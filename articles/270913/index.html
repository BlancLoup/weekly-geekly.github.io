<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Objective-C What is actually a method and self? + runtime</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="How do self and _cmd appear in the method? How does the dispatch table and categories work? What is a meta class? How many methods does your classes a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Objective-C What is actually a method and self? + runtime</h1><div class="post__text post__text-html js-mediator-article">  How do self and _cmd appear in the method?  How does the dispatch table and categories work?  What is a meta class?  How many methods does your classes actually have at ARC and at MRC?  How does swizzling work? <br>  Interesting?  Welcome under the cut! <br><br>  <b>ATTENTION!</b> <br><br>  This article is not designed for novice developers ... I apologize for not considering many things that the Objective-C developer should know. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/files/199/8d8/b4d/1998d8b4dfcb4e73baa98359ce74ace3.jpg"></div><br><a name="habracut"></a><br>  There are class methods, there are class instance methods.  Let us temporarily forget that the class has methods, we will definitely return to it later - there will be less confusion when reading the article. <br>  We will not pay additional attention to how the method is searched for in Objective-C, there are suitable articles for this, even <a href="https://ru.wikipedia.org/wiki/Objective-C">Wikipedia is</a> sufficient. <br><br>  So we begin. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/de9/38d/97c/de938d97cfb644ee93fcf6e22112bfc6.gif"></div><br><br>  The method is searched for by dispatch table at isa, going down.  That is why all methods in Objective-C are virtual, including private. <br><br>  And therefore we can turn to the method, knowing its selector. <br><br>  The key in the dispatch table is SEL (selector, <a href="http://habrahabr.ru/post/250955/">detailed parsing</a> ), and the IMP value (implementation, the most common C function) <br><br>  Method is a function?  More on that later. <br><br>  According to the picture, the table of the child class does not include the table of the parent class, but uses composition.  Let's check it in practice: <br><br><div class="spoiler">  <b class="spoiler_title">Getting the dispatch table class</b> <div class="spoiler_text"><pre><code class="objectivec hljs">... <span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> objc_method *Method; ... <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> objc_method { SEL method_name OBJC2_UNAVAILABLE; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *method_types OBJC2_UNAVAILABLE; IMP method_imp OBJC2_UNAVAILABLE; }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Human.h</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><span class="hljs-meta"> @interface Human : NSObject @property (copy, nonatomic) NSString *name; @end</span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Human.m</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Human.h"</span></span></span><span class="hljs-meta"> @implementation Human @end</span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">main.m</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><span class="hljs-meta"> #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;objc/runtime.h&gt;</span></span></span><span class="hljs-meta"> #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Human.h"</span></span></span><span class="hljs-meta"> void printAllMethodClass(Class clazz) { unsigned int count; Method *methods = class_copyMethodList(clazz, &amp;count); for (int i = 0; i </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt; count; i++) { Method method = methods[i]; SEL sel = method_getName(method); NSLog(@"%@", NSStringFromSelector(sel)); } } int main(int argc, const char * argv[]) { @autoreleasepool { printAllMethodClass([Human class]); } return 0; }</span></span></span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Conclusion</b> <div class="spoiler_text">  2015-11-14 22: 02: 03.744 TestingRuntime [71448: 6200105] .cxx_destruct <br>  2015-11-14 22: 02: 03.746 TestingRuntime [71448: 6200105] setName: <br>  2015-11-14 22: 02: 03.746 TestingRuntime [71448: 6200105] name <br></div></div></div></div><br><div class="spoiler">  <b class="spoiler_title">Comment</b> <div class="spoiler_text">  the setName and name methods are generated since we declared the property name <br></div></div><br><br>  Great, we were able to get a table of methods of the Human class and made sure that the parent table is used by the composition.  However, among our methods, .cxx_destruct was found (ARC is added when there are fields, this is where the release occurs), but this is not the topic of this article. <br>  We understand further in the dispatch table.  How do categories work?  They extend the class table.  And how does this happen?  When do we use include / import?  No, it is not. <br><br><div class="spoiler">  <b class="spoiler_title">The effect of the category on the dispatch table</b> <div class="spoiler_text"><div class="spoiler">  <b class="spoiler_title">Human + FooMethod.h</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Human.h"</span></span></span><span class="hljs-meta"> @interface Human (FooMethod) @end</span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Human + FooMethod.m</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Human+FooMethod.h"</span></span></span><span class="hljs-meta"> @implementation Human (FooMethod) - (void)fooMethod { NSLog(@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"i send msg fooMethod"</span></span></span><span class="hljs-meta">); } @end</span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">main.m</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><span class="hljs-meta"> #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Human.h"</span></span></span><span class="hljs-meta"> int main(int argc, const char * argv[]) { @autoreleasepool { Human *human = [[Human alloc] init]; [human performSelector:@selector(fooMethod)]; } return 0; }</span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Conclusion</b> <div class="spoiler_text">  2015-11-14 22: 24: 20.862 TestingRuntime [71509: 6208985] i send msg fooMethod <br></div></div><br></div></div><br><br>  Why our program did not fall, and the method was called?  Because at this moment the ‚ÄúfooMethod‚Äù method is already present in the dispatch table.  I note that the code never uses the inclusion of the file "Human + FooMethod.h".  This means that the category works on the entire project, and not only in the files where we included it, using include / import.  And what will happen if a collision occurs in the table?  Indefinite behavior, and no matter how we use the categories in the code. <br><br>  Now expand the table with your hands.  Yes, we add a method in runtime and convert a regular function into a method. <br><br><div class="spoiler">  <b class="spoiler_title">Make the function method</b> <div class="spoiler_text"><div class="spoiler">  <b class="spoiler_title">Human.h</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><span class="hljs-meta"> @interface Human : NSObject @property (copy, nonatomic) NSString *name; @end</span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">main.m</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><span class="hljs-meta"> #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;objc/runtime.h&gt;</span></span></span><span class="hljs-meta"> #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Human.h"</span></span></span><span class="hljs-meta"> void methodInRuntime(Human *self, SEL _cmd) { NSLog(@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"name self %@"</span></span></span><span class="hljs-meta">, self.name); } int main(int argc, const char * argv[]) { @autoreleasepool { class_addMethod([Human class], @selector(methodInRuntime), (IMP)methodInRuntime, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"@@:"</span></span></span><span class="hljs-meta">); Human *human = [[Human alloc] init]; human.name = @</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ajjnix"</span></span></span><span class="hljs-meta">; [human performSelector:@selector(methodInRuntime)]; } return 0; }</span></span></code> </pre></div></div><br>  <a href="https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtTypeEncodings.html">Types</a> <br><br></div></div><br><br>  The minimum limit to the method is to pass an object and a selector that symbolizes self and _cmd ( <a href="https://developer.apple.com/library/ios/qa/qa1669/_index.html">what is this?</a> ) <br><br>  So the method is the function to which the object and the selector are passed.  Does it have any practical significance? <br><br>  Now we know that self is a variable and that the block captures self as a normal external variable (topic of a separate article).  And for this, we can create a variable in the block called self (which sometimes has to be done when using macros, where self is used internally). <br><br>  A logical question arises: ‚ÄúCan we fake self and _cmd when called?‚Äù Yes, we can.  As can be seen in the code above, IMP is a simple function that can be brought to any necessary form and transfer to it whatever we want. <br><br>  What else can we do in runtime?  Use private ivar, add classes, properties, methods, delete, receive all class methods and other things.  But the article is not about how to use runtime, but about methods. <br><br>  We come to the concept of swizzling, which is a substitution. <br><br><div class="spoiler">  <b class="spoiler_title">swizzling</b> <div class="spoiler_text"><div class="spoiler">  <b class="spoiler_title">Human.h</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><span class="hljs-meta"> @interface Human : NSObject - (NSString *)fname; - (NSString *)lname; - (void)swizzling; @end</span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Human.m</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Human.h"</span></span></span><span class="hljs-meta"> #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;objc/runtime.h&gt;</span></span></span><span class="hljs-meta"> @implementation Human - (NSString *)fname { return @</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"first name"</span></span></span><span class="hljs-meta">; } - (NSString *)lname { return @</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"last name"</span></span></span><span class="hljs-meta">; } - (void)swizzling { Method mfname = class_getInstanceMethod([self class], @selector(fname)); Method mlname = class_getInstanceMethod([self class], @selector(lname)); method_exchangeImplementations(mfname, mlname); } @end</span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">main.m</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><span class="hljs-meta"> #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Human.h"</span></span></span><span class="hljs-meta"> int main(int argc, const char * argv[]) { @autoreleasepool { Human *human = [[Human alloc] init]; NSLog(@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"my fname:%@"</span></span></span><span class="hljs-meta">, [human fname]); NSLog(@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"my lname:%@"</span></span></span><span class="hljs-meta">, [human lname]); [human swizzling]; NSLog(@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"my fname:%@"</span></span></span><span class="hljs-meta">, [human fname]); NSLog(@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"my lname:%@"</span></span></span><span class="hljs-meta">, [human lname]); } return 0; }</span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Conclusion</b> <div class="spoiler_text">  2015-11-15 19: 53: 28.307 TestingRuntime [72180: 6349571] my fname: first name <br>  2015-11-15 19: 53: 28.309 TestingRuntime [72180: 6349571] my lname: last name <br>  2015-11-15 19: 53: 28.309 TestingRuntime [72180: 6349571] my fname: last name <br>  2015-11-15 19: 53: 28.309 TestingRuntime [72180: 6349571] my lname: first name <br></div></div><br></div></div><br><br>  We can also add our methods to the table and make the necessary actions.  Now there is no magic for us when we figured out what methods are. <br><br>  What about isa?  After all, everything goes here, can we change the class of an object?  We can. <br><br><div class="spoiler">  <b class="spoiler_title">Class change in runtime, without changing the address of the object</b> <div class="spoiler_text"><div class="spoiler">  <b class="spoiler_title">Human.h</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><span class="hljs-meta"> @interface Human : NSObject - (void)humanMethod; @end @interface Human1 : Human - (void)humanMethod1; @end @interface NoHuman : NSObject @property (copy, nonatomic) NSString *foo; - (void)noHumanMethod; @end</span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Human.m</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Human.h"</span></span></span><span class="hljs-meta"> @implementation Human - (void)humanMethod { NSLog(@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"humanMethod"</span></span></span><span class="hljs-meta">); } @end @implementation Human1 - (void)humanMethod1 { NSLog(@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"humanMethod1"</span></span></span><span class="hljs-meta">); } @end @implementation NoHuman - (void)noHumanMethod { NSLog(@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"noHumanMethod with property foo:%@"</span></span></span><span class="hljs-meta">, self.foo); } @end</span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">main.m</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><span class="hljs-meta"> #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Human.h"</span></span></span><span class="hljs-meta"> #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;objc/runtime.h&gt;</span></span></span><span class="hljs-meta"> int main(int argc, const char * argv[]) { @autoreleasepool { Human *human = [[Human alloc] init]; NSLog(@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ptr %p, isa = %@"</span></span></span><span class="hljs-meta">, human, NSStringFromClass([human class])); [human performSelector:@selector(humanMethod)]; object_setClass(human, [Human1 class]); NSLog(@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ptr %p, isa = %@"</span></span></span><span class="hljs-meta">, human, NSStringFromClass([human class])); [human performSelector:@selector(humanMethod)]; [human performSelector:@selector(humanMethod1)]; object_setClass(human, [NoHuman class]); NSLog(@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ptr %p, isa = %@"</span></span></span><span class="hljs-meta">, human, NSStringFromClass([human class])); NoHuman *noHuman = (NoHuman *)human; noHuman.foo = @</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"fo o"</span></span></span><span class="hljs-meta">; [noHuman noHumanMethod]; } return 0; }</span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Conclusion</b> <div class="spoiler_text">  2015-11-15 22: 40: 45.960 TestingRuntime [72469: 7427905] ptr 0x10020b8b0, isa = Human <br>  2015-11-15 22: 40: 45.961 TestingRuntime [72469: 7427905] humanMethod <br>  2015-11-15 22: 40: 45.962 TestingRuntime [72469: 7427905] ptr 0x10020b8b0, isa = Human1 <br>  2015-11-15 22: 40: 45.962 TestingRuntime [72469: 7427905] humanMethod <br>  2015-11-15 22: 40: 45.962 TestingRuntime [72469: 7427905] humanMethod1 <br>  2015-11-15 22: 40: 45.962 TestingRuntime [72469: 7427905] ptr 0x10020b8b0, isa = NoHuman <br>  2015-11-15 22: 40: 45.962 TestingRuntime [72469: 7427905] noHumanMethod with property foo: foo <br></div></div><br></div></div><br><br>  At the beginning of the article, I asked to forget that the class has methods and that it is an object in Objective-C.  So cancel it. <br><br>  Indeed, a class is an object of a meta-class.  It has its own methods, its own dispatch table, its isa.  It also has its own entry point (+ initializer). <br><br>  We can add a method in the same way to the class as we did before.  Except for one moment, you need to get a meta-class. <br><br><div class="spoiler">  <b class="spoiler_title">Demonstration, various dispatch table, use of meta-class</b> <div class="spoiler_text"><div class="spoiler">  <b class="spoiler_title">Human.h</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><span class="hljs-meta"> @interface Human : NSObject + (void)humanClassMethod; - (void)humanMethod; @end</span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Human.m</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Human.h"</span></span></span><span class="hljs-meta"> @implementation Human - (void)humanMethod { NSLog(@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"humanMethod"</span></span></span><span class="hljs-meta">); } + (void)humanClassMethod { NSLog(@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"humanClassMethod"</span></span></span><span class="hljs-meta">); } @end</span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">main.m</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><span class="hljs-meta"> #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Human.h"</span></span></span><span class="hljs-meta"> #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;objc/runtime.h&gt;</span></span></span><span class="hljs-meta"> void printAllMethodClass(Class clazz) { unsigned int count; Method *methods = class_copyMethodList(clazz, &amp;count); for (int i = 0; i </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt; count; i++) { Method method = methods[i]; SEL sel = method_getName(method); NSLog(@"%@", NSStringFromSelector(sel)); } } int main(int argc, const char * argv[]) { @autoreleasepool { printAllMethodClass([Human class]); NSLog(@"\n\n\n"); Class metaClass = object_getClass([Human class]); printAllMethodClass(metaClass); } return 0; }</span></span></span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Conclusion</b> <div class="spoiler_text">  2015-11-15 20: 20: 33.128 TestingRuntime [72303: 6360119] humanMethod <br>  2015-11-15 20: 20: 33.129 TestingRuntime [72303: 6360119] <br><br>  2015-11-15 20: 20: 33.129 TestingRuntime [72303: 6360119] humanClassMethod <br></div></div><br></div></div><br><br>  It remains to secure the material, get the address of the method of the class instance and call it as a normal function with reduction to the desired type. <br><br><div class="spoiler">  <b class="spoiler_title">Method call as a function</b> <div class="spoiler_text"><div class="spoiler">  <b class="spoiler_title">Human.h</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><span class="hljs-meta"> @interface Human : NSObject @property (copy, nonatomic) NSString *name; - (NSString *)fooMethodWithArg1:(NSString *)arg1 arg2:(NSString *)arg2; @end</span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Human.m</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Human.h"</span></span></span><span class="hljs-meta"> @implementation Human - (NSString *)fooMethodWithArg1:(NSString *)arg1 arg2:(NSString *)arg2 { return [NSString stringWithFormat:@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\nname:%@ \n_cmd:%@ \narg1:%@ \narg2:%@"</span></span></span><span class="hljs-meta">, self.name, NSStringFromSelector(_cmd), arg1, arg2]; } @end</span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">main.m</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><span class="hljs-meta"> #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Human.h"</span></span></span><span class="hljs-meta"> #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;objc/runtime.h&gt;</span></span></span><span class="hljs-meta"> int main(int argc, const char * argv[]) { @autoreleasepool { SEL sel = @selector(fooMethodWithArg1:arg2:); Method method = class_getInstanceMethod([Human class], sel); IMP imp = method_getImplementation(method); #define funcWithArg1AndArg2(imp) ((NSString * (*)())imp) Human *human = [[Human alloc] init]; human.name = @</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ajjnix"</span></span></span><span class="hljs-meta">; NSString *result = funcWithArg1AndArg2(imp)(human, sel, @</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Hello "</span></span></span><span class="hljs-meta">, @</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"world"</span></span></span><span class="hljs-meta">); NSLog(@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"%@"</span></span></span><span class="hljs-meta">, result); NSLog(@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\n\n\n"</span></span></span><span class="hljs-meta">); NSString *result1 = funcWithArg1AndArg2(imp)(human, @selector(fake_selector), @</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Hello "</span></span></span><span class="hljs-meta">, @</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"world"</span></span></span><span class="hljs-meta">); NSLog(@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"%@"</span></span></span><span class="hljs-meta">, result1); #undef funcWithArg1AndArg2 } return 0; }</span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Conclusion</b> <div class="spoiler_text">  2015-11-17 12: 28: 29.821 TestingRuntime [73269: 8918838] <br>  name: ajjnix <br>  _cmd: fooMethodWithArg1: arg2: <br>  arg1: Hello <br>  arg2: world <br>  2015-11-17 12: 28: 29.823 TestingRuntime [73269: 8918838] <br><br>  2015-11-17 12: 28: 29.823 TestingRuntime [73269: 8918838] <br>  name: ajjnix <br>  _cmd: fake_selector <br>  arg1: Hello <br>  arg2: world <br></div></div><br></div></div><br><br>  The article was not a small one, I hope I could explain what methods in Objective-C really are. <br>  ps and finally a link to the <a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtHowMessagingWorks.html">documentation</a> </div><p>Source: <a href="https://habr.com/ru/post/270913/">https://habr.com/ru/post/270913/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../270895/index.html">Analysis of price changes in Russian online stores</a></li>
<li><a href="../270897/index.html">IBM Corporation opens the Bluemix blog on Habrahabr</a></li>
<li><a href="../270901/index.html">The digest of events from the world D ‚Ññ2</a></li>
<li><a href="../270907/index.html">The pitfalls of backup and recovery of deduplicated data in a disaster recovery script</a></li>
<li><a href="../270909/index.html">Testing of domains or more than analyzing boundary values</a></li>
<li><a href="../270917/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ185 (November 8 - 15, 2015)</a></li>
<li><a href="../270919/index.html">Let's encrypt: start of the public beta on December 3</a></li>
<li><a href="../270927/index.html">Quiz of 15 questions: do you know CSS well</a></li>
<li><a href="../270929/index.html">The most simple and reliable implementation of the Dispose design pattern</a></li>
<li><a href="../270931/index.html">Forgetting old ideas and trying to invent the ‚Äúold wheel‚Äù</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>