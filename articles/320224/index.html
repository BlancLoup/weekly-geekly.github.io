<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>IAP in Unity3D</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Once upon a time, during the days of Unity 4, the addition of in-game purchases caused some difficulties. You could go in two ways: use any plugin fro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>IAP in Unity3D</h1><div class="post__text post__text-html js-mediator-article">  Once upon a time, during the days of Unity 4, the addition of in-game purchases caused some difficulties.  You could go in two ways: use any plugin from the existing ones or implement your wrapper over the native functions for each platform.  In the first case, there were several solutions: Soomla, OpenIAB, Prime, and many, many others.  Some of them were paid and were quite expensive: the price of Prime was about $ 70.  Some were free and refused to work in iOS: OpenIAB. <br><br><h3>  Unity3D 5.3 </h3><br>  And in the version of Unity3D 5.3 appeared in-app support for purchases as they say out of the box.  This simple tool makes it easy to embed in-app purchases for the most popular app stores. <br><a name="habracut"></a><br>  Now supported: <br><br><ul><li>  Amazon apps </li><li>  Google play </li><li>  iOS App Store </li><li>  Mac App Store </li><li>  Samsung GALAXY Apps </li><li>  Tizen store </li><li>  Windows Store. </li></ul><br><h3>  Project Integration </h3><br>  To begin, in the Services tab, click on the In-App Purchasing field and enable this feature.  The analytics service is also automatically turned on, in which you can later see the Revenue, Average Revenue Per Paying User (ARPPU), Average Revenue Per Daily Active User (ARPDAU). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/files/3c8/2e1/fd2/3c82e1fd204a40ceaf165e8ae49d80de.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/files/6e3/228/477/6e3228477835454bab24fc77e3ade0e3.png"></div><br>  Next, you need to click on the Import button and then, all the necessary assets will be imported into the project. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a8b/227/b3e/a8b227b3ed1044ab8e93dd8e5c9a03a6.png"></div><br><h3>  In-app manager </h3><br>  Now you need to add code to work with IAP.  <a href="">This C # script</a> contains the following functions: <br><br><ul><li>  InitializePurchasing: initializes the IAP, adds items that are available for sale and allows you to handle the necessary events </li><li>  BuyProductID: a function that allows you to buy the necessary item using its identifier </li><li>  BuyConsumable, BuyNonConsumable, BuySubscription: features that allow you to purchase various types of purchases.  Many stores support 3 types of purchases: <br><br><ol><li>  Consumable - type of purchase, which data can be spent by the player in the game (for example: coins, energy replenishment); </li><li>  NonConsumable - type of purchase, the data of which remain with the player forever (for example: a unique sword, disabling advertising) </li><li>  Subscription - subscription; </li></ol><br></li><li>  RestorePurchases: - a function that allows you to implement a mechanism to restore purchases.  Required in iOS.  If the game has a NonConsumable purchase, then there should be a button that performs its recovery. </li><li>  OnInitialize: called when the application can connect to the Unity IAP. </li><li>  OnInitializeFailed: called when the application failed to connect to the Unity IAP.  An error message is written to the console. </li><li>  ProcessPurchase: called when the purchase is successful </li><li>  OnPurchaseFailed: the function is called when the purchase fails and an error message is written to the console. </li></ul><br><h3>  Use in the game </h3><br>  To make it clearer how to use the script, I will give an example.  There are two purchases: one NonConsumable - disabling advertising, the second Consumable - gives the player 80 coins.  Two platforms are used: Google Play, AppStore.  For each purchase, you must declare three constants that contain the identifiers of purchases UnityIAP, Google Play and AppStore. <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> pMoney80 = <span class="hljs-string"><span class="hljs-string">"money_80"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> pNoAds = <span class="hljs-string"><span class="hljs-string">"no_ads"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> pMoney80AppStore = <span class="hljs-string"><span class="hljs-string">"app_money_80"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> pNoAdsAppStore = <span class="hljs-string"><span class="hljs-string">"app_no_ads"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> pMoney80GooglePlay = <span class="hljs-string"><span class="hljs-string">"gp_money_80"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> pNoAdsGooglePlay = <span class="hljs-string"><span class="hljs-string">"gp_no_ads"</span></span>;</code> </pre> <br>  After that, these constants must be passed to the initialization function: <br><br><pre> <code class="cs hljs">builder.AddProduct(pMoney80, ProductType.Consumable, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IDs() { { pMoney80AppStore, AppleAppStore.Name }, { pMoney80GooglePlay, GooglePlay.Name } }); builder.AddProduct(pNoAds, ProductType.NonConsumable, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IDs() { { pNoAdsAppStore, AppleAppStore.Name }, { pNoAdsGooglePlay, GooglePlay.Name } });</code> </pre><br>  Now on the purchase button of the item, you need to hang the BuyProductID function with passing it the identifier of the item being sold as a parameter. <br><br><img src="https://habrastorage.org/files/4f1/e12/d77/4f1e12d774184cf5bb118b64b37e2196.png"><br><br>  And in the PurchaseProcessingResult function, add actions for each of the purchases. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (String.Equals(args.purchasedProduct.definition.id, pMoney80, StringComparison.Ordinal)) { <span class="hljs-comment"><span class="hljs-comment">//Action for money ResourceManager.Instance.Money += 80; } else if (String.Equals(args.purchasedProduct.definition.id, pNoAds, StringComparison.Ordinal)) { //Action for no ads ResourceManager.Instance.NoAds = true; }</span></span></code> </pre><br>  That's all.  It remains only to remember to create purchases with the same identifiers in the AppStore and Google Play. </div><p>Source: <a href="https://habr.com/ru/post/320224/">https://habr.com/ru/post/320224/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../320212/index.html">Rounded Images on Qt Quick Scene Graph</a></li>
<li><a href="../320214/index.html">Big data protection - how to start and minimize possible risks?</a></li>
<li><a href="../320218/index.html">How a former command post becomes a data center</a></li>
<li><a href="../320220/index.html">Sparrow plug-ins and Ansible modules - comparative analysis</a></li>
<li><a href="../320222/index.html">How IT professionals work. Ilya Titov, Managing Director for IT at Modbank</a></li>
<li><a href="../320226/index.html">Is your call very important to us? Or how the prioritization system works in service departments</a></li>
<li><a href="../320228/index.html">Automation of load testing: a bunch of Jmeter + TeamCity + Grafana</a></li>
<li><a href="../320230/index.html">We test the Fujitsu PRIMERGY RX2530 M2 server</a></li>
<li><a href="../320232/index.html">R Development: Cycle Mysteries</a></li>
<li><a href="../320234/index.html">Learning lessons from 7 games born on gamejams</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>