<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The fastest floating point numbers in the wild west</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the process of implementing one "counting" there was a problem with increased accuracy of calculations. The computational algorithm worked quickly ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The fastest floating point numbers in the wild west</h1><div class="post__text post__text-html js-mediator-article">  In the process of implementing one "counting" there was a problem with increased accuracy of calculations.  The computational algorithm worked quickly on standard floating-point numbers, but when libraries for precise calculations were connected, everything began to slow down wildly.  In this article, algorithms for expanding floating-point numbers using a multi-component approach will be considered, thanks to which acceleration has been achieved, since float arithmetic is implemented on a cp crystal.  This approach will be useful for more accurate calculations of the numerical derivative, matrix inversion, polygon trimming, or other geometric problems.  So it is possible to emulate 64bit float on video cards that do not support them. <br><br><img src="https://habrastorage.org/webt/54/1e/jo/541ejotttsu8hl3swtihly-liro.png" alt="double.js benchmark"><br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Introduction </h3><br>  As Nikluas Wirth bequeathed to us to keep the numbers at 0 and 1, so we keep them in them.  And nothing, that people live in the decimal system of calculation, and the seemingly ordinary numbers 0.1 and 0.3 are not representable in the binary system as a finite fraction?  We experience cultural shock when we make calculations on them.  Of course, attempts are <a href="http://dec64.com/">being</a> made <a href="http://dec64.com/">to</a> create libraries for processors based on the decimal system and <a href="https://en.wikipedia.org/wiki/Decimal_floating_point">IEEE</a> even standardized formats. <br><br>  But for now, we always take into account storage binariness and perform all monetary calculations with libraries for accurate calculations, such as bignumber, which leads to a loss of performance.  Asiki consider crypt, and in processors there is so little space for this decimal arithmetic of yours, marketers say.  Therefore, a multi-component approach, when a number is stored in the form of an untransformed sum of numbers, is a handy trick and an actively developing area in the field of theoretical informatics.  Although Dekker learned to multiply correctly without loss of accuracy in 1971, ready-to-use libraries appeared much later (MPFR, QD) and not in all languages, apparently because not all supported the IEEE standards, but strict proofs of calculation errors even later, for example in 2017 for double-word arithmetic. <br><br><h3>  Double-word arithmetic </h3><br>  What is the point?  In bearded times, when there were no standards for floating numbers to avoid problems with the implementation of their rounding, M√∏ller came up with, and Knuth later proved that there is a summation free from errors.  Doing so <br><br><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">quickTwoSum</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a, b</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> s = a + b; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> z = s - a; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> e = b - z; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [s, e]; }</code> </pre> <br>  This algorithm assumed that if <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.913ex" height="2.66ex" viewBox="0 -832 3407.1 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/423469/&amp;xid=25657,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhifJp3_BjfC6y0NJaNDI1DW6LNU7g#MJMAIN-7C" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/423469/&amp;xid=25657,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhifJp3_BjfC6y0NJaNDI1DW6LNU7g#MJMATHI-61" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/423469/&amp;xid=25657,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhifJp3_BjfC6y0NJaNDI1DW6LNU7g#MJMAIN-7C" x="808" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/423469/&amp;xid=25657,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhifJp3_BjfC6y0NJaNDI1DW6LNU7g#MJMAIN-3E" x="1364" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/423469/&amp;xid=25657,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhifJp3_BjfC6y0NJaNDI1DW6LNU7g#MJMAIN-7C" x="2420" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/423469/&amp;xid=25657,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhifJp3_BjfC6y0NJaNDI1DW6LNU7g#MJMATHI-62" x="2699" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/423469/&amp;xid=25657,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhifJp3_BjfC6y0NJaNDI1DW6LNU7g#MJMAIN-7C" x="3128" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-1"> | a | > | b | </script>  then their exact sum can be represented as the sum of two numbers <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.014ex" height="1.937ex" viewBox="0 -676.4 2158.9 834" role="img" focusable="false" style="vertical-align: -0.366ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/423469/&amp;xid=25657,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhifJp3_BjfC6y0NJaNDI1DW6LNU7g#MJMATHI-73" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/423469/&amp;xid=25657,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhifJp3_BjfC6y0NJaNDI1DW6LNU7g#MJMAIN-2B" x="691" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/423469/&amp;xid=25657,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhifJp3_BjfC6y0NJaNDI1DW6LNU7g#MJMATHI-65" x="1692" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-2"> s + e </script>  and you can store them in pairs for subsequent calculations, and the subtraction is reduced to addition with a negative number. <br><br><img src="https://habrastorage.org/webt/6o/5b/h3/6o5bh3at9xelrvk2yslo4qk0jl0.png" alt="round-to-nearest vs bank"><br><br>  Subsequently, Dekker showed that if floating-point numbers are used that use rounding to the nearest even number (round-to-nearest ties to even, which is generally a correct procedure that does not lead to large errors in the long calculation process and the IEEE standard), then there is an error-free multiplication algorithm. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">twoMult</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a, b</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> A = split(a); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> B = split(b); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> r1 = a * b; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> t1 = -r1 + A[<span class="hljs-number"><span class="hljs-number">0</span></span>] * B[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> t2 = t1 + A[<span class="hljs-number"><span class="hljs-number">0</span></span>] * B[<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> t3 = t2 + A[<span class="hljs-number"><span class="hljs-number">1</span></span>] * B[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [r1, t3 + A[<span class="hljs-number"><span class="hljs-number">1</span></span>] * B[<span class="hljs-number"><span class="hljs-number">1</span></span>]]; }</code> </pre><br>  where split () is Mr. Weltkamp's algorithm for dividing the number <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> splitter = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.pow(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">27</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">split</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> t = splitter * a; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> d = a - t; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> xh = t + d; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> xl = a - xh; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [xh, xl]; }</code> </pre><br>  using a constant <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="11.033ex" height="2.178ex" viewBox="0 -780.1 4750.5 937.7" role="img" focusable="false" style="vertical-align: -0.366ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/423469/&amp;xid=25657,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhifJp3_BjfC6y0NJaNDI1DW6LNU7g#MJMATHI-43" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/423469/&amp;xid=25657,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhifJp3_BjfC6y0NJaNDI1DW6LNU7g#MJMAIN-3D" x="1038" y="0"></use><g transform="translate(2094,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/423469/&amp;xid=25657,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhifJp3_BjfC6y0NJaNDI1DW6LNU7g#MJMAIN-32" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/423469/&amp;xid=25657,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhifJp3_BjfC6y0NJaNDI1DW6LNU7g#MJMATHI-73" x="707" y="557"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/423469/&amp;xid=25657,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhifJp3_BjfC6y0NJaNDI1DW6LNU7g#MJMAIN-2B" x="3249" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/423469/&amp;xid=25657,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhifJp3_BjfC6y0NJaNDI1DW6LNU7g#MJMAIN-31" x="4249" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-3"> C = 2 ^ s + 1 </script>  which is equated to slightly more than half the length of the mantissa, which does not lead to an overflow of numbers in the multiplication process and divides the mantissa into two halves.  For example, if the word length is 64-bit, the length of the mantissa is 53 and then s = 27. <br><br><img src="https://habrastorage.org/webt/ut/k-/rl/utk-rlv912w0uw44uvm4cce4uts.gif" alt="double float"><br><br>  Thus, Dekker gave an almost complete set required for computing in double-word arithmetic.  Since there it was also stated how to multiply, divide and square two double-word numbers. <br><br>  He had the quickTwoSum algorithm ‚Äúinline‚Äù everywhere for summing up two double-words, and the check was used <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.913ex" height="2.66ex" viewBox="0 -832 3407.1 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/423469/&amp;xid=25657,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhifJp3_BjfC6y0NJaNDI1DW6LNU7g#MJMAIN-7C" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/423469/&amp;xid=25657,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhifJp3_BjfC6y0NJaNDI1DW6LNU7g#MJMATHI-61" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/423469/&amp;xid=25657,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhifJp3_BjfC6y0NJaNDI1DW6LNU7g#MJMAIN-7C" x="808" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/423469/&amp;xid=25657,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhifJp3_BjfC6y0NJaNDI1DW6LNU7g#MJMAIN-3E" x="1364" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/423469/&amp;xid=25657,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhifJp3_BjfC6y0NJaNDI1DW6LNU7g#MJMAIN-7C" x="2420" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/423469/&amp;xid=25657,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhifJp3_BjfC6y0NJaNDI1DW6LNU7g#MJMATHI-62" x="2699" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/423469/&amp;xid=25657,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhifJp3_BjfC6y0NJaNDI1DW6LNU7g#MJMAIN-7C" x="3128" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-4"> | a | > | b | </script>  .  On modern processors, as described in [4], it is cheaper to use additional operations with numbers than the branching algorithm.  Therefore, the following algorithm is now more appropriate for adding two single-word numbers <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">twoSum</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a, b</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> s = a + b; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> a1 = s - b; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> b1 = s - a1; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> da = a - a1; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> db = b - b1; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [s, da + db]; }</code> </pre><br>  And this is how summation and multiplication of double-word numbers is performed. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add22</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">X, Y</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> S = twoSum(X[<span class="hljs-number"><span class="hljs-number">0</span></span>], Y[<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> E = twoSum(X[<span class="hljs-number"><span class="hljs-number">1</span></span>], Y[<span class="hljs-number"><span class="hljs-number">1</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> c = S[<span class="hljs-number"><span class="hljs-number">1</span></span>] + E[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> V = quickTwoSum(S[<span class="hljs-number"><span class="hljs-number">0</span></span>], c); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> w = V[<span class="hljs-number"><span class="hljs-number">1</span></span>] + E[<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> quickTwoSum(V[<span class="hljs-number"><span class="hljs-number">0</span></span>], w); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mul22</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">X, Y</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> S = twoMult(X[<span class="hljs-number"><span class="hljs-number">0</span></span>], Y[<span class="hljs-number"><span class="hljs-number">0</span></span>]); S[<span class="hljs-number"><span class="hljs-number">1</span></span>] += X[<span class="hljs-number"><span class="hljs-number">0</span></span>] * Y[<span class="hljs-number"><span class="hljs-number">1</span></span>] + X[<span class="hljs-number"><span class="hljs-number">1</span></span>] * Y[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> quickTwoSum(S[<span class="hljs-number"><span class="hljs-number">0</span></span>], S[<span class="hljs-number"><span class="hljs-number">1</span></span>]); }</code> </pre><br>  Generally speaking, the most complete and accurate list of algorithms for double-word arithmetic, theoretical error boundaries and practical implementation is described in reference [3] from 2017.  Therefore, if interested, I strongly recommend to go there immediately.  And in general, in [6] an algorithm for quadruple-word is given, and in [5] for a multi-component extension of an arbitrary length.  Only there, after each operation, the process of renormalization is used, which is not always optimal for small sizes, and the accuracy of calculations in QD is not strictly defined.  In general, it is worth thinking about the limits of applicability of these approaches, of course. <br><br><h3>  Horror stories javascript-a.  Compare decimal.js vs bignumber.js vs big.js. </h3><br>  It so happened that almost all libraries for accurate calculations in js are written by one person.  It creates the illusion of choice, although they are almost all the same.  In addition, the documentation does not explicitly state that if you do not round the numbers after each multiply / divide operation, the size of your number will double all the time, and the complexity of the algorithm can grow to light in x3500.  For example, a comparison of their calculation times might look like this if you did not round the numbers. <br><br><img src="https://habrastorage.org/webt/lj/6r/pk/lj6rpkl_lenvq7vabfyqqhdwh8y.png"><br><br>  That is, you set the accuracy to 32 decimal places and ... Oops, you already have 64 characters, 128. We consider it very accurate!  256, 512 ... But I exhibited 32! .. 1024, 2048 ... Something like this appears overhead 3500 times.  The documentation states that if you have scientific calculations, then decimal.js will probably be better for you.  Although in fact, if you just periodically round it off, for scientific computing, Bignumber.js works a bit faster (see Fig. 1).  Who then needs to consider hundredths of kopecks if they cannot be given out as change?  Is there any case when you need to store more than the specified numbers and do not get out a few more additional signs?  How it takes the sine from such a monster number when nobody knows the exact accuracy of the convergence of a taylor series for arbitrary numbers.  In general, there are not unreasonable suspicions that there you can increase the speed of calculation using the algorithms of Sch√∂nhage ‚Äì Strassen multiplication and finding the sine with Cordic calculations, for example. <br><br><h3>  Double.js </h3><br>  I would like to say, of course, that Double.js thinks quickly and accurately.  But this is not quite so, that is, it is 10 times faster then it counts, but that's not always accurate.  For example, 0.3-0.1 it can handle, moving to double storage and back.  But here the number Pi is parsed with double precision of almost 32 characters and does not come back from it.  An error occurs on the 16th, as if there is an overflow.  In general, I urge the js community to work together to solve the problem of parsing, since I‚Äôm stuck.  I tried to parse in digital form and divide in double precision, as in QD, divide in packs of 16 digits and divide in double precision, split the mantissa using Big.js as in one of Julia.  Now I sin on a bug in .parseFloat (), since IEEE standards with rounding to the nearest integer are still supported with ECMAScript 1. Although of course you can try backing up the binary buffer and watching every 0 and 1. In general, if you can solve this problem, then it will then be possible to do calculations with arbitrary precision with acceleration in x10-x20 from bignumber.js.  However, the Mandelbrot set renders it qualitatively now, and you can use it for geometric problems. <br><br><img src="https://habrastorage.org/webt/ax/gx/mb/axgxmb_wfffxczzejqaxa9mqdpy.png" alt="double.js vs number"><br><br>  Here is a link to the <a href="">lib</a> , there is an interactive benchmark and a sandbox where you can play with it. <br><br><h3>  Sources used </h3><br><ol><li>  O. M√∏ller.  <i>Quasi double precision in floating-point arithmetic.</i>  1965 </li><li>  Theodorus Dekker.  <i>A floating-point technique for extending the available precision</i> , 1971. [ <a href="https://gdz.sub.uni-goettingen.de/id/PPN362160546_0018%3Ftify%3D%257B%2522pages%2522:%255B230%255D,%2522panX%2522:0.306,%2522panY%2522:0.754,%2522view%2522:%2522info%2522,%2522zoom%2522:0.39%257D">Viewer</a> ] </li><li>  Mioara Joldes, Jean-Michel Muller, Valentina Popescu.  <i>Tight and rigourous error bounds for building blocks of double-word arithmetic</i> , 2017. [ <a href="https://hal.archives-ouvertes.fr/hal-01351529v3/document">PDF</a> ] </li><li>  Muller, J.-M.  Brisebarre, N. de Dinechin, etc.  Handbook of Floating-Point Arithmetic, Chapter 14, 2010. </li><li>  Jonathan Shewchuk.  <i>Robust Adaptive Floating-Point Geometric Predicates</i> , 1964. [ <a href="https://people.eecs.berkeley.edu/~jrs/papers/robust-predicates.pdf">PDF</a> ] </li><li>  Yozo Hida, Xiaoye Li, David Bailey.  <i>Library for Double-Double and Quad-Double Arithmetic</i> , 2000. [ <a href="http://web.mit.edu/tabbott/Public/quaddouble-debian/qd-2.3.4-old/docs/qd.pdf">PDF</a> ] </li></ol></div><p>Source: <a href="https://habr.com/ru/post/423469/">https://habr.com/ru/post/423469/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../423459/index.html">Phoenix and Rails Differences through Convert Eyes</a></li>
<li><a href="../423461/index.html">Suborbital autumn</a></li>
<li><a href="../423463/index.html">As we wrote another RFM analysis algorithm</a></li>
<li><a href="../423465/index.html">What to read about ITSM: books, blogs and recent articles</a></li>
<li><a href="../423467/index.html">Russian developers will release a product compatibility catalog</a></li>
<li><a href="../423475/index.html">Breaking the code of aging: the new science of aging and what it means to stay young</a></li>
<li><a href="../423477/index.html">Be a security ninja: start your way to the top of IB</a></li>
<li><a href="../423479/index.html">"First": whether to fly to Mars</a></li>
<li><a href="../423481/index.html">I need to raise the Kubernetes cluster, but I'm just a code programmer. There is an exit</a></li>
<li><a href="../423483/index.html">Finding the right way to split site content with a Webpack</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>