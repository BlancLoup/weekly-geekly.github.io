<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PSGI - interface between web servers and perl web applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Not so long ago, the specification of the interface between web servers and applications / frameworks on perl PSGI - the Perl Web Server Gateway Inter...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PSGI - interface between web servers and perl web applications</h1><div class="post__text post__text-html js-mediator-article">  Not so long ago, the specification of the interface between web servers and applications / frameworks on perl <b>PSGI - the Perl Web Server Gateway Interface Specification</b> .  PSGI adds a layer of abstraction, allowing you not to worry about a specific way to connect to a web server, and implement a single interface for the specification.  You can launch such an application on servers that support PSGI - at the moment it is Plack (a set of servers and utilities), nginx (with a patch for PSGI support and embedded perl) and Apache with mod_psgi. <br><a name="habracut"></a><br><h4>  <b>Applications</b> </h4><br>  A PSGI application is a function that takes as its argument a reference to the hash with environment variables and returns the response. <br><br><h5>  Request </h5><br>  The hash passed to the application contains variables whose names are similar to the header names in CGI - REQUEST_METHOD, SCRIPT_NAME, QUERY_STRING, etc., as well as the headers from the HTTP request (starting with HTTP_, for example HTTP_HHT).  In addition, the hash should contain PSGI-specific variables: <br><ul><li>  psgi.version: Reference to array [1.0] containing the version of PSGI. </li><li>  psgi.url_scheme: http or https, depending on the request. </li><li>  psgi.input: input stream. </li><li>  psgi.errors: error output stream. </li><li>  psgi.multithread: true if the application can be called in another thread of the same process. </li><li>  psgi.multiprocess: true if the application can be called in another process. </li></ul>  Also hash can contain additional variables: <br><ul><li>  psgi.run_once: true if expected (but not guaranteed) that the application will be called only once before the process is complete (usually true only if the application is connected to the server via CGI). </li><li>  psgi.nonblocking: true if the application is called in the event loop. </li><li>  psgi.streaming: true if the server supports deferred responses and streaming. </li></ul>  An application can analyze environment variables, and take into account server features or complete its execution if the server does not support what the application needs (for example, the application being launched is non-blocking, and the server is written in synchronous style). <br><br><h5>  Answer </h5><br>  In general, an application should return a link to an array of three elements ‚Äî the HTTP response code, headers, and the response body.  The HTTP response code must be an integer number of at least 100. Headers are transmitted as a link to an array, and the Content-Type header must be present (except for answers 1xx, 204 or 304).  The response body can be a link to an array of strings (or the entire answer without line-by-line separation), either an IO :: Handle-like object or a file descriptor.  If a deferred response is required, the application can return the function to which the callback will be passed for the answer. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Sample application </h5><br>  This is the simplest PSGI application: <br><blockquote><code><font color="#000000">sub</font> <font color="#009900">{</font> <font color="#009900">[</font> <font color="#cc66cc">200</font> <font color="#339933">,</font> <font color="#009900">[</font> <font color="#ff0000">'Content-Type'</font> <font color="#339933">=&gt;</font> <font color="#ff0000">'text/plain'</font> <font color="#009900">]</font> <font color="#339933">,</font> <font color="#009900">[</font> <font color="#ff0000">'Hi, '</font> <font color="#339933">.</font> shift <font color="#339933">-&gt;</font> <font color="#009900">{</font> REMOTE_ADDR <font color="#009900">}</font> <font color="#009900">]</font> <font color="#009900">]</font> <font color="#009900">}</font></code> </blockquote> <br><br><h4>  <b>Middleware</b> </h4><br>  Middleware is similar to a normal application, but it takes 2 arguments ‚Äî environment variables and the response of the PSGI application.  Middleware can be used to analyze this data (for example, the usual access log maintenance) or their modification.  Here is an example of middleware that adds the X-PSGI-Used header to the response: <br><blockquote> <code><font color="#b1b100">my</font> <font color="#0000ff">$app</font> <font color="#339933">=</font> <font color="#000000">sub</font> <font color="#009900">{</font> <font color="#009900">[</font> <font color="#cc66cc">200</font> <font color="#339933">,</font> <font color="#009900">[</font> <font color="#ff0000">'Content-Type'</font> <font color="#339933">=&gt;</font> <font color="#ff0000">'text/plain'</font> <font color="#009900">]</font> <font color="#339933">,</font> <font color="#009900">[</font> <font color="#ff0000">'Hi, '</font> <font color="#339933">.</font> shift <font color="#339933">-&gt;</font> <font color="#009900">{</font> REMOTE_ADDR <font color="#009900">}</font> <font color="#009900">]</font> <font color="#009900">]</font> <font color="#009900">}</font> &lt;br/&gt; <br> <font color="#b1b100">my</font> <font color="#0000ff">$middleware</font> <font color="#339933">=</font> <font color="#000000">sub</font> <font color="#009900">{</font> &lt;br/&gt; <br> <font color="#b1b100">my</font> <font color="#0000ff">$env</font> <font color="#339933">=</font> <font color="#000066">shift</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#b1b100">my</font> <font color="#0000ff">$res</font> <font color="#339933">=</font> <font color="#0000ff">$app</font> <font color="#339933">-&gt;</font> <font color="#009900">(</font> <font color="#0000ff">$env</font> <font color="#009900">)</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#000066">push</font> <font color="#339933">@</font> <font color="#009900">{</font> <font color="#0000ff">$res</font> <font color="#339933">-&gt;</font> <font color="#009900">[</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#009900">}</font> <font color="#339933">,</font> <font color="#ff0000">'X-PSGI-Used'</font> <font color="#339933">=&gt;</font> <font color="#cc66cc">1</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#000066">return</font> <font color="#0000ff">$res</font> <font color="#339933">;</font> &lt;br/&gt; <br> <font color="#009900">}</font> <font color="#339933">;</font></code> </blockquote> <br>  For Plack on CPAN, there is a <a href="http://search.cpan.org/search%3Fquery%3Dplack%2Bmiddleware">rather large set of diverse middleware</a> . <br><br><h4>  <b>Servers</b> </h4><br>  The server ensures the launch of the PSGI application and must compile a hash with environment variables and pass it to the application, as well as process the response.  Now there are several PSGI servers: <br><ul><li>  <a href="http://search.cpan.org/dist/Plack/">Plack</a> is a set of middleware and servers, most of which are wrappers over existing Perl modules.  In addition, there are several servers in the same namespace that are not present in the Plack distribution on the CPAN: <a href="http://github.com/miyagawa/Plack-Server-AnyEvent">AnyEvent</a> , <a href="http://github.com/mala/Plack-Server-FCGI-EV">FCGI :: EV</a> , <a href="http://github.com/typester/Plack-Server-Danga-Socket">Danga :: Socket</a> , <a href="http://github.com/miyagawa/Plack-Server-Coro">Coro</a> , <a href="http://github.com/frodwith/plack-server-poe">POE,</a> and <a href="http://github.com/miyagawa/Plack-Server-ServerSimple">ServerSimple</a> .  Starting a PSGI application on Plack is simple: <br><blockquote> <code>plackup --server Coro --port 9090 --host 127.0.0.1 test.psgi</code> </blockquote> </li><li>  <a href="http://github.com/yappo/nginx-psgi-patchs">nginx patch for psgi support</a> </li><li>  <a href="http://github.com/spiritloose/mod_psgi/">mod_psgi for Apache</a> </li><li>  <a href="http://www.danga.com/perlbal/">Perlbal</a> </li><li>  some other servers </li></ul>  Separately, I would like to mention Plack :: Server :: AnyEvent and Plack :: Server :: Coro - these servers support file AIO, so small non-blocking PSGI applications based on them can be used to distribute statics with no blocks at all, while AIO support is not ready in nginx. <br><br><h4>  <b>Framework support</b> </h4><br>  Now there is support for PSGI in all popular web frameworks: <a href="http://www.catalystframework.org/">Catalyst</a> , <a href="http://cgi-app.org/">CGI :: Application</a> , <a href="http://search.cpan.org/dist/HTTP-Engine">HTTP :: Engine</a> , <a href="http://dancer.sukria.net/">Dancer</a> , <a href="http://www.masonhq.com/">Mason</a> , <a href="http://search.cpan.org/~beppu/Squatting/">Squatting</a> , <a href="http://search.cpan.org/~awwaiid/Continuity/">Continuity</a> , <a href="http://maypole.perl.org/">Maypole</a> , <a href="http://github.com/miyagawa/Tatsumaki">Tatsumaki</a> <br><br><h4>  <b>Links</b> </h4><br>  <a href="http://plackperl.org/">PSGI / Plack website</a> <br>  <a href="http://search.cpan.org/perldoc%3FPSGI">PSGI Specification for CPAN</a> <br>  <a href="http://search.cpan.org/perldoc%3FPSGI::FAQ">PSGI :: FAQ</a> <br>  <a href="http://search.cpan.org/perldoc%3FPlack">Plack on CPAN</a> </div><p>Source: <a href="https://habr.com/ru/post/78377/">https://habr.com/ru/post/78377/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../78368/index.html">I'll just leave it here</a></li>
<li><a href="../78372/index.html">Moscow will have its own PePYaKa!</a></li>
<li><a href="../78374/index.html">telephone systems that I crossed with VoIP Wi-Fi cell phones. Cisco CME</a></li>
<li><a href="../78375/index.html">Television about the portal gosuslugi.ru</a></li>
<li><a href="../78376/index.html">Four mobile toys that I crossed with office VoIP / SIP telephony: nokia e51 (Symbian), HP 514 & HTC Diamond (Windows Mobile), Samsung i7500 (Android)</a></li>
<li><a href="../78378/index.html">All in one click</a></li>
<li><a href="../78380/index.html">WPF4 and Taskbar in Windows 7: Thumbnail buttons</a></li>
<li><a href="../78381/index.html">LCD LG LF2510 or "why do I need a DVD now?"</a></li>
<li><a href="../78385/index.html">Session Manager - we operate with tabs in Chrome</a></li>
<li><a href="../78388/index.html">China has tightened the registration of domains to individuals</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>