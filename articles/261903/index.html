<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing LINQ in JavaScript from scratch</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What for 
 Once, when developing a graphics component for a web browser, we encountered the problem of processing sequences in JavaScript. 

 C # deve...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Writing LINQ in JavaScript from scratch</h1><div class="post__text post__text-html js-mediator-article"><h2>  What for </h2><br>  Once, when developing a graphics component for a web browser, we encountered the problem of processing sequences in JavaScript. <br><br>  C # developers have been using extension methods for sequence processing for many years.  And although this technology is not devoid of pitfalls, it allows in many cases to avoid the tedious writing of routine code for processing arrays, lists, etc. <br><br>  Naturally, I would like to have similar features in JavaScript. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      At the moment there are many implementations of LINQ for JavaScript, for example, <a href="https://linqjs.codeplex.com/">linq.js</a> , <a href="https://jscriptlinq.codeplex.com/">$ linq</a> .  These implementations provide ample opportunities comparable to C # implementations.  The downside is the considerable size of the code, from which only a small part can be used in a particular application.  For example, we need only the distinct function, and we are forced to add kilobytes of the code of the third-party library. <br><br>  Again, it is curious to understand how a particular library works, and it is often tiresome to parse the source code of a large library.  Or, in our case, we already have our <a href="">own library</a> for JavaScript and we just want to compactly supplement it with the functionality of working with sequences. <br><a name="habracut"></a><br><h2>  How useful is JavaScript to implement? </h2><br>  We define the JavaScript elements that are needed to implement the plan.  We have arrays, there are lambda functions, there are objects, inheritance is possible with some reservations.  We want to perform the operations represented by lambda functions on the data contained in the arrays and we want to group these operations in an object.  Everything is good. <br><br><h2>  Try it yourself </h2><br>  Let's start by defining the necessary entities. <br>  Obviously, for working with sequences, the most basic object is an iterator.  All that is needed from him are three methods: <br><ul><li>  moveNext () moves the pointer to the next element and returns true if successful and false if there is no next element (the end of the sequence has been reached); </li><li>  current () returns the current element or null if there is no such element (the end of the sequence has been reached); </li><li>  reset () moves the pointer to the first element of the sequence. </li></ul><br>  So, we need a method that constructs an iterator from the base sequence (for example, from the JS array). <br><br>  Next, we need an object that will contain a set of methods for working with sets (where, select, etc.).  Since I wanted to have a name reflecting the essence of the functional, rather than ‚Äúhinting‚Äù on analogs, the word Walkable was selected (the essence of which you can ‚Äúwalk‚Äù / iterate on the elements).  Each method of this object must also return a Walkable object in order to support the ability to combine several calls in one chain (in other words, so that you can transfer the result of the previous method to the next one). <br><br>  Secondly, we need a data source.  It would not be desirable to be limited to the built-in JS array as the only source.  This is where the iterator mentioned above comes in handy.  All we need from the sequence is the only method that returns an iterator (of course, every time a new instance is used so that it can be used without changing the state of other iterators).  In the next step, Walkable methods can be ‚Äúmixed in‚Äù to such an object, and as a result, any Walkable methods can be invoked over the result and cascaded into arbitrary chains. <br><br>  Let's illustrate the theory with a code.  Here is the method that creates the Walkable object from the JS array: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> arrayWalkable = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">arr</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> walker = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ .<span class="hljs-comment"><span class="hljs-comment">//  -  var idx = -1; //   //     this.reset = function() { idx = -1; }; this.moveNext = function() { return (++idx &lt; arr.length); }; this.current = function() { return (idx &lt; 0 || idx &gt;= arr.length) ? null : arr[idx]; }; }; //    ,   var walkable = { getWalker: function() { return new walker(); },}; //     Walkable // WAVE.extend -    ,    / // WAVE.extend(walkable, WAVE.Walkable); return walkable; }</span></span></code> </pre> <br>  Next, let's take the Walkable object itself.  It must contain methods for working with sequences, each of which must return a new Walkable object in its turn. <br><br>  So, we implement the Walkable object and the most popular where method.  Since we chose walkable as the name, we call all extension methods with the letter ‚Äúw‚Äù: <br><br><pre> <code class="javascript hljs">wWhere: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">filter</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> srcWalkable = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> walkable = { <span class="hljs-attr"><span class="hljs-attr">getWalker</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> walker = srcWalkable.getWalker(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">reset</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ walker.reset(); }, <span class="hljs-attr"><span class="hljs-attr">moveNext</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (walker.moveNext()) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> has = filter(walker.current()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (has) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }, <span class="hljs-attr"><span class="hljs-attr">current</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> walker.current(); } }; } } WAVE.extend(walkable, WAVE.Walkable); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> walkable; }, <span class="hljs-comment"><span class="hljs-comment">//wWhere</span></span></code> </pre><br>  As an argument for wWhere, we take the filter function, which in turn takes the sequence element as input and returns true or false (whether or not to include the element in the result).  Next we memorize this in the srcWalkable variable (a classic technique in JS). <br><br>  In the next step, by analogy with the above described arrayWalkable method, we determine the base walkable object with the key getWalker method.  With each call, we get a new iterator of the current object, so as not to affect other iterators.  And return the object. <br><br>  Then we redefine the iterator's methods in accordance with the logic of the where operation: <br><ul><li>  reset: just triggers a reset of the sequence source (for example, it can be an object produced by the WAVE.arrayWalkable method described above; </li><li>  moveNext: calls the moveNext of the source of the sequence until it finds an element that satisfies the filter criteria, or until it reaches the end of the original sequence; </li><li>  current: calls the current source of the sequence. </li></ul><br><h2>  Usage example </h2><br>  Fragments of unit tests can be cited as the simplest examples of use. <br><br>  Let us demonstrate the work of the iterator itself and walkable: <br><br>  It is easy to see that such a design allows building arbitrary functions that return Walkable into chains of arbitrary length. <br><br>  By analogy with wWhere, the remaining functions of our library are implemented, for example, wSelect, wDistinct, etc. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> aw = WAVE.arrayWalkable(a); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> walker = aw.getWalker(), i=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(walker.moveNext()) { assertTrue(a[i] === walker.current()); i++; } assertFalse(walker.moveNext()); assertTrue(<span class="hljs-literal"><span class="hljs-literal">null</span></span> === walker.current()); }</code> </pre><br>  Now use wWhere, building them into a chain: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> aw = WAVE.arrayWalkable(a); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> wWhere1 = aw.wWhere(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> e &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>; }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> wWhere2 = wWhere1.wWhere(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> e &lt; <span class="hljs-number"><span class="hljs-number">5</span></span>; }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result2 = wWhere2.wToArray(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> result2) log(result2[i]); assertTrue( <span class="hljs-number"><span class="hljs-number">3</span></span> === result2.length); }</code> </pre><br>  The code uses wrapper functions for testing included in <a href="">wv.js.</a> <br><br><h2>  findings </h2><br>  Implementing your own LINQ-like library in JavaScript is not a difficult task and anyone with minimal programming knowledge can handle it. <br><br>  Nevertheless, in our experience, such a library makes it very cool to write logic based on working with a series of data, while taking up as much space in the code as we need from it. <br><br>  The source code of the library can be obtained <a href="">here</a> , unit tests are <a href="https://github.com/aumcode/nfx/blob/master/Source/NFX.Wave/Templatization/StockContent/Embedded/script/wv.utest.htm">here</a> . <br>  P.S: <br>  I decided to add a complete list of Walkable functions: <br>  wSelect, wSelectMany, wWhere, wArt, wFe; wToArray, wEach, wWMA (moving average), wHarmonicFrequencyFilter (our own filter, the concept proved to be excellent, for example, <a href="https://play.google.com/store/apps/details%3Fid%3Dcom.itadapter.android.games.babbler%26hl%3Den">here</a> ), wConstLinearSampling, wSineGen, wSawGen, wSquareGen, wRandomGen, </div><p>Source: <a href="https://habr.com/ru/post/261903/">https://habr.com/ru/post/261903/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../261891/index.html">Detect, disassemble, study, solder and jam police police and lidars</a></li>
<li><a href="../261893/index.html">Preparing ASP.NET5, issue number 1 - let's talk about static content</a></li>
<li><a href="../261895/index.html">Gem for import of bank account statements in 1C format</a></li>
<li><a href="../261899/index.html">How important is to see the site URL?</a></li>
<li><a href="../261901/index.html">Techekspert and "Compass-3D." About the importance of secure communications and what will happen if you combine the NTD system and CAD</a></li>
<li><a href="../261905/index.html">UITableView: add icon to UITableViewRowAction</a></li>
<li><a href="../261907/index.html">Convenient structure of the iOS project</a></li>
<li><a href="../261909/index.html">Introducing the Freescale T1040RDB debug card for industrial network switches</a></li>
<li><a href="../261911/index.html">Own JS Wrapper for Uppod Player</a></li>
<li><a href="../261913/index.html">Network security Instead of introducing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>