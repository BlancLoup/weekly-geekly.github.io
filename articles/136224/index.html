<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We build a tracked Bluetooth robot with a camera. Part 3</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the previous series: 
 Part 1 
 Part 2 
 Well, have everyone already ordered parts and assembled robots? It's time to revive the robot. 
 Today we ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We build a tracked Bluetooth robot with a camera. Part 3</h1><div class="post__text post__text-html js-mediator-article">  In the previous series: <br>  <a href="http://habrahabr.ru/blogs/DIY/133414/">Part 1</a> <br>  <a href="http://habrahabr.ru/blogs/DIY/135371/">Part 2</a> <br>  Well, have everyone already ordered parts and assembled robots?  It's time to revive the robot. <br>  Today we will examine the software stuffing. <br>  The option that I offer is <b>as simple as possible</b> .  Do not expect unique abilities from him.  His task is to just <s>go to</s> work.  Fault tolerance, smooth control and additional functions - this is the scope for creativity, which I leave to everyone, so as not to deprive of this pleasure.  The code is very simple and therefore far from optimal and unprotected and not at all beautiful.  If there are suggestions for improving it - offer your options, directly pieces of code explaining why and why it would be better. <br>  Unconstructive criticism of what is done is bad - not really needed :) I already know about the shortcomings.  But if something is not clear, ask, I will explain. <br>  So let's go! <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/i8oXFiaQszk%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700191,15700253,15700256,15700259&amp;usg=ALkJrhgFvlhlANvVQBqAFpbAWTnlAfIRfQ" frameborder="0" allowfullscreen=""></iframe><br><a name="habracut"></a><br>  We divide the task into simple steps: <br>  <b>Onboard controller</b> <br><ul><li>  Caterpillar motor control for moving forward / backward and turning </li><li>  Camera Servo Control </li><li>  Receive via bluetooth and execute motion commands and camera servo controls </li></ul><br>  <b>PC / Laptop</b> <br><ul><li>  Calculate the speed of the motors to set the direction of travel </li><li>  Transmission of control packets via bluetooth </li><li>  Joystick connection for easy operation </li></ul><br><h4>  Caterpillar motor control for moving forward / backward and turning </h4><br>  Since we use a ready-made MotorShield and not a bare H-bridge or L293D / L298N, we will not have to invent anything particularly complicated.  We will use the AFMotor library.  If you have a Motorshield V3 and you need an SPI tire, take a <a href="">modified version</a> . <br>  Out of habit, I usually write comments in English, it is simpler and shorter. <br>  We declare variables for motor control.  the right motor is connected to the 4th port, the left one to the 3rd one. <br><pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-function">AF_DCMotor </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rMotor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">4</span></span></span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-comment"><span class="hljs-comment">//Right motor AF_DCMotor lMotor(3); //Left motor</span></span></code> </pre> <br><br>  depending on the given direction and speed, let the motor rotate (for the left motor): <br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (lDirection){ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: lMotor.run(RELEASE); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: lMotor.run(FORWARD); lMotor.setSpeed(lSpeed); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>: lMotor.run(BACKWARD); lMotor.setSpeed(lSpeed); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; }</code> </pre><br><br>  For the right motor is the same: <br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (rDirection){ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: rMotor.run(RELEASE); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: rMotor.run(FORWARD); rMotor.setSpeed(rSpeed); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>: rMotor.run(BACKWARD); rMotor.setSpeed(rSpeed); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; }</code> </pre><br>  lDirection (or rDirection) takes the values: <br>  0 - stop the motor <br>  1 - forward rotation <br>  2 - backward rotation. <br><h4>  Camera Servo Control </h4><br>  To control the servos, we declare two panServo objects (responsible for camera rotation) and tiltServo (responsible for tilting).  Since the servo is mechanical and does not rotate instantly, we introduce a variable for the delay required by the actuator to test the turn command (15 ms is enough) <br><pre> <code class="hljs pgsql">Servo panServo, tiltServo; long <span class="hljs-type"><span class="hljs-type">interval</span></span> = <span class="hljs-number"><span class="hljs-number">15</span></span>; // <span class="hljs-type"><span class="hljs-type">interval</span></span> at which <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> control servo long previousMillis = <span class="hljs-number"><span class="hljs-number">0</span></span>; unsigned long currentMillis;</code> </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The previousMillis and currentMillis are used so that the control loop does not stupidly wait for the servo to complete.  We check - if 15 ms has not passed since the last command, then it‚Äôs useless to command the serva - it is still busy. <br>  The piece responsible for the rotation of the camera: <br><pre> <code class="hljs pgsql"> //Rotate camera currentMillis = millis(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(currentMillis - previousMillis &gt; <span class="hljs-type"><span class="hljs-type">interval</span></span>) { previousMillis = currentMillis; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lastPan!=pan) panServo.<span class="hljs-keyword"><span class="hljs-keyword">write</span></span>(pan); // tell pan servo <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> go <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> position <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lastTilt!=tilt) tiltServo.<span class="hljs-keyword"><span class="hljs-keyword">write</span></span>(tilt); // tell tilt servo <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> go <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> position lastPan=pan; lastTilt=tilt; }</code> </pre><br><h4>  Receive via bluetooth and execute motion commands and camera servo controls </h4><br>  Bluetooth module from the point of view of Arduino is just a serial (UART) port. <br>  Therefore, we will be polling to check whether something has come from the computer.  If something is found in the buffer, then we are looking for the beginning of the packet in the stream - byte $ FF (the extreme positions of the servo drives and the speeds of the 255 engines are practically useless - the servos abut earlier, and the speed 250-255 does not differ, therefore this value Rarely and this will allow us to catch the beginning of the package, you can increase the reliability by complicating the algorithm, but this is enough for us). <br>  Having found the header, we receive a byte in which the direction of the engines is encoded by 2 bits per engine.  Then we read the engine speeds - 1 byte per engine (lSpeed, rSpeed) and the position of the camera's servos (pan, tilt). <br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-type"><span class="hljs-type">Serial</span></span>.available()&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">Header</span></span>=<span class="hljs-type"><span class="hljs-type">Serial</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">read</span></span>(); //<span class="hljs-keyword"><span class="hljs-keyword">If</span></span> <span class="hljs-keyword"><span class="hljs-keyword">header</span></span> <span class="hljs-built_in"><span class="hljs-built_in">found</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> process Cmd <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Header</span></span>==<span class="hljs-number"><span class="hljs-number">255</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-type"><span class="hljs-type">Serial</span></span>.available()&lt;<span class="hljs-number"><span class="hljs-number">5</span></span>){}; Direction=<span class="hljs-type"><span class="hljs-type">Serial</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">read</span></span>(); lSpeed=<span class="hljs-type"><span class="hljs-type">Serial</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">read</span></span>(); rSpeed=<span class="hljs-type"><span class="hljs-type">Serial</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">read</span></span>(); pan=<span class="hljs-type"><span class="hljs-type">Serial</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">read</span></span>(); tilt=<span class="hljs-type"><span class="hljs-type">Serial</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">read</span></span>();</code> </pre><br>  Next, select the directions for the right and left engines <br><pre> <code class="hljs ruby"> lDirection=Direction &amp; <span class="hljs-number"><span class="hljs-number">0x03</span></span>; rDirection=(Direction &amp; <span class="hljs-number"><span class="hljs-number">0x0C</span></span>) <span class="hljs-meta"><span class="hljs-meta">&gt;&gt; </span></span><span class="hljs-number"><span class="hljs-number">2</span></span>;</code> </pre><br>  and if the direction or speed changed from the last received command, then set the speed of the engines and rotate the camera. <br>  Here is the whole basic work cycle: <br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-type"><span class="hljs-type">Serial</span></span>.available()&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">Header</span></span>=<span class="hljs-type"><span class="hljs-type">Serial</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">read</span></span>(); //<span class="hljs-keyword"><span class="hljs-keyword">If</span></span> <span class="hljs-keyword"><span class="hljs-keyword">header</span></span> <span class="hljs-built_in"><span class="hljs-built_in">found</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> process Cmd <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Header</span></span>==<span class="hljs-number"><span class="hljs-number">255</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-type"><span class="hljs-type">Serial</span></span>.available()&lt;<span class="hljs-number"><span class="hljs-number">5</span></span>){}; Direction=<span class="hljs-type"><span class="hljs-type">Serial</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">read</span></span>(); lSpeed=<span class="hljs-type"><span class="hljs-type">Serial</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">read</span></span>(); rSpeed=<span class="hljs-type"><span class="hljs-type">Serial</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">read</span></span>(); pan=<span class="hljs-type"><span class="hljs-type">Serial</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">read</span></span>(); tilt=<span class="hljs-type"><span class="hljs-type">Serial</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">read</span></span>(); lDirection=Direction &amp; <span class="hljs-number"><span class="hljs-number">0x03</span></span>; rDirection=(Direction &amp; <span class="hljs-number"><span class="hljs-number">0x0C</span></span>) &gt;&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>; //Left <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((lastlDir!=lDirection) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> (lastlSpeed!=lSpeed)){ switch (lDirection){ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: lMotor.run(<span class="hljs-keyword"><span class="hljs-keyword">RELEASE</span></span>); break; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: lMotor.run(FORWARD); lMotor.setSpeed(lSpeed); break; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>: lMotor.run(BACKWARD); lMotor.setSpeed(lSpeed); break; } lastlDir=lDirection; lastlSpeed=lSpeed; } //Right <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((lastrDir!=rDirection) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> (lastrSpeed!=rSpeed)){ switch (rDirection){ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: rMotor.run(<span class="hljs-keyword"><span class="hljs-keyword">RELEASE</span></span>); break; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: rMotor.run(FORWARD); rMotor.setSpeed(rSpeed); break; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>: rMotor.run(BACKWARD); rMotor.setSpeed(rSpeed); break; } lastrDir=rDirection; lastrSpeed=rSpeed; } //Rotate camera currentMillis = millis(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(currentMillis - previousMillis &gt; <span class="hljs-type"><span class="hljs-type">interval</span></span>) { previousMillis = currentMillis; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lastPan!=pan) panServo.<span class="hljs-keyword"><span class="hljs-keyword">write</span></span>(pan); // tell pan servo <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> go <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> position <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lastTilt!=tilt) tiltServo.<span class="hljs-keyword"><span class="hljs-keyword">write</span></span>(tilt); // tell tilt servo <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> go <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> position lastPan=pan; lastTilt=tilt; } } } }</code> </pre><br>  As you can see, it is practically nowhere easier :) <br>  <a href="http://code.google.com/p/r-rc-robot/downloads/detail%3Fname%3DRCTank.zip%26can%3D2%26q%3D">You</a> can <a href="http://code.google.com/p/r-rc-robot/downloads/detail%3Fname%3DRCTank.zip%26can%3D2%26q%3D">download the sketch</a> from the <a href="http://code.google.com/p/r-rc-robot/downloads/list">project page</a> in Google code. <br><br>  We have taught the chassis to execute commands.  Now we need to learn how to send them. <br>  Who is too lazy to understand programming or reluctant to put Delphi, can download the <a href="">compiled version</a> <br><img src="http://habrastorage.org/storage2/8b9/d58/264/8b9d58264923f2f92a827fa827c88ff8.png"><br>  (works with the Logitech Extreme 3D Pro joystick or the EasyTouch Chinese gamepad). <br><img src="http://ecx.images-amazon.com/images/I/414X2Z0A7TL._SL500_AA300_.jpg" alt="image"><img src="http://p.gzhls.at/409285.jpg" alt="image"><br>  With the rest we go further :) <br><br>  We will need: <br><ul><li>  Delphi 2010 (it is possible and Delphi 7, just a couple of lines need to be corrected in the project file) </li><li>  Component TComPort from the open <a href="http://sourceforge.net/projects/comport/files/comport/4.11/">ComPort Library</a> (I have 4.11c installed) </li><li>  Components TjvHIDDevice, TjvHIDDeviceController from <a href="http://sourceforge.net/projects/jvcl/files/JVCL%25203/">JEDI VCL</a> .  I am using v3.38, you can download fresher.  Put it entirely, it will come in handy </li></ul><br><h4>  Calculate the speed of the motors to set the direction </h4><br>  Moving forward and backward does not cause difficulties - we simply set the same speeds of the left and right motor and the same direction. <br>  For turns in motion, we introduce the concept Steer - the deviation value from direct movement.  Engine speeds are calculated for forward and backward movement as follows: <br><pre> <code class="hljs ruby"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Speed&gt;<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> /<span class="hljs-regexp"><span class="hljs-regexp">/Forward /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/Left/</span></span>Right turn <span class="hljs-symbol"><span class="hljs-symbol">lSpeed:</span></span>=Speed-Steer; <span class="hljs-symbol"><span class="hljs-symbol">rSpeed:</span></span>=Speed+Steer; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> lSpeed&lt;<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-symbol"><span class="hljs-symbol">lSpeed:</span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> rSpeed&lt;<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-symbol"><span class="hljs-symbol">rSpeed:</span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> lSpeed&gt;MaxSpeed <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-symbol"><span class="hljs-symbol">lSpeed:</span></span>=MaxSpeed; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> rSpeed&gt;MaxSpeed <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-symbol"><span class="hljs-symbol">rSpeed:</span></span>=MaxSpeed; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> /<span class="hljs-regexp"><span class="hljs-regexp">/Backward /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/Left/</span></span>Right turn <span class="hljs-symbol"><span class="hljs-symbol">lSpeed:</span></span>=Speed+Steer; <span class="hljs-symbol"><span class="hljs-symbol">rSpeed:</span></span>=Speed-Steer; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> lSpeed&gt;<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-symbol"><span class="hljs-symbol">lSpeed:</span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> rSpeed&gt;<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-symbol"><span class="hljs-symbol">rSpeed:</span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> lSpeed&lt;(-MaxSpeed) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-symbol"><span class="hljs-symbol">lSpeed:</span></span>=-MaxSpeed; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> rSpeed&lt;(-MaxSpeed) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-symbol"><span class="hljs-symbol">rSpeed:</span></span>=-MaxSpeed; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br><br>  That is, when moving forward from the speed of the left engine, the deviation is subtracted, to the speed of the right engine - we add.  It turns out the effect of slowing down one of the tracks and the chassis turns smoothly, without stopping completely.  When moving back signs just change. <br>  Well, we check if the speed is out of the maximum allowable values.  In particular, this is useful for those who have higher voltage supply of motors than they should be - just limit the maximum speed and the motors will be intact. <br>  Management examples: <br>  <b>go forward</b> - the direction of both motors "1", the speed is the same <br>  <b>go back</b> - the direction of both motors "2", the speed is the same <br>  To rotate <b>in moving left / right we</b> set the same direction, the speeds are different.  Turns to the side, the speed of which is less. <br>  for <b>turning on the spot</b> - the speed is the same, the direction of the motors is different - it turns around the center. <br>  <b>stop</b> - both motors direction "0" <br><br><h4>  Transmission of control packets via bluetooth </h4><br>  When adding a bluetooth module to a PC, 2 virtual COM ports are formed - one incoming, one outgoing. <br>  To connect to the robot you just need to open the outgoing port.  You can define in the list of ports in the bluetooth settings or by the search method ‚Äî when connected to the correct program, the program will not swear and the LED on the module stops blinking ‚Äî the connection is established, we can assume that we are connected directly to the robot. <br><pre> <code class="hljs delphi"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfTank</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bConnectClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Tank.Connected <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Tank.Disconnect; bConnect.Caption:=<span class="hljs-string"><span class="hljs-string">'Connect'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Tank.Port:=cbPort.Text; Tank.Connect; bConnect.Caption:=<span class="hljs-string"><span class="hljs-string">'Disconnect'</span></span>; MessageBeep(MB_ICONINFORMATION); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  For convenience, I wrote a small TRCTank class that implements all actions for communicating with the robot. <br><pre> <code class="hljs delphi"> TRCTank=<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> fPort:<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; ComPort:TComPort; Cmd, lastCmd:TControlPacket; fConnected:Boolean; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isConnected</span></span></span><span class="hljs-function">:</span></span> boolean; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constructor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">destructor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Destroy</span></span></span><span class="hljs-function">;</span></span><span class="hljs-keyword"><span class="hljs-keyword">override</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Connect</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Disconnect</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SendCommand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(lDir,left, rDir, right, pan, tilt:Byte)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">property</span></span> Port:<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> fPort <span class="hljs-keyword"><span class="hljs-keyword">write</span></span> fPort; <span class="hljs-keyword"><span class="hljs-keyword">property</span></span> Connected:boolean <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> isConnected; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  Connect and Disconnect, in fact, simply open / close the port and check the current state so as not to try to open the open or close the closed port. <br><br>  To send a command to the robot, we create a header that the robot will catch (we have a byte with the code 255).  And then we write down the commands in the order that the robot is waiting for them.  It turns out such a structure <br><pre> <code class="hljs ruby"> TControlPacket=record Header, Direction, lSpeed, <span class="hljs-regexp"><span class="hljs-regexp">//left</span></span> motor speed rSpeed <span class="hljs-symbol"><span class="hljs-symbol">:Byte</span></span>;<span class="hljs-regexp"><span class="hljs-regexp">//right</span></span> motor speed pan, tilt <span class="hljs-symbol"><span class="hljs-symbol">:Byte</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>Camera pan &amp; tilt <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  In the command sending function, the only thing worth mentioning is the packing of directions for both engines in one byte by 2 bits offset.  The rest is obvious. <br><pre> <code class="hljs delphi"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TRCTank</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SendCommand</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> fConnected <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exit</span></span>; Cmd.Header:=<span class="hljs-number"><span class="hljs-number">255</span></span>; Cmd.Direction:=lDir + rDir <span class="hljs-keyword"><span class="hljs-keyword">shl</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>; Cmd.lSpeed:=left; Cmd.rSpeed:=right; Cmd.pan:=pan; Cmd.tilt:=tilt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lastCmd.Direction=Cmd.Direction) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (lastCmd.lSpeed=Cmd.lSpeed) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (lastCmd.rSpeed=Cmd.rSpeed) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (lastCmd.pan=Cmd.pan) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (lastCmd.tilt=Cmd.tilt) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exit</span></span>; ComPort.<span class="hljs-keyword"><span class="hljs-keyword">Write</span></span>(cmd, SizeOf(cmd)); lastCmd:=Cmd; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br><br><h4>  Joystick connection for easy operation </h4><br>  Unfortunately, there is not much documentation on working with HID devices on the Internet.  As a result, I went through a bunch of outdated codes that are sent to work through the midi port or consider the joysticks as a device with 2 axes and 4 buttons.  I did not like this option.  There was no information on the TjvJoystick component anywhere, so I came across it by chance.  It's a pity, by this moment I have already written my component :) So if you are not too lazy to understand, you can use the ready-made component from the JEDI VCL. <br>  I work with the HID device directly and analyze the Report from it by-byte.  But all the joystick axes are available (EasyTouch has 4 of them) and all buttons (10-12 for my joysticks). <br>  It works like this: using the TjvHIDDeviceController component on the form, we get a list of HID devices in the system and output them to the combo box.  The selected device is given to the object of the TRjoystick class by calling SelectJoystickByID (VID, PID: Word);  (It is selected by VendorID and ProductID - they can be viewed, for example, in the system device manager). <br>  The TRjoystick class performs checkout, being able to receive reports from the joystick, decrypts the values, sets the properties of the buttons and axes, and calls the handler procedure.  In our program, the handler looks like this: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">procedure</span></span> TfTank.OnJoyData; var Hat:THatPosition; CenterCamera:<span class="hljs-type"><span class="hljs-type">Boolean</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Hat:=hCenter; CenterCamera:=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>; //Easy touch joystick <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (joyPID=<span class="hljs-number"><span class="hljs-number">6</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (joyVID=<span class="hljs-number"><span class="hljs-number">121</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> scrPitch.Position:=TREasyTouchJoystick(Joy).rZ; scrAileron.Position:=TREasyTouchJoystick(Joy).Z; scrRudder.Position:=TREasyTouchJoystick(Joy).X; scrThrottle.Position:=TREasyTouchJoystick(Joy).Y; cbFire.Checked:=TREasyTouchJoystick(Joy).Btn1; cbAltFire.Checked:=TREasyTouchJoystick(Joy).Btn10; Hat:=TREasyTouchJoystick(Joy).Hat; CenterCamera:=TREasyTouchJoystick(Joy).Btn2; Speed:=Round(((TREasyTouchJoystick(Joy).rZ)<span class="hljs-number"><span class="hljs-number">-127</span></span>)*<span class="hljs-number"><span class="hljs-number">2</span></span>); Steer:=Round((TREasyTouchJoystick(Joy).Z)<span class="hljs-number"><span class="hljs-number">-127</span></span>)*<span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; //Logitech Extreme <span class="hljs-number"><span class="hljs-number">3</span></span>D Pro <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (joyPID=<span class="hljs-number"><span class="hljs-number">49685</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (joyVID=<span class="hljs-number"><span class="hljs-number">1133</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> scrPitch.Position:=TRLogitechExtreme(Joy).Pitch; scrAileron.Position:=TRLogitechExtreme(Joy).Aileron; scrRudder.Position:=TRLogitechExtreme(Joy).Rudder; scrThrottle.Position:=TRLogitechExtreme(Joy).Throttle; cbFire.Checked:=TRLogitechExtreme(Joy).Btn1; cbAltFire.Checked:=TRLogitechExtreme(Joy).Btn2; Hat:=TRLogitechExtreme(Joy).Hat; CenterCamera:=TRLogitechExtreme(Joy).Btn1; Speed:=(TRLogitechExtreme(Joy).Pitch div <span class="hljs-number"><span class="hljs-number">8</span></span>)<span class="hljs-number"><span class="hljs-number">-255</span></span>; //<span class="hljs-number"><span class="hljs-number">4096</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">-256.</span></span><span class="hljs-number"><span class="hljs-number">.256</span></span> Steer:=(TRLogitechExtreme(Joy).Aileron div <span class="hljs-number"><span class="hljs-number">4</span></span>)<span class="hljs-number"><span class="hljs-number">-127</span></span>; //<span class="hljs-number"><span class="hljs-number">1024</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">-127.</span></span><span class="hljs-number"><span class="hljs-number">.128</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; ApplyDeadZone(Speed,DeadX); ApplyDeadZone(Steer,DeadY); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Speed&gt;MaxSpeed <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Speed:=MaxSpeed; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Speed&lt;-MaxSpeed <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Speed:=-MaxSpeed; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Speed&gt;<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> //Forward //Left/Right turn lSpeed:=Speed-Steer; rSpeed:=Speed+Steer; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> lSpeed&lt;<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> lSpeed:=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> rSpeed&lt;<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> rSpeed:=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> lSpeed&gt;MaxSpeed <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> lSpeed:=MaxSpeed; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> rSpeed&gt;MaxSpeed <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> rSpeed:=MaxSpeed; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> //Backward //Left/Right turn lSpeed:=Speed+Steer; rSpeed:=Speed-Steer; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> lSpeed&gt;<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> lSpeed:=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> rSpeed&gt;<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> rSpeed:=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> lSpeed&lt;(-MaxSpeed) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> lSpeed:=-MaxSpeed; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> rSpeed&lt;(-MaxSpeed) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> rSpeed:=-MaxSpeed; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; scrLeft.Position:=-lSpeed; scrRight.Position:=-rSpeed; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cbAltFire.Checked) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (bConnect.Caption=<span class="hljs-string"><span class="hljs-string">'Connect'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> bConnect.OnClick(Self); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Hat <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> hUp: Inc(Tilt); hUpRight:<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Inc(Tilt);<span class="hljs-type"><span class="hljs-type">Dec</span></span>(pan); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; hRight: <span class="hljs-type"><span class="hljs-type">Dec</span></span>(pan); hRightDown: <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-type"><span class="hljs-type">Dec</span></span>(Pan); <span class="hljs-type"><span class="hljs-type">Dec</span></span>(tilt); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; hDown: <span class="hljs-type"><span class="hljs-type">Dec</span></span>(Tilt); hLeftDown: <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Inc(pan);<span class="hljs-type"><span class="hljs-type">Dec</span></span>(tilt); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; hLeft: Inc(pan); hLeftUp: <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Inc(pan);Inc(tilt); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; hCenter: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> CenterCamera <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> pan:=panCenter; tilt:=tiltCenter; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; //<span class="hljs-keyword"><span class="hljs-keyword">Limit</span></span> Pan&amp;Tilt range <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> pan&lt;minPan <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> pan:=minPan; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> tilt&lt;minTilt <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> tilt:=minTilt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> pan&gt;maxPan <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> pan:=maxPan; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> tilt&gt;maxTilt <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> tilt:=maxTilt; //<span class="hljs-keyword"><span class="hljs-keyword">Show</span></span> <span class="hljs-keyword"><span class="hljs-keyword">info</span></span> lJoy.Caption:=<span class="hljs-string"><span class="hljs-string">'S:'</span></span>+IntToStr(Speed)+<span class="hljs-string"><span class="hljs-string">' D:'</span></span>+InttoStr(Steer)+<span class="hljs-string"><span class="hljs-string">' L:'</span></span>+InttoStr(lSpeed)+<span class="hljs-string"><span class="hljs-string">' R:'</span></span>+InttoStr(rSpeed); lhat.Caption:=THatPosString[<span class="hljs-type"><span class="hljs-type">Integer</span></span>(Hat)]; //<span class="hljs-keyword"><span class="hljs-keyword">Show</span></span> camera position <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> sliders scrPan.Position:=pan; scrTilt.Position:=tilt; //Send command <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> tank Command2Tank; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  First, we bring the raw values ‚Äã‚Äãof the axes coordinates to the speed range -256..256 and directions -127..128. <br>  Since with linear control at low speeds, the motors do not have enough strength to move the robot, we introduce small dead zones (by experience) - it will only move from a certain speed value.  (ApplyDeadZone (Speed, DeadX); ApplyDeadZone (Steer, DeadY);) <br>  After taking into account the rudder, we check that the speeds did not get out of range, we show the speed of the motors on the form with sliders. <br>  Then, depending on the position of the hat, we change the direction of the camera or center it, and also check the constraints (the servos rest mechanically, usually before they reach the digital limits of control).  display the camera position on another pair of sliders, display the speeds and send the command to the tank. <br><pre> <code class="hljs sql">procedure TfTank.Command2Tank; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> lDir:=<span class="hljs-number"><span class="hljs-number">0</span></span>; rDir:=0; //<span class="hljs-keyword"><span class="hljs-keyword">prepare</span></span> rDir, lDir <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> based <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> tracks speed <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> lSpeed <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>:lDir:=<span class="hljs-number"><span class="hljs-number">0</span></span>; //<span class="hljs-keyword"><span class="hljs-keyword">stop</span></span> <span class="hljs-number"><span class="hljs-number">1.</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span>: lDir:=<span class="hljs-number"><span class="hljs-number">1</span></span>; //forward -255..-1:lDir:=2; //backward <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; case rSpeed of 0:rDir:=0; //<span class="hljs-keyword"><span class="hljs-keyword">stop</span></span> <span class="hljs-number"><span class="hljs-number">1.</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span>: rDir:=<span class="hljs-number"><span class="hljs-number">1</span></span>; //forward -255..-1:rDir:=2; //backward <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; Tank.SendCommand(lDir,Abs(lSpeed),rDir,Abs(rSpeed), pan, tilt); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br><br>  In the code, there are still various experiments, pieces responsible for preserving the selected port and joystick, saving and loading the limits of control and centering of the camera, it is possible to return control not by the joystick, but directly by tugging at the speed and direction sliders.  But this does not concern the main task of management.  You can use the code as you like, you can even "arrange BolgenOS" if you want :) <br>  Download the <a href="http://code.google.com/p/r-rc-robot/downloads/detail%3Fname%3DR%2520BT%2520RC%2520Tank.zip%26can%3D2%26q%3D">sources for BT R RC Tank</a> on <a href="http://code.google.com/p/r-rc-robot/">the project‚Äôs website</a> at Google code. <br>  I tried to remove the process of management from the first person, but shooting the screen with a camera was a thankless task, it was rather mediocre.  But the general meaning is clear. <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/vmSrwcP6rzs%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700191,15700253,15700256,15700259&amp;usg=ALkJrhjEaG7ydfD1jBIjSFMDTzr-huhngg" frameborder="0" allowfullscreen=""></iframe><br><br>  PS right now the chassis is disassembled for rework, so I can not quickly check any changes in the code on the hardware.  But the version available for download is quite workable, as seen in the video. </div><p>Source: <a href="https://habr.com/ru/post/136224/">https://habr.com/ru/post/136224/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../136218/index.html">Integration of some features of Scoreloop social gaming network into an Android application</a></li>
<li><a href="../136219/index.html">MSP430 Lunchpad Review and Test Project</a></li>
<li><a href="../136220/index.html">The first batch of 25-dollar computers Raspberry Pi entered production</a></li>
<li><a href="../136221/index.html">Playstation 4 will not be introduced in June</a></li>
<li><a href="../136222/index.html">Manual: Pyramid for People - Part 2</a></li>
<li><a href="../136225/index.html">About two-dimensional packaging: offline algorithms</a></li>
<li><a href="../136227/index.html">Multi-criteria selection of alternatives using fuzzy inference rules. Implementation in Java. Part 3/3: Example</a></li>
<li><a href="../136228/index.html">JQuery plugin for sorting tables: TableSorter.js. How to achieve pagination?</a></li>
<li><a href="../136230/index.html">Unified API on PHP for all cloud push services</a></li>
<li><a href="../136232/index.html">On the possibilities of antiviruses. Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>