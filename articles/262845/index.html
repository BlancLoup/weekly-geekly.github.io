<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Hey Simulator! Show your language</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Writing this material was contributed by the article Why the Verilog language to a microcontroller programmer , which describes the possibility of tes...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Hey Simulator! Show your language</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/f3d/255/4a6/f3d2554a677c40088dcbafd9934b5491.jpeg" align="left"><br>  Writing this material was contributed by the article <a href="http://habrahabr.ru/post/212507/">Why the Verilog language to a microcontroller programmer</a> , which describes the possibility of testing the algorithm (C file) of a microcontroller project in a Verilog project.  Those.  The Verilog HDL simulator interacts with the Microcontroller's Sich code and tests the implemented algorithm for possible logical errors. <br><br>  Similar methods for debugging code for microcontrollers have already been implemented by manufacturers.  I can‚Äôt vouch for everyone, but I can show by the example of the MPLAB SIM simulator from Microchip Technology Inc. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  Story </h1><br>  Many, many years ago, in Microchip, the MPLAB simulator development team developed the VHDL-like language <b>SCL</b> - Stimulus Control Language, with which you can create a testbench to help you debug the code.  However, in connection with the departure from the author's team of the SCL implementation and the ‚Äúcomplexity‚Äù of the language, it was decided to create a <a href="https://ru.wikipedia.org/wiki/%25D0%2593%25D1%2580%25D0%25B0%25D1%2584%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9_%25D0%25B8%25D0%25BD%25D1%2582%25D0%25B5%25D1%2580%25D1%2584%25D0%25B5%25D0%25B9%25D1%2581_%25D0%25BF%25D0%25BE%25D0%25BB%25D1%258C%25D0%25B7%25D0%25BE%25D0%25B2%25D0%25B0%25D1%2582%25D0%25B5%25D0%25BB%25D1%258F">GUI</a> that frees the embedded programmer from understanding the subtleties of a VHDL-like SCL and helps create test signal sequences and data injections into the registers of a simulated microcontroller.  Such a GUI wrapper in the MPLAB IDE development environment is called <b>Stimulus</b> . <br><br><div class="spoiler">  <b class="spoiler_title">Secret language</b> <div class="spoiler_text">  Microchip did not specifically promote SCL and did not provide a language description.  In 2006, it was even announced that the next version of MPLAB IDE v8.xx would generally remove support for SCL, but members of <a href="http://forum.microchip.com/">forum.microchip.com</a> were against it and SCL was left in the next releases. <br><br>  Some enthusiasts even started to ‚Äúreverse‚Äù SCL (Stimulus can generate SCL files) and create an SCL tutorial and a repository of examples.  Of particular note is the <a href="http://pic24.ru/doku.php/osa/articles/scl">Russian-language work</a> describing SCL, accompanied by several examples (from a simple generator, to emulation of UART and generation of DTMF signals). <br><br>  Due to the fact that the new generation MPLAB X IDE has been completely rewritten and cross-platform (MPLAB X is based on NetBeans), the SCL implementation has also been rewritten and the current developers have included the ‚Äúunofficial‚Äù SCL User's Guide in the MPLAB X IDE documentation. <br></div></div><br><br><h1>  GUI Stimulus features </h1><br>  Now Stimulus allows: <br>  A) create synchronous sequences of changes in the states of the outputs or values ‚Äã‚Äãof the registers (convenient for the formation of repeating sequences: <br>  At the time of the Xn state (pin, register) = XX <br>  During Xm state (pin, register) = YY <br>  The process can be repeated from step i;  between repetitions ask a delay ii. <br><br>  B) create complex effects: <br>  If the condition that (pin, bit or register) becomes (=,! =, &lt;=, &lt;,&gt; = Or&gt;) is satisfied, then through N (ticks, ns, Œºs, ms, or cm / s), execute ( one time or with period M) impact (one or more): write value to the register, change pin or bit state, set voltage on analog input. <br><br>  B) generate signals: <br>  On the pin (pin_yy) with the initial value (HIGH or LOW), output a sequence (the duration of the HIGH and LOW state is set).  The start and stop conditions are set (the program starts either by the value of the program counter or at a specified time or when the value on pin_xx == HIGH or LOW). <br><br>  D) data injection into registers: <br>  From the specified file, take the value and write it to the specified register.  The action to produce when: reading from the register occurs (that is, reading the register in the program being debugged) or the program counter will take the fixed value or the condition specified in the file will be fulfilled.  For example, you can inject data into the UART from a file of the form: <br><br> <code>wait 1 sec //  1 </code> <br> <code>01 54 106 //  </code> <br> <code>02 55</code> <br> <code>wait 200 ms //  200 </code> <br> <code>‚Äúhello‚Äù //  </code> <br> <code>rand 1 15 sec //    1  15</code> <br> <code>32 33 34</code> <br> <br>  Stimulus, in addition to the above, allows you to save the created effects as a SCL file and (!) Load your own SCL scripts. <br><br><h1>  SCL </h1><br>  Stimulus is quite a powerful tool, but it has significant limitations - it serves mainly for defining simple and deterministic influences; not every behavior model of the ‚Äúexternal environment‚Äù can be described using the GUI offered in the development environment. <br>  SCL, being a programming language, gives more flexibility: conditional expressions are available (if-elsif-else constructions), cycles, instructions for working with files, etc. <br><br>  Some SCL features: <br><ul><li>  Injecting value into pin or into microcontroller data memory </li><li>  Reading pin values ‚Äã‚Äãor from data memory </li><li>  Reading and processing files </li><li>  Perform actions based on simulation time, command loops, and based on the value of the program counter </li><li>  Issuing informational messages to the simulator window </li></ul><br><br>  That is, SCL can do everything that is available through the Stimulus GUI in MPLAB IDE.  But SCL has more opportunities and allows you to create complex dependencies between the values ‚Äã‚Äãon the outputs and the values ‚Äã‚Äãof the registers of the microcontroller;  simulate interaction with the outer periphery;  simulate impacts that are difficult to reproduce in the hardware and identify situations that lead to errors.  In addition, the development environment allows you to connect multiple SCL files for parallel execution.  This can be useful, for example, to connect to the project typical testbench-s. <br><br><h1>  Examples </h1><br>  For example, to debug and test a software decoder, you need to generate a Manchester code at the input of the microcontroller.  With the use of Stimulus, the task can be accomplished by forming a sequence of changes in the state of the output, but this is too dreary, since each change of bits needs to be registered with the hands, like this: <br><br><img src="https://habrastorage.org/files/c14/e8a/c94/c14e8ac94bc04c3eab9a0f77bb7d3e8f.png"><br><br>  Now, if you want to change the first bit, then you need to rewrite the entire sequence. <br><br>  Another thing is to form a sequence using SCL: we write testbench, which takes an input bitstream (not encoded), encodes it and sends it to the input of a simulated microcontroller.  For the convenience of changing data, the input bitstream can be taken from an external file.  Along the way, our testbench can display informational messages in the simulator window. <br><br><h3>  Sample SCL file: </h3><br><pre> <code class="hljs ruby">configuration <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-string"><span class="hljs-string">"pic16f1509"</span></span> is <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> configuration; testbench <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-string"><span class="hljs-string">"pic16f1509"</span></span> is <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> process is file fileVar : text; variable lineVar : line; -- ,    variable status : file_open_status; variable data_in : integer; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> loop file_open(status, fileVar, <span class="hljs-string"><span class="hljs-string">"dat.txt"</span></span>, read_mode); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> endfile(fileVar) == <span class="hljs-literal"><span class="hljs-literal">false</span></span> loop -- ,     readline(fileVar, lineVar); report(<span class="hljs-string"><span class="hljs-string">" "</span></span>); RB5 &lt;= <span class="hljs-string"><span class="hljs-string">'1'</span></span>; --   (<span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">2</span></span>  ) report (<span class="hljs-string"><span class="hljs-string">"== start bit =="</span></span>); wait <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">500</span></span> us; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> match(lineVar, <span class="hljs-string"><span class="hljs-string">""</span></span>) == <span class="hljs-literal"><span class="hljs-literal">false</span></span> loop --  ,     read(lineVar, data_in); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> data_in == <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> --  <span class="hljs-number"><span class="hljs-number">0</span></span> report (<span class="hljs-string"><span class="hljs-string">"== 0 =="</span></span>); RB5 &lt;= <span class="hljs-string"><span class="hljs-string">'0'</span></span>; wait <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">500</span></span> us; RB5 &lt;= <span class="hljs-string"><span class="hljs-string">'1'</span></span>; wait <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">500</span></span> us; <span class="hljs-keyword"><span class="hljs-keyword">elsif</span></span> data_in == <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> --  <span class="hljs-number"><span class="hljs-number">1</span></span> report (<span class="hljs-string"><span class="hljs-string">"== 1 =="</span></span>); RB5 &lt;= <span class="hljs-string"><span class="hljs-string">'1'</span></span>; wait <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">500</span></span> us; RB5 &lt;= <span class="hljs-string"><span class="hljs-string">'0'</span></span>; wait <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">500</span></span> us; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> report(<span class="hljs-string"><span class="hljs-string">" !"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> loop; -- match InLine <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> loop; -- endfile RB5 &lt;= <span class="hljs-string"><span class="hljs-string">'0'</span></span>; file_close(fileVar); wait <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span> ms; --    <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> loop; wait; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> process; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> testbench;</code> </pre><br><br><h3>  External data file with a bit sequence: </h3><br> <code>0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</code> <br> <code>1 0 1 0 1 1 1 0 0 0 0 0 0 1 1</code> <br> <code>1 1 1 0 1 0 1 0 0 1 1 1 0 0 0</code> <br> <br>  In the case of SCL, it is much easier to change the data, the length of the sequence and the temporal parameters of the simulated stream, which makes it easier to check the algorithm, error handling, etc ... <br><br><img src="https://habrastorage.org/files/2a7/171/1c0/2a71711c08af4ffd8dcd9d1b7e17ca25.png"><br><br>  The SCL script can parse the input file and receive external commands.  For example, in addition to the bitstream, you can change the parameters of the signals. <br><br>  An example of setting parameters for a PWM-encoded parcel with a synchro-preamble (commands parse with the SCL script and set the corresponding delays): <br> <code>sync_bit_hi 2000 us</code> <br> <code>sync_bit_lo 500 us</code> <br> <code>pulse_lo 500 us</code> <br> <code>pulse_hi_0 500 us</code> <br> <code>pulse_hi_1 1000 us</code> <br> <code>1 0 0 0 1 1 0 1</code> <br> <code>wait 2 ms</code> <br> <code>1 1 1 1 0 0 0 0 1 0 1 0 1 0 1 0</code> <br> <code>wait 3 ms</code> <br> <code>0 0 0 0 1 1 1 1</code> <br> <code>1 0 1 0 1 0 1 1</code> <br> <code>wait 15 ms</code> <br> <br><img src="https://habrastorage.org/files/0bf/5b7/4d2/0bf5b74d27534980981f9964b0d360c9.png"><br><br>  The ability to work with external files significantly expands the possibilities of simulation.  So, in the ‚ÄúSCL repository‚Äù (link at the end of the article) there is an example of obtaining data for simulation from an external application (Input to a Simulation From An External Application).  This example simulates a matrix keyboard and an input signal for an ADC (written in VBA in Excel).  ‚ÄúPressing‚Äù buttons and voltage changes are recorded in two files, the SCL script reads these files and simulates a change in the logic levels of the I / O ports and the voltage at the ADC input. <br><br><img src="https://habrastorage.org/files/fdd/be0/3f8/fddbe03f875b445c9e15bd60d00b4615.jpg"><br><br><h1>  Results </h1><br>  The SCL program has labels, addresses and variables of the code being debugged. With or .asm code.  The state of the registers, the program counter of the microcontroller, the simulation time are available.  SCL allows you to create multiple parallel processes within a single testbench.  For example, at one input we form a bit sequence, read data from another pin, process and control the state of other inputs or the state of microcontroller registers. <br><br>  Thus, SCL helps organize testbench-and to debug the code of the microcontroller.  Since SCL is part of a native simulator, SCL scripts are available in one project and in one debug cycle (yes, several SCL scripts can be connected to the project being debugged), breakpoints, stopwatch, stack, logic analyzer, etc., peripherals are being simulated (timer, UART, ADC, etc.), interrupts and it all works in the same development environment. <br><br>  Some shortcomings of the current SCL implementation should be noted: <br>  - limited debugging capabilities of the SCL code (when connecting to the draft script with an error, we receive only a message like ‚Äúparser error in line No. xx‚Äù).  If, when connecting the script, you received a message about duplicating variables, then, most likely, you connected the same testbench a second time <br><br>  - some simplifications in the current implementation (MPLAB X) <br><br><h4>  You can read more about SCL here: </h4><br><ul><li>  SCL User's Guide (included in MPLAB X IDE package documentation, <a href="http://www.microchip.com/mplabx/">www.microchip.com/mplabx/</a> ) </li><li>  <a href="http://pic24.ru/doku.php/osa/articles/scl">SCL language</a> </li><li>  <a href="http://www.microchip.com/forums/m109149.aspx">SCL Code repository</a> </li><li>  <a href="http://www.microchip.com/forums/m111255.aspx">SCL PRIMER / TUTORIAL</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/262845/">https://habr.com/ru/post/262845/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../262827/index.html">Testing password policies of the largest web services</a></li>
<li><a href="../262831/index.html">Unreal real estate developers, or why years of experience do not say anything</a></li>
<li><a href="../262833/index.html">Star rating on CSS with font-awesome font icons</a></li>
<li><a href="../262835/index.html">vCloud Director for the smallest (part 4): everything about working with virtual machine templates</a></li>
<li><a href="../262843/index.html">Why is becoming a VPN provider not so easy?</a></li>
<li><a href="../262851/index.html">Simple phone interface from Nokia</a></li>
<li><a href="../262853/index.html">Bookmarklets: if XPath is not available, and selectors and DOM navigation methods are missing</a></li>
<li><a href="../262857/index.html">Intel RealSense from a developer‚Äôs perspective</a></li>
<li><a href="../262859/index.html">Startup IaaS: Collaboration with the PickPoint Postcard Network</a></li>
<li><a href="../262861/index.html">Criticism of free-to-play, Apple Watch failures, mobile advertising market forecasts - and other news of the week for a mobile developer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>