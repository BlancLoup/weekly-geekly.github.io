<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Liquibase and changesets on pure SQL</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Not everyone knows, but since version 2.0 Liquibase supports the ability to use files with ‚Äúpure SQL‚Äù as changesets. Under the cut I want to describe ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Liquibase and changesets on pure SQL</h1><div class="post__text post__text-html js-mediator-article">  Not everyone knows, but since version 2.0 Liquibase supports the ability to use files with ‚Äúpure SQL‚Äù as changesets.  Under the cut I want to describe a little what they consist of. <br><a name="habracut"></a><br>  Comments are used to define metadata in SQL files, each changeset file starts with a comment: <br><br><pre><code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--liquibase formatted sql</span></span></code> </pre> <br>  Each changeset in the file begins with a commentary, in which all necessary parameters are indicated as follows: <br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--changeset author:id attribute1:value1 attribute2:value2 [...]</span></span></code> </pre> <br>  The following attributes can be set for a changeset: <br><table><tbody><tr><th>  Attribute </th><th>  Description </th></tr><tr><td>  stripComments </td><td>  If set to true, all comments are deleted before executing SQL statements.  The default is true. </td></tr><tr><td>  splitStatements </td><td>  If set to false, Liquibase will not separate the SQL expressions on the ‚Äú;‚Äù character, used to describe the subroutines. </td></tr><tr><td>  endDelimiter </td><td>  Specifies the SQL statement separator, the default is ";". </td></tr><tr><td>  runAlways </td><td>  If set to true, the list of changes will be executed during each build of the project. </td></tr><tr><td>  runOnChange </td><td>  If set to true, then when you edit the changeset, it will be executed at the next build of the project. </td></tr><tr><td>  context </td><td>  Creating a label for a changeset, which can later be done on request. </td></tr><tr><td>  runInTransaction </td><td>  If set to true, all SQL statements will be executed as part of a single transaction, if possible.  The default is true. </td></tr><tr><td>  failOnError </td><td>  True - the entire changeset will be canceled if errors occur during execution. </td></tr><tr><td>  dbms </td><td>  An indication of the type of DBMS for which the changeset is written. </td></tr></tbody></table><br>  After setting the parameters, preconditions are specified (optional).  Next comes a set of SQL statements, separated by a semicolon or character, specified in the endDelimiter attribute. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Currently, only one type of precondition is supported in changesets on pure SQL: SQL Check.  An example of a precondition: <br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--precondition-sql-check expectedResult:0 SELECT COUNT(*) FROM my_table</span></span></code> </pre> <br>  The expectedResult parameter is passed a value that the SQL query returns.  The query must return a single value. <br><br>  To set the behavior of the precondition check processing, the syntax is the same as setting changeset parameters: <br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--preconditions attribute1:value1 attribute2:value2 [...]</span></span></code> </pre> <br>  Attributes can be the following: <br><table><tbody><tr><th>  Attribute </th><th>  Description </th></tr><tr><td>  onFail </td><td>  Actions in case the changeset cannot be executed. </td></tr><tr><td>  onError </td><td>  Actions in case the changeset returns an error. </td></tr><tr><td>  onUpdateSQL </td><td>  Actions that will be performed on the changeset if it is executed in updateSQL mode. </td></tr><tr><td>  onFailMessage </td><td>  The message that will be returned if the changeset cannot be executed. </td></tr><tr><td>  onErrorMessage </td><td>  The message that will be returned if the changeset is executed with an error. </td></tr></tbody></table><br>  The following values ‚Äã‚Äãcan be passed to the onFail and onError attributes: <br><table><tbody><tr><th>  Value </th><th>  Description </th></tr><tr><td>  HALT </td><td>  Immediately terminate the changeset. </td></tr><tr><td>  CONTINUE </td><td>  The contents of the changeset will be skipped and an attempt will be made to re-execute it the next time. </td></tr><tr><td>  MARK_RAN </td><td>  Changeset will be marked as completed. </td></tr><tr><td>  WARN </td><td>  A warning will be generated and the changeset will continue to run normally. </td></tr></tbody></table><br>  Changesets can include SQL statements for rollback.  Rollback expressions are described in the comment form: <br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--rollback SQL STATEMENT</span></span></code> </pre> <br>  Well, in conclusion, a small example of a changeset file: <br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--liquibase formatted sql --changeset User1:1 create table test1 ( id int primary key, name varchar(255) ); --rollback drop table test1; --changeset User2:1 --preconditions onFail:CONTINUE onError:CONTINUE --precondition-sql-check expectedResult:0 SELECT COUNT(*) FROM test1 insert into test1 (id, name) values (1, 'User1'); --rollback delete from test1 where id = 1;</span></span></code> </pre><br><br>  Summarizing all the above, I would like to add that such files are read and written much easier than xml files, but not all the buns are still supported (an example of preconditions, only SQL Check is supported now). </div><p>Source: <a href="https://habr.com/ru/post/251617/">https://habr.com/ru/post/251617/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../251607/index.html">Using texture detailing to achieve the highest quality realism (more)</a></li>
<li><a href="../251609/index.html">Lenovo attacked in retaliation for the spyware Superfish</a></li>
<li><a href="../251611/index.html">Ensemble Workflow UI on Angular</a></li>
<li><a href="../251613/index.html">For the capture of the author Zeus appointed maximum reward</a></li>
<li><a href="../251615/index.html">Using color spaces in ATTiny13a for WS2811</a></li>
<li><a href="../251619/index.html">How we started monitoring the domains and what came of it</a></li>
<li><a href="../251623/index.html">Chemistry gamedev or how to manipulate players</a></li>
<li><a href="../251625/index.html">New utorrent bugs or what Bittorrent programmers are preparing for us</a></li>
<li><a href="../251627/index.html">Creating a world map</a></li>
<li><a href="../251629/index.html">Understanding the LCD screen LPH9157-2 from Siemens C75 / ME75</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>