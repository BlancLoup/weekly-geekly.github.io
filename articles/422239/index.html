<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to start shipping for millions of users</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! My name is Denis. I am the head of the SafeDeal area in Avito. We develop the ‚ÄúDelivery‚Äù and ‚ÄúShort-term lease‚Äù services and make their use con...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to start shipping for millions of users</h1><div class="post__text post__text-html js-mediator-article"><p>  Hello!  My name is Denis.  I am the head of the SafeDeal area in Avito.  We develop the ‚ÄúDelivery‚Äù and ‚ÄúShort-term lease‚Äù services and make their use convenient, understandable and secure.  In March of this year, we launched a service for the delivery of goods between private users.  It would seem that there is such a thing and why devote an entire article to it?  Delivery is available at all online stores, many customers use it and there are no great difficulties with this service. </p><br><p>  Yes it is.  There are no problems if the seller is a legal entity, a company representative.  But when private buyers and sellers are connected to this process from both sides, a number of interesting tasks and problems appear that need to be addressed.  Taking into account the fact that Avito is visited by more than 34 million users every month, we understood that the transfer of goods from the seller to the buyer with the help of our service should be made as simple as possible.  In the article I will talk about the prerequisites for launching delivery between private users on Avito, about the problems we encountered, and how we solved them thanks to agreements with our partners and attention to detail.  And I will show some insides of the service: its mechanics and architecture. </p><br><img src="https://habrastorage.org/webt/pl/sh/ji/plshji-9b2jt2atqsapxqaa4opa.png"><a name="habracut"></a><br><h1 id="zachem-na-avito-poyavilas-dostavka-predposylki">  Why there was a delivery on Avito: prerequisites </h1><br><h3 id="rasshirit-assortiment-tovarov-dlya-kazhdogo">  To expand the range of products for each </h3><br><p>  Avito is tens of thousands of small communities of buyers and sellers in each locality.  But if, for example, you live in Voronezh and tomorrow you want to buy ski boots size 44 on Avito, in your city (at the time of writing this article) there are only four ads you need.  Not a great choice.  When searching across Russia you will see 377 ads.  Selection increases 94 times. </p><br><p>  Sometimes, due to lack of choice or unwillingness to engage in logistics of delivery of goods from another region, buyers left Avito and searched for the goods they needed on the Internet and in local stores.  Often it turned out to be more expensive.  A purchased new product was not always better.  That is, although Avito was what the buyer liked, he did not dare to buy it.  We wanted to rectify the situation. </p><br><h3 id="reshit-problemy-mezhregionalnyh-prodavcov-i-pokupateley">  Solve the problems of interregional sellers and buyers </h3><br><p>  We have an analytical model, which with high accuracy considers how many transactions are made on Avito.  She tells us that private users annually conclude 63 million transactions among themselves.  A quarter of them are interregional.  Of course, distance introduces certain difficulties in this process. </p><br><p>  Before the launch of the delivery, the interregional transaction was partly a kind of ‚Äúleap of faith‚Äù.  Buying goods from another region, people often made an advance payment for it.  And nervous, relying on the integrity of the seller.  And if users agreed that the buyer would pay after receiving the goods, then the seller was in danger.  Sometimes cash on delivery was used.  The seller sent the parcel by mail indicating its value, and the buyer took the goods and paid for them.  Then the money went to the sender.  But cash on delivery did not resolve all issues: the recipient had to pay upon delivery, without the ability to check the contents and make sure that there lies (for example) the iPhone, the purchase of which was agreed with the seller, and not a brick. </p><br><p>  In addition, there were often contradictions about who exactly was to pay for the delivery service itself, and because of this there were no transactions.  We have always tried to help users, but first of all we acted as an ‚Äúinfrastructure bridge‚Äù between people, not taking part in the transaction.  Avito connected the seller and the buyer, and further arrangements and their faithful execution remained on the conscience of users.  This situation did not suit us.  Buying goods at a profit is not the main criterion for the success of a transaction on ad sites.  Trust and security issues are just as important.  We wanted to create a reliable service that will make the process of making transactions easier, more convenient and safer. </p><br><h3 id="privlech-novyh-pokupateley">  Attract new customers </h3><br><p>  It is difficult to find in Russia a person who would not have heard about Avito.  But not everyone uses the service.  Someone simply does not like to meet personally with the seller, to understand the features of parcel shipments, to transfer money to unknown accounts and cards.  Therefore, we defended the delivery transactions so that people who previously did not dare to buy and sell products on Avito, tried our service using convenient mechanics. </p><br><h1 id="kak-eto-rabotaet-mehanika-i-arhitektura">  How it works: mechanics and architecture </h1><br><h3 id="mehanika">  Mechanics </h3><br><p>  We tried to make the mechanics of using Avito delivery simple and straightforward.  The buyer selects the product, clicks "Buy with delivery" and pays for the product and delivery by credit card.  Until the goods are received, the money is reserved in the bank escrow account.  The seller receives a confirmation of payment, and he has two days to take the goods to the receiving point.  When the goods arrive at the point of issue, the buyer must pick up the package within three days.  At the point of issue the buyer calls the code from the SMS and receives the goods.  It can be checked within 15 minutes, after which the purchase is confirmed.  After the buyer receives the goods, the seller receives a message on Avito.  He binds his bank card - the money will be transferred to her from the escrow account.  The transaction is completed. </p><br><h3 id="arhitektura">  Architecture </h3><br><p>  In this section, I will talk about the product internals and services that are responsible for the work at the stage of purchase, delivery and upon receipt of the goods. </p><br><h4 id="pokupka">  Purchase </h4><br><p>  When a user selects a product through the site or the Avito mobile app, he sends a request to the Avito-Site service.  The Avito site backend ‚Äúcommunicates‚Äù with two systems: <br>  <strong>1. Avito Delivery Core</strong> - contacts the delivery service. <br>  <strong>2. Billing</strong> - forwards the request to QIWI, Tinkoff. </p><br><img src="https://habrastorage.org/webt/v5/eb/my/v5ebmyoach2rwd5sltnat8aqore.gif"><br><p>  After the buyer has chosen the product, he gets to the page where he can find out the cost and delivery time. </p><br><img src="https://habrastorage.org/webt/kt/qp/nj/ktqpnjsqzbjlslxg2l3m0v5wqpi.png"><br><h4 id="servisy-kotorye-zdes-uchastvuyut">  Services that are involved here </h4><br><p>  <strong>Avito-Site.</strong>  Sends requests. <br>  <strong>Calculation.</strong>  Stores tariffs and knows how much shipping will cost based on the selected product category. <br>  <strong>Terminal Keeper.</strong>  Finds pickup points in the city of the recipient. <br>  <strong>Delivery-Geo.</strong>  Stores information about the possibility of delivery to a specific city and the timing of delivery. </p><br><h4 id="shema-raboty-servisov">  Scheme of work of services </h4><br><img src="https://habrastorage.org/webt/qe/zm/hc/qezmhcv9m-pbdvnn6gszx0srb9u.gif"><br><h4 id="ot-oplaty-k-dostavke">  From payment to delivery </h4><br><p>  At this stage, an order is actually created. </p><br><h4 id="servisy-kotorye-uchastvuyut-na-etom-etape">  Services that are involved at this stage </h4><br><p>  <strong>Avito-Site.</strong>  Sends requests to other services. <br>  <strong>Order-Controller.</strong>  It proxies calls to our other internal services and conducts the initial validation of data received from the Avito-Site backend. <br>  <strong>Order-Expiration.</strong>  Tracks the life of the order.  If the payment deadlines have passed, the buyer‚Äôs order must be invalidated. <br>  <strong>Calculation.</strong>  Calculates shipping costs. <br>  <strong>Callback Processor.</strong>  Notifies Avito-Site about changes to the order. <br>  <strong>Order keeper</strong>  Service, as a kind of wrapper over the base with the API.  Some business validations still occur in it, and after that it gives the order number to Order-Controller. </p><br><h4 id="shema-raboty-servisov-1">  Scheme of work of services </h4><br><img src="https://habrastorage.org/webt/8h/2q/ac/8h2qacz2kzzym5jw-a_r0qspmhm.gif"><br><p>  When Order-Controller sent everything it owed and received the order number, it sends the information to Avito-Site: ‚ÄúEverything went well‚Äù.  The Avito-Site backend knocks on Billing, which works with QIWI or Tinkoff, and the order is paid. </p><br><img src="https://habrastorage.org/webt/g2/ec/fn/g2ecfnlb95q5ifgais0aisnylxc.gif"><br><p>  After successful payment, the Avito-Site backend knocks on our Order-Controller service, saying: "The confirmation was successful." </p><br><img src="https://habrastorage.org/webt/qf/jy/li/qfjylikhf3rwes8uxuwmia4ciys.gif"><br><p>  The next step - Order-Controller again knocks on Order-Keeper, saying: "We confirm the order."  Order-Keeper checks for correct status.  (Suddenly, such a product has already been delivered, canceled, or something else happened to it).  If the check is successful, the service transfers the status to the confirmation to the delivery service. </p><br><img src="https://habrastorage.org/webt/qz/r7/yh/qzr7yhdkp_loeoq3ryqura2wzpk.gif"><br><p>  Further, Order-Controller knocks on the Order-Expiration service, and says that the buyer‚Äôs payment phase of the order is over.  Now the seller has from two to four days to carry the goods to the pick-up point.  Order-Expiration follows these deadlines.  If the seller does not have time, the service will cancel the order, and the money will be returned to the buyer. </p><br><img src="https://habrastorage.org/webt/uc/4_/ut/uc4_utvdfwyasbvhkpevrgoz0jy.gif"><br><h4 id="dostavka">  Delivery </h4><br><p>  The first part of the transaction was completed: the buyer paid the order and the money was deducted from his account.  Now the seller must bring his goods to the delivery service within two days. </p><br><h4 id="kakie-servisy-zdes-rabotayut">  What services are working here </h4><br><p>  <strong>Avito-Site.</strong>  Still sending requests. <br>  <strong>Order-Controller.</strong>  Proxy calls to other internal services and validates data received from the Avito-Site backend. <br>  <strong>Order keeper</strong>  Stores order number and order payment information. <br>  <strong>Delivery Registrator.</strong>  Responsible for registering an order directly to the delivery service. <br>  <strong>Delivery-Submitter.</strong>  Registers and cancels the order, gives the number assigned by the delivery service to our services. <br>  <strong>Status-Manager.</strong>  It stores all statuses in our version, validates incoming information and notifies the necessary services about it. <br>  <strong>Callback Processor.</strong>  Notifies Avito-Site that the order is paid. <br>  <strong>Messenger.</strong>  Sends messages to the user. </p><br><h4 id="kak-eto-proishodit">  How does this happen </h4><br><img src="https://habrastorage.org/webt/v4/d0/fr/v4d0fr4mpjo5givl3swihfikpfu.gif"><br><p>  <sub>We explain the work of services on the example of the Boxberry delivery service.</sub>  <sub>But since recent times we have also been working with DPD.</sub> </p><br><h4 id="poluchenie">  Getting </h4><br><p>  The transaction is nearing completion - the order is on the way, or has already been delivered to the buyer.  We should inform the user about this in the messenger. </p><br><h4 id="servisy-uchastvuyuschie-na-poslednem-etape">  Services involved in the last stage </h4><br><p>  <strong>Delivery-History-Converter.</strong>  Receives and stores status according to the delivery service version: ‚Äúon the way‚Äù, ‚Äúready for issue‚Äù, ‚Äúreturned‚Äù. <br>  <strong>Order keeper</strong>  Stores information received from the delivery service about the dimensions, weight of the goods and the receiving terminal. <br>  <strong>Status-Manager.</strong>  Updates the latest status received and sends a request to Order-Expiration. <br>  <strong>Order-Expiration.</strong>  Monitors the timing of dispatch of goods by the seller. <br>  <strong>Callback Processor.</strong>  Alerts Avito-Site. <br>  <strong>Avito-Site.</strong>  Sends information to the messenger. </p><br><h4 id="shema-raboty-servisov-2">  Scheme of work of services </h4><br><img src="https://habrastorage.org/webt/lv/5r/h6/lv5rh69iww71xg2ln61ykoh5p3o.gif"><br><h1 id="kakie-problemy-pokupateley-i-prodavcov-reshaet-dostavka">  What problems do buyers and sellers solve? </h1><br><p>  I'll tell you what other problems private users encounter, and how we solved them with the launch of the delivery. </p><br><h3 id="fiksirovannaya-cena-dostavki">  Fixed Shipping Price </h3><br><p>  Usually the cost of delivery of a professional service depends on the size and weight of the goods.  Indicating them correctly is not a problem for a professional.  But the private seller may be mistaken in the parameters of length, width or weight, and then he will be charged an additional bill.  Because of this, use the delivery services do not want. </p><br><p> We have large volumes of service - daily sellers place over 400,000 ads.  We didn‚Äôt want each of them to be dissatisfied with our product only because it could not accurately indicate the size of its goods.  No one would connect to the delivery, and customers would be inconvenient to use Avito.  Therefore, we compared our category tree with Boxberry and DPD dimensions and tariffs and converted them into conditional dimensions.  For the tariffs we use in delivery, the goods of the same category are always the same size and weight.  It doesn‚Äôt matter if you sell iPad mini or iPad Pro - you don‚Äôt need to pay additional fees for errors in size.  Although there are services that require you to pay a commission, if the seller incorrectly indicated the size and weight of the goods. </p><br><h3 id="upakovka">  Packaging </h3><br><p>  In a classic delivery, the seller always packs the goods.  He has opportunities for that.  But if you, for example, simply sell an old TV, you may encounter a problem: the delivery service will not accept the goods without packaging, and you hardly have a factory box of it, and there is hardly any packing paper storage around the corner.  We agreed with the delivery service that they undertake this task, and therefore sellers do not waste time on unnecessary action. </p><br><h3 id="legkiy-process-otpravleniya-i-polucheniya-tovara">  Easy process for sending and receiving goods </h3><br><p>  Each order has its own unique number, which only the seller and the recipient know.  In order to deliver and receive an order, you need to call this number.  You don‚Äôt need to do anything else - for example, fill in invoices.  In many delivery services without this action, you will not send or receive anything. </p><br><h3 id="bezopasnost-i-kontrol-sdelki">  Security and transaction control </h3><br><p>  The advantage of delivery to Avito is also in the fact that it is not just the shipment of goods from the seller to the buyer, but also money management.  If the buyer did not like the product, he can refuse it, and the money will be returned to him.  And you do not have to pay for the return delivery of goods, as happens in other services.  We not only help physically deliver the goods, but also participate in the transaction, protecting sellers and buyers.  If problems arise, we will solve them. </p><br><h3 id="nelzya-dvazhdy-kupit-odin-tovar">  You can not buy one product twice </h3><br><p>  If the goods are paid, we hang a tag with information about it.  This helps us avoid confusion with double payment of a single product.  But if the seller has several copies of the same product, soon he can also indicate this.  Then we just change their number in the issue. </p><br><h1 id="chto-v-itoge">  What is the result </h1><br><p>  We have launched a convenient service for private sellers and buyers, which provides them with new opportunities and helps them better achieve their goals.  After three months of work, we summed up the interim results. </p><br><p>  Now with delivery, you can buy 5 million products - this is 36% of all ads for sale.  Most of them, of course, in Moscow - the number of ads exceeded one million, and in St. Petersburg - more than 500 thousand ads.  These same cities and the most "sending".  Since the beginning of April, users have sent almost 67 thousand products across Russia.  One day record - 2,115 shipments. </p><br><p>  Most often, users made intracity departures in Moscow - this route accounted for 5% of all parcels.  The next three most popular delivery routes are in the two largest cities: Moscow - St. Petersburg (1.6%);  St. Petersburg - St. Petersburg (1.5%);  St. Petersburg - Moscow (1.1%).  Then - departures from Moscow to Rostov-on-Don, Nizhny Novgorod, Krasnodar, Yekaterinburg, Novosibirsk and Voronezh.  With delivery to Avito, you can send the goods to any region of Russia.  The longest route was the route Moscow - Yuzhno-Sakhalinsk: a highchair for feeding from the capital flew more than 6.6 thousand kilometers. </p><br><p>  This is the first post in the series about shipping to Avito.  If you are interested in this topic, in the following posts we will tell you a little more about the technology of our service: with code and other internals.  Ask your questions in the comments, we will try to answer. </p><br><p>  Stay tuned! </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/422239/">https://habr.com/ru/post/422239/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../422227/index.html">The origins of science in the stone age?</a></li>
<li><a href="../422229/index.html">We invite to the conference Fujitsu World Tour 2018</a></li>
<li><a href="../422231/index.html">"Perfect" time plan in the form of a Gantt chart</a></li>
<li><a href="../422233/index.html">Dedicated to all the best teachers ...</a></li>
<li><a href="../422235/index.html">Designing dashboards for web analytics e-commerce site. Part 1: User-friendly interface</a></li>
<li><a href="../422241/index.html">KPI - three letter sticking</a></li>
<li><a href="../422243/index.html">CRM for small business. Do you need it?</a></li>
<li><a href="../422247/index.html">OK Instant Games Cup. Contest for HTML5 games</a></li>
<li><a href="../422251/index.html">"High level of self-discipline." Jeffrey Richter on how to code, write books and create your own companies</a></li>
<li><a href="../422253/index.html">Yew - Rust & WebAsse framework for frontend</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>