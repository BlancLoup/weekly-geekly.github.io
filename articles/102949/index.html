<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to use PivotViewer for Silverlight in a real project (Part II)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This post is the end of the article How to use PivotViewer for Silverlight in a real project . 

 Now our application already has a page that can disp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to use PivotViewer for Silverlight in a real project (Part II)</h1><div class="post__text post__text-html js-mediator-article">  This post is the end of the article <a href="http://-felix-.habrahabr.ru/blog/102912/">How to use PivotViewer for Silverlight in a real project</a> . <br><br>  Now our application already has a page that can display a test collection of data (our prototype).  Moving on to the next step ... <br><br><h3>  Step 4, software generation of xml with data and images in Deep Zoom format </h3><br>  We need to create a .cxml file with xml data and convert the images of the elements into Deep Zoom format.  In principle, xml can be easily created using standard .NET classes, and to work with Deep Zoom, use the Deep ZoomTools.dll library (part of the <a href="http://www.microsoft.com/downloads/details.aspx%3FFamilyID%3D457B17B7-52BF-4BDA-87A3-FA8A4673F8BF%26displaylang%3Den">Deep Zoom Composer</a> ).  But there is an even more convenient way - <a href="http://pauthor.codeplex.com/">Pauthor</a> .  This project includes both .dll, which can be called from your code, as well as a command line utility and allows you to create collections for Pivot, as well as to convert between these collections to other formats (CSV, Excel, CXML with raw images, and CXML with DeepZoom images) and back. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Pauthor is convenient in that it allows you to form a collection using high-level objects such as PivotCollection, PivotFacetCategory, PivotItem, etc. The example of using Pauthor is given in habrotopic. <a href="http://habrahabr.ru/blogs/silverlight/99371/">We create PivotViewer site content in 10 minutes using the example of Habrahabr</a> , so we will not dwell on it. <br><a name="habracut"></a><br>  There is one useful point that can greatly improve the usability of our viewer.  We do not want to force the user to poke at all the pictures in a row in order to understand what exactly (what product model, hotel or person) are drawn on them?  It would be nice to place these names directly in the pictures.  But usually we have just images of goods or something else without any signatures.  So, when creating the Deep Zoom collection, Pauthor allows us to specify an html template, on the basis of which images will be formed.  In addition to pure html, placeholders can be used in these templates, which will be replaced with the corresponding characteristics from the object description.  Here is an example of a simple template: <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">html</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">head</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">style</font> <font color="#0000ff">&gt;</font> <br> body { <br> margin: 0px; <br> } <br> img { <br> position: absolute; <br> top: 0; left: 0; <br> width: 100%; height: 100%; <br> } <br> p { <br> font-size: 100px; <br> color: white; <br> background: grey; <br> position: absolute; <br> bottom: 0; <br> left: 0; <br> width: 100%; <br> filter: alpha(opacity=50); <br> padding: 20px; <br> } <br> <font color="#0000ff">&lt;/</font> <font color="#800000">style</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">head</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">body</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">img</font> <font color="#ff0000">src</font> <font color="#0000ff">="{image}"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">p</font> <font color="#0000ff">&gt;</font> {name} <font color="#0000ff">&lt;/</font> <font color="#800000">p</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">body</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">html</font> <font color="#0000ff">&gt;</font></font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  In the folder with Pauthor you can find several other examples.  And here is an example of what can happen, taken from a <a href="http://www.hitched.co.uk/wedding-venues/visual-search.htm">site</a> that will allow you to choose a place for your wedding: <br><br><img src="https://habrastorage.org/storage/b19335ba/d46f3edb/d2cc1b3c/8a7e24d9.jpg"><br><br>  So, at first glance, everything is in order - we can programmatically create a collection with the data we need, and Pivot Viewer does the rest.  But for more convenience, it does not hurt to add a couple of details.  So‚Ä¶ <br><br><h3>  Step 5, optional, but fine and useful doping of the element with a file :) </h3><br>  When the user selects one of the pictures, its detailed description appears in the property panel (on the right side of the Viewer).  The title of the description is highlighted as a link, but what happens when you click on this link, the Viewer completely leaves it to our discretion. <br><br>  In the same way, users are accustomed to the fact that a double click on an object takes the default action.  The viewer handles double-click on the image in the same way as a click on the description title - it forms the event and leaves the decision for us. <br><br>  To process them, add a couple of lines of code to the .xaml page in the Silverlight project: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">&lt;pivot:PivotViewer <br> x:Name= <font color="#A31515">"MainPivotViewer"</font> <br> LinkClicked= <font color="#A31515">"OnPivotViewerLinkClicked"</font> <br> ItemDoubleClicked= <font color="#A31515">"OnPivotViewerItemDoubleClicked"</font> <br> /&gt; <br> <br> <font color="#008000">/// &lt;summary&gt;</font> <br> <font color="#008000">/// Handle links clicked in the metadata pane.</font> <br> <font color="#008000">/// &lt;/summary&gt;</font> <br> <font color="#0000ff">private</font> <font color="#0000ff">void</font> OnPivotViewerLinkClicked(Object sender, LinkEventArgs args) <br> { <br> OpenLink(args.Link.ToString()); <br> } <br> <br> <font color="#008000">/// &lt;summary&gt;</font> <br> <font color="#008000">/// Handle double-clicks on collection items</font> <br> <font color="#008000">/// &lt;/summary&gt;</font> <br> <font color="#0000ff">private</font> <font color="#0000ff">void</font> OnPivotViewerItemDoubleClicked(Object sender, ItemEventArgs args) <br> { <br> <font color="#2B91AF">String</font> linkUriString = MainPivotViewer.GetItem(args.ItemId).Href; <br> <font color="#0000ff">if</font> (! <font color="#2B91AF">String</font> .IsNullOrWhiteSpace(linkUriString)) <br> { <br> MainPivotViewer.CurrentItemId = args.ItemId; <br> OpenLink(linkUriString); <br> } <br> <font color="#0000ff">else</font> <br> { <br> <font color="#008000">// Error: No Associated Web Page: the item that was double-clicked has no value for the 'Href' field</font> <br> } <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  In our case, we call the OpenLink helper method, which opens a page with a description of the object in another browser window.  It is quite possible, instead of going through the url, you will want to add selected objects to the basket or open some other collection of objects.  In order not to increase the size of the description, the OpenLink code is not shown here.  You can view it, as well as copy the rest of the event-handling code in the example from the Pivot folder (in my case, this is ‚ÄúC: \ Program Files (x86) \ Microsoft SDKs \ Silverlight \ v4.0 \ PivotViewer \ Jun10 \ Source‚Äù ). <br><br>  This example contains another useful feature.  Pivot Viewer allows you to add several user actions to each picture.  Action is an action that can be performed on a selected object.  For each action, you must specify an icon, a name, and a callback method.  Then, when you hover the cursor over the picture, Pivot will display a list of available actions.  Here is how it looks in the example from Pivot, in which actions are used to add / remove items from the cart: <br><br><img src="https://habrastorage.org/storage/a0493a8d/68a504b1/e8b01ef2/475a5c50.jpg"><br><br>  And one more useful moment.  When you view large amounts of data, every bit of space is dear to you.  But many sites have a fixed layout and occupy only a part of the screen (a frequently encountered version in the formulation is to navigate the resolution of 1024px width).  Silverlight applications have a very convenient opportunity to switch to full-screen mode, for this it is enough to change the value of the IsFullScreen property. <br><br>  All we need is to somehow stick a button to the Pivot Viewer to change the mode, like this: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Grid</font> <font color="#ff0000">x:Name</font> <font color="#0000ff">="LayoutRoot"</font> <font color="#ff0000">Background</font> <font color="#0000ff">="White"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">pivot:PivotViewer</font> <br> <font color="#ff0000">x:Name</font> <font color="#0000ff">="MainPivotViewer"</font> <br> <font color="#ff0000">LinkClicked</font> <font color="#0000ff">="OnPivotViewerLinkClicked"</font> <br> <font color="#ff0000">ItemDoubleClicked</font> <font color="#0000ff">="OnPivotViewerItemDoubleClicked"</font> <br> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">Image</font> <br> <font color="#ff0000">x:Name</font> <font color="#0000ff">="btFullScreen"</font> <br> <font color="#ff0000">Width</font> <font color="#0000ff">="32"</font> <font color="#ff0000">Height</font> <font color="#0000ff">="32"</font> <font color="#ff0000">MinWidth</font> <font color="#0000ff">="32"</font> <font color="#ff0000">MaxWidth</font> <font color="#0000ff">="32"</font> <font color="#ff0000">MinHeight</font> <font color="#0000ff">="32"</font> <font color="#ff0000">MaxHeight</font> <font color="#0000ff">="32"</font> <br> <font color="#ff0000">Margin</font> <font color="#0000ff">="0,0,12,12"</font> <br> <font color="#ff0000">HorizontalAlignment</font> <font color="#0000ff">="Right"</font> <font color="#ff0000">VerticalAlignment</font> <font color="#0000ff">="Bottom"</font> <br> <font color="#ff0000">Source</font> <font color="#0000ff">="{  }"</font> <br> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">Grid</font> <font color="#0000ff">&gt;</font></font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  and add a handler to it: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">readonly</font> BitmapImage imageOff = <font color="#0000ff">new</font> BitmapImage({   }); <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">readonly</font> BitmapImage imageOn = <font color="#0000ff">new</font> BitmapImage({     }); <br> <br> btFullScreen.MouseLeftButtonDown += <br> <font color="#0000ff">delegate</font> (Object s, MouseButtonEventArgs args) <br> { <br> <font color="#0000ff">if</font> (Application.Current.Host.Content.IsFullScreen) <br> { <br> Application.Current.Host.Content.IsFullScreen = <font color="#0000ff">false</font> ; <br> btFullScreen.Source = imageOn; <br> } <br> <font color="#0000ff">else</font> <br> { <br> Application.Current.Host.Content.IsFullScreen = <font color="#0000ff">true</font> ; <br> btFullScreen.Source = imageOff; <br> } <br> };</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  For clarity, I change the pictures on the panels depending on the mode.  Here is how it looks in <a href="http://play2game.ru/%25D0%25BC%25D0%25B8%25D0%25BD%25D0%25B8-%25D0%25B8%25D0%25B3%25D1%2580%25D1%258B/%25D0%25B2%25D1%258B%25D0%25B1%25D0%25BE%25D1%2580">my case</a> : <br><br><img src="https://habrastorage.org/storage/9fa190c6/0169c38d/12c78e42/932e4827.jpg"><br><br>  Five steps are completed and we can admire the result of our work.  But this description would be little different from the usual "how to" if I had not shared my experience in solving problems that arose during development.  Remember, at the very beginning of the article I wrote that we can stray a little through the forest?  This is true, and the fault is the error handling in the Pivot control. <br><br>  I have to say, in my opinion, it works quite stably.  But for a couple of weeks of work, I twice stumbled upon a sad message a la "Silverlight plugin performed an incorrect operation and can not work further," but a simple reload of the page fixed everything.  In general, taking into account all its advantages, it is still possible to ignore this, especially since this is only the first version. <br><br>  But what made me spend time debugging was the error messages.  Now I will talk about this in more detail, and you will remember two useful rules: <br><ol><li>  If the Pivot simply stopped displaying something, you may have messed up with the data.  Slip him a simple test collection.  Earned?  Then use the half division method to discard xml chunks from your original data, until you narrow the scope to the value \ attribute that is to blame for everything. <br><br></li><li>  If you managed to get some kind of error message (this is not always the case) - do not take it literally.  Sometimes the text of the message has nothing to do with the real cause of the error. </li></ol><br>  Now go through the errors in more detail.  By the way, do not forget that by the time you read this article, something can already be fixed, and something new can be added :) <br><ul><li>  You have received the message ‚ÄúThe element is already a child of another element‚Äù (or its equivalent in English). <br><br>  Checked the structure of your xml - everything is in order?  Then look at your operating system version.  Losers with a 32-bit version of Windows 7 leave our ranks. <br>  This error occurs when you try to load a collection into PivotViewer.  You can walk through the forums and there will offer different reasons for this error.  But it is extremely likely that the reason is the OS version.  Even native examples from Microsoft don't work on it, and, like them, your code will work fine on the 64-bit version of Windows 7, and on other operating systems. <br><br></li><li>  You still receive the message ‚ÄúThe element is already a child of another element,‚Äù although the first point clearly does not apply to you. <br><br>  Possible cause - some errors in the values ‚Äã‚Äãof the attributes of xml tags.  In my case, the reason was that I mistakenly indicated in the p: Icon attribute of the Collection tag not the url to the image, but the physical path to the picture on my computer. <br><br></li><li>  You have received a funny message "Invalid type for String facet: String". <br><br>  The reason is that you cannot specify empty strings as values ‚Äã‚Äãfor categories (FacetCategory) of type String.  In this case, just do not add value at all. <br><br></li><li>  At one point, the data simply stopped being rendered without any error messages. <br><br>  Possible reason - you use the separator "," for categories of type Number instead of ".".  It is possible, I just did not understand how you can specify the desired culture info Pivot Viewer.  At least, changing the Language property and explicitly specifying the culture in the web.config did not help, the Viewer persistently believed that only a dot could be the correct separator. <br>  In my case, I just walked away from the problem.  The number I used for the category ‚ÄúGame size (in MB)‚Äù and I thought that rounding it up to a whole value would only simplify the filter.  If someone figure out how to solve this problem - write, I will correct the description. <br><br></li><li>  You have received the intriguing message ‚ÄúUnhandled Error in Silverlight Application The value cannot be undefined.  Parameter name: displayText ". <br><br>  A possible reason is the value ‚Äú0‚Äù for a category with the type Number.  Yes, yes, for you it can be quite a significant value, but due to an error in the Viewer (or some logic that I did not guess), null values ‚Äã‚Äãfor numbers cannot be used just like empty strings for string categories.  Therefore, simply do not specify the value of this category for the object. </li></ul>  And finally, another tip.  Browsers aggressively cache collections with data.  Ctrl + F5 will not help you (since the amount of data can be in a few megabytes - you can only be happy with this in a real application).  But if you are playing with xml to find the optimal set of filters - output the button ‚Äúclear history‚Äù on the toolbar of IE or FF browsers - this will save you a lot of time.  But Opera perfectly cleans all the data in its Ctrl + R. <br><br>  Usually, at the end of the article you need to sum up some kind of result.  Well ... This element is too good to be spoiled by minor flaws - so it was great!  I really wonder if it can really simplify our search, so we are waiting for new implementations on our sites :) <br><br>  Good luck and enjoy your programming! <br><br></div><p>Source: <a href="https://habr.com/ru/post/102949/">https://habr.com/ru/post/102949/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../102943/index.html">Javascript fluent html builder</a></li>
<li><a href="../102944/index.html">How to find your first customer</a></li>
<li><a href="../102945/index.html">Joint software development order</a></li>
<li><a href="../102946/index.html">Presents gadgets for Samsung Galaxy Tab: HDMI dock, leather case, keyboard</a></li>
<li><a href="../102948/index.html">Hough's algorithm for detecting arbitrary curves in images</a></li>
<li><a href="../102950/index.html">Announcement of the program Russia GTUG</a></li>
<li><a href="../102951/index.html">Teeworlds no more</a></li>
<li><a href="../102952/index.html">The device paws gecko prompted the solution of the ideal grip for the legs of the robot</a></li>
<li><a href="../102953/index.html">Diaspora project is close to launch.</a></li>
<li><a href="../102956/index.html">Low cost marker board</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>