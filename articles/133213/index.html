<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>DCA / DCS Communications Error on high end Oracle Sun servers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day to all. 

 I would like to share this article with the specific configuration of Oracle's High-End class servers from Oracle Sun. When adding...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>DCA / DCS Communications Error on high end Oracle Sun servers</h1><div class="post__text post__text-html js-mediator-article">  Good day to all. <br><br>  I would like to share this article with the specific configuration of Oracle's High-End class servers from Oracle Sun.  When adding / deleting / moving a motherboard in high-end servers (in this article, we will focus on E-class servers, namely E25K), it is not uncommon that came up with one very characteristic error - DCA / DCS Communications errors.  The error indicates that there is no connection between the two domains of the same server.  Google and support from orakl prompted one solution.  Putting it all together, it was decided to combine it all into one article.  The most interesting thing is that after installing Solaris10 / 11 on the server, in some cases this error takes place, in some it does not.  But this is not the essence, the most important is a solution to overcome this problem. <br><br>  As mentioned above, the problem is caused by the fact that the relationship between the two domains is broken, i.e., one server behaves like two separate servers / domain (this is natural and logical), but is unaware that it consists of two "Parts" and can "communicate" with each other.  And so we have: E25K server, SC ALOM (Service controller), OS Solaris 10. Everything works, everything is patched, but that's not the task, any operations between domains are impossible. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Several components are responsible for this relationship: <br><br>  1. Domain Configuration Agent.  DCA.  Must be enabled on service controler. <br><br>  2. Domain Configuration Server.  DCS.  Must be enabled on domains in solaris. <br><br>  3. The /ets/inetd.conf file is correctly configured. <br><br>  4. Ipsec policies are correctly built in the /etc/inet/ipsecinit.conf configuration file. <br><br>  5. The sckmd daemon is enabled.  This is a daemon responsible for IPSec protocol cryptography. <br><br>  6. Internal network devices.  On SC, this is the scman0 interface; in the domain, this is the dman0 interface. <br><br>  7. Domain X Server. <br><br>  If one of the conditions above is violated, the showdevices command wakes negative: <br><br>  <i>#showdevices -d -v [domain id]</i> <i><br></i>  <i>Unable to get device information from domain x</i> <br><br>  Well, let's go in order and find out in the end who is right.  Check for the presence of appropriate network devices: <br><br>  #ifconfig -a <br><br>  On sc: <br><br>  scman0: flags = 1008843 &lt;UP, BROADCAST, RUNNING, MULTICAST, PRIVATE, IPv4&gt; mtu 1500 index 3 inet 10.1.1.1 netmask ffffffe0 broadcast 10.1.1.31 <br><br>  Domain: <br><br>  dman0: flags = 1008843 &lt;UP, BROADCAST, RUNNING, MULTICAST, PRIVATE, IPv4&gt; mtu 1500 index 3 inet 10.10.1.3 netmask ffffffe0 broadcast 10.10.1.31 ether 0: 0: be: a8: 17: 57 <br><br>  If any interface is missing, you would need to create it manually, for this you need to do the following: <br><br>  #ndd / dev / dman man_get_hostinfo <br>  manc_magic = 0x4d414e43 <br>  manc_version = 01 <br>  manc_csum = 0x0 <br>  manc_ip_type = AF_INET <br>  manc_dom_ipaddr = 10.1.1.0 <br>  manc_dom_ip_netmask = 255.255.255.224 <br>  manc_dom_ip_netnum = 10.1.1.0 <br>  manc_sc_ipaddr = 10.1.1.1 <br>  manc_dom_eaddr = 0: 0: be: a8: 48: 26 <br>  manc_sc_eaddr = 8: 0: 20: f9: e4: 54 <br>  manc_iob_bitmap = 0x400 io boards = 10.1, <br>  manc_golden_iob = 10 <br><br>  Correct the / etc / netmasks file, <br><br>  #vi / etc / netmasks <br>  &lt;manc_dom_ip_netnum&gt; &lt;man_dom_ip_netmask&gt; <br><br>  Something like that: <br><br>  10.1.1.0 255.255.255.224 <br><br>  #vi /etc/hostname.dman0, if not, then create: <br>  &lt;manc_dom_ipaddr&gt; netmask + broadcast + private up <br>  wq! <br><br>  #ifconfig dman0 plumb <br><br>  Make sure everything is OK: <br><br>  #cat /etc/syslog.conf <br>  ... <br>  * .notice @ 10.1.1.3 <br><br>  If not, then perform the interface configuration steps again: <br><br>  #ifconfig dman0 plumb <br>  #ifconfig dman0 &lt;manc_dom_ipaddr&gt; netmask + broadcast + private up <br><br>  In my case: <br><br>  # ifconfig dman0 plumb <br>  # ifconfig dman0 10.1.1.3 netmask + broadcast + private up <br><br>  Now we need to check the services and daemons responsible for the exchange of information between domains.  On the service controller, this is DCA.  Domain Configuration Agent.  He ‚Äúlistens‚Äù on port 665 to all incoming control information.  If it is not enabled, then the execution of showdevices and rcfgadm commands will not be possible.  Checking: <br><br>  #ps -ef |  grep dca <br>  sms-dca 1614 361 0 Feb 26?  0:00 dca -d A <br>  sms-dca 1758 431 0 Feb 26?  0:00 dca -d B <br><br>  Next, we check the DCS daemon on both domains.  It is the ‚Äúserver‚Äù part between domains.  For its correct operation, the following prerequisite is necessary.  In the /etc/inetd.conf configuration file there should be the lines: <br><br>  #vi /etc/inetd.conf file: <br><br>  sun-dr stream tcp wait root / usr / lib / dcs dcs <br>  sun-dr stream tcp6 wait root / usr / lib / dcs dcs <br><br>  Restart it with new additions: <br>  # ps -ef |  grep inetd <br>  root 2021 1 0 Feb 11?  0:00 / usr / sbin / inetd -s <br>  # kill -HUP 2021 <br><br>  Check if dcs started because  inetd is an SMF application (Service Management Facility), then it is checked by the inetadm command: <br><br>  # inetadm <br>  ENABLED STATE FMRI <br>  ... <br>  enabled online svc: / application / font / stfsloader: default <br>  ... <br>  disabled disabled svc: / network / talk: default <br>  ... <br>  enabled online svc: / platform / sun4u / dcs: default <br><br>  Dcs must be on, i.e.  enable.  And here is another couple of commands, for a more detailed analysis of dcs: <br><br>  # / usr / sbin / svccfg -s svc: / platform / sun4u / dcs: default listprop <br>  # svcs dcs <br><br>  Everything is OK, go ahead.  Now we need to make sure that the domains ‚Äúlisten‚Äù to port 665. The port on which they ‚Äúcommunicate‚Äù, as mentioned above, dca and dcs: From under solaris, we type: <br><br>  #netstat -an |  grep 665 <br>  # netstat -an |  grep 665 <br>  * .665 *. * 0 0 49152 0 LISTEN <br>  * .665 *. * 0 0 49152 0 LISTEN <br><br>  And now the most interesting, for the exchange of information between domains, it is necessary to prescribe the policy of information exchange.  Default settings are not always sufficient condition!  Editing the file <br>  /etc/inet/ipsecinit.conf and add the following lines: <br><br>  {dport sun-dr ulp tcp} permit {auth_algs md5} <br>  {sport sun-dr ulp tcp} apply {auth_algs md5 sa unique} <br>  {dport cvc_hostd ulp tcp} permit {auth_algs md5} <br>  {sport cvc_hostd ulp tcp} apply {auth_algs md5 sa unique} <br><br>  Update policies: <br><br>  #ipsecconf -a /etc/inet/ipsecinit.conf <br><br>  #ipsecconf <br><br>  Next in line is DXS.  From sc, see if it is running: <br><br>  # ps -ef |  grep dxs <br>  sms-dxs 1609 361 0 Feb 26?  0:57 dxs -d A <br>  sms-dxs 1609 361 0 Feb 26?  0:57 dxs -d B <br>  sms-dxs 1609 361 0 Feb 26?  0:57 dxs -d C <br><br>  Usually he is always able to enable.  So there are no problems with it.  If not, then simply turn on the svcadm command.  Moving on - the sckmd daemon (Sun cryptographic key management daemon).  He is responsible for IPSec tunneling.  See if it is running: <br><br>  # ps -ef |  grep sckmd <br><br>  root 24156 1 0 Apr 02?  0:00 / <br>  usr / platform / SUNW, Sun-Fire-15000 / lib / sckmd <br><br>  Luckily for me he was able to incl.  But if not, then just need to activate it with the svcadm command. <br>  Well, in the end, check whether everything works for us: <br>  # showdevices <br>  #rcfgadm <br>  #addboard -d [id_domain] SBx <br>  #deletboard SBx <br>  #moveboard -d [id_domain] SBx <br><br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/133213/">https://habr.com/ru/post/133213/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../133205/index.html">Chop Slider 2 - the best jQuery slider</a></li>
<li><a href="../133207/index.html">OpenPGP module for Gmail</a></li>
<li><a href="../133208/index.html">The source code of the Doom III engine is available under a free license.</a></li>
<li><a href="../133211/index.html">Guideman - guide on selected male attributes</a></li>
<li><a href="../133212/index.html">AnjLab SQL Profiler 1.2 released</a></li>
<li><a href="../133214/index.html">Qt Quick: best practices</a></li>
<li><a href="../133215/index.html">New old method of protection against email spam based on MTA Exim</a></li>
<li><a href="../133217/index.html">And again the curve of the state program</a></li>
<li><a href="../133219/index.html">How to: VM in files on local Citrix XenServer</a></li>
<li><a href="../133220/index.html">31 effective programming methods for Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>