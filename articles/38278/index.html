<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Delphi + PostgreSQL</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In one of the projects, it was necessary to get access to the PostgreSQL database from Delphi and, in particular, to read BLOB fields from this databa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Delphi + PostgreSQL</h1><div class="post__text post__text-html js-mediator-article"> In one of the projects, it was necessary to get access to the PostgreSQL database from Delphi and, in particular, to read BLOB fields from this database.  Of course, in order not to reinvent the wheel, I decided to look for ready-made components.  There were two solutions: <br><br>  -free.  <a href="http://sourceforge.net/projects/zeoslib">ZeosLib</a> . <br>  - paid.  <a href="http://www.microolap.com/products/connectivity/postgresdac/">PostgresDAC</a> . <br><br>  Performance was key, so I decided to compare them. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>  Testing was based on PostgreSQL 8.2.5, dll of the same version was used in both components.  Previously, the request was executed a couple of times, in order for the database to be cached. <br><br>  The brackets indicate the average value for the next three attempts that were made without closing the program.  The request was of the form ‚Äúselect * from table‚Äù, where table is a table with 450 thousand unequal records, not processed by vacuum.  Positioning is the code: <br><br> <code>Query.First; <br> repeat <br> Query.Next; <br> until Query.Eof; <br></code> <br>  Results: <br><br>  <b>PostgresDAC</b> <br>  <i>Connection with base:</i> 170 ms (65 ms) *. <br>  <i>Query execution:</i> 5900 ms (5900 ms). <br>  <i>Positioning:</i> 4150 ms (4150 ms) <br><br>  <b>Zeoslib</b> <br>  <i>Connection with base:</i> 60 ms (60 ms). <br>  <i>Query execution:</i> 5200 ms (5200 ms). <br>  <i>Positioning:</i> 8100 ms (1900 ms) <br><br>  But the most interesting, as it turned out, was waiting for me further. <br>  When trying to get data from BLOB fields, both components returned nil.  Short-lived and simple experiments have shown that this happens when the Binary Object exceeds the size of 20 kilobytes. <br><br>  Google did not help solve the problem, I had to take on the file myself.  I converted libpq.h from the PostgreSQL delivery to pas, with the help of a wonderful <a href="http://ftp.univer.kharkov.ua/pub/docs/fpc~bak/tools/h2pas.html">utility</a> and started checking. <br><br>  Indeed, the standard PQexec function gave nil instead of data.  The problem was solved only using an asynchronous request. <br><br>  This code, with standard functions from libpq.dll, receives a BLOB field of any length from the database (of course, this requires a unit with certain functions and a pre-established myConnection connection): <br><br> <code>PQsendQuery(myonnection, pchar(myQuery)); <br> myResult:=PQGetResult(myConnection); <br> buf:=PQunescapeBytea(PQgetvalue(myResult, 0, 0), resultKey); <br></code> <br><br>  PS: My first topic on Habr√©.  I hope that writing really helps someone. <br><br>  PPS: Oh yes, there is another way of access through ADO, but by all indications it is somewhere 2-2.5 times slower than Zeos and DAC.  Yes, and I was looking for exactly specialized components, so there is no ADO in the tests. <br></div><p>Source: <a href="https://habr.com/ru/post/38278/">https://habr.com/ru/post/38278/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../38272/index.html">DinnerNow.net</a></li>
<li><a href="../38273/index.html">Problem number 32</a></li>
<li><a href="../38275/index.html">Habraimprover</a></li>
<li><a href="../38276/index.html">Man 2.0</a></li>
<li><a href="../38277/index.html">N.V.Gogol - "Viy"</a></li>
<li><a href="../38280/index.html">Vulnerability of iPhone with new firmware</a></li>
<li><a href="../38281/index.html">Hubrashtuki, Inc.</a></li>
<li><a href="../38282/index.html">Social network "7 hands". How important it is to do everything on time.</a></li>
<li><a href="../38283/index.html">My Smarty Plugins</a></li>
<li><a href="../38284/index.html">Using debugging tools</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>