<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Flame Management Structure Analysis</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Not even a couple of weeks passed since the discovery of Flame, with the help of colleagues from OpenDNS and GoDaddy, we were able to redirect malicio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Flame Management Structure Analysis</h1><div class="post__text post__text-html js-mediator-article">  Not even a couple of weeks passed since the <a href="http://habrahabr.ru/company/kaspersky/blog/144967/">discovery of</a> Flame, with the help of colleagues from OpenDNS and GoDaddy, we were able to redirect malicious domains to our server.  As a result of a detailed analysis of the information thus obtained, our experts came to the following conclusions: <br><br>  ‚Ä¢ Flame command servers that operated for several years were disabled immediately after last week Kaspersky Lab uncovered the existence of a malicious program. <br>  ‚Ä¢ Currently, more than 80 domains that are involved in transferring data to Flame command servers, which were registered in the period from 2008 to 2012, are known. <br>  ‚Ä¢ Over the past 4 years, Flame command servers alternately located in various countries of the world, including Hong Kong, Turkey, Germany, Poland, Malaysia, Latvia, the United Kingdom and Switzerland. <br>  ‚Ä¢ Fake registration data and various registrar companies were used to register the domains of the Flame command servers, and this activity began in 2008. <br>  ‚Ä¢ Intruders using Flame to steal information were especially interested in office documents, PDF files, and AutoCAD drawings. <br>  ‚Ä¢ The data uploaded to Flame command servers was encrypted using relatively simple algorithms.  The stolen documents were compressed using the open source Zlib library and a modified PPDM compression algorithm. <br>  ‚Ä¢ According to preliminary data, the 64-bit version of the Windows 7 operating system, which was previously recommended by Kaspersky Lab as one of the safest, was not affected by Flame. <br><br><img src="http://www.securelist.com/ru/images/pictures/klblog/207764014.png" alt="image"><br>  <i>Flame geography</i> <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>What did we manage to learn?</b> <b><br></b> <br>  Details about the infection method and distribution of the Flame server infrastructure can be found in our <a href="http://www.securelist.com/ru/blog/207764007/The_Roof_Is_on_Fire_otklyuchenie_komandnykh_serverov_Flame">Securelist</a> blog post.  Here we provide some statistics about the geography of distribution and the most interesting facts. <br><br>  For example, here are the current Flame statistics from KSN: <br><br><img src="http://www.securelist.com/ru/images/pictures/klblog/207764013.png" alt="image"><br><br>  Obviously, the largest number of victims of Flame is in the Middle East.  It is important to note that some of the victims may use different VPN / proxy services.  In such cases, infected systems may have, for example, European IP addresses, although they are physically located in the Asian region.  Also, some of the "victims" may actually be machines of other researchers.  However, in general, the statistics look fairly accurate and reflect the geographical distribution of infections. <br><br>  What about operating systems affected by Flame?  This is how the statistics obtained on the basis of the OS data of those systems where infections were detected look like: <br><br><img src="http://www.securelist.com/ru/images/pictures/klblog/207764016.png" alt="image"><br><br>  The largest number of infections is noted on systems with Windows 7 32-bit.  In second place - Windows XP.  It is important to note that Flame does not work on Windows 7 64-bit, which we previously recommended as a good solution to protect against other types of threats. <br><br>  <b>Statistics from our sinkhole and from OpenDNS</b> <br><br>  Our partner in this study, the company OpenDNS, has gathered together information on the dates of registration of Flame domains in recent years.  You can see this animated data here: <a href="https://www.opendns.com/flame-timeline/">www.opendns.com/flame-timeline</a> <br><br><img src="http://www.securelist.com/ru/images/pictures/klblog/207764017.png" alt="image"><br><br>  Over the last week, our server has registered many hits from infected users - below you can see statistics on their location.  It is necessary to take into account that the vast majority of infected machines have already been cured with the help of antivirus programs.  Thus, we see connections of those victims who, apparently, do not use antiviruses or have not updated them for a long time. <br><br>  We also noticed connections from the UK, Spain, Russia and Romania, which belong to various experts, both independent and from security companies. <br><br><img src="http://www.securelist.com/ru/images/pictures/klblog/207764018.png" alt="image"><br><br>  Below are statistics on the 10 most frequently used domains accessed by our sinkhole server: <br><br><img src="http://www.securelist.com/ru/images/pictures/klblog/207764019.png" alt="image"><br><br>  Currently, 28 Flame-related domains are redirected to a Kaspersky Lab sync server owned by: flashupdates.info, nvidiadrivers.info, nvidiasoft.info, nvidiastream.info, rendercodec.info, syncstream.info, videosync.info, dnslocation.info, dnsmask.info, dnsportal.info, dnsupdate.info, flushdns.info, localgateway.info, pingserver.info, serveflash.info, serverss.info, autosync.info, bannerspot.in, bannerzone.in, micromedia. in, mysync.info, newsync.info, syncdomain.info, synclock.info, syncprovider.info, syncsource.info, syncupdate.info and ultrasoft.in. <br><br>  <b>Data transmitted by Flame</b> <br><br>  When Flame connects to the synchole, it sends a POST request to identify itself.  After that, a large packet of data is sent that contains a lot of ‚Äúinteresting‚Äù information, for example, about the version of Flame, its configuration, history of activity in the infected system, data extracted from documents, and so on. <br><br><img src="http://www.securelist.com/ru/images/pictures/klblog/207764020.png" alt="image"><br><br>  In all the configurations we observed, the same ‚ÄúLifeStyle2‚Äù password was used.  This password is stored in the Flame configuration file and can be changed. <br><br>  The data packet uploaded to the server contains encrypted log files and other compressed information.  If you decrypt this data, you can find information about the version of Flame, which is transmitted to the server. <br><br>  The distribution of Flame by versions connected to our server is as follows: <br><br><img src="http://www.securelist.com/ru/images/pictures/klblog/207764015.png" alt="image"><br><br>  Most connections were made by version 2.242, which is the one we originally discovered and analyzed.  This confirms that it is the most common version of Flame.  But it is not the most relevant: we see one connection from a user infected with version 2.243! <br><br>  Version 2.080 is also very interesting - this is a small version of ‚Äúmssecmgr.ocx‚Äù (~ 890kb), which does not contain all the modules that are available in a large 6 megabyte version.  We also have a sample of this option, and we analyzed it simultaneously with a large sample. <br><br>  Among the computers that connected to our Sinkhall, there are some very interesting cases: three PCs - in Lebanon, Iraq and Iran.  During our Sinkhole operation, the versions of Flame on these machines changed - it is likely that the worm updated itself during this time.  For example, option 2.212 changed to 2.242 in two of these cases.  This indicates the existence of the still unknown C &amp; C, which also functioned during our syncholy.  Or about the unknown mechanism of updating Flame. <br><br>  Among all the data extracted from the systems, the attackers clearly have an increased interest in drawings in AutoCAD.  This is an interesting detail, since it is known that AutoCAD projects were also targets of the Duqu Trojan. <br><br>  In addition to the DWG files that are AutoCAD projects, Flame purposefully searches for PDF and text files, as well as other documents, and creates short reference books about the files found.  He also hunts for e-mail and many other types of various ‚Äúinteresting‚Äù (high-value) files that are listed in the worm's configuration. <br><br>  The data sent to the management server is encrypted using simple XOR encryption combined with a replacement cipher.  In addition, many blocks inside are compressed using Zlib and PPDM libraries. <br><br>  Interestingly, the data transmitted to the server is divided into packets of 8192 bytes.  This is probably done to recover from errors - it is known that the Internet in the Middle East is very slow and not very stable. <br><br>  Another interesting feature of Flame is the use of SSH connections for data transfer.  Apparently (despite the fact that we could not reproduce this behavior), when the Internet is working, but Flame servers are not available via SSL, it tries to use SSH. <br><br>  An SSH connection is established using the Putty-based library built into the worm.  Currently, the server's IP address and username / password are unknown.  It is possible that they are updated via C &amp; C and arrive only when there are temporary problems with SSL.  One of the reasons for using SSH can be a common situation with a ban on SSL / HTTPS traffic in some countries, such as Iran. <br><br>  Last week, Kaspersky Lab established contacts with CERTs of several countries to inform them about the Flame domains and the IP addresses of malicious servers.  We want to thank these teams for helping us with this research. <br><br>  If you represent a government CERT and want more information about Flame servers, please contact us at theflame@kaspersky.com. <br><br>  <b>Instead of conclusion</b> <br><br>  Kaspersky Lab would like to thank GoDaddy (GoDaddy Network Abuse Department) and William MacArthur, the network abuse department, for their prompt response and invaluable support for this investigation.  The OpenDNS security research team (OpenDNS security research team) also provided us with valuable assistance during the investigation. </div><p>Source: <a href="https://habr.com/ru/post/145236/">https://habr.com/ru/post/145236/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../145224/index.html">MIT has developed an unusual video enhancement technology.</a></li>
<li><a href="../145226/index.html">Comparison of Windows Azure Blob Storage and Google Cloud Storage</a></li>
<li><a href="../145230/index.html">In Arch Linux, digital signature verification is enabled by default.</a></li>
<li><a href="../145231/index.html">Draw a flickering text particle system</a></li>
<li><a href="../145234/index.html">Modern software - secure software</a></li>
<li><a href="../145238/index.html">Google Analytics adds a feature for analyzing the size of a user's browser window.</a></li>
<li><a href="../145239/index.html">Toshiba Qosmio X875 Laptop Video Review</a></li>
<li><a href="../145240/index.html">14 ways to become a successful startup CEO</a></li>
<li><a href="../145241/index.html">Protection for NGINX - NAXSI</a></li>
<li><a href="../145243/index.html">Announcement of the summer school "Algorithms for analyzing, modifying and comparing 3D polygonal models"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>