<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Another "bike" to collect data on PC users in the domain</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day to all. 
 I decided to publish my version of the decision to collect data on PC users in the domain. Just so as not to be wasted, and perhaps...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Another "bike" to collect data on PC users in the domain</h1><div class="post__text post__text-html js-mediator-article">  Good day to all. <br>  I decided to publish my version of the decision to collect data on PC users in the domain.  Just so as not to be wasted, and perhaps someone came in handy. <br><br>  This solution allows you to collect data on PCs in the domain as they connect to the network, users log on to these PCs and installed software at the time of switching on.  It all started with the desire to experiment with programming environments (Java, Qt), and ended with a fairly useful utility for the daily work of the system administrator.  The server part works under Linux, but I think it will also work under any system where you can run the JVM.  The client for displaying data was originally built under Linux.  When compiling for Windows, the only difficulty was that the Qt driver was not bundled to access the MySQL server, which had to be assembled separately. <br><br>  What this solution consists of: <br>  1. A small agent program on pure C. Runs twice through domain policies.  The first time you turn on a PC with system privileges, it collects data about the hardware, installed programs, and immediately sends this data to the server.  The second time - with the rights of the user when he logs in to collect data on user login.  Data to the server sends a simple XML.  Development environment Visual C ++ 2010 Express. <br>  2. Java server without any frameworks.  Constantly expects messages on port 8889 and stores the received data in the MySQL database. <br>  3. The client for displaying data was developed in the Qt4 / 5 environment (initially Qt4, then assembled in Qt5).  It refers directly to the MySQL database server. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The following is the source code for each of these parts. <br><a name="habracut"></a><br><br>  <b>Agent</b> <br><br>  Development environment - Visual C ++ 2010 Express. <br>  No dependencies.  All calls through WinAPI.  Works with Win XP / 7/2003/2008 / Vista / 8 <br>  The address of the server for data collection is sewn into the program (now there is an arbitrary ‚Äú192.168.0.123‚Äù indicated there). <br>  Command line call format: <br>  1. no parameters - collecting data about the PC (we need local system rights) <br>  2. with the "-u" parameter - collection of user data (user rights are sufficient) <br><br><div class="spoiler">  <b class="spoiler_title">Agent Code in C</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"stdafx.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;winsock2.h&gt; #include &lt;windows.h&gt; #include &lt;iostream&gt; #define SECURITY_WIN32 #include &lt;Security.h&gt; using namespace std; #pragma comment(lib, "Ws2_32.lib") #pragma comment(lib, "Secur32.lib") #define BUF_SIZE 32768 #define DST_PORT 8889 #define DST_IPADDR "192.168.0.123" int enum_installed_applications(BOOL IsUpdates, BOOL IsUserKey); int enum_user_info(); int wide_to_utf8(TCHAR *src, char *dst, int dst_size); int escape_xml_string(TCHAR *src, int src_size, TCHAR *dst, int dst_size); int _tmain(int argc, _TCHAR* argv[]) { if((argc &gt; 1)&amp;&amp;(wcscmp(argv[1],TEXT("-u"))==0)) { cout &lt;&lt; "will scan users" &lt;&lt; endl; enum_user_info(); } else { enum_installed_applications(false, false); } return 0; } int enum_user_info() { SOCKET s; sockaddr_in addr; WORD wVersionRequested; WSADATA wsaData; int err; char buf[BUF_SIZE]; const char xml_header[] = "&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;"; const char xml_user_start[] = "&lt;user"; const char xml_user_login[] = " Login=\""; const char xml_user_computer_name[] = " NBName=\""; const char xml_user_computer_domain[] = " Domain=\""; const char xml_user_end[] = "&lt;/user&gt;"; wVersionRequested = MAKEWORD(2, 2); err = WSAStartup(wVersionRequested, &amp;wsaData); if (err != 0) { printf("WSAStartup failed with error: %d\n", err); return -1; } s = socket(AF_INET, SOCK_STREAM, 0); memset(&amp;addr, 0, sizeof(addr)); addr.sin_family = AF_INET; addr.sin_port = htons(DST_PORT); addr.sin_addr.S_un.S_addr = inet_addr(DST_IPADDR); if(connect(s, (SOCKADDR*) &amp;addr, sizeof(addr)) == SOCKET_ERROR) { int error = GetLastError(); printf("ERROR CONNECT: %s (%x)\n", strerror(error), error); //system("pause"); return -1; } TCHAR computer_name[BUF_SIZE]; DWORD computer_name_count = BUF_SIZE; int computer_name_utf8_count; GetComputerNameEx(ComputerNamePhysicalNetBIOS, computer_name, &amp;computer_name_count); TCHAR user_computer_domain[BUF_SIZE]; DWORD user_computer_domain_count = BUF_SIZE; int user_computer_domain_utf8_count; GetComputerNameEx(ComputerNamePhysicalDnsDomain, user_computer_domain, &amp;user_computer_domain_count); TCHAR login[1024]; DWORD login_size = 1024; int login_utf8_count; if(GetUserNameEx(NameUserPrincipal, (TCHAR*)login, &amp;login_size) == 0) { //if(GetUserName((TCHAR*)login, &amp;login_size) == 0) { int error = GetLastError(); printf("ERROR GetUSerName: %s (%x)\n", strerror(error), error); //system("pause"); return -1; } cout &lt;&lt; login &lt;&lt; endl; send(s, xml_header, strlen(xml_header), 0); send(s, xml_user_start, strlen(xml_user_start), 0); send(s, xml_user_computer_name, strlen(xml_user_computer_name), 0); computer_name_utf8_count = wide_to_utf8(computer_name, buf, sizeof(buf)); send(s, buf, computer_name_utf8_count, 0); send(s, "\"", 1, 0); send(s, xml_user_login, strlen(xml_user_login), 0); login_utf8_count = wide_to_utf8(login, buf, sizeof(buf)); send(s, buf, login_utf8_count, 0); cout &lt;&lt; buf &lt;&lt; endl; send(s, "\"", 1, 0); send(s, xml_user_computer_domain, strlen(xml_user_computer_domain), 0); user_computer_domain_utf8_count = wide_to_utf8(user_computer_domain, buf, sizeof(buf)); send(s, buf, user_computer_domain_utf8_count, 0); send(s, "\"&gt;", 2, 0); send(s, xml_user_end, strlen(xml_user_end), 0); closesocket(s); WSACleanup(); return 0; } int enum_installed_applications(BOOL IsUpdates, BOOL IsUserKey) { DWORD dwSize = MAX_PATH, dwType, dwValue; bool bIsSystemComponent, bIsUpdate; TCHAR szParentKeyName[MAX_PATH]; TCHAR szDisplayName[BUF_SIZE]; TCHAR szDisplayNameEsc[BUF_SIZE]; TCHAR szKeyName[MAX_PATH]; char buf[BUF_SIZE]; HKEY hKey, hRootKey, hAppKey; LONG ItemIndex = 0; const char xml_header[] = "&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;"; const char xml_computer_start[] = "&lt;computer"; const char xml_computer_name[] = " NBName=\""; const char xml_computer_osversion[] = " OSVersion=\""; const char xml_computer_domain[] = " Domain=\""; const char xml_computer_end[] = "&lt;/computer&gt;"; const char xml_product_start[] = "&lt;product"; const char xml_product_name[] = " name=\""; hRootKey = IsUserKey ? HKEY_CURRENT_USER : HKEY_LOCAL_MACHINE; SOCKET s; sockaddr_in addr; WORD wVersionRequested; WSADATA wsaData; int err; wVersionRequested = MAKEWORD(2, 2); err = WSAStartup(wVersionRequested, &amp;wsaData); if (err != 0) { printf("WSAStartup failed with error: %d\n", err); return -1; } s = socket(AF_INET, SOCK_STREAM, 0); memset(&amp;addr, 0, sizeof(addr)); addr.sin_family = AF_INET; addr.sin_port = htons(DST_PORT); addr.sin_addr.S_un.S_addr = inet_addr(DST_IPADDR); if(connect(s, (SOCKADDR*) &amp;addr, sizeof(addr)) == SOCKET_ERROR) { int error = GetLastError(); printf("ERROR CONNECT: %s (%x)\n", strerror(error), error); //system("pause"); return -1; } TCHAR computer_name[BUF_SIZE]; DWORD computer_name_count = BUF_SIZE; int computer_name_utf8_count; TCHAR computer_domain[BUF_SIZE]; DWORD computer_domain_count = BUF_SIZE; int computer_domain_utf8_count; GetComputerNameEx(ComputerNamePhysicalNetBIOS, computer_name, &amp;computer_name_count); GetComputerNameEx(ComputerNamePhysicalDnsDomain, computer_domain, &amp;computer_domain_count); send(s, xml_header, strlen(xml_header), 0); send(s, xml_computer_start, strlen(xml_computer_start), 0); send(s, xml_computer_name, strlen(xml_computer_name), 0); computer_name_utf8_count = wide_to_utf8(computer_name, buf, sizeof(buf)); send(s, buf, computer_name_utf8_count, 0); send(s, "\"", 1, 0); send(s, xml_computer_domain, strlen(xml_computer_domain), 0); computer_domain_utf8_count = wide_to_utf8(computer_domain, buf, sizeof(buf)); send(s, buf, computer_domain_utf8_count, 0); send(s, "\"&gt;", 2, 0); if (RegOpenKey(hRootKey, _T("Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall"), &amp;hKey) != ERROR_SUCCESS) { return -1; } while (RegEnumKeyEx(hKey, ItemIndex, szKeyName, &amp;dwSize, NULL, NULL, NULL, NULL) == ERROR_SUCCESS) { if (RegOpenKey(hKey, szKeyName, &amp;hAppKey) == ERROR_SUCCESS) { dwType = REG_DWORD; dwSize = sizeof(DWORD); if (RegQueryValueEx(hAppKey, _T("SystemComponent"), NULL, &amp;dwType, (LPBYTE)&amp;dwValue, &amp;dwSize) == ERROR_SUCCESS) { bIsSystemComponent = (dwValue == 0x1); } else { bIsSystemComponent = FALSE; } dwType = REG_SZ; dwSize = MAX_PATH; bIsUpdate = (RegQueryValueEx(hAppKey, _T("ParentKeyName"), NULL, &amp;dwType, (LPBYTE)szParentKeyName, &amp;dwSize) == ERROR_SUCCESS); dwSize = MAX_PATH; if (RegQueryValueEx(hAppKey, _T("DisplayName"), NULL, &amp;dwType, (LPBYTE)szDisplayName, &amp;dwSize) == ERROR_SUCCESS) { if (!bIsSystemComponent) { if ((IsUpdates == FALSE &amp;&amp; !bIsUpdate) || /* Applications only */ (IsUpdates == TRUE &amp;&amp; bIsUpdate)) /* Updates only */ { send(s, xml_product_start, strlen(xml_product_start), 0); send(s, xml_product_name, strlen(xml_product_name), 0); escape_xml_string(szDisplayName, wcslen(szDisplayName), szDisplayNameEsc, BUF_SIZE); int name_len = wide_to_utf8(szDisplayNameEsc, buf, sizeof(buf)); send(s, buf, name_len, 0); send(s, "\"/&gt;", 3, 0); } } } RegCloseKey(hAppKey); } dwSize = MAX_PATH; ++ItemIndex; } send(s, xml_computer_end, strlen(xml_computer_end), 0); RegCloseKey(hKey); closesocket(s); WSACleanup(); return 0; } int wide_to_utf8(TCHAR *src, char *dst, int dst_size) { int len = WideCharToMultiByte(CP_UTF8, 0, (LPCWSTR)src, -1, NULL, 0, NULL, NULL); WideCharToMultiByte(CP_UTF8, 0, (LPCWSTR)src, -1, dst, dst_size, NULL, NULL); return len-1; } int escape_xml_string(TCHAR *src, int src_size, TCHAR *dst, int dst_size) { if((src_size == 0)||(dst_size==0)) return 0; if((src == NULL)||(dst == NULL)) return 0; int i,j; for(i=0, j=0; (i&lt;src_size)&amp;&amp;(j&lt;(dst_size-1)); i++, j++){ if(src[i] == _T('\"')) { dst[j] = _T('&amp;'); dst[++j] = _T('q'); dst[++j] = _T('u'); dst[++j] = _T('o'); dst[++j] = _T('t'); dst[++j] = _T(';'); } else if(src[i] == _T('&lt;')) { dst[j] = _T('&amp;'); dst[++j] = _T('l'); dst[++j] = _T('t'); dst[++j] = _T(';'); } else if(src[i] == _T('&gt;')) { dst[j] = _T('&amp;'); dst[++j] = _T('g'); dst[++j] = _T('t'); dst[++j] = _T(';'); } else if(src[i] == _T('&amp;')) { dst[j] = _T('&amp;'); dst[++j] = _T('a'); dst[++j] = _T('m'); dst[++j] = _T('p'); dst[++j] = _T(';'); } else { dst[j] = src[i]; } } dst[j] = _T('\0'); return j; }</span></span></span></span></code> </pre> <br></div></div><br><br>  <b>Server</b> <br><br>  Written in Java.  Uses only the basic features of the JVM without the use of additional libraries and frameworks (except for the JDBC library to access the MySQL database server). <br><br><div class="spoiler">  <b class="spoiler_title">MySQL server database structure</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">-- --  : `audit` -- -- -------------------------------------------------------- -- --   `computers` -- CREATE TABLE IF NOT EXISTS `computers` ( `id` int(11) NOT NULL AUTO_INCREMENT, `ipaddress` varchar(255) NOT NULL, `name` varchar(255) NOT NULL, `domain` varchar(255) NOT NULL, `osversion` varchar(255) DEFAULT NULL, `processor` varchar(255) DEFAULT NULL, `ram_kb` int(11) DEFAULT NULL, `updated` datetime NOT NULL, PRIMARY KEY (`id`) ) ENGINE=MyISAM DEFAULT CHARSET=utf8; -- -------------------------------------------------------- -- --   `netadapters` -- CREATE TABLE IF NOT EXISTS `netadapters` ( `id` int(11) NOT NULL AUTO_INCREMENT, `type` int(11) DEFAULT NULL, `computer_id` int(11) NOT NULL, `mac` varchar(255) COLLATE utf8_unicode_ci DEFAULT NULL, `isdhcp` int(11) NOT NULL, `ipaddr` varchar(255) COLLATE utf8_unicode_ci DEFAULT NULL, `gateway` varchar(255) COLLATE utf8_unicode_ci DEFAULT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci; -- -------------------------------------------------------- -- --   `software` -- CREATE TABLE IF NOT EXISTS `software` ( `id` int(11) NOT NULL AUTO_INCREMENT, `computer_id` int(11) NOT NULL, `name` varchar(512) NOT NULL, `version` varchar(255) DEFAULT NULL, PRIMARY KEY (`id`) ) ENGINE=MyISAM DEFAULT CHARSET=utf8; -- -------------------------------------------------------- -- --   `users` -- CREATE TABLE IF NOT EXISTS `users` ( `id` int(11) NOT NULL AUTO_INCREMENT, `login` varchar(255) NOT NULL, `domain` varchar(255) NOT NULL, `loggedin` datetime NOT NULL, `computername` varchar(255) NOT NULL, `ipaddress` varchar(255) NOT NULL, PRIMARY KEY (`id`) ) ENGINE=MyISAM DEFAULT CHARSET=utf8;</span></span></code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Computer class for injuring PC data</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> auditServer; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Date; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.LinkedList; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Computer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> id; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String name; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String domain; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String OSVersion; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String processor; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String ipAddress; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ram_kb; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Date updated; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> LinkedList&lt;Product&gt; products; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> LinkedList&lt;NetAdapter&gt; netAdapters; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Computer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String ipAddress, Date updated)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.updated = updated; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ipAddress = ipAddress; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Computer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String ipAddress, String name, String domain, String OSVersion, String processor, Date updated)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ipAddress = ipAddress; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name = name; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.domain = domain; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.OSVersion = OSVersion; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.processor = processor; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.updated = updated; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRam_kb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ram_kb; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setRam_kb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ram_kb)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ram_kb = ram_kb; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> id; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.id = id; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Date </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUpdated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> updated; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUpdated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Date updated)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.updated = updated; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIpAddress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ipAddress; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setIpAddress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String ipAddress)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ipAddress = ipAddress; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> LinkedList&lt;Product&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getProducts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> products; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setProducts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(LinkedList&lt;Product&gt; products)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.products = products; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> name; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name = name; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDomain</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> domain; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setDomain</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String domain)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.domain = domain; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getOSVersion</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> OSVersion; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setOSVersion</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String OSVersion)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.OSVersion = OSVersion; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getProcessor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> processor; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setProcessor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String processor)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.processor = processor; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> LinkedList&lt;NetAdapter&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getNetAdapters</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> netAdapters; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setNetAdapters</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(LinkedList&lt;NetAdapter&gt; netAdapters)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.netAdapters = netAdapters; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Computer{"</span></span> + <span class="hljs-string"><span class="hljs-string">"name='"</span></span> + name + <span class="hljs-string"><span class="hljs-string">'\''</span></span> + <span class="hljs-string"><span class="hljs-string">", domain='"</span></span> + domain + <span class="hljs-string"><span class="hljs-string">'\''</span></span> + <span class="hljs-string"><span class="hljs-string">", ipAddress='"</span></span> + ipAddress + <span class="hljs-string"><span class="hljs-string">'\''</span></span> + <span class="hljs-string"><span class="hljs-string">'}'</span></span>; } }</code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">NetAdapter class for storing data on network adapters PC</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> auditServer; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NetAdapter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> id; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> type; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> isdhcp; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String mac; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String ipaddr; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String gateway; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NetAdapter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> id; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.id = id; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> type; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> type)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.type = type; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIsdhcp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> isdhcp; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setIsdhcp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isdhcp)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.isdhcp = isdhcp; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMac</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mac; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setMac</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String mac)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mac = mac; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIpaddr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ipaddr; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setIpaddr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String ipaddr)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ipaddr = ipaddr; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getGateway</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gateway; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setGateway</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String gateway)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.gateway = gateway; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"NetAdapter{"</span></span> + <span class="hljs-string"><span class="hljs-string">"id="</span></span> + id + <span class="hljs-string"><span class="hljs-string">", type="</span></span> + type + <span class="hljs-string"><span class="hljs-string">", mac='"</span></span> + mac + <span class="hljs-string"><span class="hljs-string">'\''</span></span> + <span class="hljs-string"><span class="hljs-string">", isdhcp='"</span></span> + isdhcp + <span class="hljs-string"><span class="hljs-string">'\''</span></span> + <span class="hljs-string"><span class="hljs-string">", ipaddr='"</span></span> + ipaddr + <span class="hljs-string"><span class="hljs-string">'\''</span></span> + <span class="hljs-string"><span class="hljs-string">", gateway='"</span></span> + gateway + <span class="hljs-string"><span class="hljs-string">'\''</span></span> + <span class="hljs-string"><span class="hljs-string">'}'</span></span>; } }</code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">User class for storing user data</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> auditServer; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Date; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> id; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String login; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String domain; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Date loggedIn; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String computerName; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String ipAddress; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">User</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">User</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String login, String domain, Date loggedIn, String computerName, String ipAddress)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.login = login; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.domain = domain; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loggedIn = loggedIn; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.computerName = computerName; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ipAddress = ipAddress; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> id; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.id = id; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLogin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> login; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setLogin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String login)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.login = login; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDomain</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> domain; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setDomain</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String domain)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.domain = domain; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Date </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLoggedIn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> loggedIn; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setLoggedIn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Date loggedIn)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loggedIn = loggedIn; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getComputerName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> computerName; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setComputerName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String computerName)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.computerName = computerName; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIpAddress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ipAddress; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setIpAddress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String ipAddress)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ipAddress = ipAddress; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"User{"</span></span> + <span class="hljs-string"><span class="hljs-string">"login='"</span></span> + login + <span class="hljs-string"><span class="hljs-string">'\''</span></span> + <span class="hljs-string"><span class="hljs-string">", domain='"</span></span> + domain + <span class="hljs-string"><span class="hljs-string">'\''</span></span> + <span class="hljs-string"><span class="hljs-string">", computerName='"</span></span> + computerName + <span class="hljs-string"><span class="hljs-string">'\''</span></span> + <span class="hljs-string"><span class="hljs-string">'}'</span></span>; } }</code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Product class for storing information about installed software</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> auditServer; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String name; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String version; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Product</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name, String version)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name = name; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.version = version; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> name; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name = name; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getVersion</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> version; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setVersion</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String version)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.version = version; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>((version == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>)||(version.isEmpty())) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> name; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (name + <span class="hljs-string"><span class="hljs-string">" ("</span></span> + version + <span class="hljs-string"><span class="hljs-string">")"</span></span>); } }</code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Server flow code to save PC data</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> auditServer; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.net.ConnectException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.sql.*; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.concurrent.SynchronousQueue; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ComputerDBWriter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Runnable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SynchronousQueue&lt;Computer&gt; computersQueue; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String driverClassName = <span class="hljs-string"><span class="hljs-string">"com.mysql.jdbc.Driver"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String url = <span class="hljs-string"><span class="hljs-string">"jdbc:mysql://localhost:3306/audit?characterSetResults=UTF-8&amp;characterEncoding=UTF-8&amp;useUnicode=yes"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String user = <span class="hljs-string"><span class="hljs-string">"user"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String password = <span class="hljs-string"><span class="hljs-string">"password"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ComputerDBWriter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SynchronousQueue&lt;Computer&gt; computersQueue)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.computersQueue = computersQueue; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Connection </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getConnection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> SQLException </span></span>{ Connection conn = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Class.forName(driverClassName); conn = DriverManager.getConnection(url, user, password); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ClassNotFoundException e) { e.printStackTrace(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> conn; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateComputer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Computer computer)</span></span></span><span class="hljs-function"> </span></span>{ String sql1 = <span class="hljs-string"><span class="hljs-string">"INSERT INTO computers(ipaddress,name,domain,osversion,processor,ram_kb,updated) VALUES(?,?,?,?,?,?,?)"</span></span>; String sql2 = <span class="hljs-string"><span class="hljs-string">"INSERT INTO software(computer_id,name,version) VALUES(?,?,?)"</span></span>; String sql3 = <span class="hljs-string"><span class="hljs-string">"INSERT INTO netadapters(computer_id,type,mac,ipaddr,gateway,isdhcp) VALUES(?,?,?,?,?,?)"</span></span>; Connection conn = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; PreparedStatement ps1 = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; PreparedStatement ps2 = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; PreparedStatement ps3 = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { conn = getConnection(); ps1 = conn.prepareStatement(sql1, Statement.RETURN_GENERATED_KEYS); ps1.setString(<span class="hljs-number"><span class="hljs-number">1</span></span>, computer.getIpAddress()); ps1.setString(<span class="hljs-number"><span class="hljs-number">2</span></span>, computer.getName()); ps1.setString(<span class="hljs-number"><span class="hljs-number">3</span></span>, computer.getDomain()); ps1.setString(<span class="hljs-number"><span class="hljs-number">4</span></span>, computer.getOSVersion()); ps1.setString(<span class="hljs-number"><span class="hljs-number">5</span></span>, computer.getProcessor()); ps1.setInt(<span class="hljs-number"><span class="hljs-number">6</span></span>, computer.getRam_kb()); ps1.setTimestamp(<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Timestamp(computer.getUpdated().getTime())); ps1.executeUpdate(); ResultSet rs1 = ps1.getGeneratedKeys(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rs1.next()) { computer.setId(rs1.getInt(<span class="hljs-number"><span class="hljs-number">1</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(Product p : computer.getProducts()) { ps2 = conn.prepareStatement(sql2); ps2.setInt(<span class="hljs-number"><span class="hljs-number">1</span></span>, computer.getId()); ps2.setString(<span class="hljs-number"><span class="hljs-number">2</span></span>, p.getName()); ps2.setString(<span class="hljs-number"><span class="hljs-number">3</span></span>, p.getVersion()); ps2.executeUpdate(); } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(NetAdapter na : computer.getNetAdapters()) { ps3 = conn.prepareStatement(sql3); ps3.setInt(<span class="hljs-number"><span class="hljs-number">1</span></span>, computer.getId()); ps3.setInt(<span class="hljs-number"><span class="hljs-number">2</span></span>, na.getType()); ps3.setString(<span class="hljs-number"><span class="hljs-number">3</span></span>, na.getMac()); ps3.setString(<span class="hljs-number"><span class="hljs-number">4</span></span>, na.getIpaddr()); ps3.setString(<span class="hljs-number"><span class="hljs-number">5</span></span>, na.getGateway()); ps3.setInt(<span class="hljs-number"><span class="hljs-number">6</span></span>, na.getIsdhcp()); ps3.executeUpdate(); } } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (SQLException e) { e.printStackTrace(); } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { ps1.close(); ps2.close(); ps3.close(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (SQLException e) { e.printStackTrace(); } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { conn.close(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (SQLException e) { e.printStackTrace(); } } } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Computer computer = computersQueue.take(); System.out.println(<span class="hljs-string"><span class="hljs-string">"!!! got new computer: "</span></span> + computer); <span class="hljs-comment"><span class="hljs-comment">//for(Product p : computer.getProducts()) { // System.out.println(p); //} updateComputer(computer); } catch (InterruptedException e) { e.printStackTrace(); } } } }</span></span></code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Server flow code for storing user data</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> auditServer; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.sql.*; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.concurrent.SynchronousQueue; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserDBWriter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Runnable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SynchronousQueue&lt;User&gt; usersQueue; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String driverClassName = <span class="hljs-string"><span class="hljs-string">"com.mysql.jdbc.Driver"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String url = <span class="hljs-string"><span class="hljs-string">"jdbc:mysql://localhost:3306/audit?characterSetResults=UTF-8&amp;characterEncoding=UTF-8&amp;useUnicode=yes"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String user = <span class="hljs-string"><span class="hljs-string">"user"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String password = <span class="hljs-string"><span class="hljs-string">"password"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UserDBWriter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SynchronousQueue&lt;User&gt; usersQueue)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.usersQueue = usersQueue; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Connection </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getConnection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> SQLException </span></span>{ Connection conn = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Class.forName(driverClassName); conn = DriverManager.getConnection(url, user, password); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ClassNotFoundException e) { e.printStackTrace(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> conn; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(User user)</span></span></span><span class="hljs-function"> </span></span>{ String sql1 = <span class="hljs-string"><span class="hljs-string">"INSERT INTO users(computername,domain,ipaddress,loggedin,login) VALUES(?,?,?,?,?)"</span></span>; Connection conn = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; PreparedStatement ps1 = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { conn = getConnection(); ps1 = conn.prepareStatement(sql1, Statement.RETURN_GENERATED_KEYS); ps1.setString(<span class="hljs-number"><span class="hljs-number">1</span></span>, user.getComputerName()); ps1.setString(<span class="hljs-number"><span class="hljs-number">2</span></span>, user.getDomain()); ps1.setString(<span class="hljs-number"><span class="hljs-number">3</span></span>, user.getIpAddress()); ps1.setTimestamp(<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Timestamp(user.getLoggedIn().getTime())); ps1.setString(<span class="hljs-number"><span class="hljs-number">5</span></span>, user.getLogin()); ps1.executeUpdate(); ResultSet rs1 = ps1.getGeneratedKeys(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rs1.next()) { user.setId(rs1.getInt(<span class="hljs-number"><span class="hljs-number">1</span></span>)); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (SQLException e) { e.printStackTrace(); } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { ps1.close(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (SQLException e) { e.printStackTrace(); } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { conn.close(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (SQLException e) { e.printStackTrace(); } } } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { User user = usersQueue.take(); System.out.println(<span class="hljs-string"><span class="hljs-string">"!!! got new user: "</span></span> + user); updateUser(user); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (InterruptedException e) { e.printStackTrace(); } } } }</code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Server flow code for receiving data from agents</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> auditServer; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.xml.stream.XMLInputFactory; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.xml.stream.XMLStreamConstants; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.xml.stream.XMLStreamException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.xml.stream.XMLStreamReader; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.IOException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.net.Socket; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.LinkedList; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Scanner; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.concurrent.SynchronousQueue; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServerHandler</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Runnable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Socket incoming; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SynchronousQueue&lt;Computer&gt; computersQueue; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SynchronousQueue&lt;User&gt; usersQueue; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ServerHandler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Socket incoming, SynchronousQueue&lt;Computer&gt; computersQueue, SynchronousQueue&lt;User&gt; usersQueue)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.incoming = incoming; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.computersQueue = computersQueue; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.usersQueue = usersQueue; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { LinkedList&lt;Product&gt; products = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LinkedList&lt;Product&gt;(); LinkedList&lt;NetAdapter&gt; netAdapters = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LinkedList&lt;NetAdapter&gt;(); Computer c = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; User u = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> eok = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Scanner in = new Scanner(incoming.getInputStream()); // while(in.hasNextLine()) { // System.out.println(in.nextLine()); // } System.out.println("Got connection from " + incoming.getInetAddress().getHostAddress()); XMLInputFactory factory = XMLInputFactory.newInstance(); try { XMLStreamReader parser = factory.createXMLStreamReader(incoming.getInputStream()); String eName; while(parser.hasNext()) { int event = parser.next(); if(event == XMLStreamConstants.START_ELEMENT) { eName = parser.getLocalName(); if(eName.equals("computer")) { c = new Computer(incoming.getInetAddress().getHostAddress(), new java.util.Date()); int attrCount = parser.getAttributeCount(); for(int i=0; i&lt;attrCount; i++) { String attrName = parser.getAttributeLocalName(i); if(attrName.equals("NBName")) c.setName(parser.getAttributeValue(i)); else if(attrName.equals("Domain")) c.setDomain(parser.getAttributeValue(i)); else if(attrName.equals("OSVersion")) c.setOSVersion(parser.getAttributeValue(i)); else if(attrName.equals("Processor")) c.setProcessor(parser.getAttributeValue(i)); else if(attrName.equals("RAM")) c.setRam_kb(Integer.parseInt(parser.getAttributeValue(i))); } System.out.println(c); } else if(eName.equals("product")) { Product p = new Product(parser.getAttributeValue(0), parser.getAttributeValue(1)); products.add(p); //System.out.println(p); } else if(eName.equals("user")) { u = new User(); u.setIpAddress(incoming.getInetAddress().getHostAddress()); u.setLoggedIn(new java.util.Date()); int attrCount = parser.getAttributeCount(); for(int i=0; i&lt;attrCount; i++) { String attrName = parser.getAttributeLocalName(i); if(attrName.equals("NBName")) u.setComputerName(parser.getAttributeValue(i)); else if(attrName.equals("Domain")) u.setDomain(parser.getAttributeValue(i)); else if(attrName.equals("Login")) u.setLogin(parser.getAttributeValue(i)); } } else if(eName.equals("netAdapter")) { NetAdapter na = new NetAdapter(); int attrCount = parser.getAttributeCount(); for(int i=0; i&lt;attrCount; i++) { String attrName = parser.getAttributeLocalName(i); if(attrName.equals("type")) na.setType(Integer.parseInt(parser.getAttributeValue(i))); else if(attrName.equals("isdhcp")) na.setIsdhcp(Integer.parseInt(parser.getAttributeValue(i))); else if(attrName.equals("mac")) na.setMac(parser.getAttributeValue(i)); else if(attrName.equals("ip")) na.setIpaddr(parser.getAttributeValue(i)); else if(attrName.equals("gateway")) na.setGateway(parser.getAttributeValue(i)); } netAdapters.add(na); } } else if(event == XMLStreamConstants.END_DOCUMENT) { eok = true; //System.out.println("END_DOCUMENT"); } } } catch (XMLStreamException e) { e.printStackTrace(); } incoming.close(); if((eok)&amp;&amp;(c != null)&amp;&amp;(products.size() &gt; 0)) { c.setProducts(products); c.setNetAdapters(netAdapters); System.out.println(netAdapters); try { computersQueue.put(c); } catch (InterruptedException e) { e.printStackTrace(); } } if((eok)&amp;&amp;(u != null)) { try { usersQueue.put(u); } catch (InterruptedException e) { e.printStackTrace(); } } } catch (IOException e) { e.printStackTrace(); } } }</span></span></code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Server Mainstream Code</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> auditServer; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.IOException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.net.ServerSocket; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.net.Socket; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.concurrent.SynchronousQueue; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Server</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> port = <span class="hljs-number"><span class="hljs-number">8889</span></span>; SynchronousQueue&lt;Computer&gt; computersQueue = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SynchronousQueue&lt;Computer&gt;(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); SynchronousQueue&lt;User&gt; usersQueue = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SynchronousQueue&lt;User&gt;(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); Thread tComputerDBWriter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Thread(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ComputerDBWriter(computersQueue)); tComputerDBWriter.start(); Thread tUserDBWriter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Thread(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UserDBWriter(usersQueue)); tUserDBWriter.start(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { ServerSocket s = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ServerSocket(port); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { Socket incoming = s.accept(); Runnable r = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ServerHandler(incoming, computersQueue, usersQueue); Thread t = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Thread(r); t.start(); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException e) { e.printStackTrace(); } } }</code> </pre><br></div></div><br><br>  <b>Customer</b> <br><br>  Developed in Qt4 environment, then refined in Qt5 environment. <br>  It refers directly to the database server through the MySQL driver. <br>  Displays only the latest data on PCs and users.  If desired, you can add a history of changing the status of the PC and connecting users to these PCs. <br>  A double click on the PC ID opens information about the installed software on it, collected during the last connection. <br>  Double-clicking on an IP address (from which an agent message was received) opens information about all network adapters of the PC, their MAC and IPv4 addresses, whether DHCP is used. <br>  Double-clicking on the user's login opens rdesktop to connect to the specified PC with the credentials of that user. <br><br>  <a href="https://yadi.sk/d/zvX9Gvrjc5qci">Client code in the archive</a> <br><br>  UPDATE <br>  <a href="https://github.com/alexey-chaichuk/AuditServer">Project posted on GitHub</a> </div><p>Source: <a href="https://habr.com/ru/post/240687/">https://habr.com/ru/post/240687/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../240677/index.html">Indoor Weather Station on Arduino</a></li>
<li><a href="../240679/index.html">Our rake in preparing a hardcore conference</a></li>
<li><a href="../240681/index.html">My cards on leaflet.js</a></li>
<li><a href="../240683/index.html">Airbnb Search Technology</a></li>
<li><a href="../240685/index.html">BeeCamp: About Mobile Base Station, Power, and Infrastructure</a></li>
<li><a href="../240689/index.html">The minimum Hello Word limit on the AVR is 2 bytes.</a></li>
<li><a href="../240697/index.html">Watch Basor B1: what's inside the smart gadget?</a></li>
<li><a href="../240699/index.html">About medical secrets or who needs information security?</a></li>
<li><a href="../240705/index.html">Show Sound # 18 - Podcast about audio equipment, formats and technologies</a></li>
<li><a href="../240709/index.html">EMC XtremIO Flash Array: A Brief Summary</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>