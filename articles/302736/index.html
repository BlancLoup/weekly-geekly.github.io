<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to prevent frequent releases from breaking your API, or writing auto tests for an open API and sending a result to Telegram bot</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Foreword 
 Our team develops financial tools, including open payment APIs, and like many projects that work on continuous integration practice, we sim...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to prevent frequent releases from breaking your API, or writing auto tests for an open API and sending a result to Telegram bot</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/3a1/3a6/6af/3a13a66afc5b9153c20cecedd24ff299.jpg" alt="image"><br><br><h2>  Foreword </h2><br>  Our team develops financial tools, including open payment APIs, and like many projects that work on continuous integration practice, we simultaneously began to think about how to improve the test coverage of the project and achieve the maximum stability of our code with fairly frequent changes (we sometimes install updates to the grocery environment several times a day).  This is especially important in three aspects: <br><br><ul><li>  we provide our API interfaces for open access to customers and it is important that all interactions clearly correspond to the specifications of the specifications </li><li>  we integrate with a large number of other financial services and banks, and in addition to covering our code with tests, we also have to integrate interaction with the test (and sometimes prod) environment of third-party systems with integration tests <br></li><li>  Our internal architecture includes a large number of microservices that communicate with each other via HTTP API <br></li></ul><br>  In this article I would like to share my experience and show an example of how we develop tests for API interfaces that include both server-server interaction and work through a browser.  For the demonstration, I will give a simple example of testing the payment process with a bank card through our payment gateway with sending the test result to Telegram. <br><a name="habracut"></a><br>  You can download the project with sample tests on GitHub: <a href="">https://github.com/cloudipsp/auto_tests.git</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Documentation for our tested payment API: <a href="https://www.fondy.eu/info/api/">https://www.fondy.eu/info/api/</a> <br><br><h4>  Prepare the environment </h4><br>  We use the Robot Framework to develop tests, and although this framework has its own RIDE development environment, it is significantly inferior to PyCharm in terms of convenience and capabilities. <br><br>  <b>RIDE</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c15/43b/610/c1543b6108a98ee46f7ac8e32e40daf4.png" alt="image"><br><br>  To begin development, we will install <br><br><ol><li>  virtualenv <br><br><pre><code class="bash hljs">pip install virtualenv setuptools</code> </pre> <br></li><li>  free version of PyCharm Edu <br>  <a href="https://www.jetbrains.com/pycharm-edu/download/">https://www.jetbrains.com/pycharm-edu/download/</a> </li><li>  for PyCharm we put plugins <br>  intellibot: <br>  <a href="http://plugins.jetbrains.com/plugin/7386%3Fpr%3Dpycharm111">http://plugins.jetbrains.com/plugin/7386?pr=pycharm111</a> <br><br>  Robot Framework Support: <br>  <a href="http://plugins.jetbrains.com/plugin/7415%3Fpr%3Dpycharm99">http://plugins.jetbrains.com/plugin/7415?pr=pycharm99</a> <br><br>  while for the current version of PyCharm Edu 2.0.4 I had to install the robot framework version 0.14.2, since the last 0.15 was not compatible </li><li>  we clone the project with github - this item can be skipped if there is a desire to do everything from scratch: <br><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/cloudipsp/auto_tests.git</code> </pre><br></li><li>  install dependencies: <br><br>  for a start we have enough such libraries: <br><br> <code>robotframework==2.9a1 <br> selenium <br> robotframework-selenium2library <br> requests <br></code> <br>  Create a pip-requires.txt file with this content, activate virtualenv and install <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> auto_tests pip install -r pip-requires.txt</code> </pre><br></li></ol><br><h2>  Development: autotests without a browser </h2><br><br>  For example, take the type of purchase on the 3DSecure card when the card is entered on the merchant side (API section <a href="">https://www.fondy.eu/ru/info/api/v1.0/4</a> ). <br><br><img src="https://habrastorage.org/files/031/22a/843/03122a843de840a1be57181ae5dc961e.png"><br><br>  For simplicity, we exclude Step 2. - redirect in the browser (we will test it in the following example).  For a test card, this redirect occurs on the page - a banking emulator, which always returns the same result - the password is entered correctly. <br><br>  In this case, we will have 2 steps: <br><br><ul><li>  Step 1 - sending test data and card details to API <a href="https://api.fondy.eu/api/3dsecure_step1/">https://api.fondy.eu/api/3dsecure_step1/</a> and receiving in the response the URL of the page where the client should be redirected (response_status, acs_url, pareq, md parameters) to enter 3DSecure password (in case of test data, no password will be requested, instead of the issuer page there will be a stub page) <br></li><li>  Step 3 - send the order_id, merchant_id, pares, md, version, signature data to the API <a href="https://api.fondy.eu/api/3dsecure_step2/">https://api.fondy.eu/api/3dsecure_step2/</a> , get the final answer and compare it with the specifications <br></li></ul><br><h4>  Initial Settings Files </h4><br>  In the documentation link <a href="">https://www.fondy.eu/ru/info/api/v1.0/2</a> take test cards on which we will test.  By the way, all test payments can be seen in the merchant's demo account: <a href="https://www.fondy.eu/mportal/">https://www.fondy.eu/mportal/#/account/demo</a> . <br><br><img src="https://habrastorage.org/files/368/457/3c9/3684573c90f945d68189ee948c591223.png"><br><br>  Now create the robot files: <br><br>  <b>cards.robot</b> <br><br><pre> <code class="bash hljs">*** Settings *** Documentation A resource file with <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> credit cards. Imported once <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> resource.robot *** Variables *** <span class="hljs-comment"><span class="hljs-comment">#Name Card Number Exp Month Exp Year Cvv2 @{3dsApproved} 4444555566661111 01 24 238 @{no3dsApproved} 4444555511116666 01 24 238 @{3dsDeclined} 4444111166665555 01 24 238 @{no3dsDeclined} 4444111155556666 01 24 238</span></span></code> </pre><br>  <b>merchant.robot</b> <br><br><pre> <code class="bash hljs">*** Settings *** Documentation A resource file with <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> merchants. Imported once <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> resource.robot *** Variables *** <span class="hljs-variable"><span class="hljs-variable">${TestMerchant}</span></span> 1397120 <span class="hljs-comment"><span class="hljs-comment">#(Test merchant)</span></span></code> </pre><br>  <b>variables.robot</b> <br><br><pre> <code class="bash hljs">*** Settings *** Documentation Variables used <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> all tests. Imported one time <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> resource.robot *** Variables *** <span class="hljs-variable"><span class="hljs-variable">${API SERVER}</span></span> api.fondy.eu <span class="hljs-variable"><span class="hljs-variable">${JSON}</span></span> application/json <span class="hljs-variable"><span class="hljs-variable">${XML}</span></span> application/xml <span class="hljs-variable"><span class="hljs-variable">${FORM}</span></span> application/x-www-form-urlencoded</code> </pre><br>  <b>resource.robot</b> <br><br><pre> <code class="bash hljs">*** Settings *** Documentation A resource file with reusable keywords. Resource variables.robot Resource cards.robot Resource merchants.robot Library helper/utils.py Library requester.py</code> </pre><br><h4>  Protocol specifications </h4><br>  In order to be sure that the request to the API and the response from it comply with the specifications, create a file specifications_settings.py, which will contain the structure of the parameters described in the documentation.  For example, the parameters in the documentation <br><br><img src="https://habrastorage.org/files/d9e/522/a58/d9e522a588654c98a32caaf6a1252d8c.png"><br><br>  will correspond to the structure: <br><br><pre> <code class="python hljs">PAY_SERVER2SERVER_3DS = { <span class="hljs-string"><span class="hljs-string">'request_step1'</span></span>: { <span class="hljs-string"><span class="hljs-string">"order_id"</span></span>: { <span class="hljs-string"><span class="hljs-string">"required"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">1024</span></span> }, <span class="hljs-string"><span class="hljs-string">"merchant_id"</span></span>: { <span class="hljs-string"><span class="hljs-string">"required"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">12</span></span> }, <span class="hljs-string"><span class="hljs-string">"order_desc"</span></span>: { <span class="hljs-string"><span class="hljs-string">"required"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">1024</span></span> },</code> </pre><br><div class="spoiler">  <b class="spoiler_title">full specifications_settings.py</b> <div class="spoiler_text"><pre> <code class="python hljs">PAY_SERVER2SERVER_3DS = { <span class="hljs-string"><span class="hljs-string">'request_step1'</span></span>: { <span class="hljs-string"><span class="hljs-string">"order_id"</span></span>: { <span class="hljs-string"><span class="hljs-string">"required"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">1024</span></span> }, <span class="hljs-string"><span class="hljs-string">"merchant_id"</span></span>: { <span class="hljs-string"><span class="hljs-string">"required"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">12</span></span> }, <span class="hljs-string"><span class="hljs-string">"order_desc"</span></span>: { <span class="hljs-string"><span class="hljs-string">"required"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">1024</span></span> }, <span class="hljs-string"><span class="hljs-string">"signature"</span></span>: { <span class="hljs-string"><span class="hljs-string">"required"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">40</span></span> }, <span class="hljs-string"><span class="hljs-string">"amount"</span></span>: { <span class="hljs-string"><span class="hljs-string">"required"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"amount"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">12</span></span> }, <span class="hljs-string"><span class="hljs-string">"currency"</span></span>: { <span class="hljs-string"><span class="hljs-string">"required"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span> }, <span class="hljs-string"><span class="hljs-string">"version"</span></span>: { <span class="hljs-string"><span class="hljs-string">"default"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"required"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span> }, <span class="hljs-string"><span class="hljs-string">"server_callback_url"</span></span>: { <span class="hljs-string"><span class="hljs-string">"required"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"url"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">2048</span></span> }, <span class="hljs-string"><span class="hljs-string">"lifetime"</span></span>: { <span class="hljs-string"><span class="hljs-string">"required"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">6</span></span> }, <span class="hljs-string"><span class="hljs-string">"merchant_data"</span></span>: { <span class="hljs-string"><span class="hljs-string">"required"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">2048</span></span> }, <span class="hljs-string"><span class="hljs-string">"preauth"</span></span>: { <span class="hljs-string"><span class="hljs-string">"default"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"boolean"</span></span>, <span class="hljs-string"><span class="hljs-string">"required"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> }, <span class="hljs-string"><span class="hljs-string">"sender_email"</span></span>: { <span class="hljs-string"><span class="hljs-string">"required"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"email"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">50</span></span> }, <span class="hljs-string"><span class="hljs-string">"lang"</span></span>: { <span class="hljs-string"><span class="hljs-string">"required"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> }, <span class="hljs-string"><span class="hljs-string">"product_id"</span></span>: { <span class="hljs-string"><span class="hljs-string">"required"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">1024</span></span> }, <span class="hljs-string"><span class="hljs-string">"verification"</span></span>: { <span class="hljs-string"><span class="hljs-string">"default"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"boolean"</span></span>, <span class="hljs-string"><span class="hljs-string">"required"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> }, <span class="hljs-string"><span class="hljs-string">"card_number"</span></span>: { <span class="hljs-string"><span class="hljs-string">"required"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">19</span></span> }, <span class="hljs-string"><span class="hljs-string">"cvv2"</span></span>: { <span class="hljs-string"><span class="hljs-string">"required"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span> }, <span class="hljs-string"><span class="hljs-string">"expiry_date"</span></span>: { <span class="hljs-string"><span class="hljs-string">"required"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"date"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">"important"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, }, }, <span class="hljs-string"><span class="hljs-string">'request_step2'</span></span>: { <span class="hljs-string"><span class="hljs-string">"order_id"</span></span>: { <span class="hljs-string"><span class="hljs-string">"required"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">1024</span></span> }, <span class="hljs-string"><span class="hljs-string">"merchant_id"</span></span>: { <span class="hljs-string"><span class="hljs-string">"required"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">12</span></span> }, <span class="hljs-string"><span class="hljs-string">"pares"</span></span>: { <span class="hljs-string"><span class="hljs-string">"required"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">20480</span></span> }, <span class="hljs-string"><span class="hljs-string">"md"</span></span>: { <span class="hljs-string"><span class="hljs-string">"required"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">1024</span></span> }, <span class="hljs-string"><span class="hljs-string">"version"</span></span>: { <span class="hljs-string"><span class="hljs-string">"default"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"required"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span> }, <span class="hljs-string"><span class="hljs-string">"signature"</span></span>: { <span class="hljs-string"><span class="hljs-string">"required"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">40</span></span> }, }, <span class="hljs-string"><span class="hljs-string">'response_3ds'</span></span>: { <span class="hljs-string"><span class="hljs-string">"response_status"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"required"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">50</span></span> }, <span class="hljs-string"><span class="hljs-string">"acs_url"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"required"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">2048</span></span> }, <span class="hljs-string"><span class="hljs-string">"pareq"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"required"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">20480</span></span> }, <span class="hljs-string"><span class="hljs-string">"md"</span></span>: { <span class="hljs-string"><span class="hljs-string">"default"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"required"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-string"><span class="hljs-string">"description_en"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"description_ru"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">1024</span></span> }, }, <span class="hljs-string"><span class="hljs-string">'response_final'</span></span>: { <span class="hljs-string"><span class="hljs-string">"order_id"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">1024</span></span> }, <span class="hljs-string"><span class="hljs-string">"merchant_id"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">12</span></span> }, <span class="hljs-string"><span class="hljs-string">"amount"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"amount"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">12</span></span> }, <span class="hljs-string"><span class="hljs-string">"currency"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span> }, <span class="hljs-string"><span class="hljs-string">"order_status"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">50</span></span> }, <span class="hljs-string"><span class="hljs-string">"response_status"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">50</span></span> }, <span class="hljs-string"><span class="hljs-string">"signature"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">40</span></span> }, <span class="hljs-string"><span class="hljs-string">"tran_type"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">50</span></span> }, <span class="hljs-string"><span class="hljs-string">"sender_cell_phone"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span> }, <span class="hljs-string"><span class="hljs-string">"sender_account"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">50</span></span> }, <span class="hljs-string"><span class="hljs-string">"masked_card"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">19</span></span> }, <span class="hljs-string"><span class="hljs-string">"card_bin"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">6</span></span> }, <span class="hljs-string"><span class="hljs-string">"card_type"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">50</span></span> }, <span class="hljs-string"><span class="hljs-string">"rrn"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">50</span></span> }, <span class="hljs-string"><span class="hljs-string">"approval_code"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">6</span></span> }, <span class="hljs-string"><span class="hljs-string">"response_code"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span> }, <span class="hljs-string"><span class="hljs-string">"response_description"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">1024</span></span> }, <span class="hljs-string"><span class="hljs-string">"reversal_amount"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"amount"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">12</span></span> }, <span class="hljs-string"><span class="hljs-string">"settlement_amount"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"amount"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">12</span></span> }, <span class="hljs-string"><span class="hljs-string">"settlement_currency"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span> }, <span class="hljs-string"><span class="hljs-string">"order_time"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"time"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">19</span></span> }, <span class="hljs-string"><span class="hljs-string">"settlement_date"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"time"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span> }, <span class="hljs-string"><span class="hljs-string">"eci"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> }, <span class="hljs-string"><span class="hljs-string">"fee"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"amount"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">12</span></span> }, <span class="hljs-string"><span class="hljs-string">"payment_system"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">50</span></span> }, <span class="hljs-string"><span class="hljs-string">"sender_email"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"email"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">254</span></span> }, <span class="hljs-string"><span class="hljs-string">"payment_id"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">19</span></span> }, <span class="hljs-string"><span class="hljs-string">"actual_amount"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"amount"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">12</span></span> }, <span class="hljs-string"><span class="hljs-string">"actual_currency"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span> }, <span class="hljs-string"><span class="hljs-string">"product_id"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">1024</span></span> }, <span class="hljs-string"><span class="hljs-string">"merchant_data"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">2048</span></span>, }, <span class="hljs-string"><span class="hljs-string">"verification_status"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span>, }, <span class="hljs-string"><span class="hljs-string">"rectoken"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span>, }, <span class="hljs-string"><span class="hljs-string">"rectoken_lifetime"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"time"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">19</span></span>, }, }, }</code> </pre><br></div></div><br>  Next, create functions. <br><br>  The function that will run through the specifications specifications_settings.py file and create a request in the format JSON, XML, FORM from a set of all data of different types, finishing them up to the maximum length. <br><br><div class="spoiler">  <b class="spoiler_title">Build required parameters dict</b> <div class="spoiler_text"><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build_required_parameters_dict</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, merchant_id, currency, spec, spec_dict, response_url=None, *args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> self.merchant_id = merchant_id request_params_specs = getattr( specifications_settings, spec)[spec_dict] <span class="hljs-comment"><span class="hljs-comment"># for requests with cards if args: kwargs['card_number'] = args[0] kwargs['expiry_date'] = int(str(args[1]) + str(args[2])) kwargs['cvv2'] = args[3] request_params = {} for param in request_params_specs: if param in kwargs.iterkeys(): request_params[param] = kwargs[param] elif param == "signature": request_params[param] = '' elif param == "currency": request_params[param] = currency elif param == "payment_systems": request_params[param] = 'card' elif param == "response_url": request_params[param] = response_url elif param == "merchant_id": request_params[param] = merchant_id elif param == "delayed": request_params[param] = "n" elif param == "order_desc": request_params[param] = 'test' + randomStr(size=7, chars=string.digits) elif param == "order_id": request_params[param] = self.order_id # for 3ds requests elif param == "pares": request_params[param] = TEST_PARES elif param == "md": request_params[param] = self.md # any other parameters elif request_params_specs[param]["type"] == "email": request_params[param] = "test@fondy.eu" elif request_params_specs[param]["type"] == "string": request_params[param] = randomStr( request_params_specs[param]["size"], param).encode('utf-8') elif request_params_specs[param]["type"] == "url": request_params[param] = "https://" + randomStr( request_params_specs[param]["size"] - 12, param).encode('utf-8') + ".com" elif request_params_specs[param]["type"] == "int": request_params[param] = randomStr(request_params_specs[param]["size"], "", string.digits) elif request_params_specs[param]["type"] == "amount": request_params[param] = randomStr( 5, "", string.digits) elif request_params_specs[param]["type"] == "boolean": request_params[param] = randomStr( 1, "", "YN") self.request_params = request_params</span></span></code> </pre><br></div></div><br>  the function of directly HTTPS POST sending data to the API: <br><br><div class="spoiler">  <b class="spoiler_title">Send request</b> <div class="spoiler_text"><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send_request</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, content_type, url=None, data=None, protocol=False, **kwargs)</span></span></span><span class="hljs-function">:</span></span> requests.packages.urllib3.disable_warnings() <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"*HTML* sending request"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"*HTML* content_type=%r, url=%r, data=%r, kwargs=%r"</span></span> % (content_type, url, data, kwargs) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> data <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: data = self.request_params <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.order_id == <span class="hljs-string"><span class="hljs-string">''</span></span>: data[<span class="hljs-string"><span class="hljs-string">'order_id'</span></span>] = <span class="hljs-string"><span class="hljs-string">'test'</span></span> + randomStr( <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, string.ascii_letters) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: data[<span class="hljs-string"><span class="hljs-string">'order_id'</span></span>] = self.order_id data[<span class="hljs-string"><span class="hljs-string">'signature'</span></span>] = <span class="hljs-string"><span class="hljs-string">""</span></span> data[<span class="hljs-string"><span class="hljs-string">'signature'</span></span>] = build_signature(self.request_params) self.save_order_id_from_server(data[<span class="hljs-string"><span class="hljs-string">'order_id'</span></span>]) post_data = self.build_request(content_type, data) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"*HTML* POSTREQUEST %s"</span></span> % (post_data) self.response = requests.post( url, headers={<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>: content_type}, data=post_data, verify=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>).text <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"*HTML* POSTRESPONSE %s"</span></span> % (self.response) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.response</code> </pre><br></div></div><br>  We also need a function to validate the response from the API, which will verify all received parameters with the specifications_settings.py <b>specification</b> file: <br><br><div class="spoiler">  <b class="spoiler_title">Verify response status</b> <div class="spoiler_text"><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">verify_response_status</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, spec, spec_dict, content_type, response=None, request_params=None, status=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'approved'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> response == <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: response = self.response <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"*HTML* response %s"</span></span> % (response) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> request_params == <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.request_params: request_params = self.request_params <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"*HTML* REq_par %s"</span></span> % (request_params) response_params_specs = getattr( specifications_settings, spec)[spec_dict] <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"*HTML* REsponse_par_spec %s"</span></span> % (response_params_specs) errors_list = [] error = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> response_params = parse_response(self.response, content_type) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"*HTML* REsp_par %s"</span></span> % (response_params) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> param <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> response_params_specs: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> response_params[param] <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> response_params_specs[param][<span class="hljs-string"><span class="hljs-string">"type"</span></span>] == <span class="hljs-string"><span class="hljs-string">"string"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(response_params[param]) &gt; response_params_specs[param][<span class="hljs-string"><span class="hljs-string">"size"</span></span>]: errors_list.append(<span class="hljs-string"><span class="hljs-string">'Error: size of param '</span></span> + param + <span class="hljs-string"><span class="hljs-string">' is '</span></span> + str( len(response_params[param])) + <span class="hljs-string"><span class="hljs-string">' but max is '</span></span> + str( response_params_specs[param][<span class="hljs-string"><span class="hljs-string">"size"</span></span>])) error = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> response_params_specs[param][<span class="hljs-string"><span class="hljs-string">"type"</span></span>] == <span class="hljs-string"><span class="hljs-string">"int"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(str(response_params[param])) &gt; response_params_specs[param][<span class="hljs-string"><span class="hljs-string">"size"</span></span>]: errors_list.append(<span class="hljs-string"><span class="hljs-string">'Error: size of param '</span></span> + param + <span class="hljs-string"><span class="hljs-string">' is '</span></span> + str( len(str(response_params[param]))) + <span class="hljs-string"><span class="hljs-string">' but max is '</span></span> + str( response_params_specs[param][<span class="hljs-string"><span class="hljs-string">"size"</span></span>])) error = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> response_params[param] != <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> str(response_params[param]).isdigit(): errors_list.append( <span class="hljs-string"><span class="hljs-string">'Error: param '</span></span> + param + <span class="hljs-string"><span class="hljs-string">' is not integer'</span></span>) error = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: errors_list.append(<span class="hljs-string"><span class="hljs-string">'Error: param '</span></span> + param + <span class="hljs-string"><span class="hljs-string">' is missing'</span></span>) error = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> request_params.get(param) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> request_params.get( param) != <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> param != <span class="hljs-string"><span class="hljs-string">'signature'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> response_params.get(param) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (response_params_specs[param][<span class="hljs-string"><span class="hljs-string">"type"</span></span>] == <span class="hljs-string"><span class="hljs-string">"string"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> request_params.get( param) != response_params.get( param)) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> ( response_params_specs[param][<span class="hljs-string"><span class="hljs-string">"type"</span></span>] == <span class="hljs-string"><span class="hljs-string">"amount"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> int( request_params.get(param)) != int( response_params.get(param))): request = <span class="hljs-string"><span class="hljs-string">'request:'</span></span> + str(request_params.get(param)) response = <span class="hljs-string"><span class="hljs-string">'response:'</span></span> + str(response_params.get(param)) order_id = <span class="hljs-string"><span class="hljs-string">'order_id:'</span></span> + \ str(response_params.get(<span class="hljs-string"><span class="hljs-string">'order_id'</span></span>)) errors_list.append( <span class="hljs-string"><span class="hljs-string">'Error: param '</span></span> + param + <span class="hljs-string"><span class="hljs-string">' is not equal in request and '</span></span> <span class="hljs-string"><span class="hljs-string">'response\n request=%s\n response=%s order_id=%s'</span></span> % ( request, response, order_id)) error = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> response_params_specs.get(<span class="hljs-string"><span class="hljs-string">'signature'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: params_sign = {param: response_params.get(param, <span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> param <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> response_params_specs <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> param != <span class="hljs-string"><span class="hljs-string">'signature'</span></span>} params = collections.OrderedDict(sorted(response_params.items())) params_sign[<span class="hljs-string"><span class="hljs-string">'signature'</span></span>] = build_signature(params_sign) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> params_sign[<span class="hljs-string"><span class="hljs-string">'signature'</span></span>] != params[<span class="hljs-string"><span class="hljs-string">"signature"</span></span>]: errors_list.append(<span class="hljs-string"><span class="hljs-string">'Error: signature invalid in response '</span></span>) error = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> response_params.get(<span class="hljs-string"><span class="hljs-string">'order_status'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> response_params.get(<span class="hljs-string"><span class="hljs-string">'order_status'</span></span>) != status: errors_list.append(<span class="hljs-string"><span class="hljs-string">'Error: invalid status in response '</span></span>) error = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Exception <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> e: errors_list.append(<span class="hljs-string"><span class="hljs-string">"final %s"</span></span> % e.message) error = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> error: <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> Exception(<span class="hljs-string"><span class="hljs-string">"*HTML* Errors:\n %s"</span></span> % errors_list) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"*HTML* test passed OK"</span></span></code> </pre><br></div></div><br>  And the last function to save the response from the API in step 1 is to pass the parameters to step 2: <br><br><div class="spoiler">  <b class="spoiler_title">Save md pareq and acs url for 3ds</b> <div class="spoiler_text"><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">save_order_id_from_server</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, order_id)</span></span></span><span class="hljs-function">:</span></span> self.order_id = order_id <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"*HTML* Order_id %s"</span></span> % (self.order_id)</code> </pre><br></div></div><br>  Now, based on these functions, we can build the <b>pay_with_3ds_card.robot</b> test script: <br><br><pre> <code class="bash hljs">*** Settings *** Documentation A <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> suite containing tests related to server-server complete purchase with 3ds card. Test Template Server-server full purchase with 3ds card Should Pass Test Timeout 15 seconds Default Tags smoke 3ds Library DebugLibrary Resource ../resource.robot *** Variables *** <span class="hljs-variable"><span class="hljs-variable">${specificatons}</span></span> PAY_SERVER2SERVER_3DS <span class="hljs-variable"><span class="hljs-variable">${req_dict_step1}</span></span> request_step1 <span class="hljs-variable"><span class="hljs-variable">${resp_dict_step1}</span></span> response_3ds <span class="hljs-variable"><span class="hljs-variable">${url_step1}</span></span> https://<span class="hljs-variable"><span class="hljs-variable">${API SERVER}</span></span>/api/3dsecure_step1/ <span class="hljs-variable"><span class="hljs-variable">${req_dict_step2}</span></span> request_step2 <span class="hljs-variable"><span class="hljs-variable">${resp_dict_step2}</span></span> response_final <span class="hljs-variable"><span class="hljs-variable">${url_step2}</span></span> https://<span class="hljs-variable"><span class="hljs-variable">${API SERVER}</span></span>/api/3dsecure_step2/ ***Test Cases *** merchant_id currency content_type credit_card USD_JSON_Approved <span class="hljs-variable"><span class="hljs-variable">${TestMerchant}</span></span> USD <span class="hljs-variable"><span class="hljs-variable">${JSON}</span></span> @{3dsApproved} USD_XML_Approved <span class="hljs-variable"><span class="hljs-variable">${TestMerchant}</span></span> USD <span class="hljs-variable"><span class="hljs-variable">${XML}</span></span> @{3dsApproved} USD_FORM_Approved <span class="hljs-variable"><span class="hljs-variable">${TestMerchant}</span></span> USD <span class="hljs-variable"><span class="hljs-variable">${FORM}</span></span> @{3dsApproved} UAH_JSON_Approved <span class="hljs-variable"><span class="hljs-variable">${TestMerchant}</span></span> UAH <span class="hljs-variable"><span class="hljs-variable">${JSON}</span></span> @{3dsApproved} UAH_XML_Approved <span class="hljs-variable"><span class="hljs-variable">${TestMerchant}</span></span> UAH <span class="hljs-variable"><span class="hljs-variable">${XML}</span></span> @{3dsApproved} UAH_FORM_Approved <span class="hljs-variable"><span class="hljs-variable">${TestMerchant}</span></span> UAH <span class="hljs-variable"><span class="hljs-variable">${FORM}</span></span> @{3dsApproved} EUR_JSON_Approved <span class="hljs-variable"><span class="hljs-variable">${TestMerchant}</span></span> EUR <span class="hljs-variable"><span class="hljs-variable">${JSON}</span></span> @{3dsApproved} EUR_XML_Approved <span class="hljs-variable"><span class="hljs-variable">${TestMerchant}</span></span> EUR <span class="hljs-variable"><span class="hljs-variable">${XML}</span></span> @{3dsApproved} EUR_FORM_Approved <span class="hljs-variable"><span class="hljs-variable">${TestMerchant}</span></span> EUR <span class="hljs-variable"><span class="hljs-variable">${FORM}</span></span> @{3dsApproved} RUB_JSON_Approved <span class="hljs-variable"><span class="hljs-variable">${TestMerchant}</span></span> RUB <span class="hljs-variable"><span class="hljs-variable">${JSON}</span></span> @{3dsApproved} RUB_XML_Approved <span class="hljs-variable"><span class="hljs-variable">${TestMerchant}</span></span> RUB <span class="hljs-variable"><span class="hljs-variable">${XML}</span></span> @{3dsApproved} RUB_FORM_Approved <span class="hljs-variable"><span class="hljs-variable">${TestMerchant}</span></span> RUB <span class="hljs-variable"><span class="hljs-variable">${FORM}</span></span> @{3dsApproved} GBP_JSON_Approved <span class="hljs-variable"><span class="hljs-variable">${TestMerchant}</span></span> GBP <span class="hljs-variable"><span class="hljs-variable">${JSON}</span></span> @{3dsApproved} GBP_XML_Approved <span class="hljs-variable"><span class="hljs-variable">${TestMerchant}</span></span> GBP <span class="hljs-variable"><span class="hljs-variable">${XML}</span></span> @{3dsApproved} GBP_FORM_Approved <span class="hljs-variable"><span class="hljs-variable">${TestMerchant}</span></span> GBP <span class="hljs-variable"><span class="hljs-variable">${FORM}</span></span> @{3dsApproved} *** Keywords *** Server-server full purchase with 3ds card Should Pass [Arguments] <span class="hljs-variable"><span class="hljs-variable">${merchant_id}</span></span> <span class="hljs-variable"><span class="hljs-variable">${currency}</span></span> <span class="hljs-variable"><span class="hljs-variable">${content_type}</span></span> @{credit_card} Build required parameters dict <span class="hljs-variable"><span class="hljs-variable">${merchant_id}</span></span> <span class="hljs-variable"><span class="hljs-variable">${currency}</span></span> <span class="hljs-variable"><span class="hljs-variable">${specificatons}</span></span> <span class="hljs-variable"><span class="hljs-variable">${req_dict_step1}</span></span> @{credit_card} Send request <span class="hljs-variable"><span class="hljs-variable">${content_type}</span></span> <span class="hljs-variable"><span class="hljs-variable">${url_step1}</span></span> Verify response status <span class="hljs-variable"><span class="hljs-variable">${specificatons}</span></span> <span class="hljs-variable"><span class="hljs-variable">${resp_dict_step1}</span></span> <span class="hljs-variable"><span class="hljs-variable">${content_type}</span></span> Save md pareq and acs url <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> 3ds <span class="hljs-variable"><span class="hljs-variable">${content_type}</span></span> Build required parameters dict <span class="hljs-variable"><span class="hljs-variable">${merchant_id}</span></span> <span class="hljs-variable"><span class="hljs-variable">${currency}</span></span> <span class="hljs-variable"><span class="hljs-variable">${specificatons}</span></span> <span class="hljs-variable"><span class="hljs-variable">${req_dict_step2}</span></span> Send request <span class="hljs-variable"><span class="hljs-variable">${content_type}</span></span> <span class="hljs-variable"><span class="hljs-variable">${url_step2}</span></span> Verify response status <span class="hljs-variable"><span class="hljs-variable">${specificatons}</span></span> <span class="hljs-variable"><span class="hljs-variable">${resp_dict_step2}</span></span> <span class="hljs-variable"><span class="hljs-variable">${content_type}</span></span></code> </pre><br>  This human readable script will test all 3 supported JSON, XML, FORM request formats for 5 different currencies: USD, UAH, EUR, RUB, GBP <br><br>  Run the tests in virtualenv: <br><br><pre> <code class="bash hljs">(tests) E:\work\fondy\auto_tests&gt;pybot server-server-tests</code> </pre><br><img src="https://habrastorage.org/files/bbc/749/d8f/bbc749d8fe1f4559a5fdb4ea6099f6f9.png"><br><br><h2>  Development: Autotests with a browser and Telegram </h2><br>  Now we will add a robot file in which we will write all the HTML elements with which we will work: fill in or analyze <br>  <b>ui_repository.robot</b> : <br><br><pre> <code class="bash hljs">*** Settings *** Documentation Variables used <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> all tests. Imported one time <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> resource.txt *** Variables *** <span class="hljs-comment"><span class="hljs-comment"># Checkout page ${CHECKOUT_BUTTON} css=.btn-lime ${CVV2} id=cvv2 ${EXPIRE_YEAR} id=expire_year ${EXPIRE_MONTH} id=expire_month ${CARD_NUMBER} name=card_number ${CARD_NUMBER_FIELD} id=credit_card_number ${3DS_SUBMIT_BUTTON} xpath=//button[@type='submit'] #Response page ${ORDER_STATUS} css=.field_order_status .value ${TABLE_RESPONSE} id=table_response</span></span></code> </pre><br>  we will add the <b>Selenium2Library</b> library and the browser opening function to the <b>resource.robot</b> file: <br><br><pre> <code class="bash hljs">*** Settings *** Documentation A resource file with reusable keywords. Resource variables.robot Resource cards.robot Resource merchants.robot Resource ui_repository.robot Library Selenium2Library Library helper/utils.py Library requester.py *** Keywords *** Open Browser For Empty Page [Arguments] Open Browser about:blank Maximize Browser Window</code> </pre><br>  Add the browser name to the <b>variables.robot</b> file: FireFox. <br><br><pre> <code class="bash hljs">*** Settings *** Documentation Variables used <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> all tests. Imported one time <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> resource.robot *** Variables *** <span class="hljs-variable"><span class="hljs-variable">${API SERVER}</span></span> api.fondy.eu <span class="hljs-variable"><span class="hljs-variable">${RESP_URL}</span></span> https://<span class="hljs-variable"><span class="hljs-variable">${API SERVER}</span></span>/<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>/responsepage/ <span class="hljs-variable"><span class="hljs-variable">${SERVER}</span></span> fondy.eu <span class="hljs-variable"><span class="hljs-variable">${BROWSER}</span></span> FireFox <span class="hljs-variable"><span class="hljs-variable">${JSON}</span></span> application/json <span class="hljs-variable"><span class="hljs-variable">${XML}</span></span> application/xml <span class="hljs-variable"><span class="hljs-variable">${FORM}</span></span> application/x-www-form-urlencoded</code> </pre><br>  The specification file is now replenished with a new set of parameters from the documentation <a href="">https://www.fondy.eu/ru/info/api/v1.0/3</a> .  These specifications are different in that the card details are not transmitted by the merchant, but they are entered on the side of the payment gateway, after the redirect from the merchant site: <br><br><div class="spoiler">  <b class="spoiler_title">specifications_settings.py</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># -*- coding: utf-8 -*- PURCHASE_FIELDS_REDIRECT = { "request": { "order_id": { "type": "string", "required": True, "size": 1024 }, "merchant_id": { "type": "int", "required": True, "size": 12 }, "order_desc": { "type": "string", "required": True, "size": 1024 }, "signature": { "type": "string", "required": True, "size": 40 }, "amount": { "type": "amount", "required": True, "size": 12 }, "currency": { "type": "string", "required": True, "size": 3 }, "version": { "default": "1.0", "type": "string", "required": False, "size": 10 }, "response_url": { "type": "url", "required": False, "size": 2048 }, "server_callback_url": { "type": "url", "required": False, "size": 2048 }, "payment_systems": { "type": "string", "required": False, "size": 1024 }, "default_payment_system": { "type": "string", "required": False, "size": 25 }, "lifetime": { "default": "36000", "type": "int", "required": False, "size": 6 }, "merchant_data": { "type": "string", "required": False, "size": 2048 }, "preauth": { "default": False, "type": "boolean", "required": False }, "sender_email": { "type": "string", "required": False, "size": 50 }, "delayed": { "default": True, "type": "boolean", "required": False }, "lang": { "type": "string", "required": False, "size": 2 }, "product_id": { "type": "string", "required": False, "size": 1024 }, "required_rectoken": { "default": False, "type": "boolean", "required": False }, "verification": { "default": False, "type": "boolean", "required": False }, "verification_type": { "default": "amount", "type": "string", "required": False, "size": 25 }, "rectoken": { "type": "string", "required": False, "size": 40 }, "receiver_rectoken": { "type": "string", "required": False, "size": 40 }, "design_id": { "type": "string", "required": False, "size": 6 }, "subscription": { "default": False, "type": "boolean", "required": False }, "subscription_callback_url": { "type": "url", "required": False, "size": 2048 } }, "response": PAY_SERVER2SERVER_3DS['response_final'], }</span></span></code> </pre><br></div></div><br>  I will not describe all the test script files in detail, it‚Äôs pretty easy to figure them out, I‚Äôll only give one: <br><br>  <b>pay_with_checkout_url_3ds_approved.robot</b> <br><br><div class="spoiler">  <b class="spoiler_title">pay_with_checkout_url_3ds_approved.robot</b> <div class="spoiler_text"><pre> <code class="bash hljs">*** Settings *** Documentation A <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> suite containing tests related to recurring api transactions with token. ... Card with 3ds. Suite Setup Open Browser For Empty Page Suite Teardown Close Browser Default Tags 3ds approved Test Template Checkout With 3ds Should Pass Resource checkout_resources.robot *** Variables *** <span class="hljs-variable"><span class="hljs-variable">${specificatons}</span></span> PURCHASE_FIELDS_REDIRECT <span class="hljs-variable"><span class="hljs-variable">${req_dict_step1}</span></span> request <span class="hljs-variable"><span class="hljs-variable">${resp_dict_step1}</span></span> response <span class="hljs-variable"><span class="hljs-variable">${url}</span></span> https://<span class="hljs-variable"><span class="hljs-variable">${API SERVER}</span></span>/api/checkout/url/ <span class="hljs-variable"><span class="hljs-variable">${checkout_url}</span></span> <span class="hljs-variable"><span class="hljs-variable">${EMPTY}</span></span> ***Test Cases*** currency merchant_id message content_type credit_card USD_JSON_Approved USD <span class="hljs-variable"><span class="hljs-variable">${TestMerchant}</span></span> approved <span class="hljs-variable"><span class="hljs-variable">${JSON}</span></span> @{3dsApproved} USD_XML_Approved USD <span class="hljs-variable"><span class="hljs-variable">${TestMerchant}</span></span> approved <span class="hljs-variable"><span class="hljs-variable">${XML}</span></span> @{3dsApproved} USD_FORM_Approved USD <span class="hljs-variable"><span class="hljs-variable">${TestMerchant}</span></span> approved <span class="hljs-variable"><span class="hljs-variable">${FORM}</span></span> @{3dsApproved} UAH_JSON_Approved UAH <span class="hljs-variable"><span class="hljs-variable">${TestMerchant}</span></span> approved <span class="hljs-variable"><span class="hljs-variable">${JSON}</span></span> @{3dsApproved} UAH_XML_Approved UAH <span class="hljs-variable"><span class="hljs-variable">${TestMerchant}</span></span> approved <span class="hljs-variable"><span class="hljs-variable">${XML}</span></span> @{3dsApproved} UAH_FORM_Approved UAH <span class="hljs-variable"><span class="hljs-variable">${TestMerchant}</span></span> approved <span class="hljs-variable"><span class="hljs-variable">${FORM}</span></span> @{3dsApproved} EUR_JSON_Approved EUR <span class="hljs-variable"><span class="hljs-variable">${TestMerchant}</span></span> approved <span class="hljs-variable"><span class="hljs-variable">${JSON}</span></span> @{3dsApproved} EUR_XML_Approved EUR <span class="hljs-variable"><span class="hljs-variable">${TestMerchant}</span></span> approved <span class="hljs-variable"><span class="hljs-variable">${XML}</span></span> @{3dsApproved} EUR_FORM_Approved EUR <span class="hljs-variable"><span class="hljs-variable">${TestMerchant}</span></span> approved <span class="hljs-variable"><span class="hljs-variable">${FORM}</span></span> @{3dsApproved} RUB_JSON_Approved RUB <span class="hljs-variable"><span class="hljs-variable">${TestMerchant}</span></span> approved <span class="hljs-variable"><span class="hljs-variable">${JSON}</span></span> @{3dsApproved} RUB_XML_Approved RUB <span class="hljs-variable"><span class="hljs-variable">${TestMerchant}</span></span> approved <span class="hljs-variable"><span class="hljs-variable">${XML}</span></span> @{3dsApproved} RUB_FORM_Approved RUB <span class="hljs-variable"><span class="hljs-variable">${TestMerchant}</span></span> approved <span class="hljs-variable"><span class="hljs-variable">${FORM}</span></span> @{3dsApproved} GBP_JSON_Approved GBP <span class="hljs-variable"><span class="hljs-variable">${TestMerchant}</span></span> approved <span class="hljs-variable"><span class="hljs-variable">${JSON}</span></span> @{3dsApproved} GBP_XML_Approved GBP <span class="hljs-variable"><span class="hljs-variable">${TestMerchant}</span></span> approved <span class="hljs-variable"><span class="hljs-variable">${XML}</span></span> @{3dsApproved} GBP_FORM_Approved GBP <span class="hljs-variable"><span class="hljs-variable">${TestMerchant}</span></span> approved <span class="hljs-variable"><span class="hljs-variable">${FORM}</span></span> @{3dsApproved} *** Keywords *** Checkout With 3ds Should Pass [Arguments] <span class="hljs-variable"><span class="hljs-variable">${currency}</span></span> <span class="hljs-variable"><span class="hljs-variable">${merchant_id}</span></span> <span class="hljs-variable"><span class="hljs-variable">${message}</span></span> <span class="hljs-variable"><span class="hljs-variable">${content_type}</span></span> @{credit_card} Get and <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> checkout url <span class="hljs-variable"><span class="hljs-variable">${merchant_id}</span></span> <span class="hljs-variable"><span class="hljs-variable">${currency}</span></span> <span class="hljs-variable"><span class="hljs-variable">${specificatons}</span></span> <span class="hljs-variable"><span class="hljs-variable">${req_dict_step1}</span></span> <span class="hljs-variable"><span class="hljs-variable">${RESP_URL}</span></span> <span class="hljs-variable"><span class="hljs-variable">${content_type}</span></span> <span class="hljs-variable"><span class="hljs-variable">${url}</span></span> @{credit_card} Go to <span class="hljs-variable"><span class="hljs-variable">${checkout_url}</span></span> Input and submit checkout <span class="hljs-variable"><span class="hljs-variable">${merchant_id}</span></span> @{credit_card} Confirm 3ds <span class="hljs-variable"><span class="hljs-variable">${merchant_id}</span></span> Response page should be displayed Check transaction status <span class="hljs-variable"><span class="hljs-variable">${message}</span></span></code> </pre><br></div></div><br>  To send the results to the Telegram, we need 2 files: the listener and the sender. <br><br><div class="spoiler">  <b class="spoiler_title">PythonListener.py</b> <div class="spoiler_text"><pre> <code class="bash hljs">from telegram_sender import * class PythonListener(object): ROBOT_LIBRARY_SCOPE = <span class="hljs-string"><span class="hljs-string">"GLOBAL"</span></span> ROBOT_LISTENER_API_VERSION = 2 def __init__(self, count=0): self.ROBOT_LIBRARY_LISTENER = self self.count = count self.stat = None def end_suite(self, name, attrs): self.stat = attrs[<span class="hljs-string"><span class="hljs-string">'statistics'</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> self.stat def log_file(self, path): <span class="hljs-built_in"><span class="hljs-built_in">print</span></span> self.stat <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> = Telegram() test.telegram_article(self.stat)</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">telegram_sender.py</b> <div class="spoiler_text"><pre> <code class="bash hljs">import telegram from helper._settings import * from telegram.ext import Updater class Telegram(object): def __init__(self, token=None): self.token = token or default_token self.updater = None self.bot = None def update_bot(self): self.updater = Updater(token=self.token) self.bot = telegram.Bot(token=self.token) self.updater.start_polling() self.bot.getMe() self.bot.getUpdates() def telegram_article(self, status): self.update_bot() <span class="hljs-comment"><span class="hljs-comment"># chat_id = bot.getUpdates()[-1].message.chat_id # add this string to update all telegram users chat_id = default_user self.bot.sendMessage(chat_id=chat_id, text=status) self.updater.stop()</span></span></code> </pre><br></div></div><br>  Also we will write in the _settings.py parameters for Telegram bot: <br><br><pre> <code class="bash hljs">default_token = None <span class="hljs-comment"><span class="hljs-comment"># Put Your bot token to this variable default_user = None # Add user chat id</span></span></code> </pre><br>  How to get a token and chat id, you can read, for example, <a href="https://core.telegram.org/bots">here</a> and <a href="http://stackoverflow.com/questions/32423837/telegram-bot-how-to-get-a-group-chat-id-ruby-gem-telegram-bot">here</a> . <br><br>  Now we actually run the browser tests.  The result should come in telegrams: <br><br><pre> <code class="bash hljs">(tests) E:\work\fondy\auto_tests&gt;pybot --listener PythonListener.py checkout-tests</code> </pre><br><img src="https://habrastorage.org/files/ddb/7bb/46c/ddb7bb46c0214545a99901541f771d19.png"><br><br><h4>  Afterword </h4><br>  I hope this article will be useful both for auto testers and developers.  In the next article I will try to tell you what to do if there are already several thousand tests - how to parallelize them, how to collect metrics about the speed of the tests, how to develop tests that interact with the database. </div><p>Source: <a href="https://habr.com/ru/post/302736/">https://habr.com/ru/post/302736/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../302726/index.html">Self-configuring applications</a></li>
<li><a href="../302728/index.html">Bitrix24: how to avoid mistakes in project management</a></li>
<li><a href="../302730/index.html">Dash cryptocurrency: full DAO</a></li>
<li><a href="../302732/index.html">ShopConf 2016 - June 17 in Skolkovo - the program is formed</a></li>
<li><a href="../302734/index.html">Digest of interesting events from the world of Java, and around it # 3 (05/23/2016 - 06/05/2016)</a></li>
<li><a href="../302738/index.html">Learning is light: the TC MUK program for the training of information security specialists</a></li>
<li><a href="../302744/index.html">Resize images in the browser. Things could get worse</a></li>
<li><a href="../302746/index.html">Synology DSM, Perl and Mojolicious</a></li>
<li><a href="../302752/index.html">Humane VimScript: Editor Initialization</a></li>
<li><a href="../302754/index.html">SGI, HPE and Fujitsu super servers with 24-core Xeon E7 v4 processors ‚Äî and how do we curb this hardware?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>