<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PHP and Aspect-oriented programming</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The aspect-oriented programming (AOP) paradigm that is quite popular in the Java world for some reason is poorly covered in PHP development. In this a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PHP and Aspect-oriented programming</h1><div class="post__text post__text-html js-mediator-article">  The aspect-oriented programming (AOP) paradigm that is quite popular in the Java world for some reason is poorly covered in PHP development.  In this article I want to present my approach to writing AOP applications using a small framework and module. <a name="habracut"></a><br><br><h4>  Briefly about aspect-oriented programming </h4><br>  <a href="http://ru.wikipedia.org/wiki/%25D0%2590%25D1%2581%25D0%25BF%25D0%25B5%25D0%25BA%25D1%2582%25D0%25BD%25D0%25BE-%25D0%25BE%25D1%2580%25D0%25B8%25D0%25B5%25D0%25BD%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">Aspect-oriented programming</a> is a paradigm based on the idea of ‚Äã‚Äãdividing the functionality to improve program partitioning into modules. <br>  Briefly, the essence of the approach is to create functions that run on a specific event (for example, a method call).  Depending on the definition, the functions are launched either before the execution of the event, or after (or before and after), so they can take on quite a variety of operations - from logging to synchronizing information about the object with the database (persistence). <br>  The conditions under which such functions are performed are called ‚Äújoin points‚Äù, the groups of conditions are ‚Äúpoint cuts‚Äù (point cut), and the functions themselves are called ‚Äúadvice‚Äù (advice). <br>  Most often, tips are grouped into aspects (exactly as methods into classes), so an aspect is a set of tips that implement some functionality. <br><br><h4>  PHP implementation </h4><br>  There are two obvious implementation methods: <br>  1) create wrapper functions for all potential connection points from which to call for necessary advice; <br>  2) embed your code in the process of launching methods that will run the necessary tips or not run if there are no corresponding connection points. <br>  The main disadvantage of the first method is redundancy.  Even more difficult is the task of deciding to implement AOP into an existing system that does not have wrapper functions. <br>  The second method looks nicer, but needs an additional extension to PHP.  About him (method) and will go on. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  MethodIntercept Module </h4><br>  Oddly enough, but for PHP5 + there is no extension that allows you to intercept object method calls.  All that happened was to find this <a href="http://pecl.php.net/package/intercept">Intercept</a> , the development of which focused on the alpha release in 2005.  An extension can perform some function before and / or after another function.  With OOP in PHP5, of course, does not work. <br>  On the basis of it, I wrote MethodIntercept, which, in addition to intercepting the method call, is also able to pass an object to the interceptor function, whose method is called and the arguments passed to the method. <br>  Compiling an extension is quite simple (example for Linux): <br><pre><code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> git@github.com:kooler/PAF.git <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> PAF/MethodIntercept phpize ./configure make</code> </pre> <br>  As a result, the intercept.so file will appear in the modules folder, which you need to copy to the folder with PHP extensions (you can find it out by running php -i | grep extension_dir) and adding in php.ini: extension = intercept.so. <br>  If everything described above was successful, it will be possible to use the intercept_add function, which takes 3 parameters: class-&gt; method to intercept, function to be called, interception method - before or after. <br><br><h4>  PHP Aspect Framework (PAF) </h4><br>  Despite the fact that MethodIntercept allows you to embed your code in the process of launching methods, this is not enough to fully work with AOP for several reasons: <br>  1. The extension does not support the queue - you can specify only one interceptor function. <br>  2. Interceptor can only be a function and cannot be a method; accordingly, grouping tips into aspects is impossible. <br>  3. It is not very convenient to specify an interceptor by calling a function (intercept_add). <br>  It is not advisable to add the implementation of all of the above to MethodIntercept, since its task is to intercept the method call, and not to provide all the necessary AOP buns (it may be worthwhile to write a separate extension for this). <br>  Therefore, I decided to write my own mini-framework, which simplifies the use of AOP, namely: <br>  1. Allows you to define connection points using annotations <br>  2. Takes call queue generation and intercept_add execution <br>  3. Allows you to create aspects <br>  4. Allows the use of regular expressions when defining join points. <br>  The framework is called the PHP Aspect Framework (or PAF for short): <a href="https://github.com/kooler/PAF">github.com/kooler/PAF</a> <br><br><h4>  Classic AOP example - logging </h4><br>  Consider the application of the framework on the classic example of the use of AOP - logging. <br>  Suppose we have a class: <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Backet</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">order</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  } public function createNew() { //  } }</span></span></code> </pre> <br>  Suppose that we want to display a message (or write to the log) each time the user draws up or creates a basket.  Create an aspect of the Logger, which will include two tips: the first should be called after the cart has been created, and the second after creation: <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Logger</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Aspect</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@After</span></span></span><span class="hljs-comment">(Backet-&gt;order) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">backetOrderMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($params)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'Backed has been ordered'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/* * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@After</span></span></span><span class="hljs-comment">(Backet-&gt;createNew) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">backetCreatedMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($params)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'Backet has been created'</span></span>; } }</code> </pre> <br>  We register the aspect and perform the implementation function: <br><pre> <code class="php hljs">AspectRegistry::getInstance()-&gt;addAspect(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Logger); AspectRegistry::getInstance()-&gt;interceptAll();</code> </pre> <br>  The latter should be called only once, after registering all aspects, it is she who is responsible for building the queue and performing the intercept_add function. <br>  Each argument is passed one argument - an array, the first element of which contains the object, whose method was intercepted, and the second argument passed to the intercepted method.  Thus, if for example you need to display the user name when placing an order, the advice will look like this: <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Backet</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $username; ‚Ä¶ } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Logger</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Aspect</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@After</span></span></span><span class="hljs-comment">(Backet-&gt;order) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">backetOrderMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($params)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'Backed has been ordered by user: '</span></span>.$params[<span class="hljs-number"><span class="hljs-number">0</span></span>]-&gt;username; } ... }</code> </pre> <br>  The complete code for a similar example: <a href="https://github.com/kooler/PAF/blob/master/Framework/example.php">github.com/kooler/PAF/blob/master/Framework/example.php</a> <br><br><h4>  Conclusion </h4><br>  Now the framework is at a rather early stage - there is room to grow.  I plan to add the ability to connect plug-ins, implement synchronization of objects with the base (persistance) and much more.  Judging by the popularity in Java, the paradigm is quite interesting and has the right to life in PHP. <br>  I would be grateful for any advice and ideas, and whether AOP is needed in PHP at all. </div><p>Source: <a href="https://habr.com/ru/post/131994/">https://habr.com/ru/post/131994/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../131988/index.html">GParted Live 0.10.0-3 Stable Release Released</a></li>
<li><a href="../131989/index.html">Windows 3.1 on Android</a></li>
<li><a href="../131991/index.html">What devices will Ice Cream Sandwich get?</a></li>
<li><a href="../131992/index.html">Inversion compact skin v2</a></li>
<li><a href="../131993/index.html">IoC, DI, IoC-container - Just a simple</a></li>
<li><a href="../131995/index.html">FireFox 8.0 Released</a></li>
<li><a href="../131996/index.html">New day - new language!</a></li>
<li><a href="../131998/index.html">Introduction to Template Haskell. Part 1. Required minimum</a></li>
<li><a href="../132000/index.html">Natural Docs + GitHub Pages = online auto-documentation for free (almost)</a></li>
<li><a href="../132004/index.html">RedBeanPHP - another ORM library</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>