<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automation to collect data on the growth of tables and files of all MS SQL Server databases</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Foreword 
 Often there is a need to control the growth of all tables and files of all databases. 

 This article will look at an example of how you ca...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automation to collect data on the growth of tables and files of all MS SQL Server databases</h1><div class="post__text post__text-html js-mediator-article"><h3>  Foreword </h3><br>  Often there is a need to control the growth of all tables and files of all databases. <br><br>  This article will look at an example of how you can automate the collection of data on the growth of tables and database files. <br><a name="habracut"></a><br><h3>  Decision </h3><br>  1) Let's create an idea of ‚Äã‚Äãthe size of all tables for each database (database) (for example, you can do this): <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> [__] <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> ANSI_NULLS <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> QUOTED_IDENTIFIER <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">view</span></span> [inf].[vTableSize] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pagesizeKB <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">low</span></span> / <span class="hljs-number"><span class="hljs-number">1024</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> PageSizeKB <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> master.dbo.spt_values <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-built_in"><span class="hljs-built_in">number</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> = <span class="hljs-string"><span class="hljs-string">'E'</span></span> ) ,f_size <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> p.[object_id], <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>([total_pages]) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> TotalPageSize, <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>([used_pages]) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> UsedPageSize, <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>([data_pages]) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> DataPageSize <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sys.partitions p <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> sys.allocation_units a <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> p.partition_id = a.container_id <span class="hljs-keyword"><span class="hljs-keyword">left</span></span> <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> sys.internal_tables it <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> p.object_id = it.object_id <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> OBJECTPROPERTY(p.[object_id], N<span class="hljs-string"><span class="hljs-string">'IsUserTable'</span></span>) = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> p.[object_id] ) ,tbl <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> t.[schema_id], t.[object_id], i1.rowcnt <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> CountRows, (<span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(i1.reserved), <span class="hljs-number"><span class="hljs-number">0</span></span>) + <span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(i2.reserved), <span class="hljs-number"><span class="hljs-number">0</span></span>)) * (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> top(<span class="hljs-number"><span class="hljs-number">1</span></span>) PageSizeKB <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pagesizeKB) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ReservedKB, (<span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(i1.dpages), <span class="hljs-number"><span class="hljs-number">0</span></span>) + <span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(i2.used), <span class="hljs-number"><span class="hljs-number">0</span></span>)) * (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> top(<span class="hljs-number"><span class="hljs-number">1</span></span>) PageSizeKB <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pagesizeKB) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> DataKB, ((<span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(i1.used), <span class="hljs-number"><span class="hljs-number">0</span></span>) + <span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(i2.used), <span class="hljs-number"><span class="hljs-number">0</span></span>)) - (<span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(i1.dpages), <span class="hljs-number"><span class="hljs-number">0</span></span>) + <span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(i2.used), <span class="hljs-number"><span class="hljs-number">0</span></span>))) * (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> top(<span class="hljs-number"><span class="hljs-number">1</span></span>) PageSizeKB <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pagesizeKB) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> IndexSizeKB, ((<span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(i1.reserved), <span class="hljs-number"><span class="hljs-number">0</span></span>) + <span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(i2.reserved), <span class="hljs-number"><span class="hljs-number">0</span></span>)) - (<span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(i1.used), <span class="hljs-number"><span class="hljs-number">0</span></span>) + <span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(i2.used), <span class="hljs-number"><span class="hljs-number">0</span></span>))) * (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> top(<span class="hljs-number"><span class="hljs-number">1</span></span>) PageSizeKB <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pagesizeKB) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> UnusedKB <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> sys.tables <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> sysindexes <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> i1 <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> i1.id = t.[object_id] <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> i1.indid &lt; <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> sysindexes <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> i2 <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> i2.id = t.[object_id] <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> i2.indid = <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> OBJECTPROPERTY(t.[object_id], N<span class="hljs-string"><span class="hljs-string">'IsUserTable'</span></span>) = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> (OBJECTPROPERTY(t.[object_id], N<span class="hljs-string"><span class="hljs-string">'IsView'</span></span>) = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> OBJECTPROPERTY(t.[object_id], N<span class="hljs-string"><span class="hljs-string">'IsIndexed'</span></span>) = <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> t.[schema_id], t.[object_id], i1.rowcnt ) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> @@Servername <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>, DB_NAME() <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> DBName, SCHEMA_NAME(t.[schema_id]) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> SchemaName, OBJECT_NAME(t.[object_id]) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> TableName, t.CountRows, t.ReservedKB, t.DataKB, t.IndexSizeKB, t.UnusedKB, f.TotalPageSize*(<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> top(<span class="hljs-number"><span class="hljs-number">1</span></span>) PageSizeKB <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pagesizeKB) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> TotalPageSizeKB, f.UsedPageSize*(<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> top(<span class="hljs-number"><span class="hljs-number">1</span></span>) PageSizeKB <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pagesizeKB) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> UsedPageSizeKB, f.DataPageSize*(<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> top(<span class="hljs-number"><span class="hljs-number">1</span></span>) PageSizeKB <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pagesizeKB) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> DataPageSizeKB <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> f_size <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">inner</span></span> <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> tbl <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> t.[object_id]=f.[object_id] <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span></code> </pre> <br></div></div><br>  2) Create a special database and define a table in it for storing information on the growth of all tables of all databases: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> [__] <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> ANSI_NULLS <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> QUOTED_IDENTIFIER <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> ANSI_PADDING <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> [srv].[TableStatistics]( [Row_GUID] [uniqueidentifier] <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> [DF_TableStatistics_Row_GUID] <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> (newid()), [ServerName] [<span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>](<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [DBName] [<span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>](<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [SchemaName] [<span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>](<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [TableName] [<span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>](<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [CountRows] [<span class="hljs-built_in"><span class="hljs-built_in">bigint</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [DataKB] [<span class="hljs-built_in"><span class="hljs-built_in">int</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [IndexSizeKB] [<span class="hljs-built_in"><span class="hljs-built_in">int</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [UnusedKB] [<span class="hljs-built_in"><span class="hljs-built_in">int</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [ReservedKB] [<span class="hljs-built_in"><span class="hljs-built_in">int</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [InsertUTCDate] [datetime] <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> [DF_TableStatistics_InsertUTCDate] <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">getutcdate</span></span>()), [<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">CONVERT</span></span>([<span class="hljs-built_in"><span class="hljs-built_in">date</span></span>],[InsertUTCDate])) PERSISTED, [CountRowsBack] [<span class="hljs-built_in"><span class="hljs-built_in">bigint</span></span>] <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [CountRowsNext] [<span class="hljs-built_in"><span class="hljs-built_in">bigint</span></span>] <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [DataKBBack] [<span class="hljs-built_in"><span class="hljs-built_in">int</span></span>] <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [DataKBNext] [<span class="hljs-built_in"><span class="hljs-built_in">int</span></span>] <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [IndexSizeKBBack] [<span class="hljs-built_in"><span class="hljs-built_in">int</span></span>] <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [IndexSizeKBNext] [<span class="hljs-built_in"><span class="hljs-built_in">int</span></span>] <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [UnusedKBBack] [<span class="hljs-built_in"><span class="hljs-built_in">int</span></span>] <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [UnusedKBNext] [<span class="hljs-built_in"><span class="hljs-built_in">int</span></span>] <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [ReservedKBBack] [<span class="hljs-built_in"><span class="hljs-built_in">int</span></span>] <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [ReservedKBNext] [<span class="hljs-built_in"><span class="hljs-built_in">int</span></span>] <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [AvgCountRows] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ((([CountRowsBack]+[CountRows])+[CountRowsNext])/(<span class="hljs-number"><span class="hljs-number">3</span></span>)) PERSISTED, [AvgDataKB] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ((([DataKBBack]+[DataKB])+[DataKBNext])/(<span class="hljs-number"><span class="hljs-number">3</span></span>)) PERSISTED, [AvgIndexSizeKB] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ((([IndexSizeKBBack]+[IndexSizeKB])+[IndexSizeKBNext])/(<span class="hljs-number"><span class="hljs-number">3</span></span>)) PERSISTED, [AvgUnusedKB] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ((([UnusedKBBack]+[UnusedKB])+[UnusedKBNext])/(<span class="hljs-number"><span class="hljs-number">3</span></span>)) PERSISTED, [AvgReservedKB] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ((([ReservedKBBack]+[ReservedKB])+[ReservedKBNext])/(<span class="hljs-number"><span class="hljs-number">3</span></span>)) PERSISTED, [DiffCountRows] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> (([CountRowsNext]+[CountRowsBack])-(<span class="hljs-number"><span class="hljs-number">2</span></span>)*[CountRows]) PERSISTED, [DiffDataKB] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> (([DataKBNext]+[DataKBBack])-(<span class="hljs-number"><span class="hljs-number">2</span></span>)*[DataKB]) PERSISTED, [DiffIndexSizeKB] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> (([IndexSizeKBNext]+[IndexSizeKBBack])-(<span class="hljs-number"><span class="hljs-number">2</span></span>)*[IndexSizeKB]) PERSISTED, [DiffUnusedKB] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> (([UnusedKBNext]+[UnusedKBBack])-(<span class="hljs-number"><span class="hljs-number">2</span></span>)*[UnusedKB]) PERSISTED, [DiffReservedKB] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> (([ReservedKBNext]+[ReservedKBBack])-(<span class="hljs-number"><span class="hljs-number">2</span></span>)*[ReservedKB]) PERSISTED, [TotalPageSizeKB] [<span class="hljs-built_in"><span class="hljs-built_in">int</span></span>] <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [TotalPageSizeKBBack] [<span class="hljs-built_in"><span class="hljs-built_in">int</span></span>] <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [TotalPageSizeKBNext] [<span class="hljs-built_in"><span class="hljs-built_in">int</span></span>] <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [UsedPageSizeKB] [<span class="hljs-built_in"><span class="hljs-built_in">int</span></span>] <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [UsedPageSizeKBBack] [<span class="hljs-built_in"><span class="hljs-built_in">int</span></span>] <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [UsedPageSizeKBNext] [<span class="hljs-built_in"><span class="hljs-built_in">int</span></span>] <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [DataPageSizeKB] [<span class="hljs-built_in"><span class="hljs-built_in">int</span></span>] <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [DataPageSizeKBBack] [<span class="hljs-built_in"><span class="hljs-built_in">int</span></span>] <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [DataPageSizeKBNext] [<span class="hljs-built_in"><span class="hljs-built_in">int</span></span>] <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [AvgDataPageSizeKB] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ((([DataPageSizeKBBack]+[DataPageSizeKB])+[DataPageSizeKBNext])/(<span class="hljs-number"><span class="hljs-number">3</span></span>)) PERSISTED, [AvgUsedPageSizeKB] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ((([UsedPageSizeKBBack]+[UsedPageSizeKB])+[UsedPageSizeKBNext])/(<span class="hljs-number"><span class="hljs-number">3</span></span>)) PERSISTED, [AvgTotalPageSizeKB] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ((([TotalPageSizeKBBack]+[TotalPageSizeKB])+[TotalPageSizeKBNext])/(<span class="hljs-number"><span class="hljs-number">3</span></span>)) PERSISTED, [DiffDataPageSizeKB] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> (([DataPageSizeKBNext]+[DataPageSizeKBBack])-(<span class="hljs-number"><span class="hljs-number">2</span></span>)*[DataPageSizeKB]) PERSISTED,<span class="hljs-comment"><span class="hljs-comment">--     [DiffUsedPageSizeKB] AS (([UsedPageSizeKBNext]+[UsedPageSizeKBBack])-(2)*[UsedPageSizeKB]) PERSISTED,--     [DiffTotalPageSizeKB] AS (([TotalPageSizeKBNext]+[TotalPageSizeKBBack])-(2)*[TotalPageSizeKB]) PERSISTED,--     CONSTRAINT [PK_TableStatistics] PRIMARY KEY CLUSTERED ( [Row_GUID] ASC )WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY] ) ON [PRIMARY] GO SET ANSI_PADDING ON GO</span></span></code> </pre><br></div></div><br>  TotalPageSizeKB is responsible for the size of the table itself. <br><br>  TotalPageSizeKB sum of all database tables + size of system tables = size of database data. <br><br>  3) Define the procedure for collecting information: <br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> [__] <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> ANSI_NULLS <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> QUOTED_IDENTIFIER <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PROCEDURE</span></span> [srv].[InsertTableStatistics] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> NOCOUNT <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ISOLATION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LEVEL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">READ</span></span> UNCOMMITTED; <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span> @dt <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">CAST</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">GetUTCDate</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span> @dbs <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">sql</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">max</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> <span class="hljs-comment"><span class="hljs-comment">#dbs from sys.databases; while(exists(select top(1) 1 from #dbs)) begin select top(1) @dbs=[name] from #dbs; set @sql= N'INSERT INTO [srv].[TableStatistics] ([ServerName] ,[DBName] ,[SchemaName] ,[TableName] ,[CountRows] ,[DataKB] ,[IndexSizeKB] ,[UnusedKB] ,[ReservedKB] ,[TotalPageSizeKB] ,[UsedPageSizeKB] ,[DataPageSizeKB]) SELECT [Server] ,[DBName] ,[SchemaName] ,[TableName] ,[CountRows] ,[DataKB] ,[IndexSizeKB] ,[UnusedKB] ,[ReservedKB] ,[TotalPageSizeKB] ,[UsedPageSizeKB] ,[DataPageSizeKB] FROM ['+@dbs+'].[inf].[vTableSize];'; exec sp_executesql @sql; delete from #dbs where [name]=@dbs; end drop table #dbs; declare @dt_back date=CAST(DateAdd(day,-1,@dt) as date); ;with tbl1 as ( select [Date], [CountRows], [DataKB], [IndexSizeKB], [UnusedKB], [ReservedKB], [ServerName], [DBName], [SchemaName], [TableName], [TotalPageSizeKB], [UsedPageSizeKB], [DataPageSizeKB] from [srv].[TableStatistics] where [Date]=@dt_back ) , tbl2 as ( select [Date], [CountRows], [CountRowsBack], [DataKBBack], [IndexSizeKBBack], [UnusedKBBack], [ReservedKBBack], [ServerName], [DBName], [SchemaName], [TableName], [TotalPageSizeKBBack], [UsedPageSizeKBBack], [DataPageSizeKBBack] from [srv].[TableStatistics] where [Date]=@dt ) update t2 set t2.[CountRowsBack] =t1.[CountRows], t2.[DataKBBack] =t1.[DataKB], t2.[IndexSizeKBBack] =t1.[IndexSizeKB], t2.[UnusedKBBack] =t1.[UnusedKB], t2.[ReservedKBBack] =t1.[ReservedKB], t2.[TotalPageSizeKBBack]=t1.[TotalPageSizeKB], t2.[UsedPageSizeKBBack] =t1.[UsedPageSizeKB], t2.[DataPageSizeKBBack] =t1.[DataPageSizeKB] from tbl1 as t1 inner join tbl2 as t2 on t1.[Date]=DateAdd(day,-1,t2.[Date]) and t1.[ServerName]=t2.[ServerName] and t1.[DBName]=t2.[DBName] and t1.[SchemaName]=t2.[SchemaName] and t1.[TableName]=t2.[TableName]; ;with tbl1 as ( select [Date], [CountRows], [CountRowsNext], [DataKBNext], [IndexSizeKBNext], [UnusedKBNext], [ReservedKBNext], [ServerName], [DBName], [SchemaName], [TableName], [TotalPageSizeKBNext], [UsedPageSizeKBNext], [DataPageSizeKBNext] from [srv].[TableStatistics] where [Date]=@dt_back ) , tbl2 as ( select [Date], [CountRows], [DataKB], [IndexSizeKB], [UnusedKB], [ReservedKB], [ServerName], [DBName], [SchemaName], [TableName], [TotalPageSizeKB], [UsedPageSizeKB], [DataPageSizeKB] from [srv].[TableStatistics] where [Date]=@dt ) update t1 set t1.[CountRowsNext] =t2.[CountRows], t1.[DataKBNext] =t2.[DataKB], t1.[IndexSizeKBNext] =t2.[IndexSizeKB], t1.[UnusedKBNext] =t2.[UnusedKB], t1.[ReservedKBNext] =t2.[ReservedKB], t1.[TotalPageSizeKBNext]=t2.[TotalPageSizeKB], t1.[UsedPageSizeKBNext] =t2.[UsedPageSizeKB], t1.[DataPageSizeKBNext] =t2.[DataPageSizeKB] from tbl1 as t1 inner join tbl2 as t2 on t1.[Date]=DateAdd(day,-1,t2.[Date]) and t1.[ServerName]=t2.[ServerName] and t1.[DBName]=t2.[DBName] and t1.[SchemaName]=t2.[SchemaName] and t1.[TableName]=t2.[TableName]; END GO</span></span></code> </pre><br></div></div><br>  This solution can be modified in order to collect data from all the necessary instances of MS SQL Server by the size of all database tables. <br><br>  4) We define the presentation of the information collected: <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> [__] <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> ANSI_NULLS <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> QUOTED_IDENTIFIER <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">view</span></span> [srv].[vTableStatisticsShort] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> d <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DateAdd</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">day</span></span>,<span class="hljs-number"><span class="hljs-number">-1</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">max</span></span>([<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>])) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> [<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> [srv].[TableStatistics]) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> t.[ServerName] ,t.[DBName] ,t.[SchemaName] ,t.[TableName] ,t.[CountRows] ,t.[DataKB] ,t.[IndexSizeKB] ,t.[UnusedKB] ,t.[ReservedKB] ,t.[InsertUTCDate] ,t.[<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>] ,t.[CountRowsBack] ,t.[CountRowsNext] ,t.[DataKBBack] ,t.[DataKBNext] ,t.[IndexSizeKBBack] ,t.[IndexSizeKBNext] ,t.[UnusedKBBack] ,t.[UnusedKBNext] ,t.[ReservedKBBack] ,t.[ReservedKBNext] ,t.[AvgCountRows] ,t.[AvgDataKB] ,t.[AvgIndexSizeKB] ,t.[AvgUnusedKB] ,t.[AvgReservedKB] ,t.[DiffCountRows] ,t.[DiffDataKB] ,t.[DiffIndexSizeKB] ,t.[DiffUnusedKB] ,t.[DiffReservedKB] ,t.[TotalPageSizeKB] ,t.[TotalPageSizeKBBack] ,t.[TotalPageSizeKBNext] ,t.[UsedPageSizeKB] ,t.[UsedPageSizeKBBack] ,t.[UsedPageSizeKBNext] ,t.[DataPageSizeKB] ,t.[DataPageSizeKBBack] ,t.[DataPageSizeKBNext] ,t.[AvgDataPageSizeKB] ,t.[AvgUsedPageSizeKB] ,t.[AvgTotalPageSizeKB] ,t.[DiffDataPageSizeKB] ,t.[DiffUsedPageSizeKB] ,t.[DiffTotalPageSizeKB] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> d <span class="hljs-keyword"><span class="hljs-keyword">inner</span></span> <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> [SRV].[srv].[TableStatistics] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> d.[<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>]=t.[<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> t.[CountRowsBack] <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> t.[CountRowsNext] <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span></code> </pre><br></div></div><br>  It is worth paying attention to Diff.  If it is greater than 0, then this means that the table is growing faster every day. <br>  It is assumed that the collection will be made 1 time per 24 hours. <br>  Similarly, you can automate and collect the growth of files of all databases using the following view: <br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> [__] <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> ANSI_NULLS <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> QUOTED_IDENTIFIER <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> t2.[DB_Name] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> [DBName] ,t1.FileId ,t1.NumberReads ,t1.BytesRead ,t1.IoStallReadMS ,t1.NumberWrites ,t1.BytesWritten ,t1.IoStallWriteMS ,t1.IoStallMS ,t1.BytesOnDisk ,t1.[<span class="hljs-built_in"><span class="hljs-built_in">TimeStamp</span></span>] ,t1.FileHandle ,t2.[Type_desc] ,t2.[FileName] ,t2.[Drive] ,t2.[Physical_Name] ,t2.[Ext] ,t2.[CountPage] ,t2.[SizeMb] ,t2.[SizeGb] ,t2.[Growth] ,t2.[GrowthMb] ,t2.[GrowthGb] ,t2.[GrowthPercent] ,t2.[is_percent_growth] ,t2.[database_id] ,t2.[State] ,t2.[StateDesc] ,t2.[IsMediaReadOnly] ,t2.[IsReadOnly] ,t2.[IsSpace] ,t2.[IsNameReserved] ,t2.[CreateLsn] ,t2.[DropLsn] ,t2.[ReadOnlyLsn] ,t2.[ReadWriteLsn] ,t2.[DifferentialBaseLsn] ,t2.[DifferentialBaseGuid] ,t2.[DifferentialBaseTime] ,t2.[RedoStartLsn] ,t2.[RedoStartForkGuid] ,t2.[RedoTargetLsn] ,t2.[RedoTargetForkGuid] ,t2.[BackupLsn] <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> fn_virtualfilestats(<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> t1 <span class="hljs-keyword"><span class="hljs-keyword">inner</span></span> <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> [inf].[ServerDBFileInfo] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> t2 <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> t1.[DbId]=t2.[database_id] <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> t1.[FileId]=t2.[File_Id] <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span></code> </pre><br></div></div><br><h3>  Result </h3><br>  This article has reviewed an example of automating the collection of information on the size and growth of all tables and files of all databases.  This gives full control over the resizing of both the database files and its tables, as well as taking timely measures to reduce the table or file or to increase the storage medium (or splitting information into several media). <br><br><h3>  Sources: </h3><br>  <a href="https://msdn.microsoft.com/ru-ru/">MSDN</a> </div><p>Source: <a href="https://habr.com/ru/post/338536/">https://habr.com/ru/post/338536/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../338522/index.html">What did the UFO see when they arrived at RIT ++ 2017</a></li>
<li><a href="../338524/index.html">Accelerate development with interactive blockhams</a></li>
<li><a href="../338526/index.html">Broadcast from the gamedev conference 4C in St. Petersburg. Second day</a></li>
<li><a href="../338528/index.html">What conferences work and how to go there</a></li>
<li><a href="../338532/index.html">CIS Benchmarks: best practices, guidelines and recommendations for information security</a></li>
<li><a href="../338538/index.html">MikroTik - several addresses and several different MAC on one interface</a></li>
<li><a href="../338540/index.html">CGLayout - new automatic layout system in iOS</a></li>
<li><a href="../338542/index.html">How does Microsoft try to send mobile mail to itself?</a></li>
<li><a href="../338544/index.html">Creating a sound effects synthesizer from retro games</a></li>
<li><a href="../338548/index.html">How to distinguish birds from flowers. Or flowers from birds</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>