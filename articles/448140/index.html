<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SNA Hackathon 2019 - results</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On April 1, the final of the SNA Hackathon 2019 ended, the participants of which competed in sorting social network tapes using modern machine learnin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SNA Hackathon 2019 - results</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/hr/3r/bv/hr3rbvjwdjmutccd1a3qw4lgx0o.png"></p><br><p>  On April 1, the final of the <a href="https://snahackathon.org/">SNA Hackathon 2019</a> ended, the participants of which competed in sorting social network tapes using modern machine learning technologies, computer vision, test processing and recommendation systems.  Hard online selection and two days of hard work on <a href="https://cloud.mail.ru/public/A9cF/bVSWJCJgt">160 gigabytes of data were</a> not in vain :).  We talk about what helped the participants to come to success and about other interesting observations. </p><a name="habracut"></a><br><h1 id="o-dannyh-i-zadache">  About data and task </h1><br><p>  The competition presented data on the mechanisms for preparing the ribbon for users of the social network <a href="https://ok.ru/">OK</a> , consisting of three parts: </p><br><ul><li>  logs of content shows in users' tapes with a large number of signs describing the user, content, author and other properties; </li><li>  texts related to the shown content; </li><li>  body pictures used in the content. </li></ul><br><p>  The total amount of data exceeds 160 gigabytes, of which more than 3 are for logs, another 3 for texts and the rest for pictures.  A large amount of data did not frighten the participants: according to the <a href="https://mlbootcamp.ru/main/">ML Bootcamp</a> statistics, almost 200 people took part in the contest, sending more than 3000 submits, and the most active managed to break the 100 decision level.  Perhaps, they were motivated by the prize pool of 700,000 rubles + 3 GTX 2080 Ti video cards. </p><br><p><img src="https://habrastorage.org/webt/zx/xq/y6/zxxqy6upn-dj6mbvknwfuczok1k.jpeg"></p><br><p>  The participants of the competition needed to solve the problem of sorting the tape: for each individual user, sort the displayed objects in such a way that those who received the ‚ÄúClass!‚Äù Mark were closer to the head of the list. </p><br><p>  <a href="https://ru.wikipedia.org/wiki/ROC-%25D0%25BA%25D1%2580%25D0%25B8%25D0%25B2%25D0%25B0%25D1%258F">ROC-AUC was</a> used as a quality assessment metric.  In this case, the metric was not considered for all data as a whole, but separately for each user and then averaged.  This version of the calculation is noteworthy because the algorithms that have learned to distinguish users who put many classes do not receive an advantage.  On the other hand, there is no such variant of work in standard Python packages, which revealed some interesting points, which are discussed below. </p><br><h1 id="o-tehnologiyah">  About technology </h1><br><p>  Traditionally, SNA Hackathon is not only algorithms, but also technologies - the amount of data shipped exceeds 160 gigabytes, which puts participants in front of interesting technical problems. </p><br><h2 id="parquet-vs-csv">  Parquet vs.  CSV </h2><br><p><img src="https://habrastorage.org/webt/us/yy/p5/usyyp5t1w3mwl7qfkkryicmj2g8.png"></p><br><p>  In academic studies and on Kaggle, the dominant data format is <a href="https://ru.wikipedia.org/wiki/CSV">CSV</a> , as well as other ‚Äúplain text‚Äù formats.  However, in the industry the situation is somewhat different - much greater compactness and processing speed can be achieved using "binary" storage formats. </p><br><p>  In particular, in an ecosystem built on the basis of <a href="http://spark.apache.org/">Apache Spark</a> , <a href="https://parquet.apache.org/">Apache Parquet</a> is the most popular - column data storage format with support for many features important for exploitation: </p><br><ul><li>  explicitly specified schema with evolution support; </li><li>  reading only the necessary speakers from the disk; </li><li>  basic support for indexes and filters for reading; </li><li>  column compression. </li></ul><br><p>  But despite the presence of obvious advantages, the provision of data for the competition in the Apache Parquet format was strongly criticized by some participants.  In addition to conservatism and unwillingness to spend time on mastering something new, there were some really unpleasant moments. </p><br><p>  First, the format support in the <a href="https://arrow.apache.org/">Apache Arrow</a> library, the main tool for working with Parquet from Python, is far from perfect.  When preparing data, all structural fields had to be flattened, and still, when reading texts, many participants faced a bug and had to install the old version of the library 0.11.1 instead of the current 0.12 version.  Secondly, you will not look into the Parquet file using simple console utilities: cat, less, etc.  However, this disadvantage is relatively easy to compensate using the <a href="https://github.com/apache/parquet-mr/tree/master/parquet-tools">parquet-tools</a> package. </p><br><p>  Nevertheless, those who initially tried to convert all the data into CSV, in order to work in a familiar environment, eventually abandoned this idea - after all, Parquet works significantly faster. </p><br><h2 id="busting-i-gpu">  Busting and GPU </h2><br><p><img src="https://habrastorage.org/webt/nj/sq/e8/njsqe83un-wgr68pvah530u2mmk.png"></p><br><p>  At the SmartData conference in St. Petersburg, ‚Äúwidely known in narrow circles,‚Äù Alexey Natekin <a href="https://www.youtube.com/watch%3Fv%3Du8az6sLEGpA%26feature%3Dyoutu.be">compared the</a> performance of several popular boosting tools when working on a CPU / GPU and came to the conclusion that the tangible gain of the GPU does not give.  But even then, this conclusion led to an active controversy, primarily with the <a href="https://www.youtube.com/watch%3Fv%3DUYDwhuyWYSo%26feature%3Dyoutu.be">developers of the</a> domestic <a href="https://github.com/catboost/catboost">CatBoost</a> tool. </p><br><p>  Over the past two years, progress in the development of the GPU and adaptation of the algorithms did not stand still and the SNA Hackathon final can be considered a triumph for the CatBoost + GPU pair - all the winners used it and pulled the metric primarily due to the possibility to grow more trees per unit of time. </p><br><p>  The integrated implementation of the <a href="https://medium.com/datadriveninvestor/improve-your-classification-models-using-mean-target-encoding-a3d573df31e8">mean target encoding</a> implementation contributed to the high result of solutions based on CatBoost, but the number and depth of the trees gave a more significant increase. </p><br><p>  Other boosting tools are moving in a similar direction, adding and improving support for the GPU.  So grow more trees! </p><br><h2 id="spark-vs-pyspark">  Spark vs.  Pyspark </h2><br><p><img src="https://habrastorage.org/webt/l-/nf/sq/l-nfsqg1m1a6kflzpqaw_f5anpe.png" alt="https://mindfulmachines.io/blog/2018/6/apache-spark-scala-vs-java-v-python-vs-r-vs-sql26"></p><br><p>  The <a href="http://spark.apache.org/">Apache Spark</a> tool firmly occupies a leading position in industrial Data Science, including due to the presence of the API for Python.  However, the use of Python has the additional overhead of integrating between different execution environments and the interpreter‚Äôs work. </p><br><p>  In itself, this is not a problem, if the user is aware of the extent to which the additional costs result from this or that action.  However, it turned out that many people are not aware of the scale of the problem - despite the fact that participants did not use Apache Spark, discussions on Python vs.  Scala appeared in the hackathon chat regularly, which led to the appearance of the corresponding <a href="https://habr.com/ru/company/odnoklassniki/blog/443324/">post with analysis</a> . </p><br><p>  In short, the slowdown in using Spark through Python compared to using Spark through Scala / Java can be divided into the following levels: </p><br><ul><li>  only Spark SQL API without User Defined Functions (UDF) is used - in this case there are practically no overhead costs, since the entire execution plan of the query is calculated within the JVM; </li><li>  UDF in Python is used without calling packages with C ++ code - in this case, the performance of the stage at which the UDF is calculated <strong>drops 7-10 times</strong> ; </li><li>  UDF is used in Python with reference to the C ++ package (numpy, sklearn, etc.) - in this case, the performance <strong>drops 10-50 times</strong> . </li></ul><br><p>  Partly, the negative effect can be compensated using <a href="https://pypy.org/">PyPy</a> (JIT for Python) and <a href="https://spark.apache.org/docs/latest/sql-pyspark-pandas-with-arrow.html">vectorized UDF</a> , however, in these cases, the performance difference is a multiple, and the complexity of implementation and deployment comes as an additional ‚Äúbonus‚Äù. </p><br><h1 id="ob-algoritmah">  About algorithms </h1><br><p>  But the most interesting thing about Data Science-hakatons is, of course, not technologies, but new fashionable and old proven algorithms.  This year's SNA Hackathon totally dominated CatBoost, but there were several alternative approaches.  Let's talk about them :). </p><br><h2 id="differenciruemye-grafy">  Differentiable graphs </h2><br><p><img src="https://habrastorage.org/webt/qk/k0/6m/qkk06mydcetsmnd1roumkqigtm4.png" alt="image"></p><br><p>  One of the first <a href="https://habr.com/ru/company/odnoklassniki/blog/445348">publications of</a> decisions on the basis of the selection round was devoted not to trees, but to differentiable graphs (also called artificial neural networks).  The author is an employee of the OC, so he can afford not to chase after the prizes, but to enjoy building a promising solution based on a solid mathematical foundation. </p><br><p>  The main idea of ‚Äã‚Äãthe proposed solution was to build a single computational differentiable graph that translates the existing features into a forecast, taking into account various aspects of the input data: </p><br><ul><li>  embedings of objects and users allow you to add an element of classic collaborative recommendations; </li><li>  the transition from the scalar product of embeddings to aggregation via <a href="https://en.wikipedia.org/wiki/Multilayer_perceptron">MLP</a> allows you to add arbitrary features; </li><li>  <a href="https://arxiv.org/pdf/1706.03762.pdf">query-key-value attention</a> allowed the model to dynamically adapt to the behavior of even an unfamiliar user looking at his recent history. </li></ul><br><p>  This model performed very well on the online selection in solving the problem of recommending text content, so several teams tried to reproduce it at the final at once, however, they did not come to success.  This was partly due to the fact that this requires time and experience, and partly due to the fact that the number of signs in the final was much larger and methods based on trees gained a significant advantage due to them. </p><br><h2 id="kollaborativnaya-dominanta">  Collaborative dominant </h2><br><p><img src="https://habrastorage.org/webt/xw/nn/_p/xwnn_ppw7-rrv6tvfmktcoeooqq.jpeg" alt="https://www.datasciencecentral.com/profiles/blogs/5-types-of-recommenders"></p><br><p>  Of course, when organizing the competition, we knew that the logs have a fairly strong signal, because the signs collected there reflect a significant part of the ranking work done in the OK.  Nevertheless, they hoped to the very end that the participants would cope with the ‚Äúcurse of the third character‚Äù - situations where the enormous human and machine resources invested in the development of the model for extracting features from content (texts and photos) result in extremely modest quality gains compared to prepared, mainly collaborative, signs. </p><br><p>  Knowing about this problem, we initially divided the task into three tracks in the qualifying round and formed a combined data set only in the final, but in the fixed metric hackathon format, the teams that invested in the development of content models turned out to be in a losing situation compared to the teams that developed the collaborative part. </p><br><p>  To compensate for this injustice helped the prize of the jury ... </p><br><h2 id="deep-cluster">  Deep cluster </h2><br><p><img src="https://habrastorage.org/webt/mp/co/bn/mpcobnbojo10ivoue52mukjhhys.jpeg"></p><br><p>  Which was almost unanimously awarded for his work on reproducing and testing the <a href="https://github.com/facebookresearch/deepcluster">Deep Cluster</a> algorithm from facebook.  A simple method of building clusters and embeddings that does not require initial markup was captivating with new ideas and promising results. </p><br><p>  The essence of the method is very simple: </p><br><ol><li>  calculate embeding vectors for images of any meaningful neural network; </li><li>  clustering vectors in the resulting space with k-means; </li><li>  train a neural network classifier to predict a cluster of a picture; </li><li>  repeat paragraphs 2-3 to convergence (if you have 800 hcp) or while there is enough time. </li></ol><br><p>  With a minimum of effort, we managed to get high-quality clustering of OK pictures, good embeddings and metric growth in the third digit. </p><br><h2 id="vzglyad-v-buduschee">  A look into the future </h2><br><p><img src="https://habrastorage.org/webt/5k/-x/k3/5k-xk3p4-r1fai0bncbr3brbxhw.jpeg" alt="https://www.buzzfeed.com/gabrielsanchez/remarkable-behind-the-scenes-photos-from-back-to-the-futu"></p><br><p>  In any data you can find "loopholes" to improve the forecast.  In itself, this is not so bad, much worse if the ‚Äúloopholes‚Äù are found themselves and for a long time manifest themselves only in the form of incomprehensible discrepancies between the results of validation on historical data and A / B tests. </p><br><p>  One of the most common "loopholes" of this kind is the use of information from the future.  Such information is often a very strong signal and the machine learning algorithm, if allowed to it, will start using it with confidence.  When you make a model for your product, you are trying in every way to avoid infiltrating information from the future, but on the hackathon this is a good chance to raise the metric, which the participants took advantage of. </p><br><p>  The most obvious loophole was the presence of data fields with reaction counters on the object at the time of the show - numLikes and numDislikes.  By comparing the two nearest events related to the same object, it was possible to determine with high precision what the reaction was to the object in the first of them.  There were several such counters in the data, and their use gave a noticeable advantage.  Naturally, in real operation such information will not be available. </p><br><p>  In life, you can stumble upon a similar problem without realizing it, as a rule, with negative results.  For example, counting statistics on the number of marks "Class!"  for the object for all data and taking as a separate sign.  Or, as was done in one of the participating teams, adding an object identifier to the model as a categorical attribute.  On a training set, a model with such a sign works well, but cannot generalize to a test set. </p><br><h1 id="vmesto-zaklyucheniya">  Instead of conclusion </h1><br><p><img src="https://habrastorage.org/webt/g-/h7/fe/g-h7feowmbdcg5rlk052_lpk938.jpeg"></p><br><p>  All contest materials, including data and presentations of the participants' decisions are available in the <a href="https://cloud.mail.ru/public/A9cF/bVSWJCJgt">Mail.ru Cloud</a> .  Data is available for use by research projects without restrictions, except for the presence of a link.  For the story, let's leave here the final table with the metrics of the finalist teams: </p><br><ol><li>  Scala crouching, Python undercover - 0.7422, solution analysis is available <a href="https://habr.com/ru/post/447376/">here</a> , and the code <a href="https://github.com/BraginIvan/sna2019open">here</a> and <a href="https://github.com/seshaln/sna2019/blob/master/collab50-final.ipynb">here</a> . </li><li>  Magic City - 0.7256 </li><li>  Kefir - 0.7226 </li><li>  Team 6 - 0.7205 </li><li>  Three in the boat - 0.7188 </li><li>  Hall # 14 - 0.7167 and the jury prize </li><li>  BezSNA - 0.7147 </li><li>  PONGA - 0.7117 </li><li>  Team 5 - 0.7112 </li></ol><br><p>  SNA Hackathon 2019, like the previous events of the series, was a success in every sense.  We managed to gather under one roof cool specialists in different areas and have a fruitful time, for which many thanks to both the participants themselves and all those who helped with the organization. </p><br><p>  Could you do something even better?  Of course yes!  Each competition held enriches us with new experience, which we take into account when preparing the next one and are not going to stop there.  So, see you soon at SNA Hackathon events! </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/448140/">https://habr.com/ru/post/448140/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../448124/index.html">Mikrotik. SMS control using WEB server</a></li>
<li><a href="../448126/index.html">API secrets of Android devices. Yandex report</a></li>
<li><a href="../448128/index.html">9 tips on using the Cats library in Scala</a></li>
<li><a href="../448130/index.html">De-design in video games</a></li>
<li><a href="../448136/index.html">Instruction: how to test ansible roles and learn about problems before production</a></li>
<li><a href="../448142/index.html">Where evidence, facts and imagination converge</a></li>
<li><a href="../448144/index.html">NASA: Space Travel Genetic Changes are Temporary</a></li>
<li><a href="../448146/index.html">From process modeling to designing an automated system (Part 1)</a></li>
<li><a href="../448148/index.html">Infrastructure Planning for the Zimbra Collaboration Suite</a></li>
<li><a href="../448150/index.html">Unreal Engine hotkeys that make life level designer easier</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>