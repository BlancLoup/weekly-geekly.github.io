<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SALT - configuration management software for Python</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dear colleagues, I want to present to your attention one of the configuration management systems, completely written in Python. It is quite new, but i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SALT - configuration management software for Python</h1><div class="post__text post__text-html js-mediator-article">  Dear colleagues, I want to present to your attention one of the configuration management systems, completely written in Python.  It is quite new, but it deserves attention.  If you are wondering how you can manage the fleet of servers and workstations as a single system with the help of this application - I ask under cat. <br><img src="https://habrastorage.org/storage2/e2e/678/44d/e2e67844dda544a75e8d33a6c0a3b987.png"><br><a name="habracut"></a><br><br><h5>  Why Salt? </h5><br>  Some time ago I thought about the fact that the number of servers I managed increased from a few to more than 20 and continues to grow.  There were questions about centralized software updates, changing passwords, quickly raising new virtual machines and similar routine tasks of any IT specialist. <br><br>  Naturally, I began to study the features of the market.  Here, for example, is a list of free management systems on wikipedia: <a href="http://en.wikipedia.org/wiki/Comparison_of_open_source_configuration_management_software">Comparison_of_open_source_configuration_management_software</a> , which I was actually oriented at when choosing a system to study.  When choosing, I used the following criteria: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  at least weak, but Windows support </li><li>  good linux support </li><li>  Open source code </li><li>  Not Ruby (I know this is my omission, but I didn‚Äôt have a relationship with him) </li></ul><br>  As you understood, the choice fell on <a href="http://saltstack.org/">Salt</a> . <br><br><h5>  Concept and basic concepts </h5><br>  As I understand it, Salt allows you to solve 2 tasks: <br><ol><li>  Centralized command execution on computer groups </li><li>  Support for systems in previously described states </li></ol><br>  The system consists of clients - minion, and servers - master.  The connection is outgoing in relation to the minion, therefore NAT and others are not very scary to us. <br>  <b>Grains</b> <br>  Groups of computers are formed on the basis of the so-called "grains" ( <a href="https://salt.readthedocs.org/en/latest/topics/targeting/grains.html">Grains</a> ): system parameters collected by the minion service at the time of launch. <br>  For example, if we want to check the availability of all nodes on which CentOS is installed, we just need to write: <br><blockquote>  salt <font color="#660033">-G</font> <font color="#ff0000">'os: CentOS'</font> test.ping </blockquote><br>  Or we want to know the number of cores in all our 64-bit systems: <br><blockquote>  salt <font color="#660033">-G</font> <font color="#ff0000">'cpuarch: x86_64'</font> grains.item num_cpus </blockquote><br><br>  Also on a par with standard grains we can add our own: <br><blockquote>  grains: <br>  roles: <br>  - webserver <br>  - memcache <br>  deployment: <font color="#ff4500">datacenter4</font> <br>  cabinet: <font color="#ff4500">13</font> <br>  cab_u: <font color="#ff4500">14</font> - <font color="#ff4500">15</font> </blockquote><br>  <b>States</b> <br>  The second component is the <a href="https://salt.readthedocs.org/en/latest/ref/states/top.html">state files</a> that allow us to describe the requirements for the state of the system and later on the basis of these files the minion can bring the necessary parameters of the client system to the state we need. <br><br>  But it is somehow difficult to write, I offer an example: <br>  First, let's check in the configuration file of the wizard where the SLS files should be stored <br><blockquote>  vim / etc / salt / master </blockquote><br>  looking for something like: <br><blockquote>  file_roots: <br>  base: <br>  - / srv / salt </blockquote><br>  Therefore, in this folder (/ srv / salt /) our files will be our SLS files. <br><br>  The top.sls file located in this folder is required. <br>  Here is an example of the contents of this file on my test machine: <br><blockquote>  base: <br>  <font color="#483d8b">'web2'</font> : <br>  - fail2ban </blockquote><br>  fail2ban (Third line) can be: either the sls file or the folder in which the init.sls file would lie.  The second option seems to me more convenient, for this I did: <br>  The contents of the fail2ban file I have are: <br><blockquote>  <font color="#c20cb9">cat</font> fail2ban <font color="#000000">/</font> init.sls </blockquote><br><blockquote><ol><li>  fail2ban.  <font>conf</font> : </li><li>  <font color="#008000">file</font> .  <font>managed</font> : </li><li>  - name: / etc / fail2ban / fail2ban.  <font>conf</font> </li><li>  - source: salt: // fail2ban / fail2ban.  <font>conf</font> </li><li></li><li>  jail  <font>conf</font> : </li><li>  <font color="#008000">file</font> .  <font>managed</font> : </li><li>  - name: / etc / fail2ban / jail.  <font>conf</font> </li><li>  - source: salt: // fail2ban / jail.  <font>conf</font> </li><li></li><li>  fail2ban: </li><li>  pkg: </li><li>  - installed </li><li></li><li>  service.  <font>running</font> : </li><li>  - enable: <font color="#008000">True</font> </li><li>  - watch: </li><li>  - <font color="#008000">file</font> : fail2ban.  <font>conf</font> </li><li>  - <font color="#008000">file</font> : jail.  <font>conf</font> </li></ol></blockquote><br>  There are 3 entities in this SLS file: <br><ul><li>  File fail2ban.conf (line 1) </li><li>  Jail.conf file (deadline 6) </li><li>  The package itself fail2ban (line 11) </li></ul><br><br>  In accordance with the slts file described by us, Salt will do the following: <br><ol><li>  Compare files on the client so that it will update the client if there are any changes (lines 2 and 7) </li><li>  Check for installed fail2ban package (12-13) </li><li>  Check service inclusiveness (15) </li><li>  Check autostart service (16) </li><li>  If one of the files has changed, it will restart the service (17) </li></ol><br><br><h5>  Installation </h5><br>  <b>First of all, I strongly recommend against using the file proposed by the authors of the bootstrap project.</b>  Since he does a lot, in my opinion, strange actions.  (eg yum ‚Äì y update and using the epel test repository) <br>  In fact, at least with centos, there is nothing difficult to do. <br>  The salt-master and salt-minion packages are in epel. <br>  The service names on CentOS are the same. <br>  Service configuration files are in / etc / salt / <br><br><h6>  Master </h6><br>  By default, master opens 2 ports that should be enabled in iptables: <br><blockquote>  iptables <font color="#660033">-I</font> INPUT <font color="#660033">-j</font> ACCEPT <font color="#660033">-p</font> tcp <font color="#660033">--dport</font> <font color="#000000">4505</font> : <font color="#000000">4506</font> </blockquote><br>  4505 - to communicate minions with the server <br>  4506 - for file transfer <br><h6>  Minion </h6><br>  The basic configuration of the minion file is to specify the address of the wizard, and I personally add another ID.  If this is not done, the FQDN will be used. <br>  Starting, the minion connects to the master and gives him his public key. <br>  Next on the wizard when running the salt-key utility: <br>  [root @ test salt] # salt-key <br>  Accepted Keys: <br>  Unaccepted Keys: <br>  web2 <br>  Rejected Keys: <br><br>  The key we need appears in the Unaccepted Keys list to add it to the allowed: <br>  [root @ test salt] # salt-key -a web2 <br>  Key for minion web2 accepted. <br><br>  On this connection, the first minion is over.  And you can check its availability. <br>  [root @ test salt] # salt 'web2' test.ping <br>  web2: true <br><br>  Well, if we want to check how our fail2ban is configured: <br>  [root @ test salt] # salt 'web2' state.highstate <br><img src="https://habrastorage.org/storage2/9c2/89a/aee/9c289aaee04c8df7fe8ef74ebc624c3b.png"><br><br><h5>  What can you do with the minions? </h5><br>  List of modules for remote control: <a href="https://salt.readthedocs.org/en/latest/ref/states/all/salt.states.pkg.html">salt.readthedocs.org/en/latest/ref/states/all/salt.states.pkg.html#module-salt.states.pkg</a> <br>  A list of modules for managing and monitoring states: <a href="https://salt.readthedocs.org/en/latest/ref/states/all/salt.states.file.html">salt.readthedocs.org/en/latest/ref/states/all/salt.states.file.html#module-salt.states.file</a> <br><br><h5>  Questions </h5><br>  I have not figured out 2 points yet: <br><ul><li>  How can you automate prescription on a key server for full automation?  (most likely I will write my own module, with http requests) </li><li>  What will happen to the minion if he replace the server.  Will he obey this new server?  For a question, thanks to my colleague and good friend, Jan. </li></ul><br>  I will try to answer these questions in the following articles about salt after I try everything myself. <br><br>  Thank you for your attention to the material.  Waiting for comments and comments. </div><p>Source: <a href="https://habr.com/ru/post/168125/">https://habr.com/ru/post/168125/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../168115/index.html">Logic - the most interesting news gaming and IT-industry ‚Ññ12</a></li>
<li><a href="../168117/index.html">BonBon - Sweet CSS3 Buttons</a></li>
<li><a href="../168119/index.html">Network Ring on Microcontrollers</a></li>
<li><a href="../168121/index.html">Mobile subscriptions, AdWords, Vkontakte application and phishing</a></li>
<li><a href="../168123/index.html">More FineReader good and different!</a></li>
<li><a href="../168129/index.html">DoubleArrayList is a universal implementation of java.util.List</a></li>
<li><a href="../168133/index.html">Finger topology</a></li>
<li><a href="../168137/index.html">Load Testing with Selenium</a></li>
<li><a href="../168139/index.html">$ 30,000 from Telerik for Windows 8 developers</a></li>
<li><a href="../168141/index.html">Cackle - year results</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>