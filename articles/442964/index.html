<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The art of parsing or DOM do it yourself</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! I recently wondered about creating a simple markdown language like markdown, which would be perfect for my tasks, namely, quickly writing le...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The art of parsing or DOM do it yourself</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr!  I recently wondered about creating a simple markdown language like markdown, which would be perfect for my tasks, namely, quickly writing lectures with formatting and the ability to insert mathematical formulas on the fly, using only one keyboard.  To translate text written in this format into a more understandable form, for example, a LibreOffice Writer document, you need <i>a parser</i> , in other words, a <i>parser</i> .  Since I was used to making bicycles, I went to the search engines with the queries ‚Äúparser example‚Äù, ‚Äúhtml to DOM‚Äù, ‚Äúhow to parse html‚Äù and others. As a descent, either ready-made solutions such as flex, bison, llvm and yacc were used.  There were even more libraries for parsing strictly defined languages ‚Äã‚Äã(gumbo, jsoup, rapidjson, Qt tools, etc.) Neither did not enter into my plans for writing a parser of my C ++ markup using only the standard library, therefore my the source of knowledge about the art of parsing, instead of electronic resources, was the textbooks of technical institutes.  How to take the text and build from it AST (abstract syntactic tree), about some pitfalls that I stumbled upon in the process, I will tell you about possible errors today. <br><br>  Immediately make a reservation - if your goal is your own scripting language or something even more difficult, this article will not be enough to implement it.  Ideally, you need to perfectly know automata theory and discrete structures.  But as a starting point, for now, I can limit myself to my experience, which I will generously share under the cut.  This is not exactly what I originally intended, but it is ideal for an example.  Parse we will be HTML, as a simple and familiar language. <br><a name="habracut"></a><br>  First of all, parsing or <i>parsing</i> is not a synonym for the complete process of turning a text into an object model.  The process itself consists of two stages: <br><br><ol><li>  <b>Lexical analysis of</b> text on tokens - small pieces of this text that have a certain syntactic meaning. </li><li>  <b>Syntactic parsing</b> is the construction of an <i>abstract syntax tree</i> (AST - abstract syntax tree) or <i>a document object model</i> (DOM) based on their values. </li></ol><br>  But let's order.  Before you open your favorite IDE and write code, you need to develop a grammar for the future language.  Of the formal context-free grammars, the most famous are the <i>Backus-Naur form (BNF)</i> and the <i>extended Backus-Naur form</i> .  I used their symbiosis, taking the best from both forms.  Any expression can be defined through other expressions like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="plaintext hljs">&lt;&gt; = &lt;_1&gt; &lt;_&gt; &lt;_2&gt;</code> </pre> <br>  Here one expression is defined through three others, one after another.  They, in turn, must also be represented through ‚Äúthird‚Äù expressions, etc. <br><br>  When to stop? <br><br>  The syntax description of any language in formal grammars consists of two types of tokens: <i>terminals</i> and <i>non-terminals</i> .  <b>Non</b> - <b>terminals</b> - expressions that require definition: <br><br><pre> <code class="plaintext hljs">&lt;_1&gt; = &lt;&gt; (&lt;_&gt; | &lt;_&gt;) &lt;&gt;</code> </pre> <br>  <b>Terminals are</b> self-sufficient, they do not need to be defined.  The above examples can be written as: <br><br><pre> <code class="plaintext hljs">&lt;&gt; = &lt;_1&gt; "+" &lt;_2&gt; &lt;_1&gt; = &lt;&gt; ("*" | "/") &lt;&gt;</code> </pre> <br>  where "+", "*", "/" are terminals. <br>  You need to select the terminals from the grammar right away, you can even write them out in a separate list at the bottom of the basic definitions - they will come in handy later. <br><br>  A full description of the BNF is available on Wikipedia <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D0%25BE%25D1%2580%25D0%25BC%25D0%25B0_%25D0%2591%25D1%258D%25D0%25BA%25D1%2583%25D1%2581%25D0%25B0_%25E2%2580%2594_%25D0%259D%25D0%25B0%25D1%2583%25D1%2580%25D0%25B0">here</a> and <a href="https://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25B0%25D1%2581%25D1%2588%25D0%25B8%25D1%2580%25D0%25B5%25D0%25BD%25D0%25BD%25D0%25B0%25D1%258F_%25D1%2584%25D0%25BE%25D1%2580%25D0%25BC%25D0%25B0_%25D0%2591%25D1%258D%25D0%25BA%25D1%2583%25D1%2581%25D0%25B0_%25E2%2580%2594_%25D0%259D%25D0%25B0%25D1%2583%25D1%2580%25D0%25B0">here</a> .  The compilation of the grammar of a language is an important stage in the creation of a language that does not tolerate frivolity.  One mistake in it can lead to completely non-working code, which will have to be rewritten from scratch.  Therefore, before taking the next step, make sure that there are no controversial points in the compiled grammar.  If you have two monitors, it will be convenient for the rest of the work time to occupy one monitor with a grammar document so that you can quickly move your eyes to it when you code.  Believe me, you have to do it all the time.  Here is the HTML5 grammar compiled by me in the BNF form: <br><br><pre> <code class="html hljs xml">(* document *) <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">document</span></span></span><span class="hljs-tag">&gt;</span></span> = {<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">document_part</span></span></span><span class="hljs-tag">&gt;</span></span>} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">END</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">document_part</span></span></span><span class="hljs-tag">&gt;</span></span> = <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">block</span></span></span><span class="hljs-tag">&gt;</span></span> | <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">empty_tag</span></span></span><span class="hljs-tag">&gt;</span></span> | <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">comment</span></span></span><span class="hljs-tag">&gt;</span></span> | <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">macro_tag</span></span></span><span class="hljs-tag">&gt;</span></span> | <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">text</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">block</span></span></span><span class="hljs-tag">&gt;</span></span> = <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">opening_tag</span></span></span><span class="hljs-tag">&gt;</span></span> {<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">document_part</span></span></span><span class="hljs-tag">&gt;</span></span>} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">closing_tag</span></span></span><span class="hljs-tag">&gt;</span></span> (* tags *) <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">opening_tag</span></span></span><span class="hljs-tag">&gt;</span></span> = "<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span><span class="hljs-tag"> {&lt;</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ws</span></span></span><span class="hljs-tag">&gt;</span></span>} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">block_tag_name</span></span></span><span class="hljs-tag">&gt;</span></span> [<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">attributes_list</span></span></span><span class="hljs-tag">&gt;</span></span>] {<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ws</span></span></span><span class="hljs-tag">&gt;</span></span>} "&gt;" <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">closing_tag</span></span></span><span class="hljs-tag">&gt;</span></span> = "<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span><span class="hljs-tag"> "/" {&lt;</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ws</span></span></span><span class="hljs-tag">&gt;</span></span>} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">block_tag_name</span></span></span><span class="hljs-tag">&gt;</span></span> {<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ws</span></span></span><span class="hljs-tag">&gt;</span></span>} "&gt;" <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">empty_tag</span></span></span><span class="hljs-tag">&gt;</span></span> = "<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span><span class="hljs-tag"> "!" {&lt;</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ws</span></span></span><span class="hljs-tag">&gt;</span></span>} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">empty_tag_name</span></span></span><span class="hljs-tag">&gt;</span></span> [<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">attributes_list]</span></span></span><span class="hljs-tag"> {&lt;</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ws</span></span></span><span class="hljs-tag">&gt;</span></span>} ["/"] "&gt;" <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">comment</span></span></span><span class="hljs-tag">&gt;</span></span> = "<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span><span class="hljs-tag"> "!" "</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">--</span></span></span><span class="hljs-tag">" &lt;</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">comment_text</span></span></span><span class="hljs-tag">&gt;</span></span> "--" "&gt;" <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">macro_tag</span></span></span><span class="hljs-tag">&gt;</span></span> = "<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span><span class="hljs-tag"> "?" &lt;</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">macro_text</span></span></span><span class="hljs-tag">&gt;</span></span> "?" "&gt;" <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">block_tag_name</span></span></span><span class="hljs-tag">&gt;</span></span> = "a" | "abbr" | "address" | "article" | "aside" | "audio" | "b" | "bdo" | "blockquote" | "body" | "button" | "canvas" | "caption" | "cite" | "code" | "colgroup" | "data" | "datalist" | "dd" | "del" | "details" | "dfn" | "dialog" | "div" | "dl" | "dt" | "em" | "fieldset" | "figcaption" | "figure" | "footer" | "form" | "h1" | "h2" | "h3" | "h4" | "h5" | "h6" | "head" | "header" | "html" | "i" | "iframe" | "ins" | "kbd" | "label" | "legend" | "li" | "main" | "map" | "mark" | "meter" | "nav" | "noscript" | "object" | "ol" | "optgroup" | "option" | "output" | "p" | "picture" | "pre" | "progress" | "q" | "ruby" | "rb" | "rt" | "rtc" | "rp" | "s" | "samp" | "script" | "section" | "select" | "small" | "span" | "strong" | "style" | "sub" | "summary" | "sup" | "table" | "tbody" | "td" | "template" | "textarea" | "tfoot" | "th" | "thead" | "time" | "title" | "tr" | "track" | "u" | "ul" | "var" | "video" <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">empty_tag_name</span></span></span><span class="hljs-tag">&gt;</span></span> = "area" | "base" | "br" | "col" | "embed" | "hr" | "img" | "input" | "link" | "menuitem" | "meta" | "param" | "source" | "track" | "wbr" (* attributes *) <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">attributes_list</span></span></span><span class="hljs-tag">&gt;</span></span> = <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ws</span></span></span><span class="hljs-tag">&gt;</span></span> {<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ws</span></span></span><span class="hljs-tag">&gt;</span></span>} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">attribute</span></span></span><span class="hljs-tag">&gt;</span></span> {<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ws</span></span></span><span class="hljs-tag">&gt;</span></span> {<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ws</span></span></span><span class="hljs-tag">&gt;</span></span>} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">attribute</span></span></span><span class="hljs-tag">&gt;</span></span>} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">attribute</span></span></span><span class="hljs-tag">&gt;</span></span> = <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">empty_attribute</span></span></span><span class="hljs-tag">&gt;</span></span> | <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">unquoted_attribute</span></span></span><span class="hljs-tag">&gt;</span></span> | <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">single_quoted_attribute</span></span></span><span class="hljs-tag">&gt;</span></span> | <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">double_quoted_attribute</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">empty_attribute</span></span></span><span class="hljs-tag">&gt;</span></span> = <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">attribute_name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">unquoted_attribute</span></span></span><span class="hljs-tag">&gt;</span></span> = <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">attribute_name</span></span></span><span class="hljs-tag">&gt;</span></span> {<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ws</span></span></span><span class="hljs-tag">&gt;</span></span>} "=" {<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ws</span></span></span><span class="hljs-tag">&gt;</span></span>} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">unquoted_attribute_value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">single_quoted_attribute</span></span></span><span class="hljs-tag">&gt;</span></span> = <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">attribute_name</span></span></span><span class="hljs-tag">&gt;</span></span> {<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ws</span></span></span><span class="hljs-tag">&gt;</span></span>} "=" {<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ws</span></span></span><span class="hljs-tag">&gt;</span></span>} "'" <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">single_quoted_attribute_value</span></span></span><span class="hljs-tag">&gt;</span></span> "'" <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">double_quoted_attribute</span></span></span><span class="hljs-tag">&gt;</span></span> = <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">attribute_name</span></span></span><span class="hljs-tag">&gt;</span></span> {<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ws</span></span></span><span class="hljs-tag">&gt;</span></span>} "=" {<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ws</span></span></span><span class="hljs-tag">&gt;</span></span>} "\"" <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">double_quoted_attribute_value</span></span></span><span class="hljs-tag">&gt;</span></span> "\"" <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">attribute_name</span></span></span><span class="hljs-tag">&gt;</span></span> = (<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">letter</span></span></span><span class="hljs-tag">&gt;</span></span> | <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">digit</span></span></span><span class="hljs-tag">&gt;</span></span>) {<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">letter</span></span></span><span class="hljs-tag">&gt;</span></span> | <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">digit</span></span></span><span class="hljs-tag">&gt;</span></span>} {* attribute values *) <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">unquoted_attribute_value</span></span></span><span class="hljs-tag">&gt;</span></span> = /^[\s"'=<span class="hljs-tag"><span class="hljs-tag">&lt;&gt;</span></span>/]/ {/^[\s"'=<span class="hljs-tag"><span class="hljs-tag">&lt;&gt;</span></span>/]/} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">single_quoted_attribute_value</span></span></span><span class="hljs-tag">&gt;</span></span> = /^[']/ {/^[']/} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">double_quoted_attribute_value</span></span></span><span class="hljs-tag">&gt;</span></span> = /^["]/ {/^["]/} (* nonterminals *) <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">text</span></span></span><span class="hljs-tag">&gt;</span></span> = {/^[<span class="hljs-tag"><span class="hljs-tag">&lt;&gt;</span></span>]/} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">comment_text</span></span></span><span class="hljs-tag">&gt;</span></span> = ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">macro_text</span></span></span><span class="hljs-tag">&gt;</span></span> = ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">letter</span></span></span><span class="hljs-tag">&gt;</span></span> = /[a-zA-Z]/ <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">digit</span></span></span><span class="hljs-tag">&gt;</span></span> = /[0-9]/ <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ws</span></span></span><span class="hljs-tag">&gt;</span></span> = " " | "\t" | "\n" (* terminals *) "<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">",</span></span></span><span class="hljs-tag"> "&gt;</span></span>", "/", "!", "?", " ", "\t", "\n"</code> </pre><br>  When the grammar is ready, you can proceed to the lexical analyzer (another name for the lexical parser, because in addition to parsing, it reveals lexical errors in the document).  At first glance, everything is simple: to absorb characters, write to the buffer, and when a key terminal is detected, define the resulting lexeme as a token with a certain type, right?  Yes, only the type of token here is more important than the symbol.  Now I will explain.  Of course, the disassemble procedure (ifsteam &amp; file) must contain a loop that reads one character from the input stream and sends it to the process (const char &amp; c) procedure, where this character is processed.  It seems that the process procedure needs to have a switch ¬©, where each key symbol has its own functions depending on the current type of token.  In fact, the opposite is true: it is better to use a switch to check the type of the token, and define the functions for characters.  Moreover, the current token often has an undefined type, one of many.  For example, after opening a corner bracket, you can go: opening, closing, empty tags, as well as HTML-style comments or macro tags (PHP script enclosed in "&lt;? ...?&gt;". And for all such associations you need your own case. How is to implement? With the help of bit flags. Let a finite number of token types be given (the more the better, because the task of the lexical analyzer is to keep as little syntactic work as possible) A unique number of power of two is set for each type (1, 2, 4, 8 etc.) Then in binary format they will look like this: 0001, 0010, 0  100, etc., and with the bitwise addition of any number of any types, you get a unique number. If the text description is difficult to understand, here is the code. Here is the definition of types: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Token_type { END = <span class="hljs-number"><span class="hljs-number">1</span></span>, TEXT = <span class="hljs-number"><span class="hljs-number">2</span></span>, OPENING_BLOCK_TAG_NAME = <span class="hljs-number"><span class="hljs-number">4</span></span>, CLOSING_BLOCK_TAG_NAME = <span class="hljs-number"><span class="hljs-number">8</span></span>, EMPTY_TAG_NAME = <span class="hljs-number"><span class="hljs-number">16</span></span>, COMMENT = <span class="hljs-number"><span class="hljs-number">32</span></span>, MACRO_TAG = <span class="hljs-number"><span class="hljs-number">64</span></span>, ATTRIBUTE_NAME = <span class="hljs-number"><span class="hljs-number">128</span></span>, UNQUOTED_ATTRIBUTE_VALUE = <span class="hljs-number"><span class="hljs-number">256</span></span>, SINGLE_QUOTED_ATTRIBUTE_VALUE = <span class="hljs-number"><span class="hljs-number">512</span></span>, DOUBLE_QUOTED_ATTRIBUTE_VALUE = <span class="hljs-number"><span class="hljs-number">1024</span></span> };</code> </pre><br>  Abbreviated process: <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">void</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Lexer</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">::process</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">const</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">char</span></span> &amp;<span class="hljs-selector-tag"><span class="hljs-selector-tag">c</span></span>) { switch (curr_token_type) { case <span class="hljs-attribute"><span class="hljs-attribute">END</span></span>: { throw <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-string"><span class="hljs-string">"unexpected ending!"</span></span>); break; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">case</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">TEXT</span></span>: { if (c == '&gt;') throw string("unexpected <span class="hljs-attribute"><span class="hljs-attribute">symbol</span></span>: \<span class="hljs-string"><span class="hljs-string">"&gt;\"!"</span></span>); else if (c == '&lt;') { if (!buffer.empty()) { add(buffer, TEXT); buffer.clear(); } <span class="hljs-selector-tag"><span class="hljs-selector-tag">curr_token_type</span></span> = <span class="hljs-selector-tag"><span class="hljs-selector-tag">OPENING_BLOCK_TAG_NAME</span></span> | <span class="hljs-selector-tag"><span class="hljs-selector-tag">CLOSING_BLOCK_TAG_NAME</span></span> | <span class="hljs-selector-tag"><span class="hljs-selector-tag">EMPTY_TAG_NAME</span></span> | <span class="hljs-selector-tag"><span class="hljs-selector-tag">COMMENT</span></span> | <span class="hljs-selector-tag"><span class="hljs-selector-tag">MACRO_TAG</span></span>; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">else</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">buffer</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.push_back</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">c</span></span>); <span class="hljs-selector-tag"><span class="hljs-selector-tag">break</span></span>; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">case</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">OPENING_BLOCK_TAG_NAME</span></span>: { throw string("error!"); break; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">case</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">CLOSING_BLOCK_TAG_NAME</span></span>: { if (c == '&lt;') throw string("unexpected <span class="hljs-attribute"><span class="hljs-attribute">symbol</span></span>: \<span class="hljs-string"><span class="hljs-string">"&lt;\"!"</span></span>); else if (c == '/') throw string("unexpected <span class="hljs-attribute"><span class="hljs-attribute">symbol</span></span>: \<span class="hljs-string"><span class="hljs-string">"&lt;\"!"</span></span>); else if (c == '!') throw string("unexpected <span class="hljs-attribute"><span class="hljs-attribute">symbol</span></span>: \<span class="hljs-string"><span class="hljs-string">"!\"!"</span></span>); else if (c == '?') throw string("unexpected <span class="hljs-attribute"><span class="hljs-attribute">symbol</span></span>: \<span class="hljs-string"><span class="hljs-string">"?\"!"</span></span>); else if (c == ' ') throw string("unexpected <span class="hljs-attribute"><span class="hljs-attribute">symbol</span></span>: \<span class="hljs-string"><span class="hljs-string">" \"!"</span></span>); else if (c == '\t') throw string("unexpected <span class="hljs-attribute"><span class="hljs-attribute">symbol</span></span>: \<span class="hljs-string"><span class="hljs-string">"\\t\"!"</span></span>); else if (c == '\n') throw string("unexpected <span class="hljs-attribute"><span class="hljs-attribute">symbol</span></span>: \<span class="hljs-string"><span class="hljs-string">"\\n\"!"</span></span>); else if (c == '&gt;') { for (unsigned int i(0); i &lt; BLOCK_TAGS_COUNT; i++) if (buffer == block_tags[i]) { add(buffer, CLOSING_BLOCK_TAG_NAME); buffer.clear(); curr_token_type = TEXT; break; } } <span class="hljs-selector-tag"><span class="hljs-selector-tag">else</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">buffer</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.push_back</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">c</span></span>); <span class="hljs-selector-tag"><span class="hljs-selector-tag">break</span></span>; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">case</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">EMPTY_TAG_NAME</span></span>: { throw string("error!"); break; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">case</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">COMMENT</span></span>: { ... break; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">case</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MACRO_TAG</span></span>: { ... break; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">case</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">OPENING_BLOCK_TAG_NAME</span></span> | <span class="hljs-selector-tag"><span class="hljs-selector-tag">CLOSING_BLOCK_TAG_NAME</span></span> | <span class="hljs-selector-tag"><span class="hljs-selector-tag">EMPTY_TAG_NAME</span></span> | <span class="hljs-selector-tag"><span class="hljs-selector-tag">COMMENT</span></span> | <span class="hljs-selector-tag"><span class="hljs-selector-tag">MACRO_TAG</span></span>: { ... break; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">case</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">EMPTY_TAG_NAME</span></span> | <span class="hljs-selector-tag"><span class="hljs-selector-tag">COMMENT</span></span>: { ... break; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">case</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ATTRIBUTE_NAME</span></span>: { ... break; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">case</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ATTRIBUTE_NAME</span></span> | <span class="hljs-selector-tag"><span class="hljs-selector-tag">UNQUOTED_ATTRIBUTE_VALUE</span></span> | <span class="hljs-selector-tag"><span class="hljs-selector-tag">SINGLE_QUOTED_ATTRIBUTE_VALUE</span></span> | <span class="hljs-selector-tag"><span class="hljs-selector-tag">DOUBLE_QUOTED_ATTRIBUTE_VALUE</span></span>: { ... break; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">case</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">UNQUOTED_ATTRIBUTE_VALUE</span></span> | <span class="hljs-selector-tag"><span class="hljs-selector-tag">SINGLE_QUOTED_ATTRIBUTE_VALUE</span></span> | <span class="hljs-selector-tag"><span class="hljs-selector-tag">DOUBLE_QUOTED_ATTRIBUTE_VALUE</span></span>: { ... break; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">case</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">UNQUOTED_ATTRIBUTE_VALUE</span></span>: { ... break; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">case</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SINGLE_QUOTED_ATTRIBUTE_VALUE</span></span>: { ... break; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">case</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">DOUBLE_QUOTED_ATTRIBUTE_VALUE</span></span>: { ... break; } } }</code> </pre><br>  We check with the switch the type of the expected token (or tokens), and inside each case we define the procedures for each of the key terminals.  There are not so many functions, all perform simple actions: either adding a character to the buffer, or draining the buffer into another token, or changing the expected type of token (tokens), or throwing an exception.  It is easy to determine the desired procedure from the grammar written above using a searchable text editor.  We simply look for all inclusions of the expected token (tokens) in the definitions of other expressions, then including these expressions in ‚Äúthird‚Äù and so on.  Here is an example for the opening tag in the gedit text editor: <br><br><img src="https://habrastorage.org/webt/72/fw/tw/72fwtwt_waeie4ulzftkxua356w.png" alt="formal grammar orientation"><br><br>  Initially, it is difficult to navigate the grammar, but with time and experience it becomes as simple as dividing the bar.  And here is the disassemble procedure: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Lexer::disassemble (ifstream &amp;file) { tokens_count = <span class="hljs-number"><span class="hljs-number">0</span></span>; curr_token_type = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsigned</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">line</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pos</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> c; curr_token_type = TEXT; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((c = file.get()) != EOF) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c == <span class="hljs-string"><span class="hljs-string">'\n'</span></span>) { pos = <span class="hljs-number"><span class="hljs-number">1</span></span>; line++; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> pos++; process(c); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (buffer.size() != <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(curr_token_type | TEXT)) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-string"><span class="hljs-string">"text was expected!"</span></span>); add(buffer, TEXT); buffer.clear(); } add(<span class="hljs-string"><span class="hljs-string">""</span></span>, END); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> &amp;error) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-string"><span class="hljs-string">"lexer: "</span></span> + to_string(line) + <span class="hljs-string"><span class="hljs-string">","</span></span> + to_string(pos) + <span class="hljs-string"><span class="hljs-string">": "</span></span> + error); } }</code> </pre><br>  The first expected token should obviously be set to TEXT type, and at the end add an END type token with any text (or empty, like this). <br><br>  For example, I took one of my HTML document templates with a comment, added a PHP pseudo-script to it, processed the lexer and displayed a list of tokens in the format "[" &lt;token_text&gt; ": &lt;token_type&gt;]".  Here's what happened: <br><br><div class="spoiler">  <b class="spoiler_title">Document itself</b> <div class="spoiler_text"><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ru"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"content-type"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/html"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"author"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Interquadro"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"description"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"keywords"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"viewport"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"width=device-width, initial-scale=1"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"format-detection"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"telephone=no"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"x-rim-auto-match"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"telephone=none"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"referrer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"no-referrer"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_suburl"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"shortcut icon"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".ico"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--[if lt IE 9]&gt; &lt;script src="http://html5shiv.googlecode.com/svn/trunk/html5-els.js"&gt;&lt;/script&gt; &lt;![endif]--&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">header</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"intro"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">header</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nav</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"nav"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"nav"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#"</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"nav"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#"</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"nav"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nav</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">main</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"content"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?php</span></span></span><span class="php"> </span><span class="hljs-meta"><span class="php"><span class="hljs-meta">?&gt;</span></span></span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">main</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">footer</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hr</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">small</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"copyright"</span></span></span><span class="hljs-tag">&gt;</span></span>Copyright ¬© 2019.   .<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">small</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">footer</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Token List</b> <div class="spoiler_text"><pre> ["! DOCTYPE": EMPTY_TAG_NAME]
 ["html": ATTRIBUTE_NAME]
 ["
 ": TEXT]
 ["html": OPENING_BLOCK_TAG_NAME]
 ["lang": ATTRIBUTE_NAME]
 ["ru": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["
 ": TEXT]
 ["head": OPENING_BLOCK_TAG_NAME]
 ["
	 ": TEXT]
 ["meta": EMPTY_TAG_NAME]
 ["http-equiv": ATTRIBUTE_NAME]
 ["content-type": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["content": ATTRIBUTE_NAME]
 ["text / html": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["charset": ATTRIBUTE_NAME]
 ["utf-8": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["
	 ": TEXT]
 ["meta": EMPTY_TAG_NAME]
 ["name": ATTRIBUTE_NAME]
 ["author": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["content": ATTRIBUTE_NAME]
 ["Interquadro": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["
	 ": TEXT]
 ["meta": EMPTY_TAG_NAME]
 ["name": ATTRIBUTE_NAME]
 ["description": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["content": ATTRIBUTE_NAME]
 ["": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["
	 ": TEXT]
 ["meta": EMPTY_TAG_NAME]
 ["name": ATTRIBUTE_NAME]
 ["keywords": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["content": ATTRIBUTE_NAME]
 ["": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["
	 ": TEXT]
 ["meta": EMPTY_TAG_NAME]
 ["name": ATTRIBUTE_NAME]
 ["viewport": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["content": ATTRIBUTE_NAME]
 ["width = device-width, initial-scale = 1": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["
	 ": TEXT]
 ["meta": EMPTY_TAG_NAME]
 ["name": ATTRIBUTE_NAME]
 ["format-detection": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["content": ATTRIBUTE_NAME]
 ["telephone = no": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["
	 ": TEXT]
 ["meta": EMPTY_TAG_NAME]
 ["http-equiv": ATTRIBUTE_NAME]
 ["x-rim-auto-match": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["content": ATTRIBUTE_NAME]
 ["telephone = none": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["
	 ": TEXT]
 ["meta": EMPTY_TAG_NAME]
 ["name": ATTRIBUTE_NAME]
 ["referrer": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["content": ATTRIBUTE_NAME]
 ["no-referrer": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["
	 ": TEXT]
 ["meta": EMPTY_TAG_NAME]
 ["name": ATTRIBUTE_NAME]
 ["_suburl": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["content": ATTRIBUTE_NAME]
 ["": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["
	
	 ": TEXT]
 ["title": OPENING_BLOCK_TAG_NAME]
 ["title": CLOSING_BLOCK_TAG_NAME]
 ["
	 ": TEXT]
 ["link": EMPTY_TAG_NAME]
 ["rel": ATTRIBUTE_NAME]
 ["shortcut icon": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["href": ATTRIBUTE_NAME]
 [".ico": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["
	 ": TEXT]
 ["link": EMPTY_TAG_NAME]
 ["rel": ATTRIBUTE_NAME]
 ["stylesheet": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["type": ATTRIBUTE_NAME]
 ["text / css": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["href": ATTRIBUTE_NAME]
 [".css": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["title": ATTRIBUTE_NAME]
 ["": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["

	 ": TEXT]
 ["[if lt IE 9]&gt;
	 &lt;script src = "http://html5shiv.googlecode.com/svn/trunk/html5-els.js"&gt; &lt;/ script&gt;
	 &lt;! [endif] ": COMMENT]
 ["
 ": TEXT]
 ["head": CLOSING_BLOCK_TAG_NAME]
 ["

 ": TEXT]
 ["body": OPENING_BLOCK_TAG_NAME]
 ["
	 ": TEXT]
 ["header": OPENING_BLOCK_TAG_NAME]
 ["
		 ": TEXT]
 ["div": OPENING_BLOCK_TAG_NAME]
 ["id": ATTRIBUTE_NAME]
 ["intro": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["

		 ": TEXT]
 ["div": CLOSING_BLOCK_TAG_NAME]
 ["
	 ": TEXT]
 ["header": CLOSING_BLOCK_TAG_NAME]
 ["
	 ": TEXT]
 ["nav": OPENING_BLOCK_TAG_NAME]
 ["
		 ": TEXT]
 ["ul": OPENING_BLOCK_TAG_NAME]
 ["id": ATTRIBUTE_NAME]
 ["nav": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["
			 ": TEXT]
 ["li": OPENING_BLOCK_TAG_NAME]
 ["class": ATTRIBUTE_NAME]
 ["nav": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["a": OPENING_BLOCK_TAG_NAME]
 ["href": ATTRIBUTE_NAME]
 ["#": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["Home": TEXT]
 ["a": CLOSING_BLOCK_TAG_NAME]
 ["li": CLOSING_BLOCK_TAG_NAME]
 ["
			 ": TEXT]
 ["li": OPENING_BLOCK_TAG_NAME]
 ["class": ATTRIBUTE_NAME]
 ["nav": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["a": OPENING_BLOCK_TAG_NAME]
 ["href": ATTRIBUTE_NAME]
 ["#": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["Review": TEXT]
 ["a": CLOSING_BLOCK_TAG_NAME]
 ["li": CLOSING_BLOCK_TAG_NAME]
 ["
			 ": TEXT]
 ["li": OPENING_BLOCK_TAG_NAME]
 ["class": ATTRIBUTE_NAME]
 ["nav": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["a": OPENING_BLOCK_TAG_NAME]
 ["href": ATTRIBUTE_NAME]
 ["": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["Help": TEXT]
 ["a": CLOSING_BLOCK_TAG_NAME]
 ["li": CLOSING_BLOCK_TAG_NAME]
 ["
		 ": TEXT]
 ["ul": CLOSING_BLOCK_TAG_NAME]
 ["
	 ": TEXT]
 ["nav": CLOSING_BLOCK_TAG_NAME]
 ["

	 ": TEXT]
 ["main": OPENING_BLOCK_TAG_NAME]
 ["id": ATTRIBUTE_NAME]
 ["content": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["
		 ": TEXT]
 ["php": MACRO_TAG]
 ["
	 ": TEXT]
 ["main": CLOSING_BLOCK_TAG_NAME]
 ["

	 ": TEXT]
 ["footer": OPENING_BLOCK_TAG_NAME]
 ["
		 ": TEXT]
 ["hr": EMPTY_TAG_NAME]
 ["
		 ": TEXT]
 ["small": OPENING_BLOCK_TAG_NAME]
 ["id": ATTRIBUTE_NAME]
 ["copyright": DOUBLE_QUOTED_ATTRIBUTE_VALUE]
 ["Copyright ¬© 2019. All Rights Reserved."  : TEXT]
 ["small": CLOSING_BLOCK_TAG_NAME]
 ["
	 ": TEXT]
 ["footer": CLOSING_BLOCK_TAG_NAME]
 ["
 ": TEXT]
 ["body": CLOSING_BLOCK_TAG_NAME]
 ["

 ": TEXT]
 ["html": CLOSING_BLOCK_TAG_NAME]
 ["
 ": TEXT]
 ["": END]
</pre><br><br></div></div><br>  Now we are ready to proceed to the second part - the construction of the syntactic tree.  Since our tags have attributes, the nodes of the tree, in addition to communication with other nodes, will contain arrays of key-value pairs.  The resulting construction can rightfully be called the object model of the DOM document mentioned in the title of the article. <br><br>  How many classes are needed to implement all the properties of HTML elements? <br><br>  Ideally, one class for each element so that cascading style sheets can be defined for them, but we will limit ourselves to three ‚Äî the empty ‚ÄúNode‚Äù tag, the Block block inherited from it (the content between two pair tags) and inherited from him root of the tree "Root".  We will also define in the parser an array of tags that can contain text, such as &lt;p&gt;, &lt;li&gt;, &lt;strong&gt;, etc., in order to deselect tokens with unmarked text.  Now it's up to you.  If you have worked well for a lexical analyzer, then the syntactic task is to simply absorb tokens and perform one of three operations in an open node: add an empty node to it, open a new one or close it yourself, returning the pointer to the parent.  For the latter, it will be required that all classes, starting with the base Node, contain such a pointer, obtained by creating the element.  This process is called <i>downward parsing</i> . <br><br>  Parsing procedure: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Parser::parse (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Lexer &amp;lexer) { Block * open_block = (Block*) tree; Node * last_node = (Node*) tree; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> size = lexer.count(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> i(<span class="hljs-number"><span class="hljs-number">0</span></span>); i &lt; size<span class="hljs-number"><span class="hljs-number">-2</span></span>; i++) { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (lexer[i].type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Lexer::TEXT: { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j(<span class="hljs-number"><span class="hljs-number">0</span></span>); j &lt; TEXT_TAGS_COUNT; j++) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (open_block-&gt;get_name() == text_tags[j]) last_node = open_block-&gt;add(<span class="hljs-string"><span class="hljs-string">"TEXT"</span></span>, lexer[i].lexeme); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Lexer::OPENING_BLOCK_TAG_NAME: { last_node = open_block = open_block-&gt;open(lexer[i].lexeme); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Lexer::CLOSING_BLOCK_TAG_NAME: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lexer[i].lexeme != open_block-&gt;get_name()) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-string"><span class="hljs-string">"unexpected closing tag: &lt;/"</span></span> + lexer[i].lexeme + <span class="hljs-string"><span class="hljs-string">"&gt;"</span></span>); open_block = open_block-&gt;close(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Lexer::EMPTY_TAG_NAME: { last_node = open_block-&gt;add(lexer[i].lexeme); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Lexer::COMMENT: { last_node = open_block-&gt;add(<span class="hljs-string"><span class="hljs-string">"COMMENT"</span></span>, lexer[i].lexeme); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Lexer::MACRO_TAG: { last_node = open_block-&gt;add(<span class="hljs-string"><span class="hljs-string">"MACRO"</span></span>, lexer[i].lexeme); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Lexer::ATTRIBUTE_NAME: { last_node-&gt;add_attr(lexer[i].lexeme, lexer[i].lexeme); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Lexer::UNQUOTED_ATTRIBUTE_VALUE: { last_node-&gt;set_last_attr(lexer[i].lexeme); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Lexer::SINGLE_QUOTED_ATTRIBUTE_VALUE: { last_node-&gt;set_last_attr(lexer[i].lexeme); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Lexer::DOUBLE_QUOTED_ATTRIBUTE_VALUE: { last_node-&gt;set_last_attr(lexer[i].lexeme); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Lexer::END: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (open_block-&gt;get_type() != Node::ROOT) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-string"><span class="hljs-string">"unexpected ending!"</span></span>); open_block-&gt;close(); } } } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> &amp;error) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-string"><span class="hljs-string">"parser: "</span></span> + error); } }</code> </pre><br>  That's all!  If you did everything correctly, the resulting tree can be displayed on the screen: <br><br><pre> | 
 + - &lt;ROOT&gt;
   | 
   + - &lt;! DOCTYPE&gt;
   | 
   + - &lt;html&gt;
     | 
     + - &lt;head&gt;
     |  | 
     |  + - &lt;meta&gt;
     |  | 
     |  + - &lt;meta&gt;
     |  | 
     |  + - &lt;meta&gt;
     |  | 
     |  + - &lt;meta&gt;
     |  | 
     |  + - &lt;meta&gt;
     |  | 
     |  + - &lt;meta&gt;
     |  | 
     |  + - &lt;meta&gt;
     |  | 
     |  + - &lt;meta&gt;
     |  | 
     |  + - &lt;meta&gt;
     |  | 
     |  + - &lt;title&gt;
     |  | 
     |  + - &lt;link&gt;
     |  | 
     |  + - &lt;link&gt;
     |  | 
     |  + - &lt;COMMENT&gt;
     | 
     + - &lt;body&gt;
       | 
       + - &lt;header&gt;
       |  | 
       |  + - &lt;div&gt;
       | 
       + - &lt;nav&gt;
       |  | 
       |  + - &lt;ul&gt;
       |  | 
       |  + - &lt;li&gt;
       |  |  | 
       |  |  + - &lt;a&gt;
       |  | 
       |  + - &lt;li&gt;
       |  |  | 
       |  |  + - &lt;a&gt;
       |  | 
       |  + - &lt;li&gt;
       |  | 
       |  + - &lt;a&gt;
       | 
       + - &lt;main&gt;
       |  | 
       |  + - &lt;MACRO&gt;
       | 
       + - &lt;footer&gt;
         | 
         + - &lt;hr&gt;
         | 
         + - &lt;small&gt;
</pre><br><br>  However, although the resulting tree can really be called DOM, it‚Äôs far from jQuery, Jsoup, beautifulsoup or Gumbo to a full-fledged parser, particularly because it cannot correctly process text between the &lt;style&gt; and &lt;script&gt; pair tags, and therefore the source until I quote.  But be sure to add, if habrovchane express such a desire.  Successes. <br><br>  PS Filled in the public access <a href="https://gitlab.com/2che/nyHTML">source</a> .  IMHO, damp, so I will be cutting to a full-fledged library. </div><p>Source: <a href="https://habr.com/ru/post/442964/">https://habr.com/ru/post/442964/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../442948/index.html">Fired through automation</a></li>
<li><a href="../442952/index.html">New Hackathon in Tinkoff.ru</a></li>
<li><a href="../442954/index.html">Using SQLite in Unity (Unity + SQLite)</a></li>
<li><a href="../442958/index.html">Nikita Shamgunov told The Bell about working at Microsoft and Facebook, talking with Gates and the MemSQL database</a></li>
<li><a href="../442960/index.html">Google launched "rewards for viewing ads" in applications</a></li>
<li><a href="../442968/index.html">Obtaining a CPE to maintain professional certifications (using the example of ISACA)</a></li>
<li><a href="../442974/index.html">The bill to combat fake information adopted in the third reading</a></li>
<li><a href="../442976/index.html">Situation: IT giant buys a Wi-Fi startup for $ 405 million</a></li>
<li><a href="../442978/index.html">Google revealed a zero-day vulnerability in Windows 7, which is used in conjunction with the Chrome exploit</a></li>
<li><a href="../442980/index.html">Designing PL / SQL code and generating PL / SQL documentation (pldoc), similar to JavaDoc</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>