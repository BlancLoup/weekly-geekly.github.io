<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>10 Lessons from the Quora Recommender System</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! As Retail Rocket Analytics Director, I periodically attend various industry-specific events, and in September 2016 I was fortunate enough to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>10 Lessons from the Quora Recommender System</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/tr/hm/zi/trhmzijobbezrfibv7sqcqhiphm.png"><br><br>  Hi, Habr!  As Retail Rocket Analytics Director, I periodically attend various industry-specific events, and in September 2016 I was fortunate enough to attend the RecSys conference, which was a recommendation system, in Boston.  There were a lot of interesting reports, but we decided to make a translation of one of them <a href="https://recsys.acm.org/recsys16/tutorials/">Lessons Learned from Building Real-Life Recommender Systems</a> .  It is very interesting from the perspective of how Machine Learning is used in production systems.  There are a lot of articles written about ML itself: algorithms, application practice, <a href="https://www.kaggle.com/">Kaggle</a> contests.  But the output of algorithms in production is a separate and big job.  I will tell you a secret, the development of the algorithm takes only 10% -20% of the time, and its withdrawal into battle is all 80-90%.  There are a lot of restrictions here: what data to process where (online or offline), model training time, model application time on online servers, etc.  A critical aspect is also the selection of offline / online metrics and their correlation.  At the same conference, we gave a similar report on <a href="https://recsys.acm.org/recsys16/industry-session-3/">Hypothesis Testing: How to Eliminate Ideas as Soon as Possible</a> , but chose the aforementioned training report from Quora, since  it is less specific and can be used outside of recommender systems. <br><a name="habracut"></a><br>  <i>Information about Quora:</i> <i><br><br></i>  <i>Quora is a social question-and-answer knowledge-sharing service founded in June 2009 by Adam d'Angelo and Charlie Cheever (one of the creators of the social networking site Facebook).</i>  <i>Today, the service is visited by more than 450 million people monthly.</i> <i><br></i>  <i>Quora creates a personalized tape of questions and answers, in accordance with the interests of the user.</i>  <i>Questions and answers can be likes and dislikes, users can ‚Äúfollow‚Äù other users, thus creating a kind of social network around various knowledge.</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/2q/ay/xr/2qayxrjejtb72zr0pc-hke7zppu.png"><br><br>  <a href="https://www.quora.com/profile/Xavier-Amatriain">Xavier Amatriain</a> of Quora shares 10 important lessons about recommender systems that he has shaped over the years in the recommender industry. <br><br><h2>  Introduction </h2><br>  Quora's main mission is to share and develop knowledge around the world.  Therefore, it is important for us to understand what knowledge really is.  We use the question and answer mechanism to increase the amount of knowledge, and this distinguishes us from Wikipedia‚Äôs encyclopedic approach, so there are millions of answers and thousands of topics in our service. <br><br>  If we go down a notch, we can single out three main things we care about: relevance, demand, and quality. <br><br><ul><li>  Relevance.  This is the main task of any recommendation system, it is very important that each recommendation corresponds to the interests of a particular user. </li><li>  Demand.  How many people want to know the answer to this question?  If only a few people are interested in any issue, then it may not be worth the effort on it. </li><li>  Quality.  But if we are talking about a large number of users who are interested in a particular question, then you should definitely take care of the quality of the answers in this question. </li></ul><br>  Most of the information on Quora is textual, but what is more interesting is not the work with texts, but what actions users can perform on the site. <br><br><img src="https://habrastorage.org/webt/mr/hc/ym/mrhcymxcqjlxkl80yreglkaj-8u.png"><br><br>  This diagram shows the different types of relationships that exist between different types of content, users, their responses to content, etc. <br><br>  Since Quora is a kind of social network, users can not only answer questions, but also ‚Äúfoul‚Äù each other, as well as put upvote and downvote questions and answers.  Related topics (topics) are used to categorize questions and answers. <br><br>  All of these interactions generate a tremendous amount of data that influences personal recommendations. <br><br>  Among the recommendations that we use on the site, we can distinguish the main types: <br><br><ul><li>  Ranging ribbon items on the main page </li><li>  Daily email newsletter </li><li>  Ranking answers </li><li>  Recommendations to those potentially interesting to the user. </li><li>  Recommendations of users whose answers may be interesting. </li><li>  Trends </li><li>  Automatic detection of topics of questions </li><li>  Questions related to the question being viewed </li></ul><br><br><img src="https://habrastorage.org/webt/5j/yc/u7/5jycu7aimrvnjp6kzk2wf9ysmpg.png"><br><br>  Different types of recommendations are formed by completely different algorithms based on different data types. <br><br>  Since we solve problems that are very different from each other, we have to use many different machine learning algorithms: <br><br><ul><li>  Deep Neural Networks.  Since we have a lot of text data, using deep neural networks we can get various signs from this text (feature) </li><li>  Logistic regression </li><li>  Elastic nets </li><li>  Gradient boosted decision trees </li><li>  Random forests </li><li>  Lambdamart </li><li>  Matrix Factorization </li><li>  Lda </li><li>  other </li></ul><br>  We are always looking for the best methods to solve each specific problem, and we do it not just to follow the fashion, but to get maximum efficiency. <br><br><img src="https://habrastorage.org/webt/le/g4/j3/leg4j3eguai7rbtwrhbidb1f4im.png"><br><br><h2>  Lesson 1. Implicit user feedback is almost always better than explicit. </h2><br>  Even while working at Netflix, my favorite <a href="https://media.netflix.com/en/company-blog/goodbye-stars-hello-thumbs">post</a> was that five-point ratings are useless, which is <a href="https://techcrunch.com/2009/09/22/youtube-comes-to-a-5-star-realization-its-ratings-are-useless/">confirmed by</a> Youtube.  But why is this happening? <br><br>  The main reason is that implicit data is much more ‚Äúdense‚Äù (dense), allowing you to learn much more about the users themselves.  The problem of explicit feedback is that we only receive it from those who have agreed to give it to us.  Thus, an explicit response speaks more about demonstrative public behavior than about the real reaction of the user.  Therefore, implicit feedback is more appropriate for the objective function.  It also correlates better with AB test results. <br><br>  But not in all cases the implicit response is better.  This can be well illustrated with the help of an example, when a funny picture or a loud title attracts attention, and the user inadvertently fits the cursor or even clicks on a similar block.  The activity indicators in this case will be quite high, you can get a lot of action, but this tactic is hardly correlated with long-term goals, so it is important to be able to combine implicit and explicit responses. <br><br>  In Quora, we use both implicit responses, such as page visits, clicks on questions, answers and user profiles, as well as various explicit signals: likes, dislikes, sharing, etc.  To prepare qualitative data for training a model, it is necessary to learn how to combine implicit and explicit responses. <br><br><h2>  Lesson 2. Be alert to the data on which your system is learning. </h2><br>  The second lesson relates to how you prepare your data, how it enters your recommendation system, and how the algorithm of the recommendation system will learn from it. <br><br>  Even for the trivial binary classification problem, it is not always obvious which response is considered positive and which is negative. <br><br>  In the case of Quora, you can find a lot of examples where it is very difficult to understand what is positive and what is negative.  For example, what to do with funny, but meaningless answers that have many likes?  Or what to say about the short but informative response of a famous expert?  Should I consider it positive?  Or how to regard a very long informative response that users do not read and who do not like?  There may be many such examples. <br><br>  If we talk about Netflix, then how to evaluate a movie that a user watched for five minutes and stopped?  At first glance, this suggests that the film is not very interesting, but what if the user just paused it to watch tomorrow? <br><br>  Thus, there are many hidden behavioral factors that you need to learn to understand, evaluate and take into account in the training of the recommendatory system. <br><br>  Imagine that you have a more difficult task - the ranking, where you have to put different labels.  In this case, a lot of time is spent on preparing data for training, but even more time can be spent on the separation of positive and negative examples.  This can be a rather complicated and time consuming process, but it is critical to solve the problem. <br><br><h2>  Lesson 3. Your system can only learn what you teach it. </h2><br>  The third lesson is related to the training model.  In addition to the data for learning the model, two more things are important: your objective function (for example, the probability of the user reading the answer) and the metric (for example, precision or recall).  They form what your model will be trained on. <br>  For example, we need to optimize the probability of watching a movie in the cinema and its appreciation by the user, using the history of previous views and ratings, it is worth trying the NDCG-metric as final, considering films with a rating of 4 or higher as a positive result.  This is quite a long way, but it brings really good results. <br><br>  After you have determined these three points, you can begin work, but note that there are many details and pitfalls.  If you forget to identify at least one of these aspects, the risk is great that you will set the task incorrectly and will optimize something unrelated to your real goal. <br><br>  What we do in Quora: <br><br><ul><li>  Data for learning models - implicit and explicit responses that are collected on the site </li><li>  The objective function is the value of showing the question / answer to the user and the weighted sum of all user actions that they (questions / answers) will receive.  It should correlate with the long-term goals of the company.  Accordingly, you need to solve the regression problem, i.e.  match user actions with target function </li><li>  Metrics.  Since we are talking about working with the tape of recommendations of questions and answers, and it is simply a list of elements, you need to select the appropriate ranking metric, such as the NDCG, which will make sense to solve this particular problem. </li></ul><br><br><img src="https://habrastorage.org/webt/gm/jp/ig/gmjpigajbdfq6q0hw_nzljezdes.png"><br><br><h2>  Lesson 4. Explanations may be as important as the recommendations themselves. </h2><br>  The fourth lesson is about the importance of explaining certain recommendations and their effect on perception.  Explanations make it possible to understand why what you are recommended will be interesting to you.  For example, Netflix recommends movies based on previous views.  In the case of Quora, users are recommended topics, similar questions, people who can be ‚Äúfollow‚Äù, and explanations help to understand why it will be interesting. <br><br><img src="https://habrastorage.org/webt/m0/my/qb/m0myqbdihhamfkh0bv1q4_hkcae.png"><br><br><h2>  Lesson 5. If you need to choose only one algorithm, rely on matrix factorization. </h2><br>  If you can use only one algorithm, then I would put on the matrix factorization.  I often get questions about what to do if a startup has only one engineer and you need to build a recommendation system.  My answer is matrix factorization.  The main reason is that although it can be combined with other algorithms, it gives a good result by itself. <br><br><img src="https://habrastorage.org/webt/wb/bx/ii/wbbxii_zzpueeymc11wka7xog5a.png"><br><br>  Factoring is, in a sense, learning without a teacher, because it simply reduces the dimension, as the PCA method does.  But it can also be used for teaching tasks with a teacher.  For example, you can reduce the dimension and then solve the regression problem with respect to your tagged data. <br><br>  Matrix factorization fits different data types, and different implementations can be used for different data types.  For implicit signals, you can use ALS or BPR, you can go to tensor factorization or even factorization machines. <br><br>  We in Quora wrote our library, which was called <a href="https://github.com/quora/qmf">QMF</a> .  This is a small library that implements the basic methods of matrix factorization.  It is written in C ++ and can be easily used in production. <br><br><h2>  Lesson 6. Everything is an ensemble </h2><br>  The most interesting thing lies in the ensemble of algorithms.  Suppose you started with factoring the matrices and hired a second engineer.  He gets bored, and this is a great time to try a different method of training, and then combine them into an ensemble. <br><br>  In the open competition of the Netflix Prize, the winning team used the ensemble as the last step of the model.  The Bellcor team used GBDT (Gradient boosted decision trees) to create an ensemble, and when they teamed up with the BigChaos team, they used neural networks as the last layer of the ensemble, and thus approached some kind of deep learning. <br><br>  If you have different models that do different transformations on different layers, you get unlimited possibilities of working with a neural network.  It looks almost like a homemade deep neural network.  At the same time, we are not talking about deep learning in the classical sense. <br><br>  Thanks to ensembles, you can combine various algorithms using different models, such as logical regression, or non-linear Random Forest methods, or even neural networks. <br><br>  Another interesting thing is that you transform any model in the ensemble into a feature.  Thus, we erase the border between features and models.  Interestingly, you can divide their production into different engineers, and then combine them - this leads to good scalability, as well as the possibility of use in other models. <br><br><h2>  Lesson 7. To build recommender systems it is also important to be able to build features properly. </h2><br>  To obtain optimal results, it is necessary to understand the data (domain knowledge), namely, what is behind them.  If you do not understand your mission, but simply take some kind of matrix of features that interest you, some data, twist it, optimize the target function for the matrix, then with this you can optimize not what you really need. <br><br>  In Quora, we need to rank the answers and show users the best of them.  But how to choose the "best" to create the right ranking system?  Evaluating various aspects, we deduced that a good answer should be truthful, informative (that is, give an explanation), useful for a long time, well formatted, etc. <br><br>  It's hard enough to make a neural network understand what a good answer is.  To do this, you must learn to interpret the data and build features that will be associated with those aspects that are important in order to optimize the model exactly for your purposes. <br><br>  In our case, you need to have features that are related to the quality of the text, its formatting, user reaction, etc.  Some of them are easy to make, others are quite difficult, some may need a separate ML model. <br><br>  I would express the properties of a good feature as useful, reusable, transformable, interpretable and reliable. <br><br><img src="https://habrastorage.org/webt/jq/yq/og/jqyqoggb5nmoosxxc7bzfwssm9g.png"><br><br><h2>  Lesson 8. Why is it important to be able to answer questions </h2><br>  The value of the model is not in its accuracy and correctness, but in the fact that it introduces into the product and to what extent it satisfies the expectations of product managers.  If your algorithm is at odds with their understanding, you will need to answer questions, why here the recommendations are exactly like that.  It is very important to be able to debug the recommendation model, and even better the visual debugging system. <br><br>  This allows you to check the model much faster than if it were a completely black box - in this case, finding the cause of bad recommendations is almost impossible. <br>  For example, in any question / answer from the Quora tape, we can get all the features, analyze them and understand why the model recommended a particular question or answer to each user. <br><br><img src="https://habrastorage.org/webt/cz/yw/8m/czyw8mx2i68g5at4gft-fqmgiaw.png"><br><br><h2>  Lesson 9. The data and model are good, but the right approach to performance evaluation is even better. </h2><br>  When we received the data and the model, the next question arises - the correct method of evaluating the effectiveness. <br><br>  This is a diagram that explains a certain ideal innovation process when introducing algorithms into recommender systems.  The basic idea is that there are two processes. <br><br>  The first is offline experiments, that is, the process of testing and training the model.  If the model works better on the selected metric, we consider it good and we can run the second process - online AB testing.  Is the AB test negative?  The first process starts on a new one. <br><br>  Thus, an iterative process arises that will make your work faster and better. <br><br><img src="https://habrastorage.org/webt/nb/1g/0u/nb1g0umelwrvzbqxlkjabzsldom.png"><br><br>  When evaluating test results, decisions should be based on data.  This is often easier said than done, it should be an element of your company's culture. <br><br>  You must select a common prime metric, such as for example user retention or other long-term metrics. <br><br>  The main problem is that long-term metrics are difficult to measure, so sometimes you need to use more short-term metrics.  The main thing is that they correlate with your main metric! <br><br>  In offline testing, standard metrics are usually used to measure how well your model works.  But it is critically important to find a way for these metrics to be correlated with online results. <br><br><h2>  Lesson 10. No need to use a distributed system for a recommender system. </h2><br>  The last advice would be quite contradictory - you do not need to use a distributed system to build a recommender system.  Many follow a simple path, but based on my experience working with data in different companies, most of the tasks can be freely solved on a single machine. <br><br><img src="https://habrastorage.org/webt/mr/j3/w-/mrj3w-yyzh_rrrblqechbp9her0.png"><br><br>  Everything can be calculated on one machine instead of a cluster, if you follow certain requirements: <br><br><ul><li>  data sampling </li><li>  offline computing </li><li>  efficient parallel code </li></ul><br>  If you do not care about costs, delays, speed, debugging capabilities, etc., then you can continue to do this on a distributed cluster.  You can simply ask for 200 servers, deploy your spark-cluster on them and build a recommendation system.  Quora as a startup always thinks about cost reduction, because we have to pay for everything ourselves.  We also constantly think about how complex things we create, and how easy it will be to debug. <br><br>  If we talk about the matrix factorization algorithm, the first thing that is important to understand is that all factors are not necessarily needed - very often you can get good accuracy with the help of correct sampling, the result will be as if we were working with the full amount of data.  Secondly, a lot of things can be done offline.  For example, user factors you can count online, and factors of goods offline. <br><br>  Full performance can be viewed at the <a href="https://www.youtube.com/watch%3Fv%3DVJOtr47V0eo%26t%3D3038s">link</a> . <br><br><h2>  Retail rocket </h2><br>  If you want to apply these lessons, then you are welcome to us.  We are looking for an engineer in our analytical team <a href="http://retailrocket.ru/">Retail Rocket</a> .  We are developing recommender algorithms on the Spark / Hadoop computing cluster (30+ servers, 2 Petabytes of data).  The results of our team can be seen on hundreds of e-commerce sites in Russia and abroad.  Our technological stack: Hadoop, Spark, Mongodb, Redis, Kafka.  The main programming language is Scala.  We already have processes for testing hypotheses (new algorithms) both offline and online (AB tests), and we are constantly looking for ways to improve our recommendations.  To this end, we study the scientific articles of leading researchers and test them in practice.  <a href="https://retailrocket.ru/vakansii/">Job Link</a> (ANALYTICS ENGINEER) </div><p>Source: <a href="https://habr.com/ru/post/341346/">https://habr.com/ru/post/341346/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../341334/index.html">DotNext + SpbDotNet + MskDotNet</a></li>
<li><a href="../341336/index.html">Review of the reports of the conference Mobius 2017 Moscow - leap of faith in mobile technology</a></li>
<li><a href="../341338/index.html">Bitcoin and Security Software Wallets</a></li>
<li><a href="../341340/index.html">SAP HANA Support: New Features</a></li>
<li><a href="../341344/index.html">Threat Hunting: A new fileless attack for crypto mining has been discovered.</a></li>
<li><a href="../341348/index.html">JavaScript, Node, Puppeteer: Chrome Automation and Web Scraping</a></li>
<li><a href="../341350/index.html">Typical beginner problems when working with Docker (video from the conference)</a></li>
<li><a href="../341352/index.html">FrontFest.Keynote - Blaine Cook (creator of OAuth) and Mateus Fernandez (CTO Zeit)</a></li>
<li><a href="../341354/index.html">Bayram Annakov (CEO App in the Air): How to do the right onboarding</a></li>
<li><a href="../341356/index.html">Digest: ITMO University developments in 2017</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>