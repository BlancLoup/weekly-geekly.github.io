<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Search@Mail.Ru. Part one</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="‚ÄúWe have our own search!‚Äù 
 Two years in a row I began all my presentations at conferences with this phrase, because not even all search specialists k...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Search@Mail.Ru. Part one</h1><div class="post__text post__text-html js-mediator-article"><h4>  ‚ÄúWe have our own search!‚Äù </h4><br>  Two years in a row I began all my presentations at conferences with this phrase, because not even all search specialists knew that their queries specified in the Mail.Ru search box were most likely processed not by a licensed third-party engine, but by the internal development of the company. <br><br>  Now I see that the situation has changed: many people know and accept our search engine.  However, questions or doubts still remain - well, how is it that Mail.Ru Group writes its search?  Mail.Ru Group is mail, social networks, entertainment ... What search engine can they write?  In order to dispel these doubts, I want to tell you about our search, about how we are doing it, what technologies we use, what we want to get in the end.  I hope that the proposed article will be informative and interesting;  Moreover, we are going to continue the story about our technologies in more detail, and in the following posts we will talk about machine learning, spider, antispam, etc. <a name="habracut"></a><br><br><h4>  GoGo.Ru </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The Mail.Ru search engine began to be developed in 2004 by Mikhail Kostin, the former head of the aport.ru search engine.  In 2007, the search engine was submitted under the name GoGo on the domain gogo.ru. <br><br><img src="https://habrastorage.org/storage2/c63/d29/a2e/c63d29a2e70df9e7c39fb142a6c73376.png"><br><br>  Even then, GoGo had quite interesting properties: it could limit the search to commercial and informational sites, as well as forums and blogs.  After some time, it appeared in the search for pictures and the first in runet search for video. <br><br>  Much attention in it was paid to the ranking and optimization of the execution time of search queries.  For example, the GoGo text ranking formula participated in the ROMIP contest (Russian seminar on the evaluation of information retrieval methods), where it showed the best results among all participants (see <a href="http://www.romip.ru/romip2005/09_mailru.pdf">www.romip.ru/romip2005/09_mail.ru.pdf</a> ). <br><br><h4>  From GoGo - to Go.Mail.Ru </h4><br><br>  All this time, requests that are entered on the main page of the Mail.Ru portal have been performed by a licensed search engine;  at first it was a Google engine, then Yandex.  But in 2009, the contract with Yandex ended, and it was decided to try its own search engine on January 1, 2010. <br><br>  Later we entered into a partnership with the search engine Google on the following conditions: some of the requests are processed by Google, another - by us.  But this happened only in August 2010, and for eight months, Search worked completely on its own engine. <br><br>  From the point of view of developers, this meant completely different search requirements: if before gogo.ru served hundreds of thousands of queries per day, now it needed to serve tens of millions.  The anticipated increase in load by two orders required new architectural solutions.  The most significant change was the rise of the reverse index into RAM: before it lay on the hard disk, which made it impossible to meet the required response time up to 300 milliseconds per request.  And for all the changes, the development team had only a few months; on January 1, 2010, a new search engine was supposed to work and serve the requests of Mail.Ru users. <br><br>  Such a task belongs to the ‚Äúmission impossible‚Äù class, but the developers performed a labor feat and successfully coped with it: switching to a new search engine occurred at 0:00 on January 1, 2010.  The first commit to the Search repository, correcting one of the newly discovered problems, occurred already at three o'clock on New Year's Eve.  And after that, while most of the country was on New Year's holidays, the Search team, as they say, ‚Äúkept the sky‚Äù, constantly finding and fixing a variety of bugs. <br><br>  Problems with the stability of the Search arose and were solved throughout the year, but the first three months were the most intense and demanded the maximum return from all search engine developers.  At the same time, they could finally put out the fire, probably, only by August 2010.  After this, the search finally began to live a normal life, and the developers were able to switch to more long-term tasks than correcting another critical problem.  In particular, it was possible to think about how much the current search architecture corresponds to the tasks before us. <br><br><h6>  What we had: a historical background for 2010 </h6><br><br>  In 2010, an internal presentation about the search architecture schematically showed it in the following way: <br><br><img src="https://habrastorage.org/storage2/04b/010/722/04b010722045e748e10c22c043275df9.png"><br><br><ul><li>  Spider, shakes the web.  These are 24 servers, each pumping each part of the web.  What part to obkachivat, was determined by the hash on behalf of the domain.  The spiders contained the base of the downloaded pages, and they themselves determined what to download and what not. </li><li>  Indexers, create ready-made database indexes.  There were also about 30 of them at the end of 2010.  In addition to directly indexing, they performed the analysis of incoming pages for spam, pornography, etc., selected the data of interest for the calculation, for example, links for the subsequent construction of the citation index. </li><li>  Batch-servers (about 20 pieces) that perform external data calculations, the same IC.  The calculations were very diverse: some were fast, some were slow. </li><li>  Search cluster, one hundred and fifty servers.  Took databases from indexers and directly performed user search queries. </li></ul><br><br>  In 2010, it became clear that there are quite a few architectural flaws in the organization of data storage and processing: The search quickly evolved from the state of ‚Äúseveral dozen servers‚Äù to ‚Äúseveral hundred servers‚Äù, the amount of data being processed and the requirements for their processing speed began to increase, and the old ones methods no longer satisfy the urgent requirements for the quality of work.  For example, the calculation of the citation index was made on one server and now it worked for a month.  If the server rebooted during this time or the process did not have enough memory, then you had to start all over again;  thus, the citation index at some point in time simply ceased to be updated. <br><br>  The set of source data placed in the index was calculated on different servers, under different users and delivered to the index in some unique ways for this type of data.  As a result, the developers were confused about where it comes from: several times we found out that certain factors ‚Äúfell off‚Äù from the index a month ago for some reason, and no one has noticed it so far. <br>  Developers often solved the same tasks: how to "cut" the input data in such a way that it would be possible to parallelize their computation on several disks, and then on several servers.  All solutions were somewhat similar, but somewhat different from each other, and besides, developers often repeated the same thorny path of building a distributed computing system from scratch, which clearly did not contribute to effective development. <br><br>  The big problem was the presence of two databases of documents: one for the spider, the other for the indexer.  This led to a blurring of the decision regarding the fate of the same document - for example, the analysis of spam on the indexer could decide to throw the document out of the index, and the spider would continue to download it.  Or, on the contrary, the spider could throw the document out of its base for some reason, but the command to remove the document from the index could not reach the indexer due to a technical failure, so the document remained in the index for a long time, before the next garbage collection. <br><br>  It became clear that in order to continue the development of the search, a different, new approach was needed: we lacked a unified platform for distributed task execution, a high-performance database.  It was necessary to make a choice between self-development and a ready-made solution, and, in the second case, to find an option that would suit us in terms of stability and would quickly work on our workloads. <br><br>  In the next posts I will talk about how we developed and implemented this approach, as well as how other search engines work. <br><br>  <i>Andrey Kalinin,</i> <i><br></i>  <i>Head of Mail.ru Search Developers</i> </div><p>Source: <a href="https://habr.com/ru/post/149498/">https://habr.com/ru/post/149498/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../149492/index.html">Pixar gives the Open SubDiv program to Open Source and waives patents</a></li>
<li><a href="../149493/index.html">Why explore space? 1970 letter to a nun in Africa</a></li>
<li><a href="../149494/index.html">An ordinary programmer‚Äôs view of the shell change vector and what to do next</a></li>
<li><a href="../149495/index.html">Automatic change of WPA2-password (preshared key) on a Wi-Fi router</a></li>
<li><a href="../149496/index.html">The fifth "Festival 404" will be held October 6-7, 2012 in Samara</a></li>
<li><a href="../149500/index.html">Installing Zabbix 2.0 on Ubuntu Server 11.04</a></li>
<li><a href="../149502/index.html">‚ÄúRunet today‚Äù, August 13, 2012. Experts of the issue: Alexander Amzin, Gaidar Magdanurov</a></li>
<li><a href="../149505/index.html">Overview of High Availability Architecture and SQL Database (SQL Azure)</a></li>
<li><a href="../149506/index.html">Application promotion: cross promo, ad networks and direct sales</a></li>
<li><a href="../149507/index.html">The Ministry of Communications proposes to cancel domestic roaming in Russia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>