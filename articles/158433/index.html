<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Making SQL service plans for 1C: Enterprise 8.x</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After another request to tell how to make a plan for servicing the sql-bases used by 1C: Enterprise , I decided to share the experience with everyone ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Making SQL service plans for 1C: Enterprise 8.x</h1><div class="post__text post__text-html js-mediator-article">  After another request to tell how to make a plan for servicing the sql-bases used by <nobr>1C: Enterprise</nobr> , I decided to share the experience with everyone at once. <br>  Why this is necessary - if the sql does not serve the database, then its meaning is lost altogether.  The main tool is indexes and they should be kept up to date.  I did not meet any dogmas not in practice, not in the net, not in courses in 1C itself, and therefore I share my experience. <br><br><a name="habracut"></a>  Often the base works in ‚Äúnormal‚Äù conditions.  What is meant by this: <br><ul><li>  SQL Server is well-powered, i.e.  the amount of RAM provided by the SQL server to work, choose from the calculation of 70% of the size of all mdf database files. </li><li>  The processor is not loaded more than 50% within 90% of the time. </li><li>  There is enough space on the disks (in particular, the temp.db base is used for sorting, 1C uses it in general for all of its livelihoods, so you should take care of the disk space with this base in advance). </li><li>  Database recovery mode is ‚ÄúSimple‚Äù.  (It is empirically found that a large ldf file slows down 1c-ku, and the possibility of recovery from a log file is very doubtful). </li></ul><br>  It is also worth considering a few nuances: <br><ul><li>  When using the Standard edition of SQL, if the index is completely rebuilt, all users will be disconnected from the database, therefore it is worth considering this when deciding whether to run the Weekly maintenance plan (the plan will be described below). </li><li>  It should be borne in mind that the 1C server also consumes memory, especially if thin clients or web services are used. </li><li>  SQL itself is better to limit the maximum amount of RAM in the server settings, so that when it reaches a critical mass, it would start to clear unnecessary data from RAM beforehand.  And in order to grow not to drive the entire server into a stupor. </li></ul><br>  It is rational under normal conditions to use 2 <b>Weekly</b> maintenance plans (once a week) and <b>Daily</b> (on the remaining 6 days of the week). <br><br><h4>  Weekly </h4><div class="spoiler">  <b class="spoiler_title">General form</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/9b5/b62/789/9b5b62789025d3cc9a49442ffbf96088.jpg" alt="image"></div></div><br>  By service plan items: <br><ol><li>  <b>Rebuilding index.</b>  The meaning of the task is to remove all existing indexes and install new ones.  (roughly speaking, the inventory and the arrangement of everything in order). <br>  As parameters: <br><ul><li>  The choice of the target database (this will be in almost all tasks, because I will not pay attention to this parameter further within this article). </li><li>  The object in which we select "Tables and Views." </li><li>  Free space options - if the hard disk is small, you can select the ‚Äúdefault‚Äù option, but I recommend using the ‚ÄúChange free space on page‚Äù option, the recommended value is 20%.  This will leave a stock of free pages, and will allow longer indexes to keep up to date.  ATTENTION: Increases the size of the database. </li><li>  Sort results in tempdb.  I think it is not necessary to explain, but I want to warn, at this time tempdb, will grow very much, although sorting in it is intended to speed up the process, be careful, keep a space. </li><li>  Save the index in the "online" mode - a chip available for the enterprise version of SQL.  Allows you to re-index without disconnecting clients. </li></ul>  <b>!!!</b>  <b>ATTENTION!!!</b>  In the Standard version, when reindexing, clients are disconnected from the database for the duration of this step. <div class="spoiler">  <b class="spoiler_title">Settings example</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/b75/e04/bd7/b75e04bd79823ed03c54e3f809b38df3.jpg" alt="image"></div></div></li><li>  <b>Update statistics.</b>  The task of collecting information about the status of indices in the database.  (In general, it is not very relevant after reindexing, but still I do). <br>  Options: <br><ul><li>  An object.  All the same tables and views as for rebuilding the index. </li><li>  Refresh.  Here we update all the statistics. </li><li>  View Type - Full View. </li></ul>  Thus, we update the statistics for the entire database. <div class="spoiler">  <b class="spoiler_title">Settings example</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/945/975/02c/94597502ca326beb18d7df960794c328.jpg" alt="image"></div></div></li><li>  <b>Execute T-SQL statement.</b>  This execution of an arbitrary command in the SQL language, in particular, interests us <pre><code class="sql hljs">dbcc proccache</code> </pre>  As the name implies - clearing the cache. <div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/6aa/5c8/aa1/6aa5c8aa1c208ec3ae772efa6cecacd9.jpg" alt="image"></div></div></li><li>  <b>Check the integrity of the database.</b>  There seems to be no explanation - make sure that nothing is broken.  In the parameters "include indexes" in the test, not for nothing that was rebuilt. <div class="spoiler">  <b class="spoiler_title">Settings example</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/820/9ef/eee/8209efeeebcfd8a8fdd733f77455c38d.jpg" alt="image"></div></div></li><li>  <b>Backup database.</b>  Here we need to talk more, in view of many features.  It is better to study this item separately independently in other manuals, the format of this article does not provide for an in-depth study of backup. <br>  But I want to warn about a couple of nuances: <br><ul><li>  SQL does not know how to clean its container, so if you add backups to a file (it is called ‚ÄúBackup Device‚Äù), you will eventually clog up all the free space. </li><li>  SQL remembers their backups, because by making one-time backup handles (for example, take the database to another location, or to deploy for a test to another database from the backup), the next ‚Äúdifference‚Äù will be counted from it.  In order to prevent this, you need to tick "Backup only".  There is no such item in the backup task.  In general, in the weekly plan I recommend to use the full type of backup. </li><li>  And it would be good to check the copy, let it sleep better. </li><li>  Compression, in general, can be used, but be careful, then differential should also be compressed. </li></ul><div class="spoiler">  <b class="spoiler_title">Settings example</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/638/2d6/126/6382d6126bb6f6db7f40e9bebdfe1df2.jpg" alt="image"></div></div></li><li>  <b>Clearing the log.</b> <br><ul><li>  Backup log and restore. </li><li>  SQL Server Agent Job Log </li><li>  Service plan log. </li></ul>  I clean everything.  As the name implies, cleans events in the SQL log.  I believe that events older than 4 weeks are unlikely to interest me, because if there is a problem, then report it within a month. <div class="spoiler">  <b class="spoiler_title">Settings example</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/e4d/8a3/b03/e4d8a3b03743d71c7dcaaac3a98ce196.jpg" alt="image"></div></div></li><li>  <b>Operator notification.</b>  Fad again for self-study.  But as the name implies, for reporting problems during the implementation of the plan. </li></ol>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Daily </h4><div class="spoiler">  <b class="spoiler_title">General form</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/fe0/c8b/b5a/fe0c8bb5af1ba6dba59d476783a8590c.jpg" alt="image"></div></div>  Speaking separately does not make sense.  Almost everything is similar to Weekly. <br>  The difference in the first task is ‚ÄúIndex reorganization‚Äù.  Tasks are different in that the reorganization is trying to rectify the existing indices, and does not do everything from scratch.  The greater the fragmentation, the more often it will cost to run.  But in normal conditions, once a day is enough to keep the index up to date until the next rebuilding. <div class="spoiler">  <b class="spoiler_title">Options</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/b66/af1/6ec/b66af16ec68b41703f78da816dfc31ea.jpg" alt="image"></div></div>  You can also use differential backups. <br><br>  That's all.  I repeat, I did not see dogmas in this moment, this version was developed and tested by me.  Actually for bases from 6 to 100 GB in size. <br><br>  I wish you fast and reliable work. <br>  PS Due to the fact that I am not a full-fledged DBA, perhaps my comments are very superficial, I‚Äôm happy to read the comments in the comments and the PM. <habracut text=",    "></habracut></div><p>Source: <a href="https://habr.com/ru/post/158433/">https://habr.com/ru/post/158433/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../158421/index.html">Lost Island of Good Code</a></li>
<li><a href="../158423/index.html">There is a return path from the registry: Lurkmore removed from the registry of prohibited sites</a></li>
<li><a href="../158425/index.html">Plastic Aston Martin printed on a 3D printer filmed in Skyfall</a></li>
<li><a href="../158427/index.html">H3C: Performance Switch with Half Pink</a></li>
<li><a href="../158431/index.html">Parsing pictures into text: a simple algorithm</a></li>
<li><a href="../158435/index.html">VPN? Super easy! I guarantee it</a></li>
<li><a href="../158437/index.html">Number generation in words from any arbitrary number</a></li>
<li><a href="../158439/index.html">Cocos2d-x for Android: speeding up file reading</a></li>
<li><a href="../158441/index.html">Multilingual spelling checker for programs using Hunspell</a></li>
<li><a href="../158443/index.html">Internet Optimization Techniques</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>