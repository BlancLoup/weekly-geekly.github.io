<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Useful scripts when migrating from Oracle to PostgreSQL</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="During the migration from Oracle to PostgreSQL using ora2pg, the question arose of a mismatch of data types between different databases. By default, n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Useful scripts when migrating from Oracle to PostgreSQL</h1><div class="post__text post__text-html js-mediator-article">  During the migration from Oracle to PostgreSQL using ora2pg, the question arose of a mismatch of data types between different databases.  By default, not all columns are converted correctly, and the lack of an Oracle Boolean creates ambiguity at all - some of the columns must be transferred as numbers, and some as logical values.  At the same time, hibernate knows all about data types and can create a reference schema. <br><br>  The final migration process was as follows: creating the structure of the tables via ora2pg, correcting the structure according to the reference scheme, transferring data, converting blob and Boolean, adding functions not present in PostgreSQL (nvl, nvl2, regexp_substr), creating the remaining structure ‚Äî indexes, view, and others. <br><br>  Under the cut, the sql scripts accumulated during the conversion for semi-automatic migration. <br><a name="habracut"></a><br><h2>  Training </h2><br>  As a utility for converting data, ora2pg was used.  The process of using is very well described in the <a href="https://habrahabr.ru/company/custis/blog/262605/">article</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Create a project in ora2pg, set up a project, and generate a schema. <br><br><pre><code class="bash hljs">$./export_schema.sh</code> </pre> <br>  Create the 'ora_schema' schema and tables for the file './schema/tables/table.sql' in PostgreSQL <br>  Switch Hibernate to create mode and create another reference scheme 'hb_schema'.  In the case of using the view in the project, the number of tables in different schemas will not converge.  Hibernate will generate full tables instead of view, and this should be taken into account. <br><br><h2>  Fix column types </h2><br>  We look in what columns it is necessary to make changes <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> hb.table_name <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> , hb.column_name <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">column</span></span>, hb.data_type <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> hb_type, ora.data_type <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ora_type <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> information_schema.columns hb <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> information_schema.columns ora <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> hb.table_name = ora.table_name <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> hb.column_name = ora.column_name <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> hb.table_schema = <span class="hljs-string"><span class="hljs-string">'hb_schema'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> ora.table_schema= <span class="hljs-string"><span class="hljs-string">'ora_schema'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> ora.data_type != hb.data_type <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> hb.table_name, hb.column_name;</code> </pre> <br>  Substitutions for simple cases <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-string"><span class="hljs-string">'ALTER TABLE ora_schema.'</span></span> || ora.table_name || <span class="hljs-string"><span class="hljs-string">' ALTER COLUMN '</span></span> || ora.column_name || <span class="hljs-string"><span class="hljs-string">' TYPE '</span></span> || hb.data_type || <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> hb.data_type = <span class="hljs-string"><span class="hljs-string">'numeric'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-string"><span class="hljs-string">'('</span></span>|| hb.numeric_precision ||<span class="hljs-string"><span class="hljs-string">','</span></span>|| hb.numeric_scale||<span class="hljs-string"><span class="hljs-string">')'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> || <span class="hljs-string"><span class="hljs-string">'; '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> information_schema.columns <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> hb <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> information_schema.columns <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ora <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> hb.table_name = ora.table_name <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> hb.column_name = ora.column_name <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> hb.table_schema = <span class="hljs-string"><span class="hljs-string">'hb_schema'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> ora.table_schema= <span class="hljs-string"><span class="hljs-string">'ora_schema'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> ora.data_type != hb.data_type <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (hb.data_type = <span class="hljs-string"><span class="hljs-string">'integer'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> hb.data_type = <span class="hljs-string"><span class="hljs-string">'numeric'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> hb.data_type = <span class="hljs-string"><span class="hljs-string">'bigint'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> hb.data_type = <span class="hljs-string"><span class="hljs-string">'date'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> hb.table_name, hb.column_name;</code> </pre> <br><h2>  We transfer data </h2><br>  Before transferring the data, we check that no type matches remain only in the boolean and bytea (oid) columns, and all the columns with numerical values ‚Äã‚Äãhave the correct accuracy and are not 'double precision' in order to avoid random rounding. <br><br>  By default, the copy process goes into one stream.  Change the configuration to the desired number <br><br><pre> <code class="bash hljs">JOBS 4 ORACLE_COPIES 4</code> </pre><br>  Start the process of copying data <br><br><pre> <code class="bash hljs">ora2pg -t COPY -o data.sql -b ./data -c ./config/ora2pg.conf</code> </pre> <br><h2>  We process boolean </h2><br>  They need to be removed if there is a default value, change the type and return the default value <br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--ALTER TABLE mytabe ALTER COLUMN mycolumn DROP DEFAULT; --ALTER TABLE mytabe ALTER mycolumn TYPE bool USING CASE WHEN mycolumn is null then null when mycolumn=0 THEN FALSE ELSE TRUE END; --ALTER TABLE mytabe ALTER COLUMN mycolumn SET DEFAULT FALSE; select case when ora.column_default is not null then 'ALTER TABLE ora_schema.'|| ora.table_name || ' ALTER COLUMN ' || ora.column_name || ' DROP DEFAULT; ' else '' end || 'ALTER TABLE ora_schema.'|| ora.table_name || ' ALTER ' || ora.column_name || ' TYPE bool USING CASE WHEN ' || ora.column_name ||' is null then null WHEN ' || ora.column_name ||'=0 THEN FALSE ELSE TRUE END;' || case when cast(ora.column_default as NUMERIC) = 0 then 'ALTER TABLE ora_schema.'|| ora.table_name || ' ALTER COLUMN ' || ora.column_name || ' SET DEFAULT FALSE' when cast(ora.column_default as NUMERIC) = 1 then 'ALTER TABLE ora_schema.'|| ora.table_name || ' ALTER COLUMN ' || ora.column_name || ' SET DEFAULT TRUE' else '' end from information_schema.columns as hb INNER JOIN information_schema.columns as ora on hb.table_name = ora.table_name where hb.table_schema = 'hb_schema' and ora.table_schema= 'ora_schema' and hb.column_name = ora.column_name and hb.udt_name != ora.udt_name and hb.data_type = 'boolean' ORDER BY hb.table_name, hb.column_name;</span></span></code> </pre> <br><h2>  Processed by oid (bytea) </h2><br>  Create a procedure for converting bytea to oid <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> ora_schema.bytea_to_oid(p_blob bytea) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">oid</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span> v_oid <span class="hljs-keyword"><span class="hljs-keyword">oid</span></span>; v_int integer; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">octet_length</span></span>(p_blob)=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> v_oid:=<span class="hljs-literal"><span class="hljs-literal">null</span></span>; else <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> lo_create(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> v_oid; <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> lo_open(v_oid, x<span class="hljs-string"><span class="hljs-string">'20000'</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">int</span></span> | x<span class="hljs-string"><span class="hljs-string">'40000'</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">int</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> v_int; <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> lowrite (<span class="hljs-number"><span class="hljs-number">0</span></span>, p_blob) <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> v_int; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; return v_oid; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>;$BODY$ LANGUAGE plpgsql VOLATILE COST 100; <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> ora_schema.bytea_to_oid(bytea) OWNER <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> postgres;</code> </pre> <br>  Create a temporary column. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-string"><span class="hljs-string">'ALTER TABLE ora_schema.'</span></span> || ora.table_name || <span class="hljs-string"><span class="hljs-string">' ADD COLUMN '</span></span> || hb.column_name || <span class="hljs-string"><span class="hljs-string">'_oid oid; '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> information_schema.columns <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> hb <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> information_schema.columns <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ora <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> hb.table_name = ora.table_name <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> hb.column_name = ora.column_name <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> hb.table_schema = <span class="hljs-string"><span class="hljs-string">'hb_schema'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> ora.table_schema= <span class="hljs-string"><span class="hljs-string">'ora_schema'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> hb.udt_name != ora.udt_name <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> hb.data_type = <span class="hljs-string"><span class="hljs-string">'oid'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> hb.table_name, hb.column_name;</code> </pre> <br>  We transfer data <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-string"><span class="hljs-string">'update '</span></span> || ora.table_name || <span class="hljs-string"><span class="hljs-string">' set '</span></span> || hb.column_name || <span class="hljs-string"><span class="hljs-string">'_oid = bytea_to_oid('</span></span> || hb.column_name || <span class="hljs-string"><span class="hljs-string">');'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> information_schema.columns <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> hb <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> information_schema.columns <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ora <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> hb.table_name = ora.table_name <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> hb.column_name = ora.column_name <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> hb.table_schema = <span class="hljs-string"><span class="hljs-string">'hb_schema'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> ora.table_schema= <span class="hljs-string"><span class="hljs-string">'ora_schema'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> hb.udt_name != ora.udt_name <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> hb.data_type = <span class="hljs-string"><span class="hljs-string">'oid'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> hb.table_name, hb.column_name;</code> </pre> <br>  Remove the old column <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-string"><span class="hljs-string">'ALTER TABLE ora_schema.'</span></span> || ora.table_name || <span class="hljs-string"><span class="hljs-string">' DROP COLUMN '</span></span> || hb.column_name || <span class="hljs-string"><span class="hljs-string">'; '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> information_schema.columns <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> hb <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> information_schema.columns <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ora <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> hb.table_name = ora.table_name <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> hb.column_name = ora.column_name <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> hb.table_schema = <span class="hljs-string"><span class="hljs-string">'hb_schema'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> ora.table_schema= <span class="hljs-string"><span class="hljs-string">'ora_schema'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> hb.udt_name != ora.udt_name <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> hb.data_type = <span class="hljs-string"><span class="hljs-string">'oid'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> hb.table_name, hb.column_name;</code> </pre> <br>  Rename temporary column <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-string"><span class="hljs-string">'ALTER TABLE ora_schema.'</span></span> || ora.table_name || <span class="hljs-string"><span class="hljs-string">' RENAME COLUMN '</span></span> || hb.column_name ||<span class="hljs-string"><span class="hljs-string">'_oid to '</span></span>|| hb.column_name||<span class="hljs-string"><span class="hljs-string">'; '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> information_schema.columns <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> hb <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> information_schema.columns <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ora <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> hb.table_name = ora.table_name <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> hb.column_name ||<span class="hljs-string"><span class="hljs-string">'_oid'</span></span> = ora.column_name <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> hb.table_schema = <span class="hljs-string"><span class="hljs-string">'hb_schema'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> ora.table_schema= <span class="hljs-string"><span class="hljs-string">'ora_schema'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> hb.data_type = <span class="hljs-string"><span class="hljs-string">'oid'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> hb.table_name, hb.column_name;</code> </pre> <br><h2>  Add missing functions in PostgreSQL </h2><br>  So that there is no need to rewrite the code, simply create those that are missing in PostgreSQL, but which are in Oracle and are used in the project. <br><br>  last_day (date) <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> <span class="hljs-keyword"><span class="hljs-keyword">last_day</span></span>(dt <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> <span class="hljs-built_in"><span class="hljs-built_in">date</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $$ <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">cast</span></span> (date_trunc(<span class="hljs-string"><span class="hljs-string">'month'</span></span>,dt)+<span class="hljs-built_in"><span class="hljs-built_in">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 month'</span></span> - <span class="hljs-built_in"><span class="hljs-built_in">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 day'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>) $$;</code> </pre> <br>  nvl (date, date) <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> nvl(var1 <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>, var2 <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> <span class="hljs-built_in"><span class="hljs-built_in">date</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> plpgsql <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $$ <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> var1 <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> var2 <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> var1 <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; $$;</code> </pre> <br>  nvl (integer, integer) <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> nvl(var1 <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>, var2 <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> plpgsql <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $$ <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> var1 <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> var2 <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> var1 <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; $$;</code> </pre> <br>  nvl (numeric, numeric) <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> nvl(var1 <span class="hljs-built_in"><span class="hljs-built_in">numeric</span></span>, var2 <span class="hljs-built_in"><span class="hljs-built_in">numeric</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> <span class="hljs-built_in"><span class="hljs-built_in">numeric</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> plpgsql <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $$ <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> var1 <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> var2 <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> var1 <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; $$;</code> </pre> <br>  nvl (text, text) <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> nvl(var1 <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, var2 <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> plpgsql <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $$ <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> var1 <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> var2 <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> var1 <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; $$;</code> </pre> <br>  nvl (timestamp with time zone, timestamp with time zone) <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> nvl(var1 <span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone, var2 <span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone) <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> <span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> plpgsql <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $$ <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> var1 <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> var2 <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> var1 <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; $$;</code> </pre> <br>  nvl (timestamp, timestamp) <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> nvl(var1 <span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">without</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone, var2 <span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">without</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone) <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> <span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">without</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> plpgsql <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $$ <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> var1 <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> var2 <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> var1 <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; $$;</code> </pre> <br>  nvl (varchar, varchar) <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> nvl(var1 <span class="hljs-built_in"><span class="hljs-built_in">character</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varying</span></span>, var2 <span class="hljs-built_in"><span class="hljs-built_in">character</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varying</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> <span class="hljs-built_in"><span class="hljs-built_in">character</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varying</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> plpgsql <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $$ <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> var1 <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> var2 <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> var1 <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; $$;</code> </pre> <br>  nvl2 (date, date, date) <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> nvl2(var1 <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>, var2 <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>, var3 <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> <span class="hljs-built_in"><span class="hljs-built_in">date</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> plpgsql <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $$ <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> var1 <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> var2 <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> var3 <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; $$;</code> </pre> <br>  nvl2 (integer, integer, integer) <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> nvl2(var1 <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>, var2 <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>, var3 <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> plpgsql <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $$ <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> var1 <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> var2 <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> var3 <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; $$;</code> </pre> <br>  nvl2 (numeric, numeric, numeric) <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> nvl2(var1 <span class="hljs-built_in"><span class="hljs-built_in">numeric</span></span>, var2 <span class="hljs-built_in"><span class="hljs-built_in">numeric</span></span>, var3 <span class="hljs-built_in"><span class="hljs-built_in">numeric</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> <span class="hljs-built_in"><span class="hljs-built_in">numeric</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> plpgsql <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $$ <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> var1 <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> var2 <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> var3 <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; $$;</code> </pre> <br>  nvl2 (text, text, text) <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> nvl2(var1 <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, var2 <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, var3 <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> plpgsql <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $$ <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> var1 <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> var2 <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> var3 <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; $$;</code> </pre> <br>  nvl (timestamp with time zone, timestamp with time zone) <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> nvl2(var1 <span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone, var2 <span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone, var3 <span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone) <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> <span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> plpgsql <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $$ <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> var1 <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> var2 <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> var3 <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; $$;</code> </pre> <br>  nvl2 (timestamp, timestamp, timestamp) <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> nvl2(var1 <span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">without</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone, var2 <span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">without</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone, var3 <span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">without</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone) <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> <span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">without</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> plpgsql <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $$ <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> var1 <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> var2 <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> var3 <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; $$;</code> </pre> <br>  nvl2 (varchar, varchar, varchar) <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> nvl2(var1 <span class="hljs-built_in"><span class="hljs-built_in">character</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varying</span></span>, var2 <span class="hljs-built_in"><span class="hljs-built_in">character</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varying</span></span>, var3 <span class="hljs-built_in"><span class="hljs-built_in">character</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varying</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> <span class="hljs-built_in"><span class="hljs-built_in">character</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varying</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> plpgsql <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $$ <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> var1 <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> var2 <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> var3 <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; $$;</code> </pre> <br>  regexp_substr (text, text) <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> regexp_substr(<span class="hljs-keyword"><span class="hljs-keyword">str</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, pattern <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $$ <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> (regexp_matches(<span class="hljs-keyword"><span class="hljs-keyword">str</span></span>, pattern))[<span class="hljs-number"><span class="hljs-number">1</span></span>] $$;</code> </pre> <br>  regexp_substr (varchar, varchar) <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> regexp_substr(<span class="hljs-keyword"><span class="hljs-keyword">str</span></span> <span class="hljs-built_in"><span class="hljs-built_in">character</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varying</span></span>, pattern <span class="hljs-built_in"><span class="hljs-built_in">character</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varying</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $$ <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> (regexp_matches(<span class="hljs-keyword"><span class="hljs-keyword">str</span></span>, pattern))[<span class="hljs-number"><span class="hljs-number">1</span></span>] $$;</code> </pre> <br>  trunc (date, varchar) <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> trunc(dt <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>, formatstr <span class="hljs-built_in"><span class="hljs-built_in">character</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varying</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> <span class="hljs-built_in"><span class="hljs-built_in">date</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> plpgsql <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $$ <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> date_trunc(formatstr,dt); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; $$;</code> </pre> <br>  trunc (timestamp with time zone, varchar) <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> trunc(dt <span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone, formatstr <span class="hljs-built_in"><span class="hljs-built_in">character</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varying</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> <span class="hljs-built_in"><span class="hljs-built_in">date</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> plpgsql <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $$ <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> date_trunc(formatstr,dt); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; $$;</code> </pre> <br>  trunc (timestamp, varchar) <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> trunc(dt <span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">without</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone, formatstr <span class="hljs-built_in"><span class="hljs-built_in">character</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varying</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> <span class="hljs-built_in"><span class="hljs-built_in">date</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> plpgsql <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $$ <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> date_trunc(formatstr,dt); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; $$;</code> </pre> <br><h2>  Text fields </h2><br>  In Oracle, there is no unlimited text field; Lob is used instead.  PostgreSQL has a special type - text.  To be able to use both bases, the text field annotations should be as follows. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"script"</span></span>, nullable = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Type</span></span>(type = <span class="hljs-string"><span class="hljs-string">"org.hibernate.type.MaterializedClobType"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> String scriptText;</code> </pre> <br><br>  For Postgres, we also use a self-written dialect that knows about the added functions. <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostgresDialect</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostgreSQL9Dialect</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PostgresDialect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.registerFunction(<span class="hljs-string"><span class="hljs-string">"nvl"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StandardSQLFunction(<span class="hljs-string"><span class="hljs-string">"nvl"</span></span>)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> SqlTypeDescriptor </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSqlTypeDescriptorOverride</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sqlCode)</span></span></span><span class="hljs-function"> </span></span>{ Object descriptor; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (sqlCode) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">2005</span></span>: descriptor = LongVarcharTypeDescriptor.INSTANCE; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: descriptor = <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.getSqlTypeDescriptorOverride(sqlCode); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (SqlTypeDescriptor) descriptor; } }</code> </pre> <br><br><h2>  Sequence </h2><br>  Oracle and Postgress have different syntax nextval from Sequence. <br>  Oracle <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> my_seq.nextval;</code> </pre> <br>  Postgres <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nextval</span></span>(<span class="hljs-string"><span class="hljs-string">'my_seq'</span></span>);</code> </pre> <br>  We lead to a general view.  To do this, we create functions in Postgres and Oracle and rewrite them everywhere to use this function. <br>  Oracle <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">replace</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> seq_nextval(p_sequence_name <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> l_statement <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">4000</span></span>); l_value integer; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> l_statement := <span class="hljs-string"><span class="hljs-string">'select '</span></span>||<span class="hljs-keyword"><span class="hljs-keyword">upper</span></span>(p_sequence_name)||<span class="hljs-string"><span class="hljs-string">'.nextval from dual'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">execute</span></span> <span class="hljs-keyword"><span class="hljs-keyword">immediate</span></span> l_statement <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> l_value; return l_value; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br>  Postgres <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> seq_nextval(p_sequence_name <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> <span class="hljs-built_in"><span class="hljs-built_in">bigint</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $$ <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nextval</span></span>(p_sequence_name); $$ language sql;</code> </pre> <br>  Using <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> seq_nextval(<span class="hljs-string"><span class="hljs-string">'my_seq'</span></span>)</code> </pre> <br>  Using the Postgres nextval ('my_seq') function directly will not work, because although Oracle will allow you to create this function, it will not allow you to select values. <br><h2>  Transformers.ALIAS_TO_ENTITY_MAP </h2><br>  If you use Transformers.ALIAS_TO_ENTITY_MAP, then you must specify the return types.  Oracle will default keys to uppercase, PotgresSql to lowercase, and the mismatch of keys is corrected only manually. <br><h2>  Sysdate </h2><br>  Sysdate is not in PotgresSql, and current_timestamp works in both.  Replace with him <br><h2>  substring </h2><br>  Unlike java, in databases, indices start from one and correctly specify substring ('str', 1, 2) to get the first two characters, not substring ('str', 0, 2).  But Oracle allows the second option.  It is necessary to fix and not to use the 0 index <br><br><h2>  Temporary tables </h2><br>  In PostgreSQL, unlike Oracle, temporary tables are created every time and live during a session.  In Oracle, only the contents of temporary tables live in any framework, and the tables themselves are permanently created. <br>  From this stem the following problems: <br>  1) When creating each session, you will have to create a temporary table.  (Now it can be simplified using the ability of the application server to perform the initialization sql block when creating a new session (connection pool ‚Üí advanced ‚Üí Init SQL) <br>  2) Validation of entities in hibernate is performed within the framework of the configured schema (if you do not specify a schema, validation will be performed according to all available schemas).  Since  in Postgre, temporary tables are created in separate schemas, validation will fail. <br>  (You can get around by creating a real table with the same structure. With native queries, work will be done with a temporary table, not with a regular one). <br>  3) It is possible to work with such a temporary table only through native queries, since  Hibernate adds the name of the schema to all generated queries (either all the work with temporary tables should be done through native queries, or to abandon temporary tables and use the usual one with data delimitation using a unique key. Both methods involve rewriting the functionality). <br><br>  To continue working with temporary tables in Postgress, as in Oracle, we will use table functions and create a view based on a table function.  Details <a href="https://github.com/yallie/pg_global_temp_tables">here</a> <br><br>  The function of creating temporary tables <br><div class="spoiler">  <b class="spoiler_title">create_permanent_temp_table</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">replace</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> create_permanent_temp_table( p_table_name <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>, p_schema <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> <span class="hljs-built_in"><span class="hljs-built_in">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $$ <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span> <span class="hljs-comment"><span class="hljs-comment">-- https://github.com/yallie/pg_global_temp_tables v_table_name varchar := p_table_name || '$tmp'; v_trigger_name varchar := p_table_name || '$iud'; v_final_statement text; v_table_statement text; -- create temporary table... v_all_column_list text; -- id, name, ... v_new_column_list text; -- new.id, new.name, ... v_assignment_list text; -- id = new.id, name = new.name, ... v_cols_types_list text; -- id bigint, name varchar, ... v_old_column_list text; -- id = old.id, name = old.name, ... v_old_pkey_column text; -- id = old.id begin -- check if the temporary table exists if not exists(select 1 from pg_class where relname = p_table_name and relpersistence = 't') then raise exception 'Temporary table % does not exist. %', p_table_name, 'Create an ordinary temp ' || 'table first, then use create_permanent_temp_table function to convert it to a permanent one.' using errcode = 'UTMP1'; end if; -- make sure that the schema is defined if p_schema is null or p_schema = '' then p_schema := current_schema; end if; -- generate the temporary table statement with pkey as ( select cc.conrelid, format(E', constraint %I primary key(%s)', cc.conname, string_agg(a.attname, ', ' order by array_position(cc.conkey, a.attnum))) pkey from pg_catalog.pg_constraint cc join pg_catalog.pg_class c on c.oid = cc.conrelid join pg_catalog.pg_attribute a on a.attrelid = cc.conrelid and a.attnum = any(cc.conkey) where cc.contype = 'p' group by cc.conrelid, cc.conname ) select format(E'\tcreate temporary table if not exists %I\n\t(\n%s%s\n\t)\n\ton commit drop;', v_table_name, string_agg( format(E'\t\t%I %s%s', a.attname, pg_catalog.format_type(a.atttypid, a.atttypmod), case when a.attnotnull then ' not null' else '' end ), E',\n' order by a.attnum ), (select pkey from pkey where pkey.conrelid = c.oid)) as sql into v_table_statement from pg_catalog.pg_class c join pg_catalog.pg_attribute a on a.attrelid = c.oid and a.attnum &gt; 0 join pg_catalog.pg_type t on a.atttypid = t.oid where c.relname = p_table_name and c.relpersistence = 't' group by c.oid, c.relname; -- generate the lists of columns select string_agg(a.attname, ', '), string_agg(format('new.%I', a.attname), ', '), string_agg(format('%I = new.%I', a.attname, a.attname), ', '), string_agg(format('%I %s', a.attname, pg_catalog.format_type(a.atttypid, a.atttypmod)), ', '), string_agg(format('%I = old.%I', a.attname, a.attname), ' and ') into v_all_column_list, v_new_column_list, v_assignment_list, v_cols_types_list, v_old_column_list from pg_catalog.pg_class c join pg_catalog.pg_attribute a on a.attrelid = c.oid and a.attnum &gt; 0 join pg_catalog.pg_type t on a.atttypid = t.oid where c.relname = p_table_name and c.relpersistence = 't'; -- generate the list of primary key columns select string_agg(format('%I = old.%I', a.attname, a.attname), ' and ' order by array_position(cc.conkey, a.attnum)) into v_old_pkey_column from pg_catalog.pg_constraint cc join pg_catalog.pg_class c on c.oid = cc.conrelid join pg_catalog.pg_attribute a on a.attrelid = cc.conrelid and a.attnum = any(cc.conkey) where cc.contype = 'p' and c.relname = p_table_name and c.relpersistence = 't' group by cc.conrelid, cc.conname; -- if primary key is defined, use the primary key columns if length(v_old_pkey_column) &gt; 0 then v_old_column_list := v_old_pkey_column; end if; -- generate the view function v_final_statement := format(E'-- rename the original table to avoid the conflict alter table %I rename to %I; -- the function to select from the temporary table create or replace function %I.%I() returns table(%s) as $x$ begin -- generated by pg_global_temp_tables -- create table statement %s return query select * from %I; end; $x$ language plpgsql set client_min_messages to error;\n', p_table_name, v_table_name, p_schema, p_table_name, v_cols_types_list, v_table_statement, v_table_name); -- generate the view v_final_statement := v_final_statement || format(E' create or replace view %I.%I as select * from %I.%I();\n', p_schema, p_table_name, p_schema, p_table_name); -- generate the trigger function v_final_statement := v_final_statement || format(E' create or replace function %I.%I() returns trigger as $x$ begin -- generated by pg_global_temp_tables -- create temporary table %s -- handle the trigger operation if lower(tg_op) = \'insert\' then insert into %I(%s) values (%s); return new; elsif lower(tg_op) = \'update\' then update %I set %s where %s; return new; elsif lower(tg_op) = \'delete\' then delete from %I where %s; return old; end if; end; $x$ language plpgsql set client_min_messages to error;\n', p_schema, v_trigger_name, v_table_statement, -- function header v_table_name, v_all_column_list, v_new_column_list, -- insert v_table_name, v_assignment_list, v_old_column_list, -- update v_table_name, v_old_column_list); -- delete -- generate the view trigger v_final_statement := v_final_statement || format(E' drop trigger if exists %I on %I.%I; create trigger %I instead of insert or update or delete on %I.%I for each row execute procedure %I.%I();', v_trigger_name, p_schema, p_table_name, v_trigger_name, p_schema, p_table_name, p_schema, v_trigger_name); -- create all objects at once execute v_final_statement; end; $$ language plpgsql set client_min_messages to error;</span></span></code> </pre> </div></div><br><br>  Function of deleting temporary tables <div class="spoiler">  <b class="spoiler_title">drop_permanent_temp_table</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">replace</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> drop_permanent_temp_table( p_table_name <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>, p_schema <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> <span class="hljs-built_in"><span class="hljs-built_in">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $$ <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span> <span class="hljs-comment"><span class="hljs-comment">-- https://github.com/yallie/pg_global_temp_tables v_table_name varchar := p_table_name || '$tmp'; v_trigger_name varchar := p_table_name || '$iud'; v_count int; v_drop_statements text; begin -- make sure that the schema is defined if p_schema is null or p_schema = '' then p_schema := current_schema; end if; -- check if the supporting functions exist select count(*) into v_count from pg_catalog.pg_proc p join pg_catalog.pg_namespace n on n.oid = p.pronamespace where p.proname in (p_table_name, v_trigger_name) and p.pronargs = 0 and n.nspname = p_schema and p.prosrc like '%pg_global_temp_tables%'; if v_count &lt;&gt; 2 then raise exception 'The table %.% does not seem to be persistent temporary table. %', p_schema, p_table_name, 'The function only supports tables created by pg_global_temp_tables library.' using errcode = 'UTMP2'; end if; -- generate the drop function statements v_drop_statements := format(E'-- drop the functions and cascade the view drop function %I.%I() cascade; drop function %I.%I() cascade;', p_schema, p_table_name, p_schema, v_trigger_name); -- drop the functions execute v_drop_statements; end; $$ language plpgsql set client_min_messages to error;</span></span></code> </pre> </div></div><br><br>  Using <br>  Create a regular temporary table <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> temp <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> filter_table ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, id_str <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">key</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, fd <span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span>, id_long <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>, sd <span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> filter_table_pkey PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">key</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COMMIT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PRESERVE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ROWS</span></span>;</code> </pre> <br>  We run it through the generation function: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> create_permanent_temp_table(<span class="hljs-string"><span class="hljs-string">'filter_table'</span></span>, <span class="hljs-string"><span class="hljs-string">'schema_name'</span></span>);</code> </pre> </div><p>Source: <a href="https://habr.com/ru/post/340566/">https://habr.com/ru/post/340566/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../340554/index.html">Determination of the stability of automatic control systems for industrial robots</a></li>
<li><a href="../340556/index.html">First TypeScript Demo</a></li>
<li><a href="../340558/index.html">Why do you need to stop using git rebase</a></li>
<li><a href="../340562/index.html">We need to go deeper: bypass the script that bypasses the adblock</a></li>
<li><a href="../340564/index.html">Work with videos in Full Throttle Remastered</a></li>
<li><a href="../340568/index.html">Creating a sky for 3D games</a></li>
<li><a href="../340574/index.html">NLTK parse</a></li>
<li><a href="../340576/index.html">Why IT and Business Network Factory and Cisco SD-Access</a></li>
<li><a href="../340578/index.html">Release DBMS InterSystems Cach√© 2017.2</a></li>
<li><a href="../340580/index.html">We protect the mobile application with the help of "CryptoPro": step by step instructions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>