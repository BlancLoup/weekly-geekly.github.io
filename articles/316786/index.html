<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Unifi Controller + Nginx. HTTP & HTTPS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Brief essence: 


 Step-by-step instructions on proxying a Unifi controller through Nginx via http or https. 


 Configs, clear examples, comments. 
 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Unifi Controller + Nginx. HTTP & HTTPS</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://cloud.kilograpp.com/f/8ae032b0be/?dl=1" alt="image"></p><br><h4 id="kratkaya-sut">  <strong>Brief essence:</strong> </h4><br><p>  Step-by-step instructions on proxying a Unifi controller through Nginx via http or https. </p><br><p>  Configs, clear examples, comments. </p><a name="habracut"></a><br><h4 id="prolog">  <strong>Prologue</strong> : </h4><br><p>  Our company is developing mobile applications, and as you might guess, there are a lot of different devices in the office, they all love Wi-Fi and not just Wi-Fi, but seamless so that you can walk freely along the corridor without interrupting conversations on Skype and just enjoy all the fruits of uninterrupted waffles. </p><br><p>  For these purposes, we decided to take a few <a href="https://www.ubnt.com/unifi/unifi-ap-ac-lite/">Unifi</a> plates in order to not bother with the setting and that everything worked out of the box.  On a large scale, everything was as it was for one BUT, which caused the creation of this tutorial: the dish controller can work only via https, and the normal instructions for proxying through Nginx, <a href="https://community.ubnt.com/t5/UniFi-Wireless/UniFi-Ubuntu-16-04-fully-automatic-Installation-NGINX-Proxy-amp/td-p/1596848">existing</a> to put it mildly, leaves much to be desired, as well. as well as does not provide a script to work with HTTP. </p><br><h4 id="trebuemyy-uroven-podgotovki">  <strong>Required level of training:</strong> </h4><br><p>  We assume that the basics of Nginx are known, where to put configs is understandable, and the web server itself is also deployed.  In addition, it is assumed that the dish controller is already configured.  If there are difficulties with this, then Ubiquity has an excellent instruction for <a href="https://help.ubnt.com/hc/en-us/articles/220066768-UniFi-How-to-Install-Update-via-APT-on-Debian-or-Ubuntu">Linux</a> and <a href="https://help.ubnt.com/hc/en-us/articles/205144550--Outdated-UniFi-Run-the-controller-as-a-Windows-service">Windows</a> .  But in the future we will assume that we are all hardened linuxids here. </p><br><p>  The entire configuration was tested on Unifi Controller v5.2.9, Nginx v1.10.1, Debian Jessie, Java 8 </p><br><p>  And so, let's go. </p><br><h4 id="http">  <strong>Http:</strong> </h4><br><p>  It's simple, you just need to put the config where necessary, but will require certain explanations and warnings. </p><br><p>  Anyone lazy <del>  think </del>  read, but just need to make everything work, you can copy the config and replace server_name with the appropriate one, as well as the address / port in the upstream block, if the controller is not located in the local host: </p><br><pre><code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">upstream</span></span> unifi { <span class="hljs-attribute"><span class="hljs-attribute">server</span></span> <span class="hljs-number"><span class="hljs-number">127.0.0.1:8443</span></span>; } <span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">server_name</span></span> unifi.domain.com; <span class="hljs-attribute"><span class="hljs-attribute">error_log</span></span> /var/log/unifi/nginx.log; <span class="hljs-attribute"><span class="hljs-attribute">access_log</span></span> /var/log/unifi/access.log; <span class="hljs-attribute"><span class="hljs-attribute">proxy_ssl_verify</span></span> <span class="hljs-literal"><span class="hljs-literal">off</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_ssl_session_reuse</span></span> <span class="hljs-literal"><span class="hljs-literal">on</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_ssl_protocols</span></span> TLSv1 TLSv1.<span class="hljs-number"><span class="hljs-number">1</span></span> TLSv1.<span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_cache</span></span> <span class="hljs-literal"><span class="hljs-literal">off</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_store</span></span> <span class="hljs-literal"><span class="hljs-literal">off</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">server_tokens</span></span> <span class="hljs-literal"><span class="hljs-literal">off</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> / { <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> Referer <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> Host <span class="hljs-variable"><span class="hljs-variable">$host</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> X-Real-IP <span class="hljs-variable"><span class="hljs-variable">$remote_addr</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> X-Forwarded-For <span class="hljs-variable"><span class="hljs-variable">$proxy_add_x_forwarded_for</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_pass</span></span> https://unifi; <span class="hljs-attribute"><span class="hljs-attribute">proxy_redirect</span></span> https:// http://; <span class="hljs-section"><span class="hljs-section">header_filter_by_lua_block</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">if</span></span> ngx.header[<span class="hljs-string"><span class="hljs-string">"Set-Cookie"</span></span>] then ngx.header[<span class="hljs-string"><span class="hljs-string">"Set-Cookie"</span></span>] = { string.gsub(ngx.header["Set-Cookie"][1], "(.*)Secure;(.*)", "%1%2"), string.gsub(ngx.header["Set-Cookie"][2], "(.*)Secure(.*)", "%1%2") } <span class="hljs-attribute"><span class="hljs-attribute">end</span></span> } } }</code> </pre> <br><p>  If Nginx is built from source, then you need to separately install the <a href="https://github.com/openresty/lua-nginx-module">ngx_http_lua_module</a> module. </p><br><p>  Now you can reboot Nginx: </p><br><pre> <code class="bash hljs">sudo service nginx reload</code> </pre> <br><p>  <strong>Nuances:</strong> <br>  Since the controller out of the box only supports HTTPS, then for its proxying through HTTP we will have to modify the Cookie, cut off the secure flag, and in principle disable any validation of the ssl upstream server.  Smart administrators will throw a slipper at me, saying that you can add a trusted certificate by pre-registering it to the controller, but we will not consider this case because of its excessive complexity. </p><br><p>  However, it is <strong>not recommended</strong> to keep the infrastructure stuff on HTTP.  Only if there is no certificate at all, but I want the controller to stick out beautifully. </p><br><p>  You can change the listening port and any other settings to taste. </p><br><h4 id="https-s-defoltnym-sertifikatom-kontrollera">  <strong>HTTPS with default controller certificate:</strong> </h4><br><p>  This is the lazy version of https.  The controller has its ssl certificate out of the box, but it can be replaced with any other.  And instead of meticulously tweaking it, we simply ask Nginx to agree to everything. </p><br><p>  In simple terms, all traffic comes from <del>  internet </del>  networks over HTTPS to Nginx, and from Nginx to the controller is already unprotected.  If the Unifi controller and Nginx are within a localhost or trusted network, then this is our case: </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">upstream</span></span> unifi { <span class="hljs-attribute"><span class="hljs-attribute">server</span></span> <span class="hljs-number"><span class="hljs-number">127.0.0.1:8443</span></span>; } <span class="hljs-comment"><span class="hljs-comment">#   HTTPS server { listen 80; server_name unifi.domain.com; server_tokens off; rewrite ^ https://$http_host$request_uri?; } server { listen 443 ssl; server_name unifi.domain.com; error_log /var/log/unifi/nginx.log; access_log /var/log/unifi/access.log; ssl on; ssl_certificate /etc/nginx/ssl/server.crt; ssl_certificate_key /etc/nginx/ssl/server.key; ssl_ciphers ECDH+AESGCM:ECDH+AES256:ECDH+AES128:DH+3DES:!ADH:!AECDH:!MD5; ssl_prefer_server_ciphers on; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_session_cache shared:SSL:10m; ssl_session_timeout 5m; add_header Strict-Transport-Security "max-age=31536000" always; server_tokens off; proxy_ssl_verify off; proxy_ssl_session_reuse on; proxy_ssl_protocols TLSv1 TLSv1.1 TLSv1.2; proxy_cache off; proxy_store off; location / { proxy_set_header Referer ""; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_pass https://unifi; } }</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Additional settings</b> <div class="spoiler_text"><p>  You can make a permanent redirect, replacing </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">rewrite</span></span><span class="hljs-regexp"><span class="hljs-regexp"> ^</span></span> https://<span class="hljs-variable"><span class="hljs-variable">$http_host</span></span><span class="hljs-variable"><span class="hljs-variable">$request_uri</span></span>?;</code> </pre> <br><p>  on </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">rewrite</span></span><span class="hljs-regexp"><span class="hljs-regexp"> ^</span></span> https://<span class="hljs-variable"><span class="hljs-variable">$http_host</span></span><span class="hljs-variable"><span class="hljs-variable">$request_uri</span></span>? <span class="hljs-literal"><span class="hljs-literal">permanent</span></span>;</code> </pre> <br><p>  But it is better to do this when you are convinced of the correct operation of the entire system. </p></div></div><br><p>  In this config, you need to replace the following parameters with your own: </p><br><ul><li>  Path to ssl_certificate certificate </li><li>  Path to certificate key ssl_certificate_key </li><li>  Server name of both servers (ssl and redirect) server_name </li><li>  Port and address of the upstream server if necessary </li></ul><br><p>  And do not forget to reload Nginx: </p><br><pre> <code class="bash hljs">sudo service nginx reload</code> </pre> <br><p>  You may ask: "But Maine, why are there two servers in your config, although I have one?".  I will answer: one server accepts ssl traffic, proxying it to the controller, and the other redirects to the first one if we are contacted via HTTP in order not to endanger our security holes. </p><br><p>  And now there is the sweetest, for <del>  real paranoids </del>  serious administrators. </p><br><h4 id="https-s-kastomnym-sertifikatom-kontrollera">  <strong>HTTPS with a custom controller certificate</strong> </h4><br><p>  Suppose that Nginx and the controller are no longer in a trusted network and we cannot be 100% sure that the connection between them is secure.  In this case, we will have to use the certificate issued by ssl for our domain on which the controller will be located, or generate our own. </p><br><p>  We will not describe the <a href="http://www.akadia.com/services/ssh_test_certificate.html">procedure for generating a</a> self signed certificate here, it only indirectly concerns this tutorial.  We believe that everything is ready and we are great. </p><br><p>  And so, let's make sure that we have <strong>crt</strong> and <strong>key</strong> files in our hands, we will need them to put our certificate into the Unifi controller.  We assume that they are called <strong>unifi.crt</strong> and <strong>unifi.key</strong> respectively. </p><br><p>  Now we need to generate the <strong><a href="https/ssl-keystore-java/">keystore</a></strong> file for the controller.  The following commands need to be executed in the folder with <strong>unifi.crt</strong> and <strong>unifi.key</strong> at the root.  No matter where this folder is located, we will only need the final file as a result: </p><br><pre> <code class="bash hljs">openssl pkcs12 -<span class="hljs-built_in"><span class="hljs-built_in">export</span></span> -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> unifi.crt -inkey unifi.key -out unifi.p12 keytool -importkeystore -deststorepass aircontrolenterprise -destkeypass aircontrolenterprise -destkeystore keystore -srckeystore unifi.p12 -srcstoretype PKCS12 -srcstorepass aircontrolenterprise</code> </pre> <br><p>  Now we take the <strong>keystore</strong> and move it to the <strong>data</strong> folder in the root of the controller.  The default root folder location is <strong>/ usr / lib / unifi</strong> .  The file should end up in the following path: <strong>/ usr / lib / unifi / data / keystore</strong> </p><br><p>  We will not need P12 documentation, you can delete it or leave it for memory by putting it in a frame. </p><br><p>  Now restart service Unifi: </p><br><pre> <code class="bash hljs">sudo service unifi restart</code> </pre> <br><p>  With the controller, no more manipulations will be required, now it's up to Nginx.  Our config will differ little from the previous version, except for the fact that we will no longer blindly accept any certificate.  If the self certificate is signed, then we will tell Nginx to trust it. </p><br><p>  <strong>Case for issued certificate</strong> </p><br><p>  Nginx config: </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">upstream</span></span> unifi { <span class="hljs-attribute"><span class="hljs-attribute">server</span></span> <span class="hljs-number"><span class="hljs-number">127.0.0.1:8443</span></span>; } <span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">server_name</span></span> unifi.domain.com; <span class="hljs-attribute"><span class="hljs-attribute">server_tokens</span></span> <span class="hljs-literal"><span class="hljs-literal">off</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">rewrite</span></span><span class="hljs-regexp"><span class="hljs-regexp"> ^</span></span> https://<span class="hljs-variable"><span class="hljs-variable">$http_host</span></span><span class="hljs-variable"><span class="hljs-variable">$request_uri</span></span>?; } <span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">443</span></span> ssl; <span class="hljs-attribute"><span class="hljs-attribute">server_name</span></span> unifi.domain.com; <span class="hljs-attribute"><span class="hljs-attribute">error_log</span></span> /var/log/unifi/nginx.log; <span class="hljs-attribute"><span class="hljs-attribute">access_log</span></span> /var/log/unifi/access.log; <span class="hljs-attribute"><span class="hljs-attribute">ssl</span></span> <span class="hljs-literal"><span class="hljs-literal">on</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">ssl_certificate</span></span> /etc/nginx/ssl/server.crt; <span class="hljs-attribute"><span class="hljs-attribute">ssl_certificate_key</span></span> /etc/nginx/ssl/server.key; <span class="hljs-attribute"><span class="hljs-attribute">ssl_ciphers</span></span> ECDH+AESGCM:ECDH+AES256:ECDH+AES128:DH+3DES:!ADH:!AECDH:!MD5; <span class="hljs-attribute"><span class="hljs-attribute">ssl_prefer_server_ciphers</span></span> <span class="hljs-literal"><span class="hljs-literal">on</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">ssl_protocols</span></span> TLSv1 TLSv1.<span class="hljs-number"><span class="hljs-number">1</span></span> TLSv1.<span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">ssl_session_cache</span></span> shared:SSL:<span class="hljs-number"><span class="hljs-number">10m</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">ssl_session_timeout</span></span> <span class="hljs-number"><span class="hljs-number">5m</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">add_header</span></span> Strict-Transport-Security <span class="hljs-string"><span class="hljs-string">"max-age=31536000"</span></span> always; <span class="hljs-attribute"><span class="hljs-attribute">server_tokens</span></span> <span class="hljs-literal"><span class="hljs-literal">off</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_ssl_session_reuse</span></span> <span class="hljs-literal"><span class="hljs-literal">on</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> / { <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> Referer <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> Host <span class="hljs-variable"><span class="hljs-variable">$host</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> X-Real-IP <span class="hljs-variable"><span class="hljs-variable">$remote_addr</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> X-Forwarded-For <span class="hljs-variable"><span class="hljs-variable">$proxy_add_x_forwarded_for</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_pass</span></span> https://unifi; } }</code> </pre> <br><p>  I repeat that you need to replace the following config parameters: </p><br><ul><li>  Path to ssl_certificate certificate </li><li>  Path to certificate key ssl_certificate_key </li><li>  Server name of both servers (ssl and redirect) server_name </li><li>  Port and address of the upstream server if necessary </li></ul><br><p>  <strong>Now self signed certificate:</strong> </p><br><p>  We will need two already familiar files from the previous steps: <strong>unifi.crt</strong> and <strong>unifi.key</strong> .  We did not need them for the issued certificate, since Nginx is clever and can validate them in the certification bureau.  Here we will have to specify them explicitly. </p><br><p>  Nginx config: </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">upstream</span></span> unifi { <span class="hljs-attribute"><span class="hljs-attribute">server</span></span> <span class="hljs-number"><span class="hljs-number">127.0.0.1:8443</span></span>; } <span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">server_name</span></span> unifi.domain.com; <span class="hljs-attribute"><span class="hljs-attribute">server_tokens</span></span> <span class="hljs-literal"><span class="hljs-literal">off</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">rewrite</span></span><span class="hljs-regexp"><span class="hljs-regexp"> ^</span></span> https://<span class="hljs-variable"><span class="hljs-variable">$http_host</span></span><span class="hljs-variable"><span class="hljs-variable">$request_uri</span></span>?; } <span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">443</span></span> ssl; <span class="hljs-attribute"><span class="hljs-attribute">server_name</span></span> unifi.domain.com; <span class="hljs-attribute"><span class="hljs-attribute">error_log</span></span> /var/log/unifi/nginx.log; <span class="hljs-attribute"><span class="hljs-attribute">access_log</span></span> /var/log/unifi/access.log; <span class="hljs-attribute"><span class="hljs-attribute">ssl</span></span> <span class="hljs-literal"><span class="hljs-literal">on</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">ssl_certificate</span></span> /etc/nginx/ssl/server.crt; <span class="hljs-attribute"><span class="hljs-attribute">ssl_certificate_key</span></span> /etc/nginx/ssl/server.key; <span class="hljs-attribute"><span class="hljs-attribute">ssl_ciphers</span></span> ECDH+AESGCM:ECDH+AES256:ECDH+AES128:DH+3DES:!ADH:!AECDH:!MD5; <span class="hljs-attribute"><span class="hljs-attribute">ssl_prefer_server_ciphers</span></span> <span class="hljs-literal"><span class="hljs-literal">on</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">ssl_protocols</span></span> TLSv1 TLSv1.<span class="hljs-number"><span class="hljs-number">1</span></span> TLSv1.<span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">ssl_session_cache</span></span> shared:SSL:<span class="hljs-number"><span class="hljs-number">10m</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">ssl_session_timeout</span></span> <span class="hljs-number"><span class="hljs-number">5m</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">add_header</span></span> Strict-Transport-Security <span class="hljs-string"><span class="hljs-string">"max-age=31536000"</span></span> always; <span class="hljs-attribute"><span class="hljs-attribute">server_tokens</span></span> <span class="hljs-literal"><span class="hljs-literal">off</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_ssl_verify</span></span> <span class="hljs-literal"><span class="hljs-literal">on</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_ssl_certificate</span></span> /etc/nginx/ssl/unifi.crt; <span class="hljs-attribute"><span class="hljs-attribute">proxy_ssl_certificate_key</span></span> /etc/nginx/ssl/unifi.key; <span class="hljs-attribute"><span class="hljs-attribute">proxy_ssl_trusted_certificate</span></span> /etc/nginx/ssl/unifi.crt; <span class="hljs-attribute"><span class="hljs-attribute">proxy_ssl_protocols</span></span> TLSv1 TLSv1.<span class="hljs-number"><span class="hljs-number">1</span></span> TLSv1.<span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_ssl_session_reuse</span></span> <span class="hljs-literal"><span class="hljs-literal">on</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> / { <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> Referer <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> Host <span class="hljs-variable"><span class="hljs-variable">$host</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> X-Real-IP <span class="hljs-variable"><span class="hljs-variable">$remote_addr</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> X-Forwarded-For <span class="hljs-variable"><span class="hljs-variable">$proxy_add_x_forwarded_for</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_pass</span></span> https://unifi; } }</code> </pre> <br><p>  As above, we do not forget to replace the config parameters with our own: </p><br><ul><li>  Path to ssl_certificate certificate </li><li>  Path to certificate key ssl_certificate_key </li><li>  Server name of both servers (ssl and redirect) server_name </li><li>  Port and address of the upstream server if necessary <br>  <strong>And</strong> </li><li>  The path to <strong>unifi.crt</strong> and <strong>unifi.key</strong> files (you can put them anywhere. I would recommend to make a separate folder in the root of Nginx so that nothing is lost) </li></ul><br><p>  Now you can reboot Nginx: </p><br><pre> <code class="bash hljs">sudo service nginx reload</code> </pre> <br><hr><br><p>  That's all, we have achieved the desired.  Our controller is now available at the specified address. </p><br><div class="spoiler">  <b class="spoiler_title">Picture with the result</b> <div class="spoiler_text"><p><img src="https://cloud.kilograpp.com/f/9f897ef3d9/?dl=1&amp;t=" alt="image"></p></div></div><br><p>  I will be glad to answer any questions and accept feedback. </p><br><p>  <strong>PS</strong> After reading the comments, I want to thank all the respondents, it is nice to read your feedback. <br>  I will make a mini-faq of the most popular questions: </p><br><p>  <strong>1.</strong> Why Nginx, but not% software_name%? <br>  Answer: The company used Nginx, it was necessary to solve the problem through it. </p><br><p>  <strong>2.</strong> How is the article related to Unifi?  This is% common_techonology_name%! <br>  Answer: The goal was to write a narrow tutorial specifically for Unifi + Nginx, since not everyone who has difficulty with its configuration can clearly formulate the technology stack they need. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/316786/">https://habr.com/ru/post/316786/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../316772/index.html">November digest of product design: Profstandard, algorithmic design, Adobe XD and technical proficiency</a></li>
<li><a href="../316776/index.html">I spent 3 months trying to get a job after a programming camp, and this is what I learned</a></li>
<li><a href="../316778/index.html">Creating and testing a firewall in Linux, Part 2.3. Finish the firewall. We process traffic in userspace</a></li>
<li><a href="../316782/index.html">Fuel cells as one of the sources of energy for the data center</a></li>
<li><a href="../316784/index.html">Psychology of persuasion. How to convince others and be able to recognize the manipulation</a></li>
<li><a href="../316788/index.html">Own platform. Part 0.2 Theory. CHIP8 interpreter</a></li>
<li><a href="../316790/index.html">URL rewriting on github pages</a></li>
<li><a href="../316792/index.html">Networks for the harshest. Micro issue ‚Ññ7. EVPN</a></li>
<li><a href="../316794/index.html">The digest of interesting materials for the mobile developer # 182 (November 28-December 4)</a></li>
<li><a href="../316800/index.html">Diary of performances from Minsk DevGAMM 2016</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>