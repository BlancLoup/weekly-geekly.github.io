<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Attackers use a Linux / Remaiten bot to compromise embedded devices, part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the first part of our research, we looked at several features of the Linux / Remaiten malware, namely, the internal structure of the bot loader, it...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Attackers use a Linux / Remaiten bot to compromise embedded devices, part 2</h1><div class="post__text post__text-html js-mediator-article">  In the first part of our research, we <a href="https://habrahabr.ru/company/eset/blog/280544/">looked at</a> several features of the Linux / Remaiten malware, namely, the internal structure of the bot loader, its interaction with the C &amp; C server manager, the command bot processes, and the telnet scanner to search for other potential victims.  We also noted the presence of malware components for microprocessor architectures MIPS and ARM.  In addition, we were surprised to find a hint of the presence of bots for such platforms Power PC and SuperH. <br><br><img src="https://habrastorage.org/files/e87/48b/a39/e8748ba3920b4818b19613a967eef3b3.jpeg"><br><br>  In the second part, we will focus in more detail on the process of malware infection of other devices, as well as another interesting feature that allows Linux / Remaiten to complete the processes of other bots and programs on Linux. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>  <b>Infection of other devices</b> <br><br>  The first step in this process is to search for a writable directory.  The bot contains a list of popular paths to such directories, their list is shown below in the screenshot. <br><br><img src="https://habrastorage.org/files/534/10f/500/53410f5000544372850eea32a8f13d58.png"><br>  Fig.  19. List of directories on the victim's device where the bootloader can be copied. <br><br>  After this, the bot, for unknown reasons, creates executable files called ‚Äú <i>.t</i> ‚Äù, ‚Äúretrieve‚Äù and ‚Äú <i>binary</i> ‚Äù.  The <i>retrieve</i> file will contain the loader itself, and the <i>binary is</i> requested by the bot from the C &amp; C server manager.  The ‚Äú <i>.t</i> ‚Äù file is not used by malware. <br><br><img src="https://habrastorage.org/files/6de/d2d/162/6ded2d1628a3416f81bc3b8e63646df7.png"><br>  Fig.  20. The tenth case specializes in preparing the transfer of the payload to the device and its execution. <br><br>  The malware uses a strange way to create empty executable files: it copies a standard executable file called <i>busybox</i> , which is present in most embedded devices, and then deletes all the contents from it with the " <i>&gt; file</i> " command.  The loader is transmitted to the device via telnet with a simple echo command, with each byte of the executable file being encoded using the ‚ÄúxHH‚Äù escape sequence.  We observed a similar spreading technique in another malware called <a href="http://download.esetnod32.ru/company/virlab/analytics/2015-06-05-linux_moose_analysis.pdf">Linux / Moose</a> . <br><br><img src="https://habrastorage.org/files/8ca/5fa/403/8ca5fa403f7f4cdc9a4b9db94a11957d.png"><br>  Fig.  21. The code from the 11th case, which specializes in the transfer of the payload using the echo command. <br><br>  <b>Execution bootloader and IRC bot</b> <br><br>  After the bootloader has been copied onto the victim's device, it tries to load the payload of the malware onto it.  The loader requests the bot's executable file from the C &amp; C server manager and writes it to the <i>stdout</i> stream.  At the beginning of its launch, the loader redirects the stdout stream to a file called ‚Äú <i>binary</i> ‚Äù.  Finally, the file ‚Äú <i>binary</i> ‚Äù is launched for execution and the IRC bot becomes active. <br><br><img src="https://habrastorage.org/files/393/ed0/cf7/393ed0cf731e407890dbd447a28bd6fd.png"><br>  Fig.  22. The code from the 13th case, which specializes in launching the execution of the loader and the bot. <br><br>  <b>Sending status to the managing C &amp; C server</b> <br><br>  The last step for the bot is informing the C &amp; C server about the success of infecting another device.  In both cases, i.e., both in the case of a successful infection, and no, the bot also sends a login / password pair to the server, which was used to access the telnet account.  It is possible that operators will try to infect the device manually if the automatic method of the malicious program used cannot cope with this. <br><br><img src="https://habrastorage.org/files/3ef/a6f/6c5/3efa6f6c534f40ec921992b7209a2d53.png"><br>  Fig.  23. 14th case code that specializes in informing the C &amp; C server about the infection status of another device. <br><br>  <b>Shut down other bots</b> <br><br>  Another interesting bot command is the <i>KILLBOTS</i> team.  In the case of its receipt, the malware retrieves the list of running processes and searches for those that need to be completed.  The search is based on several criteria, the main one being the search by name. <br><br><img src="https://habrastorage.org/files/434/b67/23c/434b6723cd1d46caaa94c2ada8980105.png"><br>  Fig.  24. List of process names to complete. <br><br><img src="https://habrastorage.org/files/e8c/f2b/fd6/e8cf2bfd656740169d6cf886e61c7a4f.png"><br>  Fig.  25. List of processes that the bot ignores. <br><br>  The Linux / Remaiten malware specializes in terminating only those processes that were launched from the interactive shell (shell) / dev / tty.  It also sends the name of the completed process to the C &amp; C server.  Perhaps such an operation is carried out to improve the white and black lists of the processes of the malicious program. <br><br><img src="https://habrastorage.org/files/994/3cf/f03/9943cff0384241a6b644875a7b24e162.png"><br>  Fig.  26. A bot sends a message to the server, and then kills the process itself using the kill API function. <br><br>  <b>Bot evolution</b> <br><br>  There are insignificant changes between different versions of the bot, for example, the composition of the white and black lists of processes to complete is different, the directories used by the loader to copy the bot‚Äôs body etc. are different. It is logical to assume that these and other similar changes are present in each new build of the malware in the same version of the malware.  The bootloader is not subject to change, except for changing the list of hard-wired IP addresses and port numbers. <br><br>  However, in version 2.2 of the malware, the authors made a significant change.  It consists of using <i>wget / tftp</i> commands to load a shell script, which, in turn, specializes in booting the bot.  A similar scheme is used by the Gafgyt malware.  In the case when these two commands do not perform their work correctly, it loads the loader itself onto the device. <br><br><img src="https://habrastorage.org/files/511/fb0/7e5/511fb07e5aef4ec187f833e264f113c2.png"><br>  Fig.  27. The malicious program informs its C &amp; C server about the deployment of the bot using the tools <i>wget / tftp</i> . <br><br>  The command line script is distributed through another server, which is also used for the <i>Gafgyt malware</i> . <br><br><img src="https://habrastorage.org/files/0d6/dc2/196/0d6dc2196fda46a796a8a9fda2580202.png"><br>  Fig.  28. Command shell script that is distributed through another server. <br><br>  The <i>batch</i> file <i>al.sh</i> indicates the presence of intruders for microprocessors of <i>PowerPC</i> and <i>SuperH</i> architects.  Prior to the Remaiten malware, we did not observe the use of bots by attackers for such architectures. <br><br><img src="https://habrastorage.org/files/1f1/666/5b7/1f16665b7f88459fb0ca5078553bfbec.png"><br>  Fig.  29. Attackers supported architecture. <br><br><img src="https://habrastorage.org/files/535/54c/63c/53554c63c4624019ad0fb625cfc3f19a.png"><br>  Fig.  30. The beginning of the script file. <br><br>  The managing C &amp; C server used in version 2.0 of the malware uses a strange welcome message.  It contains a link to a well-known malware blog called <i>MalwareMustDie</i> . <br><br><img src="https://habrastorage.org/files/8a1/9b7/d79/8a19b7d79f4f403385da2c03623bf683.png"><br>  Fig.  31. The welcome message for bot version 2.0 contains a link to the MalwareMustDie blog. <br><br>  We assume that this is an attempt to discredit the <i>MalwareMustDie</i> team in the eyes of the users, <i>since</i> they placed a sufficient amount of material that Gafgyt and Tsunami expose. <br><br>  <b>Compromise Indicators (IoC)</b> <br><br>  Bot version 2.0 <br><br><img src="https://habrastorage.org/files/992/649/fb6/992649fb6a2a4aa1a6d7d7c6f0b0f768.png"><br><br>  Bot version 2.1 <br><br><img src="https://habrastorage.org/files/694/20b/1a7/69420b1a7561406495961d0514447a03.png"><br><br>  Bot version 2.2 <br><br><img src="https://habrastorage.org/files/74f/233/1c0/74f2331c0e94441ba785afab28c33ba7.png"><br><br><img src="https://habrastorage.org/files/261/efb/a45/261efba4591d4bcfa99a28068a62d7b1.png"><br><br>  Bootloader Version 2.0 <br><br><img src="https://habrastorage.org/files/7bc/cc7/9a0/7bccc79a08ce49739160adb4033fa95f.png"><br><br>  Bootloader version 2.1 <br><br><img src="https://habrastorage.org/files/edd/ba9/b39/eddba9b398344f68953c762565faac4c.png"><br><br>  Boot Loader Version 2.2 <br><br><img src="https://habrastorage.org/files/ae8/5f6/e9a/ae85f6e9aa4d4aaebfdafc82c8e1507f.png"><br><br>  C &amp; C version 2.0 <br><br>  Bot: 185.130.104.131:443 <br>  Loader: 185.130.104.131:25566 <br><br>  C &amp; C version 2.1 <br><br>  Bot: 185.130.5.201:53 <br>  Downloads: 185.130.5.201:25566 <br><br>  C &amp; C version 2.2 <br><br>  Bot: 185.130.5.202: 23 <br>  Loader: 185.130.5.202:443 </div><p>Source: <a href="https://habr.com/ru/post/280672/">https://habr.com/ru/post/280672/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../280660/index.html">Traditional April 1 on the Internet</a></li>
<li><a href="../280662/index.html">CLRium # 3: .NET Technology Workshop</a></li>
<li><a href="../280664/index.html">8 harmful tips to "accelerate" the site</a></li>
<li><a href="../280666/index.html">NetApp ONTAP and NAS Antivirus Protection</a></li>
<li><a href="../280668/index.html">A little bit about sockets, redis and broken eggs</a></li>
<li><a href="../280674/index.html">Quad-tree live visualization on Shader Model 2.0</a></li>
<li><a href="../280676/index.html">Unbelievable combinations of the Internet and real professions</a></li>
<li><a href="../280678/index.html">Mobile OCR. How it all began</a></li>
<li><a href="../280682/index.html">We can not pay so much money to PPA members</a></li>
<li><a href="../280684/index.html">We invite you to the spring UX-conference of the Russian School of Service Design on April 16</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>