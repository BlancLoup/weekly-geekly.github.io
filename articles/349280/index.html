<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Room: One to many</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. In the courtyard of 2018 and for almost a year now Google has been actively working on Architecture Components . Good documentation and example...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Room: One to many</h1><div class="post__text post__text-html js-mediator-article">  Hello.  In the courtyard of 2018 and for almost a year now Google has been actively working on <a href="https://developer.android.com/topic/libraries/architecture/release-notes.html">Architecture Components</a> .  <a href="https://developer.android.com/topic/libraries/architecture/index.html">Good documentation</a> and <a href="https://github.com/googlesamples/android-architecture-components">examples</a> allow you to start using new components without any problems and difficulties.  But there is always a fly in the ointment of the code <s>honey</s> .  The notes below do not claim to be true, but they may save two to three hours of googling and viewing the code of libraries. <br><a name="habracut"></a><br><h3>  One to many </h3><br>  Everything is simple: the documentation tells you how to organize classes in order to get a one-to-many connection of entities.  Take 2 entities: <br><br><pre><code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DialogPojo</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@NonNull</span></span> <span class="hljs-meta"><span class="hljs-meta">@PrimaryKey</span></span> String id; <span class="hljs-comment"><span class="hljs-comment">//other fields } @Entity( foreignKeys = @ForeignKey(entity = DialogPojo.class, parentColumns = "id", childColumns = "dialogId", onDelete = ForeignKey.CASCADE), primaryKeys = {"dialogId", "tag"}) public class TagPojo { @NonNull String dialogId; @NonNull String tag; //other fields }</span></span></code> </pre> <br>  and link them into a single entity: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DialogWithTags</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Embedded</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DialogPojo dialog; <span class="hljs-meta"><span class="hljs-meta">@Relation</span></span>(parentColumn = <span class="hljs-string"><span class="hljs-string">"id"</span></span>, entity = TagPojo.class, entityColumn = <span class="hljs-string"><span class="hljs-string">"dialogId"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;TagPojo&gt; tags; <span class="hljs-comment"><span class="hljs-comment">//other fields }</span></span></code> </pre><br>  To get a new DialogWithTags entity, you need to use Dao, which will load data from the DialogPojo table, and tags from the associated table (entity = TagPojo.class) will be automatically loaded: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Dao</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DialogDao</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Query</span></span>(<span class="hljs-string"><span class="hljs-string">"SELECT * FROM DialogPojo WHERE id = :dialogId"</span></span>) <span class="hljs-function"><span class="hljs-function">LiveData&lt;DialogWithTags&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadDialogBy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String dialogId)</span></span></span></span>; <span class="hljs-meta"><span class="hljs-meta">@Query</span></span>(<span class="hljs-string"><span class="hljs-string">"SELECT * FROM DialogPojo WHERE id = :dialogId"</span></span>) <span class="hljs-function"><span class="hljs-function">DialogWithTags </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDialogBy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String dialogId)</span></span></span></span>; }</code> </pre><br>  Using this knowledge you can already collect the <s>death star</s> app.  However, in the course of work there may be questions, the answers to which are better known at the preparatory stages. <br><br><h4>  Integrity </h4><br>  Strange as it may seem, a request to receive DialogWithTags does not guarantee data integrity.  That is, it is possible that DialogPojo is already loaded, but the TagPojo list is not.  A warning about possible problems appears at the compilation of the program.  <s>And who reads these warnings?</s>  To ensure data integrity, you must add the Transaction annotation to the request. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Dao</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DialogDao</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Transaction</span></span> <span class="hljs-meta"><span class="hljs-meta">@Query</span></span>(<span class="hljs-string"><span class="hljs-string">"SELECT * FROM DialogPojo WHERE id = :dialogId"</span></span>) <span class="hljs-function"><span class="hljs-function">LiveData&lt;DialogWithTags&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadDialogBy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String dialogId)</span></span></span></span>; <span class="hljs-meta"><span class="hljs-meta">@Transaction</span></span> <span class="hljs-meta"><span class="hljs-meta">@Query</span></span>(<span class="hljs-string"><span class="hljs-string">"SELECT * FROM DialogPojo WHERE id = :dialogId"</span></span>) <span class="hljs-function"><span class="hljs-function">DialogWithTags </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDialogBy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String dialogId)</span></span></span></span>; }</code> </pre><br><h4>  Preservation </h4><br>  Unfortunately, to save the model DialogWithTags just will not work.  You need to save the data separately and, preferably, in a single transaction, for example: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Dao</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DialogDao</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Transaction</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">insert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DialogWithTags dialogWithTags)</span></span></span><span class="hljs-function"> </span></span>{ insert(dialogWithTags.dialog); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(TagPojo tag: dialogWithTags.tags) { insert(tag); } } <span class="hljs-meta"><span class="hljs-meta">@Insert</span></span>(onConflict = OnConflictStrategy.IGNORE) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">insert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DialogPojo dialog)</span></span></span></span>; <span class="hljs-meta"><span class="hljs-meta">@Insert</span></span>(onConflict = OnConflictStrategy.IGNORE) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">insert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(TagPojo tag)</span></span></span></span>; .... }</code> </pre><br><h4>  Live data </h4><br>  The biggest disappointment awaits when using LiveData.  Data will only be live for the embedded dialog fields.  Changes to tags will not be tracked.  Of course, you can declare the tags field as LiveData, but do not forget that LiveData will only return data if at least one observer is registered. <br><br><h4>  Conclusion </h4><br>  Like any framework, Architecture Components solves a number of tasks, relieves developers of boilerplate code <s>and makes life more beautiful</s> , but also adds its own problems.  In my case, the framework has successfully penetrated the project and feels great there. </div><p>Source: <a href="https://habr.com/ru/post/349280/">https://habr.com/ru/post/349280/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../349268/index.html">Issue # 11: IT training - current issues and challenges from leading companies</a></li>
<li><a href="../349270/index.html">Student Insider: Keyhole News</a></li>
<li><a href="../349272/index.html">Basic security practices for iOS applications</a></li>
<li><a href="../349274/index.html">"Calendar tester" for February. Know your customer</a></li>
<li><a href="../349276/index.html">Creating a game on Lua and L√ñVE - 1</a></li>
<li><a href="../349282/index.html">Hamster Marketplace development team: how our outsourcer became a partner and why AI is to blame</a></li>
<li><a href="../349284/index.html">Sign symbol: iOS denial of service</a></li>
<li><a href="../349286/index.html">How to buy 1C</a></li>
<li><a href="../349288/index.html">RoboCon 2018: Robot Framework First Conference Report</a></li>
<li><a href="../349290/index.html">Introduction to graph APIs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>