<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to understand that your site has been hacked?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Currently, hacking sites are becoming a massive, staged process. Sites can be hacked for the sake of using their capacities (currently popular mining,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to understand that your site has been hacked?</h1><div class="post__text post__text-html js-mediator-article">  Currently, hacking sites are becoming a massive, staged process.  Sites can be hacked for the sake of using their capacities (currently popular mining, participation in a botnet, etc.).  Also, attackers may be interested in stealing the contents of your resource or promoting their own content (advertising, phishing).  In any case, the attackers will try to squeeze the most out of a successful hack, that is, go unnoticed as long as possible, extracting as much benefit from the hacked site. <br><br><img src="https://habrastorage.org/webt/s_/fg/g5/s_fgg5ph0kjfakjr0oqm5tdq7vq.jpeg"><br><a name="habracut"></a><br>  There are obvious signs of hacking: a lot of ads flash on the pages that you didn‚Äôt post, the pages look different, you can‚Äôt log into the administrator‚Äôs office, Google and Yandex report that your site is malicious and IP appeared in spam databases. <br><br>  But it is often impossible to immediately find out that the site is hacked, it is impossible - there are no obvious deviations from normal work.  So what signs might indicate that your site has been hacked? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  So where to look? </h3><br>  First of all, pay attention to changes in server performance and traffic to your site.  If the pages load slower and the traffic is different from what you usually had, it‚Äôs time to bother. <br><br><h3>  We adjust logs </h3><br>  A very important point in the detection of hacking are server logs.  Therefore, you should make sure that logging is configured correctly.  Then, in which case, you will have all the necessary information about the events that occurred. <br><br>  Consider the possible setting of logs.  In the examples below, Linux is used as the OS, and nginx is used as the server. <br><br>  Configuring logrotate for nginx is not particularly difficult.  It is enough to create the file /etc/logrotate.d/nginx, containing the following code: <br><br><pre><code class="markdown hljs">/opt/nginx/logs/*.log { daily #    missingok #      rotate 30 #  30  compress #     delaycompress #       notifempty #     create 640 user users # create <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name"></span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name"></span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name"></span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>. #     log-. #    ,       ,     log- postrotate #  nginx [ ! -f /var/run/nginx.pid ] || kill -USR1 <span class="hljs-code"><span class="hljs-code">`cat /var/run/nginx.pid`</span></span> endscript }</code> </pre> <br>  If possible, it is better to add automatic copying of logs to the corporate cloud or to another server, so that an attacker, if he decides to clean the logs, would not deprive you of them forever. <br><br><h3>  We look inside </h3><br>  So you have logs.  Now it's worth checking server access logs for suspicious activity.  Have many requests come from the same IP?  Many requests from different IP, but the requests themselves and the intervals between them are similar?  All this is another additional reason to check whether someone has already intercepted access to the site. <br><br>  Similar checking can be done through parsing access logs with awk.  Here are a few awk commands to help analyze access logs for nginx: <br><br>  ‚Ä¢ IP addresses sorted by the number of requests: <br><br> <code>awk '{print $1}' access.log | sort | uniq -c | sort -rn</code> <br> <br>  ‚Ä¢ 10 last unique queries sorted by quantity: <br><br> <code>awk '{print $7}' access.log | sort | uniq -c | sort -rn | tail -n 10</code> <br> <br>  ‚Ä¢ Unique IP addresses sorted by the number of requests to the / administrator / page (you can substitute any one of your interest here - for example, one of those that you received using the previous command): <br><br> <code>awk '($7 ~ /administrator/)' access.log | awk '{print $1}' | sort | uniq -c | sort -rn</code> <br> <br>  ‚Ä¢ IP addresses and pages to which access was requested, sorted by the number of attempts <br><br> <code>awk '{print $1, $7}' access.log | sort | uniq -c | sort ‚Äìr</code> <br> <br>  ‚Ä¢ To monitor abnormal activity, tracking of suspicious user agents can also help.  For example, it is simply written ‚ÄúGoogle‚Äù, a very old version of ‚ÄúInternet Explorer‚Äù is indicated, or the browser is listed as a short ‚ÄúMozilla‚Äù, instead of a full line indicating the version and platform.  The command below will display all unique user agents sorted by the number of hits with their use: <br><br> <code>awk -F'"' '{print $6}' access.log | sort | uniq -c | sort -rn</code> <br> <br><h3>  We follow the "tracks" </h3><br>  Also, if you notice that the logs have increased dramatically in volume or in the access log many times refer to pages that you did not have - another reason to be wary.  Such a change in traffic may be due to various reasons.  One of them may be due to the fact that your site has become slower to load (which will be discussed later), but not all cases are so trivial.  Today, there is malware that will simply redirect users to sites that an attacker needs, and it may not affect authorized users, which will help to hide the fact of hacking longer. <br><br>  The most common malware often leaves behind other ‚Äútraces‚Äù.  New users appear in the admin panel, which no one has added there (most often with strange names), scripts and files appear on the server, which are taken from where it is not clear, and the mailbox may contain suspicious emails.  It is also worth checking whether the planned tasks are new and unknown to you. <br><br><h3>  We look after our property </h3><br>  And to make it easy to track if anyone has changed your files, you should add a simple script to cron to check it: <br><br><pre> <code class="hljs pgsql">#!/bin/bash find ./ -iname <span class="hljs-string"><span class="hljs-string">'*.php'</span></span> -cmin <span class="hljs-number"><span class="hljs-number">-1</span></span> &gt; ./files.txt [ -s ./files.txt ] &amp;&amp; echo "Subject: static files changed!" | sendmail -v <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>@mail.com &lt; ./files.txt</code> </pre> <br>  ./ - current folder (you must specify the desired one) <br>  '* .php' - any file with the .php extension (if you have Python scripts, then put the .py extension, and so on) <br>  -1 - time interval indication.  It should be set depending on how often you want to check if someone has tried to change your code.  In this example, set to one minute. <br><br>  If any files have been changed, the names of these files will be written to the files.txt file and sent to the mail.  Instead of the sendmail utility, you can use any that you like more (for example, Postfix). <br><br><h3>  Controlling "gluttony" </h3><br>  If you notice that the site began to load more slowly, although you did not add anything, this is also a reason to check what the resources are going for.  It will help a lot, of course, if you have history / logs regarding performance.  This way you can see if there was a sudden increase in the load on the site, although you didn‚Äôt add any updates or new elements.  If the performance is higher than you expect, then it is worth considering whether you have been hacked. <br><br>  For monitoring performance, it is very convenient to use the sysstat utility. <br><br>  Configuring persistent logging is done by adding the following lines to the /etc/cron.d/sysstat file: <br><br><pre> <code class="hljs ruby">*<span class="hljs-regexp"><span class="hljs-regexp">/15 * * * * root /usr</span></span><span class="hljs-regexp"><span class="hljs-regexp">/lib/sysstat</span></span><span class="hljs-regexp"><span class="hljs-regexp">/sa1 1 1 55 23 * * * root /usr</span></span><span class="hljs-regexp"><span class="hljs-regexp">/local/lib</span></span><span class="hljs-regexp"><span class="hljs-regexp">/sa/sa</span></span>2 -A</code> </pre> <br>  The first line indicates that once every 15 minutes system data will be collected.  They will be stored in / var / log / sysstat / saDD, where DD is the current date.  The second line, that at 23:55 will be created a full report for the past day.  It will lie in / var / log / sysstat / sarDD <br>  You can view the data for the CPU with the following command: <br><br><pre> <code class="hljs pgsql">sar -P <span class="hljs-keyword"><span class="hljs-keyword">ALL</span></span> -f /var/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/sysstat/saDD</code> </pre> <br>  Memory usage data: <br><br><pre> <code class="hljs swift">sar -r -f /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/log/sysstat/saDD</code> </pre> <br>  A complete list of keys for withdrawal can be found <a href="http://sebastien.godard.pagesperso-orange.fr/man_sar.html">on the official website</a> . <br><br><h3>  Did I link to you? </h3><br>  It is also worth checking out all outgoing links from your site (for example, using <a href="http://www.seoreviewtools.com/internal-link-analyzer/">this service</a> or other similar ones) - have new ones appeared?  Those that you did not add?  In addition, it would be good to check what is displayed in the search engines regarding your site and for what phrases visitors get to you.  Just in case, look at how your site works for different platforms / countries / browsers - malware can only work for a specific category of users, this is done in order to go unnoticed. <br><br><h3>  so </h3><br>  It is necessary to check the above signs and places at least once a week, in order not to let the situation down if the site has been hacked.  Tracking new software updates and important security updates along with scheduling backups and periodically changing passwords should generally be part of standard periodic procedures. <br><br>  About what to do when you have already been hacked, we will talk in one of the following articles. </div><p>Source: <a href="https://habr.com/ru/post/355004/">https://habr.com/ru/post/355004/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../354992/index.html">Web application security: fighting with oneself, or drawing the line of adequacy</a></li>
<li><a href="../354996/index.html">Product Design Digest April 2018</a></li>
<li><a href="../354998/index.html">GitLab 10.7 released: Web IDE in open access and SAST reports for Go and C / C ++</a></li>
<li><a href="../355000/index.html">Startups, chat bots, Silicon Valley. Interviews with Russian developers in San Francisco</a></li>
<li><a href="../355002/index.html">Bought tickets for miles Aeroflot. Could not fly. How to return money / miles?</a></li>
<li><a href="../355006/index.html">RIPE distributed the last block / 22 of the last block / 8. What's next?</a></li>
<li><a href="../355008/index.html">May 19, welcome to Badoo Techleads Meetup # 3</a></li>
<li><a href="../355010/index.html">Check Point Dashboards - that's what I love</a></li>
<li><a href="../355014/index.html">Telegram bot development for Instagram</a></li>
<li><a href="../355016/index.html">Common mistakes made by developers in the UX</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>