<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SSH instead of VPN</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Surely, many system administrators were faced with a situation where the number of remote users in the company became more than one so much that the t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SSH instead of VPN</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/611/7e7/bf0/6117e7bf0a60441ba2f6ba83f28a651c.jpg" alt="image"><br><br>  Surely, many system administrators were faced with a situation where the number of remote users in the company became <s>more than one</s> so much that the thoughts of a normal VPN instead of nat didn‚Äôt give peace in a hurry and became an obsession.  And I am sure everyone frowned when he understood that the users had to explain what to press and where.  And in my personal case there is also a position regarding the wards: ‚Äúthey should not even think about how it works.‚Äù <br><a name="habracut"></a><br>  At first there were not many.  Only a couple of people walked rdp to their desktop from home and I was in no hurry to implement the solution, but when the 1C server moved from the head office to my network and a whole army of accountants and other figures appeared, the hair on my head began to move from the prospect of flooding the firewall rules with strings type dst-nat. <br><br>  For some reason, an alternative to my solution, I only saw a VPN (in one form or another), which meant that I would need to write instructions to create a connection on the user's computer.  From here, the prospect of answering questions like: ‚Äúwhat did I do wrong?‚Äù, Because on every version of Windows this is not done in exactly the same way.  Plus, it would be necessary to explain how to connect to the right computer - again, to create these labels and all that.  And by the way, a person could go <s>to the village to visit his grandfather</s> somewhere where setting up someone else‚Äôs computer is not welcome.  Therefore, it seemed to me that just as I had planned, it would be most convenient. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The very idea of ‚Äã‚Äãwhat and how to do was born a long time ago and, in principle, everything was clear. <br>  The task is simple: connect the user to the desktop on a working computer (or any other) in one click.  Those.  The user connects the flash drive on which there is a certain exe.  Runs this exe, enters the password and voila - it is on the working computer. <br><br><blockquote>  <i>Some lyrics, if you will.</i> <i><br><br></i>  <i>I am sure everyone watched a great movie "Mind Games".</i>  <i>Remember the phrase of the doctor in the clinic: "What could be worse for a schizophrenic than to realize that he is schizophrenic?"</i> <i><br><br></i>  <i>Projecting onto myself I can paraphrase: ‚ÄúWhat could be worse for a programmer than to realize that he is a system administrator?‚Äù.</i>  <i>This is me to the fact that for more than 10 years of adminstva I have grown stupid.</i>  <i>What I would have written in a couple of days would have done a week now and I‚Äôm sure that I could have done better.</i> </blockquote><br>  By and large, nothing complicated.  We take source libssh2, openssl and zlib and we fasten them to our project.  It is the source or static libraries because we don‚Äôt want us to have more than one file at the output.  If you have to put another dll solution next to the exe, it will lose its ‚Äúelegance‚Äù. <br><br>  The program creates ssh-tunnel to the remote computer and listens on the local address ala localhost.  It starts mstsc and connects to localhost (actually with the remote computer). <br><br>  I had to suffer with openssl.  I haven't seen such scanty documentation yet.  Examples from the wiki on the project site work, but do not explain anything.  The description of the functions comes down to their purpose.  Yes, and to spit, because libssh is going, but I need to store the connection settings in the exe file, read in clear text, and these are passwords and keys.  For this, having played a little with various options of functions, I still encrypted the data and put it at the end of the exe. <br><br>  In fact, it turned out to be an analogue of plink from putty, but with the ability to clone itself while preserving the connection parameters and executing some command on the user's computer.  For example: <br><br><pre><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">rlink</span></span> --saddr=example.host.com --sport=<span class="hljs-number"><span class="hljs-number">2222</span></span> --lport=<span class="hljs-number"><span class="hljs-number">1234</span></span> --raddr=pc.localdomain --rport=<span class="hljs-number"><span class="hljs-number">3389</span></span> --user=andrey --cmd=<span class="hljs-string"><span class="hljs-string">"mstsc /v:localhost:1234"</span></span></code> </pre> <br>  With this set of arguments, the program will create a localhost: 1234 ‚Üí pc.localdomain: 3389 tunnel and start the rdp client and wait for it to complete.  Since the argument --pass is omitted here, the password will be requested interactively. <br><br><img src="https://habrastorage.org/files/97d/792/bc9/97d792bc916a499f88379dbbcdc88667.jpg" alt="image"><br><br>  You can add the -a key, then the output will be a ready-made exe with the name rlink- <u>username</u> .exe and ready to run without entering any arguments on the command line. <br><br><img src="https://hsto.org/files/b10/151/630/b10151630d8d473195336410ac4cda79.jpg" alt="image"><br><br>  By default, keys for encrypting settings are generated automatically, but you can set a secret word using the - key and encrypt based on it.  Then when you start the program, the first thing you will be asked for a password to decrypt the arguments. <br><br><img src="https://habrastorage.org/files/7fa/ce1/5ee/7face15ee6ea4d2f8b45f3a5befcbb16.jpg" alt="image"><br><br>  Of course, in order for all this to work, there remains one more small detail: create a user on the ssh server.  But that's another story.  And you can still write a script to bring to the automatics the creation of a user and the generation of a ready-made exe for him, which I will do in the near future. <br><br>  Feel the program <a href="https://sourceforge.net/projects/rlink/">here</a> . <br><br>  Sorry for the confusion and thank you for your attention. </div><p>Source: <a href="https://habr.com/ru/post/319158/">https://habr.com/ru/post/319158/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../319148/index.html">What to do if the cables have ears, or a steganographic proxy</a></li>
<li><a href="../319150/index.html">Non-standard XMPP protocol support with Smack</a></li>
<li><a href="../319152/index.html">Script for removing old drivers</a></li>
<li><a href="../319154/index.html">nanoCAD Plus 8.1: what does the user expect in the new version of the Russian CAD system?</a></li>
<li><a href="../319156/index.html">Webpack in Visual Studio for large solutions</a></li>
<li><a href="../319160/index.html">Intuitive design against viral</a></li>
<li><a href="../319162/index.html">JavaScript trends that are worth paying attention to in 2017</a></li>
<li><a href="../319164/index.html">Python: collections, part 1/4: classification, general approaches and methods, conversion</a></li>
<li><a href="../319168/index.html">Arithmetic average: physical meaning and visualization</a></li>
<li><a href="../319170/index.html">Moving with Tarantool 1.5 to 1.6</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>