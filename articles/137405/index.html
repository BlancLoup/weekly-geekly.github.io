<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Serialization of static objects in C #</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Context 

 I met this question while working on one of the projects, in which there are a lot of settings. Since the addition of new settings took pla...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Serialization of static objects in C #</h1><div class="post__text post__text-html js-mediator-article">  <b>Context</b> <br><br>  I met this question while working on one of the projects, in which there are a lot of settings.  Since the addition of new settings took place in the course of development, the need to make a class that can be accessed from any program module emerged.  For this, of course, a static class was used, and we called it AppSettings.  Of course, you could use Properties.Settings ... I will not go into details, but this option did not fit. <br><br>  <b>The essence of the problem</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Because the class is static, normal serialization does not work.  Let's check.  Suppose we have a simple static class: <br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TestStatic</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Fields... private static int _Counter; public static int Counter { get { return _Counter; } set { _Counter = value; } } }</span></span></code> </pre> <br><br>  In general, if the class were not static, the System.Xml.Serialization.XmlSerializer could be used.  This is not our case - the class is static and in this case, because the XmlSerializer.Serialize method requires an instance of the class, and not the type of the class, the compiler will give 'Test1.TestStatic' is a 'type' but is used like a ' variable '. <br><a name="habracut"></a><br>  <b>Decision</b> <br><br>  Googling a bit, did not find anything intelligible.  The only thing I saw was how to classify a class that has static fields.  In the brain spinning only Reflection.  Well, after some experiments, I did the following class: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SerializeStatic</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Type static_class, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> filename</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { FieldInfo[] fields = static_class.GetFields(BindingFlags.Static | BindingFlags.NonPublic); <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[,] a = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[fields.Length, <span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (FieldInfo field <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> fields) { a[i, <span class="hljs-number"><span class="hljs-number">0</span></span>] = field.Name; a[i, <span class="hljs-number"><span class="hljs-number">1</span></span>] = field.GetValue(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); i++; }; Stream f = File.Open(filename, FileMode.Create); SoapFormatter formatter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SoapFormatter(); formatter.Serialize(f, a); f.Close(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Type static_class, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> filename</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { FieldInfo[] fields = static_class.GetFields(BindingFlags.Static | BindingFlags.NonPublic); <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[,] a; Stream f = File.Open(filename, FileMode.Open); SoapFormatter formatter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SoapFormatter(); a = formatter.Deserialize(f) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[,]; f.Close(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (a.GetLength(<span class="hljs-number"><span class="hljs-number">0</span></span>) != fields.Length) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (FieldInfo field <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> fields) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (field.Name == (a[i, <span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (a[i, <span class="hljs-number"><span class="hljs-number">1</span></span>] != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) field.SetValue(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, a[i, <span class="hljs-number"><span class="hljs-number">1</span></span>]); } i++; }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } } }</code> </pre><br><br>  The point is simple: <br><ol><li>  We receive static fields: <br>  FieldInfo [] fields = static_class.GetFields (BindingFlags.Static | BindingFlags.NonPublic); <br></li><li>  Create a matrix and drive the field name and value into it <br></li><li>  Well and then through SoapFormater we write to the file. <br></li></ol><br><br>  Loading from file is also performed.  The only thing that in my opinion is worth noting: If in our class there is another class in one of the fields, then in this case it will suffice to designate the second class as [Serializable].  That is, if we have such an ad in TestStati: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> BrowserSettings OperaSettings { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _OperaSettings; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { _OperaSettings = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } }</code> </pre><br>  Then the BrowserSettings class will look something like this: <br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Serializable</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">BrowserSettings</span></span> { <span class="hljs-comment"><span class="hljs-comment">//... }</span></span></code> </pre><br><br>  <b>How to use</b> <br><br>  To save use: <br><pre> <code class="cs hljs">SerializeStatic.Save(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(TestStatic), <span class="hljs-string"><span class="hljs-string">"file.xml"</span></span>);</code> </pre><br><br>  For loading: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!SerializeStatic.Load(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(AppSettings), <span class="hljs-string"><span class="hljs-string">"file.xml"</span></span>)) ;</code> </pre></div><p>Source: <a href="https://habr.com/ru/post/137405/">https://habr.com/ru/post/137405/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../137400/index.html">The twelfth Moscow habrakstrecha</a></li>
<li><a href="../137401/index.html">Opened repository with games for Ubuntu 10.04, 10.10, 11.04, 11.10</a></li>
<li><a href="../137402/index.html">Ways to obtain information from the customer</a></li>
<li><a href="../137403/index.html">Windows 7 and Music Player Daemon</a></li>
<li><a href="../137404/index.html">Bootstrap 2.0 - HTML + CSS + JS UI Framework</a></li>
<li><a href="../137407/index.html">ECM-educational program, part 1: electronic document flow and electronic archive</a></li>
<li><a href="../137408/index.html">A couple of git tricks</a></li>
<li><a href="../137409/index.html">SAPER on the fields of CAD</a></li>
<li><a href="../137410/index.html">How do you usually unpack the archive through the context menu</a></li>
<li><a href="../137411/index.html">Without knowing the ford, do not go into the water. Part two</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>