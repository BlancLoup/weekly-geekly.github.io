<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Installing and running Asterisk on an Android smartphone</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, Habr! 
 It took me quickly to assemble a stand to demonstrate the work of an aster in a small organization. It was necessary to make several ca...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Installing and running Asterisk on an Android smartphone</h1><div class="post__text post__text-html js-mediator-article"><h5>  Hello, Habr! </h5><img align="right" src="https://habrastorage.org/files/861/ef6/118/861ef611854d40c7b296b79fc01f8729.png"><br>  It took me quickly to assemble a stand to demonstrate the work of an aster in a small organization.  It was necessary to make several calls, demonstrate transfer, call pickup, etc.  Sam VoIP server posted on your smartphone.  Why on a smartphone, how and for what purpose - under the cut. <br><br><a name="habracut"></a><br><br><h5>  1. Why? </h5><br>  I work in a company that is engaged in setting up telephony for small and not-so companies in the city and region.  In most cases, Asterisk is the most optimal PBX option, as it is easy to configure, scale to the needs of the organization, and you can add functionality with your own scripts.  There is a gentleman's kit to demonstrate the work of the PBX - an old MacBook with Linux on board and a tuned aster, a Gigaset SIP handset, a SPA8000 gateway, a SIP trunk to our PBX for external calls. <br>  It so happened that the cat knocked over a glass of juice on a laptop.  I ordered a keyboard on aliexpress, but when replacing I accidentally broke the cable.  While I save money for a new topcase and a train - you need to make a stand - in the morning talks.  On a new laptop, there is no space for a virtual machine, there is no need to install Linux - it's a pity a working system.  I decided - it is worth trying on a smartphone, at the same time assess its capabilities by hardware. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  2. Installation </h5><br>  We have - Sony Xperia M Dual, the latest build of Cyanogenmod with 4.4.4, MicroSD for 32GB 10 class.  The method should work for most smartphones with root rights and (preferably) custom firmware. <br>  There is a great <a href="https://play.google.com/store/apps/details%3Fid%3Dru.meefik.linuxdeploy%26hl%3Dru">Linux Deploy</a> utility on Google Play.  It allows you to install one or more different Linux distributions on your smartphone and run them in a chroot environment.  I will not describe the linux installation process, there is a very visual video with pleasant music on the program page on Google Play, but just in case I will duplicate it here. <br><br><div class="spoiler">  <b class="spoiler_title">Install GNU / Linux on Android via Linux Deploy.</b> <div class="spoiler_text"><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/j4Rlu7zi1Fc%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700191,15700253&amp;usg=ALkJrhjwZ3CCik8Tb1jMxFxihFVbNTja6A" frameborder="0" allowfullscreen=""></iframe><br></div></div><br><br>  We install the system according to the instructions on the video, I did also, only chose Debian Wheezy.  Click the Start button in the Linux Deploy window, the system is installed and running. <br>  Then we can connect our favorite SSH client to the ip-address of our smartphone, and get into the Linux environment.  The default password for the user is <b>changeme</b> , in root via <b>sudo -s</b> .  For installed Debian (Ubuntu), upgrade the system and install the necessary packages: <br><br><pre><code class="bash hljs">aptitude update aptitude upgrade aptitude install mc tmux htop asterisk</code> </pre> <br><br>  3. Customization <br><br>  After installation, configuration files will be created in the / etc / asterisk / directory.  For a minimal VoIP server setup, you need to change them.  Examples of settings under the spoilers: <br><br><div class="spoiler">  <b class="spoiler_title">sip.conf</b> <div class="spoiler_text"><pre> <code class="bash hljs">; Main [general] context=incoming_calls allowguest=no ;match_auth_username=yes ; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> available, match user entry using the allowoverlap=no ; Enable RFC3578 overlap dialing support. udpbindaddr=0.0.0.0 transport=udp srvlookup=yes ; Enable DNS SRV lookups on outbound calls ;pedantic=yes ; Enable checking of tags <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> headers, disallow=all ; First disallow all codecs allow=ulaw ; Allow codecs <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> order of preference language=ru ; Default language setting <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> all users/peers relaxdtmf=yes ; Relax dtmf handling useragent=Asterisk PBX ; Allows you to change the user agent string dtmfmode = rfc2833 ; Set default dtmfmode <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> sending DTMF. Default: rfc2833 videosupport=yes ; Turn on support <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> SIP video. You need to turn this alwaysauthreject = yes ; When an incoming INVITE or REGISTER is to be rejected, autocreatepeer=no ; Allow any UAC not explicitly defined to register rtptimeout=60 ; Terminate call <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> 60 seconds of no RTP or RTCP activity recordhistory=yes ; Record SIP <span class="hljs-built_in"><span class="hljs-built_in">history</span></span> by default dumphistory=yes ; Dump SIP <span class="hljs-built_in"><span class="hljs-built_in">history</span></span> at end of SIP dialogue t38pt_udptl = yes,redundancy,maxdatagram=300 faxdetect = no ; Default <span class="hljs-string"><span class="hljs-string">'no'</span></span>, <span class="hljs-string"><span class="hljs-string">'yes'</span></span> enables both CNG and T.38 detection nat=no jbenable = yes ; Enables the use of a jitterbuffer on the receiving side of a canreinvite=no rfc2833compensate=yes limitonpeers = yes externrefresh=60 disallow=all allow=ulaw,alaw qualify=yes echocancel=yes echocancelwhenbridged=yes register =&gt; 4732453344-101:veryStrongSecret@server.prov.ru ; Provider [ext_template](!) disallow=all allow=ulaw,alaw description=fakeExampleProvider ;) <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=peer context=incoming_calls nat=force_rport,comedia host=server.prov.ru fromdomain=server.prov.ru insecure=port,invite [trunk](ext_template) fromuser=4732453344-101 defaultuser=4732453344-101 authname=4732453344-101 secret=veryStrongSecret ; GSM ;Templates [global_template](!) <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=friend qualify=yes host=dynamic nat=no notifyringing=yes call-limit=1 limitonpeers=yes insecure=port,invite secret=pass callgroup=1 pickupgroup=1 context=outgoing_calls ;SIP users [101](global_template) [102](global_template) [103](global_template) [104](global_template) [105](global_template)</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">extensions.conf</b> <div class="spoiler_text"><pre> <code class="bash hljs">[default] exten =&gt; _X.,1,Hangup() [globals] [features] exten =&gt; <span class="hljs-comment"><span class="hljs-comment">##,1,Pickup() [incoming_calls] ;from-trunk exten =&gt; s,1,NoOp(${CALLERID(num)}) same =&gt; n,Answer() same =&gt; n,Queue(main,tr) same =&gt; n,Hangup() [outgoing_calls] exten =&gt; _[23]XXXXXX,1,NoOp(${CALLERID(num)}) same =&gt; n,Dial(SIP/trunk/${EXTEN},,tTr) same =&gt; n,Hangup() exten =&gt; _8XXXXXXXXXX,1,NoOp(${CALLERID(num)}) same =&gt; n,Dial(SIP/trunk/${EXTEN},,tTr) same =&gt; n,Hangup() exten =&gt; _810XXXXXXXXXXXX,1,NoOp(${CALLERID(num)}) same =&gt; n,Dial(SIP/trunk/${EXTEN},,tTr) same =&gt; n,Hangup() include =&gt; internal_calls [internal_calls] exten =&gt; _10[12345],1,Dial(SIP/${EXTEN},,tTr) same =&gt; n,Hangup()</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">queues.conf</b> <div class="spoiler_text"><pre> <code class="bash hljs">[general] persistentmembers = yes autofill = yes monitor-type = MixMonitor updatecdr = yes ;musicclass = default strategy = rrmemory context = incoming_calls timeout = 20 retry = 1 weight=0 wrapuptime=1 autofill=yes maxlen = 0 announce-frequency = 0 relative-periodic-announce=no announce-holdtime = no announce-position = no monitor-format = wav ringinuse = no [main] strategy = rrmemory ringinuse=no member =&gt; SIP/101 member =&gt; SIP/102 member =&gt; SIP/103 member =&gt; SIP/104 member =&gt; SIP/105</code> </pre><br></div></div><br><br>  When the configuration is written, we start the service and go to the CLI: <br><pre> <code class="bash hljs">asterisk &amp;&amp; asterisk -vvvvr</code> </pre><br>  When you start the service from init.d, the mod_han_sip module does not load, writes the error <code>chan_sip.c:28816 reload_config: Unable to create SIP socket: Permission denied</code> .  From the root it starts normally, it will come off for the demonstration. <br><br>  All is ready.  I connected an FXS gateway and two softphones to our PBX.  On my device (Xperia M Dual) the load on the processor in 4 active channels is about 10%, it does not stutter, there are no lags.  You can call internal 101-105 each other, and communicate with the outside world via a trunk from the provider. <br><br>  4. Application possibilities: <br>  a) demonstration of the work of Asterisk PBX <br>  b) portable geek PBX =) <br>  c) for home use (they are installed on routers with openwrt, you can do it on a smartphone) <br>  d) just for fun <br><div class="spoiler">  <b class="spoiler_title">Screenshot</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/049/16f/560/04916f5608a04e08ac45bd9abcbdd803.png"><br></div></div><br>  Ask questions in the comments and drugs, not only within the article.  Whenever possible I can prompt and help on setting up. <br>  Thanks for attention. <br><br><div class="spoiler">  <b class="spoiler_title">For the first comment</b> <div class="spoiler_text">  Corrected "I do" on "I work in a company that deals with", thanks to <a href="https://habrahabr.ru/users/shadowalone/" class="user_link">shadowalone</a> , at first I simply did not attach any importance, I apologize.  But still, my financial problems are my own business, aren't you?  ;) <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/239419/">https://habr.com/ru/post/239419/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../239407/index.html">Based on the ‚Äúthree interviews about static analyzers,‚Äù or the fourth interview</a></li>
<li><a href="../239409/index.html">Why snowkit</a></li>
<li><a href="../239411/index.html">Protecting HTTP traffic with Citrix Netscaler</a></li>
<li><a href="../239413/index.html">"Smart money" from Microsoft and FRIA for startups</a></li>
<li><a href="../239415/index.html">Jump start on October 7th. Modernizing the company's IT infrastructure using Windows Server 2012 R2</a></li>
<li><a href="../239421/index.html">NemerleWeb - Unique Web Framework</a></li>
<li><a href="../239423/index.html">Chrome who stole christmas</a></li>
<li><a href="../239429/index.html">Another non-discovery of life on Mars?</a></li>
<li><a href="../239431/index.html">Reflections on design principles</a></li>
<li><a href="../239433/index.html">Apache Cordova adds support for Windows 8.1 and Windows Phone 8.1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>