<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Spark - A stunning web microframe for Java</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Small introduction 
 Spark is just a wonderful microframe for building web applications on Java effortlessly. Spark strives for simplicity and provide...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Spark - A stunning web microframe for Java</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a1f/a42/4ee/a1fa424eebeb375cc033b2ee5b1bc6e0.png" alt="image" width="500"></div><br><h3>  Small introduction </h3><br>  <b>Spark</b> is just a wonderful microframe for building web applications on Java effortlessly.  Spark strives for simplicity and provides only a minimal set of functions.  However, it provides everything you need to create a web application that fits in a few lines of code.  With the syntax inspired by Sinatra, the code looks very clean. <a name="habracut"></a><br><br>  Let's start with the ubiquitous helloworld. <br><br>  Create a new project and import Spark.  Personally, I use maven to manage dependencies. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Add to pom.xml. <br><br><pre><code class="java hljs">&lt;dependency&gt;    &lt;groupId&gt;com.sparkjava&lt;/groupId&gt;    &lt;artifactId&gt;spark-core&lt;/artifactId&gt;    &lt;version&gt;<span class="hljs-number"><span class="hljs-number">2.6</span></span>.0&lt;/version&gt; &lt;/dependency&gt;</code> </pre> <br>  Now let's proceed directly to the Hello World. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> spark.Spark.*; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Main</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{       get(<span class="hljs-string"><span class="hljs-string">"/hello"</span></span>, (req, res) -&gt; <span class="hljs-string"><span class="hljs-string">"Hello, World!"</span></span>);   } }</code> </pre> <br>  That's all.  Everything is so simple! <br><br>  Now spark listens for GET requests for / hello.  Whenever we go to <a href="http://localhost/">localhost</a> : 4567 / hello, the <i>handle ()</i> method is called.  Inside it, we return the object to be sent to the client (in this case, ‚ÄúHello World‚Äù). <br><br>  My personal opinion is that this code is so concise that it does not even require explanations. <br><br>  Stop stop.  What about starting / stopping the server? <br><br><ol><li>  <b>Stop</b> - just call the <i>stop ()</i> method. <br></li><li>  <b>Run</b> - and here everything is interesting.  The server automatically starts when you do something that requires starting the server (I know what sounds really strange).  But you can start it manually by calling the <i>init ()</i> method. <br></li></ol><br><h3>  Template engine support </h3><br>  I would like to touch upon such a topic as template engines.  Spark has a lot of native support of these.  Namely: <br><br><ul><li>  Velocity </li><li>  Freemarker </li><li>  Mustache </li><li>  Handlebars </li><li>  Jade </li><li>  Thymeleaf </li><li>  Pebble </li><li>  Water </li><li>  jTwig </li><li>  Jinjava </li><li>  Jetbrick </li></ul><br>  For all of them there are "wrappers" from Spark.  For example, let's take a look at my favorite Freemarker. <br><br>  First, let's import the add.  addiction. <br><br><pre> <code class="java hljs"> &lt;dependency&gt; &lt;groupId&gt;com.sparkjava&lt;/groupId&gt; &lt;artifactId&gt;spark-template-freemarker&lt;/artifactId&gt; &lt;version&gt;<span class="hljs-number"><span class="hljs-number">2.5</span></span>.5&lt;/version&gt; &lt;/dependency&gt;</code> </pre> <br>  Create a template "hello.ftl" in the <i>src / main / resources</i> directory. <br><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>Hello, ${name}!<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Now you need to configure the freemarker so that it searches for templates in the resources.  This is just 4 lines of code. <br><br><pre> <code class="java hljs">FreeMarkerEngine freeMarkerEngine = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FreeMarkerEngine(); Configuration freeMarkerConfiguration = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Configuration(); freeMarkerConfiguration.setTemplateLoader(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ClassTemplateLoader(Main.class, <span class="hljs-string"><span class="hljs-string">"/"</span></span>)); freeMarkerEngine.setConfiguration(freeMarkerConfiguration);</code> </pre> <br>  That's all, you can safely use freemarker. <br><br><pre> <code class="java hljs">get(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, (request, response) -&gt; { Map&lt;String, Object&gt; model = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;&gt;(); model.put(<span class="hljs-string"><span class="hljs-string">"name"</span></span>, <span class="hljs-string"><span class="hljs-string">"Freemarker"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> freeMarkerEngine.render(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ModelAndView(model, <span class="hljs-string"><span class="hljs-string">"hello.ftl"</span></span>)); });</code> </pre> <br><img src="https://habrastorage.org/webt/59/da/59/59da59386ae7f351714711.png"><br><br><h4>  Almost complete project </h4><br>  Let's write, some easy, but sufficient to show at least a small part of the capabilities of Spark?  From the fact that you can really quickly write, only the abbreviation of links came to my head.  Well, let's start? <br><br>  We need to add another dependency Google Guava.  As a result, we get 3 dependencies. <br><br><pre> <code class="java hljs"> &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;com.sparkjava&lt;/groupId&gt; &lt;artifactId&gt;spark-core&lt;/artifactId&gt; &lt;version&gt;<span class="hljs-number"><span class="hljs-number">2.6</span></span>.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.sparkjava&lt;/groupId&gt; &lt;artifactId&gt;spark-template-freemarker&lt;/artifactId&gt; &lt;version&gt;<span class="hljs-number"><span class="hljs-number">2.5</span></span>.5&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.google.guava&lt;/groupId&gt; &lt;artifactId&gt;guava&lt;/artifactId&gt; &lt;version&gt;<span class="hljs-number"><span class="hljs-number">23.0</span></span>&lt;/version&gt; &lt;/dependency&gt;</code> </pre> <br>  We need Guava, because it implements the hash function Murmur3.  The whole plus is that it is quite strong resistant to collisions.  Also, in order not to waste too much time, we will store all data only in variables, without any database, etc. <br><br>  Make the backbone of the program. <br><br><pre> <code class="java hljs">staticFileLocation(<span class="hljs-string"><span class="hljs-string">"/static"</span></span>); get(<span class="hljs-string"><span class="hljs-string">"/shortener"</span></span>, (request, response) -&gt; { }); get(<span class="hljs-string"><span class="hljs-string">"/:url"</span></span>, (request, response) -&gt; { });</code> </pre> <br>  : url is a parameter that can be obtained through the <i>params ()</i> method.  For example: <br><br><pre> <code class="java hljs">get(<span class="hljs-string"><span class="hljs-string">"/hello/:name"</span></span>, (request, response) -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Hello: "</span></span> + request.params(<span class="hljs-string"><span class="hljs-string">":name"</span></span>); });</code> </pre> <br>  Something I was distracted, we will continue. <br><br>  Create a collection (Map) for storage, set up a templating engine (as I said freemarker is my favorite, so it will be him) and specify a pairing where we will store statistical files.  <i>staticFiles.location ("/ static")</i> will tell it that the files will be in <i>src / main / resources / static</i> .  For example, the file / <i>static / css / style.css</i> will be available at <i>http: // {host}: {port} /css/style.css</i> .  If you want to store files suppose in <i>/ var / www / public_html</i> , then use the method <i>staticFiles.externalLocation ("/ var / www / public_html")</i> . <br><br><pre> <code class="java hljs"> ConcurrentHashMap&lt;String, String&gt; urls = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConcurrentHashMap&lt;String, String&gt;(); FreeMarkerEngine freeMarkerEngine = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FreeMarkerEngine(); Configuration freemarkerConfiguration = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Configuration(); freemarkerConfiguration.setTemplateLoader(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ClassTemplateLoader(Main.class, <span class="hljs-string"><span class="hljs-string">"/templates/"</span></span>)); freeMarkerEngine.setConfiguration(freemarkerConfiguration); staticFileLocation(<span class="hljs-string"><span class="hljs-string">"/static"</span></span>);</code> </pre><br>  Set up redirection. <br><br><pre> <code class="java hljs"> get(<span class="hljs-string"><span class="hljs-string">"/:url"</span></span>, (request, response) -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(urls.containsKey(request.url())) response.redirect(urls.get(request.url())); response.redirect(<span class="hljs-string"><span class="hljs-string">"/"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; });</code> </pre> <br>  Now when the user follows a short link, if the link is in the collection, we move it to the desired site, if not, then to the main one. <br><br>  Let's work with the front-end, otherwise we have completely forgotten about it.  Let's start with the main one. <br>  Here we will create a simple minimalist form.  And we stuff the Proxima Nova font.  Played of course ... but oh well. <br><br><pre> <code class="hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"height:100%;"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'utf-8'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"style.css"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"main"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/shortener"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"GET"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"input"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"url"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">autocomplete</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"off"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">autofocus</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">size</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"44"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">maxlength</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"512"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><pre> <code class="css hljs">@<span class="hljs-keyword"><span class="hljs-keyword">font-face</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-family</span></span>: Proxima Nova; <span class="hljs-attribute"><span class="hljs-attribute">src</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">url</span></span>(pn.otf); } * { <span class="hljs-attribute"><span class="hljs-attribute">font-family</span></span>: Proxima Nova; <span class="hljs-attribute"><span class="hljs-attribute">background</span></span>: <span class="hljs-number"><span class="hljs-number">#2a2826</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: <span class="hljs-number"><span class="hljs-number">#9C9C9C</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">margin</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">padding</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">body</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">html</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>: <span class="hljs-number"><span class="hljs-number">100%</span></span>; } <span class="hljs-selector-id"><span class="hljs-selector-id">#main</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">display</span></span>: flex; <span class="hljs-attribute"><span class="hljs-attribute">align-items</span></span>: center; <span class="hljs-attribute"><span class="hljs-attribute">justify-content</span></span>: center; <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>: <span class="hljs-number"><span class="hljs-number">100%</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">1.5em</span></span>; } <span class="hljs-selector-id"><span class="hljs-selector-id">#input</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">border</span></span>: none; <span class="hljs-attribute"><span class="hljs-attribute">outline</span></span>:none; <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">1.5em</span></span>; }</code> </pre><br>  In the end, all this stuff looks like. <br><br><img src="https://habrastorage.org/webt/59/da/7a/59da7ac33af4c426756144.png"><br><br>  Now the page on which the link ‚Äúshortener.ftl‚Äù will be displayed. <br><br><pre> <code class="hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"height:100%;"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'utf-8'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"style.css"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"main"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text-align: center"</span></span></span><span class="hljs-tag">&gt;</span></span> ${url} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  The final project structure. <br><br><img src="https://habrastorage.org/webt/59/da/7e/59da7e5dd721c073093571.png"><br><br>  Well, we add the last lines.  As a result, the Main class looks like this. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.common.hash.Hashing; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> freemarker.cache.ClassTemplateLoader; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> freemarker.template.Configuration; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> spark.ModelAndView; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> spark.Request; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> spark.Response; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> spark.template.freemarker.FreeMarkerEngine; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.nio.charset.StandardCharsets; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.HashMap; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Map; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.concurrent.ConcurrentHashMap; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> spark.Spark.*; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Main</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ ConcurrentHashMap&lt;String, String&gt; urls = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConcurrentHashMap&lt;String, String&gt;(); FreeMarkerEngine freeMarkerEngine = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FreeMarkerEngine(); Configuration freemarkerConfiguration = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Configuration(); freemarkerConfiguration.setTemplateLoader(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ClassTemplateLoader(Main.class, <span class="hljs-string"><span class="hljs-string">"/templates/"</span></span>)); freeMarkerEngine.setConfiguration(freemarkerConfiguration); staticFileLocation(<span class="hljs-string"><span class="hljs-string">"/static"</span></span>); get(<span class="hljs-string"><span class="hljs-string">"/shortener"</span></span>, (request, response) -&gt; { String shortURL = <span class="hljs-string"><span class="hljs-string">"http://localhost:4567/"</span></span> + Hashing.murmur3_32().hashString(request.queryParams(<span class="hljs-string"><span class="hljs-string">"url"</span></span>), StandardCharsets.UTF_8).toString(); Map&lt;String, Object&gt; model = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!urls.containsKey(shortURL)) { model.put(<span class="hljs-string"><span class="hljs-string">"url"</span></span>, shortURL); urls.put(shortURL, request.queryParams(<span class="hljs-string"><span class="hljs-string">"url"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> freeMarkerEngine.render(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ModelAndView(model, <span class="hljs-string"><span class="hljs-string">"shortener.ftl"</span></span>)); } model.put(<span class="hljs-string"><span class="hljs-string">"url"</span></span>, shortURL); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> freeMarkerEngine.render(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ModelAndView(model, <span class="hljs-string"><span class="hljs-string">"shortener.ftl"</span></span>)); }); get(<span class="hljs-string"><span class="hljs-string">"/:url"</span></span>, (request, response) -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(urls.containsKey(request.url())) response.redirect(urls.get(request.url())); response.redirect(<span class="hljs-string"><span class="hljs-string">"/"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; }); } }</code> </pre> <br>  That's all.  41 lines of code and we wrote a link abbreviation. <br><br><h4>  Conclusion </h4><br>  At this point, I‚Äôll finish this slightly protracted ‚ÄúGetting started‚Äù article.  I am very sorry that in Runet this project was bypassed.  If you like it, I will continue to write about Spark and reveal more of its features. <br><br><h4>  Links </h4><br>  ‚Üí <a href="http://sparkjava.com/">Project site</a> <br>  ‚Üí <a href="https://github.com/perwendel/spark">SparkJava source codes</a> </div><p>Source: <a href="https://habr.com/ru/post/339684/">https://habr.com/ru/post/339684/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../339674/index.html">Sharing Scrum and DevOps - Translation of the article The Convergence of Scrum and DevOps</a></li>
<li><a href="../339676/index.html">Proxmox 4. Day Two. Thin-LVM</a></li>
<li><a href="../339678/index.html">Simple Python Scada (continued)</a></li>
<li><a href="../339680/index.html">Startup of the day (August and September 2017)</a></li>
<li><a href="../339682/index.html">How to get alerts from Jupyter notebook in Telegram?</a></li>
<li><a href="../339688/index.html">Developer Tacts</a></li>
<li><a href="../339690/index.html">Cocos2d-x - Working with sprites</a></li>
<li><a href="../339692/index.html">How to successfully implement the Help Desk? 12 examples (part 2)</a></li>
<li><a href="../339694/index.html">New 3CX Call Flow Designer: Complicated Call Routing Without Programming</a></li>
<li><a href="../339696/index.html">Knowledge sharing and copyright management platform. Look at the state order?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>