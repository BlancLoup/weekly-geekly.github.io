<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Stream WebRTC video stream from browser to YouTube Live in 65 lines of JavaScript / HTML code</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, we will describe how Youtube Live broadcast works and show how a person with basic JavaScript knowledge can code a Youtube Live broad...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Stream WebRTC video stream from browser to YouTube Live in 65 lines of JavaScript / HTML code</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/cf7/d51/12c/cf7d5112c93e46a1b0876f229d0d907a.png"><br><br>  In this article, we will describe how Youtube Live broadcast works and show how a person with basic JavaScript knowledge can code a Youtube Live broadcast from an HTML page using WebRTC technology. <br><br>  The work will categorically require the following knowledge and skills: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      1) Basic knowledge of javascript / html <br>  2) Ability to work on the Linux command line. <br>  3) Straight arms. <br><a name="habracut"></a><br><h2>  Youtube Live Broadcasts </h2><br>  Youtube gives you the opportunity to broadcast in real time.  Those.  not just upload a video, but create a full-fledged live broadcast of yourself, your cat Murzik or another responsible event. <br><br>  Youtube TV studio is located on <a href="https://youtube.com/my_live_events">this page</a> and in Google Chrome browser looks like this: <br><br><img src="https://habrastorage.org/files/0b2/7ad/cb4/0b27adcb4123426995ae22b1dbe090ff.jpg"><br><br>  In order to make the broadcasts accessible, you need to click the <b>Enable live streaming</b> button and go through a verification in two steps.  Next, the button turns into a <b>Create live event</b> and you can start broadcasting. <br><br><img src="https://habrastorage.org/files/899/af5/e98/899af5e98564463bb6b328ebfcb1c13e.jpg"><br><br>  Click <b>Go live now</b> to go directly to the broadcast. <br><br>  Youtube opens Google Hangouts window through which all manipulations with the video stream. <br><br><img src="https://habrastorage.org/files/782/62b/b6d/78262bb6dbc148bf9451abc49b74ac79.jpg"><br><br>  Thus, we created a live broadcast on Youtube Live, started broadcasting, stopped broadcasting.  Received a video recording on Youtube.  Broadcast held by Google Hangouts. <br><br>  Everything is great, but judging by <a href="https://techcrunch.com/2017/01/06/hangouts-api-shut-down">IT news</a> , Google closes the Hangouts API for developing video applications from April 25, 2017.  For developers, this means that using the Hangouts API, it will no longer be possible to create your own custom application that streams the video, including on Youtube. <br><br><h2>  Broadcast from RTMP live encoder </h2><br>  Next, we consider an alternative to creating a broadcast that is not tied to Google Hangouts and allows you to stream a video stream from a specialized video capture device (RTMP Live Encoder). <br><br><img src="https://habrastorage.org/files/597/517/f21/597517f21ce94a939ea73d6a7f191d57.jpg"><br><br>  If you click on the Stream Now button, you will be taken to the familiar translation creation interface. <br><br>  The most important part is the encoder settings: <br><br><img src="https://habrastorage.org/files/d97/66f/9d7/d9766f9d7eae4b8e9d255337d5c07959.jpg"><br><br>  As you can see, there are only two fields: <br><br>  1) Server URL <br>  2) Stream name / key <br><br>  If you click the <b>Reveal</b> button, the name of your stream will be displayed and will be available for copying. <br><br>  This data is enough to send a video stream from the RTMP Live Encoder to Youtube Live from any location and any computer, without using Google Hangouts.  RTMP Live Encoder (also known as an encoder) is a device or software that captures stream from a webcam or a professional video camera, encodes video in the RTMP protocol and sends it to a specified address (Encoder setup). <br><br>  To get high-quality audio and video stream, you need to use standard Live Encoders codecs, namely H.264 video codec and AAC audio codec.  This combination of codecs is the most common and reliable and is the de facto standard of use in RTMP when using autonomous encoders. <br><br>  For example, the plug-in for the browser Adobe Flash Player is also an encoder and can stream video directly from the browser's web page, but it does not support AAC audio codec for streaming and therefore problems may occur with broadcasting, namely, there may be no sound. <br><br>  Therefore, we immediately take in testing only those encoders that explicitly support the H.264 and AAC codecs.  Currently, we know two candidates for testing that use these codecs: <br><br>  <b><a href="http://www.adobe.com/products/flash-media-encoder.html">Adobe Flash Media Live Encoder for Mac OS</a></b> is a free software encoder from Adobe that can encode RTMP streams in H.264 and AAC.  Please note that AAC audio codec is supported only in the FMLE version for Mac OS.  If you use the same software on Windows, AAC codec will be unavailable.  Instead, it will be mp3. <br><br>  <b><a href="http://www.telestream.net/controls/wirecast/download-wirecast.htm">Wirecast</a></b> is a paid encoder that has a free trial version in which a logo is inserted on top of the broadcast video and sound is superimposed every 30 seconds.  Wirecast has a Windows distribution. <br><br>  Let's start with Adobe FMLE.  Install FMLE on a Mac and hook up to a computer (Mac Mini was used in the tests) webcam.  With virtual cameras, FMLE does not seem to work, so you need an honest USB webcam or built-in (if you have a macbook). <br><br>  We set up H.264 as a video codec with a resolution of 640x480.  As the audio codec, we leave what is set by default AAC 22050 Hz mono.  Other H.264 and AAC configurations and settings should also work without problems. <br><br>  In the FMS URL field, enter the RTMP broadcast address that was received on Youtube. <br>  In the Stream field we put down the name of the stream, which again was received on Youtube. <br><br>  * The field has such a strange name FMS URL because FMLE thinks that there is only one server in the world capable of receiving an RTMP video stream - Flash Media Server from Adobe (now Adobe Media Server), but as we see it is not so, and with this task perfectly copes, for example Youtube and another hundred other servers and services. <br><br><img src="https://habrastorage.org/files/83d/ba3/dd0/83dba3dd01ba45ec8998fa6362d45f16.jpg"><br><br>  After all the settings have been set, click the green <b>Start</b> button to start the broadcast and the video is sent to Youtube.  The picture is a bit dull, but my Mac is overloaded and I take screenshots through Teamviewer, so you cannot count on a special quality.  To get a high-quality stream, take care of a high-quality high-resolution webcam and a powerful CPU, such as a Core i7 processor and SSD drive, would be useful for smooth and high-quality encoding of the RTMP video stream. <br><br><img src="https://habrastorage.org/files/973/54b/cc6/97354bcc6fb2473286ebdea12e5ee5a1.jpg"><br><br>  Since we have achieved some success in using FMLE, there is not much point in testing Wirecast.  If you have problems with FMLE or not at hand Mac OS, try to do the same with Wirecast.  For example, in this article you can find several screenshots with a description of how to broadcast the video stream in Wirecast.  Wirecast encoder is interesting because it can be used even without a webcam.  You can broadcast and encode in RTMP a regular video. <br><br><h2>  Convert from WebRTC to RTMP </h2><br>  Above, we conducted a test showing how to create a broadcast on Youtube Live and how to send an RTMP video stream encoded in H.264 + AAC to Youtube. <br><br>  The next task is to do the same with <a href="https://webrtc.org/">WebRTC</a> .  WebRTC is a browser-based technology that allows the browser to capture video from the camera and audio from a microphone and send it to the network.  Thus, a browser that supports WebRTC can work exactly like a Live Encoder - do capture and send.  WebRTC is supported in the following browsers: <br><br><ul><li>  Chrome </li><li>  Firefox </li><li>  Opera </li><li>  Chrome for Android </li><li>  Firefox for Android </li></ul><br>  Those.  WebRTC video streams can be sent from Chrome desktop browsers, FF and the same browsers running Android. <br><br>  As a result, our task is to broadcast on Youtube from the Google Chrome browser from a regular HTML page, without using Google Hangouts or RTMP Live Encoder. <br><br>  Three problems: <br><br><ul><li>  WebRTC does not support the RTMP protocol, which requires Youtube. </li><li>  WebRTC does not support AAC audio codec, which requires Youtube. </li><li>  WebRTC in Chrome does not support the H.264 codec on mobile devices, it uses the VP8 codec. </li></ul><br>  For these three reasons, WebRTC cannot directly send audio + video to Youtube Live. <br><br>  If we talk about Adobe Flash Player, it has another problem. <br><br><ul><li>  Does not encode audio in AAC </li></ul><br>  Therefore, regardless of whether you use a browser that supports WebRTC (Chrome) or a browser that supports Flash Player (IE or Safari), you cannot send an H.264 + AAC RTMP video stream directly from the browser. <br><br>  The solution is to convert the video stream on the server side, which is shown in the diagram below. <br><br><img src="https://habrastorage.org/files/7eb/0b4/647/7eb0b464718e4c45b7924c991aef0f7a.png"><br><br>  Thus, an intermediary server appears in the broadcast, which receives the WebRTC video stream and converts it into a format that YouTube accepts. <br><br>  For testing we will use <a href="https://flashphoner.com/">Web Call Server 5</a> .  This is a media server with support for WebRTC technology and an RTMP protocol with a trial version. <br><br>  Our task is to install Web Call Server 5 on a Linux server and send a WebRTC video stream to it that will be redirected to Youtube.  This will require a local iron server on a 64-bit Linux system or a VPS server at the hoster.  Minimum requirements: 1 processor core and 1 gigabyte RAM, Linux x86_64. <br><br>  An old dual-core Athlon 64-bit, 1.8 GHz with CentOS 6 installed on it and 2 gigabytes of RAM was found on the local network.  For experiments, decided to use it. <br><br>  The installation process is described on the developer's site. <br><br>  <b>1.</b> Download the archive <br><br><pre><code class="bash hljs">wget https://flashphoner.com/download-wcs5-server.tar.gz</code> </pre> <br>  When downloading wget swears at the certificates.  I have to add a flag: <br><br><pre> <code class="bash hljs">wget --no-check-certificate https://flashphoner.com/download-wcs5-server.tar.gz</code> </pre> <br>  <b>2.</b> Unpack <br><br><pre> <code class="bash hljs">tar -xzf download-wcs5-server.tar.gz</code> </pre> <br>  <b>3.</b> Run the installer <br><br><pre> <code class="bash hljs">./install.sh</code> </pre> <br>  When installing, it gives an error and indicates the absence of Java. <br><br>  <b>4.</b> Install java using the package manager, and then run the installer again. <br><br><pre> <code class="bash hljs">yum install java ./install.sh</code> </pre> <br>  During installation, the installer asks if the server is on the local network.  We answer in the affirmative with 'yes', after which the installer enters the local IP address of the server 192.168.1.59 into the settings. <br><br>  <b>5.</b> Next, run the server. <br><br><pre> <code class="bash hljs">service webcallserver start</code> </pre> <br>  Starting the server takes about a minute. <br><br>  <b>6.</b> Open the dashboard at <a href="https://192.168.1.59/">192.168.1.59</a> : 8888 in Chrome <br><br><img src="https://habrastorage.org/files/d36/d05/682/d36d05682ee5421c8724ea908d641e6a.jpg"><br><br>  The browser is expected to complain about the lack of normal SSL certificates.  Later they can be imported, for example, take free on <a href="https://letsencrypt.org/">letsencrypt</a> . <br><br>  Now just click on Advanced / Proceed and confirm the security exception. <br><br>  <b>7.</b> According to the developer documentation, there is one more thing to do regarding certificates.  You need to do the same on page: <a href="https://192.168.1.59/">192.168.1.59</a> : 8443 <br><br>  This is to ensure that the signal websocket connections also pass.  Without them, WebRTC will not work, because  For his work requires the exchange of SDP through a separate connection. <br><br><img src="https://habrastorage.org/files/b4b/077/313/b4b0773132d84b84a5cbfa8bdd08dc3c.jpg"><br><br>  After these two manipulations with certificates, the Dashboard page should open with demo examples.  The demo example we need is called WebRTC as RTMP re-publishing and it looks like this: <br><br><img src="https://habrastorage.org/files/475/504/8a2/4755048a2d714ccc9e7eb015a06071bd.jpg"><br><br>  Let's test it in Google Chrome browser.  The task of this example is to send WebRTC audio + video stream to Web Call Server 5, convert it to RTMP and redirect to a given direction. <br><br><img src="https://habrastorage.org/files/c70/5f9/ae3/c705f9ae31084e15aaaa23290dce5bfc.jpg"><br><br>  To start testing, just click the <b>Start</b> button and allow the use of the camera and microphone at the request of the browser. <br><br>  In the screenshot above, the following happens: <br><br>  <b>1.</b> A connection is established between the Google Chrome browser and Web Call Server 5 via the websocket protocol via a secure connection: wss: //192.168.1.59: 8443 <br><br>  <b>2.</b> WebRTC audio + video stream is sent to the server and the status PUBLISHING is displayed, which indicates the successful sending of the video stream to the server. <br><br>  <b>3.</b> Web Call Server forwards the received WebRTC audio + video stream to the specified RTMP address: <br><br><ul><li>  rtmp: // localhost: 1935 / live </li><li>  stream1 </li></ul><br>  Thus, the RTMP video stream is redirected to localhost, i.e.  On the same server 192.168.1.59 in our case.  Those.  It can be said that the Web Call Server accepted the WebRTC stream and wrapped it on itself as RTMP. <br><br>  Notice how this correlates with Youtube Live.  There we specified the Server URL and Stream name / key <br><br><img src="https://habrastorage.org/files/d97/66f/9d7/d9766f9d7eae4b8e9d255337d5c07959.jpg"><br><br>  <b>4.</b> Next, it remains to play the video stream in the built-in player.  There the address is automatically generated and the name of the stream is entered. <br><br><img src="https://habrastorage.org/files/682/678/4ff/6826784ff61c4710b9e787570f972fda.jpg"><br><br>  The built-in RTMP player is very simple and allows you to make sure that the stream is in place and reproduced correctly. <br><br>  The full stream address looks like this: rtmp: //192.168.1.59: 1935 / live / rtmp_stream1 <br><br>  Here you need to pay attention to an important detail - Web Call Server 5 substitutes the prefix rtmp_ in the name of the stream.  Those.  receives a stream called stream1, and redirects it as rtmp_stream1.  This is important for testing on localhost so that the names of the streams are different. <br><br>  Local testing was successful and it was time to send stream to Youtube Live. <br>  Recall that for testing Youtube Live with the RTMP live video encoder we used <br><br><blockquote>  Server URL: rtmp: //a.rtmp.youtube.com/live2 <br>  Stream name / key: myfm-c9td-etew-eqdf </blockquote><br>  Those.  Youtube expects from us the name of the video stream just this and no other: myfm-c9td-etew-eqdf.  And if the Web Call Server prefixes rtmp_, then the resulting name will be rtmp_myfm-c9td-etew-eqdf and Youtube will not accept the stream. <br><br>  In order to get around this, edit the config /usr/local/FlashphonerWebCallServer/conf/flashphoner.properties on the server side. <br>  Comment or remove the config line: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#rtmp_transponder_stream_name_prefix =rtmp_</span></span></code> </pre> <br>  Thus, we tell the server not to affix the prefix and redirect the received stream with the same name. <br><br><img src="https://habrastorage.org/files/f20/6dd/091/f206dd091def4cfe83a3d781d170e02d.jpg"><br><br>  Changing this setting requires a reboot.  Run the command to restart the server and wait 1 minute. <br><br><pre> <code class="bash hljs">service webcallserver restart</code> </pre> <br>  After the reboot, we proceed to the final stage of testing.  Again open the dashboard and WebRTC as RTMP re-publishing demo example, but this time we enter the RTMP address exactly as for the Live Encoder. <br><br><img src="https://habrastorage.org/files/b6d/1fa/1e2/b6d1fa1e290d44e7a379e6d2bb0f1b36.jpg"><br><br>  Finally, open Youtube Live and see the result: <br><br><img src="https://habrastorage.org/files/41b/614/62f/41b61462fd5640bc8cf7e3b3d836f611.jpg"><br><br>  This time we managed to forward the WebRTC video stream on Youtube as RTMP and get a picture. <br><br>  In the Google Chrome browser, in the chrome: // webrtc-internals tab, you can see graphs describing the WebRTC delivery of the video stream to the server: <br><br><img src="https://habrastorage.org/files/dcb/5a9/4f3/dcb5a94f3e43453788fe1fadfa9818d1.jpg"><br><br>  On the Youtube side, incoming traffic looks like this: <br><br><img src="https://habrastorage.org/files/74d/0e4/684/74d0e46840cf4fb6be74fef3b1a01e05.jpg"><br><br>  Very similar to HTTP Live streaming (HLS) with uploading video segments via HTTP (HTTPS). <br><br>  Great, we managed to test and make sure that it really works.  There is a picture, there is a sound, the video stream goes straight from the browser and goes to Youtube. <br><br>  Now you can proceed to programming.  Namely, we would like to be able to do the same from a simple HTML page and in perspective from our website or web application. <br><br><h2>  Programming an HTML page that sends WebRTC to Youtube </h2><br>  The easiest way would be to figure out the example by downloading three source files: HTML, JavaScript, CSS.  But we are not looking for easy ways and want to create a minimal page from scratch (so to speak from scratch). <br><br>  We start by creating a test-webrtc-youtube.html blank <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UTF-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Now you need to download the flashphoner.js script, which does all the work related to WebRTC and the transfer of the video stream to the server.  This script is included in the Web SDK, which is available for download at <a href="https://flashphoner.com/wcs-web-sdk">this link</a> . <br><br>  We download and unpack the Web SDK on a separate server where Apache is installed (someone has Nginx). <br><br><pre> <code class="bash hljs">wget https://flashphoner.com/downloads/builds/flashphoner_client/wcs_api-2.0/flashphoner-api-0.5.14.1977-48448b99eddb0da1248519290dba2d4d00d4a505.tar.gz</code> </pre> <br>  Create a folder / var / www / html / test-webrtc-youtube which will contain the html page and copy the files to this html and js folder: <br><br>  - test-webrtc-youtube.html <br>  - flashphoner.js <br><br>  It turns out this structure: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">test</span></span>-webrtc-youtube -- flashphoner.js -- <span class="hljs-built_in"><span class="hljs-built_in">test</span></span>-webrtc-youtube.html</code> </pre> <br>  <b>1.</b> Add the following elements to the page: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onload</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"init_page()"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"localVideo"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"width:320px;height:320px;border: 1px solid"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> Server URL <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"urlServer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wss://192.168.1.59:8443"</span></span></span><span class="hljs-tag">/&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">/&gt;</span></span> Stream URL: <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"rtmpUrl"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"rtmp://a.rtmp.youtube.com/live2"</span></span></span><span class="hljs-tag">/&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">/&gt;</span></span> Stream name / key: <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"streamName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"myfm-c9td-etew-xxxx"</span></span></span><span class="hljs-tag">/&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"publishToYoutube()"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Start"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"status"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  1) localVideo - this is just a div-block, which will be placed video from a webcam <br>  2) urlServer, rtmpUrl, streamName - already familiar fields from previous testing <br>  3) status - this field displays the status of the connection or stream <br><br>  <b>2.</b> Add three variables: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> SESSION_STATUS = Flashphoner.constants.SESSION_STATUS; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> STREAM_STATUS = Flashphoner.constants.STREAM_STATUS; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> localVideo;</code> </pre> <br>  The first two are just abbreviations.  The localVideo variable will store the reference to the div element. <br><br>  <b>3.</b> Initialize the API <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init_page</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ Flashphoner.init(); localVideo = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"localVideo"</span></span>); }</code> </pre> <br>  <b>4.</b> Connect to WCS server and start streaming. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">publishToYoutube</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> urlServer = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"urlServer"</span></span>).value; Flashphoner.createSession({<span class="hljs-attr"><span class="hljs-attr">urlServer</span></span>: urlServer}).on(SESSION_STATUS.ESTABLISHED, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">session</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//session connected, start streaming startStreaming(session); }).on(SESSION_STATUS.DISCONNECTED, function(){ setStatus("Connection DISCONNECTED"); }).on(SESSION_STATUS.FAILED, function(){ setStatus("Connection FAILED"); }); }</span></span></code> </pre><br>  Upon successful connection via the ESTABLISHED event, it starts streaming by calling the startStreaming function <br><br>  <b>5.</b> Sending a video stream. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startStreaming</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">session</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> streamName = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"streamName"</span></span>).value; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rtmpUrl = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"rtmpUrl"</span></span>).value; session.createStream({ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: streamName, <span class="hljs-attr"><span class="hljs-attr">display</span></span>: localVideo, <span class="hljs-attr"><span class="hljs-attr">cacheLocalResources</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">receiveVideo</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">receiveAudio</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">rtmpUrl</span></span>: rtmpUrl }).on(STREAM_STATUS.PUBLISHING, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">publishStream</span></span></span><span class="hljs-function">)</span></span>{ setStatus(STREAM_STATUS.PUBLISHING); }).on(STREAM_STATUS.UNPUBLISHED, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ setStatus(STREAM_STATUS.UNPUBLISHED); }).on(STREAM_STATUS.FAILED, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ setStatus(STREAM_STATUS.FAILED); }).publish(); }</code> </pre> <br>  Here we created a stream and called the function publish for it. <br><br>  <b>6.</b> All statuses are displayed as a separate function. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setStatus</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">status</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"status"</span></span>).innerHTML = status; }</code> </pre> <br>  In the end, they got about the same as when using the demo out of the box. <br><br>  The result looks like this: <br><br><img src="https://habrastorage.org/files/688/cc2/278/688cc22785d54be18e8fcfc047dd517e.jpg"><br><br>  Note that the https protocol is again used.  Your web server must be configured to use https.  This is usually done quite simply by installing mod_ssl: <br><br><pre> <code class="bash hljs">yum install mod_ssl</code> </pre> <br>  The HTML code for the page took exactly 65 lines and looks like this: <br><br><img src="https://habrastorage.org/files/6e7/5f2/265/6e75f2265fb24b46ae684dfc29e4d254.jpg"><br><br>  And you can download the source <a href="https://cloud.mail.ru/public/HgfJ/WYG4CgRHK">here.</a> <br><br>  As a result, we created an HTML page with a size of 65 lines, including scripts, which, using the flashphoner.js API file, sends WebRTC video to a Web Call Server, which in turn redirects this video stream to the Youtube Live service. <br><br>  That's all.  For those who want to repeat, I cite the references and materials used in the article. <br><br>  References: <br><br>  1) <a href="https://youtube.com/my_live_events">Youtube Live</a> <br>  2) <a href="http://www.adobe.com/products/flash-media-encoder.html">Adobe Flash Media Live Encoder</a> <br>  3) <a href="http://www.telestream.net/controls/wirecast/download-wirecast.htm">Wirecast</a> <br>  4) <a href="https://flashphoner.com/">Web Call Server</a> (used version 2047) <br>  5) <a href="https://webrtc.org/">WebRTC</a> <br>  6) <a href="https://cloud.mail.ru/public/HgfJ/WYG4CgRHK">HTML + Javascript Sources</a> <br>  7) <a href="https://techcrunch.com/2017/01/06/hangouts-api-shut-down">Google is closing the Hangouts API</a> </div><p>Source: <a href="https://habr.com/ru/post/321700/">https://habr.com/ru/post/321700/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../321690/index.html">Iterative Design and GitHub</a></li>
<li><a href="../321692/index.html">Distributed xargs, or Execution of Heterogeneous Applications on Hadoop Cluster</a></li>
<li><a href="../321694/index.html">Personal experience: Raiffeisen, Alfa-Bank and VTB24</a></li>
<li><a href="../321696/index.html">Remotely reinstalling Linux via ssh without accessing the console</a></li>
<li><a href="../321698/index.html">Advanced Threat Protection in Windows Defender</a></li>
<li><a href="../321702/index.html">Incremental analysis in PVS-Studio: now also on the assembly server</a></li>
<li><a href="../321704/index.html">Multifactor analyzer of arbitrary enterprise activity on the IEM platform</a></li>
<li><a href="../321708/index.html">A note about licensing Windows Server or how not to bankrupt a company during a licensed audit</a></li>
<li><a href="../321710/index.html">Free QGIS and NextGIS geographic information solutions</a></li>
<li><a href="../321714/index.html">How IT professionals work. Andrei Gajariga, Head of Development and Development, Orange Business Services</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>