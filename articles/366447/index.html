<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Details of DropBox H.264 lossless compression</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We recently came across an article . Dropbox developed a lossless compression algorithm for H.264 and JPEG files and we decided to test this solution ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Details of DropBox H.264 lossless compression</h1><div class="post__text post__text-html js-mediator-article">  We recently came across an article <a href="http://geektimes.ru/post/261058/">. Dropbox developed a lossless compression algorithm for H.264 and JPEG files</a> and we decided to test this solution and get some tangible technical details. <br><br>  The fact that immediately managed to find out that the <b>H.264 file pinched is no longer as such</b> and can only be used for intermediate storage. <br><br>  Also, the effect of this type of compression can be expected in two cases: if CAVLC is used as a coder in the file or if the file is encoded with PU and TU blocks of maximum size.  And this is only possible if the H.264 codec is configured for the fastest possible coding. <br><a name="habracut"></a><br><h4>  About the Pied Piper project </h4><br>  One of the most ‚Äúheavy‚Äù among all types of data is video, and it is not surprising that services that are associated with processing, transfer or storage of it, are thinking about compression.  However, the solutions to this problem may be different.  In August 2015, DropBox published its vision - its, not yet final, algorithm for H.264 video files.  The company's activity is mainly related to the storage of files of its users.  The user is not interested in the form in which they are stored, but what is important is that back, when downloading, he will receive exactly the same files that were downloaded.  Therefore, the algorithm proposed by DropBox is lossless.  In addition, the <b>result of compression is not a video file of the original format</b> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In this article we will try to determine the efficiency of the algorithm when compressing various files.  As an auxiliary tool, we will use ZOND 265 from Solveig Multimedia (this is what we have), the H.264 and H.265 video analyzer. <br><br>  All files received in the article (executable compressor file compiled for Linux Ubuntu x64 12.04, test video files) can be downloaded <a href="">here</a> . <br><br><img src="https://habrastorage.org/files/815/2f3/afa/8152f3afa32e49959a4e6e3883b3164b.jpg" alt="image"><br><br><h4>  Evaluation of the effectiveness of the compressor project "Pied Piper" </h4><br>  Source codes and compressor test files are available on <a href="https://github.com/danielrh/losslessh264">GitHub</a> .  First, let's compile the compressor and evaluate the test files.  Then we look at the efficiency of files found in real life. <br><br><h5>  Compression </h5><br>  Clear instructions for compiling the compressor of the Pied Piper project are available only for Linux; this is essentially one file ‚Äî the piedpiper_make script.  Therefore, we load Linux Ubuntu x64 and enter three commands: <br><br> <code><a href=""></a> git clone github.com/danielrh/losslessh264.git <br></code> <br> <code>cd ./lossless264 <br></code> <br> <code>./piedpiper_make <br></code> <br><br>  After compiling, the compressor files will appear in the current folder: <br><br>  <i>h264dec</i> - executable file of the compressor and decompressor, <br>  <i>libopenh264.so.0, libopenh264.so</i> - auxiliary dynamic library and link to it. <br><br>  Compression is performed by the command: <br><br> <code>./h264dec ./source-file.264 ./destination-file.pip, <br></code> <br><br>  Decompression: <br><br> <code>./h264dec ./compressed-file.pip ./decompressed-file.264. <br></code> <br><br>  It should be noted that the result of compression is not a file of the same format as the original, and I am a set of .pip files. <br><br><h5>  Test files of the Pied Piper project </h5><br>  According to the Git repository, the developers used several files as tests - ‚Äúblack.264‚Äù, ‚Äútibby.264‚Äù, ‚Äúwalk.264‚Äù, ‚ÄúBA1_FT_C.264‚Äù, ‚ÄúBAMQ2_JVC_C.264‚Äù.  Having loaded them into Zond 265, we see that they are compressed in the same way (see screenshots of Zond 265, ‚ÄúBitstream‚Äù tab, fig. 1-3 for the file ‚Äútibby.264‚Äù).  The main feature is the use of CAVLC (PPS, entropy_coding_mode_flag: 0) and the absence of B-frames (SPS, max_num_reorder_frames: 0).  For efficiency tests, the first three files are taken. <br><br><img src="https://habrastorage.org/files/c08/041/3af/c080413affbb419f8a5f3ef39fd66e78.png" alt="image"><br>  <i>Fig.</i>  <i>1. Block Sequence Parameter Set (SPS) file "tibby.264"</i> <br><br><img src="https://habrastorage.org/files/c49/904/716/c49904716849471a83ed6c74fcfc8020.png" alt="image"><br>  <i>Fig.</i>  <i>2. Block Picture Parameter Set of the file "tibby.264"</i> <br><br><img src="https://habrastorage.org/files/c99/e56/619/c99e566197244823a15eaa4f61b7f1be.png" alt="image"><br>  <i>Fig.</i>  <i>3. The structure of the video stream file "tibby.264"</i> <br><br><h5>  Other test files </h5><br>  Users can get video files in several ways: shoot it with a camera (for example, their phone), download it from various video services (youtube, vk, vimeo, facebook, etc.), use the program with the transcoding function. <br><br>  The video from the phone was taken from a regular Android smartphone, this is the file ‚ÄúVID_20150917_131139.264‚Äù.  It also does not contain B-frames, but uses CABAC as the arithmetic compressor, not CAVLC.  On files downloaded from youtube (they contain B-frames and use CABAC), the compressor gives an error, so we will not include them in testing. <br><br>  The console utility ffmpeg (module ‚Äúlibx264‚Äù) is taken as a program with the transcoding function.  Looking ahead, compression was observed only with the ‚Äúultrafast‚Äù preset, with the ‚Äúsuperfast‚Äù preset, compression was no longer possible.  Test files - "tractor-ultrafast.264", "tractor-superfast.264". <br>  In addition to the above, three more files are included in the table to assess whether the proposed algorithm will leave effective inclusion of the ‚ÄúCABAC‚Äù and coding options for PU and TUs of the maximum size: ‚Äúblack-cabac.264‚Äù, ‚Äútibby-cabac.264‚Äù and ‚Äútibby‚Äù -cabac-max-blocks ". <br><br><h5>  Test results </h5><br>  The test results are summarized in tables 1 and 2. The data on the number of PU and TU blocks for a table are obtained by the Zond 265 program (‚ÄúStream Stats‚Äù tab).  In fig.  4 shows a screenshot with the data for the file "tibby.264". <br><br><img src="https://habrastorage.org/files/640/7ff/bb8/6407ffbb8de54160bbcae8443da3e9a2.png" alt="image"><br>  <i>Fig.</i>  <i>4. PU and TU block data for the tibby.264 file</i> <br><br><img src="https://habrastorage.org/files/256/b0b/8fb/256b0b8fbaa344eda555b2ce07c37f51.jpg" alt="image"><br>  <i>Table 1. The results of tests of the compression efficiency of the compressor of the project ‚ÄúPied Piper‚Äù</i> <br><br><img src="https://habrastorage.org/files/f83/e28/154/f83e281548c640f9833556fb1b490c80.jpg" alt="image"><br>  <i>Table 2. Test results of the efficiency of compression of the compressor of the project ‚ÄúPied Piper‚Äù</i> <br><br>  As can be seen from the tables, the proposed algorithm of the ‚ÄúPied Piper‚Äù project in the published version is effective in two cases: if CAVLC is used as a coder in the file or if the file is encoded with maximum size PU and TU blocks.  And this is only possible if the H.264 codec is configured for the fastest possible coding.  Obviously, the files will be quite large.  These are the files resulting from the ffmpeg codec with libx264 with the ‚Äúultrafast‚Äù preset. <br><br>  Thank you for your attention, we will be happy to discuss the results.  This is our first expert article, do not judge strictly. </div><p>Source: <a href="https://habr.com/ru/post/366447/">https://habr.com/ru/post/366447/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../366437/index.html">Web game with the landing of SpaceX Falcon 9 on the sea platform</a></li>
<li><a href="../366439/index.html">Solar Impulse 2 will take off on the first world tour on an airplane without fuel at 6:30 am (Moscow time) on Monday, March 9</a></li>
<li><a href="../366441/index.html">Aether Cone allows you to create multi-room</a></li>
<li><a href="../366443/index.html">The most interesting events of astronautics and astronomy for the week (01.03-07.03)</a></li>
<li><a href="../366445/index.html">How to create semiconductor lasers. Part I</a></li>
<li><a href="../366449/index.html">Maria Chernitskaya: ‚ÄúIt was a great time - no one stood above the soul‚Äù</a></li>
<li><a href="../366451/index.html">Scientists from MIPT have created a new supersensitive biosensor based on graphene oxide</a></li>
<li><a href="../366453/index.html">How Marcus ‚ÄúNotch‚Äù Persson Tweaked Minecraft Share on Twitter</a></li>
<li><a href="../366455/index.html">Everything has its time: 10 interesting models of Geek watches over the past 10 years</a></li>
<li><a href="../366457/index.html">April 9 FriendFeed will be closed</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>