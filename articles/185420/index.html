<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Organize the search for molecular structures using the Lucene and Chemistry Development Kit</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lucene Full-Text Search Library provides the ability to organize a search on text documents. There are also tools with which you can organize the sear...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Organize the search for molecular structures using the Lucene and Chemistry Development Kit</h1><div class="post__text post__text-html js-mediator-article">  Lucene Full-Text Search Library provides the ability to organize a search on text documents.  There are also tools with which you can organize the search for "similar" chemical structures, for example, OpenBabel.  Sometimes it may be necessary to combine these two types of search in a single ‚Äúcanvas‚Äù.  For example, if you need to create a system that can respond to such requests: find a substance in the textual description of which has the word "amino acid" structurally similar to indole (it is expected that we will find the amino acid tryptophan).  This article describes the solution to this problem based on the Lucene full-text engine. <br><a name="habracut"></a><br>  As you know, the basis of full-text search is the construction of an inverted index.  The text of the documents is divided into separate words, for each of which a list of documents is constructed in which the word is found.  Usually, besides the list of documents for a given word, the index contains the positions of the word in each document. <br><br>  Search for similar molecules in databases can be based on "molecular fingerprints".  Often the ‚Äúmolecular imprint‚Äù is a bit string in which the presence of a certain property or structural fragment corresponds to each bit.  In the role of a measure of proximity, the Tanimoto coefficient is used (a special case of <a href="http://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BE%25D1%258D%25D1%2584%25D1%2584%25D0%25B8%25D1%2586%25D0%25B8%25D0%25B5%25D0%25BD%25D1%2582_%25D0%2596%25D0%25B0%25D0%25BA%25D0%25BA%25D0%25B0%25D1%2580%25D0%25B0">the Jaccard coefficient</a> ). <br><br>  As a simple example of a molecular imprint, consider the following: Suppose we want a molecular imprint of length n.  The structure is cut into one-dimensional chains of atoms no longer than k in length.  A hash function is applied to each received chain, which matches a number from 0 to n-1 to the chain.  This number determines the number of bits that will be set to 1 in the print. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For such manipulations with chemical structures, you can use the java-library <a href="http://sourceforge.net/apps/mediawiki/cdk/index.php%3Ftitle%3DMain_Page">Chemistry Development Kit</a> (hereinafter referred to as CDK).  CDK is distributed under the LGPL license and contains java-classes for representing structures, calculating several types of ‚Äúmolecular fingerprints‚Äù, supports many chemical file formats.  For example, cutting a molecule into fragments can be implemented like this: <br><br><pre><code class="java hljs">/     CDK    IAtomContainer. IAtomContainer structure; ... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (IAtom startAtom : structure.atoms()) { <span class="hljs-comment"><span class="hljs-comment">//    CDK org.openscience.cdk.graph.PathTools,    getPathsOfLengthUpto,     . List&lt;List&lt;IAtom&gt;&gt; paths = PathTools.getPathsOfLengthUpto(structure, startAtom, searchDepth); //  -    ... }</span></span></code> </pre> <br>  The molecular imprint described is computed using the CDK class org.openscience.cdk.fingerprint.Fingerprinter. <br><br>  In order to use Lucene to search for structures, we reformulate the search for structures by fingerprints into a kind of ‚Äúword search‚Äù.  The structure, as well as in the imprint construction method described above, is cut into short one-dimensional chains, which will be analogous to words in a text search.  Thus, if we provide the system with another structure as a search query, then the query structure will also be cut into chains, and the result will be structures in which there are the same atomic chains.  The mechanism for organizing documents by relevance will tend to display in the first positions results of structures in which, on the one hand, they have many coincidences, on the other hand, these coincidences are slightly ‚Äúdiluted‚Äù.  That is, it is logical to expect that in the first place there will be exactly the same structure (if, of course, it is among the indexed ones), then similar structures differing in one atom or group, then even more different structures, etc. <br><br>  It is worth noting that the default ranking formula used in Lucene (vector space model + TF-IDF) differs from the Tanimoto proximity measure.  You can override the Similarity class from Lucene under the Tanimoto coefficient formula, but I will not dwell on this, especially since the default formula should give a ‚Äúqualitatively correct‚Äù result: structures with a large proportion of fragment intersections will come first. <br><br>  This approach to indexing and searching for molecules can be implemented by creating a special ‚Äú <a href="">chemical tokenizer</a> ‚Äù for Lucene.  The tokenizer is the Lucene component, which breaks the text into separate tokens (most often tokens are words).  I have already cited above the main logic of this tokenizer.  The difference will be that in the Lucene tokenizer it is not necessary to immediately receive all the tokens in the loop.  Instead, you need to implement the <a href="">Tokenizer.incrementToken ()</a> method, which will produce textual representations of chains of atoms one by one. <br><br>  There are several formats for the presentation of molecules as a text string.  For now, we‚Äôll dwell on the support of only one of them - the <a href="http://ru.wikipedia.org/wiki/SMILES">SMILES</a> format.  The CDK provides a SMILES string parser (org.openscience.cdk.smiles.SmilesParser class).  It is not difficult for them to use: <br><br><pre> <code class="java hljs">SmilesParser sp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SmilesParser(DefaultChemObjectBuilder.getInstance()); String smiles = <span class="hljs-string"><span class="hljs-string">"OCC(O)C(O)C(O)C(O)CO"</span></span>; <span class="hljs-comment"><span class="hljs-comment">//Sorbitol IAtomContainer structure = sp.parseSmiles( smiles ); //  -    ...</span></span></code> </pre><br>  The logic of converting the SMILES representation of molecules into a structure for the purpose of further cutting it into chain-tokens is placed in the <a href="">SmilesTokenizer</a> class. <br><br>  I will allow myself to omit a number of insignificant details, I will only say that the source code is <a href="https://github.com/AlexanderSavochkin/MolecularLucene">uploaded to GitHub</a> .  I will go straight to the example of using these classes to search for structures.  Suppose that the search documents contain three fields: name is the name of the chemical compound, description is a text description, and the smiles field is information about the structure of the molecule. <br><br>  Document indexing might look something like this (using the <a href="">SmilesAnalyzer</a> helper class, which simply creates the <a href="">SmilesTokenizer</a> ): <br><pre> <code class="java hljs">Map&lt;String,Analyzer&gt; analyzerPerField = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;String,Analyzer&gt;(); analyzerPerField.put(SMILES_FIELD, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SmilesAnalyzer() ); PerFieldAnalyzerWrapper analyzerWrapper = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PerFieldAnalyzerWrapper(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StandardAnalyzer(Version.LUCENE_40), analyzerPerField); Document doc = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Document(); doc.add( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TextField( <span class="hljs-string"><span class="hljs-string">"name"</span></span>, <span class="hljs-string"><span class="hljs-string">"Acetic acid"</span></span>, Field.Store.YES ) ); doc.add( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TextField( <span class="hljs-string"><span class="hljs-string">"description"</span></span>, <span class="hljs-string"><span class="hljs-string">"Acetic acid is one of the simplest carboxylic acids. Liquid."</span></span>, Field.Store.YES ) ); doc.add( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TextField( <span class="hljs-string"><span class="hljs-string">"smiles"</span></span>, <span class="hljs-string"><span class="hljs-string">"CC(O)=O"</span></span>, Field.Store.YES ) ); Directory directory = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; IndexWriter indexWriter = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { directory = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RAMDirectory(); IndexWriterConfig config = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IndexWriterConfig(Version.LUCENE_40, analyzerWrapper ); indexWriter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IndexWriter( directory, config); indexWriter.addDocument(doc); } ...</code> </pre><br>  The search will look something like this: <br><pre> <code class="java hljs">reader = IndexReader.open(directory ); IndexSearcher searcher = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IndexSearcher(reader); String querystr = <span class="hljs-string"><span class="hljs-string">"smiles:CCC"</span></span>; Query q = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; q = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QueryParser(Version.LUCENE_40, FREE_TEXT_FIELD, getAnalyzer()).parse(querystr); TopScoreDocCollector collector = TopScoreDocCollector.create(<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); searcher.search(q, collector); ScoreDoc[] hits = collector.topDocs().scoreDocs; <span class="hljs-comment"><span class="hljs-comment">// -      hits ...</span></span></code> </pre></div><p>Source: <a href="https://habr.com/ru/post/185420/">https://habr.com/ru/post/185420/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../185408/index.html">New Intel Perceptual Computing SDK released</a></li>
<li><a href="../185410/index.html">Fakebook. Concept of sanity</a></li>
<li><a href="../185412/index.html">Python Tools for Visual Studio, first-hand updates</a></li>
<li><a href="../185414/index.html">Programming Olympiad of the MIPT Summer School in Applied Mathematics and Physics</a></li>
<li><a href="../185418/index.html">Onyx Boox i63SL Kepler - reader based on Android</a></li>
<li><a href="../185422/index.html">Introduction to EagleMQ</a></li>
<li><a href="../185424/index.html">Reducing the cost of ownership of a large online store</a></li>
<li><a href="../185426/index.html">Reflections on the topic of user rating</a></li>
<li><a href="../185428/index.html">WordPress Command Prompt</a></li>
<li><a href="../185434/index.html">Photo review of cabinets of KUB-Ukraine plant</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>