<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Midnight Commander build environment - continued</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Start 

 In the first part, I introduced the new binary package building service for the Midnight Commander file manager for Debian / Ubuntu. The comm...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Midnight Commander build environment - continued</h1><div class="post__text post__text-html js-mediator-article">  <a href="http://habrahabr.ru/blogs/linux/128976/">Start</a> <br><br>  In the <a href="http://habrahabr.ru/blogs/linux/128976/">first part,</a> I introduced the new binary package building service for the Midnight Commander file manager for Debian / Ubuntu.  The comments rightly pointed out the lack of a technical description of the medium itself, and I promised that I would lay out the details as soon as the code was brought into a divine form.  Two weeks passed, a little time appeared to stabilize the functionality and brush the code (it is still terrible, but it seems to work as intended), so it's time to fulfill the promise. <a name="habracut"></a><br><br>  <b>I don't specifically include source codes in the topic, there are a lot of them, and in my opinion the article is overloaded.</b>  <b>Who <a href="http://code.google.com/p/mc-buildbot/">cares</a> , can download them with <a href="http://code.google.com/p/mc-buildbot/">googlecode</a> .</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Assembly environment </h3><br>  The build environment consists of several shell scripts: <br><ul><li>  <b>contrib / mc-release-builds.sh</b> is a script that runs as a CRON task and manages the assembly of new releases, or reassembly of already released ones. </li><li>  <b>contrib / mc-nightly-builds.sh</b> is a script that is also a CRON task and builds night slices. </li><li>  <b>contrib / prepare-environment.sh</b> - a script that initializes environment variables specific to my server (in particular, environment variables are exported for SSH and GPG agents) </li><li>  <b>The contrib / local-repo-update</b> script, with which I update my repository, is now thinking of abandoning apt-ftparchive and trying reprepro. </li><li>  <b>contrib / pbuilder</b> - configs for assembly purposes, one of them (contrib / pbuilder / buildbot) is used to prepare a package from source or GIT. </li><li>  <b>contrib / apt-ftparchive</b> - my settings for running apt-ftparchive (maybe someone will come in handy) </li></ul><br><h5>  Next come the scripts that make up the build environment itself: </h5><br><ul><li>  <b>build-mc-from-git.sh</b> - build a package from source or VCS (system kernel) </li><li>  <b>buildbot.sh</b> is a wrapper over the previous script, which is an intermediate link between the crown tasks, the user and the kernel of the build environment. </li><li>  <b>initial-build.sh</b> is an anachronism that has remained due to my natural laziness.  Adds a separate buildbot user to the pbuilder (buildbot) build target. </li></ul><br><h4>  build-mc-from-git.sh </h4><br>  As I mentioned earlier, this is the most important part of the build environment.  Performs two types of operations: build / reassemble releases and build night slices from GIT.  If the release build was chosen, then the script: <br><ul><li>  updates the local copy of the contrib / debian / directory from the repository, which is required to build the package (dh_make is not used when building the package) </li><li>  unpacks the archive with the source code, which is passed to the script as one of the arguments by the parent scripts or the user. </li><li>  checks if the source is going out of the box.  To do this, in the directory with unpacked sources, a familiar sequence of actions is performed: <br><pre><code class="bash hljs">[ -x ./autogen.sh ] &amp;&amp; ./autogen.sh ./configure --prefix=/usr --sysconfdir=/etc --libexecdir=/usr/lib/mc make make install DESTDIR=/tmp/install</code> </pre> <br>  If this stage passes without errors, then further problems with building the package indicate the need to revise the debian-specific part of the package (contrib / debian / directory in VCS) </li><li>  copies the debian / directory to the sources from the local VCS copy, checks if there is a local changelog for the source version (if a new revision of the package is being assembled, not a new release) and if it exists, then the changelog from the VCS is replaced with the local one. </li><li>  izrementiruet version and / or revision number and starts building the package through the call dpkg-buildpackage -rfakeroot -us -uc </li><li>  checks lintian package for compliance with Debian policy.  The lintian output is saved to a separate file.  (recently helped to catch an error in the man pages of nightly builds and send a patch to the upstream) </li></ul><br>  Building the night slice differs only in that the sources are generated from the GIT repository and the incrementing code is different.  If the script detects that there were no changes in the master branch of the repository, the assembly is interrupted. <br><br><h4>  buildbot.sh </h4><br>  This script calls build-mc-from-git.sh and in case of successful completion it does an additional check of the binary package in piuparts and if there are no errors, it starts the process of building the targets (squeeze-i386, squeeze-amd64, natty-i386, etc. .).  After each successful build, the repository temporary structure is updated.  If all the targets are collected successfully and buildbot.sh was called by one of the CRON tasks (mc-release-builds.sh or mc-nightly-builds.sh), then the update script of my repository is launched.  At this point, the APT service information is updated, the Release files are signed, and the server copy is updated. <br><br>  Now the full cycle of assembling 8 targets takes a little over an hour.  In the future, I will probably expand the targates on rpm-based distros (as far as I understand, upstream has not restored the normal operation of the previous buildbot).  Additional info or support is available on the <a href="http://code.google.com/p/mc-buildbot/">project page</a> . </div><p>Source: <a href="https://habr.com/ru/post/129989/">https://habr.com/ru/post/129989/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../129981/index.html">Buying Skype by Microsoft Corporation approved by the European Commission</a></li>
<li><a href="../129982/index.html">PHP under C-shny debugger: we dig inside Zend Engine</a></li>
<li><a href="../129983/index.html">Emacs keys in any Windows application</a></li>
<li><a href="../129984/index.html">The Japanese have created a portable stress meter</a></li>
<li><a href="../129986/index.html">Habra Informer v.0.1</a></li>
<li><a href="../129990/index.html">phpBBex is an enhanced version of phpBB 3</a></li>
<li><a href="../129991/index.html">ZBOX nano VD01 - Dual-core micro-PC with FullHD support</a></li>
<li><a href="../129993/index.html">Eero - Objective-C without parentheses</a></li>
<li><a href="../129994/index.html">Fragmentation?</a></li>
<li><a href="../129998/index.html">10 Practical WordPress Shortcodes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>