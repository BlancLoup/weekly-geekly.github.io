<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Determining the dominant tones in the image</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Prehistory 
 A long time ago, when my knowledge of PHP was at the level of operations and output, and I found a very useful class written by Kalpeh Ga...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Determining the dominant tones in the image</h1><div class="post__text post__text-html js-mediator-article"><h4>  Prehistory </h4><br>  A long time ago, when my knowledge of PHP was at the level of operations and output, and I found a very useful class written by Kalpeh Gamit, its site has long been unavailable, so unfortunately I can‚Äôt leave contacts.  The class is distributed under the name GetImageColor and licensed under the GPL 2.0. <br><br>  I used this class often.  It accepts an image as an input parameter (only in JPEG format, but is supplemented with all the others in a minute), the number of returned colors and the processing step.  The script reads the color from the photo with the specified step and enters it into an array of colors.  The resulting array is sorted by color entries and only the specified number of colors is returned. <br><a name="habracut"></a><br><br>  Very handy script for many tasks.  Personally, I needed it in the first version of Fotokiosk, with the help of a script I defined monochromatic photos and did not allow them to be uploaded to the server (too dark, illuminated, etc.).  Later in LetPrint, I applied it to determine whether the sheet is full and chromatic. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Today saw article on Habr√©: <a href="http://habrahabr.ru/blogs/web_design/136343/">habrahabr.ru/blogs/web_design/136343</a> <br><img src="https://habrastorage.org/storage2/0da/d34/c9e/0dad34c9ee3c1b4219d0ea8fd5bd7062.png"><br><br>  I was interested in this.  The image chosen is not just common colors, but dominant or contrasting colors.  Remembering what the class would give out, I realized that another solution was needed. <br><img src="https://habrastorage.org/storage2/317/fd2/e24/317fd2e242423c6d07b32c7f564275df.jpg"><br><br><h4>  Decision </h4><br>  Actually, a similar script may work well for them, but they add the final color options manually, which is most likely happening, because the presence of the selected colors is not so dominant in the picture.  And the colors are too soft.  But maybe they are just smoothing similar colors, which I noticed. <br><br>  The next stage is an attempt to achieve smoothing.  We need an algorithm that would process the array with the available colors, select similar colors in it and find the smoothed color, and so on until 5 main ones were selected. <br><br>  It was not difficult to write such an algorithm, but the search for similar ones slowed me a little.  Although I did not understand him for a long time, I still found the handicraft solution easily. <br><br>  Our color consists of three components: R + G + B.  All these values ‚Äã‚Äãfrom 0 to 255. The colors 250,100,100 and 240.90.90 are similar, but the second is darker than the first, but they are nonetheless similar.  Color 245,100,100 is also similar to the first two, but to a lesser extent.  Actually here the error begins.  The first two colors are similar, but 255,255,255 and 0,0,0 are similar and it immediately discards black and white photographs.  Also, due to the similarity of the first two and third, shades are discarded.  But we are ready for such sacrifices. <br><br>  The number of similarities - | RG |. | RB |. | BG |, also for introducing similar shades, the difference itself is also processed dif = round (round (| RG | / pogr) * pogr).  By the pogr coefficient, we introduce an error.  For example, if pogr = 10, then the colors 254,180,35 and 234,163,19 are similar.  The greater the error, the more similar shades we will combine. <br><br>  After you must consider the weight of the color, smooth the array into a single color.  We have an array of similar colors.  Each 2 parameters - color and number of entries.  The actually smoothed color will consist of R = SUM (Ri * mi) / SUM (mi), where mi is the number of occurrences of this color, also with the other components of G and B. This means that since we are black and white, as a result of the algorithm, we get a gray, which may not be present in the picture, but which will completely reflect the mixture of black and white. <br><br>  With the resulting array, we perform these operations again and again until we achieve the result.  At some point, the algorithm may simply stall, so the sampling error of similar <b>pogr increases</b> with each iteration. <br><br><h4>  Result </h4><br>  As a result, the processing speed of this algorithm is very high.  The tones in the majority correspond to those in the figure, but some errors are obvious, which are quite difficult to eliminate in simple ways.  By and large, this is pampering, until I figured out where to use it, but it may well be a good thing for designers. <br><img src="https://habrastorage.org/storage2/623/dda/8d8/623dda8d8408ff49599c5d1a3dc9a3fb.jpg"><br>  You can try the algorithm in action here: <a href="http://blog.assorium.ru/jpeg">blog.assorium.ru/jpeg</a> <br>  My server is weak, so I will ask you not to push it hard.  Restrictions: JPEG images with a weight of no more than 500 KB. <br><br><h4>  Alternative solutions </h4><br>  The easiest way to solve this problem is a catalog of tones.  I already bumped into him somewhere.  They offered the most frequently used and pleasant colors.  The catalog consisted of several thousand colors, which would be quite enough for this script.  The processing basically remains the same, but when smoothed, a color from the catalog is added to the final array, which is similar to the current one and so on until several colors remain.  The advantage of the method is obvious, you will get a color that is good in itself and will not cut the eye and at the same time will reflect the essence of the picture. <br><br>  The second way is to search by contrast.  In this case, the number of occurrences of a color is not considered, but the colors themselves are considered directly.  By iteration, contrasting shades are selected and smoothed according to their gradients.  This method has not yet been considered by me, but I think if I have time, I will take it.  Its advantage is in the exact essence of the picture.  It will give exactly those colors that are highlighted in the image.  Search in contrast in this case will be better than the other two. <br><br>  <b>UPD_1</b> There are a lot of naked women among the uploaded photos.  Why would anyone find out the tone of the naked body? <br>  <b>UPD_2</b> <a href="http://habrahabr.ru/users/4utep/" class="user_link">4utep</a> found a ready-made solution, but with the help of HSV and a certain set of colors.  <a href="http://derickrethans.nl/finding-out-colours.html">link</a> <br>  <a href="http://habrahabr.ru/users/push_ok/" class="user_link">Push_Ok</a> prompted the ‚ÄúCIE color difference formula‚Äù.  Perhaps it will improve the definition of similar.  Until I determined how much.  <a href="http://ru.wikipedia.org/wiki/%25D0%25A4%25D0%25BE%25D1%2580%25D0%25BC%25D1%2583%25D0%25BB%25D0%25B0_%25D1%2586%25D0%25B2%25D0%25B5%25D1%2582%25D0%25BE%25D0%25B2%25D0%25BE%25D0%25B3%25D0%25BE_%25D0%25BE%25D1%2582%25D0%25BB%25D0%25B8%25D1%2587%25D0%25B8%25D1%258F">link</a> <br>  <b>UPD_3</b> More than 1500 pictures were loaded per day.  Thanks to the habrayusers for the epic pictures of the past three months and a considerable amount of erotica.  Among the pictures even caught instances asking for an invite.  My hoster made me very happy.  The site did not fall down and never slowed down. </div><p>Source: <a href="https://habr.com/ru/post/136530/">https://habr.com/ru/post/136530/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../136520/index.html">Automatic spell checker in EXCEL</a></li>
<li><a href="../136525/index.html">LESS: programmable style language</a></li>
<li><a href="../136527/index.html">LG Electronics in 2012. Plans and business tasks</a></li>
<li><a href="../136528/index.html">Developing a compiler for the cool language in C # for .NET (Part 1)</a></li>
<li><a href="../136529/index.html">Writing a simple plugin for Sublime Text 2</a></li>
<li><a href="../136531/index.html">Passive XSS in Yandex.Money</a></li>
<li><a href="../136533/index.html">DWM - minimalism in action</a></li>
<li><a href="../136534/index.html">Support The Daily WTF in support of the SOPA movement</a></li>
<li><a href="../136536/index.html">Reflections on Foggy Computing</a></li>
<li><a href="../136537/index.html">Centralized collection, storage and viewing of Syslog on Debian Linux</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>