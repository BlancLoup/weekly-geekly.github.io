<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>My experience with Webrtc</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello habraudi 

 In this topic I want to tell you about my experience with SIP telephony via webrtc. Tell about what problems I met, what software I ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>My experience with Webrtc</h1><div class="post__text post__text-html js-mediator-article">  Hello habraudi <br><br>  In this topic I want to tell you about my experience with SIP telephony via webrtc.  Tell about what problems I met, what software I tried, what crutches I wrote :). <br><br><h4>  What was used: </h4><br><ul><li>  Asterisk 11.5.1 </li><li>  GSM gateway </li><li>  Sipml5 </li></ul><br><a name="habracut"></a><br><h4>  Start: </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Initially, the task was to provide a working telephony in the browser.  Once the task is set, it means it must be done.  We decided not to use flash dialers, but try to call via webrtc.  From js dialers were JSSIP and SipML5.  I decided to use it in the SipML5 project. <br><br>  First, we started using asterisk + webrtc2sip.  Everything worked fine, but there was a problem with a very long incoming call connection.  The problem disappeared after the restart of webrtc2sip.  Googling, I learned that the asterisk can work with webrtc. <br>  Made also as it is described in vik sipml5.  Collected, checked - it works.  Gash all, ruined dialplans, connected GSM gateway.  Everything worked well, the problem went away, but other problems appeared: <br><ul><li>  Asterisk began to fall when you click on the hold </li><li>  There is no call, and sipml is ringing </li></ul><br><br>  Seeing that the latest version of Asterisk 11.5.1, I decided to upgrade. <br>  Collected, launched - works fine and without patches.  But problems also remained. <br>  Commenting out in rtp.conf <br> <code>stunaddr=stun.l.google.com:19302 <br></code> <br>  When holding a call, the asterisk stopped falling.  But the second problem remained. <br><br>  I decided to reset the call if the operator did not pick up the phone within four seconds. <br>  For this added on 'i_new_call' <br><br><pre> <code class="javascript hljs">setTimeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!ctx.is_active) { ctx.sip_hangup(); } }, <span class="hljs-number"><span class="hljs-number">4200</span></span>);</code> </pre><br><br>  The problem is gone.  but there was another.  If you place a call to hold, you cannot hear either the operator or the client leaving the hold. <br><br>  Armed with wireshark went to see what was the matter.  It turned out that if the call is removed from the hold, the connection comes from another port.  Obviously, the solution is not to use hold as it is, but simply turn the microphone on / off to the operator. <br><br><pre> <code class="javascript hljs">audio_tracks = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.session_call.o_session.o_stream_local.getAudioTracks(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>, l = audio_tracks.length; i &lt; l; i++) { audio_tracks[i].enabled = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre><br><br>  By chasing everything seemed to work as it should, but there was a periodic silence with the incoming call. <br><br>  Well, the problem here turned out to be that the GSM gateway was connected to an asterisk from a private network.  Migrated everything to public addresses.  And this problem is gone <br><br><h4>  Conclusion </h4><br>  I hope this article will help someone in setting up telephony via webrtc. <br>  Experienced dudes please forgive.  First experience with telephony </div><p>Source: <a href="https://habr.com/ru/post/203568/">https://habr.com/ru/post/203568/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../203544/index.html">How to transfer data from Yandex.Direct and Google AdWords advertising systems to Google Analytics</a></li>
<li><a href="../203548/index.html">Caching Tutorial Part 1</a></li>
<li><a href="../203550/index.html">Creating games for Windows Store using WebGL</a></li>
<li><a href="../203560/index.html">Apple buys PrimeSense - developer of 3D sensors Kinect</a></li>
<li><a href="../203566/index.html">Internet and trust in people</a></li>
<li><a href="../203570/index.html">Selling design online store. Part 2. Interface elements</a></li>
<li><a href="../203574/index.html">What makes a good programmer good?</a></li>
<li><a href="../203576/index.html">Legendary cryptographer Diffie tried to stop the patent troll</a></li>
<li><a href="../203578/index.html">How to curb the gain recording in SSD?</a></li>
<li><a href="../203580/index.html">Cognitive PDF / A - the technology of digitizing text documents for publication on the Internet and long-term archiving</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>