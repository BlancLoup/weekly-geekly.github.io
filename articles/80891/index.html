<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MVC 2: Validation Model</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is the second part of a series of articles on upcoming innovations in ASP.NET MVC 2, the release of which is just around the corner. This post is...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MVC 2: Validation Model</h1><div class="post__text post__text-html js-mediator-article"><img src="http://img695.imageshack.us/img695/3133/aspnetmvc2.png" alt="asp.net mvc 2" align="left"><br>  This is the second part of a series of articles on upcoming innovations in ASP.NET MVC 2, the release of which is just around the corner.  This post is dedicated to validation enhancements added to ASP.NET MVC 2. <br><a name="habracut"></a><br><h4>  ASP.NET MVC 2 validation </h4><br>  Validation of user data, vital business logic and rules are a key requirement of most web applications.  ASP.NET MVC 2 offers a wealth of new features that greatly facilitate the implementation of user data validation and validation logic of models and presentation models.  The new functionality is designed based on mandatory server-side validation, but can also be additionally implemented on the client side using JavaScript.  The validation infrastructure and functionality in ASP.NET MVC 2 is implemented as follows: <br>  1) Developers can easily use the DataAnnotation validation built into the .NET Framework.  DataAnnotation allows, in an easy way, to declaratively add validation rules to objects and properties using the minimum amount of code. <br><br>  2) Developers can additionally integrate their validation engine or use third-party frameworks: Castle Validator, EntLib Validation Library.  ASP.NET MVC 2 validation capabilities are designed with ease of extending the validation architecture. <br><br>  This means that validation is very simple in a number of common cases, while retaining flexibility for expansion. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Connection Validations in ASP.NET MVC 2 and DataAnnotation </h4><br>  Let's look at a simple CRUD script, where we will use the new functionality - DataAnnotation.  Specifically, create a form ‚ÄúCreate‚Äù, which will add a friend to the user: <br><br><img src="http://weblogs.asp.net/blogs/scottgu/image_thumb_5F17F852.png" alt="image"><br><br>  Before saving to the database, we want to make sure that the entered information is correct, and if not, output the appropriate error message: <br><br><img src="http://weblogs.asp.net/blogs/scottgu/image_thumb_63AE030C.png" alt="image"><br><br>  We want the validation to take place on two sides - the server and the client, and also we want to make sure that the code conforms to the DRY principle (‚Äúdon't repeat yourself‚Äù) - we apply the validation rules once, after that all controllers, actions and views follow their. <br><br>  I implement this scenario using VS 2010, but you can also do this in VS 2008. <br><br><h4>  Step 1: Create FriendsController (for starters, without validation) </h4><br>  Let's start by adding a simple ‚ÄúPerson‚Äù class to a new ASP.NET MVC 2 project: <br><br><img src="http://weblogs.asp.net/blogs/scottgu/image_thumb_36B8A031.png" alt="image"><br><br>  The class has four properties created using <a href="http://msdn.microsoft.com/ru-ru/library/bb384054.aspx">automatically implemented properties</a> in C # that appeared in VB with VS 2010. <br><br>  Let's add to our project the class controller ‚ÄúFriendsController‚Äù, which we will extend with two methods of ‚ÄúCreate‚Äù actions.  The first method is called during the GET request / Friends / Create - it will display an empty form for entering data about a person.  The second method is called during the POST request / FriendsCreate - it binds the entered form data to the Person object, checks for errors during binding and, if no errors have occurred, ultimately saves it to the database (we implement the database operation implementation a little later) .  If the data entered into the form contains errors, the method will return the form with errors to the user: <br><br><img src="http://weblogs.asp.net/blogs/scottgu/image_thumb_1558FA95.png" alt="image"><br><br>  After creating our controller, we can right-click on one of the action methods and select ‚ÄúAdd View‚Äù, we will use the scaffolding to create a ‚ÄúCreate‚Äù view that accepts the Person object: <br><br><img src="http://weblogs.asp.net/blogs/scottgu/image_thumb_0569B5D1.png" alt="image"><br><br>  Visual Studio will generate for us the Create.aspx view file in the \ Views \ Friends directory of our project.  Notice the use of <a href="http://habrahabr.ru/blogs/aspnet_mvc/80546/">strongly typed HTML helper methods</a> : <br><br><img src="http://weblogs.asp.net/blogs/scottgu/image_thumb_43169D8D.png" alt="image"><br><br>  And now, when we run the application and go to / Friends / Create, we‚Äôll get an empty data entry form: <br><br><img src="http://weblogs.asp.net/blogs/scottgu/image_thumb_67C7B504.png" alt="image"><br><br>  At the moment, nothing will stop us from entering incorrect data. <br><br><h4>  Step 2: Add Validation Using DataAnnotation </h4><br>  We will strengthen our application with simple rules for validating incoming data.  We will implement these rules in the Person model, not in the controller or view.  This approach will provide validation in any scenarios in our application that uses the Person object (for example, if we add an editing script), and also ensures that the code complies with the DRY principle and eliminates duplication of rules in different parts of the code. <br><br>  In ASP.NET MVC 2, developers can easily add declarative validation attributes to the model or view model classes that are later used in the model-binding operation.  To see this in action, let's update the Person class by adding a few attributes.  Add the ‚Äúusing‚Äù definition for the ‚ÄúSystem.ComponentModel.DataAnnotations‚Äù namespace, and then create the Person properties using the validation attributes [Required], [StringLength], [Range] and [RegularExpression] <br><br> <a href=""><img src="http://weblogs.asp.net/blogs/scottgu/image_thumb_576C3D4B.png" alt="image"></a> <br>  <i>Pay attention to the declaration of the text of errors as strings.</i>  <i>You can declare them in resource files and localize depending on the user‚Äôs chosen language or culture.</i>  <i>More details about the localization of validation errors <a href="http://haacked.com/archive/2009/12/12/localizing-aspnetmvc-validation.aspx">here</a> .</i> <br><br>  And so, when we added validation attributes to the Person class, let's restart our application to see the reaction to incorrectly entered data, sending it to the server: <br><br><img src="http://weblogs.asp.net/blogs/scottgu/image_thumb_554F3E82.png" alt="image"><br><br>  Noticed how everything went well with us?  The error text is reddened, and the error itself is displayed next to the field.  The form saves the entered data, so we eliminate the need to re-enter the user.  And how the hell is all this happening? <br><br>  To understand how this works, let's take a look at the Create action method, which handles a POST request for our form: <br><br><img src="http://weblogs.asp.net/blogs/scottgu/image_thumb_3A366F74.png" alt="image"><br><br>  When our HTML form returns data to the server, the above method is called.  Since the action method takes a Person object as a parameter, ASP.NET MVC will create a Person object and automatically associate the input form data with its values.  Just as part of this process, a check will be made for compliance with the validation rules of the DataAnnotation of the Person object.  In case of successful verification, ModelState.IsValid returns true and we will save the result in the database and transfer the user to the home page. <br><br>  If any validation error occurs, our action method will again display the form with incorrect Person object data.  This is implemented using the last line in the above code. <br><br>  Error messages are displayed on the page due to the auxiliary method &lt;% = Html.ValidationMessageFor ()%&gt; after each &lt;% = Html.TextBoxFor ()%&gt; in the form Create.  The Html.ValidationMessageFor () helper method will display the corresponding error message for any non-valid model property passed to the view: <br><br><img src="http://weblogs.asp.net/blogs/scottgu/image_thumb_263CDCDE.png" alt="image"><br><br>  The convenience of this pattern in the ease of implementation in the code, as well as the ease of adding or changing the validation rules of our Person class, without the need to change the code outside the model.  The ability to define validation rules in one place and enforcing these rules anywhere in the application allows us to quickly develop our application with minimal effort, while avoiding duplication of code. <br><br><h4>  Step 3: Add Client-Side Validation </h4><br>  Currently, our application only supports server-side validation, which requires the user to send data to the server before he sees any error message. <br><br>  One of the goodies in ASP.NET MVC 2 is the validation architecture, which supports server and client validation.  To do this, we just need to add two JavaScript scripts in the view and write one line of code: <br><br><img src="http://weblogs.asp.net/blogs/scottgu/image_thumb_1D6CD492.png" alt="image"><br><br>  After adding three lines, ASP.NET MVC 2 will use the validation metadata we specified in the Person class and will create client-side validation logic using JavaScript.  The user will see an error as soon as he switches to another element. <br><br>  To see the test on the client in action, restart the application and fill in the first three text fields with valid data, and then try to click "Create".  Notice how we got the error information, no sending data to the server happened: <br><br><img src="http://weblogs.asp.net/blogs/scottgu/image_thumb_02C03879.png" alt="image"><br><br>  If we enter text that is not a valid email address, the error immediately changes from ‚ÄúEmail required‚Äù to ‚ÄúNot a valid email‚Äù, both of which we announced earlier in the Person class: <br><br><img src="http://weblogs.asp.net/blogs/scottgu/image_thumb_6C8A1D26.png" alt="image"><br><br>  When we enter a valid email address, the error message will disappear and the background of the text field will return to its normal state: <br><br><img src="http://weblogs.asp.net/blogs/scottgu/image_thumb_4000ED40.png" alt="image"><br><br>  We do not need to write any custom javascript code to add validation logic.  Our code is still consistent with the principle of DRY. <br><br>  For security reasons, validation rules always run on the server, even if you have enabled client-side validation.  This prevents hackers from trying to cheat your server bypassing validation on the client. <br><br>  Client JavaScript validation can work with any framework / engine that you use with ASP.NET MVC.  There are no restrictions on using DataAnnotation, the entire infrastructure works independently of DataAnnotation and can work with the Castle Validator, EntLib Validation Block or any other solution. <br><br>  If you do not want to use our javascript files, you can replace them with the jQuery validation plugin and use it.  The ASP.NET MVC Futures add-on will include jQuery validation support. <br><br><h4>  Step 4: Create your own (email) validation attribute </h4><br>  The System.ComponentModel.DataAnnotations namespace contains several built-in validation attributes that you can use.  We have already used four - [Required], [StringLength], [Range] and [RegularExpression]. <br><br>  But you can declare your own validation attribute and use it.  You can create a completely new attribute inheriting from the ValidationAttribute class, which is in the System.ComponentModel.DataAnnotations namespace.  And you can create an attribute based on existing ones, if you want to simply extend their functionality. <br><br>  For example, to keep the code clean in our Person class, we want to create a new validation attribute [Email] that encapsulates a regular expression to validate email addresses.  The easy way is to inherit from the RegularExpression class and call the constructor of the RegularExpression class with the corresponding regular expression: <br><br><img src="http://weblogs.asp.net/blogs/scottgu/image_thumb_1EA147A4.png" alt="image"><br><br>  Now we can update the Person class and use our new validation attribute [Email] instead of the previous regular expression, agree - the code has become cleaner: <br><br><img src="http://weblogs.asp.net/blogs/scottgu/image_thumb_4EE81C5A.png" alt="image"><br><br>  When you create your own validation attribute, you can define validation rules for the server and client. <br><br>  Finally, to create your own attributes that refer to the individual properties of an object, you can access the validation attributes at the class level.  This allows you to implement logic in conjunction with several properties in the object.  For example, you can look at the ‚ÄúPropertiesMustMatchAttribute‚Äù attribute, which is located in the AccountModels.cs / vb file in the standard ASP.NET MVC 2 application template (File&gt; New ASP.NET MVC 2 Web Project in VS 2010). <br><br><h4>  Step 5: Go to the database </h4><br>  And now let's implement the logic needed to save our friends to the database. <br><br><img src="http://weblogs.asp.net/blogs/scottgu/image_thumb_4618140E.png" alt="image"><br><br>  We now use the old-style C # class (often referred to as the ‚ÄúPOCO‚Äù class - ‚Äúplain old CLR object‚Äù).  One approach is to write a separate code that binds the existing class to the database.  Today, such solutions based on object-relational projection (ORM), like NHibernate, perfectly support the POCO communication style.  The ADO.NET Entity Framework (EF) that comes out with .NET 4 also supports POCO communication and, like NHibernate, additionally supports the ability to communicate through code without using any communication files or constructor. <br><br>  If our Person object was connected to the database in one of the following ways, then we do not need to make any changes to the Person class. <br><br>  <b>What if we use a visual tool for our ORM links?</b> <br><br>  Today, many developers using Visual Studio do not write their own ORM-logic of links, but use the constructors built into VS to solve this problem. <br><br>  Often the question arises when using DataAnnotation (or any other form of attributes based on validation) - ‚Äúhow do you apply rules when the object model that you work with is created using a GUI constructor?‚Äù.  For example, if we replace the Person class, designed in the POCO style, we will create the Personal class in Visual Studio using the LINI to SQL or ADO.NET EF GUI-relations tool: <br><br><img src="http://weblogs.asp.net/blogs/scottgu/image_thumb_2B6B77F5.png" alt="image"><br><br>  In the screenshot, you see the Person class, declared using the ADO.NET EF constructor in VS 2010. The upper window defines the Person class, the lower one displays the link editor, namely, how properties are bound to the People database table.  After saving, the class Person is automatically generated.  This is convenient, except that with each change you will need to save the file, which will lead to a complete regeneration of the Person class and you will lose all declared validation attributes. <br><br>  A solution that will help to apply additional attribute metadata to the automatically created class is the friendly classes.  In fact, you create a separate class that contains your validation and metadata attributes, and then bind it to the generated class by applying the ‚ÄúMetadataType‚Äù attribute to the generated partial-class.  For example, we want to apply the validation rules that we used earlier to the Person class created using the LINQ to SQL or ADO.NET EF constructor. To do this, we move our validation code to the Person_Validation class and link it to the Person class: <br><br><img src="http://weblogs.asp.net/blogs/scottgu/image_thumb_6265562E.png" alt="image"><br><br>  This option is inferior in elegance to the POCO version, but it has an advantage in working with most tools or with code generated by designers in Visual Studio. <br><br><h4>  The last step is to save the Friend to the database. </h4><br>  Our last step, regardless of the approach we used: POCO or the Person class generated by some tool, will be saving Friend valid objects to the database. <br><br>  To do this, we replace the ‚ÄúTodo‚Äù tag in the FriendsController class with three lines of code that will save the new friend to the database.  Below is the full version of the FriendsController class that works with ADO.NET EF: <br><br><img src="http://weblogs.asp.net/blogs/scottgu/image_thumb_1554E696.png" alt="image"><br><br>  Now that we visit the URL / Friends / Create, we can easily add a new People object to our friends list in the database: <br><br><img src="http://weblogs.asp.net/blogs/scottgu/image_thumb_4000ED40.png" alt="image"><br><br>  Validation of all data occurs on the client and on the server.  We can easily add / change / delete validation rules and they will be used without fail by any controller or view in our application. <br><br><h4>  Let's sum up </h4><br>  ASP.NET MVC 2 makes it much easier to integrate validation into web applications.  Offers a model-based validation approach that avoids duplication of code in different places and also ensures that validation rules are guaranteed to be used throughout the application.  Built-in support for DataAnnotation allows you to implement common validation options out of the box.  Supporting the extensibility of the validation infrastructure allows you to implement various validation scenarios and include any validation frameworks. </div><p>Source: <a href="https://habr.com/ru/post/80891/">https://habr.com/ru/post/80891/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../80881/index.html">Friends, Shukh leaves TM and Habr</a></li>
<li><a href="../80882/index.html">First tablet</a></li>
<li><a href="../80883/index.html">Not quite a normal VPN connection using conventional tools.</a></li>
<li><a href="../80885/index.html">Rails 2.3.5 + mod_rails + MAMP on OSX Tiger</a></li>
<li><a href="../80887/index.html">Visual Studio "Myth Busting Matrix"</a></li>
<li><a href="../80893/index.html">Programming in tables is a new concept of recording conditional (and not only) constructions.</a></li>
<li><a href="../80894/index.html">Corbina / Beeline - delayed payments by cards per day</a></li>
<li><a href="../80896/index.html">Alternative telephony (or VOIP is not only SKYPE)!</a></li>
<li><a href="../80899/index.html">Lukashenko created a special service for the Internet</a></li>
<li><a href="../80900/index.html">Cross Site Authorization 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>