<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Screen rotation during long-term operation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 When developing virtually any application with a user interface, the programmer sooner or later encounters a situation when a long-term...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Screen rotation during long-term operation</h1><div class="post__text post__text-html js-mediator-article"><h2>  Introduction </h2><br>  When developing virtually any application with a user interface, the programmer sooner or later encounters a situation when a long-term operation is necessary.  During a long-term operation, the user is usually shown a ‚ÄúPlease Wait ...‚Äù window or something like that. <br><br>  Android platform, and probably many other platforms do not allow performing long-term operations in the UI stream.  When performing a long-term operation in a UI thread, you simply hang the program. <br><br>  Android offers <a href="https://developer.android.com/reference/android/os/AsyncTask.html">AsyncTask</a> solutions for this kind of tasks.  AsyncTask allows you to perform long-term operation and interact with the UI stream. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Problem </h3><br>  It would seem nothing complicated, we create AsyncTask and pass the pointer to the current Activity to the created AsyncTask and everything is ready, the background process works, updates the UI, everyone is happy. <br><br>  Everything works fine until the screen orientation changes (Portrait ‚Üí Landscape, Landscape ‚Üí Portrait), or the application is not sent to the background.  Usually with this approach, after changing the orientation of the screen, the application crashes. <br><a name="habracut"></a><br><h3>  Why does the application crash? </h3><br>  Because when you change the orientation of the eran, Android recreates the Activity, as a result of the Activity to which you passed the AsyncTask link, it has already been destroyed and your AsyncTask is trying to interact with the destroyed object. <br><br><h3>  Solutions </h3><br>  All solve the problem in different ways, I will not describe all the proposed methods of solving, you can find them googling or in various blogs or on StackOverflow. <br><br>  Each of the approaches requires the implementation of certain tweaks, additional tests, debugging, writing additional code or limiting the capabilities of the user interface. <br>  Faced with this problem, I was very annoyed that for such a trivial task there was no ready-made boxed solution (in any case, I did not find it). <br><br><h2>  Can i try </h2><br>  Please do not judge strictly and do not consider self-publicity, I just want to write how I solve this problem and share the solution with others. <br><br>  I wrote some semblance of the framework (I think that the framework is too loud for my solution, but due to the nature of the use, the framework is still similar) and posted it on Github. <br><br>  <u>The source codes are open, the Apache 2.0 license</u> , I‚Äôll emphasize once again that I don‚Äôt sell anything, do not impose or beg.  The framework is called <a href="https://github.com/mkabramyan/Asmyk/wiki">Asmyk</a> . <br><br><h3>  How does it work </h3><br>  When activating an Activity (onResume event), the Activity is marked in the context of the application.  Next, the background task addresses the UI of the Activity task from the context. <br><br>  Nothing complicated, however, when implementing this scheme, a novice programmer can be a bit complicated and will have to spend a couple of days to implement a quality solution. <br><br><h3>  How to implement </h3><br>  Download the <a href="">AAR</a> file and <a href="https://stackoverflow.com/questions/16682847/how-to-manually-include-external-aar-package-using-new-gradle-android-build-syst/34919810">connect to the project</a> . <br><br>  If you do not extend the Application class with your implementation, specify the attribute in the application tag in the AndroidManifest.xml file: <br><br><pre><code class="xml hljs">android:name="net.mabramyan.asmyk.core.AsmykApplicationContext"</code> </pre> <br>  Example: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">...</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"net.mabramyan.asmyk.core.AsmykApplicationContext"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">...</span></span></span><span class="hljs-tag"> &gt;</span></span> ...</code> </pre><br>  If you extend the Application class with your implementation, you must inherit your implementation from the AsmykApplicationContext class. <br><br>  Activity with which you will work from the background should be inherited from AsmykCompatActivitiy. <br>  <b>Note:</b> You can inherit at least all your Activity from AsmykCompatActivitiy. <br><br><h2>  Example </h2><br><h3>  UI "Please wait ..." </h3><br>  Create an Activity inherited from AsmykPleaseWaitActivity or from AsmykBasicPleaseWaitActivity. <br><br><h4>  What you need to implement for AsmykPleaseWaitActivity </h4><br>  The method describes the actions that the Activity should perform when updating the status of the operation.  The progressObj object will be passed from AsmykPleaseWaitTask: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onProgress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Object progressObj)</span></span></span></span></code> </pre> <br>  The method describes the actions that the Activity should perform when the operation fails.  The errorObj object will be passed from AsmykPleaseWaitTask. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onFail</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Object errorObj)</span></span></span></span></code> </pre> <br>  The method describes the actions that the Activity should perform if the operation is successful.  The successObj object will be passed from AsmykPleaseWaitTask. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onSuccess</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Object successObj)</span></span></span></span></code> </pre> <br><h4>  What you need to implement for AsmykBasicPleaseWaitActivity </h4><br>  The method describes the actions that the Activity should perform if the operation is successful.  The successObj object will be passed from AsmykPleaseWaitTask: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onSuccess</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Object successObj)</span></span></span></span></code> </pre> <br>  The onFail and onProgress methods are already implemented.  As arguments, take a String describing the error or describing the new state of the background task, respectively. <br><br><h3>  Background task </h3><br>  Next, create a background task by implementing the AsmykPleaseWaitTask class.  You will have to implement just one method describing your background task: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doInBackground</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> AsmykApplicationContext ctx)</span></span></span></span></code> </pre> <br>  During the execution of the task, you can call the <code>void fireProgress(AsmykApplicationContext ctx, final Object progressObj)</code> method <code>void fireProgress(AsmykApplicationContext ctx, final Object progressObj)</code> - this method will subsequently cause onProgress to your AsmykPleaseWaitActivity.  When the task is completed, call the fireSuccess or fireFailed method, depending on the result of the operation. <br><br><h3>  Launch </h3><br>  An example of calling a background task: <br><br><pre> <code class="java hljs">pleaseWaitTask.start((AsmykApplicationContext) MainActivity.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getApplicationContext()); Intent intent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(MainActivity.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, PleaseWaitActivity.class); startActivity(intent);</code> </pre><br>  <b>Attention:</b> AsmykPleaseWaitTask will actually start the task execution only after the Activity inherited from AsmykPleaseWaitActivity is displayed. <br><br>  This is done so that the background task is not completed before the Activity is shown. <br><br>  An example of a simple application you can see <a href="https://github.com/mkabramyan/Asmyk/tree/master/app/src/main/java/net/mabramyan/asmyk">here</a> . <br><br><h2>  Appeal to commenting </h2><br>  Thanks for reading and taking the time to comment. <br>  I am for criticism if it is constructive. <br>  In order to make the post useful for other readers, let's do this: <br>  If you think any code constructs are wrong, describe why. <br>  If you offer a method that is more convenient or more correct than the one described above, apply your solution to the task (this is the main task that the above framework solves): <br>  1) We have already received a piece of data from the user for registration, the user clicks "Continue" <br>  2) Perform registration step 1. N different requests are sent sequentially.  Here I want to show the user what the program is doing right now.  At the same time, rotate the screen, etc.  should not interrupt the registration process. <br>  From my point of view, there can be many such tasks in a real application. <br><br>  PS I suppose if we put real examples, the post will be as useful as possible. <br><br>  That's all I wanted to say!  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/330646/">https://habr.com/ru/post/330646/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../330636/index.html">Service of the future: opportunities and risks</a></li>
<li><a href="../330638/index.html">By magic ... (Pike programming language)</a></li>
<li><a href="../330640/index.html">No edits. How to become the happiest designer on the planet</a></li>
<li><a href="../330642/index.html">Is it always safe to encrypt or recover data from an external hard drive Prestigio Data Safe II</a></li>
<li><a href="../330644/index.html">Red-black trees: short and clear</a></li>
<li><a href="../330648/index.html">Solving linear programming problems using Python</a></li>
<li><a href="../330650/index.html">Ruby on Rails agreement. Part 4</a></li>
<li><a href="../330654/index.html">Dialectics of Neural Machine Translation</a></li>
<li><a href="../330656/index.html">Integration React and DataTables - not as hard as advertised</a></li>
<li><a href="../330658/index.html">How to make a beautiful avatar? New social media marketing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>