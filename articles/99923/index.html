<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Handling Excel Files Using Python</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At work, I had to face the task of processing xls files with python tools. A little google, I came across several libraries with which you can work wi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Handling Excel Files Using Python</h1><div class="post__text post__text-html js-mediator-article"><img src="http://img529.imageshack.us/img529/4537/pythonexcellogos.png" alt="image"><br>  At work, I had to face the task of processing xls files with python tools.  A little google, I came across several libraries with which you can work with excel files. <br><a name="habracut"></a><br>  Libraries: <br>  - xlrd - allows you to read Excel files <br>  - xlwt - create and populate Excel files <br>  - xlutils - a set of utilities for expanding the capabilities of the previous two libraries <br>  - pyExcelerator - also gives you the opportunity to work with Excel files, but has not been updated for a long time. <br><br>  For my task I used the first three libraries. <br>  The task was divided into several parts: reading a file with the xls extension;  creating a new one and filling it out;  create a copy of the file based on the input file;  delete the necessary lines in the output file. <br><br><h4>  Read input file </h4><br>  This task is not very complex.  The documentation and examples bundled with xlrd helped solve it quickly. <br>  Code example: <br><blockquote><code><font color="#008000"><strong>import</strong></font> <font color="#0000FF"><strong>xlrd</strong></font> <br> rb <font color="#666666">=</font> xlrd <font color="#666666">.</font> open_workbook( <font color="#BA2121">'d:/final.xls'</font> ,formatting_info <font color="#666666">=</font> <font color="#008000">True</font> ) <br> sheet <font color="#666666">=</font> rb <font color="#666666">.</font> sheet_by_index( <font color="#666666">0</font> ) <br> <font color="#008000"><strong>for</strong></font> rownum <font color="#AA22FF"><strong>in</strong></font> <font color="#008000">range</font> (sheet <font color="#666666">.</font> nrows): <br> row <font color="#666666">=</font> sheet <font color="#666666">.</font> row_values(rownum) <br> <font color="#008000"><strong>for</strong></font> c_el <font color="#AA22FF"><strong>in</strong></font> row: <br> <font color="#008000"><strong>print</strong></font> c_el <br></code> </blockquote>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Creating a new file and filling it </h4><br>  This task was no more difficult than the previous one.  Documentation and examples helped. <br>  Code example: <br><blockquote> <code><font color="#008000"><strong>import</strong></font> <font color="#0000FF"><strong>xlwt</strong></font> <br> <font color="#008000"><strong>from</strong></font> <font color="#0000FF"><strong>datetime</strong></font> <font color="#008000"><strong>import</strong></font> datetime <br> <br> font0 <font color="#666666">=</font> xlwt <font color="#666666">.</font> Font() <br> font0 <font color="#666666">.</font> name <font color="#666666">=</font> <font color="#BA2121">'Times New Roman'</font> <br> font0 <font color="#666666">.</font> colour_index <font color="#666666">=</font> <font color="#666666">2</font> <br> font0 <font color="#666666">.</font> bold <font color="#666666">=</font> <font color="#008000">True</font> <br> <br> style0 <font color="#666666">=</font> xlwt <font color="#666666">.</font> XFStyle() <br> style0 <font color="#666666">.</font> font <font color="#666666">=</font> font0 <br> <br> style1 <font color="#666666">=</font> xlwt <font color="#666666">.</font> XFStyle() <br> style1 <font color="#666666">.</font> num_format_str <font color="#666666">=</font> <font color="#BA2121">'D-MMM-YY'</font> <br> <br> wb <font color="#666666">=</font> xlwt <font color="#666666">.</font> Workbook() <br> ws <font color="#666666">=</font> wb <font color="#666666">.</font> add_sheet( <font color="#BA2121">'A Test Sheet'</font> ) <br> <br> ws <font color="#666666">.</font> write( <font color="#666666">0</font> , <font color="#666666">0</font> , <font color="#BA2121">'Test'</font> , style0) <br> ws <font color="#666666">.</font> write( <font color="#666666">1</font> , <font color="#666666">0</font> , datetime <font color="#666666">.</font> now(), style1) <br> ws <font color="#666666">.</font> write( <font color="#666666">2</font> , <font color="#666666">0</font> , <font color="#666666">1</font> ) <br> ws <font color="#666666">.</font> write( <font color="#666666">2</font> , <font color="#666666">1</font> , <font color="#666666">1</font> ) <br> ws <font color="#666666">.</font> write( <font color="#666666">2</font> , <font color="#666666">2</font> , xlwt <font color="#666666">.</font> Formula( <font color="#BA2121">"A3+B3"</font> )) <br> <br> wb <font color="#666666">.</font> save( <font color="#BA2121">'example.xls'</font> ) <br></code> </blockquote><br><br><h4>  Create a copy of the file based on the input file </h4><br>  This problem can be solved in two ways.  Option one: open the input file for reading, create a new file and overwrite all the data from one file to another.  This solution is not difficult to implement, so it makes no sense to lay out the code sample.  Option two: use the xlutils library.  There are a lot of interesting and useful things in this library, but <i>xlutils.copy</i> will be interesting for our task. <br>  And so, a sample code to create a file based on input using xlutils.copy: <br><blockquote> <code><font color="#008000"><strong>import</strong></font> <font color="#0000FF"><strong>xlrd</strong></font> <br> <font color="#008000"><strong>import</strong></font> <font color="#0000FF"><strong>xlwt</strong></font> <br> <font color="#008000"><strong>from</strong></font> <font color="#0000FF"><strong>xlutils.copy</strong></font> <font color="#008000"><strong>import</strong></font> copy <br> <br> rb <font color="#666666">=</font> open_workbook( <font color="#BA2121">'final.xls'</font> ,on_demand <font color="#666666">=</font> <font color="#008000">True</font> ,formatting_info <font color="#666666">=</font> <font color="#008000">True</font> ) <br> wb <font color="#666666">=</font> copy(rb) <br> wb <font color="#666666">.</font> save( <font color="#BA2121">"final_complete.xls"</font> ) <br></code> </blockquote><br><br>  Here such small code turned out.  In order for it to work, the <b>on_demand = True</b> flag must be set.  Thanks to the use of the <b>formatting_info</b> flag, the output file is obtained with the same styles as the input file.  For my task, this turned out to be the right option. <br><br><h4>  Deleting rows by a given condition </h4><br>  To solve this problem, it was decided to use a filter.  One option is to rewrite from one file to another, excluding those options that do not fulfill the specified condition.  But there is one catch here, if you need to keep the style of the paperwork, then this approach will not work (Unless of course you know the design style in advance and can set it programmatically).  The solution to the problem was achieved by using xlutils.filter.  Task: to leave in the output Excel file only those records that are contained in the transmitted list. <br>  The code that solves this problem: <br><blockquote> <code><font color="#008000"><strong>from</strong></font> <font color="#0000FF"><strong>xlutils.filter</strong></font> <font color="#008000"><strong>import</strong></font> GlobReader,BaseFilter,DirectoryWriter,process <br> <br> myfile <font color="#666666">=</font> <font color="#BA2121">'final2.xls'</font> <br> mydir <font color="#666666">=</font> <font color="#BA2121">'d:/'</font> <br> <br> <font color="#008000"><strong>class</strong></font> <font color="#0000FF"><strong>MyFilter</strong></font> (BaseFilter): <br> <br> goodlist <font color="#666666">=</font> <font color="#008000">None</font> <br> <br> <font color="#008000"><strong>def</strong></font> <font color="#0000FF">__init__</font> ( <font color="#008000">self</font> ,elist): <br> <font color="#008000">self</font> <font color="#666666">.</font> goodlist <font color="#666666">=</font> goodlist <br> <font color="#008000">self</font> <font color="#666666">.</font> wtw <font color="#666666">=</font> <font color="#666666">0</font> <br> <font color="#008000">self</font> <font color="#666666">.</font> wtc <font color="#666666">=</font> <font color="#666666">0</font> <br> <br> <br> <font color="#008000"><strong>def</strong></font> <font color="#0000FF">workbook</font> ( <font color="#008000">self</font> , rdbook, wtbook_name): <br> <font color="#008000">self</font> <font color="#666666">.</font> next <font color="#666666">.</font> workbook(rdbook, <font color="#BA2121">'filtered_'</font> <font color="#666666">+</font> wtbook_name) <br> <br> <font color="#008000"><strong>def</strong></font> <font color="#0000FF">row</font> ( <font color="#008000">self</font> , rdrowx, wtrowx): <br> <font color="#008000"><strong>pass</strong></font> <br> <br> <font color="#008000"><strong>def</strong></font> <font color="#0000FF">cell</font> ( <font color="#008000">self</font> , rdrowx, rdcolx, wtrowx, wtcolx): <br> value <font color="#666666">=</font> <font color="#008000">self</font> <font color="#666666">.</font> rdsheet <font color="#666666">.</font> cell(rdrowx,rdcolx) <font color="#666666">.</font> value <br> <font color="#008000"><strong>if</strong></font> value <font color="#AA22FF"><strong>in</strong></font> <font color="#008000">self</font> <font color="#666666">.</font> goodlist: <br> <font color="#008000">self</font> <font color="#666666">.</font> wtc <font color="#666666">=</font> <font color="#008000">self</font> <font color="#666666">.</font> wtc <font color="#666666">+1</font> <br> <font color="#008000">self</font> <font color="#666666">.</font> next <font color="#666666">.</font> row(rdrowx,wtrowx) <br> <font color="#008000"><strong>else</strong></font> : <br> <font color="#008000"><strong>return</strong></font> <br> <font color="#008000">self</font> <font color="#666666">.</font> next <font color="#666666">.</font> cell(rdrowx,rdcolx, <font color="#008000">self</font> <font color="#666666">.</font> wtc,wtcolx) <br> <br> <br> data <font color="#666666">=</font> <font color="#BA2121">"""somedata1 <br> somedata2 <br> somedata3 <br> somedata4 <br> somedata5 <br> """</font> <br> <br> goodlist <font color="#666666">=</font> data <font color="#666666">.</font> split( <font color="#BA2121">"</font> <font color="#BB6622"><strong>\n</strong></font> <font color="#BA2121">"</font> ) <br> <br> process(GlobReader(os <font color="#666666">.</font> path <font color="#666666">.</font> join(mydir,myfile)),MyFilter(goodlist),DirectoryWriter(mydir)) <br></code> </blockquote><br><br><h4>  Conclusion </h4><br>  Using a set of three libraries, the tasks were solved.  The following was noted: if there are graphic elements (pictures, etc.) in the input Excel file, they are not transferred to the output file.  Perhaps by studying these libraries it will be possible to solve this part of the problem. <br><br><h4>  Links </h4><br>  <a href="http://sourceforge.net/projects/pyexcelerator/">sourceforge.net/projects/pyexcelerator</a> <br>  <a href="http://www.python-excel.org/">www.python-excel.org</a> - for the first three libraries. <br>  <a href="http://groups.google.com/group/python-excel">groups.google.com/group/python-excel</a> is a group that discusses the use of xlrd, xlwt, and xlutils libraries. <br><br>  <s>PS I think it would be nice to move this post to a thematic blog.</s> </div><p>Source: <a href="https://habr.com/ru/post/99923/">https://habr.com/ru/post/99923/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../99916/index.html">Updated mobile version of Rambler News</a></li>
<li><a href="../99918/index.html">Approaches to extracting data from web resources</a></li>
<li><a href="../99919/index.html">Toshiba W100 libretto: the first laptop with a display instead of a keyboard</a></li>
<li><a href="../99920/index.html">Canobuvosti, 49th edition</a></li>
<li><a href="../99922/index.html">Football, soccer, pilau and movies</a></li>
<li><a href="../99925/index.html">We combine two local networks via the Internet. Vpn lan to lan. Asus wl520gu + dd-wrt and FreeBSD + mpd5</a></li>
<li><a href="../99928/index.html">Wireless video: external wireless video cards</a></li>
<li><a href="../99929/index.html">Toyota agreed with Alexander Severinsky</a></li>
<li><a href="../99931/index.html">Tools for assessing the status of development projects</a></li>
<li><a href="../99932/index.html">Video review of the best of low-cost Android backgrounds LG Optimus</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>