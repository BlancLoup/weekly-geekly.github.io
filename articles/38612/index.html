<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Contract Design</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Two years ago I was fortunate enough to attend a lecture by a wonderful person, one of the developers of the Eiffel language, Bertrand Meyer. He gave ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Contract Design</h1><div class="post__text post__text-html js-mediator-article"> Two years ago I was fortunate enough to attend a lecture by a wonderful person, one of the developers of the <a href="http://en.wikipedia.org/wiki/Eiffel_(programming_language)">Eiffel</a> language, Bertrand Meyer.  He gave a lecture at our university (St. Petersburg State University ITMO) about a rather interesting software design concept.  It is called ‚Äúcontract design‚Äù.  The essence of this concept, I will try to describe below. <br><br>  For example, when you agree with a client to work together, you enter into a contract.  Those.  You describe the responsibilities of both parties and the possible consequences in the event of unexpected situations.  This approach can be applied to software development, where the parties are software modules. <br>  Contract engineering is fairly simple, but, at the same time, a powerful technique based on documenting the rights and obligations of software modules to ensure the correctness of a program.  I believe that the correct program is a program that performs no more and no less than what it claims to be. <br><a name="habracut"></a>  The central figures of this concept are assertions - these are boolean expressions describing the state of the program.  There are three main types of statements: preconditions, postconditions and class invariants. <br><br>  <i>Preconditions.</i> <br>  Preconditions are subprogram requirements, i.e.  what must be true for the execution of the subroutine.  If these preconditions are violated, then the subroutine should not be called in any way.  All responsibility for sending the ‚Äúcorrect‚Äù data lies with the calling program. <br>  This approach is contrary to many concepts, which are taught in a huge number of textbooks.  There is a constant check made at the forefront.  Designing the contract claims the opposite - unnecessary checks can only harm.  In general, the design principle under the contract "looks" at design from the perspective of "complexity - the main enemy of quality" (but more on that next time;)). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>Postconditions</i> <br>  Postconditions express the states of the ‚Äúsurrounding world‚Äù at the time of the subprogram execution.  Those.  these are conditions that are guaranteed by the subroutine itself.  In addition, the presence of a postcondition in the subroutine guarantees its completion (that is, there will be no infinite loop, for example). <br><br>  <i>Class invariants</i> <br>  Invariants are global properties of a class.  They define deeper semantic properties and integrity constraints that characterize a class.  The class ensures that this condition is always true from the point of view of the caller. <br><br>  I will try to formulate the main idea that I use: <br>  "If the client calling the subroutine fulfills all the preconditions, then the called subroutine undertakes that after its execution all postconditions and invariants will be true." <br><br>  As in real life, in case of violation of one of the clauses of the contract, a pre-agreed and coordinated measure occurs.  In the software development world, this may be the excitation of an exception or the termination of a program.  In any case, you will know for sure that breach of contract is an error. <br>  I would like to make an important remark.  It should be understood that the above described is not always the case.  Therefore, preconditions should not be used for procedures such as, for example, validation of user input. <br><br>  Not to be unsubstantiated, I will give an example (hereinafter all the code is written in C #). <br>  Let's consider this situation: the user enters the code zap.  parts of the catalog and want to get information about this part.  It is known that the code consists of 9 characters.  Here is a classic example of the implementation of this function: <br><br> <code><a href="http://source.virtser.net/"></a> <font color="black"><font color="#0000ff">private</font> ComponentProvider componentProvider; <br> ‚Ä¶ <br> <font color="#0000ff">public</font> ComponentInfo GetComponentInfo( <font color="#0000ff">string</font> id) <br> { <br> <font color="#0000ff">if</font> ( <font color="#2B91AF">String</font> .IsNullOrEmpty(id) || id.Length != 9) <br> { <br> <font color="#0000ff">throw</font> <font color="#0000ff">new</font> Exception(‚ÄúWrong id‚Äù); <br> } <br> <font color="#0000ff">return</font> componentProvider.GetComponent(id); <br> }</font> <br> <br> * This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</code> <blockquote> <code><a href="http://source.virtser.net/"></a> <font color="black"><font color="#0000ff">private</font> ComponentProvider componentProvider; <br> ‚Ä¶ <br> <font color="#0000ff">public</font> ComponentInfo GetComponentInfo( <font color="#0000ff">string</font> id) <br> { <br> <font color="#0000ff">if</font> ( <font color="#2B91AF">String</font> .IsNullOrEmpty(id) || id.Length != 9) <br> { <br> <font color="#0000ff">throw</font> <font color="#0000ff">new</font> Exception(‚ÄúWrong id‚Äù); <br> } <br> <font color="#0000ff">return</font> componentProvider.GetComponent(id); <br> }</font> <br> <br> * This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</code> </blockquote> <code><a href="http://source.virtser.net/"></a> <font color="black"><font color="#0000ff">private</font> ComponentProvider componentProvider; <br> ‚Ä¶ <br> <font color="#0000ff">public</font> ComponentInfo GetComponentInfo( <font color="#0000ff">string</font> id) <br> { <br> <font color="#0000ff">if</font> ( <font color="#2B91AF">String</font> .IsNullOrEmpty(id) || id.Length != 9) <br> { <br> <font color="#0000ff">throw</font> <font color="#0000ff">new</font> Exception(‚ÄúWrong id‚Äù); <br> } <br> <font color="#0000ff">return</font> componentProvider.GetComponent(id); <br> }</font> <br> <br> * This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</code> <br> <br>  In many classic textbooks on creating ‚Äúhigh-quality software,‚Äù this example would be called excellent.  But from the point of view of the principle of design under a contract, this example is erroneous. <br>  To begin with, the caller must check the validity of the value of the id attribute.  After all, she (the caller) can take advantage of several options: complete the work, issue a warning and start reading the new number.  Or it may be possible to enter only the last 4 digits, and the program will form the first five based on the VIN number of the car.  In any case, whichever option is used, it is neither related to the GetComponentInfo () function. <br>  Then we rewrite the original example as follows. <br><br> <code><a href="http://source.virtser.net/"></a> <font color="black"><font color="#0000ff">public</font> ComponentInfo GetComponentInfo( <font color="#0000ff">string</font> id) <br> { <br> <font color="#0000ff">return</font> componentProvider.GetComponent(id); <br> }</font> <br> <br> * This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</code> <blockquote> <code><a href="http://source.virtser.net/"></a> <font color="black"><font color="#0000ff">public</font> ComponentInfo GetComponentInfo( <font color="#0000ff">string</font> id) <br> { <br> <font color="#0000ff">return</font> componentProvider.GetComponent(id); <br> }</font> <br> <br> * This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</code> </blockquote> <code><a href="http://source.virtser.net/"></a> <font color="black"><font color="#0000ff">public</font> ComponentInfo GetComponentInfo( <font color="#0000ff">string</font> id) <br> { <br> <font color="#0000ff">return</font> componentProvider.GetComponent(id); <br> }</font> <br> <br> * This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</code> <br> <br>  But then the fun begins :).  If we have already declared that this function returns an object of type ComponentInfo, then we must provide this.  After all, the GetComponent method of the componentProvider object can return null.  And then already the calling program will have to do a check for a null-value, otherwise we can ‚Äúrun into‚Äù the object reference exception.  Those.  The example is rewritten like this: <br><br> <code><a href="http://source.virtser.net/"></a> <font color="black"><font color="#0000ff">public</font> ComponentInfo GetComponentInfo( <font color="#0000ff">string</font> id) <br> { <br> ComponentInfo componentInfo = <font color="#0000ff">this</font> .componentProvider.GetComponent(id); <br> <font color="#0000ff">if</font> (componentInfo == <font color="#0000ff">null</font> ) <br> { <br> <font color="#0000ff">throw</font> <font color="#0000ff">new</font> ContractException(‚ÄúCan't find component‚Äù); <br> } <br> <font color="#0000ff">return</font> componentInfo; <br> }</font> <br> <br> * This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</code> <blockquote> <code><a href="http://source.virtser.net/"></a> <font color="black"><font color="#0000ff">public</font> ComponentInfo GetComponentInfo( <font color="#0000ff">string</font> id) <br> { <br> ComponentInfo componentInfo = <font color="#0000ff">this</font> .componentProvider.GetComponent(id); <br> <font color="#0000ff">if</font> (componentInfo == <font color="#0000ff">null</font> ) <br> { <br> <font color="#0000ff">throw</font> <font color="#0000ff">new</font> ContractException(‚ÄúCan't find component‚Äù); <br> } <br> <font color="#0000ff">return</font> componentInfo; <br> }</font> <br> <br> * This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</code> </blockquote> <code><a href="http://source.virtser.net/"></a> <font color="black"><font color="#0000ff">public</font> ComponentInfo GetComponentInfo( <font color="#0000ff">string</font> id) <br> { <br> ComponentInfo componentInfo = <font color="#0000ff">this</font> .componentProvider.GetComponent(id); <br> <font color="#0000ff">if</font> (componentInfo == <font color="#0000ff">null</font> ) <br> { <br> <font color="#0000ff">throw</font> <font color="#0000ff">new</font> ContractException(‚ÄúCan't find component‚Äù); <br> } <br> <font color="#0000ff">return</font> componentInfo; <br> }</font> <br> <br> * This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</code> <br> <br>  At least, so it is said in many articles and examples.  BUT.  Let's reason logically.  If we use the contracting principle, then, based on my ‚Äúgolden rule‚Äù, we can be sure that the GetComponent () method of the componentProvider object will return us the true value (since its parameter is true by definition).  Therefore, I see no reason to overload the program with unnecessary code.  But on the other hand, an object of type ComponentProvider can be designed by a third-party developer who did not adhere to the principle of designing under a contract.  Here comes the dilemma.  Here is my advice for this situation - if you call a subroutine that was written by you, then do not write too much code.  Trust yourself.  But if you call a subprogram written by a third-party developer, and you are not sure about it, then check it out.  The most obvious example is the square root extraction function Math.Sqrt ().  It is clear that it is impossible to extract the square root of a negative number, but if a negative number is passed to this function, no exception will be generated, but a value of type NaN will be returned. <br><br> <code><a href="http://source.virtser.net/"></a> <i>¬´¬ª </i> <br> <font color="black"><font color="#0000ff">public</font> ComponentInfo GetComponentInfo( <font color="#0000ff">string</font> id) <br> { <br> <font color="#0000ff">try</font> <br> { <br> <font color="#0000ff">return</font> <font color="#0000ff">this</font> .componentProvider.GetComponent(id); <br> } <br> <font color="#0000ff">catch</font> (ContractException ex) <br> { <br> <font color="#0000ff">throw</font> <font color="#0000ff">new</font> ContractException(ex.ToString()); <br> } <br> }</font> <br> <br> * This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</code> <blockquote> <code><a href="http://source.virtser.net/"></a> <i>¬´¬ª </i> <br> <font color="black"><font color="#0000ff">public</font> ComponentInfo GetComponentInfo( <font color="#0000ff">string</font> id) <br> { <br> <font color="#0000ff">try</font> <br> { <br> <font color="#0000ff">return</font> <font color="#0000ff">this</font> .componentProvider.GetComponent(id); <br> } <br> <font color="#0000ff">catch</font> (ContractException ex) <br> { <br> <font color="#0000ff">throw</font> <font color="#0000ff">new</font> ContractException(ex.ToString()); <br> } <br> }</font> <br> <br> * This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</code> </blockquote> <code><a href="http://source.virtser.net/"></a> <i>¬´¬ª </i> <br> <font color="black"><font color="#0000ff">public</font> ComponentInfo GetComponentInfo( <font color="#0000ff">string</font> id) <br> { <br> <font color="#0000ff">try</font> <br> { <br> <font color="#0000ff">return</font> <font color="#0000ff">this</font> .componentProvider.GetComponent(id); <br> } <br> <font color="#0000ff">catch</font> (ContractException ex) <br> { <br> <font color="#0000ff">throw</font> <font color="#0000ff">new</font> ContractException(ex.ToString()); <br> } <br> }</font> <br> <br> * This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</code> <br> <br>  All these examples are based on some of your (development team) agreements.  But there are special extensions for various programming languages.  For example, the iContract preprocessor for Java or the eXtensible C # extension. <br><br>  Most importantly, using the contract design principle will help you ensure that your code is automatically tested. <br>  This article can be called an introduction to the principle of design under the contract.  If there is interest from users, then I will continue the series about this principle.  After all, all that I have described is just the tip of the iceberg. </div><p>Source: <a href="https://habr.com/ru/post/38612/">https://habr.com/ru/post/38612/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../38594/index.html">Mobile phone signal blocker</a></li>
<li><a href="../38601/index.html">Yandex has created its jabber client</a></li>
<li><a href="../38606/index.html">Chao, Microsoft</a></li>
<li><a href="../38607/index.html">IBM SSDs break 1 million IOPS record</a></li>
<li><a href="../38610/index.html">Comparison of the old Mac Plus (86 year) versus dual core Athlone</a></li>
<li><a href="../38613/index.html">12 different types of clients and how to work with them</a></li>
<li><a href="../38616/index.html">Problem number 93</a></li>
<li><a href="../38619/index.html">Autumn season FPPP: black MacBook for the best topic</a></li>
<li><a href="../38621/index.html">Monday 1 september</a></li>
<li><a href="../38622/index.html">Metaprogramming in C ++</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>