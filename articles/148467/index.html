<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Qt + OpenCV. Runtime and Widget for CvCapture (video capture devices)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 Analyzing the comments of the previous post ( Qt Designer & Runtime Qt library in the OpenCV service ... ), I had to work out in more d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Qt + OpenCV. Runtime and Widget for CvCapture (video capture devices)</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  Analyzing the comments of the previous post ( <a href="http://habrahabr.ru/post/146210/">Qt Designer &amp; Runtime Qt library in the OpenCV service ...</a> ), I had to work out in more detail the OpenCV library video capture device and methods for separating runtime libraries and widgets. <br>  Working with Qt Designer is convenient (I'm lazy), so the interface design component for CvCapture appeared.  After the start of work, the ‚Äúscientific‚Äù explanation of this was also tightened - it is convenient to apply something similar, say, when designing an interface of properties or parameters of an application using a video capture device. <br>  While the <a href="">project archive is being</a> downloaded, read on. <br><br><h4>  Thanks </h4><br>  Thanks to everyone who left their comments on the previous post. <br><br><h4>  Runtime library. </h4><br>  So, the OpenCV library is installed, code samples are viewed.  It's time to ‚Äútie‚Äù the video capture device to Qt.  And not just like that, but also to receive images by changing devices dynamically.  Yes, to remember all the way to the image, video.  Yes, so that the camera numbers are switched.  Yes, that and ... the post is shorter turned out. <br><h5>  Library. </h5><br>  What is easier!  We inherit a new library class from QObject, we hide unnecessary fields for a developer and methods in a private class as an element of the QScopedPointer collection, we mount alert signals and slot handlers. <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Get the header file cqtopencvcaptureobject.h</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> CQTOPENCVCAPTUREOBJECT_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CQTOPENCVCAPTUREOBJECT_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"../../../include/qtopencv_global.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;opencv2/opencv.hpp&gt; #include &lt;QObject&gt; #include &lt;QScopedPointer&gt; QT_BEGIN_HEADER QT_BEGIN_NAMESPACE /*----------------------------------------------------------------------------*/ /** \internal \class CQtOpenCVCaptureObjectPrivate \brief                CvCapture  OpenCV. */ class CQtOpenCVCaptureObjectPrivate; /*----------------------------------------------------------------------------*/ /** \class CQtOpenCVCaptureObject \brief       CvCapture  OpenCV. */ class #if defined(QTOPENCV_LIB_EXPORT) QTOPENCV_DECLARE_EXPORT #else Q_DECL_EXPORT #endif CQtOpenCVCaptureObject : public QObject { Q_OBJECT Q_CLASSINFO("brief", "OpenCV Capture class.") Q_CLASSINFO("author", "Vladimir N. Litvinenko") Q_CLASSINFO("URL", "http://www.codepaint.ru") Q_CLASSINFO("email", "litvinenko.vladimir@gmail.com") Q_CLASSINFO("created", "21-JUN-2012") Q_CLASSINFO("edited", "06-JUL-2012") public: explicit CQtOpenCVCaptureObject ( QObject *parent = 0 ); virtual ~CQtOpenCVCaptureObject (); CvCapture* getCapture () const; QString getPath () const; int getNumber () const; int getTimeoutInterval () const; IplImage* getImage () const; int getFrameCount () const; bool isInternal () const; bool isExternal () const; bool isActive () const; bool isRecap () const; signals: /** \fn [SIGNAL] void CQtOpenCVCaptureObject::signal_Errno ( int errno, const QString&amp; errmsg ); \brief      . \param errno -   \param errmsg -   */ void signal_Errno ( int, const QString&amp; ); /** \fn [SIGNAL] void CQtOpenCVCaptureObject::signal_CaptureChanged () \brief       */ void signal_CaptureChanged (); /** \fn [SIGNAL] void CQtOpenCVCaptureObject::signal_CaptureChanged ( const CvCapture* value ) \brief       \param value -       CvCapture  OpenCV */ void signal_CaptureChanged ( const CvCapture* ); /** \fn [SIGNAL] void CQtOpenCVCaptureObject::signal_ImageChanged ( const IplImage* value ) \brief         IplImage  OpenCV. \param value -      IplImage  OpenCV. */ void signal_ImageChanged ( const IplImage* ); /** \fn [SIGNAL] void CQtOpenCVCaptureObject::signal_TimeoutChanged () \brief        */ void signal_TimeoutChanged (); /** \fn [SIGNAL] void CQtOpenCVCaptureObject::signal_TimeoutChanged ( int value ) \brief        \param value -      */ void signal_TimeoutChanged ( int ); /** \fn [SIGNAL] void CQtOpenCVCaptureObject::signal_ActiveChanged ( bool value ) \brief            -. \param value -     .  true   ,  false -      -. */ void signal_ActiveChanged ( bool ); public slots: void slot_SetNumber ( int ); void slot_SetPath ( const QString&amp; ); void slot_SetAsInternal ( bool ); void slot_SetTimeout ( int ); void slot_captureOn ( bool ); void slot_Activate (bool); void slot_SetRecap (bool); protected: virtual void timerEvent(QTimerEvent *event); private: Q_DISABLE_COPY(CQtOpenCVCaptureObject) Q_DECLARE_PRIVATE(CQtOpenCVCaptureObject) QScopedPointer&lt;CQtOpenCVCaptureObjectPrivate&gt; d_ptr; }; /*----------------------------------------------------------------------------*/ QT_END_NAMESPACE QT_END_HEADER #endif // CQTOPENCVCAPTUREOBJECT_H</span></span></span></span></code> </pre> <br></div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Slots: <br><ul><li>  <b>slot_SetNumber</b> is responsible for setting the camera number </li><li>  <b>slot_SetPath</b> targets video capture device image file, video or web-CGI URL </li><li>  <b>slot_SetAsInternal</b> indicates that the video capture device is the camera of your computer (in my opinion, superfluous. <b>Decide for yourself</b> ) </li><li>  <b>slot_SetTimeout</b> sets the frame extraction time from CvCapture in milliseconds </li><li>  <b>slot_captureOn</b> enables / disables CvCapture </li><li>  <b>slot_Activate</b> activates / deactivates frame request by timeout </li><li>  <b>slot_SetRecap</b> indicates to the video capture device that it is necessary ... to recreate before extracting the frame (image).  It is necessary when using the web interface to cameras </li></ul><br>  <code>.pro</code> file <pre> <code class="cpp hljs">DEFINES += QDESIGNER_EXPORT_WIDGETS</code> </pre><br>  There is no more need to connect the OpenCV library, it will go according to the runtime library. <br>  And, here, her, darling, and fasten: <br><pre> <code class="cpp hljs">unix: LIBS += -L/usr/lib -lQtOpenCVCapture INCLUDEPATH += $$PWD/../../runtime/capture/QtOpenCVCapture DEPENDPATH += /usr/lib</code> </pre><br><br>  <b>Note!</b>  The path points to <code>/usr/lib</code> .  It's comfortable.  In the future, just create a symbolic link to your library in this directory, and there will be no problems with linking! <br><br><div class="spoiler">  <b class="spoiler_title">Let's declare the widget properties for the designer:</b> <div class="spoiler_text"><pre> <code class="cpp hljs">... Q_PROPERTY( <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> visible READ isVisible WRITE slot_setVisible ) Q_PROPERTY( <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> internal READ isInternal WRITE slot_SetAsInternal ) Q_PROPERTY( QString path READ getPath WRITE slot_SetPath ) Q_PROPERTY( <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> number READ getNumber WRITE slot_SetNumber ) Q_PROPERTY( <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> numberMax READ getNumberMax WRITE slot_SetNumberMax ) Q_PROPERTY( <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> timeout READ getTimeoutInterval WRITE slot_SetTimeout ) Q_PROPERTY( <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> timeoutMax READ getTimeoutMax WRITE slot_SetTimeoutMax ) Q_PROPERTY( <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> timeoutStep READ getTimeoutStep WRITE slot_SetTimeoutStep ) Q_PROPERTY( <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> recapture READ isRecap WRITE slot_SetRecap ) Q_PROPERTY( QString FrameTitle READ getFrameTitle WRITE slot_setFrameTitle ) Q_PROPERTY( QString GroupBoxTitle READ getGroupBoxTitle WRITE slot_setGroupBoxTitle ) Q_PROPERTY( QString RadioNumberTitle READ getRadioNumberTitle WRITE slot_setRadioNumberTitle ) Q_PROPERTY( QString RadioPathTitle READ getRadioPathTitle WRITE slot_setRadioPathTitle ) Q_PROPERTY( QString PathTitle READ getPathTitle WRITE slot_setPathTitle ) Q_PROPERTY( QString NumberTitle READ getNumberTitle WRITE slot_setNumberTitle ) Q_PROPERTY( QString TimeOutTitle READ getTimeOutTitle WRITE slot_setTimeOutTitle ) Q_PROPERTY( QString TimeOutExtTitle READ getTimeOutExtTitle WRITE slot_setTimeOutExtTitle ) Q_PROPERTY( QString RecaptureTitle READ getRecaptureTitle WRITE slot_setRecaptureTitle ) ...</code> </pre><br></div></div><br><br>  Expand a set of slots and methods to support properties: <br><pre> <code class="cpp hljs">... <span class="hljs-comment"><span class="hljs-comment">//   bool isVisible () const; QString getFrameTitle () const; QString getGroupBoxTitle () const; QString getRadioNumberTitle () const; QString getRadioPathTitle () const; QString getPathTitle () const; QString getNumberTitle () const; QString getTimeOutTitle () const; QString getTimeOutExtTitle () const; QString getRecaptureTitle () const; ... //  void slot_setVisible( bool ); void slot_setFrameTitle( const QString&amp; ); void slot_setGroupBoxTitle( const QString&amp; ); void slot_setRadioNumberTitle( const QString&amp; ); void slot_setRadioPathTitle( const QString&amp; ); void slot_setPathTitle( const QString&amp; ); void slot_setNumberTitle( const QString&amp; ); void slot_setTimeOutTitle( const QString&amp; ); void slot_setTimeOutExtTitle( const QString&amp; ); void slot_setRecaptureTitle( const QString&amp; ); void slot_SetNumberMax ( int ); void slot_SetTimeoutMax ( int ); void slot_SetTimeoutStep ( int ); ...</span></span></code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">Copy the window settings from the test example runtime library:</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/*----------------------------------------------------------------------------*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CQtOpenCVCaptureWidgetPrivate::setupUi ( QWidget* parent ) { p_Frame = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QFrame(parent); Q_ASSERT(p_Frame); p_Frame-&gt;setObjectName(QString::fromUtf8(<span class="hljs-string"><span class="hljs-string">"p_Frame"</span></span>)); p_Frame-&gt;resize(<span class="hljs-number"><span class="hljs-number">550</span></span>, <span class="hljs-number"><span class="hljs-number">195</span></span>); p_Frame-&gt;setMinimumSize(QSize(<span class="hljs-number"><span class="hljs-number">550</span></span>, <span class="hljs-number"><span class="hljs-number">195</span></span>)); <span class="hljs-comment"><span class="hljs-comment">// p_Frame-&gt;setMaximumSize(QSize(550, 195)); p_Frame-&gt;setFrameShape(QFrame::StyledPanel); p_Frame-&gt;setFrameShadow(QFrame::Raised); p_gridLayout_Frame = new QGridLayout(p_Frame); Q_ASSERT(p_gridLayout_Frame); p_gridLayout_Frame-&gt;setObjectName(QString::fromUtf8("p_gridLayout_Frame")); p_groupBox_Capture = new QGroupBox(p_Frame); Q_ASSERT(p_groupBox_Capture); p_groupBox_Capture-&gt;setObjectName(QString::fromUtf8("p_groupBox_Capture")); QSizePolicy sizePolicy(QSizePolicy::Expanding, QSizePolicy::Fixed); sizePolicy.setHorizontalStretch(0); sizePolicy.setVerticalStretch(0); sizePolicy.setHeightForWidth(p_groupBox_Capture-&gt;sizePolicy().hasHeightForWidth()); p_groupBox_Capture-&gt;setSizePolicy(sizePolicy); // p_groupBox_Capture-&gt;setMinimumSize(QSize(540, 190)); // p_groupBox_Capture-&gt;setMaximumSize(QSize(540, 185)); p_groupBox_Capture-&gt;setFlat(true); p_gridLayout_GBox = new QGridLayout(p_groupBox_Capture); Q_ASSERT(p_gridLayout_GBox); p_gridLayout_GBox-&gt;setSpacing(1); p_gridLayout_GBox-&gt;setContentsMargins(3, 3, 3, 3); p_gridLayout_GBox-&gt;setObjectName(QString::fromUtf8("p_gridLayout_GBox")); p_horLayout_Radio = new QHBoxLayout(); Q_ASSERT(p_horLayout_Radio); p_horLayout_Radio-&gt;setSpacing(1); p_horLayout_Radio-&gt;setObjectName(QString::fromUtf8("p_horLayout_Radio")); p_radioButton_URL = new QRadioButton(p_groupBox_Capture); Q_ASSERT(p_radioButton_URL); p_radioButton_URL-&gt;setObjectName(QString::fromUtf8("p_radioButton_URL")); p_horLayout_Radio-&gt;addWidget(p_radioButton_URL); p_radioButton_Number = new QRadioButton(p_groupBox_Capture); Q_ASSERT(p_radioButton_Number); p_radioButton_Number-&gt;setObjectName(QString::fromUtf8("p_radioButton_Number")); p_radioButton_Number-&gt;setChecked(true); p_horLayout_Radio-&gt;addWidget(p_radioButton_Number); p_gridLayout_GBox-&gt;addLayout(p_horLayout_Radio, 0, 0, 1, 1); p_horLayout_PathNum = new QHBoxLayout(); Q_ASSERT(p_horLayout_PathNum); p_horLayout_PathNum-&gt;setSpacing(3); p_horLayout_PathNum-&gt;setObjectName(QString::fromUtf8("p_horLayout_PathNum")); p_label_PathNum = new QLabel(p_groupBox_Capture); Q_ASSERT(p_label_PathNum); p_label_PathNum-&gt;setObjectName(QString::fromUtf8("p_label_PathNum")); QSizePolicy sizePolicy1(QSizePolicy::Fixed, QSizePolicy::Preferred); sizePolicy1.setHorizontalStretch(0); sizePolicy1.setVerticalStretch(0); sizePolicy1.setHeightForWidth(p_label_PathNum-&gt;sizePolicy().hasHeightForWidth()); p_label_PathNum-&gt;setSizePolicy(sizePolicy1); p_label_PathNum-&gt;setMinimumSize(QSize(150, 0)); p_label_PathNum-&gt;setLayoutDirection(Qt::LeftToRight); p_label_PathNum-&gt;setFrameShape(QFrame::NoFrame); p_label_PathNum-&gt;setAlignment(Qt::AlignLeading|Qt::AlignLeft|Qt::AlignVCenter); p_horLayout_PathNum-&gt;addWidget(p_label_PathNum); p_spinBox_Number = new QSpinBox(p_groupBox_Capture); Q_ASSERT(p_spinBox_Number); p_spinBox_Number-&gt;setObjectName(QString::fromUtf8("p_spinBox_Number")); sizePolicy.setHeightForWidth(p_spinBox_Number-&gt;sizePolicy().hasHeightForWidth()); p_spinBox_Number-&gt;setSizePolicy(sizePolicy); p_spinBox_Number-&gt;setMinimum(0); p_spinBox_Number-&gt;setMaximum(999999); p_horLayout_PathNum-&gt;addWidget(p_spinBox_Number); p_lineEdit = new QLineEdit(p_groupBox_Capture); Q_ASSERT(p_lineEdit); p_lineEdit-&gt;setObjectName(QString::fromUtf8("p_lineEdit")); p_lineEdit-&gt;setEnabled(true); p_horLayout_PathNum-&gt;addWidget(p_lineEdit); p_gridLayout_GBox-&gt;addLayout(p_horLayout_PathNum, 1, 0, 1, 1); p_horLayout_TOut = new QHBoxLayout(); Q_ASSERT(p_horLayout_TOut); p_horLayout_TOut-&gt;setSpacing(3); p_horLayout_TOut-&gt;setObjectName(QString::fromUtf8("p_horLayout_TOut")); p_label_TOut = new QLabel(p_groupBox_Capture); Q_ASSERT(p_label_TOut); p_label_TOut-&gt;setObjectName(QString::fromUtf8("p_label_TOut")); sizePolicy1.setHeightForWidth(p_label_TOut-&gt;sizePolicy().hasHeightForWidth()); p_label_TOut-&gt;setSizePolicy(sizePolicy1); p_label_TOut-&gt;setMinimumSize(QSize(150, 0)); p_horLayout_TOut-&gt;addWidget(p_label_TOut); p_spinBox_TOut = new QSpinBox(p_groupBox_Capture); Q_ASSERT(p_spinBox_TOut); p_spinBox_TOut-&gt;setObjectName(QString::fromUtf8("p_spinBox_TOut")); sizePolicy.setHeightForWidth(p_spinBox_TOut-&gt;sizePolicy().hasHeightForWidth()); p_spinBox_TOut-&gt;setSizePolicy(sizePolicy); p_spinBox_TOut-&gt;setMinimum(0); p_spinBox_TOut-&gt;setMaximum(999999); p_horLayout_TOut-&gt;addWidget(p_spinBox_TOut); p_label_ms = new QLabel(p_groupBox_Capture); Q_ASSERT(p_label_ms); p_label_ms-&gt;setObjectName(QString::fromUtf8("p_label_ms")); sizePolicy1.setHeightForWidth(p_label_ms-&gt;sizePolicy().hasHeightForWidth()); p_label_ms-&gt;setSizePolicy(sizePolicy1); p_horLayout_TOut-&gt;addWidget(p_label_ms); p_horizontalSpacer = new QSpacerItem(40, 20, QSizePolicy::Preferred, QSizePolicy::Minimum); Q_ASSERT(p_horizontalSpacer); p_horLayout_TOut-&gt;addItem(p_horizontalSpacer); p_gridLayout_GBox-&gt;addLayout(p_horLayout_TOut, 2, 0, 1, 1); p_horLayout_Buttons = new QHBoxLayout(); Q_ASSERT(p_horLayout_Buttons); p_horLayout_Buttons-&gt;setSpacing(3); p_horLayout_Buttons-&gt;setObjectName(QString::fromUtf8("p_horLayout_Buttons")); p_checkBox_Recap = new QCheckBox(p_groupBox_Capture); Q_ASSERT(p_checkBox_Recap); p_checkBox_Recap-&gt;setObjectName(QString::fromUtf8("p_checkBox_Recap")); sizePolicy.setHeightForWidth(p_checkBox_Recap-&gt;sizePolicy().hasHeightForWidth()); p_checkBox_Recap-&gt;setSizePolicy(sizePolicy); p_horLayout_Buttons-&gt;addWidget(p_checkBox_Recap); p_pushButton_Test = new QPushButton(p_groupBox_Capture); Q_ASSERT(p_pushButton_Test); p_pushButton_Test-&gt;setObjectName(QString::fromUtf8("p_pushButton_Test")); p_pushButton_Test-&gt;setCheckable(true); p_pushButton_Test-&gt;setChecked(false); p_horLayout_Buttons-&gt;addWidget(p_pushButton_Test); p_gridLayout_GBox-&gt;addLayout(p_horLayout_Buttons, 3, 0, 1, 1); p_gridLayout_Frame-&gt;addWidget(p_groupBox_Capture, 0, 0, 1, 1); #ifndef QT_NO_SHORTCUT p_label_PathNum-&gt;setBuddy(p_lineEdit); #endif // QT_NO_SHORTCUT retranslateUi(); QMetaObject::connectSlotsByName(p_Frame); }</span></span></code> </pre><br></div></div><br><br>  Connect signals and slots: <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/*----------------------------------------------------------------------------*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CQtOpenCVCaptureWidgetPrivate::setupConnections () { <span class="hljs-comment"><span class="hljs-comment">//   runtime-    q_obj-&gt;connect (q_obj, SIGNAL(signal_Errno(int,QString)), q_ptr, SIGNAL(signal_Errno(int,QString))); q_obj-&gt;connect (q_obj, SIGNAL(signal_CaptureChanged()), q_ptr, SIGNAL(signal_CaptureChanged())); q_obj-&gt;connect (q_obj, SIGNAL(signal_CaptureChanged(const CvCapture*)), q_ptr, SIGNAL(signal_CaptureChanged(const CvCapture*))); q_obj-&gt;connect (q_obj, SIGNAL(signal_ImageChanged(const IplImage*)), q_ptr, SIGNAL(signal_ImageChanged(const IplImage*))); q_obj-&gt;connect (q_obj, SIGNAL(signal_TimeoutChanged()), q_ptr, SIGNAL(signal_TimeoutChanged())); q_obj-&gt;connect (q_obj, SIGNAL(signal_TimeoutChanged(int)), q_ptr, SIGNAL(signal_TimeoutChanged(int))); q_obj-&gt;connect (q_obj, SIGNAL(signal_ActiveChanged(bool)), q_ptr, SIGNAL(signal_ActiveChanged(bool))); //       q_ptr-&gt;connect (p_radioButton_Number,SIGNAL(toggled(bool)), q_ptr, SLOT(slot_SetAsInternal(bool))); q_ptr-&gt;connect (p_radioButton_URL, SIGNAL(toggled(bool)), q_ptr, SLOT(slot_SetAsExternal(bool))); //         q_ptr-&gt;connect (p_lineEdit, SIGNAL(textChanged(QString)), q_ptr, SLOT(slot_SetPath(QString))); q_ptr-&gt;connect (p_lineEdit, SIGNAL(returnPressed()), q_ptr, SLOT(slot_PathComplete())); //       q_ptr-&gt;connect (p_spinBox_Number, SIGNAL(valueChanged(int)), q_ptr, SLOT(slot_SetNumber(int))); //    -   q_ptr-&gt;connect (p_spinBox_TOut, SIGNAL(valueChanged(int)), q_ptr, SLOT(slot_SetTimeout(int))); //          - q_ptr-&gt;connect (p_checkBox_Recap, SIGNAL(toggled(bool)), q_ptr, SLOT(slot_SetRecap(bool))); //      q_ptr-&gt;connect (p_pushButton_Test, SIGNAL(toggled(bool)), q_ptr, SLOT(slot_Test(bool))); // q_ptr-&gt;connect (q_ptr, SIGNAL(signal_ImageChanged(const IplImage*)), q_ptr, SLOT(slot_ShowImage(const IplImage*))); } /*----------------------------------------------------------------------------*/</span></span></code> </pre><br>  Build a library based on the widget. <br><h5>  Plugin for the designer. </h5><br>  It's time to connect our QWidget library to Qt Designer. <br>  Create a collection project. <br><pre> <code class="cpp hljs">CONFIG += designer plugin debug_and_release TARGET = $$qtLibraryTarget(CQtOpenCVCollection) TEMPLATE = lib DEFINES += QDESIGNER_EXPORT_WIDGETS HEADERS = cqtopencvcapturewidgetplugin.h cqtopencvcollection.h SOURCES = cqtopencvcapturewidgetplugin.cpp cqtopencvcollection.cpp RESOURCES = icons.qrc <span class="hljs-comment"><span class="hljs-comment">//target.path = $$[QT_INSTALL_PLUGINS]/designer INSTALLS += target #include(cqtopencvimagewidget.pri) include(cqtopencvcapturewidget.pri) #include(cqtopencvcannywidget.pri) unix: LIBS += -L/usr/lib/ -lQtOpenCVCaptureWidget INCLUDEPATH += $$PWD/ DEPENDPATH += $$PWD/</span></span></code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">Let's declare the plugin class.</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> CQTOPENCVCAPTUREWIDGETPLUGIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CQTOPENCVCAPTUREWIDGETPLUGIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;QDesignerCustomWidgetInterface&gt; #include &lt;QtDesigner/QDesignerExportWidget&gt; class #if defined(QDESIGNER_EXPORT_WIDGETS) QDESIGNER_WIDGET_EXPORT #else Q_DECL_EXPORT #endif CQtOpenCVCaptureWidgetPlugin : public QObject, public QDesignerCustomWidgetInterface { Q_OBJECT Q_INTERFACES(QDesignerCustomWidgetInterface) public: CQtOpenCVCaptureWidgetPlugin(QObject *parent = 0); bool isContainer() const; bool isInitialized() const; QIcon icon() const; QString domXml() const; QString group() const; QString includeFile() const; QString name() const; QString toolTip() const; QString whatsThis() const; QWidget *createWidget(QWidget *parent); void initialize(QDesignerFormEditorInterface *core); private: bool m_initialized; };</span></span></span></span></code> </pre><br></div></div><br><br>  Let's declare a collection class: <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> CQTOPENCVCOLLECTION_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CQTOPENCVCOLLECTION_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;QtDesigner/QtDesigner&gt; #include &lt;QtCore/qplugin.h&gt; class CQtOpenCVCollection : public QObject, public QDesignerCustomWidgetCollectionInterface { Q_OBJECT Q_INTERFACES(QDesignerCustomWidgetCollectionInterface) public: explicit CQtOpenCVCollection(QObject *parent = 0); virtual QList&lt;QDesignerCustomWidgetInterface*&gt; customWidgets() const; private: QList&lt;QDesignerCustomWidgetInterface*&gt; m_widgets; }; #endif</span></span></span></span></code> </pre><br>  Implementation: <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cqtopencvcapturewidgetplugin.h"</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//#include "cqtopencvimagewidgetplugin.h" //#include "cqtopencvcannywidgetplugin.h" #include "cqtopencvcollection.h" CQtOpenCVCollection::CQtOpenCVCollection(QObject *parent) : QObject(parent) { m_widgets.append(new CQtOpenCVCaptureWidgetPlugin(this)); // m_widgets.append(new CQtOpenCVImageWidgetPlugin(this)); // m_widgets.append(new CQtOpenCVCannyWidgetPlugin(this)); } QList&lt;QDesignerCustomWidgetInterface*&gt; CQtOpenCVCollection::customWidgets() const { return m_widgets; } Q_EXPORT_PLUGIN2(CQtOpenCVCollection, CQtOpenCVCollection)</span></span></span></span></code> </pre><br><br>  <b>Pay attention</b> to <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// m_widgets.append(new CQtOpenCVImageWidgetPlugin(this)); // m_widgets.append(new CQtOpenCVCannyWidgetPlugin(this));</span></span></code> </pre><br><br>  After implementations of the <code>CQtOpenCVImageWidgetPlugin</code> and <code>CQtOpenCVCannyWidgetPlugin</code> you can remove comments.  And in the OpenCV component of Qt Designer, new items will appear. <br><br>  <a href="">Project archive.</a> <br><br><h5>  Test case </h5><br>  After assembling all the libraries, correctly assigning the links and setting the link to the collection in the plugins directory for Qt Designer, you can create a test case. <br><br>  In the Designer, create the <b>MainWindow</b> , put our widget, build it. <br><br><h4>  Conclusion </h4><br><ul><li>  Once again, the <a href="https://cloud.mail.ru/public/N9WD/HpmCe8DnA">source code of the project.</a> </li><li>  Try adding a combobox to select the type of cameras </li><li>  Do not write, please, "but you can do so."  Just do it.  Codes at your disposal </li></ul><br><br>  Thanks for attention. <br></div><p>Source: <a href="https://habr.com/ru/post/148467/">https://habr.com/ru/post/148467/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../148457/index.html">IT Compote # 15 Programming and Technology Podcast</a></li>
<li><a href="../148458/index.html">Erlang plugin for IntelliJ IDEA</a></li>
<li><a href="../148459/index.html">Monitor the number of documents in Sphinx indexes</a></li>
<li><a href="../148462/index.html">HyperActive Record - under-ORM on CodeIgniter</a></li>
<li><a href="../148464/index.html">Google Engineering Calculator</a></li>
<li><a href="../148471/index.html">Microsoft Office365: a classic in modern processing</a></li>
<li><a href="../148472/index.html">We build a report on the membership of users in AD groups: 4 problems in writing a Powershell script</a></li>
<li><a href="../148473/index.html">Cross-Vmny (CLR / JVM) Python Code</a></li>
<li><a href="../148474/index.html">The seminar ‚ÄúCreating an IT Startup‚Äù on July 29 in Gorky Park (Moscow)</a></li>
<li><a href="../148476/index.html">Launch trailer Metal War Online</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>