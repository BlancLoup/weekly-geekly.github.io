<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Factory widgets for MPA</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A widget factory is a way of organizing client code that fits perfectly into a multi-page application architecture (MPA). 

 The article will consider...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Factory widgets for MPA</h1><div class="post__text post__text-html js-mediator-article"> <a href="https://habrahabr.ru/post/339522/"><img src="https://habrastorage.org/webt/59/d7/99/59d7993a0dc4b994138504.png" alt="image"><br></a> <br>  A widget factory is a way of organizing client code that fits perfectly into a multi-page application architecture (MPA). <br><br>  The article will consider the architectural solution that will optimize the loading of scripts, divide the code into widgets and simplify the transfer of data to the client from the page (when server-side rendering). <br><blockquote>  <b>Widgets</b> will be called components (or component containers), the initialization point of which will be the DOM.  And in which it will be possible to transfer data from the template. </blockquote>  And now everything is consistent. <br><a name="habracut"></a><br><h2>  Concept </h2><br>  The page contains information about the called widgets (the name of the widget, the data for it). <br><br>  The implementation logic will be basically and the only plug-in that consists of: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  Scripts that run on most pages of our application </li><li>  Code for all common widgets <br><blockquote>  Hereinafter, <b>common</b> widgets will be understood as those widgets that are most often needed in an application, for example: navigation, search. </blockquote></li><li>  A hash list of all lazy widgets * containing their names and implementation paths <br><blockquote>  Hereinafter, <b>lazy</b> widgets will be understood as those widgets that are needed in rare cases.  Looking ahead, such widgets will be loaded dynamically, for example: gallery, marketing windows. </blockquote></li><li>  Directly widget factory code </li></ol><br>  To better understand the concept, let's analyze the implementation example. <br><br><h2>  Implementation </h2><br>  The implementation of the architecture itself is quite simple, with its version can be found on the <a href="https://github.com/Krivega/webpack-factory-widgets">githabe</a> .  It is based on the Webpack and its <a href="https://webpack.js.org/guides/code-splitting/">dynamic import</a> . <br><br>  Next, run through the main logical points: <br><br><ol><li>  The page contains a script tag containing the name of the widget, the data in the form of JSON <br><br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"application/widget+json"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> { </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"widget"</span></span></span><span class="actionscript">: </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"TesLazyWidget"</span></span></span><span class="actionscript">, </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"data"</span></span></span><span class="actionscript">: { </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"1"</span></span></span><span class="actionscript">: </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">1</span></span></span><span class="actionscript"> } } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </li><li>  Connect entry.js </li><li>  Running root scripts </li><li>  The widget factory finds all script tags <br><br><pre> <code class="javascript hljs">initWidgets($(<span class="hljs-string"><span class="hljs-string">'script[type="application/widget+json"]'</span></span>));</code> </pre></li><li>  JSON parsing <br><br><pre> <code class="javascript hljs">data = $.parseJSON(script.innerHTML);</code> </pre></li><li>  If this is a common widget, then it initializes and remembers it. <br><br><pre> <code class="javascript hljs">widget = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Widget(data);</code> </pre></li><li>  If this is a lazy widget then it loads <br><br><pre> <code class="javascript hljs">loaderWidget().then(createWidget);</code> </pre></li><li>  Start all memorized common widgets. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.widgets.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.widgets[i].start(); }</code> </pre></li><li>  Initializes and starts loaded lazy widgets. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> widget = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Widget(data); widget.start();</code> </pre></li></ol><br>  The implementation is schematic. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e3b/5b1/cc4/e3b5b1cc43dda582a6e5e11e0b3f5089.svg" alt="image"><br><br><h2>  The main advantages of this architecture </h2><br><h4>  Increase page loading speed </h4><br>  The main bundle contains only critical scripts, the main functionality.  Additional logic will be loaded dynamically.  In such a bundle there will be a high percentage of code coverage.  This reduces its page size and, as a result, improves performance. <br><br>  For example, the menu and information about the user will immediately load, and an advertising offer, a gallery of pictures and additional visual effects will dynamically load. <br><br><h4>  This is a good alternative to routing. </h4><br>  There is no need to create and configure routes and load the necessary scripts depending on URLs or templates.  No need to maintain complex dependencies, and therefore decreases the risk of error. <br><br><h4>  Simplified way to transfer data to the client </h4><br>  Simply by rendering JSON on the page, already at the parsing stage, the data gets to the client, without the need for additional AJAX requests. <br><br><pre> <code class="javascript hljs"> &lt;script type=<span class="hljs-string"><span class="hljs-string">"application/widget+json"</span></span>&gt; { <span class="hljs-string"><span class="hljs-string">"widget"</span></span>: <span class="hljs-string"><span class="hljs-string">"ActionBar"</span></span> , <span class="hljs-string"><span class="hljs-string">"data"</span></span>: { <span class="hljs-string"><span class="hljs-string">"isPublic"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"{{ id }}"</span></span>, <span class="hljs-string"><span class="hljs-string">"items"</span></span> : [{ <span class="hljs-string"><span class="hljs-string">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Edit"</span></span>, <span class="hljs-string"><span class="hljs-string">"iconLeft"</span></span>: <span class="hljs-string"><span class="hljs-string">"edit"</span></span> }] } } &lt;<span class="hljs-regexp"><span class="hljs-regexp">/script&gt;</span></span></code> </pre><br><h4>  Reducing code duplication </h4><br>  Reuse the widget?  Easy!  For example, on a page you need to implement several news lists with filters, uploads and other interactive logic.  For the implementation of this functionality will be responsible NewsList widget.  Similarly to html-tags, it is enough just to insert into the template a call to this widget as many lists as needed, and everywhere it is required. <br><br><pre> <code class="javascript hljs"> &lt;script type=<span class="hljs-string"><span class="hljs-string">"application/widget+json"</span></span>&gt; { <span class="hljs-string"><span class="hljs-string">"widget"</span></span>: <span class="hljs-string"><span class="hljs-string">"NewsList"</span></span>, <span class="hljs-string"><span class="hljs-string">"data"</span></span>: { <span class="hljs-string"><span class="hljs-string">"contentId"</span></span>: <span class="hljs-string"><span class="hljs-string">"business"</span></span> } } &lt;<span class="hljs-regexp"><span class="hljs-regexp">/script&gt; &lt;script type="application/</span></span>widget+json<span class="hljs-string"><span class="hljs-string">"&gt; { "</span></span>widget<span class="hljs-string"><span class="hljs-string">": "</span></span>NewsList<span class="hljs-string"><span class="hljs-string">", "</span></span>data<span class="hljs-string"><span class="hljs-string">": { "</span></span>contentId<span class="hljs-string"><span class="hljs-string">": "</span></span>policy<span class="hljs-string"><span class="hljs-string">" } } &lt;/script&gt;</span></span></code> </pre><br><h4>  The code becomes more readable and understandable. </h4><br>  The widget factory formalizes the rules for writing code, which in turn creates a clear structure for initializing and executing scripts.  In this approach, the widget call chain is linear.  The logic of each of them is encapsulated, and, as a result, less unforeseen consequences of code changes, less welfare in the project, and greater system flexibility. <br><br><h4>  Great way to organize code for ‚Äúold‚Äù projects </h4><br>  When in the application everything is already written, but without a special idea.  The constant feeling of mess does not leave.  And in the project pretty often inline scripts <br><br><pre> <code class="javascript hljs"> &lt;script&gt; <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>([<span class="hljs-string"><span class="hljs-string">'jquery'</span></span>, <span class="hljs-string"><span class="hljs-string">'selectBoxIt'</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$</span></span></span><span class="hljs-function">) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'#itemId_selector'</span></span>).selectBoxIt(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> $form = $(<span class="hljs-string"><span class="hljs-string">'#savepost'</span></span>); ‚Ä¶‚Ä¶.. $(<span class="hljs-string"><span class="hljs-string">'#skip'</span></span>).click(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $form.submit(); }); }); <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br>  you just need to create a widget and transfer this code to it.  Thus, the widget factory is a great way to switch to the component approach. <br><br>  Plus, you can automatically generate a list of widgets, like, for example, <a href="">here</a> .  This will simplify the creation of a widget before creating a directory with its name and a file with its implementation, which, in fact, can also be automated. <br><br><h2>  Instead of conclusion </h2><br>  As a result, the widget factory fits perfectly into the MPA architecture.  Formalizes the code, optimizes loading and gives clear and convenient rules for use. </div><p>Source: <a href="https://habr.com/ru/post/339522/">https://habr.com/ru/post/339522/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../339510/index.html">As we scrum scaled</a></li>
<li><a href="../339512/index.html">Uneducated youth: yes, another post from the student‚Äôs point of view</a></li>
<li><a href="../339516/index.html">Zabbix conference 2017: how was the first day</a></li>
<li><a href="../339518/index.html">The Unified State Automated Information System is not as terrible as they are frightened: what will the unique DataMobile module of the Unified State Automated Information System help retail stores with?</a></li>
<li><a href="../339520/index.html">We meet PostgreSQL 10. Translation Release Notes</a></li>
<li><a href="../339524/index.html">‚ÄúIf we started now from the beginning, we would choose Scala again‚Äù: Tinkoff.ru about Scala development</a></li>
<li><a href="../339526/index.html">Money pumping machine: miner Monero</a></li>
<li><a href="../339528/index.html">How to become a programmer</a></li>
<li><a href="../339532/index.html">Multimodal Emotion Recognition Challenge by Neurodata Lab</a></li>
<li><a href="../339534/index.html">Classic 2D quest or how our two years of development went. Part of the final</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>