<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A word guru, problems with unity3d, and a happy ending in the end</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The idea of ‚Äã‚Äãthe game and its features 



 Probably everyone played some games where words should be composed. Who does not know what crosswords are...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A word guru, problems with unity3d, and a happy ending in the end</h1><div class="post__text post__text-html js-mediator-article"><h1>  The idea of ‚Äã‚Äãthe game and its features </h1><br><img width="240" height="425" src="https://habrastorage.org/files/c6f/ba1/545/c6fba1545ec3428c89daa3a701074fe0.png"><br><p>  Probably everyone played some games where words should be composed.  Who does not know what crosswords are?  And <a href="https://ru.wikipedia.org/wiki/%25D0%2593%25D0%25BE%25D1%2580%25D0%25BE%25D0%25B4%25D0%25B0_%2528%25D0%25B8%25D0%25B3%25D1%2580%25D0%25B0%2529">Cities</a> .?  Another popular game (I do not remember the name) - a long word is given (for some reason I remember ‚Äúelectrification‚Äù), and all sorts of words (‚Äúelectrician‚Äù, ‚Äúfiction‚Äù), etc. are made up of it.  In general, there are a lot of such games - as well as classic (nastolki, sheet and pen), and electronic. </p><br><p>  But we are always not enough, we want more and better, right? </p><br><p>  In the West, there is a popular board game, where you also need to make words.  Called Scrabble, <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25BA%25D1%2580%25D1%258D%25D0%25B1%25D0%25B1%25D0%25BB">here is more information</a> .  The rules are simple - on the square playing field there is initially one word.  Each player has certain letters.  In his turn, he must lay out one chip so that a new word (or several words) is obtained.  Each letter has its own value (in points), so some words are more valuable than others.  Rare letters (for example, "F") give more points. </p><br><img src="https://habrastorage.org/files/a79/c6c/ed6/a79c6ced69f04e36865f7f4f30351067.png"><br><p>  My friend played a lot in Scrabble, and he had an idea - why not change the rules of the game so that it becomes more dynamic?  In short, it sounds like this - add one letter to one and collect a new word. </p><br><p>  No sooner said than done. </p><br><a name="habracut"></a><br><p>  Example: there is a playing field where the word "LAZ" is.  Add the letter "K" - we get the word "LAC".  Very simple, isn't it? </p><br><img src="https://habrastorage.org/files/e21/67a/02f/e2167a02f8b643098e4922d3ccacf8f1.png"><br><p>  Some game restrictions: you can only make nouns, remove their own names, place names, names, etc.  Words that can only be used in the plural are left (for example, "glasses"). </p><br><p>  I made a prototype of the game for a couple of days, and it fascinated me.  With a terrible design, with an incomplete vocabulary, with a blunt AI - but it was playable and addictive. </p><br><p>  And I took seriously the development. </p><br><h1>  Iron opponent </h1><br><p>  How does the development of the game begin?  In our case - with a playable core, which can be expanded.  We have a game with a computer. </p><br><p>  In general, we planned several game modes.  But the first mode, which should be in any case - is a game against the computer.  Live opponents may not be close, and here our computer will help out.  So I started writing the game by writing artificial intelligence (AI). </p><br><p>  How does AI work in our game when it moves? </p><br><p>  The first stage is the search for extreme cells.  I called a cell by a cell that contains a letter and has at least one free cell vertically or horizontally.  In the picture below, these cells are highlighted with red dots. </p><br><img src="https://habrastorage.org/files/d71/73c/54d/d7173c54daaa4bd192581cadfb7fe3a7.png"><br><p>  Why do we need such cells?  And because we can deliver a letter to an empty cell (yellow dot), and get a new word.  Please note that the word can be collected in two ways.  You can put a letter, start with it, and collect the word GAS (G first).  Or put the letter of the last, and collect the word ASS (last). </p><br><img src="https://habrastorage.org/files/409/fd6/94f/409fd694ff864673b889e278f28b381a.png"><br><p>  The second stage is after we have found all the extreme cells.  The next task is to make all kinds of chains, and check whether we can make a new word by adding a new letter in front or behind.  For example, for the example in the picture above, the following chains are possible: </p><br><ul><li>  L </li><li>  LA </li><li>  LAZ </li><li>  BUT </li><li>  LA </li><li>  AZ </li><li>  H </li><li>  BEHIND </li><li>  HALL </li></ul><br><p>  Obviously, as the field increases and the field becomes full, the number and length of the chains will increase.  Therefore, a willful decision was made, even at the maximum level of difficulty, to limit the length of strings to 10 characters.  As practice has shown, even with such a restriction, a computer without any problems cracks down on a person (at least with me and my friend). </p><br><p>  The third stage is to check which chains are valid (that is, you can create a new word).  I think, you guessed it, what problem seems obvious - we cannot use a dumb search, there are not enough resources to compare millions of times a line (if you search, just sorting through the elements sequentially).  It immediately comes to mind to use binary search - the benefit is a dictionary, and we can compare words. </p><br><p>  So I did.  True, I still optimized it.  What is the point - I slyly sorted out the dictionary.  For example, we have a string of 5 characters in length.  Obviously, the new word will be exactly 6 characters long.  That is, the length of the chain, we know the exact length of the word.  Therefore, the dictionary is sorted first by word length, and inside - alphabetically. </p><br><p>  Here is an example.  We have a chain SA.  If we add the letter D to the end, we get the word SAD, which is very good.  Therefore, what we do: </p><br><ul><li>  look for all words in the dictionary, 3 letters long (chain length + 1) </li><li>  among these words, we are looking for everything that begins in SA </li></ul><br><p>  The attentive ones noticed that this way we can find only those words that can be made up by adding a letter to the chain at the end.  But what about those words that can be made up by adding the letter at the beginning of the chain?  After all, we can make a word, and adding a front letter - for example, OCA.  It turns out that we need to look for three-letter words that end in the CA dictionary and we don‚Äôt have a sharpened word for it. </p><br><p>  The output was another dictionary, which is also sorted first by word length, and then by SECOND letter of the word.  Here is an excerpt from our dictionary: </p><br><p>  ... <br>  yard <br>  orc <br>  ruff <br>  wasp <br>  claim <br>  axis <br>  oak <br>  tooth <br>  cube <br>  ... </p><br><p>  It turns out that in both cases we are not looking for a complete word, but a substring (chain). </p><br><p>  And finally, the final stage is the sorting of the words obtained according to their price (and the price is calculated as the sum of points multiplied by the word length), and issuing the result depending on the complexity. </p><br><p>  About the complexity.  There is a good phrase - the task of the AI ‚Äã‚Äãis not to win, but to give up nicely.  In this case, this phrase is fully justified.  Writing an AI to play to the fullest means a person‚Äôs crash, binary search and modern smartphones do a quick search of options.  Therefore, the computer has a certain framework - it must keep from a person + - a certain number of points.  There are additional points there - for example, he cannot collect words that are less than a certain value. </p><br><p>  By the way, in the Ultra mode, all restrictions have been removed from the computer.  If someone knows a lot of long words with the letters b, f, b - play, it will be an interesting duel. </p><br><p>  Another life hack available to a person, but not available to the machine.  You can make a word, and adding a letter in the middle of the word.  For example, we have a chain M * MA (an asterisk is an empty cell).  If we add asterisk A instead of - we get the word MOM.  So, the computer is not looking for it - use it, fool the piece of iron (I do this all the time). </p><br><p>  As a conclusion, I want to say the following.  I was afraid that the AI ‚Äã‚Äãwould slow down - and initially undertook to optimize it to the maximum - no strings, arrays of chars, binary search with optimizations for a specific task.  But nothing slowed down - in general.  That is, even my ancient android-smartphone without delay works out the tasks of enumeration, even in a large field.  Conclusion - not such a weak iron on smartphones. </p><br><h1>  Game model.  Work with dictionaries </h1><br><p>  The first thing you need in games of this kind is a dictionary.  The more complete it is, the less problems there will be from angry users.  And if there is no rare word, this is not a big problem.  And if there is no word "cat" - this is very bad.  Therefore, the first stage is the compilation of a dictionary.  Oh, yes, two dictionaries - the game is in Russian and in English. </p><br><p>  First, I went through the Internet, found a base of 37 thousand words.  I was delighted.  But early.  This base was the result of a parser written by the author a long time ago.  As a result, there were not many words, and many were inappropriate (there were proper names, and ‚Äî oh, horror ‚Äî adjectives).  That was bad.  My friend threw me a couple more files with the words - there it was even worse - there were numbers, and everything like that. </p><br><p>  I wrote a utility in java, which I give to the input a "junk" file with all the words, and I give a list of valid characters.  And she throws out repetitions from the dictionary, removes words that have the wrong letters, cuts off too long words (hardly anyone will make a word more than 15 letters in such a game), and sorts them in alphabetical order (not quite alphabetic, but about this later).  After that, life became easier.  There was a new portion of words - added them to the end of the "junk" file, launched the utility - at the output ready-to-use words. </p><br><p>  I want to say that how many we did not look for dictionaries, we did not find all the words (and probably we will never find it again).  We played a lot of the game ourselves, and constantly wrote words on the leaflet, which I then manually added to the game.  This process continues even now - even though we find new words less and less.  I suspect that we just have limited vocabulary :) </p><br><p>  The next stage - we had a dictionary, where there were many, many words, and there were such words about which we did not know anything (do you know what is TPP? And this is such a variant of the pace, the horse jumps like that. I did not know personally, alas ).  What to do with these words?  Just throwing is not an option, because there are people who are smarter than me and my friend, and know what this beast is a CTP.  Therefore, in a couple of hours I‚Äôve put a utility on the left which is a list of words, and on the right a browser for the highlighted word: </p><br><img src="https://habrastorage.org/files/1e4/6a7/99d/1e46a799dbb747619e39a79507c278bd.png"><br><p>  A special feature is English.  Half of the words there are both nouns and half of the parts of speech.  And since neither I nor my friend are native speakers, it was difficult for us to work with such a dictionary.  We limited ourselves to checking short words (up to 5 letters inclusive) to en.wiktionary, so that there were noun.  In general, the approach is not very, but we have thrown out the worst words (like uivag).  Immediately to the question, where did such a word come from - this is not me, this is a parser so put on, and then we were disentangling :). </p><br><p>  We are well aware that the dictionaries have the wrong words, and we slowly clean the dictionaries.  But what about those words that are not included in the dictionary, and people enter them?  The decision was on the surface - if a person collects a word that is not in the dictionary, I send it to Google Analytics.  The plan is simple - we export the data as csv, I write software that will subtract the unique words from this stream.  The same software maintains a database where we will mark the words as scanned (if we are sent the word SHELF 768 times, I will be addicted 768 times to add it).  And little by little we will improve our vocabulary. </p><br><p>  Also in the next update we will add the ability to maintain a user dictionary.  If the user is exactly sure that such a word is in the dictionary, but we do not have it - he will be able to add this word. </p><br><p>  I also wanted to take ready-made dictionaries (in dict format), and some libraries for working with them.  Perhaps for other languages ‚Äã‚Äãwe will do that.  But, I am afraid, even in this case we will not cover 100% of all the necessary words of the language. </p><br><p>  In general, dictionaries - it is very difficult.  More precisely, a bad dictionary is generally easy, but a good dictionary is generally difficult.  It won't be done the first time, and we are now at the stage of constant improvement. </p><br><h1>  Design </h1><br><p>  Design is hard.  Design is not mine. </p><br><p>  A friend has an artist who drew us what you see in the screenshots.  This is not the gloss that you see in Candy Crush.  On the other hand, the current style is nice looking and suits this type of game.  I am pleased with the design. </p><br><p>  As expected, there are some problems between the design and its size.  I made the most of the large backgrounds, saved them in jpeg - I saved the size of apk, but did not improve anything on the video card.  But I did the maximum 9patch interface elements.  So I got about the same display on different screens. </p><br><p>  If you open the game, and open any dialog box - this is 9patch.  Both the blue background and the buttons are 9patch.  For myself, I realized that I would insist on 9patch as much as possible where it is possible. </p><br><p>  But the picture for those who can not open the game: </p><br><img width="240" height="425" src="https://habrastorage.org/files/d4b/b4f/601/d4bb4f601dd94f188e3230fbeccb4808.png"><br><p>  Apparently, we won. </p><br><h1>  First version - Unity3d </h1><br><p>  I started writing on Unity3d.  I had a little experience (before that we released another toy on Unity3d, but that's another story), and the 5th version is free, and the cool UI system is from the box ... In general, I was tempted. </p><br><p>  What to say.  The game slowed down.  Everything is OK on the computer, but on the phone there were always small lags, even though I didn‚Äôt do anything.  At first I sinned on non-optimized, but closer to the release I was worried - everything seemed to be playable, but small such lags spoiled the whole raspberry.  And I started digging optimization materials. </p><br><p>  I originally measured FPS.  He was bad - he jumped.  From 10 to 60. When he was 10 - play was bad, scrolling the panel with letters was fuzzy and jerky.  I was upset and began to apply all the advice from the Internet.  I degraded the quality of the textures, raised the V-sync, set lower quality settings.  I forcibly set compatibility only with OpenGL 2 (wrote that it helps).  In general, I tried everything I could. </p><br><p>  Then I did the following - I created a new empty scene.  There put the FPS counter.  And launched the game.  The FPS was about 50 - I was a little upset, because for some reason the empty scene already eats 10 frames - but not very much, because he (FPS) almost didn‚Äôt jump.  After that I added Canvas to the scene, added Image (full-screen background 480 * 800, of the most primitive shader - it seems, Vertex Unlit) - and launched it again.  FPS dropped to 40. I was generally upset. </p><br><p>  I had no problems with the architecture of the game, C # is similar to java, in some places even more comfortable (hello, properties), and in some places worse (there is no such freedom in working with enums).  I wrote all the code without problems, I did the whole UI.  But I could not do anything with the brakes.  I rummaged on the Internet, and found a bunch of similar problems in other people.  They wrote that after the appearance of the 5th version of Unity3d, their projects began to slow down terribly.  Apparently, I am another victim.  I tried to install Unity 5.2 (I originally had 5.3), tried it and beta 5.4.  To no avail. </p><br><p>  I was disappointed in Unity3d, the hope of releasing the game in a day or two collapsed.  I could not release a braking puzzle game, the inner one in me did not let me do it.  I decided to go back to basics. </p><br><h1>  Switch to libgdx </h1><br><p>  I created a new libgdx project, and started porting the game.  libgdx is something that did not let me down.  Some things to do there longer (because everything is handles), but I have never had any questions about performance. </p><br><p>  The architecture turned out, of course, quite different than on Unity3d.  The only part that I transferred without changes is working with dictionaries and AI.  I stupidly copied files from Unity3d, changed the extension from .cs to .java, and corrected the code.  And it worked fine.  This proves that language is not important - the algorithm and the idea are important. </p><br><p>  I made the main class a singleton, and called it Core: </p><br><div class="spoiler">  <b class="spoiler_title">Core.java</b> <div class="spoiler_text"><p>  package ua.com.umachka.word.guru; </p><br><p>  import com.badlogic.gdx.Game; <br>  import com.badlogic.gdx.Gdx; <br>  import com.badlogic.gdx.graphics.g2d.BitmapFont; <br>  import com.badlogic.gdx.graphics.g2d.SpriteBatch; <br>  import com.badlogic.gdx.graphics.g2d.TextureRegion; </p><br><p>  import ua.com.umachka.word.guru.localize.Localize; <br>  import ua.com.umachka.word.guru.screen.game.logic.WordDict; <br>  import ua.com.umachka.word.guru.screen.game.logic.ai.SolutionSearcher; <br>  import ua.com.umachka.word.guru.screen.splash.SplashScreen; <br>  import ua.com.umachka.word.guru.settings.Settings; </p><br><p>  public class Core extends Game { <br>  private static Core instance = new Core (); </p><br><pre><code class="hljs java"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SpriteBatch batch; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Assets assets; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Localize localize; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> WordDict dict; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> PlatformInteraction platformInteraction; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SolutionSearcher searcher; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> appTimeInSeconds = <span class="hljs-number"><span class="hljs-number">0f</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Core</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Core </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getInstance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> instance; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setPlatformInteraction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PlatformInteraction platformInteraction)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.platformInteraction = platformInteraction; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> PlatformInteraction </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPlatformInteraction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> platformInteraction; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ batch = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SpriteBatch(); assets = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Assets(); assets.loadAll(); localize = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Localize(); localize.loadLanguage(Settings.getInstance().getLanguage()); dict = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WordDict(); dict.load(<span class="hljs-string"><span class="hljs-string">"en"</span></span>); searcher = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SolutionSearcher(); searcher.setDict(dict); Gdx.input.setCatchBackKey(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); setScreen(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SplashScreen(batch)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> SpriteBatch </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSpriteBatch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> batch; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> TextureRegion </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRegion</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String regionName)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> assets.getRegion(regionName); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> BitmapFont </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFont</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> size)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> assets.getFont(size); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">text</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String tag)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> localize.text(tag); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Localize </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">localize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> localize; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> WordDict </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDict</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dict; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Assets </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">assets</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> assets; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> SolutionSearcher </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSearcher</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> searcher; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">render</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ appTimeInSeconds += Gdx.graphics.getDeltaTime(); <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.render(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dispose</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ platformInteraction.reportGameEvent(<span class="hljs-string"><span class="hljs-string">"app-session-length: "</span></span> + (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) appTimeInSeconds + <span class="hljs-string"><span class="hljs-string">" sec"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.dispose(); }</code> </pre> <br><p>  } </p></div></div><br><p>  Wrote the base class for all screens: </p><br><div class="spoiler">  <b class="spoiler_title">BaseScreeen.java</b> <div class="spoiler_text"><p>  package ua.com.umachka.word.guru.screen; </p><br><p>  import com.badlogic.gdx.Gdx; <br>  import com.badlogic.gdx.Input.Keys; <br>  import com.badlogic.gdx.ScreenAdapter; <br>  import com.badlogic.gdx.graphics.GL20; <br>  import com.badlogic.gdx.graphics.g2d.SpriteBatch; <br>  import com.badlogic.gdx.scenes.scene2d.Actor; <br>  import com.badlogic.gdx.scenes.scene2d.InputEvent; <br>  import com.badlogic.gdx.scenes.scene2d.InputListener; <br>  import com.badlogic.gdx.scenes.scene2d.Stage; <br>  import com.badlogic.gdx.scenes.scene2d.actions.Actions; <br>  import com.badlogic.gdx.utils.viewport.ScreenViewport; </p><br><p>  public class BaseScreen extends ScreenAdapter { <br>  private Stage stage; <br>  private SpriteBatch batch; </p><br><pre> <code class="hljs java"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BackPressListener</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InputListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">keyDown</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(InputEvent event, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> keycode)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (keycode == Keys.ESCAPE || keycode == Keys.BACK) { onBackOrEscapePressed(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BaseScreen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SpriteBatch batch)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (batch == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { batch = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SpriteBatch(); } stage = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Stage(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ScreenViewport(), batch); stage.addListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BackPressListener()); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">render</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> delta)</span></span></span><span class="hljs-function"> </span></span>{ Gdx.gl.glClear( GL20.GL_COLOR_BUFFER_BIT | GL20.GL_DEPTH_BUFFER_BIT ); stage.act(delta); stage.draw(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">show</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Gdx.input.setInputProcessor(stage); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addActor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Actor actor)</span></span></span><span class="hljs-function"> </span></span>{ stage.addActor(actor); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBackOrEscapePressed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Stage </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getStage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> stage; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> SpriteBatch </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getBatch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> batch; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">postTask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> delay, Runnable task)</span></span></span><span class="hljs-function"> </span></span>{ stage.addAction(Actions.sequence(Actions.delay(delay), Actions.run(task))); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">repeatTask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> interval, Runnable task)</span></span></span><span class="hljs-function"> </span></span>{ stage.addAction(Actions.forever(Actions.sequence(Actions.run(task), Actions.delay(interval)))); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getHeightPixels</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> percent)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> stage.getHeight() * percent; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getWidthPixels</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> percent)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> stage.getWidth() * percent; }</code> </pre> <br><p>  } </p></div></div><br><p>  I also made some auxiliary classes - as a typesetter, localizemanager.  These are trivial things, it makes no sense to describe them even.  I take localization from json files.  I would like to note that the latest libgdx versions allow you to make text colored, marking it with [COLOR] tags.  We just needed to do this (in one Label, to make several colors), and this opportunity came in very handy. </p><br><p>  The game is logically divided into 4 screens (splash, initial choice of language, menu, game screen).  Each screen is a separate package, if possible, elements of the screen are separate classes (for example, there is a menu screen, and there is a top panel - I make this panel a separate class).  Then it's easier to rule the toy. </p><br><p>  If possible, the logic is in the Model class.  It stores the state of the field, a list of words that have already been used.  The model also sends messages if there are any changes in it.  It turned out about the pattern Model-Presenter.  Presenter is a GameScreen, which shows the image and handles user input. </p><br><p>  To support multi-screen, I used Table.  Who does not know - this is the layout manager for UI elements.  The layout is called TableLayout.  You can arrange the elements in the cells of the virtual table, and customize each cell.  In general, it is quite convenient, and sometimes it turns out to do what it is difficult to do with pens in unity3d. </p><br><p>  I packed all the pictures in the game into one textural satin - 1024 * 1024.  Part of the place in the atlas is still free - this is nice.  This, by the way, is one of the libgdx bonuses (and generally low-level engines) - you can precisely control what resources take up how much space.  Unity3d itself packs pictures into atlases, but I didn‚Äôt fully understand how she does it, and most importantly, how to see the final result, how many atlases and how big it was. </p><br><p>  Sounds and music.  We don't have them.  A woman with a cart - a mare is easier :) </p><br><p>  Text resources - dictionaries, localization.  Localization - json.  Json is generally a great format if the data size is not too large. <br>  Dictionaries - plain text.  As someone may have noted above, we have two identical dictionaries for each language, but sorted in different ways.  You can sort, of course, when you start the application - but it is better to sacrifice several hundred kilobytes of application size than with brakes during launch. </p><br><p>  Fonts I used TrueType, ttf.  Libgdx has a library for working with them, and it works well.  Memory such fonts eat more, of course, than just texture, but the result is much better visually. </p><br><p>  What I want to say.  I wrote the version on Unity3d about a month.  Rewrote in three days on libgdx.  The comparison is not fair, because the assets have already been prepared, and the main part of the logic has been written.  But according to my feelings, I would still need less time on libgdx than on Unity3d. </p><br><p>  Several factors played a role.  The first is that I know libgdx well, and not very well, Unity3d.  Secondly - the idea of ‚Äã‚Äãthe game and everything I needed, I had.  The main result.  And it‚Äôs like this - instead of 16 megabytes of braking APK (I‚Äôve cut Android x86 support in Unity3d to achieve this size, otherwise I‚Äôll get 20+) ‚ÄîI got an APK of 8 megabytes, and a quick one (stable 60 FPS with fullscreen translucent backgrounds).  Plus the ability to easily interact with android-code.  Minus - porting to ios will be more difficult, especially in light of the latest news about libgdx.  But porting to ios is not clear when it will be, and whether it will be at all, and a stable android version is needed now. </p><br><p>  For myself, I made a conclusion - for my projects I will use libgdx, and develop my engine, built on top of it.  This will allow me not to shudder when Unity3d is updated to the next version, and not to think about how the build on Android will now work, whether the application will slow down.  On the other hand, I will periodically feel for the next version of Unity3d - maybe the situation will improve, who knows.  In general, it seems to me that Unity3d is going more towards desktop development, and therefore, they don‚Äôt really care about performance on mobile devices. </p><br><h1>  Monetization </h1><br><p>  The first version is fully functional and free, there are no additional features that can be bought for money.  But there is an advertisement - a banner in the playing field below, and a full screen at the end of the game.  In the future, we plan to introduce some bonuses that can be purchased for in-app - add a letter, change the letter, etc.  More have not thought about it.  First you need to bring it to mind (dictionary and other game modes), and then you can think about monetization. </p><br><h1>  Plans for updates </h1><br><p>  Mass plans.  We want to add a user dictionary.  I want to add a game over the network (I plan to write a server on Netty, I have some experience).  Add achivki.  Add new languages.  There are a lot of ideas, but there is little time :) But a user dictionary will definitely be included in the nearest update - this is a necessary feature. </p><br><h1>  Results </h1><br><p>  This game was the second one I wrote, and which I myself enjoy playing.  If you ask, which is the first - it is not mine, freelancing, and it has not yet come out.  And it seems to me that this is the right way - to write games that you play with pleasure yourself.  And to write them, such games, you need to be happy :) </p><br><p>  PS If there are any nuances on the issues of game logic or libgdx - write in the comments.  I understand that I cannot cover the whole topic, and could miss something, so I will be happy to answer any questions. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/282491/">https://habr.com/ru/post/282491/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../282475/index.html">The implementation of the simulator of the mathematical game "Life"</a></li>
<li><a href="../282477/index.html">Async / Await in javascript. View from the outside</a></li>
<li><a href="../282479/index.html">CRM: April theses from Ruli24</a></li>
<li><a href="../282485/index.html">New Firefox 46.0 is available for free on FTP Mozilla</a></li>
<li><a href="../282489/index.html">Hackers and exchanges: The consequences of attacks on financial companies</a></li>
<li><a href="../282493/index.html">Communications in store-and-forward mode, UUCP</a></li>
<li><a href="../282499/index.html">QFont and device independent font size</a></li>
<li><a href="../282501/index.html">Russian Code Cup 2016: for the first time in English</a></li>
<li><a href="../282505/index.html">Qt Quick Controls 2 - have been waiting for the promised three years</a></li>
<li><a href="../282507/index.html">Memo for the office sysadmin</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>