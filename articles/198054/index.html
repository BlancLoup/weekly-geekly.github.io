<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>About how we made the game for google play</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="About how we made the game "Stickers" for Google Play 


 Long ago, I had the idea to share my knowledge with the community. At first I wanted to writ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>About how we made the game for google play</h1><div class="post__text post__text-html js-mediator-article">  About how we made the game "Stickers" for Google Play <br><img src="https://habrastorage.org/getpro/habr/post_images/555/422/437/5554224370248c840e35f9471eb751f5.jpg"><br><br>  Long ago, I had the idea to share my knowledge with the community.  At first I wanted to write something on astrophysics or GR, but I decided nevertheless that it would be more correct to write about the subject area I deal with professionally.  So, I will try to explain in detail the process of creating and the subtleties of the implementation of the game application for Android (starting from design, ending with publication and In App purchases). <br><a name="habracut"></a><br><br><h4>  Introduction </h4><br>  I am engaged in programming from the first class, I graduated from Applied Mathematics of St.Petersburg State Pedagogical University  Recently (about a year ago) I discovered development for mobile platforms.  It became interesting what it is and what it is eaten with.  Currently I am developing several projects in a team of friends / colleagues, but I would like to write about my first experience.  Such an experience was writing a gaming application - ‚Äú <a href="https://play.google.com/store/apps/details%3Fid%3Dcom.gesoftware.stickers">Stickers</a> ‚Äù (Who am I?). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">What kind of stickers are these?</b> <div class="spoiler_text">  For those who do not know - I will explain.  Stickers are such a table game, in which each player has a piece of paper glued to his forehead with some famous character (the characters come up with each other playing).  The goal of each participant is to guess the character he has guessed. <br>  Gameplay is an alternate task of "yes / no" questions and receiving answers to them from other players. <br></div></div><br><br>  The choice fell on the "Stickers" for several reasons. <br>  First, we did not find any analogues in the market (meaning the implementation of the rules of the table game described). <br>  Secondly, I wanted to write something not very time consuming. <br>  Thirdly, the game is quite popular in our circles and we thought that maybe it would be interesting for someone to play it virtually. <br><br><h4>  Development process </h4><br><h5>  Formulation of the problem </h5><br>  The task was formed quite unambiguous.  You need to implement a client-server application that allows its users to use the following features: <br><ul><li>  Create your own account </li><li>  Authentication using your own account </li><li>  View player rankings </li><li>  Creating a game room </li><li>  Entrance to the game room </li><li>  Participation in the game process </li></ul><br><br>  Gameplay is an alternate phase change: <br><ul><li>  Question phase </li><li>  Voting phase </li></ul><br><br><h5>  UI Design </h5><br>  Fortunately, my wife is a designer and I practically did not have to take part in the selection of the palette, the arrangement of elements and other design pieces.  Based on the analysis of the possibilities that the game should provide the player, it was decided how many game states (Activities) there would be and what controls should be in each of them: <br><ul><li>  Main menu <br><ul><li>  Authentication </li><li>  check in </li><li>  Access to player ratings </li></ul><br></li><li>  Player Ratings <br><ul><li>  Return to the main menu </li></ul><br></li><li>  List of rooms <br><ul><li>  Entrance to the room </li><li>  Making your room </li><li>  Go to the main menu </li></ul><br></li><li>  Current room <br><ul><li>  Exit the room </li></ul><br></li><li>  Game Status # 1: question input <br><ul><li>  Question entry </li><li>  Go to the history of issues </li><li>  Go to answer input </li><li>  Go to the main menu </li></ul><br></li><li>  Game Status # 2: View Question History <br><ul><li>  Go to question entry </li><li>  Go to answer input </li><li>  Go to the main menu </li></ul><br></li><li>  Game Status # 3: Enter Answer <br><ul><li>  Enter Answer </li><li>  Go to question entry </li><li>  Go to the history of issues </li><li>  Go to the main menu </li></ul><br></li><li>  Game condition number 4: vote <br><ul><li>  Enter votes </li><li>  Go to the main menu </li></ul><br></li><li>  Victory <br><ul><li>  Go to the main menu </li></ul><br></li><li>  Defeat <br><ul><li>  Go to Wikipedia (on character page) </li><li>  Go to the main menu </li></ul><br></li></ul><br><br><div class="spoiler">  <b class="spoiler_title">State transition pattern</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/1b3/3c1/b1c/1b33c1b1c04ad12258223bce673bcbda.png"><br><br></div></div><br><br><h5>  DB Design </h5><br>  As soon as it became clear to us which game states and objects exist in the game, we proceeded to formalize them in terms of the database. <br><br>  So, we need the following tables: <br><ul><li>  Users.  Table that stores information about all users </li><li>  Games.  The table that stores information about all the rooms </li><li>  Characters.  The table that stores information about all the characters </li><li>  Questions.  A table that stores user questions about the characters they think </li><li>  Answers.  The table in which user responses are stored </li></ul><br><br>  In the initial version of the game there were only these tables, but the game developed and new ones were added.  I will not describe the rest of the tables, otherwise the narration will be overly long.  The database diagram shows all the tables, but their presence will not prevent further tell. <br><br><div class="spoiler">  <b class="spoiler_title">Database schema</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/1a9/783/485/1a9783485dfadb199e0d511720195cf0.png" title="Click to see full size"></a> <br></div></div><br><br>  The relationships between the tables changed several times (agile, so to speak), but eventually the following remained: <br><ul><li>  One character can be assigned to each user. </li><li>  Each user can only be in one room. </li><li>  Each question can be asked only by one user. </li><li>  Each question can relate to only one character. </li><li>  Each question can only be asked in one game. </li><li>  Each answer can be given only by one user. </li><li>  Each answer can be given only to one question. </li></ul><br><div class="spoiler">  <b class="spoiler_title">And where is the data normalization?</b> <div class="spoiler_text">  Duplicate links are needed only to reduce the load on the database and they appeared far from the first version of the game.  With the increase in the number of tables, the number of aggregations has increased, which needs to be made for certain data samples. <br></div></div><br><br><h5>  Application level </h5><br>  Finally we got to the software implementation.  So, I'll start with the most common words.  The whole project consists of 4 modules: <br><ul><li>  Venta.  Library that contains useful utilities </li><li>  Protocol.  Library with interaction protocol description </li><li>  Server.  Server part of the application </li><li>  Client.  Client part of the application </li></ul><br><br><div class="spoiler">  <b class="spoiler_title">Project outline</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/f60/5ab/759/f605ab759e9ec6c25e9d490eca8ccdee.png"></div></div><br><br><h6>  <a href="https://github.com/Trimax/venta">Venta</a> Library </h6><br>  Since I like to reinvent the wheel and don‚Äôt like the jumble of third-party libraries (yes, yes, the classic problem of many pedant programmers), I decided to write some things myself.  This library is written by me for a long time and it contains many utilities useful for me (work with a database, client-server interaction, actors, mathematics, encryption ...). <br>  In this article I want to talk about the network part of this library.  I decided to implement the interaction between the client and the server by serializing / deserializing the objects, among which are requests and responses.  The elementary information item being sent (at the library level, of course) is the <b>Message</b> object: <br><br><div class="spoiler">  <b class="spoiler_title">"Message.java"</b> <div class="spoiler_text"><pre><code class="hljs java"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.gesoftware.venta.network.model; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.gesoftware.venta.utility.CompressionUtility; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.nio.charset.Charset; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.Serializable; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Arrays; <span class="hljs-comment"><span class="hljs-comment">/* * * Message class definition * */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Message</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* Time */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> m_Timestamp; <span class="hljs-comment"><span class="hljs-comment">/* Message data */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] m_Data; <span class="hljs-comment"><span class="hljs-comment">/* * * METHOD: Message class constructor * PARAM: [IN] data - bytes array data * AUTHOR: Eliseev Dmitry * */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> data[])</span></span></span><span class="hljs-function"> </span></span>{ m_Timestamp = System.currentTimeMillis(); m_Data = data; } <span class="hljs-comment"><span class="hljs-comment">/* End of 'Message::Message' method */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* * * METHOD: Message class constructor * PARAM: [IN] data - bytes array data * AUTHOR: Eliseev Dmitry * */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String data)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>(data.getBytes()); } <span class="hljs-comment"><span class="hljs-comment">/* End of 'Message::Message' method */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* * * METHOD: Message class constructor * PARAM: [IN] object - some serializable object * AUTHOR: Eliseev Dmitry * */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Object object)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>(CompressionUtility.compress(object)); } <span class="hljs-comment"><span class="hljs-comment">/* End of 'Message::Message' method */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* * * METHOD: Bytes data representation getter * RETURN: Data bytes representation * AUTHOR: Eliseev Dmitry * */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] getData() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_Data; } <span class="hljs-comment"><span class="hljs-comment">/* End of 'Message::getData' method */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* * * METHOD: Gets message size * RETURN: Data size in bytes * AUTHOR: Eliseev Dmitry * */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (m_Data != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>)?m_Data.length:<span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/* End of 'Message::getSize' method */</span></span> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (m_Data != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>)?<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(m_Data, Charset.forName(<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>)):<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/* End of 'Message::toString' method */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* * * METHOD: Compares two messages sizes * RETURN: TRUE if messages has same sizes, FALSE otherwise * PARAM: [IN] message - message to compare with this one * AUTHOR: Eliseev Dmitry * */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">messagesHasSameSizes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Message message)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_Data != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; m_Data.length == message.m_Data.length; } <span class="hljs-comment"><span class="hljs-comment">/* End of 'Message::messagesHasSameSize' method */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* * * METHOD: Compares two messages by their values * RETURN: TRUE if messages has same sizes, FALSE otherwise * PARAM: [IN] message - message to compare with this one * AUTHOR: Eliseev Dmitry * */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">messagesAreEqual</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Message message)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* Messages has different sizes */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!messagesHasSameSizes(message)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* At least one of characters is not equal to same at another message */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; message.m_Data.length; i++) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m_Data[i] != message.m_Data[i]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* Messages are equal */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/* End of 'Message::messagesAreEqual' method */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* * * METHOD: Tries to restore object, that may be packed in message * RETURN: Restored object if success, null otherwise * AUTHOR: Eliseev Dmitry * */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getObject</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CompressionUtility.decompress(m_Data); } <span class="hljs-comment"><span class="hljs-comment">/* End of 'Message::getObject' method */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* * * METHOD: Gets message sending time (in server time) * RETURN: Message sending time * AUTHOR: Eliseev Dmitry * */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTimestamp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_Timestamp; } <span class="hljs-comment"><span class="hljs-comment">/* End of 'Message::getTimestamp' method */</span></span> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object obj)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> obj <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Message &amp;&amp; messagesAreEqual((Message) obj); } <span class="hljs-comment"><span class="hljs-comment">/* End of 'Message::equals' method */</span></span> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hashCode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Arrays.hashCode(m_Data); } <span class="hljs-comment"><span class="hljs-comment">/* End of 'Message::hashCode' method */</span></span> } <span class="hljs-comment"><span class="hljs-comment">/* End of 'Message' class */</span></span></code> </pre> <br></div></div><br><br>  I will not elaborate on the description of this object, the code is quite commented. <br><br>  Simplification of work with the network occurs through the use of two classes: <br><ul><li>  Server (server side) </li><li>  Connection (client part) </li></ul><br><br>  When creating an object of type <b>Server</b> , you need to specify the port on which it will expect incoming connections and the implementation of the <b>IServerHandler</b> interface <br><br><div class="spoiler">  <b class="spoiler_title">"IServerHandler.java"</b> <div class="spoiler_text"><pre> <code class="hljs java"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.gesoftware.venta.network.handlers; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.gesoftware.venta.network.model.Message; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.gesoftware.venta.network.model.ServerResponse; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.net.InetAddress; <span class="hljs-comment"><span class="hljs-comment">/* Server handler interface declaration */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IServerHandler</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* * * METHOD: Will be called right after new client connected * RETURN: True if you accept connected client, false if reject * PARAM: [IN] clientID - client identifier (store it somewhere) * PARAM: [IN] clientAddress - connected client information * AUTHOR: Eliseev Dmitry * */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onConnect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String clientID, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> InetAddress clientAddress)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/* * * METHOD: Will be called right after server accept message from any connected client * RETURN: Response (see ServerResponse class), or null if you want to disconnect client * PARAM: [IN] clientID - sender identifier * PARAM: [IN] message - received message * AUTHOR: Eliseev Dmitry * */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> ServerResponse </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onReceive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String clientID, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Message message)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/* * * METHOD: Will be called right after any client disconnected * PARAM: [IN] clientID - disconnected client identifier * AUTHOR: Eliseev Dmitry * */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDisconnect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String clientID)</span></span></span></span>; } <span class="hljs-comment"><span class="hljs-comment">/* End of 'IServerHandler' interface */</span></span></code> </pre><br></div></div><br><br>  The client, in turn, when creating an object of type <b>Connection</b> must provide an implementation of the <b>IClientHandler</b> interface. <br><br><div class="spoiler">  <b class="spoiler_title">‚ÄùIClientHandler.java‚Äù</b> <div class="spoiler_text"><pre> <code class="hljs java"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.gesoftware.venta.network.handlers; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.gesoftware.venta.network.model.Message; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.gesoftware.venta.network.model.ServerResponse; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.net.InetAddress; <span class="hljs-comment"><span class="hljs-comment">/* Server handler interface declaration */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IServerHandler</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* * * METHOD: Will be called right after new client connected * RETURN: True if you accept connected client, false if reject * PARAM: [IN] clientID - client identifier (store it somewhere) * PARAM: [IN] clientAddress - connected client information * AUTHOR: Eliseev Dmitry * */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onConnect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String clientID, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> InetAddress clientAddress)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/* * * METHOD: Will be called right after server accept message from any connected client * RETURN: Response (see ServerResponse class), or null if you want to disconnect client * PARAM: [IN] clientID - sender identifier * PARAM: [IN] message - received message * AUTHOR: Eliseev Dmitry * */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> ServerResponse </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onReceive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String clientID, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Message message)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/* * * METHOD: Will be called right after any client disconnected * PARAM: [IN] clientID - disconnected client identifier * AUTHOR: Eliseev Dmitry * */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDisconnect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String clientID)</span></span></span></span>; } <span class="hljs-comment"><span class="hljs-comment">/* End of 'IServerHandler' interface */</span></span></code> </pre><br></div></div><br>  Now a little about the internal device server.  As soon as the next client joins the server, a unique hash is calculated for it and two streams are created: the receive stream and the send stream.  Reception flow is blocked and waiting for a message from the client.  As soon as the message from the client has been accepted, it is transferred to the handler registered by the library user.  As a result of processing, one of five events can occur: <br><ul><li>  Disconnecting a client (let's say a disconnect request has arrived) </li><li>  Sending a response to the client </li><li>  Sending a response to another client </li><li>  Sending a response to all connected clients </li><li>  Sending a response to a group of clients </li></ul><br><br>  If now it is necessary to send a message to any of the connected clients, it is placed in the sending queue of messages of this client, and the thread responsible for sending is notified that new messages have appeared in the queue. <br><br>  Clearly, the data stream can be shown below. <br><div class="spoiler">  <b class="spoiler_title">The data flow in the network module of the library</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/d6e/6d4/124/d6e6d41241f27d304097db6ffac86368.png"><br></div></div><br><br>  Client X sends a request to the server (red arrow).  The request is received at the corresponding receiver stream.  It immediately calls the message handler (yellow arrow).  As a result of processing, some response is generated, which is placed in the client's send queue X (green arrow).  The send stream checks for messages in the send queue (black arrow) and sends a response to the client (blue arrow). <br><br><div class="spoiler">  <b class="spoiler_title">Example (multi-user echo server)</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.gesoftware.venta.network; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.gesoftware.venta.logging.LoggingUtility; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.gesoftware.venta.network.handlers.IClientHandler; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.gesoftware.venta.network.handlers.IServerHandler; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.gesoftware.venta.network.model.Message; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.gesoftware.venta.network.model.ServerResponse; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.net.InetAddress; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.TimerTask; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NetworkTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c_Port = <span class="hljs-number"><span class="hljs-number">5502</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startServer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Server server = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Server(c_Port, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IServerHandler() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onConnect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String clientID, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> InetAddress clientAddress)</span></span></span><span class="hljs-function"> </span></span>{ LoggingUtility.info(<span class="hljs-string"><span class="hljs-string">"Client connected: "</span></span> + clientID); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ServerResponse </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onReceive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String clientID, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Message message)</span></span></span><span class="hljs-function"> </span></span>{ LoggingUtility.info(<span class="hljs-string"><span class="hljs-string">"Client send message: "</span></span> + message.toString()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ServerResponse(message); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDisconnect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String clientID)</span></span></span><span class="hljs-function"> </span></span>{ LoggingUtility.info(<span class="hljs-string"><span class="hljs-string">"Client disconnected: "</span></span> + clientID); } }); (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Thread(server)).start(); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Task</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TimerTask</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Connection m_Connection; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Task</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Connection connection)</span></span></span><span class="hljs-function"> </span></span>{ m_Connection = connection; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ m_Connection.send(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Message(<span class="hljs-string"><span class="hljs-string">"Hello, current time is: "</span></span> + System.currentTimeMillis())); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startClient</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Connection connection = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Connection(<span class="hljs-string"><span class="hljs-string">"localhost"</span></span>, c_Port, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IClientHandler() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onReceive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Message message)</span></span></span><span class="hljs-function"> </span></span>{ LoggingUtility.info(<span class="hljs-string"><span class="hljs-string">"Server answer: "</span></span> + message.toString()); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onConnectionLost</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String message)</span></span></span><span class="hljs-function"> </span></span>{ LoggingUtility.info(<span class="hljs-string"><span class="hljs-string">"Connection lost: "</span></span> + message); } }); connection.connect(); (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> java.util.Timer(<span class="hljs-string"><span class="hljs-string">"Client"</span></span>)).schedule(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Task(connection), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String args[])</span></span></span><span class="hljs-function"> </span></span>{ LoggingUtility.setLoggingLevel(LoggingUtility.LoggingLevel.LEVEL_DEBUG); startServer(); startClient(); } }</code> </pre><br></div></div><br>  Pretty short, isn't it? <br><br><h6>  Game server </h6><br>  The game server architecture is multi-layered.  Immediately give her scheme, and then the description. <br><div class="spoiler">  <b class="spoiler_title">Server architecture diagram</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/b57/1c0/b09/b571c0b09693279e63db63e1e38be3ab.png"></div></div><br><br>  So, the connection pool is used to interact with the database (I use the BoneCP library).  To work with prepared requests (prepared statements), I wrapped the connection in my own class (the Venta library). <br><br><div class="spoiler">  <b class="spoiler_title">DBConnection.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.gesoftware.venta.db; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.gesoftware.venta.logging.LoggingUtility; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.jolbox.bonecp.BoneCPConfig; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.jolbox.bonecp.BoneCP; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.InputStream; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.AbstractList; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.LinkedList; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.HashMap; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Map; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.sql.*; <span class="hljs-comment"><span class="hljs-comment">/** * DB connection class definition **/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DBConnection</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* Connections pool */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> BoneCP m_Pool; <span class="hljs-comment"><span class="hljs-comment">/** * DB Statement class definition **/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DBStatement</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> PreparedStatement m_Statement; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Connection m_Connection; <span class="hljs-comment"><span class="hljs-comment">/* * * METHOD: Class constructor * PARAM: [IN] connection - current connection * PARAM: [IN] statement - statement, created from connection * AUTHOR: Dmitry Eliseev * */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DBStatement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Connection connection, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> PreparedStatement statement)</span></span></span><span class="hljs-function"> </span></span>{ m_Connection = connection; m_Statement = statement; } <span class="hljs-comment"><span class="hljs-comment">/* End of 'DBStatement::DBStatement' class */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* * * METHOD: Integer parameter setter * RETURN: True if success, False otherwise * PARAM: [IN] index - parameter position * PARAM: [IN] value - parameter value * AUTHOR: Dmitry Eliseev * */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setInteger</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { m_Statement.setInt(index, value); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">final</span></span> SQLException e) { LoggingUtility.debug(<span class="hljs-string"><span class="hljs-string">"Can't set integer value: "</span></span> + value + <span class="hljs-string"><span class="hljs-string">" because of "</span></span> + e.getMessage()); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/* End of 'DBStatement::setInteger' class */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* * * METHOD: Long parameter setter * RETURN: True if success, False otherwise * PARAM: [IN] index - parameter position * PARAM: [IN] value - parameter value * AUTHOR: Dmitry Eliseev * */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setLong</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { m_Statement.setLong(index, value); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">final</span></span> SQLException e) { LoggingUtility.debug(<span class="hljs-string"><span class="hljs-string">"Can't set long value: "</span></span> + value + <span class="hljs-string"><span class="hljs-string">" because of "</span></span> + e.getMessage()); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/* End of 'DBStatement::setLong' class */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* * * METHOD: String parameter setter * RETURN: True if success, False otherwise * PARAM: [IN] index - parameter position * PARAM: [IN] value - parameter value * AUTHOR: Dmitry Eliseev * */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { m_Statement.setString(index, value); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">final</span></span> SQLException e) { LoggingUtility.debug(<span class="hljs-string"><span class="hljs-string">"Can't set string value: "</span></span> + value + <span class="hljs-string"><span class="hljs-string">" because of "</span></span> + e.getMessage()); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/* End of 'DBStatement::setString' class */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* * * METHOD: Enum parameter setter * RETURN: True if success, False otherwise * PARAM: [IN] index - parameter position * PARAM: [IN] value - parameter value * AUTHOR: Dmitry Eliseev * */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setEnum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Enum value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> setString(index, value.name()); } <span class="hljs-comment"><span class="hljs-comment">/* End of 'DBStatement::setEnum' method */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* * * METHOD: Binary stream parameter setter * RETURN: True if success, False otherwise * PARAM: [IN] index - parameter position * PARAM: [IN] stream - stream * PARAM: [IN] long - data length * AUTHOR: Dmitry Eliseev * */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setBinaryStream</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> InputStream stream, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> length)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { m_Statement.setBinaryStream(index, stream); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">final</span></span> SQLException e) { LoggingUtility.debug(<span class="hljs-string"><span class="hljs-string">"Can't set stream value: "</span></span> + stream + <span class="hljs-string"><span class="hljs-string">" because of "</span></span> + e.getMessage()); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/* End of 'DBStatement::setBinaryStream' method */</span></span> } <span class="hljs-comment"><span class="hljs-comment">/* End of 'DBConnection::DBStatement' class */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* * * METHOD: Class constructor * PARAM: [IN] host - Database service host * PARAM: [IN] port - Database service port * PARAM: [IN] name - Database name * PARAM: [IN] user - Database user's name * PARAM: [IN] pass - Database user's password * AUTHOR: Dmitry Eliseev * */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DBConnection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String host, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> port, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String user, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String pass)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> BoneCPConfig config = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BoneCPConfig(); config.setJdbcUrl(<span class="hljs-string"><span class="hljs-string">"jdbc:mysql://"</span></span> + host + <span class="hljs-string"><span class="hljs-string">":"</span></span> + port + <span class="hljs-string"><span class="hljs-string">"/"</span></span> + name); config.setUsername(user); config.setPassword(pass); <span class="hljs-comment"><span class="hljs-comment">/* Pool size configuration */</span></span> config.setMaxConnectionsPerPartition(<span class="hljs-number"><span class="hljs-number">5</span></span>); config.setMinConnectionsPerPartition(<span class="hljs-number"><span class="hljs-number">5</span></span>); config.setPartitionCount(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { m_Pool = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BoneCP(config); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">final</span></span> SQLException e) { LoggingUtility.error(<span class="hljs-string"><span class="hljs-string">"Can't initialize connections pool: "</span></span> + e.getMessage()); m_Pool = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } } <span class="hljs-comment"><span class="hljs-comment">/* End of 'DBConnection::DBConnection' method */</span></span> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">finalize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Throwable </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.finalize(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m_Pool != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) m_Pool.shutdown(); } <span class="hljs-comment"><span class="hljs-comment">/* End of 'DBConnection::finalize' method */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* * * METHOD: Prepares statement using current connection * RETURN: Prepared statement * PARAM: [IN] query - SQL query * AUTHOR: Dmitry Eliseev * */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> DBStatement </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createStatement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String query)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { LoggingUtility.debug(<span class="hljs-string"><span class="hljs-string">"Total: "</span></span> + m_Pool.getTotalCreatedConnections() + <span class="hljs-string"><span class="hljs-string">"; Free: "</span></span> + m_Pool.getTotalFree() + <span class="hljs-string"><span class="hljs-string">"; Leased: "</span></span> + m_Pool.getTotalLeased()); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Connection connection = m_Pool.getConnection(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DBStatement(connection, connection.prepareStatement(query, Statement.RETURN_GENERATED_KEYS)); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">final</span></span> SQLException e) { LoggingUtility.error(<span class="hljs-string"><span class="hljs-string">"Can't create prepared statement using query: "</span></span> + e.getMessage()); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Exception e) { LoggingUtility.error(<span class="hljs-string"><span class="hljs-string">"Connection wasn't established: "</span></span> + e.getMessage()); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/* End of 'DBConnection::createStatement' method */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* * * METHOD: Closes prepared statement * PARAM: [IN] sql - prepared statement * AUTHOR: Dmitry Eliseev * */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">closeStatement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> DBStatement query)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (query == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (query.m_Statement != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) query.m_Statement.close(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (query.m_Connection != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) query.m_Connection.close(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">final</span></span> SQLException ignored) {} } <span class="hljs-comment"><span class="hljs-comment">/* End of 'DBConnection::closeStatement' method */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* * * METHOD: Executes prepared statement like INSERT query * RETURN: Inserted item identifier if success, 0 otherwise * PARAM: [IN] sql - prepared statement * AUTHOR: Dmitry Eliseev * */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">insert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> DBStatement query)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-comment"><span class="hljs-comment">/* Query execution */</span></span> query.m_Statement.execute(); <span class="hljs-comment"><span class="hljs-comment">/* Obtain last insert ID */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ResultSet resultSet = query.m_Statement.getGeneratedKeys(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (resultSet.next()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> resultSet.getInt(<span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">final</span></span> SQLException e) { LoggingUtility.error(<span class="hljs-string"><span class="hljs-string">"Can't execute insert query: "</span></span> + query.toString()); } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { closeStatement(query); } <span class="hljs-comment"><span class="hljs-comment">/* Insertion failed */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/* End of 'DBConnection::insert' method */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* * * METHOD: Executes prepared statement like UPDATE query * RETURN: True if success, False otherwise * PARAM: [IN] sql - prepared statement * AUTHOR: Dmitry Eliseev * */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> DBStatement query)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { query.m_Statement.execute(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">final</span></span> SQLException e) { LoggingUtility.error(<span class="hljs-string"><span class="hljs-string">"Can't execute update query: "</span></span> + query.m_Statement.toString()); } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { closeStatement(query); } <span class="hljs-comment"><span class="hljs-comment">/* Update failed */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/* End of 'DBConnection::update' method */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* * * METHOD: Executes prepared statement like COUNT != 0 query * RETURN: True if exists, False otherwise * PARAM: [IN] sql - prepared statement * AUTHOR: Dmitry Eliseev * */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">exists</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> DBStatement query)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> AbstractList&lt;Map&lt;String, Object&gt;&gt; results = select(query); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> results != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; results.size() != <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/* End of 'DBConnection::DBConnection' method */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* * * METHOD: Executes prepared statement like SELECT query * RETURN: List of records (maps) if success, null otherwise * PARAM: [IN] sql - prepared statement * AUTHOR: Dmitry Eliseev * */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> AbstractList&lt;Map&lt;String, Object&gt;&gt; select(<span class="hljs-keyword"><span class="hljs-keyword">final</span></span> DBStatement query) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-comment"><span class="hljs-comment">/* Container for result set */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> AbstractList&lt;Map&lt;String, Object&gt;&gt; results = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LinkedList&lt;Map&lt;String, Object&gt;&gt;(); <span class="hljs-comment"><span class="hljs-comment">/* Query execution */</span></span> query.m_Statement.execute(); <span class="hljs-comment"><span class="hljs-comment">/* Determine columns meta data */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ResultSetMetaData metaData = query.m_Statement.getMetaData(); <span class="hljs-comment"><span class="hljs-comment">/* Obtain real data */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ResultSet resultSet = query.m_Statement.getResultSet(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (resultSet.next()) { <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Map&lt;String, Object&gt; row = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;String, Object&gt;(); <span class="hljs-comment"><span class="hljs-comment">/* Copying fetched data */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> columnID = <span class="hljs-number"><span class="hljs-number">1</span></span>; columnID &lt;= metaData.getColumnCount(); columnID++) row.put(metaData.getColumnName(columnID), resultSet.getObject(columnID)); <span class="hljs-comment"><span class="hljs-comment">/* Add row to results */</span></span> results.add(row); } <span class="hljs-comment"><span class="hljs-comment">/* That's it */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> results; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">final</span></span> SQLException e) { LoggingUtility.error(<span class="hljs-string"><span class="hljs-string">"Can't execute select query: "</span></span> + query.toString()); } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { closeStatement(query); } <span class="hljs-comment"><span class="hljs-comment">/* Return empty result */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/* End of 'DBConnection::select' method */</span></span> } <span class="hljs-comment"><span class="hljs-comment">/* End of 'DBConnection' class */</span></span></code> </pre><br></div></div><br><br>  You should also pay attention to the class DBController.java: <br><div class="spoiler">  <b class="spoiler_title">DBController.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.gesoftware.venta.db; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.gesoftware.venta.logging.LoggingUtility; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.*; <span class="hljs-comment"><span class="hljs-comment">/** * DB controller class definition **/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DBController</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* Real DB connection */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> DBConnection m_Connection; <span class="hljs-comment"><span class="hljs-comment">/* * * METHOD: Class constructor * PARAM: [IN] connection - real DB connection * AUTHOR: Dmitry Eliseev * */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DBController</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> DBConnection connection)</span></span></span><span class="hljs-function"> </span></span>{ m_Connection = connection; LoggingUtility.core(getClass().getCanonicalName() + <span class="hljs-string"><span class="hljs-string">" controller initialized"</span></span>); } <span class="hljs-comment"><span class="hljs-comment">/* End of 'DBController::DBController' method */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* * * METHOD: Requests collection of T objects using select statement * RETURN: Collection of objects if success, empty collection otherwise * PARAM: [IN] selectStatement - prepared select statement * AUTHOR: Dmitry Eliseev * */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> Collection&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCollection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> DBConnection.DBStatement selectStatement)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (selectStatement == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LinkedList&lt;T&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> AbstractList&lt;Map&lt;String, Object&gt;&gt; objectsCollection = m_Connection.select(selectStatement); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((objectsCollection == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>)||(objectsCollection.size() == <span class="hljs-number"><span class="hljs-number">0</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LinkedList&lt;T&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Collection&lt;T&gt; parsedObjectsCollection = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;T&gt;(objectsCollection.size()); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Map&lt;String, Object&gt; object : objectsCollection) parsedObjectsCollection.add(parse(object)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parsedObjectsCollection; } <span class="hljs-comment"><span class="hljs-comment">/* End of 'DBController::getCollection' method */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* * * METHOD: Requests one T object using select statement * RETURN: Object if success, null otherwise * PARAM: [IN] selectStatement - prepared select statement * AUTHOR: Dmitry Eliseev * */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getObject</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> DBConnection.DBStatement selectStatement)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (selectStatement == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> AbstractList&lt;Map&lt;String, Object&gt;&gt; objectsCollection = m_Connection.select(selectStatement); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((objectsCollection == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>)||(objectsCollection.size() != <span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parse(objectsCollection.get(<span class="hljs-number"><span class="hljs-number">0</span></span>)); } <span class="hljs-comment"><span class="hljs-comment">/* End of 'DBController::getObject' method */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* * * METHOD: Parses object's map representation to real T object * RETURN: T object if success, null otherwise * PARAM: [IN] objectMap - object map, obtained by selection from DB * AUTHOR: Dmitry Eliseev * */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Map&lt;String, Object&gt; objectMap)</span></span></span></span>; } <span class="hljs-comment"><span class="hljs-comment">/* End of 'DBController' class */</span></span></code> </pre><br></div></div><br><br>  The DBController class is designed to work with objects of a particular table.  In the server application, controllers are created for each of the database tables.  At the controller level, insert, extract, update data in the database methods are implemented. <br><br>  Some operations require changing data in several tables at once.  To this end, the level of managers created.  Each manager has access to all controllers.  At the managerial level, higher level operations are implemented, for example, ‚ÄúPut user X into room A‚Äù.  In addition to moving to a new level of abstraction, managers implement a data caching mechanism.  For example, there is no need to climb into the database whenever someone tries to authenticate or wants to know their rating.  The managers responsible for the users or the rating of the users keep these data.  Thus, the total load on the database is reduced. <br><br>  The next level of abstraction is handlers.  The following class is used as the implementation of the IserverHandler interface: <br><div class="spoiler">  <b class="spoiler_title">StickersHandler.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.gesoftware.stickers.server.handlers; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.gesoftware.stickers.model.common.Definitions; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StickersHandler</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IServerHandler</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Map&lt;Class, StickersQueryHandler&gt; m_Handlers = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SynchronizedMap&lt;Class, StickersQueryHandler&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> StickersManager m_Context; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> JobsManager m_JobsManager; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StickersHandler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> DBConnection connection)</span></span></span><span class="hljs-function"> </span></span>{ m_Context = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StickersManager(connection); m_JobsManager = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JobsManager(Definitions.c_TasksThreadSleepTime); registerQueriesHandlers(); registerJobs(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">registerJobs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ m_JobsManager.addTask(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TaskGameUpdateStatus(m_Context)); m_JobsManager.addTask(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TaskGameUpdatePhase(m_Context)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">registerQueriesHandlers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* Menu handlers */</span></span> m_Handlers.put(QueryAuthorization.class, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QueryAuthorizationHandler(m_Context)); m_Handlers.put(QueryRegistration.class, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QueryRegistrationHandler(m_Context)); m_Handlers.put(QueryRating.class, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QueryRatingHandler(m_Context)); <span class="hljs-comment"><span class="hljs-comment">/* Logout */</span></span> m_Handlers.put(QueryLogout.class, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QueryLogoutHandler(m_Context)); <span class="hljs-comment"><span class="hljs-comment">/* Rooms handlers */</span></span> m_Handlers.put(QueryRoomRefreshList.class, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QueryRoomRefreshListHandler(m_Context)); m_Handlers.put(QueryRoomCreate.class, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QueryRoomCreateHandler(m_Context)); m_Handlers.put(QueryRoomSelect.class, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QueryRoomSelectHandler(m_Context)); m_Handlers.put(QueryRoomLeave.class, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QueryRoomLeaveHandler(m_Context)); <span class="hljs-comment"><span class="hljs-comment">/* Games handler */</span></span> m_Handlers.put(QueryGameLeave.class, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QueryGameLeaveHandler(m_Context)); m_Handlers.put(QueryGameIsStarted.class, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QueryGameIsStartedHandler(m_Context)); m_Handlers.put(QueryGameWhichPhase.class, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QueryGameWhichPhaseHandler(m_Context)); <span class="hljs-comment"><span class="hljs-comment">/* Question handler */</span></span> m_Handlers.put(QueryGameAsk.class, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QueryGameAskHandler(m_Context)); <span class="hljs-comment"><span class="hljs-comment">/* Answer handler */</span></span> m_Handlers.put(QueryGameAnswer.class, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QueryGameAnswerHandler(m_Context)); <span class="hljs-comment"><span class="hljs-comment">/* Voting handler */</span></span> m_Handlers.put(QueryGameVote.class, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QueryGameVoteHandler(m_Context)); <span class="hljs-comment"><span class="hljs-comment">/* Users handler */</span></span> m_Handlers.put(QueryUserHasInvites.class, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QueryUserHasInvitesHandler(m_Context)); m_Handlers.put(QueryUserAvailable.class, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QueryUserAvailableHandler(m_Context)); m_Handlers.put(QueryUserInvite.class, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QueryUserInviteHandler(m_Context)); } <span class="hljs-meta"><span class="hljs-meta">@SuppressWarnings</span></span>(<span class="hljs-string"><span class="hljs-string">"unchecked"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">synchronized</span></span></span><span class="hljs-function"> Serializable </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">userQuery</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String clientID, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Object query)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> StickersQueryHandler handler = getHandler(query.getClass()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (handler == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { LoggingUtility.error(<span class="hljs-string"><span class="hljs-string">"Handler is not registered for "</span></span> + query.getClass()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ResponseCommonMessage(<span class="hljs-string"><span class="hljs-string">"Internal server error: can't process: "</span></span> + query.getClass()); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> handler.processQuery(m_Context.getClientsManager().getClient(clientID), query); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> StickersQueryHandler </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getHandler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Class c)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_Handlers.get(c); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> ServerResponse </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">answer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Serializable object)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ServerResponse(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Message(object)); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onConnect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String clientID, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> InetAddress clientAddress)</span></span></span><span class="hljs-function"> </span></span>{ LoggingUtility.info(<span class="hljs-string"><span class="hljs-string">"User &lt;"</span></span> + clientID + <span class="hljs-string"><span class="hljs-string">"&gt; connected from "</span></span> + clientAddress.getHostAddress()); m_Context.getClientsManager().clientConnected(clientID); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> ServerResponse </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onReceive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String clientID, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Message message)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Object object = message.getObject(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (object == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { LoggingUtility.error(<span class="hljs-string"><span class="hljs-string">"Unknown object accepted"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> answer(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ResponseCommonMessage(<span class="hljs-string"><span class="hljs-string">"Internal server error: empty object"</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ServerResponse(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Message(userQuery(clientID, object))); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDisconnect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String clientID)</span></span></span><span class="hljs-function"> </span></span>{ m_Context.getClientsManager().clientDisconnected(clientID); LoggingUtility.info(<span class="hljs-string"><span class="hljs-string">"User &lt;"</span></span> + clientID + <span class="hljs-string"><span class="hljs-string">"&gt; disconnected"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ m_JobsManager.stop(); } }</code> </pre><br></div></div><br><br>  This class contains the mapping of classes of request objects to corresponding handler objects.  This approach (although it is not the fastest in terms of execution time) allows, in my opinion, to organize code well.  Each handler solves only one specific task associated with the request.  For example, user registration. <br><br><div class="spoiler">  <b class="spoiler_title">User Registration Handler</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.gesoftware.stickers.server.handlers.registration; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.gesoftware.stickers.model.enums.UserStatus; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.gesoftware.stickers.model.objects.User; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.gesoftware.stickers.model.queries.registration.QueryRegistration; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.gesoftware.stickers.model.responses.registration.ResponseRegistrationInvalidEMail; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.gesoftware.stickers.model.responses.registration.ResponseRegistrationFailed; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.gesoftware.stickers.model.responses.registration.ResponseRegistrationSuccessfully; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.gesoftware.stickers.model.responses.registration.ResponseUserAlreadyRegistered; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.gesoftware.stickers.server.handlers.StickersQueryHandler; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.gesoftware.stickers.server.managers.StickersManager; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.gesoftware.venta.logging.LoggingUtility; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.gesoftware.venta.utility.ValidationUtility; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.Serializable; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QueryRegistrationHandler</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StickersQueryHandler</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QueryRegistration</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">QueryRegistrationHandler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> StickersManager context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(context); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> Serializable </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> User user, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QueryRegistration query)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!ValidationUtility.isEMailValid(query.m_EMail)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ResponseRegistrationInvalidEMail(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m_Context.getUsersManager().isUserRegistered(query.m_EMail)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ResponseUserAlreadyRegistered(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!m_Context.getUsersManager().registerUser(query.m_EMail, query.m_PasswordHash, query.m_Name)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ResponseRegistrationFailed(); LoggingUtility.info(<span class="hljs-string"><span class="hljs-string">"User &lt;"</span></span> + user.m_ClientID + <span class="hljs-string"><span class="hljs-string">"&gt; registered as "</span></span> + query.m_EMail); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ResponseRegistrationSuccessfully(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> UserStatus </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getStatus</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UserStatus.NotLogged; } }</code> </pre><br></div></div><br><br>  The code is quite easy to read, isn't it? <br><br><h6>  Client application </h6><br>  The client application implements exactly the same logic with handlers, but only server responses.  It is implemented in a class inherited from the IClientHandler interface. <br><br>  The number of different activities coincides with the number of game states.  The principle of interaction with the server is quite simple: <br><ul><li>  The user performs an action (for example, presses the "Enter the game" button) </li><li>  The client application displays the Progress dialog to the user. </li><li>  Client application sends user credentials to server </li><li>  The server processes the request and sends back the response. </li><li>  The handler corresponding to the response hides the Progress dialog. </li><li>  The response is processed and the results are output to the client. </li></ul><br><br>  Thus, the business logic on both the client and the server is divided into a large number of small structured classes. <br><br>  One more thing I would like to tell about is the in-app purchases.  As noted in several articles here, a fairly convenient solution for monetizing an app is in-app purchases.  I decided to use the advice and added advertising to the application and the ability to disable it for $ 1. <br><br>  When I first began to deal with billing, I killed a huge amount of time to understand the principle of its work in Google.  For a long time I tried to understand how to validate a payment on the server, after all, it seems logical after Google issues some payment information (say, payment number) to transfer it to the game server and check it using the Google API. whether payment.  As it turned out, this scheme works only for subscriptions.  For ordinary purchases, everything is much simpler.  When making purchases in the application, Google returns JSON with information about the purchase and its status (check) and the electronic signature of this check.  So it all comes down to the question "Do you trust Google?".  :) Actually, after receiving such a pair, it is sent to the game server, which will only have to check two things: <br><ul><li>  Have you already sent such a request to the server (this is for operations that are not controlled by Google, for example, the purchase of game currency) </li><li>  Is the check signed correctly with an electronic signature (after all, Google‚Äôs public key is known to everyone, including the server) </li></ul><br><br>  On this note, I would like to finish my first and confused story.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> I have read my article several times, I understand that this is not an ideal technical text, and perhaps it is difficult enough for perception, but in the future (if it comes), I will try to correct the situation. </font></font><br><br><h5>  Links </h5><br><ul><li> <a href="http://developer.android.com/google/play/billing/billing_overview.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In-app Billing Overview</font></font></a> </li><li> <a href="http://habrahabr.ru/post/117944/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In-App purchasing or internal payments in Android applications</font></font></a> </li><li> <a href="http://habrahabr.ru/post/123642/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In-app purchase in Android applications</font></font></a> </li></ul><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Third Party Libraries </font></font></h5><br><ul><li> <a href="https://github.com/robotmedia/AndroidBillingLibrary"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android Billing Library</font></font></a> </li><li> <a href="http://jolbox.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bone CP</font></font></a> </li><li> <a href="http://www.oracle.com/technetwork/java/javase/jdbc/index.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jdbc</font></font></a> </li></ul><br><br><h5>  Conclusion </h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If someone had the patience to finish reading to the end, I express my gratitude, since I do not pretend to be a professional </font></font><a href="http://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2581%25D0%25BB_%2528%25D1%2582%25D0%25B5%25D0%25BB%25D0%25B5%25D1%2581%25D0%25B5%25D1%2580%25D0%25B8%25D0%25B0%25D0%25BB%2529"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">writer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Please scold me a lot, as this is my first publishing experience here. </font><font style="vertical-align: inherit;">One of the reasons for publishing is the alleged ‚Äúhabraeffect‚Äù, which I need to conduct load testing of the server, as well as a set of game audience, so I apologize for the mercenary component of the purpose of the publication. </font><font style="vertical-align: inherit;">I would appreciate an indication of errors / inaccuracies.</font></font> Thanks for attention! <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In conclusion, a small survey (I can‚Äôt add it at the moment): should it be published later? </font><font style="vertical-align: inherit;">If so, what topic would be interesting for publications:</font></font><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mathematics: linear algebra </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Math: Analysis </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mathematics: Numerical and Optimization Methods </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mathematics: discrete mathematics and theory of algorithms </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mathematics: Computational Geometry </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Programming: computer graphics basics ( </font></font><a href="https://github.com/Trimax/ventaengine"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">by the example of this project</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Programming: Shader Programming </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Programming: game development </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Physics: Theory of Relativity </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Physics: Astrophysics </font></font></li></ul><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> What do you mean where? </font></font><br><ul><li>  <a href="https://play.google.com/store/apps/details%3Fid%3Dcom.gesoftware.stickers">Stickers</a> </li><li> <a href="https://github.com/Trimax/venta"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Venta</font></font></a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/198054/">https://habr.com/ru/post/198054/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../198034/index.html">Is Comet ISON Dangerous?</a></li>
<li><a href="../198036/index.html">Anki DRIVE - back to childhood</a></li>
<li><a href="../198038/index.html">The new Nexus appeared in its own Google Play store for as low as $ 349.</a></li>
<li><a href="../198044/index.html">Dark patterns: interfaces designed to cheat</a></li>
<li><a href="../198052/index.html">Programming language J. Amateur look. Part 1. Introduction</a></li>
<li><a href="../198056/index.html">The isoHunt BitTorrent tracker closes after being defeated against MPAA</a></li>
<li><a href="../198060/index.html">VirtualDub Check</a></li>
<li><a href="../198062/index.html">Listen to music from Google Play Music</a></li>
<li><a href="../198066/index.html">Programming language J. Amateur look. Part 2. Tacit Programming</a></li>
<li><a href="../198068/index.html">Method for generating test tasks based on AND / OR trees and its software implementation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>