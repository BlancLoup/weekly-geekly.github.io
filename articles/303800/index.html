<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The implementation of interactive diagrams using OOP on the example of the prototype editor of UML diagrams. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is the end of a previous publication , in which I told you how to create an interface with interactive graphics from scratch in an object-oriente...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The implementation of interactive diagrams using OOP on the example of the prototype editor of UML diagrams. Part 2</h1><div class="post__text post__text-html js-mediator-article">  This is the end of a <a href="https://habrahabr.ru/post/303794/">previous publication</a> , in which I told you how to create an interface with interactive graphics from scratch in an object-oriented development environment.  In the first part, we looked at the key architectural ideas of this system: the use of composition, delegation, and template methods. <br><br>  Now I turn to more routine questions and consider building a class responsible for handling mouse events and scaling, panning, selecting objects and drag &amp; drop. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Class DiagramPanel </h2><br><h3>  Visual components </h3><br>  The source code of the DiagramPanel class, in contrast to the DiagramObject, does not contain any non-trivial structural solutions, it only performs routine tasks.  However, its code is about 30% longer than the DiagramObject code.  It contains all the specifics associated with the development environment: if you want to rewrite the framework from Java to another environment (as we did at one time, transferring it from Delphi to Java), the main difficulties will be associated with DiagramObject. <br><br>  When working with Swing, the DiagramPanel class is inherited from the javax.swing.JPanel class and is a visual component of the interface that can be placed on the application form.  Our demo application consists of only this one panel.  Structurally, DiagramPanel consists of: <br><br><ul><li>  horizontal and vertical scroll bars javax.swing.JScrollBar (hsb and vsb variables), </li><li>  top panel with on-screen buttons </li><li>  the ‚Äúdrawing‚Äù area that fills the entire central space, occupied by the DiagramPanel.DiagramCanvas object, the heir to java.awt.Canvas.  The java.awt.Canvas class involves creating a descendant with an overridden paint (Graphics g) method that gets the drawing context (Graphics) as an argument, which we do in the DiagramCanvas class nested in DiagramPanel.  The paint (Graphics g) method is automatically called, in particular, when the window is resized and the window overlap changes, so the diagram does not ‚Äúspoil‚Äù from these actions. </li></ul><br><br><h3>  Diagram drawing from the point of view of DiagramPanel </h3><br><br>  Let's take a closer look at the code of the paint (Graphics g) method of the DiagramPanel.DiagramCanvas class.  If you omit some details, it looks like this: <div class="spoiler">  <b class="spoiler_title">source code</b> <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> SCROLL_FACTOR = <span class="hljs-number"><span class="hljs-number">10.0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">paint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Graphics g)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// not ready for painting yet if (rootDiagramObject == null || g == null) return; double worldHeight = rootDiagramObject.getMaxY() - rootDiagramObject.getMinY(); double worldWidth = rootDiagramObject.getMaxX() - rootDiagramObject.getMinX(); int hPageSize = round(canvas.getWidth() / scale); ... int vPageSize = round(canvas.getHeight() / scale); ... hsb.setMaximum(round(worldWidth * SCROLL_FACTOR)); vsb.setMaximum(round(worldHeight * SCROLL_FACTOR)); g.clearRect(0, 0, getWidth(), getHeight()); double dX = hsb.getValue() / SCROLL_FACTOR; double dY = vsb.getValue() / SCROLL_FACTOR; rootDiagramObject.draw(g, dX, dY, scale); }</span></span></code> </pre> <br><br>  (The code of the method is simplified for better readability. A real implementation that correctly takes into account all extreme cases can be seen in the full source code of the sample article.) <br><br></div></div><br><br>  The method does the following: <br><br><ul><li>  Using the getMaxX / Y methods of the root drawing object, it obtains the width and height of the chart <b>in world coordinates</b> . </li><li>  Gets the size of the visible area (width and height) in world coordinates.  For this, the screen width and height of the component are divided by the scaling factor (to get the screen coordinate from the world, we multiply by the scaling factor). </li><li>  The maximum values ‚Äã‚Äãand widths of the scrollbar sliders are set equal to the corresponding values ‚Äã‚Äãin world coordinates multiplied by the SCROLL_FACTOR coefficient. </li></ul><br><br>  For the convenience of the user, it is very important that the widths of the scrollbar sliders change correctly when the image is scaled (and the size of the visible area).  In this animation, pay attention to the changing size of the scrollbar sliders and their disappearance at the moment when the picture begins to fit entirely: <br><br><img src="https://habrastorage.org/files/752/c12/f2f/752c12f2fa5e47faa003abab65fe69b9.gif"><br><br>  Multiplication by SCROLL_FACTOR is necessary because the values ‚Äã‚Äãtaken by the scroll bar are integer, and the world coordinates, as we remember, are of type double.  Accordingly, with a large scale of increase, the ‚Äúdiscreteness‚Äù of moving the scroll bars may become too noticeable and with the help of the SCROLL_FACTOR multiplier, we essentially substitute their integer value with a fixed point value. <br><br>  Since the chart redrawing method correctly takes into account the current scale and position of the scroll bars, <br><ol><li>  processing the change of scrollbar values ‚Äã‚Äãis reduced only to calling canvas.paint (canvas.getGraphics ()) (see DiagramPanel class scrollBarChange () method) </li><li>  Mouse wheel event handling (without pressing the Ctrl key) is reduced to <ol><li>  determining which of the scroll bars the mouse pointer is closer to, </li><li>  modification of the position of the corresponding scroll bar, </li><li>  call canvas.paint (canvas.getGraphics ()) (see the DiagramPanel class's canvasMouseWheel (MouseWheelEvent) method). </li></ol></li></ol><br><br><h3>  Scale the chart while maintaining the specified fixed point </h3><br>  The user can change the scale of the diagram in our example in two ways: by pressing the ‚ÄúZoom in‚Äù and ‚ÄúZoom out‚Äù buttons on the screen and using the Ctrl + mouse wheel combination.  In any case, this leads to a call to the setScale method (double s) of the DiagramPanel class.  But in order for it to look comfortable for the user, some tricks are needed. <br><br>  First we will pay attention to what values ‚Äã‚Äãthe scale should take.  Our long-standing experience shows that the most user-friendly chart behavior is doubling the scale with two presses of the ‚ÄúZoom in‚Äù button.  This means that pressing the ‚ÄúZoom in‚Äù / ‚ÄùZoom out‚Äù buttons should multiply / divide the current scale value by the square root of two (1.41). <br><br>  If the user is offered scale values ‚Äã‚Äãfrom the list, for visual uniformity of zooming in / out, they should be selected from a number of degrees of the square root of two: 50%, 70%, 100%, 140%, 200%. <br><br>  At first glance, the ‚ÄúCtrl + mouse wheel‚Äù event handler code might appear unexpected: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> WHEEL_FACTOR = <span class="hljs-number"><span class="hljs-number">2.8854</span></span>; <span class="hljs-comment"><span class="hljs-comment">// 1/ln(sqrt(2)) setScale(scale * Math.exp(-e.getPreciseWheelRotation() / WHEEL_FACTOR));</span></span></code> </pre><br>  It would seem, why is there an exhibitor?  The mouse wheel handler receives the number of wheel clicks made by the user (in some cases even the fractional parts of a click are issued), and the general rule is the same: for two clicks, the picture should be doubled.  But this just means that the scale values ‚Äã‚Äãshould depend on the angle of rotation of the wheel as the degree of the square root of two: <br><br><table><tbody><tr><td>  wheel turn </td><td>  -2 </td><td>  -one </td><td>  0 </td><td>  one </td><td>  2 </td></tr><tr><td>  zoom </td><td>  0.5 </td><td>  0.7 </td><td>  1.0 </td><td>  1.4 </td><td>  2.0 </td></tr></tbody></table><br><br>  Simple arithmetic reduces these calculations to exponential. <br><br>  We now turn to the DiagramPanel class's setScale (double s) method: <br><div class="spoiler">  <b class="spoiler_title">source code</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (s &lt; <span class="hljs-number"><span class="hljs-number">0.05</span></span> || s &gt; <span class="hljs-number"><span class="hljs-number">100</span></span> || s == scale) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; Point p = MouseInfo.getPointerInfo().getLocation(); SwingUtilities.convertPointFromScreen(p, canvas); <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> xQuot; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> yQuot; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (px &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; py &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; px &lt; canvas.getWidth() &amp;&amp; py &lt; canvas.getHeight()) { xQuot = p.getX() / (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>) canvas.getWidth(); yQuot = p.getY() / (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>) canvas.getHeight(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { xQuot = <span class="hljs-number"><span class="hljs-number">0.5</span></span>; yQuot = <span class="hljs-number"><span class="hljs-number">0.5</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> newHVal = hsb.getValue() + round(hsb.getVisibleAmount() * xQuot * (<span class="hljs-number"><span class="hljs-number">1</span></span> - scale / s)); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> newVVal = vsb.getValue() + round(vsb.getVisibleAmount() * yQuot * (<span class="hljs-number"><span class="hljs-number">1</span></span> - scale / s)); hsb.setValue(newHVal); vsb.setValue(newVVal); scale = s; canvas.paint(canvas.getGraphics());</code> </pre><br></div></div><br>  We see that the method, having previously checked the value of the new scale for rationality, <br><br><ul><li>  gets the position of the mouse cursor </li><li>  if the mouse cursor is over the Canvas object, then it calculates its relative position; otherwise, the relative position is considered the middle of the Canvas, </li><li>  prepares new scrollbar positions, </li><li>  and only then (!) changes the scale and redraws the chart. </li></ul><br><br>  Why these difficulties?  All this is done to ensure that during scaling the user visually remains fixed that point on the diagram on which his current view is focused.  If you do not do this, then the user will have to ‚Äútwist‚Äù the scroll bars after each change of scale.  If the user changes the scale using the on-screen buttons, the center of the visible area of ‚Äã‚Äãthe diagram remains fixed, but if the user does this using the mouse wheel, the point above which the cursor is located will be fixed.  It looks like this: <br><br><img src="https://habrastorage.org/files/5a2/064/f98/5a2064f98434468e9d5b2b7b05849b36.gif"><br><br><h3>  Pan mode </h3><br>  Our example can work in two modes: panning (panning mode) and selecting objects that are switched by on-screen buttons.  In the pan mode, moving the mouse while holding down the left button moves the entire visible area of ‚Äã‚Äãthe diagram.  The most widely known example of panning mode is, of course, the corresponding mode of viewing PDF files in Adobe Acrobat Reader. <br><br>  Moving the mouse with the left button pressed is processed in the canvasMouseDragged method, and in panning mode it is enough for us to adjust the position of the scroll bars relative to the initial position of the mouse cursor: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (panningMode) { hsb.setValue(round((startPoint.x - cursorPos.x / scale) * SCROLL_FACTOR)); vsb.setValue(round((startPoint.y - cursorPos.y / scale) * SCROLL_FACTOR)); }</code> </pre><br><br>  Already implemented machinery will redraw the image correctly: <br><br><img src="https://habrastorage.org/files/c45/503/b66/c45503b66bcf453aa077facbe5a4402e.gif"><br><br><h3>  Object selection mode </h3><br>  The logic associated with the object selection mechanism is somewhat separate, so for convenience, it is highlighted in the DiagramPanel class nested SelectionManager class.  In its ArrayList items field, this class stores all currently selected objects.  He is responsible for ‚Äúclicking‚Äù objects with the Shift key, selecting them with a ‚Äúlasso‚Äù, and dragging.  All this is quite complicated for both the description and the implementation of the functionality.  However, unexpectedly quickly understand it and help realize the concept of a <b>finite state machine</b> .  (Although the finite state machine is not included in the list of GoF design patterns and is applicable only for a limited class of tasks, its convenience and power to simplify some tasks make me treat it as another very useful and standardized design pattern.) <br><br>  From the point of view of the mechanism for selecting objects, any movement of the mouse cursor over a diagram can occur in one of three states of the automaton corresponding to the elements of the DiagramPanel.State enumeration: <br><ol><li>  Left mouse button is not pressed - the initial state (SELECTING).  Selection of several objects with the Shift key pressed. </li><li>  The left mouse button is pressed - two subcases: <br><ol><li>  moves group of selected objects (DRAGGING). </li><li>  a rectangular lasso (LASSO) is drawn. </li></ol><br></li></ol><br><br>  When implementing the SelectionManager class, I sketched on paper some such state and transition scheme: <br><br><img width="600" src="https://habrastorage.org/files/d8d/673/103/d8d6731037d5461b868048ebe887804c.png"><br><br>  You can embody this scheme in the code just as we implement any state machine. <br><br>  To draw a rectangular lasso, another heir of DiagramObject is used - the class DiagramPanel.Lasso.  Unlike other renderers, it does not belong to the diagram and is not drawn with it, but is created by the DiagramPanel class at the moment when it is necessary to draw the selection rectangle.  It must ‚Äúcatch up‚Äù with the mouse cursor and, therefore, is displayed in the internalDrawSelection method using the XOR mode of the graphics context. <br><br><img src="https://habrastorage.org/files/7e9/6bc/85c/7e96bc85c64f432483a8d6f4e03b127b.gif"><br><br>  It should be remembered that the rectangle is drawn from its upper left corner, and the starting point of the ‚Äúlasso‚Äù can be in any corner (see animation), therefore, to draw this rectangle, you need to be careful, you must first define the HL: <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x0 = dX &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ? startPoint.x : startPoint.x + dX; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y0 = dY &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ? startPoint.y : startPoint.y + dY; g2.drawRect(x0, y0, Math.abs(dX), Math.abs(dY));</code> </pre><br><br><h3>  Group offset of objects.  Interaction with Undo </h3><br><br>  Having finished moving the group of objects, the user releases the left mouse button.  What happens in the system?  In theory, it is enough to run through the objects that fall into the selection, and "tell" them that the user has moved them.  However, not everything is so trivial: <br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (commandManager != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) commandManager.beginMacro(<span class="hljs-string"><span class="hljs-string">"drag &amp; drop"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (DiagramObject i : items) { DiagramObject curItem = i.getParent(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (curItem != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; !items.contains(curItem)) { curItem = curItem.getParent(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (curItem == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) i.drop(dX, dY); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (commandManager != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) commandManager.endMacro();</code> </pre><br>  As we remember, the objects we have are "independent" and "semi-independent."  If a parent object and a semi-independent object dependent on it (for example, Actor and a signature to it) hit the selection, then only the parent object needs to be moved: the dependent object "will follow it". <br><br>  That is why in the cycle we exclude dependent objects if they fall into the selection along with the parent objects, and only for suitable objects we call the drop method (dX, dY), passing the object displacement in screen coordinates to the object itself.  DiagramObject recalculates the ‚Äúscreen‚Äù offsets into the ‚Äúworld‚Äù ones and calls its internalDrop virtual method, whose implementation at the level of the DiagramObject heirs should work out the mouse dragging event, changing the internal state of the data model objects. <br><br>  And why do we need commandManager.beginMacro / endMacro calls? <br><br>  If the system implements undo / redo functionality, then group dragging of objects must be designated as a macro command.  If this is not done and the user wishes to cancel his drag and drop operation, he will have to click on the undo () button as many times as he has moved objects at a time.  You can read more about all this in my article about the <a href="https://habrahabr.ru/post/277245/">implementation of undo and redo</a> . <br><br><h2>  Conclusion </h2><br>  So, our example is ready.  With a relatively small amount of code, we got a completely working solution, with all the amenities for the user who wants to view and edit an interactive diagram, and with a full foundation for embedding in this application that solves real problems. <br><br>  It is a pity that the times of craze for CASE-tools have long passed: with such skills we could create a dangerous alternative for some Rational Rose :-) <br><br>  Download the full source code of the example in question in the format of the Maven project at <a href="https://github.com/inponomarev/graphexample">https://github.com/inponomarev/graphexample</a> . <br><br>  With the help of this framework, in different years we built: portfolio matrices, Gantt charts, diagrams of relations between legal entities, azimuth-frequency diagrams for radio equipment, diagrams of relations between installations. <br><br>  Please note that for use in other projects, this code is available only under the GPL license. <br><br>  The author is grateful to the creators of the <a href="https://getsharex.com/">ShareX</a> system, with the help of which the animated GIF illustrations for the article were created. </div><p>Source: <a href="https://habr.com/ru/post/303800/">https://habr.com/ru/post/303800/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../303788/index.html">Hardcore startups. Part 1: How to make your dream come true</a></li>
<li><a href="../303790/index.html">IoT: from smart bulbs to advanced production technologies</a></li>
<li><a href="../303794/index.html">The implementation of interactive diagrams using OOP on the example of the prototype editor of UML diagrams. Part 1</a></li>
<li><a href="../303796/index.html">Dell Storage SC9000: Intelligent Storage for Efficient Data Center</a></li>
<li><a href="../303798/index.html">Core Data + Swift for the smallest: minimum necessary (part 2)</a></li>
<li><a href="../303802/index.html">Big Data Brain</a></li>
<li><a href="../303804/index.html">The ‚ÄúMake with Ada‚Äù competition for developers of embedded systems has begun.</a></li>
<li><a href="../303806/index.html">Harvard CS50 Programming Course Now in Russian</a></li>
<li><a href="../303814/index.html">Launch Xamarin.Forms on Windows 7</a></li>
<li><a href="../303816/index.html">NavMesh on crutches - little tricks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>