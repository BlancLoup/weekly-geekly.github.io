<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MySQL Query Cache</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="MySQL has a very useful functionality - query cache . Query cache is available in MySQL since version 4.0. 
 Many DBMSs have similar functionality, bu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MySQL Query Cache</h1><div class="post__text post__text-html js-mediator-article">  MySQL has a very useful functionality - <a href="http://dev.mysql.com/doc/refman/5.0/en/query-cache.html">query cache</a> .  Query cache is available in MySQL since version 4.0. <br>  Many DBMSs have similar functionality, but unlike MySQL, they cache query execution plans, whereas MySQL caches query results. <br>  Further on how the query cache works, how to configure it and make optimal use of it. <br><a name="habracut"></a><br>  <b>How does the query cache.</b> <br>  The query cache can be thought of as a hash, the keys of which are queries, and the values ‚Äã‚Äãare the results of queries. <br>  If query cache usage is enabled, then, upon receiving a query, MySQL determines whether the first three characters of the query are "SEL".  If yes, then MySQL looks to see if there is an entry in the query cache with a key equal to the query.  From here follow two important rules: <br><ul><li>  MySQL performs byte-by-byte comparison, so queries that differ in at least one character (for example, SELECT * FROM table and select * from table) will be treated as two different queries.  Therefore, it is necessary to write queries in the same style; </li><li>  In MySQL to version 5.0, queries that have a space at the beginning or a comment is written will never be taken from the cache. </li></ul>  In addition to the results, MySQL stores in cache the list of tables, a selection of which is cached.  If any of the tables, the sample of which is in the cache, undergo changes (insert or change rows), then MySQL removes such samples from the cache.  This approach speeds up the work of MySQL, but may be ineffective for systems with a large number of requests for changing tables. <br><br>  Optimization for such tables - to carry out frequently changing data in a separate table.  For example, there is a table of articles, which also stores the number of comments to it.  Since the number of comments changes frequently, and the article itself hardly changes, it makes sense to put the number of comments in a separate table, while avoiding the frequent invalidation of the articles cache. <br><br>  Using the query cache is completely transparent to the client.  The client does not know whether he executed the MySQL request, or returned it from the cache. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      MySQL caches the results of SELECT queries only.  MySQL does not cache queries whose results may change.  For example, queries that use functions related to the current time (NOW (), CURDATE (), etc.), to the current connection (CURRENT_USER (), CONNECTION_ID (), etc.) and others.  A complete list of such features can be found in the manual.  In addition, MySQL does not cache queries that include the use of user-defined functions, stored procedures, samples from the mysql or INFORMATION_SCHEMA database, samples from tables for which privileges are defined for columns. <br><br>  Optimization for queries using the current time functions (NOW (), CURDATE (), etc.) - replacing such functions with a string with a date.  For example: request <br>  SELECT * FROM table WHERE create_date&gt; NOW () - INTERVAL 1 DAY <br>  which will not be cached can be replaced with a request that is cached: <br>  SELECT * FROM table WHERE create_date&gt; '2009-10-14' - INTERVAL 1 DAY <br><br>  Caching samples from InnoDB tables is handled separately.  MySQL deletes the results of the samples from the cache when any changes are made to the table inside the transaction (although it could not be deleted until the transaction is committed).  In addition, all samples from this table will not be cached until the transaction is committed. <br><br>  <b>Using the query cache.</b> <br>  You can view statistics on the use of the query cache by running the command: <br>  SHOW GLOBAL STATUS LIKE 'Qcache%' <br><ul><li>  Qcache_free_blocks shows how many free blocks are in the cache; </li><li>  Qcache_total_blocks - the number of occupied blocks; </li><li>  Qcache_free_memory tells you how much free memory is left in the cache; </li><li>  Qcache_hits - the number of queries whose results were taken from the cache; </li><li>  Qcache_inserts - the number of requests that were added to the cache; </li><li>  Qcache_lowmem_prunes - the number of requests that were deleted from the cache due to lack of memory; </li><li>  Qcache_not_cached - the number of requests that were not written to the cache due to the use of time management functions, etc .; </li><li>  Qcache_queries_in_cache - the number of requests that are in the cache. </li></ul>  The following configuration variables are responsible for using the query cache: <br><ul><li>  query_cache_type = (ON, DEMAND, OFF) - determines whether caching is enabled or not (ON, OFF).  When using DEMAND, only queries that have the SQL_CACHE directive will be cached; </li><li>  query_cache_size - size of the query cache.  query_cache_size = 0 disables the use of the cache; </li><li>  query_cache_limit - the size of the maximum sample stored in the cache; </li><li>  query_cache_min_res_unit - the minimum size of the block stored in the cache; </li><li>  query_cache_wlock_invalidate - determines whether data will be taken from the cache if the table to which they belong is locked for reading. </li></ul>  When you start MySQL, it allocates a block of query_cache_size size in memory.  When the query is executed, as soon as the first result lines are received, the server starts to cache them: it allocates a block of memory equal to query_cache_min_res_unit in the cache, writes the result of the selection to it.  If not all of the sample fit into the block, the server allocates the next block, and so on.  After the entire result is written to the cache, MySQL allocates the free part of the last block into a separate block and marks it as free.  If there is a free block around such a block, MySQL merges them into one. <br><br>  At the time of the start of the recording, MySQL does not know about the size of the resulting sample.  If the sample size recorded in the cache is larger than query_cache_limit, then the recording stops and the space occupied is freed (therefore, if you know in advance that the result will be large, it is recommended to execute it with SQL_NO_CACHE directive).  If MySQL caches several queries in parallel, the blocks allocated to different queries can alternate.  In addition, after the request is removed from the cache, the free space may not be sufficient to record new requests.  This leads to cache fragmentation.  To defragment the cache, you can run the FLUSH QUERY CACHE command.  (FLUSH QUERY CACHE transfers all requests stored in the cache to its beginning and marks the remaining memory as one free block).  In addition, cache fragmentation can be reduced by correctly selecting the query_cache_min_res_unit parameter. If the query_cache_min_res_unit value is small, then the fragmentation will decrease, however, MySQL will have to create more blocks in the cache.  If the value is large, then fragmentation will be large. <br><br>  The value of query_cache_min_res_unit should be equal to the average size of the cache value.  Its approximate value can be calculated by the formula query_cache_min_res_unit = (query_cache_size - Qcache_free_memory) / Qcache_queries_in_cache.  However, for sites whose sample size varies greatly, it is recommended to use query_cache_type = DEMAND and an explicit indication that the query should be cached using SQL_CACHE directive.  In addition, it is necessary to restrict writing to the cache of large samples by specifying the variable query_cache_limit or the SQL_NO_CACHE directive. <br><br>  Determine how fragmented the cache is by the value of the variable Qcache_free_blocks.  For an ideal unfragmented cache, the value is equal to one, at worst - Qcache_total_blocks / 2. You can also determine that your query cache is highly fragmented if the value of Qcache_lowmem_prunes is constantly increasing, while the value of Qcache_free_memory is far from zero. <br><br>  You can evaluate the efficiency of using the cache using the formula Qcache_hits / (Qcache_hits + Com_select).  What value is sufficient for your site is up to you.  If the queries stored in the cache take a long time, then efficiency even at 10% may be useful.  However, if the efficiency of use is low and it cannot be increased, it is possible that the nature of the load on your system is such that the query cache is not at all effective for you.  In such cases, it is more useful to disable caching requests altogether and use client-side caching. <br><br>  Read the <a href="http://mysqlconsulting.ru/articles/2/mysql-query-cache/">original article</a> at MySQL Consulting. <br><br>  PS write in lichku topics on MySQL articles that you would like to read. <br><br></div><p>Source: <a href="https://habr.com/ru/post/41166/">https://habr.com/ru/post/41166/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../41159/index.html">Web technologies. What to include in the study of HTML?</a></li>
<li><a href="../41161/index.html">Tales of America - Work in America for students</a></li>
<li><a href="../41162/index.html">Ideas for google</a></li>
<li><a href="../41164/index.html">ChromePass - extracting passwords from Google Chrome</a></li>
<li><a href="../41165/index.html">django-inline</a></li>
<li><a href="../41167/index.html">View closed posts on the IPB forum</a></li>
<li><a href="../41169/index.html">Personalized selection of content</a></li>
<li><a href="../41170/index.html">Map of Wi-Fi points in cities of Russia</a></li>
<li><a href="../41171/index.html">On goals and objectives, part one</a></li>
<li><a href="../41175/index.html">There is justice in the world</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>