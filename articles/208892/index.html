<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Configuring file server auditing: detailed instructions and cheat sheet (.pdf)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 

 We continue to publish cheat sheets for setting up auditing of various systems, last time we talked about AD habrahabr.ru/company/netwrix/bl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">🔎</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">📜</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">⬆️</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">⬇️</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Configuring file server auditing: detailed instructions and cheat sheet (.pdf)</h1><div class="post__text post__text-html js-mediator-article">  Hello! <br><br>  We continue to publish cheat sheets for setting up auditing of various systems, last time we talked about AD <a href="http://habrahabr.ru/company/netwrix/blog/140569/">habrahabr.ru/company/netwrix/blog/140569</a> , today we will discuss file servers.  I must say that most often we perform exactly the settings of the audit of file servers - in the course of pilot installations with customers.  There is nothing difficult in this task, just three simple steps: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6fb/794/6f1/6fb7946f1e58ee1313a2e09770bea6ae.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  Set up file shares auditing </li><li>  Configure and apply general and detailed audit policies </li><li>  Change event log settings </li></ul><br>  If you have a large number of file balls, access to which is often required by employees - we recommend that you only monitor changes to audit objects.  Keeping track of all events can result in a large amount of redundant data that is not of special importance. <br><br><a name="habracut"></a><br><br><h5>  Setting up auditing on file resources </h5><br><br><ol><li>  Open the properties of the balls, select the tab "Security" and click "Advanced" </li><li>  On the “Auditing” tab, select the “Everyone” user group and click the “Edit” button. </li><li>  Enable the following check boxes in the “Successfull” and “Failed” columns: <br><br>  List Folder / Read Data; <br>  Create Files / Write Data; <br>  Create Folders / Append Data; <br>  Write Attributes; <br>  Write Extended Attributes; <br>  Delete Subfolders and File; <br>  Delete; <br>  Change Permissions; <br>  Take Ownership. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4cd/b0e/335/4cdb0e3351ccee926fdf9c09ff9cd3fd.png"></li><li>  Make sure that “This folder, subfolders and files” is selected in the “Apply onto” list, and the “Apply these auditing entries” check box is not selected. </li><li>  Click "OK", on this setting one file balls completed. </li></ol><br><br><h5>  Setting up a general audit policy </h5><br><br>  In order to monitor changes on the file server, you need to configure an audit policy.  Before setting the policy, make sure that your account is in the Administrators group or you have rights to manage auditing and event logs in the Group Policies snap-in. <br><br><ol><li>  Open the Group Policy snap-in using the gpedit.msc command or via the menu <br>  Start&gt; Programs&gt; Administrative Tools&gt; Group Policy Management. </li><li>  Expand the Domains node, right-click on the name of your domain and select the menu item “Create a GPO in this domain and Link it here”. </li><li>  Enter the name of the new policy in the Name field and click OK. </li><li>  Right-click on the new policy, select the item “Edit” in the menu, the group policy editor will open. </li><li>  Expand the Computer Configuration node, then expand Policies&gt; Windows Settings&gt; Security Settings&gt; Local Policies&gt; Audit Policy. </li><li>  In the right part of the window, double-click the “Audit object access” category. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7b0/4a8/9f3/7b04a89f3201fa2eea6565fe65ab259e.png"></li><li>  Enable all checkboxes as shown in the screenshot, click OK. </li></ol><br><br>  or <br><br><h5>  Setting a detailed audit policy </h5><br><br><ol><li>  On the monitored file server, open the Local Security Policies snap-in using the secpol.msc command </li><li>  Expand Security Settings&gt; Local Policies&gt; Security Options and find the category Audit: Force audit policy subcategory settings (Windows Vista or later) policy in the right-hand part of the window <br><br><img src="https://habrastorage.org/getpro/habr/post_images/57f/dcd/10a/57fdcd10a77232b4e064e993efee4392.png"></li><li>  Double-click this category and set it to Enabled, click OK. </li><li>  Now open the “Security Settings”&gt; “Advanced Audit Policy Configuration”&gt; “System Audit Policies”&gt; “Object Access” node and configure the “Audit File System” and “Audit Handle Manipulation” categories for each of them to select the events you need (Success or Failure). <br><img src="https://habrastorage.org/getpro/habr/post_images/e8e/8df/a15/e8e8dfa1555144ff4e60ac4d98a25584.png"></li><li>  Now it remains to apply the policy using the command line by typing gpupdate / force </li><li>  You can check whether the policy was applied using the auditpol / get / category command: “ObjectAccess” </li></ol><br><br><h5>  Configuring Event Logs </h5><br><br>  In order to effectively control the changes, it is necessary to configure the event logs, namely, to set the maximum log size.  If the size is insufficient, then the events can be overwritten before they get into the database that your change control application uses. <br><br><ol><li>  Open Event Viewer: “Start”&gt; “Programs”&gt; “Administrative Tools”&gt; “Event Viewer” </li><li>  Expand the Windows Logs node </li><li>  Right-click on the “Security” log, select the “Properties” menu item. </li><li>  Make sure the checkbox “Enable logging” is on. </li><li>  Set the values ​​in the field Maximum log size: for Windows 2003 - 300MB, for Windows 2008 - 1GB. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/104/537/970/104537970251469a05aa68d6f93e2c9d.png"></li><li>  Set the log clearing method.  You can use the methods of "Overwrite events as needed" or "Archive the log when full" </li></ol><br><br>  Finally, we would like to offer you a script that we ourselves use when setting up auditing on file servers.  <b>The script performs the audit setup on all the balls of each of the computers in a given OU</b> .  Thus, it is not required to include settings on each file resource manually. <br><br>  Before running the script, you need to edit line 19 - enter the required values ​​instead of “your_ou_name” and “your_domain”.  The script must be run on behalf of an account that has domain administrator rights. <br><br>  You can get the script in our <a href="http://www.netwrix.com/kb/1809">knowledge base</a> or save the following text to the .ps1 file: <br><br><pre><code class="actionscript hljs">#<span class="hljs-meta"><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">import</span></span></span><span class="hljs-meta">-module activedirectory #$path = $args[0];</span></span> # \\fileserver\share\folder $account = <span class="hljs-string"><span class="hljs-string">"Everyone"</span></span> # $args[<span class="hljs-number"><span class="hljs-number">1</span></span>]; $flavor = <span class="hljs-string"><span class="hljs-string">"Success,Failure"</span></span> #$args[<span class="hljs-number"><span class="hljs-number">2</span></span>]; $flags = <span class="hljs-string"><span class="hljs-string">" ReadData, WriteData, AppendData, WriteExtendedAttributes, DeleteSubdirectoriesAndFiles, WriteAttributes, Delete, ChangePermissions, TakeOwnership "</span></span> $inheritance = <span class="hljs-string"><span class="hljs-string">"ContainerInherit, ObjectInherit"</span></span> $propagation = <span class="hljs-string"><span class="hljs-string">"None"</span></span> $comps = Get-ADComputer -Filter * -SearchBase <span class="hljs-string"><span class="hljs-string">"OU=your_ou_name,DC=your_domain,DC=your_domain"</span></span> | select -exp DNSHostName foreach ($comp <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $comps) { $shares = <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>-wmiobject -<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">win32_share</span></span></span><span class="hljs-class"> -</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">computername</span></span></span><span class="hljs-class"> $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">comp</span></span></span><span class="hljs-class"> -</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">filter</span></span></span><span class="hljs-class"> "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">=0 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AND</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">like</span></span></span><span class="hljs-class"> '%[^$]'" | </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">select</span></span></span><span class="hljs-class"> -</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">exp</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">foreach</span></span></span><span class="hljs-class"> ($</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">share</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">in</span></span></span><span class="hljs-class"> $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">shares</span></span></span><span class="hljs-class">) </span></span>{ $path = <span class="hljs-string"><span class="hljs-string">"\\"</span></span>+$comp+<span class="hljs-string"><span class="hljs-string">"\"+$share $path $acl = (Get-Item $path).GetAccessControl("</span></span>Access,Audit<span class="hljs-string"><span class="hljs-string">") $ace = new-object System.Security.AccessControl.FileSystemAuditRule($account, $flags, $inheritance, $propagation, $flavor) $acl.AddAuditRule($ace) set-acl -path $path -AclObject $acl } }</span></span></code> </pre> <br><br>  <b><a href="http://www.netwrix.com/download/documents/Quick_Reference_Guide-File_Server_Auditing.pdf">Download cheat sheet</a> (.pdf) for setting up file server auditing</b> <br><br>  ____________ <br>  PS <br>  You can manually configure and audit file servers using this algorithm, or using <a href="http://www.netwrix.com/ru/auditor.html">Netwrix Auditor</a> .  A trial version of the software is available <a href="https://www.netwrix.com/ru/sign_in.html%3Frf%3Drequeste.html%26product%3DCRsuite%3FcID%3D70170000000krnk">here</a> , online test drive is <a href="http://www.netwrix.com/ru/auditing_it_infrastructure_testdrive.html%3FcID%3D70170000000krnk">here.</a> </div><p>Source: <a href="https://habr.com/ru/post/208892/">https://habr.com/ru/post/208892/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../208874/index.html">How was the local version of the site Intuit.Ru hacked</a></li>
<li><a href="../208876/index.html">Chase Algorithm</a></li>
<li><a href="../208886/index.html">Tolstoy Startup Camp: how Yandex teaches how to do its business</a></li>
<li><a href="../20889/index.html">Internet Vulnerability DataBase Deface</a></li>
<li><a href="../208890/index.html">GulpJS - fantastically fast project builder</a></li>
<li><a href="../208894/index.html">Conference Bridge, Call Recording Server and Grandstream Fax Server: Overview</a></li>
<li><a href="../2089/index.html">BitTorrent 5 client published</a></li>
<li><a href="../20890/index.html">Ours are coming!</a></li>
<li><a href="../208900/index.html">Webinar: "Dell Venue PCs - Dell's look at the BYOD concept"</a></li>
<li><a href="../208902/index.html">SmartCAT: cloud technologies for translators</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>