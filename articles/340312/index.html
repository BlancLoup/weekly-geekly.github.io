<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Use PowerShell for IT security. Part V: Security Platform Optimization Using Scripts</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A few months ago I began to solve one problem. I decided to prove that PowerShell can be used as a security monitoring tool. I finished work on my pub...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Use PowerShell for IT security. Part V: Security Platform Optimization Using Scripts</h1><div class="post__text post__text-html js-mediator-article">  A few months ago I began to solve one problem.  I decided to prove that PowerShell can be used as a security monitoring tool.  I finished work on my publication, which describes PowerShell code that allows you to collect file system events, perform some basic analysis functions, and then display the results in graphical format.  Perhaps my security platform using scripts (Security Scripting Platform; SSP) is not a minimally viable product, but it seems to me useful as a simple control tool for a single file directory. <br><a name="habracut"></a><br>  At the end of the project, I realized that certain functionality could be improved.  Event processing was performed inefficiently.  The transfer of information between different parts of the SSP platform required optimization, and the information displayed using the Out-GridView primitive code was presented in the form of an illustrious table. <br><br><h2>  New and improved features </h2><br>  I decided to increase the viability of the SSP platform.  The first step was to optimize the event handling procedure.  Initially, it was designed in such a way that the handler in my Register-EngineEvent script block (see information about script blocks) retrieved messages about file events and sent them to an internal queue, and then into the main code fragment, the classification software. <br><br>  Thinking a little, I realized that you can send messages directly using the Register-EngineEvent -forward function from the event-processing script block and simply remove the unnecessary level of these creepy queues. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Below is a simplified and optimized version. <br><br><pre><code class="hljs mel"><span class="hljs-number"><span class="hljs-number">1.</span></span> #Count events, detect bursts, forward to main interface <span class="hljs-number"><span class="hljs-number">2.</span></span> <span class="hljs-number"><span class="hljs-number">3.</span></span> $cur = Get-Date <span class="hljs-number"><span class="hljs-number">4.</span></span> $Global:Count=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">5.</span></span> $Global:baseline = @{<span class="hljs-string"><span class="hljs-string">"Monday"</span></span> = @(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-string"><span class="hljs-string">"Tuesday"</span></span> = @(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">.5</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>);<span class="hljs-string"><span class="hljs-string">"Wednesday"</span></span> = @(<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>);<span class="hljs-string"><span class="hljs-string">"Thursday"</span></span> = @(<span class="hljs-number"><span class="hljs-number">7</span></span>,<span class="hljs-number"><span class="hljs-number">12</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>); <span class="hljs-string"><span class="hljs-string">"Friday"</span></span> = @(<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>); <span class="hljs-string"><span class="hljs-string">"Saturday"</span></span>=@(<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-string"><span class="hljs-string">"Sunday"</span></span>= @(<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>)} <span class="hljs-number"><span class="hljs-number">6.</span></span> $Global:cnts = @(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-number"><span class="hljs-number">7.</span></span> $Global:burst = $false <span class="hljs-number"><span class="hljs-number">8.</span></span> $Global:evarray = New-Object System.Collections.ArrayList <span class="hljs-number"><span class="hljs-number">9.</span></span> <span class="hljs-number"><span class="hljs-number">10.</span></span> $action = { <span class="hljs-number"><span class="hljs-number">11.</span></span> $Global:Count++ <span class="hljs-number"><span class="hljs-number">12.</span></span> $d=(Get-Date).DayofWeek <span class="hljs-number"><span class="hljs-number">13.</span></span> $i= [math]::<span class="hljs-keyword"><span class="hljs-keyword">floor</span></span>((Get-Date).Hour/<span class="hljs-number"><span class="hljs-number">8</span></span>) <span class="hljs-number"><span class="hljs-number">14.</span></span> <span class="hljs-number"><span class="hljs-number">15.</span></span> $Global:cnts[$i]++ <span class="hljs-number"><span class="hljs-number">16.</span></span> <span class="hljs-number"><span class="hljs-number">17.</span></span> <span class="hljs-number"><span class="hljs-number">18.</span></span> #<span class="hljs-keyword"><span class="hljs-keyword">event</span></span> auditing! <span class="hljs-number"><span class="hljs-number">19.</span></span> <span class="hljs-number"><span class="hljs-number">20.</span></span> $rawtime = $EventArgs.NewEvent.TargetInstance.LastAccessed.Substring(<span class="hljs-number"><span class="hljs-number">8</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>) <span class="hljs-number"><span class="hljs-number">21.</span></span> $filename = $EventArgs.NewEvent.TargetInstance.Name <span class="hljs-number"><span class="hljs-number">22.</span></span> $etime= [datetime]::ParseExact($rawtime,<span class="hljs-string"><span class="hljs-string">"HHmmss"</span></span>,$null) <span class="hljs-number"><span class="hljs-number">23.</span></span> <span class="hljs-number"><span class="hljs-number">24.</span></span> <span class="hljs-number"><span class="hljs-number">25.</span></span> $msg=<span class="hljs-string"><span class="hljs-string">"$($etime)): Access of file $($filename)"</span></span> <span class="hljs-number"><span class="hljs-number">26.</span></span> $msg|Out-File C:\Users\Administrator\Documents\events.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> -Append <span class="hljs-number"><span class="hljs-number">27.</span></span> <span class="hljs-number"><span class="hljs-number">28.</span></span> New-Event -SourceIdentifier Delta -MessageData <span class="hljs-string"><span class="hljs-string">"Access"</span></span> -EventArguments $filename #notify <span class="hljs-number"><span class="hljs-number">29.</span></span> <span class="hljs-number"><span class="hljs-number">30.</span></span> $Global:evarray.Add(@($filename,$etime)) <span class="hljs-number"><span class="hljs-number">31.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!$Global:burst) { <span class="hljs-number"><span class="hljs-number">32.</span></span> $Global:start=$etime <span class="hljs-number"><span class="hljs-number">33.</span></span> $Global:burst=$true <span class="hljs-number"><span class="hljs-number">34.</span></span> } <span class="hljs-number"><span class="hljs-number">35.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-number"><span class="hljs-number">36.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($Global:start.AddMinutes(<span class="hljs-number"><span class="hljs-number">15</span></span>) -gt $etime ) { <span class="hljs-number"><span class="hljs-number">37.</span></span> $Global:Count++ <span class="hljs-number"><span class="hljs-number">38.</span></span> #File behavior analytics <span class="hljs-number"><span class="hljs-number">39.</span></span> $sfactor=<span class="hljs-number"><span class="hljs-number">2</span></span>*[math]::<span class="hljs-keyword"><span class="hljs-keyword">sqrt</span></span>( $Global:baseline[<span class="hljs-string"><span class="hljs-string">"$($d)"</span></span>][$i]) <span class="hljs-number"><span class="hljs-number">40.</span></span> <span class="hljs-number"><span class="hljs-number">41.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($Global:Count -gt $Global:baseline[<span class="hljs-string"><span class="hljs-string">"$($d)"</span></span>][$i] + <span class="hljs-number"><span class="hljs-number">2</span></span>*$sfactor) { #at <span class="hljs-number"><span class="hljs-number">95</span></span>% level of poisson <span class="hljs-number"><span class="hljs-number">42.</span></span> <span class="hljs-number"><span class="hljs-number">43.</span></span> <span class="hljs-number"><span class="hljs-number">44.</span></span> <span class="hljs-string"><span class="hljs-string">"$($etime): Burst of $($Global:Count) accesses"</span></span>| Out-File C:\Users\Administrator\Documents\events.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> -Append <span class="hljs-number"><span class="hljs-number">45.</span></span> $Global:Count=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">46.</span></span> $Global:burst =$false <span class="hljs-number"><span class="hljs-number">47.</span></span> New-Event -SourceIdentifier Delta -MessageData <span class="hljs-string"><span class="hljs-string">"Burst"</span></span> -EventArguments $Global:evarray #notify on burst <span class="hljs-number"><span class="hljs-number">48.</span></span> <span class="hljs-number"><span class="hljs-number">49.</span></span> $Global:evarray= [System.Collections.ArrayList] @() <span class="hljs-number"><span class="hljs-number">50.</span></span> } <span class="hljs-number"><span class="hljs-number">51.</span></span> } <span class="hljs-number"><span class="hljs-number">52.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $Global:burst =$false; $Global:Count=<span class="hljs-number"><span class="hljs-number">0</span></span>; $Global:evarray= [System.Collections.ArrayList] @()} <span class="hljs-number"><span class="hljs-number">53.</span></span> } <span class="hljs-number"><span class="hljs-number">54.</span></span> } <span class="hljs-number"><span class="hljs-number">55.</span></span> <span class="hljs-number"><span class="hljs-number">56.</span></span> Register-EngineEvent -SourceIdentifier Delta -Forward <span class="hljs-number"><span class="hljs-number">57.</span></span> Register-WmiEvent -Query <span class="hljs-string"><span class="hljs-string">"SELECT * FROM __InstanceModificationEvent WITHIN 5 WHERE TargetInstance ISA 'CIM_DataFile' and TargetInstance.Path = '\\Users\\Administrator\\' and targetInstance.Drive = 'C:' and (targetInstance.Extension = 'txt' or targetInstance.Extension = 'doc' or targetInstance.Extension = 'rtf') and targetInstance.LastAccessed &gt; '$($cur)' "</span></span> -sourceIdentifier <span class="hljs-string"><span class="hljs-string">"Accessor"</span></span> -Action $action <span class="hljs-number"><span class="hljs-number">58.</span></span> Write-Host <span class="hljs-string"><span class="hljs-string">"starting engine ..."</span></span> <span class="hljs-number"><span class="hljs-number">59.</span></span> <span class="hljs-number"><span class="hljs-number">60.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ($true) { <span class="hljs-number"><span class="hljs-number">61.</span></span> <span class="hljs-number"><span class="hljs-number">62.</span></span> Wait-Event -SourceIdentifier Access # just hang on this so I don<span class="hljs-string"><span class="hljs-string">'t exit 63. 64. }</span></span></code> </pre> <br>  Then I took the main code snippet, where the files are classified according to social security numbers and other important keywords.  When events arrive from the handler, the files are reclassified.  Then this code periodically displays some classification results. <br><br>  In the latest version, I removed the classification in "real time" and focused on cleaning PowerShell code and improving graphics - this will be discussed below. <br><br>  In the original version, I chose the wrong path and entrusted the PowerShell data locking module with synchronization of data access from parallel tasks that I used to perform routine work.  Subsequent testing revealed that the free module that implements the Lock-Object cmdlet does not work. <br><br>  Even novice system programmers know that synchronization is easier to do with messages, rather than low-level locks.  I changed the code, and now, as mentioned above, the messages are sent from the event handler directly to the main message loop.  In other words: I was able to handle asynchronous events in synchronous mode. <br><br><h2>  PowerShell and .Net Framework diagrams </h2><br>  My most notable achievement in the last month is that I figured out how to embed Microsoft-style charts in PowerShell.  In other words, histograms, linear, dot, and other charts available in Excel and Word can be managed at the program level in PowerShell.  I am relatively recently engaged in programming in PowerShell, so I was very pleased with it.  For more information about the .Net Framework controls, see this publication. <br><br>  This is cool!  At first, I even thought that I could also replace the tangled Out-GridView code. <br>  But it soon became clear that the problem was that in addition to this, we had to deal with interactive programming elements associated with Microsoft forms.  I just wanted to display my .Net diagrams and not write code for low-level functions.  Is there a simplified way to solve this problem? <br><br>  After active reflection, I came to the conclusion that the simplest way in this situation would be to launch each diagram in its own runspace function as a separate task.  (Note to fans: this way I got rid of the need to create a message handling function for all the diagrams, since each of them is executed separately in the form of modal dialogs.) <br><br>  This also helped me with the free PowerShell module, which collapses the intricate controls of the .Net diagrams.  Thank you, Marius! <br><br>  I have previously set up a task management system to scan and classify each monitored file in the directory.  And now to run the charts, I just had to ensure that this task management code is reused. <br><br>  I created a pie chart to represent the relative concentration of sensitive data, a histogram for dividing files by type of sensitive data.  But most of all I am proud of the classic step diagram of events for the conditions of the surge in access to files, which can be a sign of an attack. <br><br><img src="https://habrastorage.org/webt/59/e5/e2/59e5e2ac01a6c086652007.jpeg"><br><br>  <i>My great dashboard.</i>  <i>Not bad for PowerShell</i> <i><br></i>  <i>with .Net diagrams.</i> <br><br>  If any of you are interested in the main piece of code that does all the work in my SSP platform, then it is listed here below: <br><br><pre> <code class="hljs markdown"><span class="hljs-bullet"><span class="hljs-bullet">1. </span></span>$scan = { #file content scanner 2. $name=$args[<span class="hljs-string"><span class="hljs-string">0</span></span>] 3. function scan { 4. Param ( 5. [<span class="hljs-string"><span class="hljs-string">parameter(position=1)</span></span>] 6. [<span class="hljs-string"><span class="hljs-string">string</span></span>] $Name 7. ) 8. $classify =@{"Top Secret"=[<span class="hljs-string"><span class="hljs-string">regex</span></span>]'[<span class="hljs-string"><span class="hljs-string">tT</span></span>]op [<span class="hljs-string"><span class="hljs-string">sS</span></span>]ecret'; "Sensitive"=[<span class="hljs-string"><span class="hljs-string">regex</span></span>]'([<span class="hljs-string"><span class="hljs-string">Cc</span></span>]onfidential)|([<span class="hljs-string"><span class="hljs-string">sS</span></span>]nowflake)'; "Numbers"=[<span class="hljs-string"><span class="hljs-string">regex</span></span>]'[<span class="hljs-string"><span class="hljs-string">0-9</span></span>]{3}-[<span class="hljs-string"><span class="hljs-string">0-9</span></span>]{2}-[<span class="hljs-string"><span class="hljs-string">0-9</span></span>]{3}' } 9. 10. $data = Get-Content $Name 11. 12. $cnts= @() 13. 14. if($data.Length -eq 0) { return $cnts} 15. 16. foreach ($key in $classify.Keys) { 17. 18. $m=$classify[<span class="hljs-string"><span class="hljs-string">$key</span></span>].matches($data) 19. 20. if($m.Count -gt 0) { 21. $cnts+= @($key,$m.Count) 22. } 23. } 24. $cnts 25. } 26. scan $name 27. } 28. 29. 30. 31. 32. #launch a .net chart 33. function nchart ($r, $d, $t,$g,$a) { 34. 35. $task= { 36. Param($d,$t,$g,$a) 37. 38. Import-Module C:\Users\Administrator\Documents\charts.psm1 39. $chart = New-Chart -Dataset $d -Title $t -Type $g -Axis $a 40. Show-Chart $chart 41. 42. } 43. $Task = [<span class="hljs-string"><span class="hljs-string">powershell</span></span>]::Create().AddScript($task).AddArgument($d).AddArgument($t).AddArgument($g).AddArgument($a) 44. $Task.RunspacePool = $r 45. $Task.BeginInvoke() 46. 47. } 48. 49. Register-EngineEvent -SourceIdentifier Delta -Action { 50. 51. if($event.MessageData -eq "Burst") { #just look at bursts 52. New-Event -SourceIdentifier File -MessageData $event.MessageData -EventArguments $event.SourceArgs 53. } 54. 55. 56. Remove-Event -SourceIdentifier Delta 57. } 58. 59. 60. 61. 62. $list=Get-WmiObject -Query "SELECT <span class="hljs-bullet"><span class="hljs-bullet">* From CIM_DataFile where Path = '\\Users\\Administrator\\' and Drive = 'C:' and (Extension = 'txt' or Extension = 'doc' or Extension = 'rtf')" 63. 64. 65. #long list --let's multithread 66. 67. #runspace 68. $RunspacePool = [RunspaceFactory]::CreateRunspacePool(1,5) 69. $RunspacePool.Open() 70. $Tasks = @() 71. 72. 73. 74. 75. foreach ($item in $list) { 76. 77. $Task = [powershell]::Create().AddScript($scan).AddArgument($item.Name) 78. $Task.RunspacePool = $RunspacePool 79. 80. $status= $Task.BeginInvoke() 81. $Tasks += @($status,$Task,$item.Name) 82. } 83. 84. 85. 86. 87. #wait 88. while ($Tasks.isCompleted -contains $false){ 89. 90. } 91. 92. 93. #Analytics, count number of sensitive content for each file 94. $obj = @{} 95. $tdcnt=0 96. $sfcnt=0 97. $nfcnt=0 98. 99. 100. for ($i=0; $i -lt $Tasks.Count; $i=$i+3) { 101. $match=$Tasks[$i+1].EndInvoke($Tasks[$i]) 102. 103. if ($match.Count -gt 0) { 104. $s = ([string]$Tasks[$i+2]).LastIndexOf("\")+1 105. 106. $obj.Add($Tasks[$i+2].Substring($s),$match) 107. for( $j=0; $j -lt $match.Count; $j=$j+2) { 108. switch -wildcard ($match[$j]) { 109. 'Top*</span></span>' { $tdcnt+= 1 } 110. 111. 'Sens<span class="hljs-emphasis"><span class="hljs-emphasis">*' { $sfcnt+= 1} 112. 113. 'Numb*</span></span>' { $nfcnt+=1} 114. 115. } 116. 117. } 118. } 119. $Tasks[<span class="hljs-string"><span class="hljs-string">$i+1</span></span>].Dispose() 120. 121. } 122. 123. 124. #Display Initial Dashboard 125. #Pie chart of sensitive files based on total counts of senstive dat 126. $piedata= @{} 127. foreach ( $key in $obj.Keys) { 128. $senscnt =0 129. for($k=1; $k -lt $obj[<span class="hljs-string"><span class="hljs-string">$key</span></span>].Count;$k=$k+2) { 130. $senscnt+= $obj[<span class="hljs-string"><span class="hljs-string">$key</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">$k</span></span>] 131. 132. } 133. $piedata.Add($key, $senscnt) 134. 135. } 136. 137. 138. nchart $RunspacePool $piedata "Files with Sensitive Content" "Pie" $false 139. 140. #Bar Chart of Total Files, Sensitive vs Total 141. $bardata = @{"Total Files" = $Tasks.Count} 142. $bardata.Add("Files w. Top Secret",$tdcnt) 143. $bardata.Add("Files w. Sensitive", $sfcnt) 144. $bardata.Add("Files w. SS Numbers",$nfcnt) 145. 146. 147. nchart $RunspacePool $bardata "Sensitive Files" "Bar" $false 148. 149. 150. #run event handler as a seperate job 151. Start-Job -Name EventHandler -ScriptBlock({C:\Users\Administrator\Documents\evhandler.ps1}) 152. 153. 154. while ($true) { #main message handling loop 155. 156. [<span class="hljs-string"><span class="hljs-string">System.Management.Automation.PSEventArgs</span></span>] $args = Wait-Event -SourceIdentifier File # wait on event 157. Remove-Event -SourceIdentifier File 158. #Write-Host $args.SourceArgs 159. if ($args.MessageData -eq "Burst") { 160. #Display Bursty event 161. $dt=$args.SourceArgs 162. #time in seconds 163. [<span class="hljs-string"><span class="hljs-string">datetime</span></span>]$sevent =$dt[<span class="hljs-string"><span class="hljs-string">0</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">1</span></span>] 164. 165. $xyarray = [<span class="hljs-string"><span class="hljs-string">ordered</span></span>]@{} 166. $xyarray.Add(0,1) 167. for($j=1;$j -lt $dt.Count;$j=$j+1) { 168. [<span class="hljs-string"><span class="hljs-string">timespan</span></span>]$diff = $dt[<span class="hljs-string"><span class="hljs-string">$j</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">1</span></span>] - $sevent 169. $xyarray.Add($diff.Seconds,$j+1) 170. } 171. nchart $RunspacePool $xyarray "Burst Event" "StepLine" $true 172. } 173. 174. 175. }#while 176. 177. Write-Host "Done!"</code> </pre> <br><h2>  Lessons learned </h2><br>  Of course, in any task, the main goal is not the goal itself, but the process of finding a solution.  Do you agree?  In this case, I learned the main thing for myself - PowerShell can be used for security control.  For a single directory, in a small system.  And only in the case of occasional use. <br><br>  I plan to make some improvements to the implementation I just introduced (add graphics in real time), but I don‚Äôt expect my final software to become anything more than just a model project. <br><br>  Monitoring file events, analyzing and graphing information for the entire system is an extremely difficult task for one person.  In principle, my solution can be recoded using C ++, but the application will still have to solve the problem of delays and deviations in the processing of low-level events.  To do this correctly, it is necessary to have some mechanisms deep in the OS itself (to begin with), and then perform a much more serious analysis of file events than the one that is executed by my primitive code.  This is far from easy! <br><br>  I usually end up doing these kind of ‚Äúdo it yourself‚Äù publications with the words ‚Äúyou know what it is about‚Äù.  I will not disappoint you. <br><br>  You know what it is about.  Our own enterprise-class solution is a true Data Security Platform (DSP), as it performs the functions of classifying, analyzing, detecting threats, and much more at the level of entire IT systems. <br><br>  Do not back down, try your options.  Maybe even based on this project.  Understand the real capabilities of the DSP platform, learn its strengths and weaknesses. <br><br>  Have questions?  Feel free to <a href="https://www.varonis.com/ru">ask them to us!</a> </div><p>Source: <a href="https://habr.com/ru/post/340312/">https://habr.com/ru/post/340312/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../340296/index.html">Tuning the Linux network stack for the lazy (v2.5.0)</a></li>
<li><a href="../340298/index.html">Company growth: from five to three hundred</a></li>
<li><a href="../340302/index.html">Parsing sites: from the point of view of the law, one of the most useful IT tools in the world (and in Russia) looks like?</a></li>
<li><a href="../340304/index.html">Why robots have to format the code for us</a></li>
<li><a href="../340306/index.html">Windows 10 Fall Creators Update and the Windows subsystem for Linux</a></li>
<li><a href="../340314/index.html">Universal adapter</a></li>
<li><a href="../340316/index.html">Are you already using R in business?</a></li>
<li><a href="../340318/index.html">Behind the scene of TOP-1 supercomputer</a></li>
<li><a href="../340320/index.html">Free YouTube broadcast DevOps conference DevOops 2017</a></li>
<li><a href="../340322/index.html">How I passed the practice in the university and set up Nextcloud</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>