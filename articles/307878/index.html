<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Long live Wi-Fi positioning in Enterprise</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wi-Fi positioning does not work at all? Not at all! 
 After reading the previous article ‚ÄúWhy Wi-Fi Positioning Does Not Take Off,‚Äù my colleagues deci...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Long live Wi-Fi positioning in Enterprise</h1><div class="post__text post__text-html js-mediator-article"><h3>  Wi-Fi positioning does not work at all?  Not at all! </h3><br>  After reading the previous article ‚ÄúWhy Wi-Fi Positioning Does Not Take Off,‚Äù my colleagues decided that it didn‚Äôt work at all and shouldn‚Äôt be contacted.  This is absolutely not true! <br><br>  In this article I want to tell you how positioning works in a corporate Wi-Fi network that is built according to the requirements of data and voice (but not for positioning). <br><br><h3>  Wi-Fi positioning "to the room" </h3><br>  Yes, Wi-Fi is not so well adapted to positioning: numerous reflections, interference and much more.  And when you start adding tools that increase accuracy, the price tag starts to grow rapidly! <br>  But, let's say, the Customer already has Wi-Fi, he is not ready to spend money on a separate infrastructure for the positioning service (arrange separate sensors, distribute tags) and does not even want to upgrade the existing Wi-Fi network intended for data transmission (increase the number of access points (hereinafter TD), arrange them around the perimeter, install monitoring modules). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      What can the customer expect?  With high probability, he can count on the accuracy of "to the room."  By ‚Äúup to room‚Äù accuracy in this case, I mean the range within 10 meters. <br><br>  It is possible to increase positioning accuracy, but it will require effort and money (which, however, does not stop everyone). <br><a name="habracut"></a><br><h3>  Long live the Wi-Fi positioning in Enterprise! </h3><br>  Who in general may need Wi-Fi positioning accurate to the room?  Maybe this is just a toy administrator?  This accuracy is not enough to work with notifications that pop up on a smartphone when crossing a virtual border. <br><br>  My opinion is that the main driver for buying Wi-Fi positioning "to the room" is working in conjunction with a wireless intrusion detection and prevention system (wIPS) or in conjunction with a monitoring system. <br><br>  For the wIPS system, this service, I think, is necessary and, in an amicable way, should be its component (which is most often found).  For a monitoring system, this is also a rather important service that helps to get an idea of ‚Äã‚Äãthe location of interference, the number and location of its own and third-party clients, in particular, for troubleshooting. <br><br>  In this regard, I believe that along with the monitoring system and wIPS, in any Wi-Fi network of an enterprise class, there should be a positioning service. <br><br><h3>  Do we need to fork out for Cisco Hyperlocation or other expensive solutions? </h3><br>  Before proceeding to the analysis of complex and expensive solutions, such as Cisco Hyperlocation, it is worth assessing how standard Wi-Fi positioning works.  By ‚Äústandard‚Äù in this case, I understand the most common option: when they take a normal Wi-Fi network for data transfer (and / or voice) and add one inexpensive server for positioning miscalculations (without adding monitoring modules, antennas, moving points). <br><br><h3>  The best stand is a working network! </h3><br>  Consider a fragment of the network of one of my customers. <br>  The network was built on the requirements of data and voice, but not positioning.  The pilot area, I took part of the floor.  Below is a floor plan of the pilot area with marked access points and indicative dimensions. <br><br><img src="https://habrastorage.org/files/632/04b/881/63204b8810884c9b9a76ae8978c28459.png" alt="image"><br><br>  Equipment pilot zone wireless network: <br><br>  - Cisco Wireless Access Controller WLC (hereinafter WLC); <br>  - office access points without additional Cisco Aironet modules; <br>  - Cisco Prime Infrastructure Management System (hereinafter PI). <br>  - Android 4.4.4 smartphone <br><br>  What was additionally installed in order to have a positioning service: <br>  - Cisco CMX 10 (hereinafter CMX). <br><br><h3>  How is our network "normal" </h3><br>  ‚ÄúA typical Wi-Fi network‚Äù is a loose concept.  Therefore, I will show (not without pride) the results of the radio survey in the pilot zone, and you will already decide how acceptable it is.  The measurements were carried out in both bands (2.4 GHz and 5 GHz) at a level of -67dBm and SNR 25. Below is a picture of one measurement in the 5 GHz range with a level limit of -67dBm. <br><br><img src="https://habrastorage.org/files/29a/edc/66d/29aedc66d65f4a4ea308f757cc3f7f53.png" alt="image"><br><br>  On a loaded network, the performance test (using the iperf program) showed about 50-80 Mbit / s in the 5 GHz band in the middle of the working day under heavy load. <br><br><h3>  CMX settings </h3><br>  Since the floor plans with the location of access points had already been entered into PI, I only needed to deploy a CMX virtual machine and import maps into it, along with the location of the AP and data on wall attenuation. <br><br>  With walls there is a small nuance.  Only thick walls are imported (heavy walls, they are also thick walls, 13dB).  I painted thick walls only around the perimeter of the building, since in our office all the walls inside the building do not fall under the definition of ‚Äúthick‚Äù. <br><br>  You can also specify the zone where clients can and cannot be (in order to exclude clients in the air outside the second floor window for example, besides it can significantly improve accuracy, as in my case), but I decided not to do it , to evaluate how CMX will work in this situation, thick walls, traced around the perimeter. <br><br>  To limit the number of displayed devices, I configured a filter: <br><br>  - Only connected devices are displayed (that is, third-party clients are not displayed at all); <br>  - Only devices with a signal level of -85dBm or more are displayed. <br>  - <br>  For tests, I left a display of interference and labels. <br><br><h3>  Bench tests </h3><br><h4>  Positioning accuracy measurement </h4><br>  In PI there is such a curious tool (Inspect Location Readiness), which is quite straightforward, without any measurements, displays the zone ‚Äúready‚Äù for positioning.  It looks like this: <br><br><img src="https://habrastorage.org/files/a4c/98e/9ec/a4c98e9ec59d4ff5a1179a41de1583b4.png" alt="image"><br><br>  It is clear that this information can only be taken into account, but cannot be based on it.  CMX has a built-in position accuracy measurement function (location accuracy test), which already measures the actual positioning accuracy: the room location indicates the real location of the wireless Wi-Fi client (hereinafter referred to as the Client) and CMX documents the data of its own measurements, calculates the accuracy.  I used my own smartphone to measure positioning accuracy.  I chose about 5 points in advance in the pilot zone (outside the perimeter of the TD, between the TD, in the corridor, etc.).  At each point, I wanted the CMX to take at least five measurements.  Below is the result I got for the pilot zone: <br><br><img src="https://habrastorage.org/files/e04/0c9/35f/e040c935fd4448279135119599981705.png" alt="image"><br><br>  Highlights: <br><br>  - Positioning accuracy at all points was within 10 meters (in 99.2% of cases); <br>  - Average positioning accuracy - 4.21 meters; <br>  - Positioning accuracy in 50% of cases was up to 3.85 meters. <br>  You can try to compare these results with the official Cisco guide on Wi-Fi positioning: <br>  - Accuracy of less than or equal to 10 meters, with 90 percent precision <br>  - Accuracy of less than or equal to 5 meters, with 50 percent precision <br><br>  The positioning accuracy fits within the indicated frames, and not only around the TD perimeter, but also around the entire pilot zone, and this is very good.  In this case, the points were placed without taking into account the requirements for positioning! <br>  I associate such results in particular with the successful configuration of the building: a long narrow building, along the perimeter of which a thick wall passes, preventing Clients from ‚Äúfalling out‚Äù much beyond its limits. <br><br>  But it turned out not so rosy. <br><br><h3>  Just a little about the frequency of updating the position </h3><br>  Even before the tests, I found that the smartphone is much more likely than some other devices to update its position in CMX.  In order to understand why this is happening, I investigated the traffic from the smartphone and from other Clients.  As it turned out, the smartphone did an active scan of certain SSIDs using the probe request.  These requests were sent consistently to all channels, which led to the fact that all TDs had up-to-date power information (RSSI) of the smartphone signal.  As I later found out, this is the standard algorithm for the operation of active Wi-Fi tags (they wake up, send requests to all channels sequentially and fall asleep).  But in this case, it was just the manually crafted profiles of the wireless networks that I deleted before conducting the tests. <br><br>  This led to the following result: <br><br>  - If the smartphone was in one place and did not actively generate traffic, then its location was updated very rarely: in CMX there is such a parameter as ‚Äúlast seen‚Äù, that is, when the Client was last seen, so he came to me minutes (within 5 - 10 minutes). <br>  - When the SSID profiles that are actively scanning were clogged on the smartphone, this parameter was within 10 - 15 seconds. <br>  - If I started to actively generate traffic, the parameter "last seen" was also within 10-15 seconds. <br>  - If I moved from point to point, the result was slightly different.  The position was updated, but the accuracy of this position was much less than stated.  It is connected, I think, it was because the RSSI was updated only for a certain TD, and the position needed to be updated, but since the RSSI data was not collected enough, the accuracy was much worse. <br>  - <br>  I want to consider this effect in more detail in a separate article, which will be devoted to the frequency of updating positions. <br><br><h3>  Measurement of positioning accuracy when moving </h3><br>  The positioning system not only displays the current location, but can also show client movement history playback, which can be useful in troubleshooting and investigating incidents. <br><br>  But in our case I will use this tool for other purposes, namely, assessing the accuracy of positioning when moving. <br><br>  To be as impartial as possible, I did not begin to walk in any special circles around the office, but simply took the history of my movement with the smartphone for the day. <br><br>  This is how the second floor plan looks like with applied customers.  The blue circles show the TD, inside the circles - the number of authorized Clients.  Green dots are Clients. <br><br><img src="https://habrastorage.org/files/04f/eec/6f7/04feec6f7be0412ebe09836c52bb709c.png" alt="image"><br><br>  The system is very convenient search for customers.  The client can use any characters of the MAC address, user name, SSID.  Filtering is automatic for each character entered.  I found my smartphone with three letters. <br><br><img src="https://habrastorage.org/files/b71/181/9d4/b711819d418644cfa8746a1913757f92.png" alt="image"><br><br>  My position is indicated quite accurately, I am in the left compartment of the A-03 (and not in the second compartment, as shown).  The width of the compartment - 5 meters, so that the accuracy is quite personal.  If you hover the cursor on the Client, it schematically shows on which TDs the RSSI is measured (which is taken into account). <br><br><img src="https://habrastorage.org/files/27e/5d6/4a4/27e5d64a4fab4c1fbce8125672a2832e.png" alt="image"><br><br>  After the Client is selected, you can go to the history of movements. <br><br><img src="https://habrastorage.org/files/ae0/502/9b0/ae05029b00984f999f6c76d6ee71c1c6.png" alt="image"><br><br>  What is immediately interesting: the connection time of 9.31 is the time of arrival at the office (you can track the time of arrival!), The positioning accuracy at that time was even better (left compartment -03).  In the 10 o'clock area I went to the B-32 room area.  And here the most surprising begins: on the map this is displayed as a rather chaotic movement of the Client: <br><br><img src="https://habrastorage.org/files/2b2/a69/395/2b2a6939579f4cecad8eacfa58cea8e6.png" alt="image"><br><br>  Although the general direction of movement is guessed, I obviously did not move around the perimeter of the building.  Such an effect is connected, as I suppose, just with what I described a little earlier: RSSI measurement is detected only on a certain TD (which is roaming), CMX is forced to update the position, but its accuracy is extremely low.  Probably, CMX would have pushed the Client out of the building if it were not for the thick walls drawn in which the Client ‚Äúbinds‚Äù (and if the walls are not drawn, it is necessary to draw the positioning regions).  As a mitigating circumstance, it is possible to take into account the fact that in the compartment ‚ÄúB‚Äù the coverage is worse and, therefore, the positioning also.  And what are the results in the pilot zone?  Then I returned to room A-03.  Then around 12.30 I went to a colleague in the A-16 zone, then it was possible to estimate the exact positioning accuracy in the pilot zone. <br><br><img src="https://habrastorage.org/files/41b/302/b49/41b302b490194ac3828e7293fc6f39e6.png" alt="image"><br><br>  In this case, the mapping went more clearly, but on the way back I was still thrown around the perimeter.  I think this may be due both to the activity of the smartphone, and to a more dense coating directly in this compartment. <br><br>  A curious fact: the movement of the client is not tied to one floor, but is united between all the rooms.  For example, I found that in the region of three hours I went down to the first floor (I went to dinner). <br><br><img src="https://habrastorage.org/files/3a0/b44/50e/3a0b4450e19e46da8a211a096e5d3df3.png" alt="image"><br><br><h3>  The system also displays various noise and tags. </h3><br>  There is also such a pleasant moment, not only Wi-Fi clients can be displayed, but also noise and tags (due to the spectrum analyzer built into the TD).  In the Alpha meeting room, we now have to demonstrate a device based on the IEEE 802.15.4 (ZigBee) standard.  The positioning system found it, determined the type, and even with very good accuracy displayed its location! <br><br><img src="https://habrastorage.org/files/018/d1b/1ac/018d1b1ac6fd4dbf8049c2000aded89b.png" alt="image"><br><br>  This is great for troubleshooting and investigating incidents.  Few people do periodic radio surveys.  And this tool allows, without getting up from the chair, to detect all the interference with the accuracy of the room and carry out with them all the necessary measures (legalize, remove, etc.). <br><br><h3>  General conclusions </h3><br>  What conclusions can be made: <br><br>  1. Positioning accuracy in Wi-Fi networks intended for data transmission / voice in general will be within 10 meters in 90% of measurements (‚Äúto the room‚Äù accuracy). <br>  2. The issue of positioning accuracy must necessarily be considered in tandem with the question of the frequency of updating positions.  The accuracy of a stationary Client and the accuracy of a moving Client can vary greatly.  That is, you need to understand how and with what speed the Client can move. <br>  3. You need to understand what type of traffic and how often it should (and can) generate the required Client. <br><br><h3>  What's next? </h3><br>  When preparing this material, I received both answers and new questions, the main of which is the update frequency in Wi-Fi positioning.  For this reason, in the next article I will try to consider this issue in more detail. </div><p>Source: <a href="https://habr.com/ru/post/307878/">https://habr.com/ru/post/307878/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../307866/index.html">Report on attending a YouTube conference in Kiev or Why video content has become a part of life</a></li>
<li><a href="../307868/index.html">Turn Java / JVM application into a daemon</a></li>
<li><a href="../307870/index.html">Who is to blame and what to do if an IT person is bored at work. Poll results</a></li>
<li><a href="../307874/index.html">Russian and foreign sites for collective financing</a></li>
<li><a href="../307876/index.html">What's new in MS Azure</a></li>
<li><a href="../307880/index.html">Codefreeze and continuous delivery</a></li>
<li><a href="../307882/index.html">The first meeting of the Moscow IoT Community: how we found a bug in Visual Studio</a></li>
<li><a href="../307884/index.html">DotNext 2016 Moscow: 8 MVP, StackOverflow and a bit of hardcore</a></li>
<li><a href="../307886/index.html">To the question of the operating point of the LED and (suddenly) import substitution</a></li>
<li><a href="../307890/index.html">Working with screen states in Xamarin.Forms</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>