<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Docker 17.06 and Kubernetes 1.7: key innovations</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Last week presented two ‚Äútasty‚Äù releases from the Open Source-world of containers: Docker (version 17.06) and Kubernetes (version 1.7) were updated al...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Docker 17.06 and Kubernetes 1.7: key innovations</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/181/ef8/19b/181ef819b6bf4f7fab1272b463b9e18a.png"><br>  Last week presented two ‚Äútasty‚Äù releases from the Open Source-world of containers: Docker (version 17.06) and Kubernetes (version 1.7) were updated almost simultaneously.  What opportunities did they bring?  The article provides information from the announcements and release notes of these releases with a few clarifications on some of the key changes. <a name="habracut"></a><br><br><h2>  Docker CE 17.06 </h2><br>  June 28 was announced <a href="http://blog.docker.com/2017/06/announcing-docker-17-06-community-edition-ce/">Docker CE (Community Edition)</a> June 17 - the first release of the container system, assembled with the help of the <b>project Moby</b> , announced in April.  More about Moby, we <a href="https://habrahabr.ru/company/flant/blog/329136/">have already written</a> . <br><br><h3>  Build in stages </h3><br>  The main feature of the release was the official stabilization of support for multi-stage builds (multi-stage builds), first introduced in Docker 17.05.0.  Its essence lies in the ability to describe in one <code>Dockerfile</code> several stages of assembling an image so that intermediate data that are not required do not fall into the final image.  The obvious example that Docker gives is that Java developers usually use Apache Maven to compile their applications, but Maven is not needed in the final container (image) to run these applications.  Now you can arrange the <code>Dockerfile</code> in such a way that Maven itself will be used in the intermediate image (for assembly), but will not get into the final image (for launch). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Here is the <code>Dockerfile</code> option for a <a href="https://github.com/dockersamples/atsea-sample-shop-app">simple</a> Java Spring Boot <a href="https://github.com/dockersamples/atsea-sample-shop-app">application</a> : <br><br> <code>FROM node:latest AS storefront <br> WORKDIR /usr/src/atsea/app/react-app <br> COPY react-app/package.json . <br> RUN npm install <br> COPY . /usr/src/atsea/app <br> RUN npm run build <br> <br> FROM maven:latest AS appserver <br> WORKDIR /usr/src/atsea <br> COPY pom.xml . <br> RUN mvn -B -f pom.xml -s /usr/share/maven/ref/settings-docker.xml dependency:resolve <br> COPY . . <br> RUN mvn -B -s /usr/share/maven/ref/settings-docker.xml package -DskipTests <br> <br> FROM java:8-jdk-alpine <br> WORKDIR /static <br> COPY --from=storefront /usr/src/atsea/app/react-app/build/ . <br> WORKDIR /app <br> COPY --from=appserver /usr/src/atsea/target/AtSea-0.0.1-SNAPSHOT.jar . <br> ENTRYPOINT ["java", "-jar", "/app/AtSea-0.0.1-SNAPSHOT.jar"] <br> CMD ["--spring.profiles.active=postgres"]</code> <br> <br>  As you can see, the two preparatory stages here use Node.js and Apache Maven to build the application, but the resulting image will be compact, not having Node.js or Maven in its composition. <br><br>  <i><b>Note</b> : So far in our company we have used a feature called artifacts in our own Open Source utility <a href="https://github.com/flant/dapp">dapp</a> for this purpose ( <a href="https://habrahabr.ru/company/flant/blog/324274/">see its overview here</a> ).</i> <br><br><h3>  Logs and metrics </h3><br>  Docker metrics can now be used in plugins.  For the demonstration, an example of a plugin is shown that proxies requests for a metric that is available in it: <br><br><pre> <code class="bash hljs">$ docker plugin install --grant-all-permissions cpuguy83/docker-metrics-plugin-test:latest $ curl http://127.0.0.1:19393/metrics</code> </pre><br>  But this is only a demonstration, and the real purpose of this innovation is to send the collected metrics to an external service with the help of plug-ins or make them available for assembly by another service (for example, Prometheus). <br><br>  Plug-ins can now also be used for logs (that is, to implement logging drivers), and a list of all logging drivers has been added to <code>docker info</code> .  In addition, the implementation of <code>docker service logs</code> , which (also from the last release on May 17, 2005) can show individual task logs ( <code>/task/{id}/logs</code> in REST), was transferred from the Edge branch to Stable, so it is now easy to get generalized logs for the entire service running in swarm. <br><br><h3>  Network </h3><br>  It became possible to link services to networks within a node (node-local): Host, Macvlan, IPVlan, Bridge, local-scope.  An example for Macvlan is the creation of site-specific network configurations on the work nodes and the network on the management node, which will apply them: <br><br><pre> <code class="bash hljs">[Wrk-node1]$ docker network create --config-only --subnet=10.1.0.0/16 <span class="hljs-built_in"><span class="hljs-built_in">local</span></span>-config [Wrk-node2]$ docker network create --config-only --subnet=10.2.0.0/16 <span class="hljs-built_in"><span class="hljs-built_in">local</span></span>-config [Mgr-node2]$ docker network create --scope=swarm --config-from=<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>-config -d macvlan mynet [Mgr-node2]$ docker service create --network=mynet my_new_service</code> </pre> <br>  As part of the same change, the <code>DOCKER-USER</code> chain was added to iptables, which is inserted first into <code>FORWARD</code> and is not reset <i>(for this addition, thanks to <a href="https://habrahabr.ru/users/ertaquo/" class="user_link">ertaquo</a> !)</i> . <br><br>  In addition, <a href="https://github.com/docker/libnetwork/pull/1796/commits/d64e71e4f7e23c2cc71f26d56b651e78a58bbae7">changes</a> have been made to the internal algorithms of Service Discovery, which are designed to improve the logic of its work. <br><br><h3>  Swarm </h3><br>  A number of innovations received the Swarm mode, and in particular: <br><br><ul><li>  Configuration Objects, which allow you to safely transfer configuration information in the same way as it was done for secrets: <br><br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"This is a config"</span></span> | docker config create test_config - $ docker service create --name=my-srv --config=test_config ‚Ä¶ $ docker <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> -it 37d7cfdff6d5 cat test_config This is a config</code> </pre> <br></li><li>  the function of rotating CA certificates in the public key infrastructure (PKI) system used for secure deployment of the container orchestration system ( <code>docker swarm ca --rotate</code> ); </li><li>  event support (previously available outside of Swarm) for real-time data on services, nodes, networks, secrets; </li><li>  new <code>--datapath-addr</code> flag for <code>docker swarm init</code> , indicating a network interface for isolating <i>control traffic</i> from application <i>data (data traffic)</i> - useful for applications that have a large I / O load; </li><li>  the ability to specify the storage location of the secret in the container (instead of the traditional <code>/var/run</code> ). </li></ul><br>  A more detailed changelog in Docker 17.06 along with links to commits can be found in <a href="https://docs.docker.com/release-notes/docker-ce/">Docker CE release notes</a> .  And for those who like to watch and listen, there is an <a href="https://www.youtube.com/watch%3Fv%3D-NeaXUGEK_g">8-minute video</a> with a story and a demonstration of the main innovations. <br><br><h2>  Kubernetes 1.7 </h2><br>  June 29 was announced by <a href="http://blog.kubernetes.io/2017/06/kubernetes-1.7-security-hardening-stateful-application-extensibility-updates.html">Kubernetes 1.7</a> , the main innovations of which are called improvements in security, support for stateful applications, extensibility of the platform.  What is behind this? <br><br><h3>  Security </h3><br><ul><li>  Declared stable <a href="https://kubernetes.io/docs/concepts/services-networking/network-policies/">Network Policy API</a> , allowing you to customize the rules that define (and limit) the interaction between the sub. </li><li>  <a href="https://kubernetes.io/docs/admin/authorization/node/">Node authorizer</a> , which allows you to restrict kubelet API requests (to secrets, submissions and other node objects). </li><li>  The alpha version of <a href="https://kubernetes.io/docs/tasks/administer-cluster/encrypt-data/">encryption secrets</a> and other resources stored in etcd. </li><li>  Support for certificate and client certificate rotation has been added to <a href="https://kubernetes.io/docs/admin/kubelet-tls-bootstrapping/">kubelet TLS bootstrapping</a> . </li><li>  <a href="https://kubernetes.io/docs/tasks/debug-application-cluster/audit/">Audit</a> logs, stored by the API server, have become more customizable and extensible with support for event filtering and webbooks, as well as providing more data for system auditing. </li></ul><br><h3>  Support for stateful applications </h3><br><ul><li>  A beta version of the <a href="https://kubernetes.io/docs/tutorials/stateful-application/basic-stateful-set/">automatic</a> <code>StatefulSet</code> <a href="https://kubernetes.io/docs/tutorials/stateful-application/basic-stateful-set/">update</a> feature used for deploying stateful applications.  The update strategy is determined by the field <code>spec.updateStrategy</code> , which now supports two values: <code>OnDelete</code> and <code>RollingUpdate</code> . </li><li>  Support for <code>StatefulSets</code> more quickly scale and launch applications that do not require a strict sequence, now configured through the <a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/">Pod Management Policy</a> .  Such applications can now be launched in parallel and without waiting for the receipt of certain status (Running, Ready). </li><li>  Alpha Version of <a href="https://kubernetes.io/docs/concepts/storage/volumes/">Local Storage</a> : In <code>StorageClasses</code> inside <code>StatefulSets</code> you can now access local storage through a standard PVC / PV interface. </li><li>  <a href="https://kubernetes.io/docs/tasks/manage-daemon/rollback-daemon-set/">Smart rollback</a> (and change history) with <code>DaemonSets</code> updates. </li><li>  A new <a href="https://kubernetes.io/docs/concepts/storage/volumes/">StorageOS Volume</a> plugin that implements high-availability persistent storage volumes across the entire cluster (from local or attached storage). </li></ul><br><h3>  Extensibility </h3><br><ul><li>  <a href="https://kubernetes.io/docs/concepts/api-extension/apiserver-aggregation/">Aggregation API</a> allows you to extend the capabilities of Kubernetes own API.  The aggregation layer works together with kube-apiserver and does nothing until a single resource is registered for the API extension.  API registration is done through an <code>APIService</code> object, which is implemented through an <code>extension-apiserver</code> inside a hearth operating in a Kubernetes cluster. </li><li>  Added new RPC calls to <a href="">Container Runtime Interface (CRI)</a> to get container metrics.  Added alpha version of integration with <a href="https://habrahabr.ru/company/flant/blog/325358/">containerd</a> , supporting the basic life cycle of poda and image management. </li></ul><br><h3>  Other </h3><br><ul><li>  Alpha version of support for external controllers <a href="https://kubernetes.io/docs/admin/extensible-admission-controllers/">Dynamic Admission</a> , allowing you to add business logic to the API server when modifying objects. </li><li>  Alpha version of <a href="https://kubernetes.io/docs/tasks/federation/set-up-placement-policies-federation/">Policy-based Federated Resource Placement</a> , which allows you to define policy-based decisions on federated resources (using an external policy engine, for example, based on price or performance requirements). </li><li>  The Third Party Resource (TPR) has been replaced by Custom Resource Definitions (CRD), which offer a ‚Äúclearer API‚Äù and solve a number of problems fixed during the beta testing of TPR.  Fully TPR will be removed in Kubernetes 1.8 ( <a href="https://kubernetes.io/docs/tasks/access-kubernetes-api/migrate-third-party-resource/">migration guide is</a> available). </li></ul></div><p>Source: <a href="https://habr.com/ru/post/332160/">https://habr.com/ru/post/332160/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../332138/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ269 (June 26 - July 2, 2017)</a></li>
<li><a href="../332140/index.html">Konstantin Krivopustov and Alexey Stukalov about the CUBA Platform on jug.msk.ru</a></li>
<li><a href="../332142/index.html">Game control models in the context of incomplete information</a></li>
<li><a href="../332144/index.html">LibGDX + Scene2d (we program on Kotlin). Part 0</a></li>
<li><a href="../332146/index.html">Redux business logic</a></li>
<li><a href="../332162/index.html">FinWin-2017: competition fintech projects and the latest trends in the banking sector</a></li>
<li><a href="../332164/index.html">Introduction to procedural animation</a></li>
<li><a href="../332166/index.html">We simulate device control with actor</a></li>
<li><a href="../332168/index.html">Three years of successful provision of public rental services of virtual machines with Apache CloudStack</a></li>
<li><a href="../332172/index.html">5 free assets for Unity3D, which will facilitate the development process</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>