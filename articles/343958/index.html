<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ÄúImg‚Äù evolution: Gif without GIF format</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="tl; dr 



- GIFs are cool, but in terms of quality and performance, they are terrible . 
- Replacing GIF with video good idea, but there are drawback...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>‚ÄúImg‚Äù evolution: Gif without GIF format</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bb3/a17/283/bb3a17283563bd27932e0750915bcb14.gif" alt="image"></div><br>  <b>tl; dr</b> <br><br><ul><li>  GIFs are cool, but in terms of quality and performance, they <i>are terrible</i> . </li><li>  Replacing GIF with <code>video</code> good idea, but there are drawbacks: they are <a href="https://calendar.perfplanet.com/2017/animated-gif-without-the-gif/">not preloaded</a> , they use range queries. </li><li>  Today you can use <code>img src =".mp4"</code> in the Safari Technology Preview. </li><li>  Preliminary results show that mp4s in tags are displayed <a href="https://calendar.perfplanet.com/2017/animated-gif-without-the-gif/">20 times faster and are decoded 7 times faster</a> than the GIF equivalent - in addition to the fact that the file size is 1/14! </li><li>  Background CSS videos and responsive videos can be a cool thing. </li><li>  Finally, sinegraphs will be without GIF flaws. </li><li>  Now we are waiting for other browsers to follow: this post weighs 46 MB on Chrome, and only 2 MB in Safari TP. </li></ul><br>  <i>Special thanks to: Eric Portis, Jack Noble, John Davis, Doron Sherman and Yoav Weiss.</i> <br><a name="habracut"></a><br><hr><br>  <em><font color="#999999">The translation was made with the support of the company <a href="https://www.edsd.ru/">EDISON Software</a> , which is professionally engaged in development for large customers, for example, <a href="https://www.edsd.ru/razrabotka-prilozhenij-i-sajtov-na-net-i-c">developed the client-side of GameStars for the game ‚ÄúLeague of Legends‚Äù</a> and <a href="https://www.edsd.ru/razrabotka-prilozhenij-i-sajtov-na-net-i-c">developed the component of displaying objects on a three-dimensional map on the Unity engine</a> , as well as created a service <s>for tracking</s> <a href="https://www.edsd.ru/razrabotka-sajtov-i-prilozhenij-na-python">analyzes about 200 online stores</a> (more than a million items).</font></em> <br><hr><br><h3>  Introduction </h3><br>  I both love and hate gif animations <img src="https://habrastorage.org/getpro/habr/post_images/fb3/7a0/bcb/fb37a0bcb50ade16dd0a49e69e860052.gif" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/f38/b1f/94d/f38b1f94ddd00b29e00a189d42c2b435.gif" alt="image"><br><br>  Safari TP radically changed the approach to them.  Now I love animated ‚Äúgif‚Äù. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/289/59e/4de/28959e4de450ba38b84fd11c5b058570.gif" alt="image"><br><br>  Animated GIFs are a feature.  Quote from <a href="http://www.w3.org/Graphics/GIF/spec-gif89a.txt">the GIF89a specification</a> : <br><br><blockquote>  The graphics exchange format is not intended as a platform for animation, although it can be organized with limitations. <br></blockquote><br>  But they became a cool tool for <a href="http://cinemagraphs.com/">sinegraphs</a> , <a href="https://giphy.com/search/memes/">memes</a> and <a href="https://www.youtube.com/watch%3Fv%3DvuxKb5mxM8g">creative expression</a> .  However, all this coolness is expensive.  Animated GIFs are terrible for web performance.  They are HUGE in size, affect cellular data, require more memory and processor performance, <a href="https://www.html5rocks.com/en/tutorials/speed/animated-gifs/">cause redrawing</a> and are battery killers.  As a rule, <a href="https://webkit.org/blog/6784/new-video-policies-for-ios/">GIF-files are 12 times larger than H.264 videos and eat 2 times more energy when loaded and displayed in the browser</a> .  And we spend all these resources on things that don't even look very good - GIF is limited to 256 colors, which often makes GIF files awful (although there are some <a href="https://gif.ski/">cool ways to get around</a> ). <br><br>  My daughter loves them, but she does not understand why her battery is always dead. <br><br>  GIFs have many advantages: they are requested immediately using the browser's preloader, they are automatically played and looped.  They are short.  <a href="https://wistia.com/blog/does-length-matter-it-does-for-video-2k12-edition">Market</a> <a href="https://dmakproductions.com/blog/what-is-the-ideal-length-for-web-video-production/">research has</a> shown that users have a higher level of interaction with them and usually prefer both short videos (&lt;1 minute) and sinegraphs (a photo on which minor repetitive movements occur) than longer videos and still images.  Animated GIFs are great for users to use directly. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/744/6ca/0c5/7446ca0c5797ef83c193ef0042ffe78f.gif" alt="image"><br><br>  So how did I come from love / hate for GIF to love for "Gifs"? <br><br>  In the latest Safari Tech Preview, thanks to the hard work of <a href="https://twitter.com/jernoble">Jer Nobl</a> , we can <a href="https://bugs.webkit.org/show_bug.cgi%3Fid%3D176825">use MP4 files</a> in tags.  The proposed example is not a long-format video, but a microformat, looping video without sound ‚Äî like a GIF.  Take a look for yourself: <br><br> <code>img src="rocky.mp4"</code> <br> <br><img src="https://habrastorage.org/getpro/habr/post_images/2a2/ffb/94e/2a2ffb94e6a7a7c7277a222a584bf464.gif" alt="image"><br><br>  Cool!  This will be useful In many areas - for business, for ease of use and especially for working on the Internet. <br><br><h3>  ... but we already have video tags </h3><br>  As <a href="https://rigor.com/blog/2015/12/optimizing-animated-gifs-with-html5-video">already</a> <a href="https://www.sohamkamani.com/blog/2016/04/09/stop-using-gifs/">noted</a> , using the <code>video</code> tag is much better for performance than using animated GIFs.  That is why in 2014, Twitter noticeably added <a href="http://mashable.com/2014/06/20/twitter-gifs-mp4/">animated GIF support</a> without adding GIF support.  Twitter instead recoded GIF to MP4 on the fly and showed them inside the <code>video</code> tags.  Since all browsers now support H.264, this was a very simple transition. <br><br><img src="https://habrastorage.org/webt/7g/qy/jb/7gqyjbarjmzssbayjn0bztlia3c.jpeg" alt="image"><br><br>  Transcoding animated GIFs to MP 4 is pretty straightforward.  You just need to run <code>ffmpeg -i source.gif output.mp4</code> <br><br>  However, not everyone can rebuild their CMS and convert <code>img</code> to <code>video</code> .  Even if it is possible, there are three problems with this method of delivering a GIF-like (Gif) microformat video: <br><br><h3>  1. Slow performance of the browser with the tag "video" </h3><br>  As <a href="httparchive.org/t/the-elephant-in-the-room-video/1087">Doug Sillars</a> recently pointed out <a href="httparchive.org/t/the-elephant-in-the-room-video/1087">in an HTTP Archive post</a> , there is a huge performance loss in a visual presentation using the <code>video</code> tag. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e2b/ecd/b1a/e2becdb1a64423312149dfc38b0b8cf9.png" alt="image"><br><br>  Unlike <code>img</code> tags, <a href="http://yoavweiss.github.io/preloader-velocity-nyc-talk/">browsers do not load</a> <code>video</code> content.  Usually, preloaders only preload JavaScript, CSS, and image resources, because they are crucial to the page layout.  Since the <code>video</code> content can be of any length - from microform to long form - the <code>video</code> tags are skipped until the main stream is ready to analyze its content.  This delays the loading of <code>video</code> content for many hundreds of milliseconds. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e44/895/577/e44895577b611329177080584ca74281.png" alt="image"><br><br>  For example, the video at the top of the <a href="https://conferences.oreilly.com/velocity/vl-ca">Velocity page</a> takes only 5 seconds to load the page.  This is the <a href="https://www.webpagetest.org/result/171201_S2_f4f9bb24f9308827f69a8f2d5ffe09fa/3/details/">27th most requested resource</a> , and even it is not completely downloaded until rendering starts after downloading web fonts. <br><br>  Worse, many browsers assume that <code>video</code> tags contain long format content.  Instead of downloading the entire video file immediately, which will waste your Internet traffic, even in cases when you don‚Äôt watch all the videos, the browser will first perform a 1-byte request to check if the server supports <a href="https://tools.ietf.org/html/rfc7233">HTTP Range requests</a> .  Then it will follow several range requests of different block sizes to ensure that the video will be adequately (but not too) buffered.  The result is multiple TCP transmissions before the browser even decodes the content and a significant delay before the user sees anything.  When using high latency cellular data, these round-trips can download videos of hundreds or thousands of milliseconds. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c47/4da/3ed/c474da3edc347d89146f8f56ee432ff6.png" alt="image"><br><br>  And what's even worse than the native <code>video</code> element?  Typical javascript video player.  Often the easiest way to embed videos on a site is to use a service such as YouTube or Vimeo, and avoid the difficulties of video encoding, hosting, and UX.  This is usually a great idea, but for microformat video or heavy content like video, it just adds a delay due to the javascript player and support for the resources that these hosting services introduce (css / js / jpg / woff).  In addition to <code>video</code> markup, you force the browser to download, evaluate, and execute the javascript player, and only after that the video can start downloading. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4f2/93b/4b7/4f293b4b77d62b742c9c232435229a72.png" alt="image"><br><br>  As many know, I love my Loki jacket because of its built-in sleeves, balaclava and hood, which is designed for helmets.  But take a look at the Loki USA home page, which uses a great video posted on Vimeo: <br><br> <a href="https://www.webpagetest.org/result/171201_M1_8c08554c16f8e3e6dfc378289105d5e5/1/details/"><img src="https://habrastorage.org/getpro/habr/post_images/5fa/82e/0fd/5fa82e0fd83356b1c717e8fc1453d205.png" alt="image"></a> <br><br> <a href="https://www.webpagetest.org/result/171201_M1_8c08554c16f8e3e6dfc378289105d5e5/1/details/"><img src="https://habrastorage.org/getpro/habr/post_images/6fe/f65/0b0/6fef650b0e9c87d5580e4e1ae4aebf71.gif" alt="image"></a> <br><br>  If you look closely, you will see that JavaScript for the player is actually requested shortly after the DOM download is complete.  But it does not load completely and is ready to launch the video stream much later. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/95b/26a/769/95b26a769ad9dfe740f812e3804e4705.png" alt="image"><br><br>  <a href="https://www.webpagetest.org/result/171201_M1_8c08554c16f8e3e6dfc378289105d5e5/1/details/">WPT Results</a> <br><br><h3>  2. You can not right-click and save video </h3><br>  The longest video content - Vlog, TV, movies - is provided via JavaScript-based players.  Usually, these players provide users with a convenient ‚Äúshare now‚Äù link or bookmark tool, so you can go back to YouTube (or anywhere) and find the video again.  In contrast, microformat content ‚Äî like memes and blue-graphs ‚Äî usually does not come through players, and users expect to be able to download GIFs and send them to friends, as they can with any image on the Internet.  This dancing cat's mame was funny - I have to share it with all my friends! <br><br>  If you use <code>video</code> tags to display micro-form videos, users will not be able to right-click, click and drag and save.  And their joy from the cat-dancer becomes a disappointing surprise for the UX. <br><br><h3>  3. Violation of autoplay </h3><br>  Finally, using <code>video</code> and MP4 tags instead of <code>img</code> and GIF tags leads you to the current cat-and-mouse game situation between browsers and unscrupulous ad vendors who abuse the <code>video autoplay</code> attribute to get users attention.  Historically, mobile browsers have ignored the attribute of autoplay and / or refused to play videos, requiring them to go into full-screen mode.  Over the past couple of years, <a href="https://webkit.org/blog/6784/new-video-policies-for-ios/">Apple</a> and <a href="https://blog.chromium.org/2017/09/unified-autoplay.html">Google have</a> relaxed their restrictions on embedded autoplay videos, allowing you to use Gif-like images with the <code>video</code> tag.  But again, ad networks misuse this, causing additional restrictions: if you want to auto-reproduce the <code>video</code> tags, you need to turn off the sound ( <code>muted</code> ) from the content or remove the audio track in it. <br><br><h3>  ... but we already have an animated WebP.  And animated PNG. </h3><br>  GIF format is not the only format that supports animation.  WebP and PNG also have animation support.  But, like GIF, they were not designed for animation and weighed significantly more compared to dedicated video codecs, such as H.264, H.265, VP9 and AV1. <br><br>  Animated PNG is now widely supported in all browsers, and while it also concerns the limitation of the color palette like GIF, it is still an inefficient file format for compressing video. <br><br>  Animated WebP is better, but compared to classic video formats it is still problematic.  In addition to having no accepted standard, the animated WebP lacks subsampling and wide-range support.  In addition, the support ecosystem is fragmented.  Not even all versions of Android, Chrome and Opera support animated WebP - even if these browsers talk about support using <code>Accept: image / webp</code> .  You need Chrome 42, Opera 15+ or Android 5+. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ff2/f82/d83/ff2f82d835c887b0816ed60a4809c3ac.png" alt="image"><br><br>  Thus, although animated WebP compression is much better than animated GIF or PNG, although we can do better.  (See Comparison of file sizes below.) <br><br><h3>  And eat fish and ... </h3><br>  By adding support for classic video formats (such as MP4) to be included in the tags <code>img</code> Safari Technology Preview fixed performance problems and UX.  Now our videos with microformats can be small and productive (for example, MP4, transferred using the <code>video</code> tag), and they can be easily uploaded, automatically launched and shared by it (for example, as with our old friend, GIF). <br><br> <code>img src="ottawa-river.mp4"</code> <br> <br>  So how much faster will it be?  Open the developer tools and see the difference between Safari Technology Preview and other browsers: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/257/077/9d6/2570779d6beaab8f31de1340073e95ea.gif" alt="image"><br><br>  Unfortunately, Safari does not work well with WebPageTest, and creating reliable test benchmarks is rather difficult.  Similarly, the use of Tech Preview is quite small, so comparing performance with RUM tools is not yet practical. <br><br>  However, we can do two things.  First, compare the size of the raw bytes, and second, use the <a href="https://html.spec.whatwg.org/multipage/embedded-content.html">Image.decode ()</a> rule to measure the impact of various resources on the device. <br><br><h3>  Memory saving </h3><br>  The first is saving memory.  For comparison, I recoded 100 popular animated gif images from <a href="https://giphy.com/">giphy.com</a> and then converted them to <a href="https://gist.github.com/colinbendell/2aeb9d09af45dbe26ccdf5842253238d">vp8 / vp9 / webp / h264 / h265.</a> <br><br><blockquote>  <b>NB</b> : These results should be considered only as superficial.  Each codec can be configured much better, as you can see that the result with vp9 is worse than with vp8.  It is necessary to conduct a more comprehensive study that takes into account SSIM. </blockquote><br><br>  Below are the <a href="https://docs.google.com/a/bendell.ca/spreadsheets/d/1T5dR6tDeKDsTi9_Xg93hljZPsX1WlBGCcJLr9acYhZ4/edit%3Fusp%3Dsharing">median (p50)</a> conversion <a href="https://docs.google.com/a/bendell.ca/spreadsheets/d/1T5dR6tDeKDsTi9_Xg93hljZPsX1WlBGCcJLr9acYhZ4/edit%3Fusp%3Dsharing">results</a> : <br><br><img src="https://habrastorage.org/webt/ip/w3/a6/ipw3a6ll8d_oydy9coqg0h6jysc.jpeg" alt="image"><br><br>  Yes, animated WebP is small, but any video format is much smaller.  This should not surprise anyone, since modern video codecs are highly optimized for streaming online video.  The H.265 algorithms are very good, as I expected, AV1 too. <br><br>  The benefits here are not only the transfer speed, but also the substantial <a href="https://whatdoesmysitecost.com/">$$</a> savings <a href="https://whatdoesmysitecost.com/">for end users</a> . <br><br>  Using video in <code>img</code> tags, it will load much faster with cellular communication. <br><br><h3>  Improved decoding and visual performance </h3><br>  Next, consider the effect of decoding and display effects on viewing.  H.264 (and H.265) has a significant advantage in that they use hardware decoding instead of using the main core. <br><br>  How can we measure it?  Since browsers have not yet implemented the proposed <a href="https://docs.google.com/document/d/1yRYfYR1DnHtgwC4HRR04ipVVhT1h5gkI6yPmKCgJkyQ/edit%3Fusp%3Dsharing">Hero image API</a> , we can use Steve Sauder‚Äôs <a href="https://speedcurve.com/blog/user-timing-and-custom-metrics/">User Timing and Custom Metric</a> strategy as a good comparison when the image begins to be displayed to the user.  It does not measure the frame rate, but tells you when the first frame is displayed.  We can also use the recently adopted <a href="https://html.spec.whatwg.org/multipage/embedded-content.html">Image.decode () convention</a> to measure decoding performance.  On the test page below, I add a unique GIF and MP4 in the <code>img</code> tag 100 times and compare the decoding and rendering performance. <br><br> <code>let image = new Image; <br> t_startReq = new Date().getTime(); <br> document.getElementById("testimg").appendChild(image); <br> image.onload = timeOnLoad; <br> image.src = src; <br> return image.decode().then(() =&gt; { resolve(image); });</code> <br> <br>  The results are impressive.  Even on my powerful MacBook Pro 2017 running locally, without connecting to the network, we see that GIF files take 20 times longer than MP4 to draw the first frame (signaled by the <code>onload</code> ), and 7 times more for decoding . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0bf/8b9/420/0bf8b94208c97da79443d073fc63ace5.png" alt="image"><br><br>  Surprised?  <a href="https://github.com/colinbendell/gif_perf_test">Copy the repository</a> and check it out.  I note that the addition of network transmission conditions for GIF and, accordingly, MP4 will disproportionately distort the test results.  In particular, since decoding can begin before the end of the last byte, the delta between transmission, mapping and decoding becomes much smaller.  In fact, this suggests that only saving memory by itself will significantly improve user experience.  However, if you exclude a network connection, as I did when running localhost, you can see that using video has significant performance advantages. <br><br><h3>  How can you realize this? </h3><br>  So now that Safari Technology Preview supports this design pattern, but how can you use it without displaying corrupted images on unsupported browsers?  Good news!  It is relatively easy. <br><br><h3>  Option 1: Use responsive images </h3><br>  Ideally, the easiest way is to use the <code>source type</code> attribute of the HTML5 <code>picture</code> tag. <br><br><img src="https://habrastorage.org/webt/ox/x3/lv/oxx3lvyyusdthr6fymhbemnljja.jpeg" alt="image"><br><br>  I would like to say that we can stop at this.  However, there is a <a href="https://bugs.webkit.org/show_bug.cgi%3Fid%3D179231">nasty WebKit error</a> in Safari that causes the preloader to load the first <code>source</code> regardless of the mimetype declaration.  The main DOM loader will recognize the error and select the correct source.  However, the damage will already be done.  Preloader loses the ability to load the image earlier, and, moreover, loads the wrong version, losing bytes.  The good news is that I fixed this error, and the fix should appear in Safari TP 45. <br><br>  In short, using the <code>picture</code> and <code>source type</code> to select the mime type is not recommended unless the next version of Safari is installed on 90% + users. <br><br><h3>  Option 2. Use MP4, animated WebP and Fallback for GIF </h3><br>  If you do not want to change the HTML markup, you can use HTTP to send MP4 to Safari with content negotiation.  To do this, you must create multiple copies of your bluegraphs (as before) and <code>Vary</code> responses in the <code>Accept</code> and <code>User-Agent</code> headers. <br><br>  This will be a bit cleaner if <a href="https://bugs.webkit.org/show_bug.cgi%3Fid%3D179178">WebKit BUG 179178</a> is resolved and you can add a test for the <code>Accept: video / *</code> header (for example, you can check <code>Accept: image / webp</code> ).  But the end result is that each browser gets the best format for <code>img</code> video based on microformat, which it supports: <br><br><img src="https://habrastorage.org/webt/ga/t8/ni/gat8ni4sg-5yfmegxcl2rphaemu.jpeg" alt="image"><br><br>  In nginx it would look something like this: <br><br> <code>map $http_user_agent $mp4_suffix { <br> default ""; <br> "~*Safari/605" ".mp4"; <br> } <br> <br> location ~* .(gif)$ { <br> add_header Vary Accept; <br> try_files $uri$mp4_suffix $uri =404; <br> }</code> <br> <br>  Of course, don't forget to specify <code>Vary: Accept, User-Agent</code> , to tell proxy providers and CDNs to cache each response differently.  In fact, you should mark Cache-Control as private and use TLS to ensure that less complex ISP Proxy servers do not cache content. <br><br><img src="https://habrastorage.org/webt/ox/td/kw/oxtdkwfrpqeeteaplkdbmwvlkde.jpeg" alt="image"><br><br><h3>  Option 3: use RESS and ‚Äúvideo‚Äù tag </h3><br>  If you can manipulate your HTML, you can apply the Responsive-server-side (RESS) technology.  This option translates browser detection logic into your HTML output. <br><br>  For example, you can do this with PHP: <br><br><img src="https://habrastorage.org/webt/f0/cw/fo/f0cwfox1dqan4_mdmpmir7e7jfm.jpeg" alt="image"><br><br>  As above, do not forget to fix the <code>Vary: User-Agent</code> header to inform your CDN that there are different versions of your HTML for caching.  Some CDNs automatically evaluate Vary headers, while others can support it with a simple CDN configuration update. <br><br><h3>  Bonus: do not forget to remove the audio track </h3><br>  Now, since you are not converting GIF to MP4, but rather converting MP4 to GIF, we also need to remember to remove the audio track to save memory.  (Please tell me that you are not using GIF as a source. Correct.) Audio tracks take extra bytes in the file size, which we can simply free up, since we know that it will play without sound in any case.  The easiest way with ffmpeg: <br><br> <code>ffmpeg -i cats.mp4 -vcodec copy -an cats.mp4</code> <br> <br><h3>  Is there a size limit </h3><br>  When I write this, Safari will blindly download all the videos you specify on the <code>img</code> tag, no matter how long it takes.  On the one hand, this is expected because it helps improve browser performance.  However, it can be stupid if you force the user to load a 120-minute video.  I tested videos of different sizes, and they were all uploaded while the user was browsing the site.  So be kind to the users.  If you want to add a longer video, use the <code>video</code> tag to improve performance. <br><br><h3>  What's next.  Adaptive videos and background videos </h3><br>  Now that we can post MP4 via <code>img</code> tags, the doors open for many new uses.  Two of which come to mind: adaptive video and background video. ,     MP4  <code>srcsets</code> ,       Client Hints  Content-DPR,      <code>image media</code> ,    . <br><br><img src="https://habrastorage.org/webt/ez/5s/fk/ez5sfkny0di4pjspsdcxz1gu9mu.jpeg" alt="image"><br><br>   CSS <code>background-image: url (.mp4)</code>  . <br><br><img src="https://habrastorage.org/webt/4k/jf/er/4kjfer3uom3d9_qjr-11ajqasc0.jpeg" alt="image"><br><br><h3>  Conclusion </h3><br>     <code>img</code> , Safari Technology Preview     GIF- , <i></i>    ,   GIF.      , ,     .  ,    ,       ,    -      .  ,       . Google? Microsoft? Mozilla? Samsung?  . </div><p>Source: <a href="https://habr.com/ru/post/343958/">https://habr.com/ru/post/343958/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../343948/index.html">Show, tutorial, reference book and contract: announcement of the free YouTube-broadcast Heisenbug 2017 Moscow</a></li>
<li><a href="../343950/index.html">5 arguments in favor of a box PBX</a></li>
<li><a href="../343952/index.html">Douglas Crockford, Azat Mardan, Vitaly Friedman and all-all-all: the announcement of the free YouTube-broadcast HolyJS 2017 Moscow</a></li>
<li><a href="../343954/index.html">Explanation of SNARKs. From calculations to polynomials, the Pinocchio protocol and the pairing of elliptic curves (translation)</a></li>
<li><a href="../343956/index.html">How to calculate ROI when deploying Office 365 using a ROI calculator</a></li>
<li><a href="../343960/index.html">Configuring DTO Validation in the Spring Framework</a></li>
<li><a href="../343962/index.html">Agile Kitchen office Tutu.ru</a></li>
<li><a href="../343964/index.html">ASO Monthly # 18 October 2017</a></li>
<li><a href="../343966/index.html">SOLID principles in action: from Slack to Twilio</a></li>
<li><a href="../343968/index.html">Productivity of unloading a large amount of data from Mongo to ASP.NET Core Web Api</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>