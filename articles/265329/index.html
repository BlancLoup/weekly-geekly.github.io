<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Install and configure the generation of tiles based on OSM data under Windows</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Disclaimer 
 Recently, the task of generating tiles based on OSM data arose. I looked for, read a few articles , but * nix-systems appeared everywhere...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Install and configure the generation of tiles based on OSM data under Windows</h1><div class="post__text post__text-html js-mediator-article"><h3>  Disclaimer </h3><br>  Recently, the task of generating tiles based on OSM data arose.  I looked for, read a <a href="http://switch2osm.org/serving-tiles/manually-building-a-tile-server/">few</a> <a href="http://habrahabr.ru/post/144675/">articles</a> , but * nix-systems appeared everywhere, and I had a server running Windows.  In the end, a more or less intelligible tutorial was found, but it is slightly outdated and not always detailed, therefore, I had to tinker.  After successful completion, I thought that my experience would be useful. <br><br>  Who are interested, please under the cat. <br><a name="habracut"></a><br><h3>  Introductory </h3><br>  Installation was made on clean Windows 7 and 8.1, without any software.  It will take the following: <br><ul><li>  PostgreSQL (used 9.4.4) - DB for storing geoinformation from OSM dump. </li><li>  PostGIS (used 2.1) is an extension of the database for working with geo-information. </li><li>  Osm2pgsql is a utility for importing OSM dump of data into the database. </li><li>  Mapnik (used 2.2.0) is a utility for generating tiles. </li></ul><br>  You will also need additional tools, without which, however, nothing will come of it: <br><ul><li>  Patch for GiST indexes in PostGIS </li><li>  Python 2.x (used 2.7.10) - scripts generating tiles are written on it. </li><li>  PROJ.4 - a library of cartographic projections. </li><li>  SVN-client (used TortoiseSVN) - to download OSM tile generation scripts, see below. </li><li>  OSM generation scripts (used revision 31519) </li><li>  OSM info: coastline and all that. </li></ul><br><h3>  1. Install and Configure PostgreSQL </h3><br>  Distribution can be taken from <a href="http://www.enterprisedb.com/products-services-training/pgdownload">offsite</a> .  Installation is quite trivial, however, there are a couple of moments. <br><br>  First, it may be necessary to change the directory where the database is stored (it may take up to a terabyte if OSM data is used for the entire planet).  The default (for version 9.4) is <code>C:\Program Files\PostgreSQL\9.4\data</code> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Secondly, it is possible that the cluster locale should be changed.  In my case in <code>Russian, Russia</code> .  When installing, you will also be asked for the password for the PostgreSQL server, you will need it, remember it. <br><br>  After installing PostgreSQL itself, it will start StackBuilder, the installation wizard for database extensions.  You need to choose two extensions: Spatial Extensions -&gt; PostGIS and Database Drivers -&gt; JDBC.  All settings at the default setting.  During the installation of PostGIS there will be a request to create a system variable and a couple more questions, agree.  After that, you need to restart the PostgreSQL service. <br><br>  Next, add the <code>bin</code> PostgreSQL directory to <code>PATH</code> .  After adding, you need to log out and log in again (logoff-login) for the settings to be applied. <br><br>  We check the correctness of the installation, you will need to remember the password that you entered during the installation phase.  We find in programs pgAdmin III and we start.  In the list of servers will be the only <code>localhost:5432</code> , connect.  If it fails, most likely the service is not running. <br><br>  Create a template for the geodatabase: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> template_postgis_20 <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ENCODING</span></span>=<span class="hljs-string"><span class="hljs-string">'UTF8'</span></span> OWNER=postgres <span class="hljs-keyword"><span class="hljs-keyword">CONNECTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span>=<span class="hljs-number"><span class="hljs-number">-1</span></span> LC_COLLATE = <span class="hljs-string"><span class="hljs-string">'Russian_Russia.1251'</span></span> LC_CTYPE = <span class="hljs-string"><span class="hljs-string">'Russian_Russia.1251'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLESPACE</span></span>=pg_default;</code> </pre><br>  Add two extensions to the template: <code>postgis</code> and <code>postgis_topology</code> .  Disconnect from this database. <br><br>  Create a <code>gis</code> database based on the template_postgis_20 <code>template_postgis_20</code> : <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> gis <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> OWNER = postgres <span class="hljs-keyword"><span class="hljs-keyword">ENCODING</span></span> = <span class="hljs-string"><span class="hljs-string">'UTF8'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TEMPLATE</span></span> = template_postgis_20 <span class="hljs-keyword"><span class="hljs-keyword">TABLESPACE</span></span> = pg_default LC_COLLATE = <span class="hljs-string"><span class="hljs-string">'Russian_Russia.1251'</span></span> LC_CTYPE = <span class="hljs-string"><span class="hljs-string">'Russian_Russia.1251'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONNECTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> = <span class="hljs-number"><span class="hljs-number">-1</span></span>;</code> </pre><br>  Take the patch for PostGIS GiST <a href="">from here</a> .  Command line patch: <br><pre> <code class="dos hljs"><span class="hljs-function"><span class="hljs-function">C:\</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Users</span></span></span><span class="hljs-function">\</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">red</span></span></span><span class="hljs-function">&gt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">psql</span></span></span><span class="hljs-function"> -</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">U</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">postgres</span></span></span><span class="hljs-function"> -</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">d</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gis</span></span></span><span class="hljs-function"> -</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">legacy</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">postgis</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gist.sql</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CREATE</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OPERATOR</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CLASS</span></span></span></span></code> </pre><br>  The database is ready. <br><br><h3>  2. Install and configure Osm2pgsql </h3><br>  You can take the latest release from the <a href="https://github.com/openstreetmap/osm2pgsql">githaba</a> and collect it yourself, or you can take a ready-made artifact <a href="https://vanguard.houghtonassociates.com/browse/OSM-OSM2PSQL-95/artifact">from here</a> . <br><br>  Download, unpack, rename for convenience in <code>osm2pgsql</code> .  Add this directory to the <code>PATH</code> variable.  Logoff-login.  We check that everything works: <br><pre> <code class="dos hljs"><span class="hljs-function"><span class="hljs-function">C:\</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Users</span></span></span><span class="hljs-function">\</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">red</span></span></span><span class="hljs-function">&gt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">osm2pgsql</span></span></span><span class="hljs-function"> -</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">h</span></span></span></span></code> </pre><br>  Help should be displayed.  Take the last <code>default.style</code> from the github repository. <br><br>  Everything is ready to import OSM data. <br><br>  Map of the planet in compressed form weighs ~ 40 GB.  For example, you can take a map of Moscow, for example, <a href="http://gis-lab.info/projects/osm_dump/">from here</a> .  Download <br><br>  For import, execute on the command line: <br><pre> <code class="dos hljs"><span class="hljs-function"><span class="hljs-function">C:\</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Users</span></span></span><span class="hljs-function">\</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">red</span></span></span><span class="hljs-function">&gt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">osm2pgsql</span></span></span><span class="hljs-function"> -</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">d</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gis</span></span></span><span class="hljs-function"> -</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">U</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">postgres</span></span></span><span class="hljs-function"> -</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">W</span></span></span><span class="hljs-function"> -</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">H</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">localhost</span></span></span><span class="hljs-function"> -</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">P</span></span></span><span class="hljs-function"> 5432 -</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">s</span></span></span><span class="hljs-function"> -</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SC</span></span></span><span class="hljs-function">:\</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">osm2pgsql</span></span></span><span class="hljs-function">\</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">default.style</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RU</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MOW.osm.pbf</span></span></span></span></code> </pre><br>  The <code>-s</code> , i.e.  slim - the mode in which temporary data is stored in the database.  This slows down the process, increases disk usage, but reduces the use of RAM. <br><br>  If everything is correct, there will be a password request and the dump will be imported into the database.  The first lines will be all sorts of warnings, do not worry, everything is in order.  After the import is complete, something like this will be displayed: <br><pre> <code class="dos hljs">Osm2pgsql took <span class="hljs-number"><span class="hljs-number">160</span></span>s overall</code> </pre><br>  Geodata in the database. <br><br><h3>  3. Installing Python 2.x </h3><br>  Download the x86 distribution (because Mapnik binaries for Windows are only x86) <a href="https://www.python.org/downloads/release/python-2710/">from here</a> .  We put, the default settings, except for one: It is worth noting "Add python.exe to PATH", or make it handles after installation.  Logoff-login. <br><br>  Check the installation is correct: <br><pre> <code class="dos hljs"><span class="hljs-function"><span class="hljs-function">C:\</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Users</span></span></span><span class="hljs-function">\</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">red</span></span></span><span class="hljs-function">&gt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">python</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Python</span></span></span><span class="hljs-function"> 2.7.10 (</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">default</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">May</span></span></span><span class="hljs-function"> 23 2015, 09:40:32) [</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MSC</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">v</span></span></span><span class="hljs-function">.1500 32 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bit</span></span></span><span class="hljs-function"> (</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Intel</span></span></span><span class="hljs-function">)] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">win32</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Type</span></span></span><span class="hljs-function"> "</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">help</span></span></span><span class="hljs-function">", "</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copyright</span></span></span><span class="hljs-function">", "</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">credits</span></span></span><span class="hljs-function">" </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">or</span></span></span><span class="hljs-function"> "</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">license</span></span></span><span class="hljs-function">" </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">more</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">information</span></span></span><span class="hljs-function">. &gt;&gt;&gt;</span></span></code> </pre><br>  Python is ready. <br><br><h3>  4. Install and configure Mapnik </h3><br>  Again, there are two options: either compile from the <a href="https://github.com/mapnik/mapnik">github</a> source <a href="https://github.com/mapnik/mapnik">itself</a> , or take ready-made binaries <a href="http://mapnik.org/pages/downloads.html">here</a> .  We are looking for <code>Windows 32 bit Package</code> , download, unpack in <code>C:\mapnik-v2.2.0</code> . <br><br>  They have a pretty detailed installation guide on the <a href="https://github.com/mapnik/mapnik/wiki/WindowsInstallation">wiki</a> .  In short: add <code>lib</code> and <code>bin</code> directories to the map in <code>PATH</code> , this time.  Create a new system variable <code>PYTHONPATH</code> and assign it the path to <code>C:\mapnik-v2.2.0\python\2.7\site-packages</code> , these are two.  Put this <a href="http://www.microsoft.com/en-us/download/details.aspx%3Fid%3D5555">vcredist</a> , it's three.  Logoff-login. <br><br>  Check the installation is correct: <br><pre> <code class="dos hljs"><span class="hljs-function"><span class="hljs-function">C:\</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Users</span></span></span><span class="hljs-function">\</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">red</span></span></span><span class="hljs-function">&gt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">python</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Python</span></span></span><span class="hljs-function"> 2.7.10 (</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">default</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">May</span></span></span><span class="hljs-function"> 23 2015, 09:40:32) [</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MSC</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">v</span></span></span><span class="hljs-function">.1500 32 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bit</span></span></span><span class="hljs-function"> (</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Intel</span></span></span><span class="hljs-function">)] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">win32</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Type</span></span></span><span class="hljs-function"> "</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">help</span></span></span><span class="hljs-function">", "</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copyright</span></span></span><span class="hljs-function">", "</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">credits</span></span></span><span class="hljs-function">" </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">or</span></span></span><span class="hljs-function"> "</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">license</span></span></span><span class="hljs-function">" </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">more</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">information</span></span></span><span class="hljs-function">. &gt;&gt;&gt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">import</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mapnik</span></span></span><span class="hljs-function"> &gt;&gt;&gt;</span></span></code> </pre>  Possible errors are parsed on the wiki.  But besides that, it is worth trying to move the paths to <code>lib</code> and <code>bin</code> to the top of the <code>PATH</code> . <br><br>  And gene test tiles: <br><pre> <code class="dos hljs"><span class="hljs-function"><span class="hljs-function">C:\</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Users</span></span></span><span class="hljs-function">\</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">red</span></span></span><span class="hljs-function">&gt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cd</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">C</span></span></span><span class="hljs-function">:\</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mapnik</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">v2</span></span></span><span class="hljs-function">.2.0\</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">demo</span></span></span><span class="hljs-function">\</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">python</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">C</span></span></span><span class="hljs-function">:\</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mapnik</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">v2</span></span></span><span class="hljs-function">.2.0\</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">demo</span></span></span><span class="hljs-function">\</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">python</span></span></span><span class="hljs-function">&gt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">python</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rundemo.py</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Pycairo</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">available</span></span></span><span class="hljs-function">... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">render</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Cairo</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">formats</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">using</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">alternative</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">method</span></span></span><span class="hljs-function"> 12 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maps</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">have</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">been</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rendered</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">in</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">directory</span></span></span><span class="hljs-function">: - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">demo.png</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">demo256.png</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">demo64_binary_transparency.png</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">demo128_colors_hextree_no_alpha.png</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">demo_high.jpg</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">demo_low.jpg</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">demo.tif</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">demo.pdf</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">demo.ps</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">demo.svg</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">demo_cairo_rgb.png</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">demo_cairo_argb.png</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Have</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">look</span></span></span><span class="hljs-function">!</span></span></code> </pre><br>  Almost all. <br><br>  Go to the githab, find the <a href="https://github.com/OSGeo/proj.4/wiki">PROJ.4</a> library, find the binaries: <code>Prebuilt Win32 executables, DLL including NAD27 grid shift files</code> .  Download, unpack ( <code>c:\proj</code> ).  In <code>PATH</code> add the path to <code>bin</code> , to the new variable <code>PROJ_LIB</code> path to <code>nad</code> .  Logoff-login. <br><br>  A bit more. <br><br>  Download scripts to generate tiles from the official <a href="http://svn.openstreetmap.org/applications/rendering/mapnik">svn repository</a> , put in <code>c:\mapnik</code> . <br><br>  Further, for the operation of the script we need coastlines and all that.  There is a <code>get-coastlines.sh</code> script for <code>get-coastlines.sh</code> , but it is written in bash and under Windows will not work.  But it is quite simple and short, so just repeat all the actions with handles. <br><br>  Download: <br><ul><li>  <a href="">Time</a> </li><li>  <a href="">Two</a> </li><li>  <a href="">Three</a> </li><li>  <a href="http://www.naturalearthdata.com/">Four</a> </li><li>  <a href="http://www.naturalearthdata.com/">Five</a> </li></ul>  We unpack all archives in a directory in <code>c:\mapnik\world_boundaries</code> . <br><br>  Last preparations.  Go to <code>mapnik\inc</code> , rename the <code>settings.xml.inc.template</code> file to <code>settings.xml.inc</code> . <br><br>  The <code>fontset-settings.xml.inc.template</code> file in <code>fontset-settings.xml.inc</code> . <br><br>  The <code>datasource-settings.xml.inc.template</code> file is in <code>datasource-settings.xml.inc</code> and edit it: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Parameter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"type"</span></span></span><span class="hljs-tag">&gt;</span></span>postgis<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Parameter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Parameter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"password"</span></span></span><span class="hljs-tag">&gt;</span></span>password<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Parameter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Parameter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"host"</span></span></span><span class="hljs-tag">&gt;</span></span>localhost<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Parameter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Parameter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"port"</span></span></span><span class="hljs-tag">&gt;</span></span>5432<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Parameter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Parameter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"user"</span></span></span><span class="hljs-tag">&gt;</span></span>postgres<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Parameter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Parameter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dbname"</span></span></span><span class="hljs-tag">&gt;</span></span>gis<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Parameter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Parameter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"estimate_extent"</span></span></span><span class="hljs-tag">&gt;</span></span>false<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Parameter</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Fix the <code>generate_tiles.py</code> script a bit: <br>  Block on line 193: <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">"__main__"</span></span>: home = os.environ[<span class="hljs-string"><span class="hljs-string">'HOME'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: mapfile = os.environ[<span class="hljs-string"><span class="hljs-string">'MAPNIK_MAP_FILE'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> KeyError: mapfile = home + <span class="hljs-string"><span class="hljs-string">"/svn.openstreetmap.org/applications/rendering/mapnik/osm-local.xml"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: tile_dir = os.environ[<span class="hljs-string"><span class="hljs-string">'MAPNIK_TILE_DIR'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> KeyError: tile_dir = home + <span class="hljs-string"><span class="hljs-string">"/osm/tiles/"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> tile_dir.endswith(<span class="hljs-string"><span class="hljs-string">'/'</span></span>): tile_dir = tile_dir + <span class="hljs-string"><span class="hljs-string">'/'</span></span></code> </pre>  replace with <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">"__main__"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: mapfile = os.environ[<span class="hljs-string"><span class="hljs-string">'MAPNIK_MAP_FILE'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> KeyError: print(<span class="hljs-string"><span class="hljs-string">'MAPNIK_MAP_FILE env var not found! Use default.'</span></span>) mapfile = <span class="hljs-string"><span class="hljs-string">'C:/mapnik/osm.xml'</span></span> <span class="hljs-comment"><span class="hljs-comment"># - try: tile_dir = os.environ['MAPNIK_TILE_DIR'] except KeyError: print('MAPNIK_TILE_DIR env var not found! Use default.') tile_dir = 'C:/tiles/' # - if not tile_dir.endswith('/'): tile_dir = tile_dir + '/'</span></span></code> </pre><br>  Specify the boundaries in which tiles will be generated (geographic coordinates of the rectangle): <br><br>  On line 213 before <br><pre> <code class="python hljs"> bbox = (<span class="hljs-number"><span class="hljs-number">-180.0</span></span>,<span class="hljs-number"><span class="hljs-number">-90.0</span></span>, <span class="hljs-number"><span class="hljs-number">180.0</span></span>,<span class="hljs-number"><span class="hljs-number">90.0</span></span>) render_tiles(bbox, mapfile, tile_dir, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-string"><span class="hljs-string">"World"</span></span>)</code> </pre>  write (in our case Moscow) <br><pre> <code class="python hljs"> bbox = (<span class="hljs-number"><span class="hljs-number">37.32</span></span>, <span class="hljs-number"><span class="hljs-number">55.57</span></span>, <span class="hljs-number"><span class="hljs-number">37.88</span></span>, <span class="hljs-number"><span class="hljs-number">55.92</span></span>) render_tiles(bbox, mapfile, tile_dir, <span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-string"><span class="hljs-string">"Moscow"</span></span>) exit() <span class="hljs-comment"><span class="hljs-comment"># ,       </span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Tips &amp; Tricks</b> <div class="spoiler_text">  Border coordinates are taken from the osm file from which the data is taken (they will be at the very beginning).  Due to the fact that the data file can be very large, you can‚Äôt open it with a regular text editor, I advise you to use editors like EmEditor (paid) or set yourself grep. <br></div></div><br>  Specify the path and start generating tiles: <br><pre> <code class="dos hljs"><span class="hljs-function"><span class="hljs-function">C:\</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mapnik</span></span></span><span class="hljs-function">&gt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generate_tiles.py</span></span></span></span></code> </pre><br>  The process should go. <br>  It takes from several minutes to weeks (in the case of the whole world and not the most powerful machine). <br><br><h3>  Links </h3><br>  0. <a href="http://softwaresimian.com/2012/12/02/openstreetmap-osm-install-on-windows-part-i-the-database/">softwaresimian.com/2012/12/02/openstreetmap-osm-install-on-windows-part-i-the-database</a> <br>  1. <a href="http://switch2osm.org/serving-tiles/manually-building-a-tile-server/">switch2osm.org/serving-tiles/manually-building-a-tile-server</a> <br>  2. <a href="https://wiki.openstreetmap.org/wiki/PostGIS/Installation">wiki.openstreetmap.org/wiki/PostGIS/Installation</a> <br>  3. <a href="https://wiki.openstreetmap.org/wiki/Osm2pgsql">wiki.openstreetmap.org/wiki/Osm2pgsql</a> <br>  4. <a href="https://wiki.openstreetmap.org/wiki/Creating_your_own_tiles">wiki.openstreetmap.org/wiki/Creating_your_own_tiles</a> <br>  5. <a href="http://habrahabr.ru/post/144675/">habrahabr.ru/post/144675</a> <br>  6. <a href="http://habrahabr.ru/post/203212/">habrahabr.ru/post/203212</a> <br>  7. Data Russification: <a href="http://habrahabr.ru/post/259141/">habrahabr.ru/post/259141</a> </div><p>Source: <a href="https://habr.com/ru/post/265329/">https://habr.com/ru/post/265329/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../265319/index.html">Requests in CoreData with aggregate functions and grouping in one line</a></li>
<li><a href="../265321/index.html">Generators of discretely distributed random variables</a></li>
<li><a href="../265323/index.html">Numeric types and C ++ containers in terms of performance</a></li>
<li><a href="../265325/index.html">Linux Piter Conference Announcement</a></li>
<li><a href="../265327/index.html">Distributed cron and batch scheduler in a Prun cluster</a></li>
<li><a href="../265335/index.html">Underground carders market. Translation of the book "KingPIN". Chapter 9. "Opportunities"</a></li>
<li><a href="../265337/index.html">Writing API documentation with RAML</a></li>
<li><a href="../265339/index.html">Free Self-learning Library - more than 20 courses in key areas of Software Engineering</a></li>
<li><a href="../265341/index.html">Results of the campaign "I want ThinkServer", the first report</a></li>
<li><a href="../265343/index.html">Five reasons to try the new release of Intel Media Server Studio 2015 R6</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>