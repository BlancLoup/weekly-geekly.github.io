<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing your XML parser</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Prehistory 
 Having decided to run a small service on the hosting I was given, it turned out that there is not a single xml parser there: neither Simp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Writing your XML parser</h1><div class="post__text post__text-html js-mediator-article"><h1>  Prehistory </h1><br><img src="https://habrastorage.org/getpro/habr/olpictures/a57/f61/c65/a57f61c6530b5f9253902b0e403220f6.png" width="110" height="125" hspace="10" vspace="10" align="right">  Having decided to run a small service on the hosting I was given, it turned out that there is not a single xml parser there: neither SimpleXML, nor DOMXML, but only libxml and xml-rpc.  Without thinking twice, I decided to write my own.  I needed to parse non-complex rss feeds, so the xml =&gt; array class was enough.  <sup><a href="https://habr.com/ru/post/30353/">[one]</a></sup> <br><br>  But for an interesting article this was clearly not enough, so now we will write our replacement for SimpleXML.  And at the same time let's go over the many interesting features of PHP 5. <br><br><h1>  Formulation of the problem </h1><br>  Access to the elements will be provided as access to the properties of the class, for example, <font><font color="darkred">$ xml-&gt;</font> element</font> , and access to the attributes of the element as an array, those <font><font color="darkred">$ xml-&gt;</font> element [ <font color="darkgreen">'attr'</font> ]</font> , also implements the check for the existence of an attribute using <font><font color="blue">isset</font> ()</font> and iterate over elements using <font color="blue">foreach</font> .  So, let's begin. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  A little bit of magic? </h1><br>  In PHP 5, some 'magic' methods are defined for the classes, they begin with a double underscore '__' and are called when a certain action originates.  <sup><a href="https://habr.com/ru/post/30353/">[2]</a></sup> We will need the following: <br><ul><li>  <font><font color="blue">void</font> __construct ([ <font color="blue">mixed</font> <font color="darkred">$ args</font> [, <font color="darkred">$ ...</font> ]])</font> is the most famous magic method, called after the class has been created by the <font color="blue">new</font> operator. </li><li>  <font><font color="blue">mixed</font> __get ( <font color="darkred">$ name</font> )</font> - called when accessing properties of a class if the corresponding field was not found, for example, <font><font color="darkred">$ obj-&gt;</font> element</font> will call <font>__get ( <font color="darkgreen">'element'</font> )</font> if <font>element has</font> not been declared as a class field. </li><li>  <font><font color="blue">void</font> __set ( <font color="darkred">$ name</font> , <font color="darkred">$ value</font> )</font> - accordingly it is called when the class property changes, for example, <font><font color="darkred">$ obj-&gt;</font> element = <font color="darkred">$ some_var</font></font> will call <font>__set ( <font color="green">'element'</font> , <font color="darkred">$ some_var</font> )</font> . </li><li>  <font><font color="blue">string</font> __toString ()</font> - called on any operation on a class, as on a string, say <font><font color="blue">echo</font> <font color="darkred">$ obj</font></font> or <font>strval ( <font color="darkred">$ obj</font> )</font> .  We need this method to get the content of the item.  Unfortunately, there are no methods for returning a non-string, so in order to convert an element into a number, you have to do this: <font>intval (strval ( <font color="darkred">$ obj</font> ))</font> . </li></ul><br><br><h1>  SPL </h1><br>  Standard PHP Library - the standard PHP library, like <abbr title="Standard Template Library">STL</abbr> from the world of C ++, was created in order to provide the developer with tools for solving typical problems.  <sup><a href="https://habr.com/ru/post/30353/">[3]</a></sup> <br>  We will need to implement the following interfaces: <br><ul><li>  ArrayAccess - to access the class as an array, for example, <font><font color="darkred">$ obj</font> [ <font color="darkgreen">'name'</font> ]</font> or <font>isset ( <font color="darkred">$ obj</font> [ <font color="darkgreen">'name'</font> ])</font> . </li><li>  IteratorAggregate - to enable iteration over the class using <font color="blue">foreach</font> . </li><li>  Countable - to find out the number of descendants of the item. </li></ul><br><br><h1>  XML and expat </h1><br>  These are standard libraries for working with XML and creating XML parsers.  <sup><a href="https://habr.com/ru/post/30353/">[4]</a></sup> What is needed to solve our problem.  For the sake of interest, you can write an analysis of the xml-file manually, for example, on regular expressions. <br>  Most of all in expat we are interested in the following functions: <br><ul><li>  <font><font color="blue">bool</font> xml_set_element_handler ( <font color="blue">resource</font> <font color="darkred">$ parser</font> , <font color="blue">callback</font> <font color="darkred">$ start_element_handler</font> , <font color="blue">callback</font> <font color="darkred">$ end_element_handler</font> )</font> - sets the functions called when the open and closed tags are found, respectively. </li><li>  <font><font color="blue">bool</font> xml_set_character_data_handler ( <font color="blue">resource</font> <font color="darkred">$ parser</font> , <font color="blue">callback</font> <font color="darkred">$ handler</font> )</font> - calls the function, passing it the character content of the element, and even if nothing was there, it is still called. </li></ul><br>  Note: <abbr title="Callback function"><font>callback</font></abbr> in php is either the name of the function passed as a string, or an array with two values ‚Äã‚Äã- the first is the name of the class, and the second is the name of the method of this class. <br><br><h1>  Pointers </h1><br>  Pointers in PHP do not quite work as they do in C or C ++.  <sup><a href="https://habr.com/ru/post/30353/">[5]</a></sup> Actually, the <font color="darkred">$ a</font> = &amp; <font color="darkred">$ b</font> construction only means that now <font color="darkred">$ a</font> points to the same area with data as <font color="darkred">$ b</font> , and it‚Äôs impossible to change the address where <font color="darkred">$ b</font> points through <font color="darkred">$ a,</font> it‚Äôs possible to say that address change has one nesting level. <br>  Starting with the fifth version, in PHP all variables are passed to the function by pointer, but as soon as you change its value, memory is allocated for a new one.  In our case, pointers are useful for pointing to the parent element. <br><br><h1>  Coding </h1><br>  With the theory finished, now we will start directly writing of the parser. <br>  Each object will represent a single xml element, so it will need properties such as tag name, attributes, data, a reference to the parent, and an array with descendants, in addition, you will need a pointer variable to the current element.  Of the methods, we will need to implement all the interfaces, add a child, set a reference to the parent, assign the contents of the element, and the three functions required for the parser - open and close the tag and get the contents of the element. <br>  Make a sketch of the future class: <br><blockquote>  <font><font color="#007700">class</font> <font color="#0000BB">XML implements ArrayAccess</font> <font color="#007700">,</font> <font color="#0000BB">IteratorAggregate</font> <font color="#007700">,</font> <font color="#0000BB">Countable</font> <font color="#007700">{</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#0000BB">private $ pointer</font> <font color="#007700">;</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#0000BB">private $ tagName</font> <font color="#007700">;</font></font> <font><font color="#007700"><br><br><br></font></font>  <font><font color="#0000BB">private $ attributes</font> <font color="#007700">= array ();</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#0000BB">private $ cdata</font> <font color="#007700">;</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#0000BB">private $ parent</font> <font color="#007700">;</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#0000BB">private $ childs</font> <font color="#007700">= array ();</font></font> <font><font color="#007700"><br><br><br><br></font></font>  <font><font color="#0000BB">public</font> <font color="#007700">function</font> <font color="#0000BB">__construct</font> <font color="#007700">(</font> <font color="#0000BB">$ data</font> <font color="#007700">) {}</font></font> <font><font color="#007700"><br><br><br><br><br></font></font>  <font><font color="#0000BB">public</font> <font color="#007700">function</font> <font color="#0000BB">__toString</font> <font color="#007700">() {return;</font></font>  <font><font color="#007700">}</font></font> <font><font color="#007700"><br><br><br><br></font></font>  <font><font color="#0000BB">public</font> <font color="#007700">function</font> <font color="#0000BB">__get</font> <font color="#007700">(</font> <font color="#0000BB">$ name</font> <font color="#007700">) {return;</font></font>  <font><font color="#007700">}</font></font> <font><font color="#007700"><br><br><br><br><br></font></font>  <font><font color="#0000BB">public</font> <font color="#007700">function</font> <font color="#0000BB">offsetGet</font> <font color="#007700">(</font> <font color="#0000BB">$ offset</font> <font color="#007700">) {return;</font></font>  <font><font color="#007700">}</font></font> <font><font color="#007700"><br><br><br><br></font></font>  <font><font color="#0000BB">public</font> <font color="#007700">function</font> <font color="#0000BB">offsetExists</font> <font color="#007700">(</font> <font color="#0000BB">$ offset</font> <font color="#007700">) {return;</font></font>  <font><font color="#007700">}</font></font> <font><font color="#007700"><br><br><br><br><br></font></font>  <font><font color="#0000BB">public</font> <font color="#007700">function</font> <font color="#0000BB">offsetSet</font> <font color="#007700">(</font> <font color="#0000BB">$ offset</font> <font color="#007700">,</font> <font color="#0000BB">$ value</font> <font color="#007700">) {return;</font></font>  <font><font color="#007700">}</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#0000BB">public</font> <font color="#007700">function</font> <font color="#0000BB">offsetUnset</font> <font color="#007700">(</font> <font color="#0000BB">$ offset</font> <font color="#007700">) {return;</font></font>  <font><font color="#007700">}</font></font> <font><font color="#007700"><br><br><br><br><br></font></font>  <font><font color="#0000BB">public</font> <font color="#007700">function</font> <font color="#0000BB">count</font> <font color="#007700">() {return;</font></font>  <font><font color="#007700">}</font></font> <font><font color="#007700"><br><br><br><br></font></font>  <font><font color="#0000BB">public</font> <font color="#007700">function</font> <font color="#0000BB">getIterator</font> <font color="#007700">() {return;</font></font>  <font><font color="#007700">}</font></font> <font><font color="#007700"><br><br><br><br><br></font></font>  <font><font color="#0000BB">public</font> <font color="#007700">function</font> <font color="#0000BB">appendChild</font> <font color="#007700">(</font> <font color="#0000BB">$ tag</font> <font color="#007700">,</font> <font color="#0000BB">$ attributes</font> <font color="#007700">) {return;</font></font>  <font><font color="#007700">}</font></font> <font><font color="#007700"><br><br><br><br></font></font>  <font><font color="#0000BB">public</font> <font color="#007700">function</font> <font color="#0000BB">setParent</font> <font color="#007700">(</font> <font color="#0000BB">XML</font> <font color="#0000BB">$ parent</font> <font color="#007700">) {}</font></font> <font><font color="#007700"><br><br><br><br><br></font></font>  <font><font color="#0000BB">public</font> <font color="#007700">function</font> <font color="#0000BB">getParent</font> <font color="#007700">() {return;</font></font>  <font><font color="#007700">}</font></font> <font><font color="#007700"><br><br><br><br></font></font>  <font><font color="#0000BB">public</font> <font color="#007700">function</font> <font color="#0000BB">setCData</font> <font color="#007700">(</font> <font color="#0000BB">$ cdata</font> <font color="#007700">) {}</font></font> <font><font color="#007700"><br><br><br><br><br></font></font>  <font><font color="#0000BB">private</font> <font color="#007700">function</font> <font color="#0000BB">parse</font> <font color="#007700">(</font> <font color="#0000BB">$ data</font> <font color="#007700">) {}</font></font> <font><font color="#007700"><br><br><br><br></font></font>  <font><font color="#0000BB">private</font> <font color="#007700">function</font> <font color="#0000BB">tag_open</font> <font color="#007700">(</font> <font color="#0000BB">$ parser</font> <font color="#007700">,</font> <font color="#0000BB">$ tag</font> <font color="#007700">,</font> <font color="#0000BB">$ attributes</font> <font color="#007700">) {}</font></font> <font><font color="#007700"><br><br><br><br></font></font>  <font><font color="#0000BB">private</font> <font color="#007700">function</font> <font color="#0000BB">cdata</font> <font color="#007700">(</font> <font color="#0000BB">$ parser</font> <font color="#007700">,</font> <font color="#0000BB">$ cdata</font> <font color="#007700">) {}</font></font> <font><font color="#007700"><br><br><br></font></font>  <font><font color="#0000BB">private</font> <font color="#007700">function</font> <font color="#0000BB">tag_close</font> <font color="#007700">(</font> <font color="#0000BB">$ parser</font> <font color="#007700">,</font> <font color="#0000BB">$ tag</font> <font color="#007700">) {}</font></font> <font><font color="#007700"><br><br><br></font></font>  <font><font color="#007700">}</font></font> <br></blockquote><br>  Now let's get down to the implementation of the functions.  In order, let's start with the constructor.  In our case, it can take two types of values ‚Äã‚Äã- a string (xml) or an array of two elements (element name, attributes), since there is no overload of the same method with different parameters in php - you will have to manually check the type. <br><blockquote>  <font><font color="#0000BB">public</font> <font color="#007700">function</font> <font color="#0000BB">__construct</font> <font color="#007700">(</font> <font color="#0000BB">$ data</font> <font color="#007700">) {</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#007700">if (</font> <font color="#0000BB">is_array</font> <font color="#007700">(</font> <font color="#0000BB">$ data</font> <font color="#007700">)) {</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#007700">list (</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">tagName</font> <font color="#007700">,</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">attributes</font> <font color="#007700">) =</font> <font color="#0000BB">$ data</font> <font color="#007700">;</font></font> <font><font color="#007700"><br><br><br></font></font>  <font><font color="#007700">} else if (</font> <font color="#0000BB">is_string</font> <font color="#007700">(</font> <font color="#0000BB">$ data</font> <font color="#007700">))</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">parse</font> <font color="#007700">(</font> <font color="#0000BB">$ data</font> <font color="#007700">);</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#007700">}</font></font> <br></blockquote><br>  As already mentioned, with the help of the <font>__toString ()</font> magic method, the user will be able to get the data of an element as a string, and then convert it to any type that he wants, unfortunately, it‚Äôs impossible to return directly what he wants, so that's the only way. <br>  At the same time, we will analyze the next magic method <font>__get ( <font color="darkred">$ name</font> )</font> , with the help of which we will access the descendants of the current element.  It is quite logical that if there is only one descendant, then it will be returned immediately, without the need to call on the 0 index of the array.  For example: <font><font color="darkred">$ xml-&gt;</font> rss-&gt; channel-&gt; item [ <font color="red">5</font> ] -&gt; url</font> , instead of <font><font color="darkred">$ xml-&gt;</font> rss [ <font color="red">0</font> ] -&gt; channel [ <font color="red">0</font> ] -&gt; item [ <font color="red">5</font> ] -&gt; url [ <font color="red">0</font> ]</font> , if the elements rss, channel and url exist in a single copy at their nesting level. <br><blockquote>  <font><font color="#0000BB">public</font> <font color="#007700">function</font> <font color="#0000BB">__toString</font> <font color="#007700">() {</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#007700">return</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">cdata</font> <font color="#007700">;</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#007700">}</font></font> <font><font color="#007700"><br><br><br><br></font></font>  <font><font color="#0000BB">public</font> <font color="#007700">function</font> <font color="#0000BB">__get</font> <font color="#007700">(</font> <font color="#0000BB">$ name</font> <font color="#007700">) {</font></font> <font><font color="#007700"><br><br><br></font></font>  <font><font color="#007700">if (isset (</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">childs</font> <font color="#007700">[</font> <font color="#0000BB">$ name</font> <font color="#007700">])) {</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#007700">if (</font> <font color="#0000BB">count</font> <font color="#007700">(</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">childs</font> <font color="#007700">[</font> <font color="#0000BB">$ name</font> <font color="#007700">]) ==</font> <font color="#0000BB">1</font> <font color="#007700">)</font></font> <font><font color="#007700"><br><br><br></font></font>  <font><font color="#007700">return</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">childs</font> <font color="#007700">[</font> <font color="#0000BB">$ name</font> <font color="#007700">] [</font> <font color="#0000BB">0</font> <font color="#007700">];</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#007700">else</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#007700">return</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">childs</font> <font color="#007700">[</font> <font color="#0000BB">$ name</font> <font color="#007700">];</font></font> <font><font color="#007700"><br><br><br></font></font>  <font><font color="#007700">}</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#0000BB">throw</font> <font color="#007700">new</font> <font color="#0000BB">Exception</font> <font color="#007700">(</font> <font color="#DD0000">‚ÄúUFO steals [$ name]!‚Äù</font> <font color="#007700">);</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#007700">}</font></font> <font><br></font> </blockquote><br><br>  The <font>offsetGet</font> , <font>offsetExists</font> , <font>offsetSet,</font> and <font>offsetUnset functions</font> implement the <font>ArrayAccess</font> interface to access an object as an array.  We use it to access element attributes.  <font>offsetSet</font> and <font>offsetUnset</font> will leave stubs for now. <br><blockquote>  <font><font color="#0000BB">public</font> <font color="#007700">function</font> <font color="#0000BB">offsetGet</font> <font color="#007700">(</font> <font color="#0000BB">$ offset</font> <font color="#007700">) {</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#007700">if (isset (</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">attributes</font> <font color="#007700">[</font> <font color="#0000BB">$ offset</font> <font color="#007700">]))</font></font> <font><font color="#007700"><br><br><br></font></font>  <font><font color="#007700">return</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">attributes</font> <font color="#007700">[</font> <font color="#0000BB">$ offset</font> <font color="#007700">];</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#0000BB">throw</font> <font color="#007700">new</font> <font color="#0000BB">Exception</font> <font color="#007700">(</font> <font color="#DD0000">"Holy cow! There is'nt [$ offset] attribute!"</font> <font color="#007700">);</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#007700">}</font></font> <font><font color="#007700"><br><br><br><br><br></font></font>  <font><font color="#0000BB">public</font> <font color="#007700">function</font> <font color="#0000BB">offsetExists</font> <font color="#007700">(</font> <font color="#0000BB">$ offset</font> <font color="#007700">) {</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#007700">return isset (</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">attributes</font> <font color="#007700">[</font> <font color="#0000BB">$ offset</font> <font color="#007700">]);</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#007700">}</font></font> </blockquote><br><br>  And now we are faced with a problem because of a recent decision.  If suddenly we want to start a <font color="blue">foreach loop</font> on a single element, then it will start on the xml object itself!  So you have to sacrifice the ability to use <font color="blue">foreach</font> for element attributes in a simple way and implement the <font>getAttributes ()</font> method.  And we will return the iterator and the number of elements for the array of elements to which the callee belongs, and if he does not have a parent, then an iterator over the array from one current element.  Thus, the <font>IteratorAggregate</font> and <font>Countable</font> interfaces will be implemented. <br><blockquote>  <font><font color="#0000BB">public</font> <font color="#007700">function</font> <font color="#0000BB">count</font> <font color="#007700">() {</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#007700">if (</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">parent</font> <font color="#007700">! =</font> <font color="#0000BB">null</font> <font color="#007700">)</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#007700">return</font> <font color="#0000BB">count</font> <font color="#007700">(</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">parent</font> <font color="#007700">-&gt;</font> <font color="#0000BB">childs</font> <font color="#007700">[</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">tagName</font> <font color="#007700">]);</font></font> <font><font color="#007700"><br><br><br></font></font>  <font><font color="#007700">return</font> <font color="#0000BB">1</font> <font color="#007700">;</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#007700">}</font></font> <font><font color="#007700"><br><br><br><br></font></font>  <font><font color="#0000BB">public</font> <font color="#007700">function</font> <font color="#0000BB">getIterator</font> <font color="#007700">() {</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#007700">if (</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">parent</font> <font color="#007700">! =</font> <font color="#0000BB">null</font> <font color="#007700">)</font></font> <font><font color="#007700"><br><br><br></font></font>  <font><font color="#007700">return new</font> <font color="#0000BB">ArrayIterator</font> <font color="#007700">(</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">parent</font> <font color="#007700">-&gt;</font> <font color="#0000BB">childs</font> <font color="#007700">[</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">tagName</font> <font color="#007700">]);</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#007700">return new</font> <font color="#0000BB">ArrayIterator</font> <font color="#007700">(array (</font> <font color="#0000BB">$ this</font> <font color="#007700">));</font></font> <font><font color="#007700"><br><br><br></font></font>  <font><font color="#007700">}</font></font> <font><font color="#007700"><br></font></font> <br></blockquote><br>  Adding a child is a simple function, the only interesting thing about it is that after adding an element, it returns a reference to it. <br><blockquote>  <font><font color="#0000BB">public</font> <font color="#007700">function</font> <font color="#0000BB">appendChild</font> <font color="#007700">(</font> <font color="#0000BB">$ tag</font> <font color="#007700">,</font> <font color="#0000BB">$ attributes</font> <font color="#007700">) {</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#0000BB">$ element</font> <font color="#007700">= new</font> <font color="#0000BB">XML</font> <font color="#007700">(array (</font> <font color="#0000BB">$ tag</font> <font color="#007700">,</font> <font color="#0000BB">$ attributes</font> <font color="#007700">));</font></font> <font><font color="#007700"><br><br><br></font></font>  <font><font color="#0000BB">$ element</font> <font color="#007700">-&gt;</font> <font color="#0000BB">setParent</font> <font color="#007700">(</font> <font color="#0000BB">$ this</font> <font color="#007700">);</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">childs</font> <font color="#007700">[</font> <font color="#0000BB">$ tag</font> <font color="#007700">] [] =</font> <font color="#0000BB">$ element</font> <font color="#007700">;</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#007700">return</font> <font color="#0000BB">$ element</font> <font color="#007700">;</font></font> <font><font color="#007700"><br><br><br></font></font>  <font><font color="#007700">}</font></font> </blockquote><br>  Now we implement the parser itself.  To create a tree structure we will use a pointer to the current element.  At the beginning, it is installed directly on the current element, when opening a tag - on an open element, so that all elements contained in it are added to its descendants, and when closing a tag - on its parent element. <br><blockquote>  <font><font color="#0000BB">private</font> <font color="#007700">function</font> <font color="#0000BB">parse</font> <font color="#007700">(</font> <font color="#0000BB">$ data</font> <font color="#007700">) {</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">pointer</font> <font color="#007700">= &amp;</font> <font color="#0000BB">$ this</font> <font color="#007700">;</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#0000BB">$ parser</font> <font color="#007700">=</font> <font color="#0000BB">xml_parser_create</font> <font color="#007700">();</font></font> <font><font color="#007700"><br><br><br></font></font>  <font><font color="#0000BB">xml_set_object</font> <font color="#007700">(</font> <font color="#0000BB">$ parser</font> <font color="#007700">,</font> <font color="#0000BB">$ this</font> <font color="#007700">);</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#0000BB">xml_parser_set_option</font> <font color="#007700">(</font> <font color="#0000BB">$ parser</font> <font color="#007700">,</font> <font color="#0000BB">XML_OPTION_CASE_FOLDING</font> <font color="#007700">,</font> <font color="#0000BB">false</font> <font color="#007700">);</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#0000BB">xml_set_element_handler</font> <font color="#007700">(</font> <font color="#0000BB">$ parser</font> <font color="#007700">,</font> <font color="#DD0000">"tag_open"</font> <font color="#007700">,</font> <font color="#DD0000">"tag_close"</font> <font color="#007700">);</font></font> <font><font color="#007700"><br><br><br></font></font>  <font><font color="#0000BB">xml_set_character_data_handler</font> <font color="#007700">(</font> <font color="#0000BB">$ parser</font> <font color="#007700">,</font> <font color="#DD0000">"cdata"</font> <font color="#007700">);</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#0000BB">xml_parse</font> <font color="#007700">(</font> <font color="#0000BB">$ parser</font> <font color="#007700">,</font> <font color="#0000BB">$ data</font> <font color="#007700">);</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#007700">}</font></font> <font><font color="#007700"><br><br><br><br></font></font>  <font><font color="#0000BB">private</font> <font color="#007700">function</font> <font color="#0000BB">tag_open</font> <font color="#007700">(</font> <font color="#0000BB">$ parser</font> <font color="#007700">,</font> <font color="#0000BB">$ tag</font> <font color="#007700">,</font> <font color="#0000BB">$ attributes</font> <font color="#007700">) {</font></font> <font><font color="#007700"><br><br><br></font></font>  <font><font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">pointer</font> <font color="#007700">= &amp;</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">pointer</font> <font color="#007700">-&gt;</font> <font color="#0000BB">appendChild</font> <font color="#007700">(</font> <font color="#0000BB">$ tag</font> <font color="#007700">,</font> <font color="#0000BB">$ attributes</font> <font color="#007700">);</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#007700">}</font></font> <font><font color="#007700"><br><br><br></font></font>  <font><font color="#0000BB">private</font> <font color="#007700">function</font> <font color="#0000BB">cdata</font> <font color="#007700">(</font> <font color="#0000BB">$ parser</font> <font color="#007700">,</font> <font color="#0000BB">$ cdata</font> <font color="#007700">) {</font></font> <font><font color="#007700"><br><br><br></font></font>  <font><font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">pointer</font> <font color="#007700">-&gt;</font> <font color="#0000BB">setCData</font> <font color="#007700">(</font> <font color="#0000BB">$ cdata</font> <font color="#007700">);</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#007700">}</font></font> <font><font color="#007700"><br><br><br></font></font>  <font><font color="#0000BB">private</font> <font color="#007700">function</font> <font color="#0000BB">tag_close</font> <font color="#007700">(</font> <font color="#0000BB">$ parser</font> <font color="#007700">,</font> <font color="#0000BB">$ tag</font> <font color="#007700">) {</font></font> <font><font color="#007700"><br><br><br></font></font>  <font><font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">pointer</font> <font color="#007700">= &amp;</font> <font color="#0000BB">$ this</font> <font color="#007700">-&gt;</font> <font color="#0000BB">pointer</font> <font color="#007700">-&gt;</font> <font color="#0000BB">getParent</font> <font color="#007700">();</font></font> <font><font color="#007700"><br><br></font></font>  <font><font color="#007700">}</font></font> <br></blockquote><br><br>  Everything.  Parser is ready to go.  In order not to inflate the article even more, I downloaded the <a href="http://docs.google.com/View%3Fdocid%3Ddhdwh8qb_3cwq55sgd">entire source code with comments</a> on Google Docs and the <a href="http://docs.google.com/View%3Fdocid%3Ddhdwh8qb_4fftc9k2g">usage example</a> too.  <sup><a href="https://habr.com/ru/post/30353/">[6]</a></sup> <br><br><h1>  What's next? </h1><br>  This is still not a complete replacement for SimpleXML, our parser still does not know how to create an xml document from the data in it.  Adding the necessary functions is not a difficult task, so I will leave it, for those who are interested, as homework :) <br><br><h1>  Links </h1><br>  1) The first version of <a href="http://docs.google.com/View%3Fdocid%3Ddhdwh8qb_2sq45n2d9">xml =&gt; array parser</a> . <br>  2) Documentation of <a href="http://www.php.net/manual/en/language.oop5.magic.php">magical methods</a> (eng) ( <a href="http://php.su/learnphp/phpoo/%3Fphp5_4">rus</a> ). <br>  3) <a href="http://www.php.net/~helly/php/ext/spl/">SPL documentation</a> . <br>  4) Description of the functions of the <a href="http://www.php.net/manual/en/ref.xml.php">xml-parser</a> . <br>  5) <a href="http://www.php.net/manual/en/language.references.php">Documentation of signs</a> (eng) ( <a href="http://php.su/learnphp/%3Fre">rus</a> ). <br>  6) The <a href="http://docs.google.com/View%3Fdocid%3Ddhdwh8qb_3cwq55sgd">final version of the parser</a> and a simple <a href="http://docs.google.com/View%3Fdocid%3Ddhdwh8qb_4fftc9k2g">example of use</a> . <br></div><p>Source: <a href="https://habr.com/ru/post/30353/">https://habr.com/ru/post/30353/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../303520/index.html">How to create visually effective calls to action</a></li>
<li><a href="../303522/index.html">Validation of Fuel Plugins within the Mirantis Unlocked validation program. Do you need it?</a></li>
<li><a href="../303524/index.html">The experience of switching from Sublime to Vim</a></li>
<li><a href="../303526/index.html">Influence of game icon on user attraction cost</a></li>
<li><a href="../303528/index.html">Telegram bot for support service (part 1)</a></li>
<li><a href="../303532/index.html">About the importance of user stories</a></li>
<li><a href="../303534/index.html">Checking the OpenJDK project with PVS-Studio</a></li>
<li><a href="../303536/index.html">Android Security Rewards is 1 year old</a></li>
<li><a href="../303538/index.html">Relinx is another implementation of .NET LINQ methods in C ++, with support for lazy evaluation.</a></li>
<li><a href="../303540/index.html">NetApp AltaVault Storage Systems</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>