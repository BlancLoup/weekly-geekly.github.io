<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we increased JSON generation speed by 6000 times</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A brief overview of how to generate JSON 
 Today Rails has the following methods for serializing objects in JSON: 


1. Call to_json () directly. 
2. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we increased JSON generation speed by 6000 times</h1><div class="post__text post__text-html js-mediator-article"><h5>  A brief overview of how to generate JSON </h5><br>  Today Rails has the following methods for serializing objects in JSON: <br><ol><li>  Call to_json () directly. </li><li>  Rable </li><li>  Active model serializers </li><li>  Jbuilder </li></ol><br><a name="habracut"></a><br>  The first method is ideal for situations where you do not need to serialize nested objects. <br><pre><code class="ruby hljs">@posts.to_json(<span class="hljs-symbol"><span class="hljs-symbol">:include</span></span> =&gt; [...], <span class="hljs-symbol"><span class="hljs-symbol">:methods</span></span> =&gt; [...])</code> </pre> <br>  However, forming a JSON response with a list of models, it becomes necessary to serialize the associated models in the desired form. <br><br>  <a href="https://github.com/rails/jbuilder">Jbuilder</a> <br>  From personal experience, the most organically fit into a Rails development is, included by default in Rails 4, JBuilder. <br><pre> <code class="ruby hljs">json.extract! message, <span class="hljs-symbol"><span class="hljs-symbol">:id</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:content</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:chat_id</span></span> json.user <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> json.cache!([<span class="hljs-string"><span class="hljs-string">"user_"</span></span>, message.user_id]) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> json.partial! <span class="hljs-string"><span class="hljs-string">'users/user'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">user:</span></span> message.user <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  <a href="https://github.com/ccocchi/rabl-rails">Rable</a> <br>  RABL, compared to other gems, seems to be an ancient monster because of its syntax and slow to do so. <br><pre> <code class="ruby hljs">collection <span class="hljs-symbol"><span class="hljs-symbol">:</span></span>@messages attributes <span class="hljs-symbol"><span class="hljs-symbol">:id</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:content</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:chat_id</span></span> child(<span class="hljs-symbol"><span class="hljs-symbol">:user</span></span>) { attributes <span class="hljs-symbol"><span class="hljs-symbol">:name</span></span> } node(<span class="hljs-symbol"><span class="hljs-symbol">:read</span></span>) { <span class="hljs-params"><span class="hljs-params">|message|</span></span> message.read_by?(@user) }</code> </pre><br><br>  <a href="https://github.com/rails-api/active_model_serializers">ActiveModel :: Serializer</a> <br>  Active model serializers proposes to describe JSON in the form of ruby ‚Äã‚Äãclasses, without invented syntax, which reduces the zoo's use of different DSL in the project. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Solving performance problems </h5><br><h6>  Small comparison </h6><br>  Test data: 1000 typical messages with the sender and additional fields. <br>  Json: <br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">content</span></span>: <span class="hljs-string"><span class="hljs-string">"Lorem"</span></span>, <span class="hljs-attr"><span class="hljs-attr">chat_id</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">created_at</span></span>: <span class="hljs-string"><span class="hljs-string">"2014-06-18T21:47:49.363Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">kind</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">formatted_content</span></span>: <span class="hljs-string"><span class="hljs-string">"&lt;span&gt;Lorem&lt;/span&gt;"</span></span>, <span class="hljs-attr"><span class="hljs-attr">user</span></span>: { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"Ivan Petrov"</span></span>, <span class="hljs-attr"><span class="hljs-attr">image</span></span>: <span class="hljs-string"><span class="hljs-string">"https://lh6.googleusercontent.com/photo.jpg"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">files</span></span>: [ ], <span class="hljs-attr"><span class="hljs-attr">links</span></span>: [ ] }</code> </pre><br><br>  to_json: 0.2ms <br>  JBuilder: 129.0ms <br>  JBuilder with OJ: 88.0ms <br><br>  The numbers are averaged, but the overall picture is clear.  It makes no sense to compare different gems among themselves, since the difference is not significant, but objectively, JBuilder is the fastest today. <br>  For convenience you have to pay speed.  All the described gems in speed lose the to_json () method several times. <br>  Using JBuilder without configuration will cost you ~ 600.0ms <br><br>  There are several ways to speed up JBuilder: <br><br><ul><li>  Connect gems: oj, oj_mimic_json, multi_json. <br>  Add <code>MultiJson.use(:oj)</code> to initialization <code>MultiJson.use(:oj)</code> <br>  What will replace the standard serializer with a faster Oj. </li><li>  Do not use partials that significantly slow down JBuilder.  It has long been created issues in which, despite the closed status, this problem has not actually been resolved. </li><li>  Cache templates using the cache built-in JBuilder method! </li></ul><br><br>  In the <a href="https://staply.co/">Staply</a> project (almost open beta) we used JBuilder only at the initial stage of development, gradually switching to the formation of JSON manually using to_json ().  What is the olnichno demonstration of the entire concept of Rails, providing a fairly quick and easy development at the beginning with optimization at the end. </div><p>Source: <a href="https://habr.com/ru/post/226725/">https://habr.com/ru/post/226725/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../226707/index.html">We learn PHP from the inside. Zval</a></li>
<li><a href="../226711/index.html">The company Ilona Mask SolarCity intends to become the largest manufacturer of solar panels in the world</a></li>
<li><a href="../226713/index.html">Summer Mini-Conference on Robotics in Yekaterinburg</a></li>
<li><a href="../226715/index.html">Video recordings of DesignLab conference reports</a></li>
<li><a href="../226723/index.html">The most complete collection of video games in the world sold for 750 thousand dollars</a></li>
<li><a href="../226741/index.html">Solving the problem of sorting trees using a binary Materialized Path</a></li>
<li><a href="../226743/index.html">Overview teXet TM-511R: a secure phone with a 2,700 mAh battery</a></li>
<li><a href="../226749/index.html">ElasticSearch and search vice versa. Percolate API</a></li>
<li><a href="../226755/index.html">Hybrid Cloud FAQ: Good old virtualization in a new financial wrapper</a></li>
<li><a href="../226759/index.html">How to use Routing in Ext JS 5</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>