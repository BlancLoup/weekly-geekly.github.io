<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Typical NGFW implementation scenarios</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Disclaimer 
 This article provides only examples of typical NGFW deployment scenarios. Do not take the proposed scheme for the finished template. In r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Typical NGFW implementation scenarios</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/c0/uh/0o/c0uh0okjp5xnmpkcy0qealzsm0i.jpeg"><br><br><h3>  Disclaimer </h3><br>  This article provides only examples of typical NGFW deployment scenarios.  Do not take the proposed scheme for the finished template.  In real life, almost every introduction is unique.  There are many pitfalls that you need to pay attention to when planning a network topology.  But in general, all the options will ‚Äúrevolve‚Äù around several concepts.  We will try to discuss them. <br><br><h3>  Typical network architecture in terms of information security </h3><br>  Before describing the options for implementing NGFW, I would like to discuss a few typical scenarios for the use of network protection tools.  We will consider the most common means that almost every company has (of course, as simple and superficially as possible, otherwise the whole book will turn out).  Most often in practice you can find the three most common options: <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  1) Advanced </h4><br><img src="https://habrastorage.org/webt/-z/bj/tf/-zbjtfdz8xi-sbb3zjimtdio3ke.png"><br><br>  Pretty typical layout.  On the perimeter of the network, any Stateful Firewall is used, which has at least three segments: Internet, DMZ, local area network.  At this ME, Site-to-Site VPN and RA VPN can be organized.  In the DMZ are usually public services.  In the same place most often there is any Anti-Spam solution with antivirus functionality. <br>  A local switch (L3) is responsible for routing local traffic, on which there are at least two segments: a user segment and a server segment.  A proxy server with antivirus functionality and a corporate mail server are located in the server segment.  Quite often, the server segment is protected by additional MEs (virtual or ‚Äúiron‚Äù). <br><br>  As an additional protection measure, IPS can be used, which monitors a copy of the traffic (connected to the SPAN port).  In practice, few people ‚Äúdare‚Äù to put IPS in inline mode. <br><br>  I am sure that many have guessed their network in this scheme. <br><br><h4>  2) Simplified </h4><br><img src="https://habrastorage.org/webt/tq/yg/cs/tqygcs8eoyagsh4efd-fabpjkcm.png"><br><br>  This option is also quite common.  Almost all security functionality is deployed as part of a single UTM solution (Firewall, Proxy, AV, Anti-Spam, IPS).  The core switch (Core SW L3) is used to route local traffic.  It also highlights the server segment with the mail server and other services of the company. <br><br><h4>  3) SMB </h4><br><img src="https://habrastorage.org/webt/ke/od/-9/keod-9apeejpwdxsgk8w6o6xdrc.png"><br><br>  The easiest option.  Differs from the previous lack of a kernel switch.  Those.  traffic between local segments and the Internet is routed through a single UTM device.  This option is often found in small companies where there is little traffic. <br><br>  As I wrote above, this is a very superficial description of three typical scenarios for using the most common network protection tools. <br><br><h3>  Ngfw </h3><br>  Next Generation Firewall is the next generation firewall.  We have repeatedly discussed <a href="https://habr.com/company/tssolution/blog/323606/">what it is, how it differs from UTM</a> , <a href="https://habr.com/company/tssolution/blog/333338/">which market leaders</a> and what you need to pay attention to when choosing.  Initially, the main thing for the sake of which NGFW was implemented - application monitoring and deep packet inspection (the first is actually impossible without the latter).  Applications mean not only classic ‚Äúfat‚Äù applications, but also micro-applications of web format.  An example is posting, video, chatting in social networks. <br>  However, almost all modern NGFW have much more functions: <br><br><ul><li>  Application control </li><li>  URL filtering </li><li>  VPN </li><li>  IPS </li><li>  Anti-Virus </li><li>  Anti-spam </li></ul><br>  Some solutions have additional functionality: <br><br><ul><li>  DLP </li><li>  Sandboxing </li><li>  Log analyzer and correlation unit </li></ul><br>  Because of such a large availability of functions and there are questions with the implementation.  If you bought a proxy server (ironport for example), then the application scenarios would be much less.  The same goes for narrowly targeted anti-spam solutions.  <b>But what to do with such ‚Äúcombines‚Äù like modern NGFW?</b>  <b>Where to put and how to use?</b>  Let's look at a few sample scenarios and discuss how best to implement.  All subsequent conclusions are very <b>subjective</b> and based only on personal experience and in accordance with certain "best practice". <br><br><h4>  1) NGFW as a perimeter device </h4><br>  The easiest and most correct implementation option.  NGFW for this and thought - to stand on the edge of the network. <br><br><img src="https://habrastorage.org/webt/0k/r2/ih/0kr2ihb6e57egsn_bxobv8illxw.png"><br><br>  <b>What are the benefits:</b> <br><br><ul><li>  There is no need to use a dedicated proxy.  Most NGFWs can operate in proxy mode, but all the necessary functionality works in the ‚Äúdefault route‚Äù mode for all local networks.  Configured default gateway and forgot.  No explicit proxies in user browsers. </li><li>  By default, there is IPS and immediately in inline mode.  You can set Detect if you are afraid of problems.  No need to think about how to wrap traffic through a dedicated IPS device and how to quickly return traffic back in case of problems. </li><li>  Antivirus for web traffic, including for HTTPS traffic (with SSL inspection enabled). </li><li>  Antivirus for email traffic.  Check links and attachments. </li><li>  Anti-spam functionality. </li><li>  The ability to quickly implement the functional "sandbox" (sandbox).  Almost all modern NGFW have the ability to activate the sandbox (cloud or local). </li><li>  Integrated reporting for all information security incidents. </li></ul><br>  As you can see, the scheme is greatly simplified.  Removed several traditional means of network protection.  On the one hand, this is a plus (administration is simplified), on the other hand, minus (a single point of failure).  We will not discuss now what is better.  We are simply discussing the concept. <br><br>  <b>What to look for when choosing NGFW, which will stand on the perimeter of the network:</b> <br><br><ul><li>  Most attention here should be paid to the mail check functionality (of course, if you are going to remove the current anti-spam solution).  For full-fledged mail handling, NGFW must have an MTA (mail transfer agent) on board.  In fact, in this mode, NGFW replaces SMTP-relay, which allows for deep checking of mail traffic.  Including verification of investments in the sandbox.  If there is no MTA, then at least SMTP relay should be left. </li><li>  Even if the MTA is present in NGFW, carefully read the mail filtering features.  One of the most important criteria is the availability of quarantine (or ways to organize it). </li><li>  HTTPS inspection should of course be supported.  Without this function, one name remains from NGFW. </li><li>  The number of applications that NGFW can distinguish.  Be sure to check if your chosen solution determines the applications you need (including web applications). </li></ul><br>  <b>Possible limitations or problems</b> <br><br>  Often a router is used as an edge device and not a ME.  In this case, the current scheme can use functionality that is not present in its pure form on the NGFW (various WAN technologies, routing protocols, etc.).  This should be taken into account and carefully planned before implementation.  It may be logical to leave the router and use it in parallel (for example, for organizing a WAN network).  Example: <br><br><img src="https://habrastorage.org/webt/qj/uz/ru/qjuzru7bed7gpmmwe8fd9_ilgoo.png"><br><br>  <b>Summary</b> <br><br>  As I wrote above, the ‚ÄúNGFW on the perimeter of the network‚Äù option is ideal when you get the most out of it.  But do not forget that NGFW is not a router.  The usual functions (bgp, gre, ip sla, etc.) may be absent or present in a very truncated functional. <br><br><h4>  2) NGFW as a proxy server </h4><br>  Oddly enough, but it is also a fairly common option.  Although NGFW and was not developed as a proxy.  Typical scheme: <br><br><img src="https://habrastorage.org/webt/ms/gq/xm/msgqxmeeew8_g7wkwr3sy3w8qgk.png"><br><br>  <b>The advantages of this option:</b> <br><br><ul><li>  The speed of implementation.  Replaced the old proxy and done. </li><li>  No need to change the current scheme or routing. </li></ul><br>  This is perhaps the pluses end.  Although the benefits are voiced very often become decisive for many companies. <br><br>  <b>What to look for when choosing NGFW, which will stand as a proxy:</b> <br><br><ul><li>  The most important point here is the user authentication method (NTLM, Kerberos, Captive Portal, etc.).  Be sure to verify that your chosen solution supports the current authorization method or is able to replace it with something adequate. </li><li>  Check that you are comfortable with NGFW user built-in reporting (consumed traffic, visited resources, etc.). </li><li>  Opportunities for limiting traffic - QoS, restrictions on the speed (shaping) and the volume of downloadable traffic (limiting). </li></ul><br>  <b>Possible limitations or problems:</b> <br><br><ul><li>  The first thing to remember is that NGFW in proxy mode is almost always a stripped-down feature.  You will not be able to use it 100 percent.  Especially when it comes to checking email traffic. </li><li>  Lower bandwidth.  Almost all NGFW solutions in proxy mode demonstrate lower speed per user. </li><li>  You will still be forced to use IPS.  Since  Some of your traffic may go to the Internet past the proxy. </li></ul><br>  <b>Summary</b> <br><br>  Personal advice - if there is an opportunity to avoid ‚ÄúNGFW as proxy‚Äù, then avoid.  In practice, undocumented features suddenly begin to "vylazit".  And the biggest disadvantage is the impossibility of a full check of mail (technically, of course, this can be done, but it will be a ‚Äúcrutch‚Äù). <br><br><h4>  3) NGFW as core </h4><br>  A common option for small networks.  Routing of all traffic (Internet, local, server) is ‚Äúhung up‚Äù on NGFW.  L3 switch is absent, or simply not used for routing. <br><br><img src="https://habrastorage.org/webt/gu/q7/hz/guq7hzzhufey3mgfbrmxng4o8xc.png"><br><br>  <b>The advantages of this option:</b> <br><br><ul><li>  Ease of administration.  All access-lists in one place. </li><li>  Deployment speed  As a rule, NGFW is placed in this way in topologies where, before that, the ME was the core of the network. </li><li>  All the advantages of the option ‚ÄúNGFW on the perimeter of the network‚Äù. </li></ul><br>  <b>What to look for when choosing NGFW in kernel mode</b> <br><br>  Almost everything is the same as for ‚ÄúNGFW on the perimeter of the network‚Äù.  But in this case it is worth paying special attention to the presence of the MTA function.  In such a small network, it is desirable to do without an additional device in the form of an SMTP relay.  It is better if this functionality is present in your NGFW. <br><br>  <b>Possible limitations or problems:</b> <br><br><ul><li>  Perhaps the main problem is a single point of failure.  When selecting a device, do not forget to consider your local traffic so that the selected NGFW model will cope with the load. </li><li>  The network is less flexible in terms of change.  Fewer routing devices ‚Äî less traffic control. </li></ul><br>  <b>Summary</b> <br><br>  Perhaps this is an ideal option for small companies.  Of course, if you accept the risk of a single point of failure. <br><br><h4>  4) NGFW in bridge mode </h4><br>  A less popular option, but still occurs more often than we would like.  In this case, the current network logic does not change at all, the traffic at the second level passes through NGFW, which operates in bridge mode: <br><br><img src="https://habrastorage.org/webt/2l/e3/a-/2le3a-q8mgk-znxi02tx-dxt-bs.png"><br><br>  Leaving a third-party IPS in this case does not make sense (especially on monitoring traffic).  NGFW will perfectly cope with its function.  This option is used most often in more advanced infrastructures, where topology changes are for some reason impossible or highly undesirable. <br><br>  <b>The advantages of this option:</b> <br><br><ul><li>  The speed of implementation.  You do not need to change the network logic; you need to overwrite the cable or ‚Äúwrap‚Äù the VLAN. </li><li>  Less hops - easier network logic. </li></ul><br>  This is probably all. <br><br>  <b>What to look for when choosing NGFW in ‚Äúbridge‚Äù mode:</b> <br><br><ul><li>  On the restrictions of the ‚Äúbridge‚Äù mode!  Read them carefully. </li><li>  It is desirable to have bypass modules so that traffic goes through the device, even if it is turned off. </li></ul><br>  <b>Possible limitations or problems</b> <br><br>  And here are a lot of pitfalls.  I have not yet met a single NGFW solution that would adequately work in bridge mode.  Maybe I had no luck.  But I share in this article only my experience.  In addition to the official (documented) limitations in the functionality, ‚Äúunofficial‚Äù in the form of bugs and heaps of problems always appear.  Of course, it all depends on the functions you use in bridge mode.  If you configure only the Firewall, then there will be almost no problems.  However, if you include things like IPS, Application Control, HTTPS inspection, or even Sandboxing, then be prepared for surprises. <br><br>  <b>Summary</b> <br><br>  As with the proxy, it is advisable to avoid the bridge mode.  If this is not possible, then it is highly desirable to test this mode on your infrastructure.  Then make a decision. <br><br><h3>  fault tolerance </h3><br>  I could not touch this point.  Almost all NGFW solutions support two clustering modes: <br><br><ol><li>  <b>High Availability</b> .  One node of the cluster is active and routes traffic, the second node is passive and is in hot standby, ready to become active in case of problems with the first. </li><li> <b>Load Sharing</b> .  Both nodes are active and traffic is ‚Äúdivided‚Äù between them. </li></ol><br>  Many people rely heavily on Load Sharing mode when planning and implementing NGFW. <br><blockquote>  - If the traffic is divided between devices, then the load on them will be two times less, and therefore the device can be laid weaker and cheaper? <br>  - Not! </blockquote><br>  As numerous tests show, it is impossible to achieve adequate balancing of traffic.  And the maximum that you will give Load Sharing - reducing the load on the device by 15 percent, not more.  At the same time, this mode almost always has some limitations that are not found in High Availability.  Be sure to read them.  And when choosing a device, always count that one ‚Äúpiece of hardware‚Äù should cope with all traffic. <br><br>  <b>Summary</b> <br><br>  Use High Availability mode. <br><br><h3>  Virtual NGFW or ‚Äúpiece of hardware‚Äù </h3><br>  Another very frequent question when planning NGFW.  Choose a virtual solution or appliance.  There is no definite answer.  It all depends on your current infrastructure, budget and possibilities for changing the logic of the network.  But we still have general recommendations for different implementation options: <br><br><ol><li>  NGFW on the perimeter of the network.  Here is certainly the best option - appliance.  This is logical, because  the network perimeter must have a physical distinction.  If you still want a virtual solution, it is VERY desirable that NGFW is deployed on a dedicated server that has a physical separation from the local network.  In fact, you get the same appliance, just instead of the ‚Äúhardware‚Äù of the vendor, you use your server with a hypervisor.  You also need to carefully approach the settings of the hypervisor itself so that it is not accessed from the external network. </li><li>  NGFW as proxy.  There is no difference what to choose.  In my opinion a virtual solution would be more preferable and convenient option. </li><li>  NGFW as the core of the network.  Basic requirements as in the first paragraph.  Since  NGFW is directly connected to the Internet, then the solution must be physically separated from the company's servers - an appliance or a virtual machine on a dedicated server.  Since  NGFW in this case also performs the role of the kernel, then you need to understand how many physical ports you need and which ports (1g, 10g, optics).  It also greatly influences the choice. </li><li>  NGFW in bridge mode.  For this option, a hardware device is strictly recommended, since  preferably bypass modules (traffic will pass even when the device is turned off). </li></ol><br>  Let's take a look at the pros and cons of a virtual solution. <br><br>  <b>Advantages of a virtual solution:</b> <br><br><ul><li>  The main advantages of a virtual solution are the ease of management (backup, snapshot) and deployment speed. </li><li>  It is also very often cheaper and more scalable.  Typically, licensing is based on the number of cores used.  If necessary, you can simply purchase a few cores. </li></ul><br>  <b>Cons of the virtual solution:</b> <br><br><ul><li>  No hardware warranty.  If the server fails, you have to deal with it yourself. </li><li>  If you are safe, then you have to interact with the IT department.  Oddly enough, in many companies this is a very big problem. </li></ul><br>  For appliance, the opposite is true.  In addition, out of the box, more physical ports are available. <br><br><h3>  Conclusion </h3><br>  I hope this article did not work too boring and superficial.  I wanted to highlight the main points and not stretch the ‚Äúlecture‚Äù for a few hours of reading.  I would be glad if this article is really useful to someone.  If you have any questions or comments, then I am ready to discuss them in comments or personal messages. </div><p>Source: <a href="https://habr.com/ru/post/430484/">https://habr.com/ru/post/430484/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../430474/index.html">CephFS vs GlusterFS</a></li>
<li><a href="../430476/index.html">NCBI Genome Workbench: Scientific Research Under Threat</a></li>
<li><a href="../430478/index.html">Trading bots for cryptographic. Where to begin?</a></li>
<li><a href="../430480/index.html">As we wrote the application on the NASA Space Apps Challenge hackathon</a></li>
<li><a href="../430482/index.html">Theme of armor lifts in the culture of East and West</a></li>
<li><a href="../430486/index.html">How do freelancers live: from developer to technical copywriter</a></li>
<li><a href="../430488/index.html">Asynchronous data exchange with a remote application via SSH</a></li>
<li><a href="../430490/index.html">To anticipate, train, decide: how and for what EPAM builds the Java Competency Center</a></li>
<li><a href="../430492/index.html">Intel Neural Compute Stick. Artificial mind on a flash drive - 2</a></li>
<li><a href="../430494/index.html">InfoWatch Traffic Monitor. On the blade of bugs and features</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>