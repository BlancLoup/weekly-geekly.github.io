<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using annotations in PHP 5.4 for AOP and more</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When developing large projects, quite often a situation arises when the end-to-end functionality, weakly related to business logic, is greatly inflate...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using annotations in PHP 5.4 for AOP and more</h1><div class="post__text post__text-html js-mediator-article">  When developing large projects, quite often a situation arises when the end-to-end functionality, weakly related to business logic, is greatly inflated, filling the code with similar constructions.  This can be logging operations, working with a cache or checking access rights.  Here <a href="http//ru.wikipedia.org/wiki/%25D0%2590%25D1%2581%25D0%25BF%25D0%25B5%25D0%25BA%25D1%2582%25D0%25BD%25D0%25BE-%25D0%25BE%25D1%2580%25D0%25B8%25D0%25B5%25D0%25BD%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">AOP</a> comes to the rescue. <br><br>  For PHP, there are several implementations of this programming paradigm.  Unfortunately, among them I did not manage to find a solution that could be easily incorporated into an already existing large project and satisfying the aesthetic requirements for the code. <br><br><h4>  AOP implementation technologies in PHP </h4><br><h5>  Magic methods </h5><br>  The simplest solution is to use the " <a href="http://www.php.net/manual/ru/language.oop5.overloading.php">magic methods</a> " __call and __callStatic.  These methods are called (if defined in a class) when accessing a nonexistent class method.  As arguments, they get the name of a nonexistent method and the parameters passed to it. <br>  In this case, the application is built in such a way that the actual methods have a different name from the name specified in their constructs.  End-to-end functionality is implemented in "magic methods", which, if necessary, transfer control to real class methods. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h6>  Pros: </h6><ul><li>  Easy to start using; </li><li>  The implementation does not require additional modules (native PHP). </li></ul><br><h6>  Minuses: </h6><ul><li>  It is not convenient to use with a large number of end-to-end functionality; </li><li>  Because  method names in the definition and in the calls are different, difficulties are created when using code completion in the IDE. </li></ul><br><h5>  Preliminary code review </h5><br>  This method implies the existence of a mediator that allows the use of "syntactic sugar".  The necessary functionality is described by auxiliary syntax (xml / json configuration, additional php-classes or annotations in the code), which is parsed by the intermediary.  Based on the parsing, a result code is generated that contains inserts of the end-to-end functional in the required places. <br><br><h6>  Pros: </h6><ul><li>  It works quickly, because  the output is plain PHP code, just generated for you automatically. </li></ul><br><h6>  Minuses: </h6><ul><li>  Difficult to implement in a big project; </li><li>  Code analysis is required after each change to make corrections to the resulting code. </li></ul><br><h5>  Replacing Application Code at Run Time </h5><br><a name="habracut"></a>  The well-known extension <a href="http://ru2.php.net/manual/ru/book.runkit.php">runkit</a> allows <a href="http://ru2.php.net/manual/ru/book.runkit.php">you</a> to change the script code during its execution.  Based on it, I developed a small library that allows you to quite simply solve the problem. <br><br>  Meet the: <a href="https://github.com/baryshev/Annotator">Annotator</a> . <br><br><h4>  Annotator features </h4><br>  The library implements 4 types of handlers: <br><br><h5>  Info </h5><br>  An Info type handler receives information about a method during class processing.  This allows you to "register" the method for future use in the application.  For example, with its help, you can assign a method to process a specific URL and thus implement routing in an application. <br><br><h5>  Before </h5><br>  A handler of the type Before is executed before the called method.  It gets all the necessary information about the called method including the input parameters that can be changed before transferring control to the called method. <br><br><h5>  After </h5><br>  An After type handler is executed after the method being called.  In addition to information about the method and its parameters, it also receives the result of the execution of the called method, which, if necessary, can be replaced. <br><br><h5>  Around </h5><br>  An Around handler is executed instead of the method being called.  Inside the handler, it is possible to manually transfer control to the called method, if necessary. <br><br><h4>  Installation </h4><br>  Annotator requires PHP 5.4 and a runkit module. <br><br><ol><li>  Downloading the extension from here: <a href="https://github.com/zenovich/runkit">https://github.com/zenovich/runkit</a> ; </li><li>  We assemble and install it: <br><pre><code class="bash hljs">phpize &amp;&amp; ./configure &amp;&amp; make &amp;&amp; sudo make install</code> </pre> </li><li>  If everything went well, we include the runkit.so module in conf.d or php.ini; </li><li>  <a href="https://github.com/baryshev/Annotator/blob/master/Annotator.php">We download the</a> class <a href="https://github.com/baryshev/Annotator/blob/master/Annotator.php">Annotator.php</a> and connect it to the project. </li></ol><br><h4>  Examples of using </h4><br>  The class provides 4 pre-reserved annotations for all types of processors, while it is possible to register your annotations of any of the 4 types. <br><br><h5>  Info </h5><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/Annotator.php'</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Advice</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">infoStatic</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($point, $options)</span></span></span><span class="hljs-function"> </span></span>{ var_dump($point); var_dump($options); } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@info</span></span></span><span class="hljs-comment"> Advice::infoStatic hello world */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testInfoStatic</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'info'</span></span>; } } Annotator::compile(<span class="hljs-string"><span class="hljs-string">'Test'</span></span>);</code> </pre><br>  Already during the call Annotator :: compile ('Test');  the infoStatic handler of the Advice class will be called, which will receive information about the testInfoStatic method of the Test class and the handler parameters as the array ('hello', 'world') array. <br><br><h5>  Before </h5><br>  In this example, we register our annotation instead of using the standard one, and use the object method instead of the static class method as the handler. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/Annotator.php'</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Advice</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($point, $params, $options)</span></span></span><span class="hljs-function"> </span></span>{ $params[<span class="hljs-string"><span class="hljs-string">'string'</span></span>] = <span class="hljs-string"><span class="hljs-string">'bar'</span></span>; } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@registered</span></span></span><span class="hljs-comment">_before */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testBefore</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($string)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $string; } } $advice = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Advice(); Annotator::register(<span class="hljs-string"><span class="hljs-string">'registered_before'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($advice, <span class="hljs-string"><span class="hljs-string">'before'</span></span>), Annotator::BEFORE); Annotator::compile(<span class="hljs-string"><span class="hljs-string">'Test'</span></span>); $test = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Test(); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $test-&gt;testBefore(<span class="hljs-string"><span class="hljs-string">'foo'</span></span>);</code> </pre><br>  Using the Annotator :: register method, we created the @registered_before annotation associated with the before method of the $ advice object.  When you call testBefore, the control will be passed to the handler, which will replace the $ string parameter and instead of the expected ‚Äúfoo‚Äù, the script will output ‚Äúbar‚Äù. <br><br><h5>  After </h5><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/Annotator.php'</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Advice</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">power</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($point, $params, $options, $result)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> pow($result, $options[<span class="hljs-number"><span class="hljs-number">0</span></span>]); } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@power</span></span></span><span class="hljs-comment"> 4 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testAfter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($number)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $number + <span class="hljs-number"><span class="hljs-number">1</span></span>; } } $advice = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Advice(); Annotator::register(<span class="hljs-string"><span class="hljs-string">'power'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($advice, <span class="hljs-string"><span class="hljs-string">'power'</span></span>), Annotator::AFTER); Annotator::compile(<span class="hljs-string"><span class="hljs-string">'Test'</span></span>); $test = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Test(); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $test-&gt;testAfter(<span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre><br>  In this example, the result of the testAfter method will be raised to the power of 4. The script will display the value 16. <br><br><h5>  Around </h5><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/Annotator.php'</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Advice</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $cache = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cache</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($point, $params, $options, $proceed)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (array_key_exists($options[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$cache)) { <span class="hljs-comment"><span class="hljs-comment">//       -   return self::$cache[$options[0]]; } else { //      -   $result = $proceed(); //          self::$cache[$options[0]] = $result; return $result; } } } class Test { /** * @cache around_cache_key */ public function testAround($string) { return $string; } } $advice = new Advice(); Annotator::register('cache', array($advice, 'cache'), Annotator::AROUND); Annotator::compile('Test'); $test = new Test(); echo $test-&gt;testAround('foo') . PHP_EOL; echo $test-&gt;testAround('foo') . PHP_EOL; echo $test-&gt;testAround('foo') . PHP_EOL;</span></span></code> </pre><br>  This example represents an implementation of a simple caching mechanism.  The testAround method is called 3 times in a row, but it will be executed only once.  The remaining 2 times the value will be taken from the static variable $ cache of the Advice class, where it will be saved after the first call. <br><br><h5>  Using multiple handlers </h5><br>  Annotator allows you to hang multiple handlers, including different types, on one method. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/Annotator.php'</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Advice</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($point, $params, $options)</span></span></span><span class="hljs-function"> </span></span>{ $params[<span class="hljs-string"><span class="hljs-string">'string'</span></span>] .= <span class="hljs-string"><span class="hljs-string">'before1'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($point, $params, $options)</span></span></span><span class="hljs-function"> </span></span>{ $params[<span class="hljs-string"><span class="hljs-string">'string'</span></span>] .= <span class="hljs-string"><span class="hljs-string">' before1'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($point, $params, $options, $result)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $result . <span class="hljs-string"><span class="hljs-string">' after1'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($point, $params, $options, $result)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $result .= <span class="hljs-string"><span class="hljs-string">' after2'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">around1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($point, $params, $options, $proceed)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $proceed() . <span class="hljs-string"><span class="hljs-string">' around1'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">around2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($point, $params, $options, $proceed)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $proceed() . <span class="hljs-string"><span class="hljs-string">' around2'</span></span>; } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@before</span></span></span><span class="hljs-comment"> Advice::before1 * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@after</span></span></span><span class="hljs-comment"> Advice::after1 * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@around</span></span></span><span class="hljs-comment"> Advice::around1 * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@before</span></span></span><span class="hljs-comment"> Advice::before2 * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@after</span></span></span><span class="hljs-comment"> Advice::after2 * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@around</span></span></span><span class="hljs-comment"> Advice::around2 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testMulti</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($string)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $string; } } Annotator::compile(<span class="hljs-string"><span class="hljs-string">'Test'</span></span>); $test = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Test(); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $test-&gt;testMulti(<span class="hljs-string"><span class="hljs-string">''</span></span>);</code> </pre><br>  As a result of this example, the string ‚Äúbefore1 before1 around1 around2 after1 after2‚Äù will be displayed. <br><br><h4>  Handlers </h4><br>  Each type of handler has its own set of parameters: <br><br><h5>  Info </h5><ul><li>  <b>$ point</b> - the method on which the handler is hung; </li><li>  <b>$ options</b> - an array of parameters specified in the annotation. </li></ul><br><br><h5>  Before </h5><ul><li>  <b>$ point</b> - the method on which the handler is hung; </li><li>  <b>$ params</b> - an array of parameters passed to the method when called; </li><li>  <b>$ options</b> - an array of parameters specified in the annotation. </li></ul><br><br><h5>  After </h5><ul><li>  <b>$ point</b> - the method on which the handler is hung; </li><li>  <b>$ params</b> - an array of parameters passed to the method when called; </li><li>  <b>$ options</b> - an array of parameters specified in the annotation; </li><li>  <b>$ result</b> is a variable containing the result of the method on which the handler is hung. </li></ul><br><br><h5>  Around </h5><ul><li>  <b>$ point</b> - the method on which the handler is hung; </li><li>  <b>$ params</b> - an array of parameters passed to the method when called; </li><li>  <b>$ options</b> - an array of parameters specified in the annotation; </li><li>  <b>$ proceed</b> - the function transferring control back to the method on which the handler is hung. </li></ul><br><h4>  Afterword </h4><br>  On the basis of the Annotator, you can very easily and quickly implement convenient mechanisms that allow you to greatly reduce the code and improve the structure of the application, simplifying its support.  For example, in addition to the implementation of AOP, it can be used to quite easily implement the <a href="http://ru.wikipedia.org/wiki/%25D0%2592%25D0%25BD%25D0%25B5%25D0%25B4%25D1%2580%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5_%25D0%25B7%25D0%25B0%25D0%25B2%25D0%25B8%25D1%2581%25D0%25B8%25D0%25BC%25D0%25BE%25D1%2581%25D1%2582%25D0%25B8">Dependency injection</a> pattern. <br><br>  It must be remembered that replacing methods during the execution of the script takes some time.  You should not call Annotator :: compile for classes that will not be used in this query.  The easiest way to do this is through <a href="http://php.net/manual/ru/language.oop5.autoload.php">automatic loading of php classes</a> . <br><br>  For long-lived applications (simple daemons or applications based on <a href="http://phpdaemon.net/">phpDaemon</a> ), the overhead applied will have almost no effect on performance, since  classes will be loaded and processed only 1 time. </div><p>Source: <a href="https://habr.com/ru/post/149102/">https://habr.com/ru/post/149102/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../149096/index.html">I probably know OOP. Experience in object-oriented programming and design. The answer is "not knowing OOP."</a></li>
<li><a href="../149097/index.html">AT & T will stop supporting 2G networks in five years</a></li>
<li><a href="../149098/index.html">Cyberpunk, matrices and canvas</a></li>
<li><a href="../149099/index.html">Interplay medium</a></li>
<li><a href="../149100/index.html">Writing Intellij IDEA plugin: Register file type</a></li>
<li><a href="../149103/index.html">AirOS vulnerability</a></li>
<li><a href="../149104/index.html">Shred and permanent file deletion</a></li>
<li><a href="../149105/index.html">NIC.AT: Austrian companies reacted to the new gTLD program "without much enthusiasm"</a></li>
<li><a href="../149106/index.html">8 of the worst websites in the world</a></li>
<li><a href="../149109/index.html">arcticModal - jQuery plugin for modal windows</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>