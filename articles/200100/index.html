<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Strengthening type control: where in the typical C # project there is an unsolicited element of weak typing?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Problem 
 We used to talk about languages ‚Äã‚Äãlike C # as strictly and statically typed. This, of course, is true, and in many cases the type indicated ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Strengthening type control: where in the typical C # project there is an unsolicited element of weak typing?</h1><div class="post__text post__text-html js-mediator-article"><h4>  Problem </h4><br>  We used to talk about languages ‚Äã‚Äãlike C # as strictly and statically typed.  This, of course, is true, and in many cases the type <b>indicated by</b> us for some linguistic entity well expresses <b>our idea</b> of its type.  But there are widespread examples when, out of habit, we (‚Äúand everybody does that‚Äù) put up with the not quite correct expression of the ‚Äúdesired type‚Äù in the ‚Äúdeclared type‚Äù.  The brightest are reference types that are without alternative equipped with the value ‚Äúnull‚Äù. <br><blockquote>  In my current project for the year of active development there was not a single NullReferenceException.  I can not without reason to believe that this is a consequence of the use of the techniques described below. </blockquote><br>  Consider the code snippet: <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IUserRepo</span></span> { <span class="hljs-function"><span class="hljs-function">User </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-function">User </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Find</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span>; }</code> </pre> <br>  This interface requires an additional comment: ‚ÄúGet always returns non-null, but throws an Exception if the object is not found;  and Find, not finding, returns null. "  ‚ÄúDesired‚Äù, implied by the author, the return types of these methods are different: ‚ÄúRequired User‚Äù and ‚ÄúMaybe User‚Äù.  And the ‚Äúdeclared‚Äù type is the same.  If a language does not force us to explicitly express this difference, then this does not mean that we cannot and should not do this on our own initiative. <br><a name="habracut"></a><br><h4>  Decision </h4><br>  In functional languages, for example, in F #, there is a standard type FSharpOption &lt;T&gt;, which is exactly the same for any type of container, in which there can either be one T value or be absent.  Consider what opportunities we would like to have from this type, so that they are convenient to use, including adherents of different coding styles with varying degrees of familiarity with functional languages. <br>  Given this hypothetical type, you can rewrite our repository in this form: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IUserRepo</span></span> { <span class="hljs-function"><span class="hljs-function">User </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-function">Maybe&lt;User&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Find</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span>; }</code> </pre><br><blockquote>  Immediately make a reservation that the first method can still return null.  There is no simple way to prohibit it at the language level.  However, you can do this at least at the agreement level in the development team.  The success of such an undertaking depends on the people;  In my project, such an agreement is accepted and successfully respected. <br>  Of course, you can go ahead and embed in the build process of checking for the presence of the null keyword in the source code (with the specified exceptions to this rule).  But in this there was no need, just enough internal discipline. <br>  In general, you can go even further, for example, forcibly inject into all appropriate Contract.Ensure methods (Contract.Result &lt;T&gt; ()! = Null) through some AOP solution, for example PostSharp, in this case even team members with low discipline will not be able to return the ill-fated null. <br></blockquote><br>  The new version of the interface explicitly declares that Find may not find the object, in which case it will return the value Maybe &lt;User&gt; .Nothing.  In this case, no one can forgetfully check the result for null.  Let's fantasize further about using such a repository: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//      null var user = repo.Find(userId); //    User,  Maybe&lt;User&gt; var userName = user.Name; //  ,  Maybe  Name var maybeUser = repo.Find(userId); //    , string userName; if (maybeUser.HasValue) //           { var user = maybeUser.Value; userName = user.Name; } else userName = "unknown";</span></span></code> </pre><br>  This code is similar to what we would write with null checking, just the condition in the if looks a little different.  However, the constant repetition of such checks, firstly, clutters up the code, making the essence of its operations less pronounced, and secondly, it tires the developer.  Therefore, it would be extremely convenient to have ready-made methods for most standard operations.  Here is the previous fluent-style code: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">string</span></span> userName = repo.Find(userId).Select(u =&gt; u.Name).OrElse(<span class="hljs-string"><span class="hljs-string">"unknown"</span></span>);</code> </pre><br>  For those who are close to functional languages ‚Äã‚Äãand do-notation, a completely ‚Äúfunctional‚Äù style can be supported: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">string</span></span> userName = (<span class="hljs-keyword"><span class="hljs-keyword">from</span></span> user <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> repo.Find(userId) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> user.Name).OrElse(<span class="hljs-string"><span class="hljs-string">"unknown"</span></span>);</code> </pre><br>  Or, the example is more complicated: <br><br><pre> <code class="cs hljs">( <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> roleAProfile <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> provider.FindProfile(userId, type: <span class="hljs-string"><span class="hljs-string">"A"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> roleBProfile <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> provider.FindProfile(userId, type: <span class="hljs-string"><span class="hljs-string">"B"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> roleCProfile <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> provider.FindProfile(userId, type: <span class="hljs-string"><span class="hljs-string">"C"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> roleAProfile.IsActive() &amp;&amp; roleCProfile.IsPremium() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> user = repo.GetUser(userId) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> user ).Do(HonorAsActiveUser);</code> </pre><br>  with its imperative equivalent: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> maybeProfileA = provider.FindProfile(userId, type: <span class="hljs-string"><span class="hljs-string">"A"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (maybeProfileA.HasValue) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> profileA = maybeProfileA.Value; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> maybeProfileB = provider.FindProfile(userId, type: <span class="hljs-string"><span class="hljs-string">"B"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (maybeProfileB.HasValue) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> profileB = maybeProfileB.Value; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> maybeProfileC = provider.FindProfile(userId, type: <span class="hljs-string"><span class="hljs-string">"C"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (maybeProfileC.HasValue) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> profileC = maybeProfileC.Value; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (profileA.IsActive() &amp;&amp; profileC.IsPremium()) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> user = repo.GetUser(userId); HonorAsActiveUser(user); } } } }</code> </pre><br>  It also requires integrating Maybe &lt;T&gt; with its fairly close relative - IEnumerable &lt;T&gt;, at least in this form: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> admin = users.MaybeFirst(u =&gt; u.IsAdmin); <span class="hljs-comment"><span class="hljs-comment">//  FirstOrDefault(u =&gt; u.IsAdmin); Console.WriteLine("Admin is {0}", admin.Select(a =&gt; a.Name).OrElse("not found"));</span></span></code> </pre><br>  From the above ‚Äúdreams‚Äù it is clear that I want to have a Maybe type <br><ul><li>  access to value availability information </li><li>  and to the value itself, if available </li><li>  a set of convenient methods (or extension methods) for streaming call style </li><li>  LINQ expression syntax support </li><li>  integration with IEnumerable &lt;T&gt; and other components, with which there are often situations of missing value </li></ul><br><br>  Let us consider what solutions Nuget can offer us for quick inclusion in the project and compare them according to the above criteria: <br><br><table><tbody><tr><th>  Package name Nuget and type type </th><th>  Hasvalue </th><th>  Value </th><th>  Fluentapi </th><th>  LINQ support </th><th>  IEnumerable integration </th><th>  Notes and source code </th></tr><tr><td>  Option, class </td><td>  there is </td><td>  no, only pattern-matching </td><td>  minimal </td><td>  not </td><td>  not </td><td>  <a href="https://github.com/tejacques/Option/">github.com/tejacques/Option</a> </td></tr><tr><td>  Strilanc.Value.May, struct </td><td>  there is </td><td>  no, only pattern-matching </td><td>  rich </td><td>  there is </td><td>  there is </td><td>  Accepts null as a valid value in May. <br>  <a href="https://github.com/Strilanc/May">github.com/Strilanc/May</a> </td></tr><tr><td>  Options, struct </td><td>  there is </td><td>  there is </td><td>  the average </td><td>  there is </td><td>  there is </td><td>  Also available as Either. <br>  <a href="https://github.com/davidsidlinger/options">github.com/davidsidlinger/options</a> </td></tr><tr><td>  Nevernull class </td><td>  there is </td><td>  there is </td><td>  the average </td><td>  not </td><td>  not </td><td>  <a href="https://github.com/Bomret/NeverNull">github.com/Bomret/NeverNull</a> </td></tr><tr><td>  Functional.Maybe, struct </td><td>  there is </td><td>  there is </td><td>  rich </td><td>  there is </td><td>  there is </td><td>  <a href="https://github.com/AndreyTsvetkov/Functional.Maybe">github.com/AndreyTsvetkov/Functional.Maybe</a> </td></tr><tr><td>  Maybe no type </td><td>  - </td><td>  - </td><td>  minimal </td><td>  not </td><td>  - </td><td>  extension methods work with the usual null <br>  <a href="https://github.com/hazzik/Maybe">github.com/hazzik/Maybe</a> <br>  upd: and here is a screencast from <a href="http://habrahabr.ru/users/mezastel/" class="user_link">mezastel</a> with a similar approach and a detailed explanation: <a href="http://www.techdays.ru/videos/4448.html">www.techdays.ru/videos/4448.html</a> </td></tr><tr><td>  WeeGems.Options, struct </td><td>  there is </td><td>  there is </td><td>  minimal </td><td>  not </td><td>  not </td><td>  There are also other functional utilities: memoization, partial application of functions. <br>  <a href="https://bitbucket.org/MattDavey/weegems">bitbucket.org/MattDavey/weegems</a> </td></tr></tbody></table><br>  It so happened that in my project my package has grown, it is among the above. <br><br>  From this table it can be seen that the easiest, minimally invasive solution is Maybe from <a href="http://habrahabr.ru/users/hazzik/" class="user_link">hazzik</a> , which does not require changing the API in any way, but simply adds a couple of extension methods to get rid of the same if-s.  But, alas, does not protect the forgetful programmer from receiving a NullReferenceException. <br><br>  The richest packages are Strilanc.Value.Maybe ( <a href="http://twistedoakstudios.com/blog/Post1130_when-null-is-not-enough-an-option-type-for-c">here the</a> author explains, in particular, why he decided that (null) .ToMaybe () is not the same as Maybe.Nothing), Functional.Maybe, Options. <br><br>  Choose to taste.  In general, I want, of course, the standard solution from Microsoft <s>, as well as functional types in C #, tuples, etc. :)</s> .  Wait and see. <br><br>  UPD: Comrade <a href="http://habrahabr.ru/users/aikixd/" class="user_link">aikixd</a> wrote an <a href="http://habrahabr.ru/post/200884/">opposing article</a> . </div><p>Source: <a href="https://habr.com/ru/post/200100/">https://habr.com/ru/post/200100/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../200084/index.html">High Level Programming in 1975</a></li>
<li><a href="../200086/index.html">Corona SDK will support Windows Phone 8 and Windows Store</a></li>
<li><a href="../200088/index.html">Color selection / niche search</a></li>
<li><a href="../200094/index.html">Creating informative graphics in CorelDraw X6</a></li>
<li><a href="../200096/index.html">How to bypass PopUp blocker in a browser in asynchronous requests</a></li>
<li><a href="../200102/index.html">One week in the life of Ekaterinburg MakeXLab hackspace</a></li>
<li><a href="../200104/index.html">Our hacker won the final Cyber ‚Äã‚ÄãChallenge in the EMEA region</a></li>
<li><a href="../200106/index.html">Stop using location.hash, long live the HTML5 History API!</a></li>
<li><a href="../200112/index.html">Cloud computing scenarios. Backup and resiliency in web, mobile and media scenarios</a></li>
<li><a href="../200114/index.html">Where jQuery stores event handlers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>