<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Configure Kannel SMS Gateway</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Several times there have been mentions of such wonderful software as kannel, but for some reason there are no specific descriptions of examples of its...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Configure Kannel SMS Gateway</h1><div class="post__text post__text-html js-mediator-article">  Several times there have been mentions of such wonderful software as kannel, but for some reason there are no specific descriptions of examples of its integration.  <a href="http://habrahabr.ru/blogs/telecom/98702/">Here</a> is an example of a service that can be implemented with an agreement with the mobile operator (Opsos), but it is still not clear how to do this.  I'll try to fix this situation. <br><a name="habracut"></a><br><h4>  Offtopic.  Why did I need it? </h4><br>  I have been working on a <a href="http://3gin.ru/">single project for a</a> long time, the essence of which is to conduct real city games under the flag of MegaFon.  At first they were games for which a simple online service on the Zend Framework was created, in which you could register, form teams, participate in games, get tasks, enter answers.  However, the organizers and I wondered how this process could be made more accessible to the masses and more mobile.  We decided to remake this platform for working with SMS.  It is said - done, I contacted Megaphone technicians, found out how we could receive and send SMS (of course, it was much more preferable to use http, because no effort was required to integrate it and many sms services provide such an opportunity) , in Megaphone gave only bare SMPP.  Nothing to do, I had to get out. <br><br>  I‚Äôve been looking for a good option for the gateway for a long time. Kannel has become such an option - an open-ended SMS, WAP gateway.  I was not interested in the WAP component, but it turned out to be a really high-quality solution for the SMPP-HTTP gateway (you can also use it to send and receive SMS using SMPP as a server, MySQL to receive and send messages as DB lines). <br><br><h4>  Let's go to practice. </h4><br>  In many ways, configs duplicate what I cited in my <a href="http://habrahabr.ru/blogs/voip/123380/">article on integration with Multifon</a> , however, here is an example of working with a cellular operator's SMPP. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I will skip part of the installation and initial configuration, you can read about them in the previously mentioned article. <br><br>  A bit of theory.  This system is a bit non-standard.  It consists of several detached demons.  There is a demon who oversees the others, and if the process dies, he starts it up again.  This daemon is registered at startup from rc.d or init.d; you can familiarize yourself with its parameters in launch scripts. <br><br>  <b>bearerbox</b> is the main daemon that keeps the SMPP connection as a client, works with 3G dongles, listens to the port for connecting other daemons. <br>  <b>smsbox</b> - a daemon responsible for receiving messages from a web service and sending them to bearerbox for sending <br>  <b>opensmppbox</b> is a daemon that works as an SMPP server to connect other clients.  It also connects to bearerbox and works through it. <br>  <b>wapbox</b> is a daemon that works as a wap gate.  Honestly, I really did not understand him. <br>  <b>sqlbox</b> is a great interesting daemon that can record incoming messages in MySQL database of a certain structure, as well as send SMS messages that are added to MySQL database.  This makes it possible to integrate sms directly into the model via MVC.  That is, sending is just creating and saving an sms object inside your MVC application, cool, huh?  And the reception is similar, however, in this case you will not receive a callback about the fact that you have received sms, you will have to run the script on the crown and it will be no longer realtime. <br>  Each of these daemons must have its own <b>run_kannel_box attached</b> .  This is a daemon warden, for which you need to additionally register in the startup scripts, if you want to run more than one bearerbox / smsbox / wapbox in your configuration or attach other daemons.  Or write your own scripts using the command line parameter --parachute (-P), as suggested in the <a href="http://geektimes.ru/users/zerkms/" class="user_link">zerkms</a> comments. <br><br><h5>  Config with comments </h5><br><pre><code class="bash hljs">group = core admin-port = 13000 <span class="hljs-comment"><span class="hljs-comment">#,             admin-password = pass #-,     (..    ) log-file = "/var/log/kannel/bearerbox.log" log-level = 1 #  ,    0. 1      . access-log = "/var/log/kannel/access_kannel.log" store-file = "/var/log/kannel/store_sms" smsbox-port = 13001 #,     - dlr-storage = internal sms-resend-retry = 1 # 1   . group = smsc smsc-id = povoljye smsc = smpp host = xxx.xxx.xxx.xxx #,     port = xxxx smsc-username = "name" smsc-password = "pass" source-addr-ton = 0 # 4      .      . source-addr-npi = 1 #   -  . dest-addr-ton = 1 dest-addr-npi = 1 system-type = VMA #-     ) throughput = 1000 #.   reconnect-delay = 5 #   connection-timeout = 120 # ,        N . transceiver-mode = true #,    !    ,        -   .       ,    ,    . denied-smsc-id = kemerovo #   -         SMS    SMSC.  SMS   round-robin,   ,    ,    SMS     . allowed-smsc-id = povoljye preferred-smsc-id = povoljye group = smsc #   smsc   .    -   ,    . smsc-id = kemerovo smsc = smpp host = xxx.xxx.xxx.xxx #  port = xxxx receive-port = xxxx smsc-username = "kemerovo" smsc-password = "pass" source-addr-ton = 0 source-addr-npi = 1 dest-addr-ton = 1 dest-addr-npi = 1 reconnect-delay = 5 system-type = VMA throughput = 1000 connection-timeout = 120 transceiver-mode = true denied-smsc-id = povoljye allowed-smsc-id = kemerovo preferred-smsc-id = kemerovo group = smsbox bearerbox-host = localhost sendsms-port = 13003 #,   smsbox  http    global-sender = 000037 #     log-file = /var/log/kannel/smsbox.log log-level = 0 access-log = /var/log/kannel/access_smsbox.log group = sendsms-user username = "user1" #,       SMS   http  password = "pass" concatenation = true #   max-messages = 20 #    default-smsc = povoljye group = sendsms-user username = "user2" password = "pass" concatenation = true max-messages = 20 default-smsc = kemerovo #ENGINE group = sms-service keyword = default # sms   .       . post-url = "http://example.com:8080/controller/action/tel/%p/time/%t/coding/%c/smsc/%i" # url   concatenation = true max-messages = 0 #  kannel  ,     http response.    , ..       .</span></span></code> </pre> <br><br>  <b>So, in this case, we looked at connecting to 2M MegaFon sms centers with separate sending, depending on the smsc parameter.</b> <br><br>  So we send SMS (see <a href="http://habrahabr.ru/blogs/voip/123380/">previous post</a> to the account of problems with encodings) <br><pre>  http://example.com:13003/cgi-bin/sendsms?smsc=$smsc&amp;username=user1&amp;password=pass&amp;coding=2&amp;to=79277777777&amp;text=some_text </pre><br><br>  And so we get the text of the SMS in our script (for example, PHP), in this case it is transmitted <b><u>in the body of the</u></b> POST request. <br><pre> <code class="php hljs">$msg = file_get_contents(<span class="hljs-string"><span class="hljs-string">'php://input'</span></span>);</code> </pre><br><br>  Again, in the presence of a firewall, it is necessary to open the corresponding ports when accessing outside or open a loopback when working from the inside. <br><br>  Of the links again cite <a href="http://www.kannel.org/download/kannel-userguide-snapshot/userguide.html">usergide</a> , because  he is quite exhaustive.  For experiencing problems with the connection - write in the comments or in the <a href="http://kannel.org/lists.shtml">dev mailing list</a> , there will help. </div><p>Source: <a href="https://habr.com/ru/post/124302/">https://habr.com/ru/post/124302/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../124294/index.html">Site like Obama's: so beautiful and glowing</a></li>
<li><a href="../124295/index.html">Osmand User Guide</a></li>
<li><a href="../124296/index.html">Risk Management and Pistachios</a></li>
<li><a href="../124297/index.html">Solving the time zone problem in a web application</a></li>
<li><a href="../124300/index.html">Mozilla is developing an alternative to OpenID</a></li>
<li><a href="../124305/index.html">Create an email newsletter that sells</a></li>
<li><a href="../124306/index.html">BitTorrent Inc will release a paid version of uTorrent</a></li>
<li><a href="../124310/index.html">DoS vulnerability in Open vSwitch</a></li>
<li><a href="../124311/index.html">The play "Developing a multiplayer online game." Part 3: Client-server interaction</a></li>
<li><a href="../124312/index.html">Amateur radio community</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>