<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Web installer on pure WINAPI with Hi DPI support and vector logo</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In our time, this is probably one of the main applications for applications written in pure WINAPI. Writing something more serious than a few simple w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Web installer on pure WINAPI with Hi DPI support and vector logo</h1><div class="post__text post__text-html js-mediator-article">  In our time, this is probably one of the main applications for applications written in pure WINAPI.  Writing something more serious than a few simple windows on pure WINAPI is no longer so fun, but a small installer is the best thing. <br><br>  Since it's 2018 in the yard, writing a simple application is somehow not very good.  Let's correspond to the trends of time - the installer will be with support for Hi DPI modes.  Even in laptops already 4K screens are not uncommon, what can we say about desktops.  Well, since the installer is something that should quickly boot, we will save on what is really not difficult to do yourself.  Well, let's try to cheat to use vector graphics without additional libraries - we need a beautiful logo! <br><br><img src="https://habrastorage.org/webt/nv/2f/gn/nv2fgnyzchl6wyfelhtebm7lao0.png"><br><a name="habracut"></a><br>  To begin with, the <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/mt843498">latest (for today)</a> manual from Microsoft is about how to write High DPI Desktop applications.  From it you can see what a difficult fate in the mode of support for different DPI in Windows applications.  And how many <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/hh447398(v%3Dvs.85).aspx">different functions</a> have already been added ... Before Windows 10, the system could only draw the font in accordance with the DPI, but at the same time the indents and other sizes terribly ‚Äúfloated‚Äù, and everything else was just stretched.  This mode is called XP style DPI scaling.  Starting with Vista, the system drew the application to the buffer and stretched the final image, but the result was also so-so - everything was blurry.  Starting with Windows 8.1, the system began to send a message about the DPI change on the fly, but only to the main window of the application.  Only now it is not necessary to close the user session to see the DPI changes.  And only in Windows 10, the system learned to redraw everything that is done through GDI (text and common controls) and then not immediately, but after Creators Update, but even Windows 10 cannot do everything: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/ze/8y/50/ze8y50fz_hurlfy84heiey4qory.png"><br><br>  So if you want to write DPI aware application, then according to the document you have to do UWP - only this framework supports DPI and will do everything for you.  All the rest will require manual control in one form or another. <br><br>  In fact, we don‚Äôt really need it - we draw everything, anyway.  At the start, we get the current DPI and listen to the message from the system - in order to change the DPI on the fly (if the system supports it).  Then just draw the windows / components as we need, taking into account the DPI, well, and update if the user decides to change the DPI while the program is running or drag the window to another monitor, where the DPI is different.  It‚Äôs impossible to use ommon ontrols, they don‚Äôt know how to react to the DPI change until Windows 10 1703 - so that‚Äôs all by yourself. <br><br>  I don‚Äôt like to write the window procedures in the ‚ÄúC‚Äù style, because wrappers were written on all the components - windows and controls.  There is not a lot of work here even from scratch (this is if you know everything in advance), and every WINAPI programmer already has such things in storerooms for a long time.  What we need: <br><br><ol><li>  Something abstract for windows (windows) </li><li>  Something abstract for controls </li><li>  Text element (textbox) </li><li>  Button text and effects (button) </li><li>  Progress indicator </li><li>  Link </li><li>  Checkboxes with text to select any settings (checkbox) </li><li>  Tricky element for vector logo </li><li>  Well, plus their different combinations </li></ol><br>  To tell the whole theory of the operation of windows and controls (this is also windows, by the way) in WINAPI is out of place.  In short, something like this: when a GUI element is created, the system returns its HANDLE (HWND) and it points to the data of the created element.  Elements and windows have a main procedure - which parses calls to an element and does (or does not) what they want from it.  The appeal to the element goes through messages (the message itself and two parameters to it: wparam and lparam).  In order to alter something, we redefine the main procedure on our own, process the messages we need and give control to the main procedure signaling - we need to sort things out further, or we have already done everything.  In other systems, the GUI is about the same - nothing complicated. <br><br>  Well, now you are a WINAPI programmer.  Nearly. <br><br>  What we ultimately do is the main window, where you can click a couple of buttons and select several options.  By clicking the Install button, we show a trendy progress indicator with a blurred background and we‚Äôll have it working, starting with Windows XP.  We take the dialog box as the basis - the easiest way. <br><br><img src="https://habrastorage.org/webt/pt/mx/mb/ptmxmbds_mepca4rj3wkeek0cls.png"><br><br>  Now let's take it in order - what we have with Hi DPI.  Windows itself defines DPI support (dpi aware) from the application side using the application manifest - it has been almost mandatory for some time.  In addition to DPI in Windows c 8.1, for example, <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms724439(v%3Dvs.85).aspx">the GetVersion function was changed</a> - if the manifest does not say which systems you support - GetVersion will return 6.2 (as if your application is running on Windows 8 on all systems older than Windows 8) or as close as possible from the list systems that you add.  So the manifesto is needed for many reasons.  An example of a manifest <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/dn481241(v%3Dvs.85).aspx">can be found here</a> , and all possible manifest options <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/aa374191(v%3Dvs.85).aspx">are listed here</a> . <br><br>  Our application can have 4 options for working with DPI: <br><br><ol><li>  <b>DPI Unaware</b> - knows nothing about DPI (the system will do everything, but how it will turn out) </li><li>  <b>System DPI Awareness</b> - we take the system DPI and at the start we initialize our application for it (Widows Vista) </li><li>  <b>Per-Monitor</b> - we take not the system DPI, but the monitor DPI on which the application is displayed.  We process messages when the user drags the application between different monitors with different DPI, but they only come to the top level window (Widows 8.1) </li><li>  <b>Per-Monitor (V2)</b> is the same as Per-Monitor, but the system sends messages to all of our windows.  Plus, the system itself adjusts the dimensions of the non-client part of the window, the common controls and the initial dimensions of the dialog boxes created via CreateDialog (Windows 10 starting with Creators Update build 1703). </li></ol><br>  In the last three modes, the system ‚Äútakes away hands‚Äù from our application (almost), does not touch anything and gives us all coordinates and dimensions in pixels without virtualizing them.  Of course, except for the above points.  Per-Monitor mode is best suited for us, and the capabilities of Per-Monitor V2 will only interfere. <br><br>  But there is not without problems, of course.  Since I like to make dialog boxes in the designer of Visual Studio - there is a serious problem.  Microsoft itself <a href="https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DPIAwarenessPerWindow/cpp">proposes to create interactive</a> applications manually and add all elements to the window manually too - for that I am sorry, I did not subscribe.  The problem is that the size of the dialog box in the resources (dialog template) is stored in the DLU (DIALOG UNITS).  And the current DLU value varies with the DPI of the system.  It turns out that both DPI and DIALOG UNITS overlap each other.  Moreover, on the fly they (DIALOG UNITS) do not change in contrast to the DPI and, after changing the DPI, they only work in a new session.  Moreover, if you use the <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms645475(v%3Dvs.85).aspx">GetDialogBaseUnits ()</a> function and try to calculate the changes, the size will float.  It turns out the calculation of the actual size of the window also depends on some parameters, which is indirectly confirmed by <a href="https://stackoverflow.com/questions/9458555/get-dialog-size-as-defined-in-resource-file/9458692">this message</a> .  That is, we will not be able to specify the initial and correct size at the start of the application.  I don‚Äôt want to give up the dialog designer, and so the code appeared that brings the initial size of the window and elements in the window as if it is always 96 DPI, and then we will change it depending on the DPI.  I had to write for this <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms645398(v%3Dvs.85).aspx">bypassing the resources of the dialogue</a> and its elements.  Further, the sizes of windows / elements are multiplied by the DLU by default, and our initialization window is brought to this form. <br><br>  But now everything is simple - after adjusting the size of the window and the elements at the start, we take the DPI by default (96) and do the initial initialization of the window size under the current DPI of our window, and we do the same with all the children in the window.  You can do this in one stage, but I left it in two.  But it is not at all clear what is happening there. <br><br>  But we must not forget that when the WM_DPICHANGED message arrives to the window, the first parameter is the new DPI, and the second is the recommended size and position of the window that the system sends us.  If you do not take this into account and consider it yourself - the window will shy away to the floor of the screen (well, depending on how you implement it) when you drag it between monitors with different DPI. <br>  That is, to do the size of the window itself - it is not necessary, the system will send us the desired size.  But the child windows need to be processed (we have the same per-monitor mode version 1). <br><br>  The application is implemented as a single window plus InstallManager with a variety of common properties and options (implemented through singleton).  So in my project is much more convenient, but here, too, does not seem to interfere. <br><br>  Now a detailed description of the project files.  Everything for windows in the folder: webinstaller \ windows \ <br><br>  Abstract, general class of windows <br><br><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractDialog</span></span></span></span></code> </pre> <br>  Base class - it is convenient to fumble the main functionality if there are several windows. <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseDialog</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> AbstractDialog</code> </pre> <br>  Pay attention to OnEraseBackground, there is implemented the possibility of a gradient background for the window.  To do this, use the WINAPI function GradientFill. <br><br>  If anything, then the background can be changed to the usual one in webinstaller \ install \ installer_constants.h, it is enough to remove the GRADIENT_BG declaration. <br><br>  Specific window - in our case the main <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainDialog</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> BaseDialog</code> </pre> <br>  Any utilities of varying degrees of utility <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> WindowsUtils</code> </pre> <br>  For example, RectHolder, which is inherited from the RECT structure and contains several additional methods of the type - Width and Height.  Otherwise it is very annoying to write blablabla.bottom - blablabla.top, etc. <br><br>  And the replacement MulDiv (MultiplyThenDivide), which does not round the result, otherwise I can get out unpleasant size jumps for small values ‚Äã‚Äã(important for fonts). <br><br>  Yes, by the way, all this is partially torn out from the live project, which is noticeably more complicated than this, so do not judge it - all sorts of oddities are available.  In some places it was necessary on the fly to add what was needed instead of what was cleaned and it looks illogical.  In the end, this is an example.  Well, loading, unpacking, installing are done with a stub - this is all very easily done <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/aa385473(v%3Dvs.85).aspx">through the WinInet functions</a> and is not very relevant to the main topic of the article. <br><br>  And what do we have with the controls ... In terms of DPI support - everything is simple, it makes the window.  And the rest of the implementation is also not particularly difficult. <br><br>  Everything is in the folder: webinstaller \ ui \ <br><br>  Base class for ui elements <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseControl</span></span></span></span></code> </pre> <br>  Our static element, well, just text <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StaticControl</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> BaseControl</code> </pre> <br>  What is interesting, since it may be necessary to redraw an element without redrawing the window, and we can have a background with a gradient - when you first draw, you have to save the background under the element and draw it every time.  And there is still a small flaw, sometimes this buffer is read when the window has not cleared it and when redrawing over it, the text becomes slightly fatter.  Suddenly find how to get around :) <br><br>  Text that link <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LinkControl</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> StaticControl</code> </pre> <br>  Sly element that allows you to add text and several links (bottom line in the window) <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CompositeLinkControl</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> LinkControl</code> </pre> <br>  Made to be convenient to write about the user agreement and privacy policy.  If to do separate elements, then there will be a trouble with indents and alignment. <br><br>  Progress indicator <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProgressControl</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> BaseControl</code> </pre> <br>  A regular base element that draws a bar in two colors depending on the data.  Plus the marquee mode (it's hard to find some correct description in Russian in one word).  This is when we do not know exactly how long the operation will take and just draw a short strip that crawls around the indicator in a circle.  To do this, call the function of the element by timer from the window with parameters 0, 0. <br><br>  Square button <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RectButtonControl</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> LinkControl</code> </pre> <br>  The button is conditionally square, if you set the color specifically for the button, then the background will be and the edges of the background will be rounded and smeared - for beauty, of course. <br>  The text in the button can be drawn with a shadow. <br><br>  Our cunning element for a vector logo (etc.) <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LayeredStaticControl</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> StaticControl</code> </pre> <br>  Let's start from afar.  Since the size of ours is not one and not two (100%, 125%, 150%, 175%, 200% ...), stocking up with pictures for all resolutions looks wasteful, at the same time the logo is usually a vector.  But Windows doesn‚Äôt support anything other than EMF, and this is essentially the <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms536391(v%3Dvs.85).aspx">GDI / GDI + call log</a> for EMF / EMF +.  The option is not bad, there are some restrictions, but if you need to do something quite complicated and you can wrap the image you need into EMF +, that‚Äôs what it is.  Tweak the rendering for a decent blur of edges and may even be nice.  It is only necessary to use GDI + 1.1 and at a minimum it is Windows Vista (the essence is in the <a href="https://msdn.microsoft.com/en-us/library/ms535281.aspx">Metafile.ConvertToEmfPlus</a> function).  Normal EMF will not blur the edges (antialiasing). <br><br>  If you do not use GDI +, then only one vector component of Windows remains - this is font rendering.  And since it is carried out in one color, you will have to disassemble the logo into colors. <br><br>  That's what layered_static_control is for.  Several symbols are taken and drawn one after another with the desired colors.  In fact, the typefaces of characters and so complex in the font - so there is nothing particularly new.  Unless we will not be able to use this mechanism, since it is inside the component and the color cannot be changed. <br><br>  For example, I took the <a href="">SVG mouse from Twitter</a> 'a, disassembled it into 4 parts by the number of colors, took the OpenSans font and put them there instead of the characters of the brackets, correcting quite a bit.  All this is done in half an hour in a convenient open source editor - <a href="https://fontforge.github.io/">FontForge</a> .  At the same time we will have a nice font in the window. <br><br><img src="https://habrastorage.org/webt/gl/fx/mn/glfxmnao3f9baqpl5_vvycsc1hs.png"><br><br>  I uploaded SVG to Illustrator, unloaded into SVG already in parts.  I uploaded to FontForge and in FontForge itself corrected that the contours were closed.  To do this, call the element error check in FontForge: Element -&gt; Error Check -&gt; Outlines -&gt; Open Outlines.  After checking, he will highlight the desired point and you just need to grab, move and put in the same place - he closes this circuit. <br><br>  Then there are two important steps: do not forget to set characters to the same size / metrics (themes that we use for layers) and change the name of the font (its properties in FontForge); otherwise, when we try to download it into the application, it may turn out that it is already installed system (original) will be used in the system. <br><br>  By the way, since we save space, you can delete all unused characters from the font, it will then become very small (Russian + English letters + numbers and signs - 29kb).  The main thing is careful, many characters in the font are compound.  The top dash in the letter, for example, is located at the very end of the OpenSans font and is visible as a separate element. <br><br>  We add layers and their color to the element itself - everything is simple. <br><br>  Parts of the logo / symbols can be drawn with gradients - for this you need to use GDI +, there are gradient brushes.  It is necessary to make only new implementation of StaticControl and LayeredStaticControl under GDI +. <br><br>  By the way, the button for closing the window is still not quite similar to the letter X, therefore it is also made separately in the font (instead of \). <br><br>  Element to select options and settings (checkbox) <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CompositeCheckboxControl</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> CompositeLinkControl</code> </pre> <br>  Here, too, it was not without a vector, somehow it‚Äôs necessary to draw a daw and everything else.  As I wrote earlier, only Windows 10.1703 can redraw common controls.  Everything is similar to the example with the mouse in the logo, you need a frame, a clean background and the checkbox itself. <br><br>  In terms of functionality, if you really want to install something with your program (and suddenly) or mention something especially important, you will need some kind of reference to the agreement separately.  It is here provided as a separate element. <br><br>  An element for choosing which itself changes the status of the selected option in InstallManager - otherwise it inherits the CompositeCheckboxControl <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OptionCheckboxControl</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> CompositeCheckboxControl</code> </pre> <br><br>  Application manifest <br><br><pre> <code class="cpp hljs">webinstaller\installer\install.manifest</code> </pre> <br>  Pay attention to the line: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dpiAware</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/SMI/2005/WindowsSettings"</span></span></span><span class="hljs-tag">&gt;</span></span>True/PM<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dpiAware</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  This is what we say to the system that we support the DPI per Monitor mode.  All other DPI <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/aa374191(v%3Dvs.85).aspx">options are listed here</a> . <br><br>  Singleton manager <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InstallerManager</span></span></span></span></code> </pre> <br>  Various system functions (wrappers) <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> SystemUtils</code> </pre> <br>  From the resources we have only the font and icon <br><br><pre> <code class="cpp hljs">webinstaller\installer\resources\webinstaller.ttf webinstaller\installer\resources\webinstaller.ico</code> </pre> <br>  Well, in general, that's all.  160kb for everything about everything (of course, without downloading from the network, but this is a few kb from strength). <br><br>  What we have as a result of DPI in WINAPI applications: <br><br>  If you do not draw all the elements of the window yourself - then you can shift almost all the problems with drawing on Windows, but only starting with Windows 10.1703.  Solving problems in this case is necessary only with raster graphics.  It is enough to add a special option - gdiscaling to the application manifest and set it to true.  <a href="https://blogs.windows.com/buildingapps/2017/05/19/improving-high-dpi-experience-gdi-based-desktop-apps/">It describes in detail</a> how it works.  Of course, if you use GDI for drawing or your framework uses GDI. <br><br>  If you do not add raster image sets to the application, you can take a larger size and simply reduce it via GDI + for the desired resolution - there is a fairly decent interpolation algorithm.  Microsoft itself <a href="https://msdn.microsoft.com/en-us/library/ms533836(v%3Dvs.85).aspx">advises him</a> . <br><br>  In general, it turns out or do it yourself, or leave it at the mercy of the system.  Moreover, Microsoft is preparing a <a href="https://www.comss.ru/page.php%3Fid%3D4808">new option in Spring Creators Update</a> - to allow Windows to correct application blur.  How it works is not yet clear, but most likely forcibly includes GDI scaling. <br><br>  And, of course, the <a href="https://github.com/crea7or/webinstaller">repository with the application on github</a> . </div><p>Source: <a href="https://habr.com/ru/post/346274/">https://habr.com/ru/post/346274/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../346264/index.html">Technical Debt Management</a></li>
<li><a href="../346266/index.html">The effect of group polarization and its mathematical modeling</a></li>
<li><a href="../346268/index.html">Physical simulation on the GPU using the compute shader in the Unity3D environment</a></li>
<li><a href="../346270/index.html">We work with smart cards using Python (part 1)</a></li>
<li><a href="../346272/index.html">"Simple" python programming</a></li>
<li><a href="../346276/index.html">Developing a cool GUI on esp8266 with the uGFX library</a></li>
<li><a href="../346284/index.html">We select passwords using Google Chrome</a></li>
<li><a href="../346286/index.html">We write our own miniature Redis server in Python</a></li>
<li><a href="../346290/index.html">Testing of software documentation</a></li>
<li><a href="../346292/index.html">We turn speakers into speakers # 2: analysis of the speech of Artem Danilov, Avito</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>