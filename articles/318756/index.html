<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How 10 years ago the project PVS-Studio started</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ten years ago we created a simple utility called Viva64, designed to detect some problems in 64-bit code. This was the beginning of the static code an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How 10 years ago the project PVS-Studio started</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/2a1/35a/43f/2a135a43f94d625e0d33a331aa6cf8e3.png" alt="Unicorn"><br><br>  Ten years ago we created a simple utility called Viva64, designed to detect some problems in 64-bit code.  This was the beginning of the static code analyzer PVS-Studio.  Although 10 years have passed since that moment, something more or less with us, like a company, began to turn out only a few years ago.  This article is not a success story, as we believe that everything interesting is just beginning.  However, 10 years is a reason to sum up the interim results and tell our readers how it all began, what mistakes we were waiting for, and what we have done so far.  In some places, I may not be quite chronologically accurate when describing events.  My memory is not perfect, and 10 years is a long period of time.  I wish you all a pleasant reading. <br><a name="habracut"></a><br><h2>  Prehistory </h2><br>  I (Andrei Karpov) and Evgeny Ryzhkov worked in a small Tula company engaged in the creation of packages of numerical modeling and data visualization.  The work was interesting and managed to touch the most advanced technologies of the time.  For example, working with data visualization tasks, we experimented with 3D glasses, which work on the principle of alternating eye closure.  Images were displayed on a CRT monitor, which showed the image for the left, then for the right eye.  I think very few people have seen such antiquity: glasses connected to a computer via a wire, and a CRT monitor operating in interlace mode (100 frames per second), so that each eye has at least 50 frames.  It looked, in fact, all this was terrible, and my eyes instantly began to hurt, so it‚Äôs not surprising that this technology did not take root widely. <br><br>  Also, for example, we were engaged in independent manufacturing of a budget cluster based on ordinary computer motherboards.  We used boards with two physical AMD processors.  Now you will not surprise anyone with an 8-core processor.  At the same time in Tula shop motherboard with two cores - it was a wonderful miracle, a marvel.  We combined 4 such boards and got an 8-core mini-cluster, where we carried out various calculations.  I directly participated in the soldering of this device: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p><img src="https://habrastorage.org/getpro/habr/post_images/de3/547/a20/de3547a20cd9d45342e3a2e8d281ef3e.png" alt="Figure 1. A mini cluster assembled from scrap materials. Features: 8 processors, 16 gigabytes of memory."></p><br>  <font color="#999999"><i>Figure 1. A mini cluster assembled from scrap materials.</i></font>  <font color="#999999"><i>Features: 8 processors, 16 gigabytes of memory.</i></font> <br><br>  It didn‚Äôt work out very well, as the issue of ventilation could not be properly resolved and I had to sacrifice beauty to remove the back covers.  However, the cluster coped with its tasks. <br><br>  We also ran into the first 64-bit computers available for ordinary users.  These were machines with <a href="https://ru.wikipedia.org/wiki/Opteron">Opteron processors</a> and a huge, as it seemed to me, memory capacity of 4 gigabytes.  But with these machines it all started. <br><br>  In 2005, Visual Studio 2005 was released, in which it became possible to develop 64-bit programs for 64-bit architecture (at that time it was called AMD64).  I also remember I went to Moscow to a conference of the Microsoft company, where they showed how now it is easy and simple to recompile the code for a 64-bit processor.  In general, 64-bit - this was a new important trend in the development of computers. <br><br>  Of course, there were 64-bit microprocessors before that.  For example, you can remember the same <a href="https://ru.wikipedia.org/wiki/Itanium">Itanium</a> .  But it was the appearance of AMD64 that had a significant impact on the IT industry: 64-bit processors appeared available to the average user, and applied Windows programmers had the opportunity to write programs for these processors in the usual Visual C ++ development environment. <br><br>  In tasks of visualization and numerical simulation, a large amount of memory is extremely important.  Therefore, immediately with the release of Visual Studio 2005, we began work on creating 64-bit versions of applications. <br><br>  It is not surprising that we were one of the pioneers who adapted their application code to 64-bit processors and, as a result, stepped on many new rakes.  For example, it turned out that the hardware security keys used for software distribution are not quite ready for 64 bits.  I do not remember what exactly was wrong, but I had to tinker with the new version of code protection.  There were also some nuances with the program for creating distributions.  But all this - little things.  The most interesting was waiting for us further. <br><br>  Microsoft did not deceive us, we really quickly managed to recompile our applications in x64 mode.  It took about 3 weeks.  And as it seemed to us then, we received a 64-bit distribution of our applications. <br><br>  Ha!  That's just the program did not work correctly.  And in their wrong work was some kind of meanness.  Programs successfully passed all internal tests, correctly worked on test data.  But when we wanted to use all the power of a 64-bit application, strange strange errors began.  The program began to fail when allocated more than 10 gigabytes of memory for processing large sets of input data. <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/fef/89d/cf6/fef89dcf605dfe1898d9d77278fc9f83.png" alt="Figure 2. I have not saved any pictures that demonstrate rendering errors in a 64-bit application. I could not assume that in many years I would need them. But this picture is very similar to the result of the errors that I observed. Unexpectedly, only part of the object could be rendered."></p><br>  <font color="#999999"><i>Figure 2. I have not saved any pictures that demonstrate rendering errors in a 64-bit application.</i></font>  <font color="#999999"><i>I could not assume that in many years I would need them.</i></font>  <font color="#999999"><i>But this picture is very similar to the result of the errors that I observed.</i></font>  <font color="#999999"><i>Unexpectedly, only part of the object could be rendered.</i></font> <br><br>  Now I know all the reasons that led to such strange behavior of programs.  Somewhere the pointer was turned into an <i>int</i> , and then back into the pointer.  If the pointer referred to an object in the lower 4 gigabytes of memory, then everything was fine.  But if the object was created abroad in 4 gigabytes, then problems were inevitable. <br><br>  There were errors in the calculations of the form: <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> X, Y, Z; Uint64 Q = X * Y * Z;</code> </pre> <br>  Although the result is a 64-bit variable, this does not help.  Overflow occurs when multiplying 32-bit variables. <br><br>  Naturally, there are many other ways to shoot yourself a leg.  You can learn more about all these troubles here: " <a href="http://www.viva64.com/ru/a/0065/">A collection of examples of 64-bit errors in real programs</a> ." <br><br>  Then, in 2005, what was happening with our programs looked like incomprehensible magic.  And most importantly, at that moment we did not understand how we could find and eliminate defects.  All of our methods unexpectedly refused us. <br><br>  I repeat that unit tests work correctly and do not reveal anything.  On small test data, everything is fine too.  Debugging on large amounts of data is almost impossible.  First, it is very slow.  If the release of the program should work for half an hour in order for errors to begin to manifest themselves, then the debug version of the program works for long hours.  Secondly, it is not clear, and what, in fact, in the debugger to watch.  Do not study the billions of iterations of the cycle to find when something starts to go wrong.  When debugging, programmers always try to use the minimum data set to reproduce the error.  And here on the small sets everything is fine. <br><br>  We turned to the then popular BoundsChecker program, which had helped us more than once.  It just turned out that she still does not know how to work with 64-bit applications.  However, if I worked, I don‚Äôt think it helped us a lot.  The speed of the program when using BoundsChecker slows down tenfold.  I think for our cases this would have resulted in days of waiting. <br><br>  We understood that a deadlock had come: we know that there are errors in the program, but we don‚Äôt know how to look for them. <br><br>  Our team began to study the situation in more detail.  Conducted experiments, read the Internet.  Gradually it became clear what we were facing.  We began to understand what mistakes live in our programs, only it didn‚Äôt make it any easier.  Suppose we suspect that overflows in arithmetic operations are to blame for some errors.  So what's next?  How to find them, these places? <br><br>  From despair, we began to look for new ways.  The option to replace all integer types with special classes, such as SafeInt, was considered.  This would at least make it easy to find integer overflows.  However, it turned out that to make it for existing applications is very difficult. <br><br>  Then we got acquainted with some static code analysis tools and even bought <a href="http://www.gimpel.com/html/index.htm">Gimpel PC-Lint</a> .  But this analyzer almost did not help us.  It was not focused on finding 64-bit errors. <br><br>  And here we realized the consequences of the fact that we are pioneers.  We are faced with 64-bit errors for which the world has not yet offered any solutions. <br><br>  How did we get out of the situation?  We decided to read the code.  Of course, not all.  We configured PC-Lint so that it issues warnings on all explicit type conversions, on an implicit <i>int</i> extension to 64-bit types, and so on.  Of course, it turned out an incredible amount of useless messages, but it's still better than just reading all the code from beginning to end. <br><br>  We studied the potentially dangerous places to which, after special configuration, we were pointed out by PC-Lint.  Fully read the most important modules and functions.  And now, after a few months, we finally got a stable version of 64-bit applications. <br><br>  As you may have guessed, two people were engaged in porting to the 64-bit system: me and Yevgeny Ryzhkov. <br><br>  The conclusions we then made: <br><br><ul><li>  when switching to 64-bit systems, people will encounter 64-bit errors in their code; </li><li>  these errors are very difficult to look for; </li><li>  There are no tools to help find such errors. </li></ul><br>  At about the same time another fateful event took place.  Yevgeny Ryzhkov became interested in reading books about startups and the new-fangled ISV (Independent software vendor).  However, the word "startup" then, it seems, was not yet.  In any case, in the sense in which there is now. <br><br>  11 years ago, the phone industry was not yet developed, the App Store did not exist, and the like.  If there were, Eugene, perhaps, would be engaged in the creation of games for phones and tablets.  At the same time he was limited to an ordinary computer.  He tried to make an application - a coloring for children, and tried to sell.  In general, it was possible to realize everything and even make a few sales, but, of course, there was no need to talk about any success and income from this undertaking.  He began to look for a new application of his forces. <br><br>  I also had an entrepreneurial spirit, and I wanted to try to create something of my own.  However, at that time all these thoughts were fuzzy and did not find any real incarnation.  And then Eugene suggested thinking about creating something that would conquer the world and make us rich and famous.  In general, I infected a classic startup starter.  And we started thinking. <br><br><h2>  Viva64 version 1.0 </h2><br>  So, there are: <br><br><ol><li>  two people who want to start a startup; </li><li>  these two people are familiar with the existence of the problem of finding errors in 64-bit programs in C ++. </li></ol><br>  It would seem, so what is there to think about?  We must make and sell a tool to search for 64-bit errors.  However, we have long enough come to this idea.  It seemed to us that this is a complex, incomprehensible task that no one knows how to solve, since there are no tools yet. <br><br>  At the beginning we went over some simple and clear ideas.  Sites do not want to.  I wanted to create exactly the finished software product.  But this is what the world has to offer - we did not understand for a long time.  I wanted to choose a direction in which there can be real demand, and not just an abstract beautiful idea. <br><br>  After a while, we started thinking about the tool for searching 64-bit errors in C and C ++ programs.  For a start, we figured out exactly what it should be.  At first we thought about some kind of dynamic analyzer, such as BoundsChecker.  However, it was too difficult, plus it was not clear how to make the search for errors of some species. <br><br>  Gradually, it became clear to us that this should be a static code analyzer.  Those.  a program that points programmers to code points that need to be checked.  It was necessary to create a tool like PC-Lint or Parasoft C ++ test, but only focused on finding specific types of errors. <br><br>  An important question was whether it was possible for us to make such a tool at all, after all it was a question of parsing C ++ code.  I had to study this question. <br><br>  There was no LLVM at that time, so we considered the option to use the GCC compiler or one of the free libraries as a basis.  It is clear that there were also paid libraries for parsing C ++ code, but we didn‚Äôt even consider them.  GCC seemed to us to be too complicated and ponderous, plus it was not clear if it was possible to somehow create a closed application based on it.  Open did not want to do, because it is not clear how to earn it.  As a result, the choice fell on the little-known OpenC ++ library.  By this time the library was abandoned, but this did not stop us, especially since it seemed very simple, and we very quickly were able to write the simplest test diagnostics with its help. <br><br>  And so we decided and decided that we would do a tool to search for 64-bit errors in C / C ++ code.  In fact, it will be a classic static code analyzer, but at that time we tried not to use these words.  It seemed to us that this would only confuse people who would search the Internet for ‚Äúa tool for finding 64-bit errors‚Äù. <br><br>  Having experience with Gimpel PC-Lint, we immediately decided that we would do the tool as a plug-in to Visual Studio.  In those days, to use PC-Lint from Visual Studio, you had to dance with a tambourine.  Later I even wrote a short note on this topic, which, by the way, was popular: <a href="http://www.viva64.com/ru/a/0033/">Installing PC-Lint and using it in Visual Studio 2005</a> .  In general, we believed that such integration is no good and we must immediately provide users with a convenient interface.  Those.  the person must install the tool and immediately be able to proceed with the verification of the project.  It is this principle that our team still follows and considers it very important. <br><br>  At that time, we imagined Viva64 as a simple utility that we would sell for only $ 200, but massively.  We thought that this tool should sharply demand in connection with the global rewriting of programs for 64-bit processors.  The plan was this: we make a simple tool, which will soon be in great demand, we sell it 3-4 years.  Then, having earned money on this ingenious foresight, we will be engaged in some other project.  In general, youthful fantasies about what a cool idea we came up with and how quickly we will rise on it.  Even such a graph was drawn about how, in our opinion, the demand should look like: <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/234/759/b9c/234759b9cd4a8f659b274d31271e2953.png" alt="Figure 3. In 2006, Eugene drew such a graph of the alleged relevance of the solution for testing C ++ code for compatibility with the AMD64 platform. It was assumed that in 2010 the demand will decline and, in addition, Microsoft will release some kind of standard solution that will push the Viva64 analyzer out of the market. However, in 2-3 years we hoped to remove the &quot;cream&quot; and &quot;quot;&quot; and save money for future endeavors."></p><br>  <font color="#999999"><i>Figure 3. In 2006, Eugene drew such a graph of the alleged relevance of the solution for testing C ++ code for compatibility with the AMD64 platform.</i></font>  <font color="#999999"><i>It was assumed that in 2010 the demand will decline and, in addition, Microsoft will release some kind of standard solution that will push the Viva64 analyzer out of the market.</i></font>  <font color="#999999"><i>However, in 2-3 years we hoped to remove the ‚Äúcream‚Äù and save money for future undertakings.</i></font> <br><br>  Having inspired ourselves with dreams of success, we started programming, creating a distribution kit and the first version of the site.  All this was done in the evenings, as during the daytime we still worked in the office at work.  The path from the idea to the first version took about a year. <br><br>  And here was a landmark event: December 31, 2006, we posted the first public release of Viva64 version 1.00 on the Internet.  I remember Eugene told me that it is necessary to lay out before the new year, so that 2006 will appear in the version history.  It will seem to users that the tool already exists for at least a year, and this will give it solidity.  Now, after a long journey of 10 years, it all looks naive, but then it all seemed very important. <br><br>  The budget for creating the first version of the analyzer and the site was 43200 rubles.  Naturally, our time and energy are not included here.  These were additional expenses.  To make it easier to understand the amount, we will recalculate at the dollar rate of those times and get $ 1710.  We can say that we all did almost no spending. <br><br>  Since 2007, we began to try to sell our instrument, gradually improving it.  Work added even more.  In addition to programming on previous work and programming of the analyzer, added work to promote Viva64 among programmers.  Eugene and I began to learn how to write articles, communicate in forums, and try out some variants of paid advertising. <br><br>  All this very quickly exhausted our moral and physical strength.  In addition, in the previous work, everything was not so bright and rosy.  We realized that we could no longer work in this mode and quit, temporarily becoming unemployed. <br><br>  And sales did not go and did not go.  Rather, we managed to sell something a little bit, but so little that it makes no sense to talk about it.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We did not even try to withdraw the money accumulated on the reseller account, as they would not help us. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It was a difficult phase. Cash reserves melted, and there was no place to replenish them. There was a great temptation to quit and just get a job somewhere. But we held on. We were reassured by the idea that programmers are always in demand everywhere, and if everything becomes really sad, we will work somewhere during the week.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We were looking for some options to find money to continue development and believed that we had to hold on a little bit and the growth in demand for our tool would begin. I already poorly remember our chaotic actions of that time. I remember, for example, a trip to Sergey Lisitsyn at AutomatedQA, whose development office is located in Tula. We tried to interest him in our work. But what we were doing was somehow not met with any interest. Although, perhaps, we just knocked on the wrong door or did not know how to tell about ourselves.</font></font><br><br>   - ,    Viva64      .       .     ,    .      Ingate  Intelsys.          .      ,    .       ,     . ,     CAD .    ,       .   ,   NURBS . <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/f01/3eb/97c/f013eb97ccba71fbf5b57a65cad55c71.png" alt=" 4.          .  ,     ,       ,     ,     ."></p><br> <font color="#999999"><i> 4.          .  ,     ,       ,     ,     .</i></font> <br><br>     . 8      CAD ,   ,    ,   Viva64, , -   . ,          ,     .   ,  .        . , ,   -   ,       .   ,     . <br><br>   Viva64  ,   .   ,      .     ,   ,  -  64-    . <br><br>   ,    64-      .       32-  64- .    .       PVS-Studio,  - ,        ,   64-. <br><br> ,   64-     ,  .      ,        64-   .  10      Viva64,    PVS-Studio   64- .       .  ,      2-3 ,      . ,     ,  .    ,    ,      10 . <br><br> ,    ,   .        ¬´64- ¬ª    . <br><br><h2>  2008,   </h2><br>  ,  2008        . ,       2007 ,     2008.    ,   .   : <br><br> ¬´  ‚Äî  ,       , ,        - ,          .    ,   ‚Äû‚Äú        ,          ¬ª. <br><br>    ,    :     .        ,     .   ,       ,    . , <a href="http://fasie.ru/programs/programma-start/"></a>   . <br><br>          .   ,        .   ,       .  ,      .              . <br><br>       . ,    (   750 000   ).        .     , ,      .    ,   .  ,  -      ,     .      .     -     . <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/827/2a9/747/8272a97473f3b841f079f13c41239920.png" alt=" 5.  &amp;quot;&amp;quot;, 2008 .      ."></p><br> <font color="#999999"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 5. OOO ‚ÄúProgram Verification‚Äù, 2008. The first day in the first own office.</font></font></i></font> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In total, participation in the Start program made us leave the house and start not playing the Viva64 project, but actually doing it. Start pushed us to register an LLC, hiring the first employees, and generally made us feel like the real organizers of the company.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This is the main value of this program for us. She organized us and made us think about ourselves not just as programmers with an interesting technical project, but as entrepreneurs. This program has become a kind of catalyst for our project. She forced out of the comfort zone and begin to deal with new issues and challenges. For this thanks to the government and everyone who organizes this program.</font></font><br><br>  This ends the good.    .   ,          .    ,   ,  .         ,   .   ,   ,  .  ,      . ,        ,    ,    . ,        . <br><br>   ,   :         .  -    ¬´ ¬ª,      .      .  ,  ,  ,     :         . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It was "Hell." And when the year 2008 ended, we decided that we would not try to extend our participation in the Start program. The bureaucracy takes too much, and the time and effort we spend on it is wasted. At that time, some sales of Viva64 started to go on the sly, and we saw that we clearly were devoting less effort to the project than we could. We decided that we would rather tighten our belts, but then we would be more engaged in promising areas, and not in printing Talmud reports. We did not apply for the next year. From the side of such a decision, it may seem silly. But I am sure that then we did the right thing and, perhaps, saved ourselves 1 or 2 years. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I mentioned that some sales of Viva64 began.</font></font> Yes exactly.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And we began to gradually increase the price, since the clients were large companies. </font><font style="vertical-align: inherit;">It was then that the suspicion crept in that we were making the product not for programmers, but for companies. </font><font style="vertical-align: inherit;">However, to the realization that we are B2B, it was still far away.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> VivaMP, the first error </font></font></h2><br>       .      ,   , -,   , , -,     .        ,           ,   .   ,            5  ‚Äî   .    ,         ,       . <br><br>        .      VivaMP.       2008 ,       2009 . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So, we have already accepted that 64-bits did not give us a quick ‚Äútake-off‚Äù, and began to look for a new direction, where we can get ahead of others. And as it seemed to us - they found it. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In 2008, multi-core processors began to appear massively. On the agenda of programmers there was a question: which technology will dominate in the development of parallel programs in C and C ++? The options were different: MPI, OpenMP, some already existing libraries, or that could soon appear.</font></font><br><br>     Intel   OpenMP.   ,   .      :        ,    OpenMP. ,      ‚Äî        .     .  -     ,       ,   ,     ,   .   OpenMP    .  "#pragma omp ...."    ,     . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We studied in detail the topic of programming using OpenMP and made sure that there are errors that can be detected by static code analysis. </font><font style="vertical-align: inherit;">Those interested can get acquainted with our article: " </font></font><a href="http://www.viva64.com/ru/a/0054/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">32 OpenMP pitfalls when programming in C ++</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ." </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In general, the new theme was chosen incorrectly. </font><font style="vertical-align: inherit;">Totally wrong. </font><font style="vertical-align: inherit;">If with 64 bits the interest was and is, even if not as big as desired, then in the case of OpenMP there was no interest at all. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The reasons for bad luck, apparently, were several:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenMP technology does not become mainstream. </font><font style="vertical-align: inherit;">It occupies a modest position on a par with other technologies of parallel programming.</font></font></li><li>    ,       OpenMP   . ,      .  , , ,                VivaMP. </li><li>                . </li></ol><br>  VivaMP  .      .               .      <br><br> VivaMP      PVS-Studio,   2014 .  OpenMP  ,         .    ,         .      .         . <br><br> VivaMP ‚Äî    . -      ‚Äî       . <br><br>    ,  2009                  . Viva64  ,   ,      .        ,     ,   - . <br><br><h2> PVS-Studio    ,   </h2><br>  2009    Viva64  VivaMP        VivaMP      64- .     ,        . <br><br>   ,   2009 ,       .       PVS-Studio,        Viva64  VivaMP. <br><br> , ,    .  Viva64     : ¬´  64- !¬ª.     ¬´viva¬ª       ¬´Viva Forever¬ª.       ,   .        <a href="http://www.viva64.com/">www.viva64.com</a> ,       ,       . <br><br>  PVS-Studio    .    ‚Äî       OOO ¬´Program Verification Systems¬ª. ¬´Studio¬ª  ,  ,      ,   ,  .   ,    ,       : -   , -  PVS  PSV   .      ,    -  . ,    ,  CppCat,     ,     . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let us return to the main story line. In 2010, we decided that we could increase interest in the PVS-Studio analyzer, adding to it some general-purpose diagnostics. And we planned to make these diagnostics free, because we didn‚Äôt believe that they could earn something. In the field of general-purpose diagnostics for C and C ++, tools such as Coverity, Parasoft C / C ++ test, Klocwork, Gimpel PC-Lint and so on reigned at that time. We did not see any sense even trying to press these tools. Therefore, we planned to make free general-purpose diagnostics exclusively for promotional purposes. The idea was this: a person checks his project for free, and at the same time learns about paid diagnostics related to 64-bit and OpenMP.</font></font><br><br>   2010    - PVS-Studio 4.00,          .      45 .     : " <a href="http://www.viva64.com/ru/b/0085/">, !   PVS-Studio 4.00    </a> ". <br><br>    ,  .  ,    ,          . ,    -    ,  ¬´ ¬ª. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We were written by a programmer who assessed our general-purpose diagnostics and asked how much he should pay for them in order to continue using them. We replied that not at all, but perhaps he would be interested in 64-bit diagnostics, which are extremely useful. He answered that he doesn‚Äôt need 64-bit and VivaMP diagnostics at all. And thank you very much for such a cool tool, especially since he can continue to use general-purpose diagnostics for free. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We heard this signal from space and quickly revised our approaches. Therefore, the release version of PVS-Studio 4.00, released a month later, was already paid. I even had to write an explanatory article why we changed our mind so quickly: " </font></font><a href="http://www.viva64.com/ru/b/0089/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Why is PVS-Studio 4.00 a paid solution</font></font></a> ".    ,    ,      ¬´  ¬ª. <br><br> , PVS-Studio        (Viva64, VivaMP,   ),       .         (Site License). <br><br>  ,  PVS-Studio       .  PVS-Studio 4.30    ‚Äî       ,       .      PVS-Studio    . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And in PVS-Studio 4.32, which was released in July 2011, we refused licenses for one user. </font><font style="vertical-align: inherit;">It was one of the best business decisions in the history of the company. </font><font style="vertical-align: inherit;">We realized that PVS-Studio is a team tool that benefits the entire project, no matter how many people work directly with it. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At the beginning of 2012, PVS-Studio 4.53 was released, in which there were already 100 messages of general purpose analysis (V501-V600). </font><font style="vertical-align: inherit;">Soon, a set of diagnostics ‚ÄúMicro-optimization‚Äù also appeared to search for those places of performance drop that can be detected by static analysis. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So 3 years have passed when we made the right and useful decisions on the development of the project. </font><font style="vertical-align: inherit;">This is too long, it was time to do stupid things.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Embarcadero RAD Studio, the second error </font></font></h2><br>   ,        .  PVS-Studio 5.00    Embarcadero RAD Studio.  ,      C++Builder.   .       . <br><br>  ,    VivaMP. , -    RAD Studio ,    .        .    VivaMP,      ,    .  . <br><br> ,        Embarcadero RAD Studio    . <br><br> ,   Embarcadero RAD Studio   ,    ,  ,    . <br><br><h2> CppCat,   </h2><br>    CppCat 1.00 ‚Äî   PVS-Studio   .    ¬´ PVS-Studio  $250¬ª.    ,      ,     .    .           . ,        PVS-Studio,         ,      CppCat,         . <br><br> ,      ,     .        ,        " <a href="http://www.viva64.com/ru/b/0320/">   CppCat</a> ".      ,     . <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a80/dbd/771/a80dbd771e37973c6a6a5f6ad5849907.png" alt=" 6.  CppCat   .     ,     ,      .   :    ."></p><br> <font color="#999999"><i> 6.  CppCat   .     ,     ,      .   :    .</i></font> <br><br>         CppCat,      .  ,     ,      .             ,       . <br><br> ,    CppCat,     Embarcadero RAD Studio   OpenMP.  ,     ,    ,       . <br><br><h2>  Our days </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Failures with CppCat, VivaMP, Embarcadero RAD Studio did not undermine our enthusiasm, and we invested in three new areas: </font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C # code analysis; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Linux support; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Free license option PVS-Studio. </font></font></li></ol><br>         .          .   -    ,  ,    . <br><br>          2009 ,         .      4 .   7   <a href="http://www.viva64.com/ru/team/"> PVS-Studio</a>   24 . ,     ,   ,   .      .   10  ,  ,         -      . <br><br> ,     .      -         . <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/f4c/18c/0a5/f4c18c0a573de8fc6d2d3d9281dda93b.png" alt=" 7.  !"></p><br> <font color="#999999"><i> 7.  !</i></font> <br><br><h2>  ,  Viva64 v1.0 </h2><br>     ,        Viva64     PVS-Studio.            .  ,  , ,  3-4  .      Viva64    210    37 KLOC.  ,   PVS-Studio   C/C++    320     208 KLOC. ,  ,  ,  -  40 . <br><br>  Note.   ,         C  C++ .  ,  Plugin  Visual Studio,    C#,  Standalone   .            . <br><br> ,    ,    ,     . <br><br><pre> <code class="cpp hljs">rw_table_sanity_check(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rw_table table[]) { <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> n = (<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span> table)/(<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span> table[<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* old = (table++)-&gt;name; --n; old = (table++)-&gt;name) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(old, table-&gt;name) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">cerr</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"FAILED: '"</span></span> &lt;&lt; old &lt;&lt; <span class="hljs-string"><span class="hljs-string">"' &lt; '"</span></span> &lt;&lt; table-&gt;name &lt;&lt; <span class="hljs-string"><span class="hljs-string">"'"</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; assert(! <span class="hljs-string"><span class="hljs-string">"invalid order in presorted array"</span></span>); } }</code> </pre> <br>       PVS-Studio: <br><br><ul><li> V511 The sizeof() operator returns size of the pointer, and not of the array, in 'sizeof table' expression. lex.cc 822 </li><li> V514 Dividing sizeof a pointer '(sizeof table)' by another value.  There is a possibility of logical error presence. lex.cc 822 </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Error refers to the unit test subsystem. </font><font style="vertical-align: inherit;">The test, in fact, does not check anything, since the variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n is</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> assigned the value 0. The error is that </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">table</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is just a pointer, not an array. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But the mistake that I personally made:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsLiteralFFFFFFFF</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *buf, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> len)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (len &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (buf[<span class="hljs-number"><span class="hljs-number">0</span></span>] != <span class="hljs-string"><span class="hljs-string">'0'</span></span> &amp;&amp; (buf[<span class="hljs-number"><span class="hljs-number">1</span></span>] != <span class="hljs-string"><span class="hljs-string">'x'</span></span> || buf[<span class="hljs-number"><span class="hljs-number">1</span></span>] != <span class="hljs-string"><span class="hljs-string">'X'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; .... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio warning: V547 Expression 'buf [1]! =' X '|| </font><font style="vertical-align: inherit;">buf [1]! = 'X' 'is always true.</font></font> Probably the '&amp;&amp;' operator should be used here.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vivacasts.cpp 632 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A quick check does not work that the literal must begin with the characters "0x" or "0X". </font><font style="vertical-align: inherit;">The check considers valid any lines that begin with the character '0'. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A bit long code, but I decided not to shorten it:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">Ptree* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Append</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Ptree* p, Ptree* q)</span></span></span><span class="hljs-function"> </span></span>{ Ptree *result, *tail; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(p == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(q-&gt;IsLeaf()) <span class="hljs-comment"><span class="hljs-comment">// &lt;= return Cons(q, 0); else return q; result = tail = Cons(p-&gt;Car(), 0); p = p-&gt;Cdr(); while(p != 0){ Ptree* cell = Cons(p-&gt;Car(), 0); tail-&gt;SetCdr(cell); tail = cell; p = p-&gt;Cdr(); } if(q != 0 &amp;&amp; q-&gt;IsLeaf()) // &lt;= tail-&gt;SetCdr(Cons(q, 0)); else tail-&gt;SetCdr(q); return result; }</span></span></code> </pre> <br>  PVS-Studio: V595 The 'q' pointer was utilized before it was verified against nullptr. Check lines: 360, 374. ptreeutil.cc 360 <br><br>      ,       nullptr. <br><br>       ,      : <br><br><pre> <code class="cpp hljs">Class* Environment::LookupClassMetaobject(Ptree* name) { TypeInfo tinfo; Bind* bind = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>) { TheErrorLog().Report( MopMsg(Msg::Fatal, <span class="hljs-string"><span class="hljs-string">"Environment::LookupClassMetaobject()"</span></span>, <span class="hljs-string"><span class="hljs-string">"0 environment"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } .... }</code> </pre> <br>  PVS-Studio: V704 'this == 0' expression should be avoided ‚Äî this expression is always false on newer compilers, because 'this' pointer can never be NULL. environment.cc 115 <br><br>      10 . <br><br>  That's all. ,    , , ,     .  37 KLO ‚Äî   ,           . <br><br><h2>  Conclusion </h2><br>      ,  10          .  ,    ,       ,            .  ,   ,       ,       .         ,    ,     ¬´¬ª        . :   ,  ,    ,         1 ,   . , ,  ,         ,    . ,       . <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/d3c/b5d/e0b/d3cb5de0b1f8e24100eb85d47337a930.png" alt=" 8.   .     .     ,     Framework."></p><br> <font color="#999999"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 8. Fresh winter problem. Here are the difficulties of startups. They are not at all in that the wrong Framework is chosen.</font></font></i></font> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> However, sometimes you have to really pick up a tool and do something to make it work.</font></font><br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/8db/b60/544/8dbb6054409a2fdfd8207d7653b1adce.png" alt=" 9.        Press Wall.   - ,   ."></p><br> <font color="#999999"><i> 9.        Press Wall.   - ,   .</i></font> <br><br> ,      ,         ,       ,     .     , ,  , ,     .       ,   . <br><br>    .           . <br><br><div style="text-align:center;"> <a href="http://www.viva64.com/en/b/0465/"><img src="https://habrastorage.org/files/8d2/41b/5bf/8d241b5bf34747169141ed7c1997143b.png"></a> </div><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Andrey Karpov. <a href="http://www.viva64.com/en/b/0465/">PVS-Studio project ‚Äî 10 years of failures and successes</a> . </div><p>Source: <a href="https://habr.com/ru/post/318756/">https://habr.com/ru/post/318756/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../318746/index.html">MegaFon in hard to reach places</a></li>
<li><a href="../318748/index.html">Methods of protection against CSRF attacks</a></li>
<li><a href="../318750/index.html">The whole truth about the rating of manufacturers of video surveillance from ASmag</a></li>
<li><a href="../318752/index.html">Ada Lovelace. The first program in the world and a look into the future</a></li>
<li><a href="../318754/index.html">[Translation] How to correctly determine the size of the team for beta testing a mobile application</a></li>
<li><a href="../318758/index.html">Why this winter we again invite everyone to play computer games using artificial intelligence</a></li>
<li><a href="../318760/index.html">3CX brings together Elastix and PBX in a Flash communities</a></li>
<li><a href="../318762/index.html">Programming multi-core DSP processors TMS320C66x using OpenMP</a></li>
<li><a href="../318764/index.html">Roaming in Wi-Fi networks without using a controller</a></li>
<li><a href="../318766/index.html">Founder's advice. Evgeny Kobzev, technical director and co-founder of the company "Button"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>