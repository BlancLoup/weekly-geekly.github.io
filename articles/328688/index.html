<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Discipline, accuracy, attention to detail, part two (OLAP, SSAS)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 In this article, I will continue to talk about my experience with Microsoft Analysis Services. In addition to the previous article, I w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Discipline, accuracy, attention to detail, part two (OLAP, SSAS)</h1><div class="post__text post__text-html js-mediator-article"><h2>  <b>Introduction</b> </h2><br>  In this article, I will continue to talk about my experience with Microsoft Analysis Services.  In addition to the previous article, I want to write about non-standard solutions that were made in the last project.  These solutions brought me closer to Microsoft Analysis Services more closely, I began to respect him more and do with it something that previously seemed incredible to me. <br><a name="habracut"></a><br><h2>  <b>The sum of the average for the period</b> </h2><br>  The customer requested a sum of average values ‚Äã‚Äãfor each element for the period, as shown in the picture below: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/73a/ba3/675/73aba367565628862542cec3a2c7ac16.jpg" alt="image"></div><br><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mo stretchy=&quot;false&quot;>(</mo><mn>2.5</mn><mo>+</mo><mn>3.5</mn><mo>+</mo><mn>3</mn><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mn>9</mn></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="18.857ex" height="2.66ex" viewBox="0 -832 8118.9 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/328688/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhggXWQHnVlCtAm6Z0K_vxI38RGLKg#MJMAIN-28" x="0" y="0"></use><g transform="translate(389,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/328688/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhggXWQHnVlCtAm6Z0K_vxI38RGLKg#MJMAIN-32"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/328688/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhggXWQHnVlCtAm6Z0K_vxI38RGLKg#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/328688/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhggXWQHnVlCtAm6Z0K_vxI38RGLKg#MJMAIN-35" x="779" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/328688/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhggXWQHnVlCtAm6Z0K_vxI38RGLKg#MJMAIN-2B" x="1891" y="0"></use><g transform="translate(2891,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/328688/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhggXWQHnVlCtAm6Z0K_vxI38RGLKg#MJMAIN-33"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/328688/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhggXWQHnVlCtAm6Z0K_vxI38RGLKg#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/328688/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhggXWQHnVlCtAm6Z0K_vxI38RGLKg#MJMAIN-35" x="779" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/328688/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhggXWQHnVlCtAm6Z0K_vxI38RGLKg#MJMAIN-2B" x="4393" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/328688/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhggXWQHnVlCtAm6Z0K_vxI38RGLKg#MJMAIN-33" x="5394" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/328688/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhggXWQHnVlCtAm6Z0K_vxI38RGLKg#MJMAIN-29" x="5894" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/328688/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhggXWQHnVlCtAm6Z0K_vxI38RGLKg#MJMAIN-3D" x="6562" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/328688/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhggXWQHnVlCtAm6Z0K_vxI38RGLKg#MJMAIN-39" x="7618" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo stretchy="false">(</mo><mn>2.5</mn><mo>+</mo><mn>3.5</mn><mo>+</mo><mn>3</mn><mo stretchy="false">)</mo><mo>=</mo><mn>9</mn></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> (2.5 + 3.5 + 3) = 9 </script></p><br>  That is, the idea is that, in terms of the elem1, elem2, ..., elemN elements, the cube counted the average for each element for the selected period, in all other cases the sum was considered.  It is required how to change the behavior of the cube for one dimension, and for all others to leave the standard one (in the described case, the standard behavior is SUM). <br><br><h4>  <b>Solutions:</b> </h4><br><ol><li>  <b>First option:</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For this option, you need to create a hidden dimension [ELEM COPY] by simply creating a copy of [ELEM] and setting the Visible property to False.  Next in the ‚ÄúCalculations‚Äù cube section, select ‚ÄúNew Calculated Member‚Äù, as shown in the figure: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0fe/c97/eed/0fec97eed7df37cc521c1d21bc4380b1.png" alt="image"></div><br>  and in the window for entering expressions write: <br><br><pre><code class="sql hljs">iif ( not isleaf([ELEM].[ELEM SK].currentmember), sum(EXISTING [ELEM COPY].[ELEM SK].currentmember.Children,[Measures].[FCT VAL]), [Measures].[FCT VAL] )</code> </pre> <br>  where [ELEM COPY]. [ELEM SK] is a key attribute of the hidden measurement. <br><br>  [Measures]. [FCT VAL] is an AvarageOfChildren aggregation, i.e.  when assembling the cube, they created an AvarageOfChildren dimension type and it automatically calculated it.  An example of how to create a dimension with AvarageOfChildren aggregation is shown in the figure below: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c7e/13b/f04/c7e13bf044894446558db4ee98e5d854.png" alt="image"></div><br></li><li>  <b>SCOPE solution:</b> <br>  This decision showed me my colleague, in my opinion, it is more simple to understand, although a little more difficult to implement. <br><br>  <b>What need to do:</b> <br>  Rewrite the select for the fact table: <br><br>  Instead: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> [<span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span>] ,ID_CO ,ID_CUST ,ID_SYS ,ID_VOL ,ID_QUAL ,GB_used_DATA <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> [<span class="hljs-number"><span class="hljs-number">000</span></span>_REP].NAS_FACTS</code> </pre><br>  Write: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> [<span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span>] ,ID_CO ,ID_CUST ,ID_SYS ,ID_VOL ,ID_QUAL ,GB_used_DATA ,<span class="hljs-keyword"><span class="hljs-keyword">CONVERT</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>), [<span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span>], <span class="hljs-number"><span class="hljs-number">120</span></span>) + <span class="hljs-string"><span class="hljs-string">'|'</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">CAST</span></span>(ID_VOL <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> VolDate ,<span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> Avg_GB_used_DATA <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> [<span class="hljs-number"><span class="hljs-number">000</span></span>_REP].NAS_FACTS</code> </pre><br>  where GB_used_DATA is a fact that we want to add to the cube.  We want to make non-standard behavior for measurements with the ID_VOL key, for the remaining measurements with the ID_CO, ID_CUST, ID_SYS and ID_QUAL keys, the behavior should be standard and in our problem everything should be summed up.  Only for ID_VOL should be considered the average for the period for each element, and the total for ID_VOL elements should also be summed up, should be the sum of the average values ‚Äã‚Äãfor ID_VOL. <br><br>  <b>In the second query, 2 columns were added:</b> <br><br><ul><li>  The 1st column will uniquely determine the date combination with ID elements, by which the sum of the average values ‚Äã‚Äãshould be calculated.  In a cube on this column, a dimension with the DistinctCount aggregation function is added.  The example in the figure below: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/35c/300/a00/35c300a000e70d28c6289ae7fde7a5c5.png" alt="image"><br><br></li><li>  The 2nd column always stores the NULL value in all rows of the table.  In the second column, its name is important, it is necessary in order to be able to create a dimension in the cube, to which it would be possible to bind using the SCOPE function.  It is also important that the aggregation function Sum is used for this measure.  Example below: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8e9/747/b2f/8e9747b2f30b9bad7950297a479c2139.png" alt="image"><br><br>  Further, in the ‚ÄúCalculations‚Äù cube section, select ‚ÄúScript View‚Äù, and in the window for editing the script, insert the following code: <br><br><pre> <code class="sql hljs">SCOPE([Measures].[Avg GB Used DATA]); SCOPE([ID_VOL Items].[ID VOL].[ID VOL].MEMBERS); THIS = [Measures].[Sum GB Used DATA]/[Measures].[Vol Date Distinct Count]; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SCOPE</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SCOPE</span></span>;</code> </pre><br>  where [ID_VOL Items] is a dimension, the key of which is ID_VOL. <br><br>  The figure shows the sequence of actions for this step: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/72f/b84/4cd/72fb844cd877f199b9fda6531e88ff64.png" alt="image"><br><br>  In this solution, we only summarize the expression that is written in SCOPE, since without a formula in SCOPE, we store there the value NULL, which comes from the query to the Database. <br></li></ul><br></li></ol><br>  Both solutions gave the same result and considered the sum of the average at the output, which was required in the assignment. <br><br><h2>  <b>Statistical Average</b> </h2><br>  After some time, the customer returned to the topic of calculating averages.  This time, he demanded not the sum of averages, but the classical average, that is, the same functionality as the AVERAGE function in Excel.  The customer constantly operated on the concept of ‚ÄúStatistical Average‚Äù, hence the name of this chapter. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/23c/5bc/05c/23c5bc05c239fa0c4ab0f3513e75775c.png" alt="image"></div><br><br>  It was necessary to calculate the average value over the entire range.  Take the average of all elements for each day, summed up and divided by the number of days in the period.  The result is the average value of one element for the period.  The following solution was proposed: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MEMBER</span></span> CURRENTCUBE.[<span class="hljs-keyword"><span class="hljs-keyword">Measures</span></span>].[<span class="hljs-keyword"><span class="hljs-keyword">Avg</span></span> GB Used <span class="hljs-keyword"><span class="hljs-keyword">DATA</span></span> (AvgAll <span class="hljs-keyword"><span class="hljs-keyword">Only</span></span> valid <span class="hljs-keyword"><span class="hljs-keyword">days</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">Measures</span></span>].[<span class="hljs-keyword"><span class="hljs-keyword">Sum</span></span> GB Used <span class="hljs-keyword"><span class="hljs-keyword">DATA</span></span>]/[<span class="hljs-keyword"><span class="hljs-keyword">Measures</span></span>].[<span class="hljs-keyword"><span class="hljs-keyword">Count</span></span> VCMDB <span class="hljs-keyword"><span class="hljs-keyword">Only</span></span> valid <span class="hljs-keyword"><span class="hljs-keyword">days</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">VISIBLE</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span> ; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MEMBER</span></span> CURRENTCUBE.[<span class="hljs-keyword"><span class="hljs-keyword">Measures</span></span>].[<span class="hljs-keyword"><span class="hljs-keyword">Count</span></span> VCMDB <span class="hljs-keyword"><span class="hljs-keyword">Only</span></span> valid <span class="hljs-keyword"><span class="hljs-keyword">days</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Count</span></span>(NonEmpty({crossjoin([DIM Business <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> HD].[<span class="hljs-keyword"><span class="hljs-keyword">DAY</span></span>].currentmember.Children,[DIM NAS Provider Configuration Item HD].[NAS Volume CMDBID].currentmember.Children)}, [<span class="hljs-keyword"><span class="hljs-keyword">Measures</span></span>].[<span class="hljs-keyword"><span class="hljs-keyword">Sum</span></span> GB Free <span class="hljs-keyword"><span class="hljs-keyword">Data</span></span>] )), <span class="hljs-keyword"><span class="hljs-keyword">VISIBLE</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span> ;</code> </pre><br><img src="https://habrastorage.org/getpro/habr/post_images/c6b/ad0/58b/c6bad058b9624adb993db52a7aadc2ad.png" alt="image"><br><br>  In this decision, only the days were taken, where the values ‚Äã‚Äãof the elements were.  A hidden measurement trick was also used (these are [DIM Business Time HD]. [DAY] and [DIM NAS Provider Configuration Item HD]. [NAS Volume CMDB]] measurements).  I got the number of days I was using crossjoin. <br><br>  If it is necessary to obtain an average over all values ‚Äã‚Äãfor all days, where the absence of a value for any day equals 0, then I used the following expression: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MEMBER</span></span> CURRENTCUBE.[<span class="hljs-keyword"><span class="hljs-keyword">Measures</span></span>].[<span class="hljs-keyword"><span class="hljs-keyword">Count</span></span> VCMDB All <span class="hljs-keyword"><span class="hljs-keyword">days</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">Measures</span></span>].[NAS Volume CMDBID <span class="hljs-keyword"><span class="hljs-keyword">Distinct</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Count</span></span>] * [<span class="hljs-keyword"><span class="hljs-keyword">Measures</span></span>].[NAS BTIME <span class="hljs-keyword"><span class="hljs-keyword">Count</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">VISIBLE</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span> ; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MEMBER</span></span> CURRENTCUBE.[<span class="hljs-keyword"><span class="hljs-keyword">Measures</span></span>].[<span class="hljs-keyword"><span class="hljs-keyword">Count</span></span> VCMDB All <span class="hljs-keyword"><span class="hljs-keyword">days</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">Measures</span></span>].[NAS Volume CMDBID <span class="hljs-keyword"><span class="hljs-keyword">Distinct</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Count</span></span>] * [<span class="hljs-keyword"><span class="hljs-keyword">Measures</span></span>].[NAS BTIME <span class="hljs-keyword"><span class="hljs-keyword">Count</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">VISIBLE</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span> ;</code> </pre><br>  where [Measures]. [NAS Volume CMDBID Distinct Count] and [Measures]. [NAS BTIME Count] are cube measures based on dimension tables (time dimension and member dimension): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bec/a64/cf0/beca64cf0dcda1bb7cebaa6cf9997c14.png" alt="image"><br><br><h2>  <b>Another useful feature</b> </h2><br>  In the process of working with the cube, demands were made in which the calculation of values ‚Äã‚Äãvaried from the level at which the hierarchy wanted to see it.  That is, if days are selected, then we see the average for the period, if months is the amount.  This was done using the level function: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MEMBER</span></span> CURRENTCUBE.[<span class="hljs-keyword"><span class="hljs-keyword">Measures</span></span>].[ML] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> [DIM Business <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span>].[<span class="hljs-keyword"><span class="hljs-keyword">HIERARCHY</span></span> CAL].currentmember.level <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> [DIM Business <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span>].[<span class="hljs-keyword"><span class="hljs-keyword">HIERARCHY</span></span> CAL].[<span class="hljs-keyword"><span class="hljs-keyword">YEAR</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> [DIM Business <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span>].[<span class="hljs-keyword"><span class="hljs-keyword">HIERARCHY</span></span> CAL].currentmember.level <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> [DIM Business <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span>].[<span class="hljs-keyword"><span class="hljs-keyword">HIERARCHY</span></span> CAL].[<span class="hljs-keyword"><span class="hljs-keyword">PERIOD</span></span> KAL] <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> [DIM Business <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span>].[<span class="hljs-keyword"><span class="hljs-keyword">HIERARCHY</span></span> CAL].currentmember.level <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> [DIM Business <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span>].[<span class="hljs-keyword"><span class="hljs-keyword">HIERARCHY</span></span> CAL].[<span class="hljs-keyword"><span class="hljs-keyword">DAY</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">VISIBLE</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre><br><h2>  <b>Total</b> </h2><br>  To be honest, when I saw the requirements for calculating averages, I wanted to laugh and cry at the same time.  Laugh from the fact that sometimes the average value was either greater than all the values ‚Äã‚Äãin the selected range (as in the example with the sum of averages), or less.  I did not describe the case with less in the article, because I could not understand the meaning - the customer required to divide the value for each day by the number of days in the month.  And we had to cry because these requirements had to be implemented somehow. <br><br>  Attempts will be limited to the standard AvarageOfChildren, which summarizes all the figures for the day, then adds these amounts and divides by the number of days in the period, but did not succeed.  The customer insistently demanded compliance of reality with his picture of the world.  All our solutions were subjected to rigorous and rigorous testing.  The question of trust between us and the client has disappeared in the early stages of interaction.  He was constantly looking for a dirty trick and the solution, instead of simple and intuitive, turned into something strange and monstrous.  But in all there is a benefit.  Thanks to these requirements, I had to deal more closely with the work of the OLAP cube and learn how to work with arbitrary aggregations.  So that this experience was not in vain and helped in the future to solve similar tasks not only for me, I decided to share it with you.  In general, as in a joke about plumbers: <br><blockquote>  They attached a trainee to the plumbing.  Call on departure.  Come over.  Sewer manhole.  Shit flows from it.  Plumber coming to the hatch and diving. <br>  In a minute, he emerges, shouting: <br>  - The key is at 19. <br>  Dives again.  Half a minute comes to the surface: <br>  - Gasket No.6. <br>  Dives again.  Emerges: <br>  - The key to 26. <br>  Dives.  In a minute, he comes up.  It turns out, shakes off and lights.  He sat down, caught his breath and said to the intern: <br>  - That's it! Study, student!  Otherwise, you'll be serving the keys all your life ... </blockquote></div><p>Source: <a href="https://habr.com/ru/post/328688/">https://habr.com/ru/post/328688/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../328678/index.html">What does Scrum look like in the real world? We find out at the meeting of ssrum-masters on May 23 in St. Petersburg</a></li>
<li><a href="../328680/index.html">Why do we change color schemes?</a></li>
<li><a href="../328682/index.html">New dynamic protection against exploits to stop attacks at the very early stage of exploitation of vulnerabilities</a></li>
<li><a href="../328684/index.html">Release of cross-platform XAML UI-framework AvaloniaUI 0.5</a></li>
<li><a href="../328686/index.html">How to check a business idea for $ 75. Ask Drosophila Flies</a></li>
<li><a href="../328690/index.html">SQL vs ORM</a></li>
<li><a href="../328692/index.html">Mitap over SQL Server: waiting only for you</a></li>
<li><a href="../328696/index.html">7 simple steps for successful CRM implementation</a></li>
<li><a href="../328698/index.html">Learning neural network geometry</a></li>
<li><a href="../328700/index.html">Tiled2Unity: export from Tiled Map Editor to Unity</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>