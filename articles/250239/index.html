<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Another way to compress CSS files</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the image above, many will see the famous picture. This is what most CSS files in production look like. We all try to have our web pages load quick...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Another way to compress CSS files</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/53b/d33/be1/53bd33be127040adbf1f12d68b7f1fdb.jpg" alt="image"></div><br><br>  In the image above, many will see the famous picture.  This is what most CSS files in production look like.  We all try to have our web pages load quickly;  To achieve this goal, we use various tools and techniques to optimize the loading and rendering pages.  About one, but rarely used method, I would like to talk and tell how I managed to reduce the size of the <a href="http://mail.ru/">mail.ru</a> mail CSS file by 180Kb. <br><a name="habracut"></a><br>  It would seem that there is nothing to optimize in the file shown above, all spaces and line breaks are deleted, the file is processed by some clever CSSO-type optimizer with structural change and it seems that such a file will be understood only by a browser or a drunk plumber.  But, as we know, there is no limit to perfection perfection, and even less optimization. <br><br>  Next, we will try to squeeze all the juice from this file. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If you look closely, we will notice something interesting in this file. <br><br><img src="https://habrastorage.org/files/73b/00c/c14/73b00cc144114c8dbb9427d0124c05a9.jpg" alt="image"><br><br>  Please pay attention to the names of classes.  Probably, you have already guessed what the discussion will be about - reducing the length of these names.  Because with the advent of BEM and other CSS writing techniques, the class names became very long, and sometimes indecently long. <br><br><h4>  Life examples </h4><br>  I analyzed the CSS files, some popular resources and confirmed my assumption: <br><br><img src="https://habrastorage.org/files/c61/1c4/4bf/c611c44bff604cc986d754917393cd74.jpg" alt="image"><br>  <i>The image shows the classes found in the production of CSS versions of files of these sites.</i> <br><br>  Probably no one needs to explain the importance of the speed of the initial page load and its effect on user satisfaction, conversion, site traffic.  With the advent of mobile devices and mobile Internet, this problem is very acute.  For example, a 40Kb download on 4G Internet takes an average of 700ms, and if you look at 3G, EDGE, GPRS, WiFi during rush hour in a cafe or metro, the download time will increase significantly.  Every kilobyte saved is worth its weight in gold. <br><br>  If we fight for every space and line breaks in CSS files, ruthlessly cutting them out, why not compress the names of classes and identifiers to two or three characters?  After all, your users do not care what the block class will be called on the page, but the page loading speed will be very important to them.  Perhaps that is why the guys from Google use this technique (on google.com): <br><br><img src="https://habrastorage.org/files/095/782/eaa/095782eaa6f2476e9a4c28e92b801d9d.jpg" alt="image"><br><br><h4>  From words to deeds </h4><br>  So, with what it is necessary, I hope, understood.  Let's get down to business.  The first problem is that we cannot just take and reduce classes and identifiers in CSS files, because they are used in layout, templates and JS files.  Replacing only in one place - everything will break.  It becomes obvious that you need to replace the names in the whole bunch of files.  In my projects for minification, gluing and other such tasks, I use Grunt.js.  This build system is one of the world's most popular front-end development.  Pursuing a cursory search for plug-ins that implement such a task, I did not find anything and decided to write my own <s>bike</s> plug-in. <br><br><h4>  grunt-revizor </h4><br>  Thus was born the <a href="https://github.com/atrolov/grunt-revizor">grunt-revizor</a> .  When writing it, I ran into several problems.  In CSS files, everything is simple, the syntax is known in advance, .name or #name, but in other files it may look different.  For example, in HTML <pre>  &lt;div class = "name"&gt; &lt;/ div&gt; </pre>  i.e.  name already without a dot or in JS files <pre>  document.getElementById ('name') </pre>  also without #, which complicates the problem of finding and replacing names.  What is most frightening is that you can break something, for example, if the CSS class name is ".success" and in the JS file we have the variable "success", replacing it we break the JS code.  And we cannot allow this, so we had to introduce the requirements for spelling names, namely, the name must end with a unique prefix, which will unambiguously enable us to distinguish a class from something else JS, HTML, and other files.  For example, .b-tabs__title-block--, in this case the prefix is ‚Äã‚Äã'-'. <br><br>  Sample Taska: <br><br><pre><code class="javascript hljs">grunt.initConfig({ <span class="hljs-attr"><span class="hljs-attr">revizor</span></span>: { <span class="hljs-attr"><span class="hljs-attr">options</span></span>: { <span class="hljs-attr"><span class="hljs-attr">namePrefix</span></span>: <span class="hljs-string"><span class="hljs-string">'__'</span></span>, <span class="hljs-attr"><span class="hljs-attr">compressFilePrefix</span></span>: <span class="hljs-string"><span class="hljs-string">'-min'</span></span> }, <span class="hljs-comment"><span class="hljs-comment">//  : test/css/style1.css, test/css/style2.css, 'test/js/main.js  ... src: ['test/css/*.css', 'test/html/*.html', 'test/js/*.js'], dest: 'build/' }, });</span></span></code> </pre> <br>  After launching this task, grunt will find all CSS, HTML and JS files that correspond to the paths from src, find all the class and identifier names ending in the __ prefix in the CSS files, compress the found names to two and three character, for example .b-tabs- -notselected__ -&gt; .zS, after which it will save the new files, in which all found matches will be replaced, and save them in the build folder, with the names style1-min.css, index-min.html, main-min.js. <br><br>  CSS example: <br><br><pre> <code class="css hljs"><span class="hljs-comment"><span class="hljs-comment">/* Original: style1.css */</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.b-tabs__title-block--</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: red; <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">16px</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.b-tabs__selected--</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-weight</span></span>: bold; } <span class="hljs-comment"><span class="hljs-comment">/* ======================================= */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* Result: style1-min.css */</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.eD</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: red; <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">16px</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.rt</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-weight</span></span>: bold; }</code> </pre><br>  JS example: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* Original: main.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> $tabmenu = $(<span class="hljs-string"><span class="hljs-string">'#tabmenu--'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tabmenu = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'tabmenu--'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($tabmenu.hasClass(<span class="hljs-string"><span class="hljs-string">'b-tabs__selected--'</span></span>)) { $tabmenu.removeClass(<span class="hljs-string"><span class="hljs-string">'b-tabs__title-block--'</span></span>); }; <span class="hljs-comment"><span class="hljs-comment">/* ======================================= */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* Result: main-min.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> $tabmenu = $(<span class="hljs-string"><span class="hljs-string">'#j3'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tabmenu = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'j3'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($tabmenu.hasClass(<span class="hljs-string"><span class="hljs-string">'rt'</span></span>)) { $tabmenu.removeClass(<span class="hljs-string"><span class="hljs-string">'eD'</span></span>); };</code> </pre><br>  The same principle for HTML, template and other files. <br><br>  Some features of the plugin: <br><ul><li>  First generated 2-character names.  After the number of names exceeds 2500, 3-character names begin to be generated; </li><li>  To generate names, lowercase and uppercase letters of the Latin alphabet, numbers, symbols <b>-</b> and <b>_ are used</b> ; </li><li>  There is a collision check, i.e.  A compressed name can match only one full name. </li></ul><br><br><h4>  Example optimization </h4><br>  Let's try to find out the potential benefits of such optimization on the example of the same popular resources.  I'll tell you how I will count.  Of course, I will not skip CSS files through grunt-revizor, because they do not use a unique prefix.  With the help of a simple Node file, I will count the total number of classes, calculate their length in bytes and calculate the potential file size from this.  The simplified formula looks like this: <br><br><pre> <code class="javascript hljs">names = [<span class="hljs-string"><span class="hljs-string">'b-block1'</span></span>,<span class="hljs-string"><span class="hljs-string">'b-block2'</span></span>,<span class="hljs-string"><span class="hljs-string">'b-block3'</span></span>, ....]; saveSize = allNamesSize - (names.length*<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-comment"><span class="hljs-comment">// allNamesSize -        // 3 -      </span></span></code> </pre><br><br><table><tbody><tr><th>  Site </th><th>  Original file size </th><th>  Compressed </th><th>  In percents </th></tr><tr><td>  Mail.ru mail (desktop version) </td><td>  849 Kb </td><td>  182.5 Kb </td><td>  26.4% </td></tr><tr><td>  hh.ru (Desktop version) two files </td><td>  109.8 Kb </td><td>  30 Kb </td><td>  27.3% </td></tr><tr><td>  vk.com (Mobile version) two files </td><td>  184.1 Kb </td><td>  48.5 Kb </td><td>  26.4% </td></tr><tr><td>  Yandex.Taxi (Mobile version) </td><td>  127 Kb </td><td>  13 Kb </td><td>  10.3% </td></tr><tr><td>  2gis.ru (Mobile version) </td><td>  1293 Kb </td><td>  172 Kb </td><td>  13.3% </td></tr></tbody></table><br>  Normal files were used, not gzip.  Optimization data is approximate, because in addition to CSS files, styles were sometimes in the html page, respectively, were not taken into account here.  An unpretentious regular parsing was used, which looked only for classes, moreover, not all of them were possible, and she did not look for identifiers.  In addition to CSS compression, there will be a gain on other files, html, templates, etc., which are not included here either.  I will note right away that some files are poorly served by such optimization, for example, files with few classes or short names are used, or many images inserted via data: URL, which is demonstrated on the 2gis and Yandex.Taxi files. <br><br><h4>  Conclusion </h4><br>  Of course, I did not invent anything new.  This method is familiar to many, but it is rarely used, because  it has both minuses and pros.  For example, it introduces development difficulties, code purity, etc.  By and large, gzip partially solves the problem of long names and compresses files nicely, but still a certain gain in the size and time of decompression of files can be obtained using gzip.  For example, an optimized compressed mail.ru file is 20KB smaller than the same non-optimized compressed file. <br><br>  I also want to say that my plugin is not a silver bullet in this issue, but only an example of implementation.  Perhaps in the future from the plugin you get something really worthwhile.  I will work closely on this idea, ideally, I would like the plugin to work with absolutely not prepared files, that is, without using a prefix, but to do everything automatically and accurately. <br><br>  The meaning of my entire article is to raise the interest of developers to this issue, to listen to the opinions of others.  Maybe someone already had a negative or positive experience in this matter.  Please share it.  Besides, the same Google, I think, knowingly uses this method. <br><br>  In general, there is something to talk about and think about. <br><br>  UDP: Soon I will answer all questions, give specific files, and compare the gain when using GZIP. </div><p>Source: <a href="https://habr.com/ru/post/250239/">https://habr.com/ru/post/250239/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../250229/index.html">PIC16F1503. Wheelbarrow for pumping - 2. Light</a></li>
<li><a href="../250231/index.html">We write full tweak for iOS using iOSOpenDev</a></li>
<li><a href="../250233/index.html">EveryLang - translate, check spelling, switch and show the current keyboard layout</a></li>
<li><a href="../250235/index.html">Oddities in the work of Yandex.Metro: debriefing and update applications</a></li>
<li><a href="../250237/index.html">HotSpot - margin notes</a></li>
<li><a href="../250241/index.html">–°appasity 3D Scan - 3D scanning using Intel RealSense. Development experience</a></li>
<li><a href="../250243/index.html">The first experience of developing games on the Sprite Kit</a></li>
<li><a href="../250247/index.html">Room equipment for listening to music</a></li>
<li><a href="../250251/index.html">VKPLS - Generate streaming audio playlist from vk.com</a></li>
<li><a href="../250255/index.html">The first build of Opera 29 with tab synchronization</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>