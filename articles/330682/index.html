<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Create a dynamic VKontakte cover.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, various interactive ways of attracting an audience and attracting more attention are gaining increasing popularity. Here and bots for social...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Create a dynamic VKontakte cover.</h1><div class="post__text post__text-html js-mediator-article">  Recently, various interactive ways of attracting an audience and attracting more attention are gaining increasing popularity.  Here and bots for social networks and instant messengers, and other solutions that give "uniqueness."  Among them we can highlight dynamic covers for communities, which officially began <a href="https://vk.com/wall-1_340417">to</a> support VKontakte <a href="https://vk.com/wall-1_340417">in March</a> . <br><br>  Why did I decide to write this short article?  Although the excitement around this topic was asleep, it still remains quite popular, there are both ‚Äúclients‚Äù who are ready to pay a lot of money, and those who want to learn how to do it themselves.  I worked with one "studio", which takes six-figure sums for this work, while throwing its developers and small clients.  So, so that in this area there was no monopoly, and everyone saw how easy it was doing, I decided to write an article. <br><br><img width="750" height="562" src="https://habrastorage.org/web/0a5/f18/5c0/0a5f185c0f574b5f86157ffed2609be3.png"><br>  <sub><i>Using my empty sandbox community as an example</i></sub> <br><a name="habracut"></a><br><h2>  Introduction </h2><br>  I will describe how to make a dynamic cover displaying the current time and the last subscriber.  Any other functionality is no more difficult - a little more lines of code and access to the API of other services. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      What do we need?  Just a prepared background for the cover and <b>access_token</b> for a group with photo access rights.  I give an example in Java, but this can be done in any other way. <br><br>  The article is intended for more or less experienced readers - I will not begin to describe how to send a GET request or log in to VK via API. <br><br><h2>  Getting started </h2><br>  To begin with, we are broadcasting new subscribers to the cover.  The logic is approximately the following: we receive a request from the Callback API, take the user id from there, use it to take the name and avatar, impose it on the existing background and load it into the VC.  There is simply no place.  Go. <br><br><h4>  We process request from Callback API </h4><br>  This query will look something like this: <br><br><pre><code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"group_join"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"object"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"user_id"</span></span>: XXXXXXXX, <span class="hljs-attr"><span class="hljs-attr">"join_type"</span></span>: <span class="hljs-string"><span class="hljs-string">"join"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"group_id"</span></span>: XXXXXXXX }</code> </pre> <br>  Parse JSON, I think everyone can.  From here we need only the user id, and we already get the first name, last name and a link to the photo. <br><br>  It is enough to make such a GET request: <br><br><pre> <code class="apache hljs"><span class="hljs-attribute"><span class="hljs-attribute">https</span></span>://api.vk.com/method/users.get?user_ids=XXXXXXXX&amp;fields=photo_max_orig&amp;v=5.65</code> </pre> <br>  In response, we get: <br><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"response"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: XXXXXXXX, <span class="hljs-attr"><span class="hljs-attr">"first_name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"last_name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"photo_max_orig"</span></span>: <span class="hljs-string"><span class="hljs-string">"https:\/\/pp.userapi.com\/\/..."</span></span> } ] }</code> </pre> <br>  Everything, we have all the necessary information, it remains to add it to the cover and upload it. <br><br><h4>  We process the image </h4><br>  Suppose you found an image for the background in advance and know what coordinates should be what you want to add to the cover.  We will omit all these minor details and proceed to the code: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//      BufferedImage bg = ImageIO.read(new File("/some/folder/bg.png")), userAvatar = ImageIO.read(new URL("https://...")); //  -   BufferedImage result = new BufferedImage(background_image.getWidth(), bg.getHeight(), BufferedImage.TYPE_INT_ARGB); //   ""     Graphics2D g = (Graphics2D) result.getGraphics(); //   g.drawImage(bg, 0, 0, null); //    g.drawImage(userAvatar, xForAvatar, yForAvatar, width, height, null); //    g.drawString(userName, xForUserName, yForUserName); //     ImageIO.write(result, "PNG", new File("/some/folder/result.png"));</span></span></code> </pre> <br>  I want to note that it is better to use a thumbnail at once, otherwise, if you just specify the width and height of the result, as indicated in the example code above, then instead of the user's avatar you can see three pixels. <br><br>  I did not begin to bring sheets of code that help in Java to reduce the image normally and make CircleCrop in the center, this is easily written with my own hand or is quietly googled.  Also, I also lowered the setting of fonts and other minor moments. <br><br>  In principle, everything - we got the finished cover, it remains only to download it.  Simple, isn't it? <br><br><h4>  Loading the cover </h4><br>  Everything is done very simply and described in detail in the API documentation. <br><br>  We get the server to download the cover by sending a GET request: <br><br><pre> <code class="apache hljs"><span class="hljs-attribute"><span class="hljs-attribute">https</span></span>://api.vk.com/method/photos.getOwnerCoverPhotoUploadServer?group_id=XXXXXXXX&amp;crop_x=0&amp;crop_y=0&amp;crop_x2=1590&amp;crop_y2=400&amp;access_token=ACCESS_TOKEN&amp;v=5.64</code> </pre> <br>  Where <b>ACCESS_TOKEN</b> is a token with access rights to group photos. <br><br>  From the answer we take <b>upload_url</b> : <br><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"response"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"upload_url"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://..."</span></span> } }</code> </pre> <br>  Now we send a POST request with a <i>photo</i> field in a <b>multipart / form-data</b> format to our <b>upload_url</b> , just like with any documents.  I have already covered this issue in <a href="https://habrahabr.ru/post/327280/">another article</a> . <br><br>  In response, we get the following: <br><br><pre> <code class="hljs json">{<span class="hljs-attr"><span class="hljs-attr">"hash"</span></span>:<span class="hljs-string"><span class="hljs-string">"402784f0ec814632ac"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"photo"</span></span>:<span class="hljs-string"><span class="hljs-string">"eyJvaWQiOi0zNzI3MzTUsMjAwIiwwLCIxNjgwLDEwNTAiLCI3OTUsNDk3Il0sImJ3YWN0Ijoib3duZXJfY292ZXIiLCJzZXJ2ZXIiOjYzODYyOSwibWlkIjoyMzE0ODUyLCc4MSwiZGF0YSI6WyJ4QUFtLXBRQUFBQUFtRUxmY0FBS3A2VEh4bU5WYmJKOG5ZQUFLcDZ2VkMtWjRVMXdmbk9BQUtwNnnMXVvUGdxYkNBQUtwN21nSGJwQlJJdnMxRhpdWM5bldkRktwQUFBS3A3R1NhdFptbFJWNlNCQUFLcDdVamJEFBS3A3NUktQnJTSHotS0hFQUFLcDhLVVRTbzA4VURpTSIsIjAsMCw3OJfc2lnIjoiNjNkNmQ5NmY1ZmI0NWFiYzdjYjZjMjliOGM5NWNhNWMifQ"</span></span>}</code> </pre>  <sub><a href="https://vk.com/dev/upload_files_2%3Ff%3D11.%252B%25D0%2597%25D0%25B0%25D0%25B3%25D1%2580%25D1%2583%25D0%25B7%25D0%25BA%25D0%25B0%252B%25D0%25BE%25D0%25B1%25D0%25BB%25D0%25BE%25D0%25B6%25D0%25BA%25D0%25B8%252B%25D1%2581%25D0%25BE%25D0%25BE%25D0%25B1%25D1%2589%25D0%25B5%25D1%2581%25D1%2582%25D0%25B2%25D0%25B0"><i>VKontakte example</i></a></sub> <br><br>  Everything, it remains to make one GET request and the cover will shine in the community: <br><br><pre> <code class="apache hljs"><span class="hljs-attribute"><span class="hljs-attribute">https</span></span>://api.vk.com/method/photos.saveOwnerCoverPhoto?hash=HASH&amp;photo=PHOTO&amp;access_token=ACCESS_TOKEN&amp;v=5.65</code> </pre> <br>  Where HASH and PHOTO are obtained from the previous item, and the token is the same. <br><br>  Done, dynamic cover earned. <br><br>  To add any other information, the update of which will be initiated by us, and not by requests from another server, you need to do even less work. <br><br>  Previously, we knowingly saved the result of processing in a separate file.  Now we can make a ‚Äúmulti-layered‚Äù cover without losing the previous information. <br><br>  For example, this is how you can broadcast the current time on the cover: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//   Thread.sleep(1000*60); //      "20:25" String now = new SimpleDateFormat("H:m").format(new Date()); // ! BufferedImage result = ImageIO.read(new File("/some/folder/result.png")); Graphics2D g = (Graphics2D) result.getGraphics(); g.drawString(now, xForTime, yForTime); //   ,     //      ImageIO.write(result, "PNG", new File("/some/folder/result.png"); }</span></span></code> </pre> <br>  This is the most primitive way to achieve the desired result.  Similarly, you can do any functionality, since the Callback API provides quite extensive possibilities: you can calculate the users who made the most reposts, left the most comments, and so on.  True, the likes will have to be confused, but this is also not a problem.  Exchange rates, weather, traffic jams and other joys can be freely obtained through public APIs. <br><br>  To create even the most complex cover, changing depending on the seasons, weather, current time, displaying the exchange rate and anything else, you need to spend only half an hour of work and a couple of hundred lines of code. <br><br>  I would be glad if the article would not be useless.  Still, I saw a lot of questions on this topic, and there are also enough volunteers. <br><br>  However, it is a pity that Facebook does not have a similar opportunity to update the cover. </div><p>Source: <a href="https://habr.com/ru/post/330682/">https://habr.com/ru/post/330682/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../330672/index.html">Making a dragon bot in Google Chrome</a></li>
<li><a href="../330674/index.html">Introducing 3CX Phone System V15.5</a></li>
<li><a href="../330676/index.html">Client-server step-by-step, from single-threaded to multi-threaded (Client-Server step by step)</a></li>
<li><a href="../330678/index.html">SPL programming language - an example of solving a problem</a></li>
<li><a href="../330680/index.html">Estimation of aging parameters using wearable electronics. Lecture in Yandex</a></li>
<li><a href="../330684/index.html">The use of national languages ‚Äã‚Äãin SPL programming</a></li>
<li><a href="../330686/index.html">Tutorial: Creating a simple 2D game on Android</a></li>
<li><a href="../330690/index.html">Optimization of combinatorial algorithms</a></li>
<li><a href="../330692/index.html">Idiomatic Redux: Redo's Tao, Part 1 - Realization and Design</a></li>
<li><a href="../330694/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ266 (June 5 - 11, 2017)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>