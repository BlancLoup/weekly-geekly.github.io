<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Analysis of the case of changing the settings for the size of the data block for recording on tape with Veeam Backup & Replication</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue a series of posts with analysis of real cases that come to the technical support service Veeam. Today we will discuss the situation when t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Analysis of the case of changing the settings for the size of the data block for recording on tape with Veeam Backup & Replication</h1><div class="post__text post__text-html js-mediator-article">  We continue a series of posts with analysis of real cases that come to the technical support service Veeam.  Today we will discuss the situation when the data block size settings made for a tape device in the Veeam console do not match the real device settings.  Of course, we will give recommendations on tracking and correcting such an error. <br><br>  I note that changing the size of blocks can be done in cases where you need to increase the performance of data processing.  After all, the larger the block size, the more data the device can write per unit of time. <br><br><img src="https://habrastorage.org/webt/59/e5/cd/59e5cd708efc9009953680.jpeg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Imagine the following picture: the HBA controller has failed and needs to be replaced.  The Veeam server remains unchanged (that is, without reinstalling the OS and the Veeam application itself), as well as the tape recorder.  You have finally successfully set everything up, and then your boss needed to immediately restore the virtual machine from the backup recorded on the tape the day before the HBA controller was replaced.  This is where the error message with the block size comes up: <i>Error: Invalid block size</i> <br><a name="habracut"></a><br><h3>  We are conducting an investigation </h3><br>  To get started, let's go on the Veeam backup server in the <i>C: \ ProgramData \ Veeam \ Backup</i> folder, where logs are stored by default.  In the journal, our attempt to perform VM recovery will be reflected somehow like this: <br><br><img src="https://habrastorage.org/webt/59/e5/e0/59e5e0dc53578511222514.png"><br><br>  We see that after replacing the controller, our tape library did not give us the opportunity to set the previous value of the block size to write to the tape: <br>  <i>[timestamp] &lt;08&gt; Info [AP] (0f3e) output: Cannot set block size: 1048576setMediaParameters error: Tape error: '87' (The parameter is incorrect.)</i> <br><br>  After we made sure that there are such records in the log, check which block size is specified in the tape device settings in the Veeam console.  If it turns out to change it to the one that was specified when archiving to tape, then you have solved the problem. <br><br>  However, if the maximum block size is less than what you expected, you will have to open Device Manager (Device Manager) and see what block size is there.  If the maximum value exceeds the one specified in the settings of Veeam Backup &amp; Replication, then again we have a place with a discrepancy in the settings, and the investigation will have to be continued. <br><br><h3>  Example </h3><br>  Here is an example from the user's real life: in the Veeam console, the maximum block size is specified as 512 kV. <br><br><img src="https://habrastorage.org/webt/59/e5/cd/59e5cd705b373813193650.png"><br><br>  However, earlier it was possible to choose a greater value.  And in Device Manager, the maximum block size is actually 8 MB: <br><br><img src="https://habrastorage.org/webt/59/e5/cd/59e5cd7029f87737136629.png"><br><br>  There is a reasonable question: why in the settings Veeam such a limited size, if the driver does not prohibit working with a much larger block size?  And what can be done about it?  Let's try to dig deeper to answer this question. <br><br>  As we remember, only the HBA controller has changed.  The documentation ( <a href="https://bp.veeam.expert/resource_planning/tape_support-deploy.html">Best Practices for Veeam Backup &amp; Replication</a> ) about connecting via HBA states the following: <br><br>  <i>If you connect the device using the HBA, it needs to be configured for the HBA.</i> <i><br><br></i>  <i>If the tape device is connected via HBA, then Veeam Backup &amp; Replication will use the block size specified in the HBA settings.</i> <br><br>  So, we need to find out what block size is now set in the HBA settings, and set the appropriate value for it. <br><br><h3>  Editing Settings </h3><br>  For an example of editing HBA settings, consider HPE QLogic.  HPE has a very official <a href="http://h20564.www2.hpe.com/hpsc/doc/public/display%3FdocId%3Dmmr_kc-0123734">article on how to change the block size for the QLogic HBA</a> . <br><br>  To configure QLogic, we need a special tool to work with the OS of our tape device - we download it <a href="http://driverdownloads.qlogic.com/QLogicDriverDownloads_UI/SearchProductPreviousRelease.aspx%3FProductCategory%3D39%26Product%3D1044%26Os%3D173%26ResourceCategory%3DDrivers%26grid%3D1">from here</a> . <br><br>  To see which block size is set, execute the <b>-tsize</b> command, we see that in this example we have 512 KV. <br><br>  Then we execute the same command with the key to set the new block size: <br>  <b>-tsize / fc / set 1024</b> or even generally <b>-tsize / fc / set 2048</b> <br><br><img src="https://habrastorage.org/webt/59/e5/cd/59e5cd70f1dc6495120381.png"><br><br>  After we have changed the settings for the HBA, we need to return to <b>Device Manager</b> ( <b>Device Manager</b> ) and start the hardware changes check for hardware changes. <br><br>  When the changes take effect, be sure to restart the <i><b>Veeam Tape Service</b></i> . <br><br>  We expect that in the Veeam console now, too, it will be possible to set the maximum block size more than it has been up to now.  And our task, as we remember, is to set the block size equal to that which was when writing backup to the tape. <br><br>  Indeed, in the console, we now see twice the maximum block size: <br><br><img src="https://habrastorage.org/webt/59/e5/cd/59e5cd70646f2029025647.png"><br><br>  The problem with the discrepancy in the block size may occur not only during the recovery operation, but also during the inventory and updating of the tape catalog.  Therefore, we always recommend that you carefully review the limitations and features of the settings, and if a discrepancy is found, then try to eliminate it.  If it does not work out by itself, we are always ready to help. <br><br>  Your Veeam Support Team. <br><br><h3>  What else to read </h3><br><ul><li>  <a href="https://habrahabr.ru/company/veeam/blog/337248/">Article on Habr√© with the analysis of the case about the restoration of the guest OS files</a> </li><li>  <a href="https://helpcenter.veeam.com/docs/backup/vsphere/tape_device_support.html">User Guide for working with tape devices when archiving Veeam backups (in English)</a> </li><li>  <a href="https://bp.veeam.expert/resource_planning/tape_support-intro.html">Tips for working with tape devices when archiving Veeam backups (in English)</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/340236/">https://habr.com/ru/post/340236/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../340224/index.html">How to hide</a></li>
<li><a href="../340228/index.html">How to enforce PCI DSS 3.2 requirements</a></li>
<li><a href="../340230/index.html">Serious vulnerability in the popular encryption library undermines the security of millions of crypto keys</a></li>
<li><a href="../340232/index.html">TextView and Spannable: highlighting parts of a word</a></li>
<li><a href="../340234/index.html">Writing a three-dimensional retro shooter engine from scratch</a></li>
<li><a href="../340238/index.html">(Without) painful NGINX Ingress</a></li>
<li><a href="../340242/index.html">Search and fix bugs in PHP source</a></li>
<li><a href="../340246/index.html">PHP page navigation</a></li>
<li><a href="../340248/index.html">Creating distributions for different operating systems in Java 9 and 10</a></li>
<li><a href="../340250/index.html">In simple words: smart contracts, Ethereum, ICO</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>