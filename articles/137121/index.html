<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Spatial data storage in PostGIS / PostgeSQL</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When I came to the same office, which develops maps, charts and plans, I was very surprised by one thing: there was no centralized repository of all m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Spatial data storage in PostGIS / PostgeSQL</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/191/10a/e30/19110ae30d1638d60a3fc2213f4134cf.gif" align="left" alt="image">  When I came to the same office, which develops maps, charts and plans, I was very surprised by one thing: there was no centralized repository of all materials.  Users worked each with their own work.  And if there was a need to take something from another project, you had to either run with a ‚Äúflash drive‚Äù or copy files over the network.  What created an incredible amount of "garbage" in the form of duplicates of different freshness on many workstations. <br><br>  After observing all this chaos, I decided to "comb" the whole thing and make the storage of cartographic material centralized, with delineation of access rights to individual projects, and also monitoring changes made to the projects. <br><a name="habracut"></a><br>  The choice fell on PostgeSQL DBMS with the PostGIS extension, which allows geographic data (geometry of objects) to be stored in the database.  One of the determining factors of choice is the possibility of software products with which users work to work with the database without additional crutches.  Plus you can note the openness of the project and the possibility of multi-user work with the same layer. <br><br>  I will not talk about the DBMS itself - it‚Äôs already written a lot, both good and bad.  Nor will I talk about setting it up. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I‚Äôll dwell on the very extension of PostGIS. <br><br>  <a href="http://postgis.refractions.net/">PostGIS</a> was released in 2001 by Refractions Research and competes with commercial solutions, being a free open source software product.  The main advantage of PostGIS is the ability to use the SQL language in conjunction with spatial operators and functions.  In addition to simple data storage, PostGIS allows you to perform any kind of operations on them. <br><br>  Actually, further we will be engaged in the organization of storage of spatial data in a DB.  For the convenience of visualizing the structure taken pgAdmin3. <br><br>  The specificity of working with digital maps is such that in order to obtain a full-fledged map, several layers are needed containing various objects.  For example, a city needs at least two layers: buildings and roads.  Assume that we have several cities, and each contains data independent of each other.  For each of the cities we create a separate scheme in the database: <br><pre> <code class="hljs pgsql"><code class="sql"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> goroda <span class="hljs-keyword"><span class="hljs-keyword">OWNER</span></span> postgres; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SCHEMA</span></span> gorod1 <span class="hljs-keyword"><span class="hljs-keyword">OWNER</span></span> postgres; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SCHEMA</span></span> gorod2 <span class="hljs-keyword"><span class="hljs-keyword">OWNER</span></span> postgres;</code></code> </pre><br><br>  Next, we enter already existing data on them into the created charts using one of the free downloaders for this: shp2pgsql, <a href="http://www.osgeo.org/">OGR2OGR</a> , QuantumGIS SPIT, <a href="http://www.sharpgis.net/post/2006/04/06/Adding-SharpMap-geometry-to-a-PostGIS-database.aspx">shp for PostGIS</a> and others. <br>  Assign the table owner: <br><pre> <code class="hljs pgsql"><code class="sql"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> road1 <span class="hljs-keyword"><span class="hljs-keyword">OWNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> postgres; <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> building1 <span class="hljs-keyword"><span class="hljs-keyword">OWNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> postgres;</code></code> </pre><br>  As a result, we obtain the following form: <br><img src="https://habrastorage.org/storage2/ed5/02d/844/ed502d844193d6b3ac0d33edbdead1c4.png"><br>  In addition to the road1 and building1 tables, two more were formed in the public schema: geometry_columns and spatial_ref_sys.  The geometry_columns table stores information about database tables containing spatial information.  The spatial_ref_sys table contains numeric identifiers and textual descriptions of the coordinate systems used in the spatial database. <br><br>  With the owner of the table figured out, now it's up to the users.  First, create them: <br><pre> <code class="hljs sql"><code class="sql"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">USER</span></span> user1 <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PASSWORD</span></span> <span class="hljs-string"><span class="hljs-string">'psswd1'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">USER</span></span> user2 <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PASSWORD</span></span> <span class="hljs-string"><span class="hljs-string">'psswd2'</span></span>;</code></code> </pre><br>  We set them the right to use these tables: <br><pre> <code class="hljs sql"><code class="sql"><span class="hljs-keyword"><span class="hljs-keyword">GRANT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> road1 <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> user1; <span class="hljs-keyword"><span class="hljs-keyword">GRANT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> building1 <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> user1;</code></code> </pre><br>  In this form, permissions are read only. <br><br>  You can set the following rights for editing: <br>  UPDATE - the ability to change existing objects; <br>  INSERT - adding new objects; <br>  DELETE - delete objects. <br>  Actually, everything is as in standard SQL. <br><img src="https://habrastorage.org/storage2/610/709/09d/61070909d4842723cb85a3ea581254e8.png"><br><br>  Accordingly, by combining these privileges, you can set the user the right only to create or modify already existing objects, or the opportunity for full editing. <br><br>  Next, set permissions on tables with spatial information: <br><pre> <code class="hljs sql"><code class="sql"><span class="hljs-keyword"><span class="hljs-keyword">GRANT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> geometry_columns <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> user1; <span class="hljs-keyword"><span class="hljs-keyword">GRANT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> spatial_ref_sys <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> user1;</code></code> </pre><br>  If you specify only SELECT, the user will only view the layers.  If ALL - it can create its own tables (for example, a layer with bus stops).  We give the second user the following privilege: <br><pre> <code class="hljs pgsql"><code class="sql"><span class="hljs-keyword"><span class="hljs-keyword">GRANT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ALL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> geometry_columns <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> user2; <span class="hljs-keyword"><span class="hljs-keyword">GRANT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ALL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> spatial_ref_sys <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> user2;</code></code> </pre><br>  In order for the user to create records in the table (edit the map), we allow him to use the sequence of the table: <br><pre> <code class="hljs sql"><code class="sql"><span class="hljs-keyword"><span class="hljs-keyword">GRANT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">USAGE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SEQUENCE</span></span> road1_gid_seq <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> user1; <span class="hljs-keyword"><span class="hljs-keyword">GRANT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">USAGE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SEQUENCE</span></span> building1_gid_seq <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> user1;</code></code> </pre><br>  The same can be done for the second user. <br>  Since more than one scheme is used in the database, then when assigning rights to the table, we specify the full path to it: schema.table. <br><br>  Now we have a database with spatial data and with users who have different access to them: from full to ‚Äújust look‚Äù.  What, in fact, we needed. <br><br>  In the next article, we will look at auditing tables with spatial objects. </div><p>Source: <a href="https://habr.com/ru/post/137121/">https://habr.com/ru/post/137121/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../137112/index.html">What is the most interesting topic for the conference?</a></li>
<li><a href="../137114/index.html">Test task for iOS / Android developers from ZeptoLab</a></li>
<li><a href="../137117/index.html">Flex flex sdk</a></li>
<li><a href="../137119/index.html">Canobuvosti, 128th edition</a></li>
<li><a href="../137120/index.html">Gamer system unit with a fridge inside</a></li>
<li><a href="../137122/index.html">Tair-3C + K-1 Converter. Nikon Infinity</a></li>
<li><a href="../137124/index.html">We link Active Directory, Asterisk and OpenFire</a></li>
<li><a href="../137125/index.html">Segment-statistical approach to the Internet as a corpus - a new seminar in the ABBYY Open series</a></li>
<li><a href="../137126/index.html">IT education in Russia: reality or myth?</a></li>
<li><a href="../137127/index.html">History of one resource</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>