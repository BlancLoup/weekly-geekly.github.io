<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Translation: What I learned by developing an API for the Microsoft cloud platform</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Your attention is invited to the translation of the post about how the Windows Azure API was developed: about the difficulties, successful and unsucce...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Translation: What I learned by developing an API for the Microsoft cloud platform</h1><div class="post__text post__text-html js-mediator-article">  Your attention is invited to the translation of the post about how the Windows Azure API was developed: about the difficulties, successful and unsuccessful decisions, conclusions.  Next - the text of the author. <br><br>  After talking with my <a href="http://www.linkedin.com/in/sriramkrishnan01">work</a> colleague <a href="http://www.linkedin.com/in/sriramkrishnan01">on</a> the REST API, I had the idea to tell about my experience in organizing and working the team that created the Windows Azure Service Management API.  I was inspired to write this post by such great articles in the ‚Äúwhat I learned‚Äù genre, like <a href="http://engineering.foursquare.com/2011/07/08/apiv2-woulda-coulda-shoulda/">this</a> one by Foursquare and <a href="http://techblog.netflix.com/2011/02/redesigning-netflix-api.html">this one</a> by Daniel Jacobs from Netflix. <br><br>  Warning: Everything told under the cut is my personal opinion.  I'm not even sure that the other team members agree with me.  And I know for sure that some of the thoughts expressed are rather contradictory. <br><a name="habracut"></a><br><h4>  <b>Foreword</b> </h4><br>  The Windows Azure Service Management API (SMAPI) was created in 2008 and allowed the developer to control his Windows Azure account - deploy a new code, change settings, scale services, manage storage, etc.  By the way, here is the <a href="http://msdn.microsoft.com/en-us/library/ee460799.aspx">documentation</a> .  I can‚Äôt name specific numbers, but I can say that the API handled a huge number of requests from different clients every day - development environments, utilities, automation systems, intruder bots, and many other sources.  I was lucky to work on this API together with an amazing team (taking this opportunity to say hello to Zhe, Dipa, Frank!) And I am proud of what we managed to create. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      What have I learned during this time? <br><br><h4>  <b>Naming a REST URI is irrelevant ... almost</b> </h4><br>  By saying this, I risk incurring the wrath of many friends and colleagues.  At the very beginning of work on the API, we spent weeks to create the most ‚Äúclean‚Äù URL design.  We all read the work of Fielding and for us it was the norm to wave this book during particularly heated discussions.  But in the end I realized - we just wasted time. <br><br><blockquote>  URI + HTTP verb + wire format does not matter </blockquote><br><br>  And that's why.  Developers who will use your API will not see HTTP requests and responses.  If your API is at least as successful, then it will be made binding to programming languages ‚Äã‚Äã- by you or by the community.  Of course, the ability to wake up at three o'clock in the morning and build a curl request from memory will make the life of the binding developers a little easier.  As well as ignoring basic REST idioms (for example, state-changing GET requests) will cause developers to suffer.  But if every second meeting slips into discussions whether to use PUT or POST, and this lasts for weeks - then you lose your time for academic discussions. <br>  Proof of?  Look at the Amazon API (not S3, but everything else that is there).  All of these APIs are the ugliest RPC-style XML monsters.  But you will not deny how successful this API is? <br><br><h4>  <b>Start with how your API will be used.</b> </h4><br>  One of the best things we did while working on the API was that we started with code that uses this API, and looking at it, we made a REST interface.  Since the API itself was not there yet, we simply wrote pseudocode in different programming languages ‚Äã‚Äãfor important scripts.  This allowed us to avoid a large number of flaws that were not obvious during the simple reading of the API specification.  For example, we found that we are trying to force developers to create too many intermediate objects between meaningful API calls.  We also found that users do not have the ability to send structures received via an API back without having to modify them.  Without a preliminary pseudo-code check, we would not be able to detect all these flaws that would surface much later and fixing them would be much more expensive.  Or even worse - we could make a release of such an API and be a long time using a bad design. <br>  We introduced the rule that the developer does not offer API functions, in the comments to which there are not at least a few lines of pseudo-code to understand how they work.  This rule also improved API design meetings, where developers could see usage examples instead of the usual parameter lists and return values. <br>  A bad way to create an API focuses on the REST interface to the service internals.  The resulting ‚ÄúAPI‚Äù is usually thrown to grateful users, through a wall high enough so as not to hear what they think about it (the translator's note is an <a href="http://www.netlingo.com/word/throw-it-over-the-wall.php">ideological</a> expression, ‚Äúto throw over the wall‚Äù).  We see around these many APIs created by Microsoft and other companies, and all of these APIs hurt developers. <br><br><h4>  <b>Do not make the developer think a lot</b> </h4><br>  Try to minimize the number of ‚Äúentities‚Äù that your API gives out.  Each concept that your API operates on increases the complexity of understanding for developers and has a very negative effect on the learning curve.  We adhered to an aggressive policy of cutting out ‚Äúentities‚Äù sticking out, even if you had to combine slightly different ‚Äúentities‚Äù into one.  We also aggressively reduced the number of operations available for each ‚Äúentity‚Äù.  All this led to a significant simplification of the API compared with the very first design. <br><br><h4>  <b>Make key actions quick and easy.</b> </h4><br>  One of the problems we encountered in the late stages of an API design is known as the ‚ÄúN + 1 problem‚Äù.  This problem occurs when, in order to access child objects, you first need to get their list from the parent object, and then make a separate HTTP request for each one received.  In our case, the most popular operation was to request Windows Azure services and then obtain their status.  Since we were already preparing for the release, we didn‚Äôt have time to change the API design, so we did what I called the ‚Äúhuge crutch‚Äù - the ‚Äúrecursive‚Äù parameter for the parent object.  Surprisingly, this crutch turned out to be a very effective and convenient solution - both for users of our API, and for our servers.  Another similar thing is ‚Äúpartial responses‚Äù, something that is currently <a href="http://googlecode.blogspot.com/2010/03/making-apis-faster-introducing-partial.html">supported</a> within <b>GData</b> .  In each such case, the implementation was not the most successful, but the very idea of ‚Äã‚Äãhoning the API for key usage scenarios helped us a lot.  Do not be surprised if these ‚Äúcrutches‚Äù in our design save millions of API calls every day.  And allow you to quickly create convenient clients to our platform. <br>  One of the good ways to achieve such results is to develop customer prototypes in parallel with the development of the API itself.  For example, we supported client versions for publishing assemblies, clients for monitoring, and clients for other popular scenarios.  It's amazing how badly your freshly prepared API becomes as soon as you start writing code that uses it.  As an API designer, it's best for you to see this before thankful users get to your API. <br><br><h4>  <b>Measure and log all</b> </h4><br>  What we did really well was to take measurements.  We have instrumented our API for removing metrics and very closely following the resulting numbers.  Every day we knew what users were doing, what the most popular API calls were, the most common errors, and so on.  This gave us an understanding of how our API is actually used (for example, it allowed us to say how many calls the N + 1 hack saved).  With the release of new functionality, we tracked how it is used and quickly made adjustments if the harsh truth of life was different from the use we had intended.  And, perhaps most importantly, we had the opportunity to track which errors users encounter and carefully study them.  We often added or modified error messages so that users could understand what is happening while working with the system.  For a long time, all this helped us improve the usability of the API. <br><br><h4>  <b>Versioning and Extensibility</b> </h4><br>  APIs are changing, and it‚Äôs hard to predict what changes they will make.  Sometimes the changes are small - you want to add a field to an object or another element to the list of elements.  Other changes are more difficult - you want to change the authentication mechanism or stop supporting the old version of the API.  In any case, you will be grateful to yourself if you take care of versioning from the very beginning.  There are many ways to protect your API from change related issues.  You can go our way: the client sends the supported API version in the header, and the server demonstrates the expected behavior for this version.  Another way is to add the version number in the URL of the REST methods.  In any case, adding any protection method to the very first version of the API will save you from a big headache afterwards. <br><br>  We should also consider the ‚Äúsmall changes‚Äù in the API.  I think we could make Azure SMAPI better from the start.  For example, API Foursquare uses an interesting way to indirectly expand structures: <br><br><pre><code class="hljs css">{ <span class="hljs-attribute"><span class="hljs-attribute">type</span></span>: <span class="hljs-string"><span class="hljs-string">"special"</span></span>, item: { special: { ...specialdata... } } }</code> </pre> <br><br>  This allows them to add new ‚Äútypes‚Äù without losing compatibility with existing customers who are not expecting such types.  It‚Äôs a pity that we didn‚Äôt do something similar for the Azure API.  This would seriously simplify our lives in case of minor changes and would eliminate the need to constantly increase the version number and break compatibility with old customers. <br><br>  Sriram krishnan <br>  me@sriramk.com </div><p>Source: <a href="https://habr.com/ru/post/273533/">https://habr.com/ru/post/273533/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../273517/index.html">Look in looking-glass</a></li>
<li><a href="../273519/index.html">Underground carders market. Translation of the book "KingPIN". Chapter 22. "Enemies"</a></li>
<li><a href="../273523/index.html">Another "critical" "vulnerability" "VPN" and why Port Fail is nonsense</a></li>
<li><a href="../273525/index.html">Multiplication by the method of Russian peasants</a></li>
<li><a href="../273527/index.html">Apple guidelines for iOS apps are out of date</a></li>
<li><a href="../273535/index.html">How we switched from Scala to Go</a></li>
<li><a href="../273537/index.html">The digest of interesting materials for the mobile # 134 developer (December 14-20)</a></li>
<li><a href="../273543/index.html">Simple Blender. Part 5, final</a></li>
<li><a href="../273545/index.html">Quick start in 5 minutes with Angular 2 beta</a></li>
<li><a href="../273547/index.html">HP Thin Client as a home router and file server</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>