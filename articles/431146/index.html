<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>1. Check Point Log Analysis: The Official Check Point App for Splunk</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When working with Check Point security gateways, it often becomes necessary to parse logs to detect and analyze information security incidents. Usuall...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>1. Check Point Log Analysis: The Official Check Point App for Splunk</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/bq/gl/8f/bqgl8fhc3r4o-hr5aox1vkwq-ou.png"><br><br>  When working with Check Point security gateways, it often becomes necessary to parse logs to detect and analyze information security incidents.  Usually in organizations there is already some kind of logging system, and the task is to transport logs from the Check Point management server and then configure filters for logs, compile dashboards, graphs, and so on.  In this course, we will look at various options for analyzing Check Point logs using internal functionality and third-party applications, consider what useful information we can extract, and how it will help in setting up a firewall. <br><a name="habracut"></a><br>  As part of Check Point's products, SmartEvent‚Äôs functionality is responsible for this, which will build reports using templates, you can also set up a limited set of automatic actions, but this is not about that, we‚Äôll return to this issue later.  There are also other solutions for this problem, which were discussed in our other articles: <br><br><ul><li>  <a href="https://habr.com/company/tssolution/blog/325170/">Splunk + Check Point, an example of analyzing your firewall logs</a> </li><li>  <a href="https://habr.com/company/tssolution/blog/358212/">Check Point Smart Event.</a>  <a href="https://habr.com/company/tssolution/blog/358212/">Mini guide</a> </li></ul><br>  Setting up all of the above solutions requires a certain amount of qualification and a lot of time for implementation.  What if you want to get a solution here and now?  Recently, Check Point has released an application that is ideal for this case - the Check Point App for Splunk, the data for which is sent via syslog using the log exporter tool in real time to the Splunk logging system.  In this article, we will look in detail at this solution, installation, and information that we get at the output. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  <b>Installation Requirements</b> </h3><br>  The Check Point management server requires the installed Log Exporter tool in order to send logs via the syslog protocol.  In the GAIA R80.20 version, the Log Exporter is installed by default, but to support the Splunk log format, you need to install Jumbo Hotfix, in other versions, before installing the Log Exporter, you must first install it to support Jumbo Hotfix. <br>  All hotfix requirements are as follows: <br><br><ol><li>  R80.20 - Jumbo Hotfix Take 5 or higher; </li><li>  R80.10 - Jumbo Hotfix Take 56 or higher; </li><li>  R77.30 - Jumbo Hotfix Take 292 or higher. </li></ol><br>  For the application to work, the minimum system version must be at least Splunk 6.5, the <a href="https://splunkbase.splunk.com/app/1621/">Splunk Common Information Model (CIM)</a> package must also be installed. <br><br><h3>  <b>Install and Run</b> </h3><br>  The installation process is quite trivial, first install the Log Exporter, then the application on Splunk, set up the process of sending logs on the management server and the adoption process in the logging system, and as a final point we start transporting the logs, check that everything works as expected.  Consider all the points in more detail. <br><br>  <b>1. Install Jumbo Hotfix as required.</b> <br>  Go to GAIA portal in the web browser, in the left menu of Upgrades (CPUSE), Status and Actions, select the recommended Jumbo Hotfix package, which will obviously be higher than the lower threshold in the requirements, or look for the correct version in Add Hotfixes from the Cloud, install The process will require a restart of the management server. <br><br>  <b>2. Install the Log Exporter if your Check Point version is lower than R80.20.</b> <br>  In order to install Log Exporter on management, first download the archive from <a href="https://supportcenter.checkpoint.com/supportcenter/portaleventSubmit_doGoviewsolutiondetails%3D%26solutionid%3Dsk122323">the Check Point portal</a> . <br><br><img src="https://habrastorage.org/webt/14/xo/xv/14xoxvdmuob7dmrpeyh-g6ro7om.png"><br><br>  Then again we go to the CPUSE-&gt; Status and actions menu, select Import Package, specify the path to the archive, import it.  After that, we change the viewing of the Packages with Recommended packages on the Show All packages, select the imported archive, install it. <br><br>  <b>3. Install CIM if not installed before.</b> <br>  Go to the Splunk WebUI, find the CIM package in Manage Apps -&gt; Browse More Apps, install. <br><br><img src="https://habrastorage.org/webt/rq/qm/kf/rqqmkfbyxpzo2mwjjajbsohngre.png"><br><br>  <b>4. Install the Check Point App for Splunk</b> <br>  Download the archive from the <a href="https://splunkbase.splunk.com/app/4293/">portal</a> , then go to Splunk WebUI, Manage Apps, Install app from file, select the desired archive, click upload.  Waiting for notification of successful operation, make sure that the application is now visible in the Apps list. <br><br><img src="https://habrastorage.org/webt/t7/dd/vo/t7ddvo5g4c5dqzuunqyyxwm0w8a.png"><br><br>  This is how the installed application should look like, of course, among other applications: <br><br><img src="https://habrastorage.org/webt/hs/iy/y0/hsiyy0qqcvjxqhqss9pg96pi7a4.png"><br><br>  In order to send logs via syslog, you first need to create a Log Exporter process, then configure Data Input loading on Splunk, and start the created process on the Check Point management server. <br><br>  <b>5. Configuring Log Exporter</b> <br>  On the Check Point management server in the CLI, in the expert mode, run the command: <br>  cp_log_export add name [domain-server &lt;domain-server&gt;] target-server &lt;target-server&gt; target-port &lt;target-port&gt; protocol &lt;tcp |  udp&gt; format splunk read-mode &lt;raw |  semi-unified&gt; <br>  where is the configuration name, &lt;target-server&gt; is the ip address of the Splunk system to which we are sending data, &lt;target-port&gt; is the port to which we are sending data. <br>  Example: cp_log_export add name check_point_syslog target-server 10.10.1.159 target-port 9000 protocol tcp format splunk read-mode semi-unified <br><br>  <b>6. Configure Data Input to Splunk</b> <br>  We go to Splunk WebUI, in the menu we select Settings, under the Data section we select Data inputs. <br><img src="https://habrastorage.org/webt/9j/-g/do/9j-gdoyfjdfes3plbidjrupnzmw.png"><br>  We select the protocol on which data will go on Splunk, in this example tcp, we select + Add new. <br><br><img src="https://habrastorage.org/webt/je/99/gt/je99gt6ztojek43mp95-soczzx4.png"><br><br>  Next, enter the port &lt;target-port&gt;, which was specified in the Log Exporter, in this case 9000, you can additionally specify from which ip address to accept connections, then wait for the Next button. <br><br><img src="https://habrastorage.org/webt/ah/5r/vq/ah5rvqiqseck0vnig3k0qgq2u_u.png"><br><br>  In the source type we specify cp_log, method - IP, index, you can leave default, all data will go to index = Main and if you have other data on this index, the search time may increase significantly, you can specify a different index or create a new one, and then in the application itself, you must directly indicate in which index the search operations are carried out. <br><img src="https://habrastorage.org/webt/vk/50/9b/vk509b8nlj3bzibmhei3ypbe1g8.png"><br>  After we click Review, we see that all the settings correspond to reality, we select Submit, the Data Inputs setting is finished, all that remains is to send logs from the Check Point management server. <br><br>  <b>7. Start the process of uploading logs to Splunk</b> <br>  In expert mode, enter the command: <br>  cp_log_export restart name, where is the name of the configuration created in the first step <br>  Example: cp_log_export restart check_point_syslog <br>  The setup is complete, after that it only remains to make sure that the logs are sent to Splunk, using standard Splunk search query mechanisms. <br><br><img src="https://habrastorage.org/webt/ma/jo/sb/majosbg53muvbjt5m3hskshscaa.png"><br><br>  Now you can go to the analytics of the application itself, what dashboards and reports it contains, what important information can be obtained and what conclusions can be drawn. <br><br><h3>  Log Analysis </h3><br>  The application is divided into 2 sections - General Overview and Threat Prevention Protection, which in turn is divided into Cyber ‚Äã‚ÄãAttack Overview, Sandblast Protection and Additional Threat Prevention Events.  Consider separately each section. <br><br>  <b>General Overview</b> <br><br><img src="https://habrastorage.org/webt/lh/qx/dt/lhqxdtflctlgbgvjr__psy5lj7c.png"><br><br>  The main page of the application presents several tables, statistics and graphs.  Some information in this case is basic, for example, as the number of gateways and management servers, or the number of logs by blades, most likely you will not learn anything new here, and on the basis of this information it is impossible to draw conclusions that will have a positive effect. <br>  From my point of view, the most interesting elements here are Critical Attack Types, Critical Attacks Allowed by Policy, Infected Hosts, Allowed High Risk Applications, I will explain why. <br>  According to information from Critical Attack Types, Critical Attacks Allowed by Policy, you can improve the Threat Prevention security policy (by translating actions from detect to prevent by specific signatures or by increasing the response level), thereby increasing the security level for protection against virus threats, intrusion attempts and hacking. infrastructure.  Infected Hosts points to those users who are possibly infected, and accordingly in the future they should be separately checked by antivirus or isolated from the network, preventing the virus from passing through the organization's network.  Based on the diagram Allowed High Risk Applications, you can block for users the most visited potentially dangerous applications that are currently allowed. <br>  The Applications and URL Filtering by Risk, Security Incidents by Severity, and Attack Actions by Policy diagrams are systematic and indicate whether the security situation in your organization improves over time, that is, whether the security policy changes have helped to secure the infrastructure more. <br><br>  <b>Cyber ‚Äã‚ÄãAttack Overview</b> <br><br><img src="https://habrastorage.org/webt/al/qz/kj/alqzkjrz65gjhfsekfnrfew0pde.png"><br><br><img src="https://habrastorage.org/webt/34/vd/ae/34vdae6rpbgtnp6sg6vmjh5tzuk.png"><br><br><img src="https://habrastorage.org/webt/mi/-d/rt/mi-drtnm-zab4dofjx240gyaaua.png"><br><br>  This dashboard shows more detailed information on infected hosts and users who download viruses.  It is very convenient to separate the downloaded infected files and the infected emails, you can define threats and create a Threat Prevention security policy for individual services, one security profile for smtp traffic and another profile for http and https.  SandBlast Protection provides more detailed information on the infected files, you can look at Severity and identify the flaws in your Threat Prevention security profile. <br><br><h3>  Conclusion </h3><br>  Thanks to this application, it is very quickly and conveniently possible to obtain information on weak points in your security policy, setting up the application takes a little time and does not require extensive qualifications for these solutions.  That is, if you doubt your security settings and you need some analysis without a lot of time, this is a very convenient solution.  However, it is clear that the application still needs serious work, there is no statistics on users, it is very interesting to see the list of the most used applications and the amount of traffic that goes there, etc.  Since this is only the first version, the application will be updated, and most likely it will be a very good analysis solution over time, but now if we consider this application only as a log analysis, it is much inferior to other solutions.  In subsequent articles, we will look at and compare the capabilities of SmartEvent and other Splunk applications in analyzing Check Point logs, including the applications created by our engineers. <br><br>  If you still haven't tried Splunk to analyze Check Point logs, then it's time to start.  If you have questions or problems with Splunk or Check Point - you can ask them, and we will help. </div><p>Source: <a href="https://habr.com/ru/post/431146/">https://habr.com/ru/post/431146/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../431136/index.html">Is a weightless terabyte in your pocket - is the future already here? Exploring HyperX SAVAGE EXO</a></li>
<li><a href="../431138/index.html">Biometrics with Rostelecom Key: how for the first time the FSB launched Russian cryptography into application stores</a></li>
<li><a href="../431140/index.html">Report from the ‚ÄúGo in production‚Äù mitap: video, photo, presentation</a></li>
<li><a href="../431142/index.html">How to run SQL Profiler Trace at night, at a specific time?</a></li>
<li><a href="../431144/index.html">Far Fields mic (Mic array) - the inconspicuous hero in the smart column</a></li>
<li><a href="../431148/index.html">The New iOS Mobile Enterprise. Part # 1: Resource Code Generation</a></li>
<li><a href="../431152/index.html">Metro 4 - a path length of 6 years. A brief history of Metro UI CSS</a></li>
<li><a href="../431154/index.html">Flaws in the Fallout 76 quests allowed players to arrange a nuclear hell</a></li>
<li><a href="../431156/index.html">SHOCK! New phishing software wins second factor</a></li>
<li><a href="../431158/index.html">More coffee, less caffeine: Intel 9th ‚Äã‚ÄãGen (Part 2)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>