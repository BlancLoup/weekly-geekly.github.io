<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to curb the gain recording in SSD?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I once wrote that LSI, in addition to SAS controllers, produces microchips for modern hard drives and SSDs, and I also wrote that flash memory require...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to curb the gain recording in SSD?</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/43f/691/31a/43f69131a7b0730b473bb37f8210f280.jpg"><br><br>  I <a href="http://habrahabr.ru/post/173619/">once wrote</a> that LSI, in addition to SAS controllers, produces microchips for modern hard drives and SSDs, and I also <a href="http://habrahabr.ru/post/189294/">wrote</a> that flash memory requires a more complex approach to I / O operations.  What is this complexity and what problem do our chips solve? I want to tell you in this article.  It's about Write amplification.  Of course, professionals are already familiar with WA, so the article is intended more for beginners. <br><a name="habracut"></a><br>  Modern flash memory chips are designed so that in order to achieve improved performance, they need to read, write and erase data in large blocks.  Moreover, the recording block is not less than the reading block in size, and the erasing block is always larger than the recording block.  This makes it necessary to combine the memory cells in a hierarchical structure, usually: blocks - sectors - pages. <br><br>  When we have a pristine new SSD in our hands, there are no problems.  All its cells are filled with zeros and ready to receive our data.  Therefore, the first entry on the SSD does not pose any problems at all.  Typically, data is written in blocks of 4-8 KB, and this happens really fast. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And now let's say we need to change a couple of bytes (for drama, we can even assume that one single bit, although this happens rarely in life) in an already recorded file.  Unlike traditional hard drives, flash memory does not allow you to simply take and overwrite a data block, you first need to erase it.  And since the erase block is a very large write block, this operation will be very inefficient.  Thank you, Wikipedia, for a clear illustration: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1fe/8eb/d66/1fe8ebd66b6dab9a6042ef3c619b2012.png"><br><br>  To do this, we need somewhere to read the contents of the entire erase block, then modify the data in it, then erase the block and write the data to it again.  This leads to the appearance of such a negative phenomenon as recording enhancement.  In fact, much more data is written onto the disk than the computer ‚Äúreally wanted‚Äù to write. <br><br>  A very simple formula allows you to calculate the recording gain. <br><br>  Record Gain Ratio = Data written to flash / Data sent by host to record <br><br>  This phenomenon has been known since the advent of the first chips with NAND memory, but the term Write Amplification was introduced in 2008 by Intel and SiliconeSystems. <br><br>  Record enhancement has two distinct drawbacks.  The first of these is the drop in speed, since reading-erasing-writing large blocks is clearly not as effective as direct writing, but this disadvantage is simply bypassed. <br><br>  The flash memory controller takes over the work of translating the logical addresses that the computer uses to the physical addresses of the data on the storage media, in our case SSD, this is called Logical Block Addressing (LBA abbreviation familiar to many). <br><br>  Modern controllers optimize the rewriting operation as follows.  If he needs to change any of the file blocks, instead of a complete rewrite with reading, erasing and writing, the SSD controller saves the modified block in another place that was previously erased, marks the old block ‚Äúaccessible but not ready‚Äù and changes the information in the metadata he uses for LBA. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/66e/83b/7b4/66e83b7b420e6a271d2f2af1ff33c23d.jpg"><br><br>  At the first stage, this seems like a reasonable idea, but as the disk is filled, we have more and more blocks in the ‚Äúwrong‚Äù state, that is, marked as free but not erased.  Therefore, modern hard drives use different garbage collection algorithms that erase such blocks and return them to the lists of "available and ready."  Of course, the smaller the free disk space, the more intensively you have to use these algorithms, which in turn determines the dependence of SSD performance on filling. <br><br>  The second drawback of Write Amplification is to accelerate SSD wear.  We all know that memory cells have a limit on the number of valid rewrites.  It is higher in SLC disks, lower in MLC, but it is.  To combat this, data redundancy and their verification using different checksums are used (I already wrote about the LDPC in the <a href="http://habrahabr.ru/post/199360/">previous article</a> ), but the redundancy of the free space of memory chips is a limited resource, and recording gain contributes to its faster exhaustion. <br><br>  What factors and how to affect Write Amplification? <br><br>  Garbage collection <br>  The fact that the wear of SSD cells will depend on the performance of the GC algorithms is undeniable.  Garbage collection on SSD drives can occur both background and explicitly. <br><br>  In the case of explicit (foreground) garbage collection, cleaning and optimization of freed blocks occurs when writing new ones.  In the case of a background assembly, the controller uses idle periods to optimize free space and clean the blocks. <br><br>  Background cleaning allows you to speed up work because the blocks are released by the time they are needed, but this leads to the fact that often the controller has to optimize the really unnecessary data, which probably can be deleted in the future. <br><br>  The presence of both advantages and disadvantages leads to the fact that developers are trying to combine these methods, seeking better performance.  For example, in the OCZ SSD, the background garbage collector cleans up a small number of blocks and stops, which allows minimizing the number of unnecessary operations, nevertheless providing the disk with quick access to free blocks. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c94/bcd/2b9/c94bcd2b930152907fb4973dd61b691c.jpg"><br><br>  However, the most promising direction now is garbage collection simultaneously with write operations initiated by the host.  This allows you to achieve high performance in environments with a large number of write operations when the SSD is not idle.  Among the controllers that have such an opportunity are the SandForce controllers from LSI. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/82b/579/027/82b57902721c569c0d59f7a26d814bbb.jpg"><br><br>  Of interesting exotics, it is worth noting the attempts of some manufacturers, primarily Samsung, to develop a garbage collection system that would use the information of the file system located on the disk.  This would allow the controller to efficiently use information about recently deleted files and unallocated space.  According to the developers, this approach allowed to work effectively in those systems that do not support the TRIM team.  Controllers with this feature required that the disk be necessarily marked in NTFS and contain MBR.  This technology was very unreliable, and often led to data loss, especially when using other file systems.  Another direction in which the developers of SSD are moving is Application Hinting.  The easiest way to explain this is through the example of databases.  Data in the DBMS is also placed in the pages for easy retrieval.  Therefore, the DBMS also has the concept of garbage, or Dirty Page.  If the DBMS could send in advance lists of dirty pages to solid-state devices, this would greatly assist in the process of garbage collection.  There are examples of optimization for other applications. <br><br>  # end of the first part # </div><p>Source: <a href="https://habr.com/ru/post/203578/">https://habr.com/ru/post/203578/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../203566/index.html">Internet and trust in people</a></li>
<li><a href="../203568/index.html">My experience with Webrtc</a></li>
<li><a href="../203570/index.html">Selling design online store. Part 2. Interface elements</a></li>
<li><a href="../203574/index.html">What makes a good programmer good?</a></li>
<li><a href="../203576/index.html">Legendary cryptographer Diffie tried to stop the patent troll</a></li>
<li><a href="../203580/index.html">Cognitive PDF / A - the technology of digitizing text documents for publication on the Internet and long-term archiving</a></li>
<li><a href="../203582/index.html">Contest: Telegram for Windows Phone - 3 million rubles in the first round</a></li>
<li><a href="../203584/index.html">SMM's rest, the programmer is working. Automatically Voyager VKontakte</a></li>
<li><a href="../203586/index.html">Monte Carlo simulation of the blogosphere</a></li>
<li><a href="../203592/index.html">Dynamic access control: what resources are</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>