<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Java and Public Morozov pattern</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Once it took me to redefine the field marked as private final on a running program. And it was impossible to stop the program, because the server. Wel...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Java and Public Morozov pattern</h1><div class="post__text post__text-html js-mediator-article">  Once it took me to redefine the field marked as private final on a running program.  And it was impossible to stop the program, because the server.  Well, as a small addition, the type of the variable was defined as an inner class.  Of course, also private. <br><br>  Fortunately, the program allows you to connect modules containing arbitrary code on the go.  So - at our disposal all the power of reflection! <a name="habracut"></a><br><br>  I remind you that this is a proof-of-concept, so for a specific task you will at least have to set the necessary type for accessor, and in general, if the code is torn out of context, some blocks may lose their meaning.  For example, in the above example, everything will work and without replacing the accessor in general, it will be enough to remove the final.  Keep in mind that this will work only for objects.  Primitives are usually inlined by the compiler. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">package main; <br> <br> <font color="#0000ff">class</font> PublicMorozov <br> { <br> <font color="#008000">//  ,       inner </font> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final PublicMorozov INSTANCE = <font color="#0000ff">new</font> PublicMorozov(); <br> <font color="#008000">//  ,     </font> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> final java.lang. <font color="#0000ff">ref</font> .WeakReference&lt;Inner&gt; targetField = <font color="#0000ff">new</font> java.lang. <font color="#0000ff">ref</font> .WeakReference&lt;Inner&gt;( <font color="#0000ff">null</font> ); <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">class</font> Inner <br> {} <br> <br> <font color="#0000ff">public</font> PublicMorozov() <br> {} <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> makeReplace() throws <font color="#2B91AF">Exception <br></font> { <br> <font color="#008000">//    ,   </font> <br> java.lang.reflect.Field targetAsField = Class.forName( <font color="#A31515">"main.PublicMorozov"</font> ).getDeclaredField( <font color="#A31515">"targetField"</font> ); <br> <font color="#008000">//    private</font> <br> targetAsField.setAccessible( <font color="#0000ff">true</font> ); <br> <br> <font color="#008000">//       </font> <br> java.lang.reflect.Field modifiers = Class.forName( <font color="#A31515">"java.lang.reflect.Field"</font> ).getDeclaredField( <font color="#A31515">"modifiers"</font> ); <br> <font color="#008000">//    private</font> <br> modifiers.setAccessible( <font color="#0000ff">true</font> ); <br> <br> <font color="#008000">//     private  final,     public</font> <br> modifiers.setInt(targetAsField, targetAsField.getModifiers() &amp; ~java.lang.reflect.Modifier.FINAL); <br> modifiers.setInt(targetAsField, targetAsField.getModifiers() &amp; ~java.lang.reflect.Modifier.PRIVATE); <br> modifiers.setInt(targetAsField, targetAsField.getModifiers() | java.lang.reflect.Modifier.PUBLIC); <br> <br> <font color="#008000">//     ...            IllegalAccessException</font> <br> <font color="#008000">//    accessor  ,     </font> <br> <font color="#008000">//    overrideFieldAccessor     private,      fieldAccessor</font> <br> java.lang.reflect.Field accessorField = Class.forName( <font color="#A31515">"java.lang.reflect.Field"</font> ).getDeclaredField( <font color="#A31515">"overrideFieldAccessor"</font> ); <br> <font color="#008000">//      private</font> <br> accessorField.setAccessible( <font color="#0000ff">true</font> ); <br> <font color="#008000">//     Object     ,        </font> <br> java.lang.reflect.Constructor accessorConstructor = Class.forName( <font color="#A31515">"sun.reflect.UnsafeQualifiedStaticObjectFieldAccessorImpl"</font> ).getDeclaredConstructor(java.lang.reflect.Field. <font color="#0000ff">class</font> , boolean. <font color="#0000ff">class</font> ); <br> <font color="#008000">//   ...     ?</font> <br> accessorConstructor.setAccessible( <font color="#0000ff">true</font> ); <br> <font color="#008000">//     -  accessor   final    </font> <br> accessorField. <font color="#0000ff">set</font> (targetAsField, accessorConstructor.newInstance(targetAsField, <font color="#0000ff">false</font> )); <br> <br> <font color="#008000">//    -   inner </font> <br> java.lang.reflect.Constructor innerConstructor = Class.forName( <font color="#A31515">"main.PublicMorozov$Inner"</font> ).getDeclaredConstructor(Class.forName( <font color="#A31515">"main.PublicMorozov"</font> )); <br> innerConstructor.setAccessible( <font color="#0000ff">true</font> ); <br> <br> <font color="#008000">//     </font> <br> targetAsField. <font color="#0000ff">set</font> ( <font color="#0000ff">null</font> , <font color="#0000ff">new</font> java.lang. <font color="#0000ff">ref</font> .WeakReference&lt;Inner&gt;((Inner) innerConstructor.newInstance(INSTANCE))); <br> } <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> </div><p>Source: <a href="https://habr.com/ru/post/75661/">https://habr.com/ru/post/75661/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../75647/index.html">Objectified - industrial design film</a></li>
<li><a href="../75649/index.html">His sapper on his batch file</a></li>
<li><a href="../75655/index.html">The thorny path of a young company</a></li>
<li><a href="../75656/index.html">Wave Wave Gadgets Using the Audio Player Example</a></li>
<li><a href="../75658/index.html">Supercomputer "Lomonosov"</a></li>
<li><a href="../75662/index.html">Layout hyphens, minuses, dashes and quotes</a></li>
<li><a href="../75663/index.html">Chain quine of arbitrary order in Python</a></li>
<li><a href="../75664/index.html">Song about Hosting.UA - my sequel</a></li>
<li><a href="../75666/index.html">Brief Introduction to Chaos Theory</a></li>
<li><a href="../75667/index.html">"Call from nowhere" or mystic Korean phones</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>