<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>"Weather in the house" or how our office meteorological station is arranged</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In fact, the idea has been in the air for several years. We fantasized in some detail how we would use the data of our own weather station to correct ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>"Weather in the house" or how our office meteorological station is arranged</h1><div class="post__text post__text-html js-mediator-article">  In fact, the idea has been in the air for several years.  We fantasized in some detail how we would use the data of our own weather station to correct the weather forecast on the <a href="http://pogoda.mail.ru/">Weather@Mail.Ru</a> service, show the video transmission of weather conditions outside the window and even build a network of weather stations and broadcasts from our users.  Well, maybe, once all this will really happen, but for the time being we started small - with everyone who wants to send data from our office meteorological station.  How it looks you can see here: <a href="http://pogoda.mail.ru/office/">pogoda.mail.ru/office</a> .  And how it works - read on. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fa0/9d2/03d/fa09d203de21be30212ef1feb830dcb9.jpg" alt="Weather@Mail.Ru"></div><br><br><a name="habracut"></a><br>  At present, the service is aimed primarily at the company's employees (‚Äúwhat‚Äôs behind the window?‚Äù, ‚ÄúHow to dress?‚Äù Is very important, by the way, when you go from the south of Moscow to the office to the north, where the weather is often quite different) residents of the vicinity (who, of course, know where the Mail.Ru Group office is - let me remind you that we are located <a href="http://maps.mail.ru/%3Fz%3D17%26ll%3D37.5329,55.7992%26m%3D37.5329,55.7992,%25D0%25B4.%252047%250A%25D0%259B%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25BD%25D0%25B3%25D1%2580%25D0%25B0%25D0%25B4%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9%2520%25D0%25BF%25D1%2580%25D0%25BE%25D1%2581%25D0%25BF%25D0%25B5%25D0%25BA%25D1%2582%253B%2520%25D0%25B3.%2520%25D0%259C%25D0%25BE%25D1%2581%25D0%25BA%25D0%25B2%25D0%25B0,o">two minutes from the airport</a> ) and other idle observers (for example, when it howls so convincingly behind the window, I run to see with interest wind power shown by our station).  There is another category of observers - visitors to our office, but more on that below. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  We turn to the most interesting - ‚Äúhow it works?‚Äù </h3><br>  First of all, we chose a hardware weather complex Davis 6162EU Wireless Vantage Pro2 PLUS (cost about 50 thousand rubles) from the company Davis Instruments.  Why exactly Davis?  I wanted to strike a balance between the completely ‚Äúhome‚Äù stations from RST or Oregon Scientific (by the way, a great gift to a friend / colleague who is ‚Äúaddicted‚Äù from gadgets) and very deeply professional, for example, Coastal Environmental, which are used by the military and rescuers. <br><br>  The choice of model is due, in turn, to several other factors: power from the built-in battery (it is recharged from the solar battery), wireless interaction between the external and internal units, and additional sensors.  Wireless technology allowed without engineering costs to mount the station in a few hours and virtually eliminate its maintenance.  Moreover, if we change the office that will happen in the foreseeable future, we will take it with us. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f20/cc5/b38/f20cc5b38bc6464acb112723f7adcdd7.jpg" alt="Weather@Mail.Ru"></div><br><br>  What our station can measure and show: <br><ul><li>  Atmosphere pressure </li><li>  Outdoor and room air temperature </li><li>  Outdoor and indoor relative humidity </li><li>  Wind speed and direction </li><li>  Dew point temperature </li><li>  Amount and intensity of precipitation </li><li>  Solar intensity </li><li>  UV index </li></ul><br>  In addition, it can calculate the phase of the moon, the time of sunrise and sunset, and also has the function of weather forecasting.  The predictive model works quite simple and difficult at the same time, it takes into account the following factors: the coordinates of the location of the complex, the season, the current value of the atmospheric pressure and its change, the speed and direction of the wind, temperature and humidity, the amount of precipitation.  As a result, we get a text forecast for the coming hours, for the most part completely justified. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9a2/010/e49/9a2010e4953878a25b3ae024247ebfb2.jpg" alt="Weather@Mail.Ru"></div><br><br>  Thus, the station has almost everything that is needed, except that there is not enough automatic detection of the nature of clouds.  That's just for these purposes, we thought at one time about the video complex, but so far we have decided to limit ourselves to a pragmatic look behind the window. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f6a/a00/45e/f6aa0045e2e7637c9852bc708ed75950.jpg" alt="Weather@Mail.Ru"></div><br><br>  So, in one sunny, hot summer day we installed the external unit of the weather station on the roof of our office, and the internal one - in the server room, on the floor below.  Since we immediately aimed at using data on the web, we neglected the availability of the indoor unit (oh, the real weather control panel!) And placed it next to the server.  Yes, at the same time, on the one hand, we lost the function of temperature and humidity control inside the office, on the other hand, we acquired an additional opportunity to monitor the server climate. <br><br><h3>  About the features of the technical implementation of the project </h3><br>  As Andrei Mainagashev, the system architect of the project, says, to regularly receive weather data from our station, we had to allocate a separate PC in our office server room, for which WeatherLink software was purchased and installed (cost about 8,000 rubles).  The internal unit of the meteorological station communicates with this computer using a special cable that allows you to connect the device‚Äôs COM port to the PC‚Äôs USB connector.  The main condition for obtaining actual data about the ‚Äúweather outside the window‚Äù is the constantly working and appropriately configured WeatherLink application. <br><br>  We immediately had a question about the form in which this software can provide weather data and how we can transfer it to our web server.  Having rummaged in the documentation, we found out that, among other possibilities, this software can create files with weather data based on templates (for example, which turned out to be sufficient) using a flexibly customizable schedule, connect to the Internet (if necessary), and publish these files using the protocol FTP or save locally to disk (including network). <br><br>  Regarding the format of the template, we decided quickly enough - we decided to use simple and easily readable JSON.  Some question arose with the method of transferring the generated files from the internal network of the office, where the PC meteorological station itself is located, to a remote working web server, where the obtained data should be saved, consolidated and provided for beautiful display on the pages of user browsers. <br><br>  FTP was immediately dropped due to its insecurity.  We considered the option of giving these files via HTTP, raising a ‚ÄúWindows‚Äù web server for this purpose, but this solution required access from the outside to the internal office network and thus caused logical negative evaluations from security specialists. <br><br>  As a result, we stopped at the option of generating weather data files on a local disk with their subsequent transfer to a remote web server using the HTTP protocol (using the PUT method).  And already the process of analyzing and post-processing and storing the information received was assumed on the server itself.  Thus, we got a solution in which all the data we are interested in from the office meteorological station every minute is added to the database of the project Weather@Mail.Ru, and there they are constantly available for display "on the web." <br><br>  Separately, I would like to say a few words about the task of translating into Russian the texts of the forecasts that the WeatherLink program forms.  I had to look inside the program to get a lot of options for constructing English phrases, from which predictions are collected as a result.  After that, highlighting the phrases and defining their order to search when building Russian phrases, we managed to achieve a less sane translation. <br><br><h3>  Says and shows </h3><br>  Initially, we planned to show data from the station on special monitors in the office and give employees access to view this data on the web.  Immediately the question arose - how to draw and impose?  We decided to focus on a large range of monitor resolutions, to make the picture as functional as possible, friendly and at the same time ascetic enough not to distract the user‚Äôs graphics from the data, so it was decided to use vector graphics. <br>  Implemented the idea of ‚Äã‚ÄãArtem Sapegin ( <a href="http://habrahabr.ru/users/sapegin/" class="user_link">sapegin</a> ), web technologist.  To work with vector graphics (SVG) from JavaScript, the Rapha√´l library is used.  It provides a convenient API for all major SVG features.  In addition, it works in IE 6-8, emulating SVG using VML. <br><br>  The "Informer" script consists of three parts: a set of widgets, layouts and the main script that unites all this. <br><br>  Widgets - minimal interface elements.  Both simple, like text or arrows (any vector object, the angle of rotation of which depends on the data), and complex, for example, a histogram (which includes both text and arrows).  Each widget can update the data and design.  And the one and the other happens with the animation.  If you watch the page for a while, you can see how the hand of the clock moves.  And if you stock up with a thermos of coffee and sandwiches, you can even wait for the change of day and night. <br><br>  The layout is a hefty description of all types of widgets, their links to incoming data, their design, themes used (day and night), etc. <br><br>  Not without difficulty, of course.  For example, Rapha√´l does not allow you to fully control the transparency of the gradients, so the gradient on the translucent background ‚Äúdog‚Äù is added by manually changing the properties of the SVG node created by the rafael. <br><br>  Another difficulty is the upper die for the entire width of the screen.  After several experiments, I found a very simple way to draw it: the plate is shifted to the left and has a width that is obviously more than you might need.  That is, it simply ‚Äúhangs‚Äù beyond the boundaries of the SVG object on both sides.  However, IE, even the 9th, which supports the real SVG, does not allow to draw something outside the SVG / VML object.  Therefore, especially for IE, the plate is made a background image for the body tag. <br><br><h3>  What happened? </h3><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b34/584/097/b345840978a6b11e06d3b59bd12d7e2f.jpg" alt="Weather@Mail.Ru"></div><br><br>  Visitors to our central office in Avion Business Center can see at the reception a special monitor that tells them about the weather, and you, dear readers, right now can see the result here: <a href="http://pogoda.mail.ru/office/">http://pogoda.mail.ru/office/</a> <br><br><h3>  And about the weather </h3><br>  Literally the other day, a new version of <a href="http://pogoda.mail.ru/">Weather @ Mail.Ru</a> was launched, where in addition to traditional forecast data for several thousand cities, one more was added - a data slice from our weather station.  And let it be so far only Moscow, but Mail.Ru Group has many representative offices in different parts of our country and even abroad.  We dream that the stations will appear everywhere in our offices and we will create a full-fledged network of weather stations that will help our users to prepare a little more correctly for traditional weather surprises, which so far no one can foresee for certain. <br><br>  And ... let it always be summer! <br><br>  <i>Rozhkov Anatoly,</i> <i><br></i>  <i>Director of Media Projects Mail.Ru</i> </div><p>Source: <a href="https://habr.com/ru/post/135189/">https://habr.com/ru/post/135189/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../135179/index.html">About personal programming experience in transport, McDonald's and other crowded and noisy places.</a></li>
<li><a href="../135180/index.html">About the sad test</a></li>
<li><a href="../135182/index.html">Canobuvosti, 123rd edition</a></li>
<li><a href="../135183/index.html">Abnormal Agile in Finance</a></li>
<li><a href="../135187/index.html">Dropbox for Android 2.0!</a></li>
<li><a href="../135190/index.html">Update one file or combine multiple patches</a></li>
<li><a href="../135191/index.html">7 ways to increase your loyal audience</a></li>
<li><a href="../135192/index.html">Installing samba3 on Mac OS X Lion 10.7.x</a></li>
<li><a href="../135193/index.html">IndexTank Search Engine transferred to open source</a></li>
<li><a href="../135195/index.html">Bitcoin is back?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>