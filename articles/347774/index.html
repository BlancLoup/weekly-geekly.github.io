<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Laziness worked instagram</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Foreword 
 Now many people use instagram (further insta): someone collects albums there, someone sells, someone buys, and I'm lazy there. I was always...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Laziness worked instagram</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/gf/yu/da/gfyuda9fmcd6xyopusaaumuy_wm.png"></div><br><br><h2>  Foreword </h2><br>  Now many people use instagram (further insta): someone collects albums there, someone sells, someone buys, and I'm lazy there.  I was always wondering how my friends, classmates, colleagues and insta were doing there to help.  I wanted to find out what was new there - I went in, I looked through the tape, I saw everything that interested I had left ... BUT!  For some reason I always had to like every post (I can not explain why, but such are the cases).  And imagine, I didn‚Äôt go there for a week, you sit, you like a weekly pool, and when you have 200+ subscriptions, it‚Äôs all hell. <br><a name="habracut"></a><br><h2>  Active activities </h2><br>  As a result, like any normal person, I was too lazy to like everything and I scored.  It seems that everything was fine, I stopped spending a lot of time on useless huskies, but my conscience ate me.  I understood that subscribers are bad without my royal husky, they feel sad and blah blah ... In general, it was decided that you need to write something simple and easy that can solve the problem of resentment, and maybe help someone else.  From friends I have heard a lot about python and how to test applications using selenium or use it as a certain crawler.  It was decided to use python and selenium in conjunction with phantom js, it was all new to me, because  Before that, I was not familiar with these technologies at all. <br><br><h2>  Why Selenium and phantom? </h2><br>  It's all very simple.  The instagram client part is written on react, therefore, any data can be pulled there only after the page is srenderen.  Since  selenium just serves to automate actions in the browser, and phantom js helps to do it all without any display, it was decided to use them.  Looking ahead to say that I decided to give up phantom js due to the fact that it is quite slow, and chrome had a headless option, which allowed it to be used as a ‚Äúheadless‚Äù browser. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Why python? </h2><br>  I heard and read a lot about the fact that this language is great for working with big data, from here I concluded that it is convenient to work with any data at all (to parse, sort, compare, format, etc.), I also read somewhere that it‚Äôs convenient and quick to write my own mini-library (and this is what is needed for the bot to make it as versatile as possible).  After weighing everything, I decided to stop on python3 (before this, part of the project was already written with the ability to run on python2 and python3). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/4d/ec/nz/4decnzewaxvlowsw0vt9i6cs_wk.gif"></div><br><h2>  Library development for the bot </h2><br>  It‚Äôs stupid to describe the whole process, so let‚Äôs focus on the most interesting points: <br><br><ul><li><h5>  Authorization </h5><br>  Since a bot is a repetition of a large number of the same actions for which you need to be authorized, it was necessary to invent something with this process.  Each time it is very suspicious to log in through the form, it was decided to try to pull cookies and use them for authorization. <br><br><div class="spoiler">  <b class="spoiler_title">It turned out that with instagram everything is simple (but mail ru gave me a wild headache):</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pickle <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> tempfile <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> selenium.common.exceptions <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> excp <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">auth_with_cookies</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(browser, logger, login, cookie_path=tempfile.gettempdir</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" Authenticate to instagram.com with cookies :param browser: WebDriver :param logger: :param login: :param cookie_path: :return: """</span></span> logger.save_screen_shot(browser, <span class="hljs-string"><span class="hljs-string">'login.png'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: logger.log(<span class="hljs-string"><span class="hljs-string">'Trying to auth with cookies.'</span></span>) cookies = pickle.load(open(os.path.join(cookie_path, login + <span class="hljs-string"><span class="hljs-string">'.pkl'</span></span>), <span class="hljs-string"><span class="hljs-string">"rb"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> cookie <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> cookies: browser.add_cookie(cookie) browser.refresh() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> check_if_user_authenticated(browser): logger.log(<span class="hljs-string"><span class="hljs-string">"Successful authorization with cookies."</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> logger.log(<span class="hljs-string"><span class="hljs-string">"Unsuccessful authorization with cookies."</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">auth_with_credentials</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(browser, logger, login, password, cookie_path=tempfile.gettempdir</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> logger.log(<span class="hljs-string"><span class="hljs-string">'Trying to auth with credentials.'</span></span>) login_field = browser.find_element_by_name(<span class="hljs-string"><span class="hljs-string">"username"</span></span>) login_field.clear() logger.log(<span class="hljs-string"><span class="hljs-string">"---&gt;AuthWithCreds: filling username."</span></span>) login_field.send_keys(login) password_field = browser.find_element_by_name(<span class="hljs-string"><span class="hljs-string">"password"</span></span>) password_field.clear() logger.log(<span class="hljs-string"><span class="hljs-string">"---&gt;AuthWithCreds: filling password."</span></span>) password_field.send_keys(password) submit = browser.find_element_by_css_selector(<span class="hljs-string"><span class="hljs-string">"form button"</span></span>) logger.log(<span class="hljs-string"><span class="hljs-string">"---&gt;AuthWithCreds: submitting login form."</span></span>) submit.submit() time.sleep(<span class="hljs-number"><span class="hljs-number">3</span></span>) logger.log(<span class="hljs-string"><span class="hljs-string">"---&gt;AuthWithCreds: saving cookies."</span></span>) pickle.dump([browser.get_cookie(<span class="hljs-string"><span class="hljs-string">'sessionid'</span></span>)], open(os.path.join(cookie_path, login + <span class="hljs-string"><span class="hljs-string">'.pkl'</span></span>), <span class="hljs-string"><span class="hljs-string">"wb"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> check_if_user_authenticated(browser): logger.log(<span class="hljs-string"><span class="hljs-string">"Successful authorization with credentials."</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> logger.log(<span class="hljs-string"><span class="hljs-string">"Unsuccessful authorization with credentials."</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_if_user_authenticated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(browser)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: browser.find_element_by_css_selector(<span class="hljs-string"><span class="hljs-string">".coreSpriteDesktopNavProfile"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> excp.NoSuchElementException: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span></code> </pre> </div></div><br>  In case of unsuccessful authorization by cookies, we login with a login / password, save the cookie and use it in the future, the standard scheme. <br><br> <code>#TODO:        </code> <br> </li><li><h5>  Licking News Feeds </h5><br>  Since  First of all, I wrote this for myself; I was interested in my news tape being always otlaykan.  Initially, everything was simple, scrolling down to the last processed post, web elements of posts are entered into an array, the back is turned on and like everything on the way back, laid out through web elements of posts that lie in the previously created array.  I was happy that everything works exactly the way I wanted it, but after about two months the ‚Äúmoon was ibex‚Äù and my bot stupidly stopped working.  I checked everything as I could, on different web drivers, visually nothing has changed, but at the same time nothing works.  In general, I killed in search of a problem for about three days.  Everything turned out to be very simple: earlier when the bot was going through the scrolled posts, it took their objects from the array, scrolled to the post (imitating the actions of a person), found the like button there, pressed it and went on;  now the instagram decided to keep in the html markup only ~ 9 posts from which in the 5th structure is active for the user, the previous 4 and the next 4, and all the others from html were simply deleted.  It was necessary to solve the issue by collecting those posts that need to be likened to the array by their link, then when scrolling up (stupidly upwards) to look for the current post in the previously collected array and if there is one there - like. <br><br><div class="spoiler">  <b class="spoiler_title">She is also a drug addiction ..</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> post <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> progress: real_time_posts = br.find_elements_by_tag_name(<span class="hljs-string"><span class="hljs-string">'article'</span></span>) post_link = post.get(<span class="hljs-string"><span class="hljs-string">'pl'</span></span>) filtered_posts = [p <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> real_time_posts <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self._get_feed_post_link(p) == post_link] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> filtered_posts.__len__(): real_post = filtered_posts.pop() <span class="hljs-comment"><span class="hljs-comment"># scroll to real post in markup heart = real_post.find_element_by_css_selector('div:nth-child(3) section a:first-child') self.browser.execute_script("return arguments[0].scrollIntoView(false);", heart) # getting need to process elements author = real_post.find_element_by_css_selector('div:first-child .notranslate').text heart_classes = heart.find_element_by_css_selector('span').get_attribute('class') # check restrictions is_not_liked = 'coreSpriteHeartOpen' in heart_classes is_mine = author == login need_to_exclude = author in exclude if is_mine or not is_not_liked: self.post_skipped += 1 pass elif need_to_exclude: self.post_skipped_excluded += 1 pass else: # like this post time.sleep(.3) heart.click() time.sleep(.7) self.db.likes_increment() self.post_liked += 1 log = '---&gt; liked @{} post {}'.format(author, post_link) self.logger.log_to_file(log)</span></span></code> </pre> </div></div><br>  VICTORY! <br><div style="text-align:center;"><img width="300" src="https://habrastorage.org/webt/cx/q0/6w/cxq06w9kewpqnpg5fhyw2ukq5-g.gif"></div></li><li><h5>  Action limits </h5><br>  In order not to attract a lot of attention, you need to put some restrictions to the bot.  In order to adhere to these restrictions, you need to save the counters of actions taken somewhere.  For the storage of all internal information, sqlite was chosen - quickly, conveniently, locally.  Right in the library, I wrote a small module to work in the database, and added migration to the same place - for subsequent releases.  Every Like / Follow is stored in the database with the hour in which it is made, then likes / followers per day / current hour are considered, based on these data it is decided whether someone else can like or follow someone.  Limits are still fixed in the library, you will need to make them configurable. </li><li><h5>  Branch in the development process </h5><br>  While the library for the bot was being written, the tsiferka issue was in my head.  It was interesting how many user likes, views, comments in the context of the post or sumno.  To satisfy the interest, a small class of the library was written, which through a private api instagram collected all available (without authorization) statistics and gave it to the user: <br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="bash hljs">+-- https://instagram.com/al_kricha/ --------------------------+ | counter | value | +------------------------------+-------------------------------+ | followed | 402 | | posts | 397 | | comments | 1602 | | likes | 20429 | | following | 211 | | video views | 6138 | | | +--------- https://github.com/aLkRicha/insta_browser ----------+ +--------------------------------------------------------------+ | top liked posts | +--------------------------------------------------------------+ | https://instagram.com/p/BVIUvMkj1RV/ - 139 likes | | https://instagram.com/p/BTzJ38-DkUT/ - 132 likes | | https://instagram.com/p/BI8rgr-gXKg/ - 129 likes | | https://instagram.com/p/BW-I6o6DBjm/ - 119 likes | | https://instagram.com/p/BM4_XSoFhck/ - 118 likes | | https://instagram.com/p/BJVm3KIA-Vj/ - 117 likes | | https://instagram.com/p/BIhuQaCgRxI/ - 113 likes | | https://instagram.com/p/BM6XgB2l_r7/ - 112 likes | | https://instagram.com/p/BMHiRNUlHvh/ - 112 likes | | https://instagram.com/p/BLmMEwjlElP/ - 111 likes | +--------------------------------------------------------------+</code> </pre> </div></div><br>  Having such data, we and a friend ( <a href="https://github.com/txwkx"><b>txwkx</b></a> ) decided to visualize them and created <a href="https://instameter.me/"><b>instameter.me</b></a> - a small service where you can see the ‚Äúsummary‚Äù of any open instagram account. <br><br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/9c/ic/uc/9cicuc4dzqazjn0cez3ye70ctpw.png"></div></div></li><li><h5>  What can a bot? </h5><br>  At present, the bot is not able to do so much as it should be, but nevertheless, it performs the key actions: <br><br><ul><li>  Like a news feed to the last unlisted. </li><li>  Like tag on the specified number of posts </li><li>  Like location on the specified number of posts </li><li>  Auto-follower of people from the location / tag posts, when the setting is turned on, but not all in a row, but only those who can potentially become subscribers </li><li>  Collect user statistics </li><li>  Stores statistics on the clock about the committed action </li></ul><br></li><li><h5>  What would you like to do in the future? </h5><br><ul><li>  Writing ¬± meaningful comments </li><li>  Unsubscribe from unnecessary accounts </li><li>  Like a few posts of a freshly named person </li><li>  Rewrite the passage of the news feed </li><li>  Compare multiple accounts </li></ul></li></ul><br><h2>  Conclusion </h2><br>  There is still a lot to do, optimize, rewrite.  You can always effectively use the tool for other purposes.  Laziness is precisely the engine of progress.  I hope someone my bot will help or in work, or a hobby.  A repository with a pypi-package can help a beginner automator.  A repository with examples may be useful for SMM users.  Thank you all for your attention. <br><br><h2>  Links </h2><br><ul><li>  <a href="https://github.com/aLkRicha/insta_browser">insta_browser</a> - my mini library, the heart of the bot </li><li>  <a href="https://github.com/aLkRicha/insta_bot">insta_bot</a> - examples repository, the bot itself (in this form, I use it) </li><li>  <a href="https://instameter.me/">instameter</a> - a project to remove statistics on an instagram account </li></ul></div><p>Source: <a href="https://habr.com/ru/post/347774/">https://habr.com/ru/post/347774/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../347760/index.html">And so it will do ... or how the data of 14 million Russians were in my hands</a></li>
<li><a href="../347764/index.html">20 times cheaper, 2.5 times more accurate and twice as convenient</a></li>
<li><a href="../347768/index.html">Conservative national crypto regulation. What do new bills carry us?</a></li>
<li><a href="../347770/index.html">Industrial barcode scanners: new technologies in AutoID</a></li>
<li><a href="../347772/index.html">MentorHack: Tinder for Mentor Search, AI Boss and a bit of HRTech</a></li>
<li><a href="../347776/index.html">The world is still ruled by language C</a></li>
<li><a href="../347778/index.html">Play an hour or kill time in Unity</a></li>
<li><a href="../347780/index.html">Little about the retrospective</a></li>
<li><a href="../347782/index.html">Skills, tools, requirements - HackerRank's large-scale developer market research 2018</a></li>
<li><a href="../347786/index.html">Cast. Visual contrast static_cast from dynamic_cast</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>