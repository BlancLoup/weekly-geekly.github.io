<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>memset - side of darkness</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After reading the article The most dangerous function in the world of C / C ++, I found it useful to go deeper into the evil in the dark cellar of mem...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>memset - side of darkness</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/96a/3eb/efb/96a3ebefb1714693a5fd9ef314aefce6.jpg"><br><br>  After reading the article <a href="http://habrahabr.ru/company/pvs-studio/blog/272243/">The most dangerous function in the world of C / C ++,</a> I found it useful to go deeper into the evil in the dark cellar of <i>memset</i> , and write a supplement in order to broaden the essence of the problem. <br><a name="habracut"></a><br>  In C, memset () is commonly used, concealing many pitfalls.  Excerpt from C ++ Reference: <br><blockquote>  void * memset (void * ptr, int value, size_t num); <br>  <b>Fill block of memory</b> <br>  It can be interpreted as interpreted by the text. <br>  <b>Parameters</b> <br>  ptr - pointer to memory. <br>  value - Value to be set.  The value of the fills is what the block of memory uses. <br>  num - Number to by value.  size_t is an unsigned integral type. <br>  <b>Return value</b> <br>  ptr is returned. </blockquote><br>  As already noted several times, there are many rakes, which are attacked even by experienced developers.  From the <a href="http://habrahabr.ru/users/andrey2008/" class="user_link">Andrey2008</a> article described in the article <a href="http://habrahabr.ru/users/andrey2008/" class="user_link">, a</a> brief <b>summary of common errors</b> : <br><br>  ‚Ññ1.  Trying to calculate the size of an array or structure, do not use sizeof () for pointers to an array / structure, it will return you a pointer size of 4 or 8 bytes, instead of the size of the array / structure. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      ‚Ññ2.  The third argument, memset (), takes as input the number of bytes, not the number of elements, not taking into account the data type.  I will add more, for example, the type int can occupy both 4 and 8 bytes, depending on the architecture.  In this case, use sizeof (int). <br><br>  Number 3.  Do not confuse the arguments.  The correct sequence is a pointer, a value, a length in bytes. <br><br>  ‚Ññ4.  Do not use memset when working with class objects. <br><br>  But this is only the tip of the iceberg. <br><br><h3>  Alternative to memset </h3><br>  <b>memset</b> is a low-level function that binds the developer to take into account all the features of the computer architecture and its use must be justified.  Let's first consider the alternative <i>= {0}</i> , instead of <i>memset</i> , they say it allows you to initialize an array or string at the compilation stage, which should improve program performance, unlike memset (also ZeroMemory), which initialize data at runtime.  I decided to check it out. <br><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doInitialize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> p0[<span class="hljs-number"><span class="hljs-number">25</span></span>] = {<span class="hljs-number"><span class="hljs-number">0</span></span>} ; <span class="hljs-comment"><span class="hljs-comment">//   25   0 char p1[25] = "" ; //   25   0 wchar_t p2[25] = {0} ; //  25   0 wchar_t p3[25] = L"" ; //   25   0 short p4[62] = {0} //  62   0 int p5[37] = {-1} ; //      -1 unsigned int p6[10] = {89} ; //     89 }</span></span></code> </pre> <br>  <b>C99 [$ 6.7.8 / 21]</b> <br><blockquote>  If you‚Äôre trying to find out what to do, then be initialized implicitly storage duration. </blockquote><br>  At the same time, such initialization removes problems No. 1, No. 2, No. 3 with a confusion of parameters and buffer sizes.  That is, we will not confuse the second and third arguments in some places, it is not necessary to transfer the size.  Let's see how compilers transform such code.  I can not check all the compilers right away, the gcc included in android-ndk-r10c, as well as gcc in ubuntu 14.04, were on hand. <br><br><div class="spoiler">  <b class="spoiler_title">gcc -v</b> <div class="spoiler_text">  1) gcc version 4.9 20140827 (prerelease) (GCC) <br>  2) gcc version 4.8.2 (Ubuntu 4.8.2-19ubuntu1) <br></div></div><br>  Let's see how the compiler behaves on such a piece of code: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">empty_string</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> p1[<span class="hljs-number"><span class="hljs-number">25</span></span>] = {<span class="hljs-number"><span class="hljs-number">0</span></span>}; <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"\np1: "</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">25</span></span>; i++) <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"%x,"</span></span>,p1[i]); }</code> </pre><br>  So, without optimization (-O0), array initialization is compiled into such an assembler code (we scan the binaries with the help of objdump): <br><br><div class="spoiler">  <b class="spoiler_title">gcc -O0, ELF 32-bit, ARM, EABI5</b> <div class="spoiler_text"><pre> <code class="hljs css"> 83<span class="hljs-selector-tag"><span class="hljs-selector-tag">d8</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e3a03000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-id"><span class="hljs-selector-id">#0</span></span> 83<span class="hljs-selector-tag"><span class="hljs-selector-tag">dc</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e50b3024</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">str</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-attr"><span class="hljs-selector-attr">[fp, #-36]</span></span> ; 0<span class="hljs-selector-tag"><span class="hljs-selector-tag">x24</span></span> 83<span class="hljs-selector-tag"><span class="hljs-selector-tag">e0</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e24b3020</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">sub</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">fp</span></span>, <span class="hljs-selector-id"><span class="hljs-selector-id">#32</span></span> 83<span class="hljs-selector-tag"><span class="hljs-selector-tag">e4</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e3a02000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span>, <span class="hljs-selector-id"><span class="hljs-selector-id">#0</span></span> 83<span class="hljs-selector-tag"><span class="hljs-selector-tag">e8</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e5832000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">str</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span>, <span class="hljs-selector-attr"><span class="hljs-selector-attr">[r3]</span></span> 83<span class="hljs-selector-tag"><span class="hljs-selector-tag">ec</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e2833004</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-id"><span class="hljs-selector-id">#4</span></span> 83<span class="hljs-selector-tag"><span class="hljs-selector-tag">f0</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e3a02000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span>, <span class="hljs-selector-id"><span class="hljs-selector-id">#0</span></span> 83<span class="hljs-selector-tag"><span class="hljs-selector-tag">f4</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e5832000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">str</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span>, <span class="hljs-selector-attr"><span class="hljs-selector-attr">[r3]</span></span> 83<span class="hljs-selector-tag"><span class="hljs-selector-tag">f8</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e2833004</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-id"><span class="hljs-selector-id">#4</span></span> 83<span class="hljs-selector-tag"><span class="hljs-selector-tag">fc</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e3a02000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span>, <span class="hljs-selector-id"><span class="hljs-selector-id">#0</span></span> 8400: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e5832000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">str</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span>, <span class="hljs-selector-attr"><span class="hljs-selector-attr">[r3]</span></span> 8404: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e2833004</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-id"><span class="hljs-selector-id">#4</span></span> 8408: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e3a02000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span>, <span class="hljs-selector-id"><span class="hljs-selector-id">#0</span></span> 840<span class="hljs-selector-tag"><span class="hljs-selector-tag">c</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e5832000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">str</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span>, <span class="hljs-selector-attr"><span class="hljs-selector-attr">[r3]</span></span> 8410: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e2833004</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-id"><span class="hljs-selector-id">#4</span></span> 8414: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e3a02000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span>, <span class="hljs-selector-id"><span class="hljs-selector-id">#0</span></span> 8418: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e5832000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">str</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span>, <span class="hljs-selector-attr"><span class="hljs-selector-attr">[r3]</span></span> 841<span class="hljs-selector-tag"><span class="hljs-selector-tag">c</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e2833004</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-id"><span class="hljs-selector-id">#4</span></span> 8420: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e3a02000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span>, <span class="hljs-selector-id"><span class="hljs-selector-id">#0</span></span> 8424: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e5c32000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">strb</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span>, <span class="hljs-selector-attr"><span class="hljs-selector-attr">[r3]</span></span> 8428: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e2833001</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-id"><span class="hljs-selector-id">#1</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">gcc -O0, ELF 64-bit, x86-64</b> <div class="spoiler_text"><pre> <code class="hljs perl"> <span class="hljs-number"><span class="hljs-number">400700</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span> c7 <span class="hljs-number"><span class="hljs-number">45</span></span> d<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> movq $0<span class="hljs-keyword"><span class="hljs-keyword">x</span></span><span class="hljs-number"><span class="hljs-number">0</span></span>,-<span class="hljs-number"><span class="hljs-number">0x30</span></span>(%rbp) <span class="hljs-number"><span class="hljs-number">400708</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span> c7 <span class="hljs-number"><span class="hljs-number">45</span></span> d8 <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> movq $0<span class="hljs-keyword"><span class="hljs-keyword">x</span></span><span class="hljs-number"><span class="hljs-number">0</span></span>,-<span class="hljs-number"><span class="hljs-number">0x28</span></span>(%rbp) <span class="hljs-number"><span class="hljs-number">400710</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span> c7 <span class="hljs-number"><span class="hljs-number">45</span></span> e<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> movq $0<span class="hljs-keyword"><span class="hljs-keyword">x</span></span><span class="hljs-number"><span class="hljs-number">0</span></span>,-<span class="hljs-number"><span class="hljs-number">0x20</span></span>(%rbp) <span class="hljs-number"><span class="hljs-number">400718</span></span>: c6 <span class="hljs-number"><span class="hljs-number">45</span></span> e8 <span class="hljs-number"><span class="hljs-number">00</span></span> movb $0<span class="hljs-keyword"><span class="hljs-keyword">x</span></span><span class="hljs-number"><span class="hljs-number">0</span></span>,-<span class="hljs-number"><span class="hljs-number">0x18</span></span>(%rbp)</code> </pre><br></div></div><br>  As expected, without optimization, we get run-time code that will eat O (n) processor time (where n is the buffer length).  What the compiler will do with optimization (-O3) can be seen below. <br><br>  <b>gcc -O3, 32-bit, ARM</b> <br><br><pre> <code class="hljs objectivec"><span class="hljs-number"><span class="hljs-number">000083</span></span>ac &lt;empty_string&gt;: <span class="hljs-number"><span class="hljs-number">83</span></span>ac: e59f002c ldr r0, [pc, <span class="hljs-meta"><span class="hljs-meta">#44] ; 83e0 </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;empty_string+0x34&gt;</span></span></span><span class="hljs-meta"> 83b0: e92d4038 push {r3, r4, r5, lr} 83b4: e08f0000 add r0, pc, r0 83b8: ebffffb2 bl 8288 </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;printf@plt&gt;</span></span></span><span class="hljs-meta"> 83bc: e59f5020 ldr r5, [pc, #32] ; 83e4 </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;empty_string+0x38&gt;</span></span></span><span class="hljs-meta"> 83c0: e3a04019 mov r4, #25 83c4: e08f5005 add r5, pc, r5 83c8: e1a00005 mov r0, r5 83cc: e3a01000 mov r1, #0 83d0: ebffffac bl 8288 </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;printf@plt&gt;</span></span></span><span class="hljs-meta"> 83d4: e2544001 subs r4, r4, #1 83d8: 1afffffa bne 83c8 </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;empty_string+0x1c&gt;</span></span></span><span class="hljs-meta"> 83dc: e8bd8038 pop {r3, r4, r5, pc}</span></span></code> </pre> <div class="spoiler">  <b class="spoiler_title">gcc -O3, 64-bit, x86-64</b> <div class="spoiler_text"><pre> <code class="hljs perl"><span class="hljs-number"><span class="hljs-number">00000000004006</span></span>d<span class="hljs-number"><span class="hljs-number">0</span></span> &lt;empty_string&gt;: <span class="hljs-number"><span class="hljs-number">4006</span></span>d<span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-number"><span class="hljs-number">53</span></span> <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> %rbx <span class="hljs-number"><span class="hljs-number">4006</span></span>d1: be a4 08 <span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> mov $0x4008a4,%esi <span class="hljs-number"><span class="hljs-number">4006</span></span>d6: bf <span class="hljs-number"><span class="hljs-number">01</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> mov $0x1,%edi <span class="hljs-number"><span class="hljs-number">4006</span></span>db: <span class="hljs-number"><span class="hljs-number">31</span></span> c<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">xor</span></span> %eax,%eax <span class="hljs-number"><span class="hljs-number">4006</span></span>dd: bb <span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> mov $0x32,%ebx <span class="hljs-number"><span class="hljs-number">4006</span></span>e2: e8 d9 fd ff ff callq <span class="hljs-number"><span class="hljs-number">4004</span></span>c<span class="hljs-number"><span class="hljs-number">0</span></span> &lt;__printf_chk@plt&gt; <span class="hljs-number"><span class="hljs-number">4006</span></span>e7: <span class="hljs-number"><span class="hljs-number">66</span></span> 0f <span class="hljs-number"><span class="hljs-number">1</span></span>f <span class="hljs-number"><span class="hljs-number">84</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> nopw <span class="hljs-number"><span class="hljs-number">0x0</span></span>(%rax,%rax,<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">4006</span></span>ee: <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">4006</span></span>f<span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-number"><span class="hljs-number">31</span></span> d2 <span class="hljs-keyword"><span class="hljs-keyword">xor</span></span> %edx,%edx <span class="hljs-number"><span class="hljs-number">4006</span></span>f2: <span class="hljs-number"><span class="hljs-number">31</span></span> c<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">xor</span></span> %eax,%eax <span class="hljs-number"><span class="hljs-number">4006</span></span>f4: be aa 08 <span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> mov $0x4008aa,%esi <span class="hljs-number"><span class="hljs-number">4006</span></span>f9: bf <span class="hljs-number"><span class="hljs-number">01</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> mov $0x1,%edi <span class="hljs-number"><span class="hljs-number">4006</span></span>fe: e8 bd fd ff ff callq <span class="hljs-number"><span class="hljs-number">4004</span></span>c<span class="hljs-number"><span class="hljs-number">0</span></span> &lt;__printf_chk@plt&gt; <span class="hljs-number"><span class="hljs-number">400703</span></span>: <span class="hljs-number"><span class="hljs-number">83</span></span> eb <span class="hljs-number"><span class="hljs-number">01</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> $0</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x1</span></span></span><span class="hljs-function">,%</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ebx</span></span></span><span class="hljs-function"> 400706: 75 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e8</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jne</span></span></span><span class="hljs-function"> 4006</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f0</span></span></span><span class="hljs-function"> &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">empty_string</span></span></span><span class="hljs-function">+0</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x20</span></span></span><span class="hljs-function">&gt; 400708: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pop</span></span></span><span class="hljs-function"> %</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rbx</span></span></span><span class="hljs-function"> 400709: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">c3</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">retq</span></span></span></span></code> </pre><br></div></div><br>  We see that the piece of code with zeroing in the run-time just disappeared, we got the promised performance O (1), let's see where does printf take its values?  We are interested in this piece: <br><br><pre> <code class="hljs objectivec"><span class="hljs-number"><span class="hljs-number">83</span></span>bc: ldr r5, [pc, <span class="hljs-meta"><span class="hljs-meta">#32] 83c0: mov r4, #25 ;//  r4    for,     83c4: add r5, pc, r5 ;//  r5   </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"%x,"</span></span></span><span class="hljs-meta">  ,      002c7825 83c8: mov r0, r5 ;// r5    r0    ,    printf() 83cc: mov r1, #0 ;//   0 (  p1[i])    printf() 83d0: bl 8288 </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;printf@plt&gt;</span></span></span><span class="hljs-meta"> 83d4: subs r4, r4, #1 ;//      83d8: bne 83c8 </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;empty_string+0x1c&gt;</span></span></span><span class="hljs-meta"> ;//     0,      83c8</span></span></code> </pre><br>  That is, the compiler simply threw out the array, and instead of its values ‚Äã‚Äãit uses 0, as a constant pledged at the compile stage.  Good, but what happens if we use <i>memset</i> ?  Let's look at a few pieces of objdump, for example, under ARM: <br><br>  <i>Without optimization -O0</i> : <br><br><pre> <code class="hljs perl"> <span class="hljs-number"><span class="hljs-number">83</span></span>d8: e24b3024 <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r3</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fp</span></span></span><span class="hljs-function">, #36 </span></span>; <span class="hljs-number"><span class="hljs-number">0x24</span></span> <span class="hljs-number"><span class="hljs-number">83</span></span>dc: e1a00003 mov r<span class="hljs-number"><span class="hljs-number">0</span></span>, r3 <span class="hljs-number"><span class="hljs-number">83</span></span>e<span class="hljs-number"><span class="hljs-number">0</span></span>: e3a0100<span class="hljs-number"><span class="hljs-number">0</span></span> mov r1, <span class="hljs-comment"><span class="hljs-comment">#0 83e4: e3a02019 mov r2, #25 83e8: ebffffa3 bl 827c &lt;memset@plt&gt;</span></span></code> </pre><br>  <i>Optimized with -O3</i> : <br><br><pre> <code class="hljs css"> 83<span class="hljs-selector-tag"><span class="hljs-selector-tag">c0</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e58d3004</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">str</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-attr"><span class="hljs-selector-attr">[sp, #4]</span></span> 83<span class="hljs-selector-tag"><span class="hljs-selector-tag">c4</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e58d3008</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">str</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-attr"><span class="hljs-selector-attr">[sp, #8]</span></span> 83<span class="hljs-selector-tag"><span class="hljs-selector-tag">c8</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e58d300c</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">str</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-attr"><span class="hljs-selector-attr">[sp, #12]</span></span> 83<span class="hljs-selector-tag"><span class="hljs-selector-tag">cc</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e58d3010</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">str</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-attr"><span class="hljs-selector-attr">[sp, #16]</span></span> 83<span class="hljs-selector-tag"><span class="hljs-selector-tag">d0</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e58d3014</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">str</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-attr"><span class="hljs-selector-attr">[sp, #20]</span></span> 83<span class="hljs-selector-tag"><span class="hljs-selector-tag">d4</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e58d3018</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">str</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-attr"><span class="hljs-selector-attr">[sp, #24]</span></span> 83<span class="hljs-selector-tag"><span class="hljs-selector-tag">d8</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e5cd301c</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">strb</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-attr"><span class="hljs-selector-attr">[sp, #28]</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">x86-64</b> <div class="spoiler_text">  Without optimization -O0: <br><pre> <code class="hljs perl"> <span class="hljs-number"><span class="hljs-number">400816</span></span>: ba <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> mov $0x19,%edx <span class="hljs-number"><span class="hljs-number">40081</span></span>b: be <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> mov $0<span class="hljs-keyword"><span class="hljs-keyword">x</span></span><span class="hljs-number"><span class="hljs-number">0</span></span>,%esi <span class="hljs-number"><span class="hljs-number">400820</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">89</span></span> c7 mov %rax,%rdi <span class="hljs-number"><span class="hljs-number">400823</span></span>: e8 a8 fc ff ff callq <span class="hljs-number"><span class="hljs-number">4004</span></span>d<span class="hljs-number"><span class="hljs-number">0</span></span> &lt;memset@plt&gt;</code> </pre><br>  Optimized with -O3: <br><pre> <code class="hljs perl"> <span class="hljs-number"><span class="hljs-number">4007</span></span>f4: <span class="hljs-number"><span class="hljs-number">48</span></span> c7 <span class="hljs-number"><span class="hljs-number">04</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> movq $0<span class="hljs-keyword"><span class="hljs-keyword">x</span></span><span class="hljs-number"><span class="hljs-number">0</span></span>,(%rsp) <span class="hljs-number"><span class="hljs-number">4007</span></span>fc: <span class="hljs-number"><span class="hljs-number">48</span></span> c7 <span class="hljs-number"><span class="hljs-number">44</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> 08 <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> movq $0<span class="hljs-keyword"><span class="hljs-keyword">x</span></span><span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0x8</span></span>(%rsp) <span class="hljs-number"><span class="hljs-number">400805</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span> c7 <span class="hljs-number"><span class="hljs-number">44</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> movq $0<span class="hljs-keyword"><span class="hljs-keyword">x</span></span><span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0x10</span></span>(%rsp) <span class="hljs-number"><span class="hljs-number">40080</span></span>e: c6 <span class="hljs-number"><span class="hljs-number">44</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> movb $0<span class="hljs-keyword"><span class="hljs-keyword">x</span></span><span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0x18</span></span>(%rsp)</code> </pre><br></div></div><br>  That is, the optimization simply removes the <i>memset</i> call, inserting it inline.  In such cases, <i>memset</i> will always work for O (n) time, but initialization with <i>= {0}</i> when optimizing works for a constant, in our case, without at all taking away processor cycles, brazenly throwing out the fact of the existence of an array and replacing all its elements zeros.  But let's see if this is always the case and what happens if we write a non-zero value after initialization?  The test function will look like this: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">empty_string</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> p1[<span class="hljs-number"><span class="hljs-number">25</span></span>] = {<span class="hljs-number"><span class="hljs-number">0</span></span>}; p1[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-number"><span class="hljs-number">65</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"\np1: "</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">25</span></span>; i++) <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"%x,"</span></span>,p1[i]); }</code> </pre><br>  After compilation we get the already familiar block of code: <br><br><pre> <code class="hljs css"> 8404: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e3a02041</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span>, <span class="hljs-selector-id"><span class="hljs-selector-id">#65</span></span> ; 0<span class="hljs-selector-tag"><span class="hljs-selector-tag">x41</span></span> 8408: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e08f0000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">pc</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">r0</span></span> 840<span class="hljs-selector-tag"><span class="hljs-selector-tag">c</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e58d3004</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">str</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-attr"><span class="hljs-selector-attr">[sp, #4]</span></span> 8410: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e58d3008</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">str</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-attr"><span class="hljs-selector-attr">[sp, #8]</span></span> 8414: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e58d300c</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">str</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-attr"><span class="hljs-selector-attr">[sp, #12]</span></span> 8418: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e58d3010</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">str</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-attr"><span class="hljs-selector-attr">[sp, #16]</span></span> 841<span class="hljs-selector-tag"><span class="hljs-selector-tag">c</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e58d3014</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">str</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-attr"><span class="hljs-selector-attr">[sp, #20]</span></span> 8420: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e58d3018</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">str</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-attr"><span class="hljs-selector-attr">[sp, #24]</span></span> 8424: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e5cd301c</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">strb</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-attr"><span class="hljs-selector-attr">[sp, #28]</span></span> 8428: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e5cd2004</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">strb</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r2</span></span>, <span class="hljs-selector-attr"><span class="hljs-selector-attr">[sp, #4]</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">x86-64</b> <div class="spoiler_text"><pre> <code class="hljs perl"> <span class="hljs-number"><span class="hljs-number">4006</span></span>f8: <span class="hljs-number"><span class="hljs-number">48</span></span> c7 <span class="hljs-number"><span class="hljs-number">04</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> movq $0<span class="hljs-keyword"><span class="hljs-keyword">x</span></span><span class="hljs-number"><span class="hljs-number">0</span></span>,(%rsp) <span class="hljs-number"><span class="hljs-number">4006</span></span>ff: <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">400700</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span> c7 <span class="hljs-number"><span class="hljs-number">44</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> 08 <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> movq $0<span class="hljs-keyword"><span class="hljs-keyword">x</span></span><span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0x8</span></span>(%rsp) <span class="hljs-number"><span class="hljs-number">400707</span></span>: <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">400709</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span> c7 <span class="hljs-number"><span class="hljs-number">44</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> movq $0<span class="hljs-keyword"><span class="hljs-keyword">x</span></span><span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0x10</span></span>(%rsp) <span class="hljs-number"><span class="hljs-number">400710</span></span>: <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">400712</span></span>: c6 <span class="hljs-number"><span class="hljs-number">44</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> movb $0<span class="hljs-keyword"><span class="hljs-keyword">x</span></span><span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0x18</span></span>(%rsp) <span class="hljs-number"><span class="hljs-number">400717</span></span>: c6 <span class="hljs-number"><span class="hljs-number">04</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">41</span></span> movb $0x41,(%rsp)</code> </pre><br></div></div><br>  And it looks as if the compiler has inserted into us an optimized <i>memset</i> version.  And let's see what happens if the size of the array grows significantly?  Say, not 25 bytes, but 25 kilobytes! <br><br><pre> <code class="hljs perl"> <span class="hljs-number"><span class="hljs-number">83</span></span>fc: e24ddc61 <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sp</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sp</span></span></span><span class="hljs-function">, #24832 </span></span>; <span class="hljs-number"><span class="hljs-number">0x6100</span></span> <span class="hljs-number"><span class="hljs-number">8400</span></span>: e24dd0a8 <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sp</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sp</span></span></span><span class="hljs-function">, #168 </span></span>; <span class="hljs-number"><span class="hljs-number">0xa8</span></span> <span class="hljs-number"><span class="hljs-number">8404</span></span>: e3a0100<span class="hljs-number"><span class="hljs-number">0</span></span> mov r1, <span class="hljs-comment"><span class="hljs-comment">#0 8408: e59f2054 ldr r2, [pc, #84] ; 8464 &lt;empty_string+0x6c&gt; 840c: e1a0000d mov r0, sp 8410: ebffff99 bl 827c &lt;memset@plt&gt;</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">x86-64</b> <div class="spoiler_text"><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">400720</span></span>: <span class="hljs-number"><span class="hljs-number">55</span></span> push %rbp <span class="hljs-number"><span class="hljs-number">400721</span></span>: ba a8 <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> mov $<span class="hljs-number"><span class="hljs-number">0x61a8</span></span>,%edx <span class="hljs-number"><span class="hljs-number">400726</span></span>: <span class="hljs-number"><span class="hljs-number">31</span></span> f6 xor %esi,%esi <span class="hljs-number"><span class="hljs-number">400728</span></span>: <span class="hljs-number"><span class="hljs-number">53</span></span> push %rbx <span class="hljs-number"><span class="hljs-number">400729</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">81</span></span> ec b8 <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> sub $<span class="hljs-number"><span class="hljs-number">0x61b8</span></span>,%rsp <span class="hljs-number"><span class="hljs-number">400730</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">89</span></span> e7 mov %rsp,%rdi <span class="hljs-number"><span class="hljs-number">400733</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>d ac <span class="hljs-number"><span class="hljs-number">24</span></span> a8 <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> lea <span class="hljs-number"><span class="hljs-number">0x61a8</span></span>(%rsp),%rbp <span class="hljs-number"><span class="hljs-number">40073</span></span>a: <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">40073b</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">89</span></span> e3 mov %rsp,%rbx <span class="hljs-number"><span class="hljs-number">40073</span></span>e: <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">8b</span></span> <span class="hljs-number"><span class="hljs-number">04</span></span> <span class="hljs-number"><span class="hljs-number">25</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> mov %fs:<span class="hljs-number"><span class="hljs-number">0x28</span></span>,%rax <span class="hljs-number"><span class="hljs-number">400745</span></span>: <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">400747</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">89</span></span> <span class="hljs-number"><span class="hljs-number">84</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> a8 <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> mov %rax,<span class="hljs-number"><span class="hljs-number">0x61a8</span></span>(%rsp) <span class="hljs-number"><span class="hljs-number">40074</span></span>e: <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">40074f</span></span>: <span class="hljs-number"><span class="hljs-number">31</span></span> c0 xor %eax,%eax <span class="hljs-number"><span class="hljs-number">400751</span></span>: e8 <span class="hljs-number"><span class="hljs-number">8</span></span>a fd ff ff callq <span class="hljs-number"><span class="hljs-number">4004e0</span></span> &lt;<span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>@plt&gt; <span class="hljs-number"><span class="hljs-number">400756</span></span>: be <span class="hljs-number"><span class="hljs-number">54</span></span> <span class="hljs-number"><span class="hljs-number">09</span></span> <span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> mov $<span class="hljs-number"><span class="hljs-number">0x400954</span></span>,%esi <span class="hljs-number"><span class="hljs-number">40075b</span></span>: bf <span class="hljs-number"><span class="hljs-number">01</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> mov $<span class="hljs-number"><span class="hljs-number">0x1</span></span>,%edi <span class="hljs-number"><span class="hljs-number">400760</span></span>: <span class="hljs-number"><span class="hljs-number">31</span></span> c0 xor %eax,%eax <span class="hljs-number"><span class="hljs-number">400762</span></span>: c6 <span class="hljs-number"><span class="hljs-number">04</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">41</span></span> movb $<span class="hljs-number"><span class="hljs-number">0x41</span></span>,(%rsp) <span class="hljs-number"><span class="hljs-number">400766</span></span>: e8 a5 fd ff ff callq <span class="hljs-number"><span class="hljs-number">400510</span></span> &lt;__printf_chk@plt&gt; <span class="hljs-number"><span class="hljs-number">40076b</span></span>: <span class="hljs-number"><span class="hljs-number">0f</span></span> <span class="hljs-number"><span class="hljs-number">1f</span></span> <span class="hljs-number"><span class="hljs-number">44</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> nopl <span class="hljs-number"><span class="hljs-number">0x0</span></span>(%rax,%rax,<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">400770</span></span>: <span class="hljs-number"><span class="hljs-number">0f</span></span> be <span class="hljs-number"><span class="hljs-number">13</span></span> movsbl (%rbx),%edx <span class="hljs-number"><span class="hljs-number">400773</span></span>: <span class="hljs-number"><span class="hljs-number">31</span></span> c0 xor %eax,%eax <span class="hljs-number"><span class="hljs-number">400775</span></span>: be <span class="hljs-number"><span class="hljs-number">5</span></span>a <span class="hljs-number"><span class="hljs-number">09</span></span> <span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> mov $<span class="hljs-number"><span class="hljs-number">0x40095a</span></span>,%esi <span class="hljs-number"><span class="hljs-number">40077</span></span>a: bf <span class="hljs-number"><span class="hljs-number">01</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> mov $<span class="hljs-number"><span class="hljs-number">0x1</span></span>,%edi <span class="hljs-number"><span class="hljs-number">40077f</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">83</span></span> c3 <span class="hljs-number"><span class="hljs-number">01</span></span> add $<span class="hljs-number"><span class="hljs-number">0x1</span></span>,%rbx <span class="hljs-number"><span class="hljs-number">400783</span></span>: e8 <span class="hljs-number"><span class="hljs-number">88</span></span> fd ff ff callq <span class="hljs-number"><span class="hljs-number">400510</span></span> &lt;__printf_chk@plt&gt; <span class="hljs-number"><span class="hljs-number">400788</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">39</span></span> eb cmp %rbp,%rbx <span class="hljs-number"><span class="hljs-number">40078b</span></span>: <span class="hljs-number"><span class="hljs-number">75</span></span> e3 jne <span class="hljs-number"><span class="hljs-number">400770</span></span> &lt;empty1_string+<span class="hljs-number"><span class="hljs-number">0x50</span></span>&gt; <span class="hljs-number"><span class="hljs-number">40078</span></span>d: <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">8b</span></span> <span class="hljs-number"><span class="hljs-number">84</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> a8 <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> mov <span class="hljs-number"><span class="hljs-number">0x61a8</span></span>(%rsp),%rax <span class="hljs-number"><span class="hljs-number">400794</span></span>: <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">400795</span></span>: <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">04</span></span> <span class="hljs-number"><span class="hljs-number">25</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> xor %fs:<span class="hljs-number"><span class="hljs-number">0x28</span></span>,%rax <span class="hljs-number"><span class="hljs-number">40079</span></span>c: <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">40079</span></span>e: <span class="hljs-number"><span class="hljs-number">75</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>a jne <span class="hljs-number"><span class="hljs-number">4007</span></span>aa &lt;empty1_string+<span class="hljs-number"><span class="hljs-number">0x8a</span></span>&gt; <span class="hljs-number"><span class="hljs-number">4007</span></span>a0: <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">81</span></span> c4 b8 <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> add $<span class="hljs-number"><span class="hljs-number">0x61b8</span></span>,%rsp <span class="hljs-number"><span class="hljs-number">4007</span></span>a7: <span class="hljs-number"><span class="hljs-number">5b</span></span> pop %rbx <span class="hljs-number"><span class="hljs-number">4007</span></span>a8: <span class="hljs-number"><span class="hljs-number">5</span></span>d pop %rbp <span class="hljs-number"><span class="hljs-number">4007</span></span>a9: c3 retq</code> </pre><br></div></div><br>  Wow! <br><br>  <b>Line = {0} goes to the side of darkness, memset rejoices!</b> <br><br>  However, let's not forget, yet we decided to confuse the problem with the parameters; now it‚Äôs impossible to mix up the arguments. <br><br><h3>  String initialization </h3><br>  Also, it would not be superfluous to consider the option of initializing the array <i>= ""</i> .  In the C language, null-terminated strings are used, that is, the first character with a byte value of 0x00 indicates the end of the string.  Therefore, to initialize a string, it makes no sense to reset all elements; you just need to zero the first one.  Here are some ways to initialize an empty string: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doInitializeCString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> p0[<span class="hljs-number"><span class="hljs-number">25</span></span>] = {<span class="hljs-number"><span class="hljs-number">0</span></span>} ; <span class="hljs-comment"><span class="hljs-comment">//     0 char p1[25] = "" ; //     0 char p2[25] ; p2[0] = 0 ; //     0 char p3[25] ; memset(p3, 0, sizeof(p3)) ; //  25   0 char p4[25] ; strcpy(p4, "") ; //     0 char *p5 = (char *) calloc(25, sizeof(char)) ; //     0 }</span></span></code> </pre><br>  The surest way how initialization will work with <i>= ""</i> will parse the objdump again.  Without optimization, we will not see anything special, everything is similar there <i>= {0}</i> , we will immediately consider with the -O3 option.  So compile under ARM: <br><div class="spoiler">  <b class="spoiler_title">such a function</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">empty_string</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> p1[<span class="hljs-number"><span class="hljs-number">25</span></span>] = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"\np1: "</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">25</span></span>; i++) <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"%x,"</span></span>,p1[i]); }</code> </pre><br></div></div><br>  <i>And, suddenly, we get zeroing of all elements of the array.</i> <br><br><pre> <code class="hljs css"> 83<span class="hljs-selector-tag"><span class="hljs-selector-tag">c0</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e58d3004</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">str</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-attr"><span class="hljs-selector-attr">[sp, #4]</span></span> 83<span class="hljs-selector-tag"><span class="hljs-selector-tag">c4</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e58d3008</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">str</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-attr"><span class="hljs-selector-attr">[sp, #8]</span></span> 83<span class="hljs-selector-tag"><span class="hljs-selector-tag">c8</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e58d300c</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">str</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-attr"><span class="hljs-selector-attr">[sp, #12]</span></span> 83<span class="hljs-selector-tag"><span class="hljs-selector-tag">cc</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e58d3010</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">str</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-attr"><span class="hljs-selector-attr">[sp, #16]</span></span> 83<span class="hljs-selector-tag"><span class="hljs-selector-tag">d0</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e58d3014</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">str</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-attr"><span class="hljs-selector-attr">[sp, #20]</span></span> 83<span class="hljs-selector-tag"><span class="hljs-selector-tag">d4</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e58d3018</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">str</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-attr"><span class="hljs-selector-attr">[sp, #24]</span></span> 83<span class="hljs-selector-tag"><span class="hljs-selector-tag">d8</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">e5cd301c</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">strb</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r3</span></span>, <span class="hljs-selector-attr"><span class="hljs-selector-attr">[sp, #28]</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">x86-64</b> <div class="spoiler_text"><pre> <code class="hljs perl"> <span class="hljs-number"><span class="hljs-number">400768</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span> c7 <span class="hljs-number"><span class="hljs-number">04</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> movq $0<span class="hljs-keyword"><span class="hljs-keyword">x</span></span><span class="hljs-number"><span class="hljs-number">0</span></span>,(%rsp) <span class="hljs-number"><span class="hljs-number">400770</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span> c7 <span class="hljs-number"><span class="hljs-number">44</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> 08 <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> movq $0<span class="hljs-keyword"><span class="hljs-keyword">x</span></span><span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0x8</span></span>(%rsp) <span class="hljs-number"><span class="hljs-number">400779</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span> c7 <span class="hljs-number"><span class="hljs-number">44</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> movq $0<span class="hljs-keyword"><span class="hljs-keyword">x</span></span><span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0x10</span></span>(%rsp) <span class="hljs-number"><span class="hljs-number">400782</span></span>: c6 <span class="hljs-number"><span class="hljs-number">44</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> movb $0<span class="hljs-keyword"><span class="hljs-keyword">x</span></span><span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0x18</span></span>(%rsp)</code> </pre><br></div></div><br>  Oh well!  Why in the null-terminated string reset all unused characters?  It is enough to zero one single byte.  Hmm, and if there will be 25 thousand bytes, what will it do?  Here's what: <br><br><pre> <code class="hljs perl"> <span class="hljs-number"><span class="hljs-number">8474</span></span>: e24ddc61 <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sp</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sp</span></span></span><span class="hljs-function">, #24832 </span></span>; <span class="hljs-number"><span class="hljs-number">0x6100</span></span> <span class="hljs-number"><span class="hljs-number">8478</span></span>: e24dd0a8 <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sp</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sp</span></span></span><span class="hljs-function">, #168 </span></span>; <span class="hljs-number"><span class="hljs-number">0xa8</span></span> <span class="hljs-number"><span class="hljs-number">847</span></span>c: e3a0c00<span class="hljs-number"><span class="hljs-number">0</span></span> mov ip, <span class="hljs-comment"><span class="hljs-comment">#0 8480: e28d3f6a add r3, sp, #424 ; 0x1a8 8484: e1a0100c mov r1, ip 8488: e59f204c ldr r2, [pc, #76] ; 84dc &lt;empty_string+0x6c&gt; 848c: e28d0004 add r0, sp, #4 8490: e503c1a8 str ip, [r3, #-424] ; 0x1a8 8494: ebffff78 bl 827c &lt;memset@plt&gt;</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">x86-64</b> <div class="spoiler_text"><pre> <code class="hljs mel"><span class="hljs-number"><span class="hljs-number">00000000004007</span></span>b0 &lt;empty_string&gt;: <span class="hljs-number"><span class="hljs-number">4007</span></span>b0: <span class="hljs-number"><span class="hljs-number">55</span></span> push %rbp <span class="hljs-number"><span class="hljs-number">4007</span></span>b1: ba a0 <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> mov $0x61a0,%edx <span class="hljs-number"><span class="hljs-number">4007</span></span>b6: <span class="hljs-number"><span class="hljs-number">31</span></span> f6 xor %esi,%esi <span class="hljs-number"><span class="hljs-number">4007</span></span>b8: <span class="hljs-number"><span class="hljs-number">53</span></span> push %rbx <span class="hljs-number"><span class="hljs-number">4007</span></span>b9: <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">81</span></span> ec b8 <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> sub $0x61b8,%rsp <span class="hljs-number"><span class="hljs-number">4007</span></span>c0: <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>d <span class="hljs-number"><span class="hljs-number">7</span></span>c <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">08</span></span> lea <span class="hljs-number"><span class="hljs-number">0x8</span></span>(%rsp),%rdi <span class="hljs-number"><span class="hljs-number">4007</span></span>c5: <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>d ac <span class="hljs-number"><span class="hljs-number">24</span></span> a8 <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> lea <span class="hljs-number"><span class="hljs-number">0x61a8</span></span>(%rsp),%rbp <span class="hljs-number"><span class="hljs-number">4007</span></span>cc: <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">4007</span></span>cd: <span class="hljs-number"><span class="hljs-number">48</span></span> c7 <span class="hljs-number"><span class="hljs-number">04</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> movq $0x0,(%rsp) <span class="hljs-number"><span class="hljs-number">4007</span></span>d4: <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">4007</span></span>d5: <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>b <span class="hljs-number"><span class="hljs-number">04</span></span> <span class="hljs-number"><span class="hljs-number">25</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> mov %fs:<span class="hljs-number"><span class="hljs-number">0x28</span></span>,%rax <span class="hljs-number"><span class="hljs-number">4007</span></span>dc: <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">4007</span></span>de: <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">89</span></span> <span class="hljs-number"><span class="hljs-number">84</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> a8 <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> mov %rax,<span class="hljs-number"><span class="hljs-number">0x61a8</span></span>(%rsp) <span class="hljs-number"><span class="hljs-number">4007e5</span></span>: <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">4007e6</span></span>: <span class="hljs-number"><span class="hljs-number">31</span></span> c0 xor %eax,%eax <span class="hljs-number"><span class="hljs-number">4007e8</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">89</span></span> e3 mov %rsp,%rbx <span class="hljs-number"><span class="hljs-number">4007</span></span>eb: e8 f0 fc ff ff callq <span class="hljs-number"><span class="hljs-number">4004e0</span></span> &lt;memset@plt&gt; <span class="hljs-number"><span class="hljs-number">4007</span></span>f0: be <span class="hljs-number"><span class="hljs-number">54</span></span> <span class="hljs-number"><span class="hljs-number">09</span></span> <span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> mov $0x400954,%esi <span class="hljs-number"><span class="hljs-number">4007</span></span>f5: bf <span class="hljs-number"><span class="hljs-number">01</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> mov $0x1,%edi <span class="hljs-number"><span class="hljs-number">4007</span></span>fa: <span class="hljs-number"><span class="hljs-number">31</span></span> c0 xor %eax,%eax <span class="hljs-number"><span class="hljs-number">4007</span></span>fc: e8 <span class="hljs-number"><span class="hljs-number">0</span></span>f fd ff ff callq <span class="hljs-number"><span class="hljs-number">400510</span></span> &lt;__printf_chk@plt&gt; <span class="hljs-number"><span class="hljs-number">400801</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>f <span class="hljs-number"><span class="hljs-number">1</span></span>f <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> nopl <span class="hljs-number"><span class="hljs-number">0x0</span></span>(%rax) <span class="hljs-number"><span class="hljs-number">400808</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>f be <span class="hljs-number"><span class="hljs-number">13</span></span> movsbl (%rbx),%edx <span class="hljs-number"><span class="hljs-number">40080</span></span>b: <span class="hljs-number"><span class="hljs-number">31</span></span> c0 xor %eax,%eax <span class="hljs-number"><span class="hljs-number">40080</span></span>d: be <span class="hljs-number"><span class="hljs-number">5</span></span>a <span class="hljs-number"><span class="hljs-number">09</span></span> <span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> mov $0x40095a,%esi <span class="hljs-number"><span class="hljs-number">400812</span></span>: bf <span class="hljs-number"><span class="hljs-number">01</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> mov $0x1,%edi <span class="hljs-number"><span class="hljs-number">400817</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">83</span></span> c3 <span class="hljs-number"><span class="hljs-number">01</span></span> add $0x1,%rbx <span class="hljs-number"><span class="hljs-number">40081</span></span>b: e8 f0 fc ff ff callq <span class="hljs-number"><span class="hljs-number">400510</span></span> &lt;__printf_chk@plt&gt; <span class="hljs-number"><span class="hljs-number">400820</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">39</span></span> eb cmp %rbp,%rbx <span class="hljs-number"><span class="hljs-number">400823</span></span>: <span class="hljs-number"><span class="hljs-number">75</span></span> e3 jne <span class="hljs-number"><span class="hljs-number">400808</span></span> &lt;empty_string+<span class="hljs-number"><span class="hljs-number">0x58</span></span>&gt; <span class="hljs-number"><span class="hljs-number">400825</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>b <span class="hljs-number"><span class="hljs-number">84</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> a8 <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> mov <span class="hljs-number"><span class="hljs-number">0x61a8</span></span>(%rsp),%rax <span class="hljs-number"><span class="hljs-number">40082</span></span>c: <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">40082</span></span>d: <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">04</span></span> <span class="hljs-number"><span class="hljs-number">25</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> xor %fs:<span class="hljs-number"><span class="hljs-number">0x28</span></span>,%rax <span class="hljs-number"><span class="hljs-number">400834</span></span>: <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">400836</span></span>: <span class="hljs-number"><span class="hljs-number">75</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>a jne <span class="hljs-number"><span class="hljs-number">400842</span></span> &lt;empty_string+<span class="hljs-number"><span class="hljs-number">0x92</span></span>&gt; <span class="hljs-number"><span class="hljs-number">400838</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">81</span></span> c4 b8 <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> add $0x61b8,%rsp <span class="hljs-number"><span class="hljs-number">40083</span></span>f: <span class="hljs-number"><span class="hljs-number">5</span></span>b pop %rbx <span class="hljs-number"><span class="hljs-number">400840</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span>d pop %rbp <span class="hljs-number"><span class="hljs-number">400841</span></span>: c3 retq</code> </pre><br></div></div><br>  Looks like dark memset is haunting us.  If you still want to fight against darkness, then it is worth mentioning what other traps are waiting for you. <br><br><img src="https://habrastorage.org/files/d27/37a/299/d2737a29992245fa956735254a61f583.png"><br><br><h3>  memset may initialize numbers with incorrect values. </h3><br>  If you want to fill an array of integers with nonzero values, read byte-filled data. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doInitializeToMistakenValues</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> pChar[<span class="hljs-number"><span class="hljs-number">25</span></span>] ; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> pUChar[<span class="hljs-number"><span class="hljs-number">25</span></span>] ; <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> pShort[<span class="hljs-number"><span class="hljs-number">25</span></span>] ; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> pUShort[<span class="hljs-number"><span class="hljs-number">25</span></span>] ; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pInt[<span class="hljs-number"><span class="hljs-number">25</span></span>] ; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pUInt[<span class="hljs-number"><span class="hljs-number">25</span></span>] ; <span class="hljs-comment"><span class="hljs-comment">//  2-  4-      memset(pChar, 1, sizeof(pChar)) ; // 1 memset(pUChar, 1, sizeof(pUChar)) ; // 1 memset(pShort, 1, sizeof(pShort)) ; // 257 memset(pUShort, 1, sizeof(pUShort)) ; // 257 memset(pInt, 1, sizeof(pInt)) ; // 16843009 memset(pUInt, 1, sizeof(pUInt)) ; // 16843009 //  unsigned    0xFF memset(pChar, -1, sizeof(pChar)) ; // -1 memset(pUChar, -1, sizeof(pUChar)) ; // 255 memset(pShort, -1, sizeof(pShort)) ; // -1 memset(pUShort, -1, sizeof(pUShort)) ; // 65535 memset(pInt, -1, sizeof(pInt)) ; // -1 memset(pUInt, -1, sizeof(pUInt)) ; // 4294967295 }</span></span></code> </pre><br>  Consider how it turns out.  Here we have, let's say, an array of int, passing the unit to the second parameter, what happens? <br><br>  Here's what: <br><br>  0x01010101 - in hexadecimal notation, each byte will be filled with one, and the correct value <br>  0x00000001 will not be available with the memset function.  But in fact, this is not a bug, this is a feature. <br><br>  Here only ignorance of these features leads to unpredictable errors. <br><br><h3>  memset can set an invalid value </h3><br>  If the double elements are set to bytes -1, we get the value Not-A-Number (NaN), and after subsequent calculations, each operation with the value NaN will return NaN, thus disrupting the whole chain of calculations. <br><br>  In the same way, setting -1 to the bool type is incorrect and it formally will not be either true or false.  Although in most cases it will behave like true.  In most cases‚Ä¶ <br><br>  And the last, memset is intended only for work with <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D1%2580%25D0%25BE%25D1%2581%25D1%2582%25D0%25B0%25D1%258F_%25D1%2581%25D1%2582%25D1%2580%25D1%2583%25D0%25BA%25D1%2582%25D1%2583%25D1%2580%25D0%25B0_%25D0%25B4%25D0%25B0%25D0%25BD%25D0%25BD%25D1%258B%25D1%2585">simple data structures</a> .  Never use memset with managed data structures, this function is intended only for low-level operations. <br><br><img src="https://habrastorage.org/files/545/9cd/7c9/5459cd7c917240c7a4bb049283c50adb.png"><br>  <i>The article used materials <a href="https://augias.org/paercebal/tech_doc/doc.en/cp.memset_is_evil.html">memset is evil</a> .</i> <i><br><br></i>  <i>Also read about the <a href="http://www.viva64.com/ru/b/0129/">printf</a> vulnerabilities</i> . </div><p>Source: <a href="https://habr.com/ru/post/272269/">https://habr.com/ru/post/272269/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../272259/index.html">Law enforcement authorities dismantled the Dorkbot botnet</a></li>
<li><a href="../272261/index.html">Do you still store 404backup.zip on the server? I'm on 200D</a></li>
<li><a href="../272263/index.html">How to monitor all layers of infrastructure</a></li>
<li><a href="../272265/index.html">History of one optimization: transmission and processing of the results of the battle</a></li>
<li><a href="../272267/index.html">Kudu - a new data storage engine in the Hadoop ecosystem</a></li>
<li><a href="../272275/index.html">We invite speakers to the PHDays VI forum: tell us about your cyberwar</a></li>
<li><a href="../272277/index.html">When people make mistakes</a></li>
<li><a href="../272279/index.html">We get ramlog on distributions with systemd</a></li>
<li><a href="../272281/index.html">Creating Isometric Objects for Blender Games</a></li>
<li><a href="../272285/index.html">Top 5 dangerous threats from third-party vendors</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>