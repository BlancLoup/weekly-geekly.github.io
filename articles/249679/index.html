<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Installation manual for the Couchbase 2.1.1 Community and the basics of working with it</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The life of the system administrator threw a new beast on an already thorny path. It was required to the client for the project to use Couchbase witho...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Installation manual for the Couchbase 2.1.1 Community and the basics of working with it</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/0d3/073/06a/0d307306a859f414cc8264128839c8de.jpg" alt="image"><br><br>  The life of the system administrator threw a new beast on an already thorny path.  It was required to the client for the project to use Couchbase without fail. <br><br>  Under the cut instructions for installing it, adding to the cluster and balancing data.  What if it would be useful 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br><h5>  Install Couchbase. </h5><br><br>  Install openssl098e. <br><br>  Download and install couchbase 2.1.1 <br><br><pre><code class="bash hljs">wget http://packages.couchbase.com/releases/2.1.1/couchbase-server-community_x86_64_2.1.1.rpm rpm -Uhv couchbase-server-community_x86_64_2.1.1.rpm</code> </pre> <br><br>  <a href="http://centos-admin.ru/">Our company</a> actively uses OpenVZ virtualization, and for normal operation of couchbase in the openvz container, a memsup file from the erlang-os-mon version 2.2.10 or later is required. <br><br>  What we do: <br>  Stop couchbase: <br><pre> <code class="bash hljs">service couchbase-server stop</code> </pre><br><br>  First you need to download erlang itself, for example, from the official site <a href="http://www.erlang.org/download.html">www.erlang.org/download.html</a> <br>  And compile the necessary library, which is on the way lib / os_mon / priv <br><br>  Then, from lib / os_mon / priv / bin, take memsup and place it in the /opt/couchbase/lib/erlang/lib/os_mon-2.2.7/priv/bin/ directory <br>  Expose the rights to it: <br><pre> <code class="bash hljs">chown bin:bin /opt/couchbase/lib/erlang/lib/os_mon-2.2.7/priv/bin/memsup chmod a+x /opt/couchbase/lib/erlang/lib/os_mon-2.2.7/priv/bin/memsup</code> </pre><br><br>  We start the couchbase-server server and use it. <br>  Admin default is available on <a href="http://hostname/">hostname</a> : 8091 / <br><br><h5>  Adding a new server to the cluster and balancing data. </h5><br><br>  <b>Attention!!!</b>  <b>Before adding a new server to the cluster, you must remove the backup database.</b> <br><br>  For example: <br><pre> <code class="bash hljs">/opt/couchbase/bin/cbbackup -u Administrator -p PASSWORD http://localhost:8091/ /tmp/cbbackup/</code> </pre><br><br>  Or, if you need to backup only one bake, the rest are not important: <br><pre> <code class="bash hljs">/opt/couchbase/bin/cbbackup -u Administrator -p PASSWORD http://localhost:8091/ /tmp/cbbackup/ -b SRC_BUCKET</code> </pre><br><br>  When adding a new server to the couchbase cluster, it is necessary to rebalance the data and it may happen that the rebalancing does not pass and there will be an error in the log about the following: <br><pre> <code class="bash hljs">&lt;0.20769.2129&gt; exited with {unexpected_exit, {<span class="hljs-string"><span class="hljs-string">'EXIT'</span></span>,&lt;0.20785.2129&gt;, {badmatch, [{<span class="hljs-string"><span class="hljs-string">'EXIT'</span></span>, {{badmatch,{error,closed}}, {gen_server,call, [&lt;19210.18145.6&gt;,had_backfill,30000]}}}]}}}</code> </pre><br><br>  Option 1. <br>  On hw node, you can try to change vm.swappiness for the time of balancing data and re-run rebalancing: <br><pre> <code class="bash hljs">sysctl -w vm.swappiness=0</code> </pre><br><br>  If balancing is not passed: <br>  Option 2. (clear or remove the bake) <br><br>  1. We look through the couchbase <a href="http://host/">host</a> admin: 8091 / on which batch balancing falls (Server Nodes tab and open the servers themselves) <br>  2. Go to the tab Data Bucket, open the desired bakt, and in it the button (Edit) <br>  3. We are looking at the very bottom, next to the button DELETE button FLUSH.  (If it doesn‚Äôt exist, just put the Flush-Enable checkbox above.) And press FLUSH, thereby clearing the contents of the bake (we have the same backup) <br>  4. If the bake is cleared normally, we do the rebalancing again.  If it has passed then we fill the back. <br><pre> <code class="bash hljs">/opt/couchbase/bin/cbrestore -u Administrator -p PASSWORD /tmp/cbbackup/ http://host:8091/ -b &lt;___&gt;</code> </pre><br><br>  5. If the bake is not cleared, or if after cleaning the balancing also does not pass on it, then <br>  6. In the edit menu of the bake (Edit) we remember (write) all the information about it and delete it.  After that we create a new one with the same parameters and fill in the backup. <br>  And so for each baktu. <br><br>  And a very useful team, most often you have to use: <br><pre> <code class="bash hljs">/opt/couchbase/bin/cbrestore -u Administrator -p PASSWORD -b SRC_BUCKET -B DST_BUCKET -k <span class="hljs-string"><span class="hljs-string">"key1|key2|key3|key...|KeyN"</span></span> /tmp/cbbackup/ http://localhost:8091</code> </pre><br><br>  Recovers individual keys. </div><p>Source: <a href="https://habr.com/ru/post/249679/">https://habr.com/ru/post/249679/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../249663/index.html">Attempt to reincarnation and stuffing in Open-Source Yandex.Following</a></li>
<li><a href="../249665/index.html">Mobile app security, or ‚ÄúWho will check the reviewers?‚Äù</a></li>
<li><a href="../249673/index.html">27 new free courses virtual academy Microsoft Virtual Academy, February 2015</a></li>
<li><a href="../249675/index.html">Right now there is a live seminar on Extreme Networks</a></li>
<li><a href="../249677/index.html">Installing MeteorJS on Raspberry Pi B + running Arch Linux ARM</a></li>
<li><a href="../249681/index.html">Protection of games and mobile applications from hacking for dummies (Unity, C #, Mono)</a></li>
<li><a href="../249685/index.html">(Video) How to document the project at the start and the project scope</a></li>
<li><a href="../249687/index.html">VMware vSphere 5.5 Problem Solving Training Workshop</a></li>
<li><a href="../249693/index.html">Model of access control systems in an enterprise based on Arduino</a></li>
<li><a href="../249695/index.html">A simple solution for using EDS - development</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>