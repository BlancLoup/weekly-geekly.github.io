<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Use OpenShift (deployment example)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 


 At first, I apologize; here it is a bit damp, although it works, and now it works "in flight", but without telephony, the possibiliti...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Use OpenShift (deployment example)</h1><div class="post__text post__text-html js-mediator-article"><h2 id="vstuplenie">  Introduction </h2><br><p>  At first, I apologize; <a href="https://habrahabr.ru/post/275605/">here it is a</a> bit damp, although it works, and now it works "in flight", but without telephony, the possibilities are limited.  The development option was basically described when the main directory $ OPENSHIFT_REPO_DIR (~ / app-root / repo) and you have a copy in your local repository, make edits, OpenShift is your sandbox. <br>  But there is an installation option "for operation".  It is mentioned at the end of the above article, but without details.  In this case, you use $ OPENSHIFT_DATA_DIR (~ / app-root / data).  The difference is that the local repository contains configuration scripts (action_hooks, see below) and data files, patches, etc.  But not the application itself. </p><br><p>  The mini-tutorial illustrates a number of OpenShift tricks.  Working with github.com, git does not understand in detail, it is assumed that the reader already has an idea. </p><br><ol><li>  Creating and cloning on OpenShift blanks. </li><li>  Editing deployment scripts to obtain a valid installation kit. </li><li>  Record repository on github.com (for storage). </li><li>  Deploy the application to OpenShift. </li></ol><br><p>  A step-by-step guide based on a real-world example. <a name="habracut"></a></p><br><h2 id="pered-nachalom">  Before the start </h2><br><p>  Installation on any PaaS hosting (the same <a href="http://openshift.redhat.com/">Redhat Openshift</a> ) requires compliance with its specifications: </p><br><p>  Registration: <a href="https://www.openshift.com/app/account/new">here</a> <br>  Client installation: <a href="https://developers.openshift.com/en/getting-started-overview.html">here (you are already registered), the documentation is also there, but all English</a> <br>  Do not worry about the OS works almost everywhere the same.  Yes, and your application, no matter how cool under RHEL 6.7. <br>  They propose to create a domain (this is a subdomain of the 3rd level, your applications will have the address <a href="http://myapp-mydom.rhcloud.com/">http://myapp-mydom.rhcloud.com</a> ). </p><br><p>  Openshift globally provides you with a user directory with a standard set of subdirectories: <a href="https://habrahabr.ru/post/275605/">here</a> .  The feature of the engine is that in the home directory the configs of the installed software belong to root.  Your name is such a long hash type (very <a href="https://www.docker.com/">docker</a> reminds). </p><br><p>  All necessary data is stored in the environment variables of the form OPENSHIFT_, <a href="https://developers.openshift.com/en/managing-environment-variables.html">reference book</a> . </p><br><h2 id="pristupaem">  Getting started </h2><br><p>  <em>We have already done</em> </p><br><ul><li>  Create an account at <a href="https://openshift.redhat.com/">https://openshift.redhat.com</a> </li><li>  Put git, ruby, rhc. </li><li> Launched <br> <code>$rhc setup</code> <br>  And answered all the questions.  The keys will be exchanged and joined to the OpenShift domain. </li></ul><br><p>  Notes: </p><br><blockquote>  The application SalesPlatform-6.4.0, self-installing LAMP. <br>  CentOS 7.2 system (but the difference is in the details). <br>  My example application, yours - at your discretion.  (The name can contain only Latin letters and numbers). <br>  my repository on github.com <a href="https://github.com/zirf0/example">https://github.com/zirf0/example</a> , look, if that. </blockquote><br><ol><li><p>  Create a stub and clone it into your home directory. <br> <code>$rhc app create example php-5.3 mysql-5.5</code> <br> <code>$cd example</code> </p> <br></li><li><p>  Openshift service directory <br>  $ tree .openshift / <br>  .openshift / <br>  Action‚îÄ‚îÄ action_hooks <br>  ‚îÇ ‚îî‚îÄ‚îÄ README.md <br>  C‚îÄ‚îÄ cron <br>  ‚îÇ ... <br>  Mark‚îÄ‚îÄ markers <br>  ‚îÇ ‚îî‚îÄ‚îÄ README.md <br>  Pear‚îÄ‚îÄ pear.txt <br>  RE‚îÄ‚îÄ README.md </p><br></li></ol><br><p>  Strictly speaking, we are interested in <a href="https://developers.openshift.com/en/managing-action-hooks.html">action_hooks</a> .  This is a set of scripts for various purposes, but for our example we use only <em>build</em> and <em>deploy</em> , in general, the names of the scripts correspond to the action performed.  We will solve a simple problem: </p><br><ol><li><p>  Download the source to PaaS hosting. </p><br></li><li><p>  Deploy them to ~ / app-root / data / current </p><br></li><li><p>  Make changes (as a rule, it is necessary to replace the database access variables with embedded OpenShift). </p><br></li><li><p>  Deploy the application. </p><br></li><li><p>  Let's start </p><br></li></ol><br><p> <code>$ vi .openshift/action_hooks/build</code> </p> <br><p>  And put it there </p><br><div class="spoiler">  <b class="spoiler_title">build - initial installation script</b> <div class="spoiler_text"><p> <code>#!/bin/bash</code> <br> <code>#  ~/app-root/data  current</code> <br> <code>#</code> <br> <code>current_version_dir=${OPENSHIFT_DATA_DIR}current</code> <br> <code>#  , .</code> <br> <code>[ -d "${current_version_dir}" ] &amp;&amp; exit 0</code> <br> <code>#   </code> <br> <code>install_version='6.4.0-201512'</code> <br> <code>#   .</code> <br> <code>install_dir=${OPENSHIFT_BUILD_DEPENDENCIES_DIR}${install_version}</code> <br> <code>mkdir -p $install_dir</code> <br> <code>#  </code> <br> <code>pushd ${install_dir} &gt;/dev/null</code> <br> <code>#    (  ).</code> <br> <code>curl -Ls downloads.sourceforge.net/project/salesplatform/salesplatform-vtigercrm-${install_version}.tar.gz &gt; salesplatform-vtigercrm-${install_version}.tar.gz</code> <br> <code>#  </code> <br> <code>tar --strip-components=1 -xzf salesplatform-vtigercrm-${install_version}.tar.gz</code> <br> <code>#  ,    .</code> <br> <code>rm -rf salesplatform-vtigercrm-${install_version}.tar.gz</code> <br> <code>#  </code> <br> <code>echo $install_version &gt; ${OPENSHIFT_BUILD_DEPENDENCIES_DIR}.current_version</code> <br> <code>#    .</code> <br> <code>popd &gt;/dev/null</code> </p> </div></div><br><p> <code>$ vi .openshift/action_hooks/deploy</code> </p> <br><p>  In the script, a patch is applied (the same substitution of the environment variables for connecting to the MySQL DBMS) and the installation .htaccess is added.  You can have your own, that is, for example, take <a href="https://github.com/zirf0/example/tree/master/.openshift/config">ready</a> . </p><br><div class="spoiler">  <b class="spoiler_title">deploy - deployment script</b> <div class="spoiler_text"><p> <code>#!/bin/bash</code> <br> <code># This deploy hook gets executed after dependencies are resolved and the</code> <br> <code># build hook has been run but before the application has been started back</code> <br> <code># up again. This script gets executed directly, so it could be python, php,</code> <br> <code># ruby, etc.</code> <br> <code>dest_dir=${OPENSHIFT_DATA_DIR}current</code> <br> <code>current_version=$(cat ${OPENSHIFT_BUILD_DEPENDENCIES_DIR}.current_version)</code> <br> <code>install_dir=${OPENSHIFT_BUILD_DEPENDENCIES_DIR}${current_version}</code> <br> <code>if [ ! -d "${dest_dir}" ]; then</code> <br> <code>mkdir -p $dest_dir</code> <br> <code>cp -rf ${install_dir}/* ${dest_dir}/</code> <br> <code>fi</code> <br> <code>#  ~/app-root/repo/php  (    php)   .</code> <br> <code>if [ -d ${OPENSHIFT_REPO_DIR}php ]; then</code> <br> <code>rm -rf ${OPENSHIFT_REPO_DIR}php</code> <br> <code>fi</code> <br> <code>ln -sf ${dest_dir} ${OPENSHIFT_REPO_DIR}php</code> <br> <code>#   .htaccess  .openshift/config</code> <br> <code>if [ -f ${OPENSHIFT_REPO_DIR}.openshift/config/.htaccess ]; then</code> <br> <code>cp -f ${OPENSHIFT_REPO_DIR}.openshift/config/.htaccess ${dest_dir}/.htaccess</code> <br> <code>fi</code> <br> <code>set -e</code> <br> <code># .         </code> <br> <code>patch ${dest_dir}/modules/Install/views/Index.php ${OPENSHIFT_REPO_DIR}.openshift/config/patches/db_conf.patch</code> </p> </div></div><br><p>  Go ahead.  Create a repository on github.com. <br>  In our catalog: <br> <code>$git rm index.php</code> <br> <code>$vi README.md</code> <br>  Naturally, the file needs to be filled, there is nothing worse than the repository, where the donut hole is in the most visible place. <br> <code>git add .</code> <br> <code>git commit -m "Initialize"</code> <br>  Add github.com to remote repositories (of course the URL will be yours): <br> <code>$git remote add upstream ssh://git@github.com/zirf0/example.git</code> <br>  We already have the ssh key ~ / .ssh / id_rsa.pub.  Add it according to the <a href="https://help.github.com/articles/adding-a-new-ssh-key-to-your-github-account/">instructions</a> on github.com. </p><br><p>  Fill our works on github.com <br> <code>$git push upstream master</code> </p> <br><p>  Deploy the application to PaaS Openshift: <br> <code>$git push</code> <br>  Which is equivalent to <em>$ git push origin master</em> . </p><br><div class="spoiler">  <b class="spoiler_title">Gotta get something like that</b> <div class="spoiler_text"><p> <code>Counting objects: 5, done.</code> <br> <code>Delta compression using up to 4 threads.</code> <br> <code>Compressing objects: 100% (3/3), done.</code> <br> <code>Writing objects: 100% (3/3), 339 bytes | 0 bytes/s, done.</code> <br> <code>Total 3 (delta 1), reused 0 (delta 0)</code> <br> <code>remote: Stopping PHP 5.3 cartridge (Apache+mod_php)</code> <br> <code>remote: Stopping MySQL 5.5 cartridge</code> <br> <code>remote: Building git ref 'master', commit 38fe1a5</code> <br> <code>remote: Checking .openshift/pear.txt for PEAR dependency...</code> <br> <code>remote: Preparing build for deployment</code> <br> <code>remote: Deployment id is b4269d37</code> <br> <code>remote: Activating deployment</code> <br> <code>remote: Starting MySQL 5.5 cartridge</code> <br> <code>remote: patching file /var/lib/openshift/56c4641789f5cfbebb000031/app-root/data/current/modules/Install/views/Index.php</code> <br> <code>remote: Hunk #1 succeeded at 98 with fuzz 1.</code> <br> <code>remote: Starting PHP 5.3 cartridge (Apache+mod_php)</code> <br> <code>remote: Application directory "php/" selected as DocumentRoot</code> <br> <code>remote: -------------------------</code> <br> <code>remote: Git Post-Receive Result: success</code> <br> <code>remote: Activation status: success</code> <br> <code>remote: Deployment completed with status: success</code> <br> <code>To ssh://56c4641789f5cfbebb000031@example-helidon.rhcloud.com/~/git/example.git/</code> <br> <code>f5b094a..38fe1a5 master -&gt; master</code> </p> </div></div><br><p>  All through the web installation should start. </p><br><p>  <strong>Wishes, suggestions?</strong> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/277445/">https://habr.com/ru/post/277445/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../277431/index.html">The first release of Kotlin 1.0 has been released.</a></li>
<li><a href="../277433/index.html">All vertical alignment methods in CSS</a></li>
<li><a href="../277435/index.html">Mikrotik - Advanced settings for Yota</a></li>
<li><a href="../277437/index.html">Microsoft fixed multiple bugs in the system components of Windows 8.1 and Server 2012</a></li>
<li><a href="../277439/index.html">PVS-Studio rummaged in the FreeBSD kernel</a></li>
<li><a href="../277447/index.html">We return ICQ to life (ICQ). Designer's opinion</a></li>
<li><a href="../277449/index.html">Web file manager Sprut.IO in OpenSource</a></li>
<li><a href="../277451/index.html">Dynamic data binding in HTML and JS</a></li>
<li><a href="../277453/index.html">Neon: Node + Rust</a></li>
<li><a href="../277455/index.html">How is the "compatibility" of financial transactions on rough IT-examples</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>