<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Delegating the reverse zone subnet less than / 24 in BIND. How it works</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Once I got up a task to give one of my clients the right to edit the PTR-records of the subnet given to him / 28. I don‚Äôt have automation for editing ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Delegating the reverse zone subnet less than / 24 in BIND. How it works</h1><div class="post__text post__text-html js-mediator-article">  Once I got up a task to give one of my clients the right to edit the PTR-records of the subnet given to him / 28.  I don‚Äôt have automation for editing BIND settings from outside.  Therefore, I decided to go the other way - to delegate to the client a piece of PTR-zone of the subnet / 24. <br><br>  It would seem - what could be easier?  Simply, we prescribe the subnet in the right way and direct it to the desired NS as it is done with the subdomain.  But no.  Everything is not so simple (although in reality it is generally primitive, but intuition will not help), therefore I am writing this article. <br><br>  Who wants to figure it out for himself can read the <a href="">RFC</a> <br>  Who wants the ready decision, welcome under kat. <br><a name="habracut"></a><br>  In order not to delay those who love the copy-paste method, first I will place the practical part, and after it the theoretical part. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>1. Practice.</b>  <b>Delegating a zone / 28</b> <br><br>  Suppose we have a subnet <b>7.8.9.0/24</b> .  We need to delegate the subnet <b>7.8.9.240/28</b> to the dns client <b>7.8.7.8</b> ( <b>ns1.client.domain</b> ). <br><br>  On provider dns you need to find a file that describes the reverse zone of this subnet.  Let it be <b>9.8.7.in-addr.arpa</b> . <br>  Records from 240 to 255 comment, if any.  And at the end of the file we write the following: <br><br><pre><code class="plaintext hljs">255-240 IN NS 7.8.7.8 $GENERATE 240-255 $ CNAME $.255-240</code> </pre> <br>  Do not forget to increase the serial zone and do <br><br><pre> <code class="plaintext hljs">rndc reload</code> </pre> <br>  At this provider part is over.  Go to the client dns. <br><br>  First, create the file <b>/etc/bind/master/255-240.9.8.7.in-addr.arpa with the</b> following content: <br><br><pre> <code class="plaintext hljs">$ORIGIN 255-240.9.8.7.in-addr.arpa. $TTL 1W @ 1D IN SOA ns1.client.domain. root.client.domain. ( 2008152607 ; serial 3H ; refresh 15M ; retry 1W ; expiry 1D ) ; minimum @ IN NS ns1.client.domain. @ IN NS ns2.client.domain. 241 IN PTR test.client.domain. 242 IN PTR test2.client.domain. 245 IN PTR test5.client.domain.</code> </pre><br>  And in <b>named.conf we</b> add the description of our new file: <br><br><pre> <code class="plaintext hljs">zone "255-240.9.8.7.in-addr.arpa." IN { type master; file "master/255-240.9.8.7.in-addr.arpa"; };</code> </pre> <br>  Restart the bind process. <br><br><pre> <code class="plaintext hljs">/etc/init.d/named restart</code> </pre> <br>  Everything.  Now you can check. <br><br><pre> <code class="plaintext hljs">#&gt; host 7.8.9.245 245.9.8.7.in-addr.arpa is an alias for 245.255-240.9.8.7.in-addr.arpa. 245.255-240.9.8.7.in-addr.arpa domain name pointer test5.client.domain.</code> </pre> <br>  Please note that not only a PTR record is sent, but also a CNAME.  It should be so.  If you are wondering why, then welcome to the next chapter. <br><br>  <b>2. Theory.</b>  <b>How it works.</b> <br><br>  It is difficult to configure and debug the black box.  Much easier if you understand what's going on inside. <br><br>  When we delegate a subdomain in the domain <b>domain</b> , we write something like this: <br><br><pre> <code class="plaintext hljs">client.domain. NS ns1.client.domain. ns1.client.domain. A 7.8.7.8</code> </pre> <br>  We tell everyone who asks that we are not responsible for this site and we say who is responsible.  And all requests for <b>client.domain will</b> redirect to 7.8.7.8.  When checking, we see the following picture (omit what the client has there. It doesn't matter): <br><br><pre> <code class="plaintext hljs"># host test.client.domain test.client.domain has address 7.8.9.241</code> </pre> <br>  Those.  We were informed that there is such an A record and its ip 7.8.9.241.  No unnecessary information. <br><br>  <b>And how can the same be done with a subnet?</b> <br><br>  Because  our DNS server is registered in RIPE, then when requesting a PTR ip address from our network, the first request will still be to us.  The logic is the same as with domains.  That's just how to enter the subnet in the zone file? <br><br>  We try to write it like this: <br><br><pre> <code class="plaintext hljs">255-240 IN NS 7.8.7.8</code> </pre> <br>  And ... the miracle did not happen.  We do not receive any request redirection.  The thing is that bind is not aware that these records in the reverse zone file are ip-addresses and certainly do not understand the range entry.  For him, it's just some kind of symbolic subdomain.  Those.  for bind there will be no difference between " <b>255-240</b> " and " <b>oursuperclient</b> ".  And the request for the request to go where it is necessary, the address in the request should look like this: <b>241.255-240.9.8.7.in-addr.arpa</b> .  Or like this, if we use the symbolic subdomain: <b>241.oursuperclient.9.8.7.in-addr.arpa</b> .  This is different from the usual: <b>241.9.8.7.in-addr.arpa</b> . <br><br>  Hands such a request will be problematic.  And if it works, it‚Äôs still not clear how to apply it in real life.  After all, on request <b>7.8.9.241</b> , the provider DNS still responds to us, not the client. <br><br>  And here come the game <b>CNAME</b> . <br><br>  On the provider side, you need to make an alias for all ip-addresses of the subnet in a format that will forward the request to client DNS. <br><br><pre> <code class="plaintext hljs">255-240 IN NS ns1.client.domain. 241 IN CNAME 241.255-240 242 IN CNAME 242.255-240  ..</code> </pre><br>  This is for hardworking =). <br><br>  And for the lazy more suitable design below: <br><br><pre> <code class="plaintext hljs">255-240 IN NS ns1.client.domain. $GENERATE 240-255 $ CNAME $.255-240</code> </pre> <br>  Now the request for information at <b>7.8.9.241</b> from <b>241.9.8.7.in-addr.arpa</b> on the provider‚Äôs dns server will be converted to <b>241.255-240.9.8.7.in-addr.arpa</b> and go to the dns client. <br><br>  On the client side, you will need to handle such requests.  Accordingly, we create a zone of <b>255-240.9.8.7.in-addr.arpa</b> .  We can, in principle, place reverse entries for any ip of the entire subnet / 24, but we will only be asked about those that the provider will redirect to us, so it‚Äôs impossible to indulge =). <br>  To illustrate, once again I will give an example of the content of the reverse zone file from the client: <br><br><pre> <code class="plaintext hljs">$ORIGIN 255-240.9.8.7.in-addr.arpa. $TTL 1W @ 1D IN SOA ns1.client.domain. root.client.domain. ( 2008152607 ; serial 3H ; refresh 15M ; retry 1W ; expiry 1D ) ; minimum @ IN NS ns1.client.domain. @ IN NS ns2.client.domain. 241 IN PTR test.client.domain. 242 IN PTR test2.client.domain. 245 IN PTR test5.client.domain.</code> </pre><br>  This is due to the fact that we, from the provider‚Äôs side, use CNAME, and we receive in response to a request for data on the ip-address two records, and not one. <br><br><pre> <code class="plaintext hljs">#&gt; host 7.8.9.245 245.9.8.7.in-addr.arpa is an alias for 245.255-240.9.8.7.in-addr.arpa. 245.255-240.9.8.7.in-addr.arpa domain name pointer test5.client.domain.</code> </pre> <br>  <i><b>And do not forget to properly configure the ACL.</b></i>  <i><b>Because it makes no sense to pick up a PTR-zone and not respond to anyone from the external =).</b></i> </div><p>Source: <a href="https://habr.com/ru/post/451890/">https://habr.com/ru/post/451890/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../451878/index.html">Live streaming stereo video to VR glasses (Oculus Go)</a></li>
<li><a href="../45188/index.html">Oddities with Yandex</a></li>
<li><a href="../451880/index.html">DevPRO'19: View from Wrike's booth</a></li>
<li><a href="../451884/index.html">Seven years of working as a developer: what lessons have I learned</a></li>
<li><a href="../451886/index.html">Use of discrete mathematics in testing</a></li>
<li><a href="../451894/index.html">A brief and vigorous overview of the architecture of compilers</a></li>
<li><a href="../451896/index.html">The ‚Äúunbreakable‚Äù eyeDisk is protected by an iris scan, but transmits the password in clear text</a></li>
<li><a href="../451898/index.html">Innovations in Russian</a></li>
<li><a href="../4519/index.html">"Fat" investment hinders a good startup</a></li>
<li><a href="../451900/index.html">The first contribution to the browser API from Facebook</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>