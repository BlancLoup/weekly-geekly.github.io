<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to get to Hell because of Helm, but grab onto a straw</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="- To tired hipsters we speak the truth. 

 All of us (that is, I) love to pull everything new and brilliant in production in order to finally replace ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to get to Hell because of Helm, but grab onto a straw</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/u5/gs/fh/u5gsfhzampml9-ahlmi96on3uie.png" width="45%" align="right">  <i>- To tired hipsters we speak the truth.</i> <br><br>  All of us (that is, I) love to pull everything new and brilliant in production in order to finally replace some problems with others.  This story is dedicated to us (that is, to me). <br><br>  To understand and forgive further text, you will need superficial knowledge of how to work with <a href="https://kubernetes.io/">Kubernetes</a> at the user level and some rumors about <a href="https://helm.sh/">Helm</a> . <br><a name="habracut"></a><br>  Let's first abstract, and then let someone deal with it.  Imagine for a moment that we are a kind of Columbus in the world of smoothies, electric scooters and Kubernetes.  Our people are crowding Europe in an overpopulated old woman in one of its small, endless states, deploying deployment with Kronjobes on a daily basis under the crunch of quadcopters.  But astronomers have already found an explanation for the suspicious curvature of the horizon.  And there is a direct feeling that we are the same Chuzen Van of modernity.  (But no one asked.) And somewhere there, beyond the semicircular ocean, is the shortest way to India!  Endless spaces, freedom from the burden of routine and many free flavored spices.  You just need to bring our people there and finally release them!  Pushing the oceans in front of you is too much even for such magnificence as we are.  Therefore, it is necessary to build ships, pack our deployments, Krondobs and other demons in them, raise services instead of sails and steer straight into the light there.  To steer need a steering wheel, that is Helm.  He is a helmet.  A helmet would definitely be useful, if we know ahead what awaits us ahead.  But there is only a steering wheel.  Building ships is not easy, so we need help, as it were, but our people are always busy with something very useless.  Therefore, it is necessary as if by oneself and as always.  Slowly we start, we build a small boat, we row to India, we see the vast expanses with our own eyes, we take one spice, we float back, we show people.  People like it, they bless our attempts.  Then we are preparing a great outcome, we put in order the configurations, we are building many ships already.  People come up, are interested.  We show, tell, educate, promise, promise, promise ... The more ships - the more interest.  Someone joins, helps.  So that all this is not idle, we swim in <a href="https://en.wikipedia.org/wiki/Deployment_environment">staging</a> nearby, there are no spices yet, it is impossible to live there, but tourists like it.  And now, after weeks / months / best-years / sleeves he, THAT DAY, has come!  It is time to release the flotilla and subdue the treasured terra incognita.  With trepidation in our hearts, we are sailing our people to India, and there, nuttyponel, America.  And everything seems to be very similar, but this is a premonition ... Our people, of course, immediately come to taste (haha, they don't care at all anyway, in fact), they begin to explore the territory, cabins there, cabbage, all kinds of services are deployed.  But here and there something periodically disappears, as through the earth.  That floor will disappear, the coconut will not give birth.  And we are mumbling with the growing buzz ‚Äú <a href="https://www.youtube.com/watch%3Fv%3D8st9ZvrOk0A">wait a minute, wait, I'm not ready yet, just give me a day</a> ...‚Äù.  And still so we squint attentively, and there, in front, behind every bush SUDDENLY, the Indians with tomahawks appear and look so ... unkindly or something ... And the chill runs through the inter-aural ganglion.  And the people are: - ‚ÄúAnd what is this over there?  And where is my floor? ‚ÄùAnd we are:‚Äú My people!  It‚Äôs not that I‚Äôve misled you for 40 years, and no one, of course, will bury you back, but it‚Äôs urgent right away, *****, IT IS NECESSARY TO BUILD THE FREQUENCES !!!!!! ‚ÄùAnd they are: -‚Äú And , well, of course, as always, again. " 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      That's about how I felt when I transferred a certain number of services in production from pure Kubernetes to Helm, and then <a href="https://github.com/helm/helm/issues/3805">ran into it</a> . <br><br>  Well, at the end of the promised saving straw.  First, the light version, but with an explanation of the above delusions.  Here is a demo script: <br><br><ol><li>  Suppose I deploy a chart for project: 1.5.  For the first time with Helm, and before that was just Kubernetes. </li><li> Then I find that there is a bug in the release, and in version 1.4 it was not.  And it would be necessary to roll back, but for her and Helm the chart was not there either.  Therefore, I decide to do it in the old manner: <code>kubectl set image deployment/project project=registry.project.com/project:1.4 --record</code> .  For this and for the pack of other services that unfolded together. </li><li>  Then it turns out that the bug is not in this service, but in the next one, and this is all well and it is necessary to return 1.5.  If you call <code>helm upgrade --install</code> , then a big surprise awaits you ( <a href="https://github.com/helm/helm/issues/1873">more details</a> ): the image will still be from 1.4, and the labels from 1.5.  And Helm shows that everything is fine, generally 1.5 has been deployed there and even the pods have been restarted (CI-build is green). </li></ol><br>  How to avoid it?  If <b>any</b> change is made to any K8s resource controlled by Helm with pure kubectl commands on top of the Helm Chart deployed, then these changes should also be <b>canceled</b> with the kubectl commands.  Helm can deploy a new chart.  But he compares the new chart with the previous one, but not with the current state of resources.  And if you have edited the image, then the future version of Chart will probably contain another image and everything will be fine.  But if you edited an environment variable, or launch arguments, or something else, then the new version of Chart most likely does not differ from the previous one.  And your manual changes will remain in place after the update. <br><br>  And for a snack, a <a href="https://github.com/helm/helm/issues/3805">hard version of the saving straw</a> for those who cannot agree with this unpredictable state. <br><br>  <i>New technologies - the source of new sorrows.</i> </div><p>Source: <a href="https://habr.com/ru/post/426243/">https://habr.com/ru/post/426243/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../426231/index.html">Britain wants to regulate the Internet - what will affect the new laws</a></li>
<li><a href="../426233/index.html">Study: large wind power stations can heat up the soil, which affects climate</a></li>
<li><a href="../426235/index.html">Fiasco. The story of one homemade IoT</a></li>
<li><a href="../426237/index.html">How to determine the minimum size required for a DFSR replication staging folder</a></li>
<li><a href="../426241/index.html">Conference BLACK HAT USA. A botnet of a million browsers. Part 1</a></li>
<li><a href="../426245/index.html">Improving online programs</a></li>
<li><a href="../426249/index.html">Bluetooth device control</a></li>
<li><a href="../426253/index.html">The principle of least action. Part 2</a></li>
<li><a href="../426255/index.html">How Vim stole my heart</a></li>
<li><a href="../426257/index.html">Is it time to upgrade?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>