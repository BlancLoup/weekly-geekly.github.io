<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>LogicDiscovery - simple logic analyzer</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quite often in home electronic crafts there is a need to look at one or another signal, and its digital representation is enough - what the MK sends o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>LogicDiscovery - simple logic analyzer</h1><div class="post__text post__text-html js-mediator-article">  Quite often in home electronic crafts there is a need to look at one or another signal, and its digital representation is enough - what the MK sends on I2C, is the PWM configured correctly, etc.  If you have a good oscilloscope at work, then buying it for your home is too expensive, especially when the need arises only occasionally. <br>  Recently, inexpensive (within $ 50) logic analyzers have appeared, but one thought has always stopped me from buying them: the thing is extremely simple, why not make it your own from scrap materials? <br>  In this article I will explain how to make a simple logic analyzer with minimal financial costs - all you need is a <a href="http://www.st.com/internet/evalboard/product/252419.jsp">Stm32F4Discovery</a> debugging board. <br><a name="habracut"></a><br>  <b>Logic analyzer (hereinafter LA)</b> is a device intended for recording, viewing and analyzing signals in digital circuits.  Like an oscilloscope, an aircraft is connected by one or several probes to the circuit being analyzed, but unlike an oscilloscope it records only two signal states ‚Äú0‚Äù and ‚Äú1‚Äù.  An important function of the aircraft is the ability to automatically decipher the recorded signals, for example, to parse the data exchange on the I2C or SPI bus.  Also, LAs differ in more, compared with oscilloscopes, the number of analyzed lines: from 8 in simple analyzers to hundreds in industrial designs. <br>  The project described here, LogicDiscovery, is a <a href="http://www.sump.org/projects/analyzer/protocol/">SUMP-</a> compatible logic analyzer, made in the format of a USB device to a PC.  It has rather modest characteristics: 20MHz, 16 channels, 24kB of memory.  However, this is sufficient for a very large range of tasks: analysis of UART, I2C, SPI lines (within a few megahertz), parallel buses, measurement of time characteristics of signals, etc. <br><br><h4>  Let's get started </h4><br>  So, all we need is this: <br><ul><li>  <a href="http://www.st.com/internet/evalboard/product/252419.jsp">Stm32F4Discovery</a> debug board.  From 500 rubles in Moscow retail, and maybe it already lies in your bins?  Any other board on STM32F4 or STM32F2 will do, but then you have to tweak the sources. </li><li>  Several wires to connect to the analyzed circuit. </li><li>  Ready-to-use firmware <a href="http://code.google.com/p/logicdiscovery/downloads/detail%3Fname%3DLogicDiscoveryHabr.bin%26can%3D2%26q%3D">rests on Google.Code</a> .  There are also sources. </li><li>  In addition, you need a client for a PC, I recommend <a href="http://www.lxtreme.nl/ols/">OLS</a> . </li></ul><br>  The client is written in Java, so the resulting solution does not depend on the OS.  Theoretically, you can use any SUMP-compatible client, but below I will describe how to work with this program. <br>  Stm32F4Discovery is powered by a mini-USB port, through which it is flashed.  To use the functions of the aircraft, the board is connected to the PC via the micro USB port.  To power the board from the same port, we connect <b>PA9</b> and <b>5V</b> pins with a jumper.  PA9 is connected directly to the Vbus port of micro-USB, and 5V is the input of the stabilizer that forms power to the board.  To test operation, connect the ports <b>PA2</b> and <b>PD0</b> .  A test signal is generated on PA2, and PD0 is the first input of the aircraft. <br><br><img src="https://habrastorage.org/storage2/7f3/ab0/b88/7f3ab0b88fdbf4322be7043b5ba38b21.jpg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The board is recognized by the PC as a COM port, for Linux the drivers are standard and should already be in the kernel, for Win the drivers are <a href="http://www.st.com/web/en/catalog/tools/PF257938">downloaded</a> from the ST site.  Once the board has been identified, you can start the client and get to work. <br>  But first a spoon of tar. <br><br><h4>  Restrictions </h4><br>  The project uses the open protocol <a href="http://www.sump.org/projects/analyzer/protocol/">SUMP</a> .  This protocol was originally developed for FPGA-based aircrafts, and since, in terms of recording input signals and analyzing data flow, microcontrollers are still inferior to them, not all of the functions implemented in the client will be available to us: <br><ul><li>  The maximum recording frequency is 20 MHz, in the original up to 200 MHz </li><li>  RLE compression and noise filtering are not supported. </li><li>  It is impossible to choose arbitrary groups of channels, only the first (8 channels), or the first + second (16 channels). </li><li>  Triggers work not by value, but by front (however, in my opinion, this is already a merit). </li><li>  No support for extended (Complex) triggers. </li></ul><br>  These restrictions should be kept in mind when setting up the client.  He knows nothing about these restrictions and will allow you to select any settings.  The result obtained in this case will be incorrect. <br><br><h4>  We use </h4><br>  We start the client through the run.bat or run.sh file, depending on the OS being used.  You can read about the client's functions on his page, here I will describe the process of obtaining the first samples and those settings that fall under the restrictions. <br><br>  In the <i>‚ÄúCapture‚Äù</i> menu, selecting the <i>‚ÄúBegin capture‚Äù option</i> , open the recording settings window.  On the first page, in the field <i>‚ÄúAnalyzer port‚Äù, we</i> select the port on which our aircraft is sitting; nothing else needs to be changed.  With the button <i>‚ÄúShow device metadata‚Äù</i> you can check the connection: <br><br><img src="https://habrastorage.org/storage2/5b7/713/d1d/5b7713d1d007dbf65a4bc7d7ad0d3319.png"><br><br>  On the second page we specify the capture parameters.  The first two points do not touch, <br>  <i>‚ÄúSampling rate‚Äù is</i> not higher than 20 MHz (if you specify more - the board still uses 20 MHz, but the client will think that the specified value is used, in general, the nonsense will work out). <br>  <i>‚ÄúChannel groups‚Äù</i> : 0 - use one group of channels, these are the PD0-PD7 lines, or 0 and 1 - we use two groups of channels - the PD0-PD15 lines. <br>  <i>‚ÄúRecording size‚Äù</i> : for one channel group - any value, for two groups - no more than 12kB (the client will warn you if an incorrect value is selected in this field). <br>  Checkboxes on this page do not touch, they are not supported: <br><br><img src="https://habrastorage.org/storage2/569/c5c/8a9/569c5c8a9e8b42dea238041025fb8709.png"><br><br>  The <i>"Triggers"</i> page is the most interesting.  The first checkbox is set to simply enable the triggers. <br>  <i>‚ÄúBefore / After ratio‚Äù</i> allows you to specify, as a percentage, how much data is saved until the buffer is triggered.  After clicking <i>‚ÄúCapture‚Äù, the</i> LA immediately starts recording data, adding them to a cyclic buffer, and when the trigger is triggered, it reads the percentage of time specified in the After field and sends the data to the PC. <br>  <i>‚ÄúType‚Äù</i> - only ‚ÄúSimple‚Äù, ‚ÄúComplex‚Äù - is not supported. <br>  <i>"Mode"</i> - only "Parallel". <br>  <i>‚ÄúMask‚Äù</i> are those lines on which the trigger will wait for the signal to drop, set the flag in the zero position to trigger on the PD0 line <br>  <i>‚ÄúValue‚Äù</i> - the front of the signal, which will trigger the trigger.  The checkbox is set to the front edge.  Checkbox cleared - back: <br><br><img src="https://habrastorage.org/storage2/d4c/287/0ca/d4c2870ca059646c8eaa3d0d04f96424.png"><br><br>  To test the operation, connect the ports PD0 and PA2 (this port displays the UART test signal) with a jumper. <br><br>  That's all, click <i>"Capture"</i> and look at the received signal (Ctrl + F - overview scale): <br><br><img src="https://habrastorage.org/storage2/54d/569/b5e/54d569b5e26799c9371960900ffd8664.png"><br><br>  If nothing happens, it means that you have triggered the trigger on the wrong lines, or there is no signal at all - check the settings and wiring of the board.  The trigger can be started manually by pressing the User button (blue button). <br><br><h4>  Safety </h4><br>  <b>Remember:</b> you connect directly to the ports of the microcontroller!  There is no protection other than the built-in diodes on the MK board.  Therefore, first make sure that the signal under study has a maximum voltage of 3.3V, at most 5V, but then it is desirable to add a protective resistor between the signal source and the aircraft. <br><br>  When connecting to the analyzed circuit, do not forget to first connect the earth, and only then the signal lines.  Especially when the analyzed circuit is powered from its power source, and not from the same PC to which the aircraft is connected. <br><br><h4>  Utility </h4><br>  <a href="https://code.google.com/p/logicdiscovery/">Project page on Google.Code</a> <br>  <a href="http://www.st.com/internet/com/TECHNICAL_RESOURCES/TECHNICAL_LITERATURE/USER_MANUAL/DM00039084.pdf">STM32F4Discovery card description</a> <br>  <a href="http://dangerousprototypes.com/open-logic-sniffer/">Open Logic Sniffer</a> - a project that served as a source of inspiration for this work. <br><br>  PS: LogicDiscovery is successfully used both at home and at work, mainly for analyzing serial interfaces (SPI, UART).  If there are any suggestions for expanding the functionality, I will be glad to hear.  Consider only that a lot rests on the limitations of the client, for example, the sample size on F4 can be made many times larger, but the client simply does not know other sizes. </div><p>Source: <a href="https://habr.com/ru/post/165853/">https://habr.com/ru/post/165853/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../165841/index.html">Interested in the brain / AI: links to read</a></li>
<li><a href="../165843/index.html">I'll give you a phone</a></li>
<li><a href="../165845/index.html">Click-n-fire interface - sniper rifle with Linux on board</a></li>
<li><a href="../165847/index.html">What is stopping innovation in Silicon Valley?</a></li>
<li><a href="../165849/index.html">Music sales make up only 6% of the musician's income.</a></li>
<li><a href="../165855/index.html">File system load profiling with iostat and gnuplot - amateur notes</a></li>
<li><a href="../165857/index.html">Poster of the structure of Windows Azure services in Russian</a></li>
<li><a href="../165861/index.html">Control decorative lighting on Arduino from your phone</a></li>
<li><a href="../165863/index.html">Swedish school introduces compulsory Minecraft lessons</a></li>
<li><a href="../165865/index.html">Seminar-meeting "e-Estonia - the way to Europe!" # 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>