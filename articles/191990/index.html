<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>OpenWRT, or What else can you do with your router?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, I was prompted to write a similar article, but the server was Raspberry Pi. In my opinion, using this small, but powerful enough handkerchief f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>OpenWRT, or What else can you do with your router?</h1><div class="post__text post__text-html js-mediator-article">  Hello, I was prompted to write a <a href="http://habrahabr.ru/post/191854/">similar</a> article, but the server was Raspberry Pi.  In my opinion, using this small, but powerful enough handkerchief for this purpose is a little unwise, many have a wi-fi router with a USB port, and therefore why plug into the outlet a whole power supply from a computer while still allowing a small one, but all the same power consumption when all that is needed is already plugged into the outlet. <br>  In this article, we will consider installing a torrent on almost any router with USB and support for OpenWRT firmware.  I have a Linksys E3000, but there is no specific difference in the installation and configuration of OpenWRT.  What we will need for this: <br><br><ul><li>  Directly USB router, ideally of course with two. </li><li>  USB flash drive / USB HDD of arbitrary size for your needs, the more the better. </li><li>  Literally half an hour of free time to put everything up and adjust. </li><li>  Straight arms. </li></ul><a name="habracut"></a><br><br><h5>  Install / configure OpenWRT </h5><br>  First of all, I‚Äôll immediately make a reservation that you are doing everything at your own peril and risk, since there is a possibility that your router will be ‚Äúscorched‚Äù.  Check if your router is in the list of supported devices, for this we go to the website <a href="https://openwrt.org/">OpenWrt</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/storage3/795/9df/724/7959df724bb820f121a2e77136547d3e.jpg"><br><br>  Click on the appropriate link and look for your device there in the list.  In principle, the information there is not always up-to-date, I was convinced of this on my own personal experience with my router, which in this list is listed <abbr title="without dancing with a tambourine can not do">as not fully supported</abbr> , although it is already included in the trunk.  It is advisable to remember on which chipset your router is built to facilitate the search for your particular firmware. <br><br><img src="https://habrastorage.org/storage3/7b1/881/977/7b1881977c6c194316d3badc3f8cffdd.jpg"><br><br>  After that go to the tab "Downloads" <br><br><img src="https://habrastorage.org/storage3/fb4/82e/abd/fb482eabdb4a8925ea53350d3109b3f9.jpg"><br><br>  Here you should choose which branch to use stable (Attitude Adjustment) or, accordingly, ‚Äútrunk‚Äù in the snapshots folder, I‚Äôll immediately notice if your router is a less or less new model, then you will most likely not find it in a stable branch. <br><br><img src="https://habrastorage.org/storage3/8e2/593/752/8e2593752bfd724a2a6044b637fe3a1f.jpg"><br><br>  We proceed directly to downloading the firmware. <br><br><img src="https://habrastorage.org/storage3/e1b/9d9/393/e1b9d93937f2cf21142debbaade0ba98.jpg"><br><br>  After the firmware has been downloaded, proceed to the firmware of your router.  To do this, go to its web interface, which is usually located at <a href="http://192.168.1.1/">192.168.1.1</a> or <a href="http://192.168.0.1/">192.168.0.1</a> , depending on the manufacturer of the router.  For more information on the process of firmware and Wi-Fi settings and everything else for a particular router, you can contact <a href="http://www.google.com/">Google</a> , otherwise this article can stretch to indecent sizes, but we will focus on installing and configuring Transmission. <br><br><h5>  Installing and configuring Transmission </h5><br>  After the firmware of the router, start <a href="http://putty.org/">PuTTY</a> if your Windows OS, if Linux, then just start the terminal.  In the address field we drive in 192.168.1.1 for PuTTY or the <code>telnet 192.168.1.1</code> command <code>telnet 192.168.1.1</code> for Linux.  After successful connection, proceed to installing / configuring packages. <br><br>  Before downloading the package should be a small digression.  Since the physical memory router is small enough, varies from 4 to 16 megabytes depending on the advancement and price of your router, we should worry about increasing it in advance.  After all, in any case, we are going to connect a USB flash drive or hard drive to it, so why don't we make the router boot directly from the partition on our media?  Let's do that!  Before all manipulations with the router, you need to "split" your HDD / USB flash drive into several sections. <br><br><ol><li>  Section for swap (100-200 MB will be enough) * when using HDD, when using a USB flash drive, it is not recommended, as there is at least a large but still limited supply of rewriting cycles </li><li>  The partition from which the router will be loaded (at your discretion from 50 MB and higher) with the Ext3 or Ext4 file system * This is where we can use the second flash drive, where it is better to place the boot area and the area for storing downloads on different devices so that you can safely retrieve it for discarding information without turning off the router. </li><li>  The partition for your downloads / storage, the remaining space is also desirable in Ext3 / 4, if you want to periodically use media on a computer, then NTFS but be prepared for periodic errors, since Linux is ‚Äúfriendly‚Äù with this type of file system, you will also have to install one more <code>ntfs-3g</code> package. </li></ol><br>  Of course, all this could be done on the router, but on the computer it all happens much faster and you can use programs with a graphical interface, and not just the command line of the terminal, which for a beginner greatly speeds up the process.  How to do all this on Windows and Linux, again, you can look at <a href="http://google.com/">Google</a> for the same reason as the first call to this source. <br><br>  Let's get started  Enter sequentially commands in the terminal <br><br><pre> <code class="bash hljs">opkg update opkg install block-mount kmod-usb-core kmod-usb2 kmod-usb-ohci kmod-usb-storage kmod-fs-ext4</code> </pre><br><br><h6>  With these commands we updated the database of the repositories on the router and installed the packages we need: kernel modules for USB support and file system modules </h6><br><br><pre> <code class="bash hljs">block info</code> </pre><br><br><h6>  And we are looking for our partitions on a flash drive / HDD * You did not forget to connect your flash drive / HDD to the router, right? </h6><br><br><pre> <code class="bash hljs">mount /dev/sdaX /mnt mkdir /tmp/cproot mkdir /home mount --<span class="hljs-built_in"><span class="hljs-built_in">bind</span></span> / /tmp/cproot tar -C /tmp/cproot -cvf - . | tar -C /mnt -x sync umount /mnt umount /tmp/cproot</code> </pre><br><br><h6>  Here, instead of <code>sdaX</code> you need to select the partition from which we are going to perform the download in the future.  All other commands are designed to copy the boot partition of the router to a USB flash drive / HDD. </h6><br><br><pre> <code class="bash hljs">block detect &gt; /etc/config/fstab</code> </pre><br><br><h6>  This command writes all the found sections to automatically connect to the <code>/etc/config/fstab</code> .  Next we need to slightly edit this file to the form: </h6><br><br><pre> <code class="bash hljs">config <span class="hljs-string"><span class="hljs-string">'global'</span></span> option anon_swap <span class="hljs-string"><span class="hljs-string">'0'</span></span> option anon_mount <span class="hljs-string"><span class="hljs-string">'0'</span></span> option auto_swap <span class="hljs-string"><span class="hljs-string">'1'</span></span> option auto_mount <span class="hljs-string"><span class="hljs-string">'1'</span></span> option delay_root <span class="hljs-string"><span class="hljs-string">'0'</span></span> option check_fs <span class="hljs-string"><span class="hljs-string">'0'</span></span> config <span class="hljs-string"><span class="hljs-string">'mount'</span></span> option target <span class="hljs-string"><span class="hljs-string">'/'</span></span> option uuid <span class="hljs-string"><span class="hljs-string">'7d3abfaf-493a-46bb-9730-1d793ecb9783'</span></span> option enabled <span class="hljs-string"><span class="hljs-string">'1'</span></span> config <span class="hljs-string"><span class="hljs-string">'mount'</span></span> option target <span class="hljs-string"><span class="hljs-string">'/home'</span></span> option uuid <span class="hljs-string"><span class="hljs-string">'7d3abfaf-463a-46db-9730-1d793ecb4593'</span></span> option enabled <span class="hljs-string"><span class="hljs-string">'1'</span></span> config <span class="hljs-string"><span class="hljs-string">'swap'</span></span> option uuid <span class="hljs-string"><span class="hljs-string">'76d36596-5710-4b77-a3a7-02a66d469750'</span></span> option enabled <span class="hljs-string"><span class="hljs-string">'1'</span></span></code> </pre><br><br>  Open this file for editing: <br><br> <code>vi /etc/config/fstab</code> <br> <br>  How to use this editor you can see <a href="http://docs.altlinux.org/archive/2.3/junior/alt-docs-extras-linuxnovice/ch02s10.html">here</a> or again go to <a href="http://www.google.com/">Google</a> . <br>  Reboot the router.  Again we go into the console and check whether everything was correctly mounted: <br><br><pre> <code class="bash hljs">root@OpenWrt:~<span class="hljs-comment"><span class="hljs-comment"># df Filesystem 1K-blocks Used Available Use% Mounted on rootfs 2758072 118004 2501828 5% / /dev/root 2048 2048 0 100% /rom tmpfs 63340 76 63264 0% /tmp tmpfs 512 0 512 0% /dev /dev/sda1 2758072 118004 2501828 5%</span></span></code> </pre><br><br>  Here you should pay attention to the fact that <code>rootfs</code> matches the parameters with <code>/dev/sda1</code> , if this is the case, then everything <code>rootfs</code> out for us.  Moving on to the next item. <br><br><h5>  Installing the torrent Transmission client. </h5><br><br><pre> <code class="bash hljs">opkg update opkg install transmission-daemon transmission-cli transmission-web transmission-remote /etc/init.d/transmission <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span></code> </pre><br><br>  Open the client settings file and edit to fit your needs: <br><br><pre> <code class="bash hljs">vi /etc/config/transmission</code> </pre><br><br><pre> <code class="bash hljs">config transmission option <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> 1 <span class="hljs-comment"><span class="hljs-comment">#    option config_dir '/etc/transmission' #     option alt_speed_down 50 #   option alt_speed_enabled false option alt_speed_time_begin 540 option alt_speed_time_day 127 option alt_speed_time_enabled false option alt_speed_time_end 1020 option alt_speed_up 50 option bind_address_ipv4 '0.0.0.0' option bind_address_ipv6 '::' option blocklist_enabled false option dht_enabled true option download_dir '/home/' #    option encryption 0 #  option incomplete_dir '/home' #      option incomplete_dir_enabled false # /     option lazy_bitfield_enabled true option lpd_enabled false option message_level 2 option open_file_limit 32 option peer_limit_global 240 option peer_limit_per_torrent 60 option peer_port 51413 option peer_port_random_high 65535 option peer_port_random_low 49152 option peer_port_random_on_start false option peer_socket_tos 0 option pex_enabled true option port_forwarding_enabled false option preallocation 1 option proxy "" option proxy_auth_enabled false option proxy_auth_password '' option proxy_auth_username '' option proxy_enabled false option proxy_port 80 option proxy_type 0 option ratio_limit 2.0000 option ratio_limit_enabled false option rename_partial_files true option rpc_authentication_required false option rpc_bind_address '0.0.0.0' option rpc_enabled true option rpc_password '' option rpc_port 9091 option rpc_username '' option rpc_whitelist '127.0.0.1,192.168.1.*' option rpc_whitelist_enabled false option script_torrent_done_enabled false option script_torrent_done_filename '' option speed_limit_down 100 option speed_limit_down_enabled false option speed_limit_up 40 option speed_limit_up_enabled true option start_added_torrents false option trash_original_torrent_files false option umask 18 option upload_slots_per_torrent 14 option watch_dir_enabled false option watch_dir ''</span></span></code> </pre><br><br>  We start and check: <br><br><pre> <code class="bash hljs">/etc/init.d/transmission start</code> </pre><br><br>  We launch the browser and enter <a href="http://192.168.1.1:9091/">192.168.1.1:9091</a> if everything works, that's all. <br><br>  If this article is of interest to anyone, I‚Äôm also ready to tell you about setting up a ‚Äúfile dump‚Äù, raising a VPN server, setting IPTV on OpenWRT. <br><br>  I foresee the opinion of many that on Habr√© and indeed throughout the Internet is full of similar instructions, but I have tried as much as possible in detail and simply to paint the entire process of installation and configuration.  Just recently, the principle of using a flash drive as the root partition has slightly changed in OpenWRT, now this information is already available on the project wiki, but only in English. <br><br>  UPD: This article does not describe how to configure the Internet connection from your provider, as there are too many nuances of settings.  Without connecting the router to the Internet, of course, nothing will come of it. </div><p>Source: <a href="https://habr.com/ru/post/191990/">https://habr.com/ru/post/191990/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../191980/index.html">How to stop dragging diskettes on a DOS machine</a></li>
<li><a href="../191982/index.html">We repair the USB cable on the knee</a></li>
<li><a href="../191984/index.html">DebiGger for Yii 1.1 ported from Yii 2</a></li>
<li><a href="../191986/index.html">Unit tests in practice</a></li>
<li><a href="../191988/index.html">How not to overpay for Arduino and modules for it</a></li>
<li><a href="../191994/index.html">Basics of Irrlicht Engine for newbies</a></li>
<li><a href="../191996/index.html">We draw electronic money</a></li>
<li><a href="../191998/index.html">Zaovnil, stuck, gash: dictionary IT-Schnick</a></li>
<li><a href="../192000/index.html">Bootstrap, or application statistics with almost no formulas</a></li>
<li><a href="../192002/index.html">Development of a new professional standard in the field of information technology</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>