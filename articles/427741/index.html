<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Code Generator for Laravel - input OAS, output JSON-API</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The ability to create a code generator for the API to save the future generation from the need to constantly create the same controllers, models, rout...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Code Generator for Laravel - input OAS, output JSON-API</h1><div class="post__text post__text-html js-mediator-article">  The ability to create a code generator for the API to save the future generation from the need to constantly create the same controllers, models, routers, middlewares, migrations, skeletons, filters, validations, etc.  manually (even in the context of all the usual and convenient frameworks) seemed interesting to me. <br><br>  I studied the typing and subtleties of the OpenAPI specification, I liked the linearity and the ability to describe the structure and types of any entity at 1-3 levels deep.  Since at that time I was already familiar with Laravel (before it I used Yii2, CI, but they were less popular), as well as with the json-api data output format - the entire architecture settled down in the head with a connected graph. <br><br><img src="https://habrastorage.org/webt/av/8r/tv/av8rtvzwmlh6aiuh2oir4qmmgdm.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Let's move on to the examples. <br><a name="habracut"></a><br>  Suppose we have the following entity described in the OAS: <br><br><pre><code class="plaintext hljs">ArticleAttributes: description: Article attributes description type: object properties: title: required: true type: string minLength: 16 maxLength: 256 facets: index: idx_title: index description: required: true type: string minLength: 32 maxLength: 1024 facets: spell_check: true spell_language: en url: required: false type: string minLength: 16 maxLength: 255 facets: index: idx_url: unique show_in_top: description: Show at the top of main page required: false type: boolean status: description: The state of an article enum: ["draft", "published", "postponed", "archived"] facets: state_machine: initial: ['draft'] draft: ['published'] published: ['archived', 'postponed'] postponed: ['published', 'archived'] archived: [] topic_id: description: ManyToOne Topic relationship required: true type: integer minimum: 1 maximum: 6 facets: index: idx_fk_topic_id: foreign references: id on: topic onDelete: cascade onUpdate: cascade rate: type: number minimum: 3 maximum: 9 format: double date_posted: type: date-only time_to_live: type: time-only deleted_at: type: datetime</code> </pre> <br>  If we run the command <br><br><pre> <code class="bash hljs">php artisan api:generate oas/openapi.yaml --migrations</code> </pre><br>  then we get the following generated objects: <br><br>  1) Entity controller <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Modules</span></span>\<span class="hljs-title"><span class="hljs-title">V1</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Controllers</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArticleController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DefaultController</span></span></span><span class="hljs-class"> </span></span>{ }</code> </pre><br>  He is already able to GET / POST / PATCH / DELETE, for which he will go to the table through the model, the migration for which will also be generated.  DefaultController is always available to the developer, so that it is possible to implement functionality for all controllers. <br><br>  2) Article Entity Model <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Modules</span></span>\<span class="hljs-title"><span class="hljs-title">V2</span></span>\<span class="hljs-title"><span class="hljs-title">Entities</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Database</span></span>\<span class="hljs-title"><span class="hljs-title">Eloquent</span></span>\<span class="hljs-title"><span class="hljs-title">SoftDeletes</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">rjapi</span></span>\<span class="hljs-title"><span class="hljs-title">extension</span></span>\<span class="hljs-title"><span class="hljs-title">BaseModel</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Article</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseModel</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">SoftDeletes</span></span>; <span class="hljs-comment"><span class="hljs-comment">// &gt;&gt;&gt;props&gt;&gt;&gt; protected $dates = ['deleted_at']; protected $primaryKey = 'id'; protected $table = 'article'; public $timestamps = false; public $incrementing = false; // &lt;&lt;&lt;props&lt;&lt;&lt; // &gt;&gt;&gt;methods&gt;&gt;&gt; public function tag() { return $this-&gt;belongsToMany(Tag::class, 'tag_article'); } public function topic() { return $this-&gt;belongsTo(Topic::class); } // &lt;&lt;&lt;methods&lt;&lt;&lt; }</span></span></code> </pre><br><cut></cut><br>  As you can see, comments appeared here // &gt;&gt;&gt; props &gt;&gt;&gt; and // &gt;&gt;&gt; methods &gt;&gt;&gt; - they are needed to separate the code-space from the user code-space.  There are also tag / topic relationships - belognsToMany / belongsTo respectively, which will associate the essence of the Article with tags / topics, providing an opportunity to access them in relations json-api with one GET request or modify them by updating the article. <br><br>  3) Entity migration, with rollback support (reflection / atomicity): <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Support</span></span>\<span class="hljs-title"><span class="hljs-title">Facades</span></span>\<span class="hljs-title"><span class="hljs-title">Schema</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Database</span></span>\<span class="hljs-title"><span class="hljs-title">Schema</span></span>\<span class="hljs-title"><span class="hljs-title">Blueprint</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Database</span></span>\<span class="hljs-title"><span class="hljs-title">Migrations</span></span>\<span class="hljs-title"><span class="hljs-title">Migration</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CreateArticleTable</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Migration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">up</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Schema::create(<span class="hljs-string"><span class="hljs-string">'article'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Blueprint $table)</span></span></span><span class="hljs-function"> </span></span>{ $table-&gt;bigIncrements(<span class="hljs-string"><span class="hljs-string">'id'</span></span>); $table-&gt;string(<span class="hljs-string"><span class="hljs-string">'title'</span></span>, <span class="hljs-number"><span class="hljs-number">256</span></span>); $table-&gt;index(<span class="hljs-string"><span class="hljs-string">'title'</span></span>, <span class="hljs-string"><span class="hljs-string">'idx_title'</span></span>); $table-&gt;string(<span class="hljs-string"><span class="hljs-string">'description'</span></span>, <span class="hljs-number"><span class="hljs-number">1024</span></span>); $table-&gt;string(<span class="hljs-string"><span class="hljs-string">'url'</span></span>, <span class="hljs-number"><span class="hljs-number">255</span></span>); $table-&gt;unique(<span class="hljs-string"><span class="hljs-string">'url'</span></span>, <span class="hljs-string"><span class="hljs-string">'idx_url'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Show at the top of main page $table-&gt;unsignedTinyInteger('show_in_top'); $table-&gt;enum('status', ["draft","published","postponed","archived"]); // ManyToOne Topic relationship $table-&gt;unsignedInteger('topic_id'); $table-&gt;foreign('topic_id', 'idx_fk_topic_id')-&gt;references('id')-&gt;on('topic')-&gt;onDelete('cascade')-&gt;onUpdate('cascade'); $table-&gt;timestamps(); }); } public function down() { Schema::dropIfExists('article'); } }</span></span></code> </pre><br>  The migration generator supports all types of indices (including composite ones). <br><br>  4) Router for querying requests: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// &gt;&gt;&gt;routes&gt;&gt;&gt; // Article routes Route::group(['prefix' =&gt; 'v2', 'namespace' =&gt; 'Modules\\V2\\Http\\Controllers'], function() { // bulk routes Route::post('/article/bulk', 'ArticleController@createBulk'); Route::patch('/article/bulk', 'ArticleController@updateBulk'); Route::delete('/article/bulk', 'ArticleController@deleteBulk'); // basic routes Route::get('/article', 'ArticleController@index'); Route::get('/article/{id}', 'ArticleController@view'); Route::post('/article', 'ArticleController@create'); Route::patch('/article/{id}', 'ArticleController@update'); Route::delete('/article/{id}', 'ArticleController@delete'); // relation routes Route::get('/article/{id}/relationships/{relations}', 'ArticleController@relations'); Route::post('/article/{id}/relationships/{relations}', 'ArticleController@createRelations'); Route::patch('/article/{id}/relationships/{relations}', 'ArticleController@updateRelations'); Route::delete('/article/{id}/relationships/{relations}', 'ArticleController@deleteRelations'); }); // &lt;&lt;&lt;routes&lt;&lt;&lt;</span></span></code> </pre><br>  Roads were created not only for basic queries, but also relations (relations) with other entities that will be pulled out with 1 query and extensions as a bulk of operations for the ability to create / update / delete data in ‚Äúbatches‚Äù. <br><br>  5) FormRequest for pre-processing / validating requests: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Modules</span></span>\<span class="hljs-title"><span class="hljs-title">V1</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Requests</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">rjapi</span></span>\<span class="hljs-title"><span class="hljs-title">extension</span></span>\<span class="hljs-title"><span class="hljs-title">BaseFormRequest</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArticleFormRequest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseFormRequest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// &gt;&gt;&gt;props&gt;&gt;&gt; public $id = null; // Attributes public $title = null; public $description = null; public $url = null; public $show_in_top = null; public $status = null; public $topic_id = null; public $rate = null; public $date_posted = null; public $time_to_live = null; public $deleted_at = null; // &lt;&lt;&lt;props&lt;&lt;&lt; // &gt;&gt;&gt;methods&gt;&gt;&gt; public function authorize(): bool { return true; } public function rules(): array { return [ 'title' =&gt; 'required|string|min:16|max:256|', 'description' =&gt; 'required|string|min:32|max:1024|', 'url' =&gt; 'string|min:16|max:255|', // Show at the top of main page 'show_in_top' =&gt; 'boolean', // The state of an article 'status' =&gt; 'in:draft,published,postponed,archived|', // ManyToOne Topic relationship 'topic_id' =&gt; 'required|integer|min:1|max:6|', 'rate' =&gt; '|min:3|max:9|', 'date_posted' =&gt; '', 'time_to_live' =&gt; '', 'deleted_at' =&gt; '', ]; } public function relations(): array { return [ 'tag', 'topic', ]; } // &lt;&lt;&lt;methods&lt;&lt;&lt; }</span></span></code> </pre><br>  Everything is simple here - the rules of validation of properties and relations for the connection of the main entity with the entities in the relations method are generated. <br><br>  Finally, the most pleasant are examples of requests: <br><br><pre> <code class="php hljs">http:<span class="hljs-comment"><span class="hljs-comment">//example.com/v1/article?include=tag&amp;page=2&amp;limit=10&amp;sort=asc</span></span></code> </pre><br>  Bring out the article, pull up in relations all its tags, pagination on page 2, with a limit of 10 and sort it in-time. <br><br>  If we do not need to display all fields of the article: <br><br><pre> <code class="php hljs">http:<span class="hljs-comment"><span class="hljs-comment">//example.com/v1/article/1?include=tag&amp;data=["title", "description"]</span></span></code> </pre><br>  Sort by multiple fields: <br><br><pre> <code class="php hljs">http:<span class="hljs-comment"><span class="hljs-comment">//example.com/v1/article/1?include=tag&amp;order_by={"title":"asc", "created_at":"desc"}</span></span></code> </pre><br>  Filtering (or what falls in the WHERE clause): <br><br><pre> <code class="php hljs">http:<span class="hljs-comment"><span class="hljs-comment">//example.com/v1/article?include=tag&amp;filter=[["updated_at", "&gt;", "2018-01-03 12:13:13"], ["updated_at", "&lt;", "2018-09-03 12:13:15"]]</span></span></code> </pre><br>  An example of creating an entity (in this case, an article): <br><br><pre> <code class="json hljs">POST http://laravel.loc/v<span class="hljs-number"><span class="hljs-number">1</span></span>/article { <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>:<span class="hljs-string"><span class="hljs-string">"article"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"attributes"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>:<span class="hljs-string"><span class="hljs-string">"Foo bar Foo bar Foo bar Foo bar"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>:<span class="hljs-string"><span class="hljs-string">"description description description description description"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"fake_attr"</span></span>: <span class="hljs-string"><span class="hljs-string">"attr"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>:<span class="hljs-string"><span class="hljs-string">"title title bla bla bla"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"show_in_top"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span> } } }</code> </pre><br>  Answer: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"article"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"attributes"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Foo bar Foo bar Foo bar Foo bar"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"description description description description description"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"title title bla bla bla"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"show_in_top"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"links"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"self"</span></span>: <span class="hljs-string"><span class="hljs-string">"laravel.loc/article/1"</span></span> } } }</code> </pre><br>  See the link in links-&gt; self?  you can immediately <pre> <code class="json hljs">GET http://laravel.loc/article/<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre>  or save it for future use. <br><br><pre> <code class="json hljs">GET http://laravel.loc/v<span class="hljs-number"><span class="hljs-number">1</span></span>/article?include=tag&amp;filter=[[<span class="hljs-string"><span class="hljs-string">"updated_at"</span></span>, <span class="hljs-string"><span class="hljs-string">"&gt;"</span></span>, <span class="hljs-string"><span class="hljs-string">"2017-01-03 12:13:13"</span></span>], [<span class="hljs-string"><span class="hljs-string">"updated_at"</span></span>, <span class="hljs-string"><span class="hljs-string">"&lt;"</span></span>, <span class="hljs-string"><span class="hljs-string">"2019-01-03 12:13:15"</span></span>]] { <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"article"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"attributes"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Foo bar Foo bar Foo bar Foo bar 1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"The quick brovn fox jumped ower the lazy dogg"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://example.com/articles_feed 1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"show_in_top"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"status"</span></span>: <span class="hljs-string"><span class="hljs-string">"draft"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"topic_id"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"rate"</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-attr"><span class="hljs-attr">"date_posted"</span></span>: <span class="hljs-string"><span class="hljs-string">"2018-02-12"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"time_to_live"</span></span>: <span class="hljs-string"><span class="hljs-string">"10:11:12"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"links"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"self"</span></span>: <span class="hljs-string"><span class="hljs-string">"laravel.loc/article/1"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"relationships"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"tag"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"links"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"self"</span></span>: <span class="hljs-string"><span class="hljs-string">"laravel.loc/article/1/relationships/tag"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"related"</span></span>: <span class="hljs-string"><span class="hljs-string">"laravel.loc/article/1/tag"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"tag"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"1"</span></span> } ] } } } ], <span class="hljs-attr"><span class="hljs-attr">"included"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"tag"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"attributes"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Tag 1"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"links"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"self"</span></span>: <span class="hljs-string"><span class="hljs-string">"laravel.loc/tag/1"</span></span> } } ] }</code> </pre><br>  Returned a list of objects, in each of which the type of this object, its id, the whole set of attributes, then a link to itself, the relationships requested in the url via <u>include = tag</u> according to the specification there are no restrictions on the inclusion of relationships, that is, you can for example <u>include = tag, The topic, city</u> and all of them will be included in <b>relationships</b> , and their objects will be stored in <b>included</b> . <br><br>  If we want to get 1 article and all its relations / links: <br><br><pre> <code class="json hljs">GET http://laravel.loc/v<span class="hljs-number"><span class="hljs-number">1</span></span>/article/<span class="hljs-number"><span class="hljs-number">1</span></span>?include=tag&amp;data=[<span class="hljs-string"><span class="hljs-string">"title"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span>] { <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"article"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"attributes"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Foo bar Foo bar Foo bar Foo bar 123456"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"description description description description description 123456"</span></span>, }, <span class="hljs-attr"><span class="hljs-attr">"links"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"self"</span></span>: <span class="hljs-string"><span class="hljs-string">"laravel.loc/article/1"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"relationships"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"tag"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"links"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"self"</span></span>: <span class="hljs-string"><span class="hljs-string">"laravel.loc/article/1/relationships/tag"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"related"</span></span>: <span class="hljs-string"><span class="hljs-string">"laravel.loc/article/1/tag"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"tag"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"3"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"tag"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"1"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"tag"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"2"</span></span> } ] } } }, <span class="hljs-attr"><span class="hljs-attr">"included"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"tag"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"3"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"attributes"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Tag 4"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"links"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"self"</span></span>: <span class="hljs-string"><span class="hljs-string">"laravel.loc/tag/3"</span></span> } }, { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"tag"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"attributes"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Tag 2"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"links"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"self"</span></span>: <span class="hljs-string"><span class="hljs-string">"laravel.loc/tag/1"</span></span> } }, { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"tag"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"attributes"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Tag 3"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"links"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"self"</span></span>: <span class="hljs-string"><span class="hljs-string">"laravel.loc/tag/2"</span></span> } } ] }</code> </pre><br><br>  And here is an example of adding relationships to an already existing entity - a query: <br><br><pre> <code class="json hljs">PATCH http://laravel.loc/v<span class="hljs-number"><span class="hljs-number">1</span></span>/article/<span class="hljs-number"><span class="hljs-number">1</span></span>/relationships/tag { <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>:<span class="hljs-string"><span class="hljs-string">"article"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:<span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"relationships"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"tag"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"tag"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"2"</span></span> },{ <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"tag"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"3"</span></span> }] } } } }</code> </pre><br>  Answer: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"article"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"attributes"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Foo bar Foo bar Foo bar Foo bar 1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"The quick brovn fox jumped ower the lazy dogg"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://example.com/articles_feed 1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"show_in_top"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"status"</span></span>: <span class="hljs-string"><span class="hljs-string">"draft"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"topic_id"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"rate"</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-attr"><span class="hljs-attr">"date_posted"</span></span>: <span class="hljs-string"><span class="hljs-string">"2018-02-12"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"time_to_live"</span></span>: <span class="hljs-string"><span class="hljs-string">"10:11:12"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"links"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"self"</span></span>: <span class="hljs-string"><span class="hljs-string">"laravel.loc/article/1"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"relationships"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"tag"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"links"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"self"</span></span>: <span class="hljs-string"><span class="hljs-string">"laravel.loc/article/1/relationships/tag"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"related"</span></span>: <span class="hljs-string"><span class="hljs-string">"laravel.loc/article/1/tag"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"tag"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"2"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"tag"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"3"</span></span> } ] } } }, <span class="hljs-attr"><span class="hljs-attr">"included"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"tag"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"attributes"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Tag 2"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"links"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"self"</span></span>: <span class="hljs-string"><span class="hljs-string">"laravel.loc/tag/2"</span></span> } }, { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"tag"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"3"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"attributes"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Tag 3"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"links"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"self"</span></span>: <span class="hljs-string"><span class="hljs-string">"laravel.loc/tag/3"</span></span> } } ] }</code> </pre><br>  Console generator can pass additional options: <br><br><pre> <code class="json hljs">php artisan api:generate oas/openapi.yaml --migrations --regenerate --merge=last</code> </pre><br>  Thus, you report to the generator ‚Äî create a code with migrations (you have already seen this) and regenerate the code, match it with the latest changes from the saved history, without affecting custom code areas, but only those that were generated automatically (i.e. which are highlighted with special blocks by comments in the code).  It is possible to specify steps backwards, for example: <b>--merge = 9</b> (rollback generation 9 steps back), the date of code generation in the past <b>--merge = "2017-07-29 11:35:32"</b> . <br><br>  One of the library users suggested generating functional tests for queries - by adding the option - <b>tests</b> you can build tests to be sure that your API works without errors. <br><br>  Additionally, you can use a variety of options (all of them are flexibly configured via the configurator, which lies in the generated module - example: <i>/Modules/V2/Config/config.php</i> ): <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'V2'</span></span>, <span class="hljs-string"><span class="hljs-string">'query_params'</span></span>=&gt; [ <span class="hljs-comment"><span class="hljs-comment">//    - 'limit' =&gt; 15, 'sort' =&gt; 'desc', 'access_token' =&gt; 'db7329d5a3f381875ea6ce7e28fe1ea536d0acaf', ], 'trees'=&gt; [ //      'menu' =&gt; true, ], 'jwt'=&gt; [ // jwt  'enabled' =&gt; true, 'table' =&gt; 'user', 'activate' =&gt; 30, 'expires' =&gt; 3600, ], 'state_machine'=&gt; [ // finite state machine 'article'=&gt; [ 'status'=&gt; [ 'enabled' =&gt; true, 'states'=&gt; [ 'initial' =&gt; ['draft'], 'draft' =&gt; ['published'], 'published' =&gt; ['archived', 'postponed'], 'postponed' =&gt; ['published', 'archived'], 'archived' =&gt; [''], ], ], ], ], 'spell_check'=&gt; [ //       'article'=&gt; [ 'description'=&gt; [ 'enabled' =&gt; true, 'language' =&gt; 'en', ], ], ], 'bit_mask'=&gt; [ //     permissions ( true/false /  ) 'user'=&gt; [ 'permissions'=&gt; [ 'enabled' =&gt; true, 'flags'=&gt; [ 'publisher' =&gt; 1, 'editor' =&gt; 2, 'manager' =&gt; 4, 'photo_reporter' =&gt; 8, 'admin' =&gt; 16, ], ], ], ], 'cache'=&gt; [ //    'tag'=&gt; [ 'enabled' =&gt; false, //    tag  'stampede_xfetch' =&gt; true, 'stampede_beta' =&gt; 1.1, 'ttl' =&gt; 3600, ], 'article'=&gt; [ 'enabled' =&gt; true, //    article  'stampede_xfetch' =&gt; true, 'stampede_beta' =&gt; 1.5, 'ttl' =&gt; 300, ], ], ];</span></span></code> </pre><br>  Naturally, all configurations can be point-on / off if necessary.  For more information about the additional features of the code generator, see the links below.  Contributions are always welcome. <br><br>  Thank you for your attention, creative success. <br><br>  Article Resources: <br><br><ul><li>  <a href="https://github.com/RJAPI/api-generator">generator</a> </li><li>  <a href="https://jsonapi.org/format/">json-api specification</a> </li><li>  <a href="https://swagger.io/specification/">OAS specification</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/427741/">https://habr.com/ru/post/427741/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../427731/index.html">Linus Torvalds back into service after the release of the 4.19 kernel version</a></li>
<li><a href="../427733/index.html">Cyberpunk 2000: Deus Ex creation tools</a></li>
<li><a href="../427735/index.html">Analysis of the game from classmates on Joker 2018</a></li>
<li><a href="../427737/index.html">Journey to the Land of Giants: ONYX BOOX Gulliver Overview</a></li>
<li><a href="../427739/index.html">DDD, Hexagonal, Onion, Clean, CQRS ... how I put it all together</a></li>
<li><a href="../427743/index.html">Funny and strange: we collected search queries that we like.</a></li>
<li><a href="../427745/index.html">Kubernetes tips & tricks: access to dev sites</a></li>
<li><a href="../427747/index.html">Who to crush an unmanned vehicle: the results of the Moral Machine experiment</a></li>
<li><a href="../427749/index.html">Apple and Samsung for the first time fined slowing down old phones</a></li>
<li><a href="../427751/index.html">Ideas for Sublime by CudaText</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>