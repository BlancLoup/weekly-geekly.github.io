<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The use of machine learning in trading. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Translator's note. I continue to translate a series of articles on the use of machine learning in trading. The previous part is here . About any error...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The use of machine learning in trading. Part 2</h1><div class="post__text post__text-html js-mediator-article">  <i>Translator's note.</i>  <i>I continue to translate a series of articles on the use of machine learning in trading.</i>  <i><a href="http://habrahabr.ru/post/234303/">The previous part is here</a> .</i>  <i>About any errors and corrections, write to the PM.</i> <br><br><h3>  <b>How to use decision tree for stock trading Bank of America.</b> </h3><br><img src="https://habrastorage.org/files/3df/a8a/333/3dfa8a3338c24c74b15aaeaebc1cffc6.png"><br><br>  Suppose you like to use a variety of technical indicators and you want to create a strategy that looks for specific high-probability opportunities in the market.  What if the RSI value is above 85 and, at the same time, the MACD line below 20, means a good opportunity to open a short position?  You can spend days / weeks / months in attempts to manually calculate all combinations of your indicators, or you can use a decision tree - a powerful and easily interpretable algorithm. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      First, let's look at how decision trees work, then consider their use for the example of building a stock trading strategy of Bank of America. <br><a name="habracut"></a><br><h4>  <b>How the decision tree works</b> </h4><br>  Decision trees are one of the most popular machine learning algorithms, since they allow you to simulate data with strong noise, easily select non-linear trends, and catch the relationship between your indicators.  However, they are also easily interpretable.  Decision trees use a downstream, divide and conquer approach to data analysis.  They look for an indicator and an indicator value that best breaks data into two opposite groups.  The algorithm then repeats this process on each of the groups, and so it continues until it classifies each data point or the stopping criterion is reached.  In our case, the data may belong to one of two groups: ‚ÄúUp‚Äù or ‚ÄúDown‚Äù.  Each splitting, called a node, tries to maximize the purity of the resulting branches.  Purity in this case is the probability that the data belong to one of the groups; it is characterized by the complexity parameter for each node. <br><br>  Decision trees can easily retrain on test data and give a terrible result on new data.  There are three ways to solve this problem: <br>  ‚Ä¢ You can control the growth of the tree by specifying the threshold of the complexity parameter or the minimum number of data points in each branch, to fix the subset.  This creates a tree that will try to cover wider models and will not focus on small subsets that may be unique to your data set. <br>  ‚Ä¢ You can also prune trees after they have been built.  This is usually done by choosing the size of the tree, which minimizes the cross-validation error.  Cross-validation is a process that divides data into several groups, then uses all groups except one to build a model, and uses the remaining group of data to test the model.  Then this process is repeated in such a way that each group is used for testing.  Then the tree with the lowest average error is selected.  This method is also good for preventing retraining if you have a limited amount of data. <br>  ‚Ä¢ The most difficult way is to build many different trees and use them together to make decisions.  There are three popular methods for building more than one decision tree: ‚Äúbag‚Äù, ‚Äúraised‚Äù trees, and random forests.  Perhaps in future articles we will look at these methods in more detail. <br><br>  Now that we have a basic understanding of decision trees, let's build our strategy! <br><br><h4>  <b>Strategy building</b> </h4><br>  Let's take a look at how to build a strategy based on 4 technical indicators to determine the movement of BoA stocks. <br>  First, let's make sure that we have all the necessary libraries. <br><br><pre><code class="hljs vhdl">install.packages(<span class="hljs-string"><span class="hljs-string">"quantmod"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">library</span></span>(<span class="hljs-string"><span class="hljs-string">"quantmod"</span></span>) #        install.packages(<span class="hljs-string"><span class="hljs-string">"rpart"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">library</span></span>(<span class="hljs-string"><span class="hljs-string">"rpart"</span></span>) #    ,    . install.packages(<span class="hljs-string"><span class="hljs-string">"rpart.plot"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">library</span></span>(<span class="hljs-string"><span class="hljs-string">"rpart.plot"</span></span>) #     </code> </pre> <br>  Then, let's get the data and calculate the indicators. <br><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">startDate</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.<span class="hljs-type"><span class="hljs-type">Date</span></span>(<span class="hljs-string"><span class="hljs-string">"2012-01-01"</span></span>) #   endDate = <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.<span class="hljs-type"><span class="hljs-type">Date</span></span>(<span class="hljs-string"><span class="hljs-string">"2014-01-01"</span></span>) #  getSymbols(<span class="hljs-string"><span class="hljs-string">"BAC"</span></span>, src = <span class="hljs-string"><span class="hljs-string">"yahoo"</span></span>, from = startDate, to = endDate) #    <span class="hljs-type"><span class="hljs-type">Bank</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-type"><span class="hljs-type">America</span></span> <span class="hljs-type"><span class="hljs-type">RSI3</span></span>&lt;-<span class="hljs-type"><span class="hljs-type">RSI</span></span>(<span class="hljs-type"><span class="hljs-type">Op</span></span>(<span class="hljs-type"><span class="hljs-type">BAC</span></span>), n= <span class="hljs-number"><span class="hljs-number">3</span></span>) # <span class="hljs-number"><span class="hljs-number">3</span></span>-     (<span class="hljs-type"><span class="hljs-type">RSI</span></span>)    <span class="hljs-type"><span class="hljs-type">EMA5</span></span>&lt;-<span class="hljs-type"><span class="hljs-type">EMA</span></span>(<span class="hljs-type"><span class="hljs-type">Op</span></span>(<span class="hljs-type"><span class="hljs-type">BAC</span></span>),n=<span class="hljs-number"><span class="hljs-number">5</span></span>) # <span class="hljs-number"><span class="hljs-number">5</span></span>-    (<span class="hljs-type"><span class="hljs-type">EMA</span></span>) <span class="hljs-type"><span class="hljs-type">EMAcross</span></span>&lt;- <span class="hljs-type"><span class="hljs-type">Op</span></span>(<span class="hljs-type"><span class="hljs-type">BAC</span></span>)-<span class="hljs-type"><span class="hljs-type">EMA5</span></span> #         <span class="hljs-number"><span class="hljs-number">5</span></span>-  <span class="hljs-type"><span class="hljs-type">EMA</span></span> <span class="hljs-type"><span class="hljs-type">MACD</span></span>&lt;-<span class="hljs-type"><span class="hljs-type">MACD</span></span>(<span class="hljs-type"><span class="hljs-type">Op</span></span>(<span class="hljs-type"><span class="hljs-type">BAC</span></span>),fast = <span class="hljs-number"><span class="hljs-number">12</span></span>, slow = <span class="hljs-number"><span class="hljs-number">26</span></span>, signal = <span class="hljs-number"><span class="hljs-number">9</span></span>) # <span class="hljs-type"><span class="hljs-type">MACD</span></span>(/  )    <span class="hljs-type"><span class="hljs-type">MACDsignal</span></span>&lt;-<span class="hljs-type"><span class="hljs-type">MACD</span></span>[,<span class="hljs-number"><span class="hljs-number">2</span></span>] #       <span class="hljs-type"><span class="hljs-type">SMI</span></span>&lt;-<span class="hljs-type"><span class="hljs-type">SMI</span></span>(<span class="hljs-type"><span class="hljs-type">Op</span></span>(<span class="hljs-type"><span class="hljs-type">BAC</span></span>),n=<span class="hljs-number"><span class="hljs-number">13</span></span>,slow=<span class="hljs-number"><span class="hljs-number">25</span></span>,fast=<span class="hljs-number"><span class="hljs-number">2</span></span>,signal=<span class="hljs-number"><span class="hljs-number">9</span></span>) #     <span class="hljs-type"><span class="hljs-type">SMI</span></span>&lt;-<span class="hljs-type"><span class="hljs-type">SMI</span></span>[,<span class="hljs-number"><span class="hljs-number">1</span></span>] #     </code> </pre><br>  Then we calculate the variable that we predict and form the data sets. <br><br><pre> <code class="hljs swift"><span class="hljs-type"><span class="hljs-type">PriceChange</span></span>&lt;- <span class="hljs-type"><span class="hljs-type">Cl</span></span>(<span class="hljs-type"><span class="hljs-type">BAC</span></span>) - <span class="hljs-type"><span class="hljs-type">Op</span></span>(<span class="hljs-type"><span class="hljs-type">BAC</span></span>) #       <span class="hljs-type"><span class="hljs-type">Class</span></span>&lt;-ifelse(<span class="hljs-type"><span class="hljs-type">PriceChange</span></span>&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-string"><span class="hljs-string">"UP"</span></span>,<span class="hljs-string"><span class="hljs-string">"DOWN"</span></span>) #    . <span class="hljs-type"><span class="hljs-type">DataSet</span></span>&lt;-data.frame(<span class="hljs-type"><span class="hljs-type">RSI3</span></span>,<span class="hljs-type"><span class="hljs-type">EMAcross</span></span>,<span class="hljs-type"><span class="hljs-type">MACDsignal</span></span>,<span class="hljs-type"><span class="hljs-type">SMI</span></span>,<span class="hljs-type"><span class="hljs-type">Class</span></span>) #  data <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> colnames(<span class="hljs-type"><span class="hljs-type">DataSet</span></span>)&lt;-<span class="hljs-built_in"><span class="hljs-built_in">c</span></span>(<span class="hljs-string"><span class="hljs-string">"RSI3"</span></span>,<span class="hljs-string"><span class="hljs-string">"EMAcross"</span></span>,<span class="hljs-string"><span class="hljs-string">"MACDsignal"</span></span>,<span class="hljs-string"><span class="hljs-string">"Stochastic"</span></span>,<span class="hljs-string"><span class="hljs-string">"Class"</span></span>) #   <span class="hljs-type"><span class="hljs-type">DataSet</span></span>&lt;-<span class="hljs-type"><span class="hljs-type">DataSet</span></span>[-<span class="hljs-built_in"><span class="hljs-built_in">c</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span>),] #  ,       <span class="hljs-type"><span class="hljs-type">TrainingSet</span></span>&lt;-<span class="hljs-type"><span class="hljs-type">DataSet</span></span>[<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">312</span></span>,] # <span class="hljs-number"><span class="hljs-number">2</span></span>/<span class="hljs-number"><span class="hljs-number">3</span></span>      <span class="hljs-type"><span class="hljs-type">TestSet</span></span>&lt;-<span class="hljs-type"><span class="hljs-type">DataSet</span></span>[<span class="hljs-number"><span class="hljs-number">313</span></span>:<span class="hljs-number"><span class="hljs-number">469</span></span>,] #  <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">3</span></span>     </code> </pre><br>  Now that we have everything we need, let's build this tree already! <br><br><pre> <code class="hljs haskell"><span class="hljs-type"><span class="hljs-type">DecisionTree</span></span>&lt;-rpart(<span class="hljs-type"><span class="hljs-type">Class</span></span>~<span class="hljs-type"><span class="hljs-type">RSI3</span></span>+<span class="hljs-type"><span class="hljs-type">EMAcross</span></span>+<span class="hljs-type"><span class="hljs-type">MACDsignal</span></span>+<span class="hljs-type"><span class="hljs-type">Stochastic</span></span>,<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">=</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TrainingSet</span></span></span><span class="hljs-class">, cp=.001) # ,          ,      (),    .</span></span></code> </pre><br>  Fine!  We have our first decision tree, let's see what we built. <br><br><pre> <code class="hljs bash">prp(DecisionTree,<span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=2,extra=8) <span class="hljs-comment"><span class="hljs-comment">#  ,      .</span></span></code> </pre><br><img src="//habrastorage.org/files/3d5/c4a/d95/3d5c4ad955a94550b440d44445fb7851.png"><br>  If you want to play on your own with visualization, <a href="http://www.milbo.org/rpart-plot/prp.pdf">here‚Äôs a great resource.</a> <br><br>  A small note on the interpretation of this tree: nodes represent splitting, where the left branch reflects the answer ‚Äúyes‚Äù, and the right branch answers ‚Äúno‚Äù.  The number in the final sheet is the percentage of cases that were correctly classified by this node. <br>  Decision trees can also be used to select and evaluate indicators.  The indicators, which are closer to the root (top) of the tree, give more divisions and contain more information than those at the bottom of the tree.  In our case, the Stochastic Oscillator did not even hit the tree! <br><br>  Although we have a set of rules that you can follow, you should still make sure that we have not retrained the model, so let's prune the tree.  The easiest way to do this is to look at the complexity parameter, which is ‚Äúcost,‚Äù or degraded performance.  To do this, we need to add another division and choose the size of the tree, which minimizes our cross-validation error. <br><br><pre> <code class="hljs 1c">printcp(DecisionTree) <span class="hljs-meta"><span class="hljs-meta">#  cp( ) </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword"></span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword"></span></span></span><span class="hljs-meta"> , </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword"></span></span></span><span class="hljs-meta">  plotcp(DecisionTree,upper="splits") #    </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword"></span></span></span><span class="hljs-meta">  </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword"></span></span></span><span class="hljs-meta"> </span></span></code> </pre><br><br><img src="//habrastorage.org/files/85a/96b/387/85a96b3876404a0ebb9463e710f78718.png"><br><img src="//habrastorage.org/files/dd7/cc2/1de/dd7cc21dec564ceeb4365660d617f44a.png"><br><br>  You can see that the smallest error is achieved for a tree of 7 partitions.  Thanks to the cross-validation mode, which randomly selects data to test the model, your result may differ from the one shown in the screenshot.  One of the drawbacks of the decision tree is that they may not be stable, i.e.  small changes in data can lead to big changes in the tree.  Therefore, the process of "trimming" the tree and other ways to prevent retraining are so important. <br><br>  Let's cut this tree and see what our strategy will look like. <br><br><pre> <code class="hljs objectivec">PrunedDecisionTree&lt;-prune(DecisionTree,cp=<span class="hljs-number"><span class="hljs-number">0.0272109</span></span>) <span class="hljs-meta"><span class="hljs-meta">#    (cp),       (xerror)</span></span></code> </pre><br>  Now the tree looks like this: <br><br><pre> <code class="hljs lisp">prp(<span class="hljs-name"><span class="hljs-name">PrunedDecisionTree</span></span>, type=2, extra=8)</code> </pre><br><br><img src="//habrastorage.org/files/94a/a96/397/94aa96397bcb43d38e64fc4a282748d6.png"><br><br>  So much better!  Here you can see that the MACD signal line is no longer used.  We started with 4 indicators, of which only a 3-day RSI, the difference between prices, and a 5-day EMA can be helpful in predicting price movements. <br><br>  It's time to test the model on test data. <br><br><pre> <code class="hljs lisp">table(<span class="hljs-name"><span class="hljs-name">predict</span></span>(<span class="hljs-name"><span class="hljs-name">PrunedDecisionTree</span></span>,TestSet,type=<span class="hljs-string"><span class="hljs-string">"class"</span></span>),TestSet[,<span class="hljs-number"><span class="hljs-number">5</span></span>],dnn=list('predicted','actual'))</code> </pre><br><br><img src="//habrastorage.org/files/c21/ded/fdb/c21dedfdb1064661be283371a220f957.png"><br><br>  In general, not bad, 52% accuracy.  More importantly, you have a basic strategy with well-defined, mathematical parameters.  Using only 25 teams, we were able to determine which indicators are useful and what special conditions we need to complete the transaction.  Now you can use these indicators for your own trading or to improve the tree. <br><br>  In the next article, we will look at another powerful machine learning algorithm, the support vector machine, and figure out how to use its results for an even more robust strategy. </div><p>Source: <a href="https://habr.com/ru/post/236769/">https://habr.com/ru/post/236769/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../236755/index.html">Use of libraries in projects on Unity3D</a></li>
<li><a href="../236757/index.html">Overview of the most interesting materials on data analysis and machine learning ‚Ññ13 (September 8 - 14, 2014)</a></li>
<li><a href="../236759/index.html">Analysis of lost passwords Gmail, Yandex and Mail.Ru</a></li>
<li><a href="../236761/index.html">Superiority Mask. About the magic of "Merlin" put in a word</a></li>
<li><a href="../236763/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ125 (September 8 - 14, 2014)</a></li>
<li><a href="../236771/index.html">A couple of useful commands that can be useful with DDoS and not only</a></li>
<li><a href="../236773/index.html">Sun Service</a></li>
<li><a href="../236777/index.html">A special look at the Android console: EXEQ Set 2</a></li>
<li><a href="../236779/index.html">Video demonstration of the Start menu from Windows 9</a></li>
<li><a href="../236781/index.html">Will the entrance through the social media account replace the usual login form?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>