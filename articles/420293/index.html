<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>33 dual-unit servers for 13 TB of RAM and 0.6 PT of distributed storage - why is this a minimum for proactive UBA</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Screenshot of the data collected: 



 Modern security systems are VERY gluttonous to resources. Why? Because they consider more than many production ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>33 dual-unit servers for 13 TB of RAM and 0.6 PT of distributed storage - why is this a minimum for proactive UBA</h1><div class="post__text post__text-html js-mediator-article">  Screenshot of the data collected: <br><br><img src="https://habrastorage.org/webt/qz/0m/dh/qz0mdhnxelf1znlthrk_gwa-fvs.png"><br><br>  <b>Modern security systems are VERY gluttonous to resources.</b>  Why?  Because they consider more than many production server and business intelligence systems. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      What do they think?  I'll explain now.  Let's start with the simple: conventionally, the first generation of protective devices was very simple - at the level of ‚Äúlet in‚Äù and ‚Äúnot let in‚Äù.  For example, a firewall allowed traffic according to certain rules and did not allow traffic on others.  Naturally, special computational power is not needed for this. <br><br>  The next generation has gotten more complicated rules.  Thus, reputation systems emerged that, depending on strange user actions and changes in business processes, assigned them a reliability rating based on predetermined patterns and manually set trigger thresholds. <br><br>  Now UBA systems (User Behavior Analytics) analyze the behavior of users, comparing them with other employees of the company, and evaluate the consistency and accuracy of each employee‚Äôs actions.  This is done at the expense of Data Lake-methods and quite resource-intensive, but automated processing by machine learning algorithms is primarily because it takes several thousand man-days to prescribe all possible scenarios. <br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/ul/kt/tb/ulkttbt-etdb8lagqlh5ajgixjm.png"><br><br><h3>  Classic SIEM </h3><br>  Until about 2016, the approach was considered progressive when all events from all network nodes are collected in one place where the analytics server is located.  The analytics server is able to collect, filter events and map them to correlation rules.  For example, if a massive recording of files on a workstation starts suddenly, then this may be a sign of a crypto virus, or it may not be.  But the system will be sent to the administrator just in case.  If there are several stations, the probability of malware deployment increases.  It is necessary to raise the alarm. <br><br>  If a user knocks on some strange domain, registered a couple of weeks ago, and after a couple of minutes all this color music went, then this is almost certainly a crypto virus.  It is necessary to extinguish the workstation and isolate the network segment, simultaneously notifying admins. <br><br>  SIEM compared data from DLP, firewall, antispam, and so on, and this allowed us to respond very well to various threats.  The weak point was these patterns and triggers - what is considered a dangerous situation and what is not.  Further - as in the case of viruses and various cunning DDoS - the specialists of the SOC-centers began to form their bases of attack signs.  For each type of attack, a scenario was considered, symptoms were identified, additional actions were assigned to them.  All this required continuous revision and system adjustment in 24/7 mode. <br><br><h3>  Works - do not touch, well everything works! </h3><br>  That is why you can not do without UBA?  The first problem is that it is impossible to register everything with your hands.  Because different services behave differently - and different users too.  If you register events for the average user within the company, support, accounting, the tender department and admins will be very allocated.  From the point of view of such a system, the admin is obviously a malicious user, because he creates a lot and actively climbs into it.  Support is malicious because it connects to everyone.  Accounting transmits data on encrypted tunnels.  And the tender department constantly merges outward the company data when publishing documentation. <br><br>  Conclusion - it is necessary to prescribe resource usage scenarios for each.  Then deeper.  Then even deeper.  Then something changes in the processes (and this happens every day) and you need to register again. <br><br>  It would be logical to use something like a ‚Äúmoving average‚Äù when the user rate is determined automatically.  To this we will return. <br><br>  The second problem was that the attackers have become at times more careful.  Previously, data dumping, even if you missed the moment of the hacking itself, was quite easy to catch - for example, hackers could upload the file of interest to themselves in the mail or file sharing service and, at best, encrypt to the archive to avoid detection by the DLP system. <br><br>  Now everything is more interesting.  This is what we have met in our SOC centers over the past year. <br><br><ul><li>  Steganography by sending photos to Facebook.  The malware registered with the FB and subscribed to the group.  Each photograph published in the group was supplied with a built-in data chunk containing instructions for the malware.  Taking into account losses during JPEG compression, it was possible to transfer about 100 bytes per image.  Also, the malware itself spread out 2-3 photos per day to the social network, which was enough to transfer logins / passwords merged through mimikatz. </li><li>  Filling out forms on sites.  The malware launched the user's actions simulator, went to certain sites, found feedback forms there and sent data through them, encoding binary data in BASE64.  This we have already caught on the system of the new generation.  On the classic SIEM, without knowing about this method of sending, most likely, they would not even notice anything. </li><li>  In a standard way, alas, in a standard way, data was mixed into the DNS traffic.  There are quite a lot of steganography technologies in DNS and in general tunnel building through DNS; here the emphasis was not on the polling of specific domains, but on the types of query.  The system raised a minor alarm on the growth of DNS traffic for the user.  Data was sent slowly and at different intervals to make analysis more difficult with remedies. </li></ul><br>  For penetration, usually strictly custom virus is used, made directly under the users of the target company.  And the attacks often go through an intermediate link.  For example, at first the contractor is compromised, and then through it the malware is entered into the main company. <br><br>  Viruses of the last years almost always sit strictly in the RAM and are deleted at the very first shukher - an emphasis on the absence of traces.  Forensic in such conditions is very difficult. <br><br>  The overall result is that SIEM does not do well.  A lot that goes out of sight.  Approximately an empty space appeared on the market: so that the system should not be tuned to the type of attack, and she herself understood what was wrong. <br><br><h3>  How did she ‚Äúunderstand‚Äù herself? </h3><br>  The first reputational security systems were anti-fraud modules for protection against money laundering in banks.  For a bank, the main thing is to identify all fraudulent transactions.  That is, it is not a pity to go too far, the main thing is that the human operator understands what you need to look at first.  And he was not overloaded with very minor alarms. <br><br>  Systems work like this: <br><br><ol><li>  They build a user profile using a variety of parameters.  For example, how he usually spends money: what he buys, how he buys, how quickly he enters a confirmation code, from which devices he does it, etc. </li><li>  The logic layer checks whether it is possible to have time to get from the point where payment was made to another point on the transport during the period between transactions.  If the purchase is in another city, it is checked whether the user often goes to other cities, if in another country - if the user often happens in other countries, and a recently purchased air ticket adds chances that the alarm is not needed. </li><li>  Reputation module - if the user does everything within his normal behavior, then positive points are awarded for his actions (very slowly), and if within the atypical - negative ones. </li></ol><br>  About the last talk in more detail. <br><br>  <b>Example 1.</b> All your life you bought yourself a pie and a cola at McDonalds on Fridays, and then suddenly bought 500 rubles on Tuesday morning.  Minus 2 points for non-standard time, minus 3 points for non-standard purchase.  The alarm threshold for you is set to ‚Äì20.  Nothing happens. <br><br>  For about 5-6 such purchases you will bring these points to zero, because the system will remember that it is normal for you to go to McDonalds on Tuesday morning.  Of course, I greatly simplify, but the logic of the work is approximately the same. <br><br>  <b>Example 2.</b> All your life you bought yourself various small things as a regular user.  Pay at the grocery store (the system already ‚Äúknows‚Äù how much you usually eat and where you buy it most often - or rather, it does not know, but simply writes it in a profile), then buy a ticket in the metro for a month, then order something small through the online store.  And here you are buying a piano in Hong Kong for 8 thousand dollars.  Could it?  Could.  Let's look at the points: ‚Äì15 for what it looks like a standard fraud, ‚Äì10 for a non-standard amount, ‚Äì5 for a non-standard place and time, ‚Äì5 for another country without buying a ticket, ‚Äì7 for not having anything before They took abroad, +5 for their standard device, +5 for what other users of the bank bought there. <br><br>  The alarm threshold for you is set to ‚Äì20.  The transaction is ‚Äúsuspended‚Äù, an employee of the Bank‚Äôs IB starts to understand the situation.  This is a very simple case.  Most likely, in about 5 minutes he will call you and say: ‚ÄúHave you really decided to buy something at a music store in Hong Kong for 8 thousand dollars at 4 am?‚Äù If you answer yes, you will miss the transaction.  The data will form in the profile as once the committed action, further for similar actions will be given less negative points, until they become the norm at all. <br><br>  As I said, I am very, very simple.  Banks have been investing in reputation systems for years and have been honing them for years.  Otherwise, a bunch of mules would withdraw money really quickly. <br><br><h3>  How is this shifted to the IS of the enterprise? </h3><br>  On the basis of the antifraud and anti-money laundering algorithms, behavioral analysis systems appear.  A complete user profile is collected: how quickly it prints, which resources it accesses, with whom it interacts, which software it launches - in general, everything that a user does every day. <br><br>  <b>Example.</b>  The user often interacts with 1C and often enters data there, and then suddenly begins to unload the entire database in dozens of small reports.  His behavior goes beyond the standard behavior for such a user, but it can be compared with the behavior of similar profiles by type (most likely, they will be other accountants) - it shows that they have a week of reports on certain dates and they do it.  The numbers are the same, there are no other differences, the alarm does not rise. <br><br>  <b>Another example.</b>  The user worked all his life with the file ball, writing a couple of dozen documents a day, and then suddenly began to take hundreds and thousands of files from it.  And the DLP says it sends something important out.  Maybe the tender department began preparing for the competition, maybe the "rat" merges the data to competitors.  The system, of course, does not know this, but simply describes its behavior and alerts the security personnel.  In principle, the behavior of a new employee, technical support or general director, may differ little from the behavior of a ‚Äúmisguided Cossack‚Äù, and the task of the security men is to tell the system that this is normal behavior.  The profile will follow anyway, and if the CEO‚Äôs account is compromised and the reputation jumps by the points down, the alarm will rise. <br><br>  User profiles generate rules for a UBA system.  More precisely, thousands of heuristics that change regularly.  For each group of users has its own principles.  For example, users of this type send 100 MB per day, users of another type - 1 GB per day, if this is not a weekend.  And so on.  If the first one sends 5 GB, it is suspicious.  And if the second - then there will be negative points, but they do not break the threshold of anxiety.  But if next to him he turned on the DNS to suspicious new domains, then there will be a couple of negative points and the alarm will happen. <br><br>  The approach is that this is not a rule ‚Äúif there were strange DNS queries and then traffic jumped, then ...‚Äù, and the rule ‚Äúif the reputation reached ‚Äì20, then ...‚Äù - each individual source of points for the user's reputation or process is independent and is determined solely the norm of his behavior.  Automatically. <br><br>  At the same time, at first, the IB department helps to train the system and determine what is the norm and what is not, and then the system adapts, learns itself on real traffic and user activity logs. <br><br><h3>  What we put </h3><br>  As a system integrator, we provide our customers with the service of operational information security management (managed by <a href="http://service.croc.ru/soc/">CROC SOC</a> ).  A key component, along with such systems as Asset Management, Vulnerability Management, Security Testing and Threat Intelligence, available from our cloud infrastructure, is a link between the classic SIEM and proactive UBA.  At the same time, depending on the wishes of the customer, for UBA we can use both industrial solutions of large vendors and our own analytical system based on the Hadoop + Hive + Redis + Splunk Analytics for Hadoop (Hunk) bundle. <br><br>  The following solutions are available for behavioral analysis from our cloud CROC SOC or on the premise model: <br><br><ul><li>  Exabeam: perhaps the most user-friendly UBA system in use, which allows you to quickly investigate an incident using User Tracking technology, which connects activity in the IT infrastructure (for example, local login to the database under the SA account) with a real user.  It includes about 400 risk-scoring models that add penalties to the user for each strange or suspicious action; </li><li>  Securonix: a very voracious to the resources, but extremely effective system of behavioral analysis.  The system is placed on top of the Big Data platform, out of the box almost 1000 models are available.  Most of them use proprietary user activity clustering technology.  The engine is very flexible, you can track and cluster any field of the CEF format, starting with a deviation from the average number of requests per day in the web server logs and ending with the identification of new network interactions on user traffic; </li><li>  Splunk UBA: A Good Addition To Splunk ES.  The base of rules out of the box is small, but linked to the Kill Chain, which allows you not to be distracted by minor incidents and focus your attention on the real hacker.  And of course, at our disposal all the power of statistical data processing on the Splunk Machine Learning Toolkit and a retrospective analysis of the entire volume of accumulated data. </li></ul><br>  And for critical segments, whether it is a process control system or a key business butt, we place additional sensors to collect extended forensics and hanitopes to divert the hacker's attention from productive systems. <br><br><h3>  Why a sea of ‚Äã‚Äãresources? </h3><br>  Because all events are written.  It's like Google Analytics, only on the local AWP.  In the local network, events are sent to Data Lake, everything, via Internet metadata about statistics and key events, but if the SOC operator wants to investigate the incident, there is also a complete log.  Everything is going to: temporary files, registry keys, all running processes and their checksums, what is written in autoload, actions, screencast - anything.  Below is an example of the data collected. <br><br>  The list of parameters from the workstation: <br><br><img src="https://habrastorage.org/webt/9c/0u/kw/9c0ukwhlg08dcmzalotrbbogyzg.png"><br><br><img src="https://habrastorage.org/webt/mu/hk/0p/muhk0pdnbfns29cahdpn6k3h3wu.png"><br><br><img src="https://habrastorage.org/webt/ao/js/mw/aojsmwbp6g_l0a16j6q4kmmfqca.png"><br><br>  Systems in terms of storage and RAM are becoming much more complicated.  Classic SIEM starts with 64 GB of RAM, a pair of processors and storage per half a byte.  UBA is from terabyte of RAM and higher.  For example, our last deployment was on 33 physical servers (28 computational nodes for data processing + 5 control nodes for load distribution), 150 TB lakes (600 TB in hardware, including fast cache on instances) and 384 GB of RAM each. <br><br><h3>  Who needs it? </h3><br>  First of all, those who are in the ‚Äúrisk zone‚Äù and are constantly exposed to attacks are banks, financial institutions, the oil and gas sector, large retail and many others. <br><br>  For such companies, the cost of leakage or data loss can amount to tens or even hundreds of millions of dollars.  But installing a UBA system will be much cheaper.  And of course, state-owned companies and telecom, because no one wants to at some point the data of millions of patients or the correspondence of tens of millions of people float away into open access. <br><br><h3>  Links </h3><br><ul><li>  <a href="https://habr.com/company/croc/blog/353324/">SOC Centers</a> </li><li>  <a href="https://habr.com/company/croc/blog/352044/">A big company that has not been engaged in information security for 5 years and survived</a> </li><li>  <a href="https://www.anti-malware.ru/analytics/Market_Analysis/user-and-entity-behavioral-analytics-ubaueba">Proprietary UBA Systems Website</a> </li><li>  My mail for questions is dberezin@croc.ru </li></ul></div><p>Source: <a href="https://habr.com/ru/post/420293/">https://habr.com/ru/post/420293/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../420281/index.html">6. Check Point for maximum. Ips. Part 2</a></li>
<li><a href="../420283/index.html">Digest news from the world of PostgreSQL. Issue number 9</a></li>
<li><a href="../420285/index.html">MPRU, revenue and how it relates to revenue and customer base dynamics</a></li>
<li><a href="../420289/index.html">How we fit the tables in the screen of the smartphone and unified in the framework of the design system</a></li>
<li><a href="../420291/index.html">Specter and Meltdown are no longer the most dangerous attacks on Intel's CPUs. Researchers Report Foreshadow Vulnerability</a></li>
<li><a href="../420295/index.html">NeoQUEST-2018: the long-awaited Cold Boot, science research and guests from Nizhny Novgorod</a></li>
<li><a href="../420297/index.html">Step-by-step instructions for restoring access to a Linux Amazon EC2 instance when you lose a pem file</a></li>
<li><a href="../420299/index.html">My favorite examples of functional programming in the Kotlin language</a></li>
<li><a href="../420301/index.html">Indian Prime Minister Narendra Modi: we will send the flag of the country into space aboard the Gaganyana in 2022</a></li>
<li><a href="../420303/index.html">Load distribution when parsing websites and connecting additional cloud resources</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>