<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Installing and configuring GitLab + Redmine collaboration on Debian 8 jessie + Nginx - Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 It so happened that there was a shortage of the usual GitHub or GitBucket for the project. The main reason for storing and controlling ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Installing and configuring GitLab + Redmine collaboration on Debian 8 jessie + Nginx - Part 1</h1><div class="post__text post__text-html js-mediator-article"><h2>  Introduction </h2><br>  It so happened that there was a shortage of the usual GitHub or GitBucket for the project.  The main reason for storing and controlling versions of large binaries of psd, 3dsmax and others.  In fact, there are lots of solutions, for example, you could use the Cloud Disk or the git Large Files System, presented by GitHub.  But after weighing all the pros and cons of different approaches to the organization, we came to a bunch of GitLab + redmine. <br><br>  I do not think that it makes sense to describe the products, I will only bring the main advantages that prompted us to make this choice. <br>  The main advantages of GitLab: <br><br><ul><li>  Own repository. </li><li>  Tweaking rights. </li><li>  Git lfs support is almost out of the box. </li></ul><br>  Also both open source projects. <br><a name="habracut"></a><br><h2>  Workspace preparation </h2><br>  I decided not to omit all the little things, so that even the user level ‚ÄúThe first time I see the Linux console‚Äù could pick up a bunch of Redmine + GitLab. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Let's start with the preparation of the workspace, namely, installing sudo, since using the system as the root user is not good.  Also, when installing from root, there were some problems with GitLab: <br><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  nano,      . apt-get install nano sudo -y</span></span></code> </pre> <br>  Configure sudo by adding your user: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ,       &lt;username&gt; #      root.       . nano /etc/sudoers #   sudo su &lt;username&gt;</span></span></code> </pre><br><h2>  Install Redmine </h2><br>  We will use Nginx, Thin and MySQL.  If for religious reasons you need PostgreSQL, read the notes after the code, I will indicate where to change the settings.  Also, instead of Thin, you can use Unicorn, but we will omit its installation in this article. <br><br>  Installation is as follows: <br><br><h3>  Installing Nginx on the role of an external web server </h3><br><pre> <code class="bash hljs">sudo apt-get update sudo apt-get install nginx -y</code> </pre><br><h3>  Database installation </h3><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   MySql apt-get install mysql-server mysql-client libmysqlclient-dev #   PostgreSQL apt-get install postgresql</span></span></code> </pre><br>  When installing MySql can request a super user password.  Come up and write it down.  Now we need to create a database and user day of it. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#    MySql mysql -uroot -p CREATE DATABASE redmine CHARACTER SET utf8; CREATE USER 'redmine'@'localhost' IDENTIFIED BY 'password'; GRANT ALL PRIVILEGES ON redmine.* TO 'redmine'@'localhost'; exit #    PostgreSQL su postgres psql CREATE ROLE redmine LOGIN ENCRYPTED PASSWORD 'password' NOINHERIT VALID UNTIL 'infinity'; CREATE DATABASE redmine WITH ENCODING='UTF8' OWNER=redmine TEMPLATE template0; \q exit</span></span></code> </pre><br><h3>  Installing Redmine itself </h3><br>  We will need headlines for compilation. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># : libmagickcore-dev libmagickwand-dev     .      . apt-get install libmagickcore-dev libmagickwand-dev imagemagick build-essential</span></span></code> </pre><br>  Now we are ready to download the fresh redmine.  At the time of this writing, this is <a href="http://www.redmine.org/projects/redmine/wiki/Download">3.2.0</a> .  Download and put in the working directory. <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /tmp mkdir redmine <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> redmine wget http://www.redmine.org/releases/redmine-3.2.0.tar.gz tar -zxvf ./redmine-3.2.0.tar.gz mv ./redmine-3.2.0 /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/share/redmine</code> </pre><br>  Redmine is written in Ruby and requires it.  Install. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   . apt-get install ruby ruby-dev rubygems libruby #   bundler    apt-get   ruby gem install bundler</span></span></code> </pre><br>  Add thin. <br><br><pre> <code class="bash hljs">nano /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/share/redmine/Gemfile <span class="hljs-comment"><span class="hljs-comment">#  gem "thin"</span></span></code> </pre><br>  Install all the necessary gems for redmine: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/share/redmine <span class="hljs-comment"><span class="hljs-comment">#:    PostgreSQL   --without PostgreSQL  --without mysql bundle install --without development test postgresql sqlite</span></span></code> </pre><br>  It remains to configure. <br><br><pre> <code class="bash hljs">cp config/database.yml.example config/database.yml mv public/dispatch.fcgi.example public/dispatch.fcgi nano config/database.yml</code> </pre><br>  We change production approximately to such type. <br><br>  <i>NOTE: If you install PostgreSQL, follow the example at the bottom of the database.yml file.</i>  <i>It is also more accurate with tabulation because * .yml is a rather specific format.</i> <br><br><pre> <code class="bash hljs">production: adapter: mysql2 database: redmine host: localhost username: redmine password: <span class="hljs-string"><span class="hljs-string">"&lt;password_Mysql_redmine_user&gt;"</span></span> encoding: utf8</code> </pre><br>  Create a secret key: <br><br><pre> <code class="bash hljs">rake generate_secret_token</code> </pre><br>  Errors should not be.  But if he suddenly asks for mysql2 or another PostgreSQL gem, just install them: <br><pre> <code class="bash hljs">gem install mysql2 <span class="hljs-comment"><span class="hljs-comment">#       rake generate_secret_token</span></span></code> </pre><br>  The database is populated with 2 teams.  After 2 will be asked to choose a language. <br><br><pre> <code class="bash hljs">RAILS_ENV=production rake db:migrate RAILS_ENV=production rake redmine:load_default_data <span class="hljs-comment"><span class="hljs-comment">#        : rake db:encrypt RAILS_ENV=production</span></span></code> </pre><br><br>  So.  Redmine is fully configured and let's check it out.  For this there is a WebRic: <br><br><pre> <code class="bash hljs">ruby script/rails server webrick -e production</code> </pre><br>  If you saw INFO WEBrick :: HTTPServer # start: pid = 27676 port = 3000 then you can check in the <a href="http://hostname/">hostname</a> : 3000 browser everything should work fine. <br><br>  Then press Ctrl + C. <br><br><h3>  Thin setting </h3><br>  In order for nginx to understand ruby, we need thin: <br><br><pre> <code class="bash hljs">thin install <span class="hljs-comment"><span class="hljs-comment">#     adduser redmine chown -hR redmine:redmine /usr/local/share/redmine</span></span></code> </pre><br>  It remains to configure the thin: <br><br>  nano /etc/thin/redmine.yml <br><br><pre> <code class="bash hljs">pid: tmp/pids/thin.pid group: redmine <span class="hljs-built_in"><span class="hljs-built_in">wait</span></span>: 30 timeout: 30 <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/thin.log max_conns: 1024 require: [] environment: production max_persistent_conns: 512 servers: 1 daemonize: <span class="hljs-literal"><span class="hljs-literal">true</span></span> user: redmine socket: /tmp/thin.sock <span class="hljs-built_in"><span class="hljs-built_in">chdir</span></span>: /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/share/redmine</code> </pre><br>  Run thin: <br><br><pre> <code class="bash hljs">/etc/init.d/thin start <span class="hljs-comment"><span class="hljs-comment">#   nano /usr/local/share/redmine/logs/thin.0.log</span></span></code> </pre><br><h3>  Nginx setup </h3><br>  Create a host: <br><br><pre> <code class="bash hljs">nano /etc/nginx/sites-available/redmine.hostname.ru</code> </pre><br>  Copy the settings into the file and change it for you: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  upstream    ""  thin upstream thin_server { server unix:/tmp/thin.0.sock; } # -    server { #  server_name redmine.hostname.ru #  HTTPS(SSL) listen *:80; # access_log /var/log/nginx/redmine.mihanentalpo.me-access.log; error_log /var/log/nginx/redmine.mihanentalpo.me-error.log; # public  root /usr/local/share/redmine/public; #  location.      " ",   #     -,    thin location / { proxy_redirect off; proxy_set_header Host redmine.mihanentalpo.me; try_files $uri/index.html $uri.html $uri @thin; } #  Location  ,     location @thin { proxy_pass http://thin_server; } }</span></span></code> </pre><br>  Then we turn on the site and restart nginx: <br><br><pre> <code class="bash hljs">ln -s /etc/nginx/sites-available/redmine.hostname.ru /etc/nginx/sites-enabled/redmine.hostname.ru /etc/init.d/nginx restart</code> </pre><br>  This completes the installation of Redmine.  And he will be available at redmine.hostname.ru.  To work, he lacks interesting plug-ins and the most important permission to write.  Run: <br><br><pre> <code class="bash hljs">chmod -R 0777 /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/share/redmine/tmp chmod -R 0777 /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/share/redmine/files</code> </pre><br>  The administrator has the default username admin and password admin. <br><br>  In the next article we will look at installing and configuring GitLab.  Perhaps there will be a ldap setting. <br><br>  PS: The first article, waiting for constructive criticism.  Maybe he was too meticulous and for such a large project as Habr, where IT sniki gathered, it was not necessary to sort out all the details in such detail.  I just wanted that anyone could configure Redmine + GitLab on his VPS VDS server. </div><p>Source: <a href="https://habr.com/ru/post/278843/">https://habr.com/ru/post/278843/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../278833/index.html">Aspects of localization. Major developer errors</a></li>
<li><a href="../278835/index.html">As web design rolls straight to hell</a></li>
<li><a href="../278837/index.html">Game Gomoku (tic-tac-toe, 5 in a row)</a></li>
<li><a href="../278839/index.html">Gigabit Wi-Fi in Russia</a></li>
<li><a href="../278841/index.html">Database Testing Developer Version</a></li>
<li><a href="../278845/index.html">Alljoyn: embedded view of the developer. Part 2: Linux to help us</a></li>
<li><a href="../278847/index.html">How can you simplify your life using Telegram-bot</a></li>
<li><a href="../278849/index.html">How Cloud@mail.ru saved all * my files and what came of it</a></li>
<li><a href="../278853/index.html">Obstacle Chase</a></li>
<li><a href="../278855/index.html">Do not miss the details about the new SQL Server 2016 and Linux support, see the online event on March 10 at 18:00 (MCK)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>