<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automatic calculation of computable properties of view models in .NET</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Motivation on the example of presentation models for WPF UI 
 Begin the discussion and get acquainted with the issues discussed are offered on the exa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automatic calculation of computable properties of view models in .NET</h1><div class="post__text post__text-html js-mediator-article"><h2>  Motivation on the example of presentation models for WPF UI </h2><br>  Begin the discussion and get acquainted with the issues discussed are offered on the example of the approach to the architecture of user interfaces in WPF. <br><br>  As you know, one of the main features of WPF is a powerful system of banding, which makes it quite easy to separate the presentation model (hereinafter the <i>model</i> ) from the presentation itself (hereinafter <i>referred to</i> as the <i>View</i> ) as such.  Usually the programmer creates XAML for the view, binds the properties of its elements to the model in the same XAML by means of buydings and, in fact, forgets about View.  This becomes possible since most UI-logic can be implemented through the impact on the model and automatically prokirato on UI by buyding.  With this approach, the model plays the role of the View state, being its proxy for the layer that implements the UI logic.  For example, changing the property of a model, we thereby change the corresponding View property (or its elements).  The latter occurs automatically thanks to the bayding system, which tracks changes both in the model and in the View, synchronizing states at both ends as needed.  One of the ways in which a model can inform an observer (which, in our case, is binding) about its change, is to throw the <i>PropertyChanged</i> event with the name of the changed property as a parameter.  This event belongs to the <a href="http://msdn.microsoft.com/en-us/library/system.componentmodel.inotifypropertychanged(v%3Dvs.110).aspx">INotifyPropertyChanged</a> interface, which, accordingly, must be implemented in the model. <br><br>  Consider the idea described by a specific example.  Let's start with a simple model, which is a kind of <i>order</i> and contains two properties - <i>Price</i> and <i>Quantity</i> .  Both properties will be changeable, so for each you need to implement a change notification.  This is done by the following code: <br><a name="habracut"></a><br><pre><code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Order</span></span> : <span class="hljs-title"><span class="hljs-title">INotifyPropertyChanged</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">decimal</span></span> _price; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _quantity; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">decimal</span></span> Price { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _price; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> == _price) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; _price = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; OnPropertyChanged(); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Quantity { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _quantity; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> == _quantity) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; _quantity = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; OnPropertyChanged(); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> PropertyChangedEventHandler PropertyChanged; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnPropertyChanged</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[CallerMemberName] </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> propertyName = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> handler = PropertyChanged; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (handler != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) handler(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PropertyChangedEventArgs(propertyName)); } }</code> </pre> <br>  Now let's imagine that we have a View representing the order instance in the form of two TextBlocks that are tied to <i>Price</i> and <i>Quantity</i> : 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Price, StringFormat='Price: {0}'}"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Quantity, StringFormat='Quantity: {0}'}"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  If our UI logic changes any of the model properties, the corresponding binding will be notified of the change and change the text in the associated TextBlock.  So far everything is extremely simple. <br><br>  But now let's add the <i>Cost</i> property calculated to the model using the obvious formula: <br><br><pre> <code class="hljs pgsql"> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Cost</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _price * _quantity; } }</code> </pre><br>  And also corresponding to this TextBlock property: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Cost, StringFormat='Cost: {0}'}"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  Probably, the one who only gets acquainted with WPF has the right to expect that when the <i>Price</i> or <i>Number</i> changes, the TextBlock representing <i>Cost</i> will change its text too.  Naturally, this will not happen, since the <i>PropertyChanged</i> event for the <i>Cost</i> property has not been thrown.  Thus, we come to the problem of implementing updates on computable properties (properties whose value depends on the values ‚Äã‚Äãof other properties). <br><br><h2>  Possible solutions </h2><br>  In the case of the considered example, the solution is obviously quite simple.  You need to throw <i>PropertyChanged</i> for <i>Cost</i> from <i>Price</i> and <i>Quantity</i> setters or change the <i>Cost</i> property from these setters (thereby raising the desired event from <i>Cost</i> ).  Below is the code for both options: <br><br><pre> <code class="hljs pgsql">//<span class="hljs-keyword"><span class="hljs-keyword">Raise</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Cost</span></span> PropertyChanged <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-keyword"><span class="hljs-keyword">both</span></span> Price <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> Quantity setters. <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Order</span></span> : INotifyPropertyChanged { private <span class="hljs-type"><span class="hljs-type">decimal</span></span> _price; private <span class="hljs-type"><span class="hljs-type">int</span></span> _quantity; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">decimal</span></span> Price { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _price; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> == _price) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; _price = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; OnPropertyChanged(); OnPropertyChanged("Cost"); } } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span> Quantity { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _quantity; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> == _quantity) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; _quantity = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; OnPropertyChanged(); OnPropertyChanged("Cost"); } } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Cost</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _price * _quantity; } } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> event PropertyChangedEventHandler PropertyChanged; protected virtual <span class="hljs-type"><span class="hljs-type">void</span></span> OnPropertyChanged([CallerMemberName] string propertyName = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { var <span class="hljs-keyword"><span class="hljs-keyword">handler</span></span> = PropertyChanged; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">handler</span></span> != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">handler</span></span>(this, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> PropertyChangedEventArgs(propertyName)); } }</code> </pre><br><pre> <code class="hljs pgsql">//<span class="hljs-keyword"><span class="hljs-keyword">Update</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Cost</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-keyword"><span class="hljs-keyword">both</span></span> Price <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> Quantity setters. <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Order</span></span> : INotifyPropertyChanged { private <span class="hljs-type"><span class="hljs-type">decimal</span></span> _price; private <span class="hljs-type"><span class="hljs-type">int</span></span> _quantity; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">decimal</span></span> Price { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _price; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> == _price) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; _price = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; OnPropertyChanged(); <span class="hljs-keyword"><span class="hljs-keyword">Cost</span></span> = _price * _quantity; } } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span> Quantity { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _quantity; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> == _quantity) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; _quantity = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; OnPropertyChanged(); <span class="hljs-keyword"><span class="hljs-keyword">Cost</span></span> = _price * _quantity; } } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Cost</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _cost; } private <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> == _cost) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; _cost = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; OnPropertyChanged(); } } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> event PropertyChangedEventHandler PropertyChanged; protected virtual <span class="hljs-type"><span class="hljs-type">void</span></span> OnPropertyChanged([CallerMemberName] string propertyName = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { var <span class="hljs-keyword"><span class="hljs-keyword">handler</span></span> = PropertyChanged; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">handler</span></span> != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">handler</span></span>(this, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> PropertyChangedEventArgs(propertyName)); } }</code> </pre><br>  In fact, both solutions are not very good from several sides at once. <br><br>  <i>From an architectural point of view,</i> we act badly because we invert the logical direction of the dependence of <i>Cost</i> on <i>Price</i> and <i>Quantity</i> .  Now it is not <i>Cost that</i> ‚Äúknows‚Äù about <i>Price</i> and <i>Quantity</i> , but, on the contrary, <i>Price</i> and <i>Quantity</i> begin to ‚Äúknow‚Äù about <i>Cost</i> , becoming responsible for its change.  This in turn violates the <a href="https://en.wikipedia.org/wiki/Single_responsibility_principle">SRP</a> at the micro level, since the initially independent (and simple to implement) properties are now forced to have knowledge of the existence of other properties and their implementation details in order to be able to update these properties at the right moments. <br><br>  <i>From a technical point of view,</i> not everything is good, because there can be quite complex links between properties, which can be manually maintained (rather laboriously) (and very difficult).  Examples of such links are: <br><br><ul><li>  dependencies on properties that are themselves dependent; </li><li>  depending on the properties of nested objects (property chains), as in the case of <i>DiscountSum = Order.Sum * Order.Discount.Percent / 100</i> ; </li><li>  depending on the properties of the elements of the collection ( <i>TotalQuantity = Orders.Sum (o =&gt; o.Quantity</i> )). </li></ul><br>  For example, to support the last described dependency, the programmer must write a large amount of routine code (the situation will become even more complicated if there is more than one collection in the dependency chain but several collections at once): <br><br><ol><li>  Subscribe to <a href="https://msdn.microsoft.com/en-us/library/ms668604(v%3Dvs.110).aspx">ObservableCollection</a> changes (via the <a href="https://msdn.microsoft.com/en-us/library/system.collections.specialized.inotifycollectionchanged(v%3Dvs.110).aspx">INotifyCollectionChanged</a> interface) representing <i>Orders</i> . </li><li>  Subscribe to the <i>PropertyChanged of</i> each item in the collection ( <i>order</i> ) to track changes in its <i>Quantity</i> property. </li><li>  Maintain relevant subscriptions up to date: unsubscribe from the elements removed from the collection and subscribe to the added ones, unsubscribe when the collection of the collection itself changes from the old collection and subscribe to the events of the new one. </li></ol><br>  To simplify this work, as well as to enable declarative presentation of dependencies, the <i>Dependencies Tracker</i> was created <i>(DependenciesTracker)</i> , which will be discussed below. <br><br><h2>  Dependencies Tracker (DependenciesTracker) </h2><br>  The .NET library <i>DependenciesTracking</i> implements automatic updating of computable properties and the ability to set dependencies in a declarative style.  It is rather lightweight from the point of view of ease of use and from the point of view of implementation: its work requires neither creating any wrappers over properties (such as <i>ObservableProperty &lt;T&gt;</i> , <i>IndependentProperty &lt;T&gt;</i> , etc.), nor inheritance models from any base class, nor the need to label properties with any attributes.  The implementation does not significantly use reflection and is not based on rewriting assemblies after compilation.  The main component of the assembly is the class <i>DependenciesTracker</i> , the use of which will be further discussed in detail. <br><br>  In general, in order for tracking of dependent properties to start working, you need to do 2 simple things: <br><br><ol><li>  determine dependencies of properties (for a class as a whole), </li><li>  start tracking these dependencies (for a specific instance, usually in the constructor). </li></ol><br>  These points are discussed below with various examples. <br><br><h3>  Simple (single-level) dependencies </h3><br>  Let's start with the example that was described at the beginning of the article.  We rewrite the <i>Order</i> class so that the <i>Cost</i> dependency of <i>Price</i> and <i>Quantity is</i> automatically tracked and entails a <i>Cost</i> recalculation when the <i>Price</i> or <i>Quantity is</i> changed.  In accordance with PP.1-2 for this you need to implement the <i>Order</i> class as follows: <br><br><pre> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Order</span></span> : INotifyPropertyChanged { private <span class="hljs-type"><span class="hljs-type">decimal</span></span> _price; private <span class="hljs-type"><span class="hljs-type">int</span></span> _quantity; private <span class="hljs-type"><span class="hljs-type">decimal</span></span> _cost; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">decimal</span></span> Price { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _price; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> == _price) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; _price = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; OnPropertyChanged(); } } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span> Quantity { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _quantity; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> == _quantity) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; _quantity = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; OnPropertyChanged(); } } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">decimal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Cost</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _cost; } private <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> == _cost) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; _cost = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; OnPropertyChanged(); } } //  " ",       private static readonly IDependenciesMap&lt;<span class="hljs-keyword"><span class="hljs-keyword">Order</span></span>&gt; _dependenciesMap = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> DependenciesMap&lt;<span class="hljs-keyword"><span class="hljs-keyword">Order</span></span>&gt;(); static <span class="hljs-keyword"><span class="hljs-keyword">Order</span></span>() { //      _dependenciesMap.AddDependency(o =&gt; o.<span class="hljs-keyword"><span class="hljs-keyword">Cost</span></span>, o =&gt; o.Price * o.Quantity, o =&gt; o.Price, o =&gt; o.Quantity) } private IDisposable _tracker; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Order</span></span>() { //       _dependenciesMap.StartTracking(this); } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> event PropertyChangedEventHandler PropertyChanged; protected <span class="hljs-type"><span class="hljs-type">void</span></span> OnPropertyChanged([CallerMemberName] string propertyName = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { var <span class="hljs-keyword"><span class="hljs-keyword">handler</span></span> = PropertyChanged; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">handler</span></span> != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">handler</span></span>(this, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> PropertyChangedEventArgs(propertyName)); }</code> </pre><br>  The example shows that we use <i>IDependenciesMap</i> to determine dependencies and start tracking them.  We will analyze this interface in more detail. <br><br><pre> <code class="hljs django"><span class="xml"><span class="xml">public interface IDependenciesMap</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">T</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> { IDependenciesMap</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">T</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> AddDependency</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">U</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">(Expression</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Func</span></span></span></span><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">T</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">U</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">&gt; dependentProperty, Func</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">T,</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">U</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> calculator, Expression</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Func</span></span></span></span><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">T</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">object</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">&gt; obligatoryDependencyPath, params Expression</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Func</span></span></span></span><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">T</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">object</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">&gt;[] dependencyPaths); IDependenciesMap</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">T</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> AddDependency</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">U</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">(Action</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">T,</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">U</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> setter, Func</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">T,</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">U</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> calculator, Expression</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Func</span></span></span></span><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">T</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">object</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">&gt; obligatoryDependencyPath, params Expression</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Func</span></span></span></span><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">T</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">object</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">&gt;[] dependencyPaths); IDisposable StartTracking(T trackedObject); }</span></span></code> </pre><br>  In the example, to add dependencies, we used the first version of the overloaded <i>AddDependency</i> method.  It has the following parameters: <br><br><ol><li>  <i>dependentProperty</i> - expression (Expression), describing the dependent property ( <i>o =&gt; o.Cost</i> ), </li><li>  <i>calculator</i> is a method that calculates the value of a dependent property on a specific model instance ( <i>o =&gt; o.Price * o.Quantity</i> ), </li><li>  <i>ObligatoryDependencyPath</i> and <i>dependencyPaths</i> - Expression'y, which describe the ways on which the property depends ( <i>o =&gt; o.Price, o =&gt; o.Quantity</i> ). </li></ol><br>  The second version of <i>AddDependency takes the</i> first parameter to the setter of the dependent property ( <i>(o, val) =&gt; o.Cost = val</i> ), instead of the Expression that describes it (and which ultimately compiles to the same setter).  The rest of the methods are similar. <br><br>  In the second step, we added the <i>StartTracking</i> call to the constructor.  This means that tracking changes in properties in dependency paths will begin immediately when an order object is created.  In the <i>StartTracking</i> method, the following actions are performed: <br><br><ol><li>  necessary subscriptions are made for changes to properties in dependency paths, </li><li>  there is an initial calculation and setting of values ‚Äã‚Äãof computable properties. </li></ol><br>  The method returns <a href="https://msdn.microsoft.com/en-us/library/system.idisposable">IDisposable</a> , which can be used to stop tracking changes at any stage of the model's life cycle. <br><br><h3>  Dependencies on property chains </h3><br>  Now let's complicate the example.  To do this, move the <i>Price</i> and <i>Quantity</i> to a separate <i>OrderProperties</i> object: <br><br><pre> <code class="hljs cs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">OrderProperties</span></span> : <span class="hljs-title"><span class="hljs-title">INotifyPropertyChanged</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _price; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _quantity; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Price { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _price; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_price != <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { _price = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; OnPropertyChanged(<span class="hljs-string"><span class="hljs-string">"Price"</span></span>); } } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Quantity { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _quantity; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_quantity != <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { _quantity = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; OnPropertyChanged(<span class="hljs-string"><span class="hljs-string">"Quantity"</span></span>); } } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> PropertyChangedEventHandler PropertyChanged; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnPropertyChanged</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> propertyName</span></span></span><span class="hljs-function">)</span></span> { PropertyChangedEventHandler handler = PropertyChanged; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (handler != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) handler(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PropertyChangedEventArgs(propertyName)); } }</code> </pre><br>  And we put the <i>OrderProperties</i> object inside the <i>Order</i> , making, respectively, the <i>Cost</i> property dependent on <i>OrderProperties.Price</i> and <i>OrderProperties.Quantity</i> : <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Order</span></span> : <span class="hljs-title"><span class="hljs-title">INotifyPropertyChanged</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> OrderProperties _properties; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _cost; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> OrderProperties Properties { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _properties; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_properties != <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { _properties = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; OnPropertyChanged(<span class="hljs-string"><span class="hljs-string">"Properties"</span></span>); } } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Cost { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _cost; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_cost != <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { _cost = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; OnPropertyChanged(<span class="hljs-string"><span class="hljs-string">"Cost"</span></span>); } } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IDependenciesMap&lt;Order&gt; _map = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DependenciesMap&lt;Order&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Order</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _map.AddDependency(o =&gt; o.Cost, o =&gt; o.Properties != <span class="hljs-literal"><span class="hljs-literal">null</span></span> ? o.Properties.Price * o.Properties.Quantity : <span class="hljs-number"><span class="hljs-number">-1</span></span>, o =&gt; o.Properties.Price, o =&gt; o.Properties.Quantity); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> IDisposable _tracker; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Order</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _tracker = _map.StartTracking(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> PropertyChangedEventHandler PropertyChanged; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnPropertyChanged</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> propertyName</span></span></span><span class="hljs-function">)</span></span> { PropertyChangedEventHandler handler = PropertyChanged; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (handler != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) handler(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PropertyChangedEventArgs(propertyName)); } }</code> </pre><br>  Now <i>Cost</i> will be automatically recalculated when the <i>Price</i> or <i>Quantity</i> property <i>Properties are</i> changed at the order or when the <i>Properties</i> instance itself is changed.  As you can see, to determine the dependence on the chain of properties turned out to be no more difficult than a simple single-level dependence. <br><br><h3>  Dependency on collection item properties </h3><br>  It seems that <i>dependence on the properties of the elements of the collections</i> is the most time-consuming in terms of manual support.  The steps to be taken by the programmer to implement such a connection were described using the example <i>TotalQuantity = Orders.Sum (o =&gt; o.Quantity)</i> above in the article.  But It is worth noting that this is only a case of dependence on one collection.  If there are two or more collections in the chain, then the implementation will become much more complicated.  <i>DependenciesTracker</i> supports this type of dependency and, as in previous cases, makes its definition declarative: <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Invoice</span></span> : <span class="hljs-title"><span class="hljs-title">INotifyPropertyChanged</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> ObservableCollection&lt;Order&gt; _orders = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ObservableCollection&lt;Order&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">decimal</span></span> _totalCost; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ObservableCollection&lt;Order&gt; Orders { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _orders; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> == _orders) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; _orders = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; OnPropertyChanged(); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">decimal</span></span> TotalCost { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _totalCost; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> == _totalCost) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; _totalCost = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; OnPropertyChanged(); } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IDependenciesMap&lt;Invoice&gt; _dependenciesMap = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DependenciesMap&lt;Invoice&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Invoice</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _dependenciesMap.AddDependency(i =&gt; i.TotalCost, i =&gt; i.Orders.Sum(o =&gt; o.Price * o.Quantity), i =&gt; i.Orders.EachElement().Price, i =&gt; i.Orders.EachElement().Quantity); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Invoice</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _dependenciesMap.StartTracking(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> PropertyChangedEventHandler PropertyChanged; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnPropertyChanged</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[CallerMemberName] </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> propertyName = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span> { PropertyChangedEventHandler handler = PropertyChanged; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (handler != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) handler(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PropertyChangedEventArgs(propertyName)); } }</code> </pre><br>  As before, we defined a computable property, its calculator, dependency paths, and started tracking in the instance constructor.  The only new construct we encountered is the <i>EachElement</i> method for moving from a collection to its element in a property chain.  In our case, expression <i>i =&gt; i.Orders.EachElement (). Price</i> means <i>TotalCost</i> depends on the price of each order from the <i>Orders</i> collection.  <i>EachElement is</i> intended only for constructing dependency paths that are expressions, so the method call in runtime is not supported: <br><br><pre> <code class="hljs cs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CollectionExtensions</span></span> { ... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> T EachElement&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> ICollection&lt;T&gt; collection) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NotSupportedException(<span class="hljs-string"><span class="hljs-string">"Call of this method is not supported"</span></span>); } }</code> </pre><br><h4>  Dependence on some collection aggregate </h4><br>  One of the cases of dependence on elements of the collection, which should be considered separately, is the dependence on the aggregate of the collection, the calculation of which does not use any CLR properties of the elements of the collection.  Examples: <br><br><ul><li>  <i>HasNullValues ‚Äã‚Äã= Orders .Any (o =&gt; o == null)</i> </li><li>  <i>EvensCount = Ints.Count (i% 2 == 0)</i> </li></ul><br>  In such cases, the paths must be terminated with the method EachElement (and not just a collection): <br><br><ul><li>  <i>i =&gt; i.Orders.EachElement ()</i> , not <i>i =&gt; i.Orders</i> , </li><li>  <i>i =&gt; i.Ints.EachElement ()</i> , not <i>i =&gt; i.Ints</i> . </li></ul><br><h3>  Project status, links, future plans </h3><br>  Current stable version: 1.0.1. <br>  Supported platform: .NET 4.0 and higher. <br>  Links: <a href="https://github.com/ademchenko/DependenciesTracker/">project page on github</a> , <a href="https://github.com/ademchenko/DependenciesTracker/wiki">project wiki (in English)</a> , <a href="https://www.nuget.org/packages/DependenciesTracking/">NuGet package</a> . <br><br>  All the described functionality is covered by unit tests (coverage rate is 88%). <br><br>  In the next versions of the library, it is planned to add support for tracking when models are inherited (adding, replacing and redefining dependencies in derived classes), as well as making the ‚Äúpath‚Äù out of the tracker's insides, making this concept public.  The latter, in particular, makes it easy to implement triggers that depend on complex paths. <br><br><h3>  Alternative solutions </h3><br>  <i>DependenciesTracker</i> is, of course, not the only existing solution for tracking changes in dependent properties. <br>  Some of the alternatives are discussed below. <br><br><ol><li>  A simple (prototypical) <a href="http://www.codeproject.com/Articles/375192/WPF-The-calculated-property-dependency-problem">implementation of</a> the attribute-based approach: <br><br><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">DependentProperty(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Price"</span></span></span><span class="hljs-meta">, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Quantity"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">decimal</span></span> Cost { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _cost; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> == _cost) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; _cost = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; OnPropertyChanged(); } }</code> </pre><br>  Decision: <br><br><ul><li>  based on reflection, </li><li>  requires the inheritance of the model from a special base class, </li><li>  does not support dependencies on property chains and collections. </li></ul><br></li><li>  <a href="https://github.com/Fody/PropertyChanged">NotifyPropertyChangeWeaver</a> (add-in to <a href="https://github.com/Fody">Fody</a> ): <br><br><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">DependsOn(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Price"</span></span></span><span class="hljs-meta">, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Quantity"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">decimal</span></span> Cost { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre><br>  Decision: <br><br><ul><li>  based on the rewriting of the assembly, the resulting IL for the example above will contain a raise of the Cost change event from the Price and Quantity setters; </li><li>  does not support dependencies on property chains and collections. </li></ul><br></li><li>  One of the standard aspects of PostSharp <a href="https://www.postsharp.net/model/inotifypropertychanged">NotifyPropertyChanged</a> : <br><br><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">NotifyPropertyChanged</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CustomerViewModel</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> CustomerModel Customer { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FullName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"{0} {1} ({2})"</span></span>, Customer.FirstName, Customer.LastName, Customer.Address.City); } } } [NotifyPropertyChanged] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CustomerModel</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> AddressModel Address { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> FirstName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> LastName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre><br>  Decision: <br><br><ul><li>  based on rewriting the assembly; </li><li>  supports (recognizes) dependencies on chains of properties; </li><li>  does not support dependencies on collection items; </li><li>  does not support (does not recognize) dependencies on chains of properties wrapped in methods, like for example: <br><br><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">NotifyPropertyChanged</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CustomerViewModel</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> CustomerModel Customer { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FullName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> FormatFullName(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FormatFullName</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"{0} {1} ({2})"</span></span>, Customer.FirstName, Customer.LastName, Customer.Address.City); } }</code> </pre><br>  The latter fact may not be a big problem, but, nevertheless, it can lead to subtle bugs, especially in dynamics - with code changes and refactorings. <br></li></ul><br></li><li>  Aspect <a href="http://www.postsharp.net/blog/post/The-Definitive-INotifyPropertyChanged">NotifyPropertyChanged</a> from PostSharp Domain Toolkit: <br><ul><li>  compared to the standard aspect from the previous example, this is an ‚Äúon steroids‚Äù option that can recognize many case dependencies; </li><li>  based on rewriting the assembly; </li><li>  in addition to dependencies on properties, it also supports dependencies on fields and methods (of the same class); </li><li>  supports dependencies on property chains; </li><li>  causes compilation errors (which is very important) if, in calculating dependencies, it encounters an unsupported construct (for example, dependence on a method of another class); </li><li>  does not support dependencies on collection elements. </li></ul><br></li><li>  <a href="http://danielvaughan.org/post/Knockout-Style-Observables-in-XAML.aspx">Knockout style observables</a> (prototype). <br>  Decision: <br><br><ul><li>  based on wrappers over properties; </li><li>  does not support dependencies on chains of properties and elements of collections; </li><li>  has a rather verbose syntax: <br><br><pre> <code class="hljs javascript"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewModel</span></span></span><span class="hljs-class"> </span></span>{ readonly ObservableValue&lt;string&gt; firstName = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ObservableValue&lt;string&gt;<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"Alan"</span></span></span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">public</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ObservableValue</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">string</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">FirstName</span></span></span><span class="hljs-function"> { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">get</span></span></span><span class="hljs-function"> { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">return</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">firstName</span></span></span><span class="hljs-function">; } } </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">readonly</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ObservableValue</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">string</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">lastName</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">new</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ObservableValue</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">string</span></span></span><span class="hljs-function">&gt;(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"Turing"</span></span></span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">public</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ObservableValue</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">string</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">LastName</span></span></span><span class="hljs-function"> { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">get</span></span></span><span class="hljs-function"> { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">return</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">lastName</span></span></span><span class="hljs-function">; } } </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">readonly</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ComputedValue</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">string</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">fullName</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">public</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ComputedValue</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">string</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">FullName</span></span></span><span class="hljs-function"> { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">get</span></span></span><span class="hljs-function"> { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">return</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">fullName</span></span></span><span class="hljs-function">; } } </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">public</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MainWindowViewModel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">fullName</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">new</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ComputedValue</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">string</span></span></span><span class="hljs-function">&gt;(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span></span><span class="hljs-function">) =&gt;</span></span> FirstName.Value + <span class="hljs-string"><span class="hljs-string">" "</span></span> + ToUpper(LastName.Value)); } string ToUpper(string s) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> s.ToUpper(); } }</code> </pre><br></li></ul><br></li><li>  <a href="http://www.pochet.net/blog/2010/07/02/inotifypropertychanged-automatic-dependent-property-and-nested-object-support/">Automatic dependency tracker</a> based on the analysis of the call stack. <br><br>  Decision: <br><br><ul><li>  supports simple dependencies; </li><li>  supports dependencies on chains of properties, but the implementation leaves much to be desired (when the property of an internal object changes, an event about the change of this entire object rushes); </li><li>  requires the inheritance of the model from a special base class and wrapping the code of getters and setters into special constructions </li></ul><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Person</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">BindableObjectBase3 { private string firstName; private string lastName; public Person</span></span></span></span>(string firstName, string lastName) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.FirstName = firstName; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.LastName = lastName; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> string FirstName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { using (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.GetPropertyTracker(() =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.FirstName)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.firstName; } } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.SetValue(ref <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.firstName, value, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.FirstName); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> string LastName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { using (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.GetPropertyTracker(() =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.LastName)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.lastName; } } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.SetValue(ref <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.lastName, value, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.LastName); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> string FullName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { using (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.GetPropertyTracker(() =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.FullName)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.FirstName + <span class="hljs-string"><span class="hljs-string">" "</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.LastName; } } } }</code> </pre><br></li><li>  <a href="http://www.wintellect.com/devcenter/krome/linking-property-change-notifications-in-xamarin-forms-or-wpfsilverlight">Wintellect solution</a> offering declarative fluent dependency definition syntax: <br><br><ul><li>  requires the inheritance of the model from a special base class; </li><li>  does not support dependencies on property chains and collections; </li><li>  supports "triggers" (the ability to call the delegate to change the properties of the model). </li></ul><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MyViewModel</span></span> : <span class="hljs-title"><span class="hljs-title">ObservableObject</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _firstName; <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _lastName; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> _showLastNameFirst; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FirstName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _firstName; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { SetPropertyValue(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> _firstName, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> LastName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _lastName; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { SetPropertyValue(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> _lastName, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FullName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ShowLastNameFirst ? String.Format (<span class="hljs-string"><span class="hljs-string">"{0}, {1}"</span></span>, _lastName, _firstName) : String.Format (<span class="hljs-string"><span class="hljs-string">"{0} {1}"</span></span>, _firstName, _lastName); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> ShowLastNameFirst { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _showLastNameFirst; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { SetPropertyValue(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> _showLastNameFirst, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Initials { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (String.IsNullOrEmpty(FirstName) ? <span class="hljs-string"><span class="hljs-string">""</span></span> : FirstName.Substring(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) + (String.IsNullOrEmpty(LastName) ? <span class="hljs-string"><span class="hljs-string">""</span></span> : LastName.Substring(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DelegateCommand SaveCommand { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyViewModel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { SaveCommand = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DelegateCommand(() =&gt; { <span class="hljs-comment"><span class="hljs-comment">// Save Data }, () =&gt; !(String.IsNullOrEmpty (FirstName) || String.IsNullOrEmpty (LastName))); WhenPropertyChanges(() =&gt; FirstName) .AlsoRaisePropertyChangedFor(() =&gt; FullName) .AlsoRaisePropertyChangedFor(() =&gt; Initials) .AlsoInvokeAction(SaveCommand.ChangeCanExecute); WhenPropertyChanges(() =&gt; LastName) .AlsoRaisePropertyChangedFor(() =&gt; FullName) .AlsoRaisePropertyChangedFor(() =&gt; Initials) .AlsoInvokeAction(SaveCommand.ChangeCanExecute); WhenPropertyChanges(() =&gt; ShowLastNameFirst ) .AlsoRaisePropertyChangedFor(() =&gt; FullName); } }</span></span></code> </pre><br></li></ol></div><p>Source: <a href="https://habr.com/ru/post/270979/">https://habr.com/ru/post/270979/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../270969/index.html">Restoring access rights for Mac OS X - EL Capitan</a></li>
<li><a href="../270971/index.html">Travel startups. How programmers on a trillionth market are lured: kofounders, vacancies, hackathons</a></li>
<li><a href="../270973/index.html">Titanic on Kaggle: you do not finish reading this post until the end</a></li>
<li><a href="../270975/index.html">Introduction to RxJava: Subscription Life Cycle</a></li>
<li><a href="../270977/index.html">Be in the "working group" from the very beginning</a></li>
<li><a href="../270981/index.html">Better or worse</a></li>
<li><a href="../270985/index.html">MBLTdev Live Broadcast</a></li>
<li><a href="../270989/index.html">Faster, wider, stronger: plans for the development of Bluetooth in 2016</a></li>
<li><a href="../270991/index.html">How Badoo generates images for ‚Äúsharing‚Äù in social networks</a></li>
<li><a href="../270995/index.html">Outlook Add-Ins or where does 25% of working time go and is it possible to return it?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>