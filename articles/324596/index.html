<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Statistics on property values ‚Äã‚Äã- visualization on the map</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 I'll start from the end. This is a screenshot from a web-card that visualizes the average value of real estate in the secondary market ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Statistics on property values ‚Äã‚Äã- visualization on the map</h1><div class="post__text post__text-html js-mediator-article"><h1>  Introduction </h1><br>  I'll start from the end.  This is a screenshot from a web-card that visualizes the average value of real estate in the secondary market of Saratov and Engels: <br><br><img src="https://habrastorage.org/files/e28/b31/420/e28b314201954a63a3ebb18c5e29ce2f.png"><br><br>  The colors on the map can be compared with the colors on the ‚Äúlegend‚Äù, the color on the ‚Äúlegend‚Äù corresponds to the average cost per square meter of the total area in thousands of rubles. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The point on the map corresponds to one offer for the sale (on the secondary market) of an apartment with Avito.  A total of such points, as can be seen in the ‚Äúlegend‚Äù, were used to plot 4943. <br>  An interactive map is available on <a href="https://dmitriik.github.io/RealtyEstimation/">GitHub</a> . <br><br><h1>  And now a little background .. </h1><br>  A long time ago‚Ä¶ <br><a name="habracut"></a><br>  ... when, as a student of the mechanics department, I wrote a paper on statistical data on real estate prices, I accidentally found a useful document - a gradation of areas for real estate prices, something like ‚ÄúPrice zones of Saratov‚Äù.  I do not know who made it up, but it was made up quite plausibly, - the analysis showed that (taking into account other factors), the difference between the average cost per square meter of apartments from neighboring price zones was about 10%.  Since then, to act as a real estate appraiser (at the household level), like most adults, had more than once. <br><br>  The idea of ‚Äã‚Äãa more ‚Äúscientific‚Äù approach to this issue came to mind when I saw the publication of Jeff Kaufman <a href="https://www.jefftk.com/p/updated-boston-apartment-price-maps">Boston Apartment Price Maps</a> . <br><br>  A friend did the following: <br><br><ul><li>  Python script that parses the site <a href="https://www.padmapper.com/">PadMapper</a> data on the cost of renting real estate. </li><li>  another script that, using the methods of Spatial interpolation, renders this data in the form of a bitmap image. </li><li>  Put this picture <a href="https://www.jefftk.com/apartment_prices/">on a page with Google Maps</a> </li></ul>  (Sources and data - <a href="https://github.com/jeffkaufman/apartment_prices">here</a> ) <br><br>  As a result, he got such an interactive map of the distribution of the rental price on the <a href="https://www.youtube.com/watch%3Fv%3Dx-64CaD8GXw">Boston</a> map: <br><br><img src="https://habrastorage.org/files/e0e/8d5/f31/e0e8d5f31cfa423ab47c1477ef57b562.png"><br><br>  After the first ‚ÄúWow, cool‚Äù, the next thought is ‚ÄúWhat if you try to do the same, but for Russia, not only at the cost of rent, but at prices per square of real estate‚Äù. <br><br>  Immediately make a reservation, I am rather a database developer for the current occupation, and I am not an expert in GIS data, nor in front-end development, nor in statistics, nor in Python, so be condescending ... I hope this will not be very much and you will write me about it for correction. <br><br>  And here comes the first major task. <br><br><h1>  Web Scraping with Avito. </h1><br>  Since with Python at that time I was completely on ‚Äúyou‚Äù, after studying the HTML code of Avito pages, I decided to write my own bicycle as a C # library using <a href="https://anglesharp.github.io/">AngleSharp</a> for parsing. <br><br>  I will not go deep now in features of implementation, I will notice only that: <br><br><ul><li>  I rendered all the parsing metadata of Avito into a separate configuration class, so that in the future, when the layout structure on Avito is changed, it would be possible to simply change the line in the configuration file. </li><li>  in order to avoid the ban from Avito, we had to add artificial delays in 10 seconds after processing each advertisement.  (I agree - not the smartest way, but it was not possible to find a suitable pool of proxy-ipishnikov offhand). </li></ul><br>  In the end, running the parsil for the night, I received the necessary data recorded in a table in the database <br><br><img src="https://habrastorage.org/files/5e3/e04/80a/5e3e0480ad4140e0a9b5c40d1763eefb.png"><br><br>  After clearing the data from the ‚ÄúOld Fund‚Äù, ‚ÄúElite‚Äù, and all sorts of obviously inadequate offers, I received a sample of five thousand points - sales of apartments on the secondary market of Saratov and Engels.  And this made it possible to proceed to the next step: <br><br><h1>  GIS data processing. </h1><br>  General formulation of the problem: <br><br>  - there is a discrete set of values ‚Äã‚Äãof a certain metric (temperature, altitude, substance concentration, etc.), with reference to the coordinates on the plane (X, Y or latitude, longitude), <br>  - you need to be able to predict the value of this metric at an arbitrary point of this plane, <br>  - the result is visualized as a color scheme on the plane.  For a color scheme, for convenience, you can sample colors. <br><br>  Example - at one moment they took readings from temperature sensors in different places, processed, received such a picture: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bd1/29c/b3a/bd129cb3a95bd6c4073be2bc123cb520.png"><br><br>  In fact, tasks of this kind require immersion in the topic ‚Äú <a href="http://www.bisolutions.us/A-Brief-Introduction-to-Spatial-Interpolation.php">Spatial interpolation</a> ‚Äù.  It has its own mathematical apparatus, for example: <br><br>  - <a href="http//gisgeography.com/inverse-distance-weighting-idw-interpolation/">Inverse Distance Weighting (IDW) Interpolation</a> <br>  - <a href="https://en.wikipedia.org/wiki/Kriging">Kriging</a> <br>  And there is a toolkit in the composition of popular GIS packages, for example <br>  - <a href="http://www.qgistutorials.com/ru/docs/interpolating_point_data.html">Interpolation of qGIS point data</a> <br>  - <a href="http://npk-kaluga.ru/GeoStatAnalyze_AGIS.htm">GeoStatistical Analyst ArcGIS</a> <br>  - <a href="http://www.dmcsee.org/uploads/file/337_4_saga_kriging_manual.pdf">Use of SAGA GIS for spatial interpolation (kriging)</a> <br>  - <a href="https://rpubs.com/nabilabd/118172">Kriging in R.</a> <br><br>  IDW in qGIS (see the first of the links) I tried, the result did not satisfy me. <br><br><img src="https://habrastorage.org/files/5af/8dd/0c1/5af8dd0c12f342e7849ba30b747497a1.png"><br><br>  Therefore, in order not to get stuck for a long time in mastering the new toolkit, I preferred to use the <a href="https//github.com/jeffkaufman/apartment_prices">ready-made Python script from Jeff Kraufman</a> .  For calculating distances and for translating GPS coordinates to X, Y coordinates on a raster, a simplified linear formula is used here, without using the <a href="https://en.wikipedia.org/wiki/Web_Mercator">projection used in Google Maps Web Mercator</a> . <br><br>  As I understand it, the script uses a variation on the Inverse Distance Weighting (IDW) theme, the main part (and the heaviest in the calculation part) in this script is part of this code. <br><br><div class="spoiler">  <b class="spoiler_title">Python code spatial interpolation</b> <div class="spoiler_text"><pre><code class="python hljs">gaussian_variance = IGNORE_DIST/<span class="hljs-number"><span class="hljs-number">2</span></span> gaussian_a = <span class="hljs-number"><span class="hljs-number">1</span></span> / (gaussian_variance * math.sqrt(<span class="hljs-number"><span class="hljs-number">2</span></span> * math.pi)) gaussian_negative_inverse_twice_variance_squared = <span class="hljs-number"><span class="hljs-number">-1</span></span> / (<span class="hljs-number"><span class="hljs-number">2</span></span> * gaussian_variance * gaussian_variance) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gaussian</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(prices, lat, lon, ignore=None)</span></span></span><span class="hljs-function">:</span></span> num = <span class="hljs-number"><span class="hljs-number">0</span></span> dnm = <span class="hljs-number"><span class="hljs-number">0</span></span> c = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> price, plat, plon, _ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> prices: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ignore: ilat, ilon = ignore <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> distance_squared(plat, plon, ilat, ilon) &lt; <span class="hljs-number"><span class="hljs-number">0.0001</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> weight = gaussian_a * math.exp(distance_squared(lat,lon,plat,plon) * gaussian_negative_inverse_twice_variance_squared) num += price * weight dnm += weight <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> weight &gt; <span class="hljs-number"><span class="hljs-number">2</span></span>: c += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-comment"><span class="hljs-comment"># don't display any averages that don't take into account at least five data points with significant weight if c &lt; 5: return None return num/dnm def distance_squared(x1,y1,x2,y2): return (x1-x2)*(x1-x2) + (y1-y2)*(y1-y2)</span></span></code> </pre> <br></div></div><br>  I adjusted my data array to the required format, removed the part that does the calculation of correlations regarding the bedroom_category (number of rooms) from the script, played with the input parameters, started the calculation.  On my computer (Intel¬Æ Core (TM) i7-6700 CPU, 16GB RAM), the calculation from 5 thousand points at the input and the image resolution at the output of 1000 * 1000 took about half an hour. <br><br>  It remains to work a bit with the Front-End.  We look at <a href="">HTML source maps of Boston</a> from Jeff Kraufman.  We modify it a little to fit our data, and we get just such a ‚Äúoil painting‚Äù. <br><br><img src="https://habrastorage.org/files/389/d5c/5e9/389d5c5e95114cb4b9619bfe751c27d7.png"><br><br>  To check for obvious ‚Äújambs‚Äù in <a href="https://en.wikipedia.org/wiki/Georeferencing">Georeferencing, we</a> load the same set of points into qGIS, load Google Maps, compare pictures. <br><br><img src="https://habrastorage.org/files/052/1b7/720/0521b77200284b238dffc5fd03a899e3.png"><br><br>  Having made sure that the points on the drawn map are in their places, and the colors on it faithfully reflect the prices of apartments in our village, we can breathe out - ‚ÄúYes!  Works!". <br><br>  Only here it is a little sad that the picture got into the Volga.  What is natural - the algorithm for calculating anything about the Volga does not know. <br><br>  So the problem arises: <br><br><h1>  Crop image on the coastline map </h1><br>  An attempt to find geo-data on the administrative boundaries of cities, taking into account the coastline, was not crowned with success.  There is Saratov, there is Engels, and the border between them passes in the middle of the Volga.  Okay, we'll go the other way. <br><br>  We download <a href="https://ru.wikipedia.org/wiki/Shapefile">shape</a> files from open sources with data on coastlines, load as a vector layer in qGIS, select the desired polygons, understand the file structure, pull out polygons that belong to the Volga river near Saratov, fill the data in the database. <br><br>  A bit of <a href="https://msdn.microsoft.com/en-us/library/cc280766.aspx">magic</a> type: <br><br><pre> <code class="sql hljs"> <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @Volga geography; <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> @Volga= PlacePolygon.MakeValid() <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> PlacesPolygons <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> PlacesPolygonID =<span class="hljs-number"><span class="hljs-number">1003</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @Saratov geography; <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> @Saratov= PlacePolygon.MakeValid() <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> PlacesPolygons <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> PlacesPolygonID =<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> @Saratov.STDifference(@Volga)</code> </pre> <br>  And we get the desired landfill - the boundaries of the city, taking into account the coastline. <br><br>  It remains to load this into qGIS, upload the image generated by the script as a raster layer, conduct Georeferencing for this image, and cut it around the polygon with the boundaries of cities, all using standard qGIS tools.  Everything would be great if ... I managed to do it.  But alas ... I didn‚Äôt have a relationship with <a href="http://www.qgistutorials.com/en/docs/advanced_georeferencing.html">Georeferencing in qGIS</a> , and after several attempts I decided that using spatial functions from Microsoft.SqlServer.Types, it‚Äôs easier to quickly make another bike as a utility on Sharpe. <br><br><div class="spoiler">  <b class="spoiler_title">C # code for trimming the image by GEO polygon</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">string</span></span> GPSPolygonVolga = <span class="hljs-string"><span class="hljs-string">" POLYGON ((46.2324447632 51‚Ä¶. ))"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CropByGPS</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Bitmap bmp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bitmap(inputFilePath); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> w = bmp.Width; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> h = bmp.Height; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> GpsSizeOfPyxelX = (MAX_LON - MIN_LON) / w; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> GpsSizeOfPyxelY = (MAX_LAT - MIN_LAT) / h; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> VolgaPolygon = SqlGeography.STPolyFromText(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> System.Data.SqlTypes.SqlChars(GPSPolygonVolga), SRID); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y = <span class="hljs-number"><span class="hljs-number">0</span></span>; y &lt; h; y++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x &lt; w; x++) { Color c = bmp.GetPixel(x, y); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> GPS = SqlGeography.Point(MAX_LAT - GpsSizeOfPyxelY * y, MIN_LON + GpsSizeOfPyxelX * x, SRID); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (VolgaPolygon.STContains(GPS)) <span class="hljs-comment"><span class="hljs-comment">//    ""  bmp.SetPixel(x, y, Color.Transparent); } } bmp.Save(outputFilePath, System.Drawing.Imaging.ImageFormat.Png); }</span></span></code> </pre> <br></div></div><br>  We loaded the source file with a raster, got the same file as output, but in a bit ‚Äúbitten form‚Äù.  Laid on Google Maps in the browser, we look, - nothing crawls on the Volga, great!  We look a little more attentively and we see ... what seems to be bitten off too much in some places.  Jamb in the data or jamb in the procedure?  Again we look at the loaded layers in qGIS. <br><br><img src="https://habrastorage.org/files/519/628/700/51962870076b47b2ad8693ee68707dd0.png"><br><br>  Yes ... indeed, in some places we sometimes ... landfills from the reservoir layer clearly climbs into the city.  Straight is not Engels, but some kind of Venice ... Well, there is no striving for perfection, we will go the other way. <br><br>  Once the vector data is out of trust, we will work with raster ones.  We need to superimpose two pictures, and cut from the first those points that correspond to the ‚Äúblue‚Äù in the second. <br><br>  A picture with a map can give us, for example, <a href="https//developers.google.com/maps/documentation/static-maps/%3Fhl%3Dru">Google Maps static API</a> . <br><br>  We get API_KEY, we find out that: <br><br>  - maximum resolution for free use = 640 * 640 <br>  - parametrization by <a href="http://wiki.openstreetmap.org/wiki/Bounding_Box">BoundingBox</a> -, unlike <a href="https://msdn.microsoft.com/en-us/library/ff701724.aspx">BING static maps, the</a> Google <a href="https://msdn.microsoft.com/en-us/library/ff701724.aspx">API</a> does not support, and it will be necessary to additionally correlate two figures in the coordinate plane. <br><br>  Okay, we try.  We get from Google Statics Map API some image with a map covering the area of ‚Äã‚Äãinterest to us, we write this code: <br><br><div class="spoiler">  <b class="spoiler_title">C # cropping on the picture</b> <div class="spoiler_text"><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CropByMapImage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Bitmap bmp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bitmap(inputFilePath); Bitmap bmpMap = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bitmap(mapToCompareFilePath); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> w = bmp.Width; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> h = bmp.Height; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> GpsSizeOfPyxelX = (MAX_LON - MIN_LON) / w; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> GpsSizeOfPyxelY = (MAX_LAT - MIN_LAT) / h; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> wm = bmpMap.Width; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> hm = bmpMap.Height; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cntAll = w * h; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cntRiver = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y = <span class="hljs-number"><span class="hljs-number">0</span></span>; y &lt; h; y++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x &lt; w; x++) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentLatitude = MAX_LAT - GpsSizeOfPyxelY * y; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentLongitude = MIN_LON + GpsSizeOfPyxelX * x; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentLongitude &lt; MIN_LON_M || currentLongitude &gt; MAX_LON_M || currentLatitude &lt; MIN_LAT_M || currentLatitude &gt; MAX_LAT_M) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-comment"><span class="hljs-comment">//todo - something with this ugly code var CorrespondentX = (int)((currentLongitude - MIN_LON_M) / (MAX_LON_M - MIN_LON_M) * wm); var CorrespondentY = (int)((MAX_LAT_M-currentLatitude) / (MAX_LAT_M - MIN_LAT_M) * hm); Color cp = bmp.GetPixel(x, y); //color of current pixel Color mp = bmpMap.GetPixel(CorrespondentX, CorrespondentY); //color of correspondent Map pixel if (Math.Max(Math.Max( Math.Abs(mp.R - WaterMapColor.R) , Math.Abs(mp.G - WaterMapColor.G)) , Math.Abs(mp.B -WaterMapColor.B))&lt; colorDiff /* &amp;&amp; cp.A != Color.Transparent.A */)// blue water is not always the same blue { bmp.SetPixel(x, y, Color.Transparent); cntRiver++; } } } bmp.Save(outputFilePath, System.Drawing.Imaging.ImageFormat.Png); }</span></span></code> </pre> <br></div></div><br>  We process our file with a resolution of 1000 * 1000 using a file with a resolution of 640 * 640, we get ... this result (here, for clarity, those points that should be Transparent are made yellow): <br><br><img src="https://habrastorage.org/files/d3f/839/24c/d3f83924c6b744118a6f404ec62e6020.jpg"><br><br>  The result is sad, including also because the Google Map is scaled discretely and, therefore, covers our generated raster with a large margin.  That is, or you need to take to ‚Äútrim‚Äù a lot of maps with a suitable scale, or ... like all the same, find one, but with a good resolution. <br><br>  I went the second way, that is, simply by taking a screenshot of the desired projection of the usual Google Map from the browser.  GPS coordinates of corners (mapping bound), I found out by adding in JavaScript code this: <br><br><pre> <code class="javascript hljs">google.maps.event.addListener(map, <span class="hljs-string"><span class="hljs-string">'bounds_changed'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(map.getBounds());</code> </pre> <br>  I processed our raster with the help of a new map from the saved screenshot, uploaded to the browser and ... the result I was rather pleased.  Even a small pond in the local city park was ‚Äúcleaned out‚Äù quite correctly (within the GPS positioning accuracy). <br><br><img src="https://habrastorage.org/files/8e4/217/f14/8e4217f1485f49b8ae992bc66f07c704.png"><br><br>  Everything, we will consider the first stage of the quest to be completed, upload the results on GitHub to the daddy shared for hosting, and we can boast to the IT community. <br><br><h1>  So, what is next? </h1><br>  And then there are many questions that I do not know a clear answer: <br><br><ul><li>  How well does the calculation algorithm work here compared to other methods of spatial interpolations? </li><li>  What other factors, besides the location of the property, it makes sense to consider when calculating and how to enter into the calculation model </li><li>  Is it possible to make a constant update of the data in the database and build on this some kind of real estate valuation system?  (If Avito representatives read me on this site, I would like to hear comments) </li></ul><br>  Well ... thanks to everyone who has read this far.  It was interesting for me to solve a practical problem, which turned out to be ‚Äúrather challenging for me‚Äù, I hope you were interested in reading about my experience. </div><p>Source: <a href="https://habr.com/ru/post/324596/">https://habr.com/ru/post/324596/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../324586/index.html">Employees and social networks</a></li>
<li><a href="../324588/index.html">Continuous integration with Drone CI, Docker and Ansible</a></li>
<li><a href="../324590/index.html">The history of the 3rd place on ML Boot Camp III</a></li>
<li><a href="../324592/index.html">Mahou updated to version 2.0</a></li>
<li><a href="../324594/index.html">JNI Receive and Connect to JVM in Delphi</a></li>
<li><a href="../324598/index.html">Quadstor - performance and reliability</a></li>
<li><a href="../324600/index.html">GitHub introduces SHA-1 collision detection system</a></li>
<li><a href="../324604/index.html">Detection and elimination of hacker attacks: how the system GOSPKA works</a></li>
<li><a href="../324606/index.html">Definition of development vector in the project</a></li>
<li><a href="../324608/index.html">Intel strengthens its position in HPC</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>