<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Run third-party code in the sandbox</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As the Wikipedia article states, the Sandbox is a mechanism for safe execution of programs. Sandboxes are often used to run untested code, untested co...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Run third-party code in the sandbox</h1><div class="post__text post__text-html js-mediator-article">  As the Wikipedia <a href="http://ru.wikipedia.org/wiki/%25D0%259F%25D0%25B5%25D1%2581%25D0%25BE%25D1%2587%25D0%25BD%25D0%25B8%25D1%2586%25D0%25B0_(%25D0%25B1%25D0%25B5%25D0%25B7%25D0%25BE%25D0%25BF%25D0%25B0%25D1%2581%25D0%25BD%25D0%25BE%25D1%2581%25D1%2582%25D1%258C)">article</a> states, the Sandbox is a mechanism for safe execution of programs.  Sandboxes are often used to run untested code, untested code from unknown sources, as well as to launch and detect viruses. <br><img src="https://habrastorage.org/storage/923d7a64/0e18cb22/9173b504/6a234e3c.jpg"><br>  Imagine that we have a task: there is a project and users can write their own scripts (widgets, add-ons, plug-ins) under it.  We want user scripts to do nothing wrong (theft of cookies is the least that they can do). <br><br>  The article will discuss the attacks that can be committed by attackers and the methods of safe execution of third-party code. <br><a name="habracut"></a><br>  Let's start with the types of attacks that we have to prevent. <br><br><h4>  Types of attacks </h4><br>  Next comes a whole bunch of ‚Äúattack vectors‚Äù with examples (the links to the original article), if you are not interested in expanding your horizons, scroll to the end of the post.  Attacks are not cross browser. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <a href="http://code.google.com/p/google-caja/wiki/GlobalObjectPoisoning">GlobalObjectPoisoning</a> - Poisoning Global Objects <br><pre><code class="hljs javascript"><span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>.prototype[<span class="hljs-number"><span class="hljs-number">4</span></span>] = <span class="hljs-string"><span class="hljs-string">'four'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a1 = []; alert(<span class="hljs-string"><span class="hljs-string">'a1 has length '</span></span> + a1.length + <span class="hljs-string"><span class="hljs-string">' but element 4 is '</span></span> + a1[<span class="hljs-number"><span class="hljs-number">4</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>(<span class="hljs-number"><span class="hljs-number">5</span></span>); alert(<span class="hljs-string"><span class="hljs-string">'a2 has length '</span></span> + a2.length + <span class="hljs-string"><span class="hljs-string">' and its element 4 is also '</span></span> + a2[<span class="hljs-number"><span class="hljs-number">4</span></span>]);</code> </pre> <br>  <a href="http://code.google.com/p/google-caja/wiki/EvalArbitraryCodeExecution">EvalArbitraryCodeExecution</a> - eval and the Function constructor can execute third-party code. <br><pre> <code class="hljs php"><span class="hljs-keyword"><span class="hljs-keyword">eval</span></span>(<span class="hljs-string"><span class="hljs-string">'alert("your cookie is " + document.cookie)'</span></span>); (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">Function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'alert("your cookie is " + document.cookie)'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">)</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>;</code> </pre> <br>  <a href="http://code.google.com/p/google-caja/wiki/ArgumentsMaskedByVar">ArgumentsMaskedByVar</a> - the array of function arguments is masked by var arguments in Opera <br><pre> <code class="hljs javascript">(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a, b, c</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span> = [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]; alert(<span class="hljs-string"><span class="hljs-string">'arguments[0] === '</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>] + <span class="hljs-string"><span class="hljs-string">', a='</span></span> + a); <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-number"><span class="hljs-number">2</span></span>; alert(<span class="hljs-string"><span class="hljs-string">'arguments[0] === '</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>] + <span class="hljs-string"><span class="hljs-string">', a='</span></span> + a); })(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre> <br>  <a href="http://code.google.com/p/google-caja/wiki/CrossScopeParameterModification">CrossScopeParameterModification</a> - the arguments array allows you to change your parameters <br><pre> <code class="hljs matlab">(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">arguments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function"> = 1; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">alert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('a=' + a)</span></span></span><span class="hljs-function">; })</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(0)</span></span></span><span class="hljs-function">;&gt;</span></span></code> </pre> <br>  <a href="http://code.google.com/p/google-caja/wiki/ArgumentsExposesCaller">ArgumentsExposesCaller</a> - it is possible to pull the arguments of an external function using caller <br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> untrusted() { alert(<span class="hljs-string"><span class="hljs-string">'got function '</span></span> + untrusted.caller + <span class="hljs-string"><span class="hljs-string">' : '</span></span> + arguments.callee.caller.arguments[<span class="hljs-number"><span class="hljs-number">0</span></span>]); } (<span class="hljs-keyword"><span class="hljs-keyword">function</span></span> <span class="hljs-keyword"><span class="hljs-keyword">trusted</span></span>() { untrusted(); })(<span class="hljs-number"><span class="hljs-number">4</span></span>);</code> </pre> <br>  <a href="http://code.google.com/p/google-caja/wiki/FunctionMemberCrossScopeParameterAccess">FunctionMemberCrossScopeParameterAccess</a> - it is possible to replace the arguments of the external function from the internal function <br><pre> <code class="hljs matlab"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">g</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">alert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">g</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">arguments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function"> = 1; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(0)</span></span></span></span></code> </pre> <br>  <a href="http://code.google.com/p/google-caja/wiki/TypeofInconsistent">TypeofInconsistent</a> - typeof bug with regular expressions in webkits <br><pre> <code class="hljs coffeescript"><span class="hljs-string"><span class="hljs-string">'function'</span></span> === (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> <span class="hljs-regexp"><span class="hljs-regexp">/./</span></span>) <span class="hljs-string"><span class="hljs-string">'function'</span></span> === (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> alert)</code> </pre> <br>  <a href="http://code.google.com/p/google-caja/wiki/InaccessibleLocalVariables">InaccessibleLocalVariables</a> - Local variables may not be available using catch (localVarName) <br><pre> <code class="hljs javascript">(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>; alert(<span class="hljs-string"><span class="hljs-string">'arguments === undefined: '</span></span> + (<span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span> === <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>)); })(); (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> e; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e) { } alert(<span class="hljs-string"><span class="hljs-string">'arguments === undefined: '</span></span> + (<span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span> === <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>)); })(); (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> e = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e) { } alert(<span class="hljs-string"><span class="hljs-string">'e === 1 : '</span></span> + e); })();</code> </pre> <br>  <a href="http://code.google.com/p/google-caja/wiki/CatchBlocksScopeBleed">CatchBlocksScopeBleed</a> - it is possible to replace global variables using catch <br><pre> <code class="hljs matlab">var a = <span class="hljs-number"><span class="hljs-number">0</span></span>; (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">try</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">throw</span></span></span><span class="hljs-function"> 1; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">catch</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span><span class="hljs-function"> { } })</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">alert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">alerts</span></span></span><span class="hljs-function"> 1 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">old</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FF</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(function ()</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">try</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">throw</span></span></span><span class="hljs-function"> 1; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">catch</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span><span class="hljs-function"> { } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">alert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">alerts</span></span></span><span class="hljs-function"> 1 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IE</span></span></span><span class="hljs-function"> 6 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> 7 </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IE 8 not tested)</span></span></span><span class="hljs-function"> })</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">;</span></span></code> </pre> <br>  <a href="http://code.google.com/p/google-caja/wiki/GlobalScopeViaThis">GlobalScopeViaThis</a> - It is possible to access the Global scope using this in functions. <br><pre> <code class="hljs actionscript">(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ alert(<span class="hljs-string"><span class="hljs-string">'your cookie is '</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.document.cookie); })(); setTimeout( <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ alert(<span class="hljs-string"><span class="hljs-string">'your cookie is '</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.document.cookie); }, <span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre> <br>  <a href="http://code.google.com/p/google-caja/wiki/DeleteUnmasksGlobals">DeleteUnmasksGlobals</a> - Hidden global variables in with can be opened using delete <br><pre> <code class="hljs javascript"> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">document</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span> }) { <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>; alert(<span class="hljs-string"><span class="hljs-string">'your cookie is '</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.cookie); }</code> </pre> <br>  <a href="http://code.google.com/p/google-caja/wiki/FunctionConstructor">FunctionConstructor</a> - The constructor of a function is accessible through the 'constructor' property. <br><pre> <code class="hljs lisp">((<span class="hljs-name"><span class="hljs-name">function</span></span> () {}).constructor)( 'alert(<span class="hljs-string"><span class="hljs-string">"document.cookie = "</span></span> + document.cookie)')()</code> </pre> <br>  <a href="http://code.google.com/p/google-caja/wiki/ObjectEvalArbitraryCodeExecution">ObjectEvalArbitraryCodeExecution</a> - Object.eval allows you to execute any code in Firefox. <br><pre> <code class="hljs scala">({}).eval(<span class="hljs-symbol"><span class="hljs-symbol">'alert</span></span>(<span class="hljs-string"><span class="hljs-string">"Your cookie is "</span></span> + document.cookie)')</code> </pre> <br>  <a href="http://code.google.com/p/google-caja/wiki/ObjectWatch">ObjectWatch</a> - Object.watch allows you to poison and receive any external data <br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> untrusted(o) { o.watch( <span class="hljs-string"><span class="hljs-string">'private_'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> (obj, oldval, newval) { alert(<span class="hljs-string"><span class="hljs-string">'untrusted got oldval '</span></span> + oldval + <span class="hljs-string"><span class="hljs-string">' and newval '</span></span> + newval); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'poisoned'</span></span>; // substitute a bogus <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> }); } // <span class="hljs-keyword"><span class="hljs-keyword">Trusted</span></span> code var o = { private_: <span class="hljs-string"><span class="hljs-string">'old'</span></span> }; untrusted(o); o.private_ = <span class="hljs-string"><span class="hljs-string">'new'</span></span>; alert(<span class="hljs-string"><span class="hljs-string">'private is now '</span></span> + o.private_);</code> </pre> <br>  <a href="http://code.google.com/p/google-caja/wiki/ObjectToSourceLeaksPrivates">ObjectToSourceLeaksPrivates</a> - Object.toSource and uneval allows you to access private properties <br><pre> <code class="hljs lua">// Untrusted code <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">untrusted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(o)</span></span></span></span> { // untrusted need <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> attempt to access private_ directly var privateValue = o.toSource().<span class="hljs-built_in"><span class="hljs-built_in">match</span></span>(/private_:\s*(\d+)/)[<span class="hljs-number"><span class="hljs-number">1</span></span>] * <span class="hljs-number"><span class="hljs-number">1</span></span>; alert(<span class="hljs-string"><span class="hljs-string">'private value is '</span></span> + privateValue); } var o = { private_: <span class="hljs-number"><span class="hljs-number">4</span></span> } untrusted(o);</code> </pre> <br>  <a href="http://code.google.com/p/google-caja/wiki/FunctionMethodsLeakGlobalScope">FunctionMethodsLeakGlobalScope</a> - Function.call or Function.apply can open a global object using some of the values ‚Äã‚Äãof this. <br><pre> <code class="hljs pgsql">(<span class="hljs-keyword"><span class="hljs-keyword">function</span></span> () { alert(this === <span class="hljs-keyword"><span class="hljs-keyword">window</span></span>); }).<span class="hljs-keyword"><span class="hljs-keyword">call</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); (<span class="hljs-keyword"><span class="hljs-keyword">function</span></span> () { alert(this === <span class="hljs-keyword"><span class="hljs-keyword">window</span></span>); }).<span class="hljs-keyword"><span class="hljs-keyword">call</span></span>(undefined); alert(<span class="hljs-keyword"><span class="hljs-keyword">window</span></span> === ([]).sort.<span class="hljs-keyword"><span class="hljs-keyword">call</span></span>()); alert(<span class="hljs-keyword"><span class="hljs-keyword">window</span></span> === ([]).<span class="hljs-keyword"><span class="hljs-keyword">reverse</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">call</span></span>()); // Firefox2 <span class="hljs-keyword"><span class="hljs-keyword">only</span></span>. [https://bugzilla.mozilla.org/show_bug.cgi?id=<span class="hljs-number"><span class="hljs-number">406337</span></span>] var o = { valueOf: <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> () { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> } }; (<span class="hljs-keyword"><span class="hljs-keyword">function</span></span> () { alert(this === <span class="hljs-keyword"><span class="hljs-keyword">window</span></span>); }).<span class="hljs-keyword"><span class="hljs-keyword">call</span></span>(o);</code> </pre> <br>  <a href="http://code.google.com/p/google-caja/wiki/ConditionalCompilationComments">ConditionalCompilationComments</a> - Conditional compilation allows an attacker to hide the code. <br><pre> <code class="hljs php"><span class="hljs-comment"><span class="hljs-comment">/*</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@cc</span></span></span><span class="hljs-comment">_on @*/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@if</span></span></span><span class="hljs-comment"> (1) alert(document.cookie) </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@end</span></span></span><span class="hljs-comment"> @*/</span></span></code> </pre> <br>  <a href="http://code.google.com/p/google-caja/wiki/StringObfuscationIsEasy">StringObfuscationIsEasy</a> - String Obfuscation <br><pre> <code class="hljs actionscript">(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> s = <span class="hljs-string"><span class="hljs-string">'cons'</span></span>; s += <span class="hljs-string"><span class="hljs-string">'tructor'</span></span>; (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ((<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{})[s])(<span class="hljs-string"><span class="hljs-string">'alert("hello")'</span></span>))(); })();</code> </pre> <br>  <a href="http://code.google.com/p/google-caja/wiki/ParentCircumventsScoping">ParentCircumventsScoping</a> - Using __parent__ it is possible to access variables from any scope <br><pre> <code class="hljs matlab">(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">alert</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">null</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">boilerplate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">that</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">masks</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">alert</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(function ()</span></span></span><span class="hljs-function"> { // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">untrusted</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">code</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">that</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">can</span></span></span><span class="hljs-function">'</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">access</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">alert</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">directly</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({})</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__parent__</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">alert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('hello')</span></span></span><span class="hljs-function">; })</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; })</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">;</span></span></code> </pre> <br>  <a href="http://code.google.com/p/google-caja/wiki/JsControlFormatChars">JsControlFormatChars</a> - The invert RTL character or [: Cf:] can be used to hide the code in comments. <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onload</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" /&amp;#x200D;/.test(''); /* alert('hi'); // */ "</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  <a href="http://code.google.com/p/google-caja/wiki/InconsistentlyReservedKeywords">InconsistentlyReservedKeywords</a> - Context Sensitive Words: const constructor prototype <br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[<span class="hljs-string"><span class="hljs-string">'const'</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> alert = f(); <span class="hljs-comment"><span class="hljs-comment">// looks like an assignment to self. function f() { return alert; } // looks like a reference to an undefined local. alert('hello world');</span></span></code> </pre> <br>  <a href="http://code.google.com/p/google-caja/wiki/ErrorExposesParameterValues">ErrorExposesParameterValues</a> - Using the error stack trace, you can access the parameters passed to external functions. <br><pre> <code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">skroob</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">luggageCombination</span></span></span><span class="hljs-function">) </span></span>{ darkHelmet(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">darkHelmet</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> combo = <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>((<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>).stack.match(<span class="hljs-regexp"><span class="hljs-regexp">/skroob\((\d+)\)/</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>]); alert(<span class="hljs-string"><span class="hljs-string">'Only an idiot would use that combination!: '</span></span> + combo); } skroob(<span class="hljs-number"><span class="hljs-number">1234</span></span>);</code> </pre> <br>  <a href="http://code.google.com/p/google-caja/wiki/RegexpsLeakMatchGlobally">RegexpsLeakMatchGlobally</a> - <a href="http://code.google.com/p/google-caja/wiki/RegexpsLeakMatchGlobally">Regulars</a> can be run on the last line sent to the last regular expression. <br><pre> <code class="hljs ruby">/<span class="hljs-regexp"><span class="hljs-regexp">/ Privileged code (function () { var queryString = document.location.search; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ Assume it's "?password=1234" function params() { return queryString.split(/</span></span>[&amp;?]/g); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (params()[<span class="hljs-number"><span class="hljs-number">0</span></span>] === <span class="hljs-string"><span class="hljs-string">'debug=on'</span></span>) { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> ... } })(); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> Unprivileged code without direct access to document.location (function () { alert(<span class="hljs-regexp"><span class="hljs-regexp">/.*/</span></span>.exec()); })();</code> </pre> <br>  <a href="http://code.google.com/p/google-caja/wiki/EvalBreaksClosureEncapsulation">EvalBreaksClosureEncapsulation</a> - The evel call can break the scope encapsulation in older versions of ff <br><pre> <code class="hljs actionscript"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">counter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ++i; }; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> myCounter = counter(<span class="hljs-number"><span class="hljs-number">0</span></span>); alert(myCounter()); <span class="hljs-comment"><span class="hljs-comment">// =&gt; 1 eval('i = 4', myCounter); alert(myCounter()); // =&gt; 5 on Firefox 2, 2 on other browsers</span></span></code> </pre> <br>  <a href="http://code.google.com/p/google-caja/wiki/PostIncrementAndDecrementCanReturnNonNumber">PostIncrementAndDecrementCanReturnNonNumber</a> - <a href="http://code.google.com/p/google-caja/wiki/PostIncrementAndDecrementCanReturnNonNumber">Post</a> - <a href="http://code.google.com/p/google-caja/wiki/PostIncrementAndDecrementCanReturnNonNumber">increment</a> and post-dekriment may not return a number - a way to get the constructor Function <br><pre> <code class="hljs actionscript"> (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c = <span class="hljs-string"><span class="hljs-string">'constructor'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> F = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{})[c++]; <span class="hljs-comment"><span class="hljs-comment">// Function constructor F('alert("toast")')(); })();</span></span></code> </pre> <br><br>  A whole bunch of attacks, including attacks from html, css <a href="http://code.google.com/p/google-caja/wiki/AttackVectors">code.google.com/p/google-caja/wiki/AttackVectors</a> <br><br>  Given all these attacks, we must provide a certain API, so that the plugin does not work autonomously. <br><br><h4>  The features we need to provide the plugin </h4><br>  1. Getting access to some user data. <br>  2. Perform some actions on behalf of the user. <br><br>  How to isolate yourself from the attacker and give a good developer every opportunity ?! <br><br><h4>  1. Moderation </h4><br><img src="http://seoburj.ru/wp-content/uploads/2010/08/woman1_4_2009.png" alt="image"><br>  We can hire a team of moderators who are well versed in the code, plus accepting bug reports from users. <br>  <i>Disadvantages:</i> extremely expensive, and extremely inefficient.  Good moderators have to pay a lot, but you can always find a hacker who is more skilled than any moderator, plus the human factor.  Users may not find an error, the plugin can do its dirty work unnoticed by the user. <br>  <i>Advantages:</i> no <br><br><h4>  2. Sandbox in iFrame </h4><br>  This option is used in jsfiddle <br>  1. We take out user scripts to the left domain <br>  2. Forbid to perform alert prompt confirm <br>  3. The user has the right to do anything in his frame <br>  4. API provided by postMessage (asynchronously) <br>  Disadvantages: plugins can attack other plugins if they have a common domain.  Asynchronous exchange.  There may be other functions besides alert prompt confirm, which may interfere with the user.  not all browsers support postMessage <br>  <i>Advantages:</i> simple implementation of sendboxing <br>  <i>More about it:</i> <a href="http://dean.edwards.name/weblog/2006/11/sandbox/">dean.edwards.name/weblog/2006/11/sandbox</a> <br><br><h4>  3. Sandbox in WebWorkers </h4><br>  Workers are excellent sandwiches, they are already limited to the browser environment. <br>  1. API provides by postMessage (asynchronously) <br>  2. We must create a library of interface elements. <br>  3. Items will respond to events asynchronously. <br>  Disadvantages: the developer of the plugin is limited to interface components.  Asynchronous exchange and events.  Not all browsers support WebWorkers. <br>  <i>Advantages:</i> simple implementation of sendboxing <br>  <i>Example:</i> <a href="https://github.com/eligrey/jsandbox">github.com/eligrey/jsandbox</a> <br><br><h4>  4. Static analysis and translation of code into code </h4><br>  We analyze the source code, replace potentially dangerous configurations with safe ones (css javascript html), or do not miss potentially dangerous ones. <br>  <i>Disadvantages:</i> no output, we get no source code <br>  <i>Pluses:</i> works everywhere <br><br><h5>  4.1.  Douglas Crockford's ADsafe </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/50f/70d/ed6/50f70ded633e467bb1c770b859a32aa0.gif" alt="image"><br>  ADsafe defines a subset of JavaScript that is powerful enough to allow guest code to perform important actions, while preventing scripts from damaging or invading source code. <br>  ADsafe removes features from JavaScript that either do not secure or give unchecked access to browser components.  Their list includes: global variables, this, arguments, eval, with, arguments, callee, caller, constructor, eval, prototype, stack, unwatch, valueOf, watch, names ending with or beginning with _, operator [], Date and Math .random <br>  <i>Restrictions:</i> Before starting the code, you need to process JSLint, the code must be in UTF-8, html id must be unique <br>  <i>Disadvantages:</i> excessive developer restrictions <br>  <i>Pluses:</i> works everywhere <br>  <i>More details can be found here:</i> <a href="http://www.adsafe.org/">www.adsafe.org</a> <br>  <i>Play with adsafe here:</i> <a href="http://www.jslint.com/">www.jslint.com</a> (enable ADsafe flag) <br><br><h5>  4.2.  Google caja </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/9de/d25/815/9ded258155b0b8ca6b6e3098f58ea77a.png" alt="image"><br>  Unlike ADsafe, Google Caja translates (using the ‚Äúcajoler‚Äù compiler) JavaScript, HTML, CSS code to secure (cajoled) JavaScript, HTML, CSS code.  Cajoler conducts static analysis to identify potentially dangerous moments where static analysis is impossible to check dynamically - in the process.  In addition, cajoler does virtualization of DOM pieces using virtual iframes.  Caja protects against all types of attacks described <a href="http://code.google.com/p/google-caja/wiki/AttackVectors">here</a> . <br>  <i>Disadvantages:</i> we get the modified code <br>  <i>Advantages:</i> works everywhere, does not impose unnecessary restrictions on the developer <br>  <b>Code translation examples</b> <br><br>  Before <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> alert(</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.cookie); top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.thinkfu.com/evil.gif"</span></span></span><span class="javascript">; </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  After <br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> { ___.loadModule({ </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'instantiate'</span></span></span><span class="actionscript">: </span><span class="hljs-function"><span class="hljs-keyword"><span class="actionscript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="actionscript"><span class="hljs-function"> </span></span><span class="hljs-params"><span class="actionscript"><span class="hljs-function"><span class="hljs-params">(___, IMPORTS___)</span></span></span></span><span class="actionscript"><span class="hljs-function"> </span></span></span><span class="actionscript">{ </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">return</span></span></span><span class="actionscript"> ___.prepareModule({ </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'instantiate'</span></span></span><span class="actionscript">: </span><span class="hljs-function"><span class="hljs-keyword"><span class="actionscript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="actionscript"><span class="hljs-function"> </span></span><span class="hljs-params"><span class="actionscript"><span class="hljs-function"><span class="hljs-params">(___, IMPORTS___)</span></span></span></span><span class="actionscript"><span class="hljs-function"> </span></span></span><span class="actionscript">{ </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">var</span></span></span><span class="actionscript"> dis___ = IMPORTS___; </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">var</span></span></span><span class="actionscript"> moduleResult___, x0___, x1___; moduleResult___ = ___.NO_RESULT; </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">try</span></span></span><span class="actionscript"> { { (IMPORTS___.alert_v___ ? IMPORTS___.alert : ___.ri(IMPORTS___, </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'alert'</span></span></span><span class="actionscript">)).i___((x0___ = IMPORTS___.document_v___ ? IMPORTS___.document : ___.ri(IMPORTS___, </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'document'</span></span></span><span class="actionscript">), x0___.cookie_v___ ? x0___.cookie : x0___.v___(</span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'cookie'</span></span></span><span class="actionscript">))); moduleResult___ = (x1___ = IMPORTS___.top_v___ ? IMPORTS___.top : ___.ri(IMPORTS___, </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'top'</span></span></span><span class="actionscript">), x1___.location_w___ === x1___ ? (x1___.location = </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'http://www.thinkfu.com/evil.gif'</span></span></span><span class="actionscript">) : x1___.w___(</span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'location'</span></span></span><span class="actionscript">, </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'http://www.thinkfu.com/evil.gif'</span></span></span><span class="actionscript">)); } } </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">catch</span></span></span><span class="actionscript"> (ex___) { ___.getNewModuleHandler().handleUncaughtException(ex___, IMPORTS___.onerror_v___ ? IMPORTS___.onerror : ___.ri(IMPORTS___, </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'onerror'</span></span></span><span class="actionscript">), </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'unknown'</span></span></span><span class="actionscript">, </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'2'</span></span></span><span class="actionscript">); } </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">return</span></span></span><span class="actionscript"> moduleResult___; }, </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'cajolerName'</span></span></span><span class="actionscript">: </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'com.google.caja'</span></span></span><span class="actionscript">, </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'cajolerVersion'</span></span></span><span class="actionscript">: </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'4427'</span></span></span><span class="actionscript">, </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'cajoledDate'</span></span></span><span class="actionscript">: </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">1302010087717</span></span></span><span class="actionscript"> }).instantiate___(___, IMPORTS___), ___.prepareModule({ </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'instantiate'</span></span></span><span class="actionscript">: </span><span class="hljs-function"><span class="hljs-keyword"><span class="actionscript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="actionscript"><span class="hljs-function"> </span></span><span class="hljs-params"><span class="actionscript"><span class="hljs-function"><span class="hljs-params">(___, IMPORTS___)</span></span></span></span><span class="actionscript"><span class="hljs-function"> </span></span></span><span class="actionscript">{ </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">var</span></span></span><span class="actionscript"> dis___ = IMPORTS___; </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">var</span></span></span><span class="actionscript"> moduleResult___; moduleResult___ = ___.NO_RESULT; { IMPORTS___.htmlEmitter___.signalLoaded(); } </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">return</span></span></span><span class="actionscript"> moduleResult___; }, </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'cajolerName'</span></span></span><span class="actionscript">: </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'com.google.caja'</span></span></span><span class="actionscript">, </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'cajolerVersion'</span></span></span><span class="actionscript">: </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'4427'</span></span></span><span class="actionscript">, </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'cajoledDate'</span></span></span><span class="actionscript">: </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">1302010087733</span></span></span><span class="actionscript"> }).instantiate___(___, IMPORTS___); }, </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'cajolerName'</span></span></span><span class="actionscript">: </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'com.google.caja'</span></span></span><span class="actionscript">, </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'cajolerVersion'</span></span></span><span class="actionscript">: </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'4427'</span></span></span><span class="actionscript">, </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'cajoledDate'</span></span></span><span class="actionscript">: </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">1302010087748</span></span></span><span class="actionscript"> }); } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Script alert "Untrusted gadget says: undefined" and not redirects <br>  As you can see, the source code is far from being obtained, but the end user is protected from intruder attacks. <br><br>  <i>Project Page:</i> <a href="http://code.google.com/p/google-caja/">code.google.com/p/google-caja</a> <br>  <i>Twist Google Caja here</i> : <a href="http://caja.appspot.com/">caja.appspot.com</a> <br><br>  I would like to hear what methods of sandboxing you use, do you have examples of implementation? <br><br>  Criticism, questions and suggestions are welcome! <br><br>  <b>PS I</b> apologize for the breakthrough kata - the parser overslept </div><p>Source: <a href="https://habr.com/ru/post/116898/">https://habr.com/ru/post/116898/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../116892/index.html">Multi-threaded application under Tornado</a></li>
<li><a href="../116893/index.html">Mangrove, Ventech Capital and ABRT have invested in oktogo.ru</a></li>
<li><a href="../116894/index.html">Nginx + uWSGI + Django, one of the launch options</a></li>
<li><a href="../116895/index.html">Service development: Classmates, VKontakte, ethics vs. aesthetics</a></li>
<li><a href="../116896/index.html">PHPUnit && ordered tests</a></li>
<li><a href="../116899/index.html">The first public version of Appcelerator Titanium Studio has been released.</a></li>
<li><a href="../116902/index.html">Skype phone booth at Tallinn Airport</a></li>
<li><a href="../116903/index.html">Show your startup to Yandex, Mail.ru, Groupon</a></li>
<li><a href="../116904/index.html">Introduction to F #, the blue pill</a></li>
<li><a href="../116906/index.html">American Film Association sues online video rental</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>