<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Decrypt Javascript on the example of file hosting mediafire.com</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nowadays, javascript encryption on sites is gaining popularity with the help of nested eval commands. I recently encountered this encryption on mediaf...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Decrypt Javascript on the example of file hosting mediafire.com</h1><div class="post__text post__text-html js-mediator-article">  Nowadays, javascript encryption on sites is gaining popularity with the help of nested eval commands.  I recently encountered this encryption on mediafire.com file hosting.  Encryption was unusual, I was interested and I decided to understand how well this method works. <br><br>  The site mediafire.com allows you to download files without captcha and at the same time, recently, it has become quite successful in defending against all kinds of automatic robots.  It does this using the built-in javascript code generator.  Moreover, the code is created new each time, which makes it difficult to emulate automatic means. <br><br>  In this article, I will discuss how it is very easy to bypass such protection without deep analysis of the encrypted code and create an automatic script to download files from mediafire.com. <br><a name="habracut"></a><br>  First, let me show you how the code looks like: <br><blockquote><code><a href="http://s-c.me/6062/s"></a> <a href="http://s-c.me/6062/h"></a> <font color="black">Copy Source | Copy HTML <font color="#0000ff">var</font> h5u= <font color="#A31515">''</font> ; <font color="#0000ff">var</font> ybb=unescape( <font color="#A31515">'rev%24l%7Djg9%23%23%3Frev%24swhsp4l9qjawgeta%2C%23%213Bl%213F%216%3Da4c0%2A%2A6%213Bl%&lt;&lt;&lt;     &gt;&gt;&gt;Z%3D--%3Fareh%2Cl%7Djg-%3F'</font> ); <font color="#0000ff">for</font> (i=0;i&lt;1324;i++)h5u=h5u+(String.fromCharCode(ybb.charCodeAt(i)^4)); eval(h5u);</font></code> <ol> <li> <code><font color="black"><a href="http://s-c.me/6062/s"></a> <a href="http://s-c.me/6062/h"></a> Copy Source | Copy HTML <font color="#0000ff">var</font> h5u= <font color="#A31515">''</font> ; <font color="#0000ff">var</font> ybb=unescape( <font color="#A31515">'rev%24l%7Djg9%23%23%3Frev%24swhsp4l9qjawgeta%2C%23%213Bl%213F%216%3Da4c0%2A%2A6%213Bl%&lt;&lt;&lt;     &gt;&gt;&gt;Z%3D--%3Fareh%2Cl%7Djg-%3F'</font> ); <font color="#0000ff">for</font> (i=0;i&lt;1324;i++)h5u=h5u+(String.fromCharCode(ybb.charCodeAt(i)^4)); eval(h5u);</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6062/s"></a> <a href="http://s-c.me/6062/h"></a> Copy Source | Copy HTML <font color="#0000ff">var</font> h5u= <font color="#A31515">''</font> ; <font color="#0000ff">var</font> ybb=unescape( <font color="#A31515">'rev%24l%7Djg9%23%23%3Frev%24swhsp4l9qjawgeta%2C%23%213Bl%213F%216%3Da4c0%2A%2A6%213Bl%&lt;&lt;&lt;     &gt;&gt;&gt;Z%3D--%3Fareh%2Cl%7Djg-%3F'</font> ); <font color="#0000ff">for</font> (i=0;i&lt;1324;i++)h5u=h5u+(String.fromCharCode(ybb.charCodeAt(i)^4)); eval(h5u);</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6062/s"></a> <a href="http://s-c.me/6062/h"></a> Copy Source | Copy HTML <font color="#0000ff">var</font> h5u= <font color="#A31515">''</font> ; <font color="#0000ff">var</font> ybb=unescape( <font color="#A31515">'rev%24l%7Djg9%23%23%3Frev%24swhsp4l9qjawgeta%2C%23%213Bl%213F%216%3Da4c0%2A%2A6%213Bl%&lt;&lt;&lt;     &gt;&gt;&gt;Z%3D--%3Fareh%2Cl%7Djg-%3F'</font> ); <font color="#0000ff">for</font> (i=0;i&lt;1324;i++)h5u=h5u+(String.fromCharCode(ybb.charCodeAt(i)^4)); eval(h5u);</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6062/s"></a> <a href="http://s-c.me/6062/h"></a> Copy Source | Copy HTML <font color="#0000ff">var</font> h5u= <font color="#A31515">''</font> ; <font color="#0000ff">var</font> ybb=unescape( <font color="#A31515">'rev%24l%7Djg9%23%23%3Frev%24swhsp4l9qjawgeta%2C%23%213Bl%213F%216%3Da4c0%2A%2A6%213Bl%&lt;&lt;&lt;     &gt;&gt;&gt;Z%3D--%3Fareh%2Cl%7Djg-%3F'</font> ); <font color="#0000ff">for</font> (i=0;i&lt;1324;i++)h5u=h5u+(String.fromCharCode(ybb.charCodeAt(i)^4)); eval(h5u);</font></code> </li> </ol></blockquote><br>  As you can see from the example, the code is encrypted.  Also, with each access to the page, the code changes: the encryption codes (XOR) change, the eval nesting changes, the names of variables and functions change. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The code calls one of the N functions (generated in html), which in turn turns on one of the N blocks on the screen (also generated in html) and displays it on the screen.  Then, an additional script (also encrypted) is loaded, which writes the links to the pseudo-correct path to the file download to all blocks and writes the correct path to only one of these blocks. <br><br>  So, we need to solve the problem of automatically downloading files from such <br>  system. <br><br>  Draw up a plan of action. <br><br>  1. Download the main page, decrypt and determine which of the N functions is called and which of the N blocks it includes (find out the key) <br>  2. Download the file with links by key, decrypt and determine which of the N links is real (determine by key) <br>  3. Download file <br><br>  Honestly, I dismissed the idea of ‚Äã‚Äãparsing the code and the encryption method right away, since the code is constantly changing, there is no sense in it.  Therefore, I offer you a different way, namely the emulation of some functions of the browser. <br><br>  We will solve this problem with the attraction of improvised means: <a href="http://www.mozilla.org/js/spidermonkey/">spidermonkey</a> . <br><br>  Install spidermonkey on the system (in my FreeBSD example): <br><br> <code>cd /usr/ports/lang/spidermonkey <br> make install clean <br></code> <br>  The biggest problem I encountered is that it is not known in advance where exactly the executable code will save the links and what function it will call.  In order not to parse the code itself, I created some similarity to the getElementById () function, the function is used to load values ‚Äã‚Äãinto a specific HTML element.  I did it like this: <br><blockquote> <code><a href="http://s-c.me/6070/s"></a> <a href="http://s-c.me/6070/h"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  <font color="#A31515">var</font> element = new <font color="#A31515">Object</font> (); </li><li>  element.innerHTML = <font color="#0000ff">""</font> ; </li><li>  <font color="#A31515">var</font> parent = new <font color="#A31515">Object</font> (); </li><li>  parent.document = new <font color="#A31515">Object</font> (); </li><li>  parent.document.getElementById = function theGetElementByID ( <font color="#008000">x</font> ) { </li><li>  print ( <font color="#008000">"HTML:" + element.innerHTML</font> ); </li><li>  print ( <font color="#008000">"\ n"</font> ); </li><li>  print ( <font color="#008000">"ELEMENT:" + x + ":"</font> ); </li><li>  return element; </li><li>  }; </li><li></li><li>  <font color="#008000">// INSERT CODE HERE</font> </li><li></li><li>  print ( <font color="#008000">"HTML:" + element.innerHTML</font> ); </li></ol></blockquote><br>  The code itself, unchanged, is inserted inside this wrapper and executed.  If the code calls the getElementById () function, my code will display everything that is saved in innerHTML. <br><br>  Thus, without changing the code, it becomes possible to determine what and where the script is stored. <br><br>  And in conclusion, I suggest that you familiarize yourself with the working example of downloading files from mediafire.com: <br><blockquote> <code><a href="http://s-c.me/6072/s"></a> <a href="http://s-c.me/6072/h"></a> <a href="http://www.php.net/manual/en/function.fopen.php"></a> <a href="http://www.php.net/manual/en/function.fwrite.php"></a> <a href="http://www.php.net/manual/en/function.fwrite.php"></a> <a href="http://www.php.net/manual/en/function.fwrite.php"></a> <a href="http://www.php.net/manual/en/function.fwrite.php"></a> <a href="http://www.php.net/manual/en/function.fwrite.php"></a> <a href="http://www.php.net/manual/en/function.fclose.php"></a> <a href="http://www.php.net/manual/en/function.unlink.php"></a> <a href="http://www.php.net/manual/en/function.curl-init.php"></a> <a href="http://www.php.net/manual/en/function.curl-setopt.php"></a> <a href="http://www.php.net/manual/en/function.curl-setopt.php"></a> <a href="http://www.php.net/manual/en/function.curl-setopt.php"></a> <a href="http://www.php.net/manual/en/function.curl-setopt.php"></a> <a href="http://www.php.net/manual/en/function.curl-setopt.php"></a> <a href="http://www.php.net/manual/en/function.curl-exec.php"></a> <a href="http://www.php.net/manual/en/function.preg-match-all.php"></a> <a href="http://www.php.net/manual/en/function.preg-match.php"></a> <a href="http://www.php.net/manual/en/function.preg-match.php"></a> <a href="http://www.php.net/manual/en/function.preg-match.php"></a> <a href="http://www.php.net/manual/en/function.curl-setopt.php"></a> <a href="http://www.php.net/manual/en/function.curl-setopt.php"></a> <a href="http://www.php.net/manual/en/function.curl-exec.php"></a> <a href="http://www.php.net/manual/en/function.curl-close.php"></a> <a href="http://www.php.net/manual/en/function.preg-match.php"></a> <a href="http://www.php.net/manual/en/function.preg-match.php"></a> <a href="http://www.php.net/manual/en/function.preg-match.php"></a> <a href="http://www.php.net/manual/en/function.basename.php"></a> <a href="http://www.php.net/manual/en/function.file-exists.php"></a> <a href="http://www.php.net/manual/en/function.fopen.php"></a> <a href="http://www.php.net/manual/en/function.curl-init.php"></a> <a href="http://www.php.net/manual/en/function.curl-setopt.php"></a> <a href="http://www.php.net/manual/en/function.curl-setopt.php"></a> <a href="http://www.php.net/manual/en/function.curl-setopt.php"></a> <a href="http://www.php.net/manual/en/function.curl-setopt.php"></a> <a href="http://www.php.net/manual/en/function.curl-setopt.php"></a> <a href="http://www.php.net/manual/en/function.curl-setopt.php"></a> <a href="http://www.php.net/manual/en/function.curl-setopt.php"></a> <a href="http://www.php.net/manual/en/function.curl-exec.php"></a> <a href="http://www.php.net/manual/en/function.curl-getinfo.php"></a> <a href="http://www.php.net/manual/en/function.curl-close.php"></a> <a href="http://www.php.net/manual/en/function.fclose.php"></a> <a href="http://www.php.net/manual/en/function.print-r.php"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  <font color="#696969">/ *</font> &lt;br/&gt; <font color="#696969">* Copyright (C) AIG</font> &lt;br/&gt; <font color="#696969">* aignospam at gmail.com</font> <font color="#696969">*</font> <font color="#696969">* modification ,</font> <font color="#696969">&lt;/ i * * met:</font> <font color="#696969">&lt;</font> br /&gt; <font color="#696969">* 1. You must have your copyright code</font> <font color="#696969">.</font>  &lt;br/&gt; <font color="#696969">* 2. Redistributions in binary form should be noted</font> <font color="#696969">.</font>  &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">THIS SOFTWARE IS PROVIDED BY AUTHOR AND CONTRIBUTORS `` AS IS '' AND</font> &lt;br/&gt; <font color="#696969">* ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</font> &lt;br/&gt; <font color="#696969">* IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</font> &lt;br/&gt; <font color="#696969">* ARE DISCLAIMED.</font>  <font color="#696969">FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</font> &lt;br /&gt; <font color="#696969">* DAMAGES (INCLUDING, BUT NOT LIMITED, PROCUREMENT OF SUBSTITUTE GOODS</font> &lt;br/&gt; <font color="#696969">* OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)</font> <font color="#696969">* LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE ) ARISING IN ANY WAY</font> &lt;br/&gt; <font color="#696969">* OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</font> &lt;br/&gt; <font color="#696969">* SUCH DAMAGE.</font>  &lt;br/&gt; <font color="#696969">* /</font> </li><li></li><li>  <font color="#0000ff">function</font> jsDecode ( <font color="#cc6633">$ code</font> ) </li><li>  { </li><li>  <font color="#cc6633">$ fh</font> = fopen ( <font color="#008000">'./code.js'</font> , <font color="#008000">'w'</font> ); </li><li>  fwrite ( <font color="#cc6633">$ fh</font> , <font color="#008000">'var element = new Object (); element.innerHTML = "";'</font> ); </li><li>  fwrite ( <font color="#cc6633">$ fh</font> , <font color="#008000">'var parent = new Object (); parent.document = new Object ();'</font> ); </li><li>  fwrite ( <font color="#cc6633">$ fh</font> , <font color="#008000">'parent.document.getElementById = function theGetElementByID (x) {print ("HTML:" + element.innerHTML); print ("\ n"); print ("ELEMENT:" + x + ":" ); return element;}; '</font> ); </li><li>  fwrite ( <font color="#cc6633">$ fh</font> , <font color="#cc6633">$ code</font> ); </li><li>  fwrite ( <font color="#cc6633">$ fh</font> , <font color="#008000">'print ("HTML:" + element.innerHTML);'</font> ); </li><li>  fclose ( <font color="#cc6633">$ fh</font> ); </li><li>  <font color="#0000ff">return</font> `js ./code.js <font color="#008000">2</font> &gt; &amp; 1`; </li><li>  } </li><li></li><li>  <font color="#0000ff">function</font> downloadMediafire ( <font color="#cc6633">$ url</font> ) </li><li>  { </li><li>  <font color="#cc6633">$ cookie_file</font> = <font color="#008000">'./cookie.mediafire.txt'</font> ; </li><li>  @unlink ( <font color="#cc6633">$ cookie_file</font> ); </li><li></li><li>  <font color="#cc6633">$ user_agent</font> = <font color="#008000">"Mozilla / 4.0 (compatible; MSIE 5.01; Windows NT 5.0)"</font> ; </li><li></li><li>  <font color="#cc6633">$ ch</font> = curl_init ( <font color="#cc6633">$ url</font> ); </li><li>  curl_setopt ( <font color="#cc6633">$ ch</font> , CURLOPT_RETURNTRANSFER, <font color="#008000">1</font> ); </li><li>  curl_setopt ( <font color="#cc6633">$ ch</font> , CURLOPT_USERAGENT, <font color="#cc6633">$ user_agent</font> ); </li><li>  curl_setopt ( <font color="#cc6633">$ ch</font> , CURLOPT_FOLLOWLOCATION, <font color="#008000">1</font> ); </li><li>  curl_setopt ( <font color="#cc6633">$ ch</font> , CURLOPT_COOKIEJAR, <font color="#cc6633">$ cookie_file</font> ); </li><li>  curl_setopt ( <font color="#cc6633">$ ch</font> , CURLOPT_COOKIEFILE, <font color="#cc6633">$ cookie_file</font> ); </li><li>  <font color="#cc6633">$ result_parent</font> = curl_exec ( <font color="#cc6633">$ ch</font> ); </li><li></li><li>  <font color="#cc6633">$ referer</font> = <font color="#cc6633">$ url</font> ; </li><li></li><li>  <font color="#696969">// search all functions</font> </li><li>  <font color="#0000ff">if</font> (! preg_match_all ( <font color="#008000">"/ function \ s + ([a-z0-9] +) \ (qk \, pk \, r \) /"</font> , <font color="#cc6633">$ result_parent</font> , <font color="#cc6633">$ match_function_names</font> )) { </li><li>  <font color="#0000ff">print</font> <font color="#008000">"unable to find generated functions \ n"</font> ; </li><li>  <font color="#0000ff">print</font> <font color="#cc6633">$ result_parent</font> ; </li><li>  <font color="#0000ff">return false</font> ; </li><li>  } </li><li></li><li>  <font color="#cc6633">$ code_header</font> = <font color="#008000">''</font> ; </li><li>  <font color="#0000ff">foreach</font> ( <font color="#cc6633">$ match_function_names</font> [ <font color="#008000">1</font> ] <font color="#0000ff">as</font> <font color="#cc6633">$ function_name</font> ) { </li><li>  <font color="#cc6633">$ code_header</font> . = <font color="#008000">'function'</font> ; </li><li>  <font color="#cc6633">$ code_header</font> . = <font color="#cc6633">$ function_name</font> ; </li><li>  <font color="#cc6633">$ code_header</font> . = <font color="#008000">'(qk, pk, r)'</font> ; </li><li>  <font color="#cc6633">$ code_header</font> . = <font color="#008000">'{print ("KEY:" + qk + ":" + pk + ":" + r + ":" + "'</font> . <font color="#cc6633">$ function_name</font> . <font color="#008000">'" + ":");};'</font>  ; </li><li>  } </li><li></li><li>  <font color="#0000ff">if</font> (! preg_match ( <font color="#008000">'/Eo\(\\;;(.*?eval.*?)if/'</font> , <font color="#cc6633">$ result_parent</font> , <font color="#cc6633">$ match_code</font> )) { </li><li>  <font color="#0000ff">print</font> <font color="#008000">"unable to find key code \ n"</font> ; </li><li>  <font color="#0000ff">print</font> <font color="#cc6633">$ result_parent</font> ; </li><li>  <font color="#0000ff">return false</font> ; </li><li>  } </li><li></li><li>  <font color="#696969">// decode eval functions ...</font> </li><li>  <font color="#cc6633">$ code</font> = jsDecode ( <font color="#cc6633">$ code_header</font> . <font color="#cc6633">$ match_code</font> [ <font color="#008000">1</font> ]); </li><li></li><li>  <font color="#0000ff">if</font> (! preg_match ( <font color="#008000">'/KEY:(.*?):(.*?):(.*?):(.*?):/'</font> , <font color="#cc6633">$ code</font> , <font color="#cc6633">$ match_key</font> )) { </li><li>  <font color="#0000ff">print</font> <font color="#cc6633">$ code</font> ; </li><li>  <font color="#0000ff">return false</font> ; </li><li>  } </li><li></li><li>  <font color="#cc6633">$ qk</font> = <font color="#cc6633">$ match_key</font> [ <font color="#008000">1</font> ]; </li><li>  <font color="#cc6633">$ pk</font> = <font color="#cc6633">$ match_key</font> [ <font color="#008000">2</font> ]; </li><li>  <font color="#cc6633">$ r</font> = <font color="#cc6633">$ match_key</font> [ <font color="#008000">3</font> ]; </li><li></li><li>  <font color="#cc6633">$ valid_function_name</font> = <font color="#cc6633">$ match_key</font> [ <font color="#008000">4</font> ]; </li><li></li><li>  <font color="#696969">// search for visible element ...</font> </li><li>  <font color="#0000ff">if</font> (! preg_match ( <font color="#008000">'/ function'</font> . <font color="#cc6633">$ valid_function_name</font> . <font color="#008000">'\ (. *? document.getElementById \ (\' (. {32}) \ '\) /'</font> , <font color="#cc6633">$ result_parent</font> , <font color="#cc6633">$ match_id</font> )) { </li><li>  <font color="#0000ff">print</font> <font color="#cc6633">$ result_parent</font> ; </li><li>  <font color="#0000ff">return false</font> ; </li><li>  } </li><li></li><li>  <font color="#cc6633">$ element_id</font> = <font color="#cc6633">$ match_id</font> [ <font color="#008000">1</font> ]; </li><li></li><li>  <font color="#cc6633">$ url</font> = <font color="#008000">'http://www.mediafire.com/dynamic/download.php?qk='</font> .  <font color="#cc6633">$ qk</font> .  <font color="#008000">'&amp; pk ='</font> .  <font color="#cc6633">$ pk</font> .  <font color="#008000">'&amp; r ='</font> .  <font color="#cc6633">$ r</font> ; </li><li></li><li>  <font color="#0000ff">print</font> <font color="#008000">"URL = $ url \ n"</font> ; </li><li></li><li>  curl_setopt ( <font color="#cc6633">$ ch</font> , CURLOPT_URL, <font color="#cc6633">$ url</font> ); </li><li>  curl_setopt ( <font color="#cc6633">$ ch</font> , CURLOPT_REFERER, <font color="#cc6633">$ referer</font> ); </li><li>  <font color="#cc6633">$ result_fetch</font> = curl_exec ( <font color="#cc6633">$ ch</font> ); </li><li>  curl_close ( <font color="#cc6633">$ ch</font> ); </li><li></li><li>  <font color="#0000ff">if</font> (! preg_match ( <font color="#008000">'/(var\s+et\s*=\s*15.*?)function/'</font> , <font color="#cc6633">$ result_fetch</font> , <font color="#cc6633">$ match_header</font> )) { </li><li>  <font color="#0000ff">print</font> <font color="#008000">"unable to find link header \ n"</font> ; </li><li>  <font color="#0000ff">print</font> <font color="#cc6633">$ result_fetch</font> ; </li><li>  <font color="#0000ff">return false</font> ; </li><li>  } </li><li></li><li>  <font color="#cc6633">$ code_header</font> = <font color="#cc6633">$ match_header</font> [ <font color="#008000">1</font> ]; </li><li></li><li>  <font color="#0000ff">if</font> (! preg_match ( <font color="#008000">'/case\s+15:</font> ( <font color="#008000">..??)break;/'</font> , <font color="#cc6633">$ result_fetch</font> , <font color="#cc6633">$ match_code</font> )) { </li><li>  <font color="#0000ff">print</font> <font color="#008000">"unable to find link code \ n"</font> ; </li><li>  <font color="#0000ff">print</font> <font color="#cc6633">$ result_fetch</font> ; </li><li>  <font color="#0000ff">return false</font> ; </li><li>  } </li><li></li><li>  <font color="#696969">// decode eval functions ...</font> </li><li>  <font color="#cc6633">$ code</font> = jsDecode ( <font color="#cc6633">$ code_header</font> . <font color="#cc6633">$ match_code</font> [ <font color="#008000">1</font> ]); </li><li></li><li>  <font color="#0000ff">if</font> (! preg_match ( <font color="#008000">'/'</font> . <font color="#cc6633">$ element_id</font> . <font color="#008000">'. *? href = "http: \ / \ / ([^"] +) "/'</font> , <font color="#cc6633">$ code</font> , <font color="#cc6633">$ match_url</font> )) { </li><li>  <font color="#0000ff">print</font> <font color="#008000">"unable to find element url \ n"</font> ; </li><li>  <font color="#0000ff">print</font> <font color="#cc6633">$ code</font> ; </li><li>  <font color="#0000ff">return false</font> ; </li><li>  } </li><li></li><li>  <font color="#cc6633">$ file_url</font> = <font color="#cc6633">$ match_url</font> [ <font color="#008000">1</font> ]; </li><li></li><li>  <font color="#0000ff">print</font> <font color="#008000">"URL = $ file_url \ n"</font> ; </li><li></li><li>  <font color="#cc6633">$ file</font> = basename ( <font color="#cc6633">$ file_url</font> ); </li><li>  <font color="#cc6633">$ url</font> = <font color="#008000">"http: // $ file_url"</font> ; </li><li></li><li>  <font color="#0000ff">if</font> (file_exists ( <font color="#cc6633">$ file</font> )) { </li><li>  <font color="#0000ff">return true</font> ; </li><li>  } </li><li></li><li>  <font color="#cc6633">$ fp</font> = fopen ( <font color="#cc6633">$ file</font> , <font color="#008000">'w'</font> ); </li><li></li><li>  <font color="#cc6633">$ ch</font> = curl_init ( <font color="#cc6633">$ url</font> ); </li><li>  curl_setopt ( <font color="#cc6633">$ ch</font> , CURLOPT_RETURNTRANSFER, <font color="#008000">1</font> ); </li><li>  curl_setopt ( <font color="#cc6633">$ ch</font> , CURLOPT_USERAGENT, <font color="#cc6633">$ user_agent</font> ); </li><li>  curl_setopt ( <font color="#cc6633">$ ch</font> , CURLOPT_FOLLOWLOCATION, <font color="#008000">1</font> ); </li><li>  curl_setopt ( <font color="#cc6633">$ ch</font> , CURLOPT_COOKIEJAR, <font color="#cc6633">$ cookie_file</font> ); </li><li>  curl_setopt ( <font color="#cc6633">$ ch</font> , CURLOPT_COOKIEFILE, <font color="#cc6633">$ cookie_file</font> ); </li><li>  curl_setopt ( <font color="#cc6633">$ ch</font> , CURLOPT_REFERER, <font color="#cc6633">$ referer</font> ); </li><li>  curl_setopt ( <font color="#cc6633">$ ch</font> , CURLOPT_FILE, <font color="#cc6633">$ fp</font> ); </li><li>  <font color="#cc6633">$ result</font> = curl_exec ( <font color="#cc6633">$ ch</font> ); </li><li>  <font color="#cc6633">$ info</font> = curl_getinfo ( <font color="#cc6633">$ ch</font> ); </li><li>  curl_close ( <font color="#cc6633">$ ch</font> ); </li><li></li><li>  fclose ( <font color="#cc6633">$ fp</font> ); </li><li></li><li>  <font color="#0000ff">if</font> ( <font color="#cc6633">$ info</font> [ <font color="#008000">'http_code'</font> ]! = <font color="#008000">200</font> ) { </li><li>  print_r ( <font color="#cc6633">$ info</font> ); </li><li>  <font color="#0000ff">return false</font> ; </li><li>  } </li><li></li><li>  <font color="#0000ff">return true</font> ; </li><li>  } </li><li></li></ol></blockquote></div><p>Source: <a href="https://habr.com/ru/post/87705/">https://habr.com/ru/post/87705/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../87693/index.html">Free set of icons for favorite programs Lupoglaziki 2</a></li>
<li><a href="../87697/index.html">Creating a testing department is simple</a></li>
<li><a href="../87701/index.html">March 17 - Softkey webinar "Acronis Backup & Recovery 10. New product - new features"</a></li>
<li><a href="../87702/index.html">HTC Legend price announced in Russia</a></li>
<li><a href="../87704/index.html">Financial management for enterprising people</a></li>
<li><a href="../87712/index.html">Evernote API - parse article headers from Habr and mark articles with tags</a></li>
<li><a href="../87713/index.html">Under the [p] ear for singles. Project Funktionide</a></li>
<li><a href="../87714/index.html">Survey for designers: do you have the appropriate education?</a></li>
<li><a href="../87717/index.html">NVIDIA has developed applications for 3D games on the TV</a></li>
<li><a href="../87718/index.html">Engine "caffeine"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>