<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Create your file system in Windows OS on .Net</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There are a great many file systems. These include file systems for storage media (FAT *, NTFS, ext *, etc.), network file systems (NFS, CIFS, etc.), ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Create your file system in Windows OS on .Net</h1><div class="post__text post__text-html js-mediator-article">  There are a great many file systems.  These include file systems for storage media (FAT *, NTFS, ext *, etc.), network file systems (NFS, CIFS, etc.), virtual file systems, and a great many <a href="http://ru.wikipedia.org/wiki/%25D0%25A4%25D0%25B0%25D0%25B9%25D0%25BB%25D0%25BE%25D0%25B2%25D0%25B0%25D1%258F_%25D1%2581%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0">others</a> .  Did you,% habrauser%, have a need for your own, non-existent file system?  How to do it for Windows on a managed-code (.net), and will be discussed. <a name="habracut"></a><br><br>  In general, to create your own file system (hereinafter called FS), you need to write the driver of this file system and register it with the OS.  Because  Since the driver interacts with the OS kernel, then creating it on a managed code is not a trivial matter, and the performance of such a driver will be at a low level.  In this regard, it is more expedient to have a FS driver written in native code and some intermediate layer between this driver and the managed code.  Such a driver exists in the <a href="http://dokan-dev.net/en/download/">Dokan</a> project, as well as a set of <a href="http://dokan-dev.net/en/download/">DokanNet</a> classes for interacting with this driver in managed code.  Both projects are distributed under the GPLv3 license. <br><br><h4>  Let's try to figure out how it works. </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Dokan</b> is a Windows kernel-based driver with which any applications from userspace can interact.  The driver exists for both 32-bit systems and 64-bit systems.  The driver does not carry the implementation of any FS, but only acts as a proxy, passing all input-output operations (IO) from the OS kernel into the userspace.  The implementation of the FS functionality lies on our shoulders, we create the basic functions of the FS, such as opening / closing a file, reading from a file, writing to a file, etc., which will be called by the Dokan driver when corresponding events occur in the system.  At the time of registration of our file system in the Dokan driver, we specify some parameters of our file system (the number of threads handling I / O operations, the mount point of our file system (Dokan supports mounting as a removable or network drive and only to the root file system), automatic unmounting our FS, in case of errors in the work, and some other parameters).  After this, a new disk appears in the OS at the root of the file system, with which any applications and the OS itself interact, as with a regular disk.  What operations are allowed to be performed in this FS depends only on the developer of this FS, that is, on us. <br><br>  <b>DokanNet</b> is a wrapper over the Dokan driver.  Allows you to develop your file system on a managed code.  DokanNet describes the DokanOperations interface that you need to implement to register our file system in the Dokan driver.  The author of DokanNet along with the source code of the project itself put 2 examples of working with this wrapper: <br><ul><li>  DokanNetMirror - FS mirror of an existing directory </li><li>  RegistoryFS - FS, representing the structure of the Windows registry in directories and files </li></ul><br>  Sample codes are easily readable and allow you to familiarize yourself with the features provided by the Dokan driver. <br><br>  The implementation of the DokanOperations interface comes down to the implementation of the following functions: <br><ul><li>  CreateFile - create files / directories </li><li>  OpenDirectory - open directory </li><li>  CreateDirectory - create directory </li><li>  Cleanup - delete file / empty directory </li><li>  CloseFile - closing a file descriptor </li><li>  ReadFile - reading a piece of a file of the specified length with the specified offset </li><li>  WriteFile - write data to the file with the specified offset </li><li>  FlushFileBuffers - clearing file buffers (cache) </li><li>  GetFileInformation - getting information about the size, attributes, time of creation / last access / modification of the file / directory </li><li>  FindFiles - getting the list of files / directories in the specified directory </li><li>  SetFileAttributes - setting file / directory attributes </li><li>  SetFileTime - setting the time of creation / last access / modification of the file / directory </li><li>  DeleteFile - mark file for deletion (deletion is performed in Cleanup) </li><li>  DeleteDirectory - mark the directory for deletion (deletion is performed in Cleanup) </li><li>  MoveFile - move / rename file / directory </li><li>  SetEndOfFile - setting the file size (used when creating an empty file of a certain length) </li><li>  SetAllocationSize - the author has not indicated what this function is necessary for; in practice, the transfer of control to it is not seen. </li><li>  LockFile - lock file in single-access </li><li>  UnlockFile - unlock </li><li>  GetDiskFreeSpace - getting information about the amount of available / total / free space in the file system </li><li>  Unmount - unmount / unmount FS </li></ul><br><br>  As we can see, the functionality provided by the Dokan driver and DokanNet wrapper is very rich.  Based on this project, the <a href="http://dokan-dev.net/en/download/">SSHFS</a> FS has been <a href="http://dokan-dev.net/en/download/">developed</a> .  Anyone can develop a file system that meets their requirements.  I stopped on the development of HttpFS, which will allow to mount files on remote Http-servers into the system.  But more about that in the next article ... </div><p>Source: <a href="https://habr.com/ru/post/111186/">https://habr.com/ru/post/111186/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../111178/index.html">Silverlight + Augmented reality + Shaders</a></li>
<li><a href="../111181/index.html">Selecting a VPS in Germany and installing Archlinux on it</a></li>
<li><a href="../111182/index.html">Products phantoms (Vaporware) for 11 years. Article One - 1999</a></li>
<li><a href="../111183/index.html">Tuning rubber text field</a></li>
<li><a href="../111185/index.html">Firefox has shifted IE from first place in Europe</a></li>
<li><a href="../111187/index.html">Direct Fuzzy Inference</a></li>
<li><a href="../111188/index.html">Himself service screenshots</a></li>
<li><a href="../111189/index.html">Do you know JAVA,% username%?</a></li>
<li><a href="../111191/index.html">Micro-framework Robotlegs. Overview of injecting methods</a></li>
<li><a href="../111192/index.html">School website</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>