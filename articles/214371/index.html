<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Contract programming in PHP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In real life, we are everywhere faced with various contracts: when applying for a job, when doing work, when signing mutual agreements, and many other...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Contract programming in PHP</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/853/88b/cfd/85388bcfd9c8f4c4ce656fe013ce1e92.jpg" alt="Contract Programming" align="right" height="200">  In real life, we are everywhere faced with various contracts: when applying for a job, when doing work, when signing mutual agreements, and many others.  The legal validity of contracts guarantees our protection of interests and does not allow their violation without consequences, which gives us confidence that the items described in the contract will be fulfilled.  This confidence helps us plan time, plan expenses, and plan the necessary resources.  And what if the program code will be described by contracts?  Interesting?  Then welcome under the cat! <br><a name="habracut"></a><br><h4>  Introduction </h4><br>  The very idea of ‚Äã‚Äãcontract programming originated in the 90s with Bertrand Meyer when developing the object-oriented programming language <a href="http://ru.wikipedia.org/wiki/%25D0%25AD%25D0%25B9%25D1%2584%25D0%25B5%25D0%25BB%25D1%258C_(%25D1%258F%25D0%25B7%25D1%258B%25D0%25BA_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F)">Eiffel</a> .  The essence of Bertrand's idea was that it was necessary to have a tool for describing formal verification and formal specification of code.  Such a tool would give specific answers: ‚Äúthe method undertakes to do its work if you fulfill the conditions necessary to call it‚Äù.  And contracts could not be better suited for this role, because they allowed us to describe what will be received from the system (specification) in case of compliance with preconditions (verification).  Since then, there have been many implementations of this programming methodology, both at the level of a specific language and in the form of separate libraries, allowing to set contracts and verify them with external code.  Unfortunately, in PHP there is no support for contract programming at the level of the language itself, so the implementation can only be done using third-party libraries. <br><br><h4>  Contracts in code </h4><br>  Since contract programming was developed for an object-oriented language, it is not difficult to guess that the main working elements for contracts are classes, methods, and properties. <br><br><h6>  Preconditions </h6><br>  The simplest version of the contract are <i>preconditions</i> - requirements that must be met before a specific action.  Within the framework of OOP, all actions are described by methods in classes, therefore preconditions are applied to methods, and they are checked at the time the method is called, but before the method body itself is executed.  The obvious use is to check the validity of the passed parameters to the method, their structure and correctness.  That is, using preconditions, we describe in the contract everything that we will not work with.  This is great! 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Not to be unfounded, let's consider an example: <br><br><pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BankAccount</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $balance = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Deposits fixed amount of money to the account * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> float $amount */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deposit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($amount)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($amount &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span> || !is_numeric($amount)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \InvalidArgumentException(<span class="hljs-string"><span class="hljs-string">"Invalid amount of money"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;balance += $amount; } }</code> </pre> <br><br>  We see that the method of replenishing the balance implicitly requires a numerical value of the amount of the amount of replenishment, which must also be strictly greater than zero, otherwise an exception will be thrown.  This is a typical precondition in the code.  However, it has several drawbacks: we are forced to look for these checks through our eyes and, being in a different class, we cannot quickly assess the presence / absence of such checks.  Also, without an explicit contract, we will have to remember that the class code contains the necessary checks for the incoming arguments and we don‚Äôt have to worry about them.  Another factor: these checks are always performed, both in the development mode and in the combat mode of the application, which has a slight negative effect on the speed of the application. <br><br>  In terms of the implementation of preconditions, in PHP there is a special construct for verifying assertions - <a href="http://php.net/assert">assert ()</a> .  Its great advantage is that checks can be disabled in combat mode, replacing the entire command code with a single <abbr title="No OPeration - no operation">NOP</abbr> .  Let's look at how to describe the precondition with this construct: <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BankAccount</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $balance = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Deposits fixed amount of money to the account * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> float $amount */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deposit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($amount)</span></span></span><span class="hljs-function"> </span></span>{ assert(<span class="hljs-string"><span class="hljs-string">'$amount&gt;0 &amp;&amp; is_numeric($amount); /* Invalid amount of money /*'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;balance += $amount; } }</code> </pre><br>  I want to draw attention to the fact that preconditions within the framework of contracts are used to check the logs of the program and are not responsible for the validity of the parameters transmitted from the client.  Contracts are only responsible for interaction within the system itself.  Therefore, user input should always be filtered using filters, since assertions can be turned off. <br><br><h6>  Postconditions </h6><br>  The next category of contracts is <i>post conditions</i> .  As the name suggests, this type of check is performed after the method body has been executed, but until control returns to the calling code.  For our <code>deposit</code> method from the example, we can form the following postcondition: the balance of the account after calling the method should be equal to the previous value of the balance plus the amount of replenishment.  The only thing left to do is to describe all this in the form of a statement in the code.  But here we are waiting for the first disappointment: how to form this requirement in the code, because we first change the balance in the body of the method itself, and then try to check the statement where the old value of balance is needed.  Cloning an object before executing a code and checking post-conditions can help here: <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BankAccount</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $balance = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Deposits fixed amount of money to the account * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> float $amount */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deposit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($amount)</span></span></span><span class="hljs-function"> </span></span>{ $__old = <span class="hljs-keyword"><span class="hljs-keyword">clone</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>; assert(<span class="hljs-string"><span class="hljs-string">'$amount&gt;0 &amp;&amp; is_numeric($amount); /* Invalid amount of money /*'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;balance += $amount; assert(<span class="hljs-string"><span class="hljs-string">'$this-&gt;balance == $__old-&gt;balance+$amount; /* Contract violation /*'</span></span>); } }</code> </pre><br><br>  Another disappointment awaits us when describing postconditions for methods that return a value: <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BankAccount</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $balance = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Returns current balance */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getBalance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;balance; } }</code> </pre><br>  How to describe here the contract condition that the method should return the current balance?  Since the post-condition is executed after the body of the method, we will stumble on <code>return</code> earlier than our test works.  Therefore, you will have to change the method code in order to save the result in the <code>$__result</code> variable and then compare it with <code>$this-&gt;balance</code> : <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BankAccount</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $balance = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Returns current balance */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getBalance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $__result = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;balance; assert(<span class="hljs-string"><span class="hljs-string">'$__result == $this-&gt;balance; /* Contract violation /*'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $__result; } }</code> </pre><br><br>  And this is for a simple method, not to mention the case when the method is large and has several cusps.  As you already guessed, at this stage ideas about using contract programming in a PHP project quickly die, since the language does not support the necessary control structures.  But there is a solution!  And about him will be written below, have a little patience. <br><br><h6>  Invariants </h6><br>  It remains for us to consider another important type of contract: <i>invariants</i> .  Invariants are special conditions that describe the integral state of an object.  An important feature of invariants is that they are always checked after calling any public method in the class and after calling the constructor.  Since the contract determines the state of the object, and public methods - the only way to change the state from the outside, we get the complete specification of the object.  For our example, a condition can be a good invariant: an account balance should never be less than zero.  However, with invariants in PHP, the situation is even worse than with postconditions: there is no way to easily add a check to all public methods of a class, so that after calling any public method, you can check the necessary condition in the invariant.  It is also not possible to refer to the previous state of the <code>$__old</code> object and the returned result of <code>$__result</code> .  There are no contracts without invariants, so for a long time there were no means and methods for implementing this functionality. <br><br><h4>  New opportunities </h4><br>  Meet PhpDeal - an experimental <abbr title="Design by Contract">DbC</abbr> - <a href="https://github.com/lisachenko/php-deal">framework for contract programming in PHP</a> . <br>  Once the <a href="https://github.com/lisachenko/go-aop-php">Go! Framework has</a> been developed <a href="https://github.com/lisachenko/go-aop-php">!</a>  <a href="https://github.com/lisachenko/go-aop-php">AOP for aspect-oriented programming in PHP</a> , I had thoughts in my head about automatic parameter validation, condition checking, and much, much more.  A trigger for creating a project for contract programming was a discussion in <a href="http://grokbase.com/t/php/php-internals/141wpxrw6r/dbc-for-php">PHP.Internals</a> .  Surprisingly, with the help of AOP, the problem was solved in just a couple of actions: it was necessary to describe an aspect that would intercept the execution of methods marked with contract annotations and perform the necessary checks before or after calling the method. <br><br>  Let's take a look at how contracts can be used with this framework: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PhpDeal</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">Contract</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Simple trade account class * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Contract</span></span></span><span class="hljs-comment">\Invariant("$this-&gt;balance &gt; 0") */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Account</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AccountContract</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * Current balance * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> float */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $balance = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Deposits fixed amount of money to the account * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> float $amount * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Contract</span></span></span><span class="hljs-comment">\Verify("$amount&gt;0 &amp;&amp; is_numeric($amount)") * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Contract</span></span></span><span class="hljs-comment">\Ensure("$this-&gt;balance == $__old-&gt;balance+$amount") */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deposit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($amount)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;balance += $amount; } <span class="hljs-comment"><span class="hljs-comment">/** * Returns current balance * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Contract</span></span></span><span class="hljs-comment">\Ensure("$__result == $this-&gt;balance") * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> float */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getBalance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;balance; } }</code> </pre><br><br>  As you have noticed, all contracts are described as annotations inside the dock blocks and contain the necessary conditions inside the annotation itself.  There is no need to change the original executable code of the class, it remains as clean as the code without contracts. <br><br>  Preconditions are specified using the <code>Verify</code> annotation and determine the checks that will be performed at the time the method is called, but before the method body itself is executed.  Preconditions work in the scope of the class method, so they have access to all properties, including private ones, and also have access to the method parameters. <br><br>  Postconditions are specified by annotation, which has the standard name <code>Ensure</code> in terms of contract programming.  The code has a similar scope, as the method itself, in addition, the variables <code>$__old</code> with the state of the object before the method is executed and the variable <code>$__result</code> , which contains the value that was returned from this method. <br><br>  Thanks to the use of AOP, it became possible to implement even invariants - they are elegantly described in the form of <code>Invariant</code> annotations in the class dock and behave similarly to postconditions, but for all methods. <br><br>  While experimenting with code, I discovered an amazing similarity of contracts with interfaces in PHP.  If the standard interface determines the requirements for the standard of interaction with the class, then the contracts allow to describe the requirements for the state of the class instance.  Using the description of the contract in the interface, it is possible to describe the requirements for both interaction with the object and the state of the object, which will then be implemented in the class: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PhpDeal</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">Contract</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Simple trade account contract */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AccountContract</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * Deposits fixed amount of money to the account * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> float $amount * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Contract</span></span></span><span class="hljs-comment">\Verify("$amount&gt;0 &amp;&amp; is_numeric($amount)") * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Contract</span></span></span><span class="hljs-comment">\Ensure("$this-&gt;balance == $__old-&gt;balance+$amount") */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deposit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($amount)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Returns current balance * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Contract</span></span></span><span class="hljs-comment">\Ensure("$__result == $this-&gt;balance") * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> float */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getBalance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre><br><br>  Then the most interesting begins: when creating a class and determining the desired method, any modern IDE transfers all the annotations from the method description in the interface to the class itself.  And this allows the PhpDeal engine to find them and provide automatic verification of contracts in each particular class that implements this interface.  For those who want to feel everything with their own hands, you can download the project from the github, install all dependencies using a composer, set up a local web server to this folder and then simply open the code from the <a href="https://github.com/lisachenko/php-deal/tree/master/demo">demo</a> folder in your browser <br><br><h4>  Conclusion </h4><br>  Contract programming in PHP is a completely new paradigm that can be used for defensive programming, to improve the quality of the code and ensure the readability of contracts, defined as requirements and specifications.  The big plus of this implementation is that the code of the classes remains readable, the annotations themselves are read as documentation, and also that in combat mode the check can be completely disabled and does not require absolutely no time for additional unnecessary checks in the code.  Interesting fact: the frame framework itself contains only a couple of annotations and one aspect class that links these annotations with specific logic. <br><br>  Thank you for attention! <br><br>  Related Links: <br><ol><li>  <a href="http://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BE%25D0%25BD%25D1%2582%25D1%2580%25D0%25B0%25D0%25BA%25D1%2582%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">Wikipedia - contract programming</a> </li><li>  <a href="https://github.com/lisachenko/php-deal">PhpDeal framework for contract programming in PHP</a> </li><li>  <a href="https://github.com/lisachenko/go-aop-php">Framework Go!</a>  <a href="https://github.com/lisachenko/go-aop-php">AOP for aspect-oriented programming in PHP</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/214371/">https://habr.com/ru/post/214371/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../214355/index.html">We program a microwave or controller 40 years ago</a></li>
<li><a href="../214359/index.html">Video banned on YouTube due to the 5-second presence of the actress</a></li>
<li><a href="../214361/index.html">Lenovo's first mobile trade show: MWC 2014</a></li>
<li><a href="../214363/index.html">Introducing Nokia Imaging SDK 1.1 with support for Windows 8.1 and Windows RT 8.1</a></li>
<li><a href="../214367/index.html">Dykstra from Tim from Stanford</a></li>
<li><a href="../214373/index.html">Starry Sky on Canvas. Constellations</a></li>
<li><a href="../214377/index.html">Iron in the service of the algorithm (continued)</a></li>
<li><a href="../214379/index.html">How signals and slots work in Qt (part 1)</a></li>
<li><a href="../214385/index.html">Results Tizen App Chellange</a></li>
<li><a href="../214387/index.html">My smart home on .NET</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>