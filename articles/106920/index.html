<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Win32 and .NET application protection: Themida (X-Protector) review</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This review is dedicated to Themida (in the past X-Protector), one of the most powerful and reliable protectors of Win32 applications. Since I recentl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Win32 and .NET application protection: Themida (X-Protector) review</h1><div class="post__text post__text-html js-mediator-article">  This review is dedicated to <a href="http://www.themida.com/">Themida</a> (in the past X-Protector), one of the most powerful and reliable protectors of Win32 applications.  Since I recently needed Themida for one of my applications, I decided to write a short review on it.  At the same time asked the author to answer some questions that interest me.  I think the answers will be interesting to you too.  Find the results of this short interview at the end of the article. <br><br>  I want to note that the article is based on Themida version 2.1.3.30, the last one as of the date of this review.  It has several new features in terms of macros.  Demo two years ago with on the official site, they are deprived. <br><br> <a href="http://img268.imageshack.us/i/62745491.jpg/"><img src="http://img268.imageshack.us/img268/2432/62745491.th.jpg"></a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><h1>  Basic information </h1><br><br>  In fact, there are four products based on Themida technology. <br><ul><li>  <a href="http://www.themida.com/themida.php">Themida</a> (Basic ‚Ç¨ 149 / Professional ‚Ç¨ 199) </li><li>  <a href="http://www.themida.com/winlicense.php">WinLicense</a> (Basic ‚Ç¨ 349 / Professional ‚Ç¨ 399) </li><li>  <a href="http://www.themida.com/xbundler.php">X-Bundler</a> (Basic 79 ‚Ç¨ / Professional 119 ‚Ç¨) </li><li>  <a href="http://www.themida.com/wdc.php">WinLicense DLL Control</a> (99 ‚Ç¨) </li><li>  <a href="http://www.themida.com/codevirtualizer.php">Code Virtualizer</a> (59 ‚Ç¨) </li></ul><br>  Basic version from Professional differs only in the lack of ability to work with .NET applications.  Everything that we will talk about further, works both in Themida and in WinLicense. <br><ul><li>  <b>Themida</b> is the protector itself, which is the main subject of this article. </li><li>  <b>WinLicense</b> is Themida with the addition of the ability to protect applications based on all sorts of serial numbers.  The WinLicense SDK is able to generate these serial numbers, check them, safely store, link to hardware, create trial serials with expiration by a specified date or after a specified number of launches, create password-protected applications and so on. </li><li>  <b>X-Bundler</b> is a plugin for Themida and WinLicense that allows you to embed external files into a secure application.  For example, you can embed a help file or a * .mp3 file.  Moreover, it is possible to access this file from the application as an external one lying on the disk.  The application and will not know that the file is protected by Themida and is inside your * .exe.  You can also embed the assembly used by the .NET application inside the main * .exe file. </li><li>  <b>WinLicense DLL Control</b> is a plugin for WinLicense, with which you can implement your security options based on serial numbers. </li><li>  <b>CodeVirtualizer</b> is a small independent piece of Themida that allows you to exclusively convert the specified functions inside your application into code for a Themida virtual machine.  It does not provide any other protection (protection against debugging, encryption, integrity checks, etc. it does not exist).  Allows you to protect both x32 and x64 applications, including drivers. </li></ul><br><h1>  Themida automatic protection features </h1><br>  First, about the "boring platitudes". <br><ul><li>  <b>Anti-debugger.</b>  It supports both the detection of standard debuggers and kernel-level debuggers.  There is also an aggressive search mode, but in this case, the application may refuse to run on computers with active anti-viruses, rootkits, or under Wine. </li><li>  <b>Antidumper.</b>  Themida protects applications continuously.  Dumping the memory of an application to a disk and then launching it will not remove protection (who would doubt. ... Such primitive methods have not worked for a long time) </li><li>  <b>Entry Obfuscation (OEP).</b>  Themida hides the entry point to the library or application. </li><li>  Encryption resources.  If your application includes any resources (icons, files, and so on), they will be encrypted and decrypted only when they are accessed. </li><li>  <b>VMWare / VirtualPC compatibility.</b>  You can activate this mode so that the protected application can run under hypervisors. </li><li>  <b>Wrapping Windows API calls.</b>  Themida hides information about the Windows API functions that your application calls.  Information about the required libraries to run is also not available to the hacker. </li><li>  <b>Protection of the application from modification.</b>  Themida can check the integrity of the application when it starts, without allowing the modified copy of the application to start.  You can activate the mode in which the application after protection can be freely signed. </li><li>  <b>Protecting the application's memory from modification</b> during execution (useful if you are developing, for example, a game). </li><li>  <b>Technology code mutation.</b>  All Themida core code that binds to your application is mutated and smeared.  Each time this code is generated anew using virtualization techniques (see below). </li><li>  <b>Protection from monitoring files and registry.</b>  Themida does not allow external programs to track a protected application to files or registry. </li><li>  <b>Compression.</b>  Overlay protection leads to a rather strong increase in the size of the executable file on disk.  To reduce this size, Themida supports the compression of both the application itself (with a built-in security code) and its resources. </li><li>  <b>Themida is able to protect Delphi / C ++ Builder forms</b> from a special way.  The contents of the forms (in fact, a * .dfm file) cannot be extracted from both * .exe and during the execution of the application. </li></ul><br>  Almost all the features described can be turned on / off as you wish. <br><br><h1>  CodeReplace technology </h1><br>  The CodeReplace technology extracts parts of the application, inserts a garbage code instead, mixes the original code with the security code and stores it elsewhere in the application.  When running a portion of the code protected by CodeReplace, after numerous checks, it is extracted and decrypted.  After execution, it is replaced again with garbage.  Themida can analyze your application itself and select functions that seem appropriate to it for such protection.  But it will be better if you do it yourself using macros (they will be discussed later). <br><br> <a href="http://img195.imageshack.us/i/12272378.jpg/"><img src="http://img195.imageshack.us/img195/6166/12272378.th.jpg"></a> <br><br><h1>  Virtual machine </h1><br>  Themida virtual machine is one of the most powerful ways to protect an application.  Its essence lies in the fact that parts of your code are replaced by the generated assembler code, but not native to Intel processors, but by the code for an abstract virtual processor with its command system and internal structure.  Themida each time randomly generates a plan for its architecture.  Thus, the protection code becomes difficult to understand. <br>  Themida supports several types of virtual processors: <br><ul><li>  CISC.  Basic security, protected code runs relatively quickly. </li><li>  CISC-2.  Extended protection, code takes up more space than in the case of CISC.  Slightly slower. </li><li>  RISC-64.  Each virtual instruction takes 64 bits, protection is stronger than that of CISC, but the protected code is executed slowly. </li><li>  RISC-128.  Advanced super-slow and super-secure version of RISC-64 </li></ul><br>  For CISC processors, simultaneous embedding of several virtual processors of the same type, but with a different system of commands, into a protected application is supported.  This increases security, but increases the size of the executable application code. <br><br>  Generating noise allows you to mix useful instructions that do not mean anything that would make the hacker more difficult to work. <br><br>  As in the case of CodeReplace, Themida can choose which functions within your program to protect by converting to code for a virtual machine.  But it is better to do it yourself (see below). <br><br> <a href="http://img251.imageshack.us/i/30658929.jpg/"><img src="http://img251.imageshack.us/img251/1926/30658929.th.jpg"></a> <br><br><h1>  Other </h1><br><ul><li>  Themida allows you to hide the application from PE scanners, which determine how the application is protected. </li><li>  Localization options are available for the application interface (windows with errors and system messages) and inserting splash screens (the startup time of the protected application increases by 500-5000 milliseconds depending on the protection settings, you need to take something at this time). </li><li>  Themida supports management from the command line, which allows it to be integrated into the Build system. </li></ul><br>  Now for a bit of sadness.  Even if you use everything listed above, your application can still be broken.  To make it harder for a hacker to work, you should use Themida macros.  About them now and talk. <br><br><h1>  Macros Themida. </h1><br>  Themida macros are byte sequences that are embedded in an application that do not affect its operation until you protect the Themida application.  They have a special meaning for the tread.  In fact, they inform Themida about the intricacies of the internal structure of your code, allowing you to more effectively protect it. <br>  Macros have start and end markers, defining the amount of source code to which they apply.  Ready macros in the SDK are for assembler, C, D, Delphi and VisualBasic / Pure Basic.  But in principle, they can be altered in two minutes to any language that supports assembly or simply byte inserts into the code.  Here I will use the Delphi syntax that is closest to me. <br><br>  <b>Attention!</b>  Macros cannot be used in .NET and Visual Basic applications compiled into P-code. <br><br><h2>  VM </h2><br>  The VM macro restricts the area of ‚Äã‚Äãcode that Themida should virtualize (turn into instructions for a virtual machine, the settings of which you specify in the interface).  Used as follows: <br><br> <code>{$I VM_Start.inc} <br> //   <br> {$I VM_End.inc} <br></code> <br><br>  In this macro, it is recommended to wrap sections of code whose algorithm is of particular secrecy.  For example, checking the activation key, decrypting data files, checking for the presence of a protection key, and so on. <br><br>  <b>Limitations:</b> <br><ul><li>  There should be no work with exceptions directly inside the block (try, raise) </li><li>  No other macros are allowed inside the block. </li></ul><br><br><h2>  VM_WithLevel </h2><br>  The macro is similar to the VM macro in all, but provides additional protection by increasing the level of virtualization by the amount you specify.  It is also used.  To indicate the required level of virtualization, you will have to edit the corresponding * .inc file in Delphi (see the commentary in it).  A large value of the virtualization level will lead to a strong bloat on the code.  At level 0, the macro behaves the same way as the VM macro. <br><br>  The limitations are the same as the VM macro. <br><br><h2>  CodeReplace </h2><br>  The macro marks the code for processing by CodeReplace technology, which we talked about above.  Used in the same way as the VM macro. <br>  The limitations are the same as the VM macro. <br>  Encode <br>  The macro marks a block of code that you want to encrypt and decrypt only before execution, encrypting it back when you exit the block.  Used as well as the VM macro.  This macro provides weaker protection than the VM and CodeReplace macros, but the code under it runs much faster. <br><br>  <b>Limitations:</b> <br><ul><li>  Cannot be used in DLL </li><li>  You cannot declare variables or exit a procedure inside a block (return / exit) </li></ul><br><br><h2>  Clear </h2><br>  The macro marks the block of code that will be removed from the process after the first call.  This macro is recommended for operations that your program performs only once per launch.  For example, the calculation of session keys for data exchange or checking the presence of a license key.  Used in the same way as the VM macro. <br><br>  <b>Limitations:</b> <br><ul><li>  Cannot be used in DLL </li></ul><br><br><h2>  Unprotected </h2><br>  Marks the block to be removed from the application after protection.  For example, it can be used to make an application report if it is not protected.  It is used as well as all the described macros.  There are no restrictions. <br><br><h2>  CheckProtection </h2><br>  In the demo version of Themida this macro is not available.  It is used to verify the security of the application.  Its use is best shown by an example taken from Themida SDK. <br><pre> procedure TForm1.Button4Click (Sender: TObject);
 var
   StatusProtection: Integer;
 begin
     {$ I CheckProtection_Prolog.inc}
     asm
       push $ 33333333
       pop StatusProtection
     end;
     {$ I CheckProtection_Epilog.inc}
     if StatusProtection = $ 33333333 then
       MessageBox (0, 'Protection OK.', 'Protection Check Macro', MB_OK + MB_ICONINFORMATION)
     else
       MessageBox (0, 'Application protection violated!', 'Attention!', MB_OK + MB_ICONERROR);
 end;
</pre><br>  You define a number (of type Integer / Cardinal) that the macro should return in case the security is OK.  In this example, 0x33333333.  When protection is applied, assembler instructions push and pop will be removed from the program.  Instead, a complex verification procedure will be inserted, which will return the specified number in the specified variable (in our example, the StatusProtection), if it does not detect any security violations.  In case of detection of a security breach, the number will be random. <br><br>  Of course, in real life as shown, this macro cannot be used.  The simplest thing is to take any important constant used in the project, the value of which is not too obvious in the context and replace it with a variable.  Then use this macro on this new variable somewhere early in the code.  If the protection is removed, the value of this constant / variable will be incorrect, which most likely will lead to the collapse of the application in the most unexpected places. <br><br>  Inside the macro block there should not be anything other than the specified assembler instructions. <br><br><h2>  CheckCodeIntegrity </h2><br>  In the demo version of Themida this macro is not available.  The macro is very similar to CheckProtection, it just works with another part of the protection system.  Its use is absolutely similar. <br><br><h2>  CheckVirtualPC </h2><br>  In the demo version of Themida this macro is not available.  The macro is similar to the previous two, but it does not check for the presence of a protection system, but to launch a protected application under a hypervisor like VirtualPC or VMWare.  Its use is absolutely similar.  Unless it is worth combining with the corresponding checkbox in the program interface.  Then, in a protected application, upon detection of a launch under the hypervisor, Themida will issue a warning, and if under VirtualPC they try to launch an application version with the Themida protection part removed, a macro will help you out. <br><br><h1>  Protection features of .NET applications. </h1><br>  Despite the fact that Themida can protect .NET applications, you need to keep in mind the following: <br><ul><li>  After protection. NET application (*. Exe) ceases to be. NET assembly and becomes a normal Win32 application (with preservation, however, of all its functions, was checked on *. Exe file Paint.NET).  Download the application as a assembly. NET will no longer work.  Of course, this hinders the work of utilities like ILDASM. </li><li>  Macros inside .NET applications are not supported. </li><li>  The IL code inside the application remains intact, although it is encrypted, like the entire contents of the * .exe file.  It can be subjected to obfuscator treatment before Themida protection. </li><li>  Protection of individual assemblies in the form of *. Dll is not supported yet.  However, using the X-Bundler assembly, you can simply integrate into the main * .exe file. </li></ul><br><br><h1>  Interview with Raphael </h1><br><ul><li>  <b>What was the reason for stopping the development of X-Protector and the release of Themida?</b> </li><li>  A few reasons.  X-Protector was notorious for compatibility issues.  We wanted to release a new product, devoid of these shortcomings.  In addition, the development team has changed somewhat. </li><li>  <b>What are your plans for Themida64 (support for protecting 64-bit applications)?</b> </li><li>  Themida for x64 will be released in the coming months, and in the very near future our beta testers will receive it. </li><li>  <b>What are the benefits of Themida custom builds?</b> </li><li>  Unfortunately, we currently do not provide such a service, although we do have some opportunities for buyers with specific compatibility requirements. </li><li>  <b>I saw that the help file mentions Wine and ReactOS.</b>  <b>Do Themida-protected applications really work in these environments?</b> </li><li>  Yes, applications protected by our protector should work successfully in these environments.  These are the requirements of a large number of our customers. </li><li>  <b>Does Themida use ring-0 based protection?</b> </li><li>  Some time ago, the first versions of Themida did offer such protection.  But after some time we removed the use of ring-0 to increase compatibility with new versions of Windows, implementing protection based on code virtualization instead. </li><li>  <b>Themida is an extremely powerful protector.</b>  <b>But what do you think about the approach that was implemented in ExeCryptor (the code there did not turn into codes for the virtual machine, but simply mutated and complicated, while remaining native for the processor).</b> </li><li>  I think that ExeCryptor still had its own virtual machine.  Opcodes that could be emulated - emulated.  Those that can not - mutated in the x86 version.  In any case, this is what I heard, as if I do not know. </li><li>  <b>What are your plans for the future of Themida?</b> </li><li>  In general, we are thinking about a serious redesign to further enhance protection.  But above all, x64 support will be released, and all subsequent tread versions will support both x32 and x64 applications. </li></ul><br><br><table><tbody><tr><td> <a href="http://img713.imageshack.us/i/13721209.jpg/"><img src="http://img713.imageshack.us/img713/8780/13721209.th.jpg"></a> </td><td> <a href="http://img42.imageshack.us/i/88954180.jpg/"><img src="http://img42.imageshack.us/img42/5254/88954180.th.jpg"></a> </td><td> <a href="http://img264.imageshack.us/i/61605529.jpg/"><img src="http://img264.imageshack.us/img264/6213/61605529.th.jpg"></a> </td><td> <a href="http://img301.imageshack.us/i/25827811.jpg/"><img src="http://img301.imageshack.us/img301/9928/25827811.th.jpg"></a> </td></tr></tbody></table></div><p>Source: <a href="https://habr.com/ru/post/106920/">https://habr.com/ru/post/106920/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../106913/index.html">Extensions for Opera: Windows</a></li>
<li><a href="../106916/index.html">What version control systems do you use? (In real work. Poll for the conference).</a></li>
<li><a href="../106917/index.html">New Google FeedBurner interface</a></li>
<li><a href="../106918/index.html">Obama signed Aypad with his finger</a></li>
<li><a href="../106919/index.html">MINSK / Belarus (Minsk / Belarus) Motion TimeLapse</a></li>
<li><a href="../106925/index.html">IdentyMe - Create your virtual business card</a></li>
<li><a href="../106928/index.html">UX Engineer - the profession of the future</a></li>
<li><a href="../106930/index.html">QooxDoo: launch source version with denwer</a></li>
<li><a href="../106932/index.html">Linux service provider</a></li>
<li><a href="../106934/index.html">Cosmogony of the world Vizerra</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>