<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>JVM crashes (2 stories about calling the native library)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I want to share two stories with the same plot, but different interchanges. 
 Maybe someone who also falls JVM will be useful 

 1. Native code is cal...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>JVM crashes (2 stories about calling the native library)</h1><div class="post__text post__text-html js-mediator-article">  I want to share two stories with the same plot, but different interchanges. <br>  Maybe someone who also falls JVM will be useful <br><br>  1. Native code is called from Java via JNI.  Unit test - passes with a bang, the application (GUI, Swing) is crashing. <br>  We are connecting via ddd debager (this is such a shell over gdb, if any of the javaists do not know :)) - we see what falls with the longest stack.  We find out with the author of the native library that they deserialize there through boost (such a library for C ++) a large glibin tree.  And there is a recursion. <br><br>  There is an idea (not immediately, 3 days of disputes and googling) that when called from the application, the stack is larger and it overflows.  Find the parameter for the JVM: -XX: ThreadStackSize = 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Works! <br><br>  2. Native code is invoked via JNA.  Present Kolbeki back to Java, as I <a href="http://habrahabr.ru/blogs/java/113436/">described</a> .  Unit test is running, the app crashes! <br><br><a name="habracut"></a><br>  Again, we run ddd (the process is to call the debug version of the library to see the resources, start the application from the debug environment, put the breakpoint in Java, when it stops to find the process number of Java, connect to it from ddd, set breakpoints in it, continue execution ddd, continue to perform in Java - fuh!) <br><br>  We see that falls when trying to call Java kolbek.  How so?!  I knew that it was impossible for gc to gather and save it in the class field of his service! <br><br>  Another day of investigation and it turns out: <br>  Our craftsmen created another Spring Context in the application. <br>  Those. <br>  1. A ‚Äúcorrect‚Äù context was created, a spring bin of my service was born in it, it registered a colbek <br>  2. An ‚Äúextra‚Äù context was created, another bin of my service was born in it (it is a singleton, but only within one context! In another context, another istance!) And registered its own colback <br>  3. GC collected an extra context, and with it my service, and with it a callback <br>  4. I called my service (from the ‚Äúcorrect‚Äù spring context), he called C, he called Kolbek.  And a kolbek from the ‚Äúwrong‚Äù spring context was already collected from him by the scavenger! <br>  5. Crash! <br><br>  We remove the extra context - it works! <br><br></div><p>Source: <a href="https://habr.com/ru/post/114781/">https://habr.com/ru/post/114781/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../114775/index.html">Corridors Zfort Group</a></li>
<li><a href="../114776/index.html">Writing feedback function for Android applications</a></li>
<li><a href="../114777/index.html">CeBIT: Paradise for gamers</a></li>
<li><a href="../114778/index.html">Apple iPad still has no competitors</a></li>
<li><a href="../114780/index.html">The United States has compiled a list of the largest pirate points</a></li>
<li><a href="../114784/index.html">Android Developers Union</a></li>
<li><a href="../114785/index.html">Loud failures in the fight against virus writers</a></li>
<li><a href="../114786/index.html">CyanogenMod Review</a></li>
<li><a href="../114791/index.html">Electronic Parliamentary Elections in Estonia (2011)</a></li>
<li><a href="../114792/index.html">Geek has adapted Kinect for playing Tetris</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>