<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>First look at Unity 2.0</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Unity is an open source project from the Patterns & Practices group at Microsoft. The goal of the project is to provide a classic IoC framework for de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>First look at Unity 2.0</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/fbc/d36/285/fbcd36285c761f58770bfb2d0f385dac.gif" alt="image"><br>  <strong>Unity</strong> is an open source project from the <strong>Patterns &amp; Practices</strong> group at Microsoft.  The goal of the project is to provide a classic IoC framework for developers, which allows instantiating objects in an advanced way and be able to have a flexible configuration.  Unity is a separate framework, but is often included in projects as part of the <strong>Enterprise Library</strong> .  With the advent of .NET 4 and Visual Studio 2010, new versions of the Unity and Enterprise Library are on the way.  This article covers the beta version of Unity 2.0.  To try the framework yourself, visit <a href="http://unity.codeplex.com/" rel="nofollow">http://unity.codeplex.com</a> .  The release of Unity 2.0 and Enterprise Library 5.0 is scheduled for the same time as the releases of Visual Studio 2010 and .NET 4, that is, this spring. <br><a name="habracut"></a><br><h3>  <strong>Some facts about Unity 2.0</strong> </h3><br>  When a new product release comes out, the first question that arises is: can I easily update my old binary components with new ones and be happy?  The second frequent question: can I use the old version of the product with the new version?  For Unity 2.0, the answer to both questions is: YES.  You can easily migrate existing applications to the new version of the tool and you can also use versions 1.2 and 2.0 together in the context of a single application.  However, in the case of sharing, you need to do several actions to make sure, for example, that the Unity assemblies are located in different folders (since they have the same name) and each of your assemblies depends only on one of the Unity versions. <br><br>  Speaking of builds, it should be noted that all the functionality of Unity 2.0 is represented by three builds: <ul><li>  <em>Microsoft.Practices.Unity</em> </li><li>  <em>Microsoft.Practices.Unity.Configuration</em> </li><li>  <em>Microsoft.Practices.Unity.Interception</em> </li></ul>  The first one contains the core of the library, the other two are focused on specific aspects, such as support for offline configuration via XML and the implementation of the Interception pattern.  The main difference with the previous version of Unity is the absence of the <em>ObjectBuilder2</em> assembly, the code of which is now included in the <em>Microsoft.Practices.Unity</em> kernel. <br><br>  Depending on the purpose for which you used Unity 1.2 and what features you implemented, you may or may not face difficulties migrating your existing code to the new version.  At first glance, according to my feelings, in most cases migration is smooth and without problems, but some changes are still present and some old code may be outdated in the light of the new version of Unity. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  <strong>Determination of dependencies with Unity 2.0</strong> </h3><br>  Since the main goal of Unity is to resolve dependencies between classes, the primary task is how to express these dependencies.  There are two ways: using an offline configuration file and expressing dependencies through a flexible API at runtime. <br><br>  By default, Unity reads configuration parameters from an XML file, most often these are application configuration files like <strong>app.config</strong> or <strong>web.config</strong> .  But you are not limited in your choices and you can load configuration parameters from any XML file that was included in your project.  For example, you have a <strong>my.config</strong> file with Unity configuration settings.  The following code shows how you can load information from it into the current container instance: <br><br><img title="image" alt="image" src="http://www.gotdotnet.ru/upload/blog/XaocCPS/ac6/image_3.png" width="614" height="184"><br><br>  This code is slightly different from what you could use in version 1.2.  The old code is now marked obsolete.  The main difference is the line of code that loads configuration information into the container.  You now have a new <strong>Configure</strong> method for the <strong>section</strong> object. <br><br>  Keep in mind that if you use a non-default configuration file, then you need to make sure that the .config file is located in the same folder as the executable file.  Below is the code that loads the configuration from the default file: <br><br><img title="image" alt="image" src="http://www.gotdotnet.ru/upload/blog/XaocCPS/48f/image_02ae3453-5b10-4b44-97dd-14c52704dd12.png" width="665" height="98"><br><br>  The final code is definitely cleaner than the code written in previous versions.  In addition, there is even more pleasant news for Unity developers: Unity 2.0 comes with a very nice configuration tool with which you can ‚Äúexpress and declare‚Äù your dependencies. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/68f/7d5/bba/68f7d5bbad6ff9357329cd61d3ace7f9.jpg"><br>  <strong>Fig.</strong>  <strong>1. Section Unity, customizable using the Enterprise Library configuration utility</strong> <br><br>  This tool can save settings to any file, and also can combine sections from the Enterprise Library and Unity together.  The tool also opens files that you could create in Visual Studio or somewhere else. <br><br>  Offline configuration is great, but it is a declarative API.  There are many situations where you need more flexibility and, of course, situations in which you choose approaches that offer greater flexibility.  An alternative to offline configuration at design time is configuration during execution. <br><br><img title="image" alt="image" src="http://www.gotdotnet.ru/upload/blog/XaocCPS/caf/image_9b27ad51-441b-4bbf-b00c-104a1df13ff7.png" width="422" height="83"><br><br>  The <em>UnityContainer</em> class supports flexible syntax, which allows you to chain into combinations of class methods to achieve the desired configuration.  For example, you can use <em>RegisterType</em> to register a type mapping and <em>RegisterInstance</em> to register an instance of a particular type.  You can also combine the call with <em>AddExtension</em> to use the Unity interception API.  In addition, the <em>UnityContainer</em> class contains a new extension <em>method</em> , <em>IsRegistered</em> , which allows you to check the specified type to see if it has already been registered using the framework. <br><br><img title="image" alt="image" src="http://www.gotdotnet.ru/upload/blog/XaocCPS/100/image_3f82eea2-0402-4642-8e1f-304b6353b8ee.png" width="457" height="55"><br><br>  This method is one of the features added in Unity 2.0 and useful in scripts when you intend to integrate configurations together during design and execution.  You can use this method to avoid multiple identical registrations that will be automatically resolved using the last rule added.  In Unity 2.0 you will also find for yourself a new Collection <em>Registrations</em> , designed to programmatically check for registrations at the time of execution.  <em>Registrations</em> returns a collection of <em>ContainerRegistration</em> objects, which are described below: <br><br><img title="image" alt="image" src="http://www.gotdotnet.ru/upload/blog/XaocCPS/5dd/image_db3b5671-f0a1-40a4-8fc2-fa53940e7b3f.png" width="527" height="154"><br><br>  As you can see, the <em>ContainerRegistration</em> object is an exact description of the registration, regardless of how it was created: via XML or programmatically. <br><br><h3>  <strong>Resolving Dependencies with Unity 2.0</strong> </h3><br>  Unity 2.0 still contains the <em>Resolve</em> method with the same syntax that you are familiar with from previous versions.  After the container has been configured in any way, all we need to do is build instances of the projected types.  For this purpose, the <em>Resolve</em> and <em>Resolve &lt;T&gt;</em> methods are used: <br><img title="image" alt="image" src="http://www.gotdotnet.ru/upload/blog/XaocCPS/604/image_ea661983-26b2-4b8c-9b54-8a8729db6e71.png" width="376" height="55"><br><br>  The resolution method does all the magic to determine the structure of the target type and search for its dependencies, to resolve them.  Like many other IoC frameworks, Unity supports the dependencies specified through the designer and injection attributes that can be specified for properties or methods.  The instance that returns a <em>Resolve</em> or <em>Resolve &lt;T&gt;</em> contains all the existing dependencies allowed, in the case when the dependency was not resolved, the framework throws an exception. <br><br>  Unity can also allow generic types, both linked and unbound.  Below is the registration of unbound generic type (in which, type T is unknown): <br><br><img title="image" alt="image" src="http://www.gotdotnet.ru/upload/blog/XaocCPS/ee9/image_ebe78172-1a6d-45ed-9653-916eac15479e.png" width="522" height="55"><br><br>  The <em>ISpecialLogger &lt;T&gt;</em> type is projected onto a closed type that knows only how to handle integer values.  Below, for example, a description of this type: <br><br><img title="image" alt="image" src="http://www.gotdotnet.ru/upload/blog/XaocCPS/b26/image_f6351002-1eaf-430d-b138-cfc953b39b34.png" width="332" height="83"><br><br>  In your code, you ask Unity to allow <em>ISpecialLogger &lt;int&gt;</em> and get an object that knows how to log integer values: <br><br><img title="image" alt="image" src="http://www.gotdotnet.ru/upload/blog/XaocCPS/4e1/image_ce8525fc-0d38-418f-9722-6b7605b5c2d3.png" width="508" height="55"><br><br>  Ring links are a serious danger when using Unity and in general IoC containers.  Ring dependencies are difficult to identify and should be viewed as a sign of poor application design, and not as a random result due to the lack of functionality in your IoC.  When a class provides multiple constructors, Unity defaults to the one with the most parameters.  At times, this can lead to ring links, which would never appear when you create classes manually.  For example, we have two classes: <br><br><img title="image" alt="image" src="http://www.gotdotnet.ru/upload/blog/XaocCPS/a12/image_687450b0-34e7-41f5-8101-469e322d0256.png" width="415" height="168"><br><br>  Everything is fine as long as you instantiate class instances yourself: <br><br><img title="image" alt="image" src="http://www.gotdotnet.ru/upload/blog/XaocCPS/915/image_c407e23e-1bf7-428f-9bfa-b180648adf21.png" width="277" height="44"><br><br>  If you assign Unity to allow a class, you will get a stack overflow: <br><br><img title="image" alt="image" src="http://www.gotdotnet.ru/upload/blog/XaocCPS/9ad/image_411dd9b9-8cbd-4f0f-b757-2a623acf7002.png" width="379" height="40"><br><br>  The reason for the exception with stack overflow is that Unity, using the constructor with the largest number of parameters, gets into ring references when it tries to get an instance of <em>MyService</em> to resolve <em>MyContainer</em> , which in turn is required to allow <em>MyService</em> . <br><br>  In conclusion, it is worth describing that Unity 2.0 contains several new life cycle managers (lifetime managers).  In the previous version, we had three predefined managers, plus the ability to create our own.  Table 1 describes the managers available in Unity 2.0. <br><br>  <strong>Table 1. Lifecycle Managers in Unity 2.0</strong> <br><table border="1" cellpadding="2" width="598"><tbody><tr><td width="218">  <strong>Manager</strong> <br></td><td width="378">  <strong>Description</strong> <br></td></tr><tr><td width="220">  <em>ContainerControlledLifetimeManager</em> <br></td><td width="376">  Implements singleton behavior for objects.  The object is destroyed (disposed) when the container is destroyed. <br></td></tr><tr><td width="222">  <em>ExternallyControlledLifetimeManager</em> <br></td><td width="375">  Implements singleton behavior, but the container does not store an object reference, so the object is destroyed after leaving the scope. <br></td></tr><tr><td width="224">  <em>Hierarchicalifetimemanager</em> <br></td><td width="373">  New in Unity 2.0, implements singleton behavior for objects.  But, descendant containers do not share instances with parents. </td></tr><tr><td width="225">  <em>PerResolveLifetimeManager</em> <br></td><td width="372">  New in 2.0, implements a behavior similar to a transient lifetime manager, except that instances are reused in building an object graph (instances are reused across the build graph of the object graph). <br></td></tr><tr><td width="226">  <em>PerThreadLifetimeManager</em> <br></td><td width="371">  Implements singleton behavior for objects, but limits them to the current thread. <br></td></tr><tr><td width="227">  <em>TransientLifetimeManager</em> <br></td><td width="370">  Returns a new instance of the requested type for each call.  This is the default behavior. <br></td></tr></tbody></table>  As expected, the default resolution in Unity returns a new instance for each call.  The same thing happened in previous versions. <br><br><h3>  <strong>Conclusion</strong> </h3><br>  At the time of this writing, the Unity 2.0 framework remained in beta status.  This version is nothing revolutionary.  However, the configuration has been fixed - an area in which the framework was inferior to other blocks from the Enterprise Library in both forms: with the design and the API.  And another important change: now, if you want to use only a clean implementation of the code, you need only one DLL. <br><br>  The final release is expected in April, immediately after the release of Visual Studio 2010 and the .NET Framework 4. However, Unity 2.0 is not specific to .NET 4 and can also be used for .NET 3.5. <br><br> <a href="http://progg.ru/%25D0%259F%25D0%25B5%25D1%2580%25D0%25B2%25D1%258B%25D0%25B9-%25D0%25B2%25D0%25B7%25D0%25B3%25D0%25BB%25D1%258F%25D0%25B4-%25D0%25BD%25D0%25B0-Unity-20-NET-%25D0%25A5%25D0%25B0%25D0%25B1%25D1%2580%25D0%25B0%25D1%2585%25D0%25B0%25D0%25B1%25D1%2580"><img alt="Progg it" src="http://progg.ru/image.axd?url=http%3A%2F%2Fhabrahabr.ru%2Fblogs%2Fnet%2F84592%2F"></a> <br></div><p>Source: <a href="https://habr.com/ru/post/84592/">https://habr.com/ru/post/84592/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../84583/index.html">Google donates $ 2 million to the Wikimedia Foundation</a></li>
<li><a href="../84585/index.html">iPhone 3GS launched in Russia</a></li>
<li><a href="../84587/index.html">Setting up php-cgi in conjunction with sockets-based nginx</a></li>
<li><a href="../84589/index.html">Want a new iPhone? Insurers will pay</a></li>
<li><a href="../84591/index.html">Apple replaces MacBook hard drives for free</a></li>
<li><a href="../84593/index.html">QIP project: release after five years</a></li>
<li><a href="../84594/index.html">Circling startups</a></li>
<li><a href="../84595/index.html">Are you interested in the possibility of daily hosting payment?</a></li>
<li><a href="../84597/index.html">Kill the buzz</a></li>
<li><a href="../84598/index.html">A little bit about Sberbank</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>