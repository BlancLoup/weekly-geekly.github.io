<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What would JSON support look like in modern C ++?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Well in terms of JSON support, Javascript programmers live - for some incredible coincidence there JSON is included in the specification of the langua...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What would JSON support look like in modern C ++?</h1><div class="post__text post__text-html js-mediator-article">  Well in terms of JSON support, Javascript programmers live - <i>for some incredible coincidence</i> there JSON is included in the specification of the language itself: there is JSON - there is an object.  Conveniently.  The situation is also good in languages ‚Äã‚Äãwhere JSON is not included in the language itself, but is supported by the standard library (Python, Ruby): import the module - and you're done. <br><br>  The life of C ++ programmers has never been particularly simple - we don‚Äôt have JSON support either at the language level or in the standard library.  And probably never will be.  ‚ÄúI also found a problem!‚Äù Experienced colleagues will tell me, ‚ÄúIt should not be there, C ++ comes without a‚Äú battery ‚Äù.  To solve this problem, we ... "and here they are divided into two camps: <br><br>  <b>1.</b> "We use a large framework (boost, Qt, POCO, other), which is used in all our projects and is able to 150,000 different things, including JSON." <br>  <b>2.</b> ‚ÄúWe adhere to the approach in which each task has its own lightweight library.  In particular, for JSON, 150,000 years ago we chose the excellent% JSON_LIB% library, which works great. ‚Äù 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Yes, it is.  Here are just ... <br><br><div class="spoiler">  <b class="spoiler_title">What is bad approach to using frameworks</b> <div class="spoiler_text">  First, to pull a huge framework for the sake of JSON alone is somehow dull.  Well, let's say you had a framework, and so on.  But then you have to write work with JSON in terms of the framework, and this is usually a silent horror.  Look, for example, at the Jt <a href="http://doc.qt.io/qt-5/json.html">documentation in Qt</a> ‚Äî a bunch of native types like QJsonArray, QJsonDocument, QJsonObject, QJsonValue, etc.  and have to use them.  You can immediately forget about transferring the code to another project (where there is no framework).  Well, or here's Boost: the JSON parser is <i>very logical</i> in the <a href="http://www.boost.org/doc/libs/1_54_0/doc/html/boost_propertytree/parsers.html">Boost.PropertyTree</a> module.  Yeah, so I would have guessed.  Those.  we are offered to dance not from the JSON format, but from the data structure ‚Äútree‚Äù, which can read itself including from JSON. <br><br>  In general, the frameworks impose on us their own vision of the task, their own way of solving it, and strive to bind us to themselves forever.  No, if you are sure that you have found the one and only unique framework and will be happy with it for the rest of your life - your will.  But I somehow am not a supporter of such fatalism. <br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">What is bad approach with the use of libraries</b> <div class="spoiler_text">  He is bad at this part: "... 150,000 years ago, we chose an excellent library ...".  Most likely we are talking about something that began to be written almost at the time of DOS and, no doubt, it works, but at the same time, trying to be compatible with all platforms and standards of the language is completely behind the progress.  Yes, everything compiles and works, even tests pass.  But the library is completely unfamiliar with such things as the auto keyword, range-based loops, string literals, raw strings, displacement constructors, initialization lists, and other cool things that make code more efficient and more readable at the same time.  But the library, created years ago, has obligations for backward compatibility, which means it just cannot take and add all this. <br></div></div><br><br>  <b>Let's dream a little.</b> <br><br>  And what if JSON was included in the standard library of the new standard C ++?  What if it were written in terms of C ++ 11 \ 14 and without the requirements of backward compatibility with the old language standards?  What if the syntax of this module would be tried to be as close as possible to JSON's native use ‚Äúa la Javascript‚Äù, but at the same time keep the C ++ spirit (efficiency, minimum memory consumption, compatibility with STL)?  What if it could be included in the project with one person and not worry about its assembly and linking?  How would it all look and work? <br><br>  And we have the answer to this question!  Let's look at the <a href="https://github.com/nlohmann/json">JSON-library</a> for C ++ written in accordance with all these principles, well, and generally written by people for people, and not strangers for predators, as is usually the case. <br><a name="habracut"></a><br><br>  So, let us have to create such a JSON object here: <br><br><pre><code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Habrahabr"</span></span>, <span class="hljs-string"><span class="hljs-string">"nothing"</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">"answer"</span></span>: { <span class="hljs-string"><span class="hljs-string">"everything"</span></span>: <span class="hljs-number"><span class="hljs-number">42</span></span> }, <span class="hljs-string"><span class="hljs-string">"companies"</span></span>: [<span class="hljs-string"><span class="hljs-string">"Infopulse"</span></span>, <span class="hljs-string"><span class="hljs-string">"TM"</span></span>], <span class="hljs-string"><span class="hljs-string">"user"</span></span>: { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"tangro"</span></span>, <span class="hljs-string"><span class="hljs-string">"active"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }</code> </pre> <br><br><h4>  Let's take and create! </h4><br>  We download <a href="">github.com/nlohmann/json/blob/master/src/json.hpp</a> , we include it in the cpp-file. <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"json.hpp"</span></span></span><span class="hljs-meta"> using json = nlohmann::json;</span></span></code> </pre><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//   JSON- json j;</span></span></code> </pre><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//  ,     std::string j["name"] = "Habrahabr";</span></span></code> </pre><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//     j["nothing"] = nullptr;</span></span></code> </pre><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//     j["answer"]["everything"] = 42;</span></span></code> </pre><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//    (   std::vector&lt;std::string&gt;) //   -    j["companies"] = { "Infopulse", "TM" };</span></span></code> </pre><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//     -         ""-"" j["user"] = { {"name", "tangro"}, {"active", true} };</span></span></code> </pre><br><br>  By the way, using the latest feature, instead of all this you could write object creation very similar to the JSON format itself: <br><br><pre> <code class="cpp hljs">json j2 = { {<span class="hljs-string"><span class="hljs-string">"name"</span></span>, <span class="hljs-string"><span class="hljs-string">"Habrahabr"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"nothing"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>}, {<span class="hljs-string"><span class="hljs-string">"answer"</span></span>, { {<span class="hljs-string"><span class="hljs-string">"everything"</span></span>, <span class="hljs-number"><span class="hljs-number">42</span></span>} }}, {<span class="hljs-string"><span class="hljs-string">"companies"</span></span>, {<span class="hljs-string"><span class="hljs-string">"Infopulse"</span></span>, <span class="hljs-string"><span class="hljs-string">"TM"</span></span>}}, {<span class="hljs-string"><span class="hljs-string">"user"</span></span>, { {<span class="hljs-string"><span class="hljs-string">"name"</span></span>, <span class="hljs-string"><span class="hljs-string">"tangro"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"active"</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>} }} }</code> </pre><br><br><h4>  So, where are all these fancy C ++ 11 chips? </h4><br>  And here they are. <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//      json j = "{ \"active\": true, \"pi\": 3.141 }"_json;</span></span></code> </pre><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//  raw string json j = R"( { "active": true, "pi": 3.141 } )"_json;</span></span></code> </pre><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//  auto auto j = json::parse("{ \"active\": true, \"pi\": 3.141 }");</span></span></code> </pre><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//  range-based for for (auto element : j) { std::cout &lt;&lt; element &lt;&lt; '\n'; }</span></span></code> </pre><br><br><h4>  So, okay, I am an adherent of the "classic" style, show me compatibility with STL </h4><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//  ,  "- std::vector" json j; j.push_back("foo"); j.push_back(1); j.push_back(true);</span></span></code> </pre><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//  ,  "- std::map" json o; o["foo"] = 23; o["bar"] = false;</span></span></code> </pre><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//   if (o.find("foo") != o.end()) { //  }</span></span></code> </pre><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//    for (json::iterator it = j.begin(); it != j.end(); ++it) { std::cout &lt;&lt; *it &lt;&lt; '\n'; }</span></span></code> </pre><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//   []   at(),  std::string const std::string tmp = j[0]; j[1] = 42; bool foo = j.at(2);</span></span></code> </pre><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//      j.size(); // 3  j.empty(); // true  false j.type(); // json::value_t::array j.clear(); // </span></span></code> </pre><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//    std::string s = j.dump();</span></span></code> </pre><br><br>  Well, there is still support for creating JSON from any STL containers (std :: array, std :: vector, std :: deque, std :: forward_list, std :: list, std :: set, std :: multiset, std: : unordered_set, std :: unordered_multiset).  For linearly ordered and ordered associative containers, the order of the elements will be preserved; for unordered-associative containers, of course, no. <br><br><h4>  So, almost convinced </h4><br>  And there is also a 100% test library coverage and a guarantee of the absence of memory leaks from Valgrind. <br><br><h4>  That's all. </h4><br>  In general, I understand that this is ‚Äújust one more library for supporting JSON,‚Äù and in fact it is no different from a million others.  But how is it still convenient to work with her! </div><p>Source: <a href="https://habr.com/ru/post/254075/">https://habr.com/ru/post/254075/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../254061/index.html">Android found dangerous vulnerability</a></li>
<li><a href="../254065/index.html">Tibbo AggreGate Concept - Platform for the Internet of Things</a></li>
<li><a href="../254067/index.html">Simulation model of the logistics center</a></li>
<li><a href="../254071/index.html">Space landscape</a></li>
<li><a href="../254073/index.html">Lectures Technopark. Semester 2 Database</a></li>
<li><a href="../254077/index.html">And once again about the unique constants</a></li>
<li><a href="../254079/index.html">Installation, configuration and use of Antidoto security scanner</a></li>
<li><a href="../254087/index.html">The process of developing and testing demons</a></li>
<li><a href="../254089/index.html">ROTE and Lua bind terminal emulation library</a></li>
<li><a href="../254091/index.html">Free online school of Android developers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>