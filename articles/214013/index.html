<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Develop Flappy Bird on Phaser</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Picture to attract attention 

 Good day, Habr! 

 Somewhere a month ago (at the time of writing this post) I set out to create my own clone of the ga...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Develop Flappy Bird on Phaser</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/ad8/b0e/aea/ad8b0eaea14e5f3a28abe4abb4eca943.jpg"><br>  <i>Picture to attract attention</i> <br><br>  Good day, Habr! <br><br>  Somewhere a month ago (at the time of writing this post) I set out to create my own clone of the game Flappy Bird.  But all did not reach this hand.  The catalyst for this action was a small hackathon.  ‚ÄúAnd why not?‚Äù I thought, and took up the implementation of this game. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Considering that it was necessary to develop in 2 days, I did not invent a ‚Äúbicycle‚Äù and took the ready-made game engine - the Phaser. <br><br>  In this part we will look at the initialization of the game scene, write a ‚Äúpreloader‚Äù of resources and prepare the foundation for the game menu. <br><a name="habracut"></a><br><br><h2>  What is a Phaser? </h2><br><blockquote>  HTML5 games.  It uses Pixi.js internally for fast 2D Canvas and WebGL rendering. </blockquote><br>  <a href="http://phaser.io/">Phaser</a> is a framework that allows us to create games very quickly.  I do not exaggerate, using it to create a game is really easy and fast.  We are not distracted by Actors, rendering, physics - we focus on the game logic. <br>  Its unique advantages are <a href="">Pixi.js.</a>  This is one of the fastest engines that renders using WebGL.  And in case WebGL is not supported - on Canvas. <br>  Phaser also pleased with a huge set of ready-made classes: SpriteAnimation, TileMap, Timer, GameState and much more.  Including, and components of the physical engine: RigidBody, Physics, etc. <br>  The availability of these components greatly simplifies development. <br><br><h2>  We connect Phaser and other dependences </h2><br>  I didn't load the game with a lot of dependencies, so the list is small: Phaser, WebFont and Clay.  The first is needed to develop the game, WebFont to download fonts from Google Fonts and Clay for the high score table. <br><br>  The code below is contained in the index.html file. <br><div class="spoiler">  <b class="spoiler_title">index.html</b> <div class="spoiler_text"><pre><code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Flappy Bird<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"shortcut icon"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/favicon.ico"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="css"> * { </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">margin</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css">; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">padding</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css">; } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> Clay = Clay || {}; Clay.gameKey = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"gflappybird"</span></span></span><span class="javascript">; Clay.readyFunctions = []; Clay.ready = </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">fn</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ Clay.readyFunctions.push(fn); }; (</span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span><span class="javascript">{ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> clay = </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.createElement(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"script"</span></span></span><span class="javascript">); clay.async = </span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">true</span></span></span><span class="javascript">; clay.src = (</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"https:"</span></span></span><span class="javascript"> == </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.location.protocol ? </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"https://"</span></span></span><span class="javascript"> : </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://"</span></span></span><span class="javascript">) + </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"clay.io/api/api-leaderboard-achievement.js"</span></span></span><span class="javascript">; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> tag = </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.getElementsByTagName(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"script"</span></span></span><span class="javascript">)[</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">]; tag.parentNode.insertBefore(clay, tag); })(); </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"//ajax.googleapis.com/ajax/libs/webfont/1.4.7/webfont.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"//cdnjs.cloudflare.com/ajax/libs/phaser/1.1.4/phaser.min.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"js/Game.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </div></div><br>  In index.html we simply add dependencies, nothing superfluous.  This includes our Game.js script, which we will look at later.  We do not add a single line of HTML, because  Phaser renders the scene directly in body. <br>  <i>Phaser can also render to the container you created, if necessary.</i> <br><br><h2>  We connect fonts </h2><br>  There is only one function in <b>Game.js</b> - <b>GameInitialize ()</b> .  In the closure of this function and all the calculations occur.  Before calling it, you need to wait for the download fonts.  Otherwise, there is a high probability that the fonts will not have time to load and they will not be available Phaser.  For this we use WebFont: <br><br><pre> <code class="javascript hljs">WebFont.load({ <span class="hljs-attr"><span class="hljs-attr">google</span></span>: { <span class="hljs-attr"><span class="hljs-attr">families</span></span>: [<span class="hljs-string"><span class="hljs-string">'Press+Start+2P'</span></span>] }, <span class="hljs-attr"><span class="hljs-attr">active</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ GameInitialize(); } });</code> </pre><br>  We ‚Äúasked‚Äù WebFont to download the ‚ÄúPress Start 2P‚Äù font from Google Fonts, and when the download is finished, we call the GameInitialize () function, which will continue to initialize all the necessary game objects. <br><br>  <u>In the future, the content of the post will be described exclusively within the GameInitialize () function</u> . <br><br><h2>  We declare constants, create an instance of Phaser.Game, add gamestates </h2><br>  To begin with, let's add variables that will have de facto values ‚Äã‚Äãwhen used.  Since the use of const is not too ‚Äúvalid‚Äù, we use variables: <br><div class="spoiler">  <b class="spoiler_title">Game constants</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> DEBUG_MODE = <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-comment"><span class="hljs-comment">//   SPEED = 180, //   GRAVITY = 1800, //     BIRD_FLAP = 550, //    "" PIPE_SPAWN_MIN_INTERVAL = 1200, //     PIPE_SPAWN_MAX_INTERVAL = 3000, //  AVAILABLE_SPACE_BETWEEN_PIPES = 130, //     ( ) CLOUDS_SHOW_MIN_TIME = 3000, //     CLOUDS_SHOW_MAX_TIME = 5000, //     MAX_DIFFICULT = 100, //         SCENE = '', // ,   .     (    body) TITLE_TEXT = "FLAPPY BIRD", //     HIGHSCORE_TITLE = "HIGHSCORES", //   HIGHSCORE_SUBMIT = "POST SCORE", //        INSTRUCTIONS_TEXT = "TOUCH\nTO\nFLY", //    DEVELOPER_TEXT = "Developer\nEugene Obrezkov\nghaiklor@gmail.com", //    :) GRAPHIC_TEXT = "Graphic\nDmitry Lezhenko\ndima.lezhenko@gmail.com", LOADING_TEXT = "LOADING...", //    WINDOW_WIDTH = window.innerWidth || document.documentElement.clientWidth || document.getElementsByTagName('body')[0].clientWidth, WINDOW_HEIGHT = window.innerHeight || document.documentElement.clientHeight || document.getElementsByTagName('body')[0].clientHeight;</span></span></code> </pre></div></div><br>  We also need auxiliary variables for storing all the created Phaser objects: <br><div class="spoiler">  <b class="spoiler_title">Variables for Phaser Objects</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Background, <span class="hljs-comment"><span class="hljs-comment">//  Clouds, CloudsTimer, //      Pipes, PipesTimer, FreeSpacesInPipes, // ,   "" ,   ""  Bird, // Town, //TileSprite    FlapSound, ScoreSound, HurtSound, // ,     SoundEnabledIcon, SoundDisabledIcon, // \  TitleText, DeveloperText, GraphicText, ScoreText, InstructionsText, HighScoreTitleText, HighScoreText, PostScoreText, LoadingText, //   PostScoreClickArea, //     isScorePosted = false, //  ,    "" isSoundEnabled = true, //  ,     Leaderboard; //  Leaderboard   Clay.io</span></span></code> </pre></div></div><br>  Briefly describe what kind of variable and why it is needed. <br><ul><li>  <b>Background</b> - here we store Rectangle with color # 53BECE. </li><li>  <b>Clouds</b> - group of objects.  Each one is a regular sprite. </li><li>  <b>CloudsTimer</b> - a timer that spun new clouds. </li><li>  <b>Pipes</b> - a group of objects.  Similar to clouds, every object is a sprite. </li><li>  <b>PipesTimer</b> is a timer that spuns new pipes. </li><li>  <b>FreeSpacesInPipes</b> - in order to determine that the bird has flown, we need to somehow catch this event.  Objects are stored in this variable without a sprite, which are triggers. </li><li>  <b>Bird</b> - store a birdie that has a RigidBody and SpriteMap for animation. </li><li>  <b>Town</b> - TileMap of a city that moves in the background. </li><li>  <b>FlapSound</b> - a sound that is reproduced when you click the mouse (flapping wings). </li><li>  <b>ScoreSound</b> - the sound of the passage through the pipe. </li><li>  <b>HurtSound</b> - the sound of the end of the game, a conflict with the pipe or going beyond the gaming world. </li><li>  <b>SoundEnabledIcon, SoundDisabledIcon</b> - two sprites with the display of the icon of the included sound, and turned off similarly. </li><li>  <b>TitleText, InstuctionsText, DeveloperText, GraphicText</b> - the elements of the text that we display in the game menu. </li><li>  <b>ScoreText</b> - the text that is displayed during the game. </li><li>  <b>HighScoreTitleText, HighScoreText, PostScoreText</b> - text in the table of records. </li><li>  <b>LoadingText</b> - the text of the download game. </li><li>  <b>PostScoreClickArea</b> - Rectangle, which will help determine whether the user pressed the Post Score button. </li><li>  <b>isScorePosted</b> - a flag, in order to protect against re-posting of the same record (if the user presses Post Score twice in records). </li><li>  <b>isSoundEnabled</b> is the flag by which we determine the on / off sound in the game. </li><li>  <b>Leaderboard</b> is the object that stores the response from Clay.io. </li></ul><br>  After all the variables have been declared, we can start initializing Phaser.Game and adding the necessary GameState's to the game. <br><br>  <b>Phaser.Game ()</b> takes the following parameters: <br><blockquote>  new Game (width, height, renderer, parent, state, transparent, antialias) </blockquote>  We are interested in <b>width</b> , <b>height</b> , <b>renderer</b> , <b>parent</b> .  It is enough to specify the size of the canvas, the rendering method and the empty container so that Phaser starts rendering the game scene in the body. <br><br>  We initialize Phaser.Game using our constants declared earlier: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Game = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Phaser.Game(WINDOW_WIDTH, WINDOW_HEIGHT, Phaser.CANVAS, SCENE);</code> </pre><br>  We initialized the game scene, but we still do not have game states.  Need to correct this misstep. <br>  A pointer to a Phaser.StateManager is stored in Game.state.  It has the <b>add ()</b> function we need to add our own States.  Its signature is: <br><blockquote>  add (key, state, autoStart) </blockquote>  <b>key</b> is the string for identifying the State (its ID), <b>state</b> is the Phaser.State object, and <b>autoStart</b> - whether to start the State immediately after its initialization.  In this case, we do not need autoStart, so that we can determine the call of the states at the right moments of the game. <br>  Add all gaming states to the gaming scene: <br><br><pre> <code class="javascript hljs">Game.state.add(<span class="hljs-string"><span class="hljs-string">'Boot'</span></span>, BootGameState, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); Game.state.add(<span class="hljs-string"><span class="hljs-string">'Preloader'</span></span>, PreloaderGameState, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); Game.state.add(<span class="hljs-string"><span class="hljs-string">'MainMenu'</span></span>, MainMenuState, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); Game.state.add(<span class="hljs-string"><span class="hljs-string">'Game'</span></span>, GameState, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); Game.state.add(<span class="hljs-string"><span class="hljs-string">'GameOver'</span></span>, GameOverState, <span class="hljs-literal"><span class="hljs-literal">false</span></span>);</code> </pre><br>  <i>Each of these gaming states will be reviewed further.</i> <br><br>  The last step to start the gameplay loop is to start the BootGameState. <br><br><pre> <code class="javascript hljs">Game.state.start(<span class="hljs-string"><span class="hljs-string">'Boot'</span></span>);</code> </pre><br>  I give the full code of the game initialization: <br><div class="spoiler">  <b class="spoiler_title">Game initialization</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// instance       Canvas var Game = new Phaser.Game(WINDOW_WIDTH, WINDOW_HEIGHT, Phaser.CANVAS, SCENE); //  RequestAnimationFrame Game.raf = new Phaser.RequestAnimationFrame(Game); Game.antialias = false; Game.raf.start(); //   State   Game //     State'    Game.state.add('Boot', BootGameState, false); Game.state.add('Preloader', PreloaderGameState, false); Game.state.add('MainMenu', MainMenuState, false); Game.state.add('Game', GameState, false); Game.state.add('GameOver', GameOverState, false); //     Boot State' Game.state.start('Boot'); // Clay Leaderboard      Clay.ready(function() { Leaderboard = new Clay.Leaderboard({ id: 'your-leaderboard-id' }); });</span></span></code> </pre></div></div><br><h2>  How to create gaming states? </h2><br>  Phaser has a Phaser.State () constructor.  All you need to create a gaming State is to call this constructor: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> BootGameState = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Phaser.State();</code> </pre><br>  After that, we can override the Phaser functions with our own.  In State, there are 4 main loops: <b>create</b> , <b>preload</b> , <b>render</b> , <b>update</b> . <br><ul><li>  <b>Phaser.State.create</b> is called after a successful state change.  Here you can write the initialization of the logic of the game, the filling of variables, etc. </li><li>  <b>Phaser.State.preload</b> is called and is running during resource loading.  If you need to download some kind of sprite or sound - do it here. </li><li>  <b>Phaser.State.render</b> is called every time a frame is rendered.  Here we do rendering operations. </li><li>  <b>Phaser.State.update</b> is called after rendering.  Here we make calculations and, in fact, the business logic of the game. </li></ul><br>  Now consider our starting State, which initializes the game loop. <br><br>  <u>In the following paragraphs, I will indicate in brackets the name of the variable in which Phaser.State () is stored.</u> <br><br><h2>  Notify player that download has started (BootGameState) </h2><br>  Create an instance Phaser.State.  After its successful download, add the text with the inscription "Loading ..." and place it in the center.  Do not forget to start downloading PreloaderState. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> BootGameState = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Phaser.State(); BootGameState.create = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ LoadingText = Game.add.text(Game.world.width / <span class="hljs-number"><span class="hljs-number">2</span></span>, Game.world.height / <span class="hljs-number"><span class="hljs-number">2</span></span>, LOADING_TEXT, { <span class="hljs-attr"><span class="hljs-attr">font</span></span>: <span class="hljs-string"><span class="hljs-string">'32px "Press Start 2P"'</span></span>, <span class="hljs-attr"><span class="hljs-attr">fill</span></span>: <span class="hljs-string"><span class="hljs-string">'#FFFFFF'</span></span>, <span class="hljs-attr"><span class="hljs-attr">stroke</span></span>: <span class="hljs-string"><span class="hljs-string">'#000000'</span></span>, <span class="hljs-attr"><span class="hljs-attr">strokeThickness</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">align</span></span>: <span class="hljs-string"><span class="hljs-string">'center'</span></span> }); LoadingText.anchor.setTo(<span class="hljs-number"><span class="hljs-number">0.5</span></span>, <span class="hljs-number"><span class="hljs-number">0.5</span></span>); Game.state.start(<span class="hljs-string"><span class="hljs-string">'Preloader'</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); };</code> </pre><br><br><h2>  Writing resource ‚Äúpreloader‚Äù (PreloaderGameState) </h2><br>  To download the sprite, sound, animation, etc., in Phaser, you can use Phaser.Loader.  The pointer to it lies in Game.load after we initialized the scene.  Three methods will be enough for our game: <br><br><pre> <code class="javascript hljs">Phaser.Loader.spritesheet(key, url, frameWidth, frameHeight, frameMax, margin, spacing) Phaser.Loader.image(key, url, overwrite) Phaser.Loader.audio(key, urls, autoDecode)</code> </pre><br>  Using these methods, we write a function that will load resources into the game: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> loadAssets = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadAssets</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ Game.load.spritesheet(<span class="hljs-string"><span class="hljs-string">'bird'</span></span>, <span class="hljs-string"><span class="hljs-string">'img/bird.png'</span></span>, <span class="hljs-number"><span class="hljs-number">48</span></span>, <span class="hljs-number"><span class="hljs-number">35</span></span>); Game.load.spritesheet(<span class="hljs-string"><span class="hljs-string">'clouds'</span></span>, <span class="hljs-string"><span class="hljs-string">'img/clouds.png'</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">34</span></span>); Game.load.image(<span class="hljs-string"><span class="hljs-string">'town'</span></span>, <span class="hljs-string"><span class="hljs-string">'img/town.png'</span></span>); Game.load.image(<span class="hljs-string"><span class="hljs-string">'pipe'</span></span>, <span class="hljs-string"><span class="hljs-string">'img/pipe.png'</span></span>); Game.load.image(<span class="hljs-string"><span class="hljs-string">'soundOn'</span></span>, <span class="hljs-string"><span class="hljs-string">'img/soundOn.png'</span></span>); Game.load.image(<span class="hljs-string"><span class="hljs-string">'soundOff'</span></span>, <span class="hljs-string"><span class="hljs-string">'img/soundOff.png'</span></span>); Game.load.audio(<span class="hljs-string"><span class="hljs-string">'flap'</span></span>, <span class="hljs-string"><span class="hljs-string">'wav/flap.wav'</span></span>); Game.load.audio(<span class="hljs-string"><span class="hljs-string">'hurt'</span></span>, <span class="hljs-string"><span class="hljs-string">'wav/hurt.wav'</span></span>); Game.load.audio(<span class="hljs-string"><span class="hljs-string">'score'</span></span>, <span class="hljs-string"><span class="hljs-string">'wav/score.wav'</span></span>); };</code> </pre><br>  We now turn to PreloaderGameState.  Create a new Phaser.State (). <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> PreloaderGameState = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Phaser.State();</code> </pre><br>  Override the preload method, in which we call the loadAssets () function: <br><br><pre> <code class="javascript hljs">PreloaderGameState.preload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ loadAssets(); };</code> </pre><br><br>  After the resources are successfully loaded, the create function is called in which we can add a disappearing animation to the Loading Text and the loading of the MainMenuState. <br><pre> <code class="javascript hljs">PreloaderGameState.create = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tween = Game.add.tween(LoadingText).to({ <span class="hljs-attr"><span class="hljs-attr">alpha</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-number"><span class="hljs-number">1000</span></span>, Phaser.Easing.Linear.None, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); tween.onComplete.add(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ Game.state.start(<span class="hljs-string"><span class="hljs-string">'MainMenu'</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); };</code> </pre><br>  Complete PreloaderGameState () source code: <br><div class="spoiler">  <b class="spoiler_title">PreloaderGameState</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> PreloaderGameState = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Phaser.State(); PreloaderGameState.preload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ loadAssets(); }; PreloaderGameState.create = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tween = Game.add.tween(LoadingText).to({ <span class="hljs-attr"><span class="hljs-attr">alpha</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-number"><span class="hljs-number">1000</span></span>, Phaser.Easing.Linear.None, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); tween.onComplete.add(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ Game.state.start(<span class="hljs-string"><span class="hljs-string">'MainMenu'</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); };</code> </pre></div></div><br><h2>  Eventually </h2><br>  The result of this work is the presence of a game scene, a working preloader.  After successful loading of all resources, MainMenuState is called, which is already responsible for drawing the game menu. <br><br><h2>  useful links </h2><br>  <a href="http://phaser.io/">Phaser</a> <br>  <a href="https://github.com/photonstorm/phaser">Phaser (GitHub)</a> <br>  <a href="http://docs.phaser.io/">Phaser (documentation)</a> <br>  <a href="http://docs.phaser.io/Phaser.Game.html">Phaser.Game ()</a> <br>  <a href="http://docs.phaser.io/Phaser.Loader.html">Phaser.Loader ()</a> <br>  <a href="http://docs.phaser.io/Phaser.State.html">Phaser.State ()</a> <br>  <a href="http://docs.phaser.io/Phaser.StateManager.html">Phaser.StateManager ()</a> <br>  <a href="">Pixi.js (GitHub)</a> <br><br>  <a href="http://ghaiklor.github.io/flappy-bird/">FlappyBird</a> <br>  <a href="https://github.com/ghaiklor/flappy-bird">FlappyBird (GitHub)</a> <br>  <i><b>UPD:</b> In recent fixes, I removed the fullscreen mode, as many complain about performance.</i> <br><br>  I want to hear the opinion of the Habrahabr community.  Are you interested in the continuation?  In the second part, consider the following: <br><ul><li>  Making the game menu </li><li>  We initialize all game objects </li><li>  We add pleasant trifles </li><li>  Prepare the base for a seamless transition into the gameplay itself </li></ul></div><p>Source: <a href="https://habr.com/ru/post/214013/">https://habr.com/ru/post/214013/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../214001/index.html">New Graphene Application: High Efficiency Water Filters</a></li>
<li><a href="../214005/index.html">The experience of writing an article in a Chinese newspaper</a></li>
<li><a href="../214007/index.html">Rolls-Royce plans to build giant unmanned ships for maritime freight</a></li>
<li><a href="../214009/index.html">GitHab will soon launch a rich text editor.</a></li>
<li><a href="../214011/index.html">Weather Station on Ethernet (HTTP + Modbus) powered by POE</a></li>
<li><a href="../214015/index.html">Show Sound # 1-5 - Podcast about audio equipment, components, formats and technologies</a></li>
<li><a href="../214017/index.html">Business process simulator</a></li>
<li><a href="../214021/index.html">Why Intel will not leave the mobile market</a></li>
<li><a href="../214023/index.html">Voting and Information Security</a></li>
<li><a href="../214027/index.html">Massively parallel image stabilization</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>