<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>An instructive story about what can happen with a site on a shared-hosting</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The working day was slowly but surely coming to an end. Sunlight streamed through the blinds and flooded the office with golden crimson. Somewhere in ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>An instructive story about what can happen with a site on a shared-hosting</h1><div class="post__text post__text-html js-mediator-article"> The working day was slowly but surely coming to an end.  Sunlight streamed through the blinds and flooded the office with golden crimson.  Somewhere in the corner, a coffee machine was buzzing, squeezing out the remaining coffee from the capsule.  Our project discussed something lively with the designer, and I ruled shoals kindly left to me by a junior programmer. <br>  And everything seems to be nothing if it were not for the message: "What about your T site?" <br><a name="habracut"></a><br>  One of my good friends noticed that one of our sites is displayed incorrectly and let me know. <br>  I dropped all the cases and loaded the page with the site.  No problems were observed on it.  Well, unless a small redesign was required ... <br>  ‚ÄúEverything is all right with the site,‚Äù I wrote to my friend and again plunged into the fascinating world of code and bugs. <br>  After a while, my brain still took out the disturbing signal of my friend from memory and I involuntarily useful to re-check the site.  For some reason confident in the performance of the site, I experienced a light self-confidence. <br>  The main page of the site, sadly greeted me with a stray coding and the complete absence of css.  Black abracadabra symbols on a pristine white background brought me back to reality.  Self-confidence instantly disappeared and I began frantically pressing CTRL + F5 into the keyboard. <br>  "This is just a cache ... Yes ... Just a cache ..." - I repeated myself over and over again. <br><br>  When I realized that my tenth attempt to reset the browser cache does not give any results, and the main page of the site continues to change its appearance with each press on the cherished keys, the first thing that flashed through my head was ‚ÄúHacking ?!‚Äù.  My fears began to grow stronger when, after the next page reload, I saw a red and white inscription stating that such and such a table was not found. <br>  Hands themselves began to change everything related to the site, access: admin panel, database, SSH. <br>  After, I began to carefully study the logs.  Although the logs - it says loudly.  At my disposal were only reports on the web server.  MySQL crash logs and failed authorization attempts via SSH are not issued on shared hosting. <br>  Nothing strange was revealed in the logs and I went straight to the SSH console in order to connect to MySQL directly, because I clearly remember that the site cursed the lack of tables in the database. <br>  Very strange, but all the tables were in place (at least those on which the site cursed were exactly in place). <br>  As a CMS, on site T, 1C-Bitrix is ‚Äã‚Äãused.  We love this system very much and admire it in every possible way (with rare exceptions). <br>  What was my surprise when, going into the site settings, I saw the data from a completely foreign site R. The path to the root, the domain name and some other settings were changed.  I, stunned, looked at the monitor with round eyes in surprise.  At the same time, somewhere behind me, our project has already poured Valerian tincture.  For some reason I pressed F5.  What happened after that plunged me into the deepest shock and gloom.  Site settings again took normal values. <br>  At this moment, for a moment I doubted the adequacy of the entire IT industry as a whole and began to believe in miracles.  My wife's phone call brought me out of my stupor.  I picked up the phone.  Until now, I can‚Äôt remember what she was telling me, since the sensation of something mysterious did not leave me and my brain frantically tried to find at least some explanation of what had happened. <br>  I grunted something into the phone and hung up.  Well now, at least I'm sure of something.  I am sure that a lot of interesting information about myself awaits me at home. <br>  But this later, but now we need to understand what is happening. <br><br>  After the next reload of the page with the settings, I again saw other people's values. <br>  Judging by the absolute path to the root folder of the web server, we had prescribed the settings of the site, which was located on the same hosting as we. <br>  I instantly felt my handset and rang the tech support for the Hosting. <br>  From the conversation it became clear that they are not able to solve our problems right now.  The technical support officer politely let me know that I should write an appeal by email and my appeal will be reviewed within 24 hours, in the queue.  After I, just as politely, told them everything I thought about them, I hung up and wrote a letter to them, filled with epithets.  Just in case, we also wrote a letter to tech support for 1C-Bitrix. <br>  The dead silence of the office was broken only by the ticking of a large wall clock and the barely audible noise of the cooling system of the system unit.  A round-shaped white clock performed several functions in the office.  First, they were an element of the interior.  There is not much furniture in our office, nothing superfluous.  Although, I absolutely do not mind buying a large and soft sofa, so that in the breaks between tasks, you can lie down with a cup of coffee in your hands and, stretching your legs, immerse yourself in dreams that some day we will move away from developing websites and develop interesting ones. and of course innovative, in terms of gameplay, games. <br>  Secondly, this snow-white round clock still fulfilled the function embodied in them - they showed time.  If someone needed to know the time, then he certainly turned to this watch.  They have an inexplicable and almost hypnotic attraction.  And nobody cared that there was a clock in the smartphone at hand, or on the monitor screen. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So at this moment our pedantic warder inexorably counted time with every step of the second hand. <br>  And we all expected that just now, now, our mail server will receive the long-awaited response from any of the technical support. <br>  But there was still no letter.  About any work and speech could not be.  My brain, chasing a gray matter, tried to unravel this strange metamorphosis with the site T. <br>  Understanding that if the site is seen by its visitors in such a state, they will obviously not be happy, I‚Äôd come to close it from public access.  Moreover, if there is a hacking, it is quite possible that the site is already full of injections, in order to steal cookies, and therefore, a visit to this site is absolutely contraindicated. <br>  After pressing the cherished button in the settings of the main module, the site plunged into hibernation. <br>  Out of curiosity, I went to the site R, whose settings were registered in the settings of our site. <br>  Site Under Construction was on the main page of R. <br>  The brain tried to establish a connection between the two latest events and I again opened access to the site T. <br>  Returning to the site R, I saw that he recovered his performance. <br>  Coincidence or dependence? <br>  Having repeated the manipulations in the settings of the main module, I made sure that the dependence of site R on our site T and vice versa takes place here. <br>  But how can this be? <br>  All, than are connected sites T and R - this is hosting. <br><br>  ‚ÄúAnd let's call the phone number listed on the R website and try to explain the situation to them,‚Äù our project unexpectedly suggested to everyone. <br>  We did not have time to feel the whole genius of this idea, when suddenly a telephone call rang in the office. <br>  At the end of the tube were the guys who developed the site R and at the moment, too, are at a loss from what is happening. <br>  I was handed the phone. <br>  After a short conversation, it turned out that they, like us, have no idea about the causes of what is happening. <br>  "Apparently on the hosting, in some strange way, there is a symbolic link between our two bases," I suggested. <br>  Well, what other explanation could you find here?  Access to both databases is different, but, in some strange way, changes in their database affect ours and vice versa. <br>  ‚ÄúHave you tried creating another database?‚Äù I continued. <br>  ‚ÄúYes, this is the third‚Äù - they answered me at the other end with a sadness in my voice. <br>  Thus, the version with the symbolic link did not withstand any criticism. <br>  Those guys also wrote an appeal to technical support for hosting.  We exchanged names, skype and phones, having agreed to keep each other up to date. <br>  News from tech support Hosting all was not.  I dialed their number again and started explaining to the tech support employee that the situation is a stalemate and the same problem is already observed on two Hosting accounts. <br>  I did not hear anything intelligible in response.  At the end of a meaningless and fruitless conversation, I was finally convinced that hosting support would not help us. <br>  Well, at least it was clear that this is not hacking. <br>  From this moment on, I stopped hoping for technical support for the Hosting and took everything into my own hands. <br><br>  Something told me that I would get answers to my questions by going to the list of tables through the 1C-Bitrix admin panel.  Well, in fact, there were no other options from where to start the search. <br>  I was surprised at least the same when I found out that the contents of the b_lang table (where the site settings are stored) and the contents of the admin page of the site settings differ. <br>  What the hell?!  How can this be ?! <br>  ‚ÄúThere are two of them!‚Äù Flashed through my mind. <br>  ‚ÄúThere are two connections to the database‚Äù - I became more and more entrenched in this thought. <br>  How else to explain that the admin panel shows one thing, and the contents of the tables - another? <br>  A little more developing this idea, I remembered the <a href="http://php.net/manual/ru/features.persistent-connections.php">constant connection to the database</a> . <br>  Although, judging by the description of the technology of persistent connections, they are separated by at least a username and password when connecting to the database, but these data are different for the R and T sites. <br>  And yet, can the caching system somehow remember the connection and give it away with two completely different connections? <br>  By this time I was ready to believe in anything. <br>  I turned off the function of persistent connections in the 1C-Bitrix settings and, at the same time, left the caching type empty (before that there was the value - ‚ÄúAPC‚Äù). <br>  I asked the same to do and my colleagues in misfortune. <br>  When everything was ready, I pressed F5.  These were the longest and most exciting seconds of my life.  Well, it can not be so simple. <br>  Finally the page was loaded and ... the site earned!  Site R also had everything in order.  There was only one way to check if everything was normal.  I entered the main module settings and again sent the site to the ‚ÄúUnder Construction‚Äù state.  Site T, obediently followed this instruction, and site R remained in working condition.  This fact told us that the problem was successfully solved and the bases were no longer connected to each other. <br>  But what is the problem?  In persistent connections or in caching? <br>  It was possible to find out that the problem was that the sites that are not connected at all with each other were mixed with the APC cache. <br><br>  1C-Bitrix, in the dbconn.php file, forcibly caches the following tables: <br><ul><li>  b_file </li><li>  b_file_bucket_size </li><li>  b_lang </li><li>  b_option </li><li>  b_lang_domain </li><li>  b_site_template </li><li>  b_event </li><li>  b_agent </li></ul><br>  The list may vary. <br>  Among other tables, the very b_lang is clearly visible, where the settings of sites are stored.  Consequently, the T and R sites alternately recorded data in this table and cached it in APC.  When site R cached a table, site T took a cached copy and vice versa. <br>  But here's the most important question - how is it possible on a hosting, with thousands of working accounts, mixing the cache? <br>  After all, it turns out that any site that uses APC can interfere with the performance of any (almost) other site (also using APC), within the limits of this hosting (more precisely, the server). <br>  As a result - losses due to idle sites and, possibly, data theft, because you can cache anything. <br>  Is this the logic of the hosting operation is normal? <br>  After a brief discussion with the developers of the site R, we came to the conclusion that you can simply set a different BX_CACHE_SID for our sites. <br>  Obviously, there is a certain problem, since site T has worked on this hosting for about a year and a half and did not cause any complaints of this nature.  And then suddenly such an incident. <br><br>  Why did our cache get mixed up with site R? <br>  Why there are no mechanisms for delimiting the cache of different accounts on such a large hosting? <br>  With these questions I went home.  They did not go out of my head until the evening. <br>  At the door I was greeted warmly, already having time to miss me, my wife, and on the table stood a hot and deliciously smelling supper. <br>  ‚ÄúThis misunderstanding is over,‚Äù I thought with relief. <br>  Yes, someday we will definitely play games ... <br><br>  <b>UPD 1: having considered the</b> comments, I came to the conclusion that it is necessary to summarize a brief summary of the above. <br>  <b>Always set a unique cache ID and back up regularly</b> <br><br>  <b>UPD 2:</b> As a result of communication with the technical support of the Hosting, it turned out that they do not provide the account sharing service at all. <br>  They gave contacts to the director of technical support, to which you can send your wishes on the work of hosting. <br><br>  <b>UPD 3: The</b> head of the technical support service of the Hosting service shared with me wonderful information about the development of a new hosting environment in which separation of account caches will be provided. </div><p>Source: <a href="https://habr.com/ru/post/234071/">https://habr.com/ru/post/234071/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../234059/index.html">New board for OptimusBoard developers based on the eight-core big.LITTLE SoC AllWinner A80</a></li>
<li><a href="../234061/index.html">How to keep valuable frames: recipes for small companies</a></li>
<li><a href="../234065/index.html">On Habr√© embedded support for Ivideon or How to improve posts using live broadcast</a></li>
<li><a href="../234067/index.html">Now any site can find out the address of your page in VK?</a></li>
<li><a href="../234069/index.html">Habrahabr: life hacks for every day</a></li>
<li><a href="../234073/index.html">Clinical speech signal processing and machine learning. Part 1</a></li>
<li><a href="../234075/index.html">Twitter has begun to introduce extraneous tweets to the tape</a></li>
<li><a href="../234079/index.html">Cup PEGTOP (Cup-Yula) - a funny object or a killer of teaspoons?</a></li>
<li><a href="../234081/index.html">Looking for a Hype Cycle in Google Trends !?</a></li>
<li><a href="../234083/index.html">Redesign concept vk.com</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>