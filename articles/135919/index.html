<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simple minimalist implementation of complex JavaScript applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I want to describe a simple minimalist approach to developing complex JavaScript applications. Of the external libraries, only jQuery and my js templa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simple minimalist implementation of complex JavaScript applications</h1><div class="post__text post__text-html js-mediator-article"> I want to describe a simple minimalist approach to developing complex JavaScript applications.  Of the external libraries, only jQuery and my js template will be used, and from jQuery only <code>$.ready()</code> , <code>$.ajax()</code> and <code>$.proxy()</code> - i.e.  the essence is not in the libraries (they are trivial to replace them with those you prefer), but in the approach itself. <br><br>  The approach is based on two ideas: <br><ol><li>  JavaScript widgets are small modules, each of which ‚Äúowns‚Äù a certain part of a web page (i.e., all control of this part of the page occurs exclusively through the methods of this module, and not through direct modification of DOM ‚Äî <b>encapsulation</b> ).  The widget is solely responsible for the functionality, but not for the appearance;  therefore, direct modification of the part of the DOM that the widget ‚Äúowns‚Äù outside the widget is <i>allowed</i> - but only for purely design tasks (for the architecture and the total complexity of the application, there is no fundamental difference between the appearance correction via CSS or jQuery). </li><li>  Global Event Manager.  The interaction between the widgets is done by sending messages to the global dispatcher ( <b>weak connectivity</b> , <b>Mediator</b> pattern), and he already decides what to do with this message - create / delete widgets, pull methods of other widgets, execute designer code, etc.  In contrast to the dynamic approach to handling events (when handlers of a specific event are added / removed during work), the static dispatcher greatly simplifies understanding and debugging code.  Of course, there are tasks for which dynamic event handlers are needed, but in most cases this is an excessive complication, so all that is possible is done by static handlers. </li></ol><br><a name="habracut"></a><br><h4>  About bicycles </h4><br>  I usually develop the server part of the application (and more even not so much the website itself as network services), the client part is not my main profile.  So when I first had the task of developing a fairly complex one-page web application (about two years ago), I looked for ready-made architectural approaches for such applications, but, unfortunately, I did not find it (although by that time half a year had passed since the report Nicholas Zakas "Scalable JavaScript Application Architecture": <a href="http://www.youtube.com/watch%3Fv%3DvXjVFPosQHw">video</a> , <a href="http://www.slideshare.net/nzakas/scalable-javascript-application-architecture">slides</a> ). <br><br>  The architecture I developed at that time, I ran these two years on different projects, checked how it works on real tasks.  It works well.  :) That's why I decided to write this article.  In the process of writing, I looked again for other solutions, and found the report by Nicholas Zakas, plus I really liked the article Addy Osmani <a href="http://addyosmani.com/largescalejavascript/">Patterns For Large-Scale JavaScript Application Architecture</a> from the reading on this topic. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For those who are already familiar with the architecture described there, I will briefly describe the differences between my approach: <br><ul><li>  In my opinion, that architecture is necessary for applications of the scale of Yahoo !, GMail, etc.  but for the vast majority of modern, rather complex web applications, this is still a bust.  The excessive flexibility of this architecture comes at a price ‚Äî it increases the complexity of the application.  Here is an example of features in which I never had a real need: <br><ul><li>  the ability to simply replace the base library (for example jQuery with Dojo) </li><li>  check and control of ‚Äúaccess rights‚Äù of modules to the system functionality </li><li>  dynamic add / remove modules on the page </li><li>  I already wrote about dynamic event handlers above </li></ul></li><li>  This is not explicitly mentioned anywhere, but as far as I understood, in their architecture ‚Äúmodules‚Äù are practically whole large and complex applications (like chat on the GMail page or a weather widget on Yahoo).  My ‚Äúmodules‚Äù implement the <b>minimum possible</b> functionality that can be isolated into a separate isolated entity.  (However, Andrew Burgess ‚ÄúWriting Modular JavaScript‚Äù screen shows the same small modules as mine.) As an example, you can take a module that is responsible for a form with one input or a module that is responsible for outputting one value inside a single tag.  At the same time, these modules implement exactly the business logic of the application, and are not analogous to jQuery plug-ins that make the usual &lt;select&gt; very cool, beautiful and feature-rich &lt;select&gt;. <br><ul><li>  As a consequence of the difference in the scale of the functionality of the modules, their modules consist of HTML + CSS + JavaScript, and for me most of the modules are only JavaScript plus documentation on the minimum required for this module HTML structure. </li></ul></li><li>  Although I absolutely agree that it is necessary to clearly restrict what external functionality modules have access to (in fact, I wrote about this in the first paragraph of the article, it remains only to add a dispatcher to that list), but I believe that the most reliable, efficient and the safe code is the one that is not.  Therefore, if it is possible to replace the code with, for example, agreements, I usually prefer agreements (although, of course, here I also need to know the measure).  In my approach there is no code that would restrict the modules in access, but there is an agreement where modules can climb, and where not. </li></ul><br>  But, by and large, I then developed a minimalist version of the same architecture. <br><br><h4>  Start </h4><br>  Create a skeleton page of our application. <br><br>  <b>index.html</b> <br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ru"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UTF-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>    JavaScript <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://powerman.name/download/js/POWER.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--     --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> </span><span class="hljs-comment"><span class="actionscript"><span class="hljs-comment">/*    */</span></span></span><span class="actionscript"> </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--   html-   js- --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  Add a global event dispatcher.  Events are the textual name of the event and an optional hash with parameters. <br><br>  Usually, after the page loads, we need to perform some actions (at least create and add widgets to the page), and for consistency we will also process this event in the main dispatcher. <br><br>  <b>index.html</b> <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> notice = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> w = { }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e,data</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (e) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'document ready'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: alert(<span class="hljs-string"><span class="hljs-string">'notice: unknown event "'</span></span>+e+<span class="hljs-string"><span class="hljs-string">'"'</span></span>); } }; })(); $(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ notice(<span class="hljs-string"><span class="hljs-string">'document ready'</span></span>) });</code> </pre><br><br>  The hash <code>w</code> will be used to store the created widget objects - you need to store them somewhere after creation - plus that the dispatcher (who will create these objects) always has access to them. <br><br><h4>  And what are we doing? </h4><br>  The universal part is ready, it's time to decide what our application will do.  To demonstrate the complex dynamic interaction between different parts of the page, we will need several active elements, whose actions will be reflected in different parts of the page. <br><br>  Let's make an application where you can add / delete phrases, and it will show the number of any results for these phrases (for example, the number of errors found by the spelling checker).  Plus the total number of results for all phrases. <br><br><h4>  Architecture </h4><br>  Separate the necessary functionality between widgets.  The smaller and simpler the widgets are, the easier the application as a whole will be, so do not be surprised at their small size - this is not a feature of this application, but a recommended approach to the architecture of any complex applications. <br><ul><li>  AddPhrase - add phrase widget. <br><ul><li>  Methods: no. </li><li>  Generates events: <code>'add phrase'</code> . </li></ul></li><li>  Phrase - a widget that displays the added phrase, allowing it to be selected (for deletion) and add different handlers for this phrase (such as spelling check). <br><ul><li>  Methods: <code>add_handler</code> . </li><li>  Generates events: <code>'select phrase'</code> . </li></ul></li><li>  SpellCheck - a widget that displays the number of errors in this phrase.  Also responsible for the ajax service request. <br><ul><li>  Methods: no. </li><li>  Generates the events <code>'spellcheck: started'</code> and <code>'spellcheck: success'</code> . </li></ul></li><li>  Sum - a widget that displays the total number of results for all phrases. <br><ul><li>  Methods: <code>add</code> and <code>sub</code> . </li><li>  Generates events: no. </li></ul></li></ul><br><h4>  Widgets </h4><br>  Although the widget owns its area, it does not control exactly where this area is located on the page - i.e.  he does not know whether it is visible on the screen, and indeed whether it is added to the DOM or not.  For adding / deleting areas controlled by widgets to a page, an external code is responsible (that is, our global event dispatcher, or an external widget in the case when some widgets are nested in others). <br><br>  The absolute minimum of external functions is available to it inside the widget class: <br><ul><li>  global function <code>notice()</code> for generating events; </li><li>  jQuery <code>$</code> object; </li><li>  functions of the template library. </li></ul><br>  With rare exceptions, the widget should somehow be displayed on the screen.  The region of the page that he ‚Äúowns‚Äù usually either already exists (and then the widget is transferred to the widget's constructor <code>#id</code> ), or is generated on the fly by the widget from the js-template (and then the <code>#id</code> passed to the constructor). <br><br>  Everything else is not important.  My style: <br><ul><li>  Widgets are in separate <b>w.widget_name.js</b> files. </li><li>  Widgets are implemented as classes in the global namespace <code>W</code> , usually one widget is one class: <code>W.WidgetName</code> . </li><li>  Classes are implemented in the simplest and most natural for JavaScript form - the usual constructor functions and prototype inheritance. </li><li>  Private properties and methods begin with an underscore. </li><li>  At the beginning of the widget it is documented what kind of js-template (or HTML block) it needs;  constructor, public methods / properties, generated events. </li><li>  By convention, the area controlled by the widget is available through the property of the widget object <code>.$</code> (Its external code is inserted into the DOM to display the widget on the page). </li></ul><br>  A small terminological clarification.  Often a JavaScript widget is called a bundle of HTML + CSS + JavaScript.  My widgets can also be distributed along with their HTML and CSS chunks to facilitate their connection ‚Äúby default‚Äù to other applications, but I prefer to write widgets so that they have an absolute minimum of design information ‚Äî this simplifies both code and design changes.  Therefore, in the widgets described below you will not find a word about design. <br><br><h5>  Addphrase </h5><br>  The requirements of this widget for HTML - you need a form with one input type = text.  Anything else the designer can make out as you like. <br><br>  <b>w.addphrase.js</b> <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* * &lt;form id="addphrase"&gt;&lt;input type=text&gt;&lt;/form&gt; * * w = new W.AddPhrase('addphrase'); * * -&gt; 'add phrase', phrase * */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> W; W = W || {}; W.AddPhrase = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">id</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$ = $( <span class="hljs-string"><span class="hljs-string">'#'</span></span>+id ); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._input = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$.find(<span class="hljs-string"><span class="hljs-string">'input'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// cache this.$.submit( $.proxy(this,'_onsubmit') ); }; W.AddPhrase.prototype._onsubmit = function(){ notice('add phrase', { phrase: this._input.val() }); this._input.val(''); return false; };</span></span></code> </pre><br><br>  Add the creation of the widget when the page loads.  And a little code for usability - this code should be right here, and not in the widget, because  the widget does not know that in this application it is he who is the main element of the interface and work begins with it. <br><br>  <b>index.html</b> <br><pre> <code class="html hljs xml"> <span class="hljs-comment"><span class="hljs-comment">&lt;!--     --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"w.addphrase.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-comment"><span class="hljs-comment">&lt;!--   html-   js- --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addphrase"</span></span></span><span class="hljs-tag">&gt;</span></span>  : <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">text</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  <b>index.html</b> <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> notice = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> w = { <span class="hljs-attr"><span class="hljs-attr">addphrase</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e,data</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (e) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'document ready'</span></span>: w.addphrase = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> W.AddPhrase(<span class="hljs-string"><span class="hljs-string">'addphrase'</span></span>); $(<span class="hljs-string"><span class="hljs-string">'#addphrase input'</span></span>).focus(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'add phrase'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;</code> </pre><br><br>  Actually, that's all.  :) We have a universal widget that can be ‚Äúhung up‚Äù on any form, and which regularly generates events as the user enters phrases (while we ignore them in the manager, because there is still no widget that should process them). <br><br>  At the same time, there is not a single ‚Äúdrop of fat‚Äù in the widget - a line that does not relate to its immediate functionality.  In what style this functionality would not be realized, all these lines will be anyway.  In the dispatcher, of course, there are ‚Äúextra‚Äù lines - if we compare it with a non-modular application in the style of N-year-old, when all the code was written in one piece.  But in fact, these ‚Äúextra‚Äù lines are the most valuable in our application, since  It is they who visually and simply describe the high-level logic of the application. <br><br><h5>  Phrase </h5><br>  Using this widget as an example, we will look at working with js templates and nested widgets. <br><br>  The requirements of this widget for HTML - you need a js-template, in which the variable <code>phrase</code> will be passed, and in which there must be an element with the class <code>handlers</code> - widgets with the results will be added to it. <br><br>  <b>w.phrase.js</b> <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* * &lt;script type="text/x-tmpl" id="tmpl_phrase"&gt; * &lt;div&gt; * &lt;%= phrase %&gt; * &lt;span class="handlers"&gt;&lt;/span&gt; * &lt;/div&gt; * &lt;/script&gt; * * w = new W.Phrase('tmpl_phrase', 'some phrase'); * w.add_handler( new W.SomeHandler() ); * * -&gt; 'select phrase', phrase * */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> W; W = W || {}; W.Phrase = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">tmpl, phrase</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$ = $( POWER.render(tmpl, { <span class="hljs-string"><span class="hljs-string">'phrase'</span></span>: phrase }) ); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._phrase= phrase; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._w = []; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._h = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$.find(<span class="hljs-string"><span class="hljs-string">'.handlers'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// cache this.$.click( $.proxy(this,'_onclick') ); }; W.Phrase.prototype.add_handler = function(w_handler){ this._w.push( w_handler ); this._h.append( w_handler.$ ); }; W.Phrase.prototype._onclick = function(){ notice('select phrase', { phrase: this._phrase }); };</span></span></code> </pre><br><br>  I think everything is clear with templates.  But working with nested widgets is better explained. <br><br>  Although the spelling widget is ‚Äúnested‚Äù visually into the Phrase widget and the Phrase widget ‚Äúowns‚Äù the spelling widget (the only link to the spelling widget is in <code>this._w</code> , while all global widgets are held by the links in the hash <code>w</code> ), however As you can see, Phrase does not create a spelling widget object, but receives it as a parameter.  This dependency injection for increasing flexibility avoids dependencies between specific widgets and simplifies the creation of widget objects: the fact is that usually only the dispatcher has all the necessary data to call the designer of the embedded widget, and this approach avoids the transparent transmission of these parameters for constructors of nested widgets through constructors of external widgets. <br><br>  <b>index.html</b> <br><pre> <code class="html hljs xml"> <span class="hljs-comment"><span class="hljs-comment">&lt;!--     --&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"w.phrase.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-comment"><span class="hljs-comment">&lt;!--   html-   js- --&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"phrases"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/x-tmpl"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tmpl_phrase"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">%=</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">phrase</span></span></span></span><span class="xml"><span class="hljs-tag"> %&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"handlers"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  <b>index.html</b> <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> notice = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> w = { ... phrase: {} }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e,data</span></span></span><span class="hljs-function">)</span></span>{ ... case <span class="hljs-string"><span class="hljs-string">'add phrase'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(data.phrase <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> w.phrase) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; w.phrase[data.phrase] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> W.Phrase(<span class="hljs-string"><span class="hljs-string">'tmpl_phrase'</span></span>, data.phrase); $(<span class="hljs-string"><span class="hljs-string">'#phrases'</span></span>).append( w.phrase[data.phrase].$ ); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'select phrase'</span></span>: w.phrase[data.phrase].$.remove(); <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> w.phrase[data.phrase]; $(<span class="hljs-string"><span class="hljs-string">'#addphrase input'</span></span>).focus(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;</code> </pre><br><br>  A couple of explanations: firstly, we don‚Äôt have a W.SpellCheck widget, so we‚Äôre not calling <code>w.phrase[phrase].add_handler( new W.SpellCheck() )</code> ;  Secondly, after clicking on the widget, Phrase (to delete a phrase) loses the focus of the phrase input line, and it must be returned. <br><br><h5>  Spellcheck </h5><br>  Using the example of this widget, we will look at working with ajax. <br><br>  In addition, we will need to show the status of the ajax request (in the process, a response is received).  There are two different approaches: you can change the DOM in the manager (by handling the <code>'spellcheck: started'</code> and <code>'spellcheck: success'</code> events), and you can flash all the states inside the js-template and repeatedly execute / replace the template.  The second method is a bit more complicated, but because  we have an example, it is worth implementing it. <br><br>  To implement it, you have to use one trick.  The fact is that if we save the completed template to the property <code>.$</code> (as in the Phrase widget), then we will no longer be able to replace it - the fact is that the <i>value of</i> <code>.$</code> Will be added somewhere in the DOM (we are inside the widget we don‚Äôt know where), and if we just replace the value in <code>.$</code> new template, then the DOM will have a link to the old value <code>.$</code> and visually nothing will change on the page (and this widget will completely lose access to "its" part of the page).  To avoid this, any empty tag container (eg span or div) is saved in <code>.$</code> , And the result of the template execution is placed in it already.  Unfortunately, at the same time, a ‚Äúunexpected‚Äù tag appears for the designer on the page, but I did not think of how to solve this problem more elegantly. <br><br>  The requirements of this widget for HTML - you need a js-template, to which the <code>status</code> variables (possible values ‚Äã‚Äãof <code>"started"</code> and <code>"success"</code> ) and <code>spellerrors</code> (if the value of <code>status=="success"</code> ) are <code>spellerrors</code> . <br><br>  <b>w.spellcheck.js</b> <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* * &lt;script type="text/x-tmpl" id="tmpl_spellcheck"&gt; * &lt;% if (status == 'started') { %&gt; * ‚Ä¶ * &lt;% } else { %&gt; *  &lt;%= spellerrors %&gt; . * &lt;% } %&gt; * &lt;/script&gt; * * w = new W.SpellCheck('tmpl_spellcheck', 'some phrase'); * * -&gt; 'spellcheck: started', phrase * -&gt; 'spellcheck: success', phrase, spellerrors * */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> W; W = W || {}; W.SpellCheck = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">tmpl, phrase</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$ = $(<span class="hljs-string"><span class="hljs-string">'&lt;span&gt;'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._tmpl = tmpl; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._phrase= phrase; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._load(); }; W.SpellCheck.prototype._load = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ $.ajax({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'http://speller.yandex.net/services/spellservice.json/checkText'</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._phrase }, <span class="hljs-attr"><span class="hljs-attr">dataType</span></span>: <span class="hljs-string"><span class="hljs-string">'jsonp'</span></span>, <span class="hljs-attr"><span class="hljs-attr">success</span></span>: $.proxy(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>,<span class="hljs-string"><span class="hljs-string">'_load_success'</span></span>) }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$.html( POWER.render(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._tmpl, { <span class="hljs-attr"><span class="hljs-attr">status</span></span>: <span class="hljs-string"><span class="hljs-string">'started'</span></span> }) ); notice(<span class="hljs-string"><span class="hljs-string">'spellcheck: started'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">phrase</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._phrase }); } W.SpellCheck.prototype._load_success = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$.html( POWER.render(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._tmpl, { <span class="hljs-attr"><span class="hljs-attr">status</span></span>: <span class="hljs-string"><span class="hljs-string">'success'</span></span>, <span class="hljs-attr"><span class="hljs-attr">spellerrors</span></span>: data.length }) ); notice(<span class="hljs-string"><span class="hljs-string">'spellcheck: success'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">phrase</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._phrase, <span class="hljs-attr"><span class="hljs-attr">spellerrors</span></span>: data.length }); };</code> </pre><br><br>  <b>index.html</b> <br><pre> <code class="html hljs xml"> <span class="hljs-comment"><span class="hljs-comment">&lt;!--     --&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"w.spellcheck.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-comment"><span class="hljs-comment">&lt;!--   html-   js- --&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"phrases"</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/x-tmpl"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tmpl_spellcheck"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">%</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">if</span></span></span></span><span class="xml"><span class="hljs-tag"> (</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">status</span></span></span></span><span class="xml"><span class="hljs-tag"> == </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">'started'</span></span></span></span><span class="xml"><span class="hljs-tag">) { %&gt;</span></span></span><span class="xml"> (‚Ä¶) </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">%</span></span></span></span><span class="xml"><span class="hljs-tag"> } </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">else</span></span></span></span><span class="xml"><span class="hljs-tag"> { %&gt;</span></span></span><span class="xml"> ( </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">%=</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">spellerrors</span></span></span></span><span class="xml"><span class="hljs-tag"> %&gt;</span></span></span><span class="xml"> ) </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">%</span></span></span></span><span class="xml"><span class="hljs-tag"> } %&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  <b>index.html</b> <br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'add phrase'</span></span>: ... w.phrase[data.phrase].add_handler(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> W.SpellCheck(<span class="hljs-string"><span class="hljs-string">'tmpl_spellcheck'</span></span>, data.phrase)); ... break; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'spellcheck: started'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'spellcheck: success'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;</code> </pre><br><br><h5>  Sum </h5><br><br>  <b>w.sum.js</b> <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* * &lt;span id="sum"&gt;&lt;/span&gt; * * w = new W.Sum('sum'); * w.add(5); * w.sub(3); * */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> W; W = W || {}; W.Sum = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">id</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$ = $( <span class="hljs-string"><span class="hljs-string">'#'</span></span>+id ); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$.html(<span class="hljs-number"><span class="hljs-number">0</span></span>); }; W.Sum.prototype.add = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">n</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$.html( <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$.html()) + n ); }; W.Sum.prototype.sub = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">n</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$.html( <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$.html()) - n ); };</code> </pre><br><br>  <b>index.html</b> <br><pre> <code class="html hljs xml"> <span class="hljs-comment"><span class="hljs-comment">&lt;!--     --&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"w.sum.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-comment"><span class="hljs-comment">&lt;!--   html-   js- --&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span>: <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sum"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> .<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  <b>index.html</b> <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> notice = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> w = { ... sum: <span class="hljs-literal"><span class="hljs-literal">null</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> spellerrors = {}; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e,data</span></span></span><span class="hljs-function">)</span></span>{ ... case <span class="hljs-string"><span class="hljs-string">'document ready'</span></span>: ... w.sum = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> W.Sum(<span class="hljs-string"><span class="hljs-string">'sum'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'select phrase'</span></span>: ... if(data.phrase <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> spellerrors){ w.sum.sub(spellerrors[data.phrase]); <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> spellerrors[data.phrase]; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'spellcheck: success'</span></span>: w.sum.add(data.spellerrors); spellerrors[data.phrase] = data.spellerrors; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;</code> </pre><br><br><h4>  Total </h4><br>  In total for all files: 200 lines of HTML + JavaScript, 5.5KB.  Of these, almost 50 lines are documentation / comments. <br><br>  The issues of error handling, testing, logging and debugging are still behind the scenes.  Here I can not add anything new, everything is standard (for example, see the report Nicholas Zakas "Enterprise JavaScript Error Handling": <a href="http://www.slideshare.net/nzakas/enterprise-javascript-error-handling-presentation">slides</a> ). <br><br><h4>  Additional Information </h4><br>  The sources of the application described in the article are laid out on <a href="https://bitbucket.org/powerman/simple-js-app-example">bitbucket</a> , with step-by-step commit corresponding to the article.  You can also look at <a href="http://powerman.name/simple-js-app-example/">the application itself</a> . <br><br>  Those who want to criticize my approach to the implementation of the modules can first get acquainted with <a href="http://habrahabr.ru/blogs/javascript/117069/">my opinion on other approaches</a> .  Plus, there was once a little discussion about <a href="http://habrahabr.ru/blogs/jquery/91253/">my js template engine</a> . <br><br>  Other articles on this topic: <a href="http://habrahabr.ru/blogs/javascript/123635/">Scalable JavaScript applications</a> . </div><p>Source: <a href="https://habr.com/ru/post/135919/">https://habr.com/ru/post/135919/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../135913/index.html">Unicode for Dummies</a></li>
<li><a href="../135914/index.html">The interaction of the circuit in Proteus with the outside world</a></li>
<li><a href="../135915/index.html">Backdoor in Active Directory # 2</a></li>
<li><a href="../135916/index.html">Manual: Pyramid for People - Table of Contents</a></li>
<li><a href="../135917/index.html">New C ++ World Map from Alenacpp</a></li>
<li><a href="../135920/index.html">Generating a list of IPv4 addresses on TCL and some number systems</a></li>
<li><a href="../135921/index.html">Close the site mirror from indexing correctly</a></li>
<li><a href="../135922/index.html">JRebel Quickstart</a></li>
<li><a href="../135926/index.html">How do you type important letters?</a></li>
<li><a href="../135927/index.html">Browser "Internet"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>