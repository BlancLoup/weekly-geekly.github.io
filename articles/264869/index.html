<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Level Up for newbies: gulp and requirejs</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="- Water 
- Gulp 
- Require.js 

 Foreword 
 The quality of the application depends not only on what tasks and at what speed it solves, but also on suc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Level Up for newbies: gulp and requirejs</h1><div class="post__text post__text-html js-mediator-article"><ul><li>  <a href="https://habr.com/ru/post/264869/">Water</a> </li><li>  <a href="https://habr.com/ru/post/264869/">Gulp</a> </li><li>  <a href="https://habr.com/ru/post/264869/">Require.js</a> </li></ul><br><a name="water"></a><br><h2>  Foreword </h2><br>  The quality of the application depends not only on what tasks and at what speed it solves, but also on such seemingly secondary factors as ‚Äúcode beauty‚Äù. <br><br>  By the beauty of the code, I (I suppose many others) understand: <br><br><ul><li>  Readability </li><li>  Easy to change and add </li><li>  The ability for others to figure out how it works </li></ul><br>  Everyone at the dawn of his development path wrote code that was able to solve a certain (often even difficult) task, but when trying to change or adapt something to a similar task, problems arose. <br>  And the presentability of such a code was in doubt. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Let's deal with two tools that, in spite of their simplicity, will increase the presentability of the source code of your application and restore order in your head. <br><a name="habracut"></a><br><a name="gulp"></a><br><h2>  Gulp </h2><br>  What is gulp? <br>  This is a project collector. <br><br>  What is it for? <br>  The question is more complicated. <br><br>  Without losing the convenience of developing the output, you get the project in the form in which it should be: <br><br><ul><li>  Optimized images </li><li>  Minimized styles and scripts </li><li>  Other </li></ul><br>  In fact, you get two copies of the application: a working one, which is understandable to you, in which it is convenient to make edits, and public (public), already assembled from your pieces and optimized. <br><br>  Speaking about the project assembled from the pieces, I had in mind the implementation of a modular approach to programming, which, in my opinion, is extremely useful and is the starting point for the development of the developer.  The reasons for this are obvious: the ability to easily integrate any module into any project (without finishing the file), ease of testing and, most importantly, order in the head. <br><br>  Gulp is essentially a js script (set of scripts) that runs on a node.js server. <br>  This does not mean that you need to learn nodejs in order to use gulp, but you will need basic knowledge of its package manager (npm). <br><br>  Task one: put the <a href="https://nodejs.org/">node.js</a> server locally. <br>  I will not focus on this, too simple.  After installation we can use npm. <br><br>  Task two: install (in fact, download) gulp using the package manager. <br>  For makovodov this is as follows: in the terminal we will write <br><pre><code class="bash hljs">npm install gulp -g</code> </pre> <br>  The -g flag means that we set it globally so that you can start it in the terminal with the command <br><pre> <code class="bash hljs">gulp gulp task</code> </pre><br><br>  Then we set up the environment for our project by going to the console in the right folder. <br><pre> <code class="bash hljs">mkdir assets public assets/js assets/img assets/css touch gulpfile.js npm init npm i --save-dev gulp</code> </pre><br>  In order: <br><ul><li>  Create a folder structure </li><li>  Create a file of our collector settings </li><li>  We initialize npm to install useful modules in the assembly </li><li>  Install gulp with the key "--save-dev", that is, in the directory of our project </li></ul><br>  Similarly, with the last line we will install all the modules we need in the assembly. <br><pre> <code class="bash hljs">npm i --save-dev gulp gulp-autoprefixer gulp-concat-css gulp-connect gulp-livereload gulp-minify-css gulp-sass gulp-rename gulp-uncss gulp-uglify gulp-imagemin imagemin-pngquant</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Briefly about them</b> <div class="spoiler_text"><ul><li>  gulp-autoprefixer // Adds styles with prefixes to support browsers </li><li>  gulp-concat-css // merges styles into one file </li><li>  gulp-connect // Server </li><li>  gulp-livereload // Refreshes the page in the browser after code changes </li><li>  gulp-minify-css // Style minification </li><li>  gulp-sass // No comment (not yet needed) </li><li>  gulp-rename // renames files </li><li>  gulp-uncss // Removes extra styles </li><li>  gulp-uglify // Scripting minification </li><li>  gulp-imagemin // Image minification </li><li>  imagemin-pngquant // Image minification </li></ul><br></div></div><br>  Examples of use and connection are most clearly described <a href="http://gulpjs.com/plugins/">here</a> . <br><br>  Now all we need is to describe the settings file, how exactly our project should be assembled. <br>  To do this, in our configuration file (gulpfile.js) we will create tasks (tasks) <br><pre> <code class="javascript hljs">gulp.task(<span class="hljs-string"><span class="hljs-string">'js'</span></span>,<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  "js" gulp.src('./assets/js/*.js') //    .pipe(uglify()) //   .     .pipe(gulp.dest('./public/js/')) //    .pipe(connect.reload()); //   ( ) });</span></span></code> </pre><br>  For independent study I leave the full code of my <br><div class="spoiler">  <b class="spoiler_title">gulpfile.js</b> <div class="spoiler_text">  var gulp = require ('gulp'); <br>  var concatCss = require ('gulp-concat-css'); <br>  var minifyCss = require ('gulp-minify-css'); <br>  var rename = require ("gulp-rename"); <br>  var autoprefixer = require ('gulp-autoprefixer'); <br>  var livereload = require ('gulp-livereload'); <br>  var connect = require ('gulp-connect'); <br>  var sass = require ('gulp-sass'); <br>  var uglify = require ('gulp-uglify'); <br>  var imagemin = require ('gulp-imagemin'); <br>  var pngquant = require ('imagemin-pngquant'); <br><br>  // Basic <br>  gulp.task ('css', function () { <br>  gulp.src ('./ assets / css / *. css') <br>  .pipe (concatCss ("style.min.css")) <br>  .pipe (minifyCss ({compatibility: 'ie8'})) <br>  .pipe (autoprefixer ({ <br>  browsers: ['last 10 versions'], <br>  cascade: false <br>  })) <br>  .pipe (gulp.dest ('./ public / css /')); <br><br>  gulp.src ('./ assets / css / fight / *. css') <br>  .pipe (concatCss ("fight.min.css")) <br>  .pipe (minifyCss ({compatibility: 'ie8'})) <br>  .pipe (autoprefixer ({ <br>  browsers: ['last 10 versions'], <br>  cascade: false <br>  })) <br>  .pipe (gulp.dest ('./ public / css /')) <br>  .pipe (connect.reload ()); <br>  }); <br><br>  gulp.task ('sass', function () { <br>  gulp.src ('./ assets / sass / *. ccss') <br>  .pipe (sass ("style.css")) <br>  .pipe (minifyCss ('')) <br>  .pipe (rename ("style.sass.min.css")) <br>  .pipe (autoprefixer ({ <br>  browsers: ['last 10 versions'], <br>  cascade: false <br>  })) <br>  .pipe (gulp.dest ('./ public / css /')) <br>  .pipe (connect.reload ()); <br>  }); <br><br>  gulp.task ('html', function () { <br>  gulp.src ('./ assets / *. html') <br>  .pipe (gulp.dest ('./ public /')) <br>  .pipe (connect.reload ()); <br>  }); <br><br>  gulp.task ('fonts', function () { <br>  gulp.src ('./ assets / font / ** / *') <br>  .pipe (gulp.dest ('./ public / font /')) <br>  .pipe (connect.reload ()); <br>  }); <br><br>  gulp.task ('js', function () { <br>  gulp.src ('./ assets / js / *. js') <br>  .pipe (uglify ()) <br>  .pipe (gulp.dest ('./ public / js /')) <br>  .pipe (connect.reload ()); <br>  }); <br>  gulp.task ('jslibs', function () { <br>  gulp.src ('./ assets / js / libs / *. js') <br>  .pipe (uglify ()) <br>  .pipe (gulp.dest ('./ public / js / libs /')) <br>  .pipe (connect.reload ()); <br>  }); <br>  gulp.task ('jsmods', function () { <br>  gulp.src ('./ assets / js / modules / ** / *. js') <br>  .pipe (uglify ()) <br>  .pipe (gulp.dest ('./ public / js / modules /')) <br>  .pipe (connect.reload ()); <br>  }); <br><br>  gulp.task ('img', function () { <br>  gulp.src ('./ assets / img / *') <br>  .pipe (imagemin ({ <br>  progressive: true <br>  svgoPlugins: [{removeViewBox: false}], <br>  use: [pngquant ()] <br>  })) <br>  .pipe (gulp.dest ('./ public / img /')) <br>  .pipe (connect.reload ()); <br>  }); <br><br>  // connect <br>  gulp.task ('connect', function () { <br>  connect.server ({ <br>  root: 'public', <br>  livereload: true <br>  }); <br>  }); <br><br>  // Watch <br>  gulp.task ('watch', function () { <br>  gulp.watch ("./ assets / css / ** / *. css", ["css"]); <br>  gulp.watch ("./ assets / *. html", ["html"]); <br>  gulp.watch ("./ assets / js / *. js", ["js"]); <br>  gulp.watch ("./ assets / js / libs / *. js", ["jslibs"]); <br>  gulp.watch ("./ assets / js / modules / ** / *. js", ["jsmods"]); <br>  }); <br><br>  // Default <br>  gulp.task ('default', ["html", "css", "sass", "js", "jslibs", "jsmods", "connect", "watch"]); <br></div></div><br>  Focus only on a couple of things. <br>  Any of the created tasks (tasks) is launched from the console by the template. <br><pre> <code class="bash hljs">gulp task</code> </pre><br>  If we write just ‚Äúgulp‚Äù, that will start the default task, that is, default. <br><br>  Task Watch - built-in taskbar to track changes in files.  Its setup is so obvious (see the code above) that it‚Äôs sure everyone can handle it.  This task allows you not to call the project build process every time after any code changes.  As soon as you save the file, gulp will see it and rebuild the project, and in this case it will also refresh the page in the browser, and all you have to do is look at the desired monitor to see the result. <br>  To build a project with the above settings, just type in the console (being in the project folder) <br><pre> <code class="bash hljs">gulp img gulp</code> </pre><br>  Work with pictures made in a separate task for convenience (mine). <br>  After that, do not close the console, you have a watch'er and server running. <br><br>  In fact, you can write a small js function in each separate file, and the collector will collect all this into one file. <br>  Here we came close to the issue of modularity.  The above situation is very similar to the modular approach (from afar) - each function (module) is a separate file.  You will not get confused.  But what to do when one module depends on another, on several others, and those on others. <br>  Yes, there is already more difficult, it is necessary to think about the correct order of connecting modules.  And here we are come to the aid of requirejs, which implements the AMD (Asynchronous module definition) approach (there is also common.js, but about it in the next article). <br><a name="requirejs"></a><br><h2>  Require.js </h2><br>  Require.js will be mastered on a live example.  In <a href="http://habrahabr.ru/post/259907/">one of the previous articles,</a> we made a card toy.  As a result, we got just a <a href="https://github.com/seokirill/PlayingCardsMatreshka">bunch of code</a> , which we will now rake. <br><br>  First of all, <a href="http://requirejs.org/">download reuirejs</a> and connect it to our index.html, it will be the only script that we will connect in this way. <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-main</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"js/config"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"js/libs/require.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  In the data-main parameter, we pass the path to the entry point of our application (we do not specify the extension). <br><br>  Config.js in the simplest case is a list of aliases (although you can do without it) <br><div class="spoiler">  <b class="spoiler_title">Config.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs">requirejs.config({ <span class="hljs-attr"><span class="hljs-attr">paths</span></span>: { <span class="hljs-string"><span class="hljs-string">"rClck"</span></span> : <span class="hljs-string"><span class="hljs-string">"modules/disable_rclck"</span></span>, <span class="hljs-string"><span class="hljs-string">"app"</span></span> : <span class="hljs-string"><span class="hljs-string">"app"</span></span>, <span class="hljs-string"><span class="hljs-string">"socket"</span></span> : <span class="hljs-string"><span class="hljs-string">"modules/webSockets"</span></span>, <span class="hljs-string"><span class="hljs-string">"Actions"</span></span> : <span class="hljs-string"><span class="hljs-string">"modules/Actions"</span></span>, <span class="hljs-string"><span class="hljs-string">"User"</span></span> : <span class="hljs-string"><span class="hljs-string">"modules/User"</span></span>, <span class="hljs-string"><span class="hljs-string">"userList"</span></span> : <span class="hljs-string"><span class="hljs-string">"modules/userlist"</span></span>, <span class="hljs-string"><span class="hljs-string">"Matreshka"</span></span> : <span class="hljs-string"><span class="hljs-string">"libs/matreshka.min"</span></span>, <span class="hljs-string"><span class="hljs-string">"Modal"</span></span> : <span class="hljs-string"><span class="hljs-string">"modules/Modal"</span></span>, <span class="hljs-string"><span class="hljs-string">"fight"</span></span> : <span class="hljs-string"><span class="hljs-string">"modules/fight"</span></span>, <span class="hljs-string"><span class="hljs-string">"jquery"</span></span> : <span class="hljs-string"><span class="hljs-string">"libs/jquery"</span></span>, <span class="hljs-string"><span class="hljs-string">"myCards"</span></span> : <span class="hljs-string"><span class="hljs-string">"modules/myCards"</span></span>, <span class="hljs-string"><span class="hljs-string">"opCards"</span></span> : <span class="hljs-string"><span class="hljs-string">"modules/opCards"</span></span>, <span class="hljs-string"><span class="hljs-string">"mana"</span></span> : <span class="hljs-string"><span class="hljs-string">"modules/mana"</span></span> } }); <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>([<span class="hljs-string"><span class="hljs-string">'app'</span></span>],<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">app</span></span></span><span class="hljs-function">)</span></span>{ app.menu(); });</code> </pre><br></div></div><br><br>  The requirejs syntax is simple - we pass an array of dependencies (both paths and aliases are valid, everything is specified without the js extension), we describe a function that works after dependencies are satisfied (do not forget to pass modules on which we depend as arguments). <br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">require</span></span>([<span class="hljs-string"><span class="hljs-string">'app'</span></span>],<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">app</span></span></span><span class="hljs-function">)</span></span>{ app.menu(); });</code> </pre><br><br>  We connected the app module, after we call the menu () method of this module. <br>  The description of the modules is as follows: we pass an array of dependencies, we write a callback function, which returns our module. <br><pre> <code class="javascript hljs">define([<span class="hljs-string"><span class="hljs-string">'socket'</span></span>],<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">socket</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    socket var app = { menu: function(){ require(['Actions', 'Modal'],function(Actions, Modal){ //      if (socket.readyState === 1) { Actions.exec('loginFailed','   (  4 )'); }else{ Modal.box('   '); } }); } } return app; //    })</span></span></code> </pre><br><br>  The socket.readyState method checks if there is a connection to the server.  If yes, then we call the Actions.exec method, if not, the modal window (Modal.box). <br><br>  Actions, socket and Modal are separate independent modules on a par with the app module.  They have their own dependencies, their own logic, their own methods. <br><br>  Everything that we previously had in <a href="">one file</a> , we broke into modules.  Just because logically they are different pieces of code that are responsible for different tasks, whether it is connecting to the server via WebSockets, manipulating maps or ‚Äúother tasks‚Äù. <br><br>  For other tasks, I refer to what connects all the modules.  We used to have it all in the Actions object <br><div class="spoiler">  <b class="spoiler_title">Actions</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Actions = { <span class="hljs-attr"><span class="hljs-attr">send</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">method, args</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'send: '</span></span> + method); args = args || <span class="hljs-string"><span class="hljs-string">''</span></span>; socketInfo.method = method; socketInfo.args = args; socket.send(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(socketInfo)); }, <span class="hljs-attr"><span class="hljs-attr">resume</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ User = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(localStorage[<span class="hljs-string"><span class="hljs-string">'PlayingCardsUser'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.send(<span class="hljs-string"><span class="hljs-string">'reConnect'</span></span>,User.login); }, <span class="hljs-attr"><span class="hljs-attr">setMotion</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">login</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'setMotion: '</span></span> + login); User.currentMotion = login; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.motionMsg(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getCard(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setTimer(); } ...</code> </pre><br></div></div><br><br>  Data from the server comes in JSON format as <br> <code>{'function': 'fooName', 'args': [/ ]} <br></code> <br><br>  And earlier we called the necessary method as follows: <br><pre> <code class="javascript hljs">socket.onmessage = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> e.data === <span class="hljs-string"><span class="hljs-string">"string"</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> request = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(e.data); Actions[request.function](request.args); }; }</code> </pre><br><br>  But as our application grows and becomes more complex, the Actions object will grow to a level where it will be difficult to keep it in memory and navigate it.  That is why we divide it into small modules (the simplest units that perform an elementary function. I saw this ideology in the gulp, and I liked it). <br><br>  First we need a wrapper for calling the Actions method. <br><pre> <code class="javascript hljs">define([<span class="hljs-string"><span class="hljs-string">"socket"</span></span>],<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">socket</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Config var path = 'modules/Actions/'; var Actions = { exec: function(){ var args = Array.prototype.slice.call(arguments); var actionName = args.shift(); require([path + actionName],function(action){ //   action.run.apply(action,args); //   }); } } return Actions; })</span></span></code> </pre><br><br>  In the exec method of the Actions module, as the first argument, we take the name of our action (action), the remaining arguments are passed as arguments to this module. <br>  In the simplest case, the action module will look like this: <br><pre> <code class="javascript hljs">define([<span class="hljs-string"><span class="hljs-string">'myCards'</span></span>],<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">myCards</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    myCards var action = { run: function(card){ //  run()      Actions.js: action.run.apply(action,args); myCards.hand.add(card); //   } } return action; //    })</span></span></code> </pre><br><br>  This module is a wrapper for calling the add card method. <br><pre> <code class="javascript hljs">myCards.hand.add(card);</code> </pre><br><br>  This is necessary in order to isolate the modules from each other as much as possible.  So that at any time you can rewrite it painlessly, for example, using another framework. <br>  Theoretically, it would be possible to immediately receive information from the server about how to run the myCards.hand.add () method, but we are working with what we have.  We are trying to figure out how to clean up a bunch of code that already exists, sort it out. <br><br>  So, having initially one js file, where everything was described from and to, we divided it into modules responsible for the implementation of the cards (on the table and in the hand of each player), websockets and others.  And also let's write a new module and implement it to better understand everything.  This will be the mana module: <br><div class="spoiler">  <b class="spoiler_title">mana.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs">define([<span class="hljs-string"><span class="hljs-string">'Matreshka'</span></span>],<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Matreshka</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    Matreshka (js ) // var diamond = $('#icons #diamond').html(); var diamond = ''; ///////////     var manaModel = Matreshka.Class({ //   'extends': Matreshka.Object, constructor: function(data){ this.jset(data); this.on('render',function(){ this.bindNode('active', ':sandbox', Matreshka.binders.className( 'active' )); }); } }); var manaArray = Matreshka.Class({ //   'extends': Matreshka.Array, Model: manaModel, itemRenderer: '&lt;li&gt;&lt;/li&gt;', constructor: function(){ this.bindNode('sandbox','#mana'); //    }, add: function(){ //    if (this.length &gt;= 10) return; this.push({active:true}); }, spend: function(num){ var num = num || 0; var actives = this.filter(function(obj){ if (obj.active) return true; return false; }); if(actives.length &lt; num) { console.log(' '); return false; } //  num  for (var i = this.length - 1; i &gt;= this.length - num; i--) { this[i].active = false; }; return true; }, setAllActive: function(){ for (var i = this.length - 1; i &gt;= 0; i--) { this[i].active = true; }; } }); var mana = new manaArray; //    return mana; })</span></span></code> </pre><br></div></div><br><br>  A module is a list (array) of mana crystals.  What should he be able to? <br><br><ul><li>  Add crystal on each turn: add () </li><li>  Wasting full (active) mana crystals: spend () </li><li>  Replenish (make active) mana crystals every turn: setAllActive () </li></ul><br><br>  The point is that other modules do not need to know how these methods are implemented.  It is necessary to rewrite the module without any serious consequences for the same opportunity.  The main thing is to keep the logic. <br><br>  Let's introduce our new module into the existing toy, let the cost of the cards now be taken into account. <br>  Start by replenishing mana crystals every turn.  Each turn begins with a call to the action (the module called by the Actions module through our exec method) setMotion, which sets which player walks now. <br><div class="spoiler">  <b class="spoiler_title">setMotion.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs">define([<span class="hljs-string"><span class="hljs-string">'Actions'</span></span>, <span class="hljs-string"><span class="hljs-string">'User'</span></span>, <span class="hljs-string"><span class="hljs-string">'myCards'</span></span>,<span class="hljs-string"><span class="hljs-string">'mana'</span></span>],<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Actions, User, myCards, mana</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> action = { <span class="hljs-attr"><span class="hljs-attr">run</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">login</span></span></span><span class="hljs-function">)</span></span>{ User.currentMotion = login; Actions.exec(<span class="hljs-string"><span class="hljs-string">'motionMsg'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   ,    Actions.exec('setTimer'); //   (  2 ) if (User.meCurrent()) { //    myCards.arena.enableAll(); //     .   Actions.exec('getCard'); //   mana.setAllActive(); //     mana.add(); //    }; } } return action; })</span></span></code> </pre><br></div></div><br><br>  As you can see, the implementation of the first step was not difficult.  We simply added a call to this method at the right time (at the beginning of our turn).  And if we rewrite our module, everything will work as it worked.  The main thing is not to forget to implement the same logic. <br><br>  How to spend mana?  Obviously, this happens at the stage of putting cards out of hand on the table.  We make a change to this method: <br><div class="spoiler">  <b class="spoiler_title">It was</b> <div class="spoiler_text"><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.on(<span class="hljs-string"><span class="hljs-string">'click::sandbox'</span></span>,<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//      if(!User.meCurrent() || myCards.arena.length &gt;= 7) return; //          - false myCards.arena.push(this); //     myCards.hand.splice(myCards.hand.indexOf(this),1); //      Actions.exec('send', 'putCard',this.toJSON()); //    });</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">It became</b> <div class="spoiler_text"><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.on(<span class="hljs-string"><span class="hljs-string">'click::sandbox'</span></span>,<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//      if(!User.meCurrent() || myCards.arena.length &gt;= 7) return; if(!mana.spend(this.mana)) return; //      -  - false myCards.arena.push(this); myCards.hand.splice(myCards.hand.indexOf(this),1); Actions.exec('send', 'putCard',this.toJSON()); });</span></span></code> </pre><br></div></div><br><br><h2>  Conclusion </h2><br>  Applying easy-to-learn things, the study of which does not take you more than one day, we made a significant leap forward on the way to a quality application. <br>  Of course, the code is still far from ideal, but much more readable, more presentable and allows you to work on it further.  It's easier to force yourself to rewrite a small piece than a huge script. <br><br>  We will continue to improve this toy in the process of learning new technologies.  To fill my hand, I recommend to take some of your old project (not the easiest, so that was where the cones fill) and redo it with us. <br>  Repetition is the mother of learning. <br><br><h2>  Links </h2><br><ul><li>  <a href="https://github.com/seokirill/PlayingCardsMatreshka">What happened</a> </li><li>  <a href="https://github.com/seokirill/ModulePlayingCards">What became</a> </li><li>  (demo for technical reasons is not available yet) </li></ul></div><p>Source: <a href="https://habr.com/ru/post/264869/">https://habr.com/ru/post/264869/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../264859/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ172 (August 9 - 16, 2015)</a></li>
<li><a href="../264861/index.html">How to replace jQuery with D3 in a project</a></li>
<li><a href="../264863/index.html">Exception catching and handling in Yii2</a></li>
<li><a href="../264865/index.html">Open source Java online chat server</a></li>
<li><a href="../264867/index.html">Finite models of reactions and shock forces in problems on the motion of systems with non-holding coupling</a></li>
<li><a href="../264871/index.html">Deephack: hackathon for deep learning with reinforcements, or how we improved the Google Deepmind algorithm</a></li>
<li><a href="../264875/index.html">What do domain zone coordinators want?</a></li>
<li><a href="../264877/index.html">Yii environment. Inheritance and redefinition of configs</a></li>
<li><a href="../264881/index.html">Framework for validating data in iOS applications</a></li>
<li><a href="../264885/index.html">"Your privacy is very important to us." Read the Microsoft Privacy Statement</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>