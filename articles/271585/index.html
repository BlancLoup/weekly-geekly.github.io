<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We need less powerful programming languages.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today, many systems and programming languages ‚Äã‚Äãare positioned as "powerful." This is not to say that it is bad. Almost every one of us considers this...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We need less powerful programming languages.</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/a17/2ab/7af/a172ab7af3864e61a6ae1e1bb2f93c8c.jpg"><br><br>  Today, many systems and programming languages ‚Äã‚Äãare positioned as "powerful."  This is not to say that it is bad.  Almost every one of us considers this a positive property.  But in this post I want to convey this point of view that in many cases we need <b>less powerful</b> programming languages ‚Äã‚Äãand systems.  But before continuing, I will clarify: there will be few original, my own reflections.  I will present the course of thought that arose from reading Douglas Hofstadter‚Äôs book ‚Äú <a href="https://ru.wikipedia.org/wiki/%25D0%2593%25D1%2591%25D0%25B4%25D0%25B5%25D0%25BB%25D1%258C,_%25D0%25AD%25D1%2588%25D0%25B5%25D1%2580,_%25D0%2591%25D0%25B0%25D1%2585">G√∂del, Escher, Bach</a> ‚Äù, which helped me to put together the scattered ideas and thoughts that wandered in my head.  Also, the <a href="http://wadler.blogspot.co.uk/2006/03/rule-of-least-power.html">post of</a> Philip Wadler and the <a href="https://www.youtube.com/watch%3Fv%3DTS1lpKBMkgg%26t%3D28m32s">video</a> from the Scala conference had a great influence on the material below.  The key thought is: <br><br>  <i>Each increase in expressiveness places an additional burden on anyone who wants to understand the message.</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And I just want to illustrate this point with examples that will be closer and clearer to the Python programming community. <br><a name="habracut"></a><br>  A few words about the definitions.  What is meant by more or less powerful programming languages?  As part of the post, this can be roughly described as follows: ‚Äúfreedom and the ability to do whatever you want‚Äù from the point of view of the person writing the code or entering data into the system.  This is roughly correlated with the idea of ‚Äã‚Äã‚Äúexpressiveness,‚Äù although it is not a formal definition.  More precisely, many languages ‚Äã‚Äãhave the same level of expressiveness in terms of <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D0%25BE%25D0%25BB%25D0%25BD%25D0%25BE%25D1%2582%25D0%25B0_%25D0%25BF%25D0%25BE_%25D0%25A2%25D1%258C%25D1%258E%25D1%2580%25D0%25B8%25D0%25BD%25D0%25B3%25D1%2583">Turing completeness</a> .  But we, the developers, still distinguish some of them as more powerful, because they allow us to get a certain result through a smaller amount of code, or in several different ways, which gives more freedom. <br><br>  But with this freedom is not so simple.  Every bit of ‚Äúpower‚Äù that you demand when using a language is equal to the impact that you must provide when someone ‚Äúconsumes‚Äù what you have written.  Below are examples that are formally related to programming, but at the same time find a response in the shower. <br><br>  Someone will ask: ‚ÄúDoes it really matter at all?‚Äù Of course, it does so to the extent that you can ‚Äúconsume‚Äù the result of your system‚Äôs work.  Software users, compilers and other tools for developers can act as ‚Äúconsumers‚Äù, so you almost always care not only about the performance and correctness of your products, but also about people. <br><br><h1>  Databases and Schemes </h1><br>  At the lower level of the ‚Äúexpressiveness‚Äù scale is located something that can be attributed, rather, to data, and not to programming languages.  But both the data and the language must be perceived as ‚Äúa message received by someone,‚Äù so the same approach is applied here. <br><br>  Over the years I was often asked to make text boxes in any form.  From the point of view of the end user, this field embodies the highest level of ‚Äúpower‚Äù, because anything can be entered into it.  And within the framework of this logic, such a field is "most useful." <br><br>  But precisely because it is possible to enter any text in the field, it is the most useless, since it is worse amenable to structuring.  Even a search on such fields works unreliably - due to possible typos and different ways of describing things.  The longer I work with databases, the stronger the desire to strictly regulate everything that is possible.  And when I manage to do this, much more benefit can be gained from the data obtained.  That is, the more I limit the ‚Äúpower‚Äù (that is, the freedom) of the sources that enter data into the system, the more opportunities I get when this data is ‚Äúconsumed‚Äù. <br><br>  The same can be said about database technology.  Unstructured (schemaless) databases provide ample opportunities and flexibility for data entry, and more useless for their output.  Key-value storage is an analogue of ‚Äúfree-form text‚Äù with the same drawbacks: there is little use to it if you want to extract information or do something with the data, because you cannot be sure that there are any then specific keys. <br><br><h1>  HTML </h1><br>  In part, the success of the web was due to the deliberate limitation of the capabilities of key technologies ‚Äî HTML and CSS.  Yes, these are markup languages, not programming, but they are not made by chance.  It was a <a href="http://www.w3.org/DesignIssues/Principles.html">deliberately chosen concept</a> , one of the founders of which was Tim Berners Lee.  I will simply quote one passage: <i>‚ÄúFrom the 1960s to the 1980s, computer science made a lot of efforts to create more and more powerful programming languages.</i>  <i>But today there are reasons for choosing less powerful tools.</i>  <i>One of them is that the ‚Äúweaker‚Äù the language, the more you can do with the data stored in it.</i>  <i>If you write a simple declarative form, then anyone can write a program that analyzes this form in a variety of ways.</i>  <i>In a general sense, the Semantic Network is an attempt to convert large amounts of data into ordinary language in order to obtain such opportunities for analyzing this data that their creators did not dream of.</i> <i><br><br></i>  <i>For example, if a web page uses <a href="https://ru.wikipedia.org/wiki/Resource_Description_Framework">RDF</a> to present a weather forecast, users will be able to extract this data as a table, somehow process, average, plot graphs, compare with other information.</i>  <i>And compare this with a Java applet: information can be presented very nicely, but it cannot be analyzed.</i>  <i>The search bot does not understand what is presented on the page.</i>  <i>The only way to find out what a Java applet does is to launch it in front of a person sitting in front of the screen. ‚Äù</i> <br><br>  The <a href="http://www.w3.org/2001/tag/doc/leastPower-2006-02-23.html">W3C consortium</a> took the same position: <i>‚ÄúGood practice: use the least powerful language suitable for expressing information, connections or applications on the World Wide Web‚Äù</i> . <br><br>  This is almost completely contrary to the advice of <a href="http://www.paulgraham.com/avg.html">Paul Graham</a> (with the proviso that definitions of ‚Äúpower‚Äù are often far from formal): <i>‚ÄúIf you can choose from several languages, then other things being equal, it would be a mistake to program not on the most powerful of them‚Äù</i> . <br><br><h1>  File format MANIFEST.in </h1><br>  We now turn to the "real" programming languages.  As an example, I chose the format of the MANIFEST.in file used by the distutils and setuptools tools.  If you‚Äôve been able to create packages for Python libraries, then you are probably familiar with this format. <br><br>  In fact, it is a very small language that describes which files should be included in a package in Python (with respect to the MANIFEST.in file being called from the working directory).  For example: <br><br><pre><code class="bash hljs">include README.rst recursive-include foo *.py recursive-include tests * global-exclude *~ global-exclude *.pyc prune .DS_Store</code> </pre> <br>  There are two types of directives: <br><br><ul><li>  include (include, recursive-include, global-include and graft) </li><li>  exclude (exclude, recursive-exclude, global-exclude and prune) </li></ul><br>  The question arises: how are these directives interpreted?  What is their semantics? <br>  It can be interpreted as follows: ‚Äú <i>A file from the working directory (or a subdirectory) must be included in the package if it matches at least one include directive and does not match any exclude directive‚Äù.</i> <br><br>  It seems that this suggests that the language is declarative.  Unfortunately, this is not the case.  The <a href="https://docs.python.org/2/distutils/sourcedist.html">distutils documentation says about MANIFEST.in</a> - directives should be understood as follows: <br><br><ol><li>  Start with an empty list of files that should be included in the package.  More precisely, start with the default list; </li><li>  follow directives in MANIFEST.in <b>according to their order</b> ; </li><li>  for each include directive, copy all relevant files from the working directory to the package list; </li><li>  for each exclude type directive, remove all relevant files from the package list. </li></ol><br>  This example vividly illustrates the imperative nature of this language: each line of MANIFEST.in is a command whose action implies side effects.  This makes the language <b>more powerful</b> than the pseudo-declarative version given above.  Consider an example: <br><br><pre> <code class="bash hljs">recursive-include foo * recursive-exclude foo/bar * recursive-include foo *.png</code> </pre><br>  As a result of executing the list of these commands, the png-file (below foo / bar) is included in the package.  And everything above foo / bar is not included in the package.  To achieve the same result using declarative language would be more difficult, for example: <br><br><pre> <code class="bash hljs">recursive-include foo * recursive-exclude foo/bar *.txt *.rst *.gif *.jpeg *.py ...</code> </pre><br>  Since the imperative language is more powerful, there is a temptation to choose it.  However, the imperative version has several important flaws: <br><br><ol><li>  <b>Difficulties with optimization</b> .  When it comes to interpreting MANIFEST.in and generating a list of files to include in the package, there is only one effective solution: first make an unchangeable list of all files in the directory and subdirectories, and then apply rules to it.  Copy the files to the output list according to the rules of addition, and then delete some files from it according to the rules of exclusion.  This approach is now implemented in Python. <br><br>  It is a working option if you have relatively few files.  And when the list consists of thousands of positions, most of which should be excluded from the package, it takes a long time to form the final list. <br><br>  The solution to this problem looks obvious: do not climb into directories that will be excluded by some directives.  But this is only possible if the exclusion directives follow all the inclusion directives. <br><br>  This problem is not theoretical.  I found that due to the large number of files in the working directory, if you use, for example, the <a href="https://pypi.python.org/pypi/tox">tox</a> tool, the implementation of setup.py sdist and a number of other commands can reach 10 minutes.  That is, tox itself (using setup.py) will work very slowly.  Now <a href="https://bitbucket.org/pypa/setuptools/issues/450/egg_info-command-is-very-slow-if-there-are">I am trying to solve this problem</a> , but I think it will be very difficult to do it. <br><br>  At first glance, it would be possible to optimize (to use the file system less intensively by executing exclusive directives after all adding ones), but this complicates everything and the patch is unlikely to be accepted.  The number of branches of the code will increase, which means that the likelihood of multiple errors will increase. <br><br>  Probably the only acceptable solution would be to opt out of using MANIFEST.in at all, and optimize it only in cases when it is completely empty. </li><li>  <b>Reverse side of the ‚Äúpower‚Äù: it is more difficult to understand MANIFEST.in files.</b>  First of all, it is more difficult to master the principles of the language.  For the decorative version, the documentation would be significantly shorter than it actually is. <br><br>  In addition, when analyzing specific MANIFEST.in, you have to mentally execute commands, trying to present the result.  It would be much easier to place the lines in the order in which it was convenient for you. <br><br>  All this leads to errors when creating packages.  For example, it is easy to believe that the global-exclude * ~ directive at the beginning of MANIFEST.in means that all files whose names end in ~ (temporary files of some editors) will be excluded from the package.  Actually this directive does nothing at all.  And if one of the following directives tries to include some files in the package, they will be mistakenly included.  I found the following examples of this error (exclude directives that do not work as intended): <br><ul><li>  <a href="">hgview</a> (if placed at the very beginning of the file, it will not work); </li><li>  <a href="">django-mailer</a> (idle global exclusive directive at the beginning of the file). </li></ul></li><li>  You cannot group lines in MANIFEST.in for easier perception, since changing their order affects the composition of the package. </li></ol><br><h1>  Routing </h1><br>  Routing is one of the core components of Django.  This is the component that analyzes the URL and passes it to the handler of the given URL.  At the same time, it is possible, extracting some components from the URL. <br><br>  In Django, this is implemented using regular expressions.  Suppose we have an application that displays information about kittens, and the kittens / urls.py file contains this code: <br><br><pre> <code class="django hljs"><span class="xml"><span class="xml">from django.conf.urls import url from kittens import views urlpatterns = [ url(r'^kittens/$', views.list_kittens, name="kittens_list_kittens"), url(r'^kittens/(?P</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">id</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">\d+)/$', views.show_kitten, name="kittens_show_kitten"), ] ,  views.py  : def list_kittens(request): # ... def show_kitten(request, id=None): # ...</span></span></code> </pre><br><br>  Regular expressions have a built-in capture function used to get the parameters passed to the view function.  Let our application work at cuteness.com.  Then the address <a href="http://www.cuteness.com/kittens/23/">www.cuteness.com/kittens/23</a> will initiate a call to the show_kitten code (request, id = "23"). <br><br>  Since we can now route URLs to specific functions, web applications almost always have to generate these URLs.  Suppose we needed to include on the page with the list of kittens links to their personal pages: show_kitten.  And for sure we will want to do this by reusing the URL routing configuration. <br><br>  However, we will use it in the opposite direction.  When doing URL routing, do the following: <br><br><pre> <code class="django hljs"><span class="xml"><span class="xml">URL path -&gt; (handler function, arguments)</span></span></code> </pre><br>  When generating, we know the handler function and the necessary arguments.  And we have to generate a URL that will lead the user to the desired page <b>after performing the URL routing</b> : <br><br><pre> <code class="django hljs"><span class="xml"><span class="xml">(handler function, arguments) -&gt; URL path</span></span></code> </pre><br>  To do this, we need to be able to predict the behavior of the routing mechanism.  We ask: "What will be the input data for such a weekend?" At the very beginning of the Django story, there was no such functionality in it yet.  But <a href="https://groups.google.com/d/msg/django-developers/pdErxPsHPyQ/kAzz0mwqddwJ">it turned out</a> that in most cases you can ‚Äúchange the direction‚Äù of the URL template.  Regular expressions can be parsed to search for static and captured elements. <br><br>  Please note that this is possible only because the language used to define URL routes ‚Äî regular expressions ‚Äî has certain limitations.  Although it could be used for this and a much more powerful language.  For example, by defining URLs using functions that: <br><br><ul><li>  use URL as input; </li><li>  in case of a mismatch, NoMatch is issued; </li><li>  when matched, a truncated URL and a set of some captured parameters are returned. </li></ul><br>  Then our urls.py would look like this: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.conf.urls <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> url, NoMatch <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">match_kitten</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(path)</span></span></span><span class="hljs-function">:</span></span> KITTEN = <span class="hljs-string"><span class="hljs-string">'kitten/'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> path.startswith(KITTEN): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> path[len(KITTEN):], {} <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> NoMatch() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">capture_id</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(path)</span></span></span><span class="hljs-function">:</span></span> part = path.split(<span class="hljs-string"><span class="hljs-string">'/'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: id = int(part) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ValueError: <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> NoMatch() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> path[len(part)+<span class="hljs-number"><span class="hljs-number">1</span></span>:], {<span class="hljs-string"><span class="hljs-string">'id'</span></span>: id} urlpatterns = [ url([match_kitten], views.list_kittens, name=<span class="hljs-string"><span class="hljs-string">'kittens_list_kittens'</span></span>), url([match_kitten, capture_id], views.show_kitten, name=<span class="hljs-string"><span class="hljs-string">"kittens_show_kitten"</span></span>), ]</code> </pre><br>  Of course, match_kitten and capture_id could be made more concise: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.conf.urls <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> url, m, c urlpatterns = [ url([m(<span class="hljs-string"><span class="hljs-string">'kitten/'</span></span>), views.list_kittens, name=<span class="hljs-string"><span class="hljs-string">'kittens_list_kittens'</span></span>), url([m(<span class="hljs-string"><span class="hljs-string">'kitten/'</span></span>), c(int)], views.show_kitten, name=<span class="hljs-string"><span class="hljs-string">"kittens_show_kitten"</span></span>), ]</code> </pre><br>  Given that m and c are return functions, this language is more powerful for routing URLs than real, based on regular expressions.  The interface for matching and capturing has much more possibilities ‚Äî for example, it would be possible to search for an ID in a database, etc. <br><br>  But in this barrel of honey there is also tar: we would not be able to reverse URL.  In Turing-complete languages, one cannot ask: ‚ÄúWhat would be the input data for such an output?‚Äù Theoretically, one could look at the source code of the function to search for known patterns, but this is completely impractical. <br><br>  And with regular expressions that are limited in their capabilities, there are more options available.  In general, the regular-based URL configuration is not reversed, as simple expressions seem to be.  (just a point) cannot be reversed in a unique way.  And if we want to normally generate classic URLs, then we need a unique solution.  If a.  still comes across, Django arbitrarily chooses another character, other wildcard characters are not handled this way.  But since such characters are found only among the captured, it is quite possible to reverse regular expressions. <br><br>  So if we want to reliably reverse URL routes, we will need something less powerful than regular expressions.  At one time, they were chosen only because they were powerful <b>enough</b> , not realizing that their possibilities are redundant. <br><br>  Among other things, in Python, it is not so easy to define mini-languages ‚Äã‚Äãfor similar tasks.  Their implementation and use will require a considerable number of boilerplates and a level of detail - much more than when using ‚Äústring‚Äù languages ‚Äã‚Äãlike regular expressions.  By the way, in languages ‚Äã‚Äãlike Haskell, such things are made much easier thanks to fairly simple features like the definition of algebraic data types and pattern matching. <br><br><h1>  Regular expressions </h1><br>  The previous chapter reminded me of another problem.  In most cases, using regular expressions is quite simple.  But whenever you call a regular season, all its possibilities become immediately available to you, regardless of whether you need it or not.  One consequence in some cases is the need for backtracking to find all possible matches.  And that means you can deliberately create a combination of characters that will be VERY long processed by regular expressions. <br><br>  This, by the way, gave rise to <a href="https://en.wikipedia.org/wiki/ReDoS">a whole class of DoS-vulnerabilities</a> , one of which was found in Django - <a href="https://www.djangoproject.com/weblog/2015/jul/08/security-releases/">CVE-2015-5145</a> . <br><br><h1>  Patterns: Django vs Jinja </h1><br>  The creators of the <a href="http://jinja.pocoo.org/">Jinja</a> template engine were inspired by the <a href="https://docs.djangoproject.com/en/dev/topics/templates/">language of Django templates</a> , but somewhat changed its philosophy and syntax. <br><br>  <a href="https://docs.djangoproject.com/en/1.8/topics/performance/">Performance</a> is one of the main advantages of Jinja2.  Here, the Python code is compiled immediately, instead of executing an interpreter written in Python, as is done in Django, which gives a <a href="https://tomforb.es/just-how-slow-are-django-templates">5-20-fold</a> increase in performance. <br><br>  Jinja author Armin Ronher (Armin Ronacher) quite successfully <a href="https://groups.google.com/forum/">applied</a> the same approach to speed up the rendering of Django templates.  <a href="https://groups.google.com/d/msg/django-developers/amUQgS4QvOM/OusiikZSc4cJ">By proposing</a> this project, he knew that API extensions in Django make it very difficult to implement the approach implemented in Jinja.  In Django, you can use your own template tags, which gives you <a href="https://docs.djangoproject.com/en/dev/howto/custom-template-tags/">almost complete control</a> over the compilation and rendering steps.  This includes such powerful tags as <a href="http://ojii.ch/post/why-sekizai/">addtoblock in django-sekizai</a> , even at first glance it seems impossible.  But even if in such cases (infrequent) a slower version would be used, it would still be the benefit of a quick implementation. <br><br>  There was another important difference that influenced many patterns.  In Django, the passed context object (containing the data necessary for the template) can be overwritten during the template rendering process.  Template tags can assign a context, and some of them (for example, url) do just that. <br><br>  All this allowed to implement in Django the <a href="https://www.youtube.com/watch%3Fv%3DjXlR0Icvvh8%26t%3D19m3s">main part of the compilation in Python,</a> following the example of Jinja. <br><br>  Note that in both cases, the problem lies in the power of the Django engine ‚Äî it allows code authors to do things that are impossible in Jinja2.  As a result, we run into very big difficulties trying to compile fast code. <br><br>  This is quite an important point, since in some cases the template rendering speed may become the main problem of the project.  Because of this, <a href="http://insidenextstop.tumblr.com/post/425648605/real-world-django-vs-jinja-template-performance">quite a few</a> products have been <a href="http://askbot.org/en/question/8105/why-does-askbot-use-jinja/">transferred</a> to Jinja.  And this is an unhealthy situation! <br><br>  Often, only in hindsight it is possible to understand what exactly complicates optimization.  And it would be sly to assert that the introduction of some restrictions into the language will necessarily entail the simplification of the optimization process.  Although there are languages ‚Äã‚Äãin which the concept of limited opportunities for programmers and consumers is quite successfully implemented! <br><br>  It can be said that it was quite logical to make the context object rewritable, since the data structures in Python are mutable by default.  Which brings us to Python itself ... <br><br><h1>  Python </h1><br>  You can have different attitudes to the breadth of the possibilities of this language.  For example, as far as this complicates the life of each developer and program, faced with Python code. <br><br>  First of all, compilation and performance come to mind.  The almost complete absence of restrictions, which allows, among other things, to rewrite classes and modules, not only helps to do all sorts of useful things, but also greatly degrades performance.  The authors of <a href="http://pypy.org/">PyPy</a> managed to achieve impressive results, but <a href="http://speed.pypy.org/">judging by this dynamic</a> , they are unlikely to be able to achieve significant growth in the future.  Yes, and the achievements in performance were achieved at the cost of increasing memory consumption.  Simply, the Python code is optimized only up to a certain limit. <br><br>  In case you had such an opinion: I am not at all an opponent of Python or Django.  I am one of the leading developers at Django, and use it and Python in almost all my professional projects.  With this post I just want to illustrate the problems posed by the wide possibilities of programming languages. <br><br>  Let's talk now about refactoring and code support.  If you create serious projects, then surely a lot of time is spent on support.  And it is very important to be able to do this quickly and with a minimum of errors. <br><br>  Suppose, in the same Python, when using VCS (for example, Git or Mercurial), if you move a function from ten lines to another place, you will receive a diff into 20 lines, despite the fact that from the point of view of the program itself nothing has changed.  And if something has changed (the function was not only moved, but also modified), it will be very difficult to determine. <br><br>  Every time, when confronted with this, one wonders: why do we work with our complex-structured code as with a bunch of lines of plain text?  This is some kind of madness! <br><br>  You probably think that this problem can be solved with the help of <a href="https://www.semanticmerge.com/">advanced diff-tools</a> .  But the trouble is that in Python, changing the sequence of functions may actually affect the work of the program (meaning changes that occur at runtime). <br><br>  Here are some examples.  Take the previously defined function as the default argument: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a, callback=foo)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre><br>  If you change the order of the strings, then for foo in the definition of bar, a NameError error will crash. <br>  Let's use the decorator: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@decorateit def foo(): pass @decorateit def bar(): pass</span></span></code> </pre><br>  Because of the possible effects in @decorateit, you cannot change the order of these functions and be sure that the program will work the same way.  The same can be said about calling the code in the function argument list: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x=Something</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x=Something</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre><br><br>  Class attributes also cannot be interchanged: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Foo</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">()</span></span></span><span class="hljs-class">:</span></span> a = Bar() b = Bar()</code> </pre><br>  Here, the definition of b is set above a due to possible effects in the Bar constructor.  This may seem like a theorizing, but the same Django does use it inside the Model and Form definitions for the sake of providing standard field order, using a tricky counter at the class level inside the Field's base constructor. <br><br>  You will have to accept the fact that in Python the sequence of expressions of a function is a sequence of actions that result in the creation of objects (functions and arguments), some actions are performed with them, etc.  Unlike some other languages, you cannot change the order of declarations. <br><br>  This provides you with tremendous opportunities when writing code, but it does not allow you to turn around from the point of view of automation of manipulations with the ready-made code.  Refactoring is almost impossible to implement without fear, because of the possibilities of the language (for example, ‚Äú <a href="https://ru.wikipedia.org/wiki/%25D0%25A3%25D1%2582%25D0%25B8%25D0%25BD%25D0%25B0%25D1%258F_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25B8%25D0%25B7%25D0%25B0%25D1%2586%25D0%25B8%25D1%258F">duck typing</a> ‚Äù) you cannot rename methods.  And due to the likelihood of ‚Äúreflections‚Äù and dynamic access to attributes (getattr and others), you generally cannot safely rename in automatic mode. <br><br>  So do not rush to blame VCS or refactoring tools for all the troubles.  It's all about the breadth of Python itself.  Despite the huge number of structures in the code, there is little that can be done with the point of view of some kind of manipulation.  So, on closer inspection, the dependence of diff on the order of the rows does not look so bad. <br><br>  Today, we almost do not use decorators, because of which the order of definitions in the code becomes important, and this makes life a little easier for consumers.  But in rare cases, our tools still turn out to be practically useless.  For some consumers, you can optimize for some standard situation and detect the fact of failure, for example, use JIT checks.  But for other means (say, for VCS or refactoring tools) in case of failure it will be too late to collect performance information.  By the time the problem was discovered, you could have already released the ‚Äúcorrupted‚Äù code, so it is better to be vigilant than to apologize. <br><br>  In an ideal language, when renaming a diff function in VCS, it should look like "The foo function has been renamed to bar".         ‚Äî       ,   foo   bar.     ¬´ ¬ª .   -    Python           . <br><br>   ,   ,         .         . <br><br> ,   ,        ,        .       ,   ,       ‚Äî  .              ‚Äî  .                 .    ,         ,     (,     ),   . <br><br>        ,         ,       VCS,   .     <a href="http://peaker.github.io/lamdu/">Lamdu</a> ,            . <br><br><h1>  Results </h1><br>         (  ),       , :   ,    ,   .  , Slavery is freedom. , ,    <a href="http://calculist.blogspot.co.uk/2005/04/balance-of-expressiveness-and.html">     </a> . <br><br>   ,      , ,        .  ,   ,  VCS        . <br><br>    ,         . <br><br>   ,        ,        .     ‚Äî    ,    . <br><br>  ,     ,        .          ,         . </div><p>Source: <a href="https://habr.com/ru/post/271585/">https://habr.com/ru/post/271585/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../271573/index.html">First February - International Aid Day</a></li>
<li><a href="../271575/index.html">Improving network security with Content Security Policy</a></li>
<li><a href="../271577/index.html">We will load everything: demonstration of the –ÜXIA solution for load tests</a></li>
<li><a href="../271581/index.html">How to master PowerShell professionally in 5 days and become a ‚Äúlazy‚Äù administrator?</a></li>
<li><a href="../271583/index.html">Atomic processing of data blocks without blocking</a></li>
<li><a href="../271587/index.html">Microsoft has withdrawn the updated Windows 10 from the download portal</a></li>
<li><a href="../271589/index.html">IBM Watson taught to discuss world-class problems</a></li>
<li><a href="../271591/index.html">Centralized Email Alerts</a></li>
<li><a href="../271593/index.html">Micro-conference UX-Environment ‚Ññ26: Design Education in Russia</a></li>
<li><a href="../271595/index.html">Cisco Switch and Hewlett Packard Enterprise Switch Virtualization Technologies</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>