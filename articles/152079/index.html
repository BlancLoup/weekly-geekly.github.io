<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Graph database Neo4j in PHP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, I increasingly hear about NoSQL and graph databases in particular. But using habopoisk I was surprised to find that there are not so many ar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Graph database Neo4j in PHP</h1><div class="post__text post__text-html js-mediator-article">  Recently, I increasingly hear about NoSQL and graph databases in particular.  But using habopoisk I was surprised to find that there are not so many articles on this topic, but on the request of ‚ÄúNeo4j‚Äù, there are 4 results in general, where this title is indirectly mentioned in the text of the articles. <br><br><h4>  What is Neo4j? </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/ee3/471/303/ee3471303a0fb5895976add1cf18433c.png" align="right" alt="image"><br>  <a href="http://neo4j.org/">Neo4j</a> is a high-performance, NoSQL database based on graph principle.  There is no such thing as a table with strictly defined fields, it operates with a flexible structure in the form of nodes and links between them. <br><br><h4>  How did I get to this? </h4><br>  For more than a year I have not used SQL in my projects since I tried the document-oriented DBMS " <a href="http://www.mongodb.org/">MongoDB</a> ".  After MySQL, my joy knew no bounds, how simple and convenient everything can be done in MongoDB.  For the year, in our <a href="http://rework.pro/">website development studio</a> , we rewrote the top three CMS using Mongo's main features with its documents, and about a dozen sites operating on their basis.  Everything was fine, and I had already begun to forget what it was to write requests in fifty lines for each action from the database and everything would be fine until the project fell on my head with a bunch of relationships that didn‚Äôt fit into the documents.  I really didn‚Äôt want to go back to SQL, and I spent a couple of days purely searching for a NoSQL solution that allows you to make flexible connections ‚Äî on graph DBMS.  And for a number of reasons my choice was on Neo4j, one of the main reasons is that my engine was written in PHP, and for it a good driver " <a href="https://github.com/jadell/Neo4jPHP">Neo4jPHP</a> " was written, which covers almost 100% of the REST interface provided by the Noe4j server. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Closer to the point </h4><br>  Graph databases, in the first place, are designed to solve those problems where the data are closely related to each other in relationships that can go into several levels.  For example, in relational databases it‚Äôs not difficult for us to fulfill a query: ‚ÄúGive me a list of all the actors who were in the film with Kevin Bacon.‚Äù <br><br><pre><code class="sql hljs">&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> actor_name, role_name <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">roles</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> movie_title <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> movie_title <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">roles</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> actor_name=<span class="hljs-string"><span class="hljs-string">'Kevin Bacon'</span></span>)</code> </pre> <br><br>  Cited an example with a request, you can rewrite it in your head using "JOIN". <br><br>  But suppose we want to get the names of all the actors who were in the movie with someone who was in the movie with Kevin Bacon.  And here we have another JOIN.  And now try adding a third degree: ‚ÄúThe one who was in the movie with someone, who was in the movie with someone who was in the film with Kevin Bacon.‚Äù It sounds scary, but the task is real and with each new connection we need add JOIN, and the query will be becoming more complex, time consuming, less and less productive. <br><br>  Deep ties are especially relevant in various social projects, when we need to get friends of friends, in the tasks of finding routes, etc.  Graph databases are designed to solve these problems when our data can be separated from one another in two or more relationships.  They are solved very elegantly when we model the data as ‚Äúgraph vertices‚Äù, and connections as graph edges between these nodes.  We can do a graph traversal using well-known and efficient algorithms. <br><br>  The above example can be easily modeled as follows: each actor and film are nodes, and the roles are the relationships that go from the actor to the movie where they played: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ae4/c77/b41/ae4c77b4113e5b8ddff975b2bf62f5b4.png" alt="image"><br><br>  Now it becomes very easy to find a path from Kevin Bacon to any other actor. <br><br><h4>  Some code </h4><br>  First, we need to establish a connection to the database.  Since Neo4jPHP works with the database server through the REST interface, there is no permanent connection, and data transfer occurs only when we need to read or write data: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Everyman</span></span>\<span class="hljs-title"><span class="hljs-title">Neo4j</span></span>\<span class="hljs-title"><span class="hljs-title">Client</span></span>, <span class="hljs-title"><span class="hljs-title">Everyman</span></span>\<span class="hljs-title"><span class="hljs-title">Neo4j</span></span>\<span class="hljs-title"><span class="hljs-title">Transport</span></span>, <span class="hljs-title"><span class="hljs-title">Everyman</span></span>\<span class="hljs-title"><span class="hljs-title">Neo4j</span></span>\<span class="hljs-title"><span class="hljs-title">Node</span></span>, <span class="hljs-title"><span class="hljs-title">Everyman</span></span>\<span class="hljs-title"><span class="hljs-title">Neo4j</span></span>\<span class="hljs-title"><span class="hljs-title">Relationship</span></span>; $client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Client(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Transport(<span class="hljs-string"><span class="hljs-string">'localhost'</span></span>, <span class="hljs-number"><span class="hljs-number">7474</span></span>));</code> </pre><br><br>  Now we need to create nodes for each actor and film.  This is similar to how we do INSERT in traditional relational database management systems: <br><br><pre> <code class="php hljs">$keanu = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Node($client); $keanu-&gt;setProperty(<span class="hljs-string"><span class="hljs-string">'name'</span></span>, <span class="hljs-string"><span class="hljs-string">'Keanu Reeves'</span></span>)-&gt;save(); $laurence = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Node($client); $laurence-&gt;setProperty(<span class="hljs-string"><span class="hljs-string">'name'</span></span>, <span class="hljs-string"><span class="hljs-string">'Laurence Fishburne'</span></span>)-&gt;save(); $jennifer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Node($client); $jennifer-&gt;setProperty(<span class="hljs-string"><span class="hljs-string">'name'</span></span>, <span class="hljs-string"><span class="hljs-string">'Jennifer Connelly'</span></span>)-&gt;save(); $kevin = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Node($client); $kevin-&gt;setProperty(<span class="hljs-string"><span class="hljs-string">'name'</span></span>, <span class="hljs-string"><span class="hljs-string">'Kevin Bacon'</span></span>)-&gt;save(); $matrix = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Node($client); $matrix-&gt;setProperty(<span class="hljs-string"><span class="hljs-string">'title'</span></span>, <span class="hljs-string"><span class="hljs-string">'The Matrix'</span></span>)-&gt;save(); $higherLearning = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Node($client); $higherLearning-&gt;setProperty(<span class="hljs-string"><span class="hljs-string">'title'</span></span>, <span class="hljs-string"><span class="hljs-string">'Higher Learning'</span></span>)-&gt;save(); $mysticRiver = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Node($client); $mysticRiver-&gt;setProperty(<span class="hljs-string"><span class="hljs-string">'title'</span></span>, <span class="hljs-string"><span class="hljs-string">'Mystic River'</span></span>)-&gt;save();</code> </pre><br><br>  Each node has <b>setProperty</b> and <b>getProperty methods</b> that allow you to write arbitrary data to the node to read it.  The node does not have a specified structure, it looks like documents in document-oriented DBMS, although we cannot make nested data and the property can only be of one of two types: a string or a number. <br>  Data is sent to the server only when we call save () and this needs to be done for each node. <br><br>  Now we have to define the connections between the actors and the films they played.  In relational DBMS for this purpose we would create a foreign key, here we will create a relation that can be arbitrarily called to store any parameters in us, like a node, and it is also stored in the database: <br><br><pre> <code class="php hljs">$keanu-&gt;relateTo($matrix, <span class="hljs-string"><span class="hljs-string">'IN'</span></span>)-&gt;save(); $laurence-&gt;relateTo($matrix, <span class="hljs-string"><span class="hljs-string">'IN'</span></span>)-&gt;save(); $laurence-&gt;relateTo($higherLearning, <span class="hljs-string"><span class="hljs-string">'IN'</span></span>)-&gt;save(); $jennifer-&gt;relateTo($higherLearning, <span class="hljs-string"><span class="hljs-string">'IN'</span></span>)-&gt;save(); $laurence-&gt;relateTo($mysticRiver, <span class="hljs-string"><span class="hljs-string">'IN'</span></span>)-&gt;save(); $kevin-&gt;relateTo($mysticRiver, <span class="hljs-string"><span class="hljs-string">'IN'</span></span>)-&gt;save();</code> </pre><br><br>  As you can see, all relations are called ‚ÄúIN‚Äù, but we can give them any other name, for example ‚ÄúACTED IN‚Äù.  We can also set the inverse relationship from films to actors and formulate it as a film ‚ÄúHAS‚Äù (has) an actor.  Paths can be found no matter what direction of communication we will create, i.e.  we can use any semantics suitable for the specific subject area.  At the same time, there can be multiple relations between the nodes in both directions. <br><br>  All relationships are tuned, and now we are ready to find a connection between any actor in our system and Kevin Bacon to any given depth: <br><br><pre> <code class="php hljs">$path = $keanu-&gt;findPathsTo($kevin) -&gt;setMaxDepth(<span class="hljs-number"><span class="hljs-number">12</span></span>) -&gt;getSinglePath(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($path <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $i =&gt; $node) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($i % <span class="hljs-number"><span class="hljs-number">2</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $node-&gt;getProperty(<span class="hljs-string"><span class="hljs-string">'name'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($i+<span class="hljs-number"><span class="hljs-number">1</span></span> != count($path)) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">" was in\n"</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"\t"</span></span> . $node-&gt;getProperty(<span class="hljs-string"><span class="hljs-string">'title'</span></span>) . <span class="hljs-string"><span class="hljs-string">" with\n"</span></span>; } }</code> </pre><br><br>  We can also choose not the nodes themselves, but the connections between them, for example: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $laurence-&gt;getProperty(<span class="hljs-string"><span class="hljs-string">'name'</span></span>) . <span class="hljs-string"><span class="hljs-string">" was in:\n"</span></span>; $relationships = $laurence-&gt;getRelationships(<span class="hljs-string"><span class="hljs-string">'IN'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($relationships <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $relationship) { $movie = $relationship-&gt;getEndNode(); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"\t"</span></span> . $movie-&gt;getProperty(<span class="hljs-string"><span class="hljs-string">'title'</span></span>) . <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; }</code> </pre><br><br>  <b>getRelationships</b> - can return all relations for a node; it is not necessary to limit it to only a specific type of relationship.  We can also receive only all incoming or outgoing communications. <br><br>  At this point, I‚Äôll finish this post, and I hope it will give some resonance to writing articles on the subject of graph databases and neo4j in particular. <br><br>  <i>The article used an example from the developer site <a href="http://blog.everymansoftware.com/2011/06/neo4j-for-php.html">Neo4jPHP</a> with changes and comments based on my personal experience.</i> </div><p>Source: <a href="https://habr.com/ru/post/152079/">https://habr.com/ru/post/152079/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../152072/index.html">Six ways to win your customers' trust</a></li>
<li><a href="../152075/index.html">2 free paper templates for mobile app prototyping</a></li>
<li><a href="../152076/index.html">Kindle 3 upgrade to version 3.4</a></li>
<li><a href="../152077/index.html">Atypical story "house" provider</a></li>
<li><a href="../152078/index.html">Passbook earned in Russia</a></li>
<li><a href="../152080/index.html">Reverse tethering (get internet on android from linux pc)</a></li>
<li><a href="../152081/index.html">Apple invites former Google Maps employees to work</a></li>
<li><a href="../152082/index.html">Ubuntu 12.10 will advertise and music store</a></li>
<li><a href="../152083/index.html">Rambler-Kart API Update</a></li>
<li><a href="../152085/index.html">Pistol Laser Gun for Nintendo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>