<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Timing for amateur racing, flexible and wireless</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. 
 For some time, I became interested in amateur motor racing - no, not night street racing, but quite legal competitions held in the daytime an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Timing for amateur racing, flexible and wireless</h1><div class="post__text post__text-html js-mediator-article"> Hello. <br>  For some time, I became interested in amateur motor racing - no, not night street racing, but quite legal competitions held in the daytime and agreed with the relevant structures.  As many guess, the purpose of such competitions is to drive the distance faster than the opponent.  What is necessary to measure the time of passage of a distance. <br><a name="habracut"></a><br>  The easiest way is to hand out stopwatches to the judges and teach them to press the Start / Stop button in time.  Obvious disadvantages of this method are unbearable low accuracy and suspicions of the participants about the involvement of judges.  Another point - during the 3rd category amateur rally, the start and finish are often separated from each other, and the time is measured at the ‚Äúsynchronized‚Äù referee's clock.  In practice, these are Chinese alarm clocks of 30 r each, which run away from each other for a few seconds in 10 minutes. <br><br>  The modern way is to use telemetry.  The most common option is one or two target, triggered at the intersection of the infrared beam, and on these intersections control the stopwatch.  Seen by me versions of versions (amateur, do not take into account professional systems), left to wish and hope for the best. <br><br>  Example 1. Rides on a quarter mile (402m), it is - Drag racing.  At the start, the IR target is set with the 2nd or 3rd ray pairs.  At the finish line there is also a target with a pair of rays, one beam for each track.  The starting traffic light is connected to the starting line.  At the command of the controller, the traffic light starts counting the starting sequence, after which the participants begin the race.  The time is counted from the moment of ignition of the green signal, until the moment of crossing the finish section. <br>  The logic and structure of such a system is obvious.  A small minus is half a kilometer of wires connecting the starting and finishing target. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Example 2. Ring races on time, the so-called Time Attack.  Rides on the ring, at the same time at a distance of 2 participants.  The result of arrival is the lap time of the participant, equal to the interval between successive passes of the alignment. <br>  All too obvious.  Cons, I saw the implementation: <br>  - the need for each participant to pass only ‚Äúhis‚Äù target, which is indicated to him at the start, otherwise the system incorrectly counts the lap time; <br>  - in connection with the previous point - finding a part of the structure in the middle of the strip, which is fraught with consequences - quite often there were attacks on the central rack with the system being inoperative; <br>  - instability of the system to false alarms, if a foreign object passed through the target, such as a downed cone, part of a fallen bumper, etc.  This operation led to the termination of arrival, and re-start.  And the participant was already driving on the ‚Äúlast money‚Äù, with a knocking motor, and tried to win.  It's a shame, yes. <br><br>  Example 3. Rally sprint, start and finish are separated by a decent distance - about a hundred or two hundred meters, participants start at intervals of 2-3 minutes, up to 7-10 cars can be at a distance simultaneously, depending on the length.  The time of passing the distance is measured by the actions of two judges - the judge at the start gives the starting essay at a certain time by the clock, the judge at the finish - records the time of the finish by his watch, according to the difference of readings time goes to offset. <br>  The disadvantages of this timekeeping method are the asynchronous hours at the start and at the finish (as I wrote, Chinese alarm clocks are often used from the stall in the transition), and the influence of the human factor (the judge at the start can release the car sooner or later, as well as the finish judge can fix the moment of passage is not accurate enough). <br><br>  At the next event, having heard plenty of complaints from participants and organizers, I was asked to assemble the system under ‚Äútheir‚Äù requirements, for use in amateur motorsport competitions. <br>  The requirements for this system were formed: <br>  - Cheap.  According to the organizers, the rental price of a semi-professional system comes to 15 thousand rubles.  on the day of the competition - obviously not for enthusiasts this option; <br>  - Ability to adapt to various types of events - drag, ring, rally sprint, etc .; <br>  - Ease of deployment and transportation - a minimum of parts, wires and other accessories; <br>  - Maximum automation of the competition process - counting time, placing results, and more. <br><br>  In accordance with these requirements, it was decided to implement a modular system, with wireless transmission of information, with the ability to process information on a PC and output the results to a printer or screen. <br><br>  The modularity of the system consists in creating independent IR gateways that can be placed at a distance in a virtually arbitrary configuration, at the start, at the finish, at an intermediate finish, and so on. <br>  Each target is able to record the time of the beam crossing and transmit the moment of fixation to the central console (the console is implemented on a laptop).  The moment of fixation is a complete time stamp, including year, month, day, time with an accuracy of 1 ms.  Thus, having information about the moments of crossing the alignment, we can algorithmically implement practically any arrival scheme. <br>  The only requirement in this embodiment is the exact synchronization of the cross sections between each other.  This synchronization is carried out using a GPS receiver - they are quite cheap at the moment and easy to use.  Synchronization accuracy without the use of special measures - up to 1 Œºs. <br>  In the photo - an experimental card for the alignment capable of processing up to 6 IR rays simultaneously, plus control of the starting traffic light.  Why 6 rays?  I will explain a little later. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1aa/8b1/109/1aa8b11097b289bad568037762375ce9.jpg" alt="image"><br><img src="https://habrastorage.org/getpro/habr/post_images/06c/dec/38c/06cdec38ce5d6396db0d7c94967c7a4e.jpg" alt="image"><br><br>  TSOP4038 receivers are used as infrared detectors, which allow you to receive a ‚Äúcontinuous‚Äù modulated beam, unlike other series receivers, which simply ‚Äúshut up‚Äù when a continuous beam is applied as a result of the built-in AGC and stop responding to any actions with the beam.  For this receiver, the modulation frequency of the infrared beam at 38 kHz is necessary, but experience has shown that this value is rather arbitrary, and the modulation frequency from 32 to 45 kHz is quite suitable for the task. <br><br>  The radiating device is a TSAL6100 LED, powered by a modulating frequency generator.  And placed roughly in the focus of the collecting lens. <br>  About the emitter dwell in more detail.  As I wrote earlier, the board in the photo is capable of processing up to 6 rays simultaneously.  This is used to set the car on the start line in races with a traffic light.  The so-called Pre-Stage, Stage and Start.  To accurately put the car on the start line, the Stage beam is located 10-15 cm from the start beam.  And at the intersection of this beam, the Stage indicator at the traffic lights lights up, informing the participant about being on the start line and ready to enter. <br><br>  At first glance, nothing complicated about it.  But as practice has shown, it is impossible to arrange two LEDs just at a distance of 10-15 cm and not to light at the same time the ‚Äúadjacent‚Äù sensor.  That is, the task is the independent recognition of two rays that run in parallel at a distance of 10‚Äì15 cm. Ways of solution: ‚Äúmechanical‚Äù - focus the beam so that it illuminates only its own sensor, ‚Äúalgorithmic‚Äù - think of something else. <br><br>  Focusing the beam with a lens gives an excellent result, the spot size does not exceed 3-4 cm at a distance of 8 m, but there is one ‚Äúbut‚Äù - to get such a beam into the receiver is another task, especially when the beam is not visible, and on the street approximately - 25 ¬∞ C.  And besides, this aiming requires the use of mechanisms that implement the rotation of the radiator in two planes, which complicates the design itself. <br><br>  The second varinat is to focus the beam in one plane, for which a cylindrical lens would be needed, but I did not find one, and I had to discard this option. <br><br>  The third option is to divide the rays in a different way.  Namely - in time.  Since we already have a source of accurate time signals (GPS) on the board, including every beam only at ‚Äúits own‚Äù moment of time, we can independently assess the presence or absence of a signal from each radiator.  For this, the GPS receiver module was also installed in the emitter control circuit, which provided the synchronization of signals between themselves. <br><br>  This solution allowed the beam to ‚Äúwiden‚Äù, and the transmitter pointing to the receiver was simplified by an order of magnitude. <br>  A half of the cheapest optical sight was used as the focusing system (the price of the sight is around 150-200 rubles), while the second half is used accordingly for the second radiator. <br><br>  Another nuisance is the sun's illumination of the receiver; when the receiver was removed to a bright sun, random output pulses were observed at its output, which led to false readings.  The solution is a plumbing pipe and food foil :) <br><br>  Here is how it looks.  In the middle - a block with receivers and a wireless module, along the edges - radiators. <br><img src="https://habrastorage.org/getpro/habr/post_images/b13/0cf/e25/b130cfe25fd7a755e561480cac3fd96d.jpg" alt="image"><br><br>  Data transfer <br><br>  As a wireless data network, it was decided to use something similar to Zig-Bee, namely, the Xbee-Pro modules (ZigBee itself is, with only some variations).  Such modules allow you to deploy a network with minimal programming and configuration costs ‚Äî in fact, they make the communication channel transparent from the serial interface of the transmitter to the receiver, and vice versa, respectively.  Plus version Pro has an increased transmitter power, and, accordingly, the range.  On tests, it was possible to achieve stable operation at 500m, using standard antennas of the ‚Äúpin‚Äù type manufactured by D-Link for Wi-Fi routers. <br>  To transfer data to the computer, an Xbee-Usb adapter was assembled on the Xbee-Pro module and the FTDI232 chip. <br><br>  How it works <br><br>  A continuous timer is implemented in the receiving unit. It is synchronized using GPS - the microcontroller hardware timer, which provides a count of fractions of a second, is restarted by the 1PPS receiver signal. <br>  Signals from IR receivers are initiated by external microcontroller interrupts.  When the beam is interrupted, the current time value is captured and this ‚Äútag‚Äù is queued for transmission to the console. <br><br>  Transfer to the remote control is carried out 1 time per second of all counts accumulated at the current moment.  The console confirms the reception of the countdown and the confirmed countdown is removed from the transmission queue. <br>  Each sample has the identifier of the signal that has been triggered and the identifier of the target on which the signal has been triggered. <br><br>  The work of the hardware is done on this.  Her task is to detect the moment of beam crossing and transfer this mark to the console. <br><br>  Further, depending on the type of competition and the configuration of arrival, software enters the business. <br><img src="https://habrastorage.org/getpro/habr/post_images/7d7/14e/d10/7d714ed10f61ae5a880aa25140b1cb24.jpg" alt="image"><br><br>  At the time of receiving the count, a line is displayed with the received timestamp, depending on the source, this mark can be placed in the Start or Finish section, after which time is calculated for tags that have the same number ‚Äî time from start to finish, lap time and t .P. <br><br>  In the event of a false positive (flying animal through the target, or pieces of equipment), the tag that is hit is simply removed from the table and does not affect the measurement results in any way. <br><br>  To ensure the automation of the calculation of the results, each time stamp is assigned the number of the participant who has passed through the target.  This option allows timekeeping, regardless of the number of cars on the track at the same time and their relative position. <br>  The only option when the system does not work is a partial overlap of the hulls when passing through one target. <br>  After assigning a number to the label, the results are recalculated and the final table is updated, which can be displayed on a separate large monitor for the audience. <br>  Like this.  This table is updated immediately after the participant passes the finish line, thus realizing the ‚Äúonline broadcast‚Äù of the results for the audience :) <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c90/830/25e/c9083025e900c99be9c03fb004352988.jpg" alt="image"><br><br>  Also in the software implemented the ability to enter the data of each participant: the starting number, name, model of the car, the class in which the athlete is declared.  On the basis of the data of this table, the final list of the competitions is formed automatically. <br><br>  Various modifications (in the process of evolution) of this system were used during the year at several events, such as ice races with a parallel start, a ground sprint with an interval start, and time races "TimeAttak".  The system proved to be from the good side - compact design (set on one target is placed in the package from the supermarket) and easy operation. <br><br>  At the last 2/07/2013 2nd stage ‚ÄúTimeAttak‚Äù in Omsk, a variant was tested with outputting results to a large monitor (or rather TV :)) in real time.  Spectators and participants of the competition were satisfied). <br><br>  Components from which the system was assembled: <br>  - micro-controllers: ATMega8 (emitters), ATMega128 (receiving unit) <br>  - GPS modules: Quectel L10 <br>  - wireless modules: Xbee Pro 2 <br>  - IR receivers: TSOP4038 <br>  - ABS plastic casing <br>  - coasters of scrap metal <br><br>  Results: <br>  - the accuracy of measuring the time of passing the distance is not worse than 1 ms (in the program it is rounded up to 0.01 s for convenience of perception) <br>  - deployment time - 5-10 minutes <br>  - operating time from a set of batteries - not yet determined, for a day is enough for sure, batteries - used 7A / h from an office UPS. <br>  - budget - approximately 5-6 thousand rubles.  if you buy parts yourself, I used trash deposits in the workplace ÔÅä <br><br>  What else you would like: this configuration requires the participation of the operator to enter the numbers of participants.  It is necessary to automate the identification of the participant who passed through the target. <br></div><p>Source: <a href="https://habr.com/ru/post/189898/">https://habr.com/ru/post/189898/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../189882/index.html">How namedtuple or dynamic type creation works</a></li>
<li><a href="../189886/index.html">Dr. Tariff (3 months later) - you can pick up the tariff in 80 regions of Russia on Android and iOS</a></li>
<li><a href="../189888/index.html">Transition from HP EVA to 3PAR StoreServ 7400. Real implementation experience</a></li>
<li><a href="../189890/index.html">Intel Cloud Services Platform - "cloud" for the developer</a></li>
<li><a href="../189892/index.html">Third check of the Chromium project code using the PVS-Studio analyzer</a></li>
<li><a href="../189900/index.html">Basics of programming objects of the Smart Home in MajorDoMo</a></li>
<li><a href="../189902/index.html">Testing Palo Alto Networks Solutions: How to Block Access to Social Networks and Applications</a></li>
<li><a href="../189904/index.html">Modest Charm - Sony Xperia L Review</a></li>
<li><a href="../189910/index.html">A look at Tizen OS</a></li>
<li><a href="../189912/index.html">Alpha and beta testing android applications</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>