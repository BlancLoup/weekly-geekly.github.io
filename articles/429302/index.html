<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using UTF-8 in HTTP Headers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As you know, HTTP 1.1 is a text-based data transfer protocol. HTTP messages are encoded using ISO-8859-1 (which can be conventionally considered an ex...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using UTF-8 in HTTP Headers</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/hp/z_/bf/hpz_bf9tjnhftjoxvpacahso_ng.jpeg"><br><br>  As you know, HTTP 1.1 is a text-based data transfer protocol.  HTTP messages are encoded using ISO-8859-1 (which can be conventionally considered an extended version of ASCII containing umlauts, diacritics, and other symbols used in Western European languages).  In this case, in the message body, you can use a different encoding, which should be indicated in the "Content-Type" header.  But what if we need to specify non-ASCII characters not in the body of the message, but in the headers themselves?  Probably the most common case is putting a file name in the "Content-Disposition" header.  This would seem to be a fairly common task, but its implementation is not so obvious. <br><br>  TL; DR: Use the encoding described in <a href="https://tools.ietf.org/html/rfc6266">RFC 6266</a> for ‚ÄúContent-Disposition‚Äù and convert the text to Latin (transliteration) otherwise. <br><a name="habracut"></a><br><h3>  A little intro to encodings </h3><br>  The article mentions and uses US-ASCII encodings (often simply referred to as ASCII), ISO-8859-1, and UTF-8.  This is a small introduction to these encodings.  The section is intended for developers who rarely or not work at all with encodings and have managed to forget them.  If you do not belong to them, feel free to skip the section. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>ASCII</b> is a simple encoding that contains 128 characters and includes the entire English alphabet, numbers, punctuation marks, and service characters. <br><br><img src="https://habrastorage.org/webt/as/0s/ao/as0saoyn9xha8zn_tbnc-xfr0mo.png"><br><br>  7 bits is enough to represent any ASCII character.  The word ‚Äútest‚Äù will be represented in the HEX view as 0x74 0x65 0x73 0x74.  The first bit of all characters is always 0, because the characters are encoded in 128, and the byte provides 2 ^ 8 = 256 options. <br><br>  <b>ISO-8859-1</b> is a coding intended for Western European languages.  Contains French diacritics, German umlauts, etc. <br><br><img src="https://habrastorage.org/webt/rj/0d/0n/rj0d0n42-tdyjhhuu5zsr4mith0.png"><br><br>  The encoding contains 256 characters and, thus, can be represented by one byte.  The first half (128 characters) is exactly the same as ASCII.  Thus, if the first bit = 0, then this is a regular ASCII character.  If 1, then it is an ISO-8859-1 specific character. <br><br>  <b>UTF-8</b> is one of the most well-known encodings along with ASCII.  Able to encode 1.112.064 characters.  <a href="https://tools.ietf.org/html/rfc3629">The size of each character varies</a> from 1 to 4 bytes (values ‚Äã‚Äãup to 6 bytes were <a href="https://tools.ietf.org/html/rfc2279">previously</a> allowed). <br><br><img src="https://habrastorage.org/webt/3u/h_/cu/3uh_cut1zl6vfutk2lg0db2imio.png"><br><br>  The program working with this encoding determines by the first bits how many bytes are included in the character.  If the octet starts with 0, then the character is represented by one byte.  110 is two bytes, 1110 is three bytes, 11110 is 4 bytes. <br><br>  As in the case of ISO-8859-1, the first 128 characters fully correspond to ASCII.  Therefore, texts using only ASCII characters will be absolutely identical in the binary representation, regardless of whether US-ASCII, ISO-8859-1 or UTF-8 was used for encoding. <br><br><h3>  Using UTF-8 in the message body </h3><br>  Before moving on to the headers, let's quickly take a look at how to use UTF-8 in the body of messages.  To do this, use the <b>‚ÄúContent-Type‚Äù</b> header. <br><br><img src="https://habrastorage.org/webt/ji/h_/be/jih_beowiy02xqbvmrjlgiit-8g.png"><br><br>  If the ‚ÄúContent-Type‚Äù is not specified, the browser should process the messages as if they were written in ISO-8859-1.  <a href="https://tools.ietf.org/html/rfc2616">The browser should not</a> try to guess the encoding and, moreover, ignore the "Content-Type".  But what is actually displayed in a situation where the "Content-Type" is not transmitted depends on the implementation of the browser.  For example, Firefox will make according to the specification and read the message as if it were encoded in ISO-8859-1.  Google Chrome, in contrast, will use the encoding of the operating system, which for many Russian users is equal to Windows-1251.  In any case, if the message was in UTF-8, then it will be displayed incorrectly. <br><br><img src="https://habrastorage.org/webt/wt/t6/yd/wtt6yd6vgnvu3b8akanox7yj3ic.png"><br><br><h3>  We put a UTF-8 message in the header value </h3><br>  With the body of the message, everything is quite simple.  The message body always follows the headers, so there are no technical problems.  But what about the headlines?  The specification <a href="https://tools.ietf.org/html/rfc2616">states unequivocally</a> that the order of the headers in the message does not matter.  Those.  Set the encoding in one header through another header is not possible. <br><br>  What happens if you just take and write the UTF-8 value to the header value?  We have seen that such a trick with the message body will result in the value being simply read in ISO-8859-1.  It would be logical to assume that the same thing will happen with the title.  But it is not.  In fact, in many, if not most cases, this solution will work.  This includes the old iPhones, IE11, Firefox, Google Chrome.  The only browser I have at hand when I wrote this article that did not want to work with such a headline is Edge. <br><br><img src="https://habrastorage.org/webt/-w/jt/h7/-wjth7oxa2u3zdbb7g_cjk_zcva.png"><br><br>  This behavior is not fixed in the specifications.  It is possible that browser developers decided to make life easier for developers and automatically determine that the message is encoded in UTF-8 in the headers.  In general, this is not such a difficult task.  We look at the first bit: if 0, then ASCII, if 1 - then, perhaps, UTF-8. <br><br>  Is there no intersection with ISO-8859-1 in this case?  In fact, almost none.  Take for example the UTF-8 character of 2 octets (Russian letters are represented by two octets).  The symbol in binary will be: <i>110xxxxx 10xxxxxx</i> .  In the HEX view: <i>[0xC0-0x6F] [0x80-0xBF]</i> .  In ISO-8859-1, these characters can hardly encode something that carries meaning.  Therefore, the risk that the browser incorrectly decrypts the message is very small. <br><br>  However, when trying to use this method, you may encounter technical problems: your web server or framework may simply not allow writing UTF-8 characters to the header value.  For example, Apache Tomcat replaces all UTF-8 characters with 0x3F (question mark).  Of course, this restriction can be circumvented, but if the application itself beats hands and does not allow to do something, then perhaps you don‚Äôt need to do it. <br><br>  But, regardless of whether your framework allows you or the server to write UTF-8 messages to the header or not, I do not recommend this.  This is not a documented solution that can stop working at any time in browsers. <br><br><h3>  Translit </h3><br>  I think that to use translit - eto bolee horoshee reshenie.  Many large popular Russian resources do not disdain to use translit in file names.  This is a guaranteed solution that will not break with the release of new browsers and which should not be tested separately on each platform.  Although, of course, you need to think about how to transform the whole range of possible characters, which may not be entirely trivial.  For example, if an application is designed for a Russian audience, then the Tatar letters ”ô and “£ may fall into the file name, which must be somehow processed, and not simply replaced with "?". <br><br><h3>  RFC 2047 </h3><br>  As I already mentioned, Tomcate did not allow me to put UTF-8 in the message header.  Is this behavior feature reflected in Java docs for servlets?  Yes, reflected: <br><br><img src="https://habrastorage.org/webt/oj/yi/2e/ojyi2e2b9fvcjatf9zrpda_njha.png"><br><br>  Referred to <a href="https://tools.ietf.org/html/rfc2047">RFC 2047</a> .  I tried to encode messages using this format - the browser did not understand me.  This encoding method does not work in HTTP.  Although worked before.  Here, for example, a <a href="https://bugzilla.mozilla.org/show_bug.cgi%3Fid%3D601933">ticket to remove</a> support for this encoding from Firefox. <br><br><h3>  RFC 6266 </h3><br>  In the ticket, the link to which is contained in the previous section, <a href="https://bugzilla.mozilla.org/show_bug.cgi%3Fid%3D601933">there are mentions</a> that even after the termination of support for RFC 2047, there is still a way to transmit UTF-8 values ‚Äã‚Äãin the title of the downloaded files: <a href="https://tools.ietf.org/html/rfc6266">RFC 6266</a> .  In my opinion, this is the most correct decision for today.  Many popular online resources use it.  We in the <a href="https://www.cuba-platform.com/">CUBA Platform</a> also use this particular RFC to generate the ‚ÄúContent-Disposition‚Äù. <br><br>  <a href="https://tools.ietf.org/html/rfc6266">RFC 6266</a> is a specification that describes the use of the ‚ÄúContent-Disposition‚Äù header.  The encoding method itself is described in detail in another specification, <a href="https://tools.ietf.org/html/rfc8187">RFC 8187</a> . <br><br><img src="https://habrastorage.org/webt/ex/rr/j6/exrrj6nvpp-fi5wpdkfm0f4dkzk.png"><br><br>  The ‚Äúfilename‚Äù parameter contains the name of the file in ASCII, ‚Äúfilename *‚Äù in any necessary encoding.  With both attributes, ‚Äúfilename‚Äù is ignored in all modern browsers (including IE11 and older versions of Safari).  Older browsers, by contrast, ignore ‚Äúfilename *‚Äù. <br><br>  When using this encoding method, in the parameter, the encoding is first specified, followed by the encoded value.  Visible characters from ASCII coding do not require.  The remaining characters are simply written in a hex representation, with a "%" in front of each octet. <br><br><h3>  What to do with other headers? </h3><br>  The coding described in RFC 8187 is not universal.  Yes, you can put a parameter with a * prefix in the header, and this may even work for some browsers, but the <a href="https://tools.ietf.org/html/rfc8187">specification instructs</a> not to do so. <br><br>  In each case, where UTF-8 is supported in the headers, there is currently an explicit mention of this in the relevant RFC.  In addition to ‚ÄúContent-Disposition,‚Äù this encoding is used, for example, in <a href="https://tools.ietf.org/html/rfc5988">Web Linking</a> and <a href="https://tools.ietf.org/html/rfc7616">Digest Access Authentication</a> . <br><br>  It should be noted that the standards in this area are constantly changing.  The use of the above encoding in HTTP was <a href="https://tools.ietf.org/html/rfc5987">proposed only in 2010</a> .  The use of this encoding in ‚ÄúContent-Disposition‚Äù was <a href="https://tools.ietf.org/html/rfc6266">recorded in the standard in 2011</a> .  Despite the fact that these standards are only <a href="https://www.rfc-editor.org/info/rfc6266">at the ‚ÄúProposed Standard‚Äù stage</a> , they are supported everywhere.  The option that in the future we are expected by new standards that will allow us to work more uniformly with different encodings in the headers is not excluded.  Therefore, it remains only to follow the news in the world of HTTP standards and their level of support on the side of browsers. </div><p>Source: <a href="https://habr.com/ru/post/429302/">https://habr.com/ru/post/429302/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../429290/index.html">Tesla builds another giant battery in Australia</a></li>
<li><a href="../429292/index.html">Technical support 3CX answers: fast free update to the latest version 3CX</a></li>
<li><a href="../429294/index.html">Xinhua News Agency Replaces Human-Speaker With A Synthesized Voice CGI Model</a></li>
<li><a href="../429296/index.html">Electric bike from shit and sticks</a></li>
<li><a href="../429298/index.html">Updates on VPS.today</a></li>
<li><a href="../429306/index.html">Friday. Nonsense programmer 4.3</a></li>
<li><a href="../429308/index.html">How I left a startup in a big company</a></li>
<li><a href="../429310/index.html">Hiring, hunting, training and development of rubists. HR-corner at the conference RubyRussia-2018</a></li>
<li><a href="../429312/index.html">General game logic on the client and server</a></li>
<li><a href="../429314/index.html">Overview of the popular crypto airdrop platforms</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>