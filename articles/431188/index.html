<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Technical aspects of Internet blocking in Russia. Problems and Prospects</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Let's start right away with a disclaimer: below there will be basically no political issues. Administrative and legal issues will also be circumvented...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Technical aspects of Internet blocking in Russia. Problems and Prospects</h1><div class="post__text post__text-html js-mediator-article">  <em>Let's start right away with a disclaimer: below there will be basically no political issues.</em>  <em>Administrative and legal issues will also be circumvented as much as we can, in order not to completely pull out the technical part from the rest of the planes.</em> <br><br>  Internet blocking in Russia already exists - this is a reality with which we live and must live on.  And if so, you need to understand how it is arranged technically, which the provider can and cannot.  Philip Kulin ( <a href="https://habr.com/ru/users/schors/" class="user_link">schors</a> ) began to collect information on this subject long ago, participated in regulatory work, and went to various meetings.  As a result, now only Roskomnadzor knows more about it in Russia, but this is not certain.  Under the cut a brief summary of the current state of affairs. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/sBMgOt3z8IQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <strong>About Speaker:</strong> Philip Kulin ( <a href="https://habr.com/ru/users/schors/" class="user_link">schors</a> ), General Director of Dense Forest LLC - a small Russian hoster, mainly engaged in shared-hosting. <br><a name="habracut"></a><br><h2>  Tangle of problems <br></h2><br>  It would seem that there are locks and there are.  We don‚Äôt like them, but maybe there‚Äôs nothing wrong with them? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote>  In fact, locking is a solid tangle of problems. <br></blockquote><br>  <strong>Collateral damage is the biggest blocking problem.</strong>  The most vivid example illustrating this occurred in April 2018, when large blocks of IP addresses of cloud services were blocked, respectively, many services did not work and suffered great damage. <br><br>  <strong>The volatility of regulations and practices</strong> that are constantly changing.  A year ago, this story would have been completely different, and two years ago it would most likely contradict today's.  After a year everything will be different again.  Today this is so, in a month - a little bit wrong, and after six months, not at all.  It is necessary to follow this, but it is also necessary to have time to work. <br><br>  <strong>Locks difficult to diagnose</strong> .  If a resource got locked in the registry, this is the simplest case.  In the cases that we consider further, it is quite difficult to distinguish a real block from technical problems.  A vivid example - in October, Yandex dropped the DNS clock for five, during which time many managed to decide that it was a Roskomnadzor block.  It is difficult to determine precisely, indeed, but such situations have already happened, therefore people immediately think about blocking. <br><br>  <strong>It is impossible to predict</strong> when you will be blocked and blocked at all.  You work quietly, and your work is suddenly over. <br><br>  <strong>It is absolutely impossible to calculate risks</strong> , because maybe some widget on the site will fall off, about which you have already forgotten, and maybe the whole business will be hit.  A very good example of risk unpredictability is the case of Bitrix24.  In March, they very quickly transferred their services to Amazon.  In the same month, a document leaked to the network, which truth might have been a fake one, in which large Amazon subnets were registered.  Nevertheless, Bitrix24 somehow reacted to it and avoided problems in April, when Amazon services were really blocked. <br><br>  I assure you that most of you will be so unlucky!  Such documents will not by chance flow into your hands.  When your business ends, you will know this after the fact. <br><br>  In simple cases, we know why your site was blocked.  For example, the forum posted information that a court recognized as prohibited, but you did not have time to react.  But <strong>communication with the supervisory authority has unacceptable terms</strong> - for example, a day.  On the Internet during this time you can lose a fifth of the business. <br><br>  All this leads to some <strong>hopelessness</strong> .  One can argue with irony over, for example, David Khomak and the blocking of Lurk.  But it is quite another thing when it happens to you, as it happened to me once.  The client specified the IP addresses of my servers at the domain that I did not manage - I am sitting, and the phone just doesn‚Äôt fall silent.  Customers say that they are leaving, they demand to return the money, but I can not do anything!  And no one can help me with this.  This is really a feeling of complete hopelessness. <br><br><h2>  Risk groups <br></h2><br>  Locks affect: <br><br><ul><li>  <strong>Owners of sites and services</strong> , which, including, may block by mistake.  Or they may recognize some information as prohibited. </li><li>  <strong>Users of the</strong> lock <strong>service</strong> also concern.  The fact that your site is blocked, concerns you in the first place.  But there are people who used this site or service. </li><li>  <strong>Hosters and providers</strong> that are between two lights.  Because they are required and running services, and the requirements of the supervisory authority, which faces fines.  Let me remind you that fines from 50 to 100 thousand rubles for the protocol.  For example, such protocols for a month can be many and the amounts are very substantial. </li></ul><br><h2>  How locks work <br></h2><br>  First, we will briefly discuss how blocking occurs in order to understand the full picture. <br><br><ul><li>  Federal executive authorities or the court decide to prohibit any information for some reason. </li><li>  Send information to Roskomnadzor, which must make an entry in the registry of prohibited sites. </li><li>  Then there are some internal procedures (there are too many of them - you can read a whole lecture), as a result of which Roskomnadzor may decide to block and enter the site into the so-called ‚Äúupload‚Äù - a technical file that is sent to providers. </li><li>  Providers on this file implement the restriction. </li><li>  Check providers, which has been happening for two years automatically. </li></ul><br><img src="https://habrastorage.org/webt/ec/7u/oy/ec7uoyx013k4hat7f1emkodh0je.png"><br><br>  It is important to understand that traffic is filtered by each provider.  That is, not somewhere on cross-border routers or a state filter, but each provider sets itself a filter between the Internet and subscribers in each of its subnets.  In the diagram above, the verification device is next to subscribers, because it pretends to be a subscriber - this is important. <br><br><h2>  Filtering tools <br></h2><br>  Providers can buy filtered traffic from a superior provider.  But there is a problem - buying traffic from a superior provider, the provider-buyer can not determine the technical problem or blocking.  He has no tool, because he receives already cut traffic, and this does not affect his business very well. <br><br>  Or you can use: <br><br><ul><li>  special complex commercial solutions; </li><li>  free open source solutions (currently there is only one such project); </li><li>  your "collective farm". </li></ul><br>  There are no rocket sets there, and the main problems are not about writing a program. <br><br>  There are the following options for implementation. <br><img src="https://habrastorage.org/webt/0e/fv/2r/0efv2rq-4k220c9rs8sfajg7vh4.png"><br><br>  For example, you have a small channel of 100 Gbps, you put the filter in the gap. <br><img src="https://habrastorage.org/webt/m2/uz/3h/m2uz3hsz3c1tnbtsny8iresopwk.png"><br><br>  Some mirror traffic, but with traffic mirroring the problem is that it works as if it is ahead of the curve.  That is, the filter tries to respond faster than a normal response, respectively, if the filter began to slow down, - fines (remember, 50-100 thousand rubles). <br><img src="https://habrastorage.org/webt/sh/pu/wd/shpuwd9apxic9-mqokh9igug_-i.png"><br><br>  Selective routing - when traffic to IP addresses, among which there may be something from the ‚Äúupload‚Äù, passes through a separate filter. <br><br>  Unfortunately, there are no exact figures, but judging by indirect signs and tests, this is now the most common way to filter traffic. <br><br>  Selective routing can be supplemented by the fact that the <strong>sets of IP addresses for filtering are aggregated in a big way.</strong>  That is, it is not just several addresses that are blocked, but the entire network / 24 falls onto the filter at once.  Plus, large providers, for example, in MTS, have special security services that are specifically looking for IP blocks with risk, which also fall into filtering. <br><br>  Selective routing can also be combined with <strong>DNS query filtering</strong> .  This is a popular method that Dom.ru uses, for example. <br><br>  Let us examine in stages the problems that all this brings. <br><br><h2>  Decision on blocking <br></h2><br>  Roskomnadzor makes a decision - this immediately causes a problem associated, so to speak, with the organization of a support service.  In some cases, he must notify the site owner or host, but the addressee of the notification is not accurate (it is taken from public data, but not all support current addresses), notifications are lost, <strong>there is no public information</strong> . <br><br>  Because of this, all sorts of bad things happen.  The hoster or site owner cannot control what requests are being sent to him, there is no public information.  For example, Google has a database of websites with viruses, where you can register yourself as an autonomous system, somehow confirm that you are an autonomous system, and really see for yourself which sites according to Google in your autonomous system distribute "malware".  There is no such thing with locks - you expect only that the notification will reach you, and you will have time to read it in time. <br><br>  The terms of interaction with Roskomnadzor are not respected, and in general, a bit strange, despite the fact that there are standards - to send a notification in 24 hours, to respond in 24 hours, to make a decision in 24 hours.  When you receive a notification, and you say that you do not have such information and ask for clarification, you can get an answer in a few weeks.  Or maybe you will be blocked, and then they will answer that you still have the information.  I had such situations, but very few people sue - I don‚Äôt know such cases at all. <br><br>  Again, if the notification came, you can not always understand what it is about.  In most cases, Roskomnadzor normally describes what it means.  But even in our practice of a micro-host, there were three cases when the description did not understand what information was involved.  I didn‚Äôt even know what to write to the client - Roskomnadzor issues protocols and decision texts only by court, although they have such documents. <br><br><h2>  Time of application "unloading" <br></h2><br>  So, the decision was made, the provider downloaded the "upload" and then had to do something with it.  There are two options for how fast: a day or immediately. <br><br>  It is important that the day is set aside for locking the resource and unlocking, if suddenly a decision is made to unlock it.  For many, this is done as a nightly upgrade of the switch.  From my experience: I took the notice at the wrong time, blocked the resource, decided the question, but wait a day until they unblock it.  But business does not wait, losses appear. <br><br>  But now in the regulations very often the word <strong>"immediately"</strong> sounds <strong>, by verbal agreement this is the hour</strong> .  But there is a verbal agreement today, but not tomorrow.  Basically, the phrase ‚Äúimmediately‚Äù now concerns prosecutor‚Äôs decisions on extremism. <br><br>  To understand how everything is filtered, you need to know what is inside the ‚Äúunloading‚Äù.  There is a list of records in XML of one of four types by types of blocking and details of the solution: <br><br><ol><li>  URL (s) + domain + IP address (a); <br></li><li>  Domain + IP Address (s); <br></li><li>  Domain with mask (* .example.com) + IP-address (a); <br></li><li>  IP-address (a) - it is clear, there is an address, and we block it completely. <br></li></ol><br>  To make it clear what figures are in question, below are the statistics for January 22, 2019. <br><img src="https://habrastorage.org/webt/1o/xn/59/1oxn59rg0lzgm-iewywnlanduja.jpeg"><br><br>  Important: only 139 thousand records, and the most popular type of blocking is blocking ‚Äúby domain‚Äù.  These are HTTP and HTTPS protocols. <br><br><h2>  Toxicity "unloading" <br></h2><br>  Before blocking a resource, the provider must parse the "unload".  There are problems with this too.  I specifically noted that ‚Äúuploading‚Äù is not a registry, but a kind of technical document that is issued to the provider so that it can make decisions based on it.  But despite this, the provider has to carry out a very large processing of "unloading". <br><br>  For example, in the ‚Äúupload‚Äù there is <strong>redundancy</strong> , the records overlap each other.  If you take a URL, it does not mean that there will be no blocking on the domain that is contained in this URL.  There are now not so many, though, a little more than three thousand. <br><br>  The "upload" contains <strong>URLs with fragments (#) and sessions</strong> .  This is generally terrible, because you need to understand how the test goes. <br><br>  The provider must bring the ‚Äúupload‚Äù to a normal form, because it contains <strong>incorrect URLs and domains.</strong>  Mostly now there are only backslashes.  There are gaps, but they are quickly removed, and for some reason, there is a special ‚Äúlove‚Äù for the backslash.  Well, okay, with backward slashes, the question was decided, and if there is any plus sign?  Therefore, there must always be monitoring, there is always something to do. <br><br>  Once again I pay attention that the <strong>problem of the provider is our problem</strong> .  What does the provider do?  A motivation of 100 thousand rubles is a good motivation to make it so that if there is any problem at all, even with any hint of a problem, to chop right away and then figure it out. <br><br>  The urgency of ‚Äúunloading‚Äù those IP addresses that are not ‚Äúblocking by IP addresses‚Äù, but all others (blocking by domain, by URL, by mask) looks something like this. <br><img src="https://habrastorage.org/webt/lk/nw/0i/lknw0ihtkgp0cl9x0yh2rjtcrga.jpeg"><br><br>  Just a little more than half of the time, and the rest is full stuffing. <br><br><h2>  Check locks <br></h2><br>  I'll start from the end. <br><br><blockquote>  The whole history of the implementation of locks in Russia is the history of checks on these locks. <br></blockquote><br>  I do not know how abroad, we have absolutely exactly the history of inspections.  All locks are not done the way it is written, how to do them, but the way they are checked, because no one likes to pay fines, especially 100 thousand. <br><br>  Prior to the registry of banned sites, there was a list of extremist materials of the Ministry of Justice (it still exists, it‚Äôs just now in the registry, and then it was separate) and prosecutor‚Äôs checks of blockings on this list.  I am a micro-hoster and I managed to get into blocking my resources. <br><br>  Existing types of checks: <br><br><ul><li>  Field inspections (mainly the Ministry of Internal Affairs, the FSB and the prosecutor's office) are rare, but there are some. </li><li>  AS ‚ÄúRevizor‚Äù is a favorite automated system that checks all providers. </li></ul><br><img src="https://habrastorage.org/webt/59/ni/o1/59nio1btog0crenlyyzd-ffb65y.png"><br><br>  "Revizor" stands behind the filter and pretends to be a full subscriber.  But the device itself does nothing, it receives tasks and gives answers to a certain control center, i.e.  This is such a remote shell inside the network provider.  It acts very similarly to <a href="https://atlas.ripe.net/">RIPE Atlas</a> . <br><br>  The control center of an automated system is a true highload service, because we have 4,000 telecom operators, they do not have one network, but a box must be in each network.  That is, not each provider, but <strong>in each network of each provider</strong> .  Accordingly, the control center has certain problems. <br><br>  Question: Does the check itself have any problems?  Of course have. <br><br><h2>  Verification problems <br></h2><br>  At SPEKTR-2017 (a forum under the auspices of Roskomnadzor itself), one of the heads of the FSUE of the main radio frequency center (HRDC), A. Veklich  made a whole <a href="https://spectr-forum.com/uploads/files/YHyfPRcPUXroILcPpIGXpOPAku9kOrNB.pdf">report</a> on what technical problems there are with checking by the ‚ÄúAuditor‚Äù of providers. <br><br>  Verification problems: <br><br><ul><li>  Does ‚ÄúRevizor‚Äù see <strong>this as a provider or resource filter?</strong>  Maybe it was someone of you who found the database of the "Auditor" and all the sites just give a stub, similar to the provider stub. </li><li>  <strong>Block rate</strong> - for all types of blocking (for HTTPS, domain, IP-address), what is the indication that the resource is locked?  For example, by the IP address you need to scan the ports, this is a whole problem. </li><li>  <strong>Blocking rate for other protocols.</strong> </li><li>  <strong>How to check domain mask</strong> ?  Under the asterisk can be different IP-addresses, different domains.  Can I put a filter on the whole strip?  And to check what - selectively or some kind of hash to generate?  I‚Äôll say right away that there is a regulatory blocking, but no one checks it. </li></ul><br><h2>  The method of work of the AU "Auditor" <br></h2><br>  In accordance with these problems, the method of work of the Auditor was created. <br><img src="https://habrastorage.org/webt/wh/ob/p4/whobp4kojjtmfwfyulrpff5z7po.png"><br><br>  And yes, your slide exhaustively illustrates this technique.  I do not really understand how to live logically with this.  For us, this all results in the fact that providers try to solve this problem somehow, and do it in a convenient way for themselves, and not always convenient for us. <br><br>  Working without a technique, many providers have gained existential experience.  In general, the whole method of blocking is an empirical way, which costs money, nerves, falls, even now, when some method has already settled down a bit. <br><br>  There is an unofficial chat (which is remarkable - in the Telegram, where else), where providers communicate with the staff of the Radio Frequency Center.  The most interesting thing is that you can get real help there, HRPC employees help providers solve their problems, and tell how the Auditor works.  But this is all unofficial, there are no documents. <br><br>  There is a Roskomnadzor <a href="https://32.rkn.gov.ru/docs/32/PRIKAZ_Roskomnadzora__dlja_sajta_2018.pdf">standard</a> on methods and methods for restricting access, which is registered with the Ministry of Justice.  It specifically goes at the end, because it has the lowest priority.  Providers do not act as written in the standard, but in the way the method of verification works. <br><br><h2>  Methods of working with "unloading" <br></h2><br>  According to the standard and the accumulated experience, I will tell you how they work with ‚Äúunloading‚Äù, that is, how our resources are blocked. <br><br>  <strong>By URL</strong> : <br><br><ul><li>  If this is the usual HTTP protocol filter by headers. </li><li>  If the encrypted protocol is HTTPS - filter as "domain" </li></ul><br>  Why is there generally a URL with an encrypted protocol is unclear, this is redundancy. <br><br>  <strong>By Domain:</strong> <br><br><ul><li>  The usual HTTP protocol is a filter by the Host header. </li><li>  Encrypted HTTPS protocol - or DNS filter;  or filter by SNI header (when an encrypted connection is established, an unencrypted header with a domain name is transmitted inside);  or filter by IP address. </li><li>  The rest of the protocols are recommended to be blocked as by IP-address, but since the ‚ÄúAuditor‚Äù does not check this, someone does it, someone does not. </li></ul><br>  The standard really says that in the second case, blocking ‚Äúby domain‚Äù cannot be blocked by IP address.  But the provider, when it begins to knock down the filter, immediately includes another level, so as not to get a penalty.  Such a story is not uncommon and naturally leads to additional damage for business. <br><br>  Theoretically, providers filter by <strong>domain with a mask</strong> simply as by domain without an asterisk.  Since, again, there are no checks, there are no problems either. <br><br>  <strong>By IP address and a block of IP addresses</strong> , they are filtered as best they can - right sometimes on the border router. <br><br><h3>  Bona fide members </h3><br>  We know that not only ‚Äúevil‚Äù people are blocked, but also <strong>bona fide participants of the Internet</strong> .  For example, when a person did not intend to keep prohibited information on his hosting, but did not read the letter or did not receive a notification. <br><br>  The second group is foreign participants.  They live in their legal field and do not violate the law.  They can laugh, for example, at bribes, they do not see anything wrong with that.  For example, hosters do not even have the right to delete this information, because the laws do not apply to them.  They are not evil people, but locks hit them. <br><br><h3>  Filtering problems </h3><br>  Let's take a look at the problems, let's talk about DNS filtering, which is recommended by the standard. <br><br>  First question: <strong>where is the DNS</strong> ?  Indeed, forbidden information can be placed, but DNS represents a service that people need, specifically as DNS, for example, IP addresses.  If DNS is fake, everything is not very good, and it is not clear why. <br><br>  The second point is the implementation of <strong>DNS interception</strong> .  In fact, they intercept all traffic (they simply set up their own caching server - the most common practice), and accordingly the question of quality of service arises.  For example, in my office I specifically made the Dom.ru bypass only for DNS, because it is impossible to work when you have to wait for a response from their DNS. <br><br>  All this can be accelerated by creating <strong>your own system of substitution of answers</strong> .  Then the provider must develop the system and maintain it.  They also do this, but this is rare. <br><br>  When distributing DNS request encryption technology (DNSCrypt, DoT, DoH), it is not known whether the type of DNS blocking will remain. <br><br>  With domain filtering by mask, the problem is that domains can be on different IPs, so you have to scan the entire HTTP / HTTPS band.  But what to do with the other protocols?  You are scanning the entire band, but, for example, have banned only the Telegram by mask (by domain) - what to do about it?  <strong>But there is still no verification</strong> ! <br><br>  The next very important point - by the way, this is our future - what to do if on port 443: no SNI, SNI encrypted (ESNI) or other protocols in general, for example, QUIC, DNSCrypt, VPN, MTProto-proxy? <br><br>  Large companies, such as Google, already support encrypted SNI, while Yandex has DNSCrypt on port 443.  Now everyone decides this question in his own way.  Some providers, especially mobile ones, if they cannot recognize traffic as HTTPS, simply cut it off.  I can‚Äôt give exact statistics on this topic, but the approach itself does not inspire optimism. <br><br><h2>  Domain Resolving <br></h2><br>  Putting the filter on the entire band, for example, in 100 Gbps is unrealistic.  Instead, providers take domains, their IP addresses, and already this traffic is scanned.  This is done by large and small providers, mostly large ones, by the way. <br><br>  In the norm it is not, but "you know!".  "Auditor" checks on real addresses and on the fact that in the "unloading", that is, and so and so.  Resolving is used because it is profitable for providers.  It gives them the opportunity to filter all the same not 100 Gbps, but much less outgoing traffic. <br><img src="https://habrastorage.org/webt/cv/i7/p2/cvi7p2b4z1mknqwuh1vgsjrju_c.png"><br><br>  The problem of phases during verification has been known for a long time - everyone is crying, injecting and continuing to do so.  The provider took the IP, updated the filters, but before the ‚ÄúAuditor‚Äù was checked, the IP changed.  The time for which the resource changed IP (the yellow arrow on the diagram) can be measured in milliseconds, but this is enough for the provider to receive a fine. <br><img src="https://habrastorage.org/webt/nd/vi/0n/ndvi0nvlgvtc-yojul6bslqxn_e.png"><br><br>  The second option: after changing the IP resource, the provider and ‚ÄúAuditor‚Äù have the same IP, everything was done on time, only the provider updated the filters a millisecond later than ‚ÄúAuditor‚Äù checked - with the corresponding damage.  It is clear that the provider in such a situation will try to put so many straws that we may not like it. <br><br>  There are still problems with rezolving: <br><br><ul><li>  balancing; </li><li>  geo-targeting; </li><li>  service migration, including intentional. </li></ul><br>  About a half a year ago, about a thousand domains escaped from blocking.  And it is not known, specifically they did it or not.  For example, LiveJournal for some reason discards all blocked journals to some CDN, which changes IP by 23 times a minute.  Why do so, it is not very clear, but there is such a fact. <br><br><h2>  Foul Domains <br></h2><br>  The domain ‚Äúfoul‚Äù when it has expired registration, but it remains in the ‚Äúunloading‚Äù, because, of course, no one is following this.  The new owner of the domain gains control over the type of blocking that is in the ‚Äúupload‚Äù.  In the ‚Äúupload‚Äù there can be subdomains, and when you bought a domain, you get control over all subdomains. <br><br>  I found about 200 ‚Äúfoul‚Äù domains in the ‚Äúupload‚Äù, but in fact there are more of them.  We do not know how many domains have already been bought by people who have decided to joke.  Maybe they are not, maybe there is. <br><br>  What does this lead to? <br><img src="https://habrastorage.org/webt/eg/2g/t_/eg2gt_bfkscybjrod2r93_lbggs.png"><br><br>  The picture crashes sites Yandex, VKontakte, Wikipedia.  On the right is the MSK-IX chart, which MSK-IX itself denies and says it was an internal failure.  But for some reason, the internal failure exactly coincided with the DNS attack. <br><br>  <a href="https://usher2.club/articles/dns-attack-2017/%26amp%3Bsa%3DD%26amp%3Bust%3D1548138369825000%26amp%3Busg%3DAFQjCNF0H56u7vDYuVsVL3tkw50WjaCj3w">The DNS attack</a> was that someone bought a ‚Äúrotten‚Äù domain, threw thousands of IP addresses there and started watering everything he wants, that is, throwing Yandex, VKontakte, etc. on these IP addresses.  Someone played, and so it is still unknown who. <br><br>  All, of course, puffed out their cheeks and said that this could not be.  But despite this, on the graph on the right below, which shows the number of domains in the ‚Äúunloading‚Äù, it is clear that on June 5, 2017 Roskomnadzor carried out a thorough cleaning. <br><br>  One of the targets of the attack was bank card payments.  Banks do not recognize this, because then their shares will fall.  But in fact, some banks did undergo DDoS, as a result of which they did not work with payment cards for the whole evening. <br><br>  Do you think anyone did anything? <br><img src="https://habrastorage.org/webt/ye/63/gq/ye63gqphufbkczl3gtyjuxdgtcm.png"><br><br>  <a href="https://usher2.club/articles/ttk-strike/%26amp%3Bsa%3DD%26amp%3Bust%3D1548138369831000%26amp%3Busg%3DAFQjCNEMy9V6-5Tl_b49ARyddvinEMYPKA">March 14, 2018</a> : another attack vector, but also from the ‚Äúrotten‚Äù domains.  Someone bought 4 domains, got control over 400 subdomains, and uploaded 4,000 IP addresses there.  TransTeleCom, which, according to Roskomnadzor‚Äôs assurances, is all right, somewhere in 600 thousand, the table on the routers overflowed, and 20% of TTK networks throughout the country lay down. <br><br>  Less than a year: <br><img src="https://habrastorage.org/webt/gl/5r/ss/gl5rss-uqew3jaepytl-1z3lg6u.png"><br><br>  This is a re-resolution schedule, that is, IP addresses from domains from the ‚Äúupload‚Äù.  On May 5, I say to Leonid Evdokimov: ‚ÄúBut what if we don‚Äôt have a joke - do we not write anything on the chart with a Morse code?‚Äù An hour later he did it.  By the numbers it is clear that we have calibrated for several thousands of IPs for my rezolving and for my time (I am constantly polling the domains) so that the peaks can be seen and <a href="https://habr.com/ru/post/357982/">began to write</a> : DIGITAL RESISTANCE. <br><br>  On the second chart there was a big inscription: ‚ÄúTruly Popov!‚Äù, Because it was Radio Day.  I cite it, because it shows how Roskomnadzor has finally started cleaning domains.  Where there is a step, there they have already found 2 domains, and 2 have not yet, but they brought the mind to some kind of cleansing.  At the time of generation, the ‚Äúrotten‚Äù subdomains in the ‚Äúunloading‚Äù inscription were about 4,000, and by November it had become stable, that is, Roskomnadzor was conducting regular cleanings.  But, unfortunately, by the time of the article the number of domains has increased again - now there are 1538 of them. <br><br>  By the way, this is the only result of my activity in a few years - we really started to do at least something! <br><br>  By the way, about accidents and failures.  The fact is that the equipment and filtering programs for some reason do not want to go about the system: somewhere they slow down, <strong>failures and mistakes happen</strong> .  Slightly increases the load, and the quality of service becomes none.  You can, for example, use a DNS attack - in the simple case the site will not fall, because everything is normally filtered, but the quality of its work for the user will be very low.  You can say so "half the cost" sites to reduce the quality of their work. <br><br>  For example, last summer at Rostelecom in several regions, the filter for some reason gave out one HTTP protocol chunk incorrectly, and, accordingly, garbage was falling on the screen.  The owner of the site Motobratan.ru was on vacation and said that he did not care.  The site worked the whole weekend until on Monday morning the engineer came and repaired it. <br><br><h2>  ISP problems <br></h2><br>  There should be a good maintenance schedule in case: <br><br><ul><li>  the unloading service does not work; </li><li>  an accident has occurred on the communication channels, ‚Äúunloading‚Äù is impossible to obtain; </li><li>  filters broke; </li><li>  filters on the prevention. </li></ul><br>  But no, it's all fine.  There is still a cheatcode here, but I'm afraid it will soon stop working.  Providers in such cases, based on their existential experience, turn off the ‚ÄúAuditor‚Äù.  If you turned off the Auditor, Roskomnadzor calls you, you say: ‚ÄúOh, it is broken, now we fix it!‚Äù But you have a small amount of time between turning off the Inspector and Roskomnadzor‚Äôs call, and a little more to fix it.  During this time, you can safely carry out some preventive work without fines. <br><br>  Incidentally, when there was an accident at TTR, many simply turned off the filtering and the ‚ÄúAuditor‚Äù, just in case. <br><br><h2>  Fantasy <br></h2><br>  Favorite fantasy about what can be done with this is <strong>whitelists</strong> .  But there is but: <br><br><ul><li>  Whitelisting criteria. </li><li>  Interaction system - the support of Roskomnadzor is not very good, one can imagine what it will become. </li><li>  In the clouds, how to work - write a request for each virtual?  For example, Kubernetes wants to create a node, and you write an application for adding it to the white list - hello Continuous Integration! </li></ul><br>  The next option is the <strong>magic DPI</strong> , which the Chinese will sell to us now, and it will work.  But miracles do not happen, the performance of the DPI is not at all magical.  Secondly, when something complicated is filtered, you need to store states.  But DPI is not rubber and, for example, can fall under special attacks on DPI, which will just put it.  Normal <strong>failures will</strong> naturally also.  Who lived under the DPI in the closed Internet, knows that they are working so-so. <br><br>    ‚Äî   <strong>  DNS  </strong> ,    . <br><br><ul><li>   ,   DNS     ,     ‚Äî  . </li><li>       ,     .  , ,     . </li><li>   ,    DNS,    ¬´¬ª . </li></ul><br>     : <strong>   Telegram?</strong> <br><br>    ,  : .  Telegram ,     , ,   DPI  <strong>  </strong> . ,     ,     ,       Telegram. <br><br> ,             . <br><br>      <a href="https://youtu.be/sBMgOt3z8IQ%3Ft%3D2481">  </a>  , <a href="https://usher2.club/"> </a>  ,  <a href="https://t.me/usher2">Telegram-</a>      @usher2    <a href="https://habr.com/ru/users/schors/" class="user_link">schors</a> <br><br><blockquote>             <a href="https://www.highload.ru/">HighLoad++</a> 2018.       <a href="https://www.youtube.com/user/profyclub"></a>   <a href="http://eepurl.com/VYVaf"></a> ‚Äî  ,    . ,     ,        <a href="https://www.highload.ru/spb/2019">Saint HighLoad++</a> . <br></blockquote></div><p>Source: <a href="https://habr.com/ru/post/431188/">https://habr.com/ru/post/431188/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../431176/index.html">Microservices, APIs, and Innovations: All the Power of the API</a></li>
<li><a href="../431178/index.html">Parasite words in English</a></li>
<li><a href="../431180/index.html">Ext JS on server</a></li>
<li><a href="../431184/index.html">WIFI multi-hop mesh with Mesh Connex technology</a></li>
<li><a href="../431186/index.html">Designing Types: How to make invalid states ineffable on C #</a></li>
<li><a href="../431190/index.html">How to assess the level of an SEO company without entering into an agreement with it</a></li>
<li><a href="../431192/index.html">Firecracker introduces AWS - ‚Äúmicro-virtualization‚Äù for Linux</a></li>
<li><a href="../431194/index.html">Warm tube hardcore. How did DotNext 2018 Moscow</a></li>
<li><a href="../431196/index.html">How Yandex.Taxi predicts the time of filing a car using machine learning</a></li>
<li><a href="../431202/index.html">Debian and Devuan have joined forces for the sake of sysvinit</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>