<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using potential fields in real-time strategy scenarios</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Implementing unit behavior in RTS games can be a major problem. The computer often controls a huge number of units, including those belonging to the p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using potential fields in real-time strategy scenarios</h1><div class="post__text post__text-html js-mediator-article">  Implementing unit behavior in RTS games can be a major problem.  The computer often controls a huge number of units, including those belonging to the player, which must move in a large dynamic world, simultaneously avoiding collisions with each other, looking for enemies, defending their own bases and coordinating attacks to destroy the enemy.  Real-time strategies work in real time, which makes tracking planning and navigation quite difficult. <br><br>  This lesson describes a game flow planning and unit navigation method that uses multi-agent potential fields.  It is based on works under the numbers [1, 2, 3].  (See the end of the article links to the materials used) <br><br><img src="https://habrastorage.org/files/8d4/8ea/d25/8d48ead251424685b06447bb568513db.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br><h2>  What is a potential field? </h2><br>  PP (Potential Field) has a number of similarities with influence maps.  Influence cards are often used to determine whether a zone in the game world is under the control of a player or enemies (in the range of weapons or movement), or is it a zone that is not currently controlled by anyone (nobody's land).  The idea is to put positive values ‚Äã‚Äãon the cells under the control of the player, and negative values ‚Äã‚Äã- under the control of the enemy.  Smoothly reducing the value to zero, we will create a map reflecting the influence of our own and enemy units in the zone.  The figure below shows an example of an influence card with one of its own and one enemy unit. <br><br><img src="https://habrastorage.org/files/cda/ea8/ce3/cdaea8ce3bfd4010bc0c37ac234531a9.png"><br><br>  Potential fields work in a similar way - a charge is put on the position of interest in the game world and generates a field that gradually drops to zero.  The charge can be attractive (positive) or repulsive (negative).  Please note that in some literature on potential fields negative charges attract and vice versa.  In this lesson, positive charges are always repulsive.  The figure below shows a simple game world with some impassable territory (brown), an enemy unit (green) and a destination of the unit (E).  Attracting charge is located at the destination. <br><br><img src="https://habrastorage.org/files/281/ee4/e9f/281ee4e9f0bb4e00b51a8b22bbdd6d27.png"><br><br>  The charge generates a field that spreads across the game world: <br><img src="https://habrastorage.org/files/2e5/16f/680/2e516f6803d5452bb891a7db5e88863e.png"><br><br>  And decays to zero: <br><img src="https://habrastorage.org/files/8ff/899/836/8ff899836b8e48cc854b55cc3e801cf1.png"><br><br><h2>  Navigation with PP </h2><br>  In the illustration above, the attracting field spread around the destination point ‚ÄúE‚Äù.  The idea is to allow the green unit to move to the positions with the most attracted values ‚Äã‚Äãand eventually find the way to the destination point.  To make it work, we also need to deal with the obstacles in the game world, in this case with the mountains (cinnamon zones).  If we make the mountains generate small repulsive fields and combine them with attracting fields (from the picture above), we get a resultant field that can be used for navigation.  Since units always move to the next position with the most attractive value, we will go around the mountains if there is another way. <br><br><img src="https://habrastorage.org/files/393/369/3c9/3933693c94884d36b43e0a6636da783e.png"><br><br>  The same idea is used for other obstacles.  The picture below added two more of their units (white).  They generate small repulsive fields, which are again added to the resulting field. <br><br><img src="https://habrastorage.org/files/b09/adc/a6e/b09adca6eebd4346a94a309864fbe74b.png"><br><br>  Thus, our green unit will bypass these units to avoid collisions.  Now we have the final path for our unit.  A unit can move from its current position to its destination and will bypass all obstacles without using any path finding algorithm. <br><br><img src="https://habrastorage.org/files/8d4/8ea/d25/8d48ead251424685b06447bb568513db.png"><br><br><h2>  Benefits of using PP </h2><br>  One of the most important advantages of using potential fields is the ability to handle dynamic game worlds.  Since units (agents) move only one step at a time, instead of generating a full path from A to B, there is no risk that the path will become unavailable due to changes in the game world.  Finding a path in a dynamic world can often be difficult to implement and require a large amount of resources to calculate.  When an approach based on potential fields is used, the solution of the problem comes by itself, automatically.  Of course, you need to be careful when implementing the software system to not forget to make updating potential fields as effective as possible.  (More on this later). <br><br>  Another important advantage is the ability to create complex behavior just by playing with the shape settings of the generated fields.  Instead of linear attenuation to zero, we can use nonlinear fields.  If we, for example, have shooting units like tanks in our army, we don‚Äôt want tanks to move too close to enemy units, but surround them at the right distance (for example, at a distance of their shooting range).  This behavior can be achieved by placing a zero charge at the location of an enemy unit, generating an increasing field with the most attracted point at the firing range, and then decaying to zero.  The picture below shows an example with two tanks (green) moving into an attack on an enemy unit (red), generating a non-linear PP. <br><br><img src="https://habrastorage.org/files/526/bfe/480/526bfe4807664594b62a39099fdad16b.png"><br><br>  An example of an equation for how such a field can be generated: <br><img src="https://habrastorage.org/files/5f5/c79/9b1/5f5c799b18ca474e83660932512f3ba9.png"><br><br>  Here, W1 is the value for changing the relative field strength.  D is the maximum firing range and R is the maximum detection range (whence our agent sees an enemy agent) <br><br>  Another behavior that is easy to implement is ‚Äúkicked-run‚Äù.  First, the unit approaches the maximum attack distance. <br><br><img src="https://habrastorage.org/files/64f/9bb/719/64f9bb719deb420e90f6251163186e5e.png"><br><br>  After the attack, our unit must reload its weapon and retreats from the enemy unit until it is ready to fire again. <br><br><img src="https://habrastorage.org/files/5f2/f7e/1e8/5f2f7e1e87ea46aba8714878ffbf60e6.png"><br><br>  During the retreat phase, all enemy units generate a strong repulsive field with a radius of maximum firing range of the unit.  This is an example of how specific potential fields can be active or inactive, depending on the internal state of the agent controlling this unit.  An inactive field is simply ignored when the resulting potential field is summed. <br><br>  The picture below is a screenshot of our bot, based on the PP for the <a href="http://www.cs.ualberta.ca/~mburo/orts/">ORTS</a> engine.  The left side of the image is a 2D view of the current state of the game.  It shows our tanks (green circles), going to attack enemy bases (red squares) and units (red circles).  Brown and black areas - impassable territory (mountains).  The potential field of this game state is shown on the right side of the image.  As in the other pictures from this lesson, the blue zones are the most attractive.  The bright lines are the attacks of our tanks.  The PP-view clearly shows how our units surround the enemy at the maximum distance of the shot, while at the same time avoiding collisions with each other and the terrain.  The behavior of the enemy environment works perfectly and was probably one of the key ones in our success of the 2008th year at the ORTS tournament. <br><br><img src="https://habrastorage.org/files/f65/33b/27e/f6533b27ea8f42ceb08d33d306b05086.jpg"><br><br>  While we were developing our bot for ORTS, we found one thing - a completely different behavior, when the summation of the potentials of enemy units generated at each point was compared with just the highest potential of the enemy unit at that point.  In the figure below, the potentials generated by the three enemy units are summed and added to the resulting field.  Thus, the greatest potential is right in the center of the enemy unit cluster (circled in red), and our units are very eager to attack the enemies at their most powerful points. <br><br><img src="https://habrastorage.org/files/213/aa2/09d/213aa209de674618b9b2f68166b8de8b.png"><br><br>  The solution was not to summarize the potentials, but instead to take the greatest potential at a point from all units.  In the latter case, the highest potential around enemies at an acceptable distance (shown by red lines). <br><br><img src="https://habrastorage.org/files/2f4/1b0/e69/2f41b0e6998d4183b4892f8d7eadac3e.png"><br><br><h2>  Implementation notes </h2><br>  With a good plan and implementation of the PP system, the cost of resources for the calculation will not exceed the traditional solutions based on the algorithm A *.  Our ORTS bot used the least amount of CPU resources in comparison with two other bots running on path finding algorithms from the 2007 tournament.  However, we note that it is difficult to accurately calculate the use of the CPU, due to the fact that the winning bot uses more resources at the end of the game, as it has more units under control.  Multithreading also complicates the task of calculating the required CPU resources.  The comparison was made by comparing the total amount of CPU resources used by each client process in the Linux environment for 100 games.  At the very least, we can conclude that the bot was good within the time frame of 0.125 seconds used in ORTS. <br><br>  To improve performance, we divided the PP into three categories: <br><ul><li>  <b>Static fields.</b>  Fields that remain static the whole game.  In our case, the terrain.  This field is generated at startup. </li><li>  <b>Semi-static field.</b>  Fields that do not require frequent updates.  In our case, our and enemy bases.  These fields are generated at startup and are updated when the database is destroyed. </li><li>  <b>Dynamic fields.</b>  All the dynamic objects of the game world, such as our and enemy tanks.  These fields are updated every frame.  To reduce the calculation time, you can count them every second or third frame. </li></ul><br><br>  We experimented with two main architectures for generating PP ... <br><br><h3>  Pre-generation </h3><br>  The field generated by each type of object was calculated in advance and stored in static arrays in the header file.  During the execution of the program, these fields were simply added to the general software in the desired position.  To make this possible, the game world was divided into tiles, in our case each tile consisted of 8x8 points of the game world.  This approach showed insufficient detailing and the bot performed poorly (2007 of the ORTS tournament).  Since the game world was divided into significantly larger tiles, we were faced with the problems of deciding which tile (which tiles) an object is occupying.  Suppose an object (an orange circle) and a base (an orange square).  What tiles (gray squares) does our green unit occupy and what tiles should the base occupy? <br>  This approach may be suitable for games like Wargus, which use a less detailed tile navigation system. <br><br><img src="https://habrastorage.org/files/086/91c/a91/08691ca9176c4bdb87eb21ed52995b6e.png"><br><img src="https://habrastorage.org/files/112/84a/780/11284a78053d4a35a3966cf99e4cee63.png"><br><br><h3>  Real time calculations </h3><br>  Potentials generated at a point are calculated in real time by calculating the distance between the point and all the nearest objects, passing each distance as a variable to a function and then calculating the potential.  This approach actually uses less CPU resources in our bot than pre-generated fields. <br>  Thanks to: <br><ul><li>  We consider the potentials of only those points that are candidates for the movement of units in them.  In the pre-generated version, all potentials of the entire game world are considered (naturally, this can be optimized using a similar method). </li><li>  By calculating the distance to an object using the fast Manhattan method, we can avoid costly calculating the distance in Euclidean space for a large number of objects in the game world. </li></ul><br>  This approach was used in the second version of our bot (ORTS 2008 tournament).  An example of the formula PP (with 2D and 3D graphs), used to calculate the potential generated by a cliff at a point with a distance "a" from the cliff. <br><br><img src="https://habrastorage.org/files/25c/07a/cee/25c07acee5474a108be8e16246b97afd.png"><br><img src="https://habrastorage.org/files/571/3b6/5d0/5713b65d06384e9bb2039c90da548645.png"><br><img src="https://habrastorage.org/files/0a0/1ce/eb5/0a01ceeb5d114f2689b629e43044accb.png"><br><br><h2>  And what about the local optimum problem? </h2><br>  One of the most common problems with PP is the problem of local optimum.  In the picture below is an example when this problem appears.  Destination "E" generates a circular field, which is blocked by the mountain.  The unit moves to the positions with the highest potentials and ends at the largest where it currently stands.  Unit stuck. <br><br><img src="https://habrastorage.org/files/061/228/14b/06122814bcdc4873ba2e12668fd1acbc.png"><br><br>  We solved this by using a trace similar to the pheromone trace described in [4].  Each agent controlling a unit adds a trace in the last N positions visited by the unit, as well as to the current position of the unit.  The trail generates a light repulsive potential and ‚Äúpushes‚Äù the unit forward.  See how a track pushes a unit around a local optimum (yellow line) and the unit can find the way to the destination point. <br><br><img src="https://habrastorage.org/files/8e6/1a6/9cf/8e61a69cfb6f4a33b5a5bbfa0c776d35.png"><br><br>  But even with the traces there is a risk that the unit will get stuck in situations like the one in the picture below. <br><br><img src="https://habrastorage.org/files/f3f/be0/234/f3fbe02343ad473c83dd4fd3ad394079.png"><br><br>  This can be solved by filling in the voids: <br><br><img src="https://habrastorage.org/files/724/ad2/a80/724ad2a802e3469ea66fabf51884beb3.png"><br><br><h2>  Conclusion </h2><br>  Below we have compiled criticism against decisions based on PP from our point of view: <br>  The PP has problems like a local optimum that are difficult to solve.  With the use of the trace, most local optima can be solved.  The PP has problems in very difficult terrain; in these cases, methods of finding a path show themselves better.  The power of PP in the processing of large dynamic worlds with large open spaces and the least difficult terrain.  This is the case for many RTS games of today. <br>  Solutions based on PP require a lot of resources.  We have shown in our work that solutions based on software can be implemented with the same or even better efficiency as the methods of finding the path.  Efficiency can be a problem, but in these cases it is more likely to find a path. <br>  PP-based solutions are difficult to implement and customize.  PP can be implemented with a very simple architecture.  Setup can be difficult and time consuming, but the relative importance between the fields would be useful here (for example, which is more important to destroy the base or units?).  Graphical representation of the PP is also very valuable. <br><br><h2>  Links </h2><br>  <b>Using Multi-agent Potential Fields in Real-time Strategy Games</b> <br>  Johan Hagelb√§ck and Stefan J. Johansson <br>  <i>International Conference on Autonomous Agents and Multi-agent Systems (AAMAS), 2008.</i> <br>  1. <a href="http://www.aamas-conference.org/Proceedings/aamas08/proceedings/pdf/paper/AAMAS08_0269.pdf">Download PDF</a> <br><br>  <b>Real Time Strategy Bots</b> <br>  Johan Hagelb√§ck and Stefan J. Johansson. <br>  <i>Proceedings of Artificial Intelligence and Interactive Digital Entertainment (AIIDE), 2008.</i> <br>  2. <a href="http://www.aaai.org/Papers/AIIDE/2008/AIIDE08-007.pdf">Download PDF</a> <br><br>  <b>A Multiagent Potential Field-Based Bot for Real-Time Strategy Games</b> <br>  Johan Hagelb√§ck and Stefan J. Johansson <br>  <i>International Journal of Computer Games Technology, 2009.</i> <br>  3. <a href="http://www.hindawi.com/GetPDF.aspx%3Fdoi%3D10.1155/2009/910819">Download PDF</a> <br><br>  <b>Learning Human-like Movement Behavior for Computer Games</b> <br>  C. Thurau, C. Bauckhage, and G. Sagerer <br>  <i>International Conference on the Simulation of Adaptive Behavior (SAB), 2004.</i> <br>  4. <a href="http://aiweb.techfak.uni-bielefeld.de/files/papers/Thurau2004-LHL.pdf">Download PDF</a> <a href="http://aiweb.techfak.uni-bielefeld.de/files/papers/Thurau2004-LHL.pdf"><br></a> </div><p>Source: <a href="https://habr.com/ru/post/262181/">https://habr.com/ru/post/262181/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../262169/index.html">Consulo: Running Java code on the .NET platform using IKVM.NET</a></li>
<li><a href="../262173/index.html">Build-Deploy-Test. Continuous integration</a></li>
<li><a href="../262175/index.html">Real-time data processing in AWS Cloud. Part 1</a></li>
<li><a href="../262177/index.html">Web file manager with integrated chickenpox</a></li>
<li><a href="../262179/index.html">How to beat Excluded Constraints with RubyGem</a></li>
<li><a href="../262183/index.html">React on ES6 +</a></li>
<li><a href="../262185/index.html">The history of routing in the project MAPS.ME</a></li>
<li><a href="../262187/index.html">Creating a new field type for MS SharePoint using the example of a simple check field</a></li>
<li><a href="../262189/index.html">Malevich</a></li>
<li><a href="../262191/index.html">Teach Hyper-V Server with Veeam B & R to backup yourself</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>