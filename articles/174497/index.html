<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Samba 3 file server in Active Directory domain</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As promised in the last article , today I will write how to set up a Samba 3 based file server for users in an Active Directory domain. 
 What is the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Samba 3 file server in Active Directory domain</h1><div class="post__text post__text-html js-mediator-article"><img align="right" src="https://habrastorage.org/storage2/3ea/868/ccc/3ea868ccc3b19e9e0be147abba60ddad.png"><br>  As promised in the <a href="http://habrahabr.ru/post/174407/">last article</a> , today I will write how to set up a Samba 3 based file server for users in an Active Directory domain. <br>  What is the difference between this instruction and, for example, <a href="http://habrahabr.ru/post/172115/">this one</a> ?  Today we will not use winbind.  Our kerberos client will work with the kdc of its AD site and we will not need to worry about its reconfiguration when changing the site. <br><br>  It is assumed that before performing the described actions, the Linux server was <a href="http://habrahabr.ru/post/174407/">entered into the domain as previously described</a> . <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Training </h5><br><br>  Let me remind you that you can get the Open version of PowerBroker Identity Services on <a href="http://www.beyondtrust.com/Resources/OpenSourceDocumentation/">the manufacturer‚Äôs website</a> , but you will be provided with a link in exchange for your name, company name and e-mail address. <br>  There are 32 and 64 packages in rpm and deb formats.  (As well as packages for OS X, AIX, FreeBSD, SOlaris, HP-UX). <br>  The program is delivered as a self-extracting archive with a package corresponding to the selected system. <br>  On Debian-based systems, the package installs its files in / opt / pbis /. <br>  To enter a computer into a domain, you can use one of two utilities: / opt / pbis / bin / domainjoin-cli or / opt / pbis / bin / domainjoin-gui <br>  Naturally, before entering the domain, it makes sense to configure the ntp client to synchronize time with the domain controller (or with the time server with which your PDC emulator is synchronized). <br><br>  There is a utility for integrating with samba with PBIS <div class="spoiler">  <b class="spoiler_title">samba-interop-install</b> <div class="spoiler_text"><pre> # / opt / pbis / bin / samba-interop-install --help
 Usage: / opt / pbis / bin / samba-interop-install {options} [smbd path]

 Samba and copies the installs
 machine password from the PowerBroker Identity Services' database to Samba's.

 Options are:
     --help Show this help message
     --install Configure smbd to use interop libraries
     --uninstall Deconfigure smbd's use of interop libraries
     --check-version Ensure the version of smbd is supported
     --loglevel {level} Set the logging to error (default), warning, info,
                          verbose or debug

 One of the options, --install, --ininstall, or --check-version must be passed.

 The last argument is the path to smbd.  If not specified, it will be
 automatically detected.
</pre><br></div></div><br>  It will allow us to perform some preparatory operations.  PBIS does not support integration with all versions of smaba.  Versions are supported: 3.0.25 and newer from the 3.0.X, 3.2.X, 3.4.X, 3.5.X, 3.6.X.  But without winbind, only versions of samba 3.2.X, 3.5.X, 3.6.X will work (according to the documentation, I checked for samba 3.6.X). <br>  To check if PBIS supports the installed version of Samba, it is worth running: <br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># /opt/pbis/bin/samba-interop-install --check-version Found smbd version 3.6.6 Samba version supported</span></span></code> </pre> <br>  As you can see, the installed version of samba is supported.  You can set up communication with samba: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># /opt/pbis/bin/samba-interop-install --install --loglevel debug [CheckSambaVersion() /builder/src-buildserver/Platform-7.1/src/linux/samba-interop/tools/samba-interop-install.c:500] Found smbd version 3.6.6 [InstallWbclient() /builder/src-buildserver/Platform-7.1/src/linux/samba-interop/tools/samba-interop-install.c:587] Link /usr/lib/x86_64-linux-gnu/libwbclient.so.0 already points to /opt/pbis/lib/libwbclient.so.0 [AddSambaLoadPath() /builder/src-buildserver/Platform-7.1/src/linux/samba-interop/tools/samba-interop-install.c:1100] Samba is already in the load order [SetPassword() /builder/src-buildserver/Platform-7.1/src/linux/samba-interop/pstore-plugin/samba-pstore-plugin.c:459] Wrote machine password for domain CORP in secrets.tdb Install successful</span></span></code> </pre><br>  Here, I specifically launched the command in debug mode to see what samba-interop-install does: it replaces the libwbclient.so.0 library for samba with its own, makes sure that samba starts at system startup, saves the password of the computer account in the samba storage. <br><br><h5>  Samba configuration </h5><br>  Now you need to configure samba.  In smb.conf there should be lines: <br><pre>  [global]
   security = ADS
   workgroup = CONTOSO
   realm = CONTOSO.COM
   machine password timeout = 0 </pre><br>  And the ‚Äúmachine password timeout = 0‚Äù line is important; it will not allow samba to change the password of the computer account. <br>  Further we create the general resource: <br><pre>  [shared-folder]
         comment = Test shared folder
         path = / home / shared-folder
         valid users = CONTOSO \ User1, CONTOSO \ User2, @CONTOSO \ Administrators ^ domain
         read only = No </pre><br><br><h5>  The final </h5><br><br>  Do not forget to check the settings: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># testparm</span></span></code> </pre><br>  If everything is ok, restart samba. <br>  We try to open the newly configured shared folder from another PC. <br>  And enjoy the result. </div><p>Source: <a href="https://habr.com/ru/post/174497/">https://habr.com/ru/post/174497/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../174485/index.html">Popcap gives away a free arcade game to Peggle</a></li>
<li><a href="../174489/index.html">Information security policy - development experience and recommendations</a></li>
<li><a href="../174491/index.html">There are several reasons for a messy and quick blog post.</a></li>
<li><a href="../174493/index.html">Don Jones "Creating a unified IT monitoring system in your environment" Chapter 4.Monitoring: a look beyond the limits of the data center</a></li>
<li><a href="../174495/index.html">Dot rollback changes. Versioning 1C good or evil. The author's idea of ‚Äã‚Äãa system for collecting versions on 1C systems</a></li>
<li><a href="../174499/index.html">High Level APIs for Linux Containers</a></li>
<li><a href="../174501/index.html">GNOME 3.8 released</a></li>
<li><a href="../174503/index.html">Digitimes: Windows RT will no longer</a></li>
<li><a href="../174505/index.html">The Chinese, LEDs and giant screens - a short photo report with LED China</a></li>
<li><a href="../174509/index.html">Resource Odnoklassniki blocked</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>