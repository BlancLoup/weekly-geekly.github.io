<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A vulnerability has been discovered in the anti-counterfeiting system.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Egyptian engineer Yasser Ali, while researching the work of PayPal, discovered a vulnerability that allowed him to completely circumvent the CSRF atta...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A vulnerability has been discovered in the anti-counterfeiting system.</h1><div class="post__text post__text-html js-mediator-article"><img width="825" src="https://habrastorage.org/files/b60/3c2/379/b603c237944d4b76bd5953c571790395.jpg" alt="Paypal authorization"><br><br>  Egyptian engineer Yasser Ali, while researching the work of PayPal, discovered a vulnerability that allowed him to completely circumvent the CSRF attack protection system used by the service ( <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B5%25D0%25B6%25D1%2581%25D0%25B0%25D0%25B9%25D1%2582%25D0%25BE%25D0%25B2%25D0%25B0%25D1%258F_%25D0%25BF%25D0%25BE%25D0%25B4%25D0%25B4%25D0%25B5%25D0%25BB%25D0%25BA%25D0%25B0_%25D0%25B7%25D0%25B0%25D0%25BF%25D1%2580%25D0%25BE%25D1%2581%25D0%25B0">cross-site request forgery</a> ).  He described this vulnerability in detail in <a href="http://yasserali.com/hacking-paypal-accounts-with-one-click/">his blog</a> ; we translated and adapted the post describing the vulnerability. <br><br>  For a successful attack of this kind, the attacker needs to force the victim to fraudulently get a specially prepared link with which he can create requests on behalf of the victim.  The attack is possible only if the user is authorized on the website that is being exposed to it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The post was prepared specifically for the corporate blog site on payment systems c monitoring <a href="http://web-payment.ru/">Web-payment.ru</a> exchangers. <br><a name="habracut"></a><br><h4>  Reusable CSRF Tokens </h4><br>  The first thing that Ali discovered was the possibility of multiple use of a CSRF token, which allows you to verify the authenticity of each request made by the user.  The token can be found in the body of any request, and its <i>Auth</i> parameter is changed for each individual request in order to ensure security.  However, after a detailed study, it was found that <i>Auth</i> continues to act for a specific name or email address of the user, even when reused.  In case an attacker succeeds in finding any of the previously generated CSRF tokens, he can easily perform actions on behalf of any user authorized at the moment. <br><br>  However, this possibility does not seem to pose a real danger, since it is impossible to get the <i>Auth</i> value from the victim‚Äôs session. <br><br><h4>  Bypassing the CSRF authorization system </h4><br>  It is known that the <i>Auth</i> parameter checks every user request.  Ali decided to check what would happen if an ‚Äúunauthorized‚Äù attacker attempted to send a request for sending money.  In this case, PayPal will ask the attacker to provide your email address or password.  In response, the attacker can provide the victim's email, <i>enter any</i> password, and thus intercept the request, which will contain a genuine reusable CSRF authorization token, which allows to authorize requests of this user. <br><br>  Further analysis showed that by intercepting a POST request from pages that can provide tokens before the user is authorized, the attacker can get CSRF Auth, applicable to all users.  Such a magical CSRF Auth can, for example, be found at <i><a href="https://www.paypal.com/eg/cgi-bin/webscr%3Fcmd%3D_send-money">www.paypal.com/eg/cgi-bin/webscr?cmd=_send-money</a></i> .  Having done all these actions, an attacker can fake almost any request on behalf of a real user. <br><br> <a href=""><img src="https://habrastorage.org/files/209/bf4/175/209bf4175adb4d4895912850c6c1365d.png" alt=",  " title="Click to enlarge"></a> <br>  <sub><i>The application generates a genuine Auth-token for a logged out user!</i></sub> <br><br>  After checking the process of changing the password on the service, Ali came to the conclusion that the hacker would not be able to change the user's password without knowing his secret questions.  In addition, the user, in turn, cannot change his secret questions without knowing his password. <br><br><h4>  Changing security questions to bypass the security system </h4><br>  Further research has shown that the process of "creating" secret questions, which starts as soon as the user starts registration, is not password protected and can be used to reset secret questions multiple times without entering a password.  Thus, with CFSR Auth at its disposal, an attacker can fake this procedure and change the victim's secret questions. <br><br> <a href=""><img src="https://habrastorage.org/files/a2f/8b8/6dd/a2f8b86dd28d403a9eabdb80ff2062e3.png" alt=",  " title="Click to enlarge"></a> <br>  <sup><i>The first attempt to "create" secret questions is not password protected and can be used many times later</i></sup> <br><br>  Having performed all the actions described above, an attacker can make an attack aimed at specific PayPal users by faking inquiries using the CSRF principle and gaining full control over their accounts with its help.  Among other things, the attacker will be able to fake the following requests: <br><ol><li>  Add / Delete / Confirm Email Addresses </li><li>  Change secret questions </li><li>  Change shipping address or billing address </li><li>  Change payment methods </li><li>  Change user settings (notifications, mobile number settings) </li><li>  Add privileged users to a business account </li><li>  ... much more ... </li></ol><br>  Ali also wrote an interactive server in Python to automate the process and demonstrate how a cracker could take advantage of this vulnerability in practice. <br><br>  Video from the author, showing the process of hacking: <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/KoFFayw58ZQ&amp;xid=25657,15700002,15700019,15700186,15700191,15700253&amp;usg=ALkJrhi6zknAp3RhzhN9OkwWHcR41y8BEQ" frameborder="0" allowfullscreen=""></iframe><br><br>  However, the bugs themselves were discovered in early August, the engineer reported in time about the vulnerabilities that were closed, and information about them was made public after that, so at the moment they no longer pose any threat to PayPal. <br><br>  For his find, Ali, by his own admission, received the maximum reward that PayPal offers to all who report any critical problems in protecting the system, $ 10,000. <br><br> <a href="http://web-payment.ru/"><img src="https://habrastorage.org/files/b96/f2c/dbf/b96f2cdbf9ab40d2991b03650b7010b5.png"></a> </div><p>Source: <a href="https://habr.com/ru/post/245445/">https://habr.com/ru/post/245445/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../245431/index.html">AntiSMS anti-virus utility now removes Adware</a></li>
<li><a href="../245435/index.html">Anonymization of all traffic through VPN + TOR / I2P. We collect middlebox from scratch</a></li>
<li><a href="../245439/index.html">How to come up with ideas</a></li>
<li><a href="../245441/index.html">MindStream. How do we write software under FireMonkey. Part 4 Serialization</a></li>
<li><a href="../245443/index.html">Petooh programming language</a></li>
<li><a href="../245447/index.html">The simpler the better, or when ELB is not needed</a></li>
<li><a href="../245449/index.html">.NET / Mono in Java? Easy!</a></li>
<li><a href="../245451/index.html">20 million pesos and half a year in Chile: how SmartProgress won a grant at the other end of the world</a></li>
<li><a href="../245453/index.html">Roslyn to automatically translate C # code into 1C code</a></li>
<li><a href="../245455/index.html">Problem, solution and stability check in statics</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>