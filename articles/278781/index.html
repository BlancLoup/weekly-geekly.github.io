<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Adaptive Split View Controller and Popover in iOS 9 (Swift). Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is the second part of the tutorial article related to the study of the adaptive behavior of the Split View Controller and Popover in iOS 9 on the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Adaptive Split View Controller and Popover in iOS 9 (Swift). Part 2</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/4d2/88d/3d3/4d288d3d35e74879b0621885d82042a5.png" width="900" height="540"><br><br>  This is the second part of the <a href="https://habrahabr.ru/post/278573/">tutorial article</a> related to the study of the adaptive behavior of the <b>Split View Controller</b> and <b>Popover</b> in iOS 9 on the iPad and on the iPhone, made possible by the concept of <b>Size Classes</b> .  The training consists in creating practical applications on Swift that work with the <a href="https://www.flickr.com/">Flickr.com</a> server, which is a cloud-based photo storage service. <br><br>  The <a href="https://habrahabr.ru/post/278573/">first part</a> lists five interesting from the point of view of the developer cases of application of adaptive <b>Split View Controller</b> and <b>Popover</b> , which are distinguished by the complexity of the <b>Master</b> .  <b>Detail</b> is the same everywhere - the only <b>Image View Controller</b> , inserted into the <b>Navigation Controller</b> and designed to show the image of the photo: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      1. The classic version: one item in the <b>Master</b> , inserted into the <b>Navigation Controller</b> , (often a <b>Table View Controller</b> ) <br><br>  2. Many <b>Table View Controller</b> elements inserted into the <b>Navigation Controller</b> <br><br>  3. <b>Tab Bar Controller</b> as <b>Master</b> <br><br>  4. The case of different UI and different user classes for devices with different <b>Size Classes</b> is not discussed here, but the idea can be found in <a href="http://bestkora.com/IosDeveloper/dopolnenie_/">‚ÄúAdaptive interface with two storyboards for iOS 9‚Äù</a> . <br><br>  5. Adaptive <b>Popover</b> <br><br>  In the <a href="https://habrahabr.ru/post/278573/">first part</a> , the basic experimental application was built on Swift, which was extended to cases 1-2.  In this article we will further complicate our experimental application and extend it to cases 3 and 5. The code for all the options can be found on <a href="https://github.com/BestKora/AdaptiveSplitViewSwift">Github</a> . <br><a name="habracut"></a><br><br><h2>  3. Tab Bar Controller as Master </h2><br>  We will improve our application and allow the user to remember the ‚Äúrecently‚Äù viewed photos in the <code><font color="#0000FF">NSUserDefaults</font></code> repository (that is, they must be permanently stored between launches of this application) and view them on a separate tab <b>Tab Bar Controller</b> .  To do this, based on the previous <u><i>AdaptiveSplitViewController2Swift</i></u> application, create a new <i><u>AdaptiveSplitViewController3Swift</u></i> application and add a <b>Tab Bar Controller</b> on the storyboard, delete the accompanying <b>View Controllers</b> accompanying it, and instead connect our <b>Photographers</b> to it, inserted into the <b>Navigation Controller</b> and another <b>Resents</b> screen fragment intended for viewing the recent <b>reports</b> photos and also inserted in the <b>navigation controller</b> : <br><img src="https://habrastorage.org/files/e1a/d01/2ee/e1ad012ee1c5458797fff4f9cee95f14.png" width="900" height="652"><br><br>  We try to start the application and find out that everything is working fine on the iPad, and on all iPhones in <b>Compact-width</b> mode, images of images using <code><font color="#0000FF">ImageViewController</font></code> are <code><font color="#0000FF">ImageViewController</font></code> on the screen modally with a title, but without a navigation bar and without additional buttons on it.  But the saddest thing is that we cannot move anywhere from this screen: <br><br><img src="https://habrastorage.org/files/f12/1a1/6d9/f121a16d9e7b48e5b58614ce7225a630.png" width="700" height="346"><br><br>  This suggests that <b>SplitViewController</b> cannot place our <code><font color="#0000FF">ImageViewController</font></code> on the <b>Navigation Controller</b> stack for the <b>Master</b> , since <b>SplitViewController</b> controls the <b>Master</b> via the <b>Tab Bar Controller</b> , which offers a modal <b>Detail</b> view.  To fix this situation, we can put <code><font color="#0000FF">ImageViewController</font></code> ourselves on the <b>Navigation Controller</b> stack for the <b>Master</b> and will do this in the <code><font color="#0000FF">showDetailViewController</font></code> method of the <code><font color="#0000FF">showDetailViewController</font></code> delegate for <b>Compact-width</b> mode. <br>  First we define the <b>Compact-width</b> mode and get the <b>Navigation Controller</b> for the <b>Master</b> .  Then we extract the <code><font color="#0000FF">ImageViewController</font></code> , put it on the <b>Navigation Controller</b> stack for the <b>Master</b> and show it on the screen: <br><br>  <u><i>AppDelegate.swift</i></u> <br><img src="https://habrastorage.org/files/24a/7c6/6b8/24a7c66b80b845a0bfdba41fe3c81c57.png" width="700" height="298"><br><br>  A return of <code><font color="#0000FF">true</font></code> means that the <code><font color="#0000FF">SplitViewController</font></code> should not control the <b>Detail</b> display, we will show it ourselves.  Now the image of the photo for <b>Compact-width</b> devices will be shown correctly: with the return button and slide as in the <b>Navigation Controller</b> , and not appear modally with the inability to leave it: <br><br><img src="https://habrastorage.org/files/1e8/c4e/21b/1e8c4e21b8b541b39a3c8284de44bff6.png" width="700" height="344"><br><br>  But as soon as we added the <code><font color="#0000FF">ImageViewController</font></code> to the <b>Navigation Controller</b> stack for the <b>Master</b> , we can get our <code><font color="#0000FF">ImageViewController</font></code> in the <b>Master</b> when switching to landscape mode, which, of course, is unacceptable, since the <code><font color="#0000FF">ImageViewController</font></code> should appear only in the <b>Detail view</b> : <br><br><img src="https://habrastorage.org/files/167/3c5/6b7/1673c56b797144ee984a4c639d51b2fb.png" width="700" height="432"><br><br>  Therefore, when switching to landscape mode, we need to remove <code><font color="#0000FF">ImageViewController</font></code> from the <b>Navigation Controller</b> stack for <b>Master</b> : <br><br>  <u><i>AppDelegate.swift</i></u> <br><img src="https://habrastorage.org/files/d8a/b64/059/d8ab640597ac4eafbceede35f656ab76.png" width="700" height="264"><br><br>  Using the <code><font color="#0000FF">imageURL</font></code> knowledge of the newly cleaned <code><font color="#0000FF">ImageViewController</font></code> , we can set up the corresponding line in the list of photos: <br><br>  <u><i>AppDelegate.swift</i></u> <br><img src="https://habrastorage.org/files/3b5/27e/f26/3b527ef265974e06a9d24053db6b58c2.png" width="700" height="217"><br><br>  Restore <b>Detail</b> with storyboard and set up its Model on the resulting photo: <br><br>  <u><i>AppDelegate.swift</i></u> <br><img src="https://habrastorage.org/files/f83/649/3f9/f836493f9e5744349060a66b2bc813d6.png" width="700" height="301"><br><br>  As a result, the situation on iPhones will get better, including the transition from portrait mode to landscape on iPhone 6+: <br><img src="https://habrastorage.org/files/bf9/25e/9ea/bf925e9eafc0410da505aa609d2a989d.png" width="700" height="444"><br><br>  Now let's talk a little about the ‚ÄúResents‚Äù tab, the so-called ‚Äúrecent‚Äù photos.  This <b>View Controlle</b> r is served by the custom class <code><font color="#0000FF">ResentsTVC</font></code> <br><br><img src="https://habrastorage.org/files/10a/a8f/f3f/10aa8ff3f56f4f3fa757b459f7e77052.png" width="700" height="444"><br><br>  The <code><font color="#0000FF">ResentsTVC</font></code> class inherits from the <code><font color="#0000FF">FlickrPhotosTVC</font></code> class and its only functional feature is the reading of a list of photos from <code><font color="#0000FF">NSUserDefaults</font></code> : <br>  <u><i>ResentsTVC.swift</i></u> <br><img src="https://habrastorage.org/files/ad7/d46/fd1/ad7d46fd12f74eb99dca58e7ed60f342.png" width="700" height="217"><br><br>  It took us only two lines of code and it will be shown below why it is so simple. <br>  Interaction with <code><font color="#0000FF">NSUserDefaults</font></code> organized using the special class <code><font color="#0000FF">ResentsDefault</font></code> and the <code><font color="#0000FF">var resentsPhotos</font></code> property of <code><font color="#0000FF">var resentsPhotos</font></code> : <br><br>  <u><i>ResentsDefault.swift</i></u> <br><img src="https://habrastorage.org/files/4db/892/c90/4db892c90edf47e3b476e2250b2764f0.png" width="700" height="116"><br><br>  which is an array of dictionaries with keys of type <code><font color="#0000FF">String</font></code> and values ‚Äã‚Äãof type <code><font color="#0000FF">String</font></code> .  Moreover, <code><font color="#0000FF">{get}</font></code> this property reads data from <code><font color="#0000FF">NSUserDefaults</font></code> , and <code><font color="#0000FF">{set}</font></code> <code><font color="#0000FF">NSUserDefaults</font></code> it to <code><font color="#0000FF">NSUserDefaults</font></code> .  Note that <code><font color="#0000FF">NSUserDefaults</font></code> is essentially a very small database for permanently storing a <b>Property List of</b> data between the runs of your application.  Our internal data structure for storing information about photos received from the <a href="https://www.flickr.com/">Flickr.com</a> server, we chose the <code><font color="#0000FF">[Photo]</font></code> array, where <code><font color="#0000FF">Photo</font></code> is a <code><font color="#0000FF">struct</font></code> and the <code><font color="#0000FF">struct</font></code> is neither <code><font color="#0000FF">NSDates</font></code> , nor <code><font color="#0000FF">NSStrings</font></code> , nor <code><font color="#0000FF">NSArrays</font></code> , or <code><font color="#0000FF">NSDictionarys</font></code> .  We will not be able to use <code><font color="#0000FF">[Photo]</font></code> for storage in <code><font color="#0000FF">NSUserDefaults</font></code> , as this is not the <b>Property List</b> . <br>  I will use the array of <code><font color="#0000FF">[[String : String]]</font></code> dictionaries for storing data on Flickr photos in <code><font color="#0000FF">NSUserDefaults</font></code> , which is a <b>Property List</b> data, but of course I will need <code><font color="#0000FF">Photo</font></code> conversion to <code><font color="#0000FF">[[String : String]]</font></code> and back: <br><br>  <u><i>DataModel.swift</i></u> <br><img src="https://habrastorage.org/files/566/b3a/992/566b3a9922f743c19f4d41d719385f0d.png" width="720" height="472"><br><br>  The <code><font color="#0000FF">ResentsDefault</font></code> class, serving interaction with <code><font color="#0000FF">NSUserDefaults</font></code> , has two properties as a <b>public API</b> : <br> <code><font color="#0000FF">var addedPhoto = Photo?</font></code>  - the photo we want to add to <code><font color="#0000FF">NSUserDefaults</font></code> , <br>  <code><font color="#0000FF">var resentsPhotos: [[String : String]]</font></code> - an array of dictionaries with information about photos stored in <code><font color="#0000FF">NSUserDefaults</font></code> : <br><br>  <u><i>ResentsDefault.swift</i></u> <br><img src="https://habrastorage.org/files/f8d/f5a/0c9/f8df5a0c9c244c4e8d5f48aca5071b52.png" width="700" height="256"><br><br>  Our work with the <code><font color="#0000FF">NSUserDefaults</font></code> repository begins with the fact that we add <code><font color="#0000FF">addedPhoto</font></code> to an existing repository and this is done with one line of code and the <code><font color="#0000FF">addPhoto</font></code> helper function, which has <code><font color="#0000FF">photo</font></code> at the entrance and an array of photos <code><font color="#0000FF">resentsPhotos</font></code> photos stored in <code><font color="#0000FF">NSUserDefaults</font></code> : <br> <code><font color="#0000FF">addPhoto (photo, inDefaultsPhotos: resentsPhotos)</font></code> <br>  When we use <code><font color="#0000FF">resentsPhotos</font></code> as an input parameter of an auxiliary function, <code><font color="#0000FF">{get}</font></code> triggered for this calculated property and the data is read from the <code><font color="#0000FF">NSUserDefaults</font></code> repository to <code><font color="#0000FF">resentsPhotos</font></code> .  Then we add a new photo <code><font color="#0000FF">photo</font></code> to the very beginning of the <code><font color="#0000FF">resentsPhotos</font></code> array as the most ‚Äúrecent‚Äù: <br><br>  <u><i>ResentsDefault.swift</i></u> <br><img src="https://habrastorage.org/files/604/614/cbc/604614cbc51d46739572c7722c9e4bf8.png" width="700" height="211"><br><br>  The resulting array will be assigned again to <code><font color="#0000FF">resentsPhotos</font></code> : <br> <code><font color="#0000FF">resentsPhotos = addPhoto (photo, inDefaultsPhotos: resentsPhotos)</font></code> <br>  , which means that <code><font color="#0000FF">{set}</font></code> works for this computed property and the updated array is written to the <code><font color="#0000FF">NSUserDefaults</font></code> repository. <br>  The <code><font color="#0000FF">NSUserDefaults</font></code> mechanism <code><font color="#0000FF">NSUserDefaults</font></code> designed to save a very small amount of data, so we will limit ourselves to the number of photos specified by the <code><font color="#0000FF">ResentPhotoAmount</font></code> constant, which in our particular case is equal to 20. <br>  Now we will think about <u>where</u> it is best to record information about a photo in the <code><font color="#0000FF">NSUserDefaults</font></code> repository.  If the user chooses a photo, then we should put the information about it in <code><font color="#0000FF">NSUserDefaults</font></code> , and this is best done in the <code><font color="#0000FF">prepareForSegue</font></code> method of the <code><font color="#0000FF">prepareForSegue</font></code> class, but we will leave this class more general (we may need it for other purposes).  Therefore, we will place the new functionality related to the recording of photo information in <code><font color="#0000FF">NSUserDefaults</font></code> in the new class <code><font color="#0000FF">PhotosSavedNSUserDefaults</font></code> , which is a <b>subclass of the FlickrPhotosTVC</b> class: <br><br>  <u><i>PhotosSavedNSUserDefaults.swift</i></u> <br><img src="https://habrastorage.org/files/bc6/409/0e9/bc64090e9c5643bb928d50f3ac00ae29.png" width="700" height="256"><br><br>  It is necessary to install the new <code><font color="#0000FF">PhotosSavedNSUserDefaults</font></code> class as a user for the <b>Flickr Photos</b> screen fragment on the storyboard <br><br><img src="https://habrastorage.org/files/6ff/a6e/6c1/6ffa6e6c19064a0f8fd450e73b68cbf5.png" width="700" height="374"><br><br>  But back to the <code><font color="#0000FF">ResentsTVC</font></code> class, which serves ‚Äúrecent‚Äù photos and <b>Resents</b> screen snippet.  His task is to restore information about ‚Äúrecent‚Äù photos from <code><font color="#0000FF">NSUserDefaults</font></code> and we used a single line of code for this: <br><br>  <u><i>ResentsTVC.swift</i></u> <br><img src="https://habrastorage.org/files/30d/cdd/4aa/30dcdd4aae314b7eb41098a035d20414.png" width="700" height="235"><br><br>  If we compare this line with a similar line of another class <code><font color="#0000FF">JustPostedFlickrPhotosTVC</font></code> , also inheriting from <code><font color="#0000FF">FlickrPhotosTVC</font></code> : <br><br>  <u><i>JustPostedFlickrPhotosTVC.swift</i></u> <br><img src="https://habrastorage.org/files/1ed/ae8/502/1edae850247f463a8b405b1c414da963.png" width="700" height="209"><br><br>  then we will see the same <code><font color="#0000FF">.flatMap(Photo.init)</font></code> construction <code><font color="#0000FF">.flatMap(Photo.init)</font></code> .  In the first case, when recovering from <code><font color="#0000FF">NSUserDefaults</font></code> , <code><font color="#0000FF">[String : String]</font></code> <code><font color="#0000FF">NSUserDefaults</font></code> to the input, and in the second case, when reading data from the <a href="https://www.flickr.com/">Flickr</a> server, <code><font color="#0000FF">[String : AnyObject]</font></code> .  How does the compiler know which <code><font color="#0000FF">Photo</font></code> initializer to run?  After all, two of them? <br><br>  <u><i>DataModel.swift</i></u> <br><img src="https://habrastorage.org/files/bcb/3fd/c11/bcb3fdc11d8042739be46c97f671559d.png" width="730" height="575"><br><br>  In Swift, a <code><font color="#0000FF">struct</font></code> can have several initializers, as long as they differ in input parameters.  In our case, there are two: <br><ul><li>  <code><font color="#0000FF">init?(json:[String:AnyObject])</font></code> , to initialize the <code><font color="#0000FF">struct Photo</font></code> from the <b>JSON</b> data from the Flickr server, </li><li>  <code><font color="#0000FF">init(userDefaults:[String:String])</font></code> , to initialize the <code><font color="#0000FF">struct Photo</font></code> from the <code><font color="#0000FF">NSUserDefaults</font></code> repository. </li></ul><br>  Here, the mechanism of type inference from the context ( <b>type Inference</b> ) and overloading ( <b>overload</b> ) of functions depending on the type of the input parameter works.  Therefore, the correct <code><font color="#0000FF">struct Photo</font></code> initializer is called. <br>  Conclusion: in order to ensure the adaptive work of the <b>Split View Controller</b> with the <b>Table Bar Controller</b> as a <b>Master</b> , you must use the methods of the <code><font color="#0000FF">separateSecondaryViewControllerFromPrimaryViewController</font></code> <code><font color="#0000FF">showDetailViewController</font></code> and <code><font color="#0000FF">showDetailViewController</font></code> delegate <code><font color="#0000FF">UISplitViewControllerDelegate</font></code> . <br>  The code is on <a href="https://github.com/BestKora/AdaptiveSplitViewSwift">Github</a> - the <i><u>AdaptiveSplitViewController3Swift</u></i> application. <br><br><h2>  4. Adaptive Popover </h2><br>  Previously, <b>Popover</b> could only be shown on the iPad, but since iOS 8 it is shown on the iPhone both in portrait and landscape modes in the so-called ‚Äúadaptive‚Äù version (more on that later).  The concept of <b>Popover</b> remains the same: we need the <b>View Controller</b> as the content that is shown inside the <b>Popover</b> , but the <b>Popover</b> itself is not a <code><font color="#0000FF">UIViewController</font></code> .  It appears on the screen using the so-called <b>Popover Presentation Controller</b> mechanism. <br>  Let's continue to work with our experimental application and add another screen fragment on the storyboard, which will show the <b>URL of the</b> image of the selected photo in the <b>Popover</b> ‚Äúwindow‚Äù.  To do this, based on the <u><i>AdaptiveSplitViewController2Swift</i></u> application (with numerous <b>Table View Controllers</b> as <b>Master</b> ), create a new application, <u><i>AdaptiveSplitViewController4Swift,</i></u> and add the left button ‚ÄúURL‚Äù to the navigation panel of the <b>Image View Controller</b> screen (display of the photo) and <b>segue</b> of <b>Presents as Popover type</b> .  Now our user interface looks like this: <br><br><img src="https://habrastorage.org/files/caf/9a7/f08/caf9a7f08c21424f8f53da65fc427654.png" width="900" height="473"><br><br>  Regarding <b>Popover</b> , it is interesting that although it is not in itself <b>MVC</b> , it still uses a <b>segue of the</b> type <b>Present as Popover</b> to cause the <b>View Controller</b> it presents. <br>  To create a <b>segue of the</b> type <b>Present as Popover,</b> use as usual <b>CTRL-</b> dragging to some <b>View Controller</b> , and you also get the opportunity to execute the <code><font color="#0000FF">prepareForSegue</font></code> method. <br>  Once you have installed a <b>segue of</b> type <b>Presents as Popover</b> , <br><br><img src="https://habrastorage.org/files/5a4/aa6/ae0/5a4aa6ae0be24cd3aee1705548f90d20.png" width="700" height="291"><br>  It is possible to adjust the size of the ‚Äúwindow‚Äù, namely the size of the top <b>view</b> : <br><br><img src="https://habrastorage.org/files/86a/a71/4f3/86aa714f3d324ab1aa220584b4bc7920.png" width="700" height="374"><br><br>  Set the identifier ‚ÄúShow URL‚Äù for <b>segue</b> and add the <code><font color="#0000FF">prepareForSegue</font></code> method for <code><font color="#0000FF">ImageViewController</font></code> : <br><br>  <u><i>ImageViewController.swift</i></u> <br><img src="https://habrastorage.org/files/601/3b2/0dd/6013b20dde3549ed86ee163d720cbdbd.png" width="700" height="165"><br><br>  Attention should be paid to some additional features when preparing a <b>segue</b> for <b>Popover</b> .  One of them is that inside your <code><font color="#0000FF">prepareForSegue</font></code> you can get what is called a <code><font color="#0000FF">UIPopoverPresentationController</font></code> and configure the <b>Popover</b> presentation.  For example, you can say that you do not want the <b>Popover to</b> ‚Äúpop up‚Äù to the left of something, but you want the <b>Popover to</b> always ‚Äúpop up‚Äù to the right of something.  You can manage all of this.  In addition, in the <code><font color="#0000FF">prepareForSegue</font></code> method, <code><font color="#0000FF">prepareForSegue</font></code> can define yourself as a delegate: <br><br>  <u><i>ImageViewController.swift</i></u> <br><img src="https://habrastorage.org/files/b3d/239/a36/b3d239a3618d4e4dad0843fac461a0a4.png" width="700" height="212"><br><br>  Next, confirm the <code><font color="#0000FF">UIPopoverPresentationControllerDelegate</font></code> protocol: <br><br>  <u><i>ImageViewController.swift</i></u> <br><img src="https://habrastorage.org/files/dfb/d93/c8d/dfbd93c8ddd045e7954a89c73685199a.png" width="700" height="105"><br><br>  and ‚Äúturn off‚Äù adaptive behavior by implementing the <code><font color="#0000FF">UIPopoverPresentationControllerDelegate</font></code> delegate <code><font color="#0000FF">UIPopoverPresentationControllerDelegate</font></code> , which returns <code><font color="#0000FF">.None</font></code> , that is, a ‚Äúrejection‚Äù of iPhone <b>Popover</b> adaptation: <br><br>  <u><i>ImageViewController.swift</i></u> <br><img src="https://habrastorage.org/files/067/4ff/624/0674ff6242ae463a97bb73a5126daa42.png" width="700" height="97"><br><br>  And this is all that is needed to represent <b>Popover</b> in the form of a small ‚Äúwindow‚Äù on the iPhone.  Usually this method is found in blogs. <br>  But in our experimental application, we implement it a little differently, adhering to the idea that the <code><font color="#0000FF">ImageViewController</font></code> class should remain independent of the way the image <b>URL of the</b> photo is displayed, and the screen fragment that <code><font color="#0000FF">TextView</font></code> to display the <b>URL of the</b> photo image should be self-adjusting. <br>  Let's look at this second way. <br>  The display of the image <b>URL of</b> a photo is served by the custom class <code><font color="#0000FF">URLViewController</font></code> . <br>  A model of the <code><font color="#0000FF">URLViewController</font></code> class is the property <br> <code><font color="#0000FF">var url : NSURL?</font></code> <br>  When it is installed, as well as in the ‚Äúlife cycle‚Äù method of <code><font color="#0000FF">updateUI()</font></code> user interface is updated using the <code><font color="#0000FF">updateUI()</font></code> method.  We will conduct the entire <b>Popover</b> setting directly in this class, so the <code><font color="#0000FF">URLViewController</font></code> class confirms the <code><font color="#0000FF">UIPopoverPresentationControllerDelegate</font></code> protocol: <br><br><img src="https://habrastorage.org/files/1b5/75f/4ee/1b575f4eec744ef9b649b9f94329f05a.png" width="700" height="421"><br><br>  In the <code><font color="#0000FF">awakeFromNib</font></code> ‚Äúlife cycle‚Äù <code><font color="#0000FF">awakeFromNib</font></code> , which is called before everyone else, we set the presentation style <code><font color="#0000FF">.Popover</font></code> and assign ourselves to the <code><font color="#0000FF">UIPopoverPresentationControllerDelegate</font></code> protocol <code><font color="#0000FF">UIPopoverPresentationControllerDelegate</font></code> . <br><br>  <u><i>URLViewController.swift</i></u> <br><img src="https://habrastorage.org/files/c58/37e/af6/c5837eaf6f1e468583293836b427c213.png" width="700" height="128"><br><br>  Using <code><font color="#0000FF">UIPopoverPresentationControllerDelegate</font></code> , you can impact how the <b>Popover</b> adapts to the iPhone.  <b>Popover</b> on the iPad ‚Äúpops up‚Äù like we used to - in the form of a small window.  On iPhone, <b>Popover</b> adapts and turns into a full-screen modal window instead of a small window.  It doesn't ‚Äúpop up‚Äù like something small on the iPhone.  Why?  Because the iPhone screen is much smaller, and if the ‚Äúpop-up‚Äù thing is really big, then there may not be a way to make it fit the screen size.  But if you present it modally on the whole screen, then it will exactly fit the screen size.  iOS automatically makes this adaptation for you, just as <b>Split View Controller</b> and <b>Navigation Controller</b> automatically adapt.  But by using the <code><font color="#0000FF">UIPopoverPresentationControllerDelegate</font></code> delegate, you can impact this adaptation, and that is what we will do. <br>  In iOS 9, when <b>Popover</b> tries to make a presentation, it asks us how we want it to ‚Äúadapt‚Äù the <b>Popover</b> to the iPhone?  By default, this is a full-screen modal view ( <code><font color="#0000FF">.FullScreen</font></code> returns), but we can say that we want to use <code><font color="#0000FF">UIModalPresentationStyle.None</font></code> , which means there is no automatic adaptation.  That is, the presentation on the iPhone will be exactly the same as on the iPad.  For a little <b>popover,</b> this makes a lot of sense.  We can ‚Äúturn off‚Äù the behavior of ‚Äúadaptation‚Äù by implementing the delegate method <code><font color="#0000FF">UIPopoverPresentationControllerDelegate</font></code> , in which we return <code><font color="#0000FF">UIModalPresentationStyle.None</font></code> : <br><br>  <u><i>URLViewController.swift</i></u> <br><img src="https://habrastorage.org/files/001/317/299/001317299cc840d5bd00940718bb88c1.png" width="700" height="74"><br><br>  The last and very important thing regarding <b>Popover</b> is the size of the pop-up window. <br>  You really like it when a ‚Äúpop-up‚Äù window that perfectly matches the <b>MVC</b> size appears.  Because <b>MVC</b> can be of a different size.  In any case, you would like to really manage its size.  In the object-oriented world, the system asks <b>MVC</b> , which is in <b>Popover</b> , what size <b>does</b> this <b>MVC</b> prefer?  What size do you want to be?  Because in reality, only <b>MVC</b> itself can know which size may be preferable.  But this is only a recommendation, because <b>Popover</b> also has some limitations.  For example, <b>Popover</b> can appear on the screen only in a certain place, the screen should be large enough, arrows can have certain directions.  <b>Popover has a</b> lot of limitations of this kind. <br>  But he still asks <b>MVC</b> , which places inside, what he wants to be? <br>  There is a special property in your <code><font color="#0000FF">UIViewController</font></code> : <br> <code><font color="#0000FF">var preferredContentSize: CGSize</font></code> <br>  You can override this property and return the preferred size.  If your preferred size is always the same, you can simply install it.  If you need to calculate your preferred size based on its content, you can do it as follows: <br><br>  <u><i>URLViewController.swift</i></u> <br><img src="https://habrastorage.org/files/391/ae2/4ca/391ae24ca47547d890cbf5b1659b9cd0.png" width="700" height="149"><br><br>  As a result, we get the same small ‚Äúwindow‚Äù on <b>Compact-width</b> devices as on <b>Regular-width</b> devices: <br><br><img src="https://habrastorage.org/files/189/e86/07d/189e8607d5c44c42adf3377b13352f4d.png" width="700" height="435"><br><br>  There is one problem with the work of <b>Popover</b> in portrait mode on the iPad.  If I‚Äôm in portrait mode on the iPad and show the <b>URL</b> for a particular photo, then I‚Äôll click on <b>Flickr Photographers</b> on the left side of the navigation bar and select another photographer and another photo ... You can see that the previous <b>URL</b> remains on the screen, although I thought that if I click somewhere outside of <b>Popover</b> , then <b>Popover</b> will go away. <br><br><img src="https://habrastorage.org/files/108/ecf/73d/108ecf73d95d4e14b22d8df6fc37e70a.png" width="900" height="383"><br><br>  We have already changed the picture, and the <b>URL</b> will remain old until we click on the picture itself outside of <b>Popover</b> . <br>  The answer is that if you click on the same panel as the ‚ÄúURL‚Äù button, then you are allowed to interact with everything that is there, that is, click on any buttons and <b>Popover</b> will not go away.  In particular, when we click on the return button <b>Flickr Photographers</b> .  This situation is related to <code><font color="#0000FF">passthroughViews</font></code> .  The whole navigation bar is part of <code><font color="#0000FF">passthroughViews</font></code> , and the really bad thing is that if I click on another photo in the list, the image of the photo is updated, but the <b>Popover</b> from the <b>URL</b> is not.  Still on the screen will be the <b>URL of the</b> old photo.  This is really very bad. <br>  This problem in the code will be solved as follows.  Every time someone installs a new <code><font color="#0000FF">image</font></code> , I will dismiss any <b>Popover</b> that I have. <br><br>  <u><i>ImageViewController.swift</i></u> <br><img src="https://habrastorage.org/files/c02/276/006/c022760062c2487088752fbe2c00583b.png" width="700" height="369"><br><br>  Now the situation has changed <br><br><img src="https://habrastorage.org/files/5fd/b30/db7/5fdb30db7a0b4fc49ef4edab29b3028d.png" width="900" height="378"><br><br>  <u>Conclusion.</u>  In order to present <b>Popover</b> as a ‚Äúsmall window‚Äù on <b>Compact-width</b> devices, you need to cancel <b>Popover's</b> adaptive automatic presentation for <b>Compact-width</b> devices in the form of a modal window to the full screen.  This can be done using the <code><font color="#0000FF">adaptivePresentationStyleForPresentationController</font></code> method. <br>  <code><font color="#0000FF">UIPopoverPresentationControllerDelegate</font></code> delegate, in which we return the value of <code><font color="#0000FF">UIModalPresentationStyle.None</font></code> : <br>  The code is on <b><a href="https://github.com/BestKora/AdaptiveSplitViewSwift">Github</a></b> - the <u><i>AdaptiveSplitViewController4Swift</i></u> application. </div><p>Source: <a href="https://habr.com/ru/post/278781/">https://habr.com/ru/post/278781/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../278771/index.html">Import substitution successes or entertaining statistics based on the Register of Federal State Information Systems</a></li>
<li><a href="../278773/index.html">Grid implementation for working with large tables. Part 1</a></li>
<li><a href="../278775/index.html">We write on D for Raspberry Pi</a></li>
<li><a href="../278777/index.html">The digest of interesting materials for the mobile developer # 143 (February 29 - March 8)</a></li>
<li><a href="../278779/index.html">Why is ownership / borrowing in Rust so complicated?</a></li>
<li><a href="../278783/index.html">Google fixed Android vulnerabilities</a></li>
<li><a href="../278785/index.html">Lessons from participation in the Dota Science hackathon in the framework of Data Fest 2</a></li>
<li><a href="../278787/index.html">√Öngstr√∂m Style System? The use of styles. S2</a></li>
<li><a href="../278789/index.html">Why I am NOT a TypeScript fan</a></li>
<li><a href="../278791/index.html">Microsoft ported SQL Server to Linux</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>