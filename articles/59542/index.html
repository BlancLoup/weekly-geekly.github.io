<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Moose (X). Continuation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In continuation of the topic Use Moose; Modern OOP in Perl , I want to tell you about some interesting features that Moose and its extensions provide....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Moose (X). Continuation</h1><div class="post__text post__text-html js-mediator-article">  In continuation of the topic <a href="http://habrahabr.ru/blogs/perl/59512/">Use Moose;</a>  <a href="http://habrahabr.ru/blogs/perl/59512/">Modern OOP in Perl</a> , I want to tell you about some interesting features that Moose and its extensions provide. <br>  From the above-mentioned topic, you can understand that with Moose you do not have to spend time implementing the object model.  But besides the automatic creation of accessors / mutators and the designer, there is also a lot of all sorts of usefulness and interest.  And with the help of extensions, in general, Perl can be transformed beyond recognition (in a good, naturally, way). <br><br>  I will give examples of the code from the <a href="http://github.com/ksurent/Business--Qiwi/tree/master">module</a> which I try to rewrite in style of modern perl. <br><a name="habracut"></a><br><h4>  Part 1. Moose </h4><br><br><h6>  1.1 Changing inherited attributes </h6><br>  Let's start with the simple.  As you could learn from the above-mentioned topic, the Moose-based classes can, in addition to methods, also inherit attributes.  And they can also partially change their [inherited attributes].  Very comfortably.  The situation where it may be necessary: ‚Äã‚Äãthere is a base class and several inheriting from it.  Among the attributes of the base class there are those that are necessary for all children, only the default value should be for everyone.  You do not have to declare an attribute with all properties in each child (data type, access rights, etc.) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Code: <br>  base class: <br> <code>has request_type =&gt; ( is =&gt; 'ro', isa =&gt; 'Int', lazy =&gt; 1, default =&gt; undef, init_arg =&gt; undef, ); <br></code> <br>  child: <br> <code>has <b>'+request_type'</b> =&gt; ( default =&gt; 32, ); #     default <br></code> <br><br><h6>  1.2 Method Modifiers </h6><br>  In some ways they resemble decorators, although they are not.  There are three modifiers: before, after and around.  The first two are performed, respectively, <i>BEFORE</i> and <i>AFTER the</i> method to which they were applied.  About the third is to tell a little more.  The around modifier takes as an argument the name of the method to which it was applied, and already inside the modifier you yourself must explicitly call it [method].  It turns out what happens inside the modifier, and in the place where you need.  Accordingly, you can do anything both <i>BEFORE the</i> call and <i>AFTER</i> . <br><br>  Example of application: (the modifier encrypts a certain request after its creation, if the corresponding options are specified) <br> <code><b>after</b> create_request =&gt; sub { <br> my $self = shift; <br> <br> return unless $self-&gt;cipher; <br> <br> require Crypt::TripleDES; <br> <br> my $ciphered_text = sprintf "Phone%s\n%s", <br> $self-&gt;trm_id, <br> unpack('H*', Crypt::TripleDES-&gt;new-&gt;encrypt3($self-&gt;request, $self-&gt;ciphering_key)); <br> <br> $self-&gt;request($ciphered_text) <br> }; <br></code> <br><br><h6>  1.3 augment + inner </h6><br>  This feature is what I especially like. <br>  Imagine that there is a base class, which is a template of a certain abstract query in the same abstract service.  There is a set of parameters that must be added to each request (for example, login, password, number, etc.).  In order not to duplicate this addition in each class, we will move it to the base class, and all child classes will work only with a specific part of the query. <br><br>  Immediately code: <br>  base class: <br> <code>method create_request() { #      <br> my $req_node = <b>inner()</b> ; <br> $req_node-&gt;appendChild( $self-&gt;_create_extra_node($_, $self-&gt;$_) ) foreach qw(password serial); <br> $req_node-&gt;appendChild( $self-&gt;_create_simple_node('protocol-version', $self-&gt;protocol_version) ); <br> $req_node-&gt;appendChild( $self-&gt;_create_simple_node('terminal-id', $self-&gt;trm_id) ); <br> $req_node-&gt;appendChild( $self-&gt;_create_simple_node('request-type', $self-&gt;request_type) ); <br> <br> my $xml = XML::LibXML::Document-&gt;new('1.0', 'utf-8'); <br> $xml-&gt;setDocumentElement($req_node); <br> <br> $self-&gt;request($xml-&gt;toString) <br> } <br></code> <br>  child: <br> <code><b>augment</b> create_request =&gt; sub { #     <br> my $self = shift; <br> <br> my $xml = $self-&gt;_create_simple_node('request'); <br> $xml-&gt;appendChild( $self-&gt;_create_extra_node('phone', $self-&gt;phone) ); <br> <br> $xml <br> }; <br></code> <br>  How it works: in the create_request method (by the way, pay attention to its declaration. About this in part 2) there is a call to the "magic" function inner ().  This is the part that can be changed.  In the child class, we pass an anonymous sub to the augment modifier.  Here it is executed in the place of inner () when the create_request is called on an instance of the child class. <br>  At first glance, it seems tricky and useless.  Tricky - yes, useless - no.  To facilitate understanding, it is worthwhile to draw an analogy with the change of inherited attributes: the child inherits the method, but partially retains the parent functionality. <br>  Just do not abuse this opportunity, because  it reduces the "transparency" of the code. <br><br><h4>  Part 2. MooseX </h4><br>  Here the real interesting things begin) By the way, just in case I will say that MooseX is the module namespace for Moose extensions. <br><br><h6>  2.1 MooseX :: Declare </h6><br>  The module provides excellent syntactic sugar for Moose-based classes.  With it, methods become methods, and classes become classes: <br> <code>use MooseX::Declare; <br> <br> <b>class Business::Qiwi</b> { <br> has trm_id =&gt; ( is =&gt; 'rw', isa =&gt; 'Str', required =&gt; 1, ); <br> has password =&gt; ( is =&gt; 'rw', isa =&gt; 'Str', required =&gt; 1, ); <br> has serial =&gt; ( is =&gt; 'rw', isa =&gt; 'Str', required =&gt; 1, ); <br> #... <br> <b>method</b> get_balance() { <br> # ... <br> } <br> }; <br></code> <br>  And you can and so: <br> <code><b>class Business::Qiwi::Balance extends Business::Qiwi::Request</b> { <br> # ... <br> }; <br></code> <br>  A couple more important utility: <br><ol><li>  no longer need to do <code>my $self = shift;</code>  .  Invocant is available in the method automatically (under the name $ self). </li><li>  classes declared with MooseX :: Declare automatically become immutable.  Those.  you no longer need to do <code>__PACKAGE__-&gt;meta-&gt;make_immutable</code> </li></ol><br><br><h6>  2.2 MooseX :: Types </h6><br>  Creation of new data types (including on the basis of existing ones).  Example: <br> <code><b>use MooseX::Types -declare =&gt; [qw(Date EntriesList IdsList TxnsList BillsList)];</b> #    <br> use MooseX::Types::Moose qw(Int Str ArrayRef HashRef); #    Moose <br> <br> <b>subtype Date =&gt; as Str =&gt; where { /^\d{2}\.\d{2}\.\d{4}$/ } =&gt; message { 'Date must be provided in DD.MM.YYYY format' };</b> #       Str <br></code> <br>  Using MooseX :: Types, you can leave out quotes for data type names: <br> <code>subtype IdsList =&gt; as <b>ArrayRef[Int]</b> ; #     has    <br></code> <br><br><h6>  2.3 MooseX :: Declare + MooseX :: Types </h6><br>  If you use the two modules mentioned above, you can do this: <br> <code>method create_bill( <b>Num $amount, Str $to, Str $txn, Str $comment, Bool $sms_notify?, Bool $call_notify?, Int $confirm_time?</b> ) { #     //  <br> # ... <br> } <br> <br> method get_bill_status( <b>BillsList $bill</b> ) { #     ! <br> # ... <br> } <br></code> <br><br><h6>  2.4 MooseX :: MultiMethods </h6><br>  Adds the ability to overload (overloading) methods using the multi keyword.  This piece of code from the tests to the module will perfectly say for me (hello, The Big Bang Theory): <br><br> <code>use strict; <br> use warnings; <br> use Test::More tests =&gt; 3; <br> <br> { <br> package Paper; use Moose; <br> package Scissors; use Moose; <br> package Rock; use Moose; <br> package Lizard; use Moose; <br> package Spock; use Moose; <br> <br> package Game; <br> use Moose; <br> use MooseX::MultiMethod; <br> <br> <b>multi method play</b> (Paper $x, Rock $y) { 1 } <br> <b>multi method play</b> (Paper $x, Spock $y) { 1 } <br> <b>multi method play</b> (Scissors $x, Paper $y) { 1 } <br> <b>multi method play</b> (Scissors $x, Lizard $y) { 1 } <br> <b>multi method play</b> (Rock $x, Scissors $y) { 1 } <br> <b>multi method play</b> (Rock $x, Lizard $y) { 1 } <br> <b>multi method play</b> (Lizard $x, Paper $y) { 1 } <br> <b>multi method play</b> (Lizard $x, Spock $y) { 1 } <br> <b>multi method play</b> (Spock $x, Rock $y) { 1 } <br> <b>multi method play</b> (Spock $x, Scissors $y) { 1 } <br> <b>multi method play</b> (Any $x, Any $y) { 0 } <br> } <br> <br> my $game = Game-&gt;new; <br> ok($game-&gt;play(Spock-&gt;new, Scissors-&gt;new), 'Spock smashes Scissors'); <br> ok(!$game-&gt;play(Lizard-&gt;new, Rock-&gt;new), 'Rock crushes Lizard'); <br> ok(!$game-&gt;play(Spock-&gt;new, Paper-&gt;new), 'Paper disproves Spock'); <br> <br> 1; <br></code> <br><br>  It was a brief review of Moose tweaks (and its extensions) - the new Perl5 object model. <br>  In the bright future, perhaps, I will try to tell about roles as a substitute for inheritance.  For this, let me leave. </div><p>Source: <a href="https://habr.com/ru/post/59542/">https://habr.com/ru/post/59542/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../59535/index.html">10 Tricks for Using Custom Fields in WordPress</a></li>
<li><a href="../59537/index.html">Ubuntu Media Player</a></li>
<li><a href="../59538/index.html">Link shortening service integrated into Habrahabr</a></li>
<li><a href="../59539/index.html">Invite on funkytorrents. Part 3</a></li>
<li><a href="../59541/index.html">Tasks is now in Google Calendar</a></li>
<li><a href="../59543/index.html">Team Fortress 2 Sniper Update</a></li>
<li><a href="../59544/index.html">Business social networks</a></li>
<li><a href="../59548/index.html">Service for creating forums without ads</a></li>
<li><a href="../59551/index.html">GreaseMonkey Script Removing Bad Quotes from Bash</a></li>
<li><a href="../59552/index.html">Zipper - derived from type</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>