<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Attack of BitErrant with SHA-1 collisions: create different .exe with the same .torrent file</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On February 23, 2017, Google and the Center for Mathematics and Computer Science in Amsterdam presented the first collision generation algorithm for S...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Attack of BitErrant with SHA-1 collisions: create different .exe with the same .torrent file</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/bbb/b83/562/bbbb835624814a74a4ac78b5aaf5b0c1.png"><br><br>  On February 23, 2017, Google and the Center for Mathematics and Computer Science in Amsterdam presented the <a href="https://habrahabr.ru/post/322478/">first collision generation algorithm for SHA-1</a> .  This finding was the result of a two-year study, which began shortly after the publication in 2013 of the work of the cryptographer Mark Stevens from the Center for Mathematics and Computer Science in Amsterdam on the theoretical approach to creating a SHA-1 collision.  He further continued the search for practical methods of hacking.  Now, together with colleagues from Google, he published a <a href="https://shattered.io/static/shattered.pdf">scientific paper</a> , which describes the general principles of generating documents with message blocks prone to SHA-1 collisions ( <a href="http://shattered.io/">SHAttered</a> attack). <br><a name="habracut"></a><br>  It immediately became clear how dangerous the attack can be, because the <a href="https://security.googleblog.com/2014/09/gradually-sunsetting-sha-1.html">outdated</a> cryptographic hash function SHA-1 is still widely used, including in applications and security protocols, including TLS and SSL, PGP, SSH, S / MIME, IPsec.  The SHA-1 hashes are used in different Git, Mercurial, and other version control systems to verify the content and detect data corruption (see <a href="https://habrahabr.ru/post/322622/">Torvalds' comment</a> on collisions in Git).  The SHA-1 hashes are even used in the Wii game console to verify signatures at boot time.  The use of SHA-1 is legally required by some government organizations.  And the most interesting thing for the topic of this article is SHA-1 hashes are used in the BitTorrent peering network protocol for file exchange over the Internet. <br><br>  In short, how BitTorrent works, namely <a href="https://habrahabr.ru/post/119753/">how the torrent file</a> works. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/3ce/3e9/750/3ce3e975013946939aee31589962d320.png"><br><br>  To distribute a file through torrents, in the first step, you need to generate a special torrent file with the extension .torrent (DATA.torrent) from this file (DATA).  The original file is divided into a certain number of segments (chunks), for each of them the SHA-1 hash is calculated.  All received hashes are connected together and stored in the torrent file in the line of <code>pieces</code> under the common key of the dictionary.  The length of this string is 20 * the number of pieces. <br><br><img src="https://habrastorage.org/files/c55/023/6cf/c550236cf32143b1b518989731b549cb.png"><br><br>  When someone tries to download a file (DATA) via BitTorrent, he first needs to download the torrent file DATA.torrent and parse it.  Based on the information from this file, the client searches for peers and downloads segments of the original file (DATA).  To protect against peers who are trying to slip malicious data, the client checks each segment with its hash from the torrent file.  If the hash in the torrent file does not match the SHA1 hash in the downloaded fragment, then the bad fragment is rejected. <br><br>  Now the attack vector becomes clear. <br><br><img src="https://habrastorage.org/files/e2e/c8b/57a/e2ec8b57a54040ab894be3b890aa7a44.png"><br><br>  An attacker can create an executable file that, when executed, does not do anything forbidden and looks harmless, but changes the way commands are executed depending on the contents of the SHATTER region.  When antivirus checks the original file will not cause suspicion, because the malicious part is stored in an encrypted blob and never runs for execution. <br><br>  And this is where the fun begins. <br><br><h1>  <a href="https://biterrant.io/">BitErrant Attack</a> </h1><br>  If an attacker can create two data blobs with the same SHA1 hashes, then under certain conditions it is possible to generate two executable files with different data inside.  But both files will match the same torrent file. <br><br>  If all the conditions are met, then we get two executable files in which one part can be replaced by another.  If you replace it, the command execution path will change and the malicious code will work. <br><br><img src="https://habrastorage.org/files/498/fbc/e8d/498fbce8db1742079d6e50e4db2a2d8a.png"><br><br>  It is this ‚Äúvariable‚Äù functionality of the executable file that can be implemented in practice thanks to the BitTorrent protocol.  The principle is simple: we start seeding through torrents with a ‚Äúgood‚Äù file, and then at a certain moment replace it with ‚Äúbad‚Äù, effectively changing the data fragment from those who download this file on the peer network. <br><br><h1>  Demonstration and toolkit </h1><br>  <b><a href="">biterrant_poc.zip</a></b> <br><br>  The archive contains two executable EXE files with different functionality (the malicious file contains the <a href="https://www.offensive-security.com/metasploit-unleashed/meterpreter-basics/">Meterpreter</a> stuffing for the Metasploit framework, which in this case starts to listen on all interfaces). <br><br>  <i>Password to decrypt the archive: biterrant.io</i> <br><br>  SHA1: eed49a31e0a605464b41df46fbca189dcc620fc5 <br><br>  <a href="https://virustotal.com/en/file/aab71ef7bf13e4fe8613d4f1f9ae136cd7f03474c0e576f0de6f9fc4c15edd97/analysis/1488732404/">A good file on VirusTotal</a> , a <a href="https://virustotal.com/en/file/0624ed0bad3edf8308004b323d6f3cfd70751395dc93bd1108f7a6df87223102/analysis/1488732438/">bad file</a> in the same place. <br><br>  The author of the attack BitErrant has developed the <a href="https://github.com/skelsec/BitErrant">appropriate toolkit</a> - a framework for generating executable files with the same .torrent.  With this framework, you can put an arbitrary load in the encrypted part of the executable file and get the parameters for its call, which are then placed in the executable part of the file.  Then choose the innocent functions of your choice for a good file replaceable part.  Then the Python script generates two executable files ‚Äî good and bad ‚Äî that correspond to the <i>same</i> .torrent file. <br><br>  So far, no one is using this attack to distribute files through official torrent trackers.  And even "good" files with variable functionality look suspicious for some antiviruses.  So the danger of this attack should not be taken too seriously. <br><br>  To protect against this attack, it is enough to always check the total hash of the file being downloaded and compare it with the hash of the file that is in the distribution, that's all.  By the way, there is even an option to include the common hash of the MD5 file directly into the torrent file, then this attack will become impossible.  In most cases, no one uses this option. </div><p>Source: <a href="https://habr.com/ru/post/357944/">https://habr.com/ru/post/357944/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../357930/index.html">Making the PC turn on cotton per evening</a></li>
<li><a href="../357932/index.html">Running line on Arduino + control from the smartphone</a></li>
<li><a href="../357934/index.html">LED cube 8x8x8, interesting and beautiful</a></li>
<li><a href="../357936/index.html">Smart Redmond SkyPlug RSP-100S Socket Analysis of the design and the electrical circuit diagram. Identifying deficiencies</a></li>
<li><a href="../357942/index.html">Heavy industry removal</a></li>
<li><a href="../357950/index.html">Compact server for Django applications</a></li>
<li><a href="../357952/index.html">Raspberry pi zero</a></li>
<li><a href="../357954/index.html">Raspberry Pi Zero went on sale for $ 5: links to stores</a></li>
<li><a href="../357956/index.html">ACS, raspberry and kettle</a></li>
<li><a href="../357958/index.html">Thermal Raspberry Pi 3 showed a temperature of 101¬∫C</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>