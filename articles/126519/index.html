<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Audit and external authentication in MySQL</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today I will tell how to make your MySQL DBMS closer to PCI DSS standards. To begin with, this is what we get: 
 Console admin user mcshadow 


 mcsha...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Audit and external authentication in MySQL</h1><div class="post__text post__text-html js-mediator-article">  Today I will tell how to make your MySQL DBMS closer to PCI DSS standards.  To begin with, this is what we get: <br>  Console admin user <b>mcshadow</b> <br><pre>  mcshadow: ~ $ mysql --user = mcshadow --password = mike
 mysql&gt; select current_user ();
 + ---------------- +
 |  current_user () |
 + ---------------- +
 |  mike @ localhost |
 + ---------------- +
 mcshadow: ~ $ mysql --user = mcshadow --password = root
 mysql&gt; select current_user ();
 + ---------------- +
 |  current_user () |
 + ---------------- +
 |  root @ localhost |
 + ---------------- + </pre><br>  Access is possible with both root and mortal user rights mike. <br><hr><br>  Mike mortal console <br><pre>  mike: ~ $ mysql --user = mcshadow --password = mike
 ERROR 1698 (28000): Access denied for user 'mcshadow' @ 'localhost' </pre><br>  Access to the database under the administrator is not possible. <br><hr><br>  Meanwhile in syslog <br><blockquote>  <sup>mysqld: User: mcshadow TRY access from: localhost with privileges: mike</sup> <sup><br></sup>  <sup>mysqld: User: mcshadow <b>SUCCESS</b> access from: localhost with privileges: mike</sup> <sup><br></sup>  <sup>mysql: SYSTEM_USER: 'mcshadow', MYSQL_USER: 'mcshadow', CONNECTION_ID: 5, DB_SERVER: '-', DB: '-', COMMAND_RESULT: SUCCESS, QUERY: 'select current_user ();'</sup> <sup><br></sup>  <sup>mysqld: User: mcshadow TRY access from: localhost with privileges: root</sup> <sup><br></sup>  <sup>mysqld: User: mcshadow <b>SUCCESS</b> access from: localhost with privileges: root</sup> <sup><br></sup>  <sup>mysql: SYSTEM_USER: 'mcshadow', MYSQL_USER: 'mcshadow', CONNECTION_ID: 6, DB_SERVER: '-', DB: '-', COMMAND_RESULT: SUCCESS, QUERY: 'select current_user ();'</sup> <sup><br></sup>  <sup>mysqld: User: mcshadow TRY access from: localhost with privileges: mike</sup> <sup><br></sup>  <sup>mysqld: User: mcshadow <b>FAILED</b> access from: localhost with privileges: mike</sup> </blockquote><br><a name="habracut"></a><br><h4>  Introduction </h4><br>  The post is recommended to those who really need it, there was a phrase ‚ÄúI will be brief today,‚Äù but after I finished writing this article, I realized that it did not work out. <br>  If you use MySQL as a DBMS in a large company, you will encounter some problems, such as: there is no user-defined password policy in MySQL, i.e.  You can‚Äôt set up a cunning scheme for the use of a password, control new passwords for compliance with standards adopted by your organization, use SSO to connect to the database, etc.  It would also be extremely convenient to log all successful and unsuccessful attempts to connect to the database and user actions with DBA rights to the security officer‚Äôs console.  In addition to this, you often want to log into the database under your login, but with the rights of another user, for example, to install or perform a specific set of actions to get an error.  What is desirable to not know the password of this user, as well as to make sure that all actions are correctly reflected in the security logs.  Other databases allow you to make some of these items, of course, not all.  MySQL starting from version 5.5.7+ will allow you to perform any of them, without creating undue burden on the database. <br>  <u>The article is educational in nature, the use of these solutions for any purpose, including those described, solely on your conscience.</u> <br><br><h4>  Theory </h4><br>  Now let's talk what and where to get.  As you understand, in order for this to work, you need to build an external library.  Well, we are not going to write anything ourselves as ‚Äúexperienced‚Äù siblings, but simply take the finished one and just transfer from one source to another. <br>  First: logging for the MySQL client is taken from the percones.  If you compare the sources of MySQL 5.5.X and Percona 5.5.X, the difference in them is only in the fact that the Perconian client is able to log everything in a syslog, but it does this optionally.  Actually, we just need to drag a part of these source codes.  And make this the default setting.  You can simply take the source MySQL client for perkony, if you are afraid to mess with copy-paste. <br>  Second: logging attempts to log into the database, as you understand, will have to be done on the server.  Here we have a small selection.  How to understand what you need to log?  Everything is simple in the MySQL source code there is a file <b>log.cc</b> - it is responsible for the <b>general_log</b> .  This log successfully records everything that happens on the database, including successful and unsuccessful connection attempts.  Everything would be fine, but it works very slowly - I strongly advise against including it on the industrial database.  We need this log to understand what to look for and where.  According to this file, at the moment there are only two implementations allowing to write to the <b>general_log_print</b> and <b>general_log_write</b> logs.  There will have to sweat and carefully review what to change and where. <br>  Third: and for us, perhaps the most interesting is the new MySQL 5.5.7 <b>GRANT PROXY</b> feature. <br><blockquote><pre>  GRANT PROXY
   ON 'priv_user' @ 'localhost'
   TO 'real_user' @ 'localhost'; </pre></blockquote><br>  for this to work the user real_user must be created in a special way <br><blockquote><pre>  CREATE USER 'real_user' @ 'localhost'
   IDENTIFIED WITH 'auth_plugin_xxx' AS 'auth_string'; </pre></blockquote><br>  Now, when connecting a real_user user <b>, the</b> password can be checked not only by the means of the muscle itself, but put it on a third-party plugin - <b>auth_plugin_xxx</b> .  You can write this plugin yourself, well, this is for labor developers, we are not going to do such things yet, because: for testing purposes and as an example, MySQL has already written a couple of plug-ins on which to experiment.  We will take them as a basis to play around.  The most important thing for which this plugin is needed is that, based on its internal logic, it can replace the username field whose privileges will be applied to the session.  And if our <b>real_user</b> has <b>proxy</b> rights under a spoofed user, MySQL successfully gives us all the rights of the <b>priv_user</b> user.  It is in this plug-in that you can cram a call to SSO using your internal protocol or <b>ldap</b> server, and heap up any heap of other logic. <br>  While the theory suffices - we swing MySQL 5.5.15 in source codes. <br><br><h4>  Practice </h4><br>  The first is logging administrator actions from the local machine.  We believe that the database administrator is not the server administrator and has access to the database only from the console using a socket or via TCP - this is not important.  In order to administer the server is more than enough.  In <b>mysql.cc</b> we need to add the following lines: <br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;violite.h&gt; //     Linux   syslog #ifndef __WIN__ #include "syslog.h" #endif ... void tee_putc(int c, FILE *file); //       void write_syslog(String *buffer); ... //       Percona        .     : mysql_error(&amp;mysql)[0] void write_syslog(String *line){ #ifndef __WIN__ uint length= line-&gt;length(); uint chunk_len= min(MAX_SYSLOG_MESSAGE, length); char *ptr= line-&gt;c_ptr_safe(); char buff[MAX_SYSLOG_MESSAGE + 1]; for (; length; length-= chunk_len, ptr+= chunk_len, chunk_len= min(MAX_SYSLOG_MESSAGE, length)) { char *str; if (length == chunk_len) str= ptr; // last chunk =&gt; skip copy else { memcpy(buff, ptr, chunk_len); buff[chunk_len]= '\0'; str= buff; } syslog(LOG_INFO, "SYSTEM_USER:'%s', MYSQL_USER:'%s', CONNECTION_ID:%lu, " "DB_SERVER:'%s', DB:'%s', COMMAND_RESULT:%s, QUERY:'%s'", getenv("SUDO_USER") ? getenv("SUDO_USER") : getenv("USER") ? getenv("USER") : "--", current_user ? current_user : "--", mysql_thread_id(&amp;mysql), current_host ? current_host : "--", current_db ? current_db : "--", mysql_error(&amp;mysql)[0]?"FAILED":"SUCCESS", str); } #endif } ... #endif /*HAVE_READLINE*/ //       #ifndef __WIN__ if (buffer-&gt;length() &amp;&amp; connect_flag == CLIENT_INTERACTIVE){ write_syslog(buffer); } #endif</span></span></span></span></code> </pre> <br>  The second.  The main module that handles server user login attempts is <b>sql_acl.cc</b> .  After calling all <b>general_log_print</b> - we need to add our own.  As you understand, <b>general_log</b> is disabled, but the tip is very good.  The second command ( <b>general_log_write</b> ) is currently not called when attempting to connect a user to the database.  I did it like this (new blocks are allocated to the PCI DSS patch): <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// PCI DSS patch #ifndef __WIN__ #include "syslog.h" #endif // end PCI DSS patch ... //  login_failed_error -      general_log_print(thd, COM_CONNECT, ER(ER_ACCESS_DENIED_NO_PASSWORD_ERROR), mpvio-&gt;auth_info.user_name, mpvio-&gt;auth_info.host_or_ip); // PCI DSS patch syslog(LOG_WARNING, "User:%s FAILED access from:%s with privileges:%s", mpvio-&gt;auth_info.user_name, mpvio-&gt;auth_info.host_or_ip, mpvio-&gt;auth_info.authenticated_as); // end PCI DSS patch ... general_log_print(thd, COM_CONNECT, ER(ER_ACCESS_DENIED_ERROR), mpvio-&gt;auth_info.user_name, mpvio-&gt;auth_info.host_or_ip, passwd_used ? ER(ER_YES) : ER(ER_NO)); // PCI DSS patch syslog(LOG_WARNING, "User:%s FAILED access from:%s with privileges:%s", mpvio-&gt;auth_info.user_name, mpvio-&gt;auth_info.host_or_ip, mpvio-&gt;auth_info.authenticated_as); // end PCI DSS patch ... //  secure_auth -        if (mpvio-&gt;client_capabilities &amp; CLIENT_PROTOCOL_41) { my_error(ER_SERVER_IS_IN_SECURE_AUTH_MODE, MYF(0), mpvio-&gt;auth_info.user_name, mpvio-&gt;auth_info.host_or_ip); general_log_print(thd, COM_CONNECT, ER(ER_SERVER_IS_IN_SECURE_AUTH_MODE), mpvio-&gt;auth_info.user_name, mpvio-&gt;auth_info.host_or_ip); // PCI DSS patch syslog(LOG_WARNING, "User:%s FAILED access from:%s with privileges:%s", mpvio-&gt;auth_info.user_name, mpvio-&gt;auth_info.host_or_ip, mpvio-&gt;auth_info.authenticated_as); // end PCI DSS patch } else { my_error(ER_NOT_SUPPORTED_AUTH_MODE, MYF(0)); general_log_print(thd, COM_CONNECT, ER(ER_NOT_SUPPORTED_AUTH_MODE)); // PCI DSS patch syslog(LOG_WARNING, "Auth mode not supported"); // end PCI DSS patch } ... //  send_plugin_request_packet -             general_log_print(current_thd, COM_CONNECT, ER(ER_NOT_SUPPORTED_AUTH_MODE)); // PCI DSS patch syslog(LOG_WARNING, "Auth mode not supported"); // end PCI DSS patch ... // find_mpvio_user general_log_print(current_thd, COM_CONNECT, ER(ER_NOT_SUPPORTED_AUTH_MODE)); // PCI DSS patch syslog(LOG_WARNING, "Auth mode not supported"); // end PCI DSS patch ... //  acl_authenticate -      main   if (strcmp(mpvio.auth_info.authenticated_as, mpvio.auth_info.user_name)) { general_log_print(thd, command, "%s@%s as %s on %s", mpvio.auth_info.user_name, mpvio.auth_info.host_or_ip, mpvio.auth_info.authenticated_as ? mpvio.auth_info.authenticated_as : "anonymous", mpvio.db.str ? mpvio.db.str : (char*) ""); // PCI DSS patch syslog(LOG_WARNING, "User:%s TRY access from:%s with privileges:%s", mpvio.auth_info.user_name, mpvio.auth_info.host_or_ip, mpvio.auth_info.authenticated_as); // end PCI DSS patch } else { general_log_print(thd, command, (char*) "%s@%s on %s", mpvio.auth_info.user_name, mpvio.auth_info.host_or_ip, mpvio.db.str ? mpvio.db.str : (char*) ""); // PCI DSS patch syslog(LOG_WARNING, "User:%s TRY access from:%s with privileges:%s", mpvio.auth_info.user_name, mpvio.auth_info.host_or_ip, mpvio.auth_info.authenticated_as); // end PCI DSS patch } ... if (res &gt; CR_OK &amp;&amp; mpvio.status != MPVIO_EXT::SUCCESS) { DBUG_ASSERT(mpvio.status == MPVIO_EXT::FAILURE); if (!thd-&gt;is_error()) login_failed_error(&amp;mpvio, mpvio.auth_info.password_used); DBUG_RETURN (1); } // PCI DSS patch else syslog(LOG_WARNING, "User:%s SUCCESS access from:%s with privileges:%s", mpvio.auth_info.user_name, mpvio.auth_info.host_or_ip, mpvio.auth_info.authenticated_as); // end PCI DSS patch</span></span></code> </pre><br>  Unfortunately, this is not all.  It turns out the authentication is performed in 2 places.  The first is when you try to <b>use the use database</b> command.  For this, the <b>sql_db.cc</b> module, the <b>mysql_change_db</b> function, is <b>responsible</b> for it, after calling the general log, as well, we add our lines. <br><pre> <code class="cpp hljs"> general_log_print(thd, COM_INIT_DB, ER(ER_DBACCESS_DENIED_ERROR), sctx-&gt;priv_user, sctx-&gt;priv_host, new_db_file_name.str); <span class="hljs-comment"><span class="hljs-comment">// PCI DSS patch syslog(LOG_WARNING, "User:%s FAILED access from:%s with privileges:%s", sctx-&gt;proxy_user, sctx-&gt;priv_host, sctx-&gt;priv_user); // end PCI DSS patch</span></span></code> </pre><br>  And the last thing left for us to do is to log the moment when the user views information on the database that is not available to him.  The module <b>sql_show.cc</b> is responsible for this.  The procedure with the eloquent title <b>mysqld_show_create_db</b> .  Add: <br><pre> <code class="cpp hljs"> general_log_print(thd,COM_INIT_DB,ER(ER_DBACCESS_DENIED_ERROR), sctx-&gt;priv_user, sctx-&gt;host_or_ip, dbname); <span class="hljs-comment"><span class="hljs-comment">// PCI DSS patch syslog(LOG_WARNING, "User:%s FAILED access from:%s with privileges:%s", sctx-&gt;proxy_user, sctx-&gt;priv_host, sctx-&gt;priv_user); // end PCI DSS patch</span></span></code> </pre><br>  According to POSIX, the <b>syslog</b> function supports multithreading, it should not fall.  We did not fit into the critical sections, it should not be too slow. <br>  Fine!  Now we can read in the logs how and where we change rights.  It remains the case for small.  Zayuzat new feature.  We climb into the <b>plugins</b> directory of source codes and see as many as two plugins for authentication, like this a gift.  The first <b>auth_socket.c</b> allows you to log in to the database under the operating system user if a socket is used.  Well, in the absence of a better use of it - like this is our SSO.  The next plugin, <b>test_plugin.c</b> , works as follows.  When creating a user, you specify the mystical string <b>AS 'auth_string'</b> after the name of the plugin.  The plugin compares the password with this line.  If no match is found, it throws out an error, but if everything went well, then you are assigned to the session the privileges of the user whose name is ' <b>auth_string</b> '.  A plugin, as you yourself understand the test and serves simply for the purpose of checking that the mechanism works. <br>  According to the documentation, the plug-in can only change the user name, or rather, write it with a new specially allocated field <b>info-&gt; authenticated_as</b> and set the need to enter a password <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PASSWORD_USED_NO 0 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PASSWORD_USED_YES 1 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PASSWORD_USED_NO_MENTION 2</span></span></code> </pre><br>  I had problems with changing the host, so I didn‚Äôt risk it.  All just lokalki. <br>  We make one of two functions and shove it into a test authentication plugin (all of a sudden it uses another system ...) <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">auth_test_plugin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MYSQL_PLUGIN_VIO *vio, MYSQL_SERVER_AUTH_INFO *info)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *pkt; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pkt_len; MYSQL_PLUGIN_VIO_INFO vio_info; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ucred</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cred</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">socklen_t</span></span> cred_len= <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(cred); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">passwd</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pwd_buf</span></span></span><span class="hljs-class">, *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pwd</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> buf[<span class="hljs-number"><span class="hljs-number">1024</span></span>]; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (vio-&gt;write_packet(vio, (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *) PASSWORD_QUESTION, <span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CR_ERROR; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((pkt_len= vio-&gt;read_packet(vio, &amp;pkt)) &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CR_ERROR; <span class="hljs-comment"><span class="hljs-comment">/*       */</span></span> info-&gt;password_used= PASSWORD_USED_NO_MENTION; <span class="hljs-comment"><span class="hljs-comment">/*        */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">strcpy</span></span> (info-&gt;authenticated_as, (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *) pkt); vio-&gt;info(vio, &amp;vio_info); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (vio_info.protocol != MYSQL_VIO_SOCKET) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CR_ERROR; <span class="hljs-comment"><span class="hljs-comment">/* get the UID of the client process */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (getsockopt(vio_info.socket, SOL_SOCKET, SO_PEERCRED, &amp;cred, &amp;cred_len)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CR_ERROR; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cred_len != <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(cred)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CR_ERROR; <span class="hljs-comment"><span class="hljs-comment">/* and find the username for this uid */</span></span> getpwuid_r(cred.uid, &amp;pwd_buf, buf, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(buf), &amp;pwd); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pwd == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CR_ERROR; <span class="hljs-comment"><span class="hljs-comment">/*        MySQL */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(pwd-&gt;pw_name, info-&gt;user_name) ? CR_ERROR : CR_OK; }</code> </pre><br>  Next we are going <br><pre> cmake -DCMAKE_INSTALL_PREFIX = / opt / mysql-5.5.15 - this is the folder where we put, you do not want to kill your muscular.
 make
 make install
</pre><br>  We configure the database, log in as root and perform the following actions: <br><pre> install plugin test_plugin_server soname 'auth_test_plugin.so';
 show plugins;
 + ----------------------- + -------- + ---------------- ---- + --------------------- + --------- +
 |  Name |  Status |  Type |  Library |  License |
 + ----------------------- + -------- + ---------------- ---- + --------------------- + --------- +
 ...
 |  test_plugin_server |  ACTIVE |  AUTHENTICATION |  auth_test_plugin.so |  GPL |
 + ----------------------- + -------- + ---------------- ---- + --------------------- + --------- +
 create user 'mike' @ 'localhost';
 create user 'mcshadow' @ 'localhost' identified with 'test_plugin_server' as 'volki';
 grant proxy on 'root' @ 'localhost' to 'mcshadow' @ 'localhost';
 grant proxy on 'mike' @ 'localhost' to 'mcshadow' @ 'localhost';
 select * from mysql.proxies_priv;
 + ----------- + ---------- + ----------------- + -------- ------ + ------------ + ---------------- + ------------- -------- +
 |  Host |  User |  Proxied_host |  Proxied_user |  With_grant |  Grantor |  Timestamp |
 + ----------- + ---------- + ----------------- + -------- ------ + ------------ + ---------------- + ------------- -------- +
 ...
 |  localhost |  mcshadow |  localhost |  root |  0 |  root @ localhost |  2011-08-17 01:15:09 |
 |  localhost |  mcshadow |  localhost |  mike |  0 |  root @ localhost |  2011-08-17 01:30:35 |
 + ----------- + ---------- + ----------------- + -------- ------ + ------------ + ---------------- + ------------- -------- +
</pre><br>  That's all - now you can log in to the database using your account as root or any other user to whom proxying is allowed.  As can be seen from the table, you can still set <b>with grant option</b> , but purely IMHO, this is already superfluous. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Conclusion </h4><br>  While the solution is certainly damp, for it is not clear what works and what does not.  For example, everything that I tried worked for me, but I don‚Äôt have full confidence in it yet.  For more understanding, you can read the listing unit tests - <b>plugin_auth.result</b> , which as it turns out is in the samples in the daddy <b>mysql-test \ r</b> (thanks for the hint <a href="http://habrahabr.ru/users/svetasmirnova/" class="user_link">svetasmirnova</a> ), but in general very little information on the topic <b>GRANT PROXY</b> .  Following the results of these works, we made <b>diff -Nur</b> and collect RPM - we will try to drive this solution (after <b>review by</b> real programmers) on an industrial database.  I hope not let you down (pah-pah-pah). <br>  Learn!  Join now!  Share your experience! </div><p>Source: <a href="https://habr.com/ru/post/126519/">https://habr.com/ru/post/126519/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../126513/index.html">Changes in accounting for Google Analytics sessions</a></li>
<li><a href="../126514/index.html">Facebook TOS (terms of service) in human English</a></li>
<li><a href="../126515/index.html">Microsoft has created a blog about Windows 8</a></li>
<li><a href="../126517/index.html">Quarter installation</a></li>
<li><a href="../126518/index.html">Multifox for Firefox: go to the same site under different logins</a></li>
<li><a href="../126521/index.html">Patents are popular. Part 2</a></li>
<li><a href="../126522/index.html">My personal look at the Friendly URL and its automation</a></li>
<li><a href="../126523/index.html">No Higgs is good Higgs! - What if there is no Higgs boson?</a></li>
<li><a href="../126525/index.html">Some practice in Codebase</a></li>
<li><a href="../126527/index.html">13 Stanford University Free Courses</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>