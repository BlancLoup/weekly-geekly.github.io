<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Logger with member functions that do not exist</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I had in one project a class wrapper over log4cpp. One day I decided that I no longer like its interface, I decided to redo it a bit, then I redid a l...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Logger with member functions that do not exist</h1><div class="post__text post__text-html js-mediator-article">  I had in one project a class wrapper over log4cpp.  One day I decided that I no longer like its interface, I decided to redo it a bit, then I redid a little more.  Then the thought came to me, why not use generic programming?  And then it started to turn around ... and all I needed was a variable logging behavior, that is, output to the screen or to a file or somewhere else depending on the type selected. <br><br><a name="habracut"></a><br>  Choosing the right log option, it seemed to me, is better done through policy. <br><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LogFile</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LogConsole</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LogStream</span></span></span></span></code> </pre> <br><br>  The log class is inherited from one of these policies. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LogType</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Logger</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> &lt;LogType&gt;</code> </pre><br><br>  Classes themselves that determine the behavior of the logger <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LogConsole</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_log</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(log4cpp::LoggingEvent ev)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span>&lt;&lt;ev.timeStamp.getSeconds()&lt;&lt;<span class="hljs-string"><span class="hljs-string">" "</span></span> &lt;&lt;log4cpp::Priority::getPriorityName(ev.priority)&lt;&lt;<span class="hljs-string"><span class="hljs-string">" "</span></span> &lt;&lt;ev.categoryName&lt;&lt;<span class="hljs-string"><span class="hljs-string">" "</span></span>&lt;&lt;ev.ndc&lt;&lt;<span class="hljs-string"><span class="hljs-string">": "</span></span>&lt;&lt;ev.message&lt;&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; } };</code> </pre><br><br>  This class simply displays messages on the screen.  There is little use for log4cpp, well, just a little log4cpp :: LoggingEvent. <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LogStream</span></span></span><span class="hljs-class"> :</span></span> SipAppender&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">ostringstream</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-function"><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_buffer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _w.str(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_clear</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ _w.str(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_log</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(log4cpp::LoggingEvent ev)</span></span></span><span class="hljs-function"> </span></span>{ appender.doAppend(ev); } };</code> </pre><br><br>  The class works with ostringstream, displays nothing on the screen, displays messages on demand, by calling the do_buffer function. <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LogFile</span></span></span><span class="hljs-class"> :</span></span> SipAppender&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::ofstream&gt; { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: LogFile() { _w.open(<span class="hljs-string"><span class="hljs-string">"SIP_LOG.txt"</span></span>); } ~LogFile() { _w.close(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_log</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(log4cpp::LoggingEvent ev)</span></span></span><span class="hljs-function"> </span></span>{ appender.doAppend(ev); } };</code> </pre><br><br>  The class adds events to a file, when creating such a log, the file must be created, when destroying the logger, the file must be closed, all this is described in the constructor and destructor, respectively. <br>  One, detail, all function names begin with do_. <br><br>  Since our classes are in fact wrappers over log4cpp, some must inherit from Appender, which contain a stream and an object that adds events to this stream, Appender provides these objects to the heir. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Writer</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SipAppender</span></span></span><span class="hljs-class"> {</span></span> Writer _w; log4cpp::OstreamAppender appender; SipAppender() : appender(log4cpp::OstreamAppender(<span class="hljs-string"><span class="hljs-string">"logger"</span></span>, &amp;_w)){} };</code> </pre><br><br>  Now directly a class of a roger  Let it be singleton.  Simplest.  Especially since c ++ 11 gives us this opportunity. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LogType</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Logger</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> &lt;LogType&gt; { DEFAULT_FUNC(do_buffer) DEFAULT_FUNC(do_clear) Logger() = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Logger&amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">instance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Logger theSingleInstance; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> theSingleInstance; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">log</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(log4cpp::Priority::PriorityLevel p, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;msg)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;do_log(log4cpp::LoggingEvent(<span class="hljs-string"><span class="hljs-string">"CATEGORY"</span></span>,msg,<span class="hljs-string"><span class="hljs-string">"NDC"</span></span>,p)); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">debug</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ¬∂m)</span></span></span></span>{ instance().<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>(log4cpp::Priority::DEBUG, param); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">info</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ¬∂m)</span></span></span></span>{ instance().<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>(log4cpp::Priority::INFO, param); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ¬∂m)</span></span></span></span>{ instance().<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>(log4cpp::Priority::ERROR, param); } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-function"><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buffer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _do_buffer&lt;Logger&gt;::_do(&amp;instance(), [](){<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>();}); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clear</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ _do_clear&lt;Logger&gt;::_do(&amp;instance(), []()-&gt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>{}); } Logger&amp; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>=(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Logger&amp;) = <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span>; };</code> </pre><br><br>  Here is all that is needed for proper functioning.  The instance function is declared private, because the first is that I don‚Äôt want to give access to the logger object itself, and I don‚Äôt want to write when instance is called. <br>  The benefit of the interface is small, all functions can be made static. <br><br>  With the functions debug, info, error everything is clear, they call instance, log with priority and message. <br>  In the functions buffer and clear there is a certain anomaly, as you may have noticed, it is associated with the macros DEFAULT_FUNC. <br>  The idea is that buffer (outputting the contents of the log buffer) should call the base class do_buffer.  The problem is that not every class has corresponding functions. <br>  It would probably be possible to solve the problem with the help of another class, with the corresponding virtual functions, and inherit policy from it, but I didn‚Äôt want to carry an additional interface behind all the-policy classes. <br>  Moreover, if the functions are logically unrelated, it is strange to push them into one interface.  One way or another, it was decided to write a macro that would define a structure that would resolve the question of the existence of a function in a class. <br><br>  Macro itself <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DEFAULT_FUNC(name) \ template</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;class T, class Enable = void&gt; \ struct _##name \ { \ template&lt;class DF&gt; \ static auto _do(T *, DF df) -&gt; decltype(df()) { return df(); } \ template&lt;class DF&gt; \ static auto _do(const T *, DF df) -&gt; decltype(df()) { return df(); } \ }; \ template&lt;class T&gt; \ struct _##name &lt;T, typename std::enable_if&lt;std::is_member_function_pointer&lt;decltype(&amp;T::name)&gt;::value&gt;::type &gt; \ { \ template&lt;class DF&gt; \ static auto _do(T *obj, DF df) -&gt; decltype(df()) { (void)(df); return obj-&gt;name(); } \ template&lt;class DF&gt; \ static auto _do(const T *obj, DF df) -&gt; decltype(df()) { (void)(df); return obj-&gt;name(); } \ };</span></span></span></span></code> </pre><br><br>  As you can see, here the structure is defined using the SFINAE structure _ ## name (for the do_buffer function, the structure is called _do_buffer), if the name function is a member function T, then a second structure is defined that honestly performs this function for the object T, which is passed in the static function _do . <br>  The function‚Äôs belonging to the class T defines std :: is_member_function_pointer &lt;decltype (&amp; T :: name)&gt;.  Magic. <br>  If the function does not belong to the class, then the functor is executed, which is passed in the same _do function. <br>  The function is overloaded for the case if the object T is transmitted constant.  Having a little experimented, stopped on such option. <br><br>  Thus, it can protect against annoying compilation errors, if the necessary function is suddenly not found in the template base class.  And ensures the compatibility of the logging algorithm, if I need to suddenly change the output method. <br><br>  For example, for such a code: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> TestType = LogConsole; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Logger&lt;TestType&gt;::info(<span class="hljs-string"><span class="hljs-string">"Start log"</span></span>); Logger&lt;TestType&gt;::error(<span class="hljs-string"><span class="hljs-string">"Middle log"</span></span>); Logger&lt;TestType&gt;::debug(<span class="hljs-string"><span class="hljs-string">"End log"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span>&lt;&lt;Logger&lt;TestType&gt;::buffer()&lt;&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; Logger&lt;TestType&gt;::clear(); <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span>&lt;&lt;<span class="hljs-string"><span class="hljs-string">"clear: "</span></span>&lt;&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span>&lt;&lt;Logger&lt;TestType&gt;::buffer()&lt;&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre><br><br>  It is guaranteed that it will work at any TestType. <br>  Also, traditionally I will say that this code suits me so far, but perhaps there is a more elegant way. <br><br>  <b>UPD</b> <br>  Due to the critical assessment of readers, it became obvious that the method is not perfect, the macro does not take into account the existence of overloaded functions and arguments.  It made me change the code a bit. <br><br>  A separate macro for simple functions without an argument. <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> D_FUNC_VOID(name) \ template</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;class S, class R, class DEnable = void&gt; \ struct __##name \ { \ template&lt;class DF&gt; \ static R _do(S *, DF df) { return df(); } \ template&lt;class DF&gt; \ static R _do(const S *, DF df) { return df(); } \ }; \ template&lt;class S, class R&gt; \ struct __##name &lt;S, R, typename std::enable_if&lt;std::is_same&lt;std::decltype(declval&lt;S&gt;().name()), R&gt;::value&gt;::type &gt; \ { \ template&lt;class DF&gt; \ static R _do(S *obj, DF df) { (void)(df); return obj-&gt;name(); } \ template&lt;class DF&gt; \ static R _do(const S *obj, DF df) { (void)(df); return obj-&gt;name(); } \ };</span></span></span></span></code> </pre><br><br>  Separately for functions with an argument <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> D_FUNC_ARG(name) \ template</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;class S, class A, class R, class DEnable = void&gt; \ struct __##name \ { \ template&lt;class DF&gt; \ static R _do(S *, A a, DF df) { return df(a); } \ template&lt;class DF&gt; \ static R _do(const S *, A a, DF df) { return df(a); } \ }; \ template&lt;class S, class A, class R&gt; \ struct __##name &lt;S, A, R, typename std::enable_if&lt;std::is_same&lt;decltype(std::declval&lt;S&gt;().name(std::declval&lt;A&gt;())), R&gt;::value&gt;::type&gt; \ { \ template&lt;class DF&gt; \ static R _do(S *obj, A a, DF df) { (void)(df); return obj-&gt;name(a); } \ template&lt;class DF&gt; \ static R _do(const S *obj, A a, DF df) { (void)(df); return obj-&gt;name(a); } \ };</span></span></span></span></code> </pre><br><br>  General macro to determine which function to call. <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> D_FUNC(name) \ template</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;class T, class Arg = void, class Ret = void, class Enable = void&gt; \ struct _##name \ { \ D_FUNC_ARG(name) \ template&lt;class DF&gt; \ static Ret _do(T *obj, Arg a, DF df) { return __##name&lt;T, Arg, Ret&gt;::_do(obj, a, df); } \ }; \ template &lt;class T, class Arg, class Ret&gt; \ struct _##name&lt;T, Arg, Ret, typename std::enable_if&lt;std::is_void&lt;Arg&gt;::value&gt;::type&gt; \ { \ D_FUNC_VOID(name) \ template&lt;class DF&gt; \ static Ret _do(T *obj, DF df) { (void)(df); return __##name&lt;T, Ret&gt;::_do(obj, df); } \ };</span></span></span></span></code> </pre><br><br>  Due to this, all functions that must be ‚Äúprotected‚Äù are substituted into the macro D_FUNC. <br><br>  Then such calls are possible. <br><pre> <code class="cpp hljs">_do_log&lt;Logger, log4cpp::LoggingEvent&gt;::_do(&amp;instance(), log4cpp::LoggingEvent(<span class="hljs-string"><span class="hljs-string">"CATEGORY"</span></span>,msg,<span class="hljs-string"><span class="hljs-string">"NDC"</span></span>,p), [](log4cpp::LoggingEvent){}); _do_buffer&lt;Logger, <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt;::_do(&amp;instance(), [](<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>();});</code> </pre><br>  Yes, indeed, this is a very simple example for using this hell, but the interest was whether it was possible to realize this possibility. <br><br>  <b>UPD</b> <br>  With the most recent changes (D_FUNC), this would be the Logger class. <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LogType</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Logger</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> LogType { D_FUNC(do_clear) D_FUNC(do_buffer) D_FUNC(do_log) Logger() = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Logger&amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">instance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Logger theSingleInstance; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> theSingleInstance; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">log</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(log4cpp::Priority::PriorityLevel p, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;msg)</span></span></span><span class="hljs-function"> </span></span>{ _do_log&lt;Logger, log4cpp::LoggingEvent&gt;::_do(&amp;instance(), log4cpp::LoggingEvent(<span class="hljs-string"><span class="hljs-string">"CATEGORY"</span></span>,msg,<span class="hljs-string"><span class="hljs-string">"NDC"</span></span>,p), [](log4cpp::LoggingEvent){}); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">debug</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ¬∂m)</span></span></span></span>{ instance().<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>(log4cpp::Priority::DEBUG, param); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">info</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ¬∂m)</span></span></span></span>{ instance().<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>(log4cpp::Priority::INFO, param);} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ¬∂m)</span></span></span></span>{ instance().<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>(log4cpp::Priority::ERROR, param);} <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-function"><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buffer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _do_buffer&lt;Logger, <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt;::_do(&amp;instance(), [](){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>();}); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clear</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ _do_clear&lt;Logger&gt;::_do(&amp;instance(), [](){}); } Logger&amp; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>=(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Logger&amp;) = <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span>; Logger(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Logger&amp;) = <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span>; };</code> </pre></div><p>Source: <a href="https://habr.com/ru/post/242869/">https://habr.com/ru/post/242869/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../242851/index.html">The process of constant change in the company - how it is automated</a></li>
<li><a href="../242857/index.html">Announced reports of the conference. NEXT 2014 Moscow</a></li>
<li><a href="../242861/index.html">Creative card file</a></li>
<li><a href="../242863/index.html">PowerShell Web Access: manage servers from a browser</a></li>
<li><a href="../242865/index.html">Installing, configuring and using the rkhunter server vulnerability scanner</a></li>
<li><a href="../242875/index.html">FAQ on the conference. NEXT 2014 Moscow</a></li>
<li><a href="../242877/index.html">Go turned 5 years old</a></li>
<li><a href="../242879/index.html">Running Terminal Server for 1C Applications on Synology NAS</a></li>
<li><a href="../242881/index.html">Bestsellers O'Reilly</a></li>
<li><a href="../242883/index.html">What is better for a startup: Vietnam or Thailand?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>