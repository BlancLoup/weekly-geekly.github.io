<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>New approaches to validation in Rails 3</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 As you already know from the post of Comrade. Yehuda Katz on ActiveModel abstraction , in Rails 3.0, ActiveRecord now contains some asp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>New approaches to validation in Rails 3</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  As you already know from the post of Comrade.  Yehuda Katz on <a href="http://yehudakatz.com/2010/01/10/activemodel-make-any-ruby-object-feel-like-activerecord/">ActiveModel abstraction</a> , in Rails 3.0, ActiveRecord now contains some aspects of ActiveModel, including validation modules. <br><br>  And before we begin, let's remember what validation methods we already have: <ul><li> <code>validates_acceptance_of validates_associated validates_confirmation_of validates_each validates_exclusion_of validates_format_of validates_inclusion_of validates_length_of validates_numericality_of validates_presence_of validates_size_of validates_uniqueness_of</code> </li> <li> <code>validates_acceptance_of validates_associated validates_confirmation_of validates_each validates_exclusion_of validates_format_of validates_inclusion_of validates_length_of validates_numericality_of validates_presence_of validates_size_of validates_uniqueness_of</code> </li> <li> <code>validates_acceptance_of validates_associated validates_confirmation_of validates_each validates_exclusion_of validates_format_of validates_inclusion_of validates_length_of validates_numericality_of validates_presence_of validates_size_of validates_uniqueness_of</code> </li> <li> <code>validates_acceptance_of validates_associated validates_confirmation_of validates_each validates_exclusion_of validates_format_of validates_inclusion_of validates_length_of validates_numericality_of validates_presence_of validates_size_of validates_uniqueness_of</code> </li> <li> <code>validates_acceptance_of validates_associated validates_confirmation_of validates_each validates_exclusion_of validates_format_of validates_inclusion_of validates_length_of validates_numericality_of validates_presence_of validates_size_of validates_uniqueness_of</code> </li> <li> <code>validates_acceptance_of validates_associated validates_confirmation_of validates_each validates_exclusion_of validates_format_of validates_inclusion_of validates_length_of validates_numericality_of validates_presence_of validates_size_of validates_uniqueness_of</code> </li> <li> <code>validates_acceptance_of validates_associated validates_confirmation_of validates_each validates_exclusion_of validates_format_of validates_inclusion_of validates_length_of validates_numericality_of validates_presence_of validates_size_of validates_uniqueness_of</code> </li> <li> <code>validates_acceptance_of validates_associated validates_confirmation_of validates_each validates_exclusion_of validates_format_of validates_inclusion_of validates_length_of validates_numericality_of validates_presence_of validates_size_of validates_uniqueness_of</code> </li> <li> <code>validates_acceptance_of validates_associated validates_confirmation_of validates_each validates_exclusion_of validates_format_of validates_inclusion_of validates_length_of validates_numericality_of validates_presence_of validates_size_of validates_uniqueness_of</code> </li> <li> <code>validates_acceptance_of validates_associated validates_confirmation_of validates_each validates_exclusion_of validates_format_of validates_inclusion_of validates_length_of validates_numericality_of validates_presence_of validates_size_of validates_uniqueness_of</code> </li> <li> <code>validates_acceptance_of validates_associated validates_confirmation_of validates_each validates_exclusion_of validates_format_of validates_inclusion_of validates_length_of validates_numericality_of validates_presence_of validates_size_of validates_uniqueness_of</code> </li> <li> <code>validates_acceptance_of validates_associated validates_confirmation_of validates_each validates_exclusion_of validates_format_of validates_inclusion_of validates_length_of validates_numericality_of validates_presence_of validates_size_of validates_uniqueness_of</code> </li> </ul>  All of them are still operational, but Rails 3 offers some new, great alternatives. <br><a name="habracut"></a><br><h4>  New <code>validate</code> method </h4><br>  The <code>validate</code> method accepts an attribute and a hash with validation options.  This means that now the usual validation can be written like this: <br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Person &lt; ActiveRecord::Base validates :email, :presence =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  The options that can be passed are the following: <ul><li> <code>:acceptance =&gt; Boolean :confirmation =&gt; Boolean :exclusion =&gt; { :in =&gt; Ennumerable } :inclusion =&gt; { :in =&gt; Ennumerable } :format =&gt; { :with =&gt; Regexp } :length =&gt; { :minimum =&gt; Fixnum, maximum =&gt; Fixnum, } :numericality =&gt; Boolean :presence =&gt; Boolean :uniqueness =&gt; Boolean</code> </li> <li> <code>:acceptance =&gt; Boolean :confirmation =&gt; Boolean :exclusion =&gt; { :in =&gt; Ennumerable } :inclusion =&gt; { :in =&gt; Ennumerable } :format =&gt; { :with =&gt; Regexp } :length =&gt; { :minimum =&gt; Fixnum, maximum =&gt; Fixnum, } :numericality =&gt; Boolean :presence =&gt; Boolean :uniqueness =&gt; Boolean</code> </li> <li> <code>:acceptance =&gt; Boolean :confirmation =&gt; Boolean :exclusion =&gt; { :in =&gt; Ennumerable } :inclusion =&gt; { :in =&gt; Ennumerable } :format =&gt; { :with =&gt; Regexp } :length =&gt; { :minimum =&gt; Fixnum, maximum =&gt; Fixnum, } :numericality =&gt; Boolean :presence =&gt; Boolean :uniqueness =&gt; Boolean</code> </li> <li> <code>:acceptance =&gt; Boolean :confirmation =&gt; Boolean :exclusion =&gt; { :in =&gt; Ennumerable } :inclusion =&gt; { :in =&gt; Ennumerable } :format =&gt; { :with =&gt; Regexp } :length =&gt; { :minimum =&gt; Fixnum, maximum =&gt; Fixnum, } :numericality =&gt; Boolean :presence =&gt; Boolean :uniqueness =&gt; Boolean</code> </li> <li> <code>:acceptance =&gt; Boolean :confirmation =&gt; Boolean :exclusion =&gt; { :in =&gt; Ennumerable } :inclusion =&gt; { :in =&gt; Ennumerable } :format =&gt; { :with =&gt; Regexp } :length =&gt; { :minimum =&gt; Fixnum, maximum =&gt; Fixnum, } :numericality =&gt; Boolean :presence =&gt; Boolean :uniqueness =&gt; Boolean</code> </li> <li> <code>:acceptance =&gt; Boolean :confirmation =&gt; Boolean :exclusion =&gt; { :in =&gt; Ennumerable } :inclusion =&gt; { :in =&gt; Ennumerable } :format =&gt; { :with =&gt; Regexp } :length =&gt; { :minimum =&gt; Fixnum, maximum =&gt; Fixnum, } :numericality =&gt; Boolean :presence =&gt; Boolean :uniqueness =&gt; Boolean</code> </li> <li> <code>:acceptance =&gt; Boolean :confirmation =&gt; Boolean :exclusion =&gt; { :in =&gt; Ennumerable } :inclusion =&gt; { :in =&gt; Ennumerable } :format =&gt; { :with =&gt; Regexp } :length =&gt; { :minimum =&gt; Fixnum, maximum =&gt; Fixnum, } :numericality =&gt; Boolean :presence =&gt; Boolean :uniqueness =&gt; Boolean</code> </li> <li> <code>:acceptance =&gt; Boolean :confirmation =&gt; Boolean :exclusion =&gt; { :in =&gt; Ennumerable } :inclusion =&gt; { :in =&gt; Ennumerable } :format =&gt; { :with =&gt; Regexp } :length =&gt; { :minimum =&gt; Fixnum, maximum =&gt; Fixnum, } :numericality =&gt; Boolean :presence =&gt; Boolean :uniqueness =&gt; Boolean</code> </li> <li> <code>:acceptance =&gt; Boolean :confirmation =&gt; Boolean :exclusion =&gt; { :in =&gt; Ennumerable } :inclusion =&gt; { :in =&gt; Ennumerable } :format =&gt; { :with =&gt; Regexp } :length =&gt; { :minimum =&gt; Fixnum, maximum =&gt; Fixnum, } :numericality =&gt; Boolean :presence =&gt; Boolean :uniqueness =&gt; Boolean</code> </li> </ul>  What gives a vast area of ‚Äã‚Äãvery simple, short options for certain attributes, providing the opportunity to write all the necessary validations in one place. <br><br>  For example, if you need to check the name and email, you can do this: <br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">User</span></span> &lt; ActiveRecord::Base validates :<span class="hljs-type"><span class="hljs-type">name</span></span>, :presence =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, :length =&gt; {:minimum =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, :maximum =&gt; <span class="hljs-number"><span class="hljs-number">254</span></span>} validates :email, :presence =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, :length =&gt; {:minimum =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, :maximum =&gt; <span class="hljs-number"><span class="hljs-number">254</span></span>}, :uniqueness =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, :<span class="hljs-keyword"><span class="hljs-keyword">format</span></span> =&gt; {:<span class="hljs-keyword"><span class="hljs-keyword">with</span></span> =&gt; /^([^@\s]+)@((?:[-a-z0<span class="hljs-number"><span class="hljs-number">-9</span></span>]+\.)+[az]{<span class="hljs-number"><span class="hljs-number">2</span></span>,})$/i} <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre>  Thus, now you can immediately look at the model to see which validations are attached for each attribute - that there is a small victory for the code and readability :) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Fetching familiar usage scenarios </h4><br>  However, write <code>:format =&gt; {:with =&gt; EmailRegexp}</code> , a bit heavy to write it in several places, which suggests the idea of ‚Äã‚Äãcreating reusable validation, which could be applied to other models. <br><br>  Let's go further - what if you need to use a much more expressive regular expression, consisting of more than a few characters, to show how cool you can google?  :) <br><br>  Well, validations can be written by hand.  First, create an <code>email_validator.rb</code> file in the <code>lib</code> directory, in the depths of our application: <br><pre> <code class="hljs tex"># lib/email_validator.rb class EmailValidator &lt; ActiveModel::EachValidator EmailAddress = begin qtext = '[^<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span></span>x0d<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span></span>x22<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span></span>x5c<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span></span>x80-<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span></span>xff]' dtext = '[^<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span></span>x0d<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span></span>x5b-<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span></span>x5d<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span></span>x80-<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span></span>xff]' atom = '[^<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span></span>x00-<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span></span>x20<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span></span>x22<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span></span>x28<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span></span>x29<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span></span>x2c<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span></span>x2e<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span></span>x3a-' + '<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span></span>x3c<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span></span>x3e<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span></span>x40<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span></span>x5b-<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span></span>x5d<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span></span>x7f-<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span></span>xff]+' quoted_pair = '<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span></span>x5c[<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span></span>x00-<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span></span>x7f]' domain_literal = "<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span></span>x5b(?:#{dtext}|#{quoted_pair})*<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span></span>x5d" quoted_string = "<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span></span>x22(?:#{qtext}|#{quoted_pair})*<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span></span>x22" domain_ref = atom sub_domain = "(?:#{domain_ref}|#{domain_literal})" word = "(?:#{atom}|#{quoted_string})" domain = "#{sub_domain}(?:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span></span>x2e#{sub_domain})*" local_part = "#{word}(?:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span></span>x2e#{word})*" addr_spec = "#{local_part}<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span></span>x40#{domain}" pattern = /<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">A</span></span></span></span>#{addr_spec}<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">z</span></span></span></span>/ end def validate_each(record, attribute, value) unless value =~ EmailAddress record.errors[attribute] &lt;&lt; (options[:message] || " ") end end end</code> </pre><br>  Since each file from the <code>lib</code> directory is loaded automatically, and since our validator inherits from the <code>ActiveModel::EachValidator</code> , our class name is used as a dynamic validator that can be used in any object that has access to <code>ActiveModel::Validations</code> .  Ie, for example, these are all objects of ActiveRecord. <br><br>  The name of the dynamic validator is all that is to the left of the word Validator, reduced to lower case. <br><br>  Thus, our <code>User</code> class will now look like this: <br><pre> <code class="hljs kotlin"># app/models/person.rb <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class"> &lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type"> ActiveRecord::Base validates :name, :presence =</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">true</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">:length =&gt; {:minimum =&gt; 1</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">:maximum =&gt; 254} validates :email</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">:presence =&gt; true</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">:length =&gt; {:minimum =&gt; 3</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">:maximum =&gt; 254}</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">:uniqueness =&gt; true</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">:email =&gt; true end</span></span></span></span></code> </pre><br>  Notice <code>:email =&gt; true</code> ?  So much easier, but most importantly - now it can be used anywhere! <br><br>  And now in the console we will see something like the following (with our own message ‚Äúnot correct‚Äù): <br><pre> <code class="hljs pgsql">$ ./script/console Loading development environment (Rails <span class="hljs-number"><span class="hljs-number">3.0</span></span>.pre) ?&gt; u = <span class="hljs-keyword"><span class="hljs-keyword">User</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">new</span></span>(:<span class="hljs-type"><span class="hljs-type">name</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Mikel'</span></span>, :email =&gt; <span class="hljs-string"><span class="hljs-string">'bob'</span></span>) =&gt; #&lt;<span class="hljs-keyword"><span class="hljs-keyword">User</span></span> id: nil, <span class="hljs-type"><span class="hljs-type">name</span></span>: "Mikel", email: "bob", created_at: nil, updated_at: nil&gt; &gt;&gt; u.<span class="hljs-keyword"><span class="hljs-keyword">valid</span></span>? =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> &gt;&gt; u.errors =&gt; #&lt;OrderedHash {:email=&gt;[" "]}&gt;</code> </pre><br><h4>  Validations for classes </h4><br>  And what if, say, there are three different models ( <code>user</code> , <code>visitor</code> and <code>customer</code> ), each of which must use general validations.  In this case, replacing <code>validates</code> with <code>validates_with</code> , we just have to do this: <br><pre> <code class="hljs pgsql"># app/models/person.rb <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">User</span></span> &lt; ActiveRecord::Base validates_with HumanValidator <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> # app/models/person.rb <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Visitor &lt; ActiveRecord::Base validates_with HumanValidator <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> # app/models/person.rb <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Customer &lt; ActiveRecord::Base validates_with HumanValidator <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  And put the file in the <code>lib</code> directory: <br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> HumanValidator &lt; ActiveModel::<span class="hljs-keyword"><span class="hljs-keyword">Validator</span></span> def <span class="hljs-keyword"><span class="hljs-keyword">validate</span></span>(<span class="hljs-type"><span class="hljs-type">record</span></span>) <span class="hljs-type"><span class="hljs-type">record</span></span>.errors[:base] &lt;&lt; "This person is dead" unless <span class="hljs-keyword"><span class="hljs-keyword">check</span></span>(human) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> private def <span class="hljs-keyword"><span class="hljs-keyword">check</span></span>(<span class="hljs-type"><span class="hljs-type">record</span></span>) (<span class="hljs-type"><span class="hljs-type">record</span></span>.age &lt; <span class="hljs-number"><span class="hljs-number">200</span></span>) &amp;&amp; (<span class="hljs-type"><span class="hljs-type">record</span></span>.age &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  And check on, clearly far-fetched, an example: <br><pre> <code class="hljs go">$ ./script/console Loading development environment (Rails <span class="hljs-number"><span class="hljs-number">3.0</span></span>.pre) &gt;&gt; u = User.<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> =&gt; #&lt;User id: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, name: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, email: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, created_at: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, updated_at: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>&gt; &gt;&gt; u.valid? =&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> &gt;&gt; u.errors =&gt; #&lt;OrderedHash {:base=&gt;[<span class="hljs-string"><span class="hljs-string">"This person is dead"</span></span>]}&gt;</code> </pre><br><h4>  Time triggers </h4><br>  As expected, each validation can take the following sub-options: <br><ul><li> <code>:on :if :unless :allow_blank :allow_nil</code> </li> <li> <code>:on :if :unless :allow_blank :allow_nil</code> </li> <li> <code>:on :if :unless :allow_blank :allow_nil</code> </li> <li> <code>:on :if :unless :allow_blank :allow_nil</code> </li> <li> <code>:on :if :unless :allow_blank :allow_nil</code> </li> </ul>  Each of which can accept a call to an arbitrary method.  In this way: <br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Person &lt; ActiveRecord::Base validates :post_code, :presence =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, :unless =&gt; :no_postcodes? def no_postcodes? <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [<span class="hljs-string"><span class="hljs-string">'TW'</span></span>].<span class="hljs-keyword"><span class="hljs-keyword">include</span></span>?(country_iso) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre>  This will probably be enough to make a first impression about the new level of flexibility. </div><p>Source: <a href="https://habr.com/ru/post/82841/">https://habr.com/ru/post/82841/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../82832/index.html">The eternal question of measuring time</a></li>
<li><a href="../82834/index.html">Reasoning on authentication</a></li>
<li><a href="../82838/index.html">OreObject sells a steel touch ball mouse for $ 155</a></li>
<li><a href="../82839/index.html">Speed ‚Äã‚ÄãReading featuring Text Perception</a></li>
<li><a href="../82840/index.html">Time synchronization via http</a></li>
<li><a href="../82842/index.html">TDD for beginners. Answers to popular questions</a></li>
<li><a href="../82845/index.html">ColorNote. Android application for notes</a></li>
<li><a href="../82846/index.html">Hitachi, Panasonic and Toshiba will delight with new wireless devices</a></li>
<li><a href="../82847/index.html">MythBusters: Truth and Fiction about Flash</a></li>
<li><a href="../82852/index.html">Following the results of the second Minsk StartUp Weekend</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>