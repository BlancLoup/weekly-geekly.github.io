<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Persistent Structures, Part 1: Persistent Stack</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I noticed that there were a lot of posts on Habr√© about such classic data structures as stack, queue, hip; a segment tree and many different search tr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Persistent Structures, Part 1: Persistent Stack</h1><div class="post__text post__text-html js-mediator-article">  I noticed that there were a lot of posts on Habr√© about such classic data structures as stack, queue, hip;  a segment tree and many different search trees were also considered, but very little attention was paid to persistent data structures.  In this series of articles, I would like to talk about them.  It so happened that I have been engaged in Olympiad programming for a long time, so I will consider them from the point of view of my experience with the use of persistent structures in this area. <br><a name="habracut"></a><br>  By persistent data structures, we will call such structures that, with any change, there remains access to all previous versions of this structure.  Obviously, one of the options (not the best, of course) can be considered a complete copy of the entire structure with each change.  This is extremely inefficient both in memory and in operation time, but this method can be applied for example at the testing stage of a more complex organization of structure.  Nevertheless, there is little sense from such an implementation, so further we, among other things, will search for more optimal implementations for various structures. <br><br>  Today we look at the implementation and use of the persistent stack.  In subsequent articles, I will talk about the persistent queue, the Cartesian tree and the segment tree, and we will also examine a couple of problems that we will solve using these persistent structures. <br><br><h3>  Persistent stack </h3><br>  <b>Formulation of the problem.</b>  Initially, there is one empty stack with the number 0, n (the number of stacks) initially equal to one.  You are required to implement the following operations: <br><ul><li>  push (i, x) - Add item x to stack i.  The resulting stack will be n + 1. </li><li>  pop (i) - Return the last element of the stack number i and "throw it out of the stack."  The resulting stack will be n + 1. </li></ul><br>  Simply put, after each operation, you need to create a "new" stack without spoiling the old one. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Decision.</b>  The simplest and most obvious solution to this problem is the simulation of the described process, i.e.  honest stack copying at every operation.  Obviously, this is not the most effective solution.  The complexity of one operation is O (n) and the amount of required memory is O (n * n). <br><br>  In order to get closer to the idea of ‚Äã‚Äãan optimal solution, you can try to present the stack as a graph, where the vertex is its element, then from each vertex (except for the tail) let us insert an edge into the previous stack element.  An example for a stack in which '1', '2', '3', '4', '5' are added sequentially: <br><br><img src="https://habrastorage.org/storage/habraeffect/e7/db/e7db20bb2fe49932c18473170978e788.jpg"><br><br>  It is clear that in order to restore the entire stack it is enough for us to know the ‚Äúhead‚Äù of the stack.  Let's try instead of n copies of the stack to store the n first elements.  Then the push and pop operations will have the following form: <br><ul><li>  push (x, i) - creates a new element with the value x, which refers to the element with the number i as the previous element in the stack. </li><li>  pop (i) - returns the value stored in the element with the number i and copies the element previous to it. </li></ul><br><br>  Consider for clarity, the algorithm for example.  Suppose we initially have one empty stack.  For convenience, we will store it as a ‚Äúhead‚Äù with an empty stack: <br><img src="https://habrastorage.org/storage/habraeffect/b5/bb/b5bb212f3702e565498c4412e13242a7.jpg"><br><br>  Next, execute push (1, 5).  A new vertex is created with a value of 5, referring to the 1st: <br><img src="https://habrastorage.org/storage/habraeffect/61/2b/612b6fe1562242b3a455b2abb698dfc9.jpg"><br><br>  Similarly, we execute push (2, 10) and push (1, 6): <br><img src="https://habrastorage.org/storage/habraeffect/2b/eb/2beb71892fd79b675e095d5432827d03.jpg"><br><br>  Obviously, all 4 stacks are now correctly built and easily restored.  Let's now try to perform successively pop (2) and pop (3) operations: <br>  pop (2) returns 5 and copies the 1st vertex.  The resulting fifth stack is empty. <br><img src="https://habrastorage.org/storage/habraeffect/3a/b7/3ab7456751529d76c5f1392d5d3b5fcb.jpg"><br><br>  pop (3) returns 10 and copies the 2nd vertex: we get the sixth stack. <br><img src="https://habrastorage.org/storage/habraeffect/ec/ed/eced2ebbcee643d6c87576b0d3460785.jpg"><br><br>  Obviously, one request works for O (1) and O (n) memory is required in total, which is good news. <br><br>  <b>Application.</b>  As far as I remember, I encountered several tasks that can be solved using a persistent stack.  It is clear that, due to some primitiveness, these structures cannot be too complicated, but they exist nonetheless.  For example: <br><br>  N children take turns making snowmen.  The first child blinded a snowman from one ball with radius R1.  Each next child blinded the same snowman as the previous one, but after thinking a little bit he either added a ball with a radius Ri or destroyed the top, already existing ball.  It is guaranteed that all snowmen have a strictly positive number of balls.  Input data - N, information about each of the children about whether he destroyed the last ball, or added his own (then his radius is also given).  Next, a set of K numbers ranging from 1 to N is given, for each of them you need to output a sequence of balls in a snowman with that number.  Limit on N and K - million. <br><br>  After reading the section with the implementation of the persistent stack, the solution to this problem becomes obvious. <br><br>  <b>Conclusion</b>  Today we looked at a data structure such as a persistent stack and its effective implementation.  This was useful from the point of view of further understanding of other persistent structures and the principles of their implementation.  As already noted, in the next articles I plan to consider more complex structures, such as a persistent queue, a Cartesian tree, and a segment tree.  Structures are more complex - more complicated and more interesting are their implementation and solving problems with the help of them.  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/113585/">https://habr.com/ru/post/113585/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../113577/index.html">Stephen Elop responded to "turkeys"</a></li>
<li><a href="../113579/index.html">Canobuvosti, 78th edition</a></li>
<li><a href="../113580/index.html">Nokia + Microsoft. Here we go!</a></li>
<li><a href="../113581/index.html">This site is not available from your country. Cyber ‚Äã‚ÄãPins Peter compiles the tractor</a></li>
<li><a href="../113584/index.html">Testing Android Applications</a></li>
<li><a href="../113586/index.html">Subtle moments of C #</a></li>
<li><a href="../113587/index.html">How to trade stocks on NASDAQ</a></li>
<li><a href="../113588/index.html">Wolfram Mathematica: Acquaintance</a></li>
<li><a href="../113589/index.html">On the eve of the MWC 2011</a></li>
<li><a href="../113590/index.html">Finally!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>