<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Microsoft boosts Internet Explorer immunity to use-after-free attacks</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In our post on ASLR improvements in recent versions of Windows, a table with a list of Remote Code Execution vulnerabilities that attackers used to re...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Microsoft boosts Internet Explorer immunity to use-after-free attacks</h1><div class="post__text post__text-html js-mediator-article">  In our <a href="http://habrahabr.ru/company/eset/blog/206244/">post</a> on ASLR improvements in recent versions of Windows, a table with a list of Remote Code Execution vulnerabilities that attackers used to remotely install malicious code into the system (drive-by download) was provided.  More than half of these vulnerabilities are type t.  use-after-free (UAF).  UAF can be described as a convenient way for attackers to transfer control to their code.  In such a scheme, a legitimate executable code, such as the Internet Explorer browser, must contain incorrect logic for working with memory, which is that at some stage the code fragment accesses a pointer to that heap memory block that was already released earlier. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/475/447/2a5/4754472a5249d9a90e508adc21077da0.png"><br><br>  Obviously, such an error when working with memory can simply cause a crash of the browser, since it will be accessed by an invalid pointer.  However, in the case of an exploit, attackers use it for their own purposes in such a way as to force the vulnerable code to transfer control to the correct address.  As a rule, heap-spray is used for this, which contributes to reserving a large number of memory blocks at a predictable address on the heap with filling them with necessary instructions to the attacker.  In the <a href="http://habrahabr.ru/company/eset/blog/225903/">June</a> and <a href="http://habrahabr.ru/company/eset/blog/229171/">July</a> cumulative updates for the Internet Explorer 11 browser, Microsoft introduced additional mitigation technologies in the form of an isolated heap when allocating memory for objects and deferred release of memory blocks.  This approach will protect the browser code, which still may contain errors when working with memory, from the actions of exploits. <br><a name="habracut"></a><br>  Usually the logic of working with heap memory is as follows: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      1) the browser allocates a block of memory in the heap; <br>  2) uses it; <br>  3) releases. <br><br>  In the case of a bug in the code, working with memory can be: <br><br>  1) the browser allocates a block of memory in the heap; <br>  2) uses it; <br>  3) releases; <br>  4) repeatedly refers to this block by the pointer stored in the variable (for example, via vtable). <br><br>  The most common mock exploitation might look like this: <br><br>  1) the browser allocates a block of memory in the heap; <br>  2) uses it; <br>  3) releases; <br>  4) the user visits the web page with the exploit; <br>  5) the exploit performs spray heaps (for ASLR bypass) and fills the blocks with the necessary code (for example, shell code) or memory addresses (for the vulnerability to trigger); <br>  6) the exploit creates conditions for the situation of the browser code addressing by an invalid pointer, which is already valid, as clause 4; <br>  7) the browser re-accesses the pointer and transfers control to the memory block with unauthorized code (before this, <i>run the</i> exploit gadgets that disable DEP for the heap blocks via <i>ntdll! NtProtectVirtualMemory</i> ). <br><br>  In such a situation, to protect the vulnerable code from exploitation, a separate heap of memory can be used and the delayed release of memory from it.  Since the memory block will be released later, attackers will not be able to re-reserve this address.  Such a mechanism was introduced by Microsoft. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d3c/750/50a/d3c75050a8d03ac094017445c42a4cef.png"><br>  Fig.  Isolated heap memory allocation using the <i>CMarkup :: CreateInitialMarkup</i> method to initialize a CMarkup object, see <a href="http://www.zerodayinitiative.com/advisories/ZDI-14-140/">Microsoft Internet Explorer CMarkup Use-After-Free Remote Code Execution Vulnerability</a> .  Before <a href="https://technet.microsoft.com/library/security/ms14-035">MS14-035, the</a> allocation was made from a common heap of process memory. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/afd/efa/567/afdefa5671d9144b85bf2476faceac76.png"><br>  Fig.  July <a href="http://support.microsoft.com/kb/2975687">MS14-037</a> introduced a deferred release of memory blocks by the <i>MemoryProtection :: CMemoryProtector :: ProtectedFree</i> method, which does not perform the actual release of the block, but simply marks the necessary notes about it in the system data structure. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/673/2ed/31b/6732ed31be6215874bbb6c7f8d67bec5.png"><br>  Fig.  Methods that are responsible for implementing the deferred-release logic. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/161/b8f/065/161b8f065da6d05a75fd3b283e8922b1.png"><br>  Fig.  The <i>MemoryProtection :: CMemoryProtector :: ProtectedFree</i> method introduces deferred release of memory blocks of the isolated heap <i>_g_hIsolatedHeap</i> and the heap of the <i>_g_hProcessHeap</i> process <i>itself</i> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0a8/738/d12/0a8738d12642fca6f2816280d12b7091.png"><br>  Fig.  Delayed memory release is also used by the CTreeNode class, see <a href="http://habrahabr.ru/company/eset/blog/194184/">previous use of</a> use-after-free CVE-2013-3893. <br><br>  Thus, when working on up-to-date versions of Windows 8.1 x64 with Internet Explorer 11, the user has the necessary capabilities to prevent the exploitation of 0day vulnerabilities. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bb5/a36/90f/bb5a3690f7561d8c6a5e053e812640ad.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/630/ea0/2ba/630ea02babba6a158419be2f5f5bc392.jpg" alt="image"><br>  be secure. </div><p>Source: <a href="https://habr.com/ru/post/231003/">https://habr.com/ru/post/231003/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../230991/index.html">How to develop a cloud service: ensure smooth operation and add features</a></li>
<li><a href="../230993/index.html">Batch convert office documents to PDF, JPG, TIFF and PNG</a></li>
<li><a href="../230995/index.html">Android cipher / Simplocker aims for English-speaking users</a></li>
<li><a href="../230999/index.html">Linux games appeared on GOG.com</a></li>
<li><a href="../231001/index.html">Understanding the intricacies of BYOD policy is a serious plus for a summary.</a></li>
<li><a href="../231007/index.html">Achronix Plis - mastering experience</a></li>
<li><a href="../231009/index.html">Why block Google Play developers?</a></li>
<li><a href="../231011/index.html">Remote control and power device</a></li>
<li><a href="../231013/index.html">Summary of the preparation of pitch-performance</a></li>
<li><a href="../231015/index.html">Popularization of information security through cartoons</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>