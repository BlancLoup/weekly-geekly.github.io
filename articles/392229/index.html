<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Telemetry for racing. Part 1 - prototype</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Standing on the training ground at the marked track for moto jijhana (a type of motor sport that is gaining popularity), I watched how lap times were ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Telemetry for racing. Part 1 - prototype</h1><div class="post__text post__text-html js-mediator-article">  Standing on the training ground at the marked track for moto jijhana (a type of motor sport that is gaining popularity), I watched how lap times were measured on a stopwatch on a smartphone.  It is clear that accurate data is not obtained.  At home, there were several arduins, a couple of displays, and, it would seem, all that was needed to assemble automatic telemetry was to find a pair of suitable sensors that were triggered when the bike was passing.  So began many sleepless nights with a soldering iron, vim, dremel, and sometimes even a grinder. <br><br>  Looking ahead - everything turned out, the devices successfully worked on all three stages of the moto-jihhane [G] -RSBK championship, and are actively used during training.  Collected in the end were: <br><ul><li>  Check in controller </li><li>  sensors for the controller </li><li>  scoreboard </li><li>  referee panel </li></ul><br>  as well as something else! <br><br><img src="https://habrastorage.org/files/dde/9cc/4da/dde9cc4dac7a4c8082b01116890ffefe.jpg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Sensors were bought and after half an hour the prototype flashed on the display.  True, I was slightly mistaken in the belief that everything else would be enough for me for several evenings. <br><br><a name="habracut"></a><br><br>  The article does not have schemes in Fritzing - manuals on connecting sensors and displays on the network is complete, and there are no source codes - <s>(every self-respecting programmer still throws everything out and writes from scratch)</s> I think the interval between the signals from the two inputs will be all.  It turned out to be a much more interesting task with the help of available tools and tools to first assemble a prototype in a shoe box suitable for transportation, and later to bring it to near-production form. <br><br><blockquote>  Motodzhimkhana - a sport that consists in high-speed maneuvering on a motorcycle on the highway, marked by artificial obstacles.  Precise taxiing and braking, tilt angles with sparks carving steps on the asphalt, and moderate speeds make jimkhan both fascinating and fairly safe.  In addition, competitions are held on motorcycles suitable for driving on public roads, i.e.  no need to go on the track with a specially prepared bike in the trailer - the bike that you have is suitable. <br></blockquote><br><br>  At competitions, the race starts from the starting box, which is bounded by cones, and then the driveway along the track follows, and the finish line is also to the cones-limited box, located next to the start.  Sensors need two - the intersection of the start and the intersection of the finish.  So far it has been decided to note the time directly from the participant‚Äôs departure from the box, later on by a traffic light signal, and the sensor can be used to check the false start. <br><br>  Yes, entertainment adds pair runs in two identical tracks, which means that there should be two sets of equipment. <br><br><h5>  Sensors </h5><br>  After examining the range, I found and bought barrier optical beam crossing sensors, consisting of two modules - a radiator and a receiver.  A wide range of supply voltage - 6-36V, the signal from the sensor - NPN-output.  During tests in the room, they proved to be excellent - a range of several meters, good focusing of the beam, speed of response - within a millisecond. <br><br>  It is good, now you need to decide how to feed, strengthen and direct them.  All IT-shniki know that standards are good, therefore I will feed from 12V, and to fix and direct them - with standard photo supports. <br><br><h5>  Emitters </h5><br>  By a surprising coincidence, the size of the emitter coincided with the size of a standard 18650 battery. The solution came out on its own - take the case of autonomous charging!  I drilled a hole under the sensor beam in the end, added a mount on the photo pole for GoPro with a sawn top, a battery and a miniature boost DC-DC converter up to 12V.  The bonus is a bright green LED that illuminates a piece of silicone hose framing the hole for the beam, glowing when it is on. <br><br><img src="https://habrastorage.org/files/0d4/eb2/378/0d4eb2378f89428ab0548a87498ceeb3.JPG"><br><br>  The disadvantages of the design are the mass, even if one does not take into account the sequential double voltage boost of the DC-DC converters ‚Äî built-in up to 5V and soldered to 12V.  First, it is an active device, unstable to moisture and requiring charging.  Secondly, it turned out that the load from the radiator power supply is not enough, and after a minute the power-bank electronics is disconnected. <br><br>  After long trials and noting out some very hard options, I found a way out - find and replace the shunt resistor for current measurement, so that the board would consider that the connected device was not yet charged.  Intuition suggested that this resistor should be the largest on the board: <br><br><img src="https://habrastorage.org/files/8b3/693/750/8b36937504e648c3a2502eb3e0f7c3e4.JPG"><br><br>  It doesn't matter what the smd-resistance was then carefully soldered in: which is only suitable for charging phones. <br><br>  Nevertheless, there are several power-banks with the correct logic at hand - there is enough to create a working prototype.  Non-optimal energy consumption is also not critical - the battery lasted for two days of continuous operation. <br><br><h5>  Receivers </h5><br>  Knowing about the unreliable suppliers that change the scheme, the conclusion made - the more accessible and more common component, the better.  This means that the receivers will be in other buildings (initially the idea was to do everything inside the power-banks, and transmit data via radio to the controller with a display). <br><br>  Aluminum square profile, 6P4C phone jack, GoPro tripod mount, rivets, and lots of hot melt glue: <br><br><img src="https://habrastorage.org/files/ca5/a92/bcc/ca5a92bcca0648afa86525bfbfd09f2b.JPG"><br><br>  For forming hot melt cubes with components inside, I used a mandrel from a profile trimmer, lubricated with a silicone spray ‚Äî after solidification, the blank is pressed out with a light touch. <br><br>  In addition, for convenience of setting, two flashing LEDs fused into the cubes are connected to the sensor output: this way, when aiming the sensors, you can immediately see the status, despite the controller display. <br><br>  Mission accomplished - almost all components can be bought at the nearest hardware store!  As a result, the starting gate with the installed sensors on the simplest photo pegs looks like this: <br><br><img src="https://habrastorage.org/files/105/d69/442/105d694420294f08ab80103f4781cd59.jpg"><br><br><h5>  Controller </h5><br>  The controller is very simple - when the signal from the first sensor is received, the timer starts, from the second one it stops.  The time is displayed on the OLED-display and sent over the air using the module nRF24L01.  The circuit is also primitive - the display is connected with two wires on I2C, nRF24L01 - four wires via SPI, plus ground and power.  Signal wires from two sensors - through voltage dividers to two inputs with support for hardware interrupts. <br><br>  The first races are already on the way - with the prototype you need to hurry.  The case took the power bank which came to hand (this time with the hardware power button) on four banks.  The place of one battery will be occupied by the display from the front side, and the telephone connectors from the reverse: <br><br><img src="https://habrastorage.org/files/585/c4c/57f/585c4c57f69748e39ea8b07c6284911d.JPG"><br><br>  The place of the second battery is soldered on the Arduino Pro Mini PCB made by LUT, a radio module, and a handful of resistors.  There is a shortage of free space - henceforth it is worth considering that the most space is occupied by the wires: <br><br><img src="https://habrastorage.org/files/b69/2fe/fd6/b692fefd6b724fb2b9514f2f818a72f1.JPG"><br><br>  No matter how scary it looked, the design turned out to be quite working, and after half a year, the board of the power bank itself failed. <br><br>  For ease of debugging and firmware upgrades, I brought out the port of the USB serial adapter FT232RL, and connected it to the serial port of the Arduino Pro Mini.  In order to charge the batteries through the same connector at the same time, I applied a small trick: you need to power the FTDI module through the VCC output from the internal circuit of the device, and the + 5V leg from the MiniUSB to redirect to the input for charging the power bank.  To do this, it is enough to drop out zero resistance on the adapter, and make a power drain from the upper contact pad: <br><br><img src="https://habrastorage.org/files/031/d7e/3af/031d7e3af4f44735bdc907055f52bf4b.jpg"><br><br>  The obvious way is to connect only GND, RX and TX does not work: the module will receive power through RX-pin. <br><br><h5>  Second controller </h5><br>  Trial runs on the street are held, time is considered, the sensors consistently register the intersection - hurray!  And then - the competition on the nose, in just two weeks.  So time is running out: you need to assemble a second set of sensors on the already proven design, and the second controller. <br><br>  And that's why I love Arduino - for a quick start and work with a huge amount of iron without reading datasheets. <br>  The second case and elegant, but expensive OLED-display plus batteries, mail will not have time to bring.  I took what was at hand: a box for trifles, a telephone jack, four resistors, Arduino Nano, nRF24L01, some kind of display, a stabilizer KR142EN5A (there is always 12V power on the track).  There are literally three soldering points, everything else is on the model wires, and after an hour the second set is ready! <br><br>  For delivery - the judicial panel!  Box for radio equipment, Arduino Uno, nRF24L01 and a pair of displays with eight seven-segment indicators.  I connected everything again with the model wires.  In the case I drilled a hole for the USB port for powering from an external power-bank or laptop, displays - hot-melt attached to the transparent cover.  Taking a package through the radio module and bringing it to one of the two displays is not a very difficult task, the code was written quickly.  The result is the referee‚Äôs console, which duplicates the information from the controllers, and the second telemetry set: <br><br><img src="https://habrastorage.org/files/a7d/515/366/a7d515366b7b4af8bfb49f5594ca8490.JPG"><br><br><h5>  Competition </h5><br>  Before the competition I checked all the devices again, and for good reason: in one of the controllers, the quartz was on standard 16 MHz, and in the second - 16.384 MHz!  Needless to say, they considered time as differently. <br><br>  He charged the batteries and checked the connection - the radio modules showed themselves excellently by transmitting data to tens of meters with the antenna divorced on the printed circuit board.  All devices together look more impressive: <br><br><img src="https://habrastorage.org/files/4a8/b74/d77/4a8b74d77c8845a19a59c4cae03f609d.jpg"><br><br>  For luck, the day of the races turned out to be warm and dry - the equipment will survive.  While the track is being laid out - I place the equipment: <br><br><img src="https://habrastorage.org/files/027/ebe/901/027ebe90192d4defa3f0215cf61fa0c0.jpg"><br><br>  Begin the first races and - cheers, everything works clearly!  No false positives, the time is cut off accurately.  Girls at the start help athletes place the bike at the starting gates and record the result at the finish.  The portable referee console helps pretty - when in the sunlight, the LED indicators of the controller lying on the pavement are almost invisible. <br><br><img src="https://habrastorage.org/files/4a6/dd8/641/4a6dd864146f4d6b948caa396078af94.jpg"><br><br>  The venture was justified: almost a hundred parallel races were held (and these are two hundred fixed times), there are no failures, and the difference between the first two places in the road motorcycle class is 0.1 seconds, which is not easy to measure manually.  So it is decided: the project - to be! <br><br><img src="https://habrastorage.org/files/0d0/6c4/ab6/0d06c4ab6c1443d6ac57f9895da322f3.jpg"></div><p>Source: <a href="https://habr.com/ru/post/392229/">https://habr.com/ru/post/392229/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../392219/index.html">The quiet tread of the cosmic future</a></li>
<li><a href="../392221/index.html">Because of a mutation in the X chromosome, some women have 100 times more colors than ordinary people.</a></li>
<li><a href="../392223/index.html">Scientists suggest that the frequency of using a computer can determine the early stage of Alzheimer's</a></li>
<li><a href="../392225/index.html">The novel, written by the Japanese program, reached the final of the literary contest</a></li>
<li><a href="../392227/index.html">The exclusion zone around the Chernobyl nuclear power plant is planned to be used as a dump of nuclear waste</a></li>
<li><a href="../392231/index.html">The history of flash memory. Part II: card battles</a></li>
<li><a href="../392233/index.html">In Angola, Wikimedia uses free full-traffic traffic.</a></li>
<li><a href="../392235/index.html">The heavy burden of a 21st century man</a></li>
<li><a href="../392237/index.html">Small, with eight legs and works like an Arduino - what is it?</a></li>
<li><a href="../392239/index.html">Venture investments: first hedge funds have drowned Valley in money, but now everything is different</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>