<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Frontera: crawl web framework architecture and current issues</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello everyone, I am developing Frontera , the first ever framework for large-scale crawling of the Internet made in Python, with open source. With th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Frontera: crawl web framework architecture and current issues</h1><div class="post__text post__text-html js-mediator-article">  Hello everyone, I am developing <a href="https://github.com/scrapinghub/frontera">Frontera</a> , the first ever framework for large-scale crawling of the Internet made in Python, with open source.  With the help of Frontera, you can easily make a robot that can download content at a speed of thousands of pages per second, while following your crawling strategy and using a regular relational database or KV storage to store the link database and queue. <br><br>  Development Frontera is funded by Scrapinghub Ltd., has a fully open source code (located on GitHub, BSD 3-clause license) and a modular architecture.  We are trying to ensure that the development process is also as transparent and open as possible. <br><br>  In this article I am going to talk about the problems that we have encountered in the development of Frontera and the operation of robots based on it. <br><a name="habracut"></a><br>  The device of the distributed robot based on Frontera looks like this: <br><img src="http://frontera.readthedocs.io/en/latest/_images/frontera-design.png" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The picture shows the configuration with the Apache HBase storage and the Apache Kafka data bus.  The process starts from the workaround strategy (SW) worker, which schedules URLs from which to start the workaround.  These URLs are ‚Äúscoring log‚Äù, the topic of the Kafka (a dedicated message channel), are consumed by the database worker and they are also planned in the topic ‚Äúnew batches‚Äù, from where they come to the spiders on the basis of Scrapy.  Scrapy Spider resolves a DNS name, maintains a pool of open connections, receives content and sends it to the topic ‚Äúspider log‚Äù.  From where the content is consumed again by the worker of the strategy and depending on the logic encoded in the bypass strategy, he plans new URLs. <br><br>  If anyone is interested, here is a video of my report on <a href="https://youtu.be/hV929rp1YmI">how we circumvented the Spanish Internet with the help of Frontera</a> . <br><br><br><br>  At the moment we are faced with the fact that people who are trying to deploy a robot in their very difficult configuration of distributed components.  Unfortunately, the deployment of Frontera in a cluster implies an understanding of its architecture, reading the documentation, proper configuration of the data bus (message bus) and storage for it.  All this is very time consuming and not at all for beginners.  Therefore, we want to automate the deployment on a cluster.  We chose <a href="https://kubernetes.io/">Kubernetes</a> and <a href="https://www.docker.com/what-docker">Docker</a> to achieve these goals.  A big plus of Kubernetes is that it is supported by many cloud providers (AWS, Rackspace, GCE, etc.).  with the help of it, it will be possible to deploy the Frontera even without having a Kubernetes-configured cluster. <br><br>  Another problem is that it is like the Frontera water system of a nuclear power plant.  It has consumers and manufacturers. It is very important for them to control characteristics such as flow rate and performance in different parts of the system.  Here it should be recalled that Frontera is an online system.  Classic robots ( <a href="https://ru.wikipedia.org/wiki/Nutch">Apache Nutch</a> ), on the contrary, work in batch mode: first, a portion is scheduled, then downloaded, then parsed and re-scheduled.  Simultaneous parsing and scheduling are not provided for in such systems.  Thus, we have the problem of synchronization of the speed of work of different components.  It is quite difficult to design a robot that bypasses pages with constant performance with a large number of threads, while keeping them in storage and planning new ones.  The speed of the response of web servers, the size and number of pages on the site, the number of links vary; all this makes it impossible to precisely fit the components in performance.  As a solution to this problem, we want to make a web interface based on Django.  It will display the main parameters and if you can tell what steps need to be taken by the operator of the robot. <br><br>  I already mentioned modular architecture.  Like any open source project, we are committed to a variety of technologies that we support.  Therefore, now in Pull Requests we are preparing support for distributed Redis, there have already been two attempts to make support for Apache Cassandra, well, we would like to support RabbitMQ as a data bus. <br><br>  We hope to solve all these problems at least partially within the framework of Google Summer Of Code 2017. If something seems interesting to you and you are a student, let us know at <a href="">frontera@scrapinghub.com</a> and <a href="https://summerofcode.withgoogle.com/get-started/">submit an application through the GSoC form</a> .  Submission of applications starts from March 20 and will last until April 3.  The full schedule of GSoC 2017 is <a href="https://developers.google.com/open-source/gsoc/timeline">here</a> . <br><br>  Of course, there are also performance problems.  At the moment, in Scrapinghub, in the pilot mode, there is a service for massive download of pages based on Frontera.  The client provides us with a set of domains to which he would like to receive content, and we download them and put them in the S3 repository.  Payment for the downloaded volume.  In such conditions, we try to download as many pages as possible per unit of time.  When trying to scale the Frontera to 60 spiders, we pushed so that HBase (through the Thrift interface) degrades when we write to it all the links found.  We call this data reference base, and we need it in order to know when and what we downloaded, what answer we received, etc.  On a cluster of 7 server regions, we have a number of requests up to 40-50K per second, and with such volumes the response time greatly increases.  Write performance drops dramatically.  Such a problem can be solved in different ways: for example, save to a separate fast log, and later write it to HBase using packet methods, or contact HBase directly bypassing Thrift via your own Java client. <br><br>  We are also constantly working to improve reliability.  Too large a downloaded document or sudden network problems should not cause components to stop.  However, this sometimes happens.  To diagnose such cases, we have made the SIGUSR1 OS signal handler, which saves the current process stack to the log.  Several times this helped us a lot to understand what the problem was. <br><br>  We plan to further improve the Frontera, and we hope that the community of active developers will grow. </div><p>Source: <a href="https://habr.com/ru/post/325154/">https://habr.com/ru/post/325154/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../325136/index.html">Colocation: how, why and why</a></li>
<li><a href="../325138/index.html">Protection from DDoS attacks from the point of view of a telecom operator. Part 1</a></li>
<li><a href="../325140/index.html">The Institute of Software Engineering has opened access to the C ++ code design standard.</a></li>
<li><a href="../325144/index.html">Technical program PHDays: analysis of the HummingBad trojan, which is malware for macOS and attacks on the Java Card</a></li>
<li><a href="../325148/index.html">DUMP Developer Conference: Latest News and Final Program</a></li>
<li><a href="../325162/index.html">‚ÄúRuby is a great tool for me‚Äù</a></li>
<li><a href="../325168/index.html">MIPSfpga and UART</a></li>
<li><a href="../325170/index.html">Splunk + Check Point, an example of analyzing your firewall logs</a></li>
<li><a href="../325174/index.html">How I struggle with procrastination - and usually win</a></li>
<li><a href="../325176/index.html">We host a site in the interplanetary IPFS file system under Windows</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>