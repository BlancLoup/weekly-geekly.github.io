<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Universal DRO based on Arduino Nano - shDRO. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello again! 

 I continue to describe my development shDRO. In this part, I will describe the device polling algorithm and the format of the console ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Universal DRO based on Arduino Nano - shDRO. Part 2</h1><div class="post__text post__text-html js-mediator-article">  Hello again! <br><br>  I continue to describe my development shDRO.  In this part, I will describe the device polling algorithm and the format of the console commands. <br><br>  <a href="https://habr.com/ru/post/446408">First part.</a> <br><a name="habracut"></a><br>  <b>Firmware</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Since the number of channels / ports to which reader 12 can be connected, and each channel can theoretically be set to interrupt, two PCINT interrupt handlers are used (for ports D and C).  One connection restriction follows from this: all device pins that are configured for input must be connected to channels of the same group.  If the channel is configured to exit, then for the current device, no matter which group it belongs to.  Groups: group 1 (channels 0-5), group 2 (channels 6-11). <br><br>  For interrupt handlers, two circular buffers are involved, 256 bytes each. <br><br>  The interrupt handler code is: <br><br><pre><code class="cpp hljs">buf[pos] = DATA_N; pos++;</code> </pre> <br>  Where DATA_N is one of the ports: PIND, PINC. <br><br>  Data processing is as follows: <br><br><ul><li>  an interrupt occurs, a new port value is written to the buffer; </li><li>  periodically the buffer is polled, and the data that appeared after the last poll is read from it (the position of the last poll buffer is stored in the device structure); </li><li>  in the process of reading the new data, the interrupt levels set for the channels are compared with the current port data.  If the interrupt level does not match, then the data is ignored. </li><li>  it checks that all data has been received for processing (for example, for the BIN6 protocol, 24 bits must be taken); </li><li>  the data is processed into a ‚Äúreadable‚Äù view and the processed data is displayed on the screen; </li><li>  then the process is repeated; </li></ul><br>  To implement the above logic, the following logic modules are implemented in the firmware: <br><br><ul><li>  Device: the module contains all the information about one connected device.  For each connected device, such a module is created; </li><li>  Protocol: the module contains information about the protocol and how to handle incoming signals on the ports in accordance with this exchange protocol; </li><li>  Function: module contains information on how to convert data received from the Protocol module.  For example, there is a Protocol module that supports a quadrature signal, but devices that produce a quadrature signal can be different: it can be an optical ruler, or a speed sensor.  Those.  in one case, the data must be converted to mm or inches, and in the other rpm.  This module just does it; </li><li>  Led: a module that displays information on indicators.  shDRO contains 4 indicators, and the desired display indicator is set for each device; </li></ul><br>  As a result, to connect the device, in the console you need: <br><br><ul><li>  configure the desired channels; </li><li>  add device; </li><li>  for device, set protocol, function and led; </li><li>  add / bind the desired channels to the device; </li></ul><br>  <b>Console</b> <br><br>  At the moment, I checked the console in the monitor port ArduinoIDE and in Terminal v.1.9b.  For terminals like Putty you need to implement an echo mode (not implemented). <br><br>  Command format: <br><br><pre> <code class="plaintext hljs">&lt;&gt; &lt;/1&gt; &lt;_1&gt; &lt;/N&gt; &lt;_N&gt;</code> </pre> <br>  Maximum number of arguments per line 5. <br><br>  Register does not matter, command parsing occurs after converting a string to lower case (exception: the value of the argument in quotes). <br><br>  All commands are executed only after issuing the Setup command (exception, Help command, which lists all available commands). <br><br>  All commands are described in the attached archive, as well as the first version of the firmware in hex format. <br><br>  <a href="https://drive.google.com/file/d/18zCviSPTl8XanwVXbzO_AG4TBEr5KAsm/view%3Fusp%3Dsharing">shDRO.zip (.hex + command description)</a> <br><br>  To be continued. <br><br>  Thank! <br><br>  PS <br>  Commands related to configuring devices and channels can be sent to the ‚Äúbare‚Äù arduinka without strapping. <br><br>  PS1 <br>  Please those who live in Kazan. <br>  If you have: <br><ul><li>  digital calliper protocols: 24BIT, BCD7; </li><li>  iGaging digital lines (21BIT protocol); </li></ul><br>  then could you give them to me for a couple of days to write and debug protocols for them? <br>  I promise to keep them safe and sound! <br>  But this is in a personal.  Thank you in advance. <br><br>  PS2 <br>  I forgot to add two commands to the command description file: <br>  - save: saves channel and device settings to EEPROM; <br>  - load: unloads the settings of channels and devices from the EEPROM (load is performed by the machine during initialization); <br>  I will not upload the file, just keep in mind.  But ‚Äúhelp‚Äù displays these commands. </div><p>Source: <a href="https://habr.com/ru/post/446458/">https://habr.com/ru/post/446458/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../446446/index.html">Basics of JavaScript engines: common forms and inline caching. Part 1</a></li>
<li><a href="../446448/index.html">5 basic rules for conducting problem interviews to identify consumer needs</a></li>
<li><a href="../446452/index.html">Lunar mission "Bereshit" - April 4, 2019 made a transition to lunar orbit, ahead of 7 days of flight, 6 maneuvers and 1 landing</a></li>
<li><a href="../446454/index.html">Web server development on Golang - from easy to hard</a></li>
<li><a href="../446456/index.html">Import substitution in practice. Part 1. Options</a></li>
<li><a href="../446460/index.html">Product Design Digest March 2019</a></li>
<li><a href="../446462/index.html">Immersion in the driver: the general principle of the reverse example of the task NeoQUEST-2019</a></li>
<li><a href="../446464/index.html">15 parrots: choose a hosting provider for VPS / VDS servers</a></li>
<li><a href="../446466/index.html">Content marketing for business: habraseminar # 6 and its main points</a></li>
<li><a href="../446468/index.html">A practical guide on environment variables in Go</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>