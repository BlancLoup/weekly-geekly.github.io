<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Reflections on the standard JavaScript library. Core.js</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="One boy wrote everything in JavaScript, and the client and the server said what he liked, convenient, readable. Then they took him to Durkee, of cours...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Reflections on the standard JavaScript library. Core.js</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  One boy wrote everything in JavaScript, and the client and the server said what he liked, convenient, readable.  Then they took him to Durkee, of course. <br>  <i><b>- From the Internet</b></i> </blockquote><br>  What is it for me?  Fun stuff - javascript.  The basis of the modern web and on the frontend has no alternatives as such. <br><br>  JavaScript is, among other things, the <a href="http://ru.wikipedia.org/wiki/%25D1%25F2%25E0%25ED%25E4%25E0%25F0%25F2%25ED%25E0%25FF_%25E1%25E8%25E1%25EB%25E8%25EE%25F2%25E5%25EA%25E0">standard library</a> , which will be discussed here.  By standard library, I mean modules, constructors, methods that must be present on any platform, be it a browser or server, without undue action from the programmer, not including the platform-specific API.  Even if you do not write in JavaScript, but in the language compiled into it, most likely you will have to deal with its standard library. <br><br>  Vanilla JavaScript standard library is generally not bad.  This is not only a standard library on the specification of the ECMA-262 language of current versions - from 3 to draft 6. Part of the API is in separate specifications, for example, the ECMA-402 internationalization API.  Many features, without which JavaScript is hard to imagine, for example, <code>setTimeout</code> , belong to web standards.  The console is not standardized at all - you have to rely on the de facto standard. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      That's just not so standard, it is different everywhere.  There are old IE in which we get out of the box the standard ES3 library of the 90-bearded year even without <code>Array#forEach, Function#bind, Object.create</code> and consoles, and there is, for example, Node.js, on which many are already using the possibilities of the future ES6. <br><br>  I want to have a universal, truly standard library, both on the server and in any browser, as closely as possible with modern standards, as well as implementing the necessary functionality, which (for now?) Is not standardized.  The article is devoted to the <b><a href="https://github.com/zloirock/core-js">core.js</a></b> library - the implementation of my thoughts on the standard JavaScript library.  In addition, this article is also a cheat sheet on the modern standardized standard JavaScript library and notes on its prospects. <br><br><h4>  <b>Content, or what we get at the output:</b> </h4><br><ul><li><h5>  <a href="https://habr.com/post/216997/">Approaches</a> </h5></li><li><h5>  <a href="https://habr.com/post/216997/">Part One: Crutches</a> </h5><br><ul><li>  <a href="https://habr.com/post/216997/">ECMAScript 5</a> </li><li>  <a href="https://habr.com/post/216997/">ECMAScript 6</a> </li><li>  <a href="https://habr.com/post/216997/">ECMAScript 6: Symbols</a> </li><li>  <a href="https://habr.com/post/216997/">ECMAScript 6: Collections</a> </li><li>  <a href="https://habr.com/post/216997/">ECMAScript 6: Iterators</a> </li><li>  <a href="https://habr.com/post/216997/">ECMAScript 6: Promises</a> </li><li>  <a href="https://habr.com/post/216997/">Mozilla JavaScript: Static Versions of Array Methods</a> </li><li>  <a href="https://habr.com/post/216997/">Deferred execution: setTimeout, setInterval, setImmediate</a> </li><li>  <a href="https://habr.com/post/216997/">Console</a> </li></ul><br></li><li><h5>  <a href="https://habr.com/post/216997/">Part Two: Bicycles</a> </h5><br><ul><li>  <a href="https://habr.com/post/216997/">Data classification</a> </li><li>  <a href="https://habr.com/post/216997/">Dictionaries</a> </li><li>  <a href="https://habr.com/post/216997/">Partial application</a> </li><li>  <a href="https://habr.com/post/216997/">Date formatting</a> </li><li>  <a href="https://habr.com/post/216997/">Object API</a> </li><li>  <a href="https://habr.com/post/216997/">Arrays</a> </li><li>  <a href="https://habr.com/post/216997/">Numbers</a> </li><li>  <a href="https://habr.com/post/216997/">Escaping special characters</a> </li></ul><br></li><li><h5>  <a href="https://habr.com/post/216997/">Conclusion</a> </h5></li></ul><a name="habracut"></a><br>  I warn you, mnogabukf and the first chapters are quite banal, there is no desire to read everything - the table of contents is higher, scroll to the section you are interested in. <br><br><a name="approach"></a><h2>  <b><a href="https://habr.com/ru/post/216997/">#</a> Approaches</b> </h2><hr><br>  There are three main approaches to creating libraries, which can be called standard, in JavaScript: <br><br>  The first is the <b>use of only <a href="http://en.wikipedia.org/wiki/Polyfill">polyfiles</a> , only standardized functionality</b> .  Reinforced concrete confidence that over time, the API will not break.  To work with such a library, its knowledge is not needed, you only need knowledge of the corresponding API language.  Usually, polyphiles are limited to one standard or part of it.  For example, <a href="https://github.com/es-shims/es5-shim"><b>es5-shim</b></a> or <a href="https://github.com/paulmillr/es6-shim"><b>es6-shim</b></a> .  For this reason, in order to provide the features that I would like to have by default, you have to connect several polyfiles.  Their internal components often duplicate each other, so this set often grows to hundreds of kilobytes.  And not all the possibilities that I would like to have are standardized.  The possibility of conflicts with other libraries is insignificant, but I would not use them as a dependency when writing a library. <br><br>  The second is a <b>set of utilities in its own namespace</b> .  Either export in a modular system, or the creation of a single global object.  For example, <a href="http://underscorejs.org/"><b>Undescore</b></a> or its fork <a href="https://lodash.com/"><b>LoDash</b></a> .  Usually, quite compact, but the possibilities are limited to a set of simple utilities.  Since it does not extend native objects and the <code>noConflict</code> method is often present, which rolls back changes, the possibility of conflicts with other libraries is minimal, better than the other methods mentioned here as a safe dependency for other libraries. <br><br>  The third is the <b>extension of native objects not only by standardized functionality</b> .  For example, adding your own methods to an array prototype, which is usually more convenient than passing an array to a function.  Now in this category is driving <a href="http://sugarjs.com/"><b>Sugar</b></a> , in its time - <a href="http://mootools.net/"><b>MooTools</b></a> and <a href="http://prototypejs.org/"><b>Prototype</b></a> .  They add a lot of useful functionality, but often the methods almost completely duplicate each other.  Here polyfiles should be turned around - but from polyphiles such libraries are usually limited to methods of array prototype, <code>Function#bind</code> and several more, ignoring most of the standards.  As for conflicts, everything is very bad here.  Such libraries often extend native objects with methods with the same name but different signatures.  In order to avoid conflicts, when developing the final application you should not use more than one library that extends native objects, not counting polyfiles, and when writing a library, such dependencies are generally unacceptable. <br><br>  Instead of one universal standard library, to provide the features that we would like to have without unnecessary problems, we have to pull the hodgepodge of <i>Undescore / LoDash / Sugar + es5-shim, es6-shim, es6-symbol, setImmediate.js / asap, Moment.js / Intl.js, console stub</i> ... and so on. <br><br><a name="concept"></a>  <b><a href="https://habr.com/ru/post/216997/">#</a></b> We will try to take the best from each of these approaches.  <b>The core.js concept is</b> : <br><br><ul><li>  The standard library should have all the minimum required for comfortable work, which does not include the ability to work with the API of a specific platform. </li><li>  Standards are our everything.  The main part of the library is polyphiles.  That's just not all the necessary functionality is standardized. </li><li>  If the functionality available in the system is implemented according to the specification or standard de facto, we leave the native one, but if the functionality is not standardized - in order to avoid conflicts in the future, we replace it by force. </li><li>  The library should be compact and well compressed. </li><li>  Modularity, the ability to collect only the necessary functionality. </li><li>  Write the final application - you are a king and god here and have the full right to use a library that extends native objects.  The main thing is that only one library would do this. </li><li>  Write a library or npm module - you cannot use a library that extends native objects in any case.  You risk condemning to conflicts programmer writing the final application.  In this case there is the possibility of assembling without their expansion. </li></ul><br><a name="example"></a>  <b><a href="https://habr.com/ru/post/216997/">#</a></b> In the case of a normal build, working with <b>core.js</b> is quite obvious: <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>.from(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Set</span></span>([<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]))); <span class="hljs-comment"><span class="hljs-comment">// =&gt; [1, 2, 3] console.log('*'.repeat(10)); // =&gt; '**********' Promise.resolve(32).then(console.log); // =&gt; 32 setImmediate(console.log, 42); // =&gt; 42</span></span></code> </pre><br><a name="example-library"></a>  <b><a href="https://habr.com/ru/post/216997/">#</a></b> In the case of assembly without extending native objects, the functionality is exported either to the global <code>core</code> object or to the modular system.  For example, the <code>Promise</code> constructor is available as <code>core.Promise</code> , and the <code>Array.from</code> method as <code>core.Array.from</code> .  Methods designed to add existing constructors to the prototype, rather than those added by the library, become static, for example, <code>core.String.repeat</code> is a static version of the <code>String.prototype.repeat</code> method. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> log = core.console.log; log(core.Array.from(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> core.Set([<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]))); <span class="hljs-comment"><span class="hljs-comment">// =&gt; [1, 2, 3] log(core.String.repeat('*', 10)); // =&gt; '**********' core.Promise.resolve(32).then(log); // =&gt; 32 core.setImmediate(log, 42); // =&gt; 42</span></span></code> </pre><br>  An assembly containing only polyfiles, respectively, adds them only.  Actually, in the example with the usual assembly only polifila and used. <br><br><a name="node"></a>  <b><a href="https://habr.com/ru/post/216997/">#</a></b> Installation on Node.js: <br><br><pre> <code class="javascript hljs">npm i core-js</code> </pre><br>  You can connect to choose one of the assemblies: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  : require('core-js'); //     : var core = require('core-js/library'); // ,   : require('core-js/shim');</span></span></code> </pre><br><a name="browser-builds"></a>  <b><a href="https://habr.com/ru/post/216997/">#</a></b> <a href="https://github.com/zloirock/core-js/tree/master/client">Build for the browser</a> : <br><br><ul><li>  Maximum: <a href="">development</a> , <a href="">production</a> (21.8 kb without gzip) </li><li>  Without extension of native objects: <a href="">development</a> , <a href="">production</a> (21.8 kb without gzip) </li><li>  Only polyfiles: <a href="">development</a> , <a href="">production</a> (16.7 kb without gzip) </li></ul><br><a name="custom-builds"></a>  <b><a href="https://habr.com/ru/post/216997/">#</a></b> If none of these assemblies suits you, you can make your own.  For example, you need only a console module and simple date formatting, and without extending native objects.  To do this, put Node.js, then install grunt-cli, core-js with the dependencies necessary for the build and build: <br><br><pre> <code class="javascript hljs">npm i -g grunt-cli npm i core-js cd node_modules/core-js &amp;&amp; npm i grunt build:date,<span class="hljs-built_in"><span class="hljs-built_in">console</span></span>,library --path=custom uglify</code> </pre><br>  As a result, we will get the <code>custom.js</code> , <code>custom.min.js</code> weighing 4.8kb and <code>custom.min.map</code> .  The <code>library</code> flag indicates a build without extending native objects.  You can see which module the required functionality belongs to <a href="https://github.com/zloirock/core-js">here</a> (last column). <br><br><a name="I"></a><h1>  <b>Part One: Crutches</b> </h1><hr>  If someone does not understand, under crutches, in the context of the article, we mean the standardized functional polyfiles available in the library.  So, let's go: <br><br><a name="es5"></a><h2>  <b><a href="https://habr.com/ru/post/216997/">#</a> ECMAScript 5</b> </h2><hr><br>  Perhaps everyone knows that adds ECMAScript 5 to the standard library.  Almost all browsers that do not support ES5 have become extinct.  Except for old IE.  Until now, customers often ask for support for IE8, and in the most extreme cases, even IE6.  I hope the situation will change soon.  The most popular ES5 polyfil is <a href="https://github.com/es-shims/es5-shim">this es5-shim</a> , some of the features are present in Sugar, MooTools, Prototype, but only a part.  Since this is far from new, we can do without unnecessary details - a brief description and, if necessary, some features of the implementation.  Needless to say, it is important to remember that if the code is written with IE8 support, there is no question of working with descriptors. <br><br><a name="es5-array"></a><h4>  <b><a href="https://habr.com/ru/post/216997/">#</a> Array methods</b> </h4><br><a name="es5-array-proto"></a>  <b><a href="https://habr.com/ru/post/216997/">#</a></b> Let's start with the prototype array methods.  This is all known: <br><br>  <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf">Array # indexOf</a> returns the index of the first element equal to the specified value, or <code>-1</code> if the value is not found. <br>  <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/lastIndexOf">Array # lastIndexOf is</a> similar to the previous one, but returns the index of the last element. <br>  <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach">Array # forEach</a> calls a function for each element of the array. <br>  <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map">Array # map</a> returns a new array with the result of calling the function for each element of the given array. <br>  <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter">Array # filter</a> returns a new array with all the elements of this array that satisfy the condition of the checking function. <br>  <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/every">Array # every</a> checks if each element in the array satisfies the condition of the checking function. <br>  <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/some">Array # some</a> checks if there is at least one array element that satisfies the condition of the checking function. <br>  <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce">Array # reduce</a> performs a convolution of an array using the function, from the left - to the right. <br>  <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/ReduceRight">Array # reduceRight</a> performs a convolution of an array using the function, on the right - on the left. <br><br><pre> <code class="javascript hljs">[<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>].indexOf(<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-comment"><span class="hljs-comment">// =&gt; 1 [1, 2, 3, 2, 1].lastIndexOf(2); // =&gt; 3 [1, 2, 3].forEach(function(val, key){ console.log(val); // =&gt; 1, 2, 3 console.log(key); // =&gt; 0, 1, 2 }); [1, 2, 3].map(function(it){ return it * it; }); // =&gt; [1, 4, 9] [1, 2, 3].filter(function(it){ return it % 2; }); // =&gt; [1, 3] function isNum(it){ return typeof it == 'number'; } [1, '2', 3].every(isNum); // =&gt; false [1, '2', 3].some(isNum); // =&gt; true function add(a, b){ return a + b; } [1, 2, 3].reduce(add); // =&gt; 6 [1, 2, 3].reduceRight(add, ''); // =&gt; '321'</span></span></code> </pre><br>  These methods are implemented elementary, but there is one feature.  The array methods are <a href="https://ru.wikipedia.org/wiki/%25CE%25E1%25EE%25E1%25F9%25B8%25ED%25ED%25EE%25E5_%25EF%25F0%25EE%25E3%25F0%25E0%25EC%25EC%25E8%25F0%25EE%25E2%25E0%25ED%25E8%25E5">generics</a> and can be called in the context of not only an array, but also any array-like object, more information about this <a href="https://habr.com/ru/post/216997/">will be # below</a> .  So, according to the ES5 specification, strings are array-like objects, the letter of a string can be obtained by index, for example, <code>'string'[2] // =&gt; 'r'</code> , and in old IE they are not.  In the case of applying these methods in the context of strings, we cast the strings to an array.  To solve this problem, if necessary, we replace <code>Array#slice</code> and <code>Array#join</code> in old IE. <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>.prototype.map.call(<span class="hljs-string"><span class="hljs-string">'123'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">it</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> it * it; }); <span class="hljs-comment"><span class="hljs-comment">// =&gt; [1, 4, 9] Array.prototype.slice.call('qwe', 1); // =&gt; ['w', 'e'] Array.prototype.join.call('qwe', '|'); // =&gt; 'q|w|e'</span></span></code> </pre><br>  Well, don't forget the ancient truth: <b>never go around an array with a <code>for-in</code> loop</b> .  This is not only slow, but also compelling, if IE8- support is needed, to check whether the key is proper - otherwise, bypass not only the array elements, but also the methods of its prototype :) <br><br><a name="es5-is-array"></a>  <b><a href="https://habr.com/ru/post/216997/">#</a></b> Static method <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/isArray">Array.isArray</a> belongs to the same category.  The method checks whether an object is an array not by a chain of prototypes, but by an internal class.  Useful, but not universal.  We will talk about the classification of objects in detail <a href="https://habr.com/ru/post/216997/">in the second, bicycle, part of the article</a> . <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>.isArray([<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>]); <span class="hljs-comment"><span class="hljs-comment">// =&gt; true Array.isArray(Object.create(Array.prototype)); // =&gt; false</span></span></code> </pre><br><a name="es5-object"></a><h4>  <b><a href="https://habr.com/ru/post/216997/">#</a> Object API</b> </h4><br>  Full emulation of all methods of ECMAScript 5 object API based on ECMAScript 3 is impossible, partial - possible for many.  ES5 adds the following categories of methods to the object API: working with a prototype (creating from / receiving), obtaining object keys, working with descriptors. <br><br><a name="es5-create"></a>  <a href="https://habr.com/ru/post/216997/"><b>#</b></a> The <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create">Object.create</a> method creates an object from the prototype.  By passing <code>null</code> , you can create an object without a prototype, which cannot be done on the basis of ECMAScript 3.  It is necessary to use fierce thrash based on <code>iframe</code> .  Why this will be revealed to us <a href="https://habr.com/ru/post/216997/">in the second part</a> .  Optionally accepts an object <a href="https://habr.com/ru/post/216997/"># of descriptors</a> , similarly to <code>Object.defineProperties</code> . <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Parent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/*...*/</span></span></span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*...*/</span></span> } Parent.prototype = {<span class="hljs-attr"><span class="hljs-attr">constructor</span></span>: Parent <span class="hljs-comment"><span class="hljs-comment">/*, ... */</span></span>} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Child</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/*...*/</span></span></span></span></span><span class="hljs-function">)</span></span>{ Parent.call(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-comment"><span class="hljs-comment">/*, ...*/</span></span>); <span class="hljs-comment"><span class="hljs-comment">// ... } //   ES3 (  inherit  extend'): function Tmp(){} Tmp.prototype = Parent.prototype; Child.prototype = new Tmp; Child.prototype.constructor = Child; //   ES5: Child.prototype = Object.create(Parent.prototype, {constructor: {value: Child}}); var dict = Object.create(null); dict.key = 42; console.log(dict instanceof Object); // =&gt; false console.log(dict.toString) // =&gt; undefined console.log(dict.key) // =&gt; 42</span></span></code> </pre><br><a name="es5-getPrototypeOf"></a>  <a href="https://habr.com/ru/post/216997/"><b>#</b></a> The <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getPrototypeOf">Object.getPrototypeOf</a> method returns the prototype of the object.  In ECMAScript 3, there is no guaranteed way to get a prototype object.  If the object contains a <code>constructor</code> property, the <code>constructor</code> will probably be the prototype.  For objects created through <code>Object.create</code> , add the <a href="https://habr.com/ru/post/216997/"># symbol</a> containing the prototype, and we will ignore it when <a href="https://habr.com/ru/post/216997/">receiving keys</a> .  But on the instance of the constructor, the prototype of which was redefined without specifying the ‚Äúcorrect‚Äù property of the <code>constructor</code> , <code>Object.getPrototypeOf</code> will not work correctly. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parent = {<span class="hljs-attr"><span class="hljs-attr">foo</span></span>: <span class="hljs-string"><span class="hljs-string">'bar'</span></span>} , child = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.create(parent); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.getPrototypeOf(child) === parent); <span class="hljs-comment"><span class="hljs-comment">// =&gt; true function F(){} console.log(Object.getPrototypeOf(new F) === F.prototype); // =&gt; true F.prototype = {constructor: F /*, ...*/}; console.log(Object.getPrototypeOf(new F) === F.prototype); // =&gt; true F.prototype = {}; console.log(Object.getPrototypeOf(new F) === F.prototype); //  IE8-   </span></span></code> </pre><br><a name="es5-keys"></a>  <a href="https://habr.com/ru/post/216997/"><b>#</b></a> The <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys">Object.keys</a> method returns an array of the object's own enumerated keys.  <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyNames">Object.getOwnPropertyNames</a> returns an array of the object's own keys, incl.  and non-listed.  With <code>Object.keys</code> , it seems, everything is simple - we <code>Object.keys</code> over the object through <code>for-in</code> and check if the properties are proper.  If it were not for the <a href="https://developer.mozilla.org/en-US/docs/ECMAScript_DontEnum_attribute">bug with "non-enumerable enumerable" properties</a> in IE.  So you have to check the availability of such properties separately.  Similarly, with an additional check on the list of available hidden properties, <code>Object.getOwnPropertyNames</code> also <code>Object.getOwnPropertyNames</code> . <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.keys({<span class="hljs-attr"><span class="hljs-attr">q</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">w</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">e</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>})); <span class="hljs-comment"><span class="hljs-comment">// =&gt; ['q', 'w', 'e'] console.log(Object.keys([1, 2, 3])); // =&gt; ['0', '1', '2'] console.log(Object.getOwnPropertyNames([1, 2, 3])); // =&gt; ['0', '1', '2', 'length']</span></span></code> </pre><br><a name="es5-desc"></a>  <a href="https://habr.com/ru/post/216997/"><b>#</b></a> With descriptors everything is bad, ECMAScript 3 does not support them.  There is no possibility to set getters / setters.  Browsers with <code>Object#__define[GS]etter__</code> , but <code>Object.defineProperty</code> missing, have long since become extinct.  In old IE, it is possible to create an object with getters / setters through <a href="http://habrahabr.ru/post/75158/">perversions with VBScript</a> , but this is a separate topic.  <code>enumerable: false</code> properties are <code>enumerable: false</code> , they are not set, but it is possible to check whether it is such through <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/propertyIsEnumerable">Object # propertyIsEnumerable</a> .  In IE8, there are methods for working with descriptors, but it would be better if they did not exist (they work only with DOM objects).  So, all we can do for IE8- is a stub.  Setting the property <code>value</code> descriptor <code>value</code> in <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty">Object.defineProperty</a> and <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperties">Object.defineProperties</a> and honestly getting the <code>value</code> and <code>enumerable</code> in <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyDescriptor">Object.getOwnPropertyDescriptor</a> . <br><br><a name="es5-freeze"></a>  <a href="https://habr.com/ru/post/216997/"><b>#</b></a> What about <code>Object.freeze, Object.preventExtensions, Object.seal</code> ?  Not only is their emulation impossible, you can only do stubs, but there is such a point of view: <br><blockquote>  <b>Object.freeze, Object.preventExtensions, Object.seal, with, eval</b> <br>  Crazy shit  Stay away from it. <br>  <i><b><a href="http://nodeguide.com/style.html">- Felix Geisend√∂rfer</a></b></i> <br></blockquote>  And I completely agree with her, so we can do without them. <br><br><a name="es5-other"></a><h4>  <b><a href="https://habr.com/ru/post/216997/">#</a> Other</b> </h4><br><a name="es5-bind"></a>  <a href="https://habr.com/ru/post/216997/"><b>#</b></a> ECMAScript 5 adds context binding and basic partial usage through <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind">Function # bind</a> .  The method is wonderful, but for revealing the potential of partial application and context binding in JavaScript alone there is little of it, the topic is covered in detail in the <a href="https://habr.com/ru/post/216997/">relevant section</a> . <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fn = <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log.bind(<span class="hljs-built_in"><span class="hljs-built_in">console</span></span>, <span class="hljs-number"><span class="hljs-number">42</span></span>); fn(<span class="hljs-number"><span class="hljs-number">43</span></span>); <span class="hljs-comment"><span class="hljs-comment">// =&gt; 42 43</span></span></code> </pre><br><a name="es5-now"></a>  <a href="https://habr.com/ru/post/216997/"><b>#</b></a> The <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/now">Date.now</a> method returns the current time in numeric representation, the result of execution is similar to <code>+new Date</code> . <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>.now(); <span class="hljs-comment"><span class="hljs-comment">// =&gt; 1400263401642</span></span></code> </pre><br><a name="es5-trim"></a>  <a href="https://habr.com/ru/post/216997/"><b>#</b></a> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/Trim">String # trim</a> method removes whitespace from the beginning and end of a string. <br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'\n  \n'</span></span>.trim(); <span class="hljs-comment"><span class="hljs-comment">// =&gt; ''</span></span></code> </pre><br>  As for the <code>JSON</code> module, it is supported by IE8 and, within the framework of this library, I see no point in implementing it.  If you need it in absolutely prehistoric IE - no one bothers to use, for example, <a href="https://github.com/douglascrockford/JSON-js">this</a> polyfill. <br><br><a name="es6"></a><h2>  <b><a href="https://habr.com/ru/post/216997/">#</a> ECMAScript 6</b> </h2><hr><br>  The ECMAScript 5 specification was written hastily instead of the unaccepted ECMAScript 4 specification and did little expand on the ECMAScript 3 adopted in the past millennium. Now the much more seriously expanding language, including  and the standard library, ECMAScript 6 specification. Adding new features to it is frozen, all serious changes go to ECMAScript 7 sentences, recently most changes to the draft specification are bug fixes.  So in our standard library we will focus mainly on ES6. <br><br>  What with its support in current engines can be clearly seen from <a href="http://kangax.github.io/compat-table/es6/">this table</a> . <br><br><ul><li>  Best of all, with its support for <b>Firefox</b> , a lot is already available. </li><li><a name="v8-harmony-mode"></a>  <a href="https://habr.com/ru/post/216997/"><b>#</b></a> In <b>v8 (Chrome, Opera, Node.js)</b> quite a lot is also available, but much of the features are blocked by default, to enable them in the browser, check the Enable experimental JavaScript box (the parser eats the <code>chrome://flags/#enable-javascript-harmony</code> link <code>chrome://flags/#enable-javascript-harmony</code> ), and Node.js to start with the <code>--harmony</code> .  Something is available without a checkbox, for example, <code>Promise</code> , <code>WeakMap</code> and <code>WeakSet</code> , and starting with Chrome 38, <code>Symbol</code> , <code>Map</code> , <code>Set</code> , iterators are also available.  Node.js lags far behind in this regard, since, especially in a stable branch, v8 is rarely updated there.  But it, unlike the user's browser, no one will prevent you from launching with a flag. </li><li>  In <b>IE</b> , as usual, everything is bad, but the 11th version added collections and a couple more features.  In the near future promise <a href="http://habrahabr.ru/company/microsoft/blog/243215/">a lot</a> . </li><li>  Add ES6 functionality tried in <b>Safari</b> .  But almost everything that they added does not meet the standard and creates unnecessary problems, so it would be better not to add them.  The <a href="https://esdiscuss.org/topic/safari-8-es6-ish-implementation">link is</a> only a small part of the problems. </li></ul><br>  The most popular ES6 polyfil is <a href="https://github.com/paulmillr/es6-shim/">es6-shim</a> from <a href="https://habrahabr.ru/users/paulmillr/" class="user_link">paulmillr</a> . <br><br>  Part of the standard ECMAScript 6 library, for example, <code>Proxy</code> (and this is one of the most delicious features), based on ECMAScript 5 and even more so ECMAScript 3 is impossible to implement, but most can be implemented if not completely, then at least partially and unfairly. <br><br><a name="preprocessors"></a><h4>  <b><a href="https://habr.com/ru/post/216997/">#</a> A little about ECMAScript 6+ preprocessors</b> </h4><br>  As for the syntax, then, within the framework of this library, we cannot add its support.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">However, preprocessors that convert ECMAScript 6+ syntax to ECMAScript 3 or 5 come to the rescue. A huge amount of them, let's consider only a couple of popular ones. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There is such an old and powerful project - </font></font><b><a href="https://github.com/google/traceur-compiler"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google Traceur</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . It generates unreadable code and uses a rather heavy runtime, so I refused to use it. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Another project seems to me much more attractive - </font></font><b><a href="https://github.com/6to5/6to5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6to5</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . The project is fresh and develops </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">amazingly</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fast. It generates easily readable code and does not use its own runtime, the exception being the runtime </font></font><b><a href="http://facebook.github.io/regenerator/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">regenerator</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which it uses to compile the generators. But instead, it actively uses the standard ES6 library - for example, </font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font><code>Symbol.iterator</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Default -</font></font><a href="https://github.com/paulmillr/es6-shim"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">es6-shim</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://github.com/medikoo/es6-symbol"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">es6-symbol</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Our library easily replaces them, which makes this preprocessor an ideal pair of it. Converts code to ECMAScript 5, but mainly it concerns the standard library - with stub methods like </font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font><code>Object.defineProperties</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> almost everything will work in old IE. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">With the use of the preprocessor and polyphyl standard library, you can start using ECMAScript 6 to its fullest now.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Except, perhaps, some small things. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sketched a very </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">simple </font></font><a href="http://es6.zloirock.ru/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sandbox</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> with the ability to compile ES6 via </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6to5</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and the connected </font><b><font style="vertical-align: inherit;">core.js</font></b><font style="vertical-align: inherit;"> library</font></font><b><font style="vertical-align: inherit;"></font></b> ,      . ,          ECMAScript 6,        ECMAScript 5. <br><br><hr><br>         ECMAScript 6.         ,  <a href="https://habr.com/ru/post/216997/"># </a> , <a href="https://habr.com/ru/post/216997/"># </a> , <a href="https://habr.com/ru/post/216997/"># </a>  <a href="https://habr.com/ru/post/216997/"># </a> ,   . <br><br><a name="es6-object-assign"></a><h4> <b><a href="https://habr.com/ru/post/216997/">#</a> Object.assign</b> </h4><br>    . <a href="http://people.mozilla.org/~jorendorff/es6-draft.html">Object.assign</a>        ()    . <a href="http://goo.gl/H3zj4b"></a> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> foo = {<span class="hljs-attr"><span class="hljs-attr">q</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">w</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>} , bar = {<span class="hljs-attr"><span class="hljs-attr">e</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">r</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>} , baz = {<span class="hljs-attr"><span class="hljs-attr">t</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-attr"><span class="hljs-attr">y</span></span>: <span class="hljs-number"><span class="hljs-number">6</span></span>}; <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.assign(foo, bar, baz); <span class="hljs-comment"><span class="hljs-comment">// =&gt; foo = {q: 1, w: 2, e: 3, r: 4, t: 5, y: 6}</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It was also planned to add a method </font></font><code>Object.mixin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that also copied non-enumerable properties, took into account descriptors and reassigned the parent obtained via the keyword </font></font><code>super</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">However, it was decided to postpone its addition. </font><font style="vertical-align: inherit;">Its counterpart is in the </font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># bicycle part of the</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> library.</font></font><br><br><a name="es6-object-is"></a><h4> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Object.is</font></font></b> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comparison operators in JavaScript generally behave quite strangely. </font><font style="vertical-align: inherit;">Forget even such an operator, as </font></font><code>==</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with his ghosts, look at </font></font><code>===</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-literal"><span class="hljs-literal">NaN</span></span> === <span class="hljs-literal"><span class="hljs-literal">NaN</span></span> <span class="hljs-comment"><span class="hljs-comment">// =&gt; false 0 === -0 // =&gt; true,   : 1/0 === 1/-0 // =&gt; false</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Just for this case, the language has an internal comparison algorithm </font></font><a href="http://es5.javascript.ru/x9.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SameValue</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . For it </font></font><code>NaN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is equal </font></font><code>NaN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and, </font></font><code>+0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>-0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">different. In ECMAScript 6, they wanted to bring it out as operators </font></font><code>is</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>isnt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, it seems, having understood that comparison operators in the language are already quite a few, and for backward compatibility, they were rendered as an </font></font><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/is"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Object.is</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><font style="vertical-align: inherit;">. </font></font><a href="http://goo.gl/XMplwh"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.is(<span class="hljs-literal"><span class="hljs-literal">NaN</span></span>, <span class="hljs-literal"><span class="hljs-literal">NaN</span></span>); <span class="hljs-comment"><span class="hljs-comment">// =&gt; true Object.is(0, -0); // =&gt; false Object.is(42, 42); // =&gt; true,  '===' Object.is(42, '42'); // =&gt; false,  '==='</span></span></code> </pre><br><a name="same-value-zero"></a> <a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Also in ES6 and later, another comparison algorithm is actively used - </font></font><a href="http://people.mozilla.org/~jorendorff/es6-draft.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SameValueZero</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , for which it </font></font><code>NaN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is equal to </font></font><code>NaN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and, unlike the previous one, it </font></font><code>-0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is equal to </font></font><code>+0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">They ensure the uniqueness of the </font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># collections</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> key </font><font style="vertical-align: inherit;">; it is used when checking whether an item is in the collection through </font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font><code>Array#includes</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><a name="es6-object-setPrototypeOf"></a><h4> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Object.setPrototypeOf</font></font></b> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In ES6, a method appears for installing a prototype of an existing object </font></font><code>Object.setPrototypeOf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><a href="http://goo.gl/t4wJ4K"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Parent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Child</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{} <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.setPrototypeOf(Child.prototype, Parent.prototype); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Child <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Child; <span class="hljs-comment"><span class="hljs-comment">// =&gt; true new Child instanceof Parent; // =&gt; true function fn(){} Object.setPrototypeOf(fn, []); typeof fn == 'function'; // =&gt; true fn instanceof Array; // =&gt; true var object = {}; Object.setPrototypeOf(object, null); object instanceof Object; // =&gt; false</span></span></code> </pre><br> ,  ,  , ,    ,  ‚Äî ,  ,   ‚Äî     ,   ECMAScript 5.           ‚Äî   <code>__proto__</code> .   ,     ,  IE10-,    ‚Äî  /    <code>Object</code> . <br><br> ,      ,  <code>Object.setPrototypeOf</code>    ‚Äî   <code>__proto__</code>     : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> setPrototypeOf = <span class="hljs-built_in"><span class="hljs-built_in">Function</span></span>.call.bind(<span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.getOwnPropertyDescriptor(<span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.prototype, <span class="hljs-string"><span class="hljs-string">'__proto__'</span></span>).set);</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">However, here another problem appears - in old, but somewhere else actual, versions of v8, the setter </font></font><code>__proto__</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cannot be used as a function. </font><font style="vertical-align: inherit;">To implement </font></font><code>Object.setPrototypeOf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">them, it remains only to set the value by key </font></font><code>__proto__</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> That's how we live: </font></font></h5><br><ul><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For IE10, emulation </font></font><code>Object.setPrototypeOf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is completely missing, since it is impossible.</font></font></b> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In older versions v8 </font></font><code>Object.setPrototypeOf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">does not work, if the prototype chain of the target is absent </font></font><code>Object.prototype</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or property </font></font><code>__proto__</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">overridden through, for example </font></font><code>Object.defineProperty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Also, ECMAScript 6 and our library changes the logic of work </font></font><code>Object#toString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">The topic is serious, but we'll talk about it </font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the second part of the article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><a name="es6-array"></a><h4> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Array methods</font></font></b> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Static methods </font></font><code>Array.from</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>Array.of</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- generics, if they are running in the context of a function other than </font></font><code>Array</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, they create its instances. </font><font style="vertical-align: inherit;">If there is a desire to get acquainted with this in more detail, it is well described in </font></font><a href="http://www.2ality.com/2014/05/es6-array-methods.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this article on new array methods</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><a name="es6-array-from"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ECMAScript 6 adds a very useful method</font></font><code>Array.from</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">This is a universal cast to an array of</font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> # iterable</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and array-like objects. </font><font style="vertical-align: inherit;">In most cases, it will replace</font></font><code>Array.prototype.slice.call</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">without specifying the starting and ending positions. </font><font style="vertical-align: inherit;">Additionally, the method accepts an optional map callback and its execution context. </font><font style="vertical-align: inherit;">In the case of the transfer of the object being iterated and without a map callback, the result is similar to the use of the</font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> # spread</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> operator</font><font style="vertical-align: inherit;">in the array literal -</font></font><code>[...iterable]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><a href="http://goo.gl/h1F9dN"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>.from(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Set</span></span>([<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>])); <span class="hljs-comment"><span class="hljs-comment">// =&gt; [1, 2, 3] Array.from({0: 1, 1: 2, 2: 3, length: 3}); // =&gt; [1, 2, 3] Array.from('123', Number); // =&gt; [1, 2, 3] Array.from('123', function(it){ return it * it; }); // =&gt; [1, 4, 9]</span></span></code> </pre><br><a name="es6-array-of"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Unlike the previous one, the</font></font><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/of"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Array.of</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method is</font><font style="vertical-align: inherit;">currently practically useless. </font><font style="vertical-align: inherit;">It is needed, first of all, for subclasses</font></font><code>Array</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, as an analogue of an array literal</font></font><code>[]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><a href="http://goo.gl/BV1EDC"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>.of(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-comment"><span class="hljs-comment">// =&gt; [1] Array.of(1, 2, 3); // =&gt; [1, 2, 3]</span></span></code> </pre><br><a name="es6-array-find"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The</font></font><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/find"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Array # find</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and</font></font><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/findIndex"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Array # findIndex methods</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> search the array by calling a callback. </font></font><a href="http://goo.gl/Gb8ILU"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isOdd</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">val</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> val % <span class="hljs-number"><span class="hljs-number">2</span></span>; } [<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">23</span></span>, <span class="hljs-number"><span class="hljs-number">42</span></span>].find(isOdd); <span class="hljs-comment"><span class="hljs-comment">// =&gt; 15 [4, 8, 15, 16, 23, 42].findIndex(isOdd); // =&gt; 2 [4, 8, 15, 16, 23, 42].find(isNaN); // =&gt; undefined [4, 8, 15, 16, 23, 42].findIndex(isNaN); // =&gt; -1</span></span></code> </pre><br><a name="es6-array-fill"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></b></a><font style="vertical-align: inherit;"></font><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/fill"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Array</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method</font><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/fill"><font style="vertical-align: inherit;"> # fill</font></a><font style="vertical-align: inherit;"> fill the array with the passed value. </font><font style="vertical-align: inherit;">Optional arguments are starting and ending positions. </font></font><a href="http://goo.gl/34utph"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>(<span class="hljs-number"><span class="hljs-number">5</span></span>).map(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">42</span></span>; }); <span class="hljs-comment"><span class="hljs-comment">// =&gt; [undefined √ó 5],   .map  ""   Array(5).fill(42); // =&gt; [42, 42, 42, 42, 42]</span></span></code> </pre><br><a name="es6-string"></a><h4> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> String methods</font></font></b> </h4><br>  It's simple. <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/includes"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">String # includes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (until recently - </font></font><code>String#contains</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, but </font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font><code>Array#includes</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> drew it along, as long as it is available and by the old name) checks the occurrence of the substring in the string. </font></font><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/startsWith"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">String # startsWith</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/endsWith"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">String # endsWith</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> check if the string begins or ends for a given substring. </font><font style="vertical-align: inherit;">These 3 methods take an additional argument - the starting position. </font></font><a href="http://goo.gl/B5uMrt"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'foobarbaz'</span></span>.includes(<span class="hljs-string"><span class="hljs-string">'bar'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// =&gt; true 'foobarbaz'.includes('bar', 4); // =&gt; false 'foobarbaz'.startsWith('foo'); // =&gt; true 'foobarbaz'.startsWith('bar', 3); // =&gt; true 'foobarbaz'.endsWith('baz'); // =&gt; true 'foobarbaz'.endsWith('bar', 6); // =&gt; true</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The </font></font><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/repeat"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">String # repeat</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><font style="vertical-align: inherit;">returns a string repeated a specified number of times. </font></font><a href="http://goo.gl/UBdYnv"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'string'</span></span>.repeat(<span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-comment"><span class="hljs-comment">// =&gt; 'stringstringstring'</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The library does not add ECMAScript 6/7 methods </font></font><a href="https://github.com/lukehoban/es6features"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for better support of multibyte characters</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and an honest </font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#thread</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> iterator; the array iterator is used for strings. </font><font style="vertical-align: inherit;">Now they are not only because I personally do not need them. </font><font style="vertical-align: inherit;">It would be nice to add them in the near future.</font></font><br><br><a name="es6-math"></a><h4> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Working with numbers</font></font></b> </h4><br>  ECMAScript 6       .      ,  : <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/EPSILON">Number.EPSILON</a> , <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/parseFloat">Number.parseFloat</a> , <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/parseInt">Number.parseInt</a> , <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/isFinite">Number.isFinite</a> , <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/isInteger">Number.isInteger</a> , <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/isNaN">Number.isNaN</a> , <a href="http://www.2ality.com/2013/10/safe-integers.html">Number.MAX_SAFE_INTEGER, Number.MIN_SAFE_INTEGER, Number.isSafeInteger</a> , <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/acosh">Math.acosh</a> , <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/asinh">Math.asinh</a> , <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/atanh">Math.atanh</a> , <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/cbrt">Math.cbrt</a> , <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/clz32">Math.clz32</a> , <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/cosh">Math.cosh</a> , <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/expm1">Math.expm1</a> , <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/hypot">Math.hypot</a> , <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/imul">Math.imul</a> , <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/log1p"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Math.log1p</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/log10"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Math.log10</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/log2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Math.log2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/sign"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Math.sign</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/sinh"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Math.sinh</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/tanh"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Math.tanh</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/trunc"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Math.trunc</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><a name="es6-symbol"></a><h2> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ECMAScript 6: Symbols</font></font></b> </h2><hr><br>  JavaScript        .      ,          ,     .   ECMAScript 5,   <code>enumerable: false</code> ,        <code>for-in</code>   <code>Object.keys</code> ,       ‚Äî   ,    ,     , -   <code>Object.defineProperty</code>  -,   . <br><br>  ECMAScript 6        ‚Äî <a href="https://developer.mozilla.org/ru/docs/Web/JavaScript/Reference/Global_Objects/Symbol">Symbol</a> ,    <a href="http://wiki.ecmascript.org/doku.php%3Fid%3Dharmony:private_name_objects">Name</a> .         . <a href="http://goo.gl/EUsvAf"></a> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Person = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> NAME = <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>(<span class="hljs-string"><span class="hljs-string">'name'</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Person</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[NAME] = name; } Person.prototype.getName = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[NAME]; }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Person; })(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> person = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Person(<span class="hljs-string"><span class="hljs-string">''</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(person.getName()); <span class="hljs-comment"><span class="hljs-comment">// =&gt; '' console.log(person['name']); // =&gt; undefined console.log(person[Symbol('name')]); // =&gt; undefined,   Symbol    for(var key in person)console.log(key); // =&gt;  'getName',       console.log(typeof Symbol()); // =&gt; 'symbol'</span></span></code> </pre><br>      ‚Äî  <code>Object.getOwnPropertySymbols</code>    ,         .          <a href="https://habr.com/ru/post/216997/"># WeakMap</a> . , ,           . <br><br>       v8,   Chrome 38 (    ‚Äî <a href="https://habr.com/ru/post/216997/">#    </a> )     Firefox,   33.     IE,             . <br><br><a name="es6-symbol-polyfill"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Of course, a full-featured polyfill of characters based on ES5 is not possible, but the basic features ‚Äî creating unique</font><font style="vertical-align: inherit;">keys that</font><font style="vertical-align: inherit;">do not participate in crawling an object through</font></font><code>for-in</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">non-returned</font></font><code>Object.keys</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">keys ‚Äî are fairly simple, for example:</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.Symbol || (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> id = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.Symbol = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">description</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>)<span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TypeError</span></span>(<span class="hljs-string"><span class="hljs-string">'Symbol is not a constructor'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> symbol = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.create(<span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>.prototype) , tag = <span class="hljs-string"><span class="hljs-string">'Symbol('</span></span> + description + <span class="hljs-string"><span class="hljs-string">')_'</span></span> + (++id + <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.random()).toString(<span class="hljs-number"><span class="hljs-number">36</span></span>); symbol.tag = tag; <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.defineProperty(<span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.prototype, tag, { <span class="hljs-attr"><span class="hljs-attr">configurable</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">set</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">it</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.defineProperty(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, tag, { <span class="hljs-attr"><span class="hljs-attr">enumerable</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">configurable</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">writable</span></span> : <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span> : it }); } }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> symbol; } <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>.prototype.toString = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.tag; } })();</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When </font></font><code>Symbol</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we </font><font style="vertical-align: inherit;">call, </font><font style="vertical-align: inherit;">we generate a unique key string, for example </font></font><code>"Symbol(description)_m.y9oth2pcqaypsyvi"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,, and by this key we </font></font><code>Object.prototype</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">set the setter. </font><font style="vertical-align: inherit;">When trying to set the value by the key string, to which our ‚Äúsymbol‚Äù is brought, the setter sets the </font></font><code>enumerable: false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">property to the current object. </font><font style="vertical-align: inherit;">However, these "characters" have a huge number of minuses, only a part:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Writes a setter in </font></font><code>Object.prototype</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: Do not particularly abuse, may affect performance.</font></font></li><li>    :  IE8-  (  <a href="https://habr.com/ru/post/216997/"># </a> <code>Object.defineProperty</code> ),     <code>Object.prototype</code> , ¬´¬ª  . </li><li>  ,     <code>Object.prototype</code> (, <code>Object.create(null)</code> ), ¬´¬ª  . </li><li> <code>Symbol() in {}</code>  <code>true</code> ‚Äî        . </li><li> <code>typeof Symbol()</code>   <code>'object'</code> ‚Äî  JavaScript       . </li><li>   <code>Object.getOwnPropertySymbols</code> ‚Äî    <code>Object.getOwnPropertyNames</code>    , , <code>Object.getOwnPropertyNames</code>  ,   ,  ¬´¬ª. </li></ul><br><a name="es6-symbol-pure"></a> <a href="https://habr.com/ru/post/216997/"><b>#</b></a>    ,    ?              ,     <code>Object.prototype</code> ,    .        . <code>Symbol.pure</code> ,    ,  ,  ‚Äî   -     <code>Object.prototype</code> ,  <code>Symbol.set</code> ,     ‚Äî       ,  ‚Äî  ,  <code>Object.defineProperty</code>  <code>enumerable: false</code> .   ,      .          <code>Symbol</code>  <a href="http://goo.gl/DmPIbT"></a> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Person = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> NAME = <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>.pure(<span class="hljs-string"><span class="hljs-string">'name'</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Person</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>.set(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, NAME, name); } Person.prototype.getName = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[NAME]; }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Person; }();</code> </pre><br><a name="es6-reflect-own-keys"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> As noted above,</font></font><code>Object.getOwnPropertySymbols</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we do not add the</font><font style="vertical-align: inherit;">method</font><font style="vertical-align: inherit;">. And you want to have a more or less universal, moreover, standardized way to bypass all keys, both strings and characters. ECMAScript 6 adds a</font></font><a href="http://people.mozilla.org/~jorendorff/es6-draft.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> module</font></font><code>Reflect</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - first of all, a</font></font><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> set of stubs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for</font></font><code>Proxy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Since we do not have the ability to emulate</font></font><code>Proxy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font><code>Reflect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we don‚Äôt really need the</font><font style="vertical-align: inherit;">module</font><font style="vertical-align: inherit;">. However, it has a method</font></font><code>Reflect.ownKeys</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that returns all the object's own keys ‚Äî both strings and symbols, i.e.</font></font><code>Object.getOwnPropertyNames + Object.getOwnPropertySymbols</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Add this method.</font></font><a href="http://goo.gl/fyu6pn"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> O = {<span class="hljs-attr"><span class="hljs-attr">a</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>}; <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.defineProperty(O, <span class="hljs-string"><span class="hljs-string">'b'</span></span>, {<span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>}); O[<span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>(<span class="hljs-string"><span class="hljs-string">'c'</span></span>)] = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">Reflect</span></span>.ownKeys(O); <span class="hljs-comment"><span class="hljs-comment">// =&gt; ['a', 'b', Symbol(c)]</span></span></code> </pre><br><a name="es6-symbol-registry"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Also ES6 adds such a dubious thing as the global case of characters. </font><font style="vertical-align: inherit;">There are a couple of methods for working with it -</font></font><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol/for"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Symbol.for</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and</font></font><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol/keyFor"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Symbol.keyFor</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><code>Symbol.for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">searches in a register and returns a character by key-string, does not find it - creates a new one, adds it to the register and returns it. </font></font><code>Symbol.keyFor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">returns the string which in the register corresponds to the passed character. </font></font><a href="http://goo.gl/0pdJjX"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> symbol = <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>.for(<span class="hljs-string"><span class="hljs-string">'key'</span></span>); symbol === <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>.for(<span class="hljs-string"><span class="hljs-string">'key'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// true Symbol.keyFor(symbol); // 'key'</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In addition, the library actively uses the symbols </font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font><code>Symbol.iterator</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font><code>Symbol.toStringTag</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><a name="es6-collections"></a><h2> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ECMAScript 6: Collections</font></font></b> </h2><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In ECMAScript 6, 4 new types of collections appear: </font></font><code>Map, Set, WeakMap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>WeakSet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">There are also </font></font><a href="http://habrahabr.ru/post/119694/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typed arrays</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , but for now we can do without them.</font></font><br><br><ul><li> <a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Description of collections</font></font></a> </li><li> <a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Support for engines</font></font></a> </li><li> <a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Implementation </font></font><code>Map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and</font></font><code>Set</code></a> </li><li> <a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Implementation of loosely coupled collections</font></font></a> </li></ul><br><a name="es6-collections-overview"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> So, what are these collections?</font></font><br><br><a name="es6-map"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># </font></font></b></a> <b><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Map</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - collection key - value, any JavaScript entities can act as keys - both primitives and objects. </font><font style="vertical-align: inherit;">It is possible to bypass - they have</font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> # iterators</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and method</font></font><code>.forEach</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, the number of elements is available through the property</font></font><code>.size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><a href="http://goo.gl/RDbROF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = [<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> map = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>([[<span class="hljs-string"><span class="hljs-string">'a'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>], [<span class="hljs-number"><span class="hljs-number">42</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>]]); map.set(a, <span class="hljs-number"><span class="hljs-number">3</span></span>).set(<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(map.size); <span class="hljs-comment"><span class="hljs-comment">// =&gt; 4 console.log(map.has(a)); // =&gt; true console.log(map.has([1])); // =&gt; false console.log(map.get(a)); // =&gt; 3 map.forEach(function(val, key){ console.log(val); // =&gt; 1, 2, 3, 4 console.log(key); // =&gt; 'a', 42, [1], true }); map.delete(a); console.log(map.size); // =&gt; 3 console.log(map.get(a)); // =&gt; undefined console.log(Array.from(map)); // =&gt; [['a', 1], [42, 2], [true, 4]]</span></span></code> </pre><br><a name="es6-set"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># </font></font></b></a> <b><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Set</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - collection of unique values. </font><font style="vertical-align: inherit;">Like u</font></font><code>Map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, there is the possibility of a detour. </font></font><a href="http://goo.gl/7XYya3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> set = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Set</span></span>([<span class="hljs-string"><span class="hljs-string">'a'</span></span>, <span class="hljs-string"><span class="hljs-string">'b'</span></span>, <span class="hljs-string"><span class="hljs-string">'a'</span></span>, <span class="hljs-string"><span class="hljs-string">'c'</span></span>]); set.add(<span class="hljs-string"><span class="hljs-string">'d'</span></span>).add(<span class="hljs-string"><span class="hljs-string">'b'</span></span>).add(<span class="hljs-string"><span class="hljs-string">'e'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(set.size); <span class="hljs-comment"><span class="hljs-comment">// =&gt; 5 console.log(set.has('b')); // =&gt; true set.forEach(function(it){ console.log(it); // =&gt; 'a', 'b', 'c', 'd', 'e' }); set.delete('b'); console.log(set.size); // =&gt; 4 console.log(set.has('b')); // =&gt; false console.log(Array.from(set)); // =&gt; ['a', 'c', 'd', 'e']</span></span></code> </pre><br><a name="es6-weakmap"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># </font></font></b></a> <b><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WeakMap</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is a key-value collection,</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> only objects</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> can act as keys</font><font style="vertical-align: inherit;">. It uses a weak link ‚Äî when the key object is deleted (by the garbage collector), the key-value pair is removed from the collection. There is no way around - there is no iterator and method</font></font><code>.forEach</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, there is no property</font></font><code>.size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. This is another way to store private data, more ‚Äúhonest‚Äù, but also</font></font><a href="https://esdiscuss.org/topic/weakmap-better-than-private-symbols-was-direct-proxies-problem"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> more resource-intensive</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , compared with the use of</font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> # symbols</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . If in the future JavaScript will add</font></font><a href="https://github.com/zenparsing/es-abstract-refs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> abstract references</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , a convenient syntax will appear for such private fields.</font></font><a href="http://goo.gl/wCvuq3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = [<span class="hljs-number"><span class="hljs-number">1</span></span>] , b = [<span class="hljs-number"><span class="hljs-number">2</span></span>] , c = [<span class="hljs-number"><span class="hljs-number">3</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> wmap = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">WeakMap</span></span>([[a, <span class="hljs-number"><span class="hljs-number">1</span></span>], [b, <span class="hljs-number"><span class="hljs-number">2</span></span>]]); wmap.set(c, <span class="hljs-number"><span class="hljs-number">3</span></span>).set(b, <span class="hljs-number"><span class="hljs-number">4</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(wmap.has(a)); <span class="hljs-comment"><span class="hljs-comment">// =&gt; true console.log(wmap.has([1])); // =&gt; false console.log(wmap.get(a)); // =&gt; 1 wmap.delete(a); console.log(wmap.get(a)); // =&gt; undefined //      var Person = (function(){ var names = new WeakMap; function Person(name){ names.set(this, name); } Person.prototype.getName = function(){ return names.get(this); }; return Person; })(); var person = new Person(''); console.log(person.getName()); // =&gt; '' for(var key in person)console.log(key); // =&gt;  'getName'</span></span></code> </pre><br><a name="es6-weakset"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># </font></font></b></a> <b><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakSet"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WeakSet</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - well, you understand. </font><font style="vertical-align: inherit;">Appeared in the draft specification relatively recently, so it has a rather weak browser support. </font></font><a href="http://goo.gl/TdFbEx"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = [<span class="hljs-number"><span class="hljs-number">1</span></span>] , b = [<span class="hljs-number"><span class="hljs-number">2</span></span>] , c = [<span class="hljs-number"><span class="hljs-number">3</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> wset = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">WeakSet</span></span>([a, b, a]); wset.add(c).add(b).add(c); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(wset.has(b)); <span class="hljs-comment"><span class="hljs-comment">// =&gt; true console.log(wset.has([2])); // =&gt; false wset.delete(b); console.log(wset.has(b)); // =&gt; false</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All of these collections </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">should</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> provide sublinear search time. </font><font style="vertical-align: inherit;">Key uniqueness is provided by the </font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># SameValueZero</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> comparison algorithm </font><font style="vertical-align: inherit;">.</font></font><br><br><a name="es6-collections-support"></a> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> What's with the support of these collections in modern engines js? </font><font style="vertical-align: inherit;">Not bad at all.</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Firefox</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> there is full </font></font><code>Map, Set</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>WeakMap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">In the nightly assemblies appeared and </font></font><code>WeakSet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><code>Map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>Set</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">take the object being iterated. </font></font><code>Map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>Set</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">have iterators and a method </font></font><code>.forEach</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li><li>  <b>v8</b> ‚Äî  <b>Chrome, Opera  Node.js</b> ,   4   .   Chrome 38,       .     <code>WeakMap</code>  <code>WeakSet</code> .       <a href="https://habr.com/ru/post/216997/">#    </a> .     v8     ,   <code>Map</code>  <code>Set</code>     <code>.forEach</code> ,    <code>Map</code>  <code>Set</code>  ,   . </li><li>  <b>IE11</b>    <code>Map, Set</code>  <code>WeakMap</code> .     . <code>Map</code>  <code>Set</code>   ,      <code>.forEach</code> . </li><li>  <b>Safari</b>   ,    .  <code>Map, Set</code>  <code>WeakMap</code> .   .  ,  ,  , , ,      <code>next</code> .  <code>forEach</code> ,       3 ,   ,   1  <code>Set</code>  2  <code>Map</code> . </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In almost all current implementations, the collection methods </font></font><code>.add</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>.set</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">do not return </font></font><code>this</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- to fill the collection with a chain of these methods will not work. </font><font style="vertical-align: inherit;">But it is easily treated. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To initialize the collection with an iterator, it is also sufficient to wrap the constructor, which will create the collection and add elements. </font><font style="vertical-align: inherit;">About the iterators themselves, let's talk in the </font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">next chapter</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Well, the polyphiles of the collections themselves will be considered further. </font><font style="vertical-align: inherit;">Full implementation of these collections - fast, clean and without memory leaks (for WeakMap), based on ECMAScript 5 is impossible, however, you can find a reasonable compromise.</font></font><br><br><a name="es6-map-set"></a><h4> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Implementation of Map and Set</font></font></b> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What do most polyphils represent implementations of </font></font><code>Map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? </font><font style="vertical-align: inherit;">In the instance </font></font><code>Map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 2 arrays, keys and values. </font><font style="vertical-align: inherit;">When an item is received, we look for a match in the array of keys and return the element from the array of values ‚Äã‚Äãat the resulting index. </font><font style="vertical-align: inherit;">Or, to optimize the deletion, an alternative option is a chain of entry objects. </font><font style="vertical-align: inherit;">What is wrong in both cases? </font><font style="vertical-align: inherit;">This is very slow, the complexity of the search element - O (n), the complexity of the operation uniq - O (n </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">What does it threaten us with? </font><font style="vertical-align: inherit;">Here is a small test:</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> array = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">100000</span></span>; i++)array.push([{}, {}]); array = array.concat(array); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.time(<span class="hljs-string"><span class="hljs-string">'Map test'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> map = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>(array); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.timeEnd(<span class="hljs-string"><span class="hljs-string">'Map test'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Map size: '</span></span> + map.size);</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We create an array of 200,000 thousand pairs of objects (future key-value), 100,000 of which are unique, and then create a collection from this array </font></font><code>Map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Test native </font></font><code>Map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, for example, in Firefox:</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Map</span></span> test:   <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span> test: <span class="hljs-number"><span class="hljs-number">46.25</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span> size: <span class="hljs-number"><span class="hljs-number">100000</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And now it‚Äôs </font></font><code>Map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from the </font></font><a href="https://github.com/paulmillr/es6-shim"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">most popular</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ECMAScript 6 polyfile:</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Map</span></span> test:   <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span> test: <span class="hljs-number"><span class="hljs-number">506823.31</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span> size: <span class="hljs-number"><span class="hljs-number">100000</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">About 8.5 minutes. </font><font style="vertical-align: inherit;">When you try to add each new item you have to go through up to 100,000 already added ones. </font><font style="vertical-align: inherit;">From this we can conclude that this approach is suitable only for very small collections. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Polyline sublinear speed can be achieved using hash tables. </font><font style="vertical-align: inherit;">In ECMAScript 5 it is only </font></font><code>Object</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that accepts only strings as keys. </font><font style="vertical-align: inherit;">In the polyfile tested above, there is a small optimization - the search index for a key-string or a number through a simple function, which reduces the average difficulty of searching for a collection item to O (1):</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fastKey</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">key</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> key === <span class="hljs-string"><span class="hljs-string">'string'</span></span>)<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'$'</span></span> + key; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> key === <span class="hljs-string"><span class="hljs-string">'number'</span></span>)<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> key; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; };</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Similarly, you can implement quick access for other primitives. That's just why you need </font></font><code>Map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, as keys which you can effectively use only primitives? </font></font><code>Object.create(null)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">it </font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">perfectly copes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> with this </font><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Just take and get a unique string identifier for the key object will not work. Therefore, it is necessary to slightly break the rules. Let's add a symbol with an identifier to key objects, if necessary.</font></font> Like that: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> STOREID = <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>(<span class="hljs-string"><span class="hljs-string">'storeId'</span></span>) , id = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fastKey</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">it</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    'S'      'P'    if(it !== Object(it))return (typeof it == 'string' ? 'S' : 'P') + it; //      -  if(!Object.hasOwnProperty.call(it, STOREID))it[STOREID] = ++id; //     'O' return 'O' + it[STOREID]; }</span></span></code> </pre><br>  <code>Map</code>   2    -,   2  <code>Object</code> ,      .    /          :         ,   -,        -,  . , : <br><br><pre> <code class="hljs javascript"><span class="hljs-built_in"><span class="hljs-built_in">Map</span></span> test:   <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span> test: <span class="hljs-number"><span class="hljs-number">669.93</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span> size: <span class="hljs-number"><span class="hljs-number">100000</span></span></code> </pre><br> ,  , , ,  . ,      - ‚Äî      <a href="https://habr.com/ru/post/216997/"># frozen-</a> ,      . <code>Set</code>  ,  1 . <br><br><a name="es6-weak"></a><h4> <b><a href="https://habr.com/ru/post/216997/">#</a>   </b> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Weakly coupled collections are even easier to implement. </font><font style="vertical-align: inherit;">They have no iterators, methods </font></font><code>.forEach</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, properties </font></font><code>.size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">In the case of storing keys and values ‚Äã‚Äãin the collection object, it will no longer be loosely coupled - the keys / values ‚Äã‚Äãwill not be deleted, we will get just a trimmed version </font></font><code>Set</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>Map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">The only more or less reasonable solution has long been known - to keep the values ‚Äã‚Äãon the key, and in the collection object only its identifier. </font><font style="vertical-align: inherit;">Since values ‚Äã‚Äãare stored on the key, full privacy of the stored data is lost in the polyfile.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Strongly simplified implementation looks like this:</font></font></b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.WeakMap || (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> id = <span class="hljs-number"><span class="hljs-number">0</span></span> , has = <span class="hljs-built_in"><span class="hljs-built_in">Function</span></span>.call.bind(<span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.prototype.hasOwnProperty) , WEAKDATA = <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>(<span class="hljs-string"><span class="hljs-string">'WeakData'</span></span>) , ID = <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>(<span class="hljs-string"><span class="hljs-string">'ID'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.WeakMap = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> <span class="hljs-built_in"><span class="hljs-built_in">WeakMap</span></span>))<span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TypeError</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[ID] = id++; } <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.assign(<span class="hljs-built_in"><span class="hljs-built_in">WeakMap</span></span>.prototype, { <span class="hljs-string"><span class="hljs-string">'delete'</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">key</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.has(key) &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> key[WEAKDATA][<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[ID]]; }, <span class="hljs-attr"><span class="hljs-attr">has</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">key</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> key === <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>(key) &amp;&amp; has(key, WEAKDATA) &amp;&amp; has(key[WEAKDATA], <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[ID]); }, <span class="hljs-attr"><span class="hljs-attr">get</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">key</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(key === <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>(key) &amp;&amp; has(key, WEAKDATA))<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> key[WEAKDATA][<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[ID]]; }, <span class="hljs-attr"><span class="hljs-attr">set</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">key, value</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(key !== <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>(key))<span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TypeError</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!has(key, WEAKDATA))key[WEAKDATA] = {}; key[WEAKDATA][<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[ID]] = value; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } }); })();</code> </pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Let's make sure that when deleting a key reference it does not remain in the collection and, accordingly, the memory does not leak: </font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// &lt;-   snapshot 1 var array = []; for(var i = 0; i &lt; 100000; i++)array[i] = {}; var wm = new WeakMap(); for(var i = 0; i &lt; 100000; i++)wm.set(array[i], {}); // &lt;-   snapshot 2 array = null; // &lt;-   snapshot 3</span></span></code> </pre><br><img src="//habrastorage.org/files/7b2/a07/b54/7b2a07b54f664478a8b7a25be220cbe2.png"><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But in some cases, the problem of memory leaks remains. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After deleting a collection object, the value will remain associated with the key, which will lead to a memory leak until the object that was the key is deleted. </font><font style="vertical-align: inherit;">So, in a good way, the system should be designed in such a way that the collections would </font></font><code>WeakMap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">live longer than their keys. </font><font style="vertical-align: inherit;">Someone is </font></font><a href="https://habr.com/company/uprock/blog/200644/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trying to</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> circumvent the problem of memory leakage, but this is from the category of esotericism - </font></font><a href="https://habr.com/company/uprock/blog/200644/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memory leaks exactly in the same cases</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The implementation of </font></font><code>WeakSet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this problem remains, but minimized - instead of the value that can be a heavy object, only the presence flag in the collection is stored on the key.</font></font><br><br><a name="es6-iterators"></a><h2> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ECMAScript 6: Iterators</font></font></b> </h2><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In ECMAScript 6, an iterator protocol appeared - a universal way to bypass collections, and not only. </font><font style="vertical-align: inherit;">Since it includes syntactic constructions, we will consider them as well. </font><font style="vertical-align: inherit;">But, first of all, it is not part of the standard library or syntax, but a concept. </font><font style="vertical-align: inherit;">The protocol iterators include:</font></font><br><br><ul><li> <a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Iterator interface</font></font></a> </li><li> <a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Interface of the object being iterated, symbol </font></font><code>Symbol.iterator</code></a> </li><li> <a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Generators</font></font></a> </li><li> <a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Cycle </font></font><code>for-of</code></a> </li><li> <a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Iterators of instances of built-in constructors and methods that return them</font></font></a> </li><li> <a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Methods and constructors taking iterable objects</font></font></a> </li><li> <a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Operator spread</font></font></a> </li><li> <a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Array / generator comprehensions</font></font></a> </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since part of this is syntax, in this chapter we will also consider a module </font></font><code>$for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that implements some of the capabilities of these syntactic constructions. </font><font style="vertical-align: inherit;">If you are going to use the library with the </font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ES6 + # preprocessor</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , you can safely build it without this module.</font></font><br><br><a name="es6-iter-interface"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></b></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Iterator</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - an object that has a method</font></font><code>.next</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that should return an object with fields</font></font><code>.done</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- whether the iterator traversal is completed, and</font></font><code>.value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is the value of the current step. </font><font style="vertical-align: inherit;">An example is a method that creates an iterator for a positive number, allowing you to bypass all integers from 0 to the given (</font></font><a href="http://goo.gl/j9evDY"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sandbox</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NumberIterator</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">number</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">next</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i &lt; number ? {<span class="hljs-attr"><span class="hljs-attr">done</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: i++} : {<span class="hljs-attr"><span class="hljs-attr">done</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>}; } } } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> iter = NumberIterator(<span class="hljs-number"><span class="hljs-number">3</span></span>); iter.next(); <span class="hljs-comment"><span class="hljs-comment">// =&gt; {done: false, value: 0} iter.next(); // =&gt; {done: false, value: 1} iter.next(); // =&gt; {done: false, value: 2} iter.next(); // =&gt; {done: true}</span></span></code> </pre><br><a name="es6-iterable-interface"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></b></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Iterated object</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Iterable) - an object that has a key</font></font><code>Symbol.iterator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">containing a method that returns an iterator for it. </font><font style="vertical-align: inherit;">Accordingly, in order for an iterator to be iterable,</font></font><code>Symbol.iterator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">it should have a method that returns a</font><font style="vertical-align: inherit;">key</font></font><code>this</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">For example, let's make numbers iterable (</font></font><a href="http://goo.gl/598H0u"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sandbox</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>.prototype[<span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>.iterator] = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> NumberIterator(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>.from(<span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-comment"><span class="hljs-comment">// =&gt; [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pay attention to </font></font><code>Symbol.iterator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Firefox supports the iterator protocol, but in it, in stable assemblies, there are no </font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># characters</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and the </font></font><code>Symbol.iterator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">string is used </font><font style="vertical-align: inherit;">instead </font></font><code>"@@iterator"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Symbols and even appeared in the nightly assemblies </font></font><code>Symbol.iterator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, but the string is still used in the iterator protocol </font></font><code>"@@iterator"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. In order not to break the protocol of iterators in Firefox, in it in our library we will duplicate methods for getting an iterator both by key </font></font><code>Symbol.iterator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(create, if absent), and by key </font></font><code>"@@iterator"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. In v8, full support for the iterator protocol appeared with Chrome 38.</font></font><br><br><a name="es6-generators"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></b></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A generator</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is a function that can be suspended. </font><font style="vertical-align: inherit;">Returns an object with an extended iterator interface. </font><font style="vertical-align: inherit;">We will not discuss them in detail - syntax - see, for example, in</font></font><a href="http://habrahabr.ru/post/210330/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> this</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> article. </font><font style="vertical-align: inherit;">For the preprocessor, perhaps the most terrible part of ECMAScript 6. The example with iterated numbers when using the generator looks quite simple (</font></font><a href="http://goo.gl/L6IE5S"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sandbox</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>.prototype[<span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>.iterator] = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">*(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>;)<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> i++; } <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>.from(<span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-comment"><span class="hljs-comment">// =&gt; [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</span></span></code> </pre><br><a name="es6-for-of"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></b></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The loop is</font></font><code>for-of</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> designed to bypass the iterated objects. </font><font style="vertical-align: inherit;">In our example with iterated numbers, it works like this (</font></font><a href="http://goo.gl/Hcnp3z"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sandbox</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> num <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>)<span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(num); <span class="hljs-comment"><span class="hljs-comment">// =&gt; 0, 1, 2, 3, 4</span></span></code> </pre><br><a name="es6-native-iterables"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In ECMAScript 6 distortions are iterable</font></font><code>String, Array, Map, Set</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and</font></font><code>Arguments</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">In addition,</font></font><code>Array, Map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and</font></font><code>Set</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">have methods</font></font><code>.keys, .values</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and</font></font><code>.entries</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which return iterators, respectively, by key, value, and key-value pair. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Core.js adds data iterators and methods. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Together with the cycle</font></font><code>for-of</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">it looks like this (</font></font><a href="http://goo.gl/ArArLq"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sandbox</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> string = <span class="hljs-string"><span class="hljs-string">'abc'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> val <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> string)<span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(val); <span class="hljs-comment"><span class="hljs-comment">// =&gt; 'a', 'b', 'c' var array = ['a', 'b', 'c']; for(var val of array)console.log(val); // =&gt; 'a', 'b', 'c'.    - .values for(var val of array.values())console.log(val); // =&gt; 'a', 'b', 'c' for(var key of array.keys())console.log(key); // =&gt; 0, 1, 2 for(var [key, val] of array.entries()){ console.log(key); // =&gt; 0, 1, 2 console.log(val); // =&gt; 'a', 'b', 'c' } var map = new Map([['a', 1], ['b', 2], ['c', 3]]); for(var [key, val] of map){ //    - .entries console.log(key); // =&gt; 'a', 'b', 'c' console.log(val); // =&gt; 1, 2, 3 } for(var val of map.values())console.log(val); // =&gt; 1, 2, 3 for(var key of map.keys())console.log(key); // =&gt; 'a', 'b', 'c' for(var [key, val] of map.entries()){ console.log(key); // =&gt; 'a', 'b', 'c' console.log(val); // =&gt; 1, 2, 3 } var set = new Set([1, 2, 3, 2, 1]); for(var val of set)console.log(val); // =&gt; 1, 2, 3.    - .values for(var val of set.values())console.log(val); // =&gt; 1, 2, 3 for(var key of set.keys())console.log(key); // =&gt; 1, 2, 3.  .keys  .values for(var [key, val] of set.entries()){ //  Set   .entries     console.log(key); // =&gt; 1, 2, 3 console.log(val); // =&gt; 1, 2, 3 } var list = (function(){return arguments})(1, 2, 3); for(var val of list)console.log(val); // =&gt; 1, 2, 3</span></span></code> </pre><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The current Firefox has all of these iterators, except the iterator </font></font><code>arguments</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">The cycle works, but on the basis of its own, outdated, protocol.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In v8, the loop </font></font><code>for-of</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, starting with Chrome 38, works correctly (not counting the destruction of the array) and all of these iterators are available, except </font></font><code>arguments</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">In older versions (with a checkbox), an iterator was expected, not an iterated object.</font></font></li><li>  IE,  ,        . </li></ul><br><a name="for-of-helper"></a> <a href="https://habr.com/ru/post/216997/"><b>#</b></a>         ,  ,     ES6+,    ,  ,  <code>for-of</code> ( <a href="http://goo.gl/B1QWlf"></a> ): <br><br><pre> <code class="javascript hljs">$<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Set</span></span>([<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>])).of(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">it</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(it); <span class="hljs-comment"><span class="hljs-comment">// =&gt; 1, 2, 3 }); // 2  $for -  entries -    2  $for([1, 2, 3].entries(), true).of(function(key, value){ console.log(key); // =&gt; 0, 1, 2 console.log(value); // =&gt; 1, 2, 3 }); // 2  .of -    $for('abc').of(console.log, console); // =&gt; 'a', 'b', 'c' //    ,    false $for([1, 2, 3, 4, 5]).of(function(it){ console.log(it); // =&gt; 1, 2, 3 if(it == 3)return false; });</span></span></code> </pre><br><a name="iter-helpers"></a> <a href="https://habr.com/ru/post/216997/"><b>#</b></a>   <code>arguments</code> ‚Äî <code>Object.prototype</code> ,             .     <b>core.js</b>  ,    .   ,    ,  ,          ‚Äî <code>$for.isIterable(foo)</code> ,   <code>Symbol.iterator in foo</code>  <code>$for.getIterator(foo)</code> ,   <code>foo[Symbol.iterator]()</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> list = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>})(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log($<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>.isIterable(list)); <span class="hljs-comment"><span class="hljs-comment">// =&gt; true console.log($for.isIterable({})); // =&gt; false var iter = $for.getIterator(list); console.log(iter.next()); // =&gt; {value: 1, done: false} console.log(iter.next()); // =&gt; {value: 2, done: false} console.log(iter.next()); // =&gt; {value: 3, done: false} console.log(iter.next()); // =&gt; {value: undefined, done: true}</span></span></code> </pre><br><a name="es6-use-iter"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In ECMAScript 6, iterators are used to initialize</font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> # collections</font></font></a> <code>Map, Set, WeakMap, WeakSet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , arrays</font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> # through</font></font><code>Array.from</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , they expect methods</font></font><code>Promise.all, Promise.race</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to work with</font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> # promises</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><a name="es6-spread"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The</font></font><a href="http://www.2ality.com/2011/08/spreading.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> spread</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> operator</font><font style="vertical-align: inherit;">, applicable when calling functions, constructors, and in an array literal, also expects an object to be iterated, but this is already a topic quite distant from the standard library. </font><font style="vertical-align: inherit;">There is a desire to use already now - preprocessors in the teeth. </font></font><a href="http://goo.gl/sf7BPy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs">[...new <span class="hljs-built_in"><span class="hljs-built_in">Set</span></span>([<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>])]; <span class="hljs-comment"><span class="hljs-comment">// =&gt; [1, 2, 3] console.log(1, ...[2, 3, 4]); // =&gt; 1, 2, 3, 4 var map = new Map([[1, 'a'], [2, 'b']]); new Array(...map.keys(), 3); // =&gt; [1, 2, 3]</span></span></code> </pre><br><a name="es6-comprehensions"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Everything else, the</font></font><a href="http://www.2ality.com/2013/01/comprehensions.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> array / generator comprehensions</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> protocol is also an iterator protocol</font><font style="vertical-align: inherit;">(</font></font><a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25BF%25D0%25B8%25D1%2581%25D0%25BA%25D0%25BE%25D0%25B2%25D0%25BE%25D0%25B5_%25D0%25B2%25D0%25BA%25D0%25BB%25D1%258E%25D1%2587%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> array / generator abstraction?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Previously, they were present in the draft ECMAScript 6, but postponed to ECMAScript 7, although they have long been supported in</font></font><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Array_comprehensions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Firefox</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">This is the ability to generate an array or iterator from an iterated object with filtering and conversion.</font></font> Those. <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">syntax </font></font><code>filter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for any iterated objects</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Examples, except for the latter - the array destruction is not supported, they work in </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FF</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">In </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6to5</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Traceur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> everything works. </font></font><a href="http://goo.gl/mz9zv2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ar1 = [<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(i <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>])i * i]; <span class="hljs-comment"><span class="hljs-comment">// =&gt; [1, 4, 9] var set = new Set([1, 2, 3, 2, 1]); var ar2 = [for(i of set)if(i % 2)i * i]; // =&gt; [1, 9] var iter = (for(i of set)if(i % 2)i * i); iter.next(); // =&gt; {value: 1, done: false} iter.next(); // =&gt; {value: 9, done: false} iter.next(); // =&gt; {value: undefined, done: true} var map1 = new Map([['a', 1], ['b', 2], ['c', 3]]); var map2 = new Map((for([k, v] of map1)if(v % 2)[k + k, v * v])); // =&gt; Map {aa: 1, cc: 9}</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As for me - amazing thing. </font><font style="vertical-align: inherit;">That's just the syntax too.</font></font><br><br><a name="for"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> For those who do not intend to use the ES6 preprocessor, we will add this, quite a bicycle, within the module</font></font><code>$for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. The call</font></font><code>$for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">returns an iterator, extended by methods</font></font><code>of</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, about which,</font></font><code>filter, map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and</font></font><code>array</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Methods</font></font><code>filter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and</font></font><code>map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">return an iterator that, respectively, filters or converts the values ‚Äã‚Äãof the previous iterator. This iterator is extended by the same methods as the iterator</font></font><code>$for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. The method</font></font><code>array</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">converts the current iterator into an array; it accepts an optional map callback. For all these methods, the second, optional, argument is the execution context. If it</font></font><code>$for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">accepts the flag</font></font><code>entries</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, all the chain callbacks are started with a couple of arguments.</font></font><br><br> <a href="http://goo.gl/JHecXL"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ar1 = $<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>([<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>]).array(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> v * v; }); <span class="hljs-comment"><span class="hljs-comment">// =&gt; [1, 4, 9] var set = new Set([1, 2, 3, 2, 1]); var ar1 = $for(set).filter(function(v){ return v % 2; }).array(function(v){ return v * v; }); // =&gt; [1, 9] var iter = $for(set).filter(function(v){ return v % 2; }).map(function(v){ return v * v; }); iter.next(); // =&gt; {value: 1, done: false} iter.next(); // =&gt; {value: 9, done: false} iter.next(); // =&gt; {value: undefined, done: true} var map1 = new Map([['a', 1], ['b', 2], ['c', 3]]); var map2 = new Map($for(map1, true).filter(function(k, v){ return v % 2; }).map(function(k, v){ return [k + k, v * v]; })); // =&gt; Map {aa: 1, cc: 9}</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">With the literal function from ES5 comes out pretty cumbersome, but with the arrow functions will be almost the same as using the syntax comprehensions. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It would be possible to add other operations on iterators to the module </font></font><code>$for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which would give a universal and lazy (such is the iterator protocol) method of traversing and transforming iterable objects. </font><font style="vertical-align: inherit;">But postpone it for the future. </font><font style="vertical-align: inherit;">And maybe to hell. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The library adds a couple of iterators ( </font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># once</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># two</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), the constructor </font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font><code>Dict</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> expects the object to be iterated, but we will not drag all the bicycles associated with the iterators into this chapter.</font></font><br><br><a name="es6-promise"></a><h2> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ECMAScript 6: Promises</font></font></b> </h2><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Asynchrony and JavaScript for many are almost synonyms. That's just about asynchrony in the ECMAScript 5 standard there is nothing at all. Even such basic methods, as </font></font><code>setTimeout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">well </font><font style="vertical-align: inherit;">as </font></font><code>setInterval</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, are provided by the W3C and WHATWG web standards, </font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> let </font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;">'s talk about them a little further</font></a><font style="vertical-align: inherit;"> . Unless functions as objects of the first class - convenient transfer of callbacks. This generates a </font></font><a href="http://callbackhell.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">callback ad</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . One way to simplify parallel and sequential execution of asynchronous functions is libraries like </font></font><a href="https://github.com/caolan/async"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">async.js</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Another approach to simplifying asynchronous programming is the Promise template. With the help of the promising object that an asynchronous function can return, you can subscribe to its result. Methods by which you can subscribe to the result, return new promises, which helps to better structure the code, building promises in chains. Also, promises solve the problem of error handling: in asynchronous code it </font></font><code>try-catch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">does not work, you have to pass errors with callback arguments, which sometimes confuses the code even more. At the end of the chain of promises, you can subscribe to any mistake that may arise in it - either abandoned by the method </font></font><code>reject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or through </font></font><code>throw</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Promise libraries such as </font></font><a href="https://github.com/kriskowal/q"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RSVP are</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> popular </font><font style="vertical-align: inherit;">. Over time, the standard appeared</font></font><a href="http://promisesaplus.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Promises / A +</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , according to which all promises are resolved asynchronously, and the result can be subscribed using the method </font></font><code>.then</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(the first argument is a function that will be executed upon successful completion, the second - if an error occurs). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And so, in order to finally standardize work with asynchronous code, in ECMAScript 6 was </font></font><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">added the implementation of promises</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , compatible with the standard Promises / A + and with minimal, but covering most of the needs, functionality. I will not paint them in particular, I can get acquainted with them in detail </font></font><a href="http://www.html5rocks.com/en/tutorials/es6/promises/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><a href="http://habrahabr.ru/post/209662/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">translation, but slightly outdated</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), </font></font><a href="http://www.2ality.com/2014/10/es6-promises-api.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or </font></font><a href="http://habrahabr.ru/post/242767/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ES6 Promise is already available in v8 and Firefox, there are polyfiles - </font></font><a href="https://github.com/jakearchibald/es6-promise"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">es6-promise</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and</font></font><a href="https://github.com/getify/native-promise-only"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">native-promise-only</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><a name="es6-promise-constructor"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The implementation of promises from ECMAScript 6 is a constructor</font></font><code>Promise</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that accepts a function to which 2 callbacks are passed - the first one resolves the promise, the second one completes with an error. </font><font style="vertical-align: inherit;">In addition</font></font><code>then</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, the promises of ES6 contain a method</font></font><code>catch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- an abbreviation for</font></font><code>then</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with the first argument omitted; with it, you can subscribe to an error. </font></font><a href="http://goo.gl/z3bXC8"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> log = <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log.bind(<span class="hljs-built_in"><span class="hljs-built_in">console</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sleepRandom</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">time</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve, reject</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">// resolve   , reject -   //      setTimeout(resolve, time * 1e3, 0 | Math.random() * 1e3); }); } log(''); // =&gt;  sleepRandom(5).then(function(result){ log(result); // =&gt; 869,  5 . return sleepRandom(10); }).then(function(result){ log(result); // =&gt; 202,  10 . }).then(function(){ log('  '); // =&gt;    throw Error('!'); }).then(function(){ log('   - '); }).catch(log); // =&gt; Error: '!'</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since I was too lazy to completely adapt my promise engine to the standard, the core core of </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">core.js</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> promises </font><font style="vertical-align: inherit;">is based on the native-promise-only library, from the code of which there is not much left. </font><font style="vertical-align: inherit;">To ensure asynchrony is used </font></font><code>process.nextTick</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and the methods of the </font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># setImmediate polyfil</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><a name="es6-promise-resolve-reject"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A pair of helpers</font></font><code>Promise.resolve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and</font></font><code>Promise.reject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">return a promise completed, respectively, successfully or with an error with the value passed to them. If he</font></font><code>Promise.resolve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">accepts a promise, he returns it. It can also be used to convert other thenables (for example, jQuery Deferred) into promises, in the old version of the standard there was a separate method for this</font></font><code>Promise.cast</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><a href="http://goo.gl/vr8TN3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>.resolve(<span class="hljs-number"><span class="hljs-number">42</span></span>).then(log); <span class="hljs-comment"><span class="hljs-comment">// =&gt; 42 Promise.reject(42).catch(log); // =&gt; 42 Promise.resolve($.getJSON('/data.json')); // =&gt; ES6 promise</span></span></code> </pre><br><a name="es6-promise-all"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Helper</font></font><code>Promise.all</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">returns a promise that will be resolved when all promises from the</font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> # iterated</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> collection</font><font style="vertical-align: inherit;">transferred to it are resolved</font><font style="vertical-align: inherit;">(in v8 now it works only with arrays, I haven‚Äôt yet fixed it within the library - I don‚Äôt see much point in using it with something else). </font><font style="vertical-align: inherit;">Elements of the collection that are not promises are given to promises through</font></font><code>Promise.resolve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><a href="http://goo.gl/62OcTx"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>.all([ <span class="hljs-string"><span class="hljs-string">'foo'</span></span>, sleepRandom(<span class="hljs-number"><span class="hljs-number">5</span></span>), sleepRandom(<span class="hljs-number"><span class="hljs-number">15</span></span>), sleepRandom(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-comment"><span class="hljs-comment">//  15   -  ]).then(log); // =&gt; ['foo', 956, 85, 382]</span></span></code> </pre><br><a name="es6-promise-race"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Helper</font></font><code>Promise.race</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is similar to the previous one, but returns a promise that will be resolved when at least one promise from the collection given to it is resolved. </font><font style="vertical-align: inherit;">In my humble opinion, unlike</font></font><code>Promise.all</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, a little less than completely, useless. </font><font style="vertical-align: inherit;">Is that with its help it becomes a little easier to hang the limit on the time of the resolution of the promise. </font></font><a href="http://goo.gl/L8ovkJ"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">timeLimit</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">promise, time</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>.race([promise, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve, reject</span></span></span><span class="hljs-function">)</span></span>{ setTimeout(reject, time * <span class="hljs-number"><span class="hljs-number">1e3</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">'Await &gt; '</span></span> + time + <span class="hljs-string"><span class="hljs-string">' sec'</span></span>)); })]); } timeLimit(sleepRandom(<span class="hljs-number"><span class="hljs-number">5</span></span>), <span class="hljs-number"><span class="hljs-number">10</span></span>).then(log); <span class="hljs-comment"><span class="hljs-comment">// =&gt;  5    853 timeLimit(sleepRandom(15), 10).catch(log); // Error: Await &gt; 10 sec</span></span></code> </pre><br><a name="async-await"></a> <a href="https://habr.com/ru/post/216997/"><b>#</b></a>   ,  JavaScript       ,     ECMAScript 7  <a href="https://github.com/lukehoban/ecmascript-asyncawait"> </a> ,     <code>async / await</code>    <a href="https://habr.com/ru/post/216997/"># </a> ,   ,   :)      <b>Traceur</b> ,  <b>6to5</b> . <a href="http://goo.gl/v5JRT8"></a> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> delay = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">time</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve</span></span></span><span class="hljs-function"> =&gt;</span></span> setTimeout(resolve, time)); <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sleepRandom</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">time</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> delay(time * <span class="hljs-number"><span class="hljs-number">1e3</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> | <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.random() * <span class="hljs-number"><span class="hljs-number">1e3</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sleepError</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">time, msg</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> delay(time * <span class="hljs-number"><span class="hljs-number">1e3</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(msg); } (<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { log(<span class="hljs-string"><span class="hljs-string">''</span></span>); <span class="hljs-comment"><span class="hljs-comment">// =&gt;  log(await sleepRandom(5)); // =&gt; 936,  5 . var [a, b, c] = await Promise.all([ sleepRandom(5), sleepRandom(15), sleepRandom(10) ]); log(a, b, c); // =&gt; 210 445 71,  15 . await sleepError(5, '!'); log('  '); } catch(e){ log(e); // =&gt; Error: '!',  5 . } })();</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Over time, promises will change much of the standard asynchronous JavaScript API. </font><font style="vertical-align: inherit;">Already </font></font><a href="https://fetch.spec.whatwg.org/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">standardized</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><a href="https://github.com/github/fetch"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">polyfil</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) global function </font></font><code>fetch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- a simple and convenient wrapper over </font></font><code>XMLHttpRequest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, returning a promise. </font></font><a href="https://esdiscuss.org/topic/promise-returning-delay-function"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Offer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to add, and I think that will add a simple, but often necessary, a function </font></font><code>delay</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">similar to the function in the previous example, returns a promise that is resolved after a specified time - goodbye </font></font><code>setTimeout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Perhaps </font></font><code>delay</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">it would be nice to add to this library.</font></font><br><br><a name="array-generics"></a><h2> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mozilla JavaScript: Static Versions of Array Methods</font></font></b> </h2><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Above, we looked at the iterator protocol. That's just not the only standard for crawling collections in JavaScript. There is much more simple, fast and ancient. These are array-like objects. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In addition to arrays, there are many entities in JavaScript that are similar to them, but they are not arrays. These objects, as well as arrays, contain the length </font></font><code>.length</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and elements by the key [from 0 to </font></font><code>.length</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), which can be skipped - then ‚Äúholes‚Äù appear. They do not contain under themselves </font></font><code>Array.prototype</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, respectively, they do not have array methods. These are objects </font></font><code>arguments</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, strings (formally, IE8 +), typed arrays (arrays, but not containing themselves </font></font><code>Array.prototype</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), collections of DOM elements, jQuery objects, etc. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Almost all methods of the prototype array are generics (as reported </font></font><a href="http://es5.javascript.ru/x15.4.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">by the specification translation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- ‚Äúdeliberately generic‚Äù functions). </font><font style="vertical-align: inherit;">They do not require that the object from the context of which they were launched be an array. </font></font><a href="http://www.2ality.com/2012/02/concat-not-generic.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Is that </font></font><code>.concat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">not quite. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I think many are familiar with these designs:</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>.prototype.slice.call(<span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  [].slice.call(arguments, 1);</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bulky and unintelligible. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ECMAScript 6 adds the method </font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font><code>Array.from</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , with its help you can lead to an array of iterable and array-like objects.</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>.from(<span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>).slice(<span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It seems to be convenient, but </font></font><a href="http://jsperf.com/array-methods-on-array-like"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">far from cheap</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - even for the simplest operation, we are forced to bring the entire object to an array, moreover, in most cases, through a rather heavy protocol of iterators. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In Mozilla's JavaScript, </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the 1.6 version of the language</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and, accordingly, in Firefox, back in 2005, along with the array methods later included in ECMAScript 5, </font></font><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">static versions of the array methods</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> were added </font><font style="vertical-align: inherit;">. They did not get into either the 5th or the 6th edition of ECMAScript, although they have been present in the </font></font><a href="http://wiki.ecmascript.org/doku.php%3Fid%3Dstrawman:array_statics"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Strawman</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> development </font><a href="http://wiki.ecmascript.org/doku.php%3Fid%3Dstrawman:array_statics"><font style="vertical-align: inherit;">branch</font></a><font style="vertical-align: inherit;"> for a long time, but I personally hope for their appearance in one of the future versions of ECMAScript. Add to the library and they are implemented elementarily, and since they already exist in Ognelis, we put them in the category of crutches, not bicycles.</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>.slice(<span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>.join(<span class="hljs-string"><span class="hljs-string">'abcdef'</span></span>, <span class="hljs-string"><span class="hljs-string">'+'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// =&gt; 'a+b+c+d+e+f' var form = document.getElementsByClassName('form__input'); Array.reduce(form, function(memo, it){ memo[it.name] = it.value; return memo; }, {}); // =&gt; , {name: '', age: '42', sex: 'yes, please'}</span></span></code> </pre><br><a name="schedule"></a><h2> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Deferred execution: setTimeout, setInterval, setImmediate</font></font></b> </h2><hr><br><a name="timeout-interval"></a><h4> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> setTimeout, setInterval</font></font></b> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perhaps start with all the usual </font></font><code>setTimeout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>setInterval</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Many do not know that according to the standard ( </font></font><a href="http://www.w3.org/TR/html5/webappapis.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">W3C</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/timers.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHATWG</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), these functions, in addition to the callback and the delay time, take additional arguments with which the transferred callback is started. </font><font style="vertical-align: inherit;">But here, as usual, the problem is in IE. </font><font style="vertical-align: inherit;">In IE9- </font></font><code>setTimeout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>setInterval</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">take only 2 arguments, it is treated with a wrapper in several lines.</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// : setTimeout(log.bind(null, 42), 1000); // : setTimeout(log, 1000, 42);</span></span></code> </pre><br><a name="immediate"></a><h4> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> setImmediate</font></font></b> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaScript is single-threaded and sometimes it is rather unpleasant. Any lengthy heavy calculations on the client will hang up the user interface, and on the server - request processing. In this case, the partitioning of the heavy task into easy subtasks, performed asynchronously, between which I / O can pass, saves. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Also in JavaScript (for now) tail recursion is not optimized. When a function is called recursively a certain number of times, an error will be generated </font></font><code>RangeError: Maximum call stack size exceeded</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. This number, depending on the platform, varies from several hundred to several tens of thousands. Asynchronous recursive call saves from stack overflow. True, a recursive call is usually easily rewritten into a normal cycle, which is preferable. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To solve such problems you can use</font></font><code>setTimeout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with minimal delay, but it will turn out very slowly. The minimum </font></font><code>setTimeout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">specification </font><font style="vertical-align: inherit;">delay </font><font style="vertical-align: inherit;">is 4 ms, and on some platforms even more. Total, a maximum, ~ 250 recursive calls per second in modern browsers and, for example, ~ 64 in IE8. It was necessary, and it is necessary, to cycle, since there are ways to make effective pending execution. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If there was a Node.js </font></font><code>process.nextTick</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, then the client came to help from where it was not expected. In IE10, Microsoft added the </font></font><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window.setImmediate"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">setImmediate</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><font style="vertical-align: inherit;">, which sets the task to be executed immediately after the I / O has completed, and proposed it for </font></font><a href="https://dvcs.w3.org/hg/webperf/raw-file/tip/specs/setImmediate/Overview.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">W3C standardization</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . He later </font></font><a href="http://habrahabr.ru/post/172363/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">appeared on Node.js</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . FF and Chromium do not hasten to add it. Popular </font></font><a href="https://github.com/YuzuJS/setImmediate"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">such</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> polyfil.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There are a huge number of ways to implement effective deferred execution of functions. </font><font style="vertical-align: inherit;">To achieve maximum performance on different platforms, we will have to use many (similar to the methods of the above mentioned polyfil).</font></font> It: <br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> For older versions of Node.js - </font></font><code>process.nextTick</code> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> For modern browsers - </font></font><code>postMessage</code> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> For WebWorkers - </font></font><code>MessageChannel</code> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> For IE8- - </font></font><code>script.onreadystatechange</code> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And even if these methods did not help - </font></font><code>setTimeout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with minimal delay</font></font></li></ul><br><pre> <code class="javascript hljs">setImmediate(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">arg1, arg2</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(arg1, arg2); <span class="hljs-comment"><span class="hljs-comment">// =&gt;        }, '   ', '  '); clearImmediate(setImmediate(function(){ console.log('   '); }));</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In addition </font></font><code>setImmediate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, there is a faster alternative - the concept </font></font><code>asap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(as soon as possible, the </font></font><a href="https://github.com/kriskowal/asap"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">library</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) - if possible, create a microtask that will be executed before any input / output. </font><font style="vertical-align: inherit;">Add such a global method in the standard language </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">think in tc39</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Maybe it should be added to the library?</font></font><br><br><a name="console"></a><h2> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Console</font></font></b> </h2><hr><br> <a href="https://developer.mozilla.org/en-US/docs/Web/API/console"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The console</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is the only universal output and debugging tool both in the browser and on the server. </font><font style="vertical-align: inherit;">At the same time, the console is not part of the ECMAScript specification and is not standardized at all. </font><font style="vertical-align: inherit;">There are abandoned </font></font><a href="https://github.com/DeveloperToolsWG/console-object"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sketches of the specification</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , the actual implementation on all platforms varies.</font></font><br><br><a name="console-cap"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In IE7, the console is completely missing. </font><font style="vertical-align: inherit;">In some browsers, the ‚ÄúHeisenberg Console‚Äù is</font></font><code>console</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">defined only when the user is watching it. </font><font style="vertical-align: inherit;">And, of course, not all methods are available on all platforms. </font><font style="vertical-align: inherit;">We will not invent our</font></font><a href="http://getfirebug.com/firebuglite"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Firebug Lite</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> style console,</font><font style="vertical-align: inherit;">we‚Äôll just make stubs for methods so that you can use them without checking availability.</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// : if(window.console &amp;&amp; console.log)console.log(42); // : console.log(42);</span></span></code> </pre><br><a name="console-bind"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In Firefox and Chromium, the console methods must be run from the context</font></font><code>console</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, so if you need to pass them as a callback you will have to bind - for example,</font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> #</font></font><code>console.log.bind(console)</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">In IE, Firebug and Node.js can be transferred without binding, which is much more convenient. </font><font style="vertical-align: inherit;">Accordingly, we tie the methods to the object</font></font><code>console</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// : setTimeout(console.log.bind(console, 42), 1000); [1, 2, 3].forEach(console.log, console); // : setTimeout(console.log, 1000, 42); [1, 2, 3].forEach(console.log);</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But there is one problem here: on some platforms, when calling the console methods, the string from which the method was called is also displayed. </font><font style="vertical-align: inherit;">When overridden methods console, this line will be a line in </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sore.js</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">If this is critical for you - you can build a library without a console module.</font></font><br><br><h4> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since the console is not standardized, add a little ad-lib:</font></font></b> </h4><br><a name="console-disable"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ability to turn off the output to the console. </font><font style="vertical-align: inherit;">Of course, in production, it is better not to leave calls to the console methods in code, either deleting them with pens or using</font></font><a href="http://www.elijahmanor.com/grunt-away-those-pesky-console-log-statements/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> more advanced tools</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , but this is not always necessary or necessary.</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.disable(); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.warn(<span class="hljs-string"><span class="hljs-string">' ,     .'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.enable(); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.warn(<span class="hljs-string"><span class="hljs-string">'  .'</span></span>);</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The context binding and the ability to disable the console is also present, for example, in </font></font><a href="http://habrahabr.ru/post/116852/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> library from </font></font><a href="https://habrahabr.ru/users/theshock/" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TheShock</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><a name="II"></a><h1> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Part Two: Bicycles</font></font></b> </h1><hr><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Options zero, no options. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I wanted half the world - enough for a bike. </font></font><br> <i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Loop of addiction</font></font></b></i> </blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bicycles, in the context of this article / library - all non-standard functionality. </font><font style="vertical-align: inherit;">Actually, that which, in my opinion, is lacking in the standard library of the language, even if it is implemented according to all the standards currently available. </font><font style="vertical-align: inherit;">We also include here what is offered in ES7 +, since this may be far from being revised or rejected altogether.</font></font><br><br><a name="classify"></a><h2> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Classification of data</font></font></b> </h2><hr><br><a name="is-object"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Here we start quite with the triviality. In JavaScript, according to ECMAScript 5 specification, there are</font></font><a href="http://es5.javascript.ru/x8.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6 data types</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><code>Undefined, Null, Boolean, String, Number</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and</font></font><code>Object</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ECMAScript 6 adds another data type -</font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> #</font></font><code>Symbol</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . To determine the type of data there is an operator</font></font><code>typeof</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Here it only works specifically. So</font></font><a href="http://habrahabr.ru/post/200664/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> historically</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , that</font></font><code>typeof null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">returns</font></font><code>'object'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and</font></font><a href="http://wiki.ecmascript.org/doku.php%3Fid%3Dharmony:typeof_null"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> an attempt to fix</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> it in Harmony was not crowned with success. For a type,</font></font><code>Object</code> <code>typeof</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">returns either</font></font><code>'object'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or</font></font><code>'function'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">depending on the presence of an internal method</font></font><code>[[Call]]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Total we get that the operator</font></font><code>typeof</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">returns exactly the data type only for primitives, and then not all.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you check whether the variable</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">just enough to compare it with him, then you </font></font><code>Object</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">have to either write hundreds of code each time, or a helper. You can, of course, do this - </font></font><code>Object(foo) === foo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">but this solution is </font></font><a href="http://jsperf.com/core-js-isobject"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">far from the fastest</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - it leads the primitive to the object. In the early drafts of ES6, a method was present </font></font><code>Object.isObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, but apparently, due to an attempt to correct </font></font><code>typeof null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, it was deleted. And it is constantly necessary to check whether a variable is an object. So </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">let's add a helper</font></font><code>Object.isObject</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which is easier to implement ( </font></font><a href="http://goo.gl/CIkM2P"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sandbox</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.isObject = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">it</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> it != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> it == <span class="hljs-string"><span class="hljs-string">'object'</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> it == <span class="hljs-string"><span class="hljs-string">'function'</span></span>); } <span class="hljs-comment"><span class="hljs-comment">// ... typeof {}; // =&gt; 'object' typeof isNaN; // =&gt; 'function' typeof null; // =&gt; 'object' Object.isObject({}); // =&gt; true Object.isObject(isNaN); // =&gt; true Object.isObject(null); // =&gt; false</span></span></code> </pre><br><a name="classof"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> But with the classification of objects more interesting. The operator</font></font><code>instanceof</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">checks the prototype chain. If you create an object from a prototype or set an object as a prototype</font></font><code>Function.prototype</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, it will not make it a function. The instance property</font></font><code>constructor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cannot guarantee anything, and</font></font><code>constructor.name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">not only</font><font style="vertical-align: inherit;">does</font><font style="vertical-align: inherit;">it lose any meaning when compressing code, IE is also not supported. An internal property can help with the classification of an object</font></font><code>[[Class]]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. The only way to tear it out is a terrible construction well known to many</font></font><code>Object.prototype.toString.call(foo).slice(8, -1)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><a href="http://goo.gl/2pbqnZ"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.prototype.toString.call(<span class="hljs-number"><span class="hljs-number">1</span></span>).slice(<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>); <span class="hljs-comment"><span class="hljs-comment">// =&gt; 'Number' Object.prototype.toString.call([]).slice(8, -1); // =&gt; 'Array' Object.prototype.toString.call(/./).slice(8, -1); // =&gt; 'RegExp'</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On the basis of getting an inner class, most libraries add a set of utilities by type </font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font><code>Array.isArray</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Object.is </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in </font></font><a href="http://sugarjs.com/api/Object/isType"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sugar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , _.is </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in </font></font><a href="http://underscorejs.org/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Undescore</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , etc. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We will proceed differently - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">one universal method </font></font><code>Object.classof</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for classifying data</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , similar to the operator </font></font><code>typeof!</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from </font></font><a href="http://livescript.net/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LiveScript</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><a href="http://goo.gl/BxwFTQ"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here are just </font></font><code>Object.prototype.toString.call(foo).slice(8, -1)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a couple of problems:</font></font><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In older IE, applicable to </font></font><code>null, undefined</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>arguments</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, this construct returns </font></font><code>"Object"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">This is easily treated with additional checks.</font></font></li><li>       ECMAScript 6,       ?     <code>"Object"</code> .     <a href="http://people.mozilla.org/~jorendorff/es6-draft.html">  </a> <code>Object#toString</code>  ECMAScript 6. </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suddenly, but in ECMAScript 6 there is no such internal property of objects as </font></font><code>[[Class]]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><code>Object#toString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ES6, through checking special internal properties, returns the variable to </font></font><code>Undefined, Null, Array, String, Arguments, Function, Error, Boolean, Number, Date</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font></font><code>RegExp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, while for the rest it searches for a hint on the </font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># symbol</font></font></a> <b><code>Symbol.toStringTag</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">If a method finds a hint and it is not the name of one of the built-in ‚Äúclasses‚Äù, it returns it, it does not find it </font></font><code>Object</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We will correct the logic of the work </font></font><code>Object#toString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, thanks to </font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># one nasty, but fun bug,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> we can do it in IE8- without breaking it </font></font><code>for-in</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">And, of course, we implement this approach in the method </font></font><code>Object.classof</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">As a bonus, we get the ability to classify instances of custom designers. </font></font><a href="http://goo.gl/M7qIFd"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> classof = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.classof; classof(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-comment"><span class="hljs-comment">// =&gt; 'Null' classof(undefined); // =&gt; 'Undefined' classof(1); // =&gt; 'Number' classof(true); // =&gt; 'Boolean' classof('string'); // =&gt; 'String' classof(Symbol()); // =&gt; 'Symbol' classof(new Number(1)); // =&gt; 'Number' classof(new Boolean(true)); // =&gt; 'Boolean' classof(new String('string')); // =&gt; 'String' var fn = function(){} , list = (function(){return arguments})(1, 2, 3); classof({}); // =&gt; 'Object' classof(fn); // =&gt; 'Function' classof([]); // =&gt; 'Array' classof(list); // =&gt; 'Arguments' classof(/./); // =&gt; 'RegExp' classof(new TypeError); // =&gt; 'Error' classof(new Set); // =&gt; 'Set' classof(new Map); // =&gt; 'Map' classof(new WeakSet); // =&gt; 'WeakSet' classof(new WeakMap); // =&gt; 'WeakMap' classof(new Promise(fn)); // =&gt; 'Promise' classof([].values()); // =&gt; 'Array Iterator' classof(new Set().values()); // =&gt; 'Set Iterator' classof(new Map().values()); // =&gt; 'Map Iterator' classof(Math); // =&gt; 'Math' classof(JSON); // =&gt; 'JSON' function Example(){} Example.prototype[Symbol.toStringTag] = 'Example'; classof(new Example); // =&gt; 'Example'</span></span></code> </pre><br><a name="dict"></a><h2> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dictionaries</font></font></b> </h2><hr><br>  JavaScript    ( ) ‚Äî .      ‚Äî    ,         JavaScript    <code>JSON</code> ,   . <br><br>             , ,      (  ,   ‚Äî  ,  <code>Object.prototype</code> ),     .        <code>Object.prototype</code> . <br><br>  ECMAScript 6  <a href="https://habr.com/ru/post/216997/">#   </a>    - ‚Äî <code>Map</code> .     ,    ( ,   ).         .  <code>Map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, unlike object dictionaries, there is no simple literal notation; access to properties occurs through methods ‚Äî not so concise. </font></font><code>Map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It's far from being loved by everyone </font></font><code>JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and not so versatile. </font><font style="vertical-align: inherit;">Yes, and usually in the keys of the dictionary does not require anything except the lines.</font></font><br><br><ul><li> <a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Problem: </font></font><code>Object.prototype</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and dictionaries</font></font></a> </li><li> <a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Constructor </font></font><code>Dict</code></a> </li><li> <a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Methods for safe work with a dictionary that has a prototype</font></font></a> </li><li> <a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Methods for working with a dictionary</font></font></a> </li><li> <a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Iteration through the dictionary</font></font></a> </li><li> <a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Possible prospects</font></font></a> </li></ul><br><a name="dict-and-object-prototype"></a><h4> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Problem: Object.prototype and dictionaries</font></font></b> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B </font></font><code>Object.prototype</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, as suggested by the </font></font><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/prototype"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mozilla Developer Network</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , depending on the implementation, can be:</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.prototype.constructor(); <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.prototype.hasOwnProperty(); <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.prototype.isPrototypeOf(); <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.prototype.propertyIsEnumerable(); <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.prototype.toLocaleString(); <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.prototype.toString(); <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.prototype.valueOf(); <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.prototype.__proto__; <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.prototype.__count__; <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.prototype.__parent__; <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.prototype.__noSuchMethod__; <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.prototype.__defineGetter__(); <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.prototype.__defineSetter__(); <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.prototype.__lookupGetter__(); <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.prototype.__lookupSetter__(); <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.prototype.eval(); <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.prototype.toSource(); <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.prototype.unwatch(); <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.prototype.watch();</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How can this threaten us? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suppose we have a primitive telephone directory and the user has access to his API:</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> phone = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> db = { <span class="hljs-string"><span class="hljs-string">''</span></span>: <span class="hljs-string"><span class="hljs-string">'+7987654'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>: <span class="hljs-string"><span class="hljs-string">'+7654321'</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">has</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> name <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> db; }, <span class="hljs-attr"><span class="hljs-attr">get</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> db[name]; }, <span class="hljs-attr"><span class="hljs-attr">set</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name, phone</span></span></span><span class="hljs-function">)</span></span>{ db[name] = phone; }, <span class="hljs-attr"><span class="hljs-attr">delete</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> db[name]; } }; })();</code> </pre><br> <a href="http://goo.gl/1fJAhL"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We get</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(phone.has(<span class="hljs-string"><span class="hljs-string">''</span></span>)); <span class="hljs-comment"><span class="hljs-comment">// =&gt; true console.log(phone.get('')); // =&gt; '+7987654' console.log(phone.has('')); // =&gt; false console.log(phone.get('')); // =&gt; undefined console.log(phone.has('toString')); // =&gt; true console.log(phone.get('toString')); // =&gt; function toString() { [native code] }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The property, in the absence of, is taken from a chain of prototypes, </font></font><code>in</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">similarly checks its presence. </font><font style="vertical-align: inherit;">Let's add / replace </font></font><code>in</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with a method </font></font><code>hasOwnProperty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that checks the presence of a property in an object without taking into account the prototype chain. </font></font><a href="http://goo.gl/IvQUWE"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We get</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ... has: function(name){ return db.hasOwnProperty(name); }, get: function(name){ if(db.hasOwnProperty(name))return db[name]; }, // ... console.log(phone.get('')); // =&gt; '+7987654' phone.set('hasOwnProperty', '+7666666'); //   "" console.log(phone.get('')); // TypeError: string is not a function</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Already quite seriously, especially if this "telephone directory" is on the server side. </font><font style="vertical-align: inherit;">Prototype methods can be overridden. </font><font style="vertical-align: inherit;">Accordingly, you need to use the method </font></font><code>hasOwnProperty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untied from the object. </font><font style="vertical-align: inherit;">We get the need to use for every sneeze cumbersome checks. </font></font><a href="http://goo.gl/FEKzNd"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Something like this trash</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ... has: function(name){ return Object.prototype.hasOwnProperty.call(db, name); }, get: function(name){ if(Object.prototype.hasOwnProperty.call(db, name))return db[name]; }, // ...</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To solve this problem in the language would be useful to </font></font><a href="http://wiki.ecmascript.org/doku.php%3Fid%3Dstrawman:has_operator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">check</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> if the property is proper, similar to </font></font><code>in</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Have you decided that the problems are over? </font></font><a href="http://goo.gl/yZfzuz"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nothing like this</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs">phone.set(<span class="hljs-string"><span class="hljs-string">'__proto__'</span></span>, <span class="hljs-string"><span class="hljs-string">'+7666666'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   "" console.log(phone.get('__proto__')); // =&gt; undefined</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In </font></font><code>Object.prototype</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">addition, there is also a ‚Äúmagic‚Äù getter / setter </font></font><code>__proto__</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, the installation of a primitive by this key will be ignored, and the object will be damaged, for example, when traversing properties. </font><font style="vertical-align: inherit;">In the old engines were other "magical" properties. </font><font style="vertical-align: inherit;">Here helps except that </font></font><code>Object.defineProperty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font><a href="http://goo.gl/qigN0B"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pesochnitsa</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ... set: function(name, phone){ Object.defineProperty(db, name, { enumerable : true, configurable: true, writable : true, value : phone }); }, // ...</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We‚Äôre not going to talk about dictionary crawling too much - if everything‚Äôs not really bad, the dictionary doesn‚Äôt contain properties to be recalled in the prototype, you </font></font><code>for-in</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">can do without checking </font><font style="vertical-align: inherit;">when crawling through the dictionary </font></font><code>hasOwnProperty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Here are just a bug with</font></font><a name="es5-keys"></a> <a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># "Non-enumerable enumerable" properties</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> still makes a detour through the </font></font><code>for-in</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dictionaries under which is found </font></font><code>Object.prototype</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">defective in old IE. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In ECMAScript 5, a method for creating an object without a prototype has emerged - </font></font><code>Object.create(null)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with it you can use the implementation of the methods originally proposed ( </font></font><a href="http://goo.gl/gz3ZBZ"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sandbox</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> phone = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> db = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.create(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.assign(db, { <span class="hljs-string"><span class="hljs-string">''</span></span>: <span class="hljs-string"><span class="hljs-string">'+7987654'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>: <span class="hljs-string"><span class="hljs-string">'+7654321'</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">has</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> name <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> db; }, <span class="hljs-attr"><span class="hljs-attr">get</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> db[name]; }, <span class="hljs-attr"><span class="hljs-attr">set</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name, phone</span></span></span><span class="hljs-function">)</span></span>{ db[name] = phone; }, <span class="hljs-attr"><span class="hljs-attr">delete</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> db[name]; } }; })();</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Everything is great, only its creation and initialization, even with </font></font><code>Object.assign</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, are not particularly compact. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since such dictionaries have no prototype, there are no methods </font></font><code>toString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>valueOf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">What does it threaten us with?</font></font><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It will not be possible to result in a number, for example </font></font><code>+Object.create(null)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, or the string,, </font></font><code>'' + Object.create(null)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-</font></font><code>TypeError</code> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Accordingly, it will not be possible to compare the object with an abstract equality algorithm, for example </font></font><code>==</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, with primitives -</font></font><code>TypeError</code> </li></ul><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> For whom how, but for me it is rather a plus than a minus. </font></font><br><br><a name="dict-module"></a><h4> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Constructor</font></font><code>Dict</code></b> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So, creating a dictionary through </font></font><code>Object.create(null)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and filling it out is much more cumbersome than when creating a dictionary through </font></font><code>{}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Of course, the most beautiful solution would be to add a </font></font><a href="http://wiki.ecmascript.org/doku.php%3Fid%3Dstrawman:dicts"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">literal dictionary</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to the language </font><font style="vertical-align: inherit;">, but this, at least in the short term, is unlikely. </font><font style="vertical-align: inherit;">There is no possibility of initialization by the literal. </font><font style="vertical-align: inherit;">There is a record </font></font><code>{__proto__: null, foo: 'bar'}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, but it is not supported everywhere, </font></font><a href="https://github.com/petkaantonov/bluebird/wiki/Optimization-killers"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">at the moment it leads to de-optimization of the code</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and it is still rather cumbersome. </font><a href=""><font style="vertical-align: inherit;">One rather interesting decision</font></a></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> was discussed </font><font style="vertical-align: inherit;">- to make </font><b><font style="vertical-align: inherit;">‚Äúconstructor‚Äù </font></b><b><font style="vertical-align: inherit;">as an abbreviation</font></b></font><a href=""><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font><code>Dict</code><font style="vertical-align: inherit;"></font><code>Object.create(null)</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">How is it now and is it doing at all, I do not know. </font><font style="vertical-align: inherit;">But why not take it, slightly expanding? </font><font style="vertical-align: inherit;">At the same time we will receive a name space for methods for work with objects as dictionaries. </font><font style="vertical-align: inherit;">Add the ability to initialize with an iterator </font></font><code>entries</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or an object without an iterator, a sort of version </font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font><code>Array.from</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for dictionaries. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since it </font></font><code>Dict() instanceof Dict</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">will not work and </font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font><code>Object.classof(Dict())</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> will return </font></font><code>'Object'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, we </font><font style="vertical-align: inherit;">will </font><font style="vertical-align: inherit;">add a method to identify dictionaries </font></font><code>Dict.isDict</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Like </font></font><a href="http://goo.gl/IuhgSc"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Dict</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dict = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.create(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(props != <span class="hljs-literal"><span class="hljs-literal">null</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>.iterator <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> props){ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> [key, val] <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> props)dict[key] = val; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.assign(dict, props); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dict; } Dict.prototype = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; Dict.isDict = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">it</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.isObject(it) &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.getPrototypeOf(it) === <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-comment"><span class="hljs-comment">// ... var map = new Map([['a', 1], ['b', 2], ['c', 3]]); Dict(); // =&gt; {__proto__: null} Dict({a: 1, b: 2, c: 3}); // =&gt; {__proto__: null, a: 1, b: 2, c: 3} Dict(map); // =&gt; {__proto__: null, a: 1, b: 2, c: 3} Dict([1, 2, 3].entries()); // =&gt; {__proto__: null, 0: 1, 1: 2, 2: 3} Dict((for([k, v] of map)if(v % 2)[k + k, v * v])); // =&gt; {__proto__: null, aa: 1, cc: 9} Dict.isDict({}); // =&gt; false Dict.isDict(Dict()); // =&gt; true</span></span></code> </pre><br><a name="dict-safe-crud"></a><h4> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Methods for safe work with a dictionary that has a prototype</font></font></b> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In case you still have to work with an object that has a prototype under it, as with a dictionary, add methods for working safely with your own properties. </font></font><br><br> <b><code>Dict.has</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- trite, static version </font></font><code>hasOwnProperty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. In drafts of ECMAScript 6, in the module </font></font><code>Reflect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- a set of stubs for </font></font><code>Proxy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, until recently there was a static version of the method </font></font><code>hasOwnProperty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- the method </font></font><code>Reflect.hasOwn</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. However, in recent versions of the draft specification, this method has been removed. </font></font><br><br> <b><code>Dict.get</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- getting the value by key with checking whether the property is own. Not is - return </font></font><code>undefined</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br> <b><code>Dict.set</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- a method for absolutely paranoids. Allows you to set the property of the dictionary, ignore setters, such as </font></font><code>__proto__</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Uses </font></font><code>defineProperty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Well, the operator </font></font><code>delete</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and so it works as it should.</font></font><br><br> <a href="http://goo.gl/yXHvmR"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dict = {<span class="hljs-attr"><span class="hljs-attr">a</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">b</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">c</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>}; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(Dict.has(dict, <span class="hljs-string"><span class="hljs-string">'a'</span></span>)); <span class="hljs-comment"><span class="hljs-comment">// =&gt; true console.log(Dict.has(dict, 'toString')); // =&gt; false console.log(Dict.get(dict, 'a')); // =&gt; 1 console.log(Dict.get(dict, 'toString')); // =&gt; undefined Dict.set(dict, '__proto__', 42); console.log(Dict.get(dict, '__proto__')); // =&gt; 42</span></span></code> </pre><br><a name="dict-methods"></a><h4> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Methods for working with a dictionary</font></font></b> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The methods added by ECMAScript 5 to the prototype array to bypass it ( </font></font><code>forEach, map, some</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and the like) are very convenient. Their static counterparts for dictionaries are present in almost all general purpose frameworks / libraries. But there is no progress with adding them to the standard. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Add them within our module </font></font><code>Dict</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Everything is simple, the methods are similar to the static versions of the array methods. This is: </font></font><b><code>Dict.forEach, Dict.map, Dict.filter, Dict.some, Dict.every, Dict.find, Dict.findKey, Dict.keyOf,</code> <a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># </font></font><code>Dict.includes</code></a> <code>, Dict.reduce,</code> <a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font><code>Dict.turn</code></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><code>Key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the name it corresponds </font></font><code>index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to the array methods. The ‚Äúright‚Äù versions and the optional argument-index (for the time being?) Are absent, since the order of traversing the keys of objects is not always the same everywhere. Only the enumerated elements of the object are searched. These methods are generic on the same plane as </font></font><code>Array.from</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font></font><code>Array.of</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. For example, </font></font><code>Dict.map(dict, fn)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">will return a new</font></font><code>Dict</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and </font></font><code>Dict.map.call(Object, dict, fn)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- new </font></font><code>Object</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">But in general, everything is primitive, boring and like everywhere ( </font></font><a href="http://goo.gl/RkjUxu"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sandbox</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dict = {<span class="hljs-attr"><span class="hljs-attr">a</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">b</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">c</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>}; Dict.forEach(dict, <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log, <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>); <span class="hljs-comment"><span class="hljs-comment">// =&gt; 1, 'a', {a: 1, b: 2, c: 3} // =&gt; 2, 'b', {a: 1, b: 2, c: 3} // =&gt; 3, 'c', {a: 1, b: 2, c: 3} Dict.map(dict, function(it){ return it * it; }); // =&gt; {a: 1, b: 4, c: 9} Dict.filter(dict, function(it){ return it % 2; }); // =&gt; {a: 1, c: 3} Dict.some(dict, function(it){ return it === 2; }); // =&gt; true Dict.every(dict, function(it){ return it === 2; }); // =&gt; false Dict.find(dict, function(it){ return it &gt; 2; }); // =&gt; 3 Dict.find(dict, function(it){ return it &gt; 4; }); // =&gt; undefined Dict.findKey(dict, function(it){ return it &gt; 2; }); // =&gt; 'c' Dict.findKey(dict, function(it){ return it &gt; 4; }); // =&gt; undefined Dict.keyOf(dict, 2); // =&gt; 'b' Dict.keyOf(dict, 4); // =&gt; undefined Dict.includes(dict, 2); // =&gt; true Dict.includes(dict, 4); // =&gt; false Dict.reduce(dict, function(memo, it){ return memo + it; }); // =&gt; 6 Dict.reduce(dict, function(memo, it){ return memo + it; }, ''); // =&gt; '123' Dict.turn(dict, function(memo, it, key){ memo[key + key] = it; }); // =&gt; {aa: 1, bb: 2, cc: 3} Dict.turn(dict, function(memo, it, key){ it % 2 &amp;&amp; memo.push(key + it); }, []); // =&gt; ['a1', 'c3']</span></span></code> </pre><br><a name="chaining"></a> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> As for the chains of methods,</font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> # for an obvious reason</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ,</font></font><code>Dict</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">they are not</font><font style="vertical-align: inherit;">in the framework of the module</font><font style="vertical-align: inherit;">, and are not foreseen. </font><font style="vertical-align: inherit;">Salvation here can be</font></font><a href="https://github.com/zenparsing/es-abstract-refs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> abstract references</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">But within the framework of</font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> #</font></font><code>$for</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and</font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> #</font></font><code>Map</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> it is quite possible and will appear.</font></font><br><br><a name="dict-iter"></a><h4> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Iteration through the dictionary</font></font></b> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The bright future of ES6 is nearing with </font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># iterators</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># cycles</font></font><code>for-of</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . But for objects like dictionaries, this is neither warm nor cold - for them in ES6 iterators are not provided. Accordingly, there is no easy way to iterate through them </font></font><code>for-of</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, initialize </font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># with a</font></font><code>Map</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dictionary, etc. Adding methods </font></font><code>.keys, .values</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>.entries</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in </font></font><code>Object.prototype</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unlikely - there is already enough garbage, see the description of the previous problem. But two other scenarios are quite probable: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The first is the addition of static methods that return an iterator to the namespace </font></font><code>Dict</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><code>Dict.{keys, values, entries}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. But as I already wrote that with the prospect of adding this module to the standard I do not know. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The second is </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">adding methods</font></font><code>Object.{values, entries}</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> by type</font></font><code>Object.keys</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">returning an array, not an iterator, and already through the array iterator to bypass the object. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I don‚Äôt know what will come out of this and I'm afraid to guess. </font><font style="vertical-align: inherit;">To obtain an array of dictionary values, it is not rational to use a rather heavy iterator protocol, just as using an intermediate array to iterate over an object. </font><font style="vertical-align: inherit;">So, although it is partially and duplicating each other functional, we implement both sets of methods in our library. </font></font><a href="http://goo.gl/kKpVv2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Examples</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dict = {<span class="hljs-attr"><span class="hljs-attr">a</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">b</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">c</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>}; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.values(dict)); <span class="hljs-comment"><span class="hljs-comment">// =&gt; [1, 2, 3] console.log(Object.entries(dict)); // =&gt; [['a', 1], ['b', 2], ['c', 3]] for(var key of Dict.keys(dict))console.log(key); // =&gt; 'a', 'b', 'c' for(var [key, val] of Dict.entries(dict)){ console.log(key); // =&gt; 'a', 'b', 'c' console.log(val); // =&gt; 1, 2, 3 } $for(Dict.values(dict)).of(console.log); // =&gt; 1, 2, 3 new Map(Dict.entries(dict)); // =&gt; Map {a: 1, b: 2, c: 3} new Map((for([k, v] of Dict.entries(dict))if(v % 2)[k + k, v * v])); // =&gt; Map {aa: 1, cc: 9}</span></span></code> </pre><br><a name="dict-next"></a><h4> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Possible perspectives</font></font></b> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">One could go a little further, making </font></font><code>Dict</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">not just an abbreviation for </font></font><code>Object.create(null)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with the possibility of initialization by an iterator and an object, but a full-fledged constructor with a prototype that does not contain key strings, only </font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># symbols</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><a href="http://goo.gl/G4yDFL"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Like this</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Dict</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Dict))<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dict(props); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(props != <span class="hljs-literal"><span class="hljs-literal">null</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>.iterator <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> props){ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> [key, val] <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> props)<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[key] = val; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.assign(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, props); } } Dict.prototype = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.create(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); Dict.prototype[<span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>.toStringTag] = <span class="hljs-string"><span class="hljs-string">'Dict'</span></span>; Dict.prototype[<span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>.iterator] = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Dict.entries(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); };</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> What would it give us? </font></font><br><br><ul><li> <code>new Dict instanceof Dict</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font></li><li> <code>for(var [key, value] of dict){...}, new Map(dict)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">without having to get an iterator through </font></font><code>Dict.entries</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li><li> <a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font><code>Object.classof(new Dict)</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> would return </font></font><code>'Dict'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, not </font></font><code>'Object'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">However, there are reasons, at a minimum, to postpone the implementation of this approach until the moment when IE8 will die out completely, and Firefox will completely switch to the ECMAScript 6 iterator protocol. Or maybe it‚Äôs not worth it at all - we risk permanently losing compatibility with the standard when / if </font></font><code>Dict</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get there.</font></font><br><br><a name="partial-application"></a><h2> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Partial application</font></font></b> </h2><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perhaps one of the most useful innovations in ECMAScript 5 was the </font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font><code>Function#bind</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Here are the possibilities of </font></font><a href="https://ru.wikipedia.org/wiki/%25D0%25A7%25D0%25B0%25D1%2581%25D1%2582%25D0%25B8%25D1%2587%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25BF%25D1%2580%25D0%25B8%25D0%25BC%25D0%25B5%25D0%25BD%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">partial application of</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> this method is far from fully disclosed. </font><font style="vertical-align: inherit;">In this chapter, we will look at things like:</font></font><br><br><ul><li> <a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Partial application without context binding</font></font></a> </li><li> <a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Partial application of arbitrary arguments</font></font></a> </li><li> <a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Extract method from object</font></font></a> </li><li> <a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Limiting the number of arguments</font></font></a> </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">One could add </font></font><a href="http://ru.wikipedia.org/wiki/%25CA%25E0%25F0%25F0%25E8%25F0%25EE%25E2%25E0%25ED%25E8%25E5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currying</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , but in JavaScript, currying, rather than partial application, is rarely required. </font><font style="vertical-align: inherit;">Like the "right" versions of the methods. </font><font style="vertical-align: inherit;">I will add a </font></font><a href="http://benalman.com/news/2012/09/partial-application-in-javascript/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to a valid (and so, perhaps, well-known) article on the topic.</font></font><br><br><a name="part"></a><h4> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Partial application without context binding</font></font></b> </h4><br> <code>Function#bind</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">combines partial application and context binding </font></font><code>this</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">The latter is needed far from always, and in this case the binding is </font></font><code>this</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">not only an ‚Äúextra‚Äù argument for what to write. </font><font style="vertical-align: inherit;">If the context in which the partially applied function is to be launched is unknown in advance, the method is </font></font><code>Function#bind</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">not applicable. </font><font style="vertical-align: inherit;">For example, if it is a prototype method ( </font></font><a href="http://goo.gl/uj6s6f"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sandbox</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>.prototype.compact = [].filter.bind(<span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>.prototype, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">val</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> val != <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }); [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>].compact(); <span class="hljs-comment"><span class="hljs-comment">// =&gt; [] -     Array.prototype,     //    : Array.prototype.compact = function(){ return this.filter(function(val){ return val != null; }); }; [0, null, 1, undefined, 2].compact(); // =&gt; [0, 1, 2];</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Add a partial application method without binding </font></font><code>this</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><code>Function#part</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font><a href="http://goo.gl/l2UY0d"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sandbox</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>.prototype.compact = [].filter.part(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">val</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> val != <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }); [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>].compact(); <span class="hljs-comment"><span class="hljs-comment">// =&gt; [0, 1, 2]; var fn = console.log.part(1, 2); fn(3, 4); // =&gt; 1, 2, 3, 4</span></span></code> </pre><br><a name="placeholder"></a><h4> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Partial application of arbitrary arguments</font></font></b> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Often, when partially applied, arbitrary arguments need to be passed ‚Äî not, for example, the first 2, but only the second and fourth, or second and third. </font><font style="vertical-align: inherit;">Here </font></font><code>Function#bind</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we will not be able to help - we will have to write a wrapper manually for each specific case.</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fn1</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a, c</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(a, <span class="hljs-number"><span class="hljs-number">2</span></span>, c, <span class="hljs-number"><span class="hljs-number">4</span></span>); }; fn1(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-comment"><span class="hljs-comment">// =&gt; 1, 2, 3, 4 function fn2(b, c){ console.log(1, b, c, 4); }; fn2(2, 3); // =&gt; 1, 2, 3, 4</span></span></code> </pre><br>       ‚Äî ,  ,       .           <code>_</code> (, ,  <a href="http://livescript.net/">LiveScript</a> , <a href="http://goo.gl/EsYZ69"></a> ), ,     Undescore.js (,       <code>_.partial</code> )  LoDash   .     ,     <code>_</code>    ,        <code>_</code> ,     .       ,      <code>core._</code> . <a href="http://goo.gl/ykMnZf"></a> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fn1 = <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log.part(_, <span class="hljs-number"><span class="hljs-number">2</span></span>, _, <span class="hljs-number"><span class="hljs-number">4</span></span>); fn1(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-comment"><span class="hljs-comment">// =&gt; 1, 2, 3, 4 var fn2 = console.log.part(1, _, _, 4); fn2(2, 3); // =&gt; 1, 2, 3, 4 fn1(1, 3, 5); // =&gt; 1, 2, 3, 4, 5 fn1(1); // =&gt; 1, 2, undefined, 4</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Also add a method </font></font><code>Function#by</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">similar </font></font><code>Function#bind</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, but with the possibility of using a placeholder for arguments. </font><font style="vertical-align: inherit;">It would be possible to wrap up </font></font><code>Function#bind</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, forcing to work with a placeholder, but this is a violation of the specification, and this method is already rather inhibited in almost all engines.</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fn = <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log.by(<span class="hljs-built_in"><span class="hljs-built_in">console</span></span>, _, <span class="hljs-number"><span class="hljs-number">2</span></span>, _, <span class="hljs-number"><span class="hljs-number">4</span></span>); fn(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>); <span class="hljs-comment"><span class="hljs-comment">// =&gt; 1, 2, 3, 4, 5</span></span></code> </pre><br><a name="method-extraction"></a><h4> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Extract method from object</font></font></b> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In most cases, for example, when passing a callback to a function, we need to bind the method precisely to the object from which we get it. And here there is a problem - </font></font><code>fn(foo.bar.baz.bind(foo.bar))</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. We have to write </font></font><code>foo.bar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 times, this is a clear violation of the principle of DRY. I hope in the future </font></font><a href="https://github.com/zenparsing/es-abstract-refs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">abstract references</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> will save from this problem </font><font style="vertical-align: inherit;">, but the proposed implementation </font></font><a href="https://github.com/zenparsing/es-abstract-refs/issues/5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">does not solve the</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> problem </font><font style="vertical-align: inherit;">. Perhaps the most delicious and beautiful solution would be to add an access operator to the language while preserving the context, similar to </font></font><a href="http://livescript.net/"><code>~</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LiveScript</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><code>fn(foo.bar~baz)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font><a href="http://goo.gl/58e0Dp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sandbox</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There are not many solutions to the problem based on the library, except for extracting a method from an object by key. This is either a static method, for example, </font></font><code>_.bindKey</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from</font></font><a href="http://lodash.com/docs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LoDash</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (but with early binding), but it is also quite cumbersome and further worsens the readability, or similar in functionality to the method </font></font><code>Object.prototype</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, for example, </font></font><code>Object#boundTo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from </font></font><a href="https://github.com/WebReflection/eddy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eddy.js</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No matter how scary it sounds, we will add a method to </font></font><code>Object.prototype</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. To risk, expanding the </font></font><code>Object.prototype</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">method with a short key-string, we, at least, for the time being, we will not - it is difficult to avoid conflicts, and we will break it </font></font><code>for-in</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in IE8-. Earlier in this chapter, we already used a global variable </font></font><code>_</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. In order not to produce extra essences and for short, let's apply it here. Replace the </font></font><code>_</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">method </font><font style="vertical-align: inherit;">with the object </font></font><code>toString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(respectively, if used in conjunction with Undescore.js or LoDash - you need to connect </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">core.js</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">after them). It will return a unique key string, similar to the </font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># key of a poly-symbol of a character</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Let's add a method using this key </font></font><code>Object.prototype</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Due to the use of a dirty hack with a </font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fun bug</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we add this method to IE8- without breaking it </font></font><code>for-in</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In total, from the example from which we started, we get </font></font><code>fn(foo.bar[_]('baz'))</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- far from the ideal, but at least got rid of the second mention of the object. The returned method is cached. </font></font><a href="http://goo.gl/dQsSTi"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Examples</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs">[<span class="hljs-string"><span class="hljs-string">'foobar'</span></span>, <span class="hljs-string"><span class="hljs-string">'foobaz'</span></span>, <span class="hljs-string"><span class="hljs-string">'barbaz'</span></span>].filter(<span class="hljs-regexp"><span class="hljs-regexp">/bar/</span></span>[_](<span class="hljs-string"><span class="hljs-string">'test'</span></span>)); <span class="hljs-comment"><span class="hljs-comment">// =&gt; ['foobar', 'barbaz'] var has = {}.hasOwnProperty[_]('call'); console.log(has({key: 42}, 'foo')); // =&gt; false console.log(has({key: 42}, 'key')); // =&gt; true var array = [] , push = array[_]('push'); push(1); push(2, 3); console.log(array); // =&gt; [1, 2, 3];</span></span></code> </pre><br> -,     IE8- ,   ,     - :) <code>tie, boundTo, bindKey</code>  -   ,    . <br><br>  <code>Proxy</code>  ES6      ‚Äî          ‚Äî <code>fn(foo.bar[_].baz)</code> ,   <code>Proxy</code>  (,      ),       ,      . <br><br><div class="spoiler"> <b class="spoiler_title">  Proxy,      </b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _ = <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>(); <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.defineProperty(<span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.prototype, _, { <span class="hljs-attr"><span class="hljs-attr">get</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Proxy</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, { <span class="hljs-attr"><span class="hljs-attr">apply</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*    [_]    */</span></span> }, <span class="hljs-attr"><span class="hljs-attr">get</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">context, name</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> context[name].bind(context); } }); } }); [<span class="hljs-string"><span class="hljs-string">'foobar'</span></span>, <span class="hljs-string"><span class="hljs-string">'foobaz'</span></span>, <span class="hljs-string"><span class="hljs-string">'barbaz'</span></span>].filter(<span class="hljs-regexp"><span class="hljs-regexp">/bar/</span></span>[_].test); <span class="hljs-comment"><span class="hljs-comment">// =&gt; ['foobar', 'barbaz'] var has = {}.hasOwnProperty[_].call; console.log(has({key: 42}, 'foo')); // =&gt; false console.log(has({key: 42}, 'key')); // =&gt; true var array = [] , push = array[_].push; push(1); push(2, 3); console.log(array); // =&gt; [1, 2, 3];</span></span></code> </pre></div></div><br><a name="only"></a><h4> <b><a href="https://habr.com/ru/post/216997/">#</a>   </b> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The problem of optional arguments is discussed in </font></font><a href="http://habrahabr.ru/post/114737/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">The example in it is - </font></font><code>parseInt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- rather unintelligible, no one bothers to bring the lines to a number, for example, using </font></font><code>Number</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that it does not expect additional arguments. </font><font style="vertical-align: inherit;">The point here is not their ‚Äúdanger‚Äù, but the need to write an extra wrapper. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For example, we want to output all elements of the array to the console, only the elements themselves and nothing else:</font></font><br><br><pre> <code class="javascript hljs">[<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>].forEach(<span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log); <span class="hljs-comment"><span class="hljs-comment">// =&gt; 1 0 [1, 2, 3] // =&gt; 2 1 [1, 2, 3] // =&gt; 3 2 [1, 2, 3]</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The method </font></font><code>.forEach</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, like many others, passes the optional arguments to the callback ‚Äî the index and the array itself. </font><font style="vertical-align: inherit;">And we do not need them. </font><font style="vertical-align: inherit;">So each time the callback will have to be wrapped into another function:</font></font><br><br><pre> <code class="javascript hljs">[<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>].forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">it</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(it); }); <span class="hljs-comment"><span class="hljs-comment">// =&gt; 1, 2, 3</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the article mentioned above, a method was proposed to limit the function arguments </font></font><code>Function#only</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">We realize its option. </font><font style="vertical-align: inherit;">The first argument is the maximum number of arguments, the second, optional is the context. </font></font><a href="http://goo.gl/EflCFz"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs">[<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>].forEach(<span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log.only(<span class="hljs-number"><span class="hljs-number">1</span></span>)); <span class="hljs-comment"><span class="hljs-comment">// =&gt; 1, 2, 3</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Of course, if the maximum number of arguments is 1, it is simpler, if they are available, to do with the switch functions from ES6 or coffee-like languages, but if more is already problematic. </font></font><br><br><a name="date-format"></a><h2> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Date formatting</font></font></b> </h2><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It would seem that the simple task of formatting dates is not so simple in JavaScript. </font><font style="vertical-align: inherit;">What if we need to get the format string </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"11/18/2014 6:07:25 AM"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ? </font></font><a href="http://goo.gl/duI0y0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Everything is pretty scary</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> date = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lz2</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">it</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> it &gt; <span class="hljs-number"><span class="hljs-number">9</span></span> ? it : <span class="hljs-string"><span class="hljs-string">'0'</span></span> + it; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> format = [date.getDate(), date.getMonth() + <span class="hljs-number"><span class="hljs-number">1</span></span>, date.getFullYear()].map(lz2).join(<span class="hljs-string"><span class="hljs-string">'.'</span></span>) + <span class="hljs-string"><span class="hljs-string">' '</span></span> + [date.getHours(), date.getMinutes(), date.getSeconds()].map(lz2).join(<span class="hljs-string"><span class="hljs-string">':'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(format); <span class="hljs-comment"><span class="hljs-comment">// =&gt; '18.11.2014 06:07:25 '</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And what if you need to get, for example, a format string </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Tuesday, November 18, 2014, 6:07:25 AM"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At the beginning of the article, the internationalization standard </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ECMA402</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="http://norbertlindenberg.com/ecmascript/intl.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">specification</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">was mentioned </font><font style="vertical-align: inherit;">. The standard adds an </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intl</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> object to JavaScript </font><font style="vertical-align: inherit;">that contains tools for localized formatting of dates, numbers, string comparisons. At a basic level, </font></font><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intl is</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> covered in </font></font><a href="http://habrahabr.ru/post/218481/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . In addition, this standard overloads the methods </font></font><code>Date#toLocaleString, Date#toLocaleDateString, Date#toLocaleTimeString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">by adding 2 arguments to them: localization and format options. Using them, a string close to the format mentioned above can be obtained </font></font><a href="http://goo.gl/DHvgqd"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as follows</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>().toLocaleString(<span class="hljs-string"><span class="hljs-string">'ru-RU'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">weekday</span></span>: <span class="hljs-string"><span class="hljs-string">'long'</span></span>, <span class="hljs-attr"><span class="hljs-attr">year</span></span>: <span class="hljs-string"><span class="hljs-string">'numeric'</span></span>, <span class="hljs-attr"><span class="hljs-attr">month</span></span>: <span class="hljs-string"><span class="hljs-string">'long'</span></span>, <span class="hljs-attr"><span class="hljs-attr">day</span></span>: <span class="hljs-string"><span class="hljs-string">'numeric'</span></span>, <span class="hljs-attr"><span class="hljs-attr">hour</span></span>: <span class="hljs-string"><span class="hljs-string">'numeric'</span></span>, <span class="hljs-attr"><span class="hljs-attr">minute</span></span>: <span class="hljs-string"><span class="hljs-string">'2-digit'</span></span>, <span class="hljs-attr"><span class="hljs-attr">second</span></span>: <span class="hljs-string"><span class="hljs-string">'2-digit'</span></span> }); <span class="hljs-comment"><span class="hljs-comment">// =&gt; ', 18  2014 ., 6:07:25'</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is cumbersome, of course, but better than that. </font><font style="vertical-align: inherit;">Regarding the support of the standard - in general, not bad. </font><font style="vertical-align: inherit;">Chrome, Opera, IE11, more recently, and Firefox is supported. </font><font style="vertical-align: inherit;">But usually you need support for IE10-, Safari, mobile platforms and the devil still knows what. </font><font style="vertical-align: inherit;">In this case there is a </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">polyfill</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">But here's a bad luck - the implementation of this functionality will weigh too much, even without taking into account the locales. </font><font style="vertical-align: inherit;">For this reason, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in core.js and no Polyphemus ECMA402</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><a name="simple-date-format"></a><h4> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Add a simple date formatting.</font></font></b> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What does ‚Äúsimple‚Äù mean? </font><font style="vertical-align: inherit;">How often do you need full localization or some other advanced date handling tools? </font><font style="vertical-align: inherit;">I - not really, usually I want a simple convenient date formatting with a format string. </font><font style="vertical-align: inherit;">Well, if needed - no one bothers to connect </font></font><b><a href="http://momentjs.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Moment.js</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or polyfil </font></font><code>Intl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Here the whole module of working with the date is a few dozen lines. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Add a method </font></font><code>Date#format</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and its UTC version </font></font><code>Date#formatUTC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font><a href="http://goo.gl/NMeGEy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sandbox</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>().format(<span class="hljs-string"><span class="hljs-string">'W, D MM Y ., h:mm:ss'</span></span>, <span class="hljs-string"><span class="hljs-string">'ru'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// =&gt; ', 18  2014 ., 6:07:25' new Date().formatUTC('W, D MM Y ., h:mm:ss', 'ru'); // =&gt; ', 18  2014 ., 0:07:25'</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For the sake of simplicity and easy readability of the format string, we will not bother with escaping notation. </font><font style="vertical-align: inherit;">While their minimum is available:</font></font><br><br><pre> <code class="sql hljs">s |  | 0-59 ss | , 2  | 00-59 m |  | 0-59 mm | , 2  | 00-59 h |  | 0-23 hh | , 2  | 00-23 D |  | 1-31 DD | , 2  | 01-31 W |  ,  |  N |  | 1-12 NN | , 2  | 01-12 M | ,  |  MM | ,  |  Y | ,  | 2014 YY | , 2  | 14</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The library already includes Russian ( </font></font><code>ru</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) and English ( </font></font><code>en</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) locales. </font><font style="vertical-align: inherit;">A locale is specified either by the method </font></font><code>core.locale</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or by the second argument of the methods </font></font><code>Date#format</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>Date#formatUTC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font><a href="http://goo.gl/BYG9XY"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sandbox</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>().format(<span class="hljs-string"><span class="hljs-string">'W, D MM Y'</span></span>, <span class="hljs-string"><span class="hljs-string">'ru'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// =&gt; ', 18  2014' new Date().format('W, D MM Y'); // =&gt; 'Tuesday, 18 November 2014' core.locale('ru'); new Date().format('W, D MM Y'); // =&gt; ', 18  2014'</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The locale format is shown below. </font><font style="vertical-align: inherit;">In your own code, you can limit yourself </font></font><code>core.addLocale</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, but due to the possibility of building the library without extending native objects, the universal locale module will look like this:</font></font><br><br><pre> <code class="javascript hljs">(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> core != <span class="hljs-string"><span class="hljs-string">'undefined'</span></span> ? core : <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'core-js/library'</span></span>)).addLocale(<span class="hljs-string"><span class="hljs-string">'ru'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">weekdays</span></span>: <span class="hljs-string"><span class="hljs-string">',,,,,,'</span></span>, <span class="hljs-attr"><span class="hljs-attr">months</span></span>: <span class="hljs-string"><span class="hljs-string">':|,:|,:|,:|,:|,:|,:|,:|,:|,:|,:|,:|'</span></span> });</code> </pre><br> <a href="http://goo.gl/PVfVLd"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Some examples</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>().format(<span class="hljs-string"><span class="hljs-string">'DD.NN.YY'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// =&gt; '18.11.14' new Date().format('hh:mm:ss'); // =&gt; '06:07:25' new Date().format('DD.NN.Y hh:mm:ss'); // =&gt; '18.11.2014 06:07:25' new Date().format('W, D MM Y '); // =&gt; ', 18  2014 ' new Date().format('D MM, h:mm'); // =&gt; '18 , 6:07' new Date().format('M Y'); // =&gt; ' 2014'</span></span></code> </pre><br><a name="object"></a><h2> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Object API</font></font></b> </h2><hr><br><a name="object-define"></a> <a href="https://habr.com/ru/post/216997/"><b>#</b></a> <b> </b> :  ECMAScript 5         .     /         <code>Object.defineProperty</code> / <code>Object.defineProperties</code> ,        (     ,     )  ,   . <br><br>   <a href="https://habr.com/ru/post/216997/"># <code>Object.assign</code></a> ,  ECMAScript 6    <code>Object.mixin</code> ,    -      .  ,       -,     <code>super</code> . ,        . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Add a method </font></font><code>Object.define</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that works as described </font></font><code>Object.mixin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äî copying the properties of the source object to the target with descriptors, but not overriding the parent, in the absence of a keyword </font></font><code>super</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in ECMAScript 5.</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// : Object.defineProperty(target, 'c', { enumerable: true, configurable: true, get: function(){ return this.a + this.b; } }); // : Object.define(target, { get c(){ return this.a + this.b; } });</span></span></code> </pre><br><a name="object-make"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></b></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Second problem</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : ECMAScript 5 also added the ability to create an object without using a constructor, via</font></font><code>Object.create</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">It would be nice to add your own properties of the object during creation, but the second argument</font></font><code>Object.create</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, as well as</font></font><code>Object.defineProperties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, accepts an object that contains objects of property descriptors, which is terribly cumbersome. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's add a method</font></font><code>Object.make</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- an analogue</font></font><code>Object.create</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, the second argument is a waiting object, not an object of descriptors, but a simple object from which own properties are copied into the object being created taking into account descriptors.</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//        : var copy = Object.make(Object.getPrototypeOf(src), src); //   : function Vector2D(x, y){ this.x = x; this.y = y; } Object.define(Vector2D.prototype, { get xy(){ return Math.hypot(this.x, this.y); } }); function Vector3D(x, y, z){ Vector2D.apply(this, arguments); this.z = z; } Vector3D.prototype = Object.make(Vector2D.prototype, { constructor: Vector3D, get xyz(){ return Math.hypot(this.x, this.y, this.z); } }); var vector = new Vector3D(9, 12, 20); console.log(vector.xy); // =&gt; 15 console.log(vector.xyz); // =&gt; 25 vector.y++; console.log(vector.xy); // =&gt; 15.811388300841896 console.log(vector.xyz); // =&gt; 25.495097567963924</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In ECMAScript 7, we propose adding the </font></font><a href="https://gist.github.com/WebReflection/9353781"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Object.getOwnPropertyDescriptors</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><font style="vertical-align: inherit;">, which returns, as its name indicates, an object containing all the descriptors of the object's own properties. </font><font style="vertical-align: inherit;">The perfect match for creating a second argument </font></font><code>Object.defineProperties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and, </font></font><code>Object.create</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and to some extent, an alternative to ours </font></font><code>Object.make</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>Object.define</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">That's just too bulky.</font></font><br><br><a name="array"></a><h2> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Arrays</font></font></b> </h2><hr><br><a name="array-contains"></a> <a href="https://habr.com/ru/post/216997/"><b>#</b></a>  <a href="https://github.com/domenic/Array.prototype.includes">Array#includes</a> (   ‚Äî <code>Array#contains</code> ,  - <a href="https://esdiscuss.org/topic/array-prototype-contains-solutions"> MooTools</a> ,      )     ECMAScript 7.       .    <code>Array#indexOf</code> ,    <a href="https://habr.com/ru/post/216997/"># SameValueZero</a>    ¬´¬ª. , ,  ‚Äî  . <a href="http://goo.gl/2Gq4ma"></a> : <br><br><pre> <code class="javascript hljs">[<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>].includes(<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-comment"><span class="hljs-comment">// =&gt; true [1, 2, 3].includes(4); // =&gt; false [1, 2, 3].includes(2, 2); // =&gt; false [NaN].indexOf(NaN); // =&gt; -1 [NaN].includes(NaN); // =&gt; true Array(1).indexOf(undefined); // =&gt; -1 Array(1).includes(undefined); // =&gt; true</span></span></code> </pre><br><a name="array-turn"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> But the method</font></font><code>Array#turn</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is the fruit of my sick fantasy. </font><font style="vertical-align: inherit;">Although, as it turned out, not unique - it is similar to the method</font></font><code>_.transform</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from</font></font><a href="http://lodash.com/docs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> LoDash</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">This is an alternative to the method</font></font><code>Array#reduce</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for convolving an array into an arbitrary battery object (by default, a new array) without having to return the battery from the callback. </font><font style="vertical-align: inherit;">The signature of the method and callback is similar</font></font><code>Array#reduce</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">You can interrupt the collection by returning from the callback</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><a href="http://goo.gl/r3DbCT"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Examples</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   : [1, 2, 3, 4, 5].reduce(function(memo, it){ memo['key' + it] = !!(it % 2); return memo; }, {}); // =&gt; {key1: true, key2: false, key3: true, key4: false, key5: true} [1, 2, 3, 4, 5].turn(function(memo, it){ memo['key' + it] = !!(it % 2); }, {}); // =&gt; {key1: true, key2: false, key3: true, key4: false, key5: true} // filter + map + slice,   : [1, 2, 3, 4, 5, 6, 7, 8, 9].map(function(it){ return it * it; }).filter(function(it){ return it % 2; }).slice(0, 2); // =&gt; [1, 9] [1, 2, 3, 4, 5, 6, 7, 8, 9].turn(function(memo, it){ it % 2 &amp;&amp; memo.push(it * it); if(memo.length == 2)return false; }); // =&gt; [1, 9]</span></span></code> </pre><br><a name="num"></a><h2> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Numbers</font></font></b> </h2><hr><br><a name="num-iter"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Remember the</font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> example with the iterated numbers</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> from the chapter on iterators? Too tasty and versatile opportunity to abandon the similar in the standard library. A very short loop executed a specified number of times, at the base</font></font><code>for-of</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, simple generation of an array of a given length through</font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> #</font></font><code>Array.from</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (and maybe</font></font><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> # spread</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), etc. So let's add an iterator of numbers, though not in such a primitive implementation.</font></font><a href="http://goo.gl/yDD2oM"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Examples</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  : for(var i = 0; i &lt; 3; i++)console.log(i); // =&gt; 0, 1, 2 // for-of   : for(var i of 3)console.log(i); // =&gt; 0, 1, 2 //   for-of, : $for(3).of(console.log); // =&gt; 0, 1, 2 //    : // .map  ""   Array(10).map(Math.random); // =&gt; [undefined √ó 10] // ES5 ,   : Array.apply(undefined, Array(10)).map(Math.random); // =&gt; [0.9442228835541755, 0.8101077508181334, ...] // ES6 ,   : Array(10).fill(undefined).map(Math.random); // =&gt; [0.5587614295072854, 0.009569905698299408, ...] // Number Iterator: Array.from(10, Math.random); // =&gt; [0.9817775336559862, 0.02720663254149258, ...] Array.from(10); // =&gt; [0, 1, 2, 3, 4, 5, 6, 7, 8, 9] Array.from(10, function(it){ return this + it * it; }, .42); // =&gt; [0.42, 1.42, 4.42, 9.42, 16.42, 25.42, 36.42, 49.42, 64.42, 81.42] // Comprehensions: [for(i of 10)if(i % 2)i * i]; // =&gt; [1, 9, 25, 49, 81] Dict((for(i of 3)['key' + i, !(i % 2)])); // =&gt; {key0: true, key1: false, key2: true} $for(10).filter(function(i){ return i % 2; }).array(function(i){ return i * i; }); // =&gt; [1, 9, 25, 49, 81] Dict($for(3).map(function(i){ return ['key' + i, !(i % 2)]; })); // =&gt; {key0: true, key1: false, key2: true}</span></span></code> </pre><br><a name="num-math"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mathematical functions in</font></font><code>Number.prototype</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- from the category of pleasant things. </font><font style="vertical-align: inherit;">Just like in Sugar and MooTools, we move the methods from object</font></font><code>Math</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to</font></font><code>Number.prototype</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">There is nothing special to say here - the context becomes the first argument of a mathematical function. </font><font style="vertical-align: inherit;">Maybe it duplicates the existing, standardized functionality, but this is quite convenient :)</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We mention the method in a separate line</font></font><code>Number#random</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">It returns a random number between the context number and the argument passed (the default is 0). </font></font><br><br> <a href="http://goo.gl/06bs1k"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Examples</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-number"><span class="hljs-number">3.</span></span>.pow(<span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-comment"><span class="hljs-comment">// =&gt; 27 (-729).abs().sqrt(); // =&gt; 27 10..random(20); // =&gt;   (10, 20), , 16.818793776910752 10..random(20).floor(); // =&gt;   [10, 19], , 16 var array = [1, 2, 3, 4, 5]; array[array.length.random().floor()]; // =&gt;   , , 4</span></span></code> </pre><br><a name="escape"></a><h2> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Escaping special characters</font></font></b> </h2><hr><br><a name="escape-html"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> If I suddenly, at the end of the article, say that JavaScript is used, first of all, for working with HTML, I will not reveal a great secret. To work with HTML, both on the client and on the server, we need to escape it. Someone may say that this is the task of the framework or template engine. But is it worth it for such a primitive task to pull them? Methods for escaping HTML are in all standard libraries. In Sugar, Prototype, MooTools are the methods</font></font><code>escapeHTML</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and</font></font><code>unescapeHTML</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the prototype line. We will not break this tradition:</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'&lt;script&gt;doSomething();&lt;/script&gt;'</span></span>.escapeHTML(); <span class="hljs-comment"><span class="hljs-comment">// =&gt; '&amp;lt;script&amp;gt;doSomething();&amp;lt;/script&amp;gt;' '&amp;lt;script&amp;gt;doSomething();&amp;lt;/script&amp;gt;'.unescapeHTML(); // =&gt; '&lt;script&gt;doSomething();&lt;/script&gt;'</span></span></code> </pre><br><a name="escape-regexp"></a> <a href="https://habr.com/ru/post/216997/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Often there is a need to create a regular expression from user data, and for correct / safe operation, you need to screen them as well. </font><font style="vertical-align: inherit;">Methods for this are in Sugar, Prototype, MooTools, somewhere as a static method</font></font><code>RegExp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, somewhere a method</font></font><code>String.prototype</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">It has long been</font></font><a href="http://esdiscuss.org/topic/regexp-escape"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> discussed the</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> addition of such a method in ECMAScript. </font><font style="vertical-align: inherit;">I hope we will wait for this, but for now we will implement the</font></font><a href="https://gist.github.com/kangax/9698100"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> proposed option</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in our library:</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">RegExp</span></span>.escape(<span class="hljs-string"><span class="hljs-string">' -[]{}()*+?.,\\^$|'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// =&gt; ' \-\[\]\{\}\(\)\*\+\?\.\,\\\^\$\|'</span></span></code> </pre><br><a name="end"></a><h2> <b><a href="https://habr.com/ru/post/216997/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Conclusion</font></font></b> </h2><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Somehow like this. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I foresee the appearance of well-known xkcd pictures about standards in the comments, only almost everything in the library is as close as possible, and I don‚Äôt see any alternatives to it except for a hodgepodge of libraries from hundreds of kilobytes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As for plans for the future of the library, they are mainly scattered throughout the text of the article. </font><font style="vertical-align: inherit;">Of course, you also need to optimize performance and better cover the code with tests - with this, I haven't really bothered about it yet. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interested in your opinion that I may have missed and what can be implemented better.</font></font><br><br>  <b>Yes.</b> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And yet, once I started suffering like this, it‚Äôs boring to me. </font><font style="vertical-align: inherit;">I am looking for an interesting project with a decent s / n.</font></font></b> </div><p>Source: <a href="https://habr.com/ru/post/216997/">https://habr.com/ru/post/216997/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../216981/index.html">The creators of the site with pirated Android applications face 5 years in prison</a></li>
<li><a href="../216983/index.html">Static sites in the cloud storage</a></li>
<li><a href="../216985/index.html">Correct YML for Yandex.Market. Programmer's Look</a></li>
<li><a href="../216991/index.html">Registration of sites: now for 1000 rubles</a></li>
<li><a href="../216993/index.html">Ethernet Network Processor: Architectural Innovations for SDN Implementation in Huawei S12700 Agile Switches</a></li>
<li><a href="../216999/index.html">Sony Xperia Z1 Compact: tested in humans</a></li>
<li><a href="../217003/index.html">The human body is like a gadget</a></li>
<li><a href="../217005/index.html">Webinar of HUAWEI Enterprise and Landata companies ‚ÄúNew Huawei TE40 / 50/60 video terminals‚Äù, March 27, 2014</a></li>
<li><a href="../217009/index.html">Logitech Wave (K350). One year later</a></li>
<li><a href="../217011/index.html">Unpleasant Eclipse Surprise</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>