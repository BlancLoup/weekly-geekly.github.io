<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Plotting on Android: sl4a, python and flot</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day,% username%! 

 Introduction 
 Charts - a visual way of presenting information. A picture is worth a thousand words, and a chart in some case...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Plotting on Android: sl4a, python and flot</h1><div class="post__text post__text-html js-mediator-article">  Good day,% username%! <br><br><h4>  Introduction </h4><br>  Charts - a visual way of presenting information.  A picture is worth a thousand words, and a chart in some cases often completely describes the results of an experiment, physical or computational.  In the end, I like the graphics. <br><br>  Once I found myself in the situation that there is already data for plotting, but there is no computer at hand.  But a smartphone can handle such a task!  So I was able to force myself to start applying the knowledge gained from Google‚Äôs half- <a href="http://habrahabr.ru/blogs/python/137206/">year</a> Python <a href="http://habrahabr.ru/blogs/python/137206/">course</a> , and use sl4a, which was already covered with virtual dust.  So, you will need <a href="http://code.google.com/p/android-scripting/">sl4a</a> (who has not heard such an abbreviation, read <a href="http://habrahabr.ru/blogs/android_development/122281/">this</a> , <a href="http://habrahabr.ru/blogs/android_development/134184/">this</a> and <a href="http://habrahabr.ru/blogs/android_development/135902/">this</a> ) + <a href="http://code.google.com/p/flot/">flot</a> (any library for plotting graphs on js will work). <br><a name="habracut"></a><br>  Along the abscissa we count the number of the observed value, along the ordinate its value.  Values ‚Äã‚Äãare calculated as follows: there are 30 logs containing lines of the form ‚Äúvalue = 0.1 0.2 0.15 0.12 ...‚Äù, where ‚Äú0.1 0.2 ...‚Äù are values, ‚Äúvalue‚Äù is the name of the value.  The value ‚Äú1‚Äù is the average for all the first numbers from the corresponding log lines (‚Äú0.1‚Äù in the example string), ‚Äú2‚Äù for all second numbers, etc.  The result is a two-dimensional matrix of size M * N, where M is the number of lines in the log, N is the number of numbers in the line.  It is assumed that the logs contain the same number of lines and the same number of numbers in each line. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Implementation </h4><br><h5>  Graph display with flot </h5><br>  For the construction of the plot is responsible plugin flot to jquery.  From the <a href="http://code.google.com/p/flot/downloads/list">complete set</a> from the site of developers, only jquery.flot.js and jquery.js will be needed for our task.  The log_manager.html code itself: <br><br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Plot<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"layout.css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"jquery.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"jquery.flot.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"placeholder"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"width:535px;height:270px;"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> plotData = </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">d</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{$.plot($(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"#placeholder"</span></span></span><span class="javascript">), [ {</span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">label</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"flux"</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">data</span></span></span><span class="javascript">: </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">eval</span></span></span><span class="javascript">(d.data), </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">color</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"rgb(255, 100, 100)"</span></span></span><span class="javascript"> }] );}; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> droid = </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">new</span></span></span><span class="javascript"> Android(); droid.registerCallback(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"plotData"</span></span></span><span class="javascript">, plotData); </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  Line 13 - plotting with flot.  For example, you can write <br><br><pre> <code class="hljs lua">$.plot($(<span class="hljs-string"><span class="hljs-string">"#placeholder"</span></span>), [ {label: <span class="hljs-string"><span class="hljs-string">"flux"</span></span>, data: <span class="hljs-string"><span class="hljs-string">[[0,0],[1,1],[2,4],[3,9],[4,16]]</span></span>, color: <span class="hljs-string"><span class="hljs-string">"rgb(255, 100, 100)"</span></span> }] );</code> </pre> <br><br>  and a piece of parabola is displayed on the graph.  Thus, the data for construction should be of the form [[x0, y0], [x1, y1], [x2, y2], [x3, y3], ...].  The easiest way that came to my mind is to prepare them in a python script into a string of exactly the same type and wrap it in javascript in eval (), which will execute the transferred string as if it were a piece of js code.  Next, I use this method. <br><br>  Modifying existing and adding new properties of displaying curves on a graph is easy to implement.  For example, to disable the shadow under the curve, just add "shadowSize: 0": <br><br><pre> <code class="hljs lua">$.plot($(<span class="hljs-string"><span class="hljs-string">"#placeholder"</span></span>), [ {label: <span class="hljs-string"><span class="hljs-string">"flux"</span></span>, data: <span class="hljs-string"><span class="hljs-string">[[0,0],[1,1],[2,4],[3,9],[4,16]]</span></span>, shadowSize: <span class="hljs-number"><span class="hljs-number">0</span></span>, color: <span class="hljs-string"><span class="hljs-string">"rgb(255, 100, 100)"</span></span> }] );</code> </pre> <br><br>  Two curves on one graph: <br><br><pre> <code class="hljs lua">$.plot($(<span class="hljs-string"><span class="hljs-string">"#placeholder"</span></span>), [ {label: <span class="hljs-string"><span class="hljs-string">"flux"</span></span>, data: <span class="hljs-string"><span class="hljs-string">[[0,0],[1,1],[2,4],[3,9],[4,16],[5,25]]</span></span>, shadowSize: <span class="hljs-number"><span class="hljs-number">0</span></span>, color: <span class="hljs-string"><span class="hljs-string">"rgb(255, 100, 100)"</span></span> }, {label: <span class="hljs-string"><span class="hljs-string">"flux"</span></span>, data: <span class="hljs-string"><span class="hljs-string">[[0,0],[5,25]]</span></span>, shadowSize: <span class="hljs-number"><span class="hljs-number">0</span></span>, color: <span class="hljs-string"><span class="hljs-string">"rgb(255, 100, 100)"</span></span> }] );</code> </pre> <br><br>  In line 14, an object is created to interact with the Android API (it is returned by the ‚ÄúAndroid ()‚Äù function built into sl4a). <br><br>  Line 15 describes how to handle the resulting event with the name ‚ÄúplotData‚Äù.  As soon as an event with the same name is received, the function ‚ÄúplotData‚Äù is called.  The data transmitted with it (string-array) will be in &lt;input_variable_in_function_name&gt; .data. <br><br>  It remains only to write a script that will read the files, prepare the line and send it.  About this next part. <br><br><h5>  Preparing data with Python </h5><br>  Code log_manager.py: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/python ## Import libraries # android for access to Android API # time for sleep(sec) import android, time # Filename is "&lt;FileCounter&gt;-of-&lt;NumberOfFiles&gt;.log" filename = "/sdcard/864x864x30-0-of-30.log" # Get number of files N = int(filename.split("/")[-1].split("-")[-1].split(".")[0]) # Read first file file = open(filename,"r") value = [] for line in file.readlines(): if "value =" in line: value.append([]) for val in line.split(" "): try: value[-1].append(float(val)) except: continue # Read other files for f in range(1, N): file = open(filename.replace("-0-","-"+str(f)+"-")) i = 0 for line in file.readlines(): if "value =" in line: j = 0 for val in line.split(" "): try: value[i][j] += float(val) j += 1 except: continue i += 1 # Prepare string for flot toBePlotted = "[" for i in range(0, len(value[-1])): toBePlotted += "[" + str(i) + "," + str(value[-1][i]) + "]," toBePlotted += "]" # Get droid object to use Android API droid = android.Android() # Set web view droid.webViewShow('file:///sdcard/sl4a/scripts/log_manager.html') # Wait 3 seconds while web view starts time.sleep(3) # Post event 'plotData' to web view droid.eventPost('plotData', toBePlotted)</span></span></code> </pre><br><br>  This code is bad, so it‚Äôs not worth writing.  But he performs his task: he gets a matrix consisting of the corresponding averages by logs. <br><br>  In lines 1-43, data is read from files into a two-dimensional value array.  At 44-48, a line is prepared for outputting the graph to flot.  In 50-60, a webView is created based on the log_manager.html page (54), wait for 3 seconds, the script waits until the page is loaded (bad approach!) (57), and sends an event with data for plotting (60). <br><br><h4>  results </h4><br>  To test the script, you need to put log_manager.py, log_manager.html, jquery.flot.js and jquery.js in the folder / sdcard / sl4a / scripts.  At the root of the memory card should be files with the names "864x864x30-0-of-30.log" ... "864x864x30-29-of-30.log".  Each log should contain the same number of lines of the form ‚Äúvalue = 0.2 0.34 0.343 ...‚Äù with the same number of numbers in each line.  The script will build a graph based on the average values ‚Äã‚Äãof the last lines of the logs and having the form: <br><br><img src="https://habrastorage.org/storage2/211/5a2/7c1/2115a27c143b51f78d8b9eef156b7c90.png"><br><br>  <a href="http://narod.ru/disk/42765644001.d9d5e1abe47ce62beb98799c3b6fe3f0/sl4a_flot.zip.html">Archive</a> with the files mentioned in the article.  Also in the archive there are jquery.js and jquery.flot.js from the set from the site flot. </div><p>Source: <a href="https://habr.com/ru/post/139417/">https://habr.com/ru/post/139417/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../139410/index.html">MS Windows Server 2003, failover cluster</a></li>
<li><a href="../139411/index.html">Notes Asterisker. Corporate - a holy thing ...</a></li>
<li><a href="../139412/index.html">Samsung AllShare and Linux</a></li>
<li><a href="../139415/index.html">CircuitLab: create schemes in the browser</a></li>
<li><a href="../139416/index.html">Droider Show # 30. Means war!</a></li>
<li><a href="../139419/index.html">Draw the remainder of the owl, or "Seven Missed Steps"</a></li>
<li><a href="../139420/index.html">Remote installation of applications using Kaspersky Security Center</a></li>
<li><a href="../139421/index.html">Spring Data on the example of JPA</a></li>
<li><a href="../139422/index.html">Yandex Mobile Camp at the conference # MBLT12</a></li>
<li><a href="../139423/index.html">Using a bunch of Sinatra, mongodb and carrierwave, we write a simple photo gallery</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>