<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What's New in PostgreSQL 11: Improved Casting</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Continuing the theme of the new features of the upcoming release of PostgreSQL 11 (previous posts: one , two , three ), I would like to tell about one...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What's New in PostgreSQL 11: Improved Casting</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/lj/bg/jd/ljbgjdz1r4gal9_fcbm0mbzlqqm.jpeg"><br><br>  Continuing the theme of the new features of the upcoming release of PostgreSQL 11 (previous posts: <a href="https://habr.com/company/postgrespro/blog/353126/">one</a> , <a href="https://habr.com/company/postgrespro/blog/353848/">two</a> , <a href="https://habr.com/company/postgrespro/blog/354264/">three</a> ), I would like to tell about one small, but important change.  This change concerns the casting of one type to another.  And, of course, it concerns JSONB, because in PostgresPro we love it very much! <a name="habracut"></a><br><br>  This is a <a href="https://git.postgresql.org/gitweb/%3Fp%3Dpostgresql.git%3Ba%3Dcommitdiff%3Bh%3Dc0cbe00fee6d0a5e0ec72c6d68a035e674edc4cc">patch c0cbe00f</a> : 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <code>commit c0cbe00fee6d0a5e0ec72c6d68a035e674edc4cc <br> Author: Teodor Sigaev &lt;teodor@sigaev.ru&gt; <br> Date: Thu Mar 29 16:33:56 2018 +0300 <br> <br> Add casts from jsonb <br> <br> Add explicit cast from scalar jsonb to all numeric and bool types. It would be <br> better to have cast from scalar jsonb to text too but there is already a cast <br> from jsonb to text as just text representation of json. There is no way to have <br> two different casts for the same type's pair. <br> <br> Bump catalog version <br> <br> Author: Anastasia Lubennikova with editorization by Nikita Glukhov and me <br> Review by: Aleksander Alekseev, Nikita Glukhov, Darafei Praliaskouski <br> Discussion: https://www.postgresql.org/message-id/flat/0154d35a-24ae-f063-5273-9ffcdf1c7f2e@postgrespro.ru <br></code> <br><br>  The essence of the problem is this.  If you take PostgreSQL 10, you'll find the following behavior: <br><br> <code>=# select 'true' :: jsonb :: bool; <br> ERROR: cannot cast type jsonb to boolean <br> LINE 1: select 'true' :: jsonb :: bool; <br> <br> =# select '12345' :: jsonb :: int4; <br> ERROR: cannot cast type jsonb to integer <br> LINE 1: select '12345' :: jsonb :: int4; <br> <br> =# select '12345.67' :: jsonb :: float8; <br> ERROR: cannot cast type jsonb to double precision <br> LINE 1: select '12345.67' :: jsonb :: float8; <br></code> <br><br>  That is, JSONB is not cast to numeric types and boolean.  Of course, it‚Äôs not really a big deal.  In the end, you can always paste through the text: <br><br> <code>=# select '12345.67' :: jsonb :: text :: float8; <br> float8 <br> ---------- <br> 12345.67 <br></code> <br><br>  Nevertheless, this decision looks like a crutch, and there are questions about its performance. <br><br>  Now let's take a look at the behavior of the master branch: <br><br> <code>=# select 'true' :: jsonb :: bool; <br> bool <br> ------ <br> t <br> <br> =# select '12345' :: jsonb :: int4; <br> int4 <br> ------- <br> 12345 <br> <br> =# select '12345.67' :: jsonb :: float8; <br> float8 <br> ---------- <br> 12345.67 <br></code> <br><br>  As you can see, you can now cast JSONB to boolean and numeric types.  Hooray! <br><br>  It is characteristic that the casting in the opposite direction is so far possible only through intermediate casting in text: <br><br> <code>=# select 12345.67 :: jsonb; <br> ERROR: cannot cast type numeric to jsonb <br> LINE 1: select 12345.67 :: jsonb; <br> <br> =# select 12345.67 :: text :: jsonb; <br> jsonb <br> ---------- <br> 12345.67 <br> (1 row) <br></code> <br><br>  You ask, why not direct casting?  I think it‚Äôs just that no one has gotten his hands to finish it.  Sounds like an <a href="https://habr.com/company/postgrespro/blog/308442/">opportunity for self-realization</a> , don't you find?  ;) </div><p>Source: <a href="https://habr.com/ru/post/358256/">https://habr.com/ru/post/358256/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../358244/index.html">Playing Cap: how to put the cashier on the cashier's table</a></li>
<li><a href="../358246/index.html">Material Design 2.0 and Android P</a></li>
<li><a href="../358248/index.html">‚ÄúWe are starting! I said: let's start! ‚Äù, Or how we implemented the work with faststart-video for Android</a></li>
<li><a href="../358250/index.html">UI components on pixel shaders: write your first shader</a></li>
<li><a href="../358252/index.html">What I learned from personal experience over the years of freelancing</a></li>
<li><a href="../358258/index.html">How tickets in support turn into tickets in Jira</a></li>
<li><a href="../358260/index.html">Four ways to work with text UI in Unity</a></li>
<li><a href="../358262/index.html">Unreal Engine 4 Tutorial: Paint Filter</a></li>
<li><a href="../358264/index.html">Kubernetes-ha. Deploy Kubernetes failover cluster with 5 masters</a></li>
<li><a href="../358268/index.html">New trend at IT interviews: whole days of unpaid homework</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>