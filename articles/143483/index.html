<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We delve into include and extend</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Translator's note: before reading this post, I recommend that you first familiarize yourself with the post. Understand the Ruby metaclasses . 

 All r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We delve into include and extend</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/f6a/873/a66/f6a873a66af671c03d9ff614e449cc4c.jpg" align="right"><br>  <i>Translator's note: before reading this post, I recommend that you first familiarize yourself with the post. <a href="http://habrahabr.ru/post/143990/">Understand the Ruby metaclasses</a> .</i> <br><br>  All rubists are familiar with the formal definitions for <i>include</i> and <i>extend</i> .  You do <i>include a</i> module to add class instance methods, and <i>extend</i> - to add class methods.  Unfortunately, these definitions are not entirely accurate.  They cannot explain why we use <i>instance.</i>  <i><u>extend</u> (Module)</i> to add methods to the object.  Shouldn't we in this case use an <i>instance.</i>  <i><u>include</u> (Module)</i> ?  To understand this question, let's start by finding out where the methods are stored. <a name="habracut"></a><br><br><h4>  The methods I keep for you and the guy who keeps my methods </h4><br>  Objects in Ruby do not store their own methods.  Instead, they create a singleton class so that it stores their methods. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">who_am_i</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">puts</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">speak_up</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">input</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">puts</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">input</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">upcase</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br>  The interpreter will create a class <i>A</i> and a singleton class attached to it (we will refer to the object's singleton class using the prefix <b>'</b> in front of the object name).  Any class instance methods (like <i>speak_up</i> ) are added to methods stored in class <i>A.</i>  Class methods (like <i>who_am_i</i> ) are stored in class <i>' A.</i> <br><br><pre> <code class="ruby hljs">A.singleton_methods <span class="hljs-comment"><span class="hljs-comment">#    'A #=&gt; [:who_am_i]</span></span></code> </pre> <br><img src="https://habrastorage.org/storage2/356/918/856/356918856be02187db9ecb02f58b73d9.png"><br><br>  The same thing happens with instances of a class.  If we have an object of class <i>A</i> and we add a method to it, we cannot store this method inside the object itself.  Remember - objects in Ruby do not store their own methods. <br><br><pre> <code class="ruby hljs">a = A.new <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not_so_loud</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(input)</span></span></span></span> puts input.downcase <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  Here again, a singleton class is created for the object " <i>a</i> ", so that it <i>stores the not_so_loud</i> method. <br><br><img src="https://habrastorage.org/storage2/880/795/7a6/8807957a61964a327aa9a02889ea21c8.png"><br><br>  Now we have a method that belongs only to the object " <i>a</i> " and does not affect other objects of class <i>A.</i> <br><br><h4>  Am I my father? </h4><br>  Class <i>A</i> contains methods and information about the chain of inheritance needed for object " <i>a</i> " and all other objects of class <i>A.</i>  Similarly, the singleton class <i>A</i> contains methods and information about the inheritance chain for class <i>A.</i>  You can think of class <i>A as an</i> object of class <i>' A.</i>  The trick is that we cannot directly refer to the singleton class <i>' A.</i>  This means that we need to somehow distinguish between adding methods to <i>A</i> and to <i>'A.</i>  Here then <i>include</i> and <i>extend</i> and come into play. <br><br><h4>  include </h4><br>  When you <i>include a</i> module in an object, you add methods to the object's inheritance chain. <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">include</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">M</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><img src="https://habrastorage.org/storage2/32c/6f0/4e1/32c6f04e167d97e3d5dad3025079c4c1.png"><br><br>  This is easily verified by checking the ancestors of class <i>A.</i> <br><br><pre> <code class="ruby hljs">A.ancestors <span class="hljs-comment"><span class="hljs-comment">#=&gt; [A, M, Object, Kernel, BasicObject]</span></span></code> </pre> <br><br><h4>  extend </h4><br>  <i>extend</i> is the same as <i>include</i> , but for a singleton object class. <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">extend</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">M</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><img src="https://habrastorage.org/storage2/a01/148/951/a011489517975cb8a55d87fb76fae399.png"><br><br>  And again we can confirm this by checking the ancestors of the class <i>' A.</i> <br><br><pre> <code class="ruby hljs">A.singleton_class.ancestors <span class="hljs-comment"><span class="hljs-comment">#=&gt; [M, Class, Module, Object, Kernel, BasicObject]</span></span></code> </pre> <br>  We can also use <i>extend</i> for an object. <br><br><pre> <code class="ruby hljs">a = A.new a.extend(M) a.singleton_class.ancestors <span class="hljs-comment"><span class="hljs-comment">#=&gt; [M, A, Object, Kernel, BasicObject]</span></span></code> </pre> <br><img src="https://habrastorage.org/storage2/e3a/983/595/e3a9835951863710a160efd88395cf76.png"><br><br>  If you think about <i>extend</i> as a way to simply add class methods, then everything we have just done does not make much sense.  However, if you look at it as a way to add methods to the singleton class of an object, then the examples above will become clearer. <br><br><h4>  Hook included </h4><br>  Each <i>include</i> call checks the plug-in for the method <i>included</i> .  This method is executed when the module is connected using <i>include</i> .  This is like a constructor ( <i>initialize</i> ) for connections.  As you may have guessed, <i>extend</i> for this purpose has its own method - <i>extended</i> .  So when you want to add both class methods and class instance methods at once, you can use the <i>included</i> hook for this. <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">M</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">included</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">base</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">base</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">extend</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ClassMethods</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">speak_up</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">input</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">puts</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">input</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">upcase</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ClassMethods</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">who_am_i</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">puts</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">C</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">include</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">M</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">c</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">C</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span></span></code> </pre> <br>  First we include the module <i>M</i> in the inheritance chain of class <i>C.</i> <br><br><img src="https://habrastorage.org/storage2/828/b57/74e/828b5774e1bc8905d5d24d9d8bb9058b.png"><br><br>  Then we extend class <i>C</i> by adding methods to the inheritance chain of the class <i>' C.</i> <br><br><img src="https://habrastorage.org/storage2/baf/be6/f7a/bafbe6f7a34d7a0353d95c0820fa5729.png"><br><br><h4>  Conclusion </h4><br>  When you start digging deeper than the typical use of <i>include</i> and <i>extend</i> , you find something strange and frightening.  However, it is necessary to understand the underlying implementation and everything at once makes sense.  Let's now give the definition of <i>include</i> and <i>extend</i> again. <br><br>  <i><b>include</b></i> - adds module methods to the object. <br>  <i><b>extend</b></i> - calls the <i>include</i> for the singleton class of the object. <br><br>  If you are interested in even more details about how the interpreter works, then I recommend watching <a href="http://mwrc2008.confreaks.com/11farley.html">Patrick Farley‚Äôs</a> presentation <a href="http://mwrc2008.confreaks.com/11farley.html">on Ruby Internals</a> . <br><br><blockquote>  Translator's note: Another thing, why we cannot use <i>instance.include (Module)</i> is that the <i>include</i> method is a private method of the <i>Module</i> class.  In general, before reading this article, I also did not imagine the work of <i>extend</i> and <i>include</i> , so I considered it worthwhile to translate it. <br><br>  I will bring some more clarity: what is called the ‚Äúsingleton class‚Äù (singleton class) in the article has other names: metaclass and eigenclass.  This is all the same entity for which there is no ‚Äúofficial" name in the Ruby community yet.  I used the "singleton class" because  it's closer to the original.  However, Matz (the creator of the language) is more impressed with the term eigenclass. </blockquote></div><p>Source: <a href="https://habr.com/ru/post/143483/">https://habr.com/ru/post/143483/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../143477/index.html">Hangouts On Air from Google+: a video broadcasting channel for everyone</a></li>
<li><a href="../143478/index.html">How does the unmanned car "Google"</a></li>
<li><a href="../143479/index.html">LibGDX Tutorial Translation - Part 3 (scene2d package)</a></li>
<li><a href="../143480/index.html">The second Habradestra in Almaty</a></li>
<li><a href="../143482/index.html">Errors of technology transfer No. 3 / ‚ÄúErrors of offshore‚Äù + APDATE</a></li>
<li><a href="../143486/index.html">Changing the Visual Studio interface in the incoming RC</a></li>
<li><a href="../143489/index.html">Inside Startup sauna</a></li>
<li><a href="../143490/index.html">Benefits of Common Lisp</a></li>
<li><a href="../143492/index.html">Electronic library for PocketBook: automatic processing</a></li>
<li><a href="../143494/index.html">Features of the culture of teaching in universities on computer specialties</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>