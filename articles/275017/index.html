<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Alternative Sound Manager for small and medium projects on Unity3D</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I was motivated to write this article by another article about a sound manager suitable for use in small projects. In this post, I will describe some ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Alternative Sound Manager for small and medium projects on Unity3D</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/8b7/7c2/c73/8b77c2c7318b479ea35293deec0a2372.jpg" alt="image" align="left">  I was motivated to write this article by another <a href="http://habrahabr.ru/post/274529/">article</a> about a sound manager suitable for use in small projects.  In this post, I will describe some of the flaws that the author did not list, and offer my own version of the implementation, in my opinion, correcting them. <br><br>  This article will be useful as novice developers to gain experience and get ready to work, as well as avid architects, whose offices have debates about the importance of separating the form from the model and removing the static from the code.  I am sure that the solution proposed by me is not completely universal, and has its drawbacks, but an important and pleasant element for me would be that every interested Habrawner would draw useful information and improve its own modules using my advice. <br><a name="habracut"></a><br><h2>  Problems </h2><br><h4>  Angry loner </h4><br>  Many may not agree with me, but I believe that the use of singletons, especially in such aspects as sound reproduction, is unacceptable in projects of any scale.  With the help of this <s>anti-</s> pattern, all parts of the code are tightly connected, with a direct indication of the type that binds hands in several directions at once.  If it is possible to write a test to a singleton, it is very difficult, it looks ugly and does not shine with determination.  Also, you cannot elegantly write a test for any module that this sound manager will use.  Due to the fact that the same instance is used with an uncontrolled life cycle, you will also tie your hands to yourself, tacitly creating a logical relationship in certain parts of the code that you shouldn‚Äôt know about each other at all. <br><br>  Examples: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PlayMusic</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PlaySound</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pausable = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">true</span></span></span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br>  The method insists that third-party code be aware of specific melody names.  It is the responsibility of the programmer in each of the modules responsible for their sounds to correctly transfer the arguments.  And there may be a lot of such places in the project: various elements of the UI, shooting / dying units, environment.  In the comments to the ref article, one of the readers <a href="http://habrahabr.ru/post/274529/">suggests</a> using various channels for sound in the arguments, which also logically links parts of the code: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PlayFX</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">AudioClip clip, SoundFXChannel channel = SoundFXChannel.First, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> forceInterrupt = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">false</span></span></span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StopFX</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SoundFXChannel channel</span></span></span><span class="hljs-function">)</span></span> { }</code> </pre><br>  Now, for example, the buttons (or, if you like, the UIManager) using methods should take into account which of the channels they belong to, in fact, this is again the responsibility of the programmer. <br><br><h4>  Too much access </h4><br>  It has always been strange to me that when I call a method in a separate code, I get a heir type from MonoBehaviour.  Is it safe to let coroutines on it?  Has the developer protected it from Destroy ()?  Or do I even want to see further in the code ‚Äúusing UnityEngine‚Äù or do I not need MonoBehaviour?  This problem partially applies to the previous paragraph about singleton, we do not need a reference to the instance itself, we have enough API to work with it.  It's funny, but even if you implement a static call like this: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> SoundManager instance; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> ISoundManager Instance { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (instance <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ISoundManager) }}</code> </pre><br>  Then when you get an abstraction, you still have to use a specific type: <br><br><pre> <code class="cs hljs">ISoundManager sm = SoundManager.Instance;</code> </pre><br>  That solves the problem only partially. <br><br><h4>  Sewn path and direct download </h4><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> AudioClip </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadClip</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> path = <span class="hljs-string"><span class="hljs-string">"Sounds/"</span></span> + name; AudioClip clip = Resources.Load&lt;AudioClip&gt;(path); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> clip; }</code> </pre><br>  The delayed loading of sounds, in my opinion, does not always make sense.  First of all, in the import settings of sounds in a unit, you can configure how to store the sound: right in RAM, stream from disk or load into memory, but convert directly before playback.  <a href="http://docs.unity3d.com/Manual/class-AudioClip.html">Read more about import settings</a> .  Secondly, the experience of parsing the assembly logs of a unit suggests that the resources of sounds in terms of overall size are on average at the 3rd or lower place.  And the optimization of memory, if you start, it is not unique with sounds.  (Of course, this is potentially not applicable to projects whose gameplay is tied to sounds).  <a href="http://docs.unity3d.com/ru/current/Manual/LogFiles.html">Read more about logs</a> . <br><br>  Now about the sewn into the code path: Again, the responsibility of the programmer is to monitor the compliance of the path when transferring this module from project to project.  Real dances begin when a sensible thought comes to the team: ‚ÄúWhy not make a git submodule, put an audio manager there, so that in all projects, if necessary, the latest version of this module will be?‚Äù.  Since the path is sewn into the code, we cannot change it, since on other projects it will become erroneous.  On the other hand, if you change the path only locally, then the git will always shine that change for you. <br><br><h4>  Own decision </h4><br>  The module code is located at: <a href="https://github.com/hexgrimm/Audio">https://github.com/hexgrimm/Audio</a> <br>  For publication within the article, the code was simplified, I removed most of the tests and abstractions for them, so that the code looked clearer.  In projects under my leadership, a module is used with a somewhat greater potential for extensibility and a bulk configuration. <br><br>  So, first, let's talk about architecture: <br><br>  This audio module is considered the final sheet in the dependency graph of any architecture, it does not require dependencies below the graph, and it does not matter who creates it, but there is a restriction: This module must have the ‚ÄúSingleton‚Äù lifestyle (not to be confused with the Singleton design pattern, more details in the book ‚ÄúImplementing dependencies in .NET‚Äù Author: Mark Siman).  This is due to the Unity3D requirement for only one AudioListener in the application.  In case you use dependency injection in a project, then the binds will look like this (using the example of Ninject): <br><br><pre> <code class="cs hljs">binder.Bind&lt;IAudioController, IAudioPlayer, IMusicPlayer&gt;().To&lt;AudioController&gt;().InSingletonScope();</code> </pre><br>  In case you just want to create this class and use it in a project, make sure that all sources of the call for sound playback are provided with abstractions of the same instance. <br><br>  As an example: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ac = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AudioController(); IAudioController iac = ac; IAudioPlayer iap = ac; IMusicPlayer imp = ac;</code> </pre><br>  And in the future, work and delivery to all sources is carried out only with abstractions iac, iap, imp. <br><br><h4>  Abstractions </h4><br>  IAudioController, an interface designed for general sound control (on / off, master volume): <br><br><div class="spoiler">  <b class="spoiler_title">IAudioController</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IAudioController</span></span> : <span class="hljs-title"><span class="hljs-title">IDisposable</span></span> { <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> Enabled or disables all sounds in game. All music sources sets volume to = 0 and stops their playback; </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> bool SoundEnabled { get; set; } </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> Enables or disables all musics in game. All music sources sets volume to = 0 or MusicVolume value; </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> bool MusicEnabled { get; set; } </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> Sound volume range 1 - 0 </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> float SoundVolume { get; set; } </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> Music volume in range 1 - 0 </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> float MusicVolume { get; set; } }</span></span></code> </pre><br></div></div><br>  IAudioPlayer, the interface is designed to play 2D and 3D sounds, and their further control. <br><br><div class="spoiler">  <b class="spoiler_title">Iaudioplayer</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IAudioPlayer</span></span> { <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> plays audio clip if sound enabled. </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="clip"&gt;</span></span></span><span class="hljs-comment">Audio clip to play.</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="volumeProportion"&gt;</span></span></span><span class="hljs-comment">volume in range 1 - 0, when plays its also affected by global volume setting.</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="looped"&gt;</span></span></span><span class="hljs-comment">should clip play be looped</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;returns&gt;</span></span></span><span class="hljs-comment"> returns code for this sound call to control playback for concrete clip played.</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/returns&gt;</span></span></span><span class="hljs-comment"> int PlayAudioClip2D(AudioClip clip, float volumeProportion = 1f, bool looped = false); </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> Plays audio clip in concrete 3d position </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="clip"&gt;</span></span></span><span class="hljs-comment">Audio clip to play</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="position"&gt;</span></span></span><span class="hljs-comment">world position of audio source.</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="maxSoundDistance"&gt;</span></span></span><span class="hljs-comment">parameter seted to audioSource.MaxDistance</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="volumeProportion"&gt;</span></span></span><span class="hljs-comment">volume in range 1 - 0, when plays its also affected by global volume setting.</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="looped"&gt;</span></span></span><span class="hljs-comment">should clip play be looped</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;returns&gt;</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/returns&gt;</span></span></span><span class="hljs-comment"> int PlayAudioClip3D(AudioClip clip, Vector3 position, float maxSoundDistance, float volumeProportion = 1f, bool looped = false); </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> stop playing concrete clip. </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="audioCode"&gt;</span></span></span><span class="hljs-comment">code, recived from methods PlayAudioClip2D or PlayAudioClip3D</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment"> void StopPlayingClip(int audioCode); </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> Returns true if audio code contains in player and can be controlled. </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="audioCode"&gt;</span></span></span><span class="hljs-comment">audio code</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;returns&gt;</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/returns&gt;</span></span></span><span class="hljs-comment"> bool IsAudioClipCodePlaying(int audioCode); </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> Sets global audio listener to concrete position </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="position"&gt;</span></span></span><span class="hljs-comment">v3 in world coordinates</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment"> void SetAudioListenerToPosition(Vector3 position); </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> Set position of source if source exist. </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="audioCode"&gt;</span></span></span><span class="hljs-comment">code of source</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="destinationPos"&gt;</span></span></span><span class="hljs-comment">target position in world coordinates</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment"> void SetSourcePositionTo(int audioCode, Vector3 destinationPos); }</span></span></code> </pre><br></div></div><br>  IMusicPlayer, music playback and control. <br><br><div class="spoiler">  <b class="spoiler_title">IMusicPlayer</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IMusicPlayer</span></span> { <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> plays music clip as 2d sound with concrete volume padding. </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="clip"&gt;</span></span></span><span class="hljs-comment">music clip</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="volumeProportion"&gt;</span></span></span><span class="hljs-comment">volume proportions of sound in range of 1 - 0. Its also affected by global music volume settings</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;returns&gt;</span></span></span><span class="hljs-comment">concrete music playback code for future control</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/returns&gt;</span></span></span><span class="hljs-comment"> int PlayMusicClip(AudioClip clip, float volumeProportion = 1f); </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> stops playing music clip and clear data for this code. </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="audioCode"&gt;</span></span></span><span class="hljs-comment">audio code to find audio clip playback</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment"> void StopPlayingMusicClip(int audioCode); </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> Pauses concrete music clip play, it could be resumed. </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="audioCode"&gt;</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment"> void PausePlayingClip(int audioCode); </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> Resumes concrete music clip play if it was paused before. </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="audioCode"&gt;</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment"> void ResumeClipIfInPause(int audioCode); </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> Returns true if audio code contains in player and can be controlled. </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="audioCode"&gt;</span></span></span><span class="hljs-comment">audio code</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;returns&gt;</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/returns&gt;</span></span></span><span class="hljs-comment"> bool IsMusicClipCodePlaying(int audioCode); }</span></span></code> </pre><br></div></div><br>  When you call the method of playing a sound or music, the consumer is given a numeric code by which he can later control the sound. <br><br>  For example, turn it off or change the position of the sound source if the object is moving. <br><br>  A separate method is: <br><br><pre> <code class="cs hljs">SetAudioListenerToPosition(Vector3 position);</code> </pre><br>  In the case of 3d sound and a moving listener, you must provide access to control its position. <br><br>  You may have noticed that one of the arguments to the playback call is the AudioClip type, in my opinion, the storage logic or association of clips and sound sources should not be in the controller itself, so I just took this authority for the module, thereby allowing the module consumer to decide whether to create whether a sound storage base or associating clips directly with sources (in most of our cases this is the case. Different units have female and male voices, this information is an integral part of units, whatever kind of Inca  sulyatsiya have not been applied; and that the unit delivers this information using IAudioPlayer interface). <br><br>  You may also have noticed that IAudioController is inherited from IDisposable.  This is intentional and justified by the limitations that Unity3D imposes.  In the Dispose method, the unit objects created to ensure the module's functionality are removed, in my opinion, with respect to the module, the scene objects are ‚Äúseparately-managed‚Äù resources, and since the AudioController is not MonoBehaviour, we cannot call Destroy ().  And the garbage collector will not be able to clear the links, as managed unit links will be alive.  By calling the Dispose method, we ensure that all resources and links related to the unit have been cleared.  Although in small projects, the life cycle of the audio module is always the same in length as the application's work cycle, so maybe you should not bother. <br><br>  I also apologize for the large number of lines of the form: <br><br><pre> <code class="cs hljs">source.pitch = <span class="hljs-number"><span class="hljs-number">1</span></span> + Random.Range(<span class="hljs-number"><span class="hljs-number">-0.1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.1f</span></span>);</code> </pre><br>  The use of magic numbers, of course, is unacceptable and intentionally written for example, since the configuration that we transmit in real projects through the constructor complicates the code, and I would like to keep the code as simple as possible for beginners. <br><br>  Separately, I will say a few words about the class SavableValue &lt;&gt;.  The utility class for storing any type of serializable types in Prefs had to be duplicated in this module in order not to drag a separate namespace Utils.  I don‚Äôt know how well BinaryFormatter works on non-mobile platforms. <br><br><h4>  What happened in the end </h4><br>  Without using Singleton in the project, we create a convenient seam, and in the future we can replace abstractions, if necessary.  Now you can write any test for playing a class of sound just using mock abstraction. <br><br><pre> <code class="cs hljs">IAudioPlayer mock = Substitute.For&lt;IAudioPlayer &gt;(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> testClass = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Class(mock);</code> </pre><br>  Access to classes is limited by interfaces, nothing extra can be done with them (unless you take abuz with invalid audioCode).  No extra dependencies, except the namespace HexGrimmDev. Audio does not stretch.  As in the recommendations of Mark Simon, all the extra responsibility imposed on the class and, if necessary, can be passed through the designer.  There are no external logical links, you can distribute the module as a git-submodule. <br><br>  I understand that not all isolations are equally useful, but in this case it did not take much to create a seam.  For more inspiration, I propose to read the lecture by Oleg Chumakov on the topic ‚Äú <a href="https://www.youtube.com/watch%3Fv%3Djlr-NLPNi0Q">Why should your Unity project work in the console?</a>  ". <br><br>  And I also strongly recommend that you pass links on modules through the constructor, this is of course more understandable for the consumer, and besides, it damn well disciplines.  And most importantly, I propose not to chase full universalization.  There is an excellent lecture on this topic, " <a href="https://www.youtube.com/watch%3Fv%3DocHpH23UMwU">How not to get carried away by the pursuit of the universalization of components</a> ." <br><br>  Functional list in sample code: <br><br><ul><li>  Reproduction and control of 2d and 3d sounds as well as music. </li><li>  Balancing sound.  (a float argument is passed with a 0-1 range for accurate balancing of individual sounds) (taken into account when changing volume) </li><li>  The possibility of looping. </li><li>  Change the listener's position for 3d sounds. </li><li>  There is a random pitch + -0.1f shift for all sounds except music.  (for example) </li><li>  Pause and resume for music. </li></ul><br>  From specific features: <br><br><ul><li>  AudioMixer is not used. </li><li>  The code has a lot of magic numbers, refactoring before use. </li><li>  There is no smooth transition between music videos, you can implement in many ways. </li><li>  Because of the cuts in the code and after deleting the tests, there is a possibility that something is not working correctly, the code is first and foremost an example, not a means. </li><li>  For writing tests, it is recommended to enter the seam between the components of the unit and the AudioController, and work with AudioSource and AudioListener through additional abstractions, and in the test replace the abstractions with dummies.  In addition, since the test will be performed in a minimum of time. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/275017/">https://habr.com/ru/post/275017/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../275009/index.html">Server in your pocket: deploy ONLYOFFICE on Intel NUCs</a></li>
<li><a href="../27501/index.html">Vladimir Vladimirovich will teach you to knock</a></li>
<li><a href="../275011/index.html">Module loader for node js with support for local modules and load modules on demand</a></li>
<li><a href="../275013/index.html">Who are you writing on Gherkin? Or gherkin in search of the target audience</a></li>
<li><a href="../275015/index.html">350+ useful Docker resources, books and tools</a></li>
<li><a href="../275019/index.html">Routes on Google Maps in the Android application - some clarifications</a></li>
<li><a href="../275021/index.html">Automating the output of the Yandex.Maps widget on the 1C Bitrix platform</a></li>
<li><a href="../275023/index.html">Implements setImmediate: messages, mutations, or promises, which is faster?</a></li>
<li><a href="../275025/index.html">Old New Year Clearance Sale</a></li>
<li><a href="../275027/index.html">21 free educational resource for game developers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>