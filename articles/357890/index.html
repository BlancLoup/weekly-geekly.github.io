<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We process lines on Arduino</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I came to programming in general, and Arduino programming in particular, to complete zero, about two months ago. Now, in the course of my current acti...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We process lines on Arduino</h1><div class="post__text post__text-html js-mediator-article">  I came to programming in general, and Arduino programming in particular, to complete zero, about two months ago.  Now, in the course of my current activities, I felt the need to master the processing of arduino strings.  The usual campaign in Google for information is not pleased with the article, where everything is <s>simple and understandable</s> for dummies written.  And so I am here to talk about how the parsing of lines from the serial port was implemented and which pitfalls were encountered on the way.  I ask those interested under the cat. <br><a name="habracut"></a><br>  So.  Here is an approximate algorithm that I followed: <br><br><ol><li>  We go to <a href="http://arduino.ru/Reference">arduino.ru</a> and look in the type column for everything related to the characters. <br><ul><li>  <a href="http://arduino.ru/Reference/Char">Char data type</a> </li><li>  <a href="http://arduino.ru/Reference/String">Text strings as an array of characters</a> </li><li>  <a href="http://arduino.ru/Reference/StringObject">String object created in version 0.0.19</a> </li></ul><br></li><li>  We decide what form of representation we will use (I stopped at the String class, because I had an unpleasant experience with a <s>mash-up</s> array). </li><li>  <s>Convulsively trying to write our function with preference and professional mesh</s> </li><li>  We <a href="http://arduino.ua/ru/prog/StringObject">are</a> looking for a <a href="http://arduino.ua/ru/prog/StringObject">detailed description of the</a> class. </li><li>  We are looking for the necessary operators. </li><li>  <b>We write!</b> </li></ol><br>  And the algorithm of the main body of the program is simple: <br><br><ol><li>  Cyclically check whether there is a readable byte in the com port buffer, if there is, read. </li><li>  If the received byte is a newline character ('\ n'), then we call the self-writing function of parsing, if not, then add the received byte to the created variable of the String type. </li><li><div class="spoiler">  <b class="spoiler_title">Parsim, finally, a string.</b> <div class="spoiler_text">  In fact, because  the practical use of string parsing is not on my mind, this function is merely demonstrative in nature, comparing the resulting string with the constant string already recorded in memory.  So, using the <a href="http://arduino.ua/ru/prog/StringEquals">equals</a> operator, we compare the accepted string with the written one, and, if the operator returns true, we exit the handler function, if not, we compare it with the next one.  If the strings are equivalent, then again, exit the handler function, returning the result.  Well, if even this condition does not work, then we still exit the function and say that the string is not true. <br></div></div></li><li>  Depending on the received result with the switch case, select the desired one. </li><li>  Reset the accepted string, then begin to collect it again. </li></ol><br><div class="spoiler">  <b class="spoiler_title">But finally, the code:</b> <div class="spoiler_text"><pre><code class="hljs go">#define led <span class="hljs-number"><span class="hljs-number">13</span></span> String input_string = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> String Led_off = <span class="hljs-string"><span class="hljs-string">"switch led off"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> String Led_on = <span class="hljs-string"><span class="hljs-string">"switch led on"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> led_running; void setup() { Serial.begin(<span class="hljs-number"><span class="hljs-number">9600</span></span>); } void loop() { while (Serial.available() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { char c = Serial.read(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c == <span class="hljs-string"><span class="hljs-string">'\n'</span></span>) { Serial.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Input_string is: "</span></span>); Serial.<span class="hljs-built_in"><span class="hljs-built_in">println</span></span>(input_string); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> ( parse(input_string, Led_off, Led_on) ) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>: led_running=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; Serial.<span class="hljs-built_in"><span class="hljs-built_in">println</span></span>(<span class="hljs-string"><span class="hljs-string">"Switching off is done"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>: led_running=<span class="hljs-literal"><span class="hljs-literal">true</span></span>; Serial.<span class="hljs-built_in"><span class="hljs-built_in">println</span></span>(<span class="hljs-string"><span class="hljs-string">"Switching on is done"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: Serial.<span class="hljs-built_in"><span class="hljs-built_in">println</span></span>(<span class="hljs-string"><span class="hljs-string">"invalid String"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } input_string = <span class="hljs-string"><span class="hljs-string">""</span></span>; digitalWrite(led, led_running); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { input_string += c; } } } <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> parse(String input_string, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> String Led_off, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> String Led_on) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (input_string.equals(Led_off) == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (input_string.equals(Led_on) == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br></div></div><br>  So, I did not understand what was going on?  Why doesn't the LED light up?  Oh yeah, how did I forget, in the void setup you need to add: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="hljs lisp">pinMode(<span class="hljs-name"><span class="hljs-name">led</span></span>, OUTPUT)<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre><br><img src="https://habrastorage.org/files/c5c/b67/b37/c5cb67b37ea343f6942763b1afa01fe9.jpg"><br><br>  PS: It is important to set the com port monitor in the Arduino IDE to the ‚ÄúNew Line‚Äù mode, since  in any other string, the string sent will not be followed by its terminator '\ n'. <br><br>  PPS: I don‚Äôt intend to participate in the holivar about the fact that Arduino is not going to participate, learning the basics of programming and algorithmization, I didn‚Äôt do anything wrong. <br><br>  PPPS: If the article is accepted adequately, I will write the following about what happened with the improvement of the functionality of the parsing function.  <font color="#FFFFFF">Well, good luck!</font>  . </div><p>Source: <a href="https://habr.com/ru/post/357890/">https://habr.com/ru/post/357890/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../357880/index.html">Arduino programmable relay</a></li>
<li><a href="../357882/index.html">Laser link between two Arduino Morse code</a></li>
<li><a href="../357884/index.html">Forecaster Class for Weather Station or Weather Predictor</a></li>
<li><a href="../357886/index.html">Arduino: TV viewing time limit using RFID RC522 and</a></li>
<li><a href="../357888/index.html">DMX-512 Channel Level Transmission Visualization</a></li>
<li><a href="../357892/index.html">Based on "Processing lines on Arduino"</a></li>
<li><a href="../357894/index.html">Crazy hands: "Stern dispenser"</a></li>
<li><a href="../357896/index.html">Arduino Home Weather Station</a></li>
<li><a href="../357898/index.html">Build a graph on the character display 1602 Arduino</a></li>
<li><a href="../357900/index.html">Dual axis solar tracker on Arduino</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>