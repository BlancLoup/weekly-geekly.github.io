<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Octopus Deploy. Improving the world in a bloody enterprise</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today I want to talk about the deployment system Octopus Deploy . At the moment there is only one introductory article on this topic on Habr√©, so in m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Octopus Deploy. Improving the world in a bloody enterprise</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/59/dd/21/59dd21a43ef2a189905765.jpeg"><br><br>  Today I want to talk about the deployment system <a href="https://octopus.com/">Octopus Deploy</a> .  At the moment there is only <a href="https://habrahabr.ru/post/262409/">one</a> introductory article on this topic on Habr√©, so in my material I want to expand the description of the system, tell more about such important concepts as ‚Äúlife cycles‚Äù ( <b>lifecycles</b> ) and ‚Äúchannels‚Äù ( <b>channels</b> ), as well as as we have implemented and use Octopus in our work. <br><a name="habracut"></a><br><h2>  Who are we </h2><br>  We are a proprietary department of Tinkoff.ru.  The team I work for is developing a cloud platform for WebOffice virtual desktops.  At the moment we have a Asp.Net MVC application and a ServiceStack-based REST API on the back, and a SPA on Angular on the front.  In addition, there are SOAP-services for integration with other banking systems, Jobs for performing periodic tasks and a number of microservices on .Net Core 2.0. <br><br><h2>  The problems of the old deployment process </h2><br>  When I came to Tinkoff, the deployment of the system was carried out using TeamCity: MSDeploy and the nth number of powershell scripts of varying complexity were used.  Build configuration, responsible for the assembly of the project, and deploy were grouped by the existing circuits at the time: QA and Prod. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The old build and deployment process for each circuit can be conditionally presented as follows: build the project for a given environment (apply the appropriate xml configs transformations) ‚Üí collect the resulting artifacts into several zip files (one for each separately deployed application + database migration scripts + deployment scripts ) ‚Üí Deploy to the server specified for this environment. <br><br>  Since we use several servers for fault tolerance and load distribution, the deployment process took a decent amount of time, because it went sequentially across applications and servers (writing parallel asynchronous tasks on PowerShell is rather painful).  With the addition of additional contours QA2 and Preprod, the number of build-configurations grew, managing the settings of the layouts through scattered parameters was complicated. <br><br><h2>  purpose </h2><br>  We wanted to unify the process of deploying to different contours, speeding it up whenever possible, and also standardize the process of delivering releases depending on their type in our versioning system: major releases should follow the contours QA ‚Üí Pre ‚Üí Prod, minor - QA2 ‚Üí Pre ‚Üí Prod , hotfixes - Pre ‚Üí Prod. <br><br>  Octopus Deploy helped us in all of these desires.  Here are the main advantages that we have gained by incorporating it into our release delivery process: <br><br><ul><li>  a single deployment process for the entire application for all circuits; </li><li>  single place to store variables for the infrastructure settings of the application; </li><li>  parallel deployment to several servers; </li><li>  reducing a large variety of build configurations in TeamCity to one; </li><li>  normal (correct) build life cycle (when the same binaries are deployed first to QA, then to Preprod and then to Prod; in the version with TeamCity, a separate build configuration was configured for each environment); </li><li>  simplification of custom PowerShell scripts by discarding remoting links; </li><li>  visibility of the state of environments, deployment process, the possibility of flexible adjustment of specific deployments; </li><li>  flexible access control rights for release management. </li></ul><br><h2>  Installation and Setup </h2><br>  The installation of the system itself is simple and straightforward: from external dependencies, only MS SQL Server is needed to store the database.  Plus, Octopus Tentacle agent must be installed on every server you are going to deploy to. <br><br>  Its installation is perfectly automated, which removes unnecessary manual work and allows you to prepare new servers for deployment.  To do this, we use Ansible, and after installing the application itself, its configuration is performed by the powershell script: <br><br><div class="spoiler">  <b class="spoiler_title">configure_tentacle.ps1</b> <div class="spoiler_text"><pre><code class="hljs mel">$tentacle = <span class="hljs-string"><span class="hljs-string">'C:\Program Files\Octopus Deploy\Tentacle\Tentacle.exe'</span></span> &amp; $tentacle create-<span class="hljs-keyword"><span class="hljs-keyword">instance</span></span> --<span class="hljs-keyword"><span class="hljs-keyword">instance</span></span> <span class="hljs-string"><span class="hljs-string">"Tentacle"</span></span> --config <span class="hljs-string"><span class="hljs-string">"C:\Octopus\Tentacle.config"</span></span> --console &amp; $tentacle import-certificate --<span class="hljs-keyword"><span class="hljs-keyword">instance</span></span> <span class="hljs-string"><span class="hljs-string">"Tentacle"</span></span> -f <span class="hljs-string"><span class="hljs-string">"C:\ansible_temp\tentacle_cert.txt"</span></span> --console &amp; $tentacle configure --<span class="hljs-keyword"><span class="hljs-keyword">instance</span></span> <span class="hljs-string"><span class="hljs-string">"Tentacle"</span></span> --reset-trust --console &amp; $tentacle configure --<span class="hljs-keyword"><span class="hljs-keyword">instance</span></span> <span class="hljs-string"><span class="hljs-string">"Tentacle"</span></span> --home <span class="hljs-string"><span class="hljs-string">"C:\Octopus"</span></span> --app <span class="hljs-string"><span class="hljs-string">"C:\Octopus\Applications"</span></span> --port <span class="hljs-string"><span class="hljs-string">"10933"</span></span> --console &amp; $tentacle configure --<span class="hljs-keyword"><span class="hljs-keyword">instance</span></span> <span class="hljs-string"><span class="hljs-string">"Tentacle"</span></span> --trust <span class="hljs-string"><span class="hljs-string">"{{ octopus_thumbprint }}"</span></span> --console &amp; netsh advfirewall firewall add rule <span class="hljs-string"><span class="hljs-string">"name=Octopus Deploy Tentacle"</span></span> dir=<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> action=allow protocol=TCP localport=<span class="hljs-number"><span class="hljs-number">10933</span></span> &amp; $tentacle register-with --<span class="hljs-keyword"><span class="hljs-keyword">instance</span></span> <span class="hljs-string"><span class="hljs-string">"Tentacle"</span></span> --server <span class="hljs-string"><span class="hljs-string">"{{ octopus_server }}"</span></span> --apiKey=<span class="hljs-string"><span class="hljs-string">"{{ octopus_api_key }}"</span></span> --role <span class="hljs-string"><span class="hljs-string">"{{ octopus_role }}"</span></span> --environment <span class="hljs-string"><span class="hljs-string">"{{ octopus_env }}"</span></span> --comms-style TentaclePassive --console &amp; $tentacle service --<span class="hljs-keyword"><span class="hljs-keyword">instance</span></span> <span class="hljs-string"><span class="hljs-string">"Tentacle"</span></span> --install --start --console</code> </pre> <br></div></div><br>  As a result, after creating a new server, it is automatically registered in octopus and can be immediately deployed to it.  Very comfortably. <br><br><h2>  Life cycles </h2><br>  One of the key entities in Octopus Deploy are <b>lifecycles</b> .  They are used both for automatic release promotion between environments, and for restricting environments to which an application can be deployed before passing the appropriate testing. <br><br>  For example, for major versions, the system life cycle is defined as QA ‚Üí Pre ‚Üí Prod.  This means that we will not be able to finish the production version before it visits the test and preprode contours.  On the other hand, the life cycle of patch versions is shorter: Pre ‚Üí Prod, because  they are tested immediately on the preprode. <br><img src="https://habrastorage.org/webt/59/d3/b6/59d3b66a4245a438650839.png"><br><br><h2>  Channels </h2><br>  With the help of channels ( <b>channels</b> ) in Octopus, you can independently deploy multiple versions of the same project.  In addition to the rules limiting the package versions, for each channel you can specify the life cycle used to promote releases, configure the deployment process (because each step has a setting for which channels it should be performed), and also define the values ‚Äã‚Äãof variables.  Each release created in Octopus Deploy necessarily refers to a channel. <br><br>  In our project we have channels for major, minor, patch versions, as well as specialized channels for direct output to the hotfixes and deployment of an instance of the system for integration testing. <br><br>  The main charm lies in the ability to automatically create releases in the right channels.  To do this, we specify the range of package versions in the channel properties (and we can also use SemVer tags), which should be used to create a release in this channel.  Octopus will automatically select the latest available packages. <br><br>  Suppose that versions V10.1 and V11.0 are currently being tested.  After the project is built from the V10.1 branch, TeamCity will upload the collected packages (the package version will be 10.1.0.xxxx) to Octopus and trigger the creation of a release in the channel of ‚Äúminor‚Äù releases.  At the same time, it is exactly packages of version 10.1.0.xxxx that will get into the release, despite the fact that Octopus already has newer packages with version 11.0.0.yyyy, since  in Version Range, the channel of the ‚Äúminor‚Äù releases has a range [10.1.0.00000, 10.1.0.99999). <br><br><img src="https://habrastorage.org/webt/59/d3/b6/59d3b6fd7f261768490711.png"><br><br>  Thus, different versions of the application coexist perfectly with each other in channels and follow their own deployment process to different environments. <br>  Here is an example of how it looks in the project control panel: <br><br><img src="https://habrastorage.org/webt/59/dd/f1/59ddf1b1e9b44209636967.png"><br><br><blockquote>  <b>Important!</b>  If you add new steps to the deployment process, add new packages to the channel rules.  If no channel limit is specified for any package in the channel, Octopus will use the latest version of the package.  It may happen that you applet version 10.1, but one package will be, for example, version 11.0, if it already exists in Octopus. </blockquote><br><h2>  Creating NuGet Packages </h2><br>  You can create packages for deployment while assembling projects using the Octopack tool.  It is installed into the necessary projects as a NuGet package, and if you are satisfied with the default settings, you do not need to do anything else. <br><br>  Based on the type of project (console application, web application, windows service), Octopack itself selects the files that will be required for the deployment.  If you need more fine-tuning, which files should get into the package, you can create a custom .nuspec file. <br><br><h2>  TeamCity integration </h2><br>  But the most interesting thing begins when automating the processes of creating (and deploying) releases after building a project on TeamCity.  Here is how this process looks at us: <br><br><ul><li>  the developer after reviewing his task in the version branch; </li><li>  TeamCity builds the project, determines the channel to which the assembly should fall, and causes the release to be created on the desired channel in Octopus Deploy; </li><li>  the availability tester presses the ‚ÄúDeploy‚Äù button in the Octopus control panel and deploys the assembly in the test environment corresponding to this channel. </li></ul><br>  Part of the task of preparing NuGet packages, pouring them into Octopus and creating a release is very easy to do by installing the Octopus Deploy plugin for TeamCity.  For some other operations (for example, automatic updating Version Range at the channel) we wrote small powershell scripts. <br><br><h2>  Guided Failures </h2><br>  If during the deployment process an error occurs on one of the steps, the entire deployment stops and is marked as falling.  This behavior is not always relevant: sometimes we are willing to come to terms with the problems in some of the deployment steps.  For these cases, there is a mode called Guided Failures. <br><br>  If it is on, and an error occurs during deployment, Octopus suspends all operations and displays a special window.  It is possible to indicate the results of the investigation and decide whether to continue the deployment process or not.  In the history of deployment there will be a note about who made it, when and what decision. <br><br><h2>  Deploy scripts in packages </h2><br>  Sometimes before deploying applications and services, we want to perform additional actions.  For example, make sure that the application can access the port when running on behalf of the service account.  This can be done using additional installation scripts, which can be written both in the Octopus web interface and also be part of the application package. <br><br>  In scripts, you can use octopus variables that will be forwarded according to the variable naming rules in PowerShell (points and other special characters will be removed from variable names, thus the octopus variable MyApp.ConnectionString will be available in the script as $ MyAppConnectionString). <br><br><img src="https://habrastorage.org/webt/59/dd/f4/59ddf4688efeb578550866.png"><br>  <i>An example of a pre-deploy script that removes and adds a port reservation for one of our services.</i> <br><br><h2>  Retention policy </h2><br>  One day, in order not to be in a situation with a fully filled hard drive, Octopus has a mechanism for removing packages that were used in older releases and are no longer needed. <br><br>  A packet retention policy is described at the life cycle level, but it can be redefined for its individual phases.  For example, for all application deployment phases on test environments, we store only one latest version of the package. <br><br><img src="https://habrastorage.org/webt/59/dd/f4/59ddf49845a92798819747.png"><br><br>  For the combat environment, we override this setting and store packages for the last five releases (in case you suddenly have to roll back).  You can also specify for which releases to store packages on the machines themselves.  In the case of a rollback, you can deploy it faster without spending time re-downloading packages from the Octopus server. <br><br><img src="https://habrastorage.org/webt/59/dd/f4/59ddf4985e951069256202.png"><br><br><h2>  Additional nishtyaki </h2><br>  In this section I want to share some powershell scripts that we use in our system.  You can use them as is or as an example to implement your own ideas. <br><br><div class="spoiler">  <b class="spoiler_title">Generate release notes</b> <div class="spoiler_text"><pre> <code class="hljs smalltalk"># <span class="hljs-type"><span class="hljs-type">Inspired</span></span> by http://blogs.lessthandot.com/index.php/uncategorized/access-git-commits-during-a-teamcity-build-using-powershell/ function <span class="hljs-type"><span class="hljs-type">Get</span></span>-<span class="hljs-type"><span class="hljs-type">CommitsFromGitLog</span></span>([string] <span class="hljs-string"><span class="hljs-string">$S</span></span>tartCommit, [string] <span class="hljs-string"><span class="hljs-string">$E</span></span>ndCommit){ <span class="hljs-string"><span class="hljs-string">$t</span></span>askRegex = <span class="hljs-comment"><span class="hljs-comment">"(WOF-\d+)"</span></span> <span class="hljs-string"><span class="hljs-string">$C</span></span>md = <span class="hljs-comment"><span class="hljs-comment">"&amp; "</span></span><span class="hljs-comment"><span class="hljs-comment">"%vcsroot.agentGitPath%"</span></span><span class="hljs-comment"><span class="hljs-comment">" log --pretty=format:"</span></span><span class="hljs-comment"><span class="hljs-comment">"%an: %s&lt;br/&gt;"</span></span><span class="hljs-comment"><span class="hljs-comment">" --encoding=cp866 --no-merges $StartCommit...$EndCommit"</span></span> <span class="hljs-string"><span class="hljs-string">$R</span></span>esult = (<span class="hljs-type"><span class="hljs-type">Invoke</span></span>-<span class="hljs-type"><span class="hljs-type">Expression</span></span> <span class="hljs-string"><span class="hljs-string">$C</span></span>md) -replace <span class="hljs-string"><span class="hljs-string">$t</span></span>askRegex,<span class="hljs-string"><span class="hljs-string">'&lt;a href="https://jira.tcsbank.ru/browse/$1"&gt;$1&lt;/a&gt;'</span></span> return <span class="hljs-string"><span class="hljs-string">$R</span></span>esult } function <span class="hljs-type"><span class="hljs-type">Get</span></span>-<span class="hljs-type"><span class="hljs-type">TeamCityLastSuccessfulRun</span></span>( [string] <span class="hljs-string"><span class="hljs-string">$T</span></span>eamCityUrl, [string] <span class="hljs-string"><span class="hljs-string">$T</span></span>eamCityBuildTypeId, [string] <span class="hljs-string"><span class="hljs-string">$T</span></span>eamCityUsername, [string] <span class="hljs-string"><span class="hljs-string">$T</span></span>eamCityPassword, [string] <span class="hljs-string"><span class="hljs-string">$T</span></span>eamCityBranchName) { <span class="hljs-string"><span class="hljs-string">$C</span></span>redentials = <span class="hljs-comment"><span class="hljs-comment">"$($TeamCityUsername):$($TeamCityPassword)"</span></span> <span class="hljs-string"><span class="hljs-string">$A</span></span>uthString = [<span class="hljs-type"><span class="hljs-type">System</span></span>.<span class="hljs-type"><span class="hljs-type">Convert</span></span>]::<span class="hljs-type"><span class="hljs-type">ToBase64String</span></span>([<span class="hljs-type"><span class="hljs-type">System</span></span>.<span class="hljs-type"><span class="hljs-type">Text</span></span>.<span class="hljs-type"><span class="hljs-type">Encoding</span></span>]::<span class="hljs-type"><span class="hljs-type">UTF8</span></span>.<span class="hljs-type"><span class="hljs-type">GetBytes</span></span>(<span class="hljs-comment"><span class="hljs-comment">"$Credentials"</span></span>)) <span class="hljs-string"><span class="hljs-string">$U</span></span>rl = <span class="hljs-comment"><span class="hljs-comment">"$($TeamCityUrl)/app/rest/buildTypes/id:$($TeamCityBuildTypeId)/builds/branch:name:$($TeamCityBranchName),status:SUCCESS"</span></span> <span class="hljs-string"><span class="hljs-string">$C</span></span>ontent = <span class="hljs-type"><span class="hljs-type">Invoke</span></span>-<span class="hljs-type"><span class="hljs-type">WebRequest</span></span> <span class="hljs-comment"><span class="hljs-comment">"$Url"</span></span> -<span class="hljs-type"><span class="hljs-type">Headers</span></span> @{<span class="hljs-comment"><span class="hljs-comment">"Authorization"</span></span> = <span class="hljs-comment"><span class="hljs-comment">"Basic $AuthString"</span></span>} -<span class="hljs-type"><span class="hljs-type">UseBasicParsing</span></span> return <span class="hljs-string"><span class="hljs-string">$C</span></span>ontent } <span class="hljs-string"><span class="hljs-string">$R</span></span>un = <span class="hljs-type"><span class="hljs-type">Get</span></span>-<span class="hljs-type"><span class="hljs-type">TeamCityLastSuccessfulRun</span></span> -<span class="hljs-type"><span class="hljs-type">TeamCityUrl</span></span> <span class="hljs-comment"><span class="hljs-comment">"%teamcity.serverUrl%"</span></span> ` -<span class="hljs-type"><span class="hljs-type">TeamCityBuildTypeId</span></span> <span class="hljs-comment"><span class="hljs-comment">"%system.teamcity.buildType.id%"</span></span> ` -<span class="hljs-type"><span class="hljs-type">TeamCityUsername</span></span> <span class="hljs-comment"><span class="hljs-comment">"%system.teamcity.auth.userId%"</span></span> ` -<span class="hljs-type"><span class="hljs-type">TeamCityPassword</span></span> <span class="hljs-comment"><span class="hljs-comment">"%system.teamcity.auth.password%"</span></span> ` -<span class="hljs-type"><span class="hljs-type">TeamCityBranchName</span></span> <span class="hljs-comment"><span class="hljs-comment">"%teamcity.build.branch%"</span></span> <span class="hljs-string"><span class="hljs-string">$L</span></span>atestCommitFromRun = (<span class="hljs-type"><span class="hljs-type">Select</span></span>-<span class="hljs-type"><span class="hljs-type">Xml</span></span> -<span class="hljs-type"><span class="hljs-type">Content</span></span> <span class="hljs-comment"><span class="hljs-comment">"$Run"</span></span> -<span class="hljs-type"><span class="hljs-type">Xpath</span></span> <span class="hljs-comment"><span class="hljs-comment">"/build/revisions/revision/@version"</span></span>).<span class="hljs-type"><span class="hljs-type">Node</span></span>.<span class="hljs-type"><span class="hljs-type">Value</span></span> <span class="hljs-string"><span class="hljs-string">$C</span></span>ommitsSinceLastSuccess = <span class="hljs-type"><span class="hljs-type">Get</span></span>-<span class="hljs-type"><span class="hljs-type">CommitsFromGitLog</span></span> -<span class="hljs-type"><span class="hljs-type">StartCommit</span></span> <span class="hljs-comment"><span class="hljs-comment">"$LatestCommitFromRun"</span></span> ` -<span class="hljs-type"><span class="hljs-type">EndCommit</span></span> <span class="hljs-comment"><span class="hljs-comment">"%build.vcs.number%"</span></span> <span class="hljs-string"><span class="hljs-string">$C</span></span>ommitsSinceLastSuccess | <span class="hljs-type"><span class="hljs-type">Out</span></span>-<span class="hljs-type"><span class="hljs-type">File</span></span> releasenotes.txt -<span class="hljs-type"><span class="hljs-type">Force</span></span> -<span class="hljs-type"><span class="hljs-type">Encoding</span></span> utf8</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Updating Channel Settings (API)</b> <div class="spoiler_text"><pre> <code class="hljs perl">function UpdateChannel ([string]$OctopusServer, [string]$ApiKey, [string]$ChannelId, [string]$MinVersion, [string]$MaxVersion) { $url = <span class="hljs-string"><span class="hljs-string">"$OctopusServer/api/{0}/{1}"</span></span> $headers = New-Object <span class="hljs-string"><span class="hljs-string">"System.Collections.Generic.Dictionary[[String],[String]]"</span></span> $headers.Add(<span class="hljs-string"><span class="hljs-string">"X-Octopus-ApiKey"</span></span>, $ApiKey) $channel = Invoke-RestMethod -Method Get -Uri ($url -f <span class="hljs-string"><span class="hljs-string">"channels"</span></span>, $ChannelId) -Headers $headers -ContentType <span class="hljs-string"><span class="hljs-string">'application/json;charset=utf-8'</span></span> $channel.Rules[<span class="hljs-number"><span class="hljs-number">0</span></span>].VersionRange = <span class="hljs-string"><span class="hljs-string">"[{0},{1})"</span></span> -f $MinVersion, $MaxVersion $utf8encodedString = [System.Text.Encoding]::UTF8.GetBytes(($channel | ConvertTo-Json -Depth <span class="hljs-number"><span class="hljs-number">3</span></span>)) Invoke-RestMethod -Method Put -Uri ($url -f <span class="hljs-string"><span class="hljs-string">"channels"</span></span>, $ChannelId) -Headers $headers -Body $utf8encodedString } $minVersion = (<span class="hljs-string"><span class="hljs-string">"%CalculatedBuildBranch%").Trim("</span></span>V<span class="hljs-string"><span class="hljs-string">") + "</span></span>.<span class="hljs-number"><span class="hljs-number">00000</span></span><span class="hljs-string"><span class="hljs-string">" $maxVersion = ("</span></span>%CalculatedBuildBranch%").Trim(<span class="hljs-string"><span class="hljs-string">"V"</span></span>) + <span class="hljs-string"><span class="hljs-string">".99999"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-string"><span class="hljs-string">"%TargetChannel%" -eq "</span></span>%PatchChannelName%") { UpdateChannel %OctopusServer% %OctopusApiKey% %PatchChannelId% $minVersion $maxVersion } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-string"><span class="hljs-string">"%TargetChannel%" -eq "</span></span>%MinorChannelName%") { UpdateChannel %OctopusServer% %OctopusApiKey% %MinorChannelId% $minVersion $maxVersion } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-string"><span class="hljs-string">"%TargetChannel%" -eq "</span></span>%MajorChannelName%") { UpdateChannel %OctopusServer% %OctopusApiKey% %MajorChannelId% $minVersion $maxVersion }</code> </pre></div></div><br><h2>  Conclusion </h2><br>  We are very pleased that a year ago we started using Octopus Deploy, and after a short period of test operation, we completely switched to it to deploy the system on all of our environments. <br><br>  The project is actively developing, minor releases are released almost every week.  In the latest versions of Octopus Deploy, I learned how to deploy .net core and mono applications to linux machines, deploy docker containers, and in the latest release 3.17 they added first-class support for deploying Java applications to Tomcat, RedHat JBOSS and Wildfly application servers. <br><br>  In the next article I will talk about multi-tenant deployments, which we use to organize the deployment process of the feature brunches to individual virtuals, automatically raised in the local OpenStack cloud, to conduct isolated testing of individual tasks. </div><p>Source: <a href="https://habr.com/ru/post/339252/">https://habr.com/ru/post/339252/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../339240/index.html">Generate short texts with limiting conditions - for advertising and other purposes.</a></li>
<li><a href="../339242/index.html">About traffic interception: 4-10% of encrypted HTTPS traffic is intercepted today</a></li>
<li><a href="../339246/index.html">Few prefab tasks on bash</a></li>
<li><a href="../339248/index.html">The first hackathon Skyeng: 15 working projects in two days</a></li>
<li><a href="../339250/index.html">Identify hidden data dependencies to improve the quality of the forecast in machine learning</a></li>
<li><a href="../339258/index.html">English subtitles with Leo</a></li>
<li><a href="../339262/index.html">Trends and forecasts: which specialists will be snapped up in the near future?</a></li>
<li><a href="../339264/index.html">Introduction to reverse engineering with Radare2</a></li>
<li><a href="../339268/index.html">Play bash'im together</a></li>
<li><a href="../339270/index.html">Wi-Fi is over: calculate offenders wireless</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>