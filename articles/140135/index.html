<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tilt-Shift DIY Photos</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What are Tilt-Shift lenses and what can be done with their help many people know. Recently on Habr√© there was an article about the Tilt-Shift generato...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tilt-Shift DIY Photos</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/a14/e3e/bc1/a14e3ebc13cda765eeac85837362378c.jpg" align="left">  What are <a href="http://www.youtube.com/watch%3Fv%3D0HRYlJUwzYA">Tilt-Shift lenses</a> and what <a href="http://www.youtube.com/watch%3Fv%3DFk9EBOOAYiU">can be done</a> with their help many people know.  Recently on Habr√© there was an article about the Tilt-Shift <a href="http://habrahabr.ru/post/138210/">generator</a> , which creates this effect by processing ordinary photos.  But this program is written only for Windows, and you also have to pay for it.  All plug-ins for graphic editors for some reason also demanded money and licenses.  Therefore, it was decided to deal with this issue independently and make the tool a little easier than professional software, and not ideally simulating lens optics, but free, open and accessible to everyone!  What came out of it, and what not, you can see for yourself. <br><a name="habracut"></a><br>  Let's start with the fact that we make our first thumbnail. <br>  Getting started, first of all you need to select a photo.  It makes no sense to try to process images that are not suitable initially.  For the most part, landscape, city pictures taken from an elevation are used for this - this is the first thing that helps create the illusion of a small world.  It is also good if there are small objects in the frame, such as transport and people. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/storage2/ef6/2de/f4f/ef62def4f7b2dd98a3ec322e9f76fb40.png"></div><br><br>  The main effect in such photos is achieved due to the rotation of the lens, which leads to the fact that the focus plane becomes non-perpendicular to the optical axis.  This, in turn, leads to the formation of a wedge-shaped depth of field.  On how to create this effect with the help of graphic editors, you can get acquainted with the photoshop lessons on any website, so let's get straight to the point. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For work, I chose this photo: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/storage2/487/074/0f2/4870740f298b063a026f7b0d01d7c516.png"></div><br><br>  After adding saturation and applying filters in Photoshop, we get the following result: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/storage2/fea/7cb/4cf/fea7cb4cfa612a2a16d763c19a3dd01a.png"></div><br><br>  Of course, a sophisticated reader will not be fooled, and a real optical effect is quite easy to distinguish from filters, but still with fairly competent setting of the frame with improvised means you can achieve good results. <br>  In fact, all that had to be done with the image was to impose an artificial bokeh in the right places and adjust the color saturation, which helps to give the effect of plastic models to objects in the frame. <br><br>  Let's move on to programming. <br><br>  Let's start with the simple.  First you need to prepare a mask for the image.  In order not to load yourself immediately with extra work, let's do it in Photoshop.  In dark places, the value of the alpha layer will be equal to the maximum value, in white - zero, that is, the image in these places will be transparent. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/storage2/1ab/8c5/268/1ab8c52684be9c669a79589e6a8f2eec.png"></div><br><br>  In a place with black pixels, the overlapping bokeh will not occur and the scene will remain in focus.  The mask was made using the ‚Äúroughly roll‚Äù method; this is just a demonstration of the approach. <br>  Having a little picked in python, it turned out such a small and neat script: <br><br><blockquote><ol><li>  <font color="#ff7700">import</font> Image </li><li>  <font color="#ff7700">import</font> <font color="#dc143c">sys</font> </li><li>  <font color="#ff7700">import</font> numpy <font color="#ff7700">as</font> np </li><li>  <font color="#ff7700">from</font> scipy <font color="#ff7700">import</font> ndimage </li><li>  <font color="#ff7700">import</font> ImageEnhance </li><li></li><li>  <font color="#808080"># INIT</font> </li><li>  blur_size = <font color="#ff4500">6</font> </li><li>  image_base = <font color="#483d8b">"/Users/Mango/Desktop/tiltshift_alpha.png"</font> </li><li>  image_mask = <font color="#483d8b">"/Users/Mango/Desktop/mask_tiltshift.png"</font> </li><li>  image_output = <font color="#483d8b">"/Users/Mango/Desktop/tiltshift_preview.png"</font> </li><li></li><li>  <font color="#808080"># LOAD</font> </li><li>  im_base = Image.  <font color="#008000">open</font> <font>(</font> image_base <font>)</font> </li><li>  im_mask = Image.  <font color="#008000">open</font> <font>(</font> image_mask <font>)</font> </li><li>  im_mask = im_mask.  <font>resize</font> <font>(</font> im_base. <font>size</font> <font>)</font> </li><li></li><li>  <font color="#808080"># PROCESS</font> </li><li>  enh = ImageEnhance.  <font>Color</font> <font>(</font> im_base <font>)</font> </li><li>  im_base = enh.  <font>enhance</font> <font>(</font> <font color="#ff4500">1.7</font> <font>)</font> </li><li>  enh = ImageEnhance.  <font>Contrast</font> <font>(</font> im_base <font>)</font> </li><li>  im_base = enh.  <font>enhance</font> <font>(</font> <font color="#ff4500">1.2</font> <font>)</font> </li><li></li><li>  im_blurred = np.  <font color="#dc143c">array</font> <font>(</font> im_base, dtype = <font color="#008000">float</font> <font>)</font> </li><li>  im_blurred = ndimage.  <font>gaussian_filter</font> <font>(</font> im_blurred, sigma = <font>[</font> blur_size, blur_size, <font color="#ff4500">0</font> <font>]</font> <font>)</font> </li><li>  im_blurred = Image.  <font>fromarray</font> <font>(</font> np. <font>uint8</font> <font>(</font> im_blurred <font>)</font> <font>)</font> </li><li>  im_mask = im_mask.  <font>convert</font> <font>(</font> <font color="#483d8b">"L"</font> <font>)</font> </li><li>  im_base = im_base.  <font>convert</font> <font>(</font> <font color="#483d8b">"RGBA"</font> <font>)</font> </li><li></li><li>  <font color="#808080"># MERGE AND SAVE</font> </li><li>  im_base.  <font>paste</font> <font>(</font> im_blurred, mask = im_mask <font>)</font> </li><li>  im_base.  <font>save</font> <font>(</font> image_output <font>)</font> </li></ol></blockquote><br>  First we get the original image and mask, then the mask size is adjusted to the image size and processing begins.  With the help of the ImageEnhance module you can adjust such indicators as color, brightness and contrast.  After that, im_blurred saves a copy of the image as an array.  To create the bokeh, I used the good old figure of Gauss blur.  His result differs from the same Lens Blur in professional editors, but for a start it is a quite good result. <br>  At the final stage, a blurred image is superimposed on our original using an alpha mask.  It is also worth considering that each layer must have the correct palette.  The mask is used in monochrome L mode, and the alpha layer is added to the original image using convert (‚ÄúRGBA‚Äù), which we allow using the mask to overlay the second layer. <br>  Here's what happened in the end: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/storage2/a3b/ece/da6/a3beceda646225485645282d53ed1de5.png"></div><br><br>  Now let's finish the received code a bit and get rid of the ugly external addition in the form of a hand-drawn mask.  There is nothing complicated about it, it is a so-called reflected gradient and is given by two collinear vectors. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/storage2/822/358/5be/8223585befe1717f915e0a565a17b93a.jpg"></div><br><br>  In a more simplified form, this model can be represented as follows: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/storage2/87d/da7/956/87dda79561ef8faf8e2f6002ba2402ec.jpg"></div><br><br>  The whole system is defined by several parameters: the direction, the length of the vector A, the focus area and the vector B. All distances for simplicity are set along the y axis. <br>  The construction of the gradient is as follows.  At first, an image with a width of one pixel is built for the given distances; it will act as a pattern.  After which, by various manipulations, you can give it any shape and turn it to the desired angle. <br>  Having a little experimented, I got this function: <br><br><blockquote><ol><li>  <font color="#ff7700">import</font> Image </li><li>  <font color="#ff7700">import</font> ImageDraw </li><li>  <font color="#ff7700">import</font> ImageOps </li><li>  <font color="#ff7700">import</font> <font color="#dc143c">math</font> </li><li></li><li>  <font color="#ff7700">def</font> draw_mask <font>(</font> angle, width, height, offset_init, offset_A, offset_focus, offset_B <font>)</font> : </li><li>  offset = height <font color="#66cc66">*</font> offset_init / <font color="#ff4500">100</font> </li><li>  vectorA = offset + offset_A <font color="#66cc66">*</font> height / <font color="#ff4500">100</font> </li><li>  focus = vectorA + offset_focus <font color="#66cc66">*</font> height / <font color="#ff4500">100</font> </li><li>  vectorB = focus + offset_B <font color="#66cc66">*</font> height / <font color="#ff4500">100</font> </li><li></li><li>  mask = Image.  <font color="#dc143c">new</font> <font>(</font> <font color="#483d8b">'L'</font> , <font>(</font> width, height <font>)</font> <font>)</font> </li><li>  mask_1px = Image.  <font color="#dc143c">new</font> <font>(</font> <font color="#483d8b">'L'</font> , <font>(</font> <font color="#ff4500">1</font> , height <font>)</font> <font>)</font> </li><li>  draw_1px = ImageDraw.  <font>Draw</font> <font>(</font> mask_1px <font>)</font> </li><li>  <font color="#ff7700">for</font> y <font color="#ff7700">in</font> <font color="#008000">range</font> <font>(</font> <font color="#ff4500">0</font> , offset <font>)</font> : <font color="#808080"># draw white zone</font> </li><li>  draw_1px.  <font>point</font> <font>(</font> <font>(</font> <font color="#ff4500">0</font> , y <font>)</font> , <font color="#ff4500">255</font> <font>)</font> </li><li>  <font color="#ff7700">for</font> y <font color="#ff7700">in</font> <font color="#008000">range</font> <font>(</font> offset, vectorA <font>)</font> : <font color="#808080"># draw vectorA</font> </li><li>  draw_1px.  <font>point</font> <font>(</font> <font>(</font> <font color="#ff4500">0</font> , y <font>)</font> , <font>(</font> vectorA-y <font>)</font> <font color="#66cc66">*</font> <font>(</font> <font color="#ff4500">255</font> / <font>(</font> vectorA-offset <font>)</font> <font>)</font> <font>)</font> </li><li>  <font color="#ff7700">for</font> y <font color="#ff7700">in</font> <font color="#008000">range</font> <font>(</font> vectorA, focus <font>)</font> : <font color="#808080"># draw white zone</font> </li><li>  draw_1px.  <font>point</font> <font>(</font> <font>(</font> <font color="#ff4500">0</font> , y <font>)</font> , <font color="#ff4500">0</font> <font>)</font> </li><li>  <font color="#ff7700">for</font> y <font color="#ff7700">in</font> <font color="#008000">range</font> <font>(</font> focus, vectorB <font>)</font> : <font color="#808080"># draw vectorB</font> </li><li>  draw_1px.  <font>point</font> <font>(</font> <font>(</font> <font color="#ff4500">0</font> , y <font>)</font> , <font color="#ff4500">255</font> - <font>(</font> vectorB-y <font>)</font> <font color="#66cc66">*</font> <font>(</font> <font color="#ff4500">255</font> / <font>(</font> vectorB-focus <font>)</font> <font>)</font> <font>)</font> </li><li>  <font color="#ff7700">for</font> y <font color="#ff7700">in</font> <font color="#008000">range</font> <font>(</font> vectorB, height <font>)</font> : <font color="#808080"># draw white zone</font> </li><li>  draw_1px.  <font>point</font> <font>(</font> <font>(</font> <font color="#ff4500">0</font> , y <font>)</font> , <font color="#ff4500">255</font> <font>)</font> </li><li></li><li>  m_width, m_height = mask.  <font>size</font> </li><li>  mask_1px = mask_1px.  <font>resize</font> <font>(</font> <font>(</font> <font color="#008000">int</font> <font>(</font> m_width <font color="#66cc66">*</font> <font color="#ff4500">3</font> <font>)</font> , m_height <font>)</font> , Image. <font>ANTIALIAS</font> <font>)</font> </li><li>  mask_1px = ImageOps.  <font>invert</font> <font>(</font> mask_1px <font>)</font> </li><li>  mask_top = mask_1px.  <font>rotate</font> <font>(</font> angle, Image. <font>NEAREST</font> , <font color="#ff4500">1</font> <font>)</font> </li><li>  mask_top = ImageOps.  <font>invert</font> <font>(</font> mask_top <font>)</font> </li><li></li><li>  mask.  <font>convert</font> <font>(</font> <font color="#483d8b">"RGBA"</font> <font>)</font> </li><li>  n_width, n_height = mask_top.  <font>size</font> </li><li>  mask.  <font>paste</font> <font>(</font> mask_top, <font>(</font> -n_width / <font color="#ff4500">2</font> , - <font>(</font> n_height / <font color="#ff4500">2</font> -height / <font color="#ff4500">2</font> <font>)</font> <font>)</font> <font>)</font> </li><li>  mask.  <font>convert</font> <font>(</font> <font color="#483d8b">"L"</font> <font>)</font> </li><li>  <font color="#ff7700">return</font> mask </li></ol></blockquote><br><img src="https://habrastorage.org/storage2/7a2/3a5/250/7a23a52509f82f030f1398a666638461.png"><br><br>  This code takes into account the angle of rotation in case you want to make the tool more versatile or screw it to the web interface, which I intend to do in the near future. <br>  If anyone needs the source code, the final version is on <a href="https://github.com/matveyco/python-tilt-shift">github</a> . </div><p>Source: <a href="https://habr.com/ru/post/140135/">https://habr.com/ru/post/140135/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../140127/index.html">The issue of phone numbers in the LTE network is being resolved.</a></li>
<li><a href="../140128/index.html">New features and services of the Pravo.ru SPS</a></li>
<li><a href="../140132/index.html">Google Apps Script Hackathon for Automating Business Processes</a></li>
<li><a href="../140133/index.html">Class loading in application servers, features of JBoss AS 7</a></li>
<li><a href="../140134/index.html">CardboardBot v1.0 - recycle cardboard with brain benefits</a></li>
<li><a href="../140136/index.html">i-COMference'2012: Accents and Conclusions</a></li>
<li><a href="../140137/index.html">NetApp FAS2240</a></li>
<li><a href="../140139/index.html">Avast Mobile Security for Android Review</a></li>
<li><a href="../140140/index.html">First KnockoutJS training from Roman Gomolko in Dnepropetrovsk</a></li>
<li><a href="../140141/index.html">TOP-3 Hi-tech: Unrecognized gadgets!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>