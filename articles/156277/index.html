<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How easy it is to connect any OPC server sensor to the narodmon.ru project</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. 

 More recently, I learned that there is one simple but useful project ‚ÄúPeople's Monitoring‚Äù. Its meaning is, if in brief, to combine many dis...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How easy it is to connect any OPC server sensor to the narodmon.ru project</h1><div class="post__text post__text-html js-mediator-article">  Hello. <br><br>  More recently, I learned that there is one simple but useful project <a href="http://narodmon.ru/">‚ÄúPeople's Monitoring‚Äù.</a> Its meaning is, if in brief, to combine many disparate environmental monitoring sensors in one place.  Indeed, it is one thing, for example, to see the weather forecast on the Internet, and it‚Äôs quite another thing to really see where the temperature, humidity, pressure and their change over time. <br><a name="habracut"></a><br>  Or, for example, if it is commonplace to be too lazy to get up and look at the thermometer outside the window) <br><br><img src="https://habrastorage.org/storage2/909/f1e/668/909f1e668baaaeaba81f56e827d60e74.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This project allows you to "store", display and watch the data change history.  In general, all that is necessary for happiness is there.  You can make the sensors public or private. <br><br>  For those who want to join there are ready-made devices and how to get them can be found on the website.  <a href="http://habrahabr.ru/qa/4470/">Here is a</a> link to the post from which it all began and an example of the device in the same place. <br><br>  In addition, there are many sensors in the composition of SCADA systems and many of them may reflect environmental parameters in a variety of geographic locations.  That's what I want to tell you about - like to fasten any SCADA system of any OPC server sensor to the above described service. <br><br>  So we need: <br><br>  1. Python 2.7 <br>  2. <a href="http://openopc.sourceforge.net/api.html">Open OPC for Python</a> <br>  3. <a href="http://sourceforge.net/projects/pywin32/">Python for Windows extensions</a> <br><br>  All this is installed on the machine where the OPC server is spinning, or remotely.  I installed locally. <br><br>  Next, just run my script, striking in its complexity: <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> OpenOPC <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> socket <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: opc = OpenOPC.client() opc.connect(<span class="hljs-string"><span class="hljs-string">"OWEN.RS485"</span></span>) s = socket.socket( socket.AF_INET, socket.SOCK_DGRAM ) <span class="hljs-comment"><span class="hljs-comment"># UDP addr = ('narodmon.ru',1234) # ip:port    " " val = opc['Com1/TRM138(8bit adr=24)/ChannelData3/rEAd'] buf = "#123456789ABCDE\n#123456789ABCDE10#" +"%.1f#"%val + "\n##" s.sendto(buf,addr) opc.close() s.close() except : pass time.sleep(180)</span></span></code> </pre> <br><br>  As you can see, I connect to the OWEN server ‚ÄúOWEN.RS485‚Äù and read the value of the item 'Com1 / TRM138 (8bit adr = 24) / ChannelData3 / rEAd'.  Thus, you can read the value of any "item" OPC server. <br><br>  By the way, if you study the documentation for OpenOPC, then you will find there many useful functions which are quite sufficient for creating for example a small visualization. <br><br>  The package for sending is formed from the unique device ID 123456789ABCDE (you can think of your own, but it is better to use the serial number of the sensor or the input module) and the unique sensor ID.  The last one I got was adding 0x10 to the device ID, which means that it is a temperature sensor.  You can read more on the project website in the section for developers. <br><br>  The very connection to the service is very simple.  You need to register on the site and start sending packages.  When the system receives several packages, it will be possible to create a new device and add a sensor to it.  For debugging there is monitoring of packets from your IP in the section for developers.  With all questions, thanks and suggestions about the service you can contact the creator of the service <a href="http://habrahabr.ru/users/ssar/" class="user_link">SSar</a> <br><br>  For those who are not looking for easy ways, I‚Äôll add a listing of the windows service that does the same thing: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># -*- coding: utf-8 -*- import win32serviceutil import win32service import win32event import servicemanager import OpenOPC import socket class AppServerSvc (win32serviceutil.ServiceFramework): _svc_name_ = "ServiceForNarodmon" _svc_display_name_ = "ServiceForNarodmon" _svc_description_ = "Service For Narodmon.ru" def __init__(self,args): win32serviceutil.ServiceFramework.__init__(self,args) self.hWaitStop = win32event.CreateEvent(None,0,0,None) self.hWaitResume = win32event.CreateEvent(None, 0, 0, None) self.timeout = 60000 #        self.resumeTimeout = 1000 self._paused = False def SvcStop(self): self.ReportServiceStatus(win32service.SERVICE_STOP_PENDING) win32event.SetEvent(self.hWaitStop) #servicemanager.LogMsg(servicemanager.EVENTLOG_INFORMATION_TYPE, #servicemanager.PYS_SERVICE_STOPPED, #(self._svc_name_, '')) def SvcPause(self): self.ReportServiceStatus(win32service.SERVICE_PAUSE_PENDING) self._paused = True self.ReportServiceStatus(win32service.SERVICE_PAUSED) #servicemanager.LogInfoMsg("The %s service has paused." % (self._svc_name_, )) def SvcContinue(self): self.ReportServiceStatus(win32service.SERVICE_CONTINUE_PENDING) win32event.SetEvent(self.hWaitResume) self.ReportServiceStatus(win32service.SERVICE_RUNNING) #servicemanager.LogInfoMsg("The %s service has resumed." % (self._svc_name_, )) def SvcDoRun(self): #servicemanager.LogMsg(servicemanager.EVENTLOG_INFORMATION_TYPE, # servicemanager.PYS_SERVICE_STARTED, # (self._svc_name_,"")) self.main() #      def main(self): #       #servicemanager.LogInfoMsg("Hello! Im a Narodmon.ru Service.") while 1: #      #servicemanager.LogInfoMsg("I'm still here.") try: opc = OpenOPC.client() opc.connect("OWEN.RS485") s = socket.socket( socket.AF_INET, socket.SOCK_DGRAM ) # UDP addr = ('narodmon.ru',1234) # ip:port    " " val = opc['Com1/TRM138(8bit adr=24)/ChannelData3/rEAd'] buf = "#123456789ABCDE\n#123456789ABCDE10#" +"%.1f#"%val + "\n##" s.sendto(buf,addr) opc.close() s.close() except : pass #        rc = win32event.WaitForSingleObject(self.hWaitStop, self.timeout) if rc == win32event.WAIT_OBJECT_0: #       #servicemanager.LogInfoMsg("Bye!") break #       if self._paused: pass #servicemanager.LogInfoMsg("I'm paused... Keep waiting...") #   while self._paused: #        rc = win32event.WaitForSingleObject(self.hWaitResume, self.resumeTimeout) if rc == win32event.WAIT_OBJECT_0: self._paused = False #        #servicemanager.LogInfoMsg("Yeah! Let's continue!") break if __name__ == '__main__': win32serviceutil.HandleCommandLine(AppServerSvc)</span></span></code> </pre><br><br>  All attempts to write messages to the system log are commented out because they do not work in WinXP.  I didn‚Äôt understand further because everything is fine on Win7.  You can ‚Äúgrind‚Äù your service with ‚Äúblackjack and women of light providence‚Äù. <br><br>  Good luck! </div><p>Source: <a href="https://habr.com/ru/post/156277/">https://habr.com/ru/post/156277/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../156267/index.html">The new Switchvox 450 & 470, API and something else ...</a></li>
<li><a href="../156269/index.html">The results of the contest "I and my ASUS: One Day in Our Life"</a></li>
<li><a href="../156271/index.html">Component MacBook Repair: Power Supply Repair</a></li>
<li><a href="../156273/index.html">Modification in the database tabular or multiple fields of documents</a></li>
<li><a href="../156275/index.html">Data on 1 million Facebook users cost $ 5.</a></li>
<li><a href="../156279/index.html">Fuelphp in the field</a></li>
<li><a href="../156281/index.html">The benefits of a scientific approach for startups</a></li>
<li><a href="../156283/index.html">AnnotatedSQL lib - automatic database generation in Android</a></li>
<li><a href="../156285/index.html">Disable editing model properties in ASP.NET MVC</a></li>
<li><a href="../156289/index.html">Intel¬Æ Inspector XE 2013: Automatic Real-Time Verification and Debugging</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>