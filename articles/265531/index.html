<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Emacs: we train the cursor</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What are these jumps for? 


 Ostap Bender 
 Introduction 
 Actually, I wanted to write a short note about some of the features of working with Clojur...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Emacs: we train the cursor</h1><div class="post__text post__text-html js-mediator-article">  <i>What are these jumps for?</i> <br><pre>  Ostap Bender </pre><br><h2>  Introduction </h2><br>  Actually, I wanted to write a short note about some of the features of working with Clojure macros.  But at the same time I decided to finally get acquainted with Emacs more thoroughly. <br><br>  Of course, I‚Äôm not exactly the same as Lisp, but we‚Äôve already known ... for twenty years, and the potential of this wonderful language (even more likely philosophy) is quite possible in theory and in practice.  It was a matter of writing its own implementations (rather, for a better understanding of the mechanisms of operation of the Lisp interpreter than for practical use).  However, Emacs was hardly ever used.  in the old days of fairly dense work with lisp, it was quite costly with the built-in editor of my version (muLisp, the editor, of course, was also written on it).  Then we had to work with ‚Äúmore other‚Äù tools, and in recent years, a completely different field.  Now here is a little time "for the soul" ... <br><br>  Actually, the ‚Äúimmersion‚Äù in Emacs was quite comfortable - although I (for some reason still) are not a Unixoid, but I understand the console commands and the whole keyboard experience.  Setting up the control and gentlemanly set of "plug-ins" also did not cause problems.  Screwing SBCL, Clojure and Scala had to tinker a bit, but it was the inadequacy of the versions and / or their (versions) inherent problems. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      However, the ‚Äújumping cursor‚Äù syndrome (moving to the end of the line when moving to the next / previous line if it is shorter than the current one) causes a slight idiosyncrasy.  If it were not for Emacs, it would most likely have to be reconciled and look for ‚Äúconceptuality‚Äù in this approach, as is often done when it is impossible to solve problems.  But, since we are dealing with the designer of editors, the problem was interpreted as a challenge (as it is now fashionable to say). <br><a name="habracut"></a><br>  So let us leave aside the question of the necessity of ‚Äútraining‚Äù the cursor - for me personally this ‚Äú50 to 50‚Äù convenience and just <s>good physics is a</s> good exercise to familiarize yourself with the concept of programming Emacs.  Perhaps someone will also be interesting and useful, at least ‚Äúon a vskidku‚Äù I did not find ready-made solutions (only the questions ‚Äúhow to do? ..‚Äù) - I admit that I didn‚Äôt search much because of the reasons above. <br><br><h2>  The target audience </h2><br>  I‚Äôll just say that for those who are familiar with Emacs Lisp this is a half an hour problem, so the article is addressed primarily to those who begin to get acquainted with the practical possibilities of programming Emacs.  The writing style implies knowledge of the basics of Emacs Lisp and the basic concepts of Emacs. <br><br>  In turn, from the experts I would like to hear comments on alternative solutions that I probably did not see because of a superficial familiarity with the Emacs architecture for the time being. <br><br><h2>  Decision </h2><br>  Actually, my solution is quite obvious: <br><ul><li>  since we can move the <a href="http://www.gnu.org/software/emacs/manual/html_node/emacs/Point.html">cursor</a> only in terms of the <a href="http://www.gnu.org/savannah-checkouts/gnu/emacs/manual/html_node/elisp/Buffer-Basics.html">buffer</a> , we will need to supplement the lines with ‚Äúextra‚Äù spaces in order to move the cursor to the desired position; </li><li>  since these spaces are really superfluous, it is necessary to remove them as soon as possible; </li><li>  it is most convenient to issue functionality as <a href="http://www.gnu.org/savannah-checkouts/gnu/emacs/manual/html_node/elisp/Minor-Modes.html">minor mode</a> . </li></ul><br>  The idea was to track exactly those spaces that are added to move the cursor to the desired position, but this would significantly complicate the decision without bringing any special benefit, so we will simply remove all spaces at the end of lines (strictly speaking, following the non-blank character to the end of the line) .  As for the moment of removal of such whales, then, for simplicity, we restrict ourselves to the events of <a href="https://habr.com/ru/post/265531/">turning off the mode</a> and <a href="http://www.gnu.org/savannah-checkouts/gnu/emacs/manual/html_node/elisp/Saving-Buffers.html">saving the buffer</a> . <br><br>  So, let's start creating the minor mode which will be called, say, wpers (hereinafter referred to simply <i>mode</i> ).  You can get the full package with brief installation instructions from <a href="https://github.com/wardopdem/wpers">GitHub</a> .  Here I will comment on all the code in detail. <br><br>  Conceptually, all we need is to intercept the <a href="http://www.gnu.org/software/emacs/manual/html_node/emacs/Commands.html">commands</a> next-line, previous-line, right-char and move-end-of-line.  The first three just have to add spaces, if necessary, the last one will automatically remove the "extra" spaces at the end of the line.  Interception is carried out using standard <a href="http://www.gnu.org/savannah-checkouts/gnu/emacs/manual/html_node/elisp/Remapping-Commands.html">remap</a> means within the framework of a <a href="http://www.gnu.org/savannah-checkouts/gnu/emacs/manual/html_node/elisp/Keymaps.html">key-map</a> local for the <i>mode</i> . <br><br>  If possible, we can take all that is possible from the code into constants: <br><pre><code class="lisp hljs"><span class="hljs-comment"><span class="hljs-comment">;;  ()     (defconst wpers-overloaded-funs [next-line previous-line right-char move-end-of-line] "Functions overloaded by the mode") ;;     ("")  ;;       ("") (defconst wpers-fun-prefix "wpers-" "Prefix for new functions") ;;   -   ""    "" (defconst wpers-funs-alist (mapcar '(lambda (x) (cons x (intern (concat wpers-fun-prefix (symbol-name x))))) wpers-overloaded-funs) "alist (old . new) functions") ;; Key-map  -       (wpers-overloaded-funs) (defconst wpers-mode-map (reduce '(lambda (sx) (define-key s (vector 'remap (car x)) (cdr x)) s) wpers-funs-alist :initial-value (make-sparse-keymap)) "Mode map for `wpers'") ;;   -   - ()    (defconst wreps-hooks-alist '((pre-command-hook . wpers--pre-command-hook) (auto-save-hook . wpers-kill-final-spaces) (before-save-hook . wpers-kill-final-spaces)) "alist (hook-var . hook-function)")</span></span></code> </pre> <br><br>  Next, we define the <i>mode</i> itself: <a name="dismode"></a><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">define-minor-mode</span></span> wpers-mode <span class="hljs-string"><span class="hljs-string">"Toggle persistent cursor mode."</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:init-value</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:lighter</span></span> <span class="hljs-string"><span class="hljs-string">" wpers"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:group</span></span> 'wpers <span class="hljs-symbol"><span class="hljs-symbol">:keymap</span></span> wpers-mode-map (<span class="hljs-name"><span class="hljs-name">if</span></span> wpers-mode (<span class="hljs-name"><span class="hljs-name">progn</span></span> (<span class="hljs-name"><span class="hljs-name">message</span></span> <span class="hljs-string"><span class="hljs-string">"Wpers enabled"</span></span>) (<span class="hljs-name"><span class="hljs-name">mapc</span></span> '(lambda (x) (add-hook (car x) (cdr x) <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-literal"><span class="hljs-literal">t</span></span>)) wreps-hooks-alist)) <span class="hljs-comment"><span class="hljs-comment">;     (progn (message "Wpers disabled") (wpers-kill-final-spaces) (mapc '(lambda (x) (remove-hook (car x) (cdr x) t)) wreps-hooks-alist)))) ;    </span></span></code> </pre><br><br>  Now the simple "kitchen" of the functional <i>mode</i> : <br><pre> <code class="lisp hljs"><span class="hljs-comment"><span class="hljs-comment">;;    (form)        () (defmacro wpers-save-vpos (form) "Eval form with saving current cursor's position in the line (column)" (let ((old-col (make-symbol "old-col"))) `(let ((,old-col (current-column)) last-col) ,form (move-to-column ,old-col t)))) ;;;   /      (defun wpers-next-line () "Same as `new-line' but adds the spaces if it's needed for saving cursor's position in the line (column)" (interactive) (wpers-save-vpos (next-line))) (defun wpers-previous-line () "Same as `previous-line' but adds the spaces if it's needed for saving cursor's position in the line (column)" (interactive) (wpers-save-vpos (previous-line))) ;;   , " "   (defun wpers-right-char () "Same as `right-char' but adds the spaces if cursor at end of line (column)" (interactive) (let ((ca (char-after))) (if (or (null ca) (eq ca 10)) (insert 32) (right-char)))) ;;          (defun wpers-move-end-of-line () "Function `move-end-of-line' is called and then removes all trailing spaces" (interactive) (move-end-of-line nil) (while (eq (char-before) 32) (delete-char -1))) ;;        (defun wpers-kill-final-spaces () "Deleting all trailing spaces for all lines in the buffer" (save-excursion (goto-char (point-min)) (while (search-forward-regexp " +$" nil t) (replace-match "")))) ;;    (    )   read-only, visual-line    . (defun wpers--pre-command-hook () "Disabling functionality when buffer is read only, visual-line-mode is non-nil or marking is active" (if (or buffer-read-only this-command-keys-shift-translated mark-active visual-line-mode) (let ((fn-pair (rassoc this-command wpers-funs-alist))) (when fn-pair (setq this-command (car fn-pair))))))</span></span></code> </pre><br><br><h2>  Conclusion </h2><br>  This solution is certainly not ideal and has a number of limitations.  For example, the <i>mode</i> for obvious reasons does not work for read-only buffers.  Unnecessary spaces might have been better removed ‚Äúby hot pursuit‚Äù, say in <a href="http://www.gnu.org/savannah-checkouts/gnu/emacs/manual/html_node/elisp/Command-Overview.html">post-command-hook</a> .  Perhaps at leisure I will deal with these and other problems, but at the moment I‚Äôm quite happy ... maybe not "like an elephant", but definitely like an old lisper and novice emacser;) <br><br><h2>  Materials on the topic </h2><br><ul><li>  <a href="http://www.gnu.org/software/emacs/manual/">GNU Emacs Manuals Online</a> </li><li>  <a href="http://ergoemacs.org/emacs/emacs.html">Site of the Chinese comrade Xah Lee</a> </li></ul><br><br>  <b>UPD:</b> <a href="http://habrahabr.ru/post/266073/">read in the sequel</a> how to do the same without extra spaces using <a href="http://www.gnu.org/savannah-checkouts/gnu/emacs/manual/html_node/elisp/Overlays.html">overlays</a> . </div><p>Source: <a href="https://habr.com/ru/post/265531/">https://habr.com/ru/post/265531/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../265519/index.html">Armory - plugin for IntelliJ IDEA</a></li>
<li><a href="../265523/index.html">Industrial video surveillance: we remove technological data from cameras and predict emergency situations</a></li>
<li><a href="../265525/index.html">Resource Binding in Microsoft DirectX 12</a></li>
<li><a href="../265527/index.html">Single-threaded Android WebView</a></li>
<li><a href="../265529/index.html">Basic principles of virtualization on the fingers</a></li>
<li><a href="../265533/index.html">Dell ASM vs. Cisco UCS: How We Tested Infrastructure Automation</a></li>
<li><a href="../265537/index.html">OTRS 4.0.10. We put on Ubuntu + AD + Kerberos + SSO (Part Two)</a></li>
<li><a href="../265541/index.html">OTRS 4.0.10. We put on Ubuntu + AD + Kerberos + SSO (Part Three)</a></li>
<li><a href="../265543/index.html">Free mono-vendor seminar: ‚ÄúKerio Connect is the solution for safe and comfortable work with e-mail‚Äù</a></li>
<li><a href="../265545/index.html">Atmospheric scattering in the video The Blacksmith</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>