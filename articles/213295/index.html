<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Custom events in action</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this post I will tell you how I use jQuery custom events (custom events) in my work. 

 Imitation of events 
 A simple task is given, the implement...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Custom events in action</h1><div class="post__text post__text-html js-mediator-article">  In this post I will tell you how I use jQuery custom events (custom events) in my work. <br><br><h4>  Imitation of events </h4><br>  A simple task is given, the implementation of which is observed by all habrovans: when the user has scrolled down enough, the ‚ÄúBest for 24 hours‚Äù box-block is animated, and hidden when the user scrolls up the page.  This task is solved by hanging the event handler on the scroll and resize events of the window (window), which is occupied by two things: it calculates whether or not the insert box should be displayed / hidden and, depending on the result, makes animation of the display or hide it. <br><br>  If this task faced us, how would we proceed to its implementation?  Well, for example, wrote such a piece of code: <br><a name="habracut"></a><br><pre><code class="javascript hljs">$(<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>).on(<span class="hljs-string"><span class="hljs-string">'scroll resize'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   , ,   / //    ( ) });</span></span></code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Immediately, I <code>.delegate()</code> note that since version 1.7, the time of <code>.bind()</code> , <code>.delegate()</code> , <code>.live()</code> over: from now on we use the universal method for connecting event handlers <code>.on()</code> (except for the cases when we need to use a single "eavesdropping " <code>.one()</code> , as well as catch dom-ready with <code>$(function(){ })</code> ). <br><br>  In the example above, we catch window scrolling and resizing events using an anonymous function as a handler. <br><br>  Do not forget anything?  Probably not.  We are checking.  When a window scrolling event occurs, the body of the handler function is processed: take the dimensions of the visible rectangle, count the coordinates and move the div-ku to them.  Stand still.  And if the user does not ‚Äútwist‚Äù anything, we will not position our element at the very beginning of work?  Well yes.  It seems, still forgotten.  Well, we will write this: <br><br><pre> <code class="javascript hljs">$(<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>).on(<span class="hljs-string"><span class="hljs-string">'scroll resize'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">// get new coordinates // animate repositioning }); // get new coordinates // animate repositioning</span></span></code> </pre><br><br>  Trouble: it turned out the code "with a smell."  Keep calm and get rid of copy-paste: <br><pre> <code class="javascript hljs">$(<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>).on(<span class="hljs-string"><span class="hljs-string">'scroll resize'</span></span>, repositionAnchor); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">repositionAnchor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">// get new coordinates // animate repositioning } repositionAnchor();</span></span></code> </pre><br><br>  I do not know about you, but I <i>like</i> it even less. <br><br>  Someone will say: "Go back to the original example and tie up even for the event 'load'."  No question, tie up.  But what if, for some reason, this code is executed <i>after the</i> passage of the load event? <br><br>  The solution is on the surface.  Thanks to jQuery, we can independently imitate the passage of events that we expect using the <code>.trigger()</code> method.  Our initial example becomes: <br><br><pre> <code class="javascript hljs">$(<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>).on(<span class="hljs-string"><span class="hljs-string">'load scroll resize'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">// get new coordinates // animate repositioning }).trigger('scroll');</span></span></code> </pre><br><br>  Attached to the load, scroll and resize, and without waiting for any to happen, we imitate the onset of one of them.  Profit.  Both the declaration, and initialization. <br><br><h4>  Custom events </h4><br>  Well, what if the document itself is shortened or somehow changed the shape due to the drawing of new data received asynchronously?  Need to display the block will appear in us, but the 'scroll' event will not happen?  Then ... when it becomes necessary, we ‚Äúcall‚Äù <code>$(window).trigger('scroll')</code> - it's much easier. <br><br>  Easier then - yes, but the fact that ‚Äúscroll‚Äù means ‚Äúscrolling‚Äù, and not ‚Äúchanging the internals of the document‚Äù, is it nothing?  Personally to me - <i>what</i> .  Oh, the <code>window</code> object would have a <code>'change'</code> or <code>'redraw'</code> event, say.  Then it would be possible to hang on him, and later - ‚Äúshoot‚Äù them when the time comes. <br><br>  What if I tell you that nothing prevents us from doing this?  What does it matter if the object has such an event or not?  That's it: <br><br><pre> <code class="javascript hljs">$(<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>).on(<span class="hljs-string"><span class="hljs-string">'load scroll resize redraw'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">// get new coordinates // animate repositioning }).trigger('scroll'); // some time later, just when we need it: $(window).trigger('redraw'); // &lt;&lt; custom event</span></span></code> </pre><br><br>  There is no standard event called <code>redraw</code> .  We ourselves have come up with it now.  Therefore, it is called "user". <br><br>  In jQuery, we can ‚Äúhang‚Äù on listening to such an event on all elements except text nodes and nodes with comments. <br><br>  So, look, it turns out that we are not limited to a rigid list of user interaction events with the DOM: we can invent our own names for events, ‚Äúshoot‚Äù them, and, of course, hang their handlers.  This freedom of action allows us to rise to a higher level in the definition of application blocks (modules) and ensure their interaction on the principles of loose coupling. <br><br>  Of course, we already knew about this from the <a href="http://api.jquery.com/on/">jQuery API</a> documentation itself: an event can have any name or <i>type</i> , for example, <code>'onDataAvailable'</code> , <code>'elvisHasLeftTheBuilding'</code> and <code>'the_answer_to_life_the_universe_and_everything_is_ready'</code> .  Many knew this, but I am sure that not everyone used it. <br><br>  Two words about event namespaces.  Everything that goes in the name of the event through a dot is the so-called namespace of this event ( <code>'onDataAvailable.widgetOne'</code> - ‚ÄúwidgetOne‚Äù is the namespace for this event).  There may be several of them ( <code>'onDataAvailable.widgetOne.dataEvents'</code> - two namespaces are involved here: widgetOne and dataEvents).  This is a convenient way to group events.  But namespaces deserve a separate article, so there is not a word about them anymore.  One conclusion from the above: we avoid the names of events with dots. <br><br><h4>  What to cling to? </h4><br>  We have just learned anew that we can ‚Äúshoot‚Äù and ‚Äúlisten‚Äù to events with absolutely any names.  However, another question comes to the fore.  If to listen for a click ( <code>'click'</code> ), we hang on a DOM element <code>..</code> (or on one of his parents, who will receive the desired event when it ascends), then what should we hang on when we want to listen to the onset of a <i>user</i> event?  For example, the <code>'onDataAvailable'</code> events, which should occur, in our opinion, when the data important for the application was loaded and processed? <br><br>  I first answered this question for myself: <br><br><pre> <code class="javascript hljs">$(<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>).on(<span class="hljs-string"><span class="hljs-string">'onDataAvailable'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  });</span></span></code> </pre><br><br>  But immediately abandoned this working version.  It seemed to me wrong to use the most important object of the client environment as a gateway for ‚Äúwalking‚Äù user events.  One of the reasons: is it not enough, because of the lack of it, or how, one of the events will acquire the name of known events ( <code>'load'</code> , <code>'resize'</code> , etc.), and <i>not those</i> ‚Äúlisteners‚Äù will work. <br><br>  Then I created, without binding to the document, an empty element ( <code>var eventNode = $('')</code> ) and connected listeners to it - <code>eventNode.on('customEvent', function(){ /*...*/ })</code> or ‚Äú fired an event from it: <code>eventNode.trigger('customEvent')</code> . <br><br>  But I still thought it was wrong that we can create custom events, but send or listen to them from non-DOM elements - no.  And now, after re-reading the documentation and digging into the jQuery source, I came to the conclusion that the eventNode from our example may well be a simple object ( <code>{}</code> ) wrapped in <code>$()</code> , like this: <code>var eventNode = $({})</code> .  Such an object not only has <code>.on()</code> , <code>.trigger()</code> , <code>.one()</code> methods in its prototype, but also really works with them. <br><br>  Here, simply what happened: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> events = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> eventNode = $({}); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">on</span></span>: on, <span class="hljs-attr"><span class="hljs-attr">trigger</span></span>: trigger }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ eventNode.on.apply(eventNode, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">trigger</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ eventNode.trigger.apply(eventNode, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); } })(); <span class="hljs-comment"><span class="hljs-comment">// events.on('customEvent', function() {}); // events.trigger('customEvent');</span></span></code> </pre><br><br><h4>  What to say? </h4><br>  I am going to eliminate the omission present in all the above examples.  Our events do not transmit any data. <br><br>  This omission is eliminated easily: the second parameter to the <code>.trigger()</code> method, immediately after the name of the event, we can pass our own data, which the handler will receive the second parameter (the first, as you know, the object of the event itself).  I don't even have to rewrite a recent example: <br><br><pre> <code class="javascript hljs">events.on(<span class="hljs-string"><span class="hljs-string">'onDataAvailable'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">evt, data</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> items = data.items, page = data.page, total = data.total; <span class="hljs-comment"><span class="hljs-comment">// render items based on data }); events.trigger('onDataAvailable', { items: [ /*... */ ], page: 3, total: 10 });</span></span></code> </pre><br><br>  On this I interrupt.  In the second part, I will talk about the attempt at typing events, filtering based on expected data patterns, and also about resolving the problem of ringing calls. <br><br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/213295/">https://habr.com/ru/post/213295/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../213281/index.html">PRFLR, or how your code works in production</a></li>
<li><a href="../213283/index.html">Mark read: Twitter, VK, LiveJournal, Facebook ...</a></li>
<li><a href="../213287/index.html">Total Commander 8.50 Final</a></li>
<li><a href="../213291/index.html">Generate and scan QR / BAR codes</a></li>
<li><a href="../213293/index.html">ADCSpb # 11. Meeting iOS developers in St. Petersburg</a></li>
<li><a href="../213297/index.html">Kegbot: Beer Bottling System for Arduino and Android</a></li>
<li><a href="../213299/index.html">Promotional website for a mobile application. Part 2</a></li>
<li><a href="../213301/index.html">Cross-platform server with non-blocking sockets. Part 4</a></li>
<li><a href="../213303/index.html">State expenditures: public expenditure monitoring, API and competition for developers</a></li>
<li><a href="../213305/index.html">Samsung Galaxy Win Duos: what is a middle class smartphone from a market leader?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>