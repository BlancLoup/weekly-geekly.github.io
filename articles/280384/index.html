<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Million files and one laptop</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Consider the example of an online store, using a laptop to analyze a million files. 



 If there is a sufficiently modern computer, it is possible to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Million files and one laptop</h1><div class="post__text post__text-html js-mediator-article">  Consider the example of an online store, using a laptop to analyze a million files. <br><br><img src="https://habrastorage.org/files/26d/18b/294/26d18b294c4a489db6ac7ec4beea8d48.png"><br><br>  If there is a sufficiently modern computer, it is possible to process data of ‚Äúmedium size‚Äù using reasonable utilization of the <a href="http://www.gnu.org/software/parallel/">GNU Parallel</a> utility and stream processing. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><h4>  Step 1: Concatenating (cat * &gt;&gt; out.txt?!) </h4><br>  The utility of the <i>cat</i> utility in Unix systems is known to most of those who have ever opened a Terminal.  Simply select all or some of the files in the folder and merge them together into one large file.  But that's what comes out, as soon as there are many files: <br><br><pre><code class="html hljs xml">$ cat * &gt;&gt; out.txt -bash: /bin/cat: Argument list too long</code> </pre> <br><br>  The number of files exceeds the allowed and the computer can not always keep track of them.  Many Unix tools only take about 10,000 arguments;  using an asterisk in the <i>cat command</i> extends control and passes 1,234,567 arguments to the utility.  As a result, an error message appears. <br><br>  You can do the following: <br><br><pre> <code class="html hljs xml">for f in *; do cat "$f" &gt;&gt; ../transactions_cat/transactions.csv; done</code> </pre><br><br>  And after about 10.093 seconds, the compound file is formed. <br><br><h4>  Step 2: GNU Parallel &amp; Concatenation </h4><br>  But you can improve the process with GNU Parallel: <br><br><pre> <code class="html hljs xml">ls | parallel -m -j $f "cat {} &gt;&gt; ../transactions_cat/transactions.csv"</code> </pre><br><br>  The <i>$ f</i> argument in the code comes to the fore, so you can choose the level of <i>parallelism</i> ;  but at the same time the linear scale will not be uniform (as in the figure below - <a href="https://gist.github.com/randyzwitch/ee0f738b5895e059fa2a">graph code</a> ): <br><br><img src="https://habrastorage.org/files/042/fab/7c4/042fab7c4ca34defb0ab61ed25fc31dd.png"><br><br><h4>  Step 3: Data&gt; RAM </h4><br>  After a million files are converted to one file, another problem arises.  The data volume of 19.93 GB does not fit in the RAM (this is a 2014 MBP laptop, 16 GB RAM).  Thus, for analysis, you need either a more powerful machine, or processing through streaming.  Or you can use <i>chunked</i> ( <a href="https://ru.wikipedia.org/wiki/Chunked_transfer_encoding">Chunked transfer encoding</a> ). <br><br>  But continuing to talk about the use of GNU Parallel, you should answer a number of questions relating to operational data (for example, an online store): <br><br>  How many unique products have been sold? <br>  How many deals were made per day? <br>  How many products were sold in the store in a month? <br><br><h5>  Unique products </h5><br><br><pre> <code class="css hljs"># <span class="hljs-selector-tag"><span class="hljs-selector-tag">Serial</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">method</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">ie</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">no</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">parallelism</span></span>) # <span class="hljs-selector-tag"><span class="hljs-selector-tag">This</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">is</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">simple</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">implementation</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">of</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">map</span></span> &amp; <span class="hljs-selector-tag"><span class="hljs-selector-tag">reduce</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">tr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">statements</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">represent</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">one</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">map</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">sort</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-u</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">statements</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">one</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">reducer</span></span> # <span class="hljs-selector-tag"><span class="hljs-selector-tag">cut</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-d</span></span> ' ' <span class="hljs-selector-tag"><span class="hljs-selector-tag">-f</span></span> 5<span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">transactions</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.csv</span></span> | \ <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Using</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cut</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">take</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">everything</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">from</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">the</span></span> 5<span class="hljs-selector-tag"><span class="hljs-selector-tag">th</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">column</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">and</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">over</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">from</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">the</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">transactions</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.csv</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">file</span></span> # <span class="hljs-selector-tag"><span class="hljs-selector-tag">tr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-d</span></span> \" | \ <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Using</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">tr</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">trim</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">off</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">double-quotes</span></span>. <span class="hljs-selector-tag"><span class="hljs-selector-tag">This</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">leaves</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">us</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">with</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">comma-delimited</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">string</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">of</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">products</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">representing</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">transaction</span></span> # <span class="hljs-selector-tag"><span class="hljs-selector-tag">sort</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-u</span></span> | \ <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Using</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">sort</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">put</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">similar</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">items</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">together</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">but</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">only</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">output</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">the</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">unique</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">values</span></span> # <span class="hljs-selector-tag"><span class="hljs-selector-tag">wc</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-l</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Count</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">number</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">of</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">unique</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">lines</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">which</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">after</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">de-duping</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">represents</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">number</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">of</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">unique</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">products</span></span> $ <span class="hljs-selector-tag"><span class="hljs-selector-tag">time</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cut</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-d</span></span> ' ' <span class="hljs-selector-tag"><span class="hljs-selector-tag">-f</span></span> 5<span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">transactions</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.csv</span></span> | <span class="hljs-selector-tag"><span class="hljs-selector-tag">tr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-d</span></span> \" | <span class="hljs-selector-tag"><span class="hljs-selector-tag">tr</span></span> ',' '\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span>' | <span class="hljs-selector-tag"><span class="hljs-selector-tag">sort</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-u</span></span> | <span class="hljs-selector-tag"><span class="hljs-selector-tag">wc</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-l</span></span> 331 <span class="hljs-selector-tag"><span class="hljs-selector-tag">real</span></span> 292<span class="hljs-selector-tag"><span class="hljs-selector-tag">m7</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.116s</span></span> # <span class="hljs-selector-tag"><span class="hljs-selector-tag">Parallelized</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">version</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">default</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">chunk</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">size</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">of</span></span> 1<span class="hljs-selector-tag"><span class="hljs-selector-tag">MB</span></span>. <span class="hljs-selector-tag"><span class="hljs-selector-tag">This</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">will</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">use</span></span> 100% <span class="hljs-selector-tag"><span class="hljs-selector-tag">of</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">all</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">CPUs</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">real</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">and</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">virtual</span></span>) # <span class="hljs-selector-tag"><span class="hljs-selector-tag">Also</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">map</span></span> &amp; <span class="hljs-selector-tag"><span class="hljs-selector-tag">reduce</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">tr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">statements</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">single</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">map</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">sort</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-u</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">statements</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">multiple</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">reducers</span></span> (8 <span class="hljs-selector-tag"><span class="hljs-selector-tag">by</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">default</span></span>) $ <span class="hljs-selector-tag"><span class="hljs-selector-tag">time</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cut</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-d</span></span> ' ' <span class="hljs-selector-tag"><span class="hljs-selector-tag">-f</span></span> 5<span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">transactions</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.csv</span></span> | <span class="hljs-selector-tag"><span class="hljs-selector-tag">tr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-d</span></span> \" | <span class="hljs-selector-tag"><span class="hljs-selector-tag">tr</span></span> ',' '\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span>' | <span class="hljs-selector-tag"><span class="hljs-selector-tag">parallel</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">--pipe</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">--block</span></span> 1<span class="hljs-selector-tag"><span class="hljs-selector-tag">M</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">sort</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-u</span></span> | <span class="hljs-selector-tag"><span class="hljs-selector-tag">sort</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-u</span></span> | <span class="hljs-selector-tag"><span class="hljs-selector-tag">wc</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-l</span></span> 331 # <span class="hljs-selector-tag"><span class="hljs-selector-tag">block</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">size</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">performance</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Making</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">block</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">size</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">smaller</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">might</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">improve</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">performance</span></span> # <span class="hljs-selector-tag"><span class="hljs-selector-tag">Number</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">of</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">jobs</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">can</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">also</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">be</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">manipulated</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">not</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">evaluated</span></span>) # <span class="hljs-selector-tag"><span class="hljs-selector-tag">--500K</span></span>: 73<span class="hljs-selector-tag"><span class="hljs-selector-tag">m57</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.232s</span></span> # <span class="hljs-selector-tag"><span class="hljs-selector-tag">--Default</span></span> 1<span class="hljs-selector-tag"><span class="hljs-selector-tag">M</span></span>: 75<span class="hljs-selector-tag"><span class="hljs-selector-tag">m55</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.268s</span></span> (3<span class="hljs-selector-class"><span class="hljs-selector-class">.84x</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">faster</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">than</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">serial</span></span>) # <span class="hljs-selector-tag"><span class="hljs-selector-tag">--2M</span></span>: 79<span class="hljs-selector-tag"><span class="hljs-selector-tag">m30</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.950s</span></span> # <span class="hljs-selector-tag"><span class="hljs-selector-tag">--3M</span></span>: 80<span class="hljs-selector-tag"><span class="hljs-selector-tag">m43</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.311s</span></span></code> </pre><br><br><h5>  Deals for the day </h5><br>  If the file format is undesirable in order to be considered the first question, then for the second one it will be perfect.  Since each line represents an operation, all we have to do is execute the SQL equivalent of ‚ÄúGroup By‚Äù per day and summarize the lines: <br><br><pre> <code class="css hljs"># <span class="hljs-selector-tag"><span class="hljs-selector-tag">Data</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">is</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">transaction</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">level</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">so</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">just</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">need</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">do</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">equivalent</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">of</span></span> '<span class="hljs-selector-tag"><span class="hljs-selector-tag">group</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">by</span></span>' <span class="hljs-selector-tag"><span class="hljs-selector-tag">operation</span></span> # <span class="hljs-selector-tag"><span class="hljs-selector-tag">Using</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cut</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">again</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">we</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">choose</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">field</span></span> 3, <span class="hljs-selector-tag"><span class="hljs-selector-tag">which</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">is</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">the</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">date</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">part</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">of</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">the</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">timestamp</span></span> # <span class="hljs-selector-tag"><span class="hljs-selector-tag">sort</span></span> | <span class="hljs-selector-tag"><span class="hljs-selector-tag">uniq</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-c</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">is</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">common</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">pattern</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">for</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">doing</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span> '<span class="hljs-selector-tag"><span class="hljs-selector-tag">group</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">by</span></span>' <span class="hljs-selector-tag"><span class="hljs-selector-tag">count</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">operation</span></span> # <span class="hljs-selector-tag"><span class="hljs-selector-tag">Final</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">tr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">step</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">is</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">trim</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">the</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">leading</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">quotation</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mark</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">from</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">date</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">string</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">time</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cut</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-d</span></span> ' ' <span class="hljs-selector-tag"><span class="hljs-selector-tag">-f</span></span> 3 <span class="hljs-selector-tag"><span class="hljs-selector-tag">transactions</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.csv</span></span> | <span class="hljs-selector-tag"><span class="hljs-selector-tag">sort</span></span> | <span class="hljs-selector-tag"><span class="hljs-selector-tag">uniq</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-c</span></span> | <span class="hljs-selector-tag"><span class="hljs-selector-tag">tr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-d</span></span> \" <span class="hljs-selector-tag"><span class="hljs-selector-tag">real</span></span> 76<span class="hljs-selector-tag"><span class="hljs-selector-tag">m51</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.223s</span></span> # <span class="hljs-selector-tag"><span class="hljs-selector-tag">Parallelized</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">version</span></span> # <span class="hljs-selector-tag"><span class="hljs-selector-tag">Quoting</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">can</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">be</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">annoying</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">when</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">using</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">parallel</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">so</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">writing</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bash</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">function</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">is</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">often</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">much</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">easier</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">than</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dealing</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">with</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">escaping</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">quotes</span></span> # <span class="hljs-selector-tag"><span class="hljs-selector-tag">To</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">do</span></span> '<span class="hljs-selector-tag"><span class="hljs-selector-tag">group</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">by</span></span>' <span class="hljs-selector-tag"><span class="hljs-selector-tag">operation</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">using</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">awk</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">need</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">use</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">an</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">associative</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">array</span></span> # <span class="hljs-selector-tag"><span class="hljs-selector-tag">Because</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">we</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">are</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">doing</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">parallel</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">operations</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">need</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">pass</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">awk</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">output</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">awk</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">again</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">return</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">final</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">counts</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">awksub</span></span> () { awk '{a[$3]+=1;}<span class="hljs-selector-tag"><span class="hljs-selector-tag">END</span></span>{for(i in a)print i" "a[i];}';} <span class="hljs-selector-tag"><span class="hljs-selector-tag">export</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-f</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">awksub</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">time</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">parallel</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">--pipe</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">awksub</span></span> &lt; <span class="hljs-selector-tag"><span class="hljs-selector-tag">transactions</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.csv</span></span> | <span class="hljs-selector-tag"><span class="hljs-selector-tag">awk</span></span> '{a[$1]+=$2;}<span class="hljs-selector-tag"><span class="hljs-selector-tag">END</span></span>{for(i in a)print i" "a[i];}' | <span class="hljs-selector-tag"><span class="hljs-selector-tag">tr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-d</span></span> \" | <span class="hljs-selector-tag"><span class="hljs-selector-tag">sort</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">real</span></span> 8<span class="hljs-selector-tag"><span class="hljs-selector-tag">m22</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.674s</span></span> (9<span class="hljs-selector-class"><span class="hljs-selector-class">.05x</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">faster</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">than</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">serial</span></span>)</code> </pre><br><br><h5>  Total sales per day and per month </h5><br>  For this example, it could happen that the <i>fu</i> command line is rather weak, but the sequential method is one of the fastest.  Of course, in the 14-minute runtime, the real-time advantages for ‚Äúparallelization‚Äù are not so big. <br><br><pre> <code class="css hljs"># <span class="hljs-selector-tag"><span class="hljs-selector-tag">Serial</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">method</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">uses</span></span> 40<span class="hljs-selector-tag"><span class="hljs-selector-tag">-50</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">all</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">available</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">CPU</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">prior</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> `<span class="hljs-selector-tag"><span class="hljs-selector-tag">sort</span></span>` <span class="hljs-selector-tag"><span class="hljs-selector-tag">step</span></span>. <span class="hljs-selector-tag"><span class="hljs-selector-tag">Assuming</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">linear</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">scaling</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">best</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">we</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">could</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">achieve</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">is</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">halving</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">the</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">time</span></span>. # <span class="hljs-selector-tag"><span class="hljs-selector-tag">Grand</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Assertion</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">this</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">pipeline</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">actually</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">gives</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">correct</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">answer</span></span>! <span class="hljs-selector-tag"><span class="hljs-selector-tag">This</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">is</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">very</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">complex</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">way</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">calculate</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">this</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">SQL</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">would</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">be</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">so</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">much</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">easier</span></span>... # <span class="hljs-selector-tag"><span class="hljs-selector-tag">cut</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-d</span></span> ' ' <span class="hljs-selector-tag"><span class="hljs-selector-tag">-f</span></span> 2,3,5 <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Take</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">fields</span></span> 2, 3, <span class="hljs-selector-tag"><span class="hljs-selector-tag">and</span></span> 5 (<span class="hljs-selector-tag"><span class="hljs-selector-tag">store</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">timestamp</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">transaction</span></span>) # <span class="hljs-selector-tag"><span class="hljs-selector-tag">tr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-d</span></span> '<span class="hljs-selector-attr"><span class="hljs-selector-attr">[A-Za-z\"/\- ]</span></span>' <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Strip</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">out</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">all</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">the</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">characters</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">and</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">spaces</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">just</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">leave</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">the</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">store</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">number</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">timestamp</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">and</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">commas</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">represent</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">the</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">number</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">of</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">items</span></span> # <span class="hljs-selector-tag"><span class="hljs-selector-tag">awk</span></span> '{print (substr($1,1,5)"-"substr($1,6,6)), length(substr($1,14))+1}' <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Split</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">the</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">string</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">the</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">store</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">yearmo</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">boundary</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">then</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">count</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">number</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">of</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">commas</span></span> + 1 (<span class="hljs-selector-tag"><span class="hljs-selector-tag">since</span></span> 3 <span class="hljs-selector-tag"><span class="hljs-selector-tag">commas</span></span> = 4 <span class="hljs-selector-tag"><span class="hljs-selector-tag">items</span></span>) # <span class="hljs-selector-tag"><span class="hljs-selector-tag">awk</span></span> '{a[$1]+=$2;}<span class="hljs-selector-tag"><span class="hljs-selector-tag">END</span></span>{for(i in a)print i" "a[i];}' <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Sum</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">by</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">store-yearmo</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">combo</span></span> # <span class="hljs-selector-tag"><span class="hljs-selector-tag">sort</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Sort</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">such</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">that</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">the</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">store</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">number</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">is</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">together</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">then</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">the</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">month</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">time</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cut</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-d</span></span> ' ' <span class="hljs-selector-tag"><span class="hljs-selector-tag">-f</span></span> 2,3,5 <span class="hljs-selector-tag"><span class="hljs-selector-tag">transactions</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.csv</span></span> | <span class="hljs-selector-tag"><span class="hljs-selector-tag">tr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-d</span></span> '<span class="hljs-selector-attr"><span class="hljs-selector-attr">[A-Za-z\"/\- ]</span></span>' | <span class="hljs-selector-tag"><span class="hljs-selector-tag">awk</span></span> '{print (substr($1,1,5)"-"substr($1,6,6)), length(substr($1,14))+1}' | <span class="hljs-selector-tag"><span class="hljs-selector-tag">awk</span></span> '{a[$1]+=$2;}<span class="hljs-selector-tag"><span class="hljs-selector-tag">END</span></span>{for(i in a)print i" "a[i];}' | <span class="hljs-selector-tag"><span class="hljs-selector-tag">sort</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">real</span></span> 14<span class="hljs-selector-tag"><span class="hljs-selector-tag">m5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.657s</span></span> # <span class="hljs-selector-tag"><span class="hljs-selector-tag">Parallelize</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">the</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">substring</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">awk</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">step</span></span> # <span class="hljs-selector-tag"><span class="hljs-selector-tag">Actually</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">lowers</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">processor</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">utilization</span></span>! <span class="hljs-selector-tag"><span class="hljs-selector-tag">awksub2</span></span> () { awk '{print (substr($1,1,5)"-"substr($1,6,6)), length(substr($1,14))+1}';} <span class="hljs-selector-tag"><span class="hljs-selector-tag">export</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-f</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">awksub2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">time</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cut</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-d</span></span> ' ' <span class="hljs-selector-tag"><span class="hljs-selector-tag">-f</span></span> 2,3,5 <span class="hljs-selector-tag"><span class="hljs-selector-tag">transactions</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.csv</span></span> | <span class="hljs-selector-tag"><span class="hljs-selector-tag">tr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-d</span></span> '<span class="hljs-selector-attr"><span class="hljs-selector-attr">[A-Za-z\"/\- ]</span></span>' | <span class="hljs-selector-tag"><span class="hljs-selector-tag">parallel</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">--pipe</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-m</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">awksub2</span></span> | <span class="hljs-selector-tag"><span class="hljs-selector-tag">awk</span></span> '{a[$1]+=$2;}<span class="hljs-selector-tag"><span class="hljs-selector-tag">END</span></span>{for(i in a)print i" "a[i];}' | <span class="hljs-selector-tag"><span class="hljs-selector-tag">sort</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">real</span></span> 19<span class="hljs-selector-tag"><span class="hljs-selector-tag">m27</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.407s</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">worse</span></span>!) # <span class="hljs-selector-tag"><span class="hljs-selector-tag">Move</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">parallel</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">aggregation</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">step</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">awksub3</span></span> () { awk '{a[$1]+=$2;}<span class="hljs-selector-tag"><span class="hljs-selector-tag">END</span></span>{for(i in a)print i" "a[i];}';} <span class="hljs-selector-tag"><span class="hljs-selector-tag">export</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-f</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">awksub3</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">time</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cut</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-d</span></span> ' ' <span class="hljs-selector-tag"><span class="hljs-selector-tag">-f</span></span> 2,3,5 <span class="hljs-selector-tag"><span class="hljs-selector-tag">transactions</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.csv</span></span> | <span class="hljs-selector-tag"><span class="hljs-selector-tag">tr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-d</span></span> '<span class="hljs-selector-attr"><span class="hljs-selector-attr">[A-Za-z\"/\- ]</span></span>' | <span class="hljs-selector-tag"><span class="hljs-selector-tag">awk</span></span> '{print (substr($1,1,5)"-"substr($1,6,6)), length(substr($1,14))+1}' | <span class="hljs-selector-tag"><span class="hljs-selector-tag">parallel</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">--pipe</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">awksub3</span></span> | <span class="hljs-selector-tag"><span class="hljs-selector-tag">awksub3</span></span> | <span class="hljs-selector-tag"><span class="hljs-selector-tag">sort</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">real</span></span> 19<span class="hljs-selector-tag"><span class="hljs-selector-tag">m24</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.851s</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">Same</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">as</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">other</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">parallel</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">run</span></span>)</code> </pre><br><br>  These three examples showed that using GNU Parallel in a reasonable time it is possible to process data sets that exceed RAM.  However, the examples also showed that working with Unix utilities can be complicated.  The command line script helps the movement outside the ‚Äúone-liner‚Äù syndrome when pipelining becomes so long that every logical trace is lost.  But in the end, problems are easily solved by using other tools. </div><p>Source: <a href="https://habr.com/ru/post/280384/">https://habr.com/ru/post/280384/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../280374/index.html">Measuring code coverage tests on Android using JaCoCo</a></li>
<li><a href="../280376/index.html">In simple words: We deal with "cloud" services.</a></li>
<li><a href="../280378/index.html">man! (Go => D) .concurrency</a></li>
<li><a href="../280380/index.html">We solve the problem of interception and substitution of DNS queries. DNSCrypt in Yandex Browser</a></li>
<li><a href="../280382/index.html">Yii framework code parsing</a></li>
<li><a href="../280386/index.html">Flume - manage data streams. Part 1</a></li>
<li><a href="../280388/index.html">Understanding multithreading in RxJava</a></li>
<li><a href="../280390/index.html">SaaS solutions to protect any device anywhere: why it‚Äôs simpler and cheaper + implementation example</a></li>
<li><a href="../280394/index.html">How to develop 1C: ERP (and not only)</a></li>
<li><a href="../280396/index.html">About type conversion in arithmetic expressions in C ++ and C #</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>