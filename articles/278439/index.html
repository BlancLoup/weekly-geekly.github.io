<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We fix the error of installing updates Windows 7</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Windows 7 is still a popular operating system in a corporate environment, despite the fact that two new versions of the client OS have already been re...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We fix the error of installing updates Windows 7</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/add/1af/8a3/add1af8a38ba4ecc961a370dedcca439.png" align="left">  Windows 7 is still a popular operating system in a corporate environment, despite the fact that two new versions of the client OS have already been released.  Expanded support for the G-7 will end only on January 14, 2020, which means that for the next 4 years, updates will be released for it to fix the detected vulnerabilities. <br><br>  There is a rule - if there are updates, then there are problems with installing them.  Let's look at what the main problems arise when updating Windows 7 through Windows Server Update Services (WSUS) and how to fix them at the lowest cost. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  <b>Error # 1</b> .  Failed to find updates with error code 80244010 </h5><br>  You will almost certainly observe this error on any system that first accessed the WSUS server.  The WindowsUpdate.log will also encounter a warning: <br> <code>WARNING: Exceeded max server round trips <br></code> <br>  The reason for the problem is that the list of updates has become too large, and the client cannot accept it in one go.  Details - <a href="https://blogs.technet.microsoft.com/sus/2008/09/18/wsus-clients-fail-with-warning-syncserverupdatesinternal-failed-0x80244010/">blogs.technet.microsoft.com/sus/2008/09/18/wsus-clients-fail-with-warning-syncserverupdatesinternal-failed-0x80244010</a> <br>  What solution does Microsoft offer?  If, after an error, a repeated search for updates is started, the process of downloading metadata will continue from the moment the error occurred.  Patience gentlemen, patience.  Three, five attempts <code>wuauclt /detectnow</code> - and everything will be <code>wuauclt /detectnow</code> .  Do not forget to wait for the end of the previous search cycle when re-searching, otherwise the magic will not work! <br><br><h5>  <b>Error # 2.</b>  Windows updates are not installed with error 0x80070308 </h5><br>  Occurs sporadically, and in one case out of 100 she has the only and very specific solution - delete the key <br> <code>HKLM\Components\PendingRequired=1 <br></code> <br>  Reboot.  Here it is important not to overdo it, you should not delete any other keys in this section, even if you really do not like them, because after this update they will stop being placed forever. <br><br><h5>  <b>Error # 3.</b>  All other errors </h5><br>  Almost 100% of other errors can be solved by System Update Readiness Tool (SURT) from the article <a href="https://support.microsoft.com/en-us/kb/947821">support.microsoft.com/en-us/kb/947821</a> <br>  Download the package for your system, install, read the <code>%windir%\Logs\CBS\CheckSUR.log</code> log and if it ends like this: <br><blockquote>  Summary: <br>  Seconds executed: 1164 <br>  Found 16 errors <br>  Fixed 4 errors <br></blockquote><br>  then you are our client. <br><br>  The problem is that during the installation of updates in the system may appear broken files.  What is the cause ‚Äî a faulty network, a disk, RAM, Windows Update itself ‚Äî cannot be figured out, and errors will have to be corrected to install future updates. <br><br>  As a rule, * .cat, * .mum, * .manifest files are damaged.  Someone has * .dll damage, but I haven‚Äôt encountered it in practice.  And it seems that the SURT tool should correct errors itself, since inside it there is a huge catalog of reference files.  Only the last time SURT was updated in October 2014, and there have been countless patches to the operating system since then, and there are not enough files in the directory. <br><br><img src="https://habrastorage.org/files/057/d7c/940/057d7c9403eb46099425fedcbead5908.png"><br><br>  Below, I will describe the sequence of actions required to correct the errors of installing updates on Windows 7 x64 using SURT.  For x86 edition, you just need another SURT package from KB947821. <br><br>  The sequence of actions will be as follows. <br><br><h6>  1. Start the first pass of Windows6.1-KB947821-v34-x64.msu </h6><br>  It is not necessary to distract the user from work, we will do everything remotely.  Create the following batch file and run it: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span> machine=BUHWKS02 xcopy Windows6.1-KB947821-v34-x64.msu \\%machine%\admin$\temp psexec -s \\%machine% wusa <span class="hljs-string"><span class="hljs-string">"c:\windows\temp\Windows6.1-KB947821-v34-x64.msu"</span></span> /quiet /norestart pause</code> </pre><br>  where BUHWKS02 is the target machine. <br>  When the script runs and pauses, we check <code>%windir%\Logs\CBS\CheckSUR.log</code> <br>  If no errors were found, it‚Äôs not a broken update. <br>  If it ends <br><blockquote>  Summary: <br>  Seconds executed: 1164 <br>  <b>Found 16 errors</b> <b><br></b>  <b>Fixed 4 errors</b> <br>  CSI Manifest All Zeros Total count: 6 <br>  CSI Catalog Corrupt Total count: 3 <br>  Fixed: CSI Catalog Corrupt.  Total count: 3 <br>  CBS MUM Corrupt Total count: 3 <br>  CBS Catalog Corrupt Total count: 3 <br>  CSI Catalog Thumbprint Invalid Total count: 1 <br>  Fixed: CSI Catalog Thumbprint Invalid.  Total count: 1 <br>  <b>Unavailable repair files:</b> <br>  winsxs \ manifests \ wow64_microsoft-windows-gdi32_31bf3856ad364e35_6.1.7601.19091_none_c19fa2719495aca9.manifest <br>  winsxs \ manifests \ amd64_microsoft-windows-capi2-weakcrypto_31bf3856ad364e35_6.1.7601.23290_none_5e936c9c5ce2e8e6.manifest <br>  winsxs \ manifests \ wow64_microsoft-windows-gdi32_31bf3856ad364e35_6.1.7601.23290_none_c22840d8adb43043.manifest <br>  winsxs \ manifests \ amd64_microsoft-windows-gdi32_31bf3856ad364e35_6.1.7601.19091_none_b74af81f6034eaae.manifest <br>  winsxs \ manifests \ amd64_microsoft-windows-capi2-weakcrypto_31bf3856ad364e35_6.1.7601.19091_none_5e0ace3543c4654c.manifest <br>  winsxs \ manifests \ amd64_microsoft-windows-gdi32_31bf3856ad364e35_6.1.7601.23290_none_b7d3968679536e48.manifest <br>  servicing \ packages \ Package_2_for_KB3123479 ~ 31bf3856ad364e35 ~ amd64 ~~ 6.1.1.0.mum <br>  servicing \ packages \ Package_2_for_KB3123479 ~ 31bf3856ad364e35 ~ amd64 ~~ 6.1.1.0.mum <br>  servicing \ packages \ Package_for_KB3123479_SP1 ~ 31bf3856ad364e35 ~ amd64 ~~ 6.1.1.0.mum </blockquote><br>  then we will fix it. <br><br><h6>  2. Copy the reference files to the target machine </h6><br>  Microsoft offers us a long, confused procedure <a href="https://technet.microsoft.com/en-us/library/ee619779(WS.10).aspx">with extracting good files from updates</a> and placing them in certain directories of the SURT tool.  In this case, the way in the articles wrong.  Somewhere it is recommended to enclose the original msu files. <br><br>  The simplest and correct option is to copy the reference files from the working system: <br><br>  * .mum and * .cat from C: \ Windows \ servicing \ Packages add up to% windir% \ Temp \ CheckSUR \ servicing \ packages <br>  * .manifest from C: \ Windows \ winsxs \ Manifests stack in% windir% \ Temp \ CheckSUR \ winsxs \ manifests \ <br><br>  The problem is that there are usually dozens of broken files, and it is very difficult to select and copy them.  Then the following PowerShell script comes to the rescue (the reference machine is the machine from which you run the script) <br><br><pre> <code class="vbscript hljs">cls $flag = $<span class="hljs-literal"><span class="hljs-literal">false</span></span> $destPC = <span class="hljs-string"><span class="hljs-string">"\\BUHWKS02"</span></span> $<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>-content $($destPC + <span class="hljs-string"><span class="hljs-string">"\admin$\Logs\CBS\CheckSUR.log"</span></span>) $MUMCATSource = <span class="hljs-string"><span class="hljs-string">"C:\Windows\servicing\Packages\"</span></span> $MUMCATDest = $destpc + <span class="hljs-string"><span class="hljs-string">"\admin$\Temp\CheckSUR\servicing\Packages\"</span></span> $MANIFESTSource = <span class="hljs-string"><span class="hljs-string">"C:\Windows\winsxs\Manifests\"</span></span> $MANIFESTDest = $destpc + <span class="hljs-string"><span class="hljs-string">"\admin$\Temp\CheckSUR\winsxs\Manifests\"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> ((Test-Path -Path $MUMCATDest -PathType Container) -eq $<span class="hljs-literal"><span class="hljs-literal">false</span></span>) {<span class="hljs-keyword"><span class="hljs-keyword">New</span></span>-Item -Path $MUMCATDest -ItemType directory } <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> ((Test-Path -Path $MANIFESTDest -PathType Container) -eq $<span class="hljs-literal"><span class="hljs-literal">false</span></span>) {<span class="hljs-keyword"><span class="hljs-keyword">New</span></span>-Item -Path $MANIFESTDest -ItemType directory} foreach ($line <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($flag -eq $<span class="hljs-literal"><span class="hljs-literal">True</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($line.<span class="hljs-built_in"><span class="hljs-built_in">trim</span></span>().Length -ne <span class="hljs-number"><span class="hljs-number">0</span></span>) { $fileArray=$($line.<span class="hljs-built_in"><span class="hljs-built_in">Split</span></span>(<span class="hljs-string"><span class="hljs-string">"\"</span></span>)) $file = $FileArray[$FileArray.Length<span class="hljs-number"><span class="hljs-number">-1</span></span>] $extArray = $file.<span class="hljs-built_in"><span class="hljs-built_in">split</span></span>(<span class="hljs-string"><span class="hljs-string">"."</span></span>) $ext = $extArray[$extArray.length<span class="hljs-number"><span class="hljs-number">-1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($ext -eq <span class="hljs-string"><span class="hljs-string">"manifest"</span></span>) { Write-Warning $(<span class="hljs-string"><span class="hljs-string">"Copying "</span></span> + $($MANIFESTSource+$file)+<span class="hljs-string"><span class="hljs-string">" to "</span></span> + $MANIFESTDest) Copy-Item $($MANIFESTSource+$file) $($MANIFESTDest+$file) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (($ext -eq <span class="hljs-string"><span class="hljs-string">"mum"</span></span>) -<span class="hljs-keyword"><span class="hljs-keyword">or</span></span> ($ext -eq <span class="hljs-string"><span class="hljs-string">"cat"</span></span>) ) { Write-Warning $(<span class="hljs-string"><span class="hljs-string">"Copying "</span></span> + $($MUMCATSource+$file)+<span class="hljs-string"><span class="hljs-string">" to "</span></span> + $MUMCATDest) Copy-Item $($MUMCATSource+$file) $($MUMCATDest+$file) } } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($line -eq <span class="hljs-string"><span class="hljs-string">"Unavailable repair files:"</span></span>) {$flag = $<span class="hljs-literal"><span class="hljs-literal">true</span></span>} }</code> </pre><br>  As you can see, the script is simple and can be easily sharpened by a file for your infrastructure. <br><br><h5>  3. Run the second pass Windows6.1-KB947821-v34-x64.msu </h5><br>  After copying the files, we re-launch the SURT using the batch file from the first step.  When restarting, the tool will be able to pick up the reference files copied by us from% windir% \ Temp \ CheckSUR and replace the damaged ones with them. <br>  If we did everything correctly, the% windir% \ Logs \ CBS \ CheckSUR.log would look like this: <br><blockquote>  ================================= <br>  Checking System Update Readiness. <br>  Binary Version 6.1.7601.22471 <br>  Package Version 26.0 <br>  2016-03-03 09:15 <br>  Checking Windows Servicing Packages <br>  Checking Package Manifests and Catalogs <br>  Checking Package Watchlist <br>  Checking Component Watchlist <br>  Checking packages <br>  Checking Component Store <br>  Summary: <br>  Seconds executed: 1435 <br>  <b>No errors detected</b> </blockquote><br><br>  Now you can continue installing updates on the target machine, for example, with the following batch files: <br> <code>set machine= BUHWKS02 <br> psexec -i -s \\%machine% wuauclt /detectnow <br> pause <br> <br> set machine= BUHWKS02 <br> psexec -i -s \\%machine% wuauclt /updatenow <br> pause <br></code> <br><h5>  <b>Error # 4.</b>  If SURT worked fine, but updates are still not installed </h5><br>  Try to resort to the old method - reset the Windows Update service to its original state.  To do this, delete the% windir% \ SoftwareDistribution directory. <br><br>  Create a file WU-cleanupCMD.cmd: <br> <code>net stop wuauserv <br> rmdir /s /q %windir%\SoftwareDistribution <br> net start wuauserv <br> wuauclt /detectnow <br></code> <br>  Run: <br> <code>set machine= BUHWKS02 <br> psexec -c -s \\%machine% WU-cleanupCMD.cmd <br> pause <br></code> <br>  After this, Error # 1 will occur, but we already know how to deal with it. <br><br><h5>  <b>Error # 5</b> </h5><br><br>  The client disappears from the WSUS console.  A curious error related to improper cloning of machines and duplication (build-up, etc.) of customer identifiers.  It is solved like this: <br><br><pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">net</span></span> stop wuauserv REG DELETE "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate" /v SusClientId /f REG DELETE "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate" /v SusClientIdValidation /f <span class="hljs-built_in"><span class="hljs-built_in">net</span></span> <span class="hljs-built_in"><span class="hljs-built_in">start</span></span> wuauserv wuauclt /resetauthorization /detectnow /reportnow</code> </pre><br><br><h5>  <b>Error # 6</b> </h5><br><blockquote>  GetCookie failure, error = 0x8024400D, soap client error = 7, soap error code = 300, HTTP status code = 200 <br>  SyncUpdates failure, error = 0x80072EE2, soap client error = 5, soap error code = 0, HTTP status code = 200 <br>  Windows Update Client failed to detect with error 0x80072ee2 <br></blockquote><br><br>  The error is due to a lack of resources in the AppPool WSUS.  The solution is to remove the limit on consumed memory.  How to do it - <a href="http-503-errors/">article</a> . <br>  In short: Open IIS, Application Pools, WsusPool, Advanced Settings. <br>  The parameter Private Memory Limit is set to 0. <br><br>  Continuing the WSUS configuration topic is in my next article: <a href="https://habrahabr.ru/post/329440/">https://habrahabr.ru/post/329440/</a> <br><br>  PS: <br>  Many bugs are resolved in the new WSUS client: <br>  1. <a href="https://support.microsoft.com/en-us/kb/3125574">KB3125574</a> <a href="http://catalog.update.microsoft.com/v7/site/Search.aspx%3Fq%3DKB3125574">"Windows 7 post SP1 Convenience Rollup Update"</a> .  Carefully read the Known issues section! <br><br>  You must first install <a href="https://support.microsoft.com/en-us/kb/3020369">KB3020369</a> "April 2015 servicing stack update for Windows 7 and Windows Server 2008 R2". <br><br>  Successful administration! </div><p>Source: <a href="https://habr.com/ru/post/278439/">https://habr.com/ru/post/278439/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../278427/index.html">Connect to the Device Guard Webinar on Windows 10. Start March 3 at 11:00 (GMT)</a></li>
<li><a href="../278429/index.html">Fresh exhibition ISE - new LEDs, screens in the windows and how to break the screen that does not break</a></li>
<li><a href="../278431/index.html">First hakaton 2GIS</a></li>
<li><a href="../278435/index.html">Image binarization: Bradley algorithm</a></li>
<li><a href="../278437/index.html">If programmers were making pancakes (according to kosher methodologies)</a></li>
<li><a href="../278441/index.html">Track updates from MongoDB Replica Set Oplog using Scala and Akka Streams</a></li>
<li><a href="../278443/index.html">Physical web concept. Bluetooth beacons. Comparison of iBeacon, AltBeacon and Eddystone standards</a></li>
<li><a href="../278445/index.html">Pomp - metaframe for parsing sites</a></li>
<li><a href="../278447/index.html">Ralph Baer: "Video Games, I'm your father!"</a></li>
<li><a href="../278449/index.html">Meet at CodeFest</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>