<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Query optimization. Basics of EXPLAIN in PostgreSQL (part 3)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I keep publishing the author's rework Understanding EXPLAIN from Guillaume Lelarge. 
 Once again I will note that some of the information is omitted f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Query optimization. Basics of EXPLAIN in PostgreSQL (part 3)</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/f6c/287/17a/f6c28717a7325185814bec4274d95bb9.jpg"><br>  I keep publishing the author's rework <a href="http://www.dalibo.org/_media/understanding_explain.pdf">Understanding EXPLAIN</a> from Guillaume Lelarge. <br>  Once again I will note that some of the information is omitted for brevity, so I strongly recommend that you familiarize yourself with the original. <br><h5>  Previous parts: </h5><br>  <a href="http://habrahabr.ru/post/203320/">Part 1</a> <br>  <a href="http://habrahabr.ru/post/203386/">Part 2</a> <br><a name="habracut"></a><br><h4>  ORDER BY </h4><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> foo_c1_idx; <span class="hljs-keyword"><span class="hljs-keyword">EXPLAIN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ANALYZE</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> foo <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> c1;</code> </pre> <br><blockquote>  QUERY PLAN <br>  - Sort (cost = 117993.01..120493.04 rows = 1000010 width = 37) (actual time = 571.591..651.524 rows = 1000010 loops = 1) <br>  Short key: c1 <br>  Sort Method: external merge Disk: 45952kB <br>  -&gt; Seq Scan on foo (cost = 0.00..18334.10 rows = 1000010 width = 37) (actual time = 0.007..62.041 rows = 1000010 loops = 1) <br>  Total runtime: 690.984 ms <br>  (5 rows) <br></blockquote><br>  First produced by <code>Seq Scan</code> table <code>foo</code> .  Then sort <code>Sort</code> .  In the output of the EXPLAIN command, the sign <code>-&gt;</code> indicates a hierarchy of actions ( <i>node</i> ).  The sooner an action is performed, the more indented it is displayed. <br>  <code>Sort Key</code> - sorting condition. <br>  <code>Sort Method: external merge Disk</code> - when sorting, a temporary file on a disk with a volume of <code>45952kB</code> . <br><br>  <i>I ask those who understand the topic to explain the differences between <code>external merge</code> and <code>external sort</code></i> . <br><br>  Check with the BUFFERS option: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">EXPLAIN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ANALYZE</span></span>,BUFFERS) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> foo <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> c1;</code> </pre><br><blockquote>  QUERY PLAN <br>  - Sort (cost = 117993.01..120493.04 rows = 1000010 width = 37) (actual time = 568.412..652.308 rows = 1000010 loops = 1) <br>  Short key: c1 <br>  Sort Method: external merge Disk: 45952kB <br>  Buffers: shared hit = 8334, temp read = 5745 written = 5745 <br>  -&gt; Seq Scan on foo (cost = 0.00..18334.10 rows = 1000010 width = 37) (actual time = 0.010..68.203 rows = 1000010 loops = 1) <br>  Buffers: shared hit = 8334 <br>  Total runtime: 698.032 ms <br>  (7 rows) <br></blockquote><br>  Indeed, <code>temp read=5745 written=5745</code> - 5745 blocks of 8Kb = 45960Kb were written and read into a temporary file.  Operations with 8334 blocks were made in the cache. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      File system operations are slower than RAM operations. <br>  Let's try to increase the amount of used memory <code>work_mem</code> : <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> work_mem <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> <span class="hljs-string"><span class="hljs-string">'200MB'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">EXPLAIN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ANALYZE</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> foo <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> c1;</code> </pre><br><blockquote>  QUERY PLAN <br>  - Sort (cost = 117993.01..120493.04 rows = 1000010 width = 37) (actual time = 265.301..296.777 rows = 1000010 loops = 1) <br>  Short key: c1 <br>  Sort Method: quicksort Memory: 102702kB <br>  -&gt; Seq Scan on foo (cost = 0.00..18334.10 rows = 1000010 width = 37) (actual time = 0.006..57.836 rows = 1000010 loops = 1) <br>  Total runtime: 328.746 ms <br>  (5 rows) <br></blockquote><br>  <code>Sort Method: quicksort Memory: 102702kB</code> - the entire sorting is done in RAM. <br><br>  Index: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> foo(c1); <span class="hljs-keyword"><span class="hljs-keyword">EXPLAIN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ANALYZE</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> foo <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> c1;</code> </pre><br><blockquote>  QUERY PLAN <br>  - Index Scan using foo_c1_idx on foo (cost = 0.42..34327.57 rows = 1000010 width = 37) (actual time = 0.023..126.076 rows = 1000010 loops = 1) <br>  Total runtime: 153.452 ms <br>  (2 rows) <br></blockquote><br>  Of the actions left only <code>Index Scan</code> , which markedly affected the speed of the query. <br><br><h4>  LIMIT </h4><br>  Delete the previously created index. <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> foo_c2_idx1; <span class="hljs-keyword"><span class="hljs-keyword">EXPLAIN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ANALYZE</span></span>,BUFFERS) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> foo <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> c2 <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> <span class="hljs-string"><span class="hljs-string">'ab%'</span></span>;</code> </pre><br><blockquote>  QUERY PLAN <br>  - Seq Scan on foo (cost = 0.00..20834.12 rows = 100 width = 37) (actual time = 0.033..94.757 rows = 3824 loops = 1) <br>  Filter: (c2 ~ ab '%' :: text) <br>  Rows Removed by Filter: 996186 <br>  Buffers: shared hit = 8334 <br>  Total runtime: 94.924 ms <br>  (5 rows) <br></blockquote><br>  Expectedly, <code>Seq Scan</code> and <code>Filter</code> . <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">EXPLAIN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ANALYZE</span></span>,BUFFERS) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> foo <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> c2 <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> <span class="hljs-string"><span class="hljs-string">'ab%'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>;</code> </pre><br><blockquote>  QUERY PLAN <br>  - Limit (cost = 0.00..2083.41 rows = 10 width = 37) (actual time = 0.037..0.607 rows = 10 loops = 1) <br>  Buffers: shared hit = 26 <br>  -&gt; Seq Scan on foo (cost = 0.00..20834.12 rows = 100 width = 37) (actual time = 0.031..0.599 rows = 10 loops = 1) <br>  Filter: (c2 ~ ab '%' :: text) <br>  Rows Removed by Filter: 3053 <br>  Buffers: shared hit = 26 <br>  Total runtime: 0.628 ms <br>  (7 rows) <br></blockquote><br>  <code>Seq Scan</code> table rows and compares them to the condition.  As soon as there are 10 entries that satisfy the condition, the scan will end.  In our case, in order to get 10 rows of the result, we had to read not the entire table, but only 3063 records, of which 3053 were rejected ( <code>Rows Removed by Filter</code> ). <br>  The same thing happens with <code>Index Scan</code> . <br><br><h4>  JOIN </h4><br>  Let's create a new table, collect statistics for it. <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> bar (c1 <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>, c2 <span class="hljs-built_in"><span class="hljs-built_in">boolean</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> bar <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> i, i%<span class="hljs-number"><span class="hljs-number">2</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> generate_series(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">500000</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">ANALYZE</span></span> bar;</code> </pre><br><br>  Query on two tables <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">EXPLAIN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ANALYZE</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> foo <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> bar <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> foo.c1=bar.c1;</code> </pre><br><blockquote>  QUERY PLAN <br>  - Hash Join (cost = 13463.00..49297.22 rows = 500000 width = 42) (actual time = 87.441..907.555 rows = 500010 loops = 1) <br>  Hash Cond: (foo.c1 = bar.c1) <br>  -&gt; Seq Scan on foo (cost = 0.00..18334.10 rows = 1000010 width = 37) (actual time = 0.008..67.951 rows = 1000010 loops = 1) <br>  -&gt; Hash (cost = 7213.00..7213.00 rows = 500000 width = 5) (actual time = 87.352..87.352 rows = 500000 loops = 1) <br>  Buckets: 65536 Batches: 1 Memory Usage: 18067kB <br>  -&gt; Seq Scan on bar (cost = 0.00 ..7213.00 rows = 500000 width = 5) (actual time = 0.007..33.233 rows = 500000 loops = 1) <br>  Total runtime: 920.967 ms <br>  (7 rows) <br></blockquote><br>  First viewed ( <code>Seq Scan</code> ) table <code>bar</code> .  For each of its lines, a hash is computed. <br>  Then, the <code>Seq Scan</code> table <code>foo</code> scanned, and for each row of this table a hash is computed, which is compared ( <code>Hash Join</code> ) with the hash of the <code>bar</code> table by the <code>Hash Cond</code> condition.  If a match is found, the resulting string is output, otherwise the string will be skipped. <br>  Used 18067kB in memory to accommodate the hash table <code>bar</code> . <br><br>  Add an index <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> bar(c1); <span class="hljs-keyword"><span class="hljs-keyword">EXPLAIN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ANALYZE</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> foo <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> bar <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> foo.c1=bar.c1;</code> </pre><br><blockquote>  QUERY PLAN <br>  - Merge Join (cost = 1.69..39879.71 rows = 500000 width = 42) (actual time = 0.037..263.357 rows = 500010 loops = 1) <br>  Merge Cond: (foo.c1 = bar.c1) <br>  -&gt; Index Scan using foo_c1_idx on foo (cost = 0.42..34327.57 rows = 1000010 width = 37) (actual time = 0.019..58.920 rows = 500011 loops = 1) <br>  -&gt; Index Scan using bar_c1_idx on bar (cost = 0.42..15212.42 rows = 500000 width = 5) (actual time = 0.008..71.719 rows = 500010 loops = 1) <br>  Total runtime: 283.549 ms <br>  (5 rows) <br></blockquote><br>  <code>Hash</code> no longer in use.  <code>Merge Join</code> and <code>Index Scan</code> indices of both tables provide an impressive performance boost. <br><br>  LEFT JOIN: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">EXPLAIN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ANALYZE</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> foo <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> bar <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> foo.c1=bar.c1;</code> </pre><br><blockquote>  QUERY PLAN <br>  - Hash Left Join (cost = 13463.00..49297.22 rows = 1000010 width = 42) (actual time = 82.682..926.331 rows = 1000010 loops = 1) <br>  Hash Cond: (foo.c1 = bar.c1) <br>  -&gt; Seq Scan on foo (cost = 0.00..18334.10 rows = 1000010 width = 37) (actual time = 0.004..68.763 rows = 1000010 loops = 1) <br>  -&gt; Hash (cost = 7213.00..7213.00 rows = 500000 width = 5) (actual time = 82.625..82.625 rows = 500000 loops = 1) <br>  Buckets: 65536 Batches: 1 Memory Usage: 18067kB <br>  -&gt; Seq Scan on bar (cost = 0.00..7213.00 rows = 500000 width = 5) (actual time = 0.003..31.890 rows = 500000 loops = 1) <br>  Total runtime: 950.625 ms <br>  (7 rows) <br></blockquote><br>  <code>Seq Scan</code> ? <br>  Let's see what the results will be if you disable Seq Scan. <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> enable_seqscan <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">off</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">EXPLAIN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ANALYZE</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> foo <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> bar <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> foo.c1=bar.c1;</code> </pre><br><blockquote>  QUERY PLAN <br>  - Merge Left Join (cost = 0.85..58290.02 rows = 1000010 width = 42) (actual time = 0.024..353.819 rows = 1000010 loops = 1) <br>  Merge Cond: (foo.c1 = bar.c1) <br>  -&gt; Index Scan using foo_c1_idx on foo (cost = 0.42..34327.57 rows = 1000010 width = 37) (actual time = 0.011..112.095 rows = 1000010 loops = 1) <br>  -&gt; Index Scan using bar_c1_idx on bar (cost = 0.42..15212.42 rows = 500000 width = 5) (actual time = 0.008..63.125 rows = 500010 loops = 1) <br>  Total runtime: 378.603 ms <br>  (5 rows) <br></blockquote><br>  According to the planner, using indexes is more expensive than using hashes.  This is possible with a sufficiently large amount of allocated memory.  Remember we increased <code>work_mem</code> ? <br>  But, if memory is in short supply, the scheduler will behave differently: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> work_mem <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> <span class="hljs-string"><span class="hljs-string">'15MB'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> enable_seqscan <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">EXPLAIN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ANALYZE</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> foo <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> bar <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> foo.c1=bar.c1;</code> </pre><br><blockquote>  QUERY PLAN <br>  - Merge Left Join (cost = 0.85..58290.02 rows = 1000010 width = 42) (actual time = 0.014..376.395 rows = 1000010 loops = 1) <br>  Merge Cond: (foo.c1 = bar.c1) <br>  -&gt; Index Scan using foo_c1_idx1 on foo (cost = 0.42..34327.57 rows = 1000010 width = 37) (actual time = 0.005..124.698 rows = 1000010 loops = 1) <br>  -&gt; Index Scan using bar_c1_idx on bar (cost = 0.42..15212.42 rows = 500000 width = 5) (actual time = 0.006..66.813 rows = 500010 loops = 1) <br>  Total runtime: 401.990 ms <br>  (5 rows) <br></blockquote><br>  And what will the output of EXPLAIN look like when <code>Index Scan</code> ? <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> work_mem <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> <span class="hljs-string"><span class="hljs-string">'15MB'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> enable_indexscan <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">off</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">EXPLAIN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ANALYZE</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> foo <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> bar <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> foo.c1=bar.c1;</code> </pre><br><blockquote>  QUERY PLAN <br>  - Hash Left Join (cost = 15417.00..63831.18 rows = 1000010 width = 42) (actual time = 93.440..712.056 rows = 1000010 loops = 1) <br>  Hash Cond: (foo.c1 = bar.c1) <br>  -&gt; Seq Scan on foo (cost = 0.00..18334.10 rows = 1000010 width = 37) (actual time = 0.008..65.901 rows = 1000010 loops = 1) <br>  -&gt; Hash (cost = 7213.00..7213.00 rows = 500000 width = 5) (actual time = 93.308..93.308 rows = 500000 loops = 1) <br>  Buckets: 65536 Batches: 2 Memory Usage: 9045kB <br>  -&gt; Seq Scan on bar (cost = 0.00..7213.00 rows = 500000 width = 5) (actual time = 0.007..33.718 rows = 500000 loops = 1) <br>  Total runtime: 736.726 ms <br>  (7 rows) <br></blockquote><br>  <code>cost</code> clearly increased.  The reason for the <code>Batches: 2</code> .  The whole hash did not fit in memory, it had to be broken into 2 packages of 9045kB. <br><br>  <i>Here again I ask for the help of the guru.</i>  <i>Explain why with <code>LEFT JOIN</code> and sufficient <code>work_mem</code> , using <code>Merge Left Join</code> more expensive than <code>Hash Left Join</code> ?</i> <br><br>  I‚Äôll stop on this today. <br><br>  UPD. <br>  Oleg Bartunov and Alexander Korotkov <a href="https://vimeo.com/105424016">told a</a> lot about PostgreSQL indexes. <br><br>  I will bring here a link to the latest articles from PostgreSQL <a href="https://habrahabr.ru/company/postgrespro/blog/326096/">Indices in PostgreSQL</a> , <a href="https://habrahabr.ru/company/postgrespro/blog/326106/">part 2</a> , <a href="https://habrahabr.ru/company/postgrespro/blog/328280/">part 3</a> .  There much is clarified. </div><p>Source: <a href="https://habr.com/ru/post/203484/">https://habr.com/ru/post/203484/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../203466/index.html">About private "clouds": what and how is usually done in Russia, educational program and the main problems</a></li>
<li><a href="../203470/index.html">Neurozagadka</a></li>
<li><a href="../203476/index.html">Where is the story of space</a></li>
<li><a href="../203478/index.html">Labyrinth generation by Euler algorithm in 30 lines</a></li>
<li><a href="../203482/index.html">The digest of interesting news and materials from the world of PHP No. 30 (November 10‚Äî24, 2013)</a></li>
<li><a href="../203488/index.html">Desktop in a home server or all-in-one</a></li>
<li><a href="../203490/index.html">Why 98% of the texts on your sites do not work. At all. And how to fix it</a></li>
<li><a href="../203492/index.html">Do not trust "people of the people"</a></li>
<li><a href="../203494/index.html">Commercial self-extracting archives: security, principles of operation</a></li>
<li><a href="../203496/index.html">New domains for brands: make.believe</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>