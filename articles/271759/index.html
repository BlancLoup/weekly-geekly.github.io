<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating The Blacksmith: Staging, Shading and Lighting</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In previous articles in this series, we talked about the team that created The Blacksmith video , as well as its artistic design . Now we will look at...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating The Blacksmith: Staging, Shading and Lighting</h1><div class="post__text post__text-html js-mediator-article">  In previous articles in this series, we talked about the <a href="http://habrahabr.ru/company/plarium/blog/269643/">team that created The Blacksmith video</a> , as well as its <a href="http://habrahabr.ru/company/plarium/blog/263219/">artistic design</a> .  Now we will look at creating a video from a technical point of view and will address the aspects of scene preparation, shading and lighting in Unity 5. <br><br><img src="https://habrastorage.org/files/33e/f53/6eb/33ef536ebbe3490880ee49c6cc4fd4e6.jpg"><br><a name="habracut"></a><br>  <b>Testing and working with different versions of the engine</b> <br><br>  We started to create a video on early alpha and beta versions of Unity, stabilized it on version 5.0.b22, and eventually we updated the entire project for the final version of Unity 5. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Using a raw engine at the development stage for creating content, you inevitably encounter instability and low efficiency of processes.  Every week we had a choice: update the engine to the bug fix version or skip the update so as not to disrupt the work of the team. <br><br>  For example, to streamline cameras and animations, we used the Director sequencer as part of the Storytelling toolkit, which at that time was at the initial stage of development.  To add this functionality to the project, we had to regularly merge it with the main version of the engine right up to the release itself. <br><br>  Our team, responsible for the release of content, reports errors and requests new functionality from the relevant departments.  But then we can only hope that the developers will fix the bugs and add new features.  Otherwise, we have to look for workarounds.  The fact is that in addition to our feedback, Unity developers receive feedback from many users and, as a rule, determine the priority of tasks themselves. <br><br>  <b>Scene preparation</b> <br><br>  In one of the first stages of creating The Blacksmith, we sketched out the geometry of the scenes in gray material. <br><br><img src="https://habrastorage.org/files/b97/2fe/b37/b972feb376494c59b17dc975978ac33c.png"><br><br>  To create prototypes we were very useful packages from the Asset Store, for example, <a href="https://www.assetstore.unity3d.com/en/">Better Rocks and Cliffs</a> from Quantum Theory.  Thanks to them, we immediately began work on the appearance of objects and very soon got good results: <br><br><img src="https://habrastorage.org/files/4b8/01b/086/4b801b0869ba400a9af82f257011b660.jpg"><br><br>  On the basis of the storyboard made on preproduction, we performed the first iteration of the cameras, roughly identifying the necessary shots, and immediately made a list of the resources needed for each of them.  At the same time, work on art for 3D character models was in full swing. <br><br>  We needed ample opportunity to customize the artistic effects for each shot.  Therefore, we have added the Scene Manager component to the Unity editor, which allows grouping objects by shots.  With it, we were able to enable and disable objects for individual cameras, as well as change their properties: location, scale, material, etc. Moreover, for each shot unique parameters of light were set up, and Global Illumination provided an instant light change in real time. <br><br><img src="https://habrastorage.org/files/0ec/c00/b69/0ecc00b69a674a459afbbf2c8ef70196.gif"><br><br>  <b>Shading</b> <br><br>  Physically accurate shader (PBS) in Unity is quite easy to use and configure.  We worked with him at all stages of the project.  Writing a separate shader for the skin was not included in our list of tasks, so we limited ourselves to the standard shader: <br><br><img src="https://habrastorage.org/files/b12/20e/d19/b1220ed192bd4a94898f3bfc3a56ce7b.png"><br>  <i>Antagonist.</i>  <i>Screenshot from Unity Editor</i> <br><br>  One of the main advantages of the built-in shader in Unity 5 is the possibility of flexible configuration and expansion in accordance with the specifics of the project.  You can download it from the link: <a href="http://unity3d.com/ru/get-unity/download/archive">http://unity3d.com/get-unity/download/archive</a> (in the Downloads menu, select ‚ÄúEmbedded shaders‚Äù for your platform).  Taking it as a basis, you can easily create unique shaders for your projects, as we do for our video.  Below we present some examples. <br><br>  We have added a unique shader recognition function to the built-in shader.  For this modification, we made two versions: for the environment (for example, to take into account atmospheric scattering) and for characters, more complex (to take into account unique shadows and wrinkle maps).  In the latter, we slightly improved the UI by adding sliders for the reflection map. <br><br><img src="https://habrastorage.org/files/c23/b91/9fa/c23b919fac2e409186716e3d620b626e.png"><br><br>  To make the antagonist's mimicry more realistic, we added blend-based wrinkle maps to the project.  In each frame, our component determined the blend shampoo with the greatest influence and appropriately arranged the textures of the normals and shadows at the prerendor stage.  Then the modified standard shader sampled and unpacked the normals and shadows from the screen space buffer instead of the usual material slots. <br><br><img src="https://habrastorage.org/files/5a5/2ac/28e/5a52ac28e02a4bfea90fd546889b02a2.png"><br><br>  The standard Unity shader is well suited for a variety of real materials, but unfortunately, hair is not one of them.  Despite the fact that hair rendering was not part of the project‚Äôs objectives, we wanted to provide characteristic anisotropic lighting while maintaining proper integration with the physical environment used by other materials.  To do this, we modified the built-in shader by changing the reflection distribution model, but left the process of sampling reflections and lightning probes in its original form. <br><br><img src="https://habrastorage.org/files/4db/f96/e23/4dbf96e231564cd9a3b94e31d9e2435c.png"><br>  <i>Hair shader</i>  <i>Screenshot from Unity Editor</i> . <br><br>  For some shots, we wanted to make soft vegetation and find an easy way to diversify it.  To this end, we have broken the whole process into 2 stages and expanded the vegetation creation functions built into Unity.  Using the small PaintJob tool, we automated the process of adding any static geometry to a world with a temporary landscape.  Combined with a set of simple rules that control the process, this allowed us to generate layers of vegetation on the meshes of the earth's surface, around objects and on the roofs of houses.  For rendering, we collected all of this data in a unique component for sorting around the viewpoint, sampling the global illumination, and managing the sample rendering and level of detail. <br><br><img src="https://habrastorage.org/files/6e1/2ec/58d/6e12ec58d95f4f4b817f1395426e0d33.png"><br><br><img src="https://habrastorage.org/files/198/62f/4d4/19862f4d404143a0b935786d0aaafe22.png"><br><br>  <b>Lighting</b> <br><br>  We divided the lighting for the characters and the surrounding world into several layers and assigned the appropriate culling-masks to the lamps.  So we got more control over each layer.  A similar approach is usually used in the film industry, adjusting the lighting depending on the location of the actors in the frame. <br><br>  To improve the appearance of the characters, we used additional local light sources to soften the shadows (unlit areas) on their faces. <br><br><img src="https://habrastorage.org/files/fca/5d1/817/fca5d181711a46a9af1ca4162cdc3aff.gif"><br><br>  In the Blacksmith demo, we focused on the characters and used a lot of close-up shots.  Therefore, it was very important that the shadows were in a sufficiently high resolution.  Therefore, especially for the shadows of the characters, we added a separate texture. <br><br><img src="https://habrastorage.org/files/e69/777/568/e69777568f8a46cd94725c90bbdb68cf.gif"><br><br>  According to the idea, the forge inside had to look as if it was illuminated by rays penetrating through holes in the walls and roof.  To achieve this effect, we used a cookie with the appropriate pattern. <br><br><img src="https://habrastorage.org/files/836/b89/c19/836b89c193844fe39391c1ea77f9ec04.png"><br><br>  As for reflections in the ocean and puddles on the shore, we wanted them to look as sharp as possible at the point of contact of the object with the reflecting surface and gradually become blurry as the distance from the object.  As a result, we added a convolution step to the shader taking into account the depth and the ability to adjust the data depending on the smoothness of the surface.  The obtained data was then imported into a standard shader with the replacement of cubic textures of reflections with new unique textures. <br><br><img src="https://habrastorage.org/files/d84/193/992/d8419399293c4f33b21ca617ca15c5a2.png"></div><p>Source: <a href="https://habr.com/ru/post/271759/">https://habr.com/ru/post/271759/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../271747/index.html">Asterisk: Prioritizing VoIP traffic and reserving Internet access from two providers on MikroTik</a></li>
<li><a href="../271749/index.html">DotNext - Conference on .NET-technologies, Moscow, December 11</a></li>
<li><a href="../271751/index.html">Deploy Drupal 8 with Docker</a></li>
<li><a href="../271755/index.html">MultiSim: technological SIM-phony for several operators and one subscriber</a></li>
<li><a href="../271757/index.html">Comparative analysis of shopping carts</a></li>
<li><a href="../271761/index.html">Development of fast mobile applications on Android. Part one</a></li>
<li><a href="../271763/index.html">Give us a flash revolution! How to quickly and safely go to flash drives</a></li>
<li><a href="../271765/index.html">AngularJs, a short tutorial on creating PhoneCat Application</a></li>
<li><a href="../271767/index.html">Computational intelligence in creating procedurally-generated content for video games</a></li>
<li><a href="../271769/index.html">WifiOTP: Convenient two-factor authentication using Wi-Fi SSID</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>