<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What do they write to tech-support video streamer?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. Dozens of different calls open daily to our support, from simple questions ‚Äúhelp set up a cluster‚Äù to very complex ‚Äúthe stream does not work, s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What do they write to tech-support video streamer?</h1><div class="post__text post__text-html js-mediator-article">  Hello.  Dozens of different calls open daily to our support, from simple questions ‚Äúhelp set up a cluster‚Äù to very complex ‚Äúthe stream does not work, sometimes the stream stutters‚Äù, but there are questions that already have an eye twitching and every employee can answer in detail. <br><br>  And since the questions do not stop, so you can answer here. <br><a name="habracut"></a><br><h2>  Why is the video delayed? </h2><br>  We already have two articles in the blog ( <a href="https://habr.com/post/335208/">one</a> , <a href="https://habr.com/post/345010/">two</a> ) on this topic, read them if you work with videos, and here I will give a short and comprehensive answer: <br><br>  Modern Internet streaming is the <a href="https://ru.wikipedia.org/wiki/HLS">HLS protocol</a> .  Sometimes DASH, but it does not matter, because they are both segment. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      How it works?  Streaming video is ‚Äúsliced‚Äù into small files (usually 2-8 seconds, depending on the dynamic content), 3-10 such segments accumulate and are described by a special playlist, which is automatically updated when you delete the old segment and add a new one.  Just like that.  More segments - more delay, longer duration of each segment - more delay.  10-20 seconds is normal. <br><br>  Why do you need it?  Why accumulate so much video in the video server memory?  Segmentation allows the player to not respond to the instability of the Internet connection, not to interrupt the video when switching from a Wi-Fi network to a mobile connection.  If the video were not prepared in advance and packed into separate files, then at the slightest failure or lack of bandwidth, we would have video on the screen artifacts, and segmentation gives the player about 4-20 seconds to reconnect the player and upload new data. <br><br>  What if you need a video without delay?  Choose a different protocol if you are going to make a web chat, control the web through the Internet, watch IP video cameras.  Here are examples: WebRTC, MSE-LD, RTMP. <br><br><h2>  How to protect the video?  Paste only on your website </h2><br>  The task is very simple - the video on the site should be protected from pasting to other sites, no one wants to pay for someone else's traffic, video traffic is expensive.  And still video can be private and should not fall outside the personal account. <br><br>  I always have one answer to all such requests - you <b>need to set up Securelink</b> on your site.  Content protection is impossible unilaterally - the site itself must generate links, you can not just take and insert a static link to the site. <br><br>  Securelink is an old and highly effective link protection technology.  Many habrachitelemy aware of a special module for Nginx - ngx_http_secure_link_module.  We do not use Nginx, but there is a similar and equally effective implementation, the difference is only in the order of parameters. <br><br>  How it works?  The site generates a <b>unique one-time</b> link based on user data.  And what does the web server know about the client?  Correctly, this is IP-address, User-Agent, Cookie, requested URL.  If the client is authorized, then in the session variables you can get other information, for example, the unique client ID in the service database, or, for example, the subscription validity period. <br><br>  We collect parameters in one line and we hash our favorite algorithm, for example, SHA1.  It turns out a set of useless characters.  For example, the hash from the string ‚Äú127.0.0.1Habr‚Äù would be: 70ebe94671dd21bd65f4a00dfd988adc83fe6bda. <br><br>  This line will be transmitted to the video streamer and its task will be to check the validity of the link, that it was generated by your website, not ‚Äúspoiled‚Äù and not passed on to third parties.  There is no feedback from the site, so the video streamer should generate a hash using the same data that the website used.  The video streamer also knows the client‚Äôs IP address, the requested content, but can never know either the user ID or the link lifetime.  You will have to transfer this data directly in the link and use the secret key so that anyone could not generate links to themselves. <br><br>  We take the line "127.0.0.1Habr1540327100SECRET" and we get SHA1 99fe961672c52aa3033b98b545ec2cdec93bf515, and now we form the link of the form: <br><br>  <a href="">example.com/Habr/index.m3u8?token=99fe961672c52aa3033b98b545ec2cdec93bf515-1540327100</a> <br><br>  example.com is your video server, Habr is the requested video, index.m3u8 is the standard name of the HLS playlist, the value token is a string from the web server that you and I generated. <br><br>  The video streamer easily extracts from this data everything that is needed to get the same hash: the IP address is read from the web server variable, the requested content is from the URL, the lifetime is from the token parameter, the only thing that is missing is the secret key; write to config file and keep secret. <br><br>  You cannot send such a link to a friend or open it in another browser ‚Äî the IP address is in the hash formula, and the lifetime cannot be changed ‚Äî then the hash does not match. <br><br><h2>  Underwater rocks </h2><br>  I really wanted to describe in two paragraphs, but in short did not work.  This is the first problem - not everyone is willing to delve into such details, because it is much easier to insert a static link.  We <a href="https://erlyvideo.ru/doc/auth/securelink-alt">have ready-made examples on</a> our <a href="https://erlyvideo.ru/doc/auth/securelink-alt">site</a> , so there should be no problem. <br><br>  It often happens that the website and the web server incorrectly determine the IP address of the client, this is normal if you use a CDN network, for example, CloudFlare.  In this case, you need to take the IP address from the correct header, you may need the help of a CDN provider.  For example, with CloudFlare, this is CF-Connecting-IP. <br><br>  Wrong time.  Incorrect time on one of the servers, in combination with attempts to shorten the link lifetime as much as possible, not infrequently lead to broken links.  And it also happens that the user leaves the tab open for several hours, and then cannot play the video due to the short lifetime. <br><br>  3-24 hours link lifetime is normal, they are still protected and there are ways to limit the number of simultaneous views. <br><br><h2>  Instead of the total </h2><br>  Tell us in the comments how to circumvent such a link protection mechanism? </div><p>Source: <a href="https://habr.com/ru/post/427499/">https://habr.com/ru/post/427499/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../427487/index.html">Testing configuration for Java developers: practical experience</a></li>
<li><a href="../427489/index.html">Home Data: How Data Analysis is Used in Architecture and Urbanism</a></li>
<li><a href="../427491/index.html">Do it in English: 7 western interviewers, from whom everyone takes an example</a></li>
<li><a href="../427493/index.html">Amplifiers low frequency classes: A, B, AB, D, G, H</a></li>
<li><a href="../427495/index.html">How much does Habr + earn how to find out how much other companies earn</a></li>
<li><a href="../427501/index.html">Seymour Papert: Hard Fun</a></li>
<li><a href="../427505/index.html">Presumption of mind</a></li>
<li><a href="../427507/index.html">Seymour Papert: The Delightful Discovery of ‚ÄúNothing‚Äù</a></li>
<li><a href="../427509/index.html">Web servers: Southbridge experience and practice</a></li>
<li><a href="../427513/index.html">How to analyze Thread Dump</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>