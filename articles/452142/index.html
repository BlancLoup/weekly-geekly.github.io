<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How do we deal with copying content, or the first adversarial attack in the sale</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hey. 


 Did you know that ad platforms often copy content from competitors in order to increase the number of ads? They do it like this: ring up the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How do we deal with copying content, or the first adversarial attack in the sale</h1><div class="post__text post__text-html js-mediator-article"><p>  Hey. </p><br><p>  Did you know that ad platforms often copy content from competitors in order to increase the number of ads?  They do it like this: ring up the sellers and offer them to be accommodated on their platform.  And sometimes they copy ads without permission from users.  Avito is a popular venue, and we often face such unfair competition.  Read about how we deal with this phenomenon under the cut. </p><br><p><img src="https://habrastorage.org/webt/2e/ey/o2/2eeyo2sz9_4r8iq7kntcrbh4h0a.png"></p><a name="habracut"></a><br><h1 id="problema">  Problem </h1><br><p>  Copying content from Avito to other platforms exists in several categories of goods and services.  This article will only discuss cars.  In the <a href="https://habr.com/ru/company/avito/blog/447286/">previous post,</a> I told you about how we did auto-hide the number on cars. </p><br><p><img src="https://habrastorage.org/webt/3j/gr/bz/3jgrbzhv3y9sldjmbm5hlfmhlo8.png"></p><br><p>  But it turned out (judging by the search results of other platforms) that we launched this feature on three ad sites at once. <br> <a href=""><img src="https://habrastorage.org/webt/lo/sb/r3/losbr3xqmaaaojzcgbzd5j3_w_a.png"></a> </p><br><p> <a href=""><img src="https://habrastorage.org/webt/it/zo/e4/itzoe4rmebgi5xhy-ngcoickcig.png"></a> </p><br><p>  After the launch of one of these sites, we temporarily stopped calling our users with offers to copy an ad to their platform: there was too much content with the Avito logo on their site, only in November 2018 - more than 70,000 ads.  For example, this is how their search results per day in the Chechen Republic looked like. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/3h/2t/eq/3h2teqevlept8woqmqaq8xf3qc8.png"></a> </p><br><p>  After training their license plate hiding algorithm so that it automatically detects and closes the Avito logo, they resumed the process. </p><br><p><img src="https://habrastorage.org/webt/oj/c3/ln/ojc3ln9gt1jhp-j3jyt628c1gue.png"></p><br><p>  From our point of view, copying the content of competitors, using it for commercial purposes is unethical and unacceptable.  We receive complaints from our users who are unhappy with this in our support.  And here is an example of the reaction in one of the stores. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/a8/ya/ze/a8yaze9dwemfmmygfn_qjpgmufu.png"></a> </p><br><p>  It must be said that asking people for consent to copy ads does not justify such actions.  This is a violation of the laws "On Advertising" and "On Personal Data", Avito rules, trademark rights and the database of announcements. </p><br><p>  We did not manage to agree peacefully with a competitor, and we did not want to leave the situation as it is. </p><br><h1 id="sposoby-resheniya-problemy">  Ways to solve the problem </h1><br><p>  The first method is legal.  Similar precedents have already been in other countries.  For example, the well-known American klassifayd Craigslist sued large sums of money from sites copying from it. <br>  The second way to solve the problem of copying is to add a large watermark to the image so that it cannot be cut off. <br>  The third way is technological.  We may hinder the process of copying our content.  It is logical to assume that some model is involved in hiding Avito‚Äôs logo from competitors.  It is also known that many models are subject to "attacks" that prevent them from working correctly.  This article is about them. </p><br><h1 id="adversarial-attack">  Adversarial attack </h1><br><p><img src="https://habrastorage.org/webt/ar/qt/is/arqtis4l_bfurroznpr0occwmji.png"></p><br><p>  Ideally, the adversarial example for the network looks like a noise indistinguishable by the human eye, but for the classifier it adds a sufficient signal to the class that is absent in the picture.  As a result, a picture, for example, with a panda, is classified with high confidence as a gibbon.  Creating adversarial noise is possible not only for image classification networks, but also for segmentation, detection.  An interesting example is the recent work from Keen Labs: they tricked the Tesla autopilot with dots on the pavement and a rain detector by displaying <a href="https://www.forbes.com/sites/thomasbrewster/2019/04/01/hackers-use-little-stickers-to-trick-tesla-autopilot-into-the-wrong-lane/">just such adversarial noise</a> .  There are also attacks for other domains, for example, sound: the famous attack on Amazon Alexa and other voice assistants <a href="https://www.fastcompany.com/90240975/alexa-can-be-hacked-by-chirping-birds">consisted</a> in playing commands indistinguishable by the human ear (hackers offered to buy something on Amazon). </p><br><p>  The creation of adversarial noise for models that analyze images is possible due to the non-standard use of the gradient necessary for training the model.  Usually, in the method of back propagation of error, using the calculated gradient of the objective function, only the weights of the layers of the network change so that it is less mistaken in the training dataset.  Just as with network layers, you can calculate the gradient of the objective function from the input image and change it.  Changing the input image using a gradient was applied for various known algorithms.  Remember <a href="https://en.wikipedia.org/wiki/DeepDream">Deepdream</a> ? </p><br><p><img src="https://habrastorage.org/webt/zy/7-/nz/zy7-nzz0yigb1t6nlpk7p-yg8fe.jpeg"></p><br><p>  If we iteratively compute the gradient of the objective function from the input image and add this gradient to it, more information about the prevailing class from ImageNet will appear in the image: more dog faces appear, thus reducing the value of the loss function and the model becomes more confident in the dog class.  Why are dogs in the example?  Just in ImageNet from 1000 classes - <a href="https://en.wikipedia.org/wiki/ImageNet">120 classes of dogs</a> .  A similar approach to changing the image was used in the Style Transfer algorithm, known mainly due to the Prisma application. <br>  To create an adversarial example, you can also use an iterative method for changing the input image. </p><br><img src="https://habrastorage.org/webt/ep/9c/fn/ep9cfnp03kvmvw3bxkgdtrsvh9s.png" width="500"><br><p>  This method has several modifications, but the basic idea is simple: the original image is iteratively shifted in the direction of the gradient of the loss function of the classifier J (because only the sign is used) with the increment Œ±.  'y' is the class that is represented in the image to reduce network confidence in the correct answer.  Such an attack is called non targeted.  You can choose the optimal step and the number of iterations so that the change in the input image is indistinguishable from the usual for a person.  But in terms of time costs, such an attack does not suit us.  5-10 iterations for one image in the sale is a long time. <br>  An alternative to iterative methods is the FGSM method. </p><br><img src="https://habrastorage.org/webt/bt/jz/eb/btjzebognzeq9yfjcao4feowcka.png" width="400"><br><p>  This is the single-shot method, i.e.  to use it, you need to count the gradient of the loss function once on the input image, and the adversarial noise to add to the picture is ready.  This method is obviously more productive.  It can be applied in production. </p><br><h1 id="sozdanie-adversarial-examples">  Creating adversarial examples </h1><br><p>  We decided to start with hacking our own model. <br>  This is a picture that reduces the probability of finding a license plate for our model. </p><br><p><img src="https://habrastorage.org/webt/_g/zr/sd/_gzrsdzrt8_ll-kcptlk6drohks.jpeg"></p><br><p>  It can be seen that this method has a drawback: the changes that it adds to the picture are noticeable to the eye.  Also this method is non-targeted, but it can be changed to make a targeted attack.  Then the model will predict the place for the license plate in another place.  This is the T-FGSM method. </p><br><img src="https://habrastorage.org/webt/fl/xa/ol/flxaolivi31qlwypwfbqh7ifkc4.png" width="400"><br><p>  In order to break our model with this method, you need to change the input image a little more noticeably. </p><br><p><img src="https://habrastorage.org/webt/sd/tc/wb/sdtcwbv90v5kfmx8tt0zgvg9gxs.jpeg"></p><br><p>  So far it is impossible to say that the results are perfect, but at least the efficiency of the methods has been verified.  We also tried ready-made libraries for hacking Foolbox, CleverHans and ART-IBM networks, but with their help it was not possible to break our network for detection.  The methods given there are better suited for classification networks.  This is a general trend in network hacking: for object detection, it is more difficult to make an attack, especially when it comes to complex models, for example, Mask RCNN. </p><br><h1 id="testirovanie-atak">  Attack testing </h1><br><p>  Everything that was described so far did not go beyond our internal experiments, but we had to figure out how to test the attacks on the detectors of other ad serving platforms. <br>  It turns out that when submitting ads to one of the platforms, license plate detection occurs automatically, so you can upload photos and check how the detection algorithm copes with the new adversarial example many times. </p><br><p><img src="https://habrastorage.org/webt/6o/ha/hb/6ohahbfey05kcdxjejpzmn5cs2y.png"></p><br><p>  It is perfectly!  But‚Ä¶ <br>  None of the attacks that worked on our model worked when tested on another platform.  Why did it happen?  This is a consequence of the differences in the models and how poorly the adversarial attacks are generalized to different network architectures.  Because of the difficulty of replaying attacks, they are divided into two groups: the white box and the black box. </p><br><p><img src="https://habrastorage.org/webt/yq/nv/vw/yqnvvwjl2s5lftjoq1mmjttmeby.jpeg"></p><br><p>  Those attacks that we did on our model - it was a white box.  What we need is a black box with additional restrictions on the inference: there is no API, all you can do is manually upload photos and check attacks.  If there was an API, then you could make a substitute model. </p><br><p><img src="https://habrastorage.org/webt/lg/hu/ir/lghuirklbgq70ds44k0olqckncw.png"></p><br><p> The idea is to create a dataset of input images and answers of the black box model, on which several models of different architectures can be trained, so as to approximate the black box model.  Then you can hold a white box attack on these models and they are more likely to work on the black box.  In our case, this implies a lot of manual work, so this option did not suit us. </p><br><h1 id="vyhod-iz-tupika">  Break the deadlock </h1><br><p>  In search of interesting work on black box attacks, an article was found <a href="https://arxiv.org/abs/1804.05810">ShapeShifter: Robust Physical Adversarial Attack on Faster R-CNN Object Detector</a> <br>  The authors of the article made attacks on the object detection network of self-driving machines by iteratively adding images, other than the true class, to the background of the stop sign. </p><br><p><img src="https://habrastorage.org/webt/au/wu/-h/auwu-hmc4muwly5o4q5fl2xxnow.png" width="350"><img src="https://habrastorage.org/webt/yk/jf/u9/ykjfu930tsmrxu2peehnpbxgzau.png" width="350"><br></p><br><p>  Such an attack is clearly visible to the human eye, however, it successfully breaks down the work of the object detection network, which is what we need.  Therefore, we decided to neglect the desired invisibility of the attack in favor of efficiency. </p><br><p>  We wanted to check whether the detection model was retrained, does it use information about the car, or does Avito only need a die? </p><br><p>  To do this, create this image: </p><br><p><img src="https://habrastorage.org/webt/7t/y0/ke/7ty0kes_vemztxmeitpvc2gkslq.jpeg"></p><br><p>  We uploaded it as a car to the ad platform with a black box model.  Got: </p><br><p><img src="https://habrastorage.org/webt/jz/l2/pb/jzl2pbdrm7yn5ak0nyjq3epk0v0.png"></p><br><p>  So, you can only change Avito's plate, the rest of the information in the input image is not necessary for detecting the black box model. <br>  After several attempts, the idea of ‚Äã‚Äãadding to the Avito plate an adversarial noise obtained by the FGSM method, which broke our own model, but with a rather large coefficient Œµ, arose.  It turned out like this: </p><br><p><img src="https://habrastorage.org/webt/uk/j8/s9/ukj8s9odu4xovgxm7zaxkhx1eby.png"></p><br><p>  By car, it looks like this: </p><br><p><img src="https://habrastorage.org/webt/mf/df/m-/mfdfm-kw3lwcnm5ywmcfm_wmgnu.jpeg"></p><br><p>  We uploaded photos to the platform with a black box model.  The result was successful. </p><br><p><img src="https://habrastorage.org/webt/7v/yu/g4/7vyug4z6_pclel8qzsg89icho0y.png"></p><br><p>  Applying this method to several other photos, we found that it does not work often.  Then after several attempts, we decided to focus on the other most prominent part of the issue - the border.  It is known that the initial convolutional layers of the network have activation on simple objects like lines, angles.  By breaking the border line, we can prevent the network from correctly detecting the number area.  This can be done, for example, by adding noise in the form of white squares of random size along the entire border of the number. </p><br><p><img src="https://habrastorage.org/webt/zz/sl/ct/zzslct12tukii9si-56ygfzezhm.jpeg"></p><br><p>  By uploading such a picture onto the platform with a black box model, we got a successful adversarial example. </p><br><p><img src="https://habrastorage.org/webt/bt/oa/j9/btoaj9xafqe4rjflrvn0xeaysrq.png"></p><br><p>  Having tried this approach on a set of other pictures, we found out that the black box model can no longer detect Avito's plate (the set was assembled by hand, there are fewer than a hundred pictures, and it is certainly not representative, but it takes more time to make more).  An interesting observation: the attack is successful only when combining noise in the letters Avito and random white squares in a frame; the use of these methods separately does not give a successful result. <br>  As a result, we rolled out this algorithm in the prod, and this is what came of it :) </p><br><h1 id="neskolko-naydennyh-obyavleniy">  Multiple ads found </h1><br><p><img src="https://habrastorage.org/webt/yy/2k/lj/yy2kljgvkuzut5olbluake9llhw.png"></p><br><p><img src="https://habrastorage.org/webt/nm/rc/wk/nmrcwk2lofhrlf3vjkqssbyoeqw.png"></p><br><p>  Something fresher: </p><br><p><img src="https://habrastorage.org/webt/eq/9u/9e/eq9u9epuxlbjiaew94-9ul0orji.png"></p><br><p>  We even got into the advertising platform: </p><br><p><img src="https://habrastorage.org/webt/z_/fg/7m/z_fg7m-wm4vo1jjeq4nvdhlsmrs.png"></p><br><h1 id="itogo">  Total </h1><br><p>  As a result, we managed to make an adversarial attack, which in our implementation does not increase the image processing time.  The time we spent creating an attack is two weeks before the New Year.  If it had not happened during this time to do it, they would have placed a watermark.  Now the adversarial license plate is disabled, because now a competitor is calling users, invites them to upload photos into the advertisement themselves or replace the photo of the car with stock from the Internet. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/452142/">https://habr.com/ru/post/452142/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../452130/index.html">The moon shrinks, it causes moonquakes</a></li>
<li><a href="../452134/index.html">How it all began: the history of the soldering iron and the emergence of modern tools</a></li>
<li><a href="../452138/index.html">13. Check Point Getting Started R80.20. Licensing</a></li>
<li><a href="../45214/index.html">On the crest of a wave with spam, or how to punish villains?</a></li>
<li><a href="../452140/index.html">Why CFOs are switching to an operating cost model in IT</a></li>
<li><a href="../452144/index.html">China and Iran use replay attacks to combat Telegram</a></li>
<li><a href="../452146/index.html">So what will happen with authentication and passwords? The second part of the Javelin Strong Authentication Status Report</a></li>
<li><a href="../45215/index.html">A highly developed AI must have a soul.</a></li>
<li><a href="../452152/index.html">What solutions does Rostelecom have for IIoT?</a></li>
<li><a href="../452154/index.html">Virtual cube - instead of OLAP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>