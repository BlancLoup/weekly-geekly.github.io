<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Operation Potao: Malware Analysis for cyber espionage, part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Analysts of our anti-virus laboratory conducted an investigation of a series of cyber attacks and malicious campaigns using Win32 / Potao malware . De...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Operation Potao: Malware Analysis for cyber espionage, part 1</h1><div class="post__text post__text-html js-mediator-article"> Analysts of our anti-virus laboratory conducted an investigation of a series of cyber attacks and malicious campaigns using <b>Win32 / Potao malware</b> .  Despite the fact that the anti-virus products of our company, as well as some other anti-virus vendors, have already detected this malware, it remained outside the public field.  The first samples of <b>Win32 / Potao</b> date back to 2011. <br><br><img src="https://habrastorage.org/files/116/079/36a/11607936ad224a5aa83d4ecfbd35da78.jpeg"><br><br>  Cyber ‚Äã‚Äãattacks using Potao are a type of directional attack, some examples of which we have already considered.  We are talking about BlackEnergy malware (aka Sandworm, Quedagh), which prevails in Ukraine, Russia, and also in some CIS countries, including Georgia and Belarus. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>  The computer networks of the military and the government of Ukraine, as well as one of the leading Ukrainian news agencies, were victims of Potao.  In addition, the malicious program was used by cybercriminals to spy on participants in the MMM financial pyramid, which is popular in both Russia and Ukraine.  One of the most interesting features of this malicious campaign is that attackers compromised the well-known open-source legitimate encryption software TrueCrypt and then used it to distribute malware. <br><br>  The Russian website for this encryption tool with the address <i>truecryptrussia.ru</i> distributed the TrueCrypt application, which contained a backdoor.  An interesting feature is that malicious instances of this application were delivered only to some users, which is an indicator of the focus of this malicious campaign.  This feature also explains the fact that the backdoor for a long time remained invisible to users and visitors to the specified website.  This above domain was used by operators as a C &amp; C server manager for malware.  In some cases, Win32 / Potao is downloaded onto the computer by another malicious program, which is detected by our products as <b>Win32 / FakeTC</b> . <br><br>  Our report contains detailed information about the large number of attacks using Win32 / Potao, which the attackers have organized over the past 5 years.  Similar to the BlackEnergy malware used by the Sandworm cyber group, Potao is a versatile modular cyber espionage tool.  Cyberattacks in which Potao was used are of the Advanced Persistent Threat (APT) type and are targeted.  We observed only sporadic cases of using Potao in mass malicious campaigns. <br><br>  <b>general information</b> <br><br>  As we mentioned earlier, the Potao malware is not new, it was discovered as early as 2011. One of the possible reasons why this malware has not yet been publicly covered is its activity.  In the period from 2011 to 2013  The number of detections of this malware was low.  A significant increase in the prevalence of Potao, according to ESET LiveGrid, was observed in 2014 and 2015.  (Figure 1.) <br><br><img src="https://habrastorage.org/files/be5/993/134/be5993134934486e8eac12d2dd7c91b6.png"><br>  Fig.  1. Win32 / Potao distribution statistics at different time intervals according to ESET LiveGrid. <br><br>  The diagram above shows that we did not provide statistics for Win32 / Potao for 2011. This was done for the reason that during this period of time Potao was distributed by attackers as part of mass campaigns, i.e. at that time the malware was not used in targeted attacks against users.  The debug versions of Potao, discovered in 2013, were also excluded from the chart data. <br><br>  Using Potao in mass campaigns against users makes it look like malware like BlackEnergy or even Stuxnet.  These well-known malicious programs were used by cybercriminals for targeting cyber attacks, but ultimately they became widespread, infecting those users for whom they were not designed initially.  In the process of investigating malware campaigns involving Potao, we discovered that attackers used debug versions of this malware to test it before using it in targeted attacks. <br><br>  The main reason for the increase in the number of Potao detections in 2014 and 2015.  there was an intruder-added mechanism for infecting removable USB drives. <br><br><img src="https://habrastorage.org/files/114/1ce/cd7/1141cecd74ca4cd08beb028f1aa6a368.png"><br>  Fig.  2. Chronology of malicious campaigns using Potao. <br><br>  To compile the above chronology, we used data from our ESET LiveGrid cloud system, as well as the timestamps of the executable PE files of the malware. <br><br>  The first cyber campaign using Potao was recorded in August 2011. It was not a direct attack, as it was massive.  The executable files of the malware that were used in this campaign contained the encrypted string <i>GlobalPotao</i> . <br><br>  The propagation mechanism of Potao in this malicious campaign was rather trivial, but rather effective.  Malicious droppers were distributed as attachments to phishing e-mail messages, while the MS Word document icon was used as the icon of the executable file.  This disguise helps to lull the attention of users who receive such phishing messages.  It should be noted that the attackers did not use any exploits to automatically install the malware.  In addition to the payload, the droppers contained a fake Word document that was displayed to the user to disguise the installation of the malware into the system. <br><br><img src="https://habrastorage.org/files/79f/163/43b/79f16343b79c479ba1d384404e9553c5.png"><br>  Fig.  3. A fake decoy document (bait) that the Potao dropper shows the user to disguise their installation process. <br><br>  Other Potao droppers that were used in malicious campaigns in 2011 contained documents in the Armenian language.  It is interesting to note that a legitimate document belonging to the Armenian Ministry of Labor and Social Affairs was used as one of the decoy documents. <br><br><img src="https://habrastorage.org/files/8e0/82a/13c/8e082a13c5fb4d30aff244016b57a699.png"><br>  Fig.  4. Legitimate decoy-document in Armenian, which was used in Potao droppers in 2011 <br><br>  Another malicious cyber campaign was aimed at the participants in the <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%259C%25D0%259C">MMM financial pyramid by</a> cyber criminals.  Potao executables that were used in a campaign against MMM members had compile timestamps on April 27, 2012 and the campaign identifier (ID) <i>00km</i> .  A fake decoy document uses the pyramid entry theme. <br><br><img src="https://habrastorage.org/files/3e0/40b/dff/3e040bdff9cb4569ab8f459e47deab1c.png"><br>  Fig.  5. Decoy-document dropper, which was used in malicious campaigns against members of MMM. <br><br>  In this malicious campaign, Potao droppers with decoy documents were found that contained random sequences of Cyrillic characters.  As we discovered later, the use of documents with arbitrary character sets is a kind of calling card of this cyber group. <br><br><img src="https://habrastorage.org/files/cd8/6b9/c20/cd86b9c202504050beda25ec6df1b329.png"><br>  Fig.  6. Decoy-document, which was used in malicious campaigns against participants MMM. <br><br>  The above file was named by the attackers ‚ÄúReport on the payment of Kovaleva Alexandra.exe‚Äù.  In addition, the <i>mmmL</i> campaign ID of the malicious campaign confirms the use of malicious software by hackers against MMM users. <br><br>  The founder of the MMM pyramid, Sergey Mavrodi, on June 19, 2012 posted on the pyramid website a warning that attackers send phishing emails on his behalf that contain a link to malware located on Dropbox. <br><br><img src="https://habrastorage.org/files/18c/71c/9bc/18c71c9bc4744bb29388e9f9d00e83f5.png"><br>  Fig.  7. Message with a warning about malicious distribution from the founder of MMM Sergey Mavrodi. <br><br><img src="https://habrastorage.org/files/ebb/936/e72/ebb936e72f344caeb530e866a057c6d2.png"><br>  Fig.  8. Archive with malware hosted on the Dropbox service. <br><br>  The attackers used the following file names as indicated above: ‚ÄúQuestionnaire and rules‚Äù, ‚Äúanketa_i_pravila‚Äù, droppers contained a compilation mark on June 13, 2012 and the campaign ID ‚ÄúNMMM‚Äù. <br><br>  We can assume that Potao operators used this spyware malware to spy on the participants or organizers of this financial pyramid. <br><br>  In 2013, traces of Potao were found in Georgia.  The executable file of the malware, which had a timestamp dated October 15, 2013, was called ‚ÄúWedding_invitation.exe‚Äù.  This time the decoy-document contained the text of the wedding invitation.  The file name and the text of the document contained the text in English. <br><br><img src="https://habrastorage.org/files/833/c44/b0e/833c44b0efb948f9987df07953fb6ca2.png"><br>  Fig.  9. The appearance of the decoy-document, which was used in Potao droppers, aimed at users of Georgia. <br><br>  <b>Potao in Ukraine</b> <br><br>  Before detecting an increase in Win32 / Potao activity in Ukraine in 2014, we discovered several debug versions of this malware in the fall of 2013. We can assume that the attackers tested the new version of the malware before using it in targeted cyber attacks on Ukrainian users . <br><br><img src="https://habrastorage.org/files/232/1f6/aa8/2321f6aa844a4bf493e3097a80721282.png"><br>  Fig.  10. Fragment of the code of the debug version of the malicious program. <br><br>  It is interesting to note that one of the campaign identifiers in these debug versions of Potao was the word <i>krim</i> (Crimea). <br><br>  In March 2014, the criminal group switched to using the new distribution vector Potao.  They began to use the so-called.  ‚ÄúLanding page‚Äù for installing a malicious program.  The webpage was called MNTExpress.  We believe that the design of this website was taken from the website of the Russian postal service Pony Express. <br><br><img src="https://habrastorage.org/files/7bc/0b7/154/7bc0b71546cf4065a84d0e2e7c30d8ea.png"><br>  Fig.  10. The appearance of the web page delivery service Pony Express. <br><br><img src="https://habrastorage.org/files/12d/f43/85a/12df4385a31d40b1bc99662cffcc5932.png"><br>  Fig.  11. The appearance of the web page MNTExpress. <br><br>  Disguising a phishing email as a mail service notification is a very common method for malicious users to spread malware.  Instructions for downloading a malicious program may be located in the body of the message.  However, the Potao cyber group takes a different approach.  Alleged victims received SMS messages that contained a link to a web page with malware.  The victim was also sent a special tracking code (tracking code), as well as the name of the recipient.  This method is also another indicator of cyber attack, since, firstly, the attackers had to conduct reconnaissance and get the full name of the victim, as well as her phone number.  Secondly, in order to receive the malware file, the victim needed to enter the code sent to her in an SMS message. <br><br><img src="https://habrastorage.org/files/1da/2c9/430/1da2c9430ec74e409cc8126f0216c8f9.png"><br>  Fig.  12. SMS sent by hackers. <br><br><img src="https://habrastorage.org/files/f57/97b/e62/f5797be62867475c802c446188e182c7.png"><br>  Fig.  13. One of the recipients of SMS messages from attackers is trying to get information about him in the <a href="http://vk.com/wall-2785866_1134398">public group of the</a> social network vkontakte. <br><br>  A similar malware distribution scenario was used by attackers as early as March 2015. This time, the attackers registered the domain WorldAirPost.com, and the design for the website was taken from the Singapore postal service.  They simply replaced the Singapore Post logo with Italy Post. <br><br><img src="https://habrastorage.org/files/193/52e/ec4/19352eec49b94ed3a78825de4ddf0eb2.png"><br>  Fig.  14. Appearance of a legitimate Singapore Post website. <br><br><img src="https://habrastorage.org/files/f6b/3b9/089/f6b3b908950543cd9a1e2f26cb895f45.png"><br>  Fig.  15. The appearance of the fake WorldAirPost.com website. <br><br>  At the time of our analysis, the attackers were still active, registering another WorldAirPost.net domain in June 2015. It should be noted that MNTExpress supported two languages, Russian and English, and WorldAirPost only English.  When using this website, the attackers resorted to disguising drops as an MS Excel document, not Word. <br><br>  In addition, instead of displaying a decoy-document (bait), the dropper shows the user a special system message (Fig. 16). <br><br><img src="https://habrastorage.org/files/e83/f6c/4aa/e83f6c4aa22e411d9c85342883fefd6b.png"><br>  Fig.  16. The system message displayed by the dropper to the user when launched in the system. <br><br>  Since March 2015, our anti-virus laboratory has detected malicious Potao files on the computers of Ukrainian military and government organizations, as well as on computers of one of the largest Ukrainian news agencies.  Distributed droppers were disguised as MS Word documents and meaningful file names were assigned to them. <br><br><img src="https://habrastorage.org/files/43a/ea8/879/43aea8879d0542d6a25ee12b451f2619.png"><br>  Figure 17. File names of droppers that were used in cyber attacks on high-level institutions in Ukraine. <br><br>  It is seen that the file names indicate their focus on the military and government institutions of Ukraine.  The decopper-document of the droppers apparently was damaged (Fig. 18). <br><br><img src="https://habrastorage.org/files/471/953/61a/47195361aca84644a78f71c60de8c183.png"><br>  Fig.  18. Appearance of the decoy-document, which was used in Potao droppers from March 5, 2015 <br><br>  <b>TrueCrypt encryption application compromise</b> <br><br>  In the process of monitoring the Potao botnet, we detected computer infections that were originally performed by other malware using suspicious websites. <br><br>  We found that Win32 / Potao was installed on the system using an executable file called TrueCrypt.exe.  At first glance, this was not surprising, since attackers often assign special trusted names to malicious files.  However, in this case, the situation was different, since the compromised version of legitimate encryption software called <a href="https://en.wikipedia.org/wiki/TrueCrypt">TrueCrypt</a> acted as the Potao dropper (downloader) dropper.  Further investigation revealed that such a modification of TrueCrypt was distributed through the website truecryptrussia.ru.  Moreover, we were able to establish the fact that the attackers used this domain name as one of the addresses of the managing C &amp; C server.  This fact leads us to the idea that this site is not legitimate, but was originally conceived by the owners to carry out malicious operations.  Thus, the website itself and the software called ‚ÄúTrueCrypt Russia‚Äù were used to perform the following malicious functions. <br><br><ol><li>  Hosting malware modification software for encrypting TrueCrypt. </li><li>  As a consequence of the first point, hosting Win32 / Potao malware. </li><li>  The website address was used as a C &amp; C server manager for Win32 / FakeTC. </li></ol><br>  It should be noted that not every visitor to the above website will download the malicious modification TrueCrypt.  The mechanism for downloading a malicious copy is organized on a selective basis.  This is further evidence of the targeting of a cyber attack using Potao. <br><br><img src="https://habrastorage.org/files/7fe/5d5/eab/7fe5d5eab02c43b9a0eec29fad55dc11.png"><br>  Fig.  19. Web page TrueCrypt Russia. <br><br>  According to our statistics from ESET LiveGrid, this website has distributed a malicious version of the TrueCrypt software since at least June 2012. In this case, the timestamps of the malware files are from April 2012. <br><br>  <b>Georgian Cyber ‚Äã‚ÄãCampaign</b> <br><br>  In confirmation of the fact that the attackers behind Potao were very active even at the time of writing this study, one of the malicious program droppers with a compilation date of July 20, 2015 can be cited. Dropper was used to compromise users in Georgia.  This time the decoy document was a PDF file. <br><br><img src="https://habrastorage.org/files/805/0c0/ed5/8050c0ed58714aac938a3682a09959fc.png"><br>  Fig.  20. An example of a decoy-document from the ‚ÄúGeorgian dropper‚Äù. </div><p>Source: <a href="https://habr.com/ru/post/263855/">https://habr.com/ru/post/263855/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../263841/index.html">Google Chrome for Windows switched to using the AppContainer sandbox</a></li>
<li><a href="../263843/index.html">Acceleration of image processing in Android</a></li>
<li><a href="../263845/index.html">Hacker projects on Kickstarter</a></li>
<li><a href="../263849/index.html">Sphinx distribute. Accelerate the search</a></li>
<li><a href="../263853/index.html">Magic of tensor algebra: Part 15 - Motion of a non-free solid</a></li>
<li><a href="../263859/index.html">Automating the ip-network using the tools at hand (Python)</a></li>
<li><a href="../263861/index.html">Alarm, ahtung, attention, whistle all the server</a></li>
<li><a href="../263863/index.html">How to find a place on earth and not get to the Yandex counter</a></li>
<li><a href="../263865/index.html">5G radio interface</a></li>
<li><a href="../263869/index.html">Twisted architecture</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>