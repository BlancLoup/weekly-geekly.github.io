<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Qadars - a new banking Trojan with the ability to bypass two-factor authentication</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We recently discovered a new banking malware that was added to our databases as Win32 / Qadars . The first public coverage of this threat was made by ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Qadars - a new banking Trojan with the ability to bypass two-factor authentication</h1><div class="post__text post__text-html js-mediator-article">  We recently discovered a new banking malware that was added to our databases as <a href="http://www.virusradar.com/en/Win32_Qadars/detail">Win32 / Qadars</a> .  The first public coverage of this threat <a href="http://www.lexsi-leblog.com/cert-en/qadars-new-banking-malware-with-fraudulent-mobile-application-component.html">was made</a> by LEXSI.  Qadars has been quite active lately, infecting users around the world.  Like other banking malware, it steals online banking data and user funds through a web injection mechanism.  Our researchers have found that Qadars uses a wide range of such web injections for various tasks of working with an online banking system. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0ef/fef/527/0effef5272e21fa77863184c2998c2e2.jpg"><br><br>  Earlier we wrote about the banking trojan <a href="http://habrahabr.ru/company/eset/blog/205700/">Hesperbot</a> , which contains a special component for mobile platforms.  This component allows you to bypass the two-factor authentication mechanism based on the confirmation codes of the mTAN banking operation.  Qadars uses an approach similar to Hesperbot to install a mobile component via a web injection on a special message online banking page.  The difference between the two is that Qadars uses the existing <b>Android / Perkele</b> mobile malware code, and does not rely on its own. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>  Usually for banking Trojans, the rule is either they are focused on a large number of financial institutions and banks, or attackers focus on certain banks by geography, that is, by their actual location.  Win32 / Qadars belongs to the second category, attackers target it to users of a particular region or regions, and also use web-injection configuration files linked to the banks that are most in demand in this region.  Below are the six main countries that have suffered from Qadars activities. <br><br>  - Holland <br>  - France <br>  - Canada <br>  - India <br>  - Australia <br>  - Italy <br><br>  We observed several waves of Qadars propagation by intruders in these countries, and in Holland such a process was especially intensive, the activity of the intruders was tracked there by us for the entire monitoring period.  The following features of this banking trojan should be noted. <br><br><ul><li>  Six months after its discovery, it is still very active. </li><li>  Sent only to certain countries. </li><li>  It uses a wide range of web injections, some of which have been used by other family of banking Trojans in other malicious campaigns. </li><li>  Uses the <a href="http://www.virusradar.com/en/Android_Perkele/detail">Android / Perkele</a> malicious code to bypass the two-factor authentication system based on mTAN codes (mobile devices). </li></ul><br>  The first detection of this malware was recorded in mid-May 2013.  The following graph shows the number of Win32 / Qadars detections by day. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/161/fd1/b4e/161fd1b4e967bbe011dc4837e8bf3949.png"><br><br>  Although Qadars was observed back in May, the first real wave of infection spread occurred at the end of June.  Apparently, the authors tested their malicious tool, since we found several intermediate versions of it.  In the first wave of the spread of malicious code, the attackers focused on the users of Italy, and in subsequent waves on the Dutch users. <br><br>  We can trace the evolution of this malicious tool through its version, which is listed in the executable file.  The first version had the number 1.0.0.0, and the last 1.0.2.7.  Constant releases of new versions point to the active development of this malicious code by hackers.  The following graph shows the date of the first discovery of each version. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c87/08b/ed7/c8708bed7540ddab604dfc921d8494f0.png"><br><br>  Win32 / Qadars uses the well-known <a href="http://en.wikipedia.org/wiki/Man-in-the-browser">Man-in-the-Browser</a> (MitB) mechanism to perform financial fraud.  Similar to Win32 / Spy.Zbot (Zeus), this malicious code is injected into the browser process and intercepts the necessary API calls.  Using these hooks, he is able to inject malicious content into web pages that the user views.  In fact, this content can be anything, but usually is a web form that is used by attackers to collect confidential online banking data.  Alternatively, this malicious content could be javascript, which attempts to automatically transfer money without the knowledge or consent of the user. <br><br>  Web injection configuration files are downloaded from the C &amp; C server manager and contain the URLs of the banks' web pages, the content to be embedded in these pages, and the intended place of implementation on the page.  This configuration file format is very similar to the files of other banking Trojans.  After the file is downloaded from the management server, it is stored in encrypted form (AES) in one of the registry keys.  Currently, Qadars is capable of intercepting in two browsers: Firefox and Internet Explorer.  The malware‚Äôs code also contains a stub for Google Chrome, so that in the future we can see the corresponding hooks for this browser as well. <br><br>  Once the malicious code is installed on the computer, the botnet operator can send him various commands, which are listed in the table below. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c09/aa3/75d/c09aa375d47e6cda74219c3f20297dda.png"><br><br>  In version 1.0.2.7, an add-on appeared, which is the theft module of the user's FTP account credentials.  It supports an extensive set of FTP clients and attempts to open their configuration files, as well as steal user account data.  Interestingly, to steal user credentials, Qadars uses some well-known static passwords that FTP clients use by default to encrypt their configuration file.  Another malicious code <a href="http://www.virusradar.com/en/Win32_PSW.Fareit/detail">Win32 / PSW.Fareit</a> ( <a href="http://www.welivesecurity.com/2013/07/02/the-home-campaign-overstaying-its-welcome/">Pony Loader</a> ) has this feature. <br><br>  To encrypt data during network communication, Win32 / Qadars uses <a href="http://en.wikipedia.org/wiki/Advanced_Encryption_Standard">AES</a> in <a href="http://en.wikipedia.org/wiki/Block_cipher_modes_of_operation">ECB mode</a> .  Before sending the message, the client generates a random string of nine characters, then it will use the MD5 of this string as the AES key.  This key will also be used by the server to encrypt the response message.  For the secure transmission of the AES key, which is used in encryption operations, the client also encrypts it and then appends it to the end of the message.  After that, the entire generated message is encrypted using base64 and sent to the server.  The figure below shows this process with the corresponding message fields that are sent to the server. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/925/40e/54a/92540e54a4a2051aaa018d3ec55e37e0.png"><br>  Fig.  Network interaction between client and server. <br><br>  The server's response is encrypted using the key that the client sent to him in the message.  To ensure integrity, the client also adds MD5 messages.  The figure below shows the structure of the server response. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/666/72b/510/66672b510597f2d7f40e105b1f9848bd.png"><br>  Fig.  The format of the server message. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/34f/473/4a3/34f4734a3adfa3c39e94e8b8c8d8b731.png"><br><br>  Knowledge of the format of the network protocol used by Win32 / Qadars greatly facilitated our work in tracking the botnet and studying its behavior. <br><br>  The Win32 / Qadars configuration file, which contains web injections, changes quite often and is aimed at certain financial institutions.  To increase the impact of these web injections, malware authors try to infect users in specific regions or countries.  It was not entirely clear what method the attackers chose to spread Qadars from May to October.  Using some data from our telemetry system, we found out that they acquired special compromised hosts in the countries for which they were going to distribute this malware.  Our specialists came to this conclusion because the compromised computers that they observed contained daunloaders and other Pay-per-install (PPI) malicious code, for example, the Win32 / Virut file virus. <br><br>  Starting in November, attackers began distributing Win32 / Qadars using the Nuclear Exploit Kit.  Below are a few URLs that were used for its distribution in early November, they clearly show the pattern that is specific to Nuclear EK. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d01/65d/f8c/d0165df8cb62e8bd8db228c3a6b4b463.png"><br><br>  Both of these methods of distributing malicious code allow botnet operators to select the region where potential victims are located. <br><br>  As we mentioned, the attackers chose six countries to compromise their users with the Qadars malicious code, namely Holland, France, Canada, Australia, India and Italy.  The graph below shows the geographical distribution of Qadars infections from May to November 2013. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0d5/678/876/0d5678876efc96731d0a9245d2d8d5c8.png"><br>  Fig.  The geography of distribution Qadars. <br><br>  As can be seen, the largest number of infections is present in the Netherlands (75%), and in second place is France. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f54/f70/65a/f54f7065acaec2a19ec8b15e7481ff7a.png"><br>  Fig.  Detected Qadars infections by day and their distribution by country. <br><br>  It is an interesting case of a compromise by attackers of Canadian users, which was recorded during the last 15 days of October.  This is confirmed by the bot configuration files we found that contained web injections targeting Canadian banks. <br><br>  Web injections in the case of banking institutions in other countries have varying degrees of complexity.  Some of them collect additional information whenever a user tries to access a secure online banking site.  To do this, the user is presented with an additional web form that requests the information necessary to the attackers when he logs in to his online banking account.  An example of such a form is presented below. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/501/c80/09a/501c8009a25fe51ce1a824451c4b5483.png"><br><br>  Other web injections that are in the arsenal of malicious code can automatically perform banking operations and contain methods for circumventing two-factor authentication. <br><br>  These web injections, which we have repeatedly mentioned, can be obtained by malicious code in various ways.  Some of them are delivered as part of the malicious code itself, or can be purchased by hackers.  On underground forums, there are various offers for distributing similar web-injections to customers.  The price in this case varies from the <a href="http://www.trusteer.com/blog/la-carte-criminals-charging-feature-custom-webinjects">wishes of the customer</a> and the necessary opportunities.  When analyzing Win32 / Qadars, we saw that these web injections were developed by different people, since their writing styles differed in different cases.  Obviously, many of them were acquired in underground forums, since this form of distribution of malicious content is preferred by cybercriminals.  One of the injects uses a characteristic template for extracting external content: scripts and images.  The URL pattern in this case will look like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dc3/757/575/dc37575753cd3ff1311259915a70be52.png"><br><br>  The data of the part of the URL that is the value of the ‚Äúdata‚Äù parameter is encoded using base64.  When decrypted in this case, we get the parameter ‚Äúproject = mob-ingnl-fand &amp; action = file &amp; id = css‚Äù, which gives more information about the attackers' targets.  Interestingly, we saw a similar injection address pattern in a campaign against Czech banks, using <a href="http://www.virusradar.com/en/Win32_Yebot/detail">Win32 / Yebot</a> (aka Tilon). <br><br>  In the case of Qadars, attackers resort to the services of the so-called <a href="http://www.trendmicro.com/cloud-content/us/pdfs/security-intelligence/white-papers/wp_automating_online_banking_fraud.pdf">ATS</a> (Automatic Transfer System) system.  This term refers to web injections that use the automatic execution of the transaction required by these attackers on the victim‚Äôs bank account when the latter gains access to it.  The code of such an inject may be more complicated and it will perform additional functions, for example, it will select a bank account with the most funds to withdraw a certain amount from there.  Under the withdrawal of funds means its transfer to the bank account of a mule (individual. Person to whose account funds are transferred during a fraudulent operation) or an intruder.  The injection code may also contain additional mechanisms to bypass the two-factor authentication system, which banks use to protect the transactions of their users. <br><br>  We found several cybercriminals who sell ATS systems targeting some banks around the world.  For such underground forums, there are notions of ‚Äúpublic‚Äù web injections, which are sold to everyone and ‚Äúprivate‚Äù, which are additionally customized for the customer, and each customer receives his own copy of the code.  Thus, in a private distribution scheme, the buyer receives the source code of the injection with the right to distribute it.  During the analysis, it was found that the authors of Qadars bought web injections, we observed a public ATS, which was registered in the configuration file.  An attacker who spreads this public injection, in addition to it, attaches an administrative panel that allows Qadars operators to control the settings for the automatic transfer. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5a8/6ab/d45/5a86abd45e9b1236ad45d89b7dbca5c1.png"><br><br>  The highlighted line characterizes the direction of the injection to the French bank and the attacker claims that he can bypass two-factor authentication based on SMS messages. <br><br>  <b>Mobile component</b> <br><br>  Some ATS systems that we were able to analyze were designed so that the malicious code could intercept the SMS message with the operation confirmation code before it was sent by the online banking system.  This message contains the mTAN code confirming the ongoing banking operation.  The user then enters this code in the web-browser form of the online banking site.  As we know, the use of a mobile component by malware is not new.  Hesperbot and <b>Zeus-in-the-mobile</b> (ZitMo) can be cited as such examples.  It is interesting that the attackers who are involved in the dissemination of web injections, began to use for them the possibility of malicious code for mobile devices.  Thus, attackers who use malicious code to install it on a user's computer can acquire similar opportunities in the market as a service, along with an administrative panel and mobile malware for specific banks. <br><br>  In the case of Win32 / Qadars, the mobile component is the malicious code Android / Perkele and comes bundled with web injections that are used to install it.  Perkele is able to intercept SMS messages on the user's device and redirect them to attackers.  This malicious mobile tool was described by Brian Krebs on <a href="http://krebsonsecurity.com/2013/08/a-closer-look-perkele-android-malware-kit/">krebsonsecurity</a> .  Using web injection, Perkele is installed on a user's mobile device as follows: when a user enters his online banking account, a special malicious code that is already embedded in the web page requests installation of a special mobile application for a specific phone model (choice of platform for installation).  This mobile application allegedly belongs to the bank with which the user works. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/aef/77d/bf5/aef77dbf52cf4e67049d12d86a37f900.png"><br>  Fig.  Interface version of Android / Perkele, which is aimed at the French banks. <br><br>  The malicious code Android / Perkele exists in modifications for various platforms, including, Android, Blackberry, Symbian.  In the case of Win32 / Qadars, we observed only the Android version.  After the malware is installed, the mTAN bank transaction confirmation codes will be redirected to the number of the attackers, and the user will not see them.  It is worth noting that the latest version of Android called KitKat contains <a href="http://www.cert.pl/news/7741/langswitch_lang/en">additional restrictions</a> on hiding incoming SMS, so Perkele will not be able to do it in stealth mode. <br><br>  <b>Conclusion</b> <br><br>  Recently, we have seen an increase in the number of banking Trojans and the emergence of new families, among which, <a href="http://habrahabr.ru/company/eset/blog/196086/">Win32 / Napolar</a> , <a href="http://habrahabr.ru/company/eset/blog/205700/">Win32 / Hesperbot</a> , Win32 / Qadars.  This is probably due to the leakage of texts of such well-known banking Trojans as Zeus and <a href="http://habrahabr.ru/company/eset/blog/184576/">Carberp</a> , which allowed attackers to better understand the operation of these malicious tools.  Another interesting feature is the use of special tools for automating web injections, as is the case with ATS (injection as a service).  This service allows attackers who distribute malware to perform more complex manipulations on the infected system, including bypassing two-factor authentication. <br><br>  <b>SHA1 hashes</b> <br>  Win32 / Qadars (Nuclear Pack): F31BF806920C97D9CA8418C9893052754DF2EB4D <br>  Win32 / Qadars (1.0.2.3): DAC7065529E59AE6FC366E23C470435B0FA6EBBE <br>  Android / Perkele: B2C70CA7112D3FD3E0A88D2D38647318D68f836F </div><p>Source: <a href="https://habr.com/ru/post/207216/">https://habr.com/ru/post/207216/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../207200/index.html">Do not postpone acquisitions in foreign online stores</a></li>
<li><a href="../207202/index.html">Yandex.Maps change API. Why we needed to break backward compatibility in a clusterer</a></li>
<li><a href="../207208/index.html">I2P proxy on hosting</a></li>
<li><a href="../207210/index.html">Dell VRTX: First Steps</a></li>
<li><a href="../207214/index.html">Implementation of the I2C interface based on the FT2232H chip (MPSSE mode)</a></li>
<li><a href="../207220/index.html">December distribution of servers: voting</a></li>
<li><a href="../207224/index.html">Is it possible to centrally manage language settings?</a></li>
<li><a href="../207228/index.html">How to raise the average check?</a></li>
<li><a href="../207230/index.html">Android 4.3 for Z series devices</a></li>
<li><a href="../207232/index.html">Cards for all, for nothing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>