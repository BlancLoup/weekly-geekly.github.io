<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Championship #PGHACK. Platform</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Already this Saturday in the Moscow office Avito will be held the championship in PostgreSQL. This is a database management competition with practical...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Championship #PGHACK. Platform</h1><div class="post__text post__text-html js-mediator-article"><p>  Already this Saturday in the Moscow office Avito will be held the championship in PostgreSQL.  This is a database management competition with practical tasks.  We implemented it on a platform fully assembled from open-source components.  We tested it already at two domestic competitions (it turned out interesting), and now we are preparing to hold #PGHACK for all postgreses who wish (we still accept applications for participation, a link at the end of the text).  In this post I will talk about how we prepared the platform for the championship. </p><br><p><img src="https://habrastorage.org/web/535/0b3/04e/5350b304e44743bda9b011dd88afc654.jpg"></p><a name="habracut"></a><br><h2 id="korotko-ob-igre">  Briefly about the game </h2><br><p>  I talked in detail about the game in <a href="https://habrahabr.ru/company/avito/blog/334886/">this post</a> .  In short, it's like CTF, just about Postgres. </p><br><h2 id="kak-eto-rabotaet">  How it works? </h2><br><p>  The platform is assembled from open-source components proven by time.  I collected and debugged all this myself, except for the OpenVPN setup.  I'll tell you about the components in more detail. </p><br><p><img src="https://habrastorage.org/web/e7a/33e/9e4/e7a33e9e438347c49ab0e9341dbdffcc.jpeg"></p><br><h3 id="igrovaya-set-vpn">  VPN game network </h3><br><p>  To build a gaming network, Open VPN is used - a fairly standard solution for such tasks.  No additional software is required on players' laptops, since they will connect to the network from virtual machines with a pre-installed VPN.  The key to the game network (and all the following tasks) participants will take in the task tracker.  Task execution checker checker. </p><br><h3 id="task-treker">  Task tracker </h3><br><p>  The user is authorized in the game with the login and password given to him, after that he sees his unique VPN key to configure the virtual machine and the tracker with the list of tasks that he will need to solve.  During the championship will turn on the leaderboard, where you can watch the change in the number of points from other participants. </p><br><h3 id="cheker">  Checker </h3><br><p>  Checker walks through the players' virtual machines and checks the results - in principle, the same way as on CTF.  Under the hood, he has a Fabric, which was originally designed for parallel execution of tasks on multiple servers / computers.  We did not make a new component: Fabric provides the most honest and truly parallel verification process - this is in his blood. </p><br><h3 id="virtualnye-mashiny">  Virtual machines </h3><br><p>  On the virtual machines that connect to the VPN, a database and application are installed.  They solve problems.  Virtual machines are automatically assembled using HashiCorp Packer.  The process is also automatic.  Ansible is used for this, so the virtual can be rebuilt any number of times.  The correctness of this decision was confirmed by the preparation process - we completely excluded routine operations and tried to minimize changes and refinements. </p><br><h3 id="podgotovka-zadaniy">  Preparation of tasks </h3><br><p>  Some of the tasks were invented immediately, some changed during the discussion and test runs.  We entered a label in Confluence to which we could add our task and describe its solution.  It was important to come up with tasks with unambiguous solutions.  The check should be quick, simple and automatic: otherwise, in parallel, checking 50-60 participants (the system was calculated for such a number of players) would be problematic.  Some tasks even simplified.  In some cases, they rejected rare decisions in favor of standard working methods. </p><br><p>  Initially, we planned that we would lay down the time as much as the normal fair CTF ‚Äî about 8 hours.  But they realized that this is quite a lot.  As a result, #PGHACK will last about 4 hours, not counting the time to set up the environment.  As practice has shown, the postgres-grandmaster can solve all problems in 2 hours. </p><br><h3 id="podgotovka-igrovogo-prilozheniya">  Preparing a game application </h3><br><p>  The first version of the mini-Avito site was made during the New Year holidays on Flask.  It has nothing to do with the technologies that are used on a real site, but trying to be like it - this is also a bulletin board. </p><br><p><img src="https://habrastorage.org/web/4b7/81c/41c/4b781c41c2ba4449901cbb4cfa84269e.png"></p><br><p>  In the process of work, the ORM was completely cut out from the application, and it began to call database functions.  We took the game dataset from our fellow analysts who held their competition a couple of months ago.  These are ‚Äúlive‚Äù ads with completely disguised personal data.  It weighs about 4 GB, so we can not perform large complex queries on virtual machines.  Checks for solving problems are made easy and fast. </p><br><h2 id="dopuschennye-oshibki">  Mistakes made </h2><br><p>  At the first stage of preparation, we planned to be in trend: to assemble a platform from microservices in different languages ‚Äã‚Äã- Go, Python, PHP.  But we refused this: it would have been difficult for the participants to sort out a large number of incomprehensible microservices, and the game would not have turned into a Postgres fix, but into picking up microservices - who goes where, what he does. </p><br><p>  There was another trend idea - to use Docker.  Refused, because  understood that most DBAs are not ready for its use: they work with other systems and in other planes.  Came to the classic virtualka, as in most CTF. </p><br><p>  At the battle, they found out that the checker should be a server.  Initially, he went through SSH to a gaming virtual machine and executed commands on its side.  In the first test game, we found out that those of our guys who had a good knowledge base on Linux, caught these commands and could have tricked the checker.  Therefore, it became a server, and most of the checks were transferred there. </p><br><h2 id="spisok-open-source-komponentov-platformy-pghack">  List of open-source components of the platform PGHACK </h2><br><p>  <a href="https://www.packer.io/">Packer</a> <br>  <a href="https://www.ansible.com/">Ansible</a> <br>  <a href="https://www.virtualbox.org/">Virtualbox</a> <br>  <a href="https://openvpn.net/">Openvpn</a> <br>  <a href="http://www.fabfile.org/">Fabric</a> <br>  <a href="http://flask.pocoo.org/">Flask</a> </p><br><p>  And, of course, <a href="https://www.postgresql.org/">PostgreSQL</a> ! </p><br><h2 id="chto-potom">  What then </h2><br><p>  We do not plan to stop only on holding one #PGHACK championship.  I want this to be a regular event for the postgres community.  Therefore, a detailed analysis of the tasks will not be. </p><br><p>  After the event, a photo report will appear on <a href="http://bit.ly/fbavitotech">our page in FB</a> .  By the way, registration for the championship is still open: <a href="http://bit.ly/2vlq6W1">fill out an application</a> until the evening of August 31 and participate in #PGHACK! </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/336246/">https://habr.com/ru/post/336246/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../336232/index.html">Reverse engineering malicious fraud script</a></li>
<li><a href="../336234/index.html">With the wind! How we introduced contactless payment of trips to the subway</a></li>
<li><a href="../336236/index.html">Fill in "Agreements, taxes and banking information" in iTunes connect for Russian LLC</a></li>
<li><a href="../336240/index.html">Welcome to South DevFest 2017</a></li>
<li><a href="../336242/index.html">Turn off Intel ME 11 using undocumented mode</a></li>
<li><a href="../336248/index.html">Four types of programmers</a></li>
<li><a href="../336250/index.html">How to work with designers</a></li>
<li><a href="../336252/index.html">Comparative load testing of Lua-connectors for Tarantool from NGINX</a></li>
<li><a href="../336254/index.html">Features of the development of mobile MMO RTS. Part 6</a></li>
<li><a href="../336256/index.html">Russian girls in Data Science. Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>