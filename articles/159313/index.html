<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>JavaScript pitfalls</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I really like JavaScript and I find it powerful and convenient. But for most novice JS programmers, many problems create a misunderstanding of aspects...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>JavaScript pitfalls</h1><div class="post__text post__text-html js-mediator-article">  I really like JavaScript and I find it powerful and convenient.  But for most novice JS programmers, many problems create a misunderstanding of aspects of the language.  Often, language constructs behave "illogically."  In this article I want to give examples of "rakes" that I stepped on;  explain the behavior of the language and give a couple of tips. <br><br><a name="habracut"></a><br><br><h2>  Types </h2><br>  As written in <a href="http://ecma-international.org/ecma-262/5.1/">the ECMAScript specification</a> , there are a total of 6 types: <br><ol><li>  Undefined </li><li>  Null </li><li>  Boolean </li><li>  String </li><li>  Number </li><li>  Object </li></ol><br>  All values ‚Äã‚Äãmust belong to them.  In JS there is a typeof operator, which, as it would seem, should return the type of an object.  It would seem one of the listed.  What actually happens: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-comment"><span class="hljs-comment">//"number", ,    typeof "hello"; //"string" typeof true; //"boolean" typeof undefined; //"undefined" typeof {}; //"object".  5  5 typeof null; //"object". WTF? typeof function(){}; //"function".      function?</span></span></code> </pre> <br>  <b>Problem:</b> although the type is null - Null, the operator returns 'object';  and the type of the function is Object, the operator returns 'function', but there is no such type. <br>  <b>Explanation:</b> typeof returns not a type, but a string that depends on the argument and is not a type name. <br>  <b>Tip:</b> forget the types.  Seriously, I think that knowing the 6 types of JS will not give you any benefit, and the typeof operator is used quite often, so it‚Äôs better to remember the results of its work: <br><table><tbody><tr><td>  Argument type </td><td>  Result </td></tr><tr><td>  Undefined </td><td>  undefined </td></tr><tr><td>  Null </td><td>  object </td></tr><tr><td>  Boolean </td><td>  boolean </td></tr><tr><td>  Number </td><td>  number </td></tr><tr><td>  String </td><td>  string </td></tr><tr><td>  Object (results of the operator new, inline-objects ({key: value})) </td><td>  object </td></tr><tr><td>  Object (functions) </td><td>  function </td></tr></tbody></table><br><br><h2>  Magic Values: undefined, null, NaN </h2><br>  The <a href="http://ecma-international.org/ecma-262/5.1/">specification is</a> described as follows: <br><br><ul><li>  undefined value - the value of the primitive is used </li><li>  Undefined type - type </li><li>  null value - the value of the object value </li><li>  Null type is the null value </li><li>  NaN - number value that is a IEEE 754 ‚ÄúNot-a-Number‚Äù value </li></ul><br><br>  In my head, I keep the following: <br><ul><li>  undefined - the value of a variable that has not been initialized.  Single value of type Undefined. </li><li>  null - an intentionally created ‚Äúempty‚Äù object.  The only value of type null. </li><li>  NaN is a special value of the Number type, for the expression ‚Äúnot numbers‚Äù, ‚Äúuncertainty‚Äù.  It can be obtained, for example, as a result of dividing 0 by 0 (from the course of mathematical analysis, remember that this is uncertainty, and the division of other numbers by 0 is infinity, for which in JS there are Infinity values). </li></ul><br>  With these meanings, I discovered a lot of "magic."  For starters, boolean operations with them: <br><pre> <code class="javascript hljs"> !!<span class="hljs-literal"><span class="hljs-literal">undefined</span></span>; <span class="hljs-comment"><span class="hljs-comment">//false !!NaN; //false !!null; //false // ,  3     boolean  false null == undefined; //true undefined === undefined; //true null === null; //true NaN == undefined; //false NaN == null; //false NaN === NaN; //false! NaN == NaN; //false!</span></span></code> </pre><br>  <b>Problem:</b> whatever we compare NaN, the result of the comparison will always be false. <br>  <b>Explanation:</b> NaN can occur as a result of multiple operations: 0/0, parseInt ('irreducible string'), Math.sqrt (-1) and it would be strange if the root of -1 was 0/0.  That is why NaN! == NaN. <br>  <b>Tip:</b> do not use boolean operators with NaN.  For verification, you must use the isNaN function. <br><br><br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> a; <span class="hljs-comment"><span class="hljs-comment">//'undefined' a; //ReferenceError: a is not defined</span></span></code> </pre><br>  <b>Problem:</b> the typeof operator tells us that the type of an undeclared variable is undefined, but an error occurs when accessing it. <br>  <b>Explanation:</b> in fact, there are 2 concepts - Undefined and Undeclared.  So, an undeclared variable is an Undeclared variable and accessing it causes an error.  The declared but not initialized variable takes on the value undefined and no errors occur when accessing it. <br>  <b>Tip:</b> Before accessing a variable, you must be sure that it is declared.  If you refer to the Undeclared variable, the code following the call will not be executed. <br><br><br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a; <span class="hljs-comment"><span class="hljs-comment">//  ,     ,   undefined console.log(undefined); //undefined console.log(a); // undefined a === undefined; //true undefined = 1; console.log(undefined); //1 a === undefined; //false</span></span></code> </pre><br>  <b>Problem:</b> at any moment we can read and write the value undefined, therefore, someone can overwrite it for us and the comparison with undefined will be incorrect. <br>  <b>Explanation:</b> undefined is not only the undefined value of the Undefined type, but also a global variable, which means that anyone can override it. <br>  <b>Tip:</b> just comparing variables with undefined is a bad tone.  There are 3 options for solving this problem, to create "bulletproof" code. <br><ul><li>  You can compare not the value of a variable, but its type: ‚Äútypeof a === 'undefined'‚Äù. </li><li>  Use the pattern immediately-invoked function: </li></ul><br><pre> <code class="javascript hljs"> (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">window, undefined</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//..     ,   undefined  ¬´¬ª. }(this));</span></span></code> </pre><br><ul><li>  To get a real ‚Äúundefined‚Äù value, you can use the void operator (by the way, I don‚Äôt know of another use for this operator): </li></ul><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>) === <span class="hljs-string"><span class="hljs-string">'undefined'</span></span> <span class="hljs-comment"><span class="hljs-comment">// true</span></span></code> </pre><br><br><br><br>  Now let's try to perform similar actions with null: <br><pre> <code class="javascript hljs"> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-comment"><span class="hljs-comment">//null null = 1; //ReferenceError: Invalid left-hand side in assignment</span></span></code> </pre><br>  <b>Problem:</b> despite some similarities between null and undefined, we cannot overwrite null.  In fact, this is not the problem, but the fact that the language behaves illogically: allows you to overwrite undefined, but does not allow overwriting null. <br>  <b>Explanation:</b> null is not a global variable and you cannot create it, because null is a reserved word. <br>  <b>Tip:</b> there are not so many reserved words in JavaScript, it's easier to <a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Reserved_Words">remember</a> them and not to use them as variable names, than to delve into what the problem is when it comes up. <br><br><br><br>  And now let's do the same with NaN: <br><pre> <code class="javascript hljs"> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-literal"><span class="hljs-literal">NaN</span></span>); <span class="hljs-comment"><span class="hljs-comment">//NaN NaN = 1; console.log(NaN); //NaN isNaN(NaN); //true</span></span></code> </pre><br>  <b>Problem:</b> when redefining undefined everything went well, when redefining null an error occurred, and when redefining NaN, the operation did not cause an error, but the property was not redefined. <br>  <b>Explanation:</b> you need to understand that NaN is a global context variable (the window object).  In addition, you can ‚Äúreach out‚Äù to NaN via Number.NaN.  But it does not matter, none of these properties you can not override, because NaN is not a writable property: <br><pre> <code class="javascript hljs"> <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.getOwnPropertyDescriptor(<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>, <span class="hljs-literal"><span class="hljs-literal">NaN</span></span>).writable; <span class="hljs-comment"><span class="hljs-comment">//false Object.getOwnPropertyDescriptor(Number, NaN).writable; //false</span></span></code> </pre><br>  <b>Tip:</b> as a JS programmer, you need to know about <a href="http://ecma-international.org/ecma-262/5.1/">property attributes</a> : <br><table><tbody><tr><td>  Attribute </td><td>  Type of </td><td>  Meaning </td></tr><tr><td>  enumerable </td><td>  Boolean </td><td>  If true, this property will participate in for-in loops. </td></tr><tr><td>  writable </td><td>  Boolean </td><td>  If false, the value of this property cannot be changed. </td></tr><tr><td>  configurable </td><td>  Boolean </td><td>  If false, then the value of this property cannot be changed, the property attributes can not be deleted or changed. </td></tr><tr><td>  value </td><td>  Any </td><td>  Property value when reading </td></tr><tr><td>  get </td><td>  Object (or Undefined) </td><td>  getter function </td></tr><tr><td>  set </td><td>  Object (or Undefined) </td><td>  setter function </td></tr></tbody></table><br>  You can declare properties that are not deleted or read-only for objects created by you using the Object.defineProperty method: <br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obj = {}; <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.defineProperty(obj, <span class="hljs-string"><span class="hljs-string">'a'</span></span>, {<span class="hljs-attr"><span class="hljs-attr">writable</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">configurable</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-string"><span class="hljs-string">'a'</span></span>}); <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.defineProperty(obj, <span class="hljs-string"><span class="hljs-string">'b'</span></span>, {<span class="hljs-attr"><span class="hljs-attr">writable</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">configurable</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-string"><span class="hljs-string">'b'</span></span>}); <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.defineProperty(obj, <span class="hljs-string"><span class="hljs-string">'c'</span></span>, {<span class="hljs-attr"><span class="hljs-attr">writable</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">configurable</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-string"><span class="hljs-string">'c'</span></span>}); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(obj.a); <span class="hljs-comment"><span class="hljs-comment">//a obj.a = 'b'; console.log(obj.a); //b delete obj.a; //true console.log(obj.b); //b obj.b = 'a'; console.log(obj.b); //b delete obj.b; //true console.log(obj.c); //c obj.b = 'a'; console.log(obj.c); //c delete obj.b; //false</span></span></code> </pre><br><br><h2>  Work with fractional numbers </h2><br>  Let's remember the 3rd grade and add a few decimal fractions.  The results of the addition in mind check in the JS console: <br><pre> <code class="javascript hljs"> <span class="hljs-number"><span class="hljs-number">0.5</span></span> + <span class="hljs-number"><span class="hljs-number">0.5</span></span>; <span class="hljs-comment"><span class="hljs-comment">//1 0.5 + 0.7; //1.2 0.1 + 0.2; //0.30000000000000004; 0.1 + 0.7; //0.7999999999999999; 0.1 + 0.2 - 0.2; //0.10000000000000003</span></span></code> </pre><br>  <b>Problem:</b> when adding some fractional numbers, an arithmetically incorrect result is given. <br>  <b>Explanation:</b> such results are obtained due to the peculiarities of working with floating point numbers.  This is not a JavaScript feature, other languages ‚Äã‚Äãwork as well (I checked in PHP, Python and Ruby). <br>  <b>Tip:</b> First, you, as a programmer, <a href="http://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html">must know</a> about the features of a floating-point computer.  Secondly, in most cases it is enough to simply round the results.  But if you suddenly need to give the user an exact result, for example, when working with money data, you can simply multiply all the arguments by 10 and divide the result back by 10, like this: <br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>, max = <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>.length; i&lt; max; i++ ) { result += <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>[i]*<span class="hljs-number"><span class="hljs-number">10</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result / <span class="hljs-number"><span class="hljs-number">10</span></span>; } sum(<span class="hljs-number"><span class="hljs-number">0.5</span></span>, <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-comment"><span class="hljs-comment">//1 sum(0.5, 0.7); //1.2 sum(0.1, 0.2); //0.3 sum(0.1, 0.7); //0.8 sum(0.1, 0.2, -0.2); //0.1</span></span></code> </pre><br><br><h2>  Conclusion </h2><br>  These are just a few unusual examples with unpredictable results.  If you remember them, it will turn out not to step on the same rake and quickly understand what the problem is.  If you find a new ‚Äúillogical‚Äù piece of code, then try to understand what is happening from the point of view of the language by reading the <a href="http://ecma-international.org/ecma-262/5.1/">specification</a> or <a href="https://developer.mozilla.org/ru/">MDN</a> . </div><p>Source: <a href="https://habr.com/ru/post/159313/">https://habr.com/ru/post/159313/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../159297/index.html">IOS application development Aviasales.ru. Airport selection screen</a></li>
<li><a href="../159299/index.html">Jailbreak for higher education</a></li>
<li><a href="../159303/index.html">The new letter in the Sony alphabet</a></li>
<li><a href="../159307/index.html">Course lectures "Startup". Peter Thiel. Stanford 2012. Session 6</a></li>
<li><a href="../159309/index.html">Git & Github eyewitness</a></li>
<li><a href="../159315/index.html">Behind the scenes - Media Query Mario</a></li>
<li><a href="../159317/index.html">Crazy House on Siemens Logo</a></li>
<li><a href="../159319/index.html">Lexand LT-227: Android budget reader</a></li>
<li><a href="../159321/index.html">David Kolb cycle in life</a></li>
<li><a href="../159323/index.html">Protected USB flash drive for 350 rubles with your own hands</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>