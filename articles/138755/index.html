<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using AOP to debug someone else's library</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The topic of aspect-oriented programming (Aspect-oriented programming, AOP) has already been raised on Habr√©. This paradigm is not so few years old, b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using AOP to debug someone else's library</h1><div class="post__text post__text-html js-mediator-article">  The topic of <a href="http://ru.wikipedia.org/wiki/%25D0%2590%25D1%2581%25D0%25BF%25D0%25B5%25D0%25BA%25D1%2582%25D0%25BD%25D0%25BE-%25D0%25BE%25D1%2580%25D0%25B8%25D0%25B5%25D0%25BD%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">aspect-oriented programming</a> (Aspect-oriented programming, AOP) has already been <a href="http://habrahabr.ru/search/%3Fq%3Daop">raised</a> on Habr√©.  This paradigm is not so few years old, but its use is far from universal.  The comments regularly discusses whether it is needed at all or for what purpose it is still beneficial to use it. <br><br>  In this article I want to describe one of the examples of application - the real situation where the AOP helped me out.  Moreover, I simply do not know an acceptable solution without using aspects. <br><br>  Have you ever encountered a situation where a bunch of your code with a third-party library or framework does not work?  And there is a vague suspicion that you have a mistake somewhere, but it is difficult to find it without a debugger.  And then suddenly it turns out that the library has no source, or for some other reason, debugging is not available ... 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If you are wondering what can be done in such circumstances, welcome under cat. <a name="habracut"></a><br><br><h5>  Problem </h5><br>  Recently, while working on my open-source project, I encountered a similar problem when debugging autocompletion in the IDE based on the Eclipse DLTK (Dynamic Languages ‚Äã‚ÄãToolKit). <br><br>  I tried to use the debugger (all the sources, fortunately, were), but unfortunately, the error that I had to catch was hidden in the middle of the code for working with UI.  And there is such a feature that the autocomplete window automatically closes when the focus is lost, that is, any breakpoints in that code and step-by-step debugging were excluded. <br><br>  What can be done in such cases usually?  You can use the trace.  There are several well-known methods, ranging from debugging output, to full profiling.  A list of these methods with a brief comparison can be found <a href="http://blog.zvikico.com/2007/11/five-ways-for-t.html">here</a> .  In this article, aspect-oriented programming is also mentioned (I would even say that there they were undeservedly credited with one minus). <br><br>  So, a simple debugging output would require recompiling not only DLTK, but the entire JFace;  proxies were not suitable due to the presence of private fields and methods;  and the complete profiling of such a heavy platform as an eclipse is a sad prospect. <br><br>  That's how I came to the need to use AOP. <br><br><h5>  Decision </h5><br>  It all turned out to be simple - I created a single aspect, which describes which calls to intercept, and what information to output to the console. <br><br>  I do not want to describe the installation instructions and syntax basics.  For AspectJ and PostSharp this introduction is already on Habr√©.  In my case, the use of AOP in OSGi environment is a topic for a separate article in a more thematic blog. <br><br>  I will only note that it was possible to connect the aspect without any intervention in the source code of the main project modules or platform libraries.  It wasn‚Äôt even necessary to rebuild them (as stated by the article at the link above), because dynamic interweaving (runtime weaving) was used. <br><br>  Finally, I also want to give a useful example on AspectJ, which in fact was my template for describing interception rules. <br><br>  Trace all calls inside the call to the Foo.bar method: <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> aspect TraceAspect { before() : cflowbelow(execution(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Foo.bar(..))) &amp;&amp; execution(* *.*(..)) &amp;&amp; !within(TraceAspect){ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { System.out.println(thisJoinPoint.getSourceLocation()); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { } } }</code> </pre> <br><br>  Cutting too low-level calls can (and should) be done using cflowbelow negation, but this should already be done separately for each specific case. <br><br>  The filtering capabilities of the required calls from AOP are very <a href="http://www.eclipse.org/aspectj/doc/next/progguide/semantics-pointcuts.html">impressive</a> .  The only thing that confuses me in the above is the need to restart the application for the introduction of additional hooks. <br><br><h5>  findings </h5><br>  Do not be afraid of AOP.  However, tulit it everywhere, without the need, too, is not worth it.  This is a very powerful tool with its scope.  Its use in the context described in the article may seem like a nailing microscope, but in this case it was better than hammering it in with a hand or twisting it with a screwdriver. <br><br>  But now I'm even thinking about how to encapsulate all this power in a small library for non-interactive debugging. <br><br>  Anyway, the method described in the article helped me localize the problem and, I hope, can be useful to you in the future. </div><p>Source: <a href="https://habr.com/ru/post/138755/">https://habr.com/ru/post/138755/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../138750/index.html">ABBYY Airlines - as it were</a></li>
<li><a href="../138751/index.html">Mozilla announces plans for Mozilla Marketplace</a></li>
<li><a href="../138752/index.html">In Australia, the big problems with access to the Internet</a></li>
<li><a href="../138753/index.html">Visual instruction on the use of a mobile phone</a></li>
<li><a href="../138754/index.html">Are you afraid to open the editor?</a></li>
<li><a href="../138757/index.html">Dinosaur PLEO - Internal Structure</a></li>
<li><a href="../138758/index.html">Refrigerator guard</a></li>
<li><a href="../138760/index.html">Ultrabook Dell XPS 13: soon in Russia</a></li>
<li><a href="../138762/index.html">Navigator for free icons</a></li>
<li><a href="../138765/index.html">Features of Tesla Roadster batteries</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>