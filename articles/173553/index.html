<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PHP console commands</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many, as well as mine, periodically have a need to implement some small tasks. For example, parse the site / API and save the data in xml / json / csv...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PHP console commands</h1><div class="post__text post__text-html js-mediator-article">  Many, as well as mine, periodically have a need to implement some small tasks.  For example, parse the site / API and save the data in xml / json / csv, make any calculations / recalculations, overtake the data from one format to another, collect statistics, etc.  etc.  I note that we are talking about tasks not related to current projects. <br><br><img src="https://habrastorage.org/storage2/239/ee7/d4c/239ee7d4cc099eb9346bc92b491a8ab0.jpg"><br><br>  Collecting a heavy framework for the sake of convenient features is too lazy, and it‚Äôs somehow not aesthetically pleasing to implement within the code of current projects.  Therefore, to save your time, you have to create a script, copy pieces of code from previous developments into it, connect various libraries and run the script from the console.  It often requires some interactivity of the script: processing options / arguments, and even interactive interaction.  The main thing here is not to have a mood that is well described by the expression ‚ÄúAppetite comes with eating,‚Äù then it‚Äôs not at all clear what the work on a simple task will lead to =) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      At such times, I recalled a comfortable symphony console, which I managed to get used to working with projects on <br>  Symfony 2. No offense to other consoles (zend, yii, django, ror etc), everything is good, it just happened. <br><br>  When once again it was necessary to parse something, I again remembered the Symfony console ( <a href="http://symfony.com/doc/master/components/console/introduction.html">Console Component</a> ) and the fact that this independent component pushed me more and more to the idea of ‚Äã‚Äãusing its capabilities. <br><br>  For a couple of hours, a simple <a href="https://github.com/suncat2000/console-commands">tool came out</a> , based on: <br><ul><li>  <a href="https://github.com/symfony/Console">symfony / console</a> - the console itself </li><li>  <a href="https://github.com/symfony/Finder">symfony / finder</a> - to search and connect to the application of our commands </li><li>  <a href="https://github.com/suncat2000/symfony-console-extra">suncat / symfony-console-extra</a> - a few buns for this to work </li></ul><br>  and <a href="http://getcomposer.org/">Composer</a> dependency manager, which will help us quickly assemble all of this, add new ones, and also take care of autoloading classes. <br><a name="habracut"></a><br>  Suppose we really needed to compile a list of the latest news, ‚ÄúInternet‚Äù topics.  And as a source, we are quite satisfied with the RSS service Yandex.News. <br><br>  With the help of Somposer, we create a new project: <br><pre><code class="bash hljs">$ composer create-project suncat/console-commands ./cmd</code> </pre> <br>  My Composer is installed <a href="">globally</a> , so it is always available.  If you are not using it yet, then you need to <a href="">install</a> it to check the example. <br><br>  After downloading the application and all dependencies, go to the created directory: <br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> cmd <span class="hljs-comment"><span class="hljs-comment">#  ,         </span></span></code> </pre><br>  The structure is as follows: <br><pre> <code class="bash hljs">app/ console <span class="hljs-comment"><span class="hljs-comment">#  src/ #  psr-0 Command/ #    vendor/ #  </span></span></code> </pre><br>  Check the status: <br><pre> <code class="bash hljs">$ app/console list</code> </pre><br>  If we see reference information and a list of available commands, then everything is ok.  It looks like this: <br><br><img src="https://habrastorage.org/storage2/0b8/4b3/9cd/0b84b39cdf539f246d52fe44842e64e7.jpg"><br><br>  Now we will create a template for the class of the team that we plan to use to implement the task: <br><pre> <code class="bash hljs">$ app/console generate</code> </pre><br>  In the dialog that appears we indicate the name of the future class: <br><pre> <code class="bash hljs">Please enter the name of the <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> class: NewsInternetCommand</code> </pre><br>  In response, we will receive a notification: <br><pre> <code class="bash hljs">Generated new <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> class to <span class="hljs-string"><span class="hljs-string">"./cmd/src/Command/NewsInternetCommand.php"</span></span></code> </pre><br>  Actually everything, the team is ready, it appeared in the list of available commands: <br><br><img src="https://habrastorage.org/storage2/f11/5d9/066/f115d906685b9e1a5c578dbfa555c84f.jpg"><br><br>  But so far it does not do what is necessary (here you can open the created class in the IDE or your favorite editor and write the command code). <br><br>  Since for our example it is necessary to get external content and we like OOP, we will put another library: <br><pre> <code class="bash hljs">$ composer require kriswallsmith/buzz 0.9</code> </pre><br>  <a href="https://github.com/kriswallsmith/Buzz">Buzz</a> is a lightweight HTTP client in PHP5.3.  We will use it to make requests to the news service. <br><br>  Let's create a separate class - YandexRSSNewsParser, which will provide the team with a class of prepared content: <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// ./src/Parser/YandexRSSNewsParser.php namespace Parser; use Buzz\Client\FileGetContents; use Buzz\Message\Request; use Buzz\Message\Response; use DOMDocument; use DOMXPath; class YandexRSSNewsParser { private $method; private $host; /** * Construct */ public function __construct() { $this-&gt;method = 'GET'; $this-&gt;host = 'http://news.yandex.ru'; } /** * Get news * * @param $resource * * @return mixed */ public function getNews($resource) { // content $xml = $this-&gt;getData($resource); if (false === $xml) { return array(); } $doc = new DOMDocument(); @$doc-&gt;loadXML($xml); $xpath = new DOMXpath($doc); // items $items = $xpath-&gt;query('.//item'); $news = array(); foreach ($items as $item) { $news[] = array( 'datetime' =&gt; $xpath-&gt;evaluate("./pubDate", $item)-&gt;item(0)-&gt;nodeValue, 'title' =&gt; $xpath-&gt;evaluate("./title", $item)-&gt;item(0)-&gt;nodeValue ); } return $news; } /** * Get data * * @return mixed */ protected function getData($resource) { $request = new Request($this-&gt;method, $resource, $this-&gt;host); $response = new Response(); $client = new FileGetContents(); // processing get data $attempt = 0; do { if ($attempt) { sleep($attempt); } try { $client-&gt;send($request, $response); } catch (\Exception $e) { continue; } } while (false === ($response instanceof Response) &amp;&amp; ++$attempt &lt; 5); if (false === ($response instanceof Response) || false === $response-&gt;isOk()) { return false; } $data = $response-&gt;getContent(); return $data; } }</span></span></code> </pre><br>  And edit the command class to display the latest news headlines in the console, the Internet heading: <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// ./src/Command/NewsInternetCommand.php namespace Command; use Parser\YandexRSSNewsParser; use Symfony\Component\Console\Command\Command; use Symfony\Component\Console\Input\InputArgument; use Symfony\Component\Console\Input\InputInterface; use Symfony\Component\Console\Input\InputOption; use Symfony\Component\Console\Output\OutputInterface; /** * NewsInternetCommand */ class NewsInternetCommand extends Command { /** * Configuration of command */ protected function configure() { $this -&gt;setName("news:internet") -&gt;setDescription("Command for parsing internet news") ; } /** * Execute command * * @param \Symfony\Component\Console\Input\InputInterface $input * @param \Symfony\Component\Console\Output\OutputInterface $output */ protected function execute(InputInterface $input, OutputInterface $output) { $parser = new YandexRSSNewsParser(); $output-&gt;writeln("&lt;info&gt;Start parsing&lt;/info&gt;\n")); // News $news = $parser-&gt;getNews('/internet.rss'); foreach ($news as $item) { $output-&gt;writeln(sprintf("&lt;info&gt;[%s]&lt;/info&gt; &lt;comment&gt;%s&lt;/comment&gt;", $item['datetime'], $item['title'])); } $output-&gt;writeln("\n&lt;info&gt;Done!&lt;/info&gt;")); } }</span></span></code> </pre><br>  Now execute the prepared command: <br><pre> <code class="bash hljs">$ app/console news:internet</code> </pre><br>  Result: <br><img src="https://habrastorage.org/storage2/274/9fc/954/2749fc95490032c64dd2ed5c6aec089c.jpg"><br><br>  It turned out very simple, but due to symfony / console and composer a flexible and convenient tool for organizing console commands in PHP. </div><p>Source: <a href="https://habr.com/ru/post/173553/">https://habr.com/ru/post/173553/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../173543/index.html">High Performance Conference 4.0 will be held in St. Petersburg on April 2</a></li>
<li><a href="../173545/index.html">With a flick of the wrist, the GeForce GTX 690 turns into a Quadro K5000 or Tesla K10</a></li>
<li><a href="../173547/index.html">HoloEverywhere v1.5</a></li>
<li><a href="../173549/index.html">The generation of "little emperors" confirms stereotypes</a></li>
<li><a href="../173551/index.html">3 Russian finalists for the Windows Phone Next App Star contest</a></li>
<li><a href="../173557/index.html">HTC Butterfly - beauty at your fingertips</a></li>
<li><a href="../173561/index.html">Runetology (190): Peter Kutis, founder of OneTwoTrip.com</a></li>
<li><a href="../173563/index.html">NASA is organizing the second Space Apps Challenge</a></li>
<li><a href="../173567/index.html">Space Retreat from Flurry</a></li>
<li><a href="../173569/index.html">New security measure for Payoneer cards</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>