<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Pi-Sonos: a hobby out of control</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The idea of ‚Äã‚Äãthe design of the new building of the Internet radio station Pi-Sonos was born before the completion of the previous version. Over time,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Pi-Sonos: a hobby out of control</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/py/f0/to/pyf0to8at60eul2epuzf4et1zso.png"><br><br>  The idea of ‚Äã‚Äãthe design of the new building of the Internet radio station Pi-Sonos was born before the completion of the <a href="https://habr.com/post/411085/">previous</a> version.  Over time, she absorbed the accumulated user experience and took into account previously admitted shortcomings.  This time everything is ‚Äúgrown-up‚Äù. <br><a name="habracut"></a><br><h3>  Please love and respect </h3><br>  Let's say goodbye with the name " <i>Pi-Sonos</i> ", and today we will continue to call the column " <b>RadioBox</b> ".  And although this time <a href="https://www.sonos.com/en/shop/play1.html">Sonos Play 1</a> had the greatest impact on the development of the project, the new name, firstly, sounds better, and secondly, reflects its specificity and independence. <br><br><h3>  Motivation </h3><br>  It seems to be the case number 2 was more user-friendly compared with the <a href="https://habr.com/post/406677/">first</a> , but he, too, was not without flaws. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The main and principal were two of them: <br><br><ol><li>  <b>Button "play / pause" on the front end</b> <br>  The button is not the toughest, but nevertheless, when you click on it, the column very often moved from its place. <br></li><li>  <b>Analog Volume Control ("Twist")</b> <br><br>  The volume can be adjusted not only from the smartphone, but also on the speaker itself.  The first method is digital, the second is analog.  Accordingly, intermittently appeared between them.  It was especially frustrating cases when someone twisted the analog volume to 0, and then no matter how much you poked into the smartphone, you could not do it louder, you had to get up anyway and go turn the knob. <br></li></ol><br>  Consequently, it was necessary at least <b><i>to replace the</i></b> analog twist with two numeric volume buttons, and <b><i>move</i></b> all three buttons to the upper end.  By the way, in Sonos Play 1 it is done that way. <br><br>  Here are added two more Wishlist.  The first is the <b><i>smooth flashing of the LED</i></b> in pause mode.  The second is a <b><i>different color of the LED</i></b> during the loading of the column, so that without a smartphone it is clear when the column is ready for use after switching on. <br><br>  And last but not least - I wanted a beautiful case with a minimum number of seams, smooth lines and a stylish design.  I wanted to repeat the aesthetics and conciseness of Sonos. <br><br><h3>  Process </h3><br>  <b>Housing</b> <br><br>  The sketch at the beginning of the article is a real sketch of the future corps.  Phase-inverters are not traced there, but the volume of the case is already calculated for the existing speakers and the places for the speakers and electronic filling are allocated.  Smoothed corners are a real challenge for me.  Whatever one may say, it‚Äôs impossible to glue this from individual walls out of 8mm MDF ( <i>I do not consider other materials for two reasons: 1) the ease of processing this MDF;</i>  <i>2) the absence of other normal materials in stores in my area</i> ).  I had to completely change the approach to the manufacture of the body. <br><br>  This time I had to apply the technology of gluing layers.  It is simple to indecency: we dissect the entire body with horizontal planes with an interval of 8 mm and cut out the resulting projections from MDF.  The mastermind behind technology, as always, is the <a href="https://www.youtube.com/watch%3Fv%3DCK2IdqG-YTE">SoundBlab</a> channel.  The main advantage of this approach is that you can immediately make a lot of cameras of almost any shape (for example, phase shifters are very convenient to do).  But as you know, the devil is in the details. <br><br>  The height of the case with all the ‚Äúcovers‚Äù is 168mm, MDF is 8mm thick, i.e.  need to make 21 layer.  No not like this.  It is necessary: <br><br><ul><li>  sawed MDF panels into 21 blanks; </li><li>  then make 21 parts of a certain size (i.e., milling 63 faces, 3 faces on each part, one face was initially flat, and therefore starting); </li><li>  then cut with a mill with 84 angles according to the template; </li><li>  next - cut about 50 holes of different size and shape; </li><li>  then glue all the parts into a single case; </li><li>  and drill and drill holes for the speakers and ports of the Raspberry Pi; </li><li>  finally, putty, sanding and painting the case and covers; </li><li>  and only then can one calmly proceed to the assembly of the components inside the case and the "finishing" finishing of the column. </li></ul><br>  If there were no problems with the saw (on the miter saw of claim 1, it took about 10 minutes), then some difficulties started.  For those who do not encounter wood processing, I will explain: to make more than 2 <b><i>strictly rectangular</i></b> parts of <b><i>exactly the same</i></b> size and shape using only a milling cutter and a ruler is very difficult. <br><br>  It was possible to make one detail, and then use it as a template (something like <a href="https://www.youtube.com/watch%3Fv%3DqbM6d0ZXvxM">this</a> ), but then (as you can see by example) you can only process 2 faces out of 3x at a time, and then you need to rotate the workpiece, which still threatened to "knock down the sight" and do something crooked. <br><br>  In practice, it turned out to be easier and better to assemble your own small milling table and mill the parts already on it. <br><br><div class="spoiler">  <b class="spoiler_title">A little about the table for those who are curious</b> <div class="spoiler_text">  In the assembly of the milling table is nothing complicated.  The material of the tabletop was the remnants of laminate - it is quite hard and gives a perfectly smooth surface.  For the frame used planed bar 30x30mm.  2 frames, 4 with small stiffeners - <i>et ... voil√†</i> : <br><br><img src="https://habrastorage.org/webt/h3/hv/wi/h3hvwi7dmdujaadrzirkkekp7qy.jpeg"><br><br>  As a guide for milling ideal square aluminum profile 20mm.  In the simplest case, it could simply be fastened to the tabletop with clamps from two sides, but this is not <i>comme il faut</i> .  It is much better to make it moveable along the table along special guides and fixed with wing screws at the ends.  To this end, grooves are milled parallel to the long face at a short distance from the edge.  Since all the lamellae are even, the grooves are absolutely parallel, the aluminum profile moves freely along them.  To strengthen the clamp, you can use the washer under the screw head (below). <br></div></div><br><div class="spoiler">  <b class="spoiler_title">But fotochki process drove</b> <div class="spoiler_text"> Cutting blanks: <br><br><img src="https://habrastorage.org/webt/ic/3a/je/ic3ajeok527safg4pnematjkqbm.jpeg"><br><br>  Milling table in action: milling corners by pattern: <br><br><img src="https://habrastorage.org/webt/xy/gl/ms/xyglmsm867-migedbxnnxrdjzku.jpeg"><br><br>  All items after milling.  Future covers are separate. <br><br><img src="https://habrastorage.org/webt/ek/cx/ia/ekcxiasj32u_e8hfr19z8kyra0g.jpeg"><br><br>  There must be a photo of drunk holes in the layers, but <abbr title="k / f 'Man from Boulevard des Capucines' (1987)">Johnny has already made the installation</abbr> . <br><br>  Column housing before grinding: <br><br><img src="https://habrastorage.org/webt/nz/hy/vs/nzhyvskzswugafsk_dt9bc-kywy.jpeg"><br><br>  At the end, the body was painted black so that the black speakers did not stand out on it with dark spots after being coated with decorative material. <br></div></div><br>  And, actually, this is how it looks in the assembled state: <br><br><img src="https://habrastorage.org/webt/5r/j2/et/5rj2etvyh-4tm9plnms-svr3omc.jpeg"><br><br>  And behind: <br><br><img src="https://habrastorage.org/webt/8g/eh/ls/8gehlsnswli6bgchuzvovgzmmcy.jpeg"><br><br>  The <a href="https://ru.aliexpress.com/item/LEORY-Speaker-Grill-Cloth-Stereo-Gille-Fabric-Speaker-Mesh-Cloth-Color-Brown-Black-Silver-Beige-Stage/32831710938.html">acoustic fabric is</a> glued on the outside, and the white plugs covering its joint and electronics compartment are trimming the 40x25 cable channel.  The top and bottom covers are painted with white enamel from a can of 5 layers (I regret very much that I didn‚Äôt choose acrylic paint - the enamel smelled badly, dried for a long time, and now actively collects dust and prints). <br><br>  <b>Filling</b> <br><br>  The speakers moved to the new building from the old one.  There are no complaints against them.  These are all the same pair of <a href="https://www.aliexpress.com/item/AIYIMA-2Pcs-3Inch-Full-Range-Speakers-4Ohm-15W-Speaker-Subwoofer-Tweeter-HIFI-Music-FM-Radio-Home/32781082274.html">midbass</a> and a pair of <a href="https://www.aliexpress.com/item/AIYIMA-2Pcs-1-5Inch-HIFI-Audio-Portable-Speakers-6ohm-10W-Stereo-Tweeters-Speaker-Silk-Film-Louderspeaker/32810883905.html">tweeters</a> connected to the amplifier through <a href="https://www.aliexpress.com/item/AIYIMA-1Pc-HIFI-A2-Two-Way-Frequency-Divider-Crossover-Filters-Mini-Audio-Portable-Full-Range-Speaker/32835442848.html">crossovers</a> . <br><br>  Now for the amp.  Since we refuse to use the analog ‚Äútwist‚Äù of the <a href="http://www.suptronics.com/xseries/x400.html">Suptronics X400 board</a> , then you can, as an option, just hide it in the bowels of the case.  But the board is large, and because of its size, a couple of problems have appeared that have forced me to look for a replacement for it. <br><br>  Thanks to <a href="https://habr.com/users/igorkkk/" class="user_link">IgorKKK</a> , for making <a href="https://habr.com/users/igorkkk/" class="user_link">me</a> understand Hifiberry products.  Once upon a time I thought that their <a href="https://www.hifiberry.com/products/ampplus/">AMP +</a> is only an audio amplifier that should be hung over their <a href="https://www.hifiberry.com/products/dacplus/">DAC + DAC</a> .  But AMP + is an all-in-one board, and it could well have replaced the X400, only its performance is worse.  But her descendant - <a href="https://www.hifiberry.com/shop/boards/hifiberry-amp2/">AMP2</a> - with all the characteristics of OK.  It is more compact than the X400, and its clamps are moved to a more convenient for mounting side. <br><br><div class="spoiler">  <b class="spoiler_title">For comparison, the sizes of X400 and AMP2 assembled with Raspberry Pi 3</b> <div class="spoiler_text">  Suptronics X400: <br><br><img src="https://habrastorage.org/webt/de/ms/ld/demsldoxhj2i90vjvl7o4gff1-m.png"><br><br>  HIFiberry AMP2: <br><br><img src="https://habrastorage.org/webt/w-/d1/eh/w-d1ehyzpw9acbo4swds1ghygsg.jpeg"><br></div></div><br>  By the way, AMP2 on Aliexpress is not for sale, I ordered it directly from the manufacturer (I highly recommend - an order from Switzerland reached me in just 6 days).  But AMP + is quite a <a href="https://ru.aliexpress.com/item/Raspberry-Pi-HIFI-AMP/32851570316.html">buyable</a> for AE. <br><br><div class="spoiler">  <b class="spoiler_title">Component location inside the case</b> <div class="spoiler_text">  Above - "Malinka", amp and control board: <br><br><img src="https://habrastorage.org/webt/cy/tu/jc/cytujcaobezsapq30yy1_w14-yk.jpeg"><br><br>  Below are the speakers and crossovers: <br><br><img src="https://habrastorage.org/webt/k-/zk/_v/k-zk_vb-0a-fqzczyqktiys9cfw.jpeg"><br></div></div><br>  <b>Controls</b> <br><br>  In the previous version, one small board with a button and an LED controlled the playback control.  Now the board had to be divided.  The first board - with the ‚Äúplay / pause‚Äù, ‚Äúvolume -‚Äù and ‚Äúvolume +‚Äù buttons - is located under the top cover, the second one - which controls the flashing of the LEDs - in the compartment with the ‚Äúraspberry‚Äù. <br><br><div class="spoiler">  <b class="spoiler_title">Circuit board for particularly inquisitive minds</b> <div class="spoiler_text">  Physical boards are divided by a gray line. <br><br><img src="https://habrastorage.org/webt/hu/mi/qu/humiqu_vn8pk-3jgoj4ryfyznsm.jpeg"><br><br>  A few comments on the scheme. <br><br>  On the right, everything is trivial - three buttons with three pairs of protective resistors that protect the input pins from burning out. <br><br>  Left more interesting.  Immediately catches the eye is the inclusion of a blue LED2.  The principle of its work is simple, but not obvious.  It uses the fact that all common GPIO pins by default work as input.  When the power is turned on from the + 3.3V pin, a voltage is applied that drives the current through the limiting resistor R1, the blue LED2 and the pin OUT1 (which is not OUT yet, but IN, therefore you can pass current through it to the input).  When the Raspbian is fully loaded, my daemon starts up, which takes the OUT1 pin to output mode and applies + 3.3V (HIGH) to it.  The potential difference falling on the section "R1-LED2" becomes equal to 0V, and the LED goes out.  So  the column signals full readiness for work. <br><br>  White LED works in three modes: <br><br>  <b>always on</b> - the speaker plays music; <br>  <b>flashes seldom and smoothly</b> - the column in the pause mode; <br>  <b>flashes often and abruptly</b> - a button is pressed. <br><br>  The on and off of the white diode is controlled by the pin OUT2, and the smoothness of the flashing - the pin OUT3.  When flashing is needed, the logical 1 (HIGH, + 3.3V) is fed to the MOSFET pin Q1 of the OUT3 pin, the transistor opens the ‚ÄúR12-C1-Q1‚Äù circuit.  And then when installing pin OUT2 to the HIGH level (+ 3.3V), the current starts charging the capacitor C1 and, as it is charged, the LED1 turns on.  When the OUT2 pin is set to LOW (0V), the capacitor gradually discharges through the LED, gradually reducing its brightness level to 0. It is easy to calculate that the full charge / discharge time of the capacitor is approximately 3 seconds, the best, in my opinion, blinking. <br></div></div><br>  <b>Finally, software and UX</b> <br><br>  The web interface has become more functional, more pleasant, and has learned to load the album cover for the current composition.  All code is still available to anyone on <a href="https://github.com/bellerofonte/radiobox">Github</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Comparison with version 2.0</b> <div class="spoiler_text"><table><tbody><tr><th>  It was </th><th>  It became </th></tr><tr><td><img src="https://habrastorage.org/webt/te/nz/am/tenzamoyba4r-l2y4ypzu3zpt68.jpeg"></td><td><img src="https://habrastorage.org/webt/3q/yy/ob/3qyyobrrg_wu_lhia2_bdwwtvps.jpeg"></td></tr></tbody></table><br></div></div><br>  In the logic of the physical buttons added processing long press: <br><br>  <b>play / pause:</b> short press - start / stop playback;  long press - switch the station to the next one on the list; <br><br>  <b>volume:</b> short press - change volume once;  long press - continuous volume change. <br><br><h3>  Well, what's next? </h3><br>  The photo shows that the building was going in the summer, and he had enough time for running in and refinement.  At the moment, both appearance and sound quality and usability suit both my home and (most importantly) me.  And although so far I see no reason for reworking this body and / or replacing its parts, I don‚Äôt intend to stop there.  The plans include turning this speaker into a voice assistant, as well as manufacturing a mini-column for a nursery based on the Raspberry Pi Zero in a case printed on a 3D printer.  So wait for new articles in the near future! </div><p>Source: <a href="https://habr.com/ru/post/435128/">https://habr.com/ru/post/435128/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../435118/index.html">Save File Me - free client-side backup service</a></li>
<li><a href="../435120/index.html">Lambda functions in SQL ... let me think</a></li>
<li><a href="../435122/index.html">How the flames were implemented in Doom on the Playstation</a></li>
<li><a href="../435124/index.html">Masterpieces of world column design: studio transformer with a variable number of lanes</a></li>
<li><a href="../435126/index.html">Experience in organizing and conducting corporate conferences for analysts</a></li>
<li><a href="../435132/index.html">Nomad: problems and solutions</a></li>
<li><a href="../435134/index.html">Simplify working with databases in Qt using QSqlRelationalTableModel</a></li>
<li><a href="../435136/index.html">Sergey and the scientific method</a></li>
<li><a href="../435138/index.html">How to take control of network infrastructure. Part Three Network security</a></li>
<li><a href="../435142/index.html">Examining Tracing with eBPF: Guide and Examples</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>