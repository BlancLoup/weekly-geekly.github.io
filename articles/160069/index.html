<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>WSUS update approvals: import, export, copy</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Prehistory 
 Until recently, I worked as an enikeyschik in a large Russian company with many offices throughout the country. In my charge were eleven ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>WSUS update approvals: import, export, copy</h1><div class="post__text post__text-html js-mediator-article"><h4>  Prehistory </h4><br>  Until recently, I worked as an enikeyschik in a large Russian company with many offices throughout the country.  In my charge were eleven sites located in different cities of the Far East (this is important).  Each of these offices had its own, unrelated to others, network infrastructure - its own <a href="http://technet.microsoft.com/en-us/library/cc758535(v%3Dws.10).aspx">AD</a> domain, its own subnet, etc. <br><br>  Once, the management set me the task of organizing the process of automatically updating the OS and programs from MS and allowed me to deploy <a href="http://technet.microsoft.com/ru-ru/windowsserver/bb332157.aspx">WSUS</a> at the accountable sites. <br><br><h4>  Problem </h4><br>  After WSUS was deployed, computer mapping policies to WSUS groups were configured, content directories were synchronized with MS servers, etc., the question arose: who will, and, most importantly, how will approve updates? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Imagine: 11 cities, the connection with which is so ‚Äúfast‚Äù and ‚Äústable‚Äù, that rare minutes when ICMP response delays are <i>only</i> 800 ms are perceived as unheard of luck.  And in each it is necessary to conduct testing of all updates before deployment.  At the same time, access to servers on the sites was only via RDP, i.e.  it was necessary to weekly (the order established such a frequency) to connect to the server of each city and manually approve the use of new updates in test groups and, accordingly, transfer the tested updates to commercial operation: <br><img src="https://habrastorage.org/getpro/habr/post_images/53c/3de/574/53c3de57456a4fb8e9b771051a61668d.png" alt="image"><br><br><a name="habracut"></a><br><h4>  Why reinvent the wheel </h4><br>  A reader who has experience working with WSUS will most certainly ask: what is the problem?  Microsoft has foreseen everything: <a href="http://technet.microsoft.com/ru-ru/library/cc708511(v%3Dws.10).aspx">there is a replication mechanism</a> in which the ‚Äúdownstream‚Äù (subordinate) server, called the ‚Äúreplica‚Äù, downloads both the update files themselves and information about which updates have been approved for use in various groups. <br><br>  Indeed it is.  However, in the case under consideration, the use of a regular mechanism did not work, since  it requires a wide enough channel between the root server and its replicas.  I did not have such a channel.  But there was an indication - under no circumstances increase the cost of IT. <br><br><h4>  Idea </h4><br>  ‚ÄúNo, no!‚Äù I thought, and began to figure out how to get out of this situation.  First, each of the WSUS servers somehow had access to either the <a href="http://www.update.microsoft.com/windowsupdate">WindowsUpdate</a> servers from MS, or to the local WSUS servers of the providers, or to the WSUS servers of the neighbors in the office, etc.  Those.  they had, from where to download update files, they only needed to specify which updates to download.  Secondly, I was allowed to use <a href="http://habrahabr.ru/hub/powershell/">Powershell</a> . <br><br>  The idea was simple: you need to implement a mechanism for importing / exporting data on which updates were approved.  According to the old tradition, which was formed at the time of studying at the university, I decided to export to a simple XML file.  The structure of this file is like this: <br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Groups</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--   ,       --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gWSUS_wks_test</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--   (Update) --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Update</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- ,      --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UpdateProduct</span></span></span><span class="hljs-tag">&gt;</span></span>Windows XP<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UpdateProduct</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--  ,   ,    MS --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UpdateKB</span></span></span><span class="hljs-tag">&gt;</span></span>815021<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UpdateKB</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--    --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UpdateDescription</span></span></span><span class="hljs-tag">&gt;</span></span>An identified security vulnerability in Microsoft Windows NT 4.0, Windows 2000, and Windows XP could allow an attacker to take control of the computer. This issue is most likely to affect computers used as web servers. You can help protect your computer from this and other identified issues by installing this update from Microsoft. After you install this item, you may have to restart your computer.<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UpdateDescription</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--    --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UpdateID</span></span></span><span class="hljs-tag">&gt;</span></span>4aed463b-3a3b-4ad8-976e-17baf6434da2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UpdateID</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--     --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UpdateIsDeclined</span></span></span><span class="hljs-tag">&gt;</span></span>False<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UpdateIsDeclined</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--        --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UpdateApprovalIsOptional</span></span></span><span class="hljs-tag">&gt;</span></span>False<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UpdateApprovalIsOptional</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--    (        ) --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UpdateApprovalDeadLine</span></span></span><span class="hljs-tag">&gt;</span></span>12/31/9999 23:59:59<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UpdateApprovalDeadLine</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- ,    (   - ) --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UpdateApprovalAction</span></span></span><span class="hljs-tag">&gt;</span></span>Install<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UpdateApprovalAction</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Update</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gWSUS_wks_test</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Groups</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  The scenario of using this mechanism can be represented as follows: <br><ol><li>  The administrator (or his trusted assistant) on his network approves some updates for use in certain groups, makes sure that everything is fine, and uploads a file with information about which of them should be applied to certain groups of computers, for example, on the internal WEB -site; </li><li>  Enikeyschik on site (I, for example) configures a script that downloads the file generated by the administrator in claim 1 and loads its contents into the local WSUS database; </li><li>  If there are several unrelated WSUS servers in the area of ‚Äã‚Äãresponsibility of enikeyschik - step 2 is performed several times </li></ol><br><br>  What does this give in the end?  First, enikeyshik does not decide which updates to approve and which not - this decision is made by a qualified system administrator who can reasonably predict the effect of each update on the original development <s>curves</s> used in the work, which seem to be strongly tied to specific <s>glitches</s> undocumented features of the OS, SQL server and MS Office. <br><br>  Secondly, enikeyschik cannot be mistaken (forget to approve the necessary update, accidentally approve the unnecessary, etc.) <br><br>  Thirdly, the administrator receives a guarantee that the same updates are approved for installation in all the company's networks (i.e. the question ‚ÄúWhat version of the office is used in Zamkadsk?‚Äù Loses its relevance). <br><br>  In addition to the export of approvals, a mechanism was needed to transfer the upgrades to ‚Äúcombat‚Äù that had been tested in test groups.  It is desirable, with one button / command - ‚Äúto approve everything that is not prohibited and approved for use in the test group‚Äù.  This is necessary in order to exclude non-tested updates from getting into production as a result of the contractor‚Äôs mistake (‚Äúoh, I didn‚Äôt approve it, I didn‚Äôt click it!‚Äù). <br><br><h4>  Implementation </h4><br><h5>  Code </h5><br>  After spending some time looking for a ready-made solution, and not finding one, I went deep into studying the documentation on the <a href="http://msdn.microsoft.com/en-us/library/microsoft.updateservices.administration(v%3DVS.85).aspx">WSUS API</a> , <a href="http://msdn.microsoft.com/ru-ru/library/cc281945(v%3Dsql.105).aspx">Powershell,</a> and <a href="http://msdn.microsoft.com/en-us/vstudio/aa496123.aspx">.NET</a> . <br><br>  First I had to figure out how to get access to the objects that allow you to manipulate the WSUS server.  To do this, download the appropriate assembly: <br><pre> <code class="hljs pgsql">[reflection.assembly]::LoadWithPartialName("Microsoft.UpdateServices.Administration")|<span class="hljs-keyword"><span class="hljs-keyword">out</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">null</span></span></code> </pre> <br><br>  After this, create a function that would return an object representing the WSUS server installed locally: <br><pre> <code class="bash hljs">&lt;<span class="hljs-comment"><span class="hljs-comment"># .SYNOPSIS    -  WSUS .DESCRIPTION      (,    )  WSUS .OUTPUTS   IUpdateServer,    WSUS #&gt; Function Get-WsusServerInstance() { #  $Script:WSUS   "" . $WSUSServer = $Script:WSUS #      WSUS. if ($WSUSServer -eq $null) { $WSUSServer =[Microsoft.UpdateServices.Administration.AdminProxy]::GetUpdateServer(); } Return $WSUSServer }</span></span></code> </pre><br><br>  Since the formulation of the problem involves working with WSUS groups, you need to learn how to get their idea.  I used something like this: <br><pre> <code class="bash hljs">&lt;<span class="hljs-comment"><span class="hljs-comment"># .SYNOPSIS   -   WSUS   . .PARAMETER Name   WSUS,    . .OUTPUTS  IComputerTargetGroup,    WSUS,   . $null -   . #&gt; Function Get-WsusGroupByName([STRING]$Name) { $wsus = $null $wsus = Get-WsusServerInstance $Groups = $wsus.GetComputerTargetGroups() Foreach ($Group in $Groups) { if ($Group.Name -eq $Name) { Return $Group } } Return $null }</span></span></code> </pre><br><br>  Now that we have a mechanism for accessing the WSUS group view, it‚Äôs easy to get a list of updates approved for a given group: <br><pre> <code class="bash hljs">&lt;<span class="hljs-comment"><span class="hljs-comment"># .SYNOPSIS   ,    . .DESCRIPTION   ,  ,    .       (ID)   . .PARAMETER GroupName  ,       .OUTPUTS  .     : objUpdate ()  objApproval ( ) #&gt; Function Get-UpdatesApprovedToGroup([STRING]$GroupName) { #   $ApprovedUpdates = @() # ,   WSUS $wsus = Get-WsusServerInstance #    $Group = Get-WsusGroupByName -Name $GroupName Write-Host "Querying updates info from WSUS server..." #    ,    $WsusUpdates = $wsus.GetUpdates() $TotalWsusUpdates = $WsusUpdates.Count $i = 0 #   ,           foreach ($Update in $WsusUpdates) { $i++ #KBID (    MS)  [STRING]$UpdateKB = $Update.KnowledgebaseArticles Write-Host "Gathering approvals for update. Last porcessed is KB$UpdateKB" #,             . $CurrentApprovals = $update.GetUpdateApprovals($group) #      (, ),   #      . if ($CurrentApprovals.Count -gt 0) { foreach ($Approval in $CurrentApprovals) { # ,      . $Record = New-Object Object Add-Member -InputObject $Record -MemberType NoteProperty -Value $Update -Name "objUpdate" | Out-Null Add-Member -InputObject $Record -MemberType NoteProperty -Value $Approval -Name "objApproval" | Out-Null $ApprovedUpdates = $ApprovedUpdates + $Record } } } Return $ApprovedUpdates }</span></span></code> </pre><br><br>  Information obtained as a result of this function can be saved to a file and then imported on another WSUS server, for example, using this function: <br><pre> <code class="bash hljs">&lt;<span class="hljs-comment"><span class="hljs-comment"># .SYNOPSIS      WSUS   .DESCRIPTION       (Approval),      (Decline) .PARAMETER FilePath XML-,        WSUS. .OUTPUTS $null (    ). #&gt; Function Import-Approvals([STRING]$FilePath) { #    WSUS $WSUS = Get-WsusServerInstance #   WSUS,      . $XML = [xml](get-content $FilePath) $Groups = $XML.Groups $Groups = $Groups.ChildNodes #        Foreach ($Group in $Groups) { #  XML if ($Group.get_NodeType() -ne $XML_TYPE_COMMENT) { $GroupName = $Group.Name Write-Host "Importing updates for WSUS group: $GroupName" #   $objGroup = Get-WsusGroupByName -Name $GroupName #    ,       $Updates = $Group.ChildNodes $TotalUpdates = $Updates.Count $i = 0 Foreach ($Update in $Updates) { $i++ $UpdateGUID = $Update.UpdateID if ($UpdateGUID -ne "") { $UpdateKB = $Update.UpdateKB Write-Host "Importing updates for $GroupName. Last processed is KB$UpdateKB" # Update   ID  : $UpdateGUID = [System.Guid]$UpdateGUID $objUpdateID = [Microsoft.UpdateServices.Administration.UpdateRevisionId]$UpdateGUID $objUpdate = $WSUS.GetUpdate($objUpdateID) #       XML-,       [DateTime]$UpdateApprovalDeadline = Get-XmlValue -XML $Update.UpdateApprovalDeadLine [Microsoft.UpdateServices.Administration.UpdateApprovalAction]$UpdateApprovalAction = Get-XmlValue -XML $Update.UpdateApprovalAction if ($Update.UpdateIsDeclined -eq "true") { $UpdateIsDeclined = $true } else { $UpdateIsDeclined = $false } #  $objUpdate.Approve($UpdateApprovalAction,$objGroup,$UpdateApprovalDeadline) | Out-Null #  ""    ,     $objUpdate.IsDeclined = $UpdateIsDeclined } } } Write-host -Message "Import finished for group: $GroupName" } }</span></span></code> </pre><br><br>  In general, everything is quite simple.  The export is carried out similarly to the import (those who wish can find the corresponding function in the <a href="http://pastebin.com/uiSkZzJp">full text of the script</a> ). <br><br><h5>  User interface </h5><br><br>  Since the script was supposed to be used not only by me, but also by my colleagues - the same enikeyschiki in other regions, it was decided to provide it with a graphical user interface: <br> <a href="http://imgur.com/dzGDZ"><img src="https://habrastorage.org/getpro/habr/post_images/f16/51f/039/f1651f039df0cef16571f8feb007cca6.png" title="Laconic GUI"></a> <br><br>  I tried to keep minimalism in the guise of the main window and avoided including script parameters in the interface, only <s>hardcore</s> hardcode.  Since <a href="http://msdn.microsoft.com/ru-ru/library/ms754130.aspx">WPF</a> is not installed on all computers that use this script, the graphical interface is implemented using <a href="http://msdn.microsoft.com/ru-ru/library/system.windows.forms.aspx">System.Windows.Forms</a> , rather than the more appropriate <a href="http://msdn.microsoft.com/ru-ru/library/cc189054(v%3Dvs.95).aspx">XAML</a> for such tasks. <br><br>  Of course, a Powershell solution created to automate routine operations must have a command line interface, otherwise the user will not be able to use it in his scripts (or at least run on a schedule). <br><br>  The described script takes the following parameters: <br><ol><li>  <i>DoImportFromFile</i> ‚Äî The path to the file from which you want to import approval information.  If this parameter is empty, the import does not occur; </li><li>  <i>DoExportToFile</i> - The path to the file to which the approval information should be <i>uploaded</i> .  Similarly, if there is no value for this parameter, the export is not performed; </li><li>  <i>ServersCopyTestApprovals</i> - Approve all updates allowed for use in a test group of servers for use on ‚Äúcombat‚Äù servers (see below); </li><li>  WorkstationsCopyTestApprovals - Same as above, but for workstations; </li><li>  <i>PathToLog</i> - Path to the log file (by default it is created in the temporary folder "% Temp%") </li></ol><br><br><h4>  Implementation activities </h4><br>  In order to successfully use the described scenario, we had to perform a number of preparatory activities. <br><br>  Initially, at least one test workstation and at least one test server were allocated on each network.  Whenever possible, we tried to include non-critical nodes for the main business into test groups.  Before updates are approved for use throughout the network, they are checked on test computers for several days (at the discretion of the system administrator).  Those updates that cause any problems are excluded (decline), the rest, at the end of testing, are approved for use in combat groups.  To copy approvals, use the described script. <br><br>  The following computer groups were created on all the WSUS servers where the described script was supposed to be used: <br><ol><li>  <i>gWSUS_srv_test</i> - test servers; </li><li>  <i>gWSUS_wks_test</i> - test workstations; </li><li>  <i>gWSUS_srv_prod</i> - ‚Äúcombat‚Äù servers; </li><li>  <i>gWSUS_wks_prod</i> ‚Äî business-critical workstations; </li></ol><br>  The names of groups are hard-coded in the script and cannot be changed without editing it.  Each WSUS server was configured to run the script in the copy approval mode from test groups to ‚Äúbattle‚Äù on a schedule every two weeks (it was decided that such a period of time would, on the one hand, have time to eliminate ‚Äúproblematic‚Äù updates from the list a, c the other one will not delay the delivery of updates to computers too much). <br><br>  Once every few days (at the discretion of the system administrator), a specially assigned enikeyschik in the test network performs the approval of new (not yet approved and not canceled) updates.  After obtaining permission from the system administrator, he uploads the list of approvals as an XML file to a special site within the network. <br><br>  Every day a simple batch file is executed on each WSUS server that downloads the current version of the list of updates from this site and imports the approvals: <br><br><pre> <code class="dos hljs"><span class="hljs-comment"><span class="hljs-comment">REM      cd /dd:\WSUS_script\ REM     del /f .\WSUS_updates_approvals.waf REM     wget --tries=100 --retry-connrefused --continue http://server.network.lan/wsus_approvals/WSUS_updates_approvals.waf REM     powershell -command -ExecutionPolicy Bypass ".\wsus_admin_tool.ps1 -DoImportFromFile 'c:\WSUS_updates_approvals.waf'"</span></span></code> </pre><br><br><h4>  Conclusion </h4><br>  Of course, the solution described is not without certain flaws: the script doesn‚Äôt check whether the approvals are in demand (does the server need SQL server‚Äôs approval in the network if this DBMS is not there?), The script requires access to the upstream WSUS server (or WindowsUpdate server), yes and the code itself is probably far from ideal. <br><br>  However, the task was successfully solved, and the practice, as is known, is the criterion of truth.  I hope the solution described is useful to someone else. <br><br>  Ps Full script code is <a href="http://pastebin.com/uiSkZzJp">available at PasteBin</a> . <br></div><p>Source: <a href="https://habr.com/ru/post/160069/">https://habr.com/ru/post/160069/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../160059/index.html">IIS - resize images on the fly</a></li>
<li><a href="../160061/index.html">Munich has saved 10 million euros due to the transition to Linux</a></li>
<li><a href="../160063/index.html">Do not touch the hardware or Redmine vs. Youtrack</a></li>
<li><a href="../160065/index.html">XHTML / CSS modeling of graphing diagrams</a></li>
<li><a href="../160067/index.html">Typical day under the supervision of Alice</a></li>
<li><a href="../160071/index.html">Marketing roles in IT companies</a></li>
<li><a href="../160075/index.html">Amateur video camera</a></li>
<li><a href="../160077/index.html">Search for a Hamiltonian cycle in a large graph (traveling salesman problem). Part 1</a></li>
<li><a href="../160081/index.html">OpenStreetMap switches to Leaflet instead of OpenLayers</a></li>
<li><a href="../160083/index.html">The correct translation or how was the localization of the series "Stage"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>