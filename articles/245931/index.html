<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using Veeam Backup for Linux-based Virtual Machines: Certificate Based Authentication</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="With the release of Veeam Backup & Replication v8, users began to carefully study the new functionality of the product. And since ‚Äúthere is no friend ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using Veeam Backup for Linux-based Virtual Machines: Certificate Based Authentication</h1><div class="post__text post__text-html js-mediator-article">  With the release of Veeam Backup &amp; Replication v8, users began to carefully study the new functionality of the product.  And since ‚Äúthere is no friend to the taste and color,‚Äù everyone finds some nice features for himself personally, and this can be quite modest, ‚Äúbut very useful gifts,‚Äù that is, new options that do not immediately rush into eyes, but on which the developers worked hard.  This is how the ‚Äúgorgeous eight‚Äù was selected, maybe not very sensational, but very useful features of Veeam Backup &amp; Replication v8.  My today's story is about authentication using a certificate when accessing the guest OS of virtual machines running Linux. <br><img src="https://habrastorage.org/files/d8f/81a/ede/d8f81aede78a4f33ac135a0158f22e0b.png" alt="image"><br><a name="habracut"></a><br><h1>  Why do we need access to the guest OS on the Linux VM </h1><br>  Indexing the guest file system is required in order to provide the user with a convenient search and quick recovery of the necessary files.  In particular, Veeam Backup &amp; Replication 8.0 supports this functionality for virtual machines running Linux, providing a convenient web interface Veeam Backup Enterprise Manager: <br><img src="https://habrastorage.org/files/998/4d0/d11/9984d0d1123f445f980ed0f62aaad766.png" alt="image"><br>  Veeam performs the corresponding operations using a runtime component that runs on the guest OS of the virtual machine when the backup job starts.  This component coordinates the processes during indexing (about them a bit later), and upon completion of the task it stops working.  The runtime component works on the guest OS and requires authentication, for which Veeam Backup &amp; Replication 8 now also supports the use of a certificate (Linux public key). <br><br>  For more information on indexing the guest file system, see <a href="http://helpcenter.veeam.com/backup/80/vsphere/index.html%3Findexing_hiw.html">here</a> and <a href="http://helpcenter.veeam.com/backup/80/hyperv/index.html%3Findexing_hiw.html">here</a> (in English). <br><br><h1>  Why we decided to support Linux Public Key authentication </h1><br>  Those who worked with Linux-infrastructures are probably in the know - rarely anyone logs in to the Linux server, entering a username and password.  There are several reasons for this, among them, in particular, the lack of centralized account management.  Yes, someone is using Microsoft Active Directory through Kerberos, someone is different, but this is not a mass phenomenon, and setting up and managing a large number of accounts in a rather large infrastructure can be a headache for someone responsible for this. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Take at least passwords: everyone knows that for security purposes you should use passwords of sufficient complexity and change them regularly.  Yes, you can spend half your life on this!  Someone decides to simplify the task and use, say, never changing passwords, or simple short passwords.  It is clear that life is becoming easier, but safety is reduced.  We also remember that in addition to the ‚Äúhuman-computer‚Äù communication, there is also a ‚Äúcomputer-to-computer‚Äù communication, and in order to ensure communication between servers, passwords should be stored where applications and scripts would have access to them ‚Äî while it is highly desirable to This is a protected form and not in text format. <br><br>  Because of all this, Linux system administrators often use the authentication method using a certificate, completely disabling the ability to log in with the input of a name and password.  The idea is for a user (or server) to access a remote machine via SSH with a certificate registered on that remote machine - which allows you to get authorization without having to enter a name \ password. <br><br>  This certificate must be registered only once, after which access will be granted automatically.  The issuance of certificates can also be automated. <br><br>  If authentication is enabled on the Linux server using a certificate, then when you try to log in with a username and password, the user will see an error message.  The only possible login option with these settings is if the local SSH certificate (public key) is uploaded to the list of allowed keys ( <i>authorized_keys</i> ) on the server where you need to log in. When you configure the backup job in Veeam Backup &amp; Replication 8.0, which includes such a Linux server , you will need to specify the corresponding private key. <br><br><h1>  How it works in Veeam Backup &amp; Replication v8 </h1><br>  So, first create a pair of RSA-keys, and you get two files: <br><ul><li>  <i>id_rsa</i> is a private key, we save it on the backup server.  The path to this key will need to be specified when configuring the backup task. </li><li>  <i>id_rsa.pub</i> is the public key, you need to save it to the <i>authorized_keys</i> file of the SSH server (Linux VM) whose guest OS you plan to index. </li></ul><br>  By the way, PuTTYGen is present in the Veeam installation directory - it can be used to generate the PuTTY Private Key (PPK) private keys for the Veeam Backup &amp; Replication backup server.  The following SSH key formats are supported: OpenSSH RSA, OpenSSH DSA, OpenSSL PEM, Open SSL PKCS # 8, and SSH.com. <br><br>  More detailed information, as well as a description of working with Credentials Manager - a tool for centralized management of access settings in Veeam Backup &amp; Replication, can be found <a href="http://helpcenter.veeam.com/backup/80/vsphere/index.html%3Fcredentials_manager_linux_pubkey.html">here</a> (in English). <br><br>  User access settings can also be entered during the creation of a backup or replication task.  In the Backup Job Setup Wizard for Linux VM, we reach the <b>Guest Processing</b> step, enable the index option of the guest OS;  then in the section for setting access settings, click <b>Add</b> and from the three methods presented in the list select the <b>Linux public key</b> : <br><img src="https://habrastorage.org/files/76f/425/0a3/76f4250a3e5d4b2c9a668d1f84fa4e3c.png" alt="image"><br>  In the dialog that opens, you need to specify what username our key (for example, <i>root</i> ) will be assigned to and specify the path to the private key that you previously created.  If the key phrase was used to create the key (passphrase), enter it too. <br><br><img src="https://habrastorage.org/files/77d/3b3/91d/77d3b391d14a495daa0b9a04cd054c31.png" alt="image"><br><br>  After you have specified the key, you can check whether it will work during authentication - to do this, after returning to the <b>Guest Processing</b> step, click <b>Test Now</b> and watch the process: <br><img src="https://habrastorage.org/files/d97/d30/0d7/d97d300d77f94a36a69b6cfcb1905c8c.png" alt="image"><br><br>  This button is really useful, because  When checking a key, it checks at the same time the presence of all components necessary for indexing the guest OS.  So, in the example above, CentOS was used in a minimal configuration, where <i>mlocate</i> is not included by <i>default</i> , whose absence was reported by the session error.  There are two more utilities needed - <i>gzip</i> and <i>tar</i> . <br><br>  Actually, the main work is performed by <i>mlocate</i> , which conducts an effective file search using not the file system, but the index database, and Veeam uses an SSH connection to ‚Äúissue instructions‚Äù to this utility (start, update the database using <i>updatedb</i> , etc.) .  (In this scenario, the connection via VMware VIX will not succeed - this functionality is planned for future implementation, and in the current version, the backup server needs access to the Linux VM over the network via SSH.) <br><br>  Note that since ordinary users may not have enough rights to access files and execute commands (in particular, the index database is closed for normal users to read), it is recommended to either specify the <i>root</i> user in the <b>Credentials</b> dialog or enable the <b>Elevate account to root</b> option. <br><br>  Thus, <i>mlocate</i> will <i>output the</i> files found from the index database and the metadata (including the paths, the time of the last update of the index, etc.), and <i>tar</i> and <i>gzip</i> respectively will add all of this into one file and carefully package it. <br><br>  After all necessary components are installed and the authentication test is successfully passed, you can proceed to the final steps of the setup wizard.  And remember, of course, these settings will be applied to all the machines included in the task - unless you specify otherwise for the selected machine (for example, you can enter individual settings for the guest OS by clicking the <b>Credentials</b> button at the appropriate wizard step). <br><br>  During the execution of the backup task, the statistics window will display detailed information about the Linux indexing process using the private key: <br><img src="https://habrastorage.org/files/b7b/e0d/46b/b7be0d46b5d24f2284ac56e59c28248a.png" alt="image"><br>  The screenshot shows the process steps (marked by arrows, top to bottom): <br><ul><li>  Veeam connects to the Linux VM via SSH, using the private key for the login. </li><li>  Then using <i>mlocate</i> indexed guest file system. </li><li>  After that, using <i>tar</i> and <i>gzip</i> creates a compact index file <b>GuestIndexData.tar.gz</b> . </li><li>  At the end of the work, the index file is published in the <b>VBRC</b> catalog catalog - so that users can search for files to restore.  (Read more about the catalog <a href="http://helpcenter.veeam.com/backup/80/em/index.html%3Findexing_data.html">here</a> .) </li></ul><br>  I hope the new options for working with virtual machines running Linux will be useful to you or your colleagues.  However, this is only the first of 8 stories, to be continued. <br><br><h1>  Additional Information: </h1><br><ul><li>  <a href="http://habrahabr.ru/company/veeam/blog/242587/">Article on Habr√© about new features of Veeam Availability Suite 8.0</a> </li><li>  <a href="http://www.veeam.com/ru/videos/availability-suite-v8-ru-5463.html">Record of the webinar "Veeam Availability Suite v8" (in Russian)</a> </li><li>  <a href="http://www.veeam.com/ru/data-center-availability-suite.html">Solution page: an overview of opportunities, links to resources (in Russian)</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/245931/">https://habr.com/ru/post/245931/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../245917/index.html">Writing converter for Nokia 3310 ringtone generator</a></li>
<li><a href="../245921/index.html">We test Mighty Editor and Phaser. HTML5 game per hour</a></li>
<li><a href="../245923/index.html">ABAP Development for SAP HANA</a></li>
<li><a href="../245925/index.html">Quantmehm to protect plastic cards</a></li>
<li><a href="../245929/index.html">Freelancers survey</a></li>
<li><a href="../245935/index.html">IPv6 SLAAC Attack</a></li>
<li><a href="../245937/index.html">30 steps to be done on Facebook so that your business soars rapidly in the new year</a></li>
<li><a href="../245943/index.html">From the first electric bike with your own hands - to a promising startup. Staff stories REG.RU</a></li>
<li><a href="../245945/index.html">Creating Universal Web Applications Using the Web App Template</a></li>
<li><a href="../245949/index.html">AWS Lambda and no servers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>