<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Work with Oracle DB from Xcode</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I wanted to learn how to work with oracle from xcode, because I did not find a ready-made apple framework to work with the oracle database directly. 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Work with Oracle DB from Xcode</h1><div class="post__text post__text-html js-mediator-article"> I wanted to learn how to work with oracle from xcode, because I did not find a ready-made apple framework to work with the oracle database directly. <br>  To begin with, I tried to create a test project and connect the oracle instantclient to it.  I also used a test example from Oracle (cdemo81.c), included its code in the xcode project and tested the work.  Yes, everything works, although I had to beat a little bit into the google's shaman tambourine.  However, using the oci library directly is difficult, since you need to implement the interface, and this is similar to the invention of the bicycle. <br>  Then I decided to try using the ocilib cross-platform library ( <a href="http://orclib.sourceforge.net/">http://orclib.sourceforge.net</a> ) <br>  Further in the text, step by step instructions on how to make a test project on cocoa and use this library.  The purpose of the test project is to connect the library to get data from the oracle server. <a name="habracut"></a><br><br>  1) Download the library itself <a href="http://orclib.sourceforge.net/download/">http://orclib.sourceforge.net/download/</a> <br>  2) Downloading the oracle instantclient for macosx <a href="http://www.oracle.com/technetwork/topics/intel-macsoft-096467.html">http://www.oracle.com/technetwork/topics/intel-macsoft-096467.html</a> , In this case I'm interested in Version 11.2.0.3.0 (64-bit), Instant Client Package - Basic: All files required to run OCI, OCCI, and JDBC-OCI applications ( <a href="">http://download.oracle.com/otn/mac/instantclient/11203/instantclient-basic-macos.x64-11.2.0.3.0. zip</a> ) Registration is required for download, but it is free.  You will also need header files to compile the ocilib, so download the ‚ÄúInstant Client Package - SDK: an additional header file for developing Oracle applications with the Instant Client‚Äù, in my case this one is instantclient-sdk-macos.x64-11.2.0.3 .0.zip ( <a href="http://www.oracle.com/technetwork/topics/intel-macsoft-096467.html">http://www.oracle.com/technetwork/topics/intel-macsoft-096467.html</a> ) <br>  3) Extract the instantclient to a folder, for example / usr / local / lib / instantclient_11_2 <br>  4) Also, unpack the SDK c header files into the inside folder with instantclient, for example like this - / usr / local / lib / instantclient_11_2 / sdk <br>  5) Now, you need to create a symlink for the library in the instantclient folder, go to the / usr / local / lib / instantclient_11_2 folder in the console, then we make a symlink - "ln -s libclntsh.dylib.11.1 libclntsh.dylib" <br>  6) Next, unpack the archive with the library of ocilib, for example in the folder / Users / username / Downloadloads / soc-3.12.1 <br>  7) Open the terminal and go to the folder with ocilib, for example, <code>cd /Users/username/Downloads/ocilib-3.12.1</code> <br>  8) In the console we sequentially assemble the library <br><br><pre> <code class="bash hljs">./configure --with-oracle-lib-path=/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/lib/instantclient_11_2/ ‚Äîwith-oracle-headers-path=/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/lib/instantclient_11_2/sdk/include make sudo make install</code> </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      After that, the library should be installed in the / usr / local / lib folder, check for files in the folder, such as libocilib * <br>  The first stage of the preparation of libraries is completed.  Now try to create a test project in Xcode <br><br>  1) Create a new project in Xcode (OS X -&gt; Cocoa Application) <br>  By default, Xcode (I have installed version 5.1) creates an empty project with MainMenu.xib in which there is an empty view. <br>  2) First, add the library file ocilib to the project header.  Open the /Users/username/Downloads/ocilib-3.12.1/include folder and copy the ocilib.h file from there to the folder of our project for Xcode, and add this file to our project (in xcode, inside the project folder we make file-&gt; add files to "project name" and choose our ocilib.h <br>  3) Next you need to add links for libraries to the project, to do this, open the xcode project's Build Settings, look for Other Linker Flags and add two parameters there - ‚Äú-locilib‚Äù and ‚Äú-lclntsh‚Äù - first, link to the ocilib library, second to instantclient .  If we now try to compile the project, we get an error - "ld: library not found for -lclntsh".  The fact is that when compiling xcode, it doesn‚Äôt know where exactly the instantclient oracle is located, you need to specify the path to it. <br>  4) Specify the path to the libraries - to do this, open the xcode project's Build Settings, look for the ‚ÄúLibrary Search Path‚Äù and add the path to the instantclient and ocilib, we press the two parameters ‚Äú/ usr / local / lib / instantclient_11_2‚Äù and ‚Äú/ usr / local / lib " <br><br>  The second stage of preparation was completed, the project saw the library.  Let's try to compile the project, everything should work without errors.  If there are no mistakes, congratulations, there are a third way behind.  Little things left - to connect to the database and get any information. <br><br>  1) In AppDelegate.h we write <code>#include "ocilib.h"</code> <br>  2) In AppDelegate.m change the code <br><br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)applicationDidFinishLaunching:(<span class="hljs-built_in"><span class="hljs-built_in">NSNotification</span></span> *)aNotification { OCI_Connection* cn; OCI_Statement* st; OCI_Resultset* rs; OCI_Initialize(<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, OCI_ENV_DEFAULT); cn = OCI_ConnectionCreate(<span class="hljs-string"><span class="hljs-string">"orcl"</span></span>, <span class="hljs-string"><span class="hljs-string">"USERNAME"</span></span>, <span class="hljs-string"><span class="hljs-string">"PASSWORD"</span></span>, OCI_SESSION_DEFAULT); st = OCI_StatementCreate(cn); OCI_ExecuteStmt(st, <span class="hljs-string"><span class="hljs-string">"select id,name from test_encoding_table"</span></span>); rs = OCI_GetResultset(st); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (OCI_FetchNext(rs)) { printf(<span class="hljs-string"><span class="hljs-string">"%i - %s\n"</span></span>, OCI_GetInt(rs, <span class="hljs-number"><span class="hljs-number">1</span></span>), OCI_GetString(rs,<span class="hljs-number"><span class="hljs-number">2</span></span>)); } OCI_Cleanup(); }</code> </pre><br><br>  Where username, password is the name and password to connect to our database, and orcl is the name of the instance registered in tnsnames.ora (how to register, more on that later) <br>  If we now try to start the project, we get an error, like this - ‚Äúdyld: Library not loaded: /ade/b/2649109290/oracle/rdbms/lib/libclntsh.dylib.11.1 <br>  Referenced from: /Users/chepil/Library/Developer/Xcode/DerivedData/test3-hdexygntscvmwahcgsfolpqrkldi/Build/Products/Debug/test3.app/Contents/MacOS/test3 <br>  Reason: image not found ¬ª <br><br>  This error suggests that when you run the project (yes, it compiled normally), the application does not know where the library to which we refer lies.  Since it is one thing to compile a project, it is another thing to execute it. <br>  To correct the error, either run the project from the console, setting the necessary environment variables, or add the necessary variables directly to xcode. <br>  To do this, click on the project name in the upper left corner of the project window (unfortunately, I don‚Äôt know how to do it through the menu), and select ‚ÄúEdit Scheme ...‚Äù <br>  Select the startup scheme (in my case, ‚ÄúRun test3.app‚Äù) and open the Arguments tab, in which we will write several ‚ÄúEnvironment Variables‚Äù - environment variables.  You need to understand that these variables are valid only when you start a project from Xcode, and will cease to act as soon as we allow our app file to go public ... <br><br>  3) Add the DYLD_LIBRARY_PATH environment variable with the value / usr / local / lib: / usr / local / lib / instantclient_11_2.  As you can see, to add multiple values, you need to use a colon.  Let's try to run the project.  The project started, but nothing happened to the console.  It is logical, because firstly, there was no connection to the database, and secondly, the test_encoding_table table is probably not in your database (I hope you guessed it to replace the query with its value).  However, what is missing to connect to the database?  That's right, the environment variable ORACLE_HOME, in which the network / admin / tnsnames.ora should be located <br><br>  4) create folders / Users / username / oracle_home / network / admin <br>  5) create the file /Users/username/oracle_home/network/admin/tnsnames.ora <br>  the contents of the tnsnames.ora file: <br><br><pre> <code class="bash hljs">orcl= (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp) (HOST=orclserver.myaddress.com) (PORT=1521))(CONNECT_DATA=(SERVICE_NAME=orcl)))</code> </pre><br><br>  In your case, the connection may be different, the settings for connecting to the oracle server are beyond the scope of this article.  The connection above is just an example. <br><br>  6) Let's write a new environment variable for our application to run (in the same place where we registered DYLD_LIBRARY_PATH).  The new variable will be named ORACLE_HOME and have the value / Users / username / oracle_home <br>  After that, when you start the application and create the correct query (to your table), you will start receiving data from the oracle server.  Also, it was possible to register the value of the variable is not ORACLE_HOME, but TNS_ADMIN and specify the path to the tnsnames.ora file (oracle administrators and programmers know what it is about, I will not chew) <br><br>  7) In my case, the test_encoding_table table contains test records in Russian and Japanese, in UTF8 encoding.  When requesting this data in xcode, I got this result - <br>  one - ????????????  ????????  ???? <br>  ... <br><br>  It is clear that this is a question mark, and we do not need the data, which means that something is wrong. <br>  For correct data return, you need to specify in which encoding we work <br><br>  8) Let's write another environment variable to start the application.  As well as DYLD_LIBRARY_PATH, ORACLE_HOME, create a variable NLS_LANG and assign a value to it (for example RUSSIAN_CIS.UTF8) <br>  Run the project and get the output to the project console - <br><br>  1 - testing Russian names <br>  2 - Êó•Êú¨Ë™û „Åß Âà©Áî® „Åó „Åü „ÅÑ „ÅÆ „Åß „Åô „Åå <br><br>  Q.E.D. <br><br>  It remains - little things.  Let's now display the result in NSTextView in the main program window.  For this <br>  Modify the MainMenu.xib file created by default, put a new NSTextView on the window <br>  Change AppDelegate.h <br><br><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Cocoa/Cocoa.h&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ocilib.h"</span></span></span><span class="hljs-meta"> @interface AppDelegate : NSObject </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;NSApplicationDelegate&gt;</span></span></span><span class="hljs-meta"> { IBOutlet NSTextView *textView; } @property (assign) IBOutlet NSWindow *window; @property (nonatomic,retain) IBOutlet NSTextView *textView; @end</span></span></code> </pre><br><br>  3) Change AppDelegate.m <br><br><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"AppDelegate.h"</span></span></span><span class="hljs-meta"> @implementation AppDelegate @synthesize textView; - (void)applicationDidFinishLaunching:(NSNotification *)aNotification { // Insert code here to initialize your application NSString *str = @</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">""</span></span></span><span class="hljs-meta">; OCI_Connection* cn; OCI_Statement* st; OCI_Resultset* rs; OCI_Initialize(NULL, NULL, OCI_ENV_DEFAULT); cn = OCI_ConnectionCreate(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"orcl"</span></span></span><span class="hljs-meta">, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"username"</span></span></span><span class="hljs-meta">, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"password"</span></span></span><span class="hljs-meta">, OCI_SESSION_DEFAULT); st = OCI_StatementCreate(cn); OCI_ExecuteStmt(st, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"select id,name from test_encoding_table"</span></span></span><span class="hljs-meta">); rs = OCI_GetResultset(st); while (OCI_FetchNext(rs)) { printf(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"%i - %s\n"</span></span></span><span class="hljs-meta">, OCI_GetInt(rs, 1), OCI_GetString(rs,2)); NSString *str1 = [NSString stringWithUTF8String:OCI_GetString(rs,2)]; str = [NSString stringWithFormat:@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"%@\n%i: %@"</span></span></span><span class="hljs-meta">,str,OCI_GetInt(rs, 1),str1]; } OCI_Cleanup(); [textView setString:str]; } @end</span></span></code> </pre><br><br>  4) on MainMenu.xib, open the AppDelegate and link the outlet textView to our new NSTextView, which we put in our window. <br><br>  Run the application <br>  Now the database query output is duplicated in the project console and in NSTextView. <br><br>  Last clarification.  If we want to start the program (in my case test3.app) from the console, and not from xcode, then we will need to set the environment variables. <br>  For the test, create the file test.sh, give it rights <pre> <code class="bash hljs">chmod +x test.sh</code> </pre>  and write inside something like: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh export DYLD_LIBRARY_PATH=/usr/local/lib:/usr/local/lib/instantclient_11_2 export ORACLE_HOME=/Users/chepil/oracle_home export NLS_LANG=RUSSIAN_CIS.UTF8 open test3.app</span></span></code> </pre><br><br>  we start the project from the console - <br><br><pre> <code class="bash hljs">./test3.sh</code> </pre><br><br>  the application opens, there is a window in it, a database request is made and the result is displayed in the textview on the screen.  Everything works, and what was required to prove. <br><br>  Finally, I would like to ask, maybe there are other libraries for working with Oracle.  I am at the beginning of the project development and I need to decide on the expediency of working with this library.  In fact, the library of ocilib is a wrapper around OCI from Oracle, and you do not want to reinvent your bicycle.  Who has experience with orakl from xcode?  What comments are there on the text of the article? <br>  Thanks for the constructive criticism! </div><p>Source: <a href="https://habr.com/ru/post/217397/">https://habr.com/ru/post/217397/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../217387/index.html">Cocos2D-X and so easy on all devices</a></li>
<li><a href="../217389/index.html">Calculate the day of the week in the mind</a></li>
<li><a href="../217391/index.html">Easy start: Spring + MongoDB</a></li>
<li><a href="../217393/index.html">MongoDB from theory to practice. MongoDB Cluster Installation Guide</a></li>
<li><a href="../217395/index.html">As a "non-programmer" game wrote</a></li>
<li><a href="../217399/index.html">How I used BitTorrent Sync between offices in the Russian Federation and China</a></li>
<li><a href="../217401/index.html">Web browser, as an environment for the operation of software for control / process control</a></li>
<li><a href="../217407/index.html">Music for the grandmother from the grandson-programmer</a></li>
<li><a href="../217409/index.html">HabraFAQ about job search on the Internet</a></li>
<li><a href="../217411/index.html">About bad words, or How to write a text without making a shit out of it</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>