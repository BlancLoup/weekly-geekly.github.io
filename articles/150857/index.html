<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Unusual JSF and Spring integration</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 I would like to share my experience with the unusual integration of these two frameworks. I really wouldn‚Äôt like to touch upon such ext...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Unusual JSF and Spring integration</h1><div class="post__text post__text-html js-mediator-article"><h2>  Introduction </h2><br>  I would like to share my experience with the unusual integration of these two frameworks.  I really wouldn‚Äôt like to touch upon such extremely important issues ‚Äúwhy do we need JSF at all‚Äù, I‚Äôll make a reservation that I am not a supporter of this technology. <br><br>  The zoo application for Spring + Hibernate + a large number of PL / SQL files and Oracle packages was developed for quite a long time.  The user interface was created on ExtJS 4th and 2nd version, sometimes used self-made JavaScript and HTML.  In general, normal corporate Frankenstein.  Force majeure circumstances forced me to use JSF to create some part of the interfaces, so JSF should be integrated into the already existing query processing system based on Spring MVC.  I used Primefaces, but I assume that the same methods apply for all other implementations. <br><a name="habracut"></a><br><h2>  Obvious things </h2><br>  First, create a separate servlet in the web.xml file. <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span>JSF<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-class</span></span></span><span class="hljs-tag">&gt;</span></span>javax.faces.webapp.FacesServlet<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-class</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">load-on-startup</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">load-on-startup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span>JSF<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url-pattern</span></span></span><span class="hljs-tag">&gt;</span></span>*.xhtml<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url-pattern</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-mapping</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And in the faces-config.xml file, we add Spring support so that the xhtml objects can use the bins created by spring annotations. <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">el-resolver</span></span></span><span class="hljs-tag">&gt;</span></span>org.springframework.web.jsf.el.SpringBeanFacesELResolver<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">el-resolver</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br><h2>  Wrapping up requests </h2><br><br>  Until now, everything is quite simple and described almost everywhere.  Now we have to solve the following tasks: <br><br><ol><li>  to provide transfer of get and post requests through spring to JSF. </li><li>  add transaction support (we have Hibernate inside with lazy collections) </li><li>  create bins with a lifetime of "view" </li><li>  prevent user access to xhtml files </li></ol><br><br>  The first two points can be solved simultaneously.  In our application, all the URLs for which JSF interfaces will be created are of the form "/ app / * / jsf / *" <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Controller</span></span>(<span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/app/*/jsf"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JSFTestController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>(value = <span class="hljs-string"><span class="hljs-string">"/*"</span></span>, method = {RequestMethod.GET}) <span class="hljs-meta"><span class="hljs-meta">@Transactional</span></span>(rollbackFor = Exception.class) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">redirectToJSF</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ String uri = request.getRequestURI(); <span class="hljs-comment"><span class="hljs-comment">//       RequestContextHolder.getRequestAttributes().setAttribute(JSF_REQUEST_URL, uri, RequestAttributes.SCOPE_REQUEST); String xhtmlPath= getXHTMLPath(uri); //   xhml ,     //    ,    request.getRequestDispatcher(xhtmlPath).forward(request, response); } //   public static String getURLFromRequest(HttpServletRequest request) { return (String) RequestContextHolder.getRequestAttributes().getAttribute(JSF_REQUEST_URL, RequestAttributes.SCOPE_REQUEST); }</span></span></code> </pre><br>  The getXHTMLPath method returns the path to the xhtml file, for example <i>/resources/jsf/accounts/find_create.xhtml</i> to access the file that lies in <i>[war file] \ resources \ jsf \ accounts \ find_create.xhtml.</i> <br><br>  This is enough to see the rendered xhtml page, however PrimeFaces is rich in POST requests for building an interface, and they clearly go to the wrong addresses.  For the formation of the POST request path (that is, the form renderer is responsible for the value of the action attribute of the form).  It is necessary to change only one static function <b>getActionStr</b> , unfortunately it was made static and it is necessary to block the function that calls it: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActCorrectFormRenderer</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FormRenderer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> com.sun.faces.renderkit.Attribute[] ATTRIBUTES = AttributeManager.getAttributes(AttributeManager.Key.FORMFORM); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> writeStateAtEnd; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ActCorrectFormRenderer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ WebConfiguration webConfig = WebConfiguration.getInstance(); writeStateAtEnd = webConfig.isOptionEnabled(WebConfiguration.BooleanWebContextInitParameter.WriteStateAtFormEnd); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encodeBegin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(FacesContext context, UIComponent component)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ rendererParamsNotNull(context, component); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!shouldEncode(component)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } ResponseWriter writer = context.getResponseWriter(); <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> (writer != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); String clientId = component.getClientId(context); <span class="hljs-comment"><span class="hljs-comment">// since method and action are rendered here they are not added // to the pass through attributes in Util class. writer.write('\n'); writer.startElement("form", component); writer.writeAttribute("id", clientId, "clientId"); writer.writeAttribute("name", clientId, "name"); writer.writeAttribute("method", "post", null); writer.writeAttribute("action", getActionStr(context), null); String styleClass = (String) component.getAttributes().get("styleClass"); if (styleClass != null) { writer.writeAttribute("class", styleClass, "styleClass"); } String acceptcharset = (String) component.getAttributes().get("acceptcharset"); if (acceptcharset != null) { writer.writeAttribute("accept-charset", acceptcharset, "acceptcharset"); } RenderKitUtils.renderPassThruAttributes(context, writer, component, ATTRIBUTES); writer.writeText("\n", component, null); // this hidden field will be checked in the decode method to // determine if this form has been submitted. writer.startElement("input", component); writer.writeAttribute("type", "hidden", "type"); writer.writeAttribute("name", clientId, "clientId"); writer.writeAttribute("value", clientId, "value"); writer.endElement("input"); writer.write('\n'); // Write out special hhidden field for partial submits String viewId = context.getViewRoot().getViewId(); String actionURL = context.getApplication().getViewHandler().getActionURL(context, viewId); ExternalContext externalContext = context.getExternalContext(); String encodedActionURL = externalContext.encodeActionURL(actionURL); String encodedPartialActionURL = externalContext.encodePartialActionURL(actionURL); if (encodedPartialActionURL != null) { if (!encodedPartialActionURL.equals(encodedActionURL)) { writer.startElement("input", component); writer.writeAttribute("type", "hidden", "type"); writer.writeAttribute("name", "javax.faces.encodedURL", null); writer.writeAttribute("value", encodedPartialActionURL, "value"); writer.endElement("input"); writer.write('\n'); } } if (!writeStateAtEnd) { context.getApplication().getViewHandler().writeState(context); writer.write('\n'); } } private static String getActionStr(FacesContext context) { return JSFTestController.getURLFromRequest(HttpUtils.getCurrentRequest()); } }</span></span></code> </pre><br><br>  This is inconvenient, but there is no other way to change its static function.  But in this way, we managed to change the action form and post requests will go to the same address as the get request, which built the view for the page.  It remains to register your renderer in the faces-config file: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">render-kit</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">renderer</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">component-family</span></span></span><span class="hljs-tag">&gt;</span></span>org.primefaces.component<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">component-family</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">renderer-type</span></span></span><span class="hljs-tag">&gt;</span></span>org.primefaces.component.MenuRenderer<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">renderer-type</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">renderer-class</span></span></span><span class="hljs-tag">&gt;</span></span>com.XXXXX.ActCorrectMenuRenderer<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">renderer-class</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">renderer</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">render-kit</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  In the application, when processing GET and POST requests, slightly different checks are used, therefore the methods are separated, but for a simple example, the redirectToJSF method can be annotated with @RequestMapping (value = "/ *", method = {RequestMethod.GET, RequestMethod.POST}) <br><br><h2>  "View" scope </h2><br><br>  JSF requires bins that exist within a view, i.e.  are generated at every GET request and live at POST requests that originate from the page spawned by this GET request.  We will not reinvent the wheel, we will borrow the code for the class here: <a href="http://forum.springsource.org/showthread.php%3F80595-View-scope-with-Spring">forum.springsource.org/showthread.php?80595-View-scope-with-Spring</a> <br><br><h2>  Security </h2><br>  The application had the ability to work under several users simultaneously from one browser, the session GUID was added to the URL, so a direct access to the xhtml file is blocked as unauthorized (the login form was made without JSF), and pull it out (or get JSF to process the user's request directly) using request with session GUID: <br><br>  localhost: 8443 / &lt;application name&gt; /app/ea10efcb-4a2e-4eeb-aa71-24310882f7ad/jsf/accounts/find_create.xhtml <br><br>  will not work, since no file [xxx.war] /app/ea10efcb-4a2e-4eeb-aa71-24310882f7ad/jsf/accounts/find_create.xhtml <br><br>  Additionally, the following filters were installed: <br><br><ul><li>  "/javax.faces.resource/**" - empty filter (we do not mind, take what you want) </li><li>  / themes / ** - empty filter </li><li>  / ** / resources / jsf / ** - with verification of authorization </li></ul><br><br><h2>  Conclusion </h2><br>  Well, we reviewed the main points of a relatively painless (for the program, for the developer, many moments were extremely painful) adding JSF to a complex application.  Behind the scenes, there are issues of handling exceptions during POST requests, combating chaotic component calls to bins to optimize performance, but this is a topic for a separate article. </div><p>Source: <a href="https://habr.com/ru/post/150857/">https://habr.com/ru/post/150857/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../150850/index.html">BMW Computer Mouse</a></li>
<li><a href="../150851/index.html">Smooth.js - jQuery plugin for CSS3 transitions with downgrade to $ .animate</a></li>
<li><a href="../150854/index.html">Apple insures from Samsung and actively buys LTE-patents</a></li>
<li><a href="../150855/index.html">Comparative CMS analysis: the hunt for an optimal system for creating corporate sites</a></li>
<li><a href="../150856/index.html">Bruce Willis will not sue Apple</a></li>
<li><a href="../150859/index.html">Moq usage examples</a></li>
<li><a href="../150861/index.html">Apple sent invitations to the presentation on September 12</a></li>
<li><a href="../150862/index.html">Debugging Android Applications Without Java Source Code: A Few Words About Breakpoints</a></li>
<li><a href="../150863/index.html">Add Bundling and Minification to an ASP.NET Web Forms Application</a></li>
<li><a href="../150864/index.html">iPhone Style Checkbox for Twitter Bootstrap</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>