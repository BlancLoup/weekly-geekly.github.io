<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Multiprotocol bot via Microsoft Bot Connector REST API v3.0</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I want to describe a simple example of how a multi-protocol bot works through the Microsoft Bot Connector API - v3.0 . On skype- like ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Multiprotocol bot via Microsoft Bot Connector REST API v3.0</h1><div class="post__text post__text-html js-mediator-article">  In this article I want to describe a simple example of how a multi-protocol bot works through the <a href="https://docs.botframework.com/en-us/restapi/connector/">Microsoft Bot Connector API - v3.0</a> .  On <s>skype-</s> like bots, there are already articles on Habr√©: <a href="https://habrahabr.ru/post/281296/">‚ÄúHow to create your own bot for Skype.</a>  <a href="https://habrahabr.ru/post/281296/">What is not written in the documentation "</a> by <a href="https://habrahabr.ru/users/and7ey/" class="user_link">and7ey</a> and <a href="https://habrahabr.ru/company/microsoft/blog/281459/">" Hello, Bot!</a>  <a href="https://habrahabr.ru/company/microsoft/blog/281459/">Chat bots are the next generation of apps? ‚Äù</a> By <a href="https://habrahabr.ru/users/shwars/" class="user_link">shwars</a> .  But in the first there is a speech about the work through apis.skype and the variant described there is not multiprotocol, and in the second the implementation is described via C #, but I do not know how to do it. <br><br><h3>  Who needs this article and why? </h3><br>  Firstly, the ‚Äúguy‚Äù who wants to make his bot, but does not know how to do C #, but who knows how to use REST. <br><a name="habracut"></a><br>  Secondly, to me, since I spent a fair amount of time analyzing several versions of the API and understanding which API and how I should use it.  Therefore, I would like to consolidate my experience <s>on paper</s> in the article (ok, I will no longer use the chip with a strikethrough text). <br><br><h3>  Authorization </h3><br>  Fully (as far as I was able to evaluate) is considered in the article I mentioned above - in <a href="https://habrahabr.ru/post/281296/">this one</a> .  We do as described, we get a token and a start - we are ‚Äúon the first base‚Äù (this is not a generally accepted analogy about the bases, where on the third we will be given a boob tits, no, this is not it). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Receive messages </h3><br>  The bot should have an endpoint where requests with a json-body will come.  For example, a message sent to the bot via skype with the text ‚Äúhello, bot‚Äù will come like this: <br><br><div class="spoiler">  <b class="spoiler_title">json</b> <div class="spoiler_text"><pre> {  
    "type": "message",
    "id": "1q80QckzCi3wL6zg",
    "timestamp": "2016-08-16T12: 56: 16.49Z",
    "serviceUrl": "https://skype.botframework.com",
    "channelId": "skype",
    "from": {  
       "id": "29: 1Phe2HAxz6CD9uc1O_PVl_Zih6doxIe_KuyrQ9eANUbs",
       "name": "avvero"
    },
    "conversation": {  
       "id": "29: 1Phe2HAxz6CD9uc1O_PVl_Zih6doxIe_KuyrQ9eANUbs"
    },
    "recipient": {  
       "id": "28: 300cbb48-78e0-4998-8e85-4f4c7ccb5aee",
       "name": "notify_bot"
    },
    "text": "hello, bot",
    "entities": [  

    ]
</pre><br>  } <br></div></div><br>  What is especially important to us in this request: <br><br><ul><li>  conversation.id - conversation ID </li><li>  channelId - channel identifier </li></ul><br>  These two parameters are especially important because on the basis of them the url is determined for sending requests to botframework.  At the same time, the role of conversationId is mentioned in the API <a href="https://docs.botframework.com/en-us/restapi/connector/">description</a> ( <a href="">swagger</a> ), but with channelId, not everything is so obvious, more precisely, nifiga (technical term) is not obvious.  For example, messages from the bot for the skype channel should go here: <br><br>  https: // <b>skype</b> .botframework.com / v3 / conversations / {conversationId} / activities, <br><br>  And for the telegram here: <br><br>  https: // <b>telegram</b> .botframework.com / v3 / conversations / {conversationId} / activities. <br><br>  I did not see this in the documentation and this is bad, since most of the time was spent on identifying this feature. <br><br><h3>  Sending messages </h3><br>  For skype, the minimum request body will be: <br><br><div class="spoiler">  <b class="spoiler_title">json</b> <div class="spoiler_text"><pre> {  
    "type": "message",
    "text": "hello"
 }
</pre><br></div></div><br>  And for a telegram like this (you need a <b>from</b> object): <br><br><div class="spoiler">  <b class="spoiler_title">json</b> <div class="spoiler_text"><pre> {  
    "type": "message",
    "from": {  
       "id": "avvero_notify_bot",
       "name": "avvero"
    },
    "text": "hello"
 }
</pre></div></div><br><h3>  Cards </h3><br>  Not texts uniform.  You can send cards as well (here is an example of a message for a telegram, for skype it is possible without from): <br><br><div class="spoiler">  <b class="spoiler_title">json</b> <div class="spoiler_text"><pre> { 
    "type": "message",
    "from": { 
       "id": "avvero_notify_bot",
       "name": "avvero"
    },
    "text": "hello",
    "attachments": [ 
       { 
          "contentType": "application / vnd.microsoft.card.hero",
          "content": { 
             "title": "title",
             "subtitle": "subtitle",
             "text": "text",
             "images": [ 
                { 
                   "url": "https://pp.vk.me/c7011/v7011856/3160d/HVELORSo5KM.jpg",
                   "alt": "hello thumb"
                }
             ],
             "buttons": [ 
                { 
                   "type": "imBack",
                   "title": "Yes",
                   "value": "yes &lt;context offer = \" ... \ "/&gt;"
                },
                { 
                   "type": "imBack",
                   "title": "No",
                   "value": "no"
                },
                { 
                   "type": "openUrl",
                   "title": "Google",
                   "value": "https://disney.radisson.com"
                }
             ]
          }
       }
    ]
 }
</pre></div></div><br>  In skype it looks like this: <br><br><img src="https://habrastorage.org/files/20c/999/fb7/20c999fb7b7b4e54aadb410b90b0aea7.png"><br><br>  In a telegram like this: <br><br><img src="https://habrastorage.org/files/bb0/8b4/bf1/bb08b4bf1b494a1f8c48852da18b8aec.png"><br><br><h3>  the end </h3><br>  Well, that's basically all I wanted to tell.  It is worth mentioning the problems when using such a bot. <br><br>  For skype: <br><br><ul><li>  need a fresh version of the client (linux is quite old and the bots will not go there) </li><li>  I added one bot as a simple contact - through the search, I couldn‚Äôt add a second bot, it came out only through a link like <b><a href="https://join.skype.com/bot/6877d5c8-dc4f-4eda-9aac-29b19e1761f0">join.skype.com/bot/6877d5c8-dc4f-4eda-9aac-29b19e1761f0</a></b> </li></ul><br>  For telegram: <br><br><ul><li>  It is not possible to contact the bot in the group through the <b>@</b> sign, the bot message does not go, the bot message goes if you put the <b>/</b> sign in front of the message, i.e.  so "/ hi bot" </li></ul><br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/308036/">https://habr.com/ru/post/308036/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../308026/index.html">Introducing RAIL: Site Performance Assessment Model</a></li>
<li><a href="../308028/index.html">0day vulnerabilities in lshell</a></li>
<li><a href="../308030/index.html">A critical vulnerability has been discovered in the encryption library Libgcrypt for 18 years.</a></li>
<li><a href="../308032/index.html">We use Secure Boot in Linux to the fullest</a></li>
<li><a href="../308034/index.html">Three-position checkbox (aka tristate) without scripts and SMS</a></li>
<li><a href="../308038/index.html">Flash revolution</a></li>
<li><a href="../308040/index.html">Friendly introduction to Dagger 2. Part 2</a></li>
<li><a href="../308042/index.html">We found 10,000 bugs in various open source projects.</a></li>
<li><a href="../308044/index.html">How does the MTS Mobile Network Operations Center work?</a></li>
<li><a href="../308050/index.html">Questions Heilmeyer, Pierce and our developers answers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>