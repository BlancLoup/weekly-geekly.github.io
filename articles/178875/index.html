<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MySQL Database Sync Overview</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When developing modern web applications, it is difficult to underestimate the benefits of using version control systems. In relation to the files of t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MySQL Database Sync Overview</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/d22/876/702/d228767027f9250b01303a59f04d676f.png" alt="image" align="left"><br><br>  When developing modern web applications, it is difficult to underestimate the benefits of using version control systems.  In relation to the files of the developed product, we are able to track any stages of production at any time, starting with the first revision.  The tools that help us in this are popularized today, are considered good form when developing, and in many cases, successful production without their use is impossible in principle.  And what opportunities do we have when it becomes necessary to trace changes not in the files, but in the project databases?  Under the cut, I will share information about existing tools with which I had to read. <br><a name="habracut"></a><br><br><br><h4>  1. PHP SQLDIFF, aka SQLDiff </h4>  ( <a href="http://phpsqldiff.sourceforge.net/">http://phpsqldiff.sourceforge.net/</a> ) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      A PHP script that allows you to see the complete differences (both in structure and in data) between any two database tables.  There are no tools for automatic synchronization of the structure or data in the tool - only visual information is provided.  Another of the significant drawbacks is the ability to connect only to the database, which can be accessed directly (not through an ssh tunnel).  Slow speed of work on large amounts of data (work through a pear-module, which does not shine neither novelty nor speed).  I consider this script to be very useful for the developer in cases when it is necessary to understand and visualize the differences between different tables - it has a convenient interface, quick setup.  I would rather characterize as a useful pocket utility for quickly gaining insight about the desynchronization of tables, which in theory should be identical, rather than as a serious tool that can be used to automate synchronization processes. <br><br><h4>  2. LIQUIBASE </h4>  ( <a href="http://www.liquibase.org/">http://www.liquibase.org/</a> ) <br><br>  Convenient multi-functional and easy-to-use database structure migrator to java.  I see for myself in this plus, if used in conjunction with Jenkins. <br>  Example (host1 is the server from which the database structure is to be copied; host2 is the server to which the structure is to be transferred from host1): <br><br><pre><code class="bash hljs">java -jar liquibase.jar --driver=com.mysql.jdbc.Driver \ --classpath=mysql-connector-java-5.1.xx-bin.jar \ --logFile=db.ExampleChangelog.xml \ --url=<span class="hljs-string"><span class="hljs-string">"jdbc:mysql://host2"</span></span> \ --defaultSchemaName=db_name \ --username=username \ --password=<span class="hljs-string"><span class="hljs-string">"password"</span></span> \ --referenceUrl=jdbc:mysql://host1 \ --referenceUsername=username \ --referencePassword=<span class="hljs-string"><span class="hljs-string">"password"</span></span> \ diffChangeLog &gt; ChangeSet.xml</code> </pre> <br><br>  Generates a changeset in xml format, the further migration of which brings the structure of the database to host2 to the state identical to host1. <br><br>  Start Migration: <br><br><pre> <code class="bash hljs">java -jar liquibase.jar --driver=com.mysql.jdbc.Driver \ --classpath=/path/to/classes \ --changeLogFile=ChangeSet.xml \ --url=<span class="hljs-string"><span class="hljs-string">"jdbc:mysql://host2"</span></span> \ --username=user \ --password=<span class="hljs-string"><span class="hljs-string">"password"</span></span> \ migrate</code> </pre><br><br>  After migration, it makes sense to check again that the changeset is empty. <br>  There is not only the synchronization of tables and fields, but also indexes, keys.  Not sure about the stored procedures - I did not check. <br><br>  Changeset can also be formed in other formats - in sql, in json (not only in xml).  Forming a changeset in sql will be useful in cases where other utilities are used for migration. <br><br><h4>  3. schemasync </h4>  ( <a href="http://schemasync.org/">http://schemasync.org/</a> ) <br><br>  A tool to synchronize the structure of the database.  It requires python and the corresponding interface for mysql. <br>  Of the significant differences with liquibase: <br>  - schemasync creates not only a changeset, but also a file that allows you to roll back the changes (the most important and most valuable advantage, although, in my opinion, does not eliminate the need to make a backup before synchronization) <br>  - liquibase allows not only to get a changeset, but also immediately start the migration by means of the utility itself.  Maybe not a killer feature, but still convenient and useful. <br><br>  schemasync works only with sql - no intermediate xml and analogues - I see for myself in this both advantages and disadvantages. <br>  Very concise syntax, minimum settings.  Allows you not to synchronize comments and autoincrement (customizable) - an unconditional plus. <br><br>  Usage example: <br><br><pre> <code class="bash hljs">schemasync mysql://user:pass@dev-host:3306/dev_db mysql://user:pass@prod-host:3306/production_db</code> </pre><br><br><h4>  4. MAATKIT data sync </h4>  ( <a href="http://www.maatkit.org/doc/">http://www.maatkit.org/doc/</a> ) <br>  mk-table-sync is a utility for synchronizing table data.  Immediately I will mention that maatkit is a whole complex of tools for working with MySQL, which provides opportunities not embedded in the original MySQL.  This is not surprising, considering that this product was created by Percona - we already got used to seeing products a la from them "We will take MySQL and add to it what it should have been in it for a long time." <br>  It works effectively with tables only if there is a primary key or a unique index (which, in general, is justified). <br>  It has an impressive number of options and settings, allows you to synchronize the master-slave, master-master configuration.  It allows you to run automatic synchronization, but we are primarily interested not in this, but in the ability to create a change log.  I think you can write a separate article on this utility, so I will not delve into the settings - I only emphasize that there are really many options and they give the developer a very flexible synchronization setting, allowing you to take into account many nuances.  It makes sense to read the original documentation (http://www.maatkit.org/doc/mk-table-sync.html). <br><br>  Usage example: <br><br><pre> <code class="bash hljs">mk-table-sync --verbose --<span class="hljs-built_in"><span class="hljs-built_in">print</span></span> --charset=DB_CHARSET, h=host, P=port1, u=user1, p=password1, t=table1, D=db1 h=host2, P=port2, u=user2, p=password2, D=db2 &gt; /__path__/ChangeLogQueries.sql</code> </pre><br><br><br><h5>  Addition 1: </h5><br>  The mentioned tools have a significant drawback, which is less important when deploying to a production-server, but constantly reminds of itself during the development process - execution speed.  Initially, the task was to build a mechanism that would automate the syncronization between sites in the chain ‚Äúdevelopers - test servers - stage - production‚Äù.  Starting (in the above-mentioned chain) from test servers everything is quite simple - only time is needed from the resources, the load is minimal.  If the process is carried out automatically according to a schedule at night, then it is not important how long it has been completed, but not to create a load and that the task should be fully completed by morning.  If the synchronization is regular, then the lists of changes will never be excessively large, and the load will be negligible.  Another thing when it comes to synchronization between the developer site and the test server.  In this case, synchronization, which takes 1 hour, will always be tangible and will create inconvenience.  These circumstances and prompted the synchronization tool number 5: <br><br><h4>  5. "Semi-automatic synchronization". </h4><br>  In the utilities described above, a large (slightly less than completely) part of the time is occupied by the formation of a list of differences.  Then apply the script to eliminate the differences - the action is quite fast (again, not an axiom, but in most cases in the development process).  This suggests that it is possible to work on the manual formation of a list of differences, and to automate only its application.  There are only two obvious ways: <br>  a) in any product there are methods for working with the database - it does not matter whether you use a popular framework or your product has a home-made core.  It is enough to fix all the necessary requests (if only the structure is interested in - DDL, if the data is also update and delete, for example) in its own repository; <br>  b) if your framework (and even more with this cms) does not have the ability to extend the methods of the class that works with the database and does not even have an event handler in the method that performs the query to the database, you can parse the log of all queries (I hope the ability to enable such a log has all target software) and record only the necessary actions from this log. <br><br>  This ‚Äúsemi-automatic synchronization‚Äù with the creation of your own change logs has a right to exist, but should encourage the developer to use the above-mentioned utilities to check after synchronization that the tables really match (let it be done at least at night on a schedule to be sure that the human factor has not made its own corrections in data synchronization). <br><br><h5>  Addition 2: </h5>  (updated) <br>  Unfortunately, almost all of the tools I mentioned have a significant drawback (and I will be glad if I am mistaken, but I have not found any refutations to my words) - they all require remote access to the database using tcp / ip.  Given that the normal practice is to allow access to the database only from the local host and prohibit remote access, it will not be possible to achieve synchronization using only the tools of the mentioned utilities. <br>  Many thanks to <a href="http://habrahabr.ru/users/darkbyte/" class="user_link">DarkByte</a> user for the proposed solution with port forwarding - this solves the problem. <br><br>  Successful application and do not forget to make backups! </div><p>Source: <a href="https://habr.com/ru/post/178875/">https://habr.com/ru/post/178875/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../178861/index.html">Rules for effective meetings</a></li>
<li><a href="../178865/index.html">Web development based on Java EE + JSP + Hibernate + Maven + Spring MVC in NetBeans. Part 1</a></li>
<li><a href="../178867/index.html">Usability checklist</a></li>
<li><a href="../178869/index.html">How can I see a regular movie in 3D</a></li>
<li><a href="../178871/index.html">JIRA: create plugins. Framework Features</a></li>
<li><a href="../178877/index.html">Using schema.org markup for company logos</a></li>
<li><a href="../178881/index.html">Installing FANN Neural Network on Linux</a></li>
<li><a href="../178885/index.html">New processors in the new cloud pool</a></li>
<li><a href="../178887/index.html">Win a free participation in DEVCONF 2013, the creative opens the door for you!</a></li>
<li><a href="../178889/index.html">JavaOne Russia or Kuksenko‚Äôs benefit performance with Shipilev. Conference report</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>