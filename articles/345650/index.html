<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Achieving Maximum Performance Fast Fourier Transform Based on Data Management</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Now the problem of productivity of applications with digital signal processing is solved using specialized equipment. At the same time, such equipment...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Achieving Maximum Performance Fast Fourier Transform Based on Data Management</h1><div class="post__text post__text-html js-mediator-article">  Now the problem of productivity of applications with digital signal processing is solved using specialized equipment.  At the same time, such equipment also requires programs optimized for it. <br><br>  There are several approaches for fitting the algorithms to the machine architecture, one of which is data management.  Anyone who has experienced manual data programming knows that this is not a simple matter.  However, in most cases, you can design a pre-compiler that will significantly simplify the task.  The article describes the method for constructing two data-driven FFT algorithms and methods for achieving maximum performance that exceeds the theoretical one. <br><a name="habracut"></a><br><h3>  A bit of math </h3><br>  N time samples of any signal can be converted to N phase-frequencies using the Direct Discrete Fourier Transform. <br><br>  X <sub>k</sub> = <sub>n = 0</sub> <sup>N ‚àí 1</sup> ‚àë x <sub>n</sub> * œâ <sub>N</sub> <sup>kn</sup> , k = 0..N-1, œâ <sub>N</sub> = e <sup>-2œÄi / N</sup> , i = <sup>2</sup> ‚àö -1; 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In order to obtain a complex phase-frequency spectrum {X}, it is also necessary to convert time samples {x} into a complex view with zero imaginary part.  The rotating multiplier œâ is a ‚Äúrotating vector‚Äù on the unit circle in the complex plane. <br>  To simplify the calculations, the Fast Fourier Transform is used, where N is a power of 2. In this case, the complex signal X = (x <sub>0</sub> , x <sub>1</sub> <sub>...</sub> x <sub>n-1</sub> ) can be divided into two A = (x <sub>0</sub> , x <sub>2</sub> <sub>...</sub> x <sub>n- 2</sub> ) and B = (x <sub>1</sub> , x <sub>3</sub> <sub>...</sub> x <sub>n-1</sub> ) already from N / 2 samples. <br><br>  A <sub>k</sub> = <sub>n = 0</sub> <sup>N / 2-1</sup> ‚àë x <sub>2 n</sub> * œâ <sub>N</sub> <sup>k (2n)</sup> ; <br>  B <sub>k</sub> = <sub>n = 0</sub> <sup>N / 2-1</sup> ‚àë x <sub>2 n + 1</sub> * œâ <sub>N</sub> <sup>k (2n + 1)</sup> = <sub>n = 0</sub> <sup>N / 2-1</sup> ‚àë x <sub>2 n + 1</sub> * œâ <sub>N</sub> <sup>k</sup> * œâ <sub>N</sub> <sup>k ( 2n)</sup> = œâ <sub>N</sub> <sup>k</sup> * <sub>n = 0</sub> <sup>N / 2-1</sup> ‚àë x <sub>2 n + 1</sub> * œâ <sub>N</sub> <sup>k (2n)</sup> ; <br><br>  Now we can derive the formula we need: X <sub>k</sub> = A <sub>k</sub> + œâ <sub>N</sub> <sup>k</sup> * B <sub>k</sub> ; <br><br>  Here, the N phase frequencies of our signal can be obtained by applying the FFT in turn for N / 2 even counts and for N / 2 odd counts.  In the next step, A and B again split in half.  It is worth noting that this approach is applicable to the Inverse Fourier Transform, which is not considered here. <br><br><h3>  C ++ FFT </h3><br>  The recursive implementation [1] of the FFT according to the above formulas is simple and is given below: <br><br><pre><code class="hljs delphi">#include &lt;complex&gt; #include &lt;vector&gt; #include &lt;algorithm&gt; #include &lt;iostream&gt; #include &lt;math.h&gt; #define M_PI <span class="hljs-number"><span class="hljs-number">3.14159265358979323846</span></span> using namespace std; typedef complex&lt;double&gt; w_type; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> vector&lt;w_type&gt; fft(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> vector&lt;w_type&gt; &amp;<span class="hljs-keyword"><span class="hljs-keyword">In</span></span>) <span class="hljs-comment"><span class="hljs-comment">{ int i = 0, wi = 0; int n = In.size(); vector&lt;w_type&gt; A(n / 2), B(n / 2), Out(n); if (n == 1) { return vector&lt;w_type&gt;(1, In[0]); }</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; copy_if( <span class="hljs-keyword"><span class="hljs-keyword">In</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(), <span class="hljs-keyword"><span class="hljs-keyword">In</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(), A.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(), [&amp;i] (w_type e) <span class="hljs-comment"><span class="hljs-comment">{ return !(i++ % 2); }</span></span> ); copy_if( <span class="hljs-keyword"><span class="hljs-keyword">In</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(), <span class="hljs-keyword"><span class="hljs-keyword">In</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(), B.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(), [&amp;i] (w_type e) <span class="hljs-comment"><span class="hljs-comment">{ return (i++ % 2); }</span></span> ); vector&lt;w_type&gt; At = fft(A); vector&lt;w_type&gt; Bt = fft(B); transform(At.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(), At.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(), Bt.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(), <span class="hljs-keyword"><span class="hljs-keyword">Out</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(), [&amp;wi, &amp;n] (w_type&amp; a, w_type&amp; b) <span class="hljs-comment"><span class="hljs-comment">{ return a + b * exp(w_type(0, 2 * M_PI * wi++ / n)); }</span></span>); transform(At.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(), At.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(), Bt.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(), <span class="hljs-keyword"><span class="hljs-keyword">Out</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>() + n / <span class="hljs-number"><span class="hljs-number">2</span></span>, [&amp;wi, &amp;n] (w_type&amp; a, w_type&amp; b) <span class="hljs-comment"><span class="hljs-comment">{ return a + b * exp(w_type(0, 2 * M_PI * wi++ / n)); }</span></span>); return <span class="hljs-keyword"><span class="hljs-keyword">Out</span></span>; } void main(int argc, char* argv[]) <span class="hljs-comment"><span class="hljs-comment">{ int ln = (int)floor( log(argc - 1.0) / log(2.0) ); vector&lt;w_type&gt; In(1 &lt;&lt; ln); std::transform(argv + 1, argv + argc, In.begin(),[&amp;](const char* arg) { return w_type(atof(arg), 0); }</span></span>); vector&lt;w_type&gt; <span class="hljs-keyword"><span class="hljs-keyword">Out</span></span> = fft(<span class="hljs-keyword"><span class="hljs-keyword">In</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (vector&lt;w_type&gt;::iterator itr = <span class="hljs-keyword"><span class="hljs-keyword">Out</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(); itr != <span class="hljs-keyword"><span class="hljs-keyword">Out</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(); itr++) <span class="hljs-comment"><span class="hljs-comment">{ cout &lt;&lt; *itr &lt;&lt; endl; }</span></span> }</code> </pre> <br>  The real parts of the complex values ‚Äã‚Äãof the input vector consist of input parameters, the number of which is truncated to the nearest degree 2-ki.  The first level of recursion breaks the signal In from n-values ‚Äã‚Äãinto 2 signals A and B, each of which consists of n / 2 values.  The next level splits the data into 4 signals at n / 4 values.  Recursion stops when only a signal of one value remains.  Signals A and B are converted to At and Bt, and then to the returned vector of signals Out.  At the end, the program outputs the real and imaginary parts of the phase-frequency signal from the output vector. <br><br><h3>  Levels of abstraction </h3><br>  The higher the level of abstraction of the application language, the less effort is required for programming.  But the lower the performance.  You can write more efficient code, reducing the level of abstraction, but spending more effort.  Let us analyze this on the basis of the elementary FFT operation, which can be represented as C = a + w * b in a complex form.  This formula is generally implemented through multiplication with accumulation, therefore it has the abbreviation MAC (multiply ‚Äì accumulate operation): <br><table><tbody><tr><td>  Prototype </td><td> <code>void w_mac( w_type* cc, w_type a, w_type w, w_type b)</code> </td> </tr><tr><td>  C ++ </td><td> <code>*cc = a + b * exp(w_type(0, 2 * M_PI * w / n))</code> </td> </tr><tr><td>  Classic C </td><td> <code>cc-&gt;r = ar + wr * br - wi * bi; <br> cc-&gt;i = ai + wr * bi + wi * br;</code> </td> </tr><tr><td>  Optimized C </td><td> <code>register double reg; <br> reg = mac(ar, wr, br); <br> cc-&gt;r = mac(reg, -wi, bi); <br> reg = mac(ai, wr, bi ); <br> cc-&gt;i = mac(reg, wi * br );</code> </td> </tr></tbody></table>  The logarithm of base 2 of the size of the signal determines the number of recursions.  Several styles of the n2ln function are listed below. <table><tbody><tr><td>  Prototype </td><td> <code>int n2ln( int n )</code> </td> </tr><tr><td>  C ++ </td><td> <code>return (int)floor( log(n) / log(2.0) );</code> </td> </tr><tr><td>  Classic C </td><td> <code>int ln = 0; <br> while (n &gt;&gt;= 1) ln++;</code> </td> </tr><tr><td>  Built In </td><td><pre> <code class="hljs ruby"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n/<span class="hljs-number"><span class="hljs-number">256</span></span> <span class="hljs-string"><span class="hljs-string">?n</span></span>/<span class="hljs-number"><span class="hljs-number">4048</span></span> <span class="hljs-string"><span class="hljs-string">?n</span></span>/<span class="hljs-number"><span class="hljs-number">16348</span></span> <span class="hljs-string"><span class="hljs-string">?n</span></span>/<span class="hljs-number"><span class="hljs-number">32768</span></span>?<span class="hljs-number"><span class="hljs-number">15</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:n/</span></span><span class="hljs-number"><span class="hljs-number">8096</span></span>?<span class="hljs-number"><span class="hljs-number">13</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:n/</span></span><span class="hljs-number"><span class="hljs-number">1024</span></span> <span class="hljs-string"><span class="hljs-string">?n</span></span>/<span class="hljs-number"><span class="hljs-number">2048</span></span>?<span class="hljs-number"><span class="hljs-number">11</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:n/</span></span><span class="hljs-number"><span class="hljs-number">512</span></span>?<span class="hljs-number"><span class="hljs-number">9</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:n/</span></span><span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-string"><span class="hljs-string">?n</span></span>/<span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-string"><span class="hljs-string">?n</span></span>/<span class="hljs-number"><span class="hljs-number">128</span></span>?<span class="hljs-number"><span class="hljs-number">7</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:n/</span></span><span class="hljs-number"><span class="hljs-number">32</span></span>?<span class="hljs-number"><span class="hljs-number">5</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:n/</span></span><span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-string"><span class="hljs-string">?n</span></span>/<span class="hljs-number"><span class="hljs-number">8</span></span>?<span class="hljs-number"><span class="hljs-number">3</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:n/</span></span><span class="hljs-number"><span class="hljs-number">2</span></span>?<span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre> </td></tr></tbody></table>  In the latest implementation, the worst case execution is equal to the average case, which the C compiler can implement with the help of 3 shifts and 4 conditional jumps.  In addition, this implementation can be represented as a macro to calculate the values ‚Äã‚Äãof the constants at compile time. <br><br><h3>  FFT on C </h3><br>  The classic implementation of recursive C FFT is similar to the C ++ variant. <br><br><pre> <code class="hljs mel">#include &lt;stdlib.h&gt; #include &lt;stdio.h&gt; #include &lt;math.h&gt; #define M_PI <span class="hljs-number"><span class="hljs-number">3.14159265358979323846</span></span> typedef struct { double r; double i; } w_type; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n2ln( <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n ); void w_mac( w_type* cc, w_type a, w_type w, w_type b ); static void fft0( w_type InOut[], <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n ) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; w_type w, *A, *B; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n == <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; A = malloc( sizeof(w_type) * n / <span class="hljs-number"><span class="hljs-number">2</span></span> ); B = malloc( sizeof(w_type) * n / <span class="hljs-number"><span class="hljs-number">2</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; n / <span class="hljs-number"><span class="hljs-number">2</span></span>; i++) { A[i] = InOut[i * <span class="hljs-number"><span class="hljs-number">2</span></span>]; B[i] = InOut[i * <span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>]; } fft0( A, n / <span class="hljs-number"><span class="hljs-number">2</span></span> ); fft0( B, n / <span class="hljs-number"><span class="hljs-number">2</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; n; i++) { wr = <span class="hljs-keyword"><span class="hljs-keyword">cos</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span> * M_PI * i / n); wi = <span class="hljs-keyword"><span class="hljs-keyword">sin</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span> * M_PI * i / n); w_mac( &amp;InOut[i], A[i % (n / <span class="hljs-number"><span class="hljs-number">2</span></span>)], w, B[i % (n / <span class="hljs-number"><span class="hljs-number">2</span></span>)] ); } free( A ); free( B ); } void main( <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> argc, char * argv[] ) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ln = n2ln(argc - <span class="hljs-number"><span class="hljs-number">1</span></span>); w_type* InOut = malloc( (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; ln) * sizeof(w_type) ); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; ln); i++) { InOut[i].r = atof(argv[i+<span class="hljs-number"><span class="hljs-number">1</span></span>]); InOut[i].i = <span class="hljs-number"><span class="hljs-number">0</span></span>; } fft0( InOut, <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; ln ); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; ln); i++) { printf(<span class="hljs-string"><span class="hljs-string">"%.4f %.4f\n"</span></span>, InOut[i].r, InOut[i].i); } }</code> </pre> <br>  Regarding the C ++ implementation, several algorithmic changes have been made here.  First, complex calculations are made manually.  Secondly, to save memory, the input and output vector from the C ++ implementation are combined into one buffer.  Buffers are allocated explicitly, because the size of the transformation needs to be transferred to a recursive function. <br><br><h3>  C FFT implementation based on data management </h3><br>  An example of a recursive FFT based on data management, made from a previous implementation in C. <br><br><pre> <code class="hljs swift">#include &lt;stdlib.h&gt; #include &lt;stdio.h&gt; #include &lt;math.h&gt; #define <span class="hljs-type"><span class="hljs-type">M_PI</span></span> <span class="hljs-number"><span class="hljs-number">3.14159265358979323846</span></span> #define <span class="hljs-type"><span class="hljs-type">LN_FFT</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-comment"><span class="hljs-comment">/* number of samples is 1 &lt;&lt; LN_FFT */</span></span> typedef <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span></span>{ double r; double i; } w_type; int n2ln( int n ); void w_mac( w_type* cc, w_type a, w_type w, w_type b ); <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">tMac</span></span></span><span class="hljs-class"> </span></span>{ w_type *<span class="hljs-built_in"><span class="hljs-built_in">c</span></span>, *a, *b, w; } <span class="hljs-type"><span class="hljs-type">Mac</span></span>[<span class="hljs-type"><span class="hljs-type">LN_FFT</span></span> * (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-type"><span class="hljs-type">LN_FFT</span></span>)]; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> int nMac; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> w_type <span class="hljs-type"><span class="hljs-type">DataTrace</span></span>[<span class="hljs-type"><span class="hljs-type">LN_FFT</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-type"><span class="hljs-type">LN_FFT</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> int <span class="hljs-type"><span class="hljs-type">BusyDataTrace</span></span>[<span class="hljs-type"><span class="hljs-type">LN_FFT</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> void calculate_macs() { int i; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; nMac; i++) { w_mac(<span class="hljs-type"><span class="hljs-type">Mac</span></span>[i].<span class="hljs-built_in"><span class="hljs-built_in">c</span></span>, *<span class="hljs-type"><span class="hljs-type">Mac</span></span>[i].a, <span class="hljs-type"><span class="hljs-type">Mac</span></span>[i].w, *<span class="hljs-type"><span class="hljs-type">Mac</span></span>[i].b); } } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> void record_mac( w_type** cc, w_type* a, w_type w, w_type *b, int n ) { int ln = n2ln(n); int i = <span class="hljs-type"><span class="hljs-type">BusyDataTrace</span></span>[ln]++; *cc = &amp;<span class="hljs-type"><span class="hljs-type">DataTrace</span></span>[ln][i]; <span class="hljs-type"><span class="hljs-type">Mac</span></span>[nMac].<span class="hljs-built_in"><span class="hljs-built_in">c</span></span> = &amp;<span class="hljs-type"><span class="hljs-type">DataTrace</span></span>[ln][i]; <span class="hljs-type"><span class="hljs-type">Mac</span></span>[nMac].w = w; <span class="hljs-type"><span class="hljs-type">Mac</span></span>[nMac].a = a; <span class="hljs-type"><span class="hljs-type">Mac</span></span>[nMac].b = b; nMac++; } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> void fft0( w_type* <span class="hljs-type"><span class="hljs-type">InOut</span></span>[], int n ) { int i; w_type w, **<span class="hljs-type"><span class="hljs-type">A</span></span>, **<span class="hljs-type"><span class="hljs-type">B</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n == <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-type"><span class="hljs-type">A</span></span> = malloc( <span class="hljs-built_in"><span class="hljs-built_in">sizeof</span></span>(w_type*) * n / <span class="hljs-number"><span class="hljs-number">2</span></span> ); <span class="hljs-type"><span class="hljs-type">B</span></span> = malloc( <span class="hljs-built_in"><span class="hljs-built_in">sizeof</span></span>(w_type*) * n / <span class="hljs-number"><span class="hljs-number">2</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; n / <span class="hljs-number"><span class="hljs-number">2</span></span>; i++) { <span class="hljs-type"><span class="hljs-type">A</span></span>[i] = <span class="hljs-type"><span class="hljs-type">InOut</span></span>[i * <span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-type"><span class="hljs-type">B</span></span>[i] = <span class="hljs-type"><span class="hljs-type">InOut</span></span>[i * <span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>]; } fft0( &amp;<span class="hljs-type"><span class="hljs-type">A</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>], n / <span class="hljs-number"><span class="hljs-number">2</span></span> ); fft0( &amp;<span class="hljs-type"><span class="hljs-type">B</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>], n / <span class="hljs-number"><span class="hljs-number">2</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; n; i++) { wr = cos(<span class="hljs-number"><span class="hljs-number">2</span></span> * <span class="hljs-type"><span class="hljs-type">M_PI</span></span> * i / n); wi = sin(<span class="hljs-number"><span class="hljs-number">2</span></span> * <span class="hljs-type"><span class="hljs-type">M_PI</span></span> * i / n); record_mac( &amp;<span class="hljs-type"><span class="hljs-type">InOut</span></span>[i], <span class="hljs-type"><span class="hljs-type">A</span></span>[i % (n / <span class="hljs-number"><span class="hljs-number">2</span></span>)], w, <span class="hljs-type"><span class="hljs-type">B</span></span>[i % (n / <span class="hljs-number"><span class="hljs-number">2</span></span>)], n ); } free(<span class="hljs-type"><span class="hljs-type">A</span></span>); free(<span class="hljs-type"><span class="hljs-type">B</span></span>); } void main( int argc, char* argv[] ) { int i; w_type** <span class="hljs-type"><span class="hljs-type">InOut</span></span> = malloc( <span class="hljs-built_in"><span class="hljs-built_in">sizeof</span></span>(w_type*) * (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-type"><span class="hljs-type">LN_FFT</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-type"><span class="hljs-type">LN_FFT</span></span>); i++) { <span class="hljs-type"><span class="hljs-type">InOut</span></span>[i] = &amp;<span class="hljs-type"><span class="hljs-type">DataTrace</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>][i]; <span class="hljs-type"><span class="hljs-type">DataTrace</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>][i].r = atof( argv[i % (argc - <span class="hljs-number"><span class="hljs-number">1</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>] ); <span class="hljs-type"><span class="hljs-type">DataTrace</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>][i].i = <span class="hljs-number"><span class="hljs-number">0</span></span>; } fft0( <span class="hljs-type"><span class="hljs-type">InOut</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-type"><span class="hljs-type">LN_FFT</span></span> ); calculate_macs(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-type"><span class="hljs-type">LN_FFT</span></span>); i++) { printf(<span class="hljs-string"><span class="hljs-string">"%.4f %.4f\n"</span></span>, <span class="hljs-type"><span class="hljs-type">DataTrace</span></span>[<span class="hljs-type"><span class="hljs-type">LN_FFT</span></span>][i].r, <span class="hljs-type"><span class="hljs-type">DataTrace</span></span>[<span class="hljs-type"><span class="hljs-type">LN_FFT</span></span>][i].i); } free(<span class="hljs-type"><span class="hljs-type">InOut</span></span>); }</code> </pre> <br>  Here, the computation buffer contains not the complex values ‚Äã‚Äãthemselves, but pointers to them.  In a Mac array, deferred elementary BNF operations are actually sequentially written in order to be done later.  In other words, this is a bytecode for elementary BNF operations. <br><br>  A two-dimensional DataTrace array is used to support these operations.  After calling the recursive procedure, the user must call calculate_macs to execute the generated bytecode.  This procedure has only one cycle, but can be applied repeatedly.  This is the maximum performance for the theoretical complexity of the FFT n * log2 (n).  But the problem here is in the memory - Mac and DataTrace also have n * log2 (n) elements.  And that's too much for low-cost embedded solutions. <br><br><h3>  Tabular implementation </h3><br>  Now it's time to divide the previous FFT implementation into two programs.  The first one will generate C bytecode structures, and the second will execute them.  With this approach, the C structures generator is in fact a pre-compiler, in which one can implement various optimization strategies, for example, for optimizing RAM memory, without sparing resources.  Earlier, the DataTrace is an array of N * log2 (N) elements; in the program below, its analog XY array has a total of N + 2 elements. <br><br><pre> <code class="hljs rust">#include &lt;stdlib.h&gt; #include &lt;stdio.h&gt; #define LN_FFT <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-comment"><span class="hljs-comment">/* power of 2 is number of fft points */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* */</span></span> #define W_0_02 <span class="hljs-number"><span class="hljs-number">1.000000000000000</span></span> <span class="hljs-comment"><span class="hljs-comment">/* angle 0.00 dg */</span></span> #define W_1_04 <span class="hljs-number"><span class="hljs-number">0.000000000000000</span></span> <span class="hljs-comment"><span class="hljs-comment">/* angle 90.00 dg */</span></span> #define W_1_08 <span class="hljs-number"><span class="hljs-number">0.707106781186548</span></span> <span class="hljs-comment"><span class="hljs-comment">/* angle 45.00 dg */</span></span> #define W_1_16 <span class="hljs-number"><span class="hljs-number">0.923879532511287</span></span> <span class="hljs-comment"><span class="hljs-comment">/* angle 22.50 dg */</span></span> #define W_3_16 <span class="hljs-number"><span class="hljs-number">0.382683432365090</span></span> <span class="hljs-comment"><span class="hljs-comment">/* angle 67.50 dg */</span></span> typedef <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> {</span></span> double r; double i; } w_type; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fft_tbl</span></span></span></span> { double wr, wi; unsigned <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> c, a, b; } tbl[] = { { W_0_02,+W_1_04,<span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>}, {-W_0_02,+W_1_04,<span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>}, { W_0_02,+W_1_04, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">12</span></span>}, {-W_0_02,+W_1_04, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">12</span></span>}, { W_0_02,+W_1_04, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>}, {-W_0_02,+W_1_04,<span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>}, { W_0_02,+W_1_04, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">14</span></span>}, {-W_0_02,+W_1_04,<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">14</span></span>}, { W_0_02,+W_1_04, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>}, {-W_0_02,+W_1_04,<span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>}, { W_0_02,+W_1_04, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">13</span></span>}, {-W_0_02,+W_1_04, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">13</span></span>}, { W_0_02,+W_1_04, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">11</span></span>}, {-W_0_02,+W_1_04,<span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">11</span></span>}, { W_0_02,+W_1_04, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>,<span class="hljs-number"><span class="hljs-number">15</span></span>}, {-W_0_02,+W_1_04,<span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>,<span class="hljs-number"><span class="hljs-number">15</span></span>}, { W_0_02,+W_1_04, <span class="hljs-number"><span class="hljs-number">7</span></span>,<span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, {-W_0_02,+W_1_04,<span class="hljs-number"><span class="hljs-number">15</span></span>,<span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, { W_1_04,+W_0_02,<span class="hljs-number"><span class="hljs-number">16</span></span>,<span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>}, {-W_1_04,-W_0_02, <span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>}, { W_0_02,+W_1_04,<span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}, {-W_0_02,+W_1_04, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}, { W_1_04,+W_0_02, <span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">12</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>}, {-W_1_04,-W_0_02, <span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">12</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>}, { W_0_02,+W_1_04,<span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {-W_0_02,+W_1_04,<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, { W_1_04,+W_0_02, <span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>}, {-W_1_04,-W_0_02, <span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>}, { W_0_02,+W_1_04,<span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>}, {-W_0_02,+W_1_04, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>}, { W_1_04,+W_0_02, <span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">13</span></span>,<span class="hljs-number"><span class="hljs-number">11</span></span>}, {-W_1_04,-W_0_02, <span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">13</span></span>,<span class="hljs-number"><span class="hljs-number">11</span></span>}, { W_0_02,+W_1_04,<span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>,<span class="hljs-number"><span class="hljs-number">17</span></span>}, {-W_0_02,+W_1_04,<span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>,<span class="hljs-number"><span class="hljs-number">17</span></span>}, { W_1_08,+W_1_08, <span class="hljs-number"><span class="hljs-number">7</span></span>,<span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>}, {-W_1_08,-W_1_08,<span class="hljs-number"><span class="hljs-number">17</span></span>,<span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>}, { W_1_04,+W_0_02,<span class="hljs-number"><span class="hljs-number">16</span></span>,<span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>}, {-W_1_04,-W_0_02, <span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>}, {-W_1_08,+W_1_08,<span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}, { W_1_08,-W_1_08, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}, { W_0_02,+W_1_04, <span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">12</span></span>,<span class="hljs-number"><span class="hljs-number">14</span></span>}, {-W_0_02,+W_1_04, <span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">12</span></span>,<span class="hljs-number"><span class="hljs-number">14</span></span>}, { W_1_08,+W_1_08,<span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>}, {-W_1_08,-W_1_08,<span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>}, { W_1_04,+W_0_02, <span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>}, {-W_1_04,-W_0_02, <span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>}, {-W_1_08,+W_1_08,<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>}, { W_1_08,-W_1_08, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>}, { W_0_02,+W_1_04, <span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, {-W_0_02,+W_1_04, <span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, { W_1_16,+W_3_16,<span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>,<span class="hljs-number"><span class="hljs-number">12</span></span>}, {-W_1_16,-W_3_16, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>,<span class="hljs-number"><span class="hljs-number">12</span></span>}, { W_1_08,+W_1_08, <span class="hljs-number"><span class="hljs-number">7</span></span>,<span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>}, {-W_1_08,-W_1_08,<span class="hljs-number"><span class="hljs-number">12</span></span>,<span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>}, { W_3_16,+W_1_16,<span class="hljs-number"><span class="hljs-number">16</span></span>,<span class="hljs-number"><span class="hljs-number">15</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>}, {-W_3_16,-W_1_16, <span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">15</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>}, { W_1_04,+W_0_02,<span class="hljs-number"><span class="hljs-number">15</span></span>,<span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}, {-W_1_04,-W_0_02,<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}, {-W_3_16,+W_1_16,<span class="hljs-number"><span class="hljs-number">11</span></span>,<span class="hljs-number"><span class="hljs-number">17</span></span>,<span class="hljs-number"><span class="hljs-number">14</span></span>}, { W_3_16,-W_1_16, <span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">17</span></span>,<span class="hljs-number"><span class="hljs-number">14</span></span>}, {-W_1_08,+W_1_08,<span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>}, { W_1_08,-W_1_08,<span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>}, {-W_1_16,+W_3_16, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>}, { W_1_16,-W_3_16, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>}, }; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> unsigned <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> OutOrder[]={ <span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">13</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span>,<span class="hljs-number"><span class="hljs-number">16</span></span>,<span class="hljs-number"><span class="hljs-number">15</span></span>,<span class="hljs-number"><span class="hljs-number">11</span></span>,<span class="hljs-number"><span class="hljs-number">17</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">12</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">14</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>,}; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> {</span></span> double r; double i; } XY[(<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; LN_FFT) + <span class="hljs-number"><span class="hljs-number">2</span></span>]; void fft_table() { int i; register <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fft_tbl</span></span></span></span>* t; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>, t = tbl; i &lt; <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(tbl) / <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(tbl[<span class="hljs-number"><span class="hljs-number">0</span></span>]); i++, t++) { XY[t-&gt;c].r = XY[t-&gt;a].r + t-&gt;wr * XY[t-&gt;b].r - t-&gt;wi * XY[t-&gt;b].i; XY[t-&gt;c].i = XY[t-&gt;a].i + t-&gt;wr * XY[t-&gt;b].i + t-&gt;wi * XY[t-&gt;b].r; } } void main(int argc, <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>* argv[]) { int i; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; LN_FFT); i++) { XY[i].r = atof( argv[i % (argc - <span class="hljs-number"><span class="hljs-number">1</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>] ); XY[i].i = <span class="hljs-number"><span class="hljs-number">0</span></span>; } fft_table(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; LN_FFT); i++) { printf(<span class="hljs-string"><span class="hljs-string">"%.4f %.4f\n"</span></span>, XY[OutOrder[i]].r, XY[OutOrder[i]].i); } }</code> </pre> <br>  This is an example of FFT for 16 counts.  One element of the tbl array contains the complex value of the turning factor and three offsets for organizing calculations on the cells of the XY array.  At the same time, the code itself has only one ‚Äúfor‚Äù cycle. <br><br><h3>  Caterpillar method </h3><br>  The following example is based on the grouping of elementary FFT operations with respect to the turning factor. <br><br><pre> <code class="hljs django"><span class="xml"><span class="xml">#include </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">stdlib.h</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> #include </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">stdio.h</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> #define LN_FFT 5 /* power of 2 is number of fft points */ /* */ #define W_0_02 1.000000000000000 /* angle 0.00 dg */ #define W_0_04 0.000000000000000 /* angle 90.00 dg */ #define W_0_08 0.707106781186547 /* angle 45.00 dg */ #define W_0_16 0.923879532511287 /* angle 22.50 dg */ #define W_1_16 0.382683432365090 /* angle 67.50 dg */ #define W_0_32 0.980785280403230 /* angle 11.25 dg */ #define W_1_32 0.831469612302545 /* angle 33.75 dg */ #define W_2_32 0.555570233019602 /* angle 56.25 dg */ #define W_3_32 0.195090322016128 /* angle 78.75 dg */ typedef struct { double r; double i; } w_type; #define X2Y(a) (a + (1 </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;&lt; (</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">LN_FFT</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">1</span></span></span></span><span class="xml"><span class="hljs-tag">))) #</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">define</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XMAC</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">c</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">a</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">wr</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">wi</span></span></span></span><span class="xml"><span class="hljs-tag">) \ </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">c-</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">r = a-&gt;r + wr * X2Y(a)-&gt;r - wi * X2Y(a)-&gt;i; \ c-&gt;i = a-&gt;i + wr * X2Y(a)-&gt;i + wi * X2Y(a)-&gt;r; static w_type XY[2][(1 </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;&lt; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">LN_FFT</span></span></span></span><span class="xml"><span class="hljs-tag">)]; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">static</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">const</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">w_type</span></span></span></span><span class="xml"><span class="hljs-tag">* </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pOut</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">LN_FFT</span></span></span></span><span class="xml"><span class="hljs-tag"> % </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">2</span></span></span></span><span class="xml"><span class="hljs-tag"> ? &amp;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XY</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">1</span></span></span></span><span class="xml"><span class="hljs-tag">][</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span><span class="xml"><span class="hljs-tag">] </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">:</span></span></span></span><span class="xml"><span class="hljs-tag"> &amp;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XY</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span><span class="xml"><span class="hljs-tag">][</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span><span class="xml"><span class="hljs-tag">]; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">static</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">const</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">unsigned</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">char</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">OutOrder</span></span></span></span><span class="xml"><span class="hljs-tag">[]=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{31,15,23,14,27,13,22,12,29,11,21,</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">10</span></span></span></span><span class="xml"><span class="hljs-tag">,</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">26</span></span></span></span><span class="xml"><span class="hljs-tag">,</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">9</span></span></span></span><span class="xml"><span class="hljs-tag">,</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">20</span></span></span></span><span class="xml"><span class="hljs-tag">,</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">8</span></span></span></span><span class="xml"><span class="hljs-tag">,</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">30</span></span></span></span><span class="xml"><span class="hljs-tag">,</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">7</span></span></span></span><span class="xml"><span class="hljs-tag">,</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">19</span></span></span></span><span class="xml"><span class="hljs-tag">,</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">6</span></span></span></span><span class="xml"><span class="hljs-tag">,</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">25</span></span></span></span><span class="xml"><span class="hljs-tag">,</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">5</span></span></span></span><span class="xml"><span class="hljs-tag">,</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">18</span></span></span></span><span class="xml"><span class="hljs-tag">,</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">4</span></span></span></span><span class="xml"><span class="hljs-tag">,</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">28</span></span></span></span><span class="xml"><span class="hljs-tag">,</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">3</span></span></span></span><span class="xml"><span class="hljs-tag">,</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">17</span></span></span></span><span class="xml"><span class="hljs-tag">,</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">2</span></span></span></span><span class="xml"><span class="hljs-tag">,</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">24</span></span></span></span><span class="xml"><span class="hljs-tag">,</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">1</span></span></span></span><span class="xml"><span class="hljs-tag">,</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">16</span></span></span></span><span class="xml"><span class="hljs-tag">,</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span><span class="xml"><span class="hljs-tag">,}; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">void</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">fft_caterpillar</span></span></span></span><span class="xml"><span class="hljs-tag">() { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">int</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">j</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">lim</span></span></span></span><span class="xml"><span class="hljs-tag">; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">register</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">w_type</span></span></span></span><span class="xml"><span class="hljs-tag"> *</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">, *</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag">; /* </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pb</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">a</span></span></span></span><span class="xml"><span class="hljs-tag"> + (</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">1</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt;&lt; (</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">LN_FFT</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">1</span></span></span></span><span class="xml"><span class="hljs-tag">)) */ </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">for</span></span></span></span><span class="xml"><span class="hljs-tag"> (</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt;= </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">LN_FFT;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">++) { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">i</span></span></span></span><span class="xml"><span class="hljs-tag"> % </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">2</span></span></span></span><span class="xml"><span class="hljs-tag"> ? &amp;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XY</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">1</span></span></span></span><span class="xml"><span class="hljs-tag">][</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span><span class="xml"><span class="hljs-tag">] </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">:</span></span></span></span><span class="xml"><span class="hljs-tag"> &amp;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XY</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span><span class="xml"><span class="hljs-tag">][</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span><span class="xml"><span class="hljs-tag">]; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">i</span></span></span></span><span class="xml"><span class="hljs-tag"> % </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">2</span></span></span></span><span class="xml"><span class="hljs-tag"> ? &amp;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XY</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span><span class="xml"><span class="hljs-tag">][</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span><span class="xml"><span class="hljs-tag">] </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">:</span></span></span></span><span class="xml"><span class="hljs-tag"> &amp;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XY</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">1</span></span></span></span><span class="xml"><span class="hljs-tag">][</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span><span class="xml"><span class="hljs-tag">]; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">lim</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt;&lt; (</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">LN_FFT</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">for</span></span></span></span><span class="xml"><span class="hljs-tag"> (</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">j</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">0;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">j</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">lim</span></span></span></span><span class="xml"><span class="hljs-tag">; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">j</span></span></span></span><span class="xml"><span class="hljs-tag">++) { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">switch</span></span></span></span><span class="xml"><span class="hljs-tag"> (</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">) { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">case</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">5:</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XMAC</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">W_0_32</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-W_3_32</span></span></span></span><span class="xml"><span class="hljs-tag">); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">++; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> += </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XMAC</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">W_1_32</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-W_2_32</span></span></span></span><span class="xml"><span class="hljs-tag">); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">++; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> += </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XMAC</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">W_2_32</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-W_1_32</span></span></span></span><span class="xml"><span class="hljs-tag">); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">++; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> += </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XMAC</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">W_3_32</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-W_0_32</span></span></span></span><span class="xml"><span class="hljs-tag">); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">++; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> += </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XMAC</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-W_3_32</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-W_0_32</span></span></span></span><span class="xml"><span class="hljs-tag">); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">++; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> += </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XMAC</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-W_2_32</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-W_1_32</span></span></span></span><span class="xml"><span class="hljs-tag">); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">++; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> += </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XMAC</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-W_1_32</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-W_2_32</span></span></span></span><span class="xml"><span class="hljs-tag">); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">++; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> += </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XMAC</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-W_0_32</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-W_3_32</span></span></span></span><span class="xml"><span class="hljs-tag">); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">++; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> += </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-</span></span></span></span><span class="xml"><span class="hljs-tag">= </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">8;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XMAC</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-W_0_32</span></span></span></span><span class="xml"><span class="hljs-tag">, +</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">W_3_32</span></span></span></span><span class="xml"><span class="hljs-tag">); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">++; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> += </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XMAC</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-W_1_32</span></span></span></span><span class="xml"><span class="hljs-tag">, +</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">W_2_32</span></span></span></span><span class="xml"><span class="hljs-tag">); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">++; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> += </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XMAC</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-W_2_32</span></span></span></span><span class="xml"><span class="hljs-tag">, +</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">W_1_32</span></span></span></span><span class="xml"><span class="hljs-tag">); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">++; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> += </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XMAC</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-W_3_32</span></span></span></span><span class="xml"><span class="hljs-tag">, +</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">W_0_32</span></span></span></span><span class="xml"><span class="hljs-tag">); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">++; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> += </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XMAC</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">W_3_32</span></span></span></span><span class="xml"><span class="hljs-tag">, +</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">W_0_32</span></span></span></span><span class="xml"><span class="hljs-tag">); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">++; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> += </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XMAC</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">W_2_32</span></span></span></span><span class="xml"><span class="hljs-tag">, +</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">W_1_32</span></span></span></span><span class="xml"><span class="hljs-tag">); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">++; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> += </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XMAC</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">W_1_32</span></span></span></span><span class="xml"><span class="hljs-tag">, +</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">W_2_32</span></span></span></span><span class="xml"><span class="hljs-tag">); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">++; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> += </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XMAC</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">W_0_32</span></span></span></span><span class="xml"><span class="hljs-tag">, +</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">W_3_32</span></span></span></span><span class="xml"><span class="hljs-tag">); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">++; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> += </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">case</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">4:</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XMAC</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">W_0_16</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-W_1_16</span></span></span></span><span class="xml"><span class="hljs-tag">); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">++; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> += </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XMAC</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">W_1_16</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-W_0_16</span></span></span></span><span class="xml"><span class="hljs-tag">); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">++; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> += </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XMAC</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-W_1_16</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-W_0_16</span></span></span></span><span class="xml"><span class="hljs-tag">); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">++; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> += </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XMAC</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-W_0_16</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-W_1_16</span></span></span></span><span class="xml"><span class="hljs-tag">); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">++; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> += </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-</span></span></span></span><span class="xml"><span class="hljs-tag">= </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">4;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XMAC</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-W_0_16</span></span></span></span><span class="xml"><span class="hljs-tag">, +</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">W_1_16</span></span></span></span><span class="xml"><span class="hljs-tag">); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">++; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> += </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XMAC</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-W_1_16</span></span></span></span><span class="xml"><span class="hljs-tag">, +</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">W_0_16</span></span></span></span><span class="xml"><span class="hljs-tag">); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">++; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> += </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XMAC</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">W_1_16</span></span></span></span><span class="xml"><span class="hljs-tag">, +</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">W_0_16</span></span></span></span><span class="xml"><span class="hljs-tag">); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">++; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> += </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XMAC</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">W_0_16</span></span></span></span><span class="xml"><span class="hljs-tag">, +</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">W_1_16</span></span></span></span><span class="xml"><span class="hljs-tag">); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">++; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> += </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">case</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">3:</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XMAC</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">W_0_08</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-W_0_08</span></span></span></span><span class="xml"><span class="hljs-tag">); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">++; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> += </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XMAC</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-W_0_08</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-W_0_08</span></span></span></span><span class="xml"><span class="hljs-tag">); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">++; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> += </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-</span></span></span></span><span class="xml"><span class="hljs-tag">= </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">2;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XMAC</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-W_0_08</span></span></span></span><span class="xml"><span class="hljs-tag">, +</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">W_0_08</span></span></span></span><span class="xml"><span class="hljs-tag">); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">++; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> += </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XMAC</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">W_0_08</span></span></span></span><span class="xml"><span class="hljs-tag">, +</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">W_0_08</span></span></span></span><span class="xml"><span class="hljs-tag">); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">++; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> += </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">case</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">2:</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XMAC</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-W_0_04</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-W_0_02</span></span></span></span><span class="xml"><span class="hljs-tag">); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">++; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> += </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-</span></span></span></span><span class="xml"><span class="hljs-tag">= </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XMAC</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">W_0_04</span></span></span></span><span class="xml"><span class="hljs-tag">, +</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">W_0_02</span></span></span></span><span class="xml"><span class="hljs-tag">); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">++; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> += </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">case</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">1:</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XMAC</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-W_0_02</span></span></span></span><span class="xml"><span class="hljs-tag">, +</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">W_0_04</span></span></span></span><span class="xml"><span class="hljs-tag">); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">++; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> += </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-</span></span></span></span><span class="xml"><span class="hljs-tag">= </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">case</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0:</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XMAC</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">W_0_02</span></span></span></span><span class="xml"><span class="hljs-tag">, +</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">W_0_04</span></span></span></span><span class="xml"><span class="hljs-tag">); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pc</span></span></span></span><span class="xml"><span class="hljs-tag">++; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pa</span></span></span></span><span class="xml"><span class="hljs-tag"> += </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1;</span></span></span></span><span class="xml"><span class="hljs-tag"> } } } } </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">void</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">main</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">int</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">argc</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">char</span></span></span></span><span class="xml"><span class="hljs-tag">* </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">argv</span></span></span></span><span class="xml"><span class="hljs-tag">[]) { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">int</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">for</span></span></span></span><span class="xml"><span class="hljs-tag"> (</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">0;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt; (</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">1</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt;&lt; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">LN_FFT</span></span></span></span><span class="xml"><span class="hljs-tag">); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">++) { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XY</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span><span class="xml"><span class="hljs-tag">][</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">]</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.r</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">atof(</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">argv</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag"> % (</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">argc</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">1</span></span></span></span><span class="xml"><span class="hljs-tag">) + </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">1</span></span></span></span><span class="xml"><span class="hljs-tag">] ); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">XY</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span><span class="xml"><span class="hljs-tag">][</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">]</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.i</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">0;</span></span></span></span><span class="xml"><span class="hljs-tag"> } </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">fft_caterpillar</span></span></span></span><span class="xml"><span class="hljs-tag">(); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">for</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">0;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt; (</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">1</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt;&lt; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">LN_FFT</span></span></span></span><span class="xml"><span class="hljs-tag">); </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">++) { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">printf</span></span></span></span><span class="xml"><span class="hljs-tag">("%</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.4f</span></span></span></span><span class="xml"><span class="hljs-tag"> %</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.4f</span></span></span></span><span class="xml"><span class="hljs-tag">\</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">n</span></span></span></span><span class="xml"><span class="hljs-tag">", </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pOut</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">OutOrder</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">]]</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.r</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pOut</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">OutOrder</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">]]</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.i</span></span></span></span><span class="xml"><span class="hljs-tag">); } }</span></span></span></span></code> </pre> <br>  This is an example of FFT for 32 counts.  The number of elementary FFT operations is N. The XY array is organized according to the swap scheme and its size is 2 * N.  This makes it possible for conditional XMAC instructions to operate with 3 memory banks simultaneously, although in practice this is ignored by compilers.  However, XMAC can theoretically be implemented even by a single machine instruction. <br><br>  The best-known FFT algorithm uses complex address permutation logic, which graphically resembles butterfly wings.  But in this example, the new addresses are obtained by a simple increment from the old ones, so the name is simple - this is the caterpillar method.  It is worth noting that the long switch statement also resembles a caterpillar. <br><br><h3>  Further optimizations </h3><br>  The elementary complex FFT operation (c = a + œâ * b) consists of 4 ordinary operations: <br><br><pre> <code class="hljs matlab">reg = a.<span class="hljs-built_in"><span class="hljs-built_in">real</span></span> + w.<span class="hljs-built_in"><span class="hljs-built_in">real</span></span> * b.<span class="hljs-built_in"><span class="hljs-built_in">real</span></span>; c.<span class="hljs-built_in"><span class="hljs-built_in">real</span></span> = reg - w.<span class="hljs-built_in"><span class="hljs-built_in">imag</span></span> * b.<span class="hljs-built_in"><span class="hljs-built_in">imag</span></span>; reg = a.<span class="hljs-built_in"><span class="hljs-built_in">imag</span></span> + w.<span class="hljs-built_in"><span class="hljs-built_in">real</span></span> * b.<span class="hljs-built_in"><span class="hljs-built_in">imag</span></span>; c.<span class="hljs-built_in"><span class="hljs-built_in">imag</span></span> = reg + w.<span class="hljs-built_in"><span class="hljs-built_in">imag</span></span> * b.<span class="hljs-built_in"><span class="hljs-built_in">real</span></span>;</code> </pre> <br>  In the FFT literature [2] for these calculations, several optimization strategies can be found, which are classified below: <br><br><ul><li>  Optimizations based on FFT in / out features <br><ul><li>  The imaginary parts of the input signal are zero. </li><li>  The output phase-frequency signal is duplicated, in fact from it you need N / 2 + 1 values </li></ul></li><li>  Optimizations based on a degenerate turning factor <br><ul><li>  For œâ with values ‚Äã‚Äãof 0 and 1, the addition operation is sufficient. </li><li>  For œâ with a value of 0.7071 (45 degree angle), one multiplication operation can be saved. </li></ul></li><li>  Optimization based on consumer features FFT <br><ul><li>  FFT can take and output data in the required order specified in the pre-compiler settings </li><li>  The normalization or adjustment of the input / output window can be embedded in the FFT </li></ul></li></ul><br>  Almost all of these FFT optimizations are applicable to the caterpillar method. <br><br>  Architectural and machine optimizations are also possible.  For example, the elementary FFT operation in the code above is implemented as an XMAC macro.  It can be parallelized using SIMD instructions for x86 Intel AVX processors: <br><br><pre> <code class="hljs delphi">#define XMAC(c, a, wr, wi) \ vec1 = _mm_setr_pd(wr, wi); \ vec2 = *( __m128d*)&amp;X2Y(a)-&gt;r; \ vec1 = _mm_hadd_pd(_mm_mul_pd(vec1, _mm_mul_pd(vec2, neg)), \ _mm_mul_pd(vec1, _mm_shuffle_pd(vec2, vec2, <span class="hljs-number"><span class="hljs-number">1</span></span>))); \ *( __m128d*)c = _mm_add_pd<span class="hljs-comment"><span class="hljs-comment">(*( __m128d*)</span></span>a, vec1);</code> </pre> <br>  The above macro supports two floating point operations at the same time using 128-bit registers.  But it is worth looking at the caterpillar again - because of the peculiarities of addressing, the nearest XMACs can be combined together, for example, for implementation using 512 registers (AVX3). <br><br>  In conclusion, it should be said that the directions of development of the pre-compiler are much more than possibilities.  Therefore, the purpose of this article is to collect additional requirements and identify areas where this approach may be useful. <br><br><h3>  Sources </h3><br>  [1] <a href="http://www.emunix.emich.edu/~haynes/Papers/FFT/NotesOnRecursiveFFT.pdf">Notes on Recursive FFT (Fast Fourier Transform) algorithm, Fall 2010, COSC 511, Susan Haynes</a> <br>  [2] <a href="http://www.jjj.de/fft/fftnote.txt">Notes on the FFT, CS Burrus, Department of Electrical and Computer Engineering</a> <a href="http://www.jjj.de/fft/fftnote.txt"><br></a>  <a href="http://www.jjj.de/fft/fftnote.txt">Rice University, Houston, TX 77251-1892</a> <br>  [3] <a href="https://www.codeproject.com/Articles/1177589/Fast-Fourier-Transform-Caterpillar-Method">Caterpillar Implementation Based on Generated Code</a> <br>  [4] <a href="https://github.com/r35382/fft_caterpillar">Some fft_caterpillar examples, https://github.com/r35382/fft_caterpillar</a> </div><p>Source: <a href="https://habr.com/ru/post/345650/">https://habr.com/ru/post/345650/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../345640/index.html">Christmas magic and gifts (version 2018)</a></li>
<li><a href="../345642/index.html">Fukubukuro in LANIT office: sharing a bag of happiness</a></li>
<li><a href="../345644/index.html">‚ÄúRussian cloud‚Äù: what domestic startups use virtual infrastructure</a></li>
<li><a href="../345646/index.html">"Hack us to be beautiful"</a></li>
<li><a href="../345648/index.html">SOC for beginners. 3 myths about automation and artificial intelligence in the Security Operations Center</a></li>
<li><a href="../345652/index.html">PostgreSQL News Digest</a></li>
<li><a href="../345654/index.html">Happy semi-final stories about the automation of test schemes</a></li>
<li><a href="../345656/index.html">We try q-learning to taste, the story in three parts</a></li>
<li><a href="../345658/index.html">Why does it seem to me that students are learning OOP wrong</a></li>
<li><a href="../345660/index.html">Magic CharSequence</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>