<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ICloud integration using the example of Cut the Rope</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi habra-resident. Today, I would like to tell you about my experience of integrating iCloud into the Cut the Rope game. 

 This post was inspired by ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ICloud integration using the example of Cut the Rope</h1><div class="post__text post__text-html js-mediator-article">  Hi habra-resident.  Today, I would like to tell you about my experience of integrating iCloud into the Cut the Rope game. <br><br>  This post was inspired by the feedback from one user who came to the email address of technical support: <br>  "I didn‚Äôt need any help, I wanted to ask you something ... How did you <br>  run iCloud Cut the Rope even if it is not a universal application?  I <br>  alternate with iPhone and iPad. <br>  Unfortunately, no other developer does this. <br>  applications, so I wonder ... you are a magician you or others are not <br>  willing to do anything?  Thank you for your <br>  beautiful game and support it for long.  Hello. <br><br>  I do not know how extraordinary the fact that the iPad and iPhone versions of the application use one game progress, but today I will tell how to achieve this.  Especially since it is very simple.  I will also talk about some of the problems and their solutions that we encountered during integration. <br><a name="habracut"></a><br>  <b>What is iCloud?</b> <br>  iCloud is a free cloud service, for data storage, with support for push-technologies.  Created by Apple.  In iOS, it appeared, starting with the fifth version.  And in Mac OS starting from version 10.7 (Lion). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Design issues</b> <br>  We wanted the use of iCloud for the user to be as transparent as possible.  Therefore, by default, we disabled this feature and made a special item in the menu to enable it: <br><img src="https://habrastorage.org/storage2/4b0/610/fe4/4b0610fe41b364b9d5bb4ee4cd2fae6b.png"><br>  This is also done so that each family member can independently go through all the boxes on his iOS device using the same Apple ID. <br><br>  Since the data update occurs asynchronously, we decided to add the following notification about the presence of saving in iCloud: <br><img src="https://habrastorage.org/storage2/095/75a/50e/09575a50e25a92446f30d6e53f437ffd.png"><br>  This notification allows you to easily and easily use the progress that already exists in iCloud.  It is shown only once, after the first synchronization.  Moreover, synchronization occurs regardless of the settings in the menu.  Customization only affects whether we apply the resulting progress to the local one. <br><br>  It was decided to make progress on the levels only from the best results from each device.  Thus, you can go through one half of the box on one device and the other on the second and get full progress on the box on both devices through several synchronizations. <br><br>  The game Cut the Rope has the ability to reset the game progress.  And we thought about whether to reset the progress saved in iCloud with it.  We decided that it was not worth it.  We thought that the latest and best result for each level will always be stored in iCloud so that the user can restore it at any time, regardless of any external factors.  In case the player wants to reset progress and go through the whole game from scratch, he can turn off iCloud synchronization. <br><br>  <b>Integration</b> <br>  There are two ways to integrate iCloud into an iOS application: <br>  <u>iCloud document storage</u> (saving files in iCloud user account) and <br>  <u>iCloud key-value data storage</u> ( <u>key-value data storage</u> ). <br><br>  I will talk about the second option, because in our game, game progress is saved in this way - level-result pair. <br><ol><li>  First of all, you need to enable iCloud support in the application on the <a href="http://developer.apple.com/">developer.apple.com</a> website and rewrite the corresponding profiles. </li><li>  Include entitlements in the project.  In xcode version 4.2, this is done as follows: <br>  In the Project navigator, double click on the project, select the desired target and on the Summary tab in the Entitlements section, turn on the checkbox opposite the ‚ÄúEnable Entitlements‚Äù line. </li><li>  In the iCloud Key-Value Store field, specify the container identifier used in the application.  This identifier may be the same for different applications.  This is how the possibility of using one progress for two different applications is realized.  As a result, for our applications the identifier will look like ‚Äúcom.zeptolab.ctr‚Äù, for full versions (iPhone and iPad).  And "com.zeptolab.ctrlite", for free versions.  In our case, we had to split the progress files, because in the free versions there is a different number and order of levels. <br>  Here are the correct settings in our project: <br><img src="https://habrastorage.org/storage2/fbe/092/42b/fbe09242b864d0da1bdf43bb1f07312f.png"><br></li><li> In the application code, add listening for data change messages, for example: <br> <code>[[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(notification:) name:NSUbiquitousKeyValueStoreDidChangeExternallyNotification object:[NSUbiquitousKeyValueStore defaultStore]];</code> <br>  And do not forget to unsubscribe from these messages when they are no longer needed: <br> <code>[[NSNotificationCenter defaultCenter] removeObserver:self name:NSUbiquitousKeyValueStoreDidChangeExternallyNotification <br> object:[NSUbiquitousKeyValueStore defaultStore]]; <br></code> </li><li>  Accordingly, in the method <br> <code>-(void)notification:(NSNotification *)notification</code> <br>  handle the situation of obtaining new data. <br></li><li>  Working with NSUbiquitousKeyValueStore using a dictionary as an example.  Access to the dictionary is as follows: <br> <code>NSUbiquitousKeyValueStore* store = [NSUbiquitousKeyValueStore defaultStore]; <br> NSDictionary* storedDict = [store dictionaryForKey:GAME_PROGRESS]; <br></code>  And so it can be synchronized: <br> <code>NSUbiquitousKeyValueStore* store = [NSUbiquitousKeyValueStore defaultStore]; <br> [store setDictionary:dict forKey:GAME_PROGRESS]; <br> [store synchronize]; <br></code> </li></ol><br>  <b>Note</b> <br>  The NSUbiquitousKeyValueStore interface is very similar to NSUserDefaults.  But the second can not be completely replaced by the first.  The application should always be locally saved current game progress. <br><br>  <b>Old firmware support</b> : <br>  Since iCloud appeared only starting with iOS 5, for compatibility with earlier versions this functionality will have to be disabled. <br>  This is done as follows: <br><ul><li>  We put a weak link on Foundation.framework, otherwise when running on older firmware we will encounter the following error: <br>  "Dyld: Symbol not found: _OBJC_CLASS _ $ _ NSUbiquitousKeyValueStore." </li><li>  And we add a check in the code for the availability of iCloud functionality, for example: <br> <code>+(BOOL)isCloudAvailable <br> { <br> id class = NSClassFromString(@"NSUbiquitousKeyValueStore"); <br> return class != nil; <br> }</code> <br>  And isolate the rest of the code with its help. </li></ul><br>  Thanks for attention.  I hope someone finds this article interesting. <br><br>  <b>useful links</b> <br>  <a href="https://developer.apple.com/library/ios/">iCloud Programming Guide</a> <br>  <a href="https://developer.apple.com/library/mac/">NSUbiquitousKeyValueStore Class Reference</a> </div><p>Source: <a href="https://habr.com/ru/post/137947/">https://habr.com/ru/post/137947/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../137940/index.html">RIPE NCC Password Policy Update</a></li>
<li><a href="../137941/index.html">John Barlow conveys heartfelt greetings to the sopa copiers and supporters: lecture in Russia</a></li>
<li><a href="../137943/index.html">Content for the site: better in advance than never</a></li>
<li><a href="../137945/index.html">What are patents in Russia? Likbez, Part 3</a></li>
<li><a href="../137946/index.html">Canobuvosti, 130th edition</a></li>
<li><a href="../137949/index.html">NGINX walks on the planet</a></li>
<li><a href="../137950/index.html">Now ChromeOS is participating in the rewards program for bugs found.</a></li>
<li><a href="../137951/index.html">Take part in the translation of technical terms for Windows 8</a></li>
<li><a href="../137952/index.html">Welcome to the Quality Assurance Day conference.</a></li>
<li><a href="../137953/index.html">Household appliances interfaces are 20 years behind</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>