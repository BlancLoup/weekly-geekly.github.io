<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing your spring-boot-starter</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Most java-developers have already become acquainted with the Spring Boot project, which allows you to quickly write an application that uses various c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Writing your spring-boot-starter</h1><div class="post__text post__text-html js-mediator-article">  Most java-developers have already become acquainted with the <a href="http://projects.spring.io/spring-boot/">Spring Boot</a> project, which allows you to quickly write an application that uses various components of the Spring Framework (Spring MVC, Spring Data and many others). <br><br>  All the convenience of <b>Spring Boot is</b> based on the use of so-called <i>Starters</i> , which allow you to get a set of configured bins ready for use and available for configuration via properties files.  But what to do, if for the necessary technology the starter is not written yet? <br><a name="habracut"></a><br>  In this article I would like to talk about how starters are created using the example of a starter for Spring-social-vkontakte.  Spring Social is one of the modules of the <b>Spring Framework</b> used to integrate with social networks.  The Spring Boot project included starters for social networks such as <i>Facebook</i> (spring-boot-starter-social-facebook), Twitter (spring-boot-starter-social-twitter) and LinkedIn (spring-boot-starter-social-twitter), based on the use of appropriate social modules.  Most developers from the CIS are primarily interested in the social network Vkontakte, for which there is a third-party module <b>spring-social-vkontakte</b> .  Accordingly, there is no starter for this module yet.  Writing this starter we will do in this article. <br><br>  The cornerstone of the <b>Spring Boot</b> infrastructure is the <i>AutoConfiguration classes</i> that <b>Spring Boot</b> finds when it starts the application and uses it to automatically create and configure bins. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Let's create this class for our starter: <br><br><pre><code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnClass</span></span>({SocialConfigurerAdapter.class, VKontakteConnectionFactory.class}) <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(prefix= <span class="hljs-string"><span class="hljs-string">"ru.shadam.social-vkontakte"</span></span>, name = { <span class="hljs-string"><span class="hljs-string">"client-id"</span></span>, <span class="hljs-string"><span class="hljs-string">"client-secret"</span></span>}) <span class="hljs-meta"><span class="hljs-meta">@AutoConfigureBefore</span></span>(SocialWebAutoConfiguration.class) <span class="hljs-meta"><span class="hljs-meta">@AutoConfigureAfter</span></span>(WebMvcAutoConfiguration.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VKontakteAutoConfiguration</span></span></span><span class="hljs-class"> </span></span>{ }</code> </pre> <br>  We use annotations to tell SpringBoot that our class is a configuration (@Configuration), annotations to specify the conditions under which our AutoConfiguration will be used to create bins, as well as annotations to indicate what our autoconfiguration takes place in the application initialization procedure. <br><br>  In this way: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@ConditionalOnClass</span></span>({SocialConfigurerAdapter.class, VKontakteConnectionFactory.class})</code> </pre><br>  means that the bins will be created if the SocialConfigurerAdapter (included in the Spring-Social module) and VKontakteConnectionFactory (included in the Spring-Social-Vkontakte module) are present in the classpath.  Thus, without the dependencies necessary for our starter, no bins will be created. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(prefix= <span class="hljs-string"><span class="hljs-string">"ru.shadam.social-vkontakte"</span></span>, name = { <span class="hljs-string"><span class="hljs-string">"client-id"</span></span>, <span class="hljs-string"><span class="hljs-string">"client-secret"</span></span>})</code> </pre><br>  means that bins will be created only if the property is available ru.shadam.social-vkontakte.client-id and ru.shadam.social-vkontakte.client-secret. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@AutoConfigureBefore</span></span>(SocialWebAutoConfiguration.class) <span class="hljs-meta"><span class="hljs-meta">@AutoConfigureAfter</span></span>(WebMvcAutoConfiguration.class)</code> </pre><br>  means that our bin will be initialized after WebMvc and before SocialWeb.  This is necessary so that by the time SocialWeb is initialized, our bins have already been registered. <br><br>  We now turn to what we will configure the bins in our AutoConfiguration. <br><br><div class="spoiler">  <b class="spoiler_title">VKontakteAutoConfiguration.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnClass</span></span>({SocialConfigurerAdapter.class, VKontakteConnectionFactory.class}) <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnProperty</span></span>(prefix= <span class="hljs-string"><span class="hljs-string">"ru.shadam.social-vkontakte"</span></span>, name = { <span class="hljs-string"><span class="hljs-string">"client-id"</span></span>, <span class="hljs-string"><span class="hljs-string">"client-secret"</span></span>}) <span class="hljs-meta"><span class="hljs-meta">@AutoConfigureBefore</span></span>(SocialWebAutoConfiguration.class) <span class="hljs-meta"><span class="hljs-meta">@AutoConfigureAfter</span></span>(WebMvcAutoConfiguration.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VKontakteAutoConfiguration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableSocial</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableConfigurationProperties</span></span>(VKontakteProperties.class) <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnWebApplication</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VKontakteConfigurationAdapter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SocialConfigurerAdapter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> VKontakteProperties properties; <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConditionalOnMissingBean</span></span> <span class="hljs-meta"><span class="hljs-meta">@Scope</span></span>(value = <span class="hljs-string"><span class="hljs-string">"request"</span></span>, proxyMode = ScopedProxyMode.INTERFACES) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> VKontakte </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vkontakte</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ConnectionRepository repository)</span></span></span><span class="hljs-function"> </span></span>{ Connection&lt;VKontakte&gt; connection = repository.findPrimaryConnection(VKontakte.class); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (connection != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> connection.getApi(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> VKontakteTemplate(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.properties.getClientId(), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.properties.getClientSecret()); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ConnectionFactory&lt;?&gt; createConnectionFactory() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> VKontakteConnectionFactory(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.properties.getClientId(), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.properties.getClientSecret()); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addConnectionFactories</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ConnectionFactoryConfigurer connectionFactoryConfigurer, Environment environment)</span></span></span><span class="hljs-function"> </span></span>{ connectionFactoryConfigurer.addConnectionFactory(createConnectionFactory()); } } }</code> </pre><br></div></div><br>  We <b>extend the SocialConfigurationAdapter</b> , which is needed to register our <b>ConnectionFactory</b> .  For this, the SocialConfigurerAdapter has a callback method: <br><br><pre> <code class="java hljs">addConnectionFactories(ConnectionFactoryConfigurer, Environment)</code> </pre> <br>  We will override it by adding our ConnectionFactory. <br><br>  We will also register the request-scoped bin <b>Vkontakte</b> , which is an interface for accessing the Vkontakte API.  In this case, if the user is authorized through the application, then the interaction operation with the API will be performed using auth_token. <br><br>  Consider also the VkontakteProperties class, which is used to get the configuration from the application properties files. <br><br><div class="spoiler">  <b class="spoiler_title">VkontakteProperties.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@ConfigurationProperties</span></span>(prefix = <span class="hljs-string"><span class="hljs-string">"ru.shadam.social-vkontakte"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VKontakteProperties</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String clientId; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String clientSecret; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getClientId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> clientId; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setClientId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String clientId)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.clientId = clientId; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getClientSecret</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> clientSecret; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setClientSecret</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String clientSecret)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.clientSecret = clientSecret; } }</code> </pre><br></div></div><br>  For receiving values ‚Äã‚Äãfrom the properties of files, the following is responsible: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@ConfigurationProperties</span></span>(prefix = <span class="hljs-string"><span class="hljs-string">"ru.shadam.social-vkontakte"</span></span>)</code> </pre><br>  She tells SpringBoot to try all the properties starting with the prefix <b>ru.shadam.social-vkontakte</b> in the appropriate fields of the class. <br><br>  Our final step is to create a file that allows the SpringBoot to find our AutoConfiguration class.  For this, there is a special spring.factories file that needs to be placed in the META-INF folder of the resulting jar file. <br><br>  In this file we need to specify our AutoConfiguration-class. <br><br><pre> <code class="java hljs">org.springframework.boot.autoconfigure.EnableAutoConfiguration=ru.shadam.spring.boot.vkontakte.VKontakteAutoConfiguration</code> </pre><br>  Now, by connecting the resulting jar to our <b>Spring Boot</b> project and setting it in the configuration ru.shadam.social-vkontakte.client-id and ru.shadam.social-vkontakte.client-secret, we‚Äôll get the configured / connect / vkontakte and Bin Vkontakte, which we can use to access the Vkontakte API. <br><br>  Used materials: <br><br><ol><li>  <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-developing-auto-configuration.html">docs.spring.io/spring-boot/docs/current/reference/html/boot-features-developing-auto-configuration.html</a> <br></li><li>  Link to the project on github: <a href="https://github.com/saladinkzn/social-vkontakte-spring-boot-starter">github.com/saladinkzn/social-vkontakte-spring-boot-starter</a> <br></li></ol></div><p>Source: <a href="https://habr.com/ru/post/275337/">https://habr.com/ru/post/275337/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../275305/index.html">Experience using the Intel Multi-OS Engine to develop an iOS-based Java application</a></li>
<li><a href="../275307/index.html">Zapulit on simple. Java pool manager</a></li>
<li><a href="../275323/index.html">Let's talk about Gmail: How did the popular mail service evolve</a></li>
<li><a href="../275331/index.html">To recursion through permutations</a></li>
<li><a href="../275333/index.html">JavaScript application, or why do we need Razor in ASP.NET MVC?</a></li>
<li><a href="../275339/index.html">Own search engine in the distributions of The Pirate Bay</a></li>
<li><a href="../275341/index.html">Patching modern application for use under Windows 2000</a></li>
<li><a href="../275343/index.html">3rd place in 11 steps in the Hola JavaScript contest</a></li>
<li><a href="../275347/index.html">Purple Encryption Machine</a></li>
<li><a href="../275351/index.html">Dynamic Interrupt Management in ARM</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>