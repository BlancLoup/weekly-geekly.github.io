<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Distributed computing for housing search</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Everyone has heard of distributed computing projects that are trying to solve large-scale tasks, such as the search for extraterrestrial life, drugs f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Distributed computing for housing search</h1><div class="post__text post__text-html js-mediator-article">  Everyone has heard of <a href="http://en.wikipedia.org/wiki/List_of_distributed_computing_projects">distributed computing</a> projects that are trying to solve large-scale tasks, such as the <a href="http://en.wikipedia.org/wiki/SETI%40home">search for</a> extraterrestrial life, <a href="http://en.wikipedia.org/wiki/World_Community_Grid">drugs</a> for AIDS and cancer, the search for <a href="http://en.wikipedia.org/wiki/Great_Internet_Mersenne_Prime_Search">primes</a> and unique <a href="http://en.wikipedia.org/wiki/Sudoku%40vtaiwan">solutions</a> for Sudoku.  All this is very entertaining, but no more than that, since there is no practical use for a person who shares the resources of his computer. <br><br>  Today I will talk about distributed computing that solves your problems.  Well, not all of course, but only some related to the search for housing.  I recently <a href="http://habrahabr.ru/post/237869/">wrote</a> about the Sobnik project, an extension for Chrome that detects middlemen on bulletin boards.  Two weeks ago, a new version of the program was launched, in which work on scanning and analyzing ads is distributed among users' computers.  Since that time, about a million ads from over a thousand Russian cities have been processed, and this is only the beginning.  Details, technical details and some more numbers await you under the cut. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Why is distributed computing here? </h2><br>  In order to identify the intermediary, the program needs to load the advertisement, parse it, analyze the photos, add the results to the database and perform several types of search, in particular - by phone numbers.  Initially, the user was required to open a specific ad in order for the plugin to perform this analysis.  This is inconvenient, because there are hundreds of ads, and among them almost all are intermediaries.  It was necessary to get rid of manual operations, as computers exist in order to act automatically! <br><br>  The first plan was to create a centralized ad scanner (hereinafter <a href="http://ru.wikipedia.org/wiki/%25D0%259F%25D0%25BE%25D0%25B8%25D1%2581%25D0%25BA%25D0%25BE%25D0%25B2%25D1%258B%25D0%25B9_%25D1%2580%25D0%25BE%25D0%25B1%25D0%25BE%25D1%2582">referred to as the crawler</a> ).  Take <a href="http://phantomjs.org/">PhantomJS</a> , <a href="http://phantomjs.org/">finish the</a> plug-in JS-code for it, and run the scan on the server.  <a href="http://avito.ru/">Avito</a> , of course, will be angry at a large-scale scan, and will block the server's IP, but in that case it was decided to buy IP addresses or use a bunch of proxies (Avito is the only bulletin board with which the plugin works).  But the longer I worked and thought in this direction, the more I understood - the decision is bad: <br><ol><li>  Servers cost money that I did not want to spend - the project is free, and I dream of leaving it as such. </li><li>  There is no reliability - there was no desire to compete with Avito in search of non-banned proxies. </li><li>  The scalability of such a decision rested on even more money, see item 1. </li></ol><br>  Soon, I came to the conclusion that the only solution without these shortcomings would be an automatic crawler built into the plugin, and working in users' browsers even when they are not busy searching for housing. <br><br><h2>  Distributed crawler </h2><br>  Only a small percentage of users work actively with Avito at any given time, however, the browser with a working plugin runs almost all day.  What if in the browser of each user would be scanned, say, one ad per minute?  These total capacities would be enough to quickly scan the ads with which active users are currently working.  And Avito would not be upset, because overloads from certain IP would never occur.  Yes, probably not everyone will want to share the power of their computers, but I believed that "conscious citizens" would still be enough.  The idea looked very tempting. <br><br>  Delving into the technical part of the new approach, I realized that the current server simply could not cope with the increased load.  Photo processing to detect phone numbers already consumed almost the entire CPU, and if the flow of ads increases by an order of magnitude?  AWS Free Tier's free virtual server had to cope, otherwise the project‚Äôs life was threatened.  So the first step was to transfer the work with images to the scalable part of the system - to the client.  The code of the plugin is <a href="https://github.com/sobnik/sobnik.chrome">open</a> , and of course there were fears that the publication of the algorithm would make it difficult for evil spammers to find weak points and ways to deceive.  However, I did not see any other options for the development of the project, and decided - come what may. <br><br>  So, now Sobnik opens a separate tab in your browser.  Periodically, about once a minute, he requests a task from the server - the ad address to scan, loads this ad in his tab, parses, processes the images and sends the results to the server.  Scanning tasks are created when one of the users opens a list of ads - in advance and nothing is scanned for nothing, ads are perishable. <br><br>  Conscious citizens who wish to share the power of your PC, while not so much - about a couple of hundred.  However, this is quite enough to process 60 thousand ads per day, providing the needs of thousands of users of the plugin.  The list of hundreds of ads opened on Avito is usually processed within one minute. <br><br>  It all sounds pretty simple, but I still fascinated by the ability to use hundreds of other people's computers to solve a common problem.  The browser is the ideal platform for these kinds of applications: <br><ol><li>  JavaScript can do almost everything now. </li><li>  The JS code is cross-platform (with the exception of calls to the browser API). </li><li>  The extension is installed in one click. </li><li>  Webstore distributes software updates. </li><li>  The browser is running most of the day. </li></ol><br>  If you have invented your own SETI @ HOME - take a closer look, maybe you need to learn the API of your favorite browser.  <a href="http://habrahabr.ru/post/151801/">Many</a> have already <a href="http://habrahabr.ru/post/119692/">written</a> about this, but the heyday of distributed computing, solving the practical problems of volunteers, and not of abstract human civilization, is not yet visible. <br><br>  It is worth paying attention to one nuance - people are very annoying when tabs open in the browser on their own.  And if it is necessary to open them, it is worth spending enough effort to ensure that this behavior was expected for users (instructions, faq, understandable informational messages).  Taking this opportunity, I apologize to everyone who was surprised by the behavior of the plug-in after the release of the new version of the program - I should have spent more time informing you about such significant innovations. <br><br><h2>  Efficient server </h2><br>  A server that coordinates work in a distributed computing system must be very efficient, because it is not so easy to scale.  The Sobnik project server is engaged not only in coordinating, but also in solving an applied task ‚Äî searching the database, so the requirements for it are even higher.  And if the client-side functionality was just slightly expanded, the server was almost completely redone (remember, it is written in Go). <br><br>  Initially, MongoDB was responsible for storing data and performing searches, now all working data is stored in RAM.  Two processes are running on the server - front-end and backend.  The frontend interacts with clients, maintains a queue of tasks for a distributed crawler, a queue of announcements for transfer to the backend, and a small cache with information about the status of the announcements (intermediary / owner).  The backend stores data in RAM (a squeeze from incoming ads), performs searches on them, asynchronously writes incoming ads to MongoDB, asynchronously executes frontend queries.  Interact processes with <a href="http://zeromq.org/">ZeroMQ</a> . <br><br>  MongoDB is used in the most efficient modes - for consistently writing incoming announcements, and for sequential reading when restarting the backend, in one stream.  At start-up, the backend reads the current advertisements from the DBMS, performs the same searches and analysis, as with regular receipt of data from customers, and fills its database in RAM.  This approach allows you to easily modify the algorithm for identifying intermediaries, and apply it to the entire database by simply restarting the backend. <br><br>  While the backend is running, filling its database, the frontend continues to serve clients ‚Äî incoming messages are put in a queue, requests for the status of ads are served from the cache, and tasks are distributed from their turn. <br><br>  In a system with almost a dozen parallel threads ( <a href="https://gobyexample.com/goroutines">goroutine</a> ), there is not a single mutex.  Each stream has exclusive access to its data, and serves other streams through <a href="https://gobyexample.com/channels">channels</a> (their presence in Go just makes you feel incredible). <br><br>  All interprocess and inter-thread communications are performed in non-blocking mode.  If the receiving party does not have time to read, the data is either added to the queue (incoming ads on the frontend) or discarded (other requests).  All queues and cache have a size limit, and when filling out the oldest records are discarded - the latest information is more valuable to Sobnik's clients.  If it is impossible to execute the request (the data channel is busy), the corresponding response is sent to the client, and the client tries again, at an increasing interval. <br><br>  Such an architecture was created in order to ensure maximum reliability and availability of the service.  And for now, it justifies itself - having nearly a million ads in the database and processing up to a million http requests per day, load_average on a virtual server stably keeps below 10%. <br><br><h2>  We are looking for housing in a new way! </h2><br>  Sobnik successfully survived the rebirth - ‚Äúdistributed‚Äù and fully strengthened.  A month ago, it was just an interesting idea, a prototype, which many set to indulge.  Now it is a working tool that is convenient to use and which really helps to filter spam.  This has become possible thanks to you, Dear Users, because <i>your</i> computers are solving a common task. <br><br>  Of course, the system works far from perfect, there are many questions to the detector for photos, and there are problems with the analysis of the text of ads.  However, it is now clear that Sobnik has enough resources to resolve these issues.  It remains only to feed the enthusiasm of the author, what you can achieve with criticism, suggestions and valuable comments. </div><p>Source: <a href="https://habr.com/ru/post/240941/">https://habr.com/ru/post/240941/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../240931/index.html">New Favorite Kickstarter: Pronto Speed ‚Äã‚ÄãCharging</a></li>
<li><a href="../240933/index.html">New in the release of Kerio Control 8.4</a></li>
<li><a href="../240935/index.html">How to debug your brain</a></li>
<li><a href="../240937/index.html">Tzdata update for Russia (system and java in Ubuntu / Debian, as well as in MySQL)</a></li>
<li><a href="../240939/index.html">Facebook launched a system for collecting and checking data compromised accounts</a></li>
<li><a href="../240943/index.html">SimBank or 200 SmartCard in one box</a></li>
<li><a href="../240945/index.html">How to rubyte survive OSX 10.10 Yosemite update</a></li>
<li><a href="../240947/index.html">New service: virtual private cloud</a></li>
<li><a href="../240951/index.html">Enterprise OpenStack and Database as a Service (DBaaS)</a></li>
<li><a href="../240953/index.html">Musical publics in a new way, or how I did Public Radio</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>