<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We continue to watch Moscow‚Äôs public video surveillance cameras</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It was evening, there was nothing. The reason was the activity of the user leider , who gave a link to the public resource in the comments :  video.di...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We continue to watch Moscow‚Äôs public video surveillance cameras</h1><div class="post__text post__text-html js-mediator-article"> It was evening, there was nothing.  The reason was the activity of the user <a href="https://habrahabr.ru/users/leider/" class="user_link">leider</a> , who gave a link to the public resource in the <a href="http://habrahabr.ru/post/248727/">comments</a> : <code><a href="http://video.dit.mos.ru/window/"></a> video.dit.mos.ru/window</code> <br> <br><img src="https://habrastorage.org/getpro/habr/post_images/69f/956/a90/69f956a900896bb4dc093a4a2c8f3dd8.jpg" alt="image"><br><br>  What is remarkable about this resource - it provides <b>public access</b> to video surveillance cameras <b>through the built-in player</b> . <br><a name="habracut"></a><br><img src="https://habrastorage.org/getpro/habr/post_images/5b0/216/bba/5b0216bba14741c07c1270a984b0134a.png" alt="image"><br><br>  In this article there will be neither ‚Äúsalt‚Äù nor sugar, but only healthy ones. <del>  food </del>  links directly from the stove. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The list of links that the player uses on that resource: <br><br><pre> <code class="bash hljs">http://videoproxy2.echd.ru:41025/rtsplive/10.200.21.21:2033/rtsp___10.208.1.18_axis_media_media.amp/live http://videoproxy2.echd.ru:41025/rtsplive/10.200.21.22:2033/rtsp___10.208.1.186_axis_media_media.amp/live http://videoproxy2.echd.ru:41025/rtsplive/10.200.21.22:2033/rtsp___10.208.0.50_axis_media_media.amp/live http://videoproxy2.echd.ru:41025/rtsplive/10.200.21.22:2033/rtsp___10.208.41.134_axis_media_media.amp/live http://videoproxy2.echd.ru:41025/rtsplive/10.200.21.23:2033/rtsp___10.194.23.9_axis_media_media.amp/live http://videoproxy2.echd.ru:41025/rtsplive/10.200.30.24:2033/rtsp___10.208.14.78_axis_media_media.amp_camera_4/live http://videoproxy2.echd.ru:41025/rtsplive/10.200.30.33:2033/rtsp___10.208.14.117_axis_media_media.amp_camera_2/live http://videoproxy2.echd.ru:41025/rtsplive/10.200.26.150:2033/rtsp___10.232.0.121_live_h264/live http://videoproxy2.echd.ru:41025/rtsplive/10.200.26.150:2033/rtsp___10.232.0.1_live_h264/live http://videoproxy2.echd.ru:41025/rtsplive/10.200.26.153:2033/rtsp___10.232.0.113_live_h264/live</code> </pre><br>  <strong>We <em>include</em> logic of the programmer " <em>vlob!</em> ":</strong> <br><ul><li> <code><a href="http://videoproxy2.echd.ru/"></a> videoproxy2.echd.ru:41025/rtsplive</code>  <code><a href="http://videoproxy2.echd.ru/"></a> videoproxy2.echd.ru:41025/rtsplive</code> is a proxy </li><li>  <code>10.200.30.33:2033</code> - this is a caching server </li><li>  <code>rtsp___10.208.14.117_axis_media_media.amp_camera_2/live</code> is a link to the stream from the camera on the server. </li></ul><br><br>  <strong>Work links:</strong> <br><ul><li> <code><a href="http://videoproxy2.echd.ru/"></a> videoproxy2.echd.ru:41025/rtsplive/10.200.21.21:2033/rtsp___10.208.1.18_axis_media_media.amp/live</code> </li> <li> <code><a href="http://videoproxy2.echd.ru/"></a> videoproxy2.echd.ru:41025/rtsplive/10.200.21.21:2033/rtsp___10.208.1.18_axis_media_media.amp</code> </li> </ul><br>  <strong>Non-working links:</strong> <br><ul><li> <code><a href="http://videoproxy2.echd.ru/"></a> videoproxy2.echd.ru:41025/rtsplive/10.200.21.21:2033/rtsp___10.208.1.18</code> </li> <li> <code><a href="http://videoproxy2.echd.ru/"></a> videoproxy2.echd.ru:41025/rtsplive/10.208.1.18:80</code> </li> <li> <code><a href="http://videoproxy2.echd.ru/"></a> videoproxy2.echd.ru:41025/rtsplive/10.208.1.18:81</code> </li> <li> <code><a href="http://videoproxy2.echd.ru/"></a> videoproxy2.echd.ru:41025/rtsplive/10.208.1.18:8080</code> </li> <li> <code><a href="http://videoproxy2.echd.ru/"></a> videoproxy2.echd.ru:41025/rtsplive/10.208.1.18:8081</code> </li> <li> <code><a href="http://videoproxy2.echd.ru/"></a> videoproxy2.echd.ru:41025/rtsplive/10.208.1.18:[_rtsp_  wiki,   7020  27020]</code> </li> </ul><br><br><h3>  Search automation </h3><br>  <strong>Theory:</strong> <br><ul><li>  Proksya only one ( <em>videoproxy2.echd.ru:41025/rtsplive/</em> ) </li><li>  caching server port is unchanged ( <em>: 2033</em> ) </li><li>  tail <em>_axis_media_media.amp / live</em> </li><li>  tail <em>_live_h264 / live</em> </li></ul><br>  Next, _camera_4, etc.  It is not taken into account, as there is ‚Äú10.200.30.24:2033/rtsp___10.208.14.7 <strong><em>8</em></strong> _axis_media_media.amp_camera <em><strong>_4</strong></em> / live‚Äù and there is no ‚Äú10.200.30.24.24:2033/rtsp___10.208.14.7 <em><strong>7</strong></em> _axis_media_media.amp_camera <strong><em>_3</em></strong> / live‚Äù, but following the logic must be "_axis_media_media.amp / live" - ‚Äã‚Äãthat's what we are looking for. <br><br>  IP list for caching servers <strong>:</strong> <br><ul><li>  10.200.21.21 </li><li>  10.200.21.22 </li><li>  10.200.21.23 </li><li>  10.200.30.24 </li><li>  10.200.30.33 </li><li>  10.200.26.150 </li><li>  10.200.26.153 </li></ul><br>  Ideally, the range should be <strong>10.200.21.1--10.200.30.254</strong> . <br><br>  List of IP addresses for cameras: <br><ul><li>  10.194.1.7 </li><li>  10.194.23.9 </li><li>  10.208.0.50 </li><li>  10.208.1.186 </li><li>  10.208.14.117 </li><li>  10.208.41.134 </li><li>  10.232.0.113 </li><li>  10.232.0.121 </li></ul><br>  As a range (again, ideal), we take the addresses <strong>10.194.0.1--10.232.255.254</strong> with the exception of <strong>10.200. *. *</strong> , Since, according to my logic (as I would have done), these are caching servers. <br><br>  As a result, this pattern emerges for requests: <br><ul><li> <code><a href="http://videoproxy2.echd.ru/"></a> videoproxy2.echd.ru:41025/rtsplive/10.200.</code>  <em><strong>ip13</strong></em> .  <em><strong>ip14</strong></em> : 2033 / rtsp ___ 10.  <em><strong>ip22</strong></em> .  <em><strong>ip23</strong></em> .  <em><strong>ip24</strong></em> _axis_media_media.amp / live </li><li> <code><a href="http://videoproxy2.echd.ru/"></a> videoproxy2.echd.ru:41025/rtsplive/10.200.</code>  <em><strong>ip13</strong></em> .  <em><strong>ip14</strong></em> : 2033 / rtsp ___ 10.  <em><strong>ip22</strong></em> .  <em><strong>ip23</strong></em> .  <em><strong>ip24</strong></em> _live_h264 / live </li></ul><br><br><ul><li>  <strong>ip13</strong> - 21..30 </li><li>  <strong>ip14</strong> - 0..254 </li><li>  <strong>ip22</strong> - 194..232 </li><li>  <strong>ip23</strong> - 0..255 </li><li>  <strong>ip24</strong> - 1..254 </li></ul><br>  We get: <strong>5 billion</strong> addresses and requests ... In reality, there are many less requests and we can also save <strong>903k</strong> requests in 10-15 seconds of idle script ... (more on that below). <br><br>  <strong>Success:</strong> <br><ul><li>  If successful, the server returns us to the <strong>Content-type</strong> <em>x-flv</em> or the reverse condition <strong>NOT</strong> <em>text</em> ; </li><li>  If successful, the server is responsible for 1-3 seconds. </li></ul><br>  <strong>Failure:</strong> <br><ul><li>  The server is responsible for 200-400ms with <em>text</em> in the <strong>Content-type</strong> ; </li><li>  The server <em>thinks for a</em> long time, if they sent a request to a ‚Äúnonexistent‚Äù cache server, in this case it is necessary to stop the parsing on this server and jump to the IP ‚Äúhigher‚Äù. </li></ul><br>  To minimize the time of parsing, set the connection timeout to 10,000 ms, then before the request and after the request (when the server responded or the timeout worked on our client) we save the time value.  Then we subtract the first from the second one and if 9500ms or more has passed, then it goes to 1 IP higher (for the caching server), which gives us the above-mentioned saving of <strong>903,224</strong> requests or <strong>104</strong> days waiting for 10 seconds! <br><br>  You also need to understand that the links to the cameras run in a circle, and as <a href="http://habrahabr.ru/post/248727/">noted</a> in the previous article, there are about <strong>140,000</strong> cameras.  The server quietly gives 10 requests per second, so if we have already found <strong>140,000</strong> cameras, then in the future we need not look for them again. <br><br>  But parsing such a number of addresses will take forever, and we are not in the matrix yet! <br><br><br><h3>  <strong>Practice</strong> </h3><br>  <strong>Reduce the search range:</strong> <br><ul><li>  10.200.21.21-24, cameras 10. [194, 208, 232] .0-255.1-254 </li><li>  10.200.30.21-34, cameras 10. [194, 208, 232] .0-255.1-254 </li><li>  10.200.26.150-153, cameras 10.232.0-255.1-254 </li></ul><br>  Their proxy calmly processes ~ 10 requests for 1 stream, try ... 8 streams, 16 streams ... 16 is enough. Total ~ 160 links per second and a stream at the level of 2-3 megabits, which does not load the network. <br><br>  <strong>Server response:</strong> <br><br>  video / x-flv is if we received the stream from the camera through their server, text / html - if the error message.  In the program, you need to make a condition not of finding x-flv, but of the <strong>absence of</strong> text.  Because if the camera is lying, then the server just tupit and we get nothing, but the camera is there. <br><br>  As a result, <strong>608</strong> cameras were found: <br><table><tbody><tr><td>  <strong>IP</strong> </td><td>  .21.23 </td><td>  .21.22 </td><td>  .21.21 </td><td>  .26.150 </td><td>  .26.151 </td><td>  .30.21 </td><td>  .26.152 </td><td>  .30.24 </td><td>  .26.153 </td><td>  .30.23 </td><td>  .30.25 </td><td>  .21.24 </td><td>  .30.22 </td></tr><tr><td>  <strong>number</strong> </td><td>  193 </td><td>  176 </td><td>  171 </td><td>  31 </td><td>  ten </td><td>  7 </td><td>  four </td><td>  four </td><td>  3 </td><td>  3 </td><td>  3 </td><td>  2 </td><td>  one </td></tr></tbody></table><br><ul><li>  <strong>540</strong> cameras <em>_axis_media_media.amp / live</em> </li><li>  <strong>68</strong> cameras <em>_live_h264 / live</em> </li></ul><br><br><br>  <em><strong>Notifications:</strong></em> <br><ul><li>  On January 27, at noon, a letter was sent to dit @, an hour later after a personal <a href="https://habrahabr.ru/users/leider/" class="user_link">leider</a> to see the mail.  The letter described what and how it works. </li><li>  January 28 is also at noon - a new letter on dit-video @, where he mentioned that he already wrote on dit @ and that there was no answer (in each letter it was stated that I was waiting for news) </li></ul><br>  <em><strong>"News":</strong></em> <br><ul><li>  The link to the camera shown in the example was closed on 27 more ... silently and silently. </li></ul><br>  I hope that after this publication, they will introduce a check on <strong>videoproxy2</strong> , so that it gives out only cameras from the ‚Äúwindow‚Äù project.  For other cameras / all cameras, you can raise <strong>blablaproxy2</strong> , which <em>does not shine anywhere</em> and which will work on <strong>https</strong> . <br><br>  <em>Related Links:</em> <br><br>  <a href="http://cdn-files.evildayz.com/_habr/moscams/habr_moscams.html">Page with players</a> ||  <a href="">Dump in mysql format</a> (description of fields in comments). </div><p>Source: <a href="https://habr.com/ru/post/249173/">https://habr.com/ru/post/249173/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../249159/index.html">Apple fixed important OS X vulnerabilities</a></li>
<li><a href="../249163/index.html">Introduction to topological spaces. Java finite topology programming. Part 2: Base topology. Continuous display</a></li>
<li><a href="../249165/index.html">Features of domain modeling using OOP</a></li>
<li><a href="../249167/index.html">Pebble: an example of using an Android companion</a></li>
<li><a href="../249169/index.html">AdBlock Plus and Adguard + Anti-Adblock banner blocking bypass</a></li>
<li><a href="../249175/index.html">Conveyor - time delayed data element processing</a></li>
<li><a href="../249177/index.html">Unity 2D: working with sprites in different display resolutions</a></li>
<li><a href="../249179/index.html">TM represents TM Feed</a></li>
<li><a href="../249181/index.html">Attack "Man In The Middle" (MITM) in Wi-Fi network</a></li>
<li><a href="../249183/index.html">Microservices (Microservices)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>