<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>OGRE 3D and SDL Duet</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, there began to appear articles related to the engine OGRE, incl. and a post on creating a simple program, so I decided not to postpone the m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>OGRE 3D and SDL Duet</h1><div class="post__text post__text-html js-mediator-article">  Recently, there began to appear articles related to the engine OGRE, incl.  and a <a href="http://habrahabr.ru/blogs/open_source/86017/">post</a> on creating a simple program, so I decided not to postpone the matter and write this article.  Once, not so long ago, I already wrote a small superficial <a href="http://gcc.habrahabr.ru/blog/83927/">review of</a> the SDL library, and here, as a continuation, I will give a specific example of using this library, namely, how to make it work together with the engine. <br><a name="habracut"></a><br><h4>  Intro </h4><br>  First, I will answer the question - why?  OGRE itself works on most popular platforms, it is able to create a window for visualization, and for handling user input there are many lessons at the office.  The site engine is recommended to use the OIS library.  This is true, and before that I used the engine in conjunction with this library until I had to write under Linux.  Then there were unpleasant moments.  For some reason, the OGRE window often refused to respond to dragging the mouse, often the image flickered in it (there was a suspicion of a conflict with Compiz or Emerald);  input with the help of OIS could not boast of decent speed, and after using the mouse for a few seconds, I wanted to close the program as soon as possible.  Then I decided to try SDL as an alternative to OIS.  The library handled it very successfully with its responsibilities - creating a window and processing input, while showing a decent speed. <br><br><h4>  Program frame </h4><br>  So, we need the <a href="http://www.ogre3d.org/download/sdk">OGRE SDK</a> and <a href="http://www.libsdl.org/download-1.2.php">SDL SDK</a> .  I will not describe the process of their installation, because it is different in different systems, and there are a lot of simple lessons on this topic.  Let's go straight to the point.  The first task is to write the program code in which the SDL will be engaged in creating the window and processing the input, and OGRE will only render to another window for it.  We will try to make our code portable at least between Windows and Linux. <br><br>  To begin with, we initialize the SDL and create a window with it: <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">#include &lt;Ogre.h&gt; #include &lt;SDL.h&gt; #ifdef _WINDOWS #include &lt;SDL_syswm.h&gt; <font color="#0000ff">#endif</font> ... <font color="#008000">//    SDL</font> SDL_Init(SDL_INIT_VIDEO); <font color="#008000">//     </font> SDL_putenv(( <font color="#0000ff">char</font> *) <font color="#A31515">"SDL_VIDEO_CENTERED=true"</font> ); <font color="#008000">//       800x600@16    OpenGL</font> SDL_SetVideoMode(800, 600, 16, SDL_OPENGL); <font color="#008000">//    </font> SDL_WM_SetCaption( <font color="#A31515">"Demo window"</font> , NULL);</font> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <ol><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> #include &lt;Ogre.h&gt; #include &lt;SDL.h&gt; #ifdef _WINDOWS #include &lt;SDL_syswm.h&gt; <font color="#0000ff">#endif</font> ... <font color="#008000">//    SDL</font> SDL_Init(SDL_INIT_VIDEO); <font color="#008000">//     </font> SDL_putenv(( <font color="#0000ff">char</font> *) <font color="#A31515">"SDL_VIDEO_CENTERED=true"</font> ); <font color="#008000">//       800x600@16    OpenGL</font> SDL_SetVideoMode(800, 600, 16, SDL_OPENGL); <font color="#008000">//    </font> SDL_WM_SetCaption( <font color="#A31515">"Demo window"</font> , NULL); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> #include &lt;Ogre.h&gt; #include &lt;SDL.h&gt; #ifdef _WINDOWS #include &lt;SDL_syswm.h&gt; <font color="#0000ff">#endif</font> ... <font color="#008000">//    SDL</font> SDL_Init(SDL_INIT_VIDEO); <font color="#008000">//     </font> SDL_putenv(( <font color="#0000ff">char</font> *) <font color="#A31515">"SDL_VIDEO_CENTERED=true"</font> ); <font color="#008000">//       800x600@16    OpenGL</font> SDL_SetVideoMode(800, 600, 16, SDL_OPENGL); <font color="#008000">//    </font> SDL_WM_SetCaption( <font color="#A31515">"Demo window"</font> , NULL); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> #include &lt;Ogre.h&gt; #include &lt;SDL.h&gt; #ifdef _WINDOWS #include &lt;SDL_syswm.h&gt; <font color="#0000ff">#endif</font> ... <font color="#008000">//    SDL</font> SDL_Init(SDL_INIT_VIDEO); <font color="#008000">//     </font> SDL_putenv(( <font color="#0000ff">char</font> *) <font color="#A31515">"SDL_VIDEO_CENTERED=true"</font> ); <font color="#008000">//       800x600@16    OpenGL</font> SDL_SetVideoMode(800, 600, 16, SDL_OPENGL); <font color="#008000">//    </font> SDL_WM_SetCaption( <font color="#A31515">"Demo window"</font> , NULL); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> #include &lt;Ogre.h&gt; #include &lt;SDL.h&gt; #ifdef _WINDOWS #include &lt;SDL_syswm.h&gt; <font color="#0000ff">#endif</font> ... <font color="#008000">//    SDL</font> SDL_Init(SDL_INIT_VIDEO); <font color="#008000">//     </font> SDL_putenv(( <font color="#0000ff">char</font> *) <font color="#A31515">"SDL_VIDEO_CENTERED=true"</font> ); <font color="#008000">//       800x600@16    OpenGL</font> SDL_SetVideoMode(800, 600, 16, SDL_OPENGL); <font color="#008000">//    </font> SDL_WM_SetCaption( <font color="#A31515">"Demo window"</font> , NULL); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><font color="#0000ff"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> #include &lt;Ogre.h&gt; #include &lt;SDL.h&gt; #ifdef _WINDOWS #include &lt;SDL_syswm.h&gt; #endif ... <font color="#008000">//    SDL</font> SDL_Init(SDL_INIT_VIDEO); <font color="#008000">//     </font> SDL_putenv(( <font color="#0000ff">char</font> *) <font color="#A31515">"SDL_VIDEO_CENTERED=true"</font> ); <font color="#008000">//       800x600@16    OpenGL</font> SDL_SetVideoMode(800, 600, 16, SDL_OPENGL); <font color="#008000">//    </font> SDL_WM_SetCaption( <font color="#A31515">"Demo window"</font> , NULL); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code> </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> #include &lt;Ogre.h&gt; #include &lt;SDL.h&gt; #ifdef _WINDOWS #include &lt;SDL_syswm.h&gt; <font color="#0000ff">#endif</font> ... <font color="#008000">//    SDL</font> SDL_Init(SDL_INIT_VIDEO); <font color="#008000">//     </font> SDL_putenv(( <font color="#0000ff">char</font> *) <font color="#A31515">"SDL_VIDEO_CENTERED=true"</font> ); <font color="#008000">//       800x600@16    OpenGL</font> SDL_SetVideoMode(800, 600, 16, SDL_OPENGL); <font color="#008000">//    </font> SDL_WM_SetCaption( <font color="#A31515">"Demo window"</font> , NULL); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li></li><li> <code><font color="black"><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> #include &lt;Ogre.h&gt; #include &lt;SDL.h&gt; #ifdef _WINDOWS #include &lt;SDL_syswm.h&gt; <font color="#0000ff">#endif</font> ... //    SDL SDL_Init(SDL_INIT_VIDEO); <font color="#008000">//     </font> SDL_putenv(( <font color="#0000ff">char</font> *) <font color="#A31515">"SDL_VIDEO_CENTERED=true"</font> ); <font color="#008000">//       800x600@16    OpenGL</font> SDL_SetVideoMode(800, 600, 16, SDL_OPENGL); <font color="#008000">//    </font> SDL_WM_SetCaption( <font color="#A31515">"Demo window"</font> , NULL); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> #include &lt;Ogre.h&gt; #include &lt;SDL.h&gt; #ifdef _WINDOWS #include &lt;SDL_syswm.h&gt; <font color="#0000ff">#endif</font> ... <font color="#008000">//    SDL</font> SDL_Init(SDL_INIT_VIDEO); <font color="#008000">//     </font> SDL_putenv(( <font color="#0000ff">char</font> *) <font color="#A31515">"SDL_VIDEO_CENTERED=true"</font> ); <font color="#008000">//       800x600@16    OpenGL</font> SDL_SetVideoMode(800, 600, 16, SDL_OPENGL); <font color="#008000">//    </font> SDL_WM_SetCaption( <font color="#A31515">"Demo window"</font> , NULL); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> #include &lt;Ogre.h&gt; #include &lt;SDL.h&gt; #ifdef _WINDOWS #include &lt;SDL_syswm.h&gt; <font color="#0000ff">#endif</font> ... <font color="#008000">//    SDL</font> SDL_Init(SDL_INIT_VIDEO); //      SDL_putenv(( <font color="#0000ff">char</font> *) <font color="#A31515">"SDL_VIDEO_CENTERED=true"</font> ); <font color="#008000">//       800x600@16    OpenGL</font> SDL_SetVideoMode(800, 600, 16, SDL_OPENGL); <font color="#008000">//    </font> SDL_WM_SetCaption( <font color="#A31515">"Demo window"</font> , NULL); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> #include &lt;Ogre.h&gt; #include &lt;SDL.h&gt; #ifdef _WINDOWS #include &lt;SDL_syswm.h&gt; <font color="#0000ff">#endif</font> ... <font color="#008000">//    SDL</font> SDL_Init(SDL_INIT_VIDEO); <font color="#008000">//     </font> SDL_putenv(( <font color="#0000ff">char</font> *) <font color="#A31515">"SDL_VIDEO_CENTERED=true"</font> ); <font color="#008000">//       800x600@16    OpenGL</font> SDL_SetVideoMode(800, 600, 16, SDL_OPENGL); <font color="#008000">//    </font> SDL_WM_SetCaption( <font color="#A31515">"Demo window"</font> , NULL); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> #include &lt;Ogre.h&gt; #include &lt;SDL.h&gt; #ifdef _WINDOWS #include &lt;SDL_syswm.h&gt; <font color="#0000ff">#endif</font> ... <font color="#008000">//    SDL</font> SDL_Init(SDL_INIT_VIDEO); <font color="#008000">//     </font> SDL_putenv(( <font color="#0000ff">char</font> *) <font color="#A31515">"SDL_VIDEO_CENTERED=true"</font> ); //       800x600@16    OpenGL SDL_SetVideoMode(800, 600, 16, SDL_OPENGL); <font color="#008000">//    </font> SDL_WM_SetCaption( <font color="#A31515">"Demo window"</font> , NULL); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> #include &lt;Ogre.h&gt; #include &lt;SDL.h&gt; #ifdef _WINDOWS #include &lt;SDL_syswm.h&gt; <font color="#0000ff">#endif</font> ... <font color="#008000">//    SDL</font> SDL_Init(SDL_INIT_VIDEO); <font color="#008000">//     </font> SDL_putenv(( <font color="#0000ff">char</font> *) <font color="#A31515">"SDL_VIDEO_CENTERED=true"</font> ); <font color="#008000">//       800x600@16    OpenGL</font> SDL_SetVideoMode(800, 600, 16, SDL_OPENGL); <font color="#008000">//    </font> SDL_WM_SetCaption( <font color="#A31515">"Demo window"</font> , NULL); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> #include &lt;Ogre.h&gt; #include &lt;SDL.h&gt; #ifdef _WINDOWS #include &lt;SDL_syswm.h&gt; <font color="#0000ff">#endif</font> ... <font color="#008000">//    SDL</font> SDL_Init(SDL_INIT_VIDEO); <font color="#008000">//     </font> SDL_putenv(( <font color="#0000ff">char</font> *) <font color="#A31515">"SDL_VIDEO_CENTERED=true"</font> ); <font color="#008000">//       800x600@16    OpenGL</font> SDL_SetVideoMode(800, 600, 16, SDL_OPENGL); //     SDL_WM_SetCaption( <font color="#A31515">"Demo window"</font> , NULL); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> #include &lt;Ogre.h&gt; #include &lt;SDL.h&gt; #ifdef _WINDOWS #include &lt;SDL_syswm.h&gt; <font color="#0000ff">#endif</font> ... <font color="#008000">//    SDL</font> SDL_Init(SDL_INIT_VIDEO); <font color="#008000">//     </font> SDL_putenv(( <font color="#0000ff">char</font> *) <font color="#A31515">"SDL_VIDEO_CENTERED=true"</font> ); <font color="#008000">//       800x600@16    OpenGL</font> SDL_SetVideoMode(800, 600, 16, SDL_OPENGL); <font color="#008000">//    </font> SDL_WM_SetCaption( <font color="#A31515">"Demo window"</font> , NULL); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> </ol> <code><font color="gray"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">#include &lt;Ogre.h&gt; #include &lt;SDL.h&gt; #ifdef _WINDOWS #include &lt;SDL_syswm.h&gt; <font color="#0000ff">#endif</font> ... <font color="#008000">//    SDL</font> SDL_Init(SDL_INIT_VIDEO); <font color="#008000">//     </font> SDL_putenv(( <font color="#0000ff">char</font> *) <font color="#A31515">"SDL_VIDEO_CENTERED=true"</font> ); <font color="#008000">//       800x600@16    OpenGL</font> SDL_SetVideoMode(800, 600, 16, SDL_OPENGL); <font color="#008000">//    </font> SDL_WM_SetCaption( <font color="#A31515">"Demo window"</font> , NULL);</font> * This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Now you need to configure OGRE, install a visualizer for it.  How to code this part of the program is purely individual preference of each.  Here I reserved the right to manually download only the most necessary plugins and set the necessary parameters.  The main thing is not to create a window using OGRE: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#008000">// Start the initialization of OGRE by creating a Root object</font> </li><li>  Ogre :: Root * root = <font color="#0000ff">new</font> Ogre :: Root (); </li><li>  <font color="#008000">// Load the OpenGL visualization plugin from the current folder (or from another location)</font> </li><li>  #ifdef _WINDOWS </li><li>  root-&gt; loadPlugin ( <font color="#A31515">"./RenderSystem_GL.dll"</font> ); </li><li>  <font color="#0000ff">#else</font> </li><li>  root-&gt; loadPlugin ( <font color="#A31515">"./RenderSystem_GL.so"</font> ); </li><li>  <font color="#0000ff">#endif</font> </li><li>  <font color="#008000">// Create the visualizer itself</font> </li><li>  Ogre :: RenderSystem * rs = root-&gt; getRenderSystemByName ( <font color="#A31515">"OpenGL Rendering Subsystem"</font> ); </li><li>  <font color="#008000">// ... make it current</font> </li><li>  root-&gt; setRenderSystem (rs); </li><li>  <font color="#008000">// ... and set up the video mode</font> </li><li>  rs-&gt; setConfigOption ( <font color="#A31515">"Full Screen"</font> , <font color="#A31515">"no"</font> ); </li><li>  rs-&gt; setConfigOption ( <font color="#A31515">"Video Mode"</font> , <font color="#A31515">"800 x 600 16-bit color"</font> ); </li><li>  <font color="#008000">// Initialize OGRE, but without automatic window creation</font> </li><li>  root-&gt; initialise ( <font color="#0000ff">false</font> ); </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br>  The most interesting thing is to tell OGRE that the OpenGL context has already been received, and it needs to be rendered: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#008000">// Set the parameters for creating the OGRE window.</font> </li><li>  <font color="#008000">// Actually no window is created.</font>  <font color="#008000">We just point OGRE where</font> </li><li>  <font color="#008000">// make it visualize</font> </li><li>  Ogre :: NameValuePairList <font color="#0000ff">params</font> ; </li><li>  #ifdef _WINDOWS </li><li>  SDL_SysWMinfo info; </li><li>  SDL_VERSION (&amp; info.version); </li><li>  SDL_GetWMInfo (&amp; info); </li><li>  <font color="#0000ff">params</font> [ <font color="#A31515">"externalWindowHandle"</font> ] = Ogre :: StringConverter :: toString (reinterpret_cast &lt;size_t&gt; (info.window)); </li><li>  <font color="#0000ff">params</font> [ <font color="#A31515">"externalGLContent"</font> ] = Ogre :: StringConverter :: toString (reinterpret_cast &lt;size_t&gt; (info.hglrc)); </li><li>  <font color="#0000ff">params</font> [ <font color="#A31515">"externalGLControl"</font> ] = Ogre :: <font color="#2B91AF">String</font> ( <font color="#A31515">"True"</font> ); </li><li>  <font color="#0000ff">#else</font> </li><li>  <font color="#008000">// Under Linux a little easier</font> </li><li>  <font color="#0000ff">params</font> [ <font color="#A31515">"currentGLContext"</font> ] = Ogre :: <font color="#2B91AF">String</font> ( <font color="#A31515">"True"</font> ); </li><li>  <font color="#0000ff">#endif</font> </li><li></li><li>  <font color="#008000">// Create a "virtual" window with the selected parameters</font> </li><li>  Ogre :: RenderWindow * wnd = root-&gt; createRenderWindow ( <font color="#A31515">"Main window"</font> , 800, 600, <font color="#0000ff">false</font> , &amp; <font color="#0000ff">params</font> ); </li><li>  wnd-&gt; setVisible ( <font color="#0000ff">true</font> ); </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br>  It's time to finish with the initialization and go to the working part: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#008000">// Here we will add the next event for processing</font> </li><li>  SDL_Event evt; </li><li>  <font color="#008000">// Yes, the loop should go on</font> </li><li>  <font color="#0000ff">bool</font> running = <font color="#0000ff">true</font> ; </li><li>  <font color="#008000">// The main rendering cycle</font> </li><li>  <font color="#0000ff">while</font> (running) </li><li>  { </li><li>  <font color="#008000">// Read the system events and input events received since the previous frame</font> </li><li>  <font color="#0000ff">while</font> (SDL_PollEvent (&amp; evt)) </li><li>  { </li><li>  <font color="#008000">// If the user closed the window, stop the cycle</font> </li><li>  <font color="#0000ff">if</font> (evt.type == SDL_QUIT) </li><li>  running = <font color="#0000ff">false</font> ; </li><li>  } </li><li>  <font color="#008000">// Draw one frame</font> </li><li>  root-&gt; renderOneFrame (); </li><li></li><li>  <font color="#008000">// For some reason, the need to call SDL_GL_SwapBuffers ();</font>  <font color="#008000">There is only in Windows.</font> </li><li>  <font color="#008000">// On Linux, it works fine without it and is buggy if you use it.</font> </li><li>  #ifdef _WINDOWS </li><li>  SDL_GL_SwapBuffers (); </li><li>  <font color="#0000ff">#endif</font> </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br>  At the end of the program, do not forget to clean up after you: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#008000">// Delete the main OGRE object, freeing up all the resources used by the engine</font> </li><li>  delete root; </li><li>  <font color="#008000">// Close SDL</font> </li><li>  SDL_Quit (); </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br>  The code is rather short, comments take up half the space.  After compiling and running the program, a window appears with incomprehensible content: <br><img src="http://i038.radikal.ru/1003/f3/a070d92f210d.jpg" alt="image"><br>  This is an expected result, because at this stage not a single viewport or a single camera was created from which OGRE could render.  Therefore, all that is displayed in the window is arbitrary data that is in the video memory. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Input manager </h4><br>  Now it would be nice to make a small convenient system for catching events and sending them to listeners.  We first describe the listener interfaces: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#008000">// Input.h</font> </li><li></li><li>  #include &lt;list&gt; </li><li>  #include &lt;SDL.h&gt; </li><li></li><li>  <font color="#008000">/// Keyboard Event Listener Interface</font> </li><li>  <font color="#0000ff">class</font> KeyboardListener </li><li>  { </li><li>  <font color="#0000ff">public</font> : </li><li>  <font color="#0000ff">virtual</font> ~ KeyboardListener () {} </li><li>  <font color="#0000ff">virtual</font> <font color="#0000ff">void</font> onKeyboardEvent ( <font color="#0000ff">const</font> SDL_KeyboardEvent &amp; evt) = 0; </li><li>  }; </li><li></li><li>  <font color="#008000">/// Mouse Event Listener Interface</font> </li><li>  <font color="#0000ff">class</font> MouseListener </li><li>  { </li><li>  <font color="#0000ff">public</font> : </li><li>  <font color="#0000ff">virtual</font> ~ MouseListener () {} </li><li>  <font color="#0000ff">virtual</font> <font color="#0000ff">void</font> onMouseMotion ( <font color="#0000ff">const</font> SDL_MouseMotionEvent &amp; evt) = 0; </li><li>  <font color="#0000ff">virtual</font> <font color="#0000ff">void</font> onMouseBtn ( <font color="#0000ff">const</font> SDL_MouseButtonEvent &amp; evt) = 0; </li><li>  }; </li><li></li><li>  <font color="#008000">/// Listener interface for all other types of events</font> </li><li>  <font color="#0000ff">class</font> EventListener </li><li>  { </li><li>  <font color="#0000ff">public</font> : </li><li>  <font color="#0000ff">virtual</font> ~ EventListener () {} </li><li>  <font color="#0000ff">virtual</font> <font color="#0000ff">void</font> onEvent ( <font color="#0000ff">const</font> SDL_Event &amp; evt) = 0; </li><li>  }; </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br>  By defining listener interfaces, you can write the input manager class itself: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">class</font> InputManager </li><li>  { </li><li>  <font color="#0000ff">private</font> : </li><li>  typedef std :: list &lt;KeyboardListener *&gt; KeyboardListenersList; </li><li>  typedef std :: list &lt;MouseListener *&gt; MouseListenersList; </li><li>  typedef std :: list &lt;EventListener *&gt; OtherEventsListenersList; </li><li></li><li>  <font color="#0000ff">private</font> : </li><li>  KeyboardListenersList kb_listeners; </li><li>  MouseListenersList mouse_listeners; </li><li>  OtherEventsListenersList other_listeners; </li><li></li><li>  <font color="#0000ff">public</font> : </li><li>  InputManager () {} </li><li>  ~ InputManager () {} </li><li></li><li>  <font color="#008000">/// Captures and handles events</font> </li><li>  <font color="#0000ff">void</font> capture (); </li><li></li><li>  <font color="#008000">/// Registers the event listener keyboard</font> </li><li>  <font color="#0000ff">void</font> regKeyboardListener (KeyboardListener * l); </li><li>  <font color="#008000">/// Unregisters the keyboard event listener</font> </li><li>  <font color="#0000ff">void</font> unregKeyboardListener (KeyboardListener * l); </li><li></li><li>  <font color="#008000">/// Registers a mouse event listener.</font> </li><li>  <font color="#0000ff">void</font> regMouseListener (MouseListener * l); </li><li>  <font color="#008000">/// Unregisters the mouse event listener.</font> </li><li>  <font color="#0000ff">void</font> unregMouseListener (MouseListener * l); </li><li></li><li>  <font color="#008000">/// Registers a general event listener</font> </li><li>  <font color="#0000ff">void</font> regEventListener (EventListener * l); </li><li>  <font color="#008000">/// Unregisters an event listener of any type</font> </li><li>  <font color="#0000ff">void</font> unregEventListener (EventListener * l); </li><li>  }; </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br>  We now turn to the implementation of the class.  The main interest is the capture () method: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  SDL_Event evt; </li><li>  <font color="#0000ff">while</font> (SDL_PollEvent (&amp; evt)) </li><li>  { </li><li>  <font color="#0000ff">switch</font> (evt.type) </li><li>  { </li><li>  <font color="#008000">// keyboard event</font> </li><li>  <font color="#0000ff">case</font> SDL_KEYUP: <font color="#0000ff">case</font> SDL_KEYDOWN: </li><li>  { </li><li>  KeyboardListenersList :: const_iterator kb_it = kb_listeners.begin (), kb_end = kb_listeners.end (); </li><li>  <font color="#0000ff">for</font> (; kb_it! = kb_end; ++ kb_it) </li><li>  (* kb_it) -&gt; onKeyboardEvent (evt.key); </li><li>  <font color="#0000ff">break</font> ; </li><li>  } </li><li>  <font color="#008000">// Mouse event</font> </li><li>  <font color="#0000ff">case</font> SDL_MOUSEBUTTONDOWN: <font color="#0000ff">case</font> SDL_MOUSEBUTTONUP: <font color="#0000ff">case</font> SDL_MOUSEMOTION: </li><li>  { </li><li>  MouseListenersList :: const_iterator m_it = mouse_listeners.begin (), m_end = mouse_listeners.end (); </li><li>  <font color="#0000ff">for</font> (; m_it! = m_end; ++ m_it) </li><li>  { </li><li>  <font color="#0000ff">if</font> (evt.type == SDL_MOUSEBUTTONDOWN || evt.type == SDL_MOUSEBUTTONUP) </li><li>  (* m_it) -&gt; onMouseBtn (evt.button); </li><li>  <font color="#0000ff">if</font> (evt.type == SDL_MOUSEMOTION) </li><li>  (* m_it) -&gt; onMouseMotion (evt.motion); </li><li>  } </li><li>  <font color="#0000ff">break</font> ; </li><li>  } </li><li>  <font color="#008000">// All other events</font> </li><li>  <font color="#0000ff">default</font> : </li><li>  OtherEventsListenersList :: const_iterator other_it = other_listeners.begin (), other_end = other_listeners.end (); </li><li>  <font color="#0000ff">for</font> (; other_it! = other_end; ++ other_it) </li><li>  (* other_it) -&gt; onEvent (evt); </li><li>  } </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br>  This method retrieves events from the queue and sends them to the right listeners.  The code is easy to adapt to listen to different specific types of events.  In fact, you can create quite a few highly specialized listeners, in this case I gave only examples of mouse and keyboard listeners. <br>  It remains quite a bit - to implement methods for registering listeners.  Everything is simple, so I will give the implementation code only for the methods of registering keyboard listeners, the rest are implemented by analogy: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">void</font> InputManager :: regKeyboardListener (KeyboardListener * l) </li><li>  { </li><li>  <font color="#0000ff">if</font> (l &amp;&amp; std :: find (kb_listeners.begin (), kb_listeners.end (), l) == kb_listeners.end ()) </li><li>  kb_listeners.push_back (l); </li><li>  } </li><li></li><li>  <font color="#0000ff">void</font> InputManager :: unregKeyboardListener (KeyboardListener * l) </li><li>  { </li><li>  <font color="#0000ff">if</font> (l) </li><li>  kb_listeners.remove (l); </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br>  Now we have a decent input manager, not ideal of course, but giving room for imagination in terms of further improvement.  Using the input manager, the main program loop can be rewritten: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  InputManager * imgr = <font color="#0000ff">new</font> InputManager (); </li><li>  <font color="#0000ff">while</font> (! stop) </li><li>  { </li><li>  imgr-&gt; capture (); </li><li>  root-&gt; renderOneFrame (); </li><li>  ... </li><li>  } </li><li>  delete imgr; </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br>  For event handling, you will need to create classes that implement the appropriate interfaces.  At a minimum, it is worth catching the SDL_QUIT event to correctly terminate the program :) <br><br><h4>  At last </h4><br>  I must say that I don‚Äôt find it necessary to use SDL, but the library is nonetheless very enjoyable to use.  The API, although fully written in C, is not inferior in terms of convenience to the object-oriented OIS interface.  Binding to OGRE also does not bring any particular inconvenience.  OGRE, in turn, showed once again its performance in conditions of extreme use :) </div><p>Source: <a href="https://habr.com/ru/post/86207/">https://habr.com/ru/post/86207/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../86193/index.html">Poll. I wonder how many habrazhiteli use identi.ca</a></li>
<li><a href="../86195/index.html">Tax checks freelancers Minsk. Part 2. Court</a></li>
<li><a href="../86196/index.html">Sales of iPhone 3GS will begin tomorrow night</a></li>
<li><a href="../86199/index.html">Next ICQ problems</a></li>
<li><a href="../86201/index.html">Browsers - Cars</a></li>
<li><a href="../86211/index.html">WD TV Review</a></li>
<li><a href="../86212/index.html">Firefox 3.7 Alpha 2 is available for download.</a></li>
<li><a href="../86214/index.html">Another pebble in the direction of IE6: D</a></li>
<li><a href="../86215/index.html">The first online release of BSDMagazine has been released.</a></li>
<li><a href="../86216/index.html">Skype in the Ovi Store</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>