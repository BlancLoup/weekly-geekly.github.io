<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Pure functional data structures</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I admit. I didn't really like the course on data structures and algorithms at the university. All these stacks, queues, heaps, trees, graphs (if they ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Pure functional data structures</h1><div class="post__text post__text-html js-mediator-article">  I admit.  I didn't really like the course on data structures and algorithms at the university.  All these stacks, queues, heaps, trees, graphs (if they were not okay) and other ‚Äúwitty‚Äù names of incomprehensible and complex data structures didn‚Äôt want to be fixed in my head.  As a true ‚Äúpragmatist,‚Äù I already in the second - third year believed in a standard library of classes and prayed to collections (and mere mortals) bestowed on us and containers carefully realized by fathers and noble CS.  It seemed that all that could be invented was already invented and implemented long ago. <br><br>  Everything changed about a year ago, when I found out that there is another world.  The world is different from ours with you.  A cleaner and more predictable world.  A world without side effects, mutations, arrays and destructive updates (reassignments to a variable).  A world where the wise queen persistence rules and her beautiful sisters rule all - function and recursion.  I'm talking about a purely functional world, where there are harmoniously, or even live, projections of almost all known data structures. <br><br>  And now, I want to show you a small bit of this world.  Through a keyhole, we look at this wonderful world for a second to consider one of its most striking inhabitants - the functional red-ebony (CCD). <br><a name="habracut"></a><br><h4>  About purely functional data structures </h4><br>  Pure functional data structures (CFSDs) as a class exist for two reasons.  First, for 99% imperative implementations, the stumbling block is the so-called destructive updates (assignment to a variable with the loss of the previous value).  It is clear that such a scenario is impossible in the functional world, because we are always dealing with immutable objects.  Secondly, in the functional world, after changing the collection, we expect that its previous version remains available to us.  Hence the term ‚Äúpersistent object‚Äù (persistent object) - support for multiple versions of an object. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Thus, one cannot simply take and port a certain imperative realization into a functional world.  It is necessary to remember about its limitations (no updates) and requirements (persistence).  Therefore, the process of adapting an imperative implementation to a functional environment is somewhat more complex and even mysterious.  And unsurpassed master in this difficult matter for 15 years, <a href="http://www.usma.edu/eecs/SitePages/Chris%2520Okasaki.aspx">Chris Okasaki</a> is considered with his fundamental work - <a href="http://www.amazon.com/Purely-Functional-Structures-Chris-Okasaki/dp/0521663504">Purely Functional Data Structures</a> . <br><br><h4>  About Chris and his book </h4><br>  In 1998, Chris defended his thesis on CSDS and a year later published the theses in the form of a book.  Chris's book is 200 pages of very dense (informative) and fascinating read.  The text, whose style borders on scientific work and informal conversation with a friend in a bar, literally reads like an artistic novel.  Chris's work combines the best practices and approaches in implementing CSFS, supported by examples of well-known (and not very) data structures in Standard ML and Haskell. <br><br><h4>  About two keys </h4><br>  An attentive reader will say that with such requirements and restrictions everything will be terribly slow.  It seems that any change in the functional collection is accompanied by its full copying in order to maintain persistence.  This is not entirely true.  More precisely - not at all.  Copying is really present, but at the most minimal scale.  More formally, only what really changes is copied.  The rest of the collection (as a big plan) is shared between versions.  These two sentences are the keys to understanding purely functional data structures.  These are unique tools that are invented and honed by the sharpest minds of AF.  The name of these tools is path copying (copying only what is affected in the operation) and structural sharing (common parts can be safely shared between versions, since each such part is itself unchangeable). <br><br><h4>  About binary search trees </h4><br>  First, consider the usual unbalanced binary search trees (DBP), which are very easily ported to the functional world.  Their structure looks like this: <br><br><pre><code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Tree</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">value</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Int</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Tree</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Tree</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isEmpty</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Boolean</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Leaf</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Tree</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">value</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Int</span></span> = fail(<span class="hljs-string"><span class="hljs-string">"Empty tree."</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Tree</span></span> = fail(<span class="hljs-string"><span class="hljs-string">"Empty tree."</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Tree</span></span> = fail(<span class="hljs-string"><span class="hljs-string">"Empty tree."</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isEmpty</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Boolean</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Branch</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">value: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, left: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Tree</span></span></span></span><span class="hljs-class"><span class="hljs-params"> = </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Leaf</span></span></span></span><span class="hljs-class"><span class="hljs-params">, right: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Tree</span></span></span></span><span class="hljs-class"><span class="hljs-params"> = </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Leaf</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Tree</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isEmpty</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Boolean</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span> }</code> </pre> <br>  We are interested in the insert operation, which will allow us to fully appreciate the strength and beauty of path copying and structural sharing tools. <br><br><pre> <code class="scala hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span></span>(x: <span class="hljs-type"><span class="hljs-type">Int</span></span>): <span class="hljs-type"><span class="hljs-type">Tree</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isEmpty) <span class="hljs-type"><span class="hljs-type">Branch</span></span>(x) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x &lt; value) <span class="hljs-type"><span class="hljs-type">Branch</span></span>(value, left.add(x), right) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x &gt; value) <span class="hljs-type"><span class="hljs-type">Branch</span></span>(value, left, right.add(x)) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span></code> </pre><br>  As in the imperative algorithm, the problem of insertion is reduced to the problem of finding a suitable place for a new node.  However, our functional implementation will be slightly more interesting.  The insert operation into the functional tree combines two passes - a downward (top-down) <code>add</code> call chain (searching for an insertion point) and a bottom-up call chain of the Branch constructor (copying a modified part of the tree along the search path).  The first pass (the downward search for the insertion point) is an obvious projection of the imperative algorithm.  We are also interested in the second pass (ascending path copying), which makes our implementation fully functional (persistent). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ac8/1a3/58c/ac81a358c322a2233f5334c157153ac7.png"></div><br>  To preserve the persistence property, it is necessary to maintain two versions of the collection - ‚Äúbefore‚Äù and ‚Äúafter‚Äù insertion.  Therefore, any changes to the internal structure of the nodes should be made on their copies.  As a result of inserting into a tree, a kind of ‚Äúchain reaction‚Äù of updating nodes (changing links to the left / right descendant) occurs, extending along the search path from the insertion point to the root of the tree.  This is the way to describe the ‚Äúmagic‚Äù that is implemented by the ascending passage, combining ideas and path copying (nodes ‚Äú5‚Äù and ‚Äú7‚Äù copied) and structural sharing (subtree with keys ‚Äú1‚Äù, ‚Äú2‚Äù, ‚Äú3‚Äù contained in both versions of the collection). <br><br><h4>  About red and black trees </h4><br>  A red-ebony tree (CCD) is a self-balancing binary search tree for which two invariants are valid: <br><br><ul><li>  <strong><font color="red">Red invariant</font></strong> : no red node has a red ancestor </li><li>  <strong>Black invariant</strong> : each path from root to leaf has the same number of black nodes </li></ul><br>  Execution of these invariants ensures that the tree will be balanced with the height of log n, where n is the number of nodes in the tree.  In other words, the main operations on the FDC are guaranteed to be performed in logarithmic time. <br><br>  Until 1999, the KChD in the functional world was out of the question.  The imperative implementation was notoriously difficult to port, since it was completely built on complex manipulations with pointers (pointers hell).  For example, in Cormen, eight possible cases of violation of invariants and corresponding measures to eliminate them are considered.  Slightly deviating from the topic, one can add that it is precisely because of the excessive complexity of the PSD that they tried in every possible way to replace with alternative things.  For example, Sezhevik proposed the <a href="http://www.cs.princeton.edu/~rs/talks/LLRB/LLRB.pdf">LLRB tree</a> as a simplified version of the CHD. <br><br>  However, in 1999, Chris Okasaki published <a href="http://www.ccs.neu.edu/course/cs3500wc/jfp99redblack.pdf">an article</a> in which he presented a purely functional implementation of the PSD.  This article is still in great demand among both functional programmers and imperative programmers.  The fact is that the article presents a very simple and understandable idea of ‚Äã‚Äãimplementation, which any programmer can understand and program in 15 minutes.  Chris said that there are only 4 patterns (see picture below) that break one of the invariants.  And our task is to find these patterns and rebuild them into one and the same construction with a red root and two black children (see picture).  And it's all.  Those.  in order to obtain a PSD from DBP, it is enough for us to change the second (ascending) pass of the insertion algorithm.  Now the second pass should not just copy the nodes along the search path, but also if the subtree matches one of the four patterns, rebuild it into a safe structure.  In other words, the copying phase in the algorithm is combined with the balancing phase. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ed1/926/43d/ed192643dea794362067b2d6668d9ddb.png"></div><br>  Adding to this two simple facts that the CCD root is always black, and the new node is always red, we get the following code: <br><br><pre> <code class="scala hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span></span>(x: <span class="hljs-type"><span class="hljs-type">Int</span></span>): <span class="hljs-type"><span class="hljs-type">Tree</span></span> = { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">balancedAdd</span></span></span></span>(t: <span class="hljs-type"><span class="hljs-type">Tree</span></span>): <span class="hljs-type"><span class="hljs-type">Tree</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (t.isEmpty) <span class="hljs-type"><span class="hljs-type">Tree</span></span>.make(<span class="hljs-type"><span class="hljs-type">Red</span></span>, x) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x &lt; t.value) balanceLeft(t.color, t.value, balancedAdd(t.left), t.right) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x &gt; t.value) balanceRight(t.color, t.value, t.left, balancedAdd(t.right)) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> t <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">balanceLeft</span></span></span></span>(c: <span class="hljs-type"><span class="hljs-type">Color</span></span>, x: <span class="hljs-type"><span class="hljs-type">Int</span></span>, l: <span class="hljs-type"><span class="hljs-type">Tree</span></span>, r: <span class="hljs-type"><span class="hljs-type">Tree</span></span>) = (c, l, r) <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> (<span class="hljs-type"><span class="hljs-type">Black</span></span>, <span class="hljs-type"><span class="hljs-type">Branch</span></span>(<span class="hljs-type"><span class="hljs-type">Red</span></span>, y, <span class="hljs-type"><span class="hljs-type">Branch</span></span>(<span class="hljs-type"><span class="hljs-type">Red</span></span>, z, a, b), c), d) =&gt; <span class="hljs-type"><span class="hljs-type">Tree</span></span>.make(<span class="hljs-type"><span class="hljs-type">Red</span></span>, y, <span class="hljs-type"><span class="hljs-type">Tree</span></span>.make(<span class="hljs-type"><span class="hljs-type">Black</span></span>, z, a, b), <span class="hljs-type"><span class="hljs-type">Tree</span></span>.make(<span class="hljs-type"><span class="hljs-type">Black</span></span>, x, c, d)) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> (<span class="hljs-type"><span class="hljs-type">Black</span></span>, <span class="hljs-type"><span class="hljs-type">Branch</span></span>(<span class="hljs-type"><span class="hljs-type">Red</span></span>, z, a, <span class="hljs-type"><span class="hljs-type">Branch</span></span>(<span class="hljs-type"><span class="hljs-type">Red</span></span>, y, b, c)), d) =&gt; <span class="hljs-type"><span class="hljs-type">Tree</span></span>.make(<span class="hljs-type"><span class="hljs-type">Red</span></span>, y, <span class="hljs-type"><span class="hljs-type">Tree</span></span>.make(<span class="hljs-type"><span class="hljs-type">Black</span></span>, z, a, b), <span class="hljs-type"><span class="hljs-type">Tree</span></span>.make(<span class="hljs-type"><span class="hljs-type">Black</span></span>, x, c, d)) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-type"><span class="hljs-type">Tree</span></span>.make(c, x, l, r) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">balanceRight</span></span></span></span>(c: <span class="hljs-type"><span class="hljs-type">Color</span></span>, x: <span class="hljs-type"><span class="hljs-type">A</span></span>, l: <span class="hljs-type"><span class="hljs-type">Tree</span></span>, r: <span class="hljs-type"><span class="hljs-type">Tree</span></span>) = (c, l, r) <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> (<span class="hljs-type"><span class="hljs-type">Black</span></span>, a, <span class="hljs-type"><span class="hljs-type">Branch</span></span>(<span class="hljs-type"><span class="hljs-type">Red</span></span>, y, b, <span class="hljs-type"><span class="hljs-type">Branch</span></span>(<span class="hljs-type"><span class="hljs-type">Red</span></span>, z, c, d))) =&gt; <span class="hljs-type"><span class="hljs-type">Tree</span></span>.make(<span class="hljs-type"><span class="hljs-type">Red</span></span>, y, <span class="hljs-type"><span class="hljs-type">Tree</span></span>.make(<span class="hljs-type"><span class="hljs-type">Black</span></span>, x, a, b), <span class="hljs-type"><span class="hljs-type">Tree</span></span>.make(<span class="hljs-type"><span class="hljs-type">Black</span></span>, z, c, d)) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> (<span class="hljs-type"><span class="hljs-type">Black</span></span>, a, <span class="hljs-type"><span class="hljs-type">Branch</span></span>(<span class="hljs-type"><span class="hljs-type">Red</span></span>, z, <span class="hljs-type"><span class="hljs-type">Branch</span></span>(<span class="hljs-type"><span class="hljs-type">Red</span></span>, y, b, c), d)) =&gt; <span class="hljs-type"><span class="hljs-type">Tree</span></span>.make(<span class="hljs-type"><span class="hljs-type">Red</span></span>, y, <span class="hljs-type"><span class="hljs-type">Tree</span></span>.make(<span class="hljs-type"><span class="hljs-type">Black</span></span>, x, a, b), <span class="hljs-type"><span class="hljs-type">Tree</span></span>.make(<span class="hljs-type"><span class="hljs-type">Black</span></span>, z, c, d)) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-type"><span class="hljs-type">Tree</span></span>.make(c, x, l, r) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">blacken</span></span></span></span>(t: <span class="hljs-type"><span class="hljs-type">Tree</span></span>) = <span class="hljs-type"><span class="hljs-type">Tree</span></span>.make(<span class="hljs-type"><span class="hljs-type">Black</span></span>, t.value, t.left, t.right) blacken(balancedAdd(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)) }</code> </pre><br>  In the considered implementation, there are a couple more points that require additional comments.  First, each tree node contains additional information ‚Äî its own color ( <code>color</code> function).  Secondly, the <code>balance</code> function, which implements balancing and copying, is divided into two functions (the <code>balanceLeft</code> and <code>balanceRight</code> ), which expect to find violation of invariants in the left or right subtree (only along the search patch), and process two patterns for each side, respectively. <br><br><h4>  On the complexity of imperative implementation </h4><br>  A fair question arises - why the implementation of the CHD in the imperative world looks much more complicated?  The answer is quite simple - to blame for performance.  Dealing with pointers and variable variables, we can stop the balancing process at its earliest iterations (under certain conditions), thereby reducing the running time of the algorithm.  In the functional environment, we are forced to copy all the affected nodes, so the extra checks for the presence of patterns in the subtrees do not bother us much.  For the sake of justice, it is worth replacing that the proposed algorithm for inserting into a functional PSD has the same asymptotic complexity as the original algorithm from the imperative world - O (log n). <br><br><h4>  About further steps </h4><br>  I have collected some great links for those interested in the topic. <br><br>  For researchers: <br><br><ol><li>  <a href="http://www.slideshare.net/vkostyukov/purely-functional-data-structures-in-scala-26175521">My review presentation of ChFSD with examples on Scala</a> (video report for the Novosibirsk Scala meeting <a href="http://www.youtube.com/watch%3Fv%3DfWnaW3CP7OI">here</a> ) </li><li>  <a href="http://arxiv.org/pdf/1312.4666v1.pdf">My attempt to port a binary heap to the functional world</a> </li><li>  <a href="https://github.com/vkostyukov/scalacaster/">Code of PSD and other structures on GitHub</a> </li><li>  <a href="http://matt.might.net/articles/red-black-delete/">Removal from PSD from Metta Mait</a> </li><li>  <a href="http://okasaki.blogspot.com/">Chris Okasaki's blog</a> </li></ol><br>  For practitioners: <br><br><ol><li>  Anre Andersonin in <a href="http://user.it.uu.se/~arnea/ps/searchproc.pdf">this article</a> proposed to reduce the number of comparisons from ‚Äú2 * d‚Äù to ‚Äúd + 1‚Äù, where d is the depth of the tree (search path length).  Modify the insert operation in DBP so that it uses fewer comparisons. </li><li>  Write a function <code>fromOrderedList</code> , which builds a balanced DBP from a sorted list.  Hint: Hinze, Ralf.  1999 "Constructing red-black trees". </li></ol></div><p>Source: <a href="https://habr.com/ru/post/208918/">https://habr.com/ru/post/208918/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../208904/index.html">New kind of developers - Java Coder Framework?</a></li>
<li><a href="../208906/index.html">Classification of 3D printers (7 3D printing technologies)</a></li>
<li><a href="../208908/index.html">Reversing simulated time</a></li>
<li><a href="../208910/index.html">Torrent server Demonoid back to life</a></li>
<li><a href="../208914/index.html">Clustering a nodejs web server using node-clusterize-cli</a></li>
<li><a href="../208920/index.html">Alternative to PVS-Studio for $ 250</a></li>
<li><a href="../208922/index.html">Javascript: check your intuition</a></li>
<li><a href="../208926/index.html">Original Apple iMac</a></li>
<li><a href="../208928/index.html">How to prepare and get a PMP certificate in two weeks</a></li>
<li><a href="../208932/index.html">Free screencasts to explore Go</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>