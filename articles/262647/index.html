<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>"Pimp my game", or how to "pump over" games without API</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I think many of you at least once in your life engaged in the modification of your favorite computer game. It could be editing resources (for example,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>"Pimp my game", or how to "pump over" games without API</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/ac1/c10/2bf/ac1c102bf7b9e8f50fffd8a27edefc36.png" alt="image"><br><br>  I think many of you at least once in your life engaged in the modification of your favorite computer game.  It could be editing resources (for example, character models and objects from <a href="https://en.wikipedia.org/wiki/Grand_Theft_Auto_(series)">GTA</a> ), writing various scripts (for example, the <a href="http://www.bay12games.com/dwarves/">Dwarf Fortress</a> task scheduler, launched using <a href="https://github.com/DFHack/dfhack">DFHack</a> ) or developing mods for your <a href="https://minecraft.net/">Minecraft</a> server that was running <a href="http://www.minecraftforge.net/wiki/">Minecraft Forge</a> . <br><br>  In many cases, game developers do not provide an official API for expanding functionality, leaving an indifferent community alone with their own ideas and desires, which sometimes result in fairly large-scale projects. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Sitting one evening at one of my favorite games called <a href="http://www.unrealworld.fi/">UnReal World</a> (hereinafter <a href="http://www.unrealworld.fi/">referred</a> to as URW), I once again encountered an incredibly inconvenient behavior for me.  The natural desire of almost any player when meeting with a more or less strong enemy is to save instantly, so as not to lose everything he has achieved at the moment (yes, some will consider it ‚Äúrudeness‚Äù / ‚Äúcheat‚Äù / etc, but do not argue about tastes) .  The problem is that save-boot quickly in the URW just will not work.  When saving a character, you automatically exit to the main menu, and exit without saving to return to the previous save point, you can only kill the game process through <a href="https://en.wikipedia.org/wiki/Task_Manager_(Windows)">taskmgr</a> .  As a result, in most cases, difficult battles in the later stages of the game (when it is really a pity to lose everything that I have accumulated over a long time) ended in insane combinations and memorized keystrokes. <br><br>  And then I thought.  And what's stopping us from adding our own quick load and save menu?  Armed with a PE file debugger, editor and analyzers, I set to work. <br><br>  How was the process, and what came of it, read under the cut (carefully, a <b>lot of screenshots</b> ).  Before reading this article, I also strongly recommend that you familiarize yourself with the <a href="http://habrahabr.ru/users/nikitatrophimov/topics/">previous ones</a> , since  they have already explained some of the points outlined here. <br><a name="habracut"></a><br>  A few words about the game itself.  UnReal World is a computer game, developed since 1992 by two Finnish developers, and continuing its development in our days.  The game is a representative of the genre of <a href="https://en.wikipedia.org/wiki/Roguelike">roguelike</a> and will make you plunge into the life of the northern tribes of the late Iron Age.  At the time of this writing, the URW is absolutely free (however, this was not always the case), and for donating any size you will receive a video with thanks, taken by the authors of the game, and if you pay more than a certain amount, you will receive a so-called.  lifetime membership, which will give you access to a hidden forum section with beta releases and other goodies.  In general, the game is really worth playing it. <br><br>  If you have carefully read the previous articles, you probably already know where we will begin the study of the binary.  True, with the analysis of the executable urw.exe file with the utilities <a href="https://tuts4you.com/download.php%3Fview.3518">DiE</a> and <a href="https://tuts4you.com/download.php%3Fview.398">PEiD</a> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a0c/387/434/a0c3874348f2328ca05a4a67a83023d2.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/195/732/c2b/195732c2b3f8d6d857965e2bc32d5436.png" alt="image"><br><br>  No packers and projectors were reported, so we can assume that we won't have to shoot anything this time. <br><br>  We now turn to the test for the use of <a href="https://en.wikipedia.org/wiki/Address_space_layout_randomization">ASLR</a> technology.  We load urw.exe into <a href="http://sourceforge.net/projects/pe-tools/">PE Tools</a> , click on the ‚ÄúOptional Header‚Äù button and see the ‚ÄúDLL Flags‚Äù option already familiar to us from previous articles: 0x8140: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e61/46d/791/e6146d791b52f086bc917fc5ffee6d73.png" alt="image"><br><br>  Change it to 0x8100 (why this is explained, for example, <a href="http://habrahabr.ru/post/261507/">here</a> ) and click on the two ‚ÄúOk‚Äù buttons, thus causing the executable file to be loaded at the same address every time, equal to Image Base (in our case, it is <b>0x00400000</b> ). <br><br>  We load urw.exe into <a href="http://www.ollydbg.de/">OllyDbg</a> and think over the procedure: <br><ul><li>  Find the character loading procedure and figure out how to interact with it. </li><li>  Find the process of saving the character and also find out how to interact with it. </li><li>  Assign the opening of the menu "Quick save-load" to some unused hotkey and draw it </li></ul><br>  Let's start with the first item. <br><br>  We create a character, save it and, after going to the main menu, we try to load it.  Your attention should fall on the message "Loading% character_name%": <br><br><img src="https://habrastorage.org/getpro/habr/post_images/970/59a/8d1/97059a8d17e322e547eb6bc57c514dc7.png" alt="image"><br><br>  Let's find references to this line in the disassembled listing: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/60f/bdd/069/60fbdd069e6c0de70ce514588e597783.png" alt="image"><br><br>  Very similar to that!  We set the breakpoint, exit to the main menu and try to load our character again: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/85f/184/f84/85f184f84137511e3a0f2a64b61c93b7.png" alt="image"><br><br>  Assuming that this whole procedure is responsible for loading the character, we jump to call it using the window with the call stack <br><br><img src="https://habrastorage.org/getpro/habr/post_images/203/16a/13d/20316a13d4b95cefda173d2473354b3f.png" alt="image"><br><br>  and we see that she does not require any ‚Äúenvironment‚Äù for her work: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f54/1e6/5be/f541e65beeb050d8a353f7ff905d37db.png" alt="image"><br><br>  Let us turn to the second point - the search for the procedure involved in the preservation of the character. <br><br>  The procedure is, in principle, similar to the previous step.  First, we look at what happens at the moment of saving the character and pay attention to the fact that in this case the game also writes a corresponding message: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1a4/615/4d4/1a46154d4e7930a1f297d819787830d8.png" alt="image"><br><br>  Now we are looking for the string ‚ÄúSaving your character ...‚Äù in the ‚ÄúReferenced text strings‚Äù of the urw module: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0f1/035/6af/0f10356af3e91d2f99d4f18a79b3eb9d.png" alt="image"><br><br>  We put the bryak on the instructions that refer to this line, and again we try to save the character: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/661/61d/a52/66161da5219ead40f43108624a7e1bc6.png" alt="image"><br><br>  Next, jump to the place of the current procedure call <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ba0/619/28d/ba061928dcaf1894464060e19abd6f1c.png" alt="image"><br><br>  and look at the "environment": <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f65/e0f/d72/f65e0fd72d677a54087f8e4a479c01d5.png" alt="image"><br><br>  As you can see, before calling the character saving procedure, the number 1 is put on the stack, which is most likely its argument.  If we look into the procedure body, we will really see the <b>EBP + 8</b> addresses in a couple of places (the <b>EBP</b> register contains the old value of the <b>EBP</b> register, <b>EBP + 4</b> is the address of the instruction that you need to transfer control after the current procedure completes, from the <b>EBP</b> address <b>+8</b> arguments begin, if they, of course, exist, and local variables are usually found for negative offsets: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f16/6a7/a83/f166a7a83b064c9c821535b1fa514bec.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/31e/773/6bf/31e7736bf2e4eb50e4f501f23b9a16bc.png" alt="image"><br><br>  A quick look can be guessed that the value of this argument is responsible for the need to display messages about the beginning and end of the download. <br><br>  It is equally important to pay attention to the <b>ADD ESP, 4</b> instruction, which immediately follows the call to the character saving procedure.  It "cleans up" the place in the stack, which was occupied by the arguments of the procedure (in this case, only one).  Requirements for who should ‚Äúclean‚Äù the stack are determined by various <a href="https://en.wikipedia.org/wiki/Calling_convention">calling conventions</a> . <br><br>  So, we have dealt with the procedures for loading and saving the game world, so let's move on to the next step - finding the unallocated hotkey and drawing our menu. <br><br>  Fortunately, in one of the previous versions, the menu of ‚Äúextended commands‚Äù was ‚Äúcut out‚Äù from the game, which was previously called by entering the '#' character.  Now when you try to activate it, the game displays the following message: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3db/eb0/8ea/3dbeb08ea0c1fc9280ff9efc4fe6c458.png" alt="image"><br><br>  What is not an ideal place for patching? <br><br>  We are looking for references to the line ‚ÄúExtended commands menu has been removed‚Äù <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2d0/3a6/3d2/2d03a63d297107fe0c20b5a6198972d9.png" alt="image"><br><br>  and jump on the only one of them: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/407/d4c/eb1/407d4ceb18e6acb879b75c4f62ea7be5.png" alt="image"><br><br>  Left-click on the start of the procedure and press Ctrl-R to find the places from which it is called: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ee2/434/41e/ee243441e6c8cd74ca874e576396f246.png" alt="image"><br><br>  Well, this is just one call.  We jump on it and find ourselves in one of the cases of the switch-block: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/934/ca8/2b8/934ca82b839bc6c1bb959afc8fe2324c.png" alt="image"><br><br>  Well, we found a place to implement our patch.  Now let's think about how we will draw the menu for quick loading and saving. <br><br>  Obviously, this menu should fit into the rest of the visual component of the game, as is done, for example, from the ‚ÄúFishing‚Äù menu: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/005/049/b50/005049b5001a722b5ad18c0251605f0b.png" alt="image"><br><br>  There are too many references to the ‚ÄúFishing options‚Äù line, so let's try to find references to ‚ÄúRetrieve a net‚Äù: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7a6/bd9/e97/7a6bd9e97323e34184183e4842e20c30.png" alt="image"><br><br>  We jump to the specified instruction and get into one of the cases: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0fb/4f2/a89/0fb4f2a89c77c6ebf4ce3f709ca62fcc.png" alt="image"><br><br>  We set up a bryak, trying to open the ‚ÄúFishing‚Äù menu and see where we were called from: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c30/733/37b/c3073337b0e56fc322bb69060ba07e3e.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/7ac/03b/355/7ac03b355557249afe40c6b61aaf05da.png" alt="image"><br><br>  We put the breakpoint at the beginning of this procedure, press F9 in OllyDbg and again try to activate the fishing menu.  As a result of step-by-step debugging, we can assume that the procedure <b>0x004FC530</b> is responsible for getting the text for the next menu item from the switch block we‚Äôve seen before, and the procedure located at <b>0x004BEF10</b> is responsible for drawing the menu items: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/564/0bd/fa4/5640bdfa423021414cf0c4125f97d0f4.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/050/73e/a2b/05073ea2b758245e00df27768db5a044.png" alt="image"><br><br>  Arg1 indicates the ASCII code of the character that must be entered to select the corresponding menu item, and Arg2 is responsible for its name. <br><br>  For drawing the menu itself with its name, the procedure <b>0x004BF3B0</b> is responsible, which takes as its argument the menu title.  Also for some reason, the value at <b>0xAE16068 is</b> changed to 1 before calling this procedure and to 0 after it: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c6c/d3a/3f4/c6cd3a3f432f1fcbed1fb64c9061efe4.png" alt="image"><br><br>  Please note that in the case of these procedures, responsibility for the cleanup stack also lies on the caller's shoulders. <br><br>  The <b>0x004BF3B0</b> procedure returns control to the code that called it only after selecting one of the menu options or pressing the Esc key, putting in the <b>EAX</b> register a number denoting the ASCII code of the character entered (in the case of Esc, it will be zero). <br><br>  Let's think over our patch code: <br><br><pre><code class="hljs pgsql">;    PUSH "Save" PUSH <span class="hljs-number"><span class="hljs-number">0x53</span></span> ; <span class="hljs-string"><span class="hljs-string">'S'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> <span class="hljs-number"><span class="hljs-number">0x004BEF10</span></span> ;    ,    <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> ESP,<span class="hljs-number"><span class="hljs-number">8</span></span> PUSH "Load" PUSH <span class="hljs-number"><span class="hljs-number">0x4C</span></span> ; <span class="hljs-string"><span class="hljs-string">'L'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> <span class="hljs-number"><span class="hljs-number">0x004BEF10</span></span> ;    ,    <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> ESP,<span class="hljs-number"><span class="hljs-number">8</span></span> ;      PUSH "Quick save-load" MOV DWORD PTR DS:[<span class="hljs-number"><span class="hljs-number">0xAE16068</span></span>],<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> <span class="hljs-number"><span class="hljs-number">0x004BF3B0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> ESP,<span class="hljs-number"><span class="hljs-number">4</span></span> MOV DWORD PTR DS:[<span class="hljs-number"><span class="hljs-number">0xAE16068</span></span>],<span class="hljs-number"><span class="hljs-number">0</span></span> ; ,    CMP EAX,<span class="hljs-number"><span class="hljs-number">53</span></span> JE save ;   <span class="hljs-string"><span class="hljs-string">'S'</span></span> CMP EAX,<span class="hljs-number"><span class="hljs-number">4</span></span>C JNZ <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> ;    <span class="hljs-string"><span class="hljs-string">'L'</span></span> JMP <span class="hljs-keyword"><span class="hljs-keyword">load</span></span> save: PUSH <span class="hljs-number"><span class="hljs-number">1</span></span> ;          <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> <span class="hljs-number"><span class="hljs-number">0x005030E0</span></span> ;   ,    <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> ESP,<span class="hljs-number"><span class="hljs-number">4</span></span> JMP <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">load</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> <span class="hljs-number"><span class="hljs-number">0x0050CB90</span></span> ;   ,    JMP <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>: ;   <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">case</span></span> switch-,    ;   ,     <span class="hljs-string"><span class="hljs-string">'#'</span></span> JMP <span class="hljs-number"><span class="hljs-number">0x0050C8C1</span></span></code> </pre> <br>  We are looking for a place for our code cave at the end of the executable image.  I decided to start it from the address <b>0x0051039B</b> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dbb/47a/c28/dbb47ac2848c4b7e5e9787ff3196f5ff.png" alt="image"><br><br>  Here is what happened: <br><br><pre> <code class="hljs pgsql"><span class="hljs-number"><span class="hljs-number">0051039</span></span>B . <span class="hljs-number"><span class="hljs-number">53</span></span> <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">76</span></span> <span class="hljs-number"><span class="hljs-number">65</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> ASCII "Save",<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">005103</span></span>A0 . <span class="hljs-number"><span class="hljs-number">4</span></span>C <span class="hljs-number"><span class="hljs-number">6</span></span>F <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> ASCII "Load",<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">005103</span></span>A5 . <span class="hljs-number"><span class="hljs-number">51</span></span> <span class="hljs-number"><span class="hljs-number">75</span></span> <span class="hljs-number"><span class="hljs-number">69</span></span> <span class="hljs-number"><span class="hljs-number">63</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>B <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">73</span></span> <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">76</span></span> <span class="hljs-number"><span class="hljs-number">65</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>D <span class="hljs-number"><span class="hljs-number">6</span></span>C <span class="hljs-number"><span class="hljs-number">6</span></span>F <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> ASCII "Quick save-load",<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">005103</span></span>B5 <span class="hljs-number"><span class="hljs-number">68</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span>B035100 PUSH urw<span class="hljs-number"><span class="hljs-number">.0051039</span></span>B ; ASCII "Save" <span class="hljs-number"><span class="hljs-number">005103</span></span>BA <span class="hljs-number"><span class="hljs-number">6</span></span>A <span class="hljs-number"><span class="hljs-number">53</span></span> PUSH <span class="hljs-number"><span class="hljs-number">53</span></span> <span class="hljs-number"><span class="hljs-number">005103</span></span>BC E8 <span class="hljs-number"><span class="hljs-number">4</span></span>FEBFAFF <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> urw<span class="hljs-number"><span class="hljs-number">.004</span></span>BEF10 <span class="hljs-number"><span class="hljs-number">005103</span></span>C1 <span class="hljs-number"><span class="hljs-number">83</span></span>C4 <span class="hljs-number"><span class="hljs-number">08</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> ESP,<span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">005103</span></span>C4 <span class="hljs-number"><span class="hljs-number">68</span></span> A0035100 PUSH urw<span class="hljs-number"><span class="hljs-number">.005103</span></span>A0 ; ASCII "Load" <span class="hljs-number"><span class="hljs-number">005103</span></span>C9 <span class="hljs-number"><span class="hljs-number">6</span></span>A <span class="hljs-number"><span class="hljs-number">4</span></span>C PUSH <span class="hljs-number"><span class="hljs-number">4</span></span>C <span class="hljs-number"><span class="hljs-number">005103</span></span>CB E8 <span class="hljs-number"><span class="hljs-number">40</span></span>EBFAFF <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> urw<span class="hljs-number"><span class="hljs-number">.004</span></span>BEF10 <span class="hljs-number"><span class="hljs-number">005103</span></span>D0 <span class="hljs-number"><span class="hljs-number">83</span></span>C4 <span class="hljs-number"><span class="hljs-number">08</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> ESP,<span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">005103</span></span>D3 <span class="hljs-number"><span class="hljs-number">68</span></span> A5035100 PUSH urw<span class="hljs-number"><span class="hljs-number">.005103</span></span>A5 ; ASCII "Quick save-load" <span class="hljs-number"><span class="hljs-number">005103</span></span>D8 C705 <span class="hljs-number"><span class="hljs-number">6860E10</span></span>A <span class="hljs-number"><span class="hljs-number">01000000</span></span> MOV DWORD PTR DS:[AE16068],<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">005103E2</span></span> E8 C9EFFAFF <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> urw<span class="hljs-number"><span class="hljs-number">.004</span></span>BF3B0 <span class="hljs-number"><span class="hljs-number">005103E7</span></span> <span class="hljs-number"><span class="hljs-number">83</span></span>C4 <span class="hljs-number"><span class="hljs-number">04</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> ESP,<span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">005103</span></span>EA C705 <span class="hljs-number"><span class="hljs-number">6860E10</span></span>A <span class="hljs-number"><span class="hljs-number">00000000</span></span> MOV DWORD PTR DS:[AE16068],<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">005103</span></span>F4 <span class="hljs-number"><span class="hljs-number">83</span></span>F8 <span class="hljs-number"><span class="hljs-number">53</span></span> CMP EAX,<span class="hljs-number"><span class="hljs-number">53</span></span> <span class="hljs-number"><span class="hljs-number">005103</span></span>F7 <span class="hljs-number"><span class="hljs-number">74</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> JE SHORT urw<span class="hljs-number"><span class="hljs-number">.00510400</span></span> <span class="hljs-number"><span class="hljs-number">005103</span></span>F9 <span class="hljs-number"><span class="hljs-number">83</span></span>F8 <span class="hljs-number"><span class="hljs-number">4</span></span>C CMP EAX,<span class="hljs-number"><span class="hljs-number">4</span></span>C <span class="hljs-number"><span class="hljs-number">005103</span></span>FC <span class="hljs-number"><span class="hljs-number">75</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span> JNZ SHORT urw<span class="hljs-number"><span class="hljs-number">.00510411</span></span> <span class="hljs-number"><span class="hljs-number">005103</span></span>FE EB <span class="hljs-number"><span class="hljs-number">0</span></span>C JMP SHORT urw<span class="hljs-number"><span class="hljs-number">.0051040</span></span>C <span class="hljs-number"><span class="hljs-number">00510400</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>A <span class="hljs-number"><span class="hljs-number">01</span></span> PUSH <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">00510402</span></span> E8 D92CFFFF <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> urw<span class="hljs-number"><span class="hljs-number">.005030E0</span></span> <span class="hljs-number"><span class="hljs-number">00510407</span></span> <span class="hljs-number"><span class="hljs-number">83</span></span>C4 <span class="hljs-number"><span class="hljs-number">04</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> ESP,<span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">0051040</span></span>A EB <span class="hljs-number"><span class="hljs-number">05</span></span> JMP SHORT urw<span class="hljs-number"><span class="hljs-number">.00510411</span></span> <span class="hljs-number"><span class="hljs-number">0051040</span></span>C E8 <span class="hljs-number"><span class="hljs-number">7</span></span>FC7FFFF <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> urw<span class="hljs-number"><span class="hljs-number">.0050</span></span>CB90 <span class="hljs-number"><span class="hljs-number">00510411</span></span> ^ E9 ABC4FFFF JMP urw<span class="hljs-number"><span class="hljs-number">.0050</span></span>C8C1</code> </pre><br>  Let's add an unconditional jump to our code cave in the case block, which is responsible for handling the opening of the extended command menu: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a57/fff/9c7/a57fff9c74c3b57e13a2595ab3c2df4f.png" alt="image"><br><br>  Push '#' in the game and ... <br><br><img src="https://habrastorage.org/getpro/habr/post_images/373/1d9/81d/3731d981da56a1050269336599f30ac8.png" alt="image"><br><br>  What it is?  Apparently, after opening the previous menu the list of items was not cleared, but only expanded with new ones.  Let's take another look at how the ‚ÄúFishing‚Äù menu is <b>rendered</b> and note that in the case of our menu we don‚Äôt call at least one more procedure - <b>0x004BED40</b> .  Perhaps it is she who is responsible for the cleanup, because her challenge is right before drawing all the items: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7f4/56c/b51/7f456cb51b6b869cd45f513014237884.png" alt="image"><br><br>  Despite the fact that before calling this procedure, the values ‚Äã‚Äãof the <b>EBX</b> register are <b>placed</b> on the stack, it is not at all an argument of this procedure, as can be seen by looking at its implementation: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/533/e4a/d74/533e4ad74bb02cb6e401a31c8d02b23e.png" alt="image"><br><br>  In order not to ‚Äúshift‚Äù all the instructions and not to change the addresses in the code cave already written, let's add a call to this procedure to the case-block code <br><br><img src="https://habrastorage.org/getpro/habr/post_images/67f/317/c24/67f317c24f86c76b59635f7a3ffa1fa2.png" alt="image"><br><br>  and try entering the '#' character again: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3c2/a27/8d4/3c2a278d4488403202c1eb3d0e914f9e.png" alt="image"><br><br>  Fine! <br><br>  We play with save-load <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4a7/3b6/55c/4a73b655cc7977508c28a9ec98b8e1af.png" alt="image"><br><br>  and notice that at first glance everything works as it should. <br><br>  In the process of testing come to the village <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e05/530/eb8/e05530eb83fd529def246b23ca765610.png" alt="image"><br><br>  and press # - S again: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cc5/d2e/0b1/cc5d2e0b170eb3bf0f7ef4e27a584193.png" alt="image"><br><br>  Where are the people? <br><br>  Apparently, the process of saving the game world also contains the cleanup code of game objects, since  It was not designed to be used outside the context of entering the main menu.  You can get out of this situation in two ways - to find out exactly where the cleanup code is (and there are not enough nested calls, believe me), or to cheat and perform saving followed by loading instead of the usual saving.  I propose to stay on the last version.  We change our code cave, having finished the <b>JMP 0x00510411</b> instruction, located at <b>0x0051040A</b> : <br><br><pre> <code class="hljs pgsql"><span class="hljs-number"><span class="hljs-number">0051039</span></span>B . <span class="hljs-number"><span class="hljs-number">53</span></span> <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">76</span></span> <span class="hljs-number"><span class="hljs-number">65</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> ASCII "Save",<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">005103</span></span>A0 . <span class="hljs-number"><span class="hljs-number">4</span></span>C <span class="hljs-number"><span class="hljs-number">6</span></span>F <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> ASCII "Load",<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">005103</span></span>A5 . <span class="hljs-number"><span class="hljs-number">51</span></span> <span class="hljs-number"><span class="hljs-number">75</span></span> <span class="hljs-number"><span class="hljs-number">69</span></span> <span class="hljs-number"><span class="hljs-number">63</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>B <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">73</span></span> <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">76</span></span> <span class="hljs-number"><span class="hljs-number">65</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>D <span class="hljs-number"><span class="hljs-number">6</span></span>C <span class="hljs-number"><span class="hljs-number">6</span></span>F <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> ASCII "Quick save-load",<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">005103</span></span>B5 <span class="hljs-number"><span class="hljs-number">68</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span>B035100 PUSH urw<span class="hljs-number"><span class="hljs-number">.0051039</span></span>B ; ASCII "Save" <span class="hljs-number"><span class="hljs-number">005103</span></span>BA <span class="hljs-number"><span class="hljs-number">6</span></span>A <span class="hljs-number"><span class="hljs-number">53</span></span> PUSH <span class="hljs-number"><span class="hljs-number">53</span></span> <span class="hljs-number"><span class="hljs-number">005103</span></span>BC E8 <span class="hljs-number"><span class="hljs-number">4</span></span>FEBFAFF <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> urw<span class="hljs-number"><span class="hljs-number">.004</span></span>BEF10 <span class="hljs-number"><span class="hljs-number">005103</span></span>C1 <span class="hljs-number"><span class="hljs-number">83</span></span>C4 <span class="hljs-number"><span class="hljs-number">08</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> ESP,<span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">005103</span></span>C4 <span class="hljs-number"><span class="hljs-number">68</span></span> A0035100 PUSH urw<span class="hljs-number"><span class="hljs-number">.005103</span></span>A0 ; ASCII "Load" <span class="hljs-number"><span class="hljs-number">005103</span></span>C9 <span class="hljs-number"><span class="hljs-number">6</span></span>A <span class="hljs-number"><span class="hljs-number">4</span></span>C PUSH <span class="hljs-number"><span class="hljs-number">4</span></span>C <span class="hljs-number"><span class="hljs-number">005103</span></span>CB E8 <span class="hljs-number"><span class="hljs-number">40</span></span>EBFAFF <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> urw<span class="hljs-number"><span class="hljs-number">.004</span></span>BEF10 <span class="hljs-number"><span class="hljs-number">005103</span></span>D0 <span class="hljs-number"><span class="hljs-number">83</span></span>C4 <span class="hljs-number"><span class="hljs-number">08</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> ESP,<span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">005103</span></span>D3 <span class="hljs-number"><span class="hljs-number">68</span></span> A5035100 PUSH urw<span class="hljs-number"><span class="hljs-number">.005103</span></span>A5 ; ASCII "Quick save-load" <span class="hljs-number"><span class="hljs-number">005103</span></span>D8 C705 <span class="hljs-number"><span class="hljs-number">6860E10</span></span>A <span class="hljs-number"><span class="hljs-number">01000000</span></span> MOV DWORD PTR DS:[AE16068],<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">005103E2</span></span> E8 C9EFFAFF <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> urw<span class="hljs-number"><span class="hljs-number">.004</span></span>BF3B0 <span class="hljs-number"><span class="hljs-number">005103E7</span></span> <span class="hljs-number"><span class="hljs-number">83</span></span>C4 <span class="hljs-number"><span class="hljs-number">04</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> ESP,<span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">005103</span></span>EA C705 <span class="hljs-number"><span class="hljs-number">6860E10</span></span>A <span class="hljs-number"><span class="hljs-number">00000000</span></span> MOV DWORD PTR DS:[AE16068],<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">005103</span></span>F4 <span class="hljs-number"><span class="hljs-number">83</span></span>F8 <span class="hljs-number"><span class="hljs-number">53</span></span> CMP EAX,<span class="hljs-number"><span class="hljs-number">53</span></span> <span class="hljs-number"><span class="hljs-number">005103</span></span>F7 <span class="hljs-number"><span class="hljs-number">74</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> JE SHORT urw<span class="hljs-number"><span class="hljs-number">.00510400</span></span> <span class="hljs-number"><span class="hljs-number">005103</span></span>F9 <span class="hljs-number"><span class="hljs-number">83</span></span>F8 <span class="hljs-number"><span class="hljs-number">4</span></span>C CMP EAX,<span class="hljs-number"><span class="hljs-number">4</span></span>C <span class="hljs-number"><span class="hljs-number">005103</span></span>FC <span class="hljs-number"><span class="hljs-number">75</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span> JNZ SHORT urw<span class="hljs-number"><span class="hljs-number">.00510411</span></span> <span class="hljs-number"><span class="hljs-number">005103</span></span>FE EB <span class="hljs-number"><span class="hljs-number">0</span></span>C JMP SHORT urw<span class="hljs-number"><span class="hljs-number">.0051040</span></span>C <span class="hljs-number"><span class="hljs-number">00510400</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>A <span class="hljs-number"><span class="hljs-number">01</span></span> PUSH <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">00510402</span></span> E8 D92CFFFF <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> urw<span class="hljs-number"><span class="hljs-number">.005030E0</span></span> <span class="hljs-number"><span class="hljs-number">00510407</span></span> <span class="hljs-number"><span class="hljs-number">83</span></span>C4 <span class="hljs-number"><span class="hljs-number">04</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> ESP,<span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">0051040</span></span>A <span class="hljs-number"><span class="hljs-number">90</span></span> NOP <span class="hljs-number"><span class="hljs-number">0051040</span></span>B <span class="hljs-number"><span class="hljs-number">90</span></span> NOP <span class="hljs-number"><span class="hljs-number">0051040</span></span>C E8 <span class="hljs-number"><span class="hljs-number">7</span></span>FC7FFFF <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> urw<span class="hljs-number"><span class="hljs-number">.0050</span></span>CB90 <span class="hljs-number"><span class="hljs-number">00510411</span></span> ^ E9 ABC4FFFF JMP urw<span class="hljs-number"><span class="hljs-number">.0050</span></span>C8C1</code> </pre><br>  Great!  Objects still disappear, but immediately appear due to subsequent download. <br><br>  Let's try to save our changes to disk: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/475/be2/f37/475be2f37524951ca3fe7105c70ef956.png" alt="image"><br><br>  It is sad to realize, but the instructions added by us closer to the end of the image of the executable file came out beyond its ‚Äúphysical boundaries‚Äù, as it was already in <a href="http://habrahabr.ru/post/261507/">one of the previous articles</a> . <br><br>  Let's calculate the upper "border" by looking at the information about the urw.exe sections in PE Tools: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b41/a74/29f/b41a7429f24b72cbdb5fb457f117a9ec.png" alt="image"><br><br>  Virtual Offset ( <b>0x00001000</b> ) + Raw Size ( <b>0x0010F400</b> ) + Image Base ( <b>0x00400000</b> ) = <b>0x00510400</b> <br><br>  Those.  highlighted instructions "got out" for the "border": <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7c9/449/9e6/7c94499e67e350c6bd5c5037e1362b2a.png" alt="image"><br><br>  <b>NOPs</b> , of course, can be removed, but we still have 20 bytes left without them.  Another 5 bytes we can borrow in front of our code cave: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6ae/964/7c1/6ae9647c1c481c41188cd60eabe37696.png" alt="image"><br><br>  But what to do with the remaining 15 bytes?  You can reduce the size of the lines responsible for the menu items and its title, making them, for example, equal to "S", "L" and "S &amp; L", but this is not a very elegant solution. <br><br>  It is possible that in the middle of a disassembled listing there are also places where you can add your own code.  These can be zeros, which we usually found at the end of the image of the executable file, <b>NOPs</b> or, for example, <b>INT3</b> instructions that follow each other between the procedure bodies.  This is the last case observed in urw.exe.  For example, <br><br><img src="https://habrastorage.org/getpro/habr/post_images/660/8a7/a6d/6608a7a6d1bd5c34c7d96c84993fd8b2.png" alt="image"><br><br>  Let's break up the lines and save and load processing to the following places: <br><br><pre> <code class="hljs pgsql"><span class="hljs-number"><span class="hljs-number">00409</span></span>FBA . <span class="hljs-number"><span class="hljs-number">53</span></span> <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">76</span></span> <span class="hljs-number"><span class="hljs-number">65</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> ASCII "Save",<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">00409</span></span>FBF . <span class="hljs-number"><span class="hljs-number">4</span></span>C <span class="hljs-number"><span class="hljs-number">6</span></span>F <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> ASCII "Load",<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">00409</span></span>FC4 . <span class="hljs-number"><span class="hljs-number">51</span></span> <span class="hljs-number"><span class="hljs-number">75</span></span> <span class="hljs-number"><span class="hljs-number">69</span></span> <span class="hljs-number"><span class="hljs-number">63</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>B <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">73</span></span> <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">76</span></span> <span class="hljs-number"><span class="hljs-number">65</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>D <span class="hljs-number"><span class="hljs-number">6</span></span>C <span class="hljs-number"><span class="hljs-number">6</span></span>F <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> ASCII "Quick save-load",<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">005007</span></span>A2 <span class="hljs-number"><span class="hljs-number">6</span></span>A <span class="hljs-number"><span class="hljs-number">01</span></span> PUSH <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">005007</span></span>A4 E8 <span class="hljs-number"><span class="hljs-number">37290000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> urw<span class="hljs-number"><span class="hljs-number">.005030E0</span></span> <span class="hljs-number"><span class="hljs-number">005007</span></span>A9 ^ E9 C6F5FFFF JMP urw<span class="hljs-number"><span class="hljs-number">.004</span></span>FFD74 <span class="hljs-number"><span class="hljs-number">004</span></span>FFD74 <span class="hljs-number"><span class="hljs-number">83</span></span>C4 <span class="hljs-number"><span class="hljs-number">04</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> ESP,<span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">004</span></span>FFD77 ^ E9 <span class="hljs-number"><span class="hljs-number">16</span></span>FFFFFF JMP urw<span class="hljs-number"><span class="hljs-number">.004</span></span>FFC92 <span class="hljs-number"><span class="hljs-number">004</span></span>FFC92 E8 F9CE0000 <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> urw<span class="hljs-number"><span class="hljs-number">.0050</span></span>CB90 <span class="hljs-number"><span class="hljs-number">004</span></span>FFC97 E9 <span class="hljs-number"><span class="hljs-number">25</span></span>CC0000 JMP urw<span class="hljs-number"><span class="hljs-number">.0050</span></span>C8C1 <span class="hljs-number"><span class="hljs-number">0050</span></span>C438 &gt; \BE <span class="hljs-number"><span class="hljs-number">20</span></span>C75300 MOV ESI,urw_<span class="hljs-number"><span class="hljs-number">.0053</span></span>C720 ; ASCII "Extended commands"; <span class="hljs-keyword"><span class="hljs-keyword">Case</span></span> <span class="hljs-number"><span class="hljs-number">23</span></span> (<span class="hljs-string"><span class="hljs-string">'#'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> switch <span class="hljs-number"><span class="hljs-number">0050</span></span>C3FB <span class="hljs-number"><span class="hljs-number">0050</span></span>C43D . E8 FE28FBFF <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> urw<span class="hljs-number"><span class="hljs-number">.004</span></span>BED40 <span class="hljs-number"><span class="hljs-number">0050</span></span>C442 E9 <span class="hljs-number"><span class="hljs-number">4</span></span>F3F0000 JMP urw<span class="hljs-number"><span class="hljs-number">.00510396</span></span> <span class="hljs-number"><span class="hljs-number">0050</span></span>C447 . E9 <span class="hljs-number"><span class="hljs-number">75040000</span></span> JMP urw<span class="hljs-number"><span class="hljs-number">.0050</span></span>C8C1 <span class="hljs-number"><span class="hljs-number">00510396</span></span> <span class="hljs-number"><span class="hljs-number">68</span></span> BA9F4000 PUSH urw<span class="hljs-number"><span class="hljs-number">.00409</span></span>FBA ; ASCII "Save" <span class="hljs-number"><span class="hljs-number">0051039</span></span>B <span class="hljs-number"><span class="hljs-number">6</span></span>A <span class="hljs-number"><span class="hljs-number">53</span></span> PUSH <span class="hljs-number"><span class="hljs-number">53</span></span> <span class="hljs-number"><span class="hljs-number">0051039</span></span>D E8 <span class="hljs-number"><span class="hljs-number">6</span></span>EEBFAFF <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> urw<span class="hljs-number"><span class="hljs-number">.004</span></span>BEF10 <span class="hljs-number"><span class="hljs-number">005103</span></span>A2 <span class="hljs-number"><span class="hljs-number">83</span></span>C4 <span class="hljs-number"><span class="hljs-number">08</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> ESP,<span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">005103</span></span>A5 <span class="hljs-number"><span class="hljs-number">68</span></span> BF9F4000 PUSH urw<span class="hljs-number"><span class="hljs-number">.00409</span></span>FBF ; ASCII "Load" <span class="hljs-number"><span class="hljs-number">005103</span></span>AA <span class="hljs-number"><span class="hljs-number">6</span></span>A <span class="hljs-number"><span class="hljs-number">4</span></span>C PUSH <span class="hljs-number"><span class="hljs-number">4</span></span>C <span class="hljs-number"><span class="hljs-number">005103</span></span>AC E8 <span class="hljs-number"><span class="hljs-number">5</span></span>FEBFAFF <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> urw<span class="hljs-number"><span class="hljs-number">.004</span></span>BEF10 <span class="hljs-number"><span class="hljs-number">005103</span></span>B1 <span class="hljs-number"><span class="hljs-number">83</span></span>C4 <span class="hljs-number"><span class="hljs-number">08</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> ESP,<span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">005103</span></span>B4 <span class="hljs-number"><span class="hljs-number">68</span></span> C49F4000 PUSH urw<span class="hljs-number"><span class="hljs-number">.00409</span></span>FC4 ; ASCII "Quick save-load" <span class="hljs-number"><span class="hljs-number">005103</span></span>B9 C705 <span class="hljs-number"><span class="hljs-number">6860E10</span></span>A <span class="hljs-number"><span class="hljs-number">01000000</span></span> MOV DWORD PTR DS:[AE16068],<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">005103</span></span>C3 E8 E8EFFAFF <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> urw<span class="hljs-number"><span class="hljs-number">.004</span></span>BF3B0 <span class="hljs-number"><span class="hljs-number">005103</span></span>C8 <span class="hljs-number"><span class="hljs-number">83</span></span>C4 <span class="hljs-number"><span class="hljs-number">04</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> ESP,<span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">005103</span></span>CB C705 <span class="hljs-number"><span class="hljs-number">6860E10</span></span>A <span class="hljs-number"><span class="hljs-number">00000000</span></span> MOV DWORD PTR DS:[AE16068],<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">005103</span></span>D5 <span class="hljs-number"><span class="hljs-number">83</span></span>F8 <span class="hljs-number"><span class="hljs-number">53</span></span> CMP EAX,<span class="hljs-number"><span class="hljs-number">53</span></span> <span class="hljs-number"><span class="hljs-number">005103</span></span>D8 ^ <span class="hljs-number"><span class="hljs-number">0</span></span>F84 C403FFFF JE urw<span class="hljs-number"><span class="hljs-number">.005007</span></span>A2 <span class="hljs-number"><span class="hljs-number">005103</span></span>DE <span class="hljs-number"><span class="hljs-number">83</span></span>F8 <span class="hljs-number"><span class="hljs-number">4</span></span>C CMP EAX,<span class="hljs-number"><span class="hljs-number">4</span></span>C <span class="hljs-number"><span class="hljs-number">005103E1</span></span> ^ <span class="hljs-number"><span class="hljs-number">0</span></span>F85 B0F8FEFF JNZ urw<span class="hljs-number"><span class="hljs-number">.004</span></span>FFC97 <span class="hljs-number"><span class="hljs-number">005103E7</span></span> ^ E9 A6F8FEFF JMP urw<span class="hljs-number"><span class="hljs-number">.004</span></span>FFC92</code> </pre><br>  This time the image is successfully saved, and we can enjoy playing URW with a new quick load and save menu. <br><br><h3>  Afterword </h3><br>  Laziness is one of the most annoying qualities in almost any person and field of activity.  Do not be lazy to spend a little time on solving the problem that you have met not the first time - perhaps this will save you much more time in the future. <br><br>  Thank you for your attention, and again I hope that the article was useful to someone. </div><p>Source: <a href="https://habr.com/ru/post/262647/">https://habr.com/ru/post/262647/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../262631/index.html">Beeline interferes with user traffic</a></li>
<li><a href="../262633/index.html">Shine always, shine everywhere. Start</a></li>
<li><a href="../262635/index.html">Internet Explorer 11 discovered zero day vulnerability</a></li>
<li><a href="../262639/index.html">Epic Games official forums hacked</a></li>
<li><a href="../262645/index.html">Firefox blocks Adobe Flash Player plugin</a></li>
<li><a href="../262649/index.html">[ABAP] Learn to use FOR ALL ENTRIES IN correctly</a></li>
<li><a href="../262651/index.html">Synth synthesizing on the example of Korg Monotron</a></li>
<li><a href="../262653/index.html">How beautiful to issue a publication on Habr√©</a></li>
<li><a href="../262655/index.html">Simple plan-fact analysis in Power BI Desktop. Part One - Consolidation and Data Cleansing</a></li>
<li><a href="../262657/index.html">Open design universal microcontroller module</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>