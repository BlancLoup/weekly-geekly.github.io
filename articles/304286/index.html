<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We send encrypted SMS messages from Virgil</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! 
 Despite the growing popularity of mobile messengers such as WhatsApp and Telegram, the good old SMS still does not lose its relevance. SMS...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We send encrypted SMS messages from Virgil</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/e83/379/948/e83379948c234dc28d04b232d3c888c2.jpg"></div><br>  Hi, Habr! <br>  Despite the growing popularity of mobile messengers such as WhatsApp and Telegram, the good old SMS still does not lose its relevance.  SMS can be used to send various kinds of notifications, for two-factor authentication, or when resetting a password.  However, the latest successful <a href="http://www.ptsecurity.ru/download/PT_SS7_security_2014_rus.pdf">attacks on mobile networks</a> make us think about an additional level of protection of SMS data. <br>  In this article we will talk about how using Virgil and Twilio services to make the process of sending SMS on an Android device secure. <br><a name="habracut"></a><br>  Before proceeding to programming, let us recall once again a number of preliminary actions. <br>  To send SMS, we will use the <a href="https://www.twilio.com/">Twilio API</a> , for access to which you need to create a Twilio account <a href="https://www.twilio.com/user/account/">here</a> .  After registration, you will receive special identifiers required for working with the API - TWILIO_ACCOUNT_SID and TWILIO_AUTH_TOKEN. <br><br>  To encrypt SMS messages, we need the help of the Virgil Crypto Library and the Virgil Keys Service, to access which you need to create a <a href="https://developer.virgilsecurity.com/account/signup">Virgil account</a> and generate a special token VIRGIL_ACCESS_TOKEN. <br><br>  After completing the above steps, you can proceed to the implementation of SMS notifications. <br>  Virgil services have a large <a href="https://virgilsecurity.com/downloads">set of SDKs</a> that allow you to work with them in almost any popular programming language.  In previous articles, we showed how to work with services using JavaScript.  Today, as a variety, we will code on <a href="https://github.com/VirgilSecurity/virgil-sdk-net">C #.</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We will write down the process of sending and receiving encrypted SMS in stages. <br><br><ol><li>  Install Virgil and Twilio SDK using the NuGet package manager: <br><br>  PM&gt; Install-Package Virgil.SDK <br>  PM&gt; Install-Package Twilio <br><br></li><li>  We initialize clients to work with Virgil and Twilio API: <br><br><pre><code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//   Twilio  string accountSid = "%TWILIO_ACCOUNT_SID%"; string authToken = "%TWILIO_AUTH_TOKEN%"; //  Twilio API  var twilio = new TwilioRestClient(accountSid, authToken); //  Virgil ,    var virgil = ServiceHub.Create("%VIRGIL_ACCESS_TOKEN%");</span></span></code> </pre> <br>  Notice the accountSid and authToken variables.  In them we indicate the identifiers of our Twilio account, which can be found <a href="https://www.twilio.com/user/account/">here</a> . <br><br></li><li>  Implement sending encrypted messages using the usual POST request to the Twilio service (send invitations with passwords to enter the party): <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//    SMS  var people = new Dictionary&lt;string,string&gt;() { {"+14XXXXXXXX1","Darth Vader"}, {"+14XXXXXXXX2","Luke Skywalker"}, {"+14XXXXXXXX3","Princess Leia"} }; //      Virgil Keys Service var peopleCards = await Task.WhenAll(people .Select(it =&gt; virgil.Cards.Search(number))); foreach (var personCards in peopleCards) { //   ,   var personCard = personCards.OrderBy(it =&gt; it.CreatedAt).Last(); var personName = people[personCard.Identity.Value]; //  ,        //       ( ). using (var tinyCipher = new VirgilTinyCipher(120)) { var message = $"Hey {personName}, your security word is STAR. We are waiting for you!"; var messageData = Encoding.UTF8.GetBytes(message); tinyCipher.Encrypt(messageData, personCard.PublicKey.Value); //   ,   ,    SMS  //  160-  (120   base64 ). for(int index = 0; index &lt; tinyCipher.GetPackageCount(); index++) { var encryptedMessage = Convert.ToBase64String(tinyCipher.GetPackage(index)); //      Twilio API twilio.SendMessage( SMS.Constants.TwilioPhoneNumber, //  ,  Twilio   SMS personCard.Identity.Value, //    encryptedMessage); } } }</span></span></code> </pre><br></li><li>  We decrypt the message on the side of the recipient.  To receive SMS we will use Android SMS API.  To decrypt the message, we also need the <a href="https://github.com/VirgilSecurity/virgil-sdk-net">.NET</a> Virgil SDK: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//  ,        120 . var tinyCipher = new VirgilTinyCipher(120); //  message    private void OnSmsReceived(string from, string message) { //     ,       //  ,      . this.tinyCipher.AddPackage(Convert.FromBase64String(message)); if (this.tinyCipher.IsPackagesAccumulated()) { var decryptedData = this.tinyCipher.Decrypt(this.myPrivateKey); var decryptedMessage = Encoding.UTF8.GetString(decryptedData, 0, decryptedData.Length); this.tinyCipher.Reset(); Application.Current.MainPage.DisplayAlert($"From: {from}", decryptedMessage, "Got It"); } }</span></span></code> </pre></li></ol><br><br>  As you can see with Twilio and Virgil API, sending and receiving encrypted SMS becomes a simple task that does not require in-depth knowledge of cryptography. <br><br><h4>  PS </h4><br>  You can download the source code for sending encrypted SMS messages on <a href="https://github.com/VirgilSecurity/virgil-demo-twilio-sms">GitHub</a> . </div><p>Source: <a href="https://habr.com/ru/post/304286/">https://habr.com/ru/post/304286/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../304276/index.html">GFI MailEssentials: Mail Protected</a></li>
<li><a href="../304278/index.html">Altaro VM Backup: Backup Hyper-V and VMware Virtual Machines</a></li>
<li><a href="../304280/index.html">Welcome to the IoT hackaton from Mail.Ru Group and Intel July 30‚Äì31</a></li>
<li><a href="../304282/index.html">The robot, which does answer the question about the weather in Tokyo (in fact - no, but close)</a></li>
<li><a href="../304284/index.html">Chat bot algorithms based on recurrent neural network and AIML language extensions</a></li>
<li><a href="../304288/index.html">PCI DSS: Trends and Benefits</a></li>
<li><a href="../304290/index.html">IaaS-digest: 30 materials on technology transformation</a></li>
<li><a href="../304292/index.html">Improving service design in IaaS model</a></li>
<li><a href="../304294/index.html">Independent Developer Cup</a></li>
<li><a href="../304296/index.html">Visualization with Google Chart Tools API</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>