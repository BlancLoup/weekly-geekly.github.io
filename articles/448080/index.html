<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Robo-footballer from beginners. Competitions in MIPT. Android & Arduino & Bluetooth</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article is a semi-sequel to the work of Love, Death and Robots "The machine on the Arduino, controlled by an Android device via Bluetooth, is a f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Robo-footballer from beginners. Competitions in MIPT. Android & Arduino & Bluetooth</h1><div class="post__text post__text-html js-mediator-article">  This article is a semi-sequel to the work of <s>Love, Death and Robots</s> "The machine on the Arduino, controlled by an Android device via Bluetooth, is a full cycle", consisting of two parts ( <a href="https://habr.com/ru/post/424087/">one</a> , <a href="https://habr.com/ru/post/424813/">two</a> ).  The things described there were slightly modified, reworked, and the robot turned from a riding machine into a football player.  In general, there is an interesting material on how to do it. <br><br>  The previous instruction was divided into two parts: software and physical.  There were not many changes in both directions, so this time everything is in one single copy.  I will briefly remind you why the described part is needed, but for complete understanding it is better to run through the first two parts. <br><a name="habracut"></a><br><h2>  Physical part </h2><br>  Based on all the same principles described in the first article: <br><br><ul><li>  Arduino Uno and Motor Shield sandwich. </li><li>  two motors connected to motor shield. </li></ul><br>  Here are the changes: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  there was a shock, oddly enough, responsible for hitting the ball. </li><li>  The body is now completely your own, printed on a 3D printer. </li></ul><br><h3>  Housing </h3><br>  The form is a circle in which both the board and the two wheels fit.  Lengthening for the part where the impact force will stand. <br><br><img src="https://habrastorage.org/webt/_y/3l/ei/_y3lei6subbvm0y1qfltplolwcg.jpeg"><br><br>  When constructing a similar pay attention to: <br><br><ul><li>  High bumpers.  Robots during the game collide, the sides protect not only your wires, but also your opponents from your wires. </li><li>  Center of gravity and stability.  The center of gravity is of course where the charge is.  The wheels are located near it, so they will not slip.  Plus a battery is put on top of the board. </li><li>  So that the robot does not nod or backwards, we put both the balls going in the set from the amperca to and from here (if there are none, you can replace it with any other sliding design). </li><li>  Stiffness design.  The platform should not sag under the weight of boards and motors.  Do not be stingy, either use solid materials (plywood), or strengthen the plastic construction with slats. </li></ul><br><img src="https://habrastorage.org/webt/cl/pn/a0/clpna0fp8fdkx_jys3g5dq505iy.jpeg"><br><br><h3>  And now the main nonsense </h3><br>  The balls added for lack of "pecking", lifted a platform so that wheels did not reach a floor.  To avoid this, either use larger wheels or shorten supporting structures.  In general, we calculate this in advance! <br><br>  Shock part.  She doesn't hit.  Beats, but not cool enough.  In our first model there was a servo machine to which a part resembling a snowplow bucket was connected.  Changing the position of the serva (from 0 to 30 degrees), you can simulate a blow.  But serfs were slow, so the blow goes to dvoechku. <br><br>  Exit two: add a jerk when struck or replace servy on solenoids.  The first option is to increase the momentum by supplying speed to the wheels during impact.  In practice, like this: the user presses the strike button, the robot starts from a place (slightly) and simultaneously makes a strike. <br><br>  The second option is that solenoids push the shock part and it all depends on the power (speed) of the thrust, which in turn depends on the characteristics of the solenoid. <br><br><img src="https://habrastorage.org/webt/ma/da/23/mada23ag3yr3pttwrtk9oxcfzyq.jpeg"><br><br><h2>  Software part </h2><br>  According to the good tradition, which is already one article, we divide this section into two parts.  First, an Android application, then an Arduino sketch. <br><br><h3>  Android </h3><br>  Let me remind you of the application written by me from scratch.  Over the past six months, I have understood a little more in this matter, so I will describe <s>what I</s> thought of before. <br><br>  First, let's go to the simplification.  Now the communication protocol is the following: ‚Äúopening character‚Äù + ‚Äúvalue‚Äù + ‚Äúclosing character‚Äù (To understand how I get these values ‚Äã‚Äãand what it is all about, see the full analysis of the application <a href="https://habr.com/ru/post/424813/">here</a> ).  This works for both the speed value and the angle.  Since there is only one type of impact, he does not need such wisdom, therefore the command consists of a single "/" character (about the command for hitting through a paragraph). <br><br><pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendCommand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String speed, String angle)</span></span></span><span class="hljs-function"> </span></span>{ String speedCommand = <span class="hljs-string"><span class="hljs-string">"#"</span></span> + speed + <span class="hljs-string"><span class="hljs-string">"#"</span></span>; <span class="hljs-comment"><span class="hljs-comment">//     String angleCommand = "@" + angle + "@"; try { outputStream.write(speedCommand.getBytes()); //   outputStream.write(angleCommand.getBytes()); } catch(Exception e) { e.printStackTrace(); } }</span></span></code> </pre> <br>  A typical command would look like this: # 125 # @ 180 @, where 125 is speed and 180 is angle.  Of course, this can still be simplified, but one of the tasks was to preserve ease and readability, so that later it could be easily explained, including to children. <br><br>  A new sendHit () command has been added, which is triggered while clicking on the ‚ÄúStrike‚Äù button.  It sends one "/" character.  Since the usual bluetooth 2.0+ does not suffer from data received at the same time, that is, it can put them in a queue and not lose them, we do not need to control this.  If you are going to work with Bluetooth Low Energy 4.0+ (well, all of a sudden), then there will already have to be a queue manually, otherwise the data will be lost. <br><br><pre> <code class="java hljs">... bHit = findViewById(R.id.b_high_hit); <span class="hljs-comment"><span class="hljs-comment">//   bHit.setOnClickListener(new View.OnClickListener() { @Override public void onClick(View view) { threadCommand.sendHit(); //     "" } }); ... private void sendHit() { try { outputStream.write("/".getBytes()); //   }catch (Exception e) { e.printStackTrace(); } } }</span></span></code> </pre><br><h3>  Arduino </h3><br>  So the command sending protocol changed, the reception algorithm also changed.  He simplified.  Also added one if tracking hit.  Full analysis of the sketch <a href="https://habr.com/ru/post/424813/">here</a> . <br><br>  bt.read () reads one character.  If it is equal to "#", then the symbols of speed begin.  Read them until the closing "#" appears.  A for loop cannot be used here, because the velocity length is not known in advance (it can be a single-digit, two-digit, or three-digit number).  The resulting value is written to the variable. <br><br>  The same thing happens with the turn.  After both the speed and the angle are read, we transfer everything to the turn (int speed, int angle) function. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(BTSerial.available() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) {<span class="hljs-comment"><span class="hljs-comment">//    char a = BTSerial.read(); //   if(a == '#') { //  sp=""; char b = BTSerial.read(); while( b != '#') { //   ,     sp+=b; b = BTSerial.read(); } } else if (a == '@') {//  val = ""; char b = BTSerial.read(); while(b != '@') { //    val+=b; //    b = BTSerial.read(); } turn(val.toInt(), sp.toInt()); //   ,   } else if (a == '/') { //,    Serial.println(a); servo.write(30); //  delay(150); servo.write(0); //    } lastTakeInformation = millis(); } else { if(millis() - lastTakeInformation &gt; 150) { //     150 //  lastTakeInformation = 0; analogWrite(speedRight, 0); analogWrite(speedLeft, 0); } } delay(5); }</span></span></code> </pre><br>  The turn () function determines which way to move (forward, backward) and where to turn (right, left, straight).  The if (speed&gt; 0 &amp;&amp; speed &lt;70) constraint is necessary so that the robot does not brake if bytes are lost.  I encountered this when I increased the transmission speed (played with delays of 100-300ms between the teams) - sometimes the speed did not reach the value and turned into 0.40 (although, for example, 240 was actually sent).  A crutch, but it works. <br>  Can be called "protection from uncontrollable factors." <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">turn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> angle, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> speed)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(speed &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; speed &lt; <span class="hljs-number"><span class="hljs-number">70</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(speed &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { digitalWrite(dirLeft, HIGH); digitalWrite(dirRight, HIGH); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sp &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { digitalWrite(dirLeft, LOW); digitalWrite(dirRight, LOW); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(angle &gt; <span class="hljs-number"><span class="hljs-number">149</span></span>) { analogWrite(speedLeft, speed); analogWrite(speedRight, speed - <span class="hljs-number"><span class="hljs-number">65</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  } else if (angle &lt; 31) { analogWrite(speedLeft, speed - 65); //  analogWrite(speedRight, speed); } else { analogWrite(speedLeft, speed); analogWrite(speedRight, speed); } }</span></span></code> </pre><br><h3>  Competitions in MIPT instead of the total </h3><br>  With our robot, we went to the robot football competitions, which were arranged and held at the MIPT University, Dolgoprudny, 04/14/2019.  We managed to reach the 1/4 finals, but did not advance further. <br><br><img src="https://habrastorage.org/webt/f0/n2/lx/f0n2lxvkzlyxv0jbm9rsnd6xffe.jpeg"><br><br>  The process itself was interesting to us, and here I will describe the conclusions that were made by looking at the robot in the field: <br><br><ul><li>  need more powerful.  Preferably four wheels or more powerful engines and other wheels.  Although, of course, it was four-wheeled models that looked better. </li><li>  management is not a buzz.  It is necessary to transfer the robot to a tank turn (turn at one point due to the wheels spinning in opposite directions), otherwise the turning radius is too large.  And in general, the option with four arrows, and not around with proportional speed, is preferable <b>for football</b> .  The described option is better suited for racing, where you go continuously, but you need clarity (turned 10 degrees around its axis, aimed at the ball and squeezed the button forward. But then, when I grabbed the ball, I would like to flexibly maneuver, but here it is necessary proportional speed ... you need to somehow combine this business). </li></ul><br>  Comments and suggestions will be very happy.  Under previous articles, comments are sometimes more interesting than the article itself.  Thanks for the work to <a href="https://vk.com/ddolgop">me</a> , <a href="https://vk.com/rai044der">Sasha</a> and <a href="https://vk.com/id232959559">Dana</a> . </div><p>Source: <a href="https://habr.com/ru/post/448080/">https://habr.com/ru/post/448080/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../448068/index.html">American scientists have taught robots to use auxiliary tools</a></li>
<li><a href="../448072/index.html">Joins understanding is broken. This is definitely not a lap crossing, honestly</a></li>
<li><a href="../448074/index.html">ALU on 12 transistors (actually not)</a></li>
<li><a href="../448076/index.html">Simple simulation system on Go</a></li>
<li><a href="../448078/index.html">On autoregressive estimation of the spectral density of a stationary signal</a></li>
<li><a href="../448082/index.html">[Before Monday] Dry Eye Syndrome</a></li>
<li><a href="../448084/index.html">Photo of a black hole - will it benefit?</a></li>
<li><a href="../448088/index.html">Production of plasma engines in Russia</a></li>
<li><a href="../448096/index.html">Julia in latex</a></li>
<li><a href="../448098/index.html">GHIDRA, Playstation 1 executables, FLIRT signatures and PsyQ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>