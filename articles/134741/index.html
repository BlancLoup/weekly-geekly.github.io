<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Prevent reloading libraries or remake jQuery.html ()</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="You probably have come across a situation where, when loading content from an ajax request, jquery automatically loads and runs nested libraries and s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Prevent reloading libraries or remake jQuery.html ()</h1><div class="post__text post__text-html js-mediator-article">  You probably have come across a situation where, when loading content from an ajax request, jquery automatically loads and runs nested libraries and scripts.  Undoubtedly, this is convenient, for example, when a self-sufficient plugin or widget is present in the loaded content.  Everything will automatically load, and visually looks all good. <br><br>  But if you look closely, everything is not so beautiful.  jQuery loads each nested library in whether it is loaded by the browser or not, and even adds a unique parameter to the query to prevent explorer cache usage.  I did not go into details why the jQuery developers chose such a scheme and made an wrapper around the html () function that fixes this problem. <br><a name="habracut"></a><br>  So.  What problems we need to solve: <br><br>  1. Do not load libraries and styles again. <br>  2. When loading new libraries or styles use browser cache <br>  3. Since nested scripts can use functions from connected libraries, they need to be run after loading all libraries. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In principle, nothing complicated.  The problem is solved using regular expressions. <br><br>  1. Cut out all the &lt;script&gt; and &lt;link&gt; tags from the content, compare with the already connected tags and load them, depending on the situation. <br>  2. Put the onload event handler for the link libraries in which we run all the nested scripts. <br><br>  I attach the code of the plugin itself: <br><br><pre><code class="javascript hljs">(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> originalHtmlMethod = $.fn.html; <span class="hljs-comment"><span class="hljs-comment">/** *      */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sanitize = { <span class="hljs-attr"><span class="hljs-attr">scriptsCountLoading</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">inlineScripts</span></span>:[], <span class="hljs-comment"><span class="hljs-comment">/** *     onload. *          */</span></span> loadingCompleted:<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scriptsCountLoading==<span class="hljs-number"><span class="hljs-number">0</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($.isArray(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.inlineScripts)){ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.inlineScripts.length; i++){ <span class="hljs-built_in"><span class="hljs-built_in">eval</span></span>.call(<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.inlineScripts[i]); } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.inlineScripts = []; }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.inlineScripts){ <span class="hljs-built_in"><span class="hljs-built_in">eval</span></span>.call(<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.inlineScripts); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.inlineScripts = []; } } } }, <span class="hljs-comment"><span class="hljs-comment">/** *   javascript       . *   scriptsCountLoading */</span></span> sanitizeScripts:<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> scripts = $(<span class="hljs-string"><span class="hljs-string">'script'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> scriptSrc = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;scripts.length; i++){ scriptSrc[scriptSrc.length] = scripts[i].src; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> patternScripts = <span class="hljs-regexp"><span class="hljs-regexp">/&lt;script[^&lt;&gt;]*?src=\"?([^&gt;&lt;\\\"\\']*)\"?[^&lt;&gt;]*?&gt;[\s\S]*?&lt;\/script&gt;/igm</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> absolutePath = <span class="hljs-regexp"><span class="hljs-regexp">/https?:\/\//</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> matches = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dataScriptSrc = {}; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (matches = patternScripts.exec(data)){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> matchedString = matches[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> src = matches[<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (absolutePath.test(src)){ <span class="hljs-comment"><span class="hljs-comment">// absolute path }else{ // relative path if (src[0]!='/'){ src = window.location.href.replace(/#|\?.*$/)+'/'+src; var m = null; while (m = /[^\/]*\/\.\.\//ig.exec(src)){ src = src.replace(m[0],''); } }else{ src = window.location.protocol+'//'+window.location.hostname+src; } } data = data.replace(matchedString,''); patternScripts.lastIndex -= matchedString.length; if ($.inArray(src,scriptSrc)==-1){ this.scriptsCountLoading++; //   var self = this; this.loadScript(src,function(){ self.scriptsCountLoading--; self.loadingCompleted(); }); } } return data; }, /** *   .        */ sanitizeInlineScripts:function(data){ var scripts = $('script'); var scriptSrc = []; for (var i=0; i&lt;scripts.length; i++){ scriptSrc[scriptSrc.length] = scripts[i].src; } var patternScripts = /&lt;script[^&lt;&gt;]*?&gt;([\s\S]*?)&lt;\/script&gt;/igm; var absolutePath = /https?:\/\//; var matches = null; var dataScriptSrc = {}; while (matches = patternScripts.exec(data)){ var matchedString = matches[0]; var script = matches[1]; data = data.replace(matchedString,''); patternScripts.lastIndex -= matchedString.length; this.inlineScripts[this.inlineScripts.length] = script } return data; }, /** *   css ,       */ sanitizeHeadLinks:function(data){ var links = $('link'); var linkSrc = []; for (var i=0; i&lt;links.length; i++){ linkSrc[linkSrc.length] = links[i].href; } var patternHeadLinks = /&lt;link[^&lt;&gt;]*?href=\"?([^&gt;&lt;\\\"\\']*)\"?[^&lt;&gt;]*?\/&gt;/igm; var absolutePath = /https?:\/\//; var matches = null; var dataScriptSrc = {}; while (matches = patternHeadLinks.exec(data)){ var matchedString = matches[0]; var src = matches[1]; if (absolutePath.test(src)){ // absolute path }else{ // relative path if (src[0]!='/'){ src = window.location.href.replace(/#|\?.*$/)+'/'+src; var m = null; while (m = /[^\/]*\/\.\.\//ig.exec(src)){ src = src.replace(m[0],''); } }else{ src = window.location.protocol+'//'+window.location.hostname+src; } } data = data.replace(matchedString,''); patternHeadLinks.lastIndex -= matchedString.length; if ($.inArray(src,linkSrc)==-1){ this.loadCSS(src); } } return data; }, /** *    */ sanitizeData:function(data){ data = this.sanitizeInlineScripts(this.sanitizeScripts(this.sanitizeHeadLinks(data))); return data; }, /** *   */ loadScript:function(url,onload){ var e = document.createElement("script"); e.src = url; e.type="text/javascript"; if (onload instanceof Function){ e.onreadystatechange= function () { if (this.readyState == 'complete') onload(); } e.onload= onload; } document.getElementsByTagName("head")[0].appendChild(e); }, /** *  css  */ loadCSS:function(url){ var oLink = document.createElement("link") oLink.href = url; oLink.rel = "stylesheet"; oLink.type = "text/css"; document.getElementsByTagName("head")[0].appendChild(oLink); } } /** *    html() */ $.fn.html = function(data){ data = sanitize.sanitizeData(data); var res = originalHtmlMethod.apply( this, [data] ); sanitize.loadingCompleted(); return res; } })(jQuery);</span></span></code> </pre> <br><br>  Upd: Considering the reaction of habrovchan, I consider it necessary to add some explanations. <br><br>  This post was created as an idea or option for a quick solution to the problem (without changing the architecture) arising from the use of this or that php framework.  In this case, guided by the architecture of Yii. <br><br>  Since plugins are a self-contained package of scripts, it‚Äôs enough just to ‚Äúplug in‚Äù them, as everything miraculously starts working.  In this case, the plugin itself will add all the necessary libraries, scripts, styles, and the framework will send this whole thing to the output. <br><br>  Many plugins load content dynamically (ajax), this is where the problem occurs.  In this dynamic content can be self-contained plug-in connected by means of Yii (with all libraries, scripts and styles).  When loading such content, jQuery will behave as described above.  Since these plugins use jQuery, it was logical to suggest overloading the html () function for global impact. <br><br>  In general, the change of the html () function itself is not critical.  You can also use the pre-installed dataFilter as stated in the first comment. </div><p>Source: <a href="https://habr.com/ru/post/134741/">https://habr.com/ru/post/134741/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../134734/index.html">Google patented robots</a></li>
<li><a href="../134735/index.html">Smart home appliances - LG THINQ technology</a></li>
<li><a href="../134736/index.html">Telepresence Robots Appear at Boston Children's Hospital</a></li>
<li><a href="../134738/index.html">Run jQuery on the Node.js engine instead of the browser</a></li>
<li><a href="../134740/index.html">PHP MongoDB ORM</a></li>
<li><a href="../134742/index.html">Debian and Ubuntu remove the jvm oracle and sun implementations from the distros</a></li>
<li><a href="../134743/index.html">Mozilla invites developers to test an experimental version of an app store.</a></li>
<li><a href="../134744/index.html">HTML.next or ideas for HTML6</a></li>
<li><a href="../134746/index.html">Petersburg has identified the best Internet startups in 2011</a></li>
<li><a href="../134747/index.html">Almost linear increase in bzip2 performance on multiprocessor systems</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>