<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automate testing of Windows applications using .Net</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Test automation. 
 Testing is an activity performed to evaluate and improve software quality. This activity, in general, is based on the detection of ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automate testing of Windows applications using .Net</h1><div class="post__text post__text-html js-mediator-article"><h4>  Test automation. </h4><br>  Testing is an activity performed to evaluate and improve software quality.  This activity, in general, is based on the detection of defects and problems in software systems. <br>  Testing of software systems consists of dynamic verification of program behavior on a finite (limited) set of tests, selected appropriately from the usually performed actions of the application area and ensuring compliance with the expected system behavior. <br>  The main approach when testing software is black box testing.  With this approach, the tester does not know the internal structure of the program.  The tester interacts with the program: enters data, presses buttons, manipulates other visual components and evaluates the results. <br><a name="habracut"></a><br>  Since complete testing is usually impossible or difficult to implement, the task of the tester is to select data and a sequence of actions where the errors of the program under test are most likely to occur. <br>  When developing software, testers conduct a large number of identical tests when conducting acceptance and regression testing.  In this regard, test automation can save a lot of man-hours.  When conducting automated testing, the task of the tester is to develop a test suite.  With direct testing, testers can do more important and intelligent tasks.  In addition, large sets of test items can be run at night, which will allow to intensify the development process and reduce the cost of the project.  In the morning, testers analyze the results, refine or recheck some tests and issue the required reports for transmission to the project manager or developers. <br><h4>  .Net platform mechanisms </h4><br>  When developing Windows applications on the .Net platform, you can use the platform to create a lightweight and flexible tool that will run the developed tests.  It is not necessary to create a complete solution, sometimes it makes sense to quickly create a set of automated tests that will be specified directly in the code.  To quickly modify and add tests, it is necessary to create and use an assembly with various methods that will perform the necessary actions for the tester with the user interface of the program. <br>  With automated testing of the user interface of Windows applications, two solutions are possible.  The first of these is based on the Reflection mechanism. <br>  The reflection mechanism allows you to get objects that describe assemblies, modules and types.  Reflection can be used to dynamically create an instance of a type, bind a type to an existing object, as well as get the type from an existing object and call its methods or access its fields and properties. <br>  The second approach is based on the low-level functions of the Win32 API libraries: FindWindow, FindWindowEx, SendMessage, PostMessage, and the P / Invoke mechanism (invoking unmanaged code). <br>  Calling unmanaged code is a service that allows managed code to call unmanaged functions implemented in dynamic-link libraries (DLLs).  Calling unmanaged code detects and calls the exported function. <br>  The second approach works not only for .Net applications, but for any Windows applications with a user interface. <br><h4>  Test application </h4><br>  The application under test adds two integers and, after pressing the button, displays the result.  If the addition failed for any reason, the word ‚ÄúError‚Äù is displayed instead of the result. <br><br> <a title="Habraffe.ru" href=""><img src="https://habrastorage.org/storage/habraeffect/4c/0c/4c0c9152fc9b0c5eb4a6f599fbccdf53.png"></a> <br><br> <a title="Habraffe.ru" href=""><img src="https://habrastorage.org/storage/habraeffect/46/ea/46eaa0c5d95a15b8a87c091d8adad89a.png"></a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Access to the code when testing the "black box" is not required.  We can not use our code and get all the necessary information from the assembly and the running application.  But when accessing the code, some procedures are simplified. <br>  The application is located at D: \ visual studio 2010 \ Projects \ WindowsFormsApplication1 \ WindowsFormsApplication1 \ bin \ Debug \ AUT.exe <br>  The name AUT is the common abbreviation for Application Under Testing. <br><h4>  Testing based on the mechanism of reflection. </h4><br>  When using the reflection mechanism, you must load the assembly, get the form type, create an instance, and start the application with this form in the new stream. <br>  If the tester does not have access to the source code, then you can use Red Gate's Reflector utility.  With its help you can see the names of the form, controls and methods. <br><br> <a title="Habraffe.ru" href=""><img src="https://habrastorage.org/storage/habraeffect/96/31/963115ed292646a8014594c05bc5e7f4.png"></a> <br><br>  This way you can see that the form class is called Form1.  The text fields are named textBox1 and textBox2, the button is button1, the result is output in a Label with the name label1.  The method of processing a button click is called button1_Click and accepts object and EventArgs parameters as input. <br>  To create an automated test data knowledge of the internal structure of the application is enough. <br>  To increase code reuse, we will create a series of classes and methods. <br>  The test application is launched using the StartApplication method. <br><br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">static</font> Form StartApplication( <font color="#0000ff">string</font> path, <font color="#0000ff">string</font> formName) <br> { <br> Form result = <font color="#0000ff">null</font> ; <br> <font color="#2B91AF">Assembly</font> a = <font color="#2B91AF">Assembly</font> .LoadFrom(path); <br> Type t = a.GetType(formName); <br> result = (Form)a.CreateInstance(t.FullName); <br> ApplicationState aps = <font color="#0000ff">new</font> ApplicationState(result); <br> ThreadStart ts = <font color="#0000ff">new</font> ThreadStart(aps.RunApp); <br> Thread thread = <font color="#0000ff">new</font> Thread(ts); <br> thread.Start(); <br> <font color="#0000ff">return</font> result; <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  At the entrance passed the path to the assembly and the name of the form.  The specified assembly is loaded, the form type is determined, an instance of the form is created and with its use the application is launched in the new stream: the delegate and the method for launching in the new stream are specified. <br>  <b>Class ApplicationState.</b> <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">class</font> ApplicationState <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">readonly</font> Form formToRun; <br> <br> <font color="#0000ff">public</font> ApplicationState(Form f) <br> { <br> <font color="#0000ff">this</font> .formToRun = f; <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> RunApp() <br> { <br> Application.Run(formToRun); <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  For reuse it is necessary to define a number of methods, fields and delegates. <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">static</font> BindingFlags flags = BindingFlags.Public | <br> BindingFlags.NonPublic | <br> BindingFlags.Static | <br> BindingFlags.Instance; <br> <br> <font color="#0000ff">delegate</font> <font color="#0000ff">void</font> SetControlPropertyValueHandler(Form f, <font color="#0000ff">string</font> controlName, <font color="#0000ff">string</font> propertyName, <font color="#0000ff">object</font> newValue); <br> <br> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SetControlPropertyValue(Form f, <font color="#0000ff">string</font> controlName, <font color="#0000ff">string</font> propertyName, <font color="#0000ff">object</font> newValue) <br> { <br> <font color="#0000ff">if</font> (f.InvokeRequired) <br> { <br> f.Invoke( <br> <font color="#0000ff">new</font> SetControlPropertyValueHandler(SetControlPropertyValue), <br> <font color="#0000ff">new</font> <font color="#0000ff">object</font> [] { f, controlName, propertyName, newValue } <br> ); <br> } <br> <font color="#0000ff">else</font> <br> { <br> Type t1 = f.GetType(); <br> FieldInfo fi = t1.GetField(controlName, flags); <br> <font color="#0000ff">object</font> ctrl = fi.GetValue(f); <br> Type t2 = ctrl.GetType(); <br> PropertyInfo pi = t2.GetProperty(propertyName); <br> pi.SetValue(ctrl, newValue, <font color="#0000ff">null</font> ); <br> } <br> } <br> <font color="#0000ff">static</font> AutoResetEvent are = <font color="#0000ff">new</font> AutoResetEvent( <font color="#0000ff">false</font> ); <br> <font color="#0000ff">delegate</font> <font color="#0000ff">void</font> InvokeMethodHandler(Form f, <font color="#0000ff">string</font> methodName, <font color="#0000ff">params</font> <font color="#0000ff">object</font> [] parms); <br> <font color="#0000ff">static</font> <font color="#0000ff">void</font> InvokeMethod(Form f, <font color="#0000ff">string</font> methodName, <font color="#0000ff">params</font> <font color="#0000ff">object</font> [] parms) <br> { <br> <font color="#0000ff">if</font> (f.InvokeRequired) <br> { <br> f.Invoke( <br> <font color="#0000ff">new</font> InvokeMethodHandler(InvokeMethod), <br> <font color="#0000ff">new</font> <font color="#0000ff">object</font> [] { f, methodName, parms } <br> ); <br> } <br> <font color="#0000ff">else</font> <br> { <br> Type t = f.GetType(); <br> MethodInfo mi = t.GetMethod(methodName, flags); <br> mi.Invoke(f, parms); <br> are.Set(); <br> } <br> } <br> <font color="#0000ff">delegate</font> <font color="#0000ff">object</font> GetControlPropertyValueHandler(Form f, <font color="#0000ff">string</font> controlName, <font color="#0000ff">string</font> propertyName); <br> <font color="#0000ff">static</font> <font color="#0000ff">object</font> GetControlPropertyValue(Form f, <font color="#0000ff">string</font> controlName, <font color="#0000ff">string</font> propertyName) <br> { <br> <font color="#0000ff">if</font> (f.InvokeRequired) <br> { <br> <font color="#0000ff">object</font> iResult = f.Invoke( <br> <font color="#0000ff">new</font> GetControlPropertyValueHandler(GetControlPropertyValue), <br> <font color="#0000ff">new</font> <font color="#0000ff">object</font> [] { f, controlName, propertyName } <br> ); <br> <font color="#0000ff">return</font> iResult; <br> } <br> <font color="#0000ff">else</font> <br> { <br> Type t1 = f.GetType(); <br> FieldInfo fi = t1.GetField(controlName, flags); <br> <font color="#0000ff">object</font> ctrl = fi.GetValue(f); <br> Type t2 = ctrl.GetType(); <br> PropertyInfo pi = t2.GetProperty(propertyName); <br> <font color="#0000ff">object</font> gResult = pi.GetValue(ctrl, <font color="#0000ff">null</font> ); <br> <font color="#0000ff">return</font> gResult; <br> } <br> } <br> <font color="#0000ff">delegate</font> <font color="#0000ff">object</font> GetControlHandler(Form f, <font color="#0000ff">string</font> controlName); <br> <font color="#0000ff">static</font> <font color="#0000ff">object</font> GetControl(Form f, <font color="#0000ff">string</font> controlName) <br> { <br> <font color="#0000ff">if</font> (f.InvokeRequired) <br> { <br> <font color="#0000ff">object</font> iCtrl = f.Invoke( <br> <font color="#0000ff">new</font> GetControlHandler(GetControl), <br> <font color="#0000ff">new</font> <font color="#0000ff">object</font> [] { f, controlName } <br> ); <br> <font color="#0000ff">return</font> iCtrl; <br> } <br> <font color="#0000ff">else</font> <br> { <br> Type t1 = f.GetType(); <br> FieldInfo fi = t1.GetField(controlName, flags); <br> <font color="#0000ff">object</font> gCtrl = fi.GetValue(f); <br> <font color="#0000ff">return</font> gCtrl; <br> } <br> } <br> <font color="#0000ff">delegate</font> <font color="#0000ff">object</font> GetFormPropertyValueHandler(Form f, <font color="#0000ff">string</font> propertyName); <br> <font color="#0000ff">static</font> <font color="#0000ff">object</font> GetFormPropertyValue(Form f, <font color="#0000ff">string</font> propertyName) <br> { <br> <font color="#0000ff">if</font> (f.InvokeRequired) <br> { <br> <font color="#0000ff">object</font> iResult = f.Invoke( <br> <font color="#0000ff">new</font> GetFormPropertyValueHandler(GetFormPropertyValue), <br> <font color="#0000ff">new</font> <font color="#0000ff">object</font> [] { f, propertyName } <br> ); <br> <font color="#0000ff">return</font> iResult; <br> } <br> <font color="#0000ff">else</font> <br> { <br> Type t = f.GetType(); <br> PropertyInfo pi = t.GetProperty(propertyName); <br> <font color="#0000ff">object</font> gResult = pi.GetValue(f, <font color="#0000ff">null</font> ); <br> <font color="#0000ff">return</font> gResult; <br> } <br> } <br> <font color="#0000ff">delegate</font> <font color="#0000ff">void</font> SetFormPropertyValueHandler(Form f, <font color="#0000ff">string</font> propertyName, <font color="#0000ff">object</font> newValue); <br> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SetFormPropertyValue(Form f, <font color="#0000ff">string</font> propertyName, <font color="#0000ff">object</font> newValue) <br> { <br> <font color="#0000ff">if</font> (f.InvokeRequired) <br> { <br> f.Invoke( <br> <font color="#0000ff">new</font> SetFormPropertyValueHandler(SetFormPropertyValue), <br> <font color="#0000ff">new</font> <font color="#0000ff">object</font> [] { f, propertyName, newValue } <br> ); <br> } <br> <font color="#0000ff">else</font> <br> { <br> Type t = f.GetType(); <br> PropertyInfo pi = t.GetProperty(propertyName); <br> pi.SetValue(f, newValue, <font color="#0000ff">null</font> ); <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  The InvokeRequired property gets a value indicating whether the calling operator should access the invoke method during method calls from the control, because the calling operator is not in the thread in which the control was created [4]. <br>  <b>InvokeMethod</b> - calls the method specified in the parameters with the specified parameters. <br>  <b>SetControlPropertyValue</b> - sets the property of the specified control. <br>  <b>GetControlPropertyValue</b> - gets the value of the specified property of the control. <br>  <b>SetFormPropertyValue</b> - sets the specified form property. <br>  <b>GetFormPropertyValue</b> - gets the value of the form property. <br>  <b>GetControl</b> - gets the specified control. <br>  Using these methods, you can create a testing application. <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">static</font> <font color="#0000ff">void</font> Main( <font color="#0000ff">string</font> [] args) <br> { <br> <font color="#0000ff">string</font> path = <font color="#A31515">@"D:\visual studio 2010\Projects\WindowsFormsApplication1\WindowsFormsApplication1\bin\Debug\aut.exe"</font> ; <br> <font color="#0000ff">string</font> nameForm = <font color="#A31515">"AUT.Form1"</font> ; <br> Form myForm = StartApplication(path, nameForm); <br> <font color="#0000ff">string</font> f1 = <font color="#A31515">"521"</font> ; <br> <font color="#0000ff">string</font> f2 = <font color="#A31515">"367"</font> ; <br> SetControlPropertyValue(myForm, <font color="#A31515">"textBox1"</font> , <font color="#A31515">"Text"</font> , f1); <br> SetControlPropertyValue(myForm, <font color="#A31515">"textBox2"</font> , <font color="#A31515">"Text"</font> , f2); <br> <font color="#0000ff">object</font> ctrl = GetControl(myForm, <font color="#A31515">"button1"</font> ); <br> InvokeMethod(myForm, <font color="#A31515">"button1_Click"</font> , ctrl, <font color="#2B91AF">EventArgs</font> .Empty); <br> <font color="#0000ff">string</font> res = GetControlPropertyValue(myForm, <font color="#A31515">"label1"</font> , <font color="#A31515">"Text"</font> ).ToString(); <br> <font color="#0000ff">string</font> resTest = <font color="#A31515">"FAIL"</font> ; <br> <font color="#0000ff">if</font> (res == <font color="#A31515">"888"</font> ) resTest = <font color="#A31515">"PASS"</font> ; <br> <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} + {1} = {2}. Test {3}"</font> , f1, f2, res, resTest); <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  The required values ‚Äã‚Äãare set in the text fields, then the button1_Click method is called with the required parameters.  After that, the value of the Text property of the label1 control is obtained and it is compared with the required one, after which information about the test is displayed on the screen. <br>  Only a special case of using the reflection mechanism is given, the tester can complement the test suite. <br><h4>  Testing based on calling unmanaged code. </h4><br>  For testing, a number of functions from the user32.dll library are used. <br>  To import functions, use the DllImport attribute. <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">[DllImport( <font color="#A31515">"user32.dll"</font> , EntryPoint = <font color="#A31515">"FindWindow"</font> , CharSet = CharSet.Auto)] <br> <font color="#0000ff">static</font> <font color="#0000ff">extern</font> <font color="#2B91AF">IntPtr</font> FindWindow( <font color="#0000ff">string</font> lpClassName, <font color="#0000ff">string</font> lpWindowName); <br> <br> [DllImport( <font color="#A31515">"user32.dll"</font> , EntryPoint = <font color="#A31515">"FindWindowEx"</font> , CharSet = CharSet.Auto)] <br> <font color="#0000ff">static</font> <font color="#0000ff">extern</font> <font color="#2B91AF">IntPtr</font> FindWindowEx( <font color="#2B91AF">IntPtr</font> hwndParent, <font color="#2B91AF">IntPtr</font> hwndChildAfter, <font color="#0000ff">string</font> lpszClass, <font color="#0000ff">string</font> lpszWindow); <br> <br> [DllImport( <font color="#A31515">"user32.dll"</font> , EntryPoint = <font color="#A31515">"SendMessage"</font> , CharSet = CharSet.Auto)] <br> <font color="#0000ff">static</font> <font color="#0000ff">extern</font> <font color="#0000ff">void</font> SendMessage1( <font color="#2B91AF">IntPtr</font> hWnd, <font color="#0000ff">uint</font> Msg, <font color="#0000ff">int</font> wParam, <font color="#0000ff">int</font> lParam); <br> <br> [DllImport( <font color="#A31515">"user32.dll"</font> , EntryPoint = <font color="#A31515">"PostMessage"</font> , CharSet = CharSet.Auto)] <br> <font color="#0000ff">static</font> <font color="#0000ff">extern</font> <font color="#0000ff">bool</font> PostMessage1( <font color="#2B91AF">IntPtr</font> hWnd, <font color="#0000ff">uint</font> Msg, <font color="#0000ff">int</font> wParam, <font color="#0000ff">int</font> lParam); <br> <br> [DllImport( <font color="#A31515">"user32.dll"</font> , EntryPoint = <font color="#A31515">"SendMessage"</font> , CharSet = CharSet.Auto)] <br> <font color="#0000ff">static</font> <font color="#0000ff">extern</font> <font color="#0000ff">int</font> SendMessage3( <font color="#2B91AF">IntPtr</font> hWndControl, <font color="#0000ff">uint</font> Msg, <font color="#0000ff">int</font> wParam, <font color="#0000ff">byte</font> [] lParam); <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  These functions will allow you to find the main form handler, find the required controls, enter text, click the buttons and get the value of the control. <br>  For reuse, we define a series of methods. <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">static</font> <font color="#0000ff">void</font> ClickKey( <font color="#2B91AF">IntPtr</font> hControl, VKeys key) <br> { <br> PostMessage1(hControl, ( <font color="#0000ff">int</font> )WMessages.WM_KEYDOWN, ( <font color="#0000ff">int</font> )key, 0); <br> PostMessage1(hControl, ( <font color="#0000ff">int</font> )WMessages.WM_KEYUP, ( <font color="#0000ff">int</font> )key, 0); <br> } <br> <font color="#0000ff">static</font> <font color="#0000ff">void</font> ClickOn( <font color="#2B91AF">IntPtr</font> hControl) <br> { <br> PostMessage1(hControl, ( <font color="#0000ff">int</font> )WMessages.WM_LBUTTONDOWN, 0, 0); <font color="#008000">// button down</font> <br> PostMessage1(hControl, ( <font color="#0000ff">int</font> )WMessages.WM_LBUTTONUP, 0, 0); <font color="#008000">// button up</font> <br> } <br> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SendChar( <font color="#2B91AF">IntPtr</font> hControl, <font color="#0000ff">char</font> c) <br> { <br> <font color="#0000ff">uint</font> WM_CHAR = 0x0102; <br> SendMessage1(hControl, WM_CHAR, c, 0); <br> } <br> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SendChars( <font color="#2B91AF">IntPtr</font> hControl, <font color="#0000ff">string</font> s) <br> { <br> <font color="#0000ff">foreach</font> ( <font color="#0000ff">char</font> c <font color="#0000ff">in</font> s) <br> { <br> SendChar(hControl, c); <br> } <br> } <br> <font color="#0000ff">static</font> <font color="#2B91AF">IntPtr</font> FindWindowByIndex( <font color="#2B91AF">IntPtr</font> hwndParent, <font color="#0000ff">int</font> index) <br> { <br> <font color="#0000ff">if</font> (index == 0) <br> <font color="#0000ff">return</font> hwndParent; <br> <font color="#0000ff">else</font> <br> { <br> <font color="#0000ff">int</font> ct = 0; <br> <font color="#2B91AF">IntPtr</font> result = <font color="#2B91AF">IntPtr</font> .Zero; <br> <font color="#0000ff">do</font> <br> { <br> result = FindWindowEx(hwndParent, result, <font color="#0000ff">null</font> , <font color="#0000ff">null</font> ); <br> <font color="#0000ff">if</font> (result != <font color="#2B91AF">IntPtr</font> .Zero) <br> ++ct; <br> } <font color="#0000ff">while</font> (ct &lt; index &amp;&amp; result != <font color="#2B91AF">IntPtr</font> .Zero); <br> <font color="#0000ff">return</font> result; <br> } <br> } <br> <font color="#0000ff">static</font> <font color="#2B91AF">List</font> &lt; <font color="#2B91AF">IntPtr</font> &gt; GetAllControls( <font color="#2B91AF">IntPtr</font> hwndParent) <br> { <br> <font color="#2B91AF">IntPtr</font> ctrl = <font color="#2B91AF">IntPtr</font> .Zero; <br> <font color="#2B91AF">List</font> &lt; <font color="#2B91AF">IntPtr</font> &gt; res = <font color="#0000ff">new</font> <font color="#2B91AF">List</font> &lt; <font color="#2B91AF">IntPtr</font> &gt;(); <br> ctrl = FindWindowEx(hwndParent, ctrl, <font color="#0000ff">null</font> , <font color="#0000ff">null</font> ); <br> <font color="#0000ff">while</font> (ctrl != <font color="#2B91AF">IntPtr</font> .Zero) <br> { <br> res.Add(ctrl); <br> ctrl = FindWindowEx(hwndParent, ctrl, <font color="#0000ff">null</font> , <font color="#0000ff">null</font> ); <br> } <br> <font color="#0000ff">return</font> res; <br> } <br> <font color="#0000ff">static</font> <font color="#2B91AF">IntPtr</font> FindMainWindowHandle( <font color="#0000ff">string</font> caption) <br> { <br> <font color="#2B91AF">IntPtr</font> mwh = <font color="#2B91AF">IntPtr</font> .Zero; <br> <font color="#0000ff">bool</font> formFound = <font color="#0000ff">false</font> ; <br> <font color="#0000ff">int</font> attempts = 0; <br> <font color="#0000ff">do</font> <br> { <br> mwh = FindWindow( <font color="#0000ff">null</font> , caption); <br> <font color="#0000ff">if</font> (mwh == <font color="#2B91AF">IntPtr</font> .Zero) <br> { <br> Thread.Sleep(100); <br> ++attempts; <br> } <br> <font color="#0000ff">else</font> <br> { <br> formFound = <font color="#0000ff">true</font> ; <br> } <br> } <font color="#0000ff">while</font> (!formFound &amp;&amp; attempts &lt; 25); <br> <font color="#0000ff">if</font> (mwh != <font color="#2B91AF">IntPtr</font> .Zero) <br> <font color="#0000ff">return</font> mwh; <br> <font color="#0000ff">else</font> <br> <font color="#0000ff">throw</font> <font color="#0000ff">new</font> Exception( <font color="#A31515">"Could not find Main Window"</font> ); <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  The main task is to determine the order of controls.  You can get a pointer to a control if its name / title / caption property is known.  If this property is unknown, or it is not unique, you must use the FindWindowByIndex method.  The zero control is the window itself.  Next, the controls follow in the order of addition: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">this</font> .Controls.Add( <font color="#0000ff">this</font> .label1); <br> <font color="#0000ff">this</font> .Controls.Add( <font color="#0000ff">this</font> .button1); <br> <font color="#0000ff">this</font> .Controls.Add( <font color="#0000ff">this</font> .textBox2); <br> <font color="#0000ff">this</font> .Controls.Add( <font color="#0000ff">this</font> .textBox1); <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  But since it is assumed that the source code is unknown, it is necessary to use the SPY ++ utility.  It shows the order of controls. <br><br> <a title="Habraffe.ru" href=""><img src="https://habrastorage.org/storage/habraeffect/ff/37/ff37fd4b91e170632874ff2274598400.png"></a> <br><br>  The first number is the Label, the second button, the third and fourth text fields. <br>  Based on this information, code is generated to test the application. <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">static</font> <font color="#0000ff">void</font> Main( <font color="#0000ff">string</font> [] args) <br> { <br> <font color="#0000ff">string</font> path = <font color="#A31515">@"D:\visual studio 2010\Projects\WindowsFormsApplication1\WindowsFormsApplication1\bin\Debug\aut.exe"</font> ; <br> <font color="#0000ff">string</font> nameForm = <font color="#A31515">"AUT"</font> ; <br> Process p = Process.Start(path); <br> <font color="#008000">// </font> <br> <font color="#2B91AF">IntPtr</font> mwh = FindMainWindowHandle(nameForm); <br> <font color="#008000">//    </font> <br> <font color="#2B91AF">IntPtr</font> tb1 = FindWindowByIndex(mwh, 3); <br> <font color="#2B91AF">IntPtr</font> tb2 = FindWindowByIndex(mwh, 4); <br> <font color="#008000">//   </font> <br> <font color="#0000ff">string</font> f1 = <font color="#A31515">"521"</font> ; <br> SendChars(tb1, f1); <br> <font color="#0000ff">string</font> f2 = <font color="#A31515">"367"</font> ; <br> SendChars(tb2, f2); <br> <font color="#008000">// </font> <br> <font color="#2B91AF">IntPtr</font> btn = FindWindowByIndex(mwh, 2); <br> ClickOn(btn); <br> <font color="#008000">//       </font> <br> Thread.Sleep(150); <br> <font color="#2B91AF">IntPtr</font> lbl = FindWindowByIndex(mwh, 1); <br> <font color="#0000ff">uint</font> WM_GETTEXT = 0x000D; <br> <font color="#0000ff">byte</font> [] buffer = <font color="#0000ff">new</font> <font color="#0000ff">byte</font> [256]; <br> <font color="#0000ff">string</font> res = <font color="#0000ff">null</font> ; <br> <font color="#0000ff">int</font> numFetched = SendMessage3(lbl, WM_GETTEXT, 256, buffer); <br> res = System.Text. <font color="#2B91AF">Encoding</font> .Unicode.GetString(buffer); <br> <font color="#008000">//  Label</font> <br> <font color="#0000ff">string</font> resTest = <font color="#A31515">"FAIL"</font> ; <br> <font color="#0000ff">if</font> (res == <font color="#A31515">"888"</font> ) resTest = <font color="#A31515">"PASS"</font> ; <br> <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"{0} + {1} = {2}. Test {3}"</font> , f1, f2, res, resTest); <br> Thread.Sleep(3000); <br> p.CloseMainWindow(); <br> p.Close(); <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><h4>  Conclusion </h4><br>  The development of a complete tool for automated testing was not the purpose of this article.  This article only showed the mechanisms of the .Net platform that are used for automated testing.  Outside of this article are questions related to storing test suites and saving results.  The questions of choosing the purpose of testing, data, problems of the oracle were not considered. <br><h4>  List of sources </h4><br>  1. <a href="http://swebok.sorlik.ru/4_software_testing.html">swebok.sorlik.ru/4_software_testing.html</a> IEEE Guide to Software Engineering Body of Knowledge, SWEBOK, 2004. Basics of Software Engineering.  Translation Sergey Orlik. <br>  2. Sam Kaner, Jack Folk, Eng Kek Nguyen.  Software testing.  Fundamental concepts of business application management.  DiaSoft 2001. <br>  3. <a href="http://msdn.microsoft.com/ru-ru/library/ms173183.aspx">msdn.microsoft.com/ru-ru/library/ms173183.aspx</a> - Reflection (C # and Visual Basic). <br>  4. <a href="http://msdn.microsoft.com/ru-ru/library/system.windows.forms.control.invokerequired.aspx">msdn.microsoft.com/en-ru/library/system.windows.forms.control.invokerequired.aspx</a> - .NET Framework Class Library.  Property Control.InvokeRequired. <br>  5. <a href="http://msdn.microsoft.com/ru-ru/library/26thfadc.aspx">msdn.microsoft.com/en-ru/library/26thfadc.aspx</a> - Using unmanaged DLL functions. <br>  6. James D. McCaffrey.  Net test automation recipes: a problem-solution approach.  <a href="http://books.google.ru/books%3Fid%3D3vN9zsMLvxkC">books.google.com/books?id=3vN9zsMLvxkC</a> <br>  7. <a href="http://www.automatedtestinginstitute.com/home/index.php%3Foption%3Dcom_content%26task%3Dview%26id%3D1312%26option%3Dcom_content%26Itemid%3D1000">www.automatedtestingstitute.com/home/index.php?option=com_content&amp;task=view&amp;id=1312&amp;option=com_content&amp;Itemid=1000</a> UI Automation Beneath the Presentation Layer.  Bj rollison.  Link to the magazine with the full version of the article.  <a href="http://www.automatedtestinginstitute.com/home/ASTMagazine/2010/AutomatedSoftwareTestingMagazine_June2010.pdf">www.automatedtestinginstitute.com/home/ASTMagazine/2010/AutomatedSoftwareTestingMagazine_June2010.pdf</a> <br>  8. <a href="http://msdn.microsoft.com/en-us/magazine/cc163864.aspx">msdn.microsoft.com/en-us/magazine/cc163864.aspx</a> Lightweight UI Test Automation with .NET.  James McCaffrey. <br>  9. <a href="http://habrahabr.ru/blogs/net/58582/">habrahabr.ru/blogs/net/58582</a> NET in an unmanaged environment: platform invoke or what LPTSTR is. <br>  10. <a href="http://pinvoke.net/">PInvoke.net</a> <br><br>  <a href="">Project source code</a> </div><p>Source: <a href="https://habr.com/ru/post/100749/">https://habr.com/ru/post/100749/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../100739/index.html">Necessary things</a></li>
<li><a href="../100741/index.html">How to stop thinking about time zones and start living</a></li>
<li><a href="../100742/index.html">Handgam do it yourself</a></li>
<li><a href="../100743/index.html">Henry Kuttner - Classic Humorous Fiction</a></li>
<li><a href="../100744/index.html">Until the thunder clap ...</a></li>
<li><a href="../100750/index.html">We send SMS.ru with convenience</a></li>
<li><a href="../100751/index.html">Help for victims of fires</a></li>
<li><a href="../100754/index.html">Sales: ‚Äúanother feature - and sales will go‚Äù</a></li>
<li><a href="../100756/index.html">Hacker created a $ 1,500 cell phone listening device</a></li>
<li><a href="../100757/index.html">2 Chinese ISPs control 20% of the world's broadband subscribers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>