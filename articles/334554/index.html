<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Characteristics of the PVS-Studio analyzer on the example of EFL Core Libraries, 10-15% of false positives</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After a big article about checking the Tizen operating system, I was asked a lot of questions about the percentage of false positives and the density ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Characteristics of the PVS-Studio analyzer on the example of EFL Core Libraries, 10-15% of false positives</h1><div class="post__text post__text-html js-mediator-article"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a8f/9d0/dec/a8f9d0dec426cff079e84c5d420965d6.png" alt="EFL Core Libraries and PVS-Studio"></div><br>  After a big article about checking the Tizen operating system, I was asked a lot of questions about the percentage of false positives and the density of errors (how many errors does PVS-Studio detect per 1000 code lines).  My reasoning that it strongly depends on the project being analyzed and the settings of the analyzer do not look like the real answer.  I decided to give specific numbers, conducting a more thorough study of one of the projects that make up Tizen.  Since Carsten Haitzler was actively involved in the discussion of the article, I decided that it would be interesting to take for the experiment the EFL Core Libraries, in whose development he participates.  I hope this article will help Carsten become a fan of our analyzer :). <br><a name="habracut"></a><br><br><h2>  Prehistory </h2><br>  If any of my readers missed, then I inform them that I recently wrote <a href="https://www.viva64.com/ru/b/0508/">an open letter to the developers of Tizen</a> , and then the monumental article " <a href="https://www.viva64.com/ru/b/0519/">27000 errors in the operating system Tizen</a> ". <br><br>  After that, on some sites relevant news notes appeared, and several discussions unfolded.  Here are some of them: <ul><li>  Reddit  <a href="https://www.reddit.com/r/Tizen/comments/6bhn09/pvsstudio_team_willing_to_work_on_improving_tizen/">PVS-Studio Team Wizards on Tizen Project (open letter)</a> . </li><li>  Reddit  <a href="https://www.reddit.com/r/programming/comments/6n0kgy/good_news_samsungs_tizen_no_longer_worst_code/">Good news: Samsung's Tizen is no longer worst code ever.</a>  <a href="https://www.reddit.com/r/programming/comments/6n0kgy/good_news_samsungs_tizen_no_longer_worst_code/">Bad news: It's still pretty awful</a> . </li><li>  Ycombinator.  <a href="https://news.ycombinator.com/item%3Fid%3D14752446">27000 errors in the Tizen operating system</a> . </li><li>  The Register.  <a href="https://www.theregister.co.uk/2017/07/12/samsungs_tizen_no_longer_worst_ever/">Good news: Samsung's Tizen is no longer worst code ever.</a>  <a href="https://www.theregister.co.uk/2017/07/12/samsungs_tizen_no_longer_worst_ever/">Bad news: It's still pretty awful</a> </li><li>  The Hacker News.  <a href="http://thehackernews.com/2017/07/samsung-tizen-os-security.html">Samsung's Researcher Claims Tizen OS is Poorly Programmed;</a>  <a href="http://thehackernews.com/2017/07/samsung-tizen-os-security.html">Contains 27,000 Bugs!</a> </li><li>  Lists.tizen.org: <a href="https://lists.tizen.org/pipermail/dev/2017-July/007322.html">1</a> , <a href="https://lists.tizen.org/pipermail/dev/2017-July/007323.html">2</a> , <a href="https://lists.tizen.org/pipermail/dev/2017-July/007324.html">3</a> , <a href="https://lists.tizen.org/pipermail/dev/2017-July/007325.html">4</a> , <a href="https://lists.tizen.org/pipermail/dev/2017-July/007326.html">5</a> , <a href="https://lists.tizen.org/pipermail/dev/2017-July/007327.html">6</a> . </li></ul><br>  I want to express my appreciation to <a href="https://en.wikipedia.org/wiki/Carsten_Haitzler">Carsten Haitzler</a> , who paid attention to my publication and took an active part in its discussion. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Various topics were raised, to some of which I gave detailed comments in the note ‚Äú <a href="https://www.viva64.com/ru/b/0522/">Tizen: Summing Up</a> ‚Äù. <br><br>  However, two eternal questions haunt me: <ul><li>  What is the percentage of false positives? </li><li>  How many errors does PVS-Studio find in 1000 lines of code? </li></ul><br>  Programmers who understand well what a static analysis methodology is would agree with me that such generalized questions do not make sense.  It all depends on the project with which we work.  To ask such questions is the same as asking the doctor to answer the question ‚Äúso what is the average temperature of patients in your hospital?‚Äù <br><br>  Therefore, I will give an answer on the example of a specific project.  I chose EFL Core Libraries.  First, this project is part of Tizen.  And secondly, Carsten Haitzler is involved in its development, and I think it will be interesting for him to look at my results. <br><br>  You could still check Enlightenment, but I didn‚Äôt have the strength for it.  I feel that even without this article will be very long. <br><br>  <a href="https://en.wikipedia.org/wiki/Enlightenment_Foundation_Libraries">The Enlightenment Foundation Libraries</a> (EFL) is a collection of graphics libraries that emerged from the development of Enlightenment, the window manager and the Wayland protocol. <br><br>  When checking EFL Core Libraries, we used the latest code taken from the <a href="https://git.enlightenment.org/">https://git.enlightenment.org/</a> repository. <br><br>  I will also note that the project under investigation is tested using the static Coverity analyzer.  Here is a <a href="https://www.reddit.com/r/Tizen/comments/6bhn09/pvsstudio_team_willing_to_work_on_improving_tizen/dhobweh/">comment</a> on this topic: <br><br>  <i>I will say that we take checking seriously.</i>  <i>If you‚Äôre looking at what to look for at this time, it‚Äôs not a problem. finding issues is easy enough i the codebase is large).</i>  <i>They are mostly not so big impacting things.</i>  <i>We‚Äôve been fixing the bug.</i> <br><br>  Well, let's see how the PVS-Studio analyzer demonstrates itself. <br><br><h2>  Specifications </h2><br>  After its configuration, the PVS-Studio analyzer will <b>generate</b> about <b>10-15% of false positives</b> when checking the EFL Core Libraries project. <br><br>  The density of currently detected errors in EFL Core Libraries is more than <b>0.71 errors per 1000 lines of code</b> . <br><br><h2>  How the calculations were carried out </h2><br>  The EFL Core Libraries project at the time of analysis contains about 1,616,000 lines of code in C and C ++.  Of these, 17.7% are comments.  Thus, the number of lines of code without comments is 1,330,000. <br><br>  After the first launch, I saw the following number of general-purpose messages (GA): <ul><li>  High confidence level: 605 </li><li>  Average confidence level: 3924 </li><li>  Low confidence: 1186 </li></ul><br>  This is, of course, a bad result.  That is why I do not like to write abstract measurement results.  I need to set up the analyzer, and this time I decided to devote time to it. <br><br>  Almost the entire project is written in C and, as a result, macros are widely used in it.  It is macros that cause the majority of false positives.  I spent about 40 minutes on a quick review of the report and compiled the <a href="http://cppfiles.com/EFL/efl_settings.txt">efl_settings.txt</a> file. <br><br>  The file contains the necessary settings.  To use them when checking a project, you need to specify in the analyzer's configuration file (for example, in PVS-Studio.cfg): <br><pre><code class="cpp hljs">rules-config=/path/to/efl_settings.txt</code> </pre> <br>  The analyzer can be run like this: <br><pre> <code class="cpp hljs">pvs-studio-analyzer analyze ... --cfg /path/to/PVS-Studio.cfg ...</code> </pre> <br>  or so <br><pre> <code class="cpp hljs">pvs-studio ... --cfg /patn/to/PVS-Studio.cfg ...</code> </pre> <br>  depending on the integration method used. <br><br>  Using the settings, I told the analyzer not to give some warnings for those lines of code that contain the names of certain macros or expressions.  I also completely disabled several diagnostics.  For example, I turned off the <a href="https://www.viva64.com/ru/w/V505/">V505</a> .  Using the <i>alloca</i> function in cycles is not good, but this is not an obvious error.  I do not want to discuss a lot about whether this or that warning is a false positive, and I thought it would be easier to turn off something. <br><br>  Yes, it should be noted that I was viewing and setting up warnings for only the first two levels.  In the future, I will consider only them.  Low confidence level warnings are not recommended.  At least starting to use the analyzer, it is unreasonable to work with these warnings.  Only having understood with the first two levels, it is possible to glance on the third and choose types of warnings useful in your opinion. <br><br>  The restart resulted in the following results: <ul><li>  High confidence level: 189 </li><li>  Average confidence level: 1186 </li><li>  Low confidence: 1186 </li></ul><br>  The number 1186 is repeated twice. This is not a typo.  Indeed the numbers coincided so casually. <br><br>  So, having spent 40 minutes on setup, I significantly reduced the number of false positives.  Of course, I have a lot of experience, this process would take more time for a third-party developer, but there is nothing terrible and difficult to set up. <br><br>  In total, I received 189 + 1186 = 1375 messages (High + Medium), with which I began to work. <br><br>  After analyzing these messages, I believe that the analyzer detected 950 code fragments containing errors.  In other words, I found 950 code snippets to fix.  I will tell you more about these errors in the next chapter. <br><br>  Let us now calculate the density of detected errors: <br><br>  950 * 1000/1330000 = about 0.71 errors per 1000 lines of code. <br><br>  Now let's calculate the percentage of false positives: <br><br>  ((1375-950) / 1375) * 100% = 30% <br><br>  Stop, stop, stop!  But after all, at the beginning of the article it was said about 10-15% of false positives.  And here 30%. <br><br>  I'll explain now.  So, looking through the report from 1375 messages, I came to the conclusion that 950 indicate errors.  There are 425 messages left. <br><br>  Not all of these remaining 425 messages are false positives.  There are a lot of messages here, about which I just can‚Äôt say whether an error was detected with their help or not. <br><br>  Consider an example of one of the messages I missed. <br><pre> <code class="cpp hljs">.... <span class="hljs-keyword"><span class="hljs-keyword">uint64_t</span></span> callback_mask; .... <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> _check_event_catcher_add(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span> *data, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Efl_Event *event) { .... Evas_Callback_Type type = EVAS_CALLBACK_LAST; .... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((type = _legacy_evas_callback_type(<span class="hljs-built_in"><span class="hljs-built_in">array</span></span>[i].desc)) != EVAS_CALLBACK_LAST) { obj-&gt;callback_mask |= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; type); } .... }</code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V629/">warning</a> : <a href="http://www.viva64.com/ru/w/V629/">V629</a> Consider inspecting the '1 &lt;&lt; type' expression.  Bit shifting of the 32-bit type.  evas_callbacks.c 709 <br><br>  Consider the line more closely: <br><pre> <code class="cpp hljs">obj-&gt;callback_mask |= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; type);</code> </pre> <br>  It is used to write 1 to the desired bit of the <i>callback_mask</i> variable.  Please note that the <i>callback_mask</i> variable is 64-bit. <br><br>  The expression <i>(1 &lt;&lt; type)</i> is of type <i>int</i> , so with its help you can change bits only in the lower part of the variable <i>callback_mask</i> .  Bits [32-63] cannot be changed. <br><br>  To understand whether there is an error here or not, you need to figure out what range of values ‚Äã‚Äãthe <i>_legacy_evas_callback_type</i> function can return.  Can she return a value greater than 31?  I do not know and miss this message. <br><br>  Please understand me.  I see this code for the first time and have no idea what it does.  In addition, <b>hundreds</b> more <b>analyzer messages</b> are waiting for me.  I just can not begin to carefully deal with each such case. <br><br>  <b><i>Comment by Carsten Haitzler.</i></b>  <i>If you‚Äôre really a little bit of a bug, you‚Äôll have to do it. do this to retain compatibility, but what happens with any refactoring ... stuff happens).</i>  <i>This is a series of events.</i>  <i>It‚Äôs not just ‚Äútype A‚Äù ... but it doesn‚Äôt have a complete check. / mapping</i>  <i>It was actually pretty harmless.</i> <br><br>  Among the remaining 425 messages there are indicative of errors.  I just missed them. <br><br>  If it comes to using PVS-Studio regularly, you can continue to configure it.  As I said, I already spent only 40 minutes on the setup.  But this does not mean that I did everything I could.  You can also reduce the number of false positives by disabling diagnostics for certain software designs. <br><br>  After a more careful study of the remaining messages and additional settings, just 10-15% of false positives will remain.  Good result. <br><br><h2>  Bugs found </h2><br>  Now consider the errors I found.  I cannot describe all 950, therefore I will limit myself to the analysis of a pair of warnings of each type.  The rest of the warnings I give a list or a separate file. <br><br>  Also, the reader himself can get acquainted with all the warnings by opening the report file: <a href="">zip-archive with the report</a> .  Note that I only left General warnings of high and medium confidence in the file. <br><br>  I was viewing this report in Windows, opening it with the help of the PVS-Studio Standalone utility. <br><br>  In Linux, you can use the Plog Converter utility, which will convert the report to one of the following formats: <ul><li>  <b>xml</b> is a convenient format for additional processing of the analysis results, supported by the plugin for SonarQube; </li><li>  <b>csv</b> is a text format intended for the presentation of tabular data; </li><li>  <b>errorfile</b> - gcc and clang output format; </li><li>  <b>tasklist</b> is an error format that can be opened in QtCreator. </li></ul><br>  Then you can use QtCreator, Vim / gVim, GNU Emacs, LibreOffice Calc to view reports.  This is described in detail in the documentation section " <a href="https://www.viva64.com/ru/m/0036/">How to run PVS-Studio in Linux</a> " (see "Viewing and filtering the analyzer report"). <br><br><h3>  V501 (1 error) </h3><br>  Diagnostics <a href="http://www.viva64.com/ru/w/V501/">V501</a> revealed only one error, but beautiful.  The error is in the comparison function, which echoes the topic of the recent article " <a href="https://www.viva64.com/ru/b/0509/">Evil lives in comparison functions</a> ". <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _ephysics_body_evas_stacking_sort_cb(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> *d1, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> *d2) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> EPhysics_Body_Evas_Stacking *stacking1, *stacking2; stacking1 = (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> EPhysics_Body_Evas_Stacking *)d1; stacking2 = (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> EPhysics_Body_Evas_Stacking *)d2; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!stacking1) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!stacking2) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (stacking1-&gt;stacking &lt; stacking2-&gt;stacking) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (stacking2-&gt;stacking &gt; stacking2-&gt;stacking) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br>  PVS-Studio warning: V501 There are identical sub-expressions "stacking2-&gt; stacking".  ephysics_body.cpp 450 <br><br>  A typo.  The last comparison should be: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (stacking1-&gt;stacking &gt; stacking2-&gt;stacking) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br><br><h3>  V512 (8 errors) </h3><br>  First, take a look at the definition of the <i>Eina_Array</i> structure. <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Eina_Array</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Eina_Array</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Eina_Array</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> version; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> **data; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> total; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> count; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> step; Eina_Magic __magic; };</code> </pre> <br>  Carefully consider it is not necessary.  Just a structure with some kind of fields. <br><br>  Now let's look at the definition of the <i>Eina_Accessor_Array</i> structure: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Eina_Accessor_Array</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Eina_Accessor_Array</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Eina_Accessor_Array</span></span></span><span class="hljs-class"> {</span></span> Eina_Accessor accessor; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Eina_Array *<span class="hljs-built_in"><span class="hljs-built_in">array</span></span>; Eina_Magic __magic; };</code> </pre> <br>  Note that the <i>Eina_Accessor_Array</i> structure stores a pointer to the <i>Eina_Array</i> structure.  Otherwise, these structures are in no way interconnected and have a different size. <br><br>  Now the code that detected the analyzer and which I do not understand: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Eina_Accessor * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eina_array_accessor_clone</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Eina_Array *</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">array</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ Eina_Accessor_Array *ac; EINA_SAFETY_ON_NULL_RETURN_VAL(<span class="hljs-built_in"><span class="hljs-built_in">array</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>); EINA_MAGIC_CHECK_ARRAY(<span class="hljs-built_in"><span class="hljs-built_in">array</span></span>); ac = <span class="hljs-built_in"><span class="hljs-built_in">calloc</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span> (Eina_Accessor_Array)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!ac) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">memcpy</span></span>(ac, <span class="hljs-built_in"><span class="hljs-built_in">array</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(Eina_Accessor_Array)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> &amp;ac-&gt;accessor; }</code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V512/">warning</a> : <a href="http://www.viva64.com/ru/w/V512/">V512</a> A call of the 'memcpy' function will get to the array.  eina_array.c 186 <br><br>  Let me remove all the extra details to make it easier: <br><pre> <code class="cpp hljs">.... eina_array_accessor_clone(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Eina_Array *<span class="hljs-built_in"><span class="hljs-built_in">array</span></span>) { Eina_Accessor_Array *ac = <span class="hljs-built_in"><span class="hljs-built_in">calloc</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span> (Eina_Accessor_Array)); <span class="hljs-built_in"><span class="hljs-built_in">memcpy</span></span>(ac, <span class="hljs-built_in"><span class="hljs-built_in">array</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(Eina_Accessor_Array)); }</code> </pre> <br>  Memory is allocated for an object of type <i>Eina_Accessor_Array</i> .  A strange thing happens next. <br><br>  An object of type <i>Eina_Array is</i> copied to the allocated memory buffer. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/429/385/5b5/4293855b52f8b8ca1c6f33847ca1cfc0.png" alt="Shta"></div><br><br>  I do not know what the considered function should do, but it is doing something wrong. <br><br>  First, when copying occurs, the source goes beyond the boundary ( <i>Eina_Array</i> structures). <br><br>  Secondly, in general, such a copy does not make sense.  Structures have a set of fields of completely different types. <br><br>  <b><i>Comment by Carsten Haitzler.</i></b>  <i>Function content correct - Type in param is wrong.</i>  <i>It is not a funeral of the. .</i> <br><br>  Consider the following error. <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Eina_Bool _convert_etc2_rgb8_to_argb8888(....) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> *in = src; <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> *out = dst; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> out_step, x, y, k; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> bgra[<span class="hljs-number"><span class="hljs-number">16</span></span>]; .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (k = <span class="hljs-number"><span class="hljs-number">0</span></span>; k &lt; <span class="hljs-number"><span class="hljs-number">4</span></span>; k++) <span class="hljs-built_in"><span class="hljs-built_in">memcpy</span></span>(out + x + k * out_step, bgra + k * <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>); .... }</code> </pre> <br>  PVS-Studio warning: V512 A call of the 'memcpy' function will bgra + k * 16 '.  draw_convert.c 318 <br><br>  Everything is simple here.  Ordinary overflow buffer. <br><br>  The <i>bgra</i> array consists of 16 <i>unsigned int</i> elements. <br><br>  The variable <i>k</i> takes values ‚Äã‚Äãin a loop from 0 to 3. <br><br>  Pay attention to the expression: <i>bgra + k * 16</i> . <br><br>  When the variable <i>k</i> takes a value greater than 0, a pointer will be calculated that points out of the array. <br><br>  However, some V512 messages point to code that does not contain a real error.  However, I do not consider such analyzer triggers to be false.  The code is bad and, in my opinion, should be changed.  Consider this case. <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MATRIX_XX(m) (m)-&gt;xx typedef struct _Eina_Matrix4 Eina_Matrix4; struct _Eina_Matrix4 { double xx; double xy; double xz; double xw; double yx; double yy; double yz; double yw; double zx; double zy; double zz; double zw; double wx; double wy; double wz; double ww; }; EAPI void eina_matrix4_array_set(Eina_Matrix4 *m, const double *v) { memcpy(&amp;MATRIX_XX(m), v, sizeof(double) * 16); }</span></span></code> </pre> <br>  PVS-Studio warning: V512 A call of the 'memcpy' function will lead to the overflow of the buffer '&amp; (m) -&gt; xx'.  eina_matrix.c 1003 <br><br>  You could just copy the array into the structure.  But instead, the address of the first member <i>xx</i> is taken.  Probably, it is assumed that in the future at the beginning of the structure other fields will appear.  And so that the behavior of the program does not break, this technique is used. <br><br>  <b><i>Comment by Carsten Haitzler.</i></b>  <i>Memcpy's not a bug: taking advantage of the guaranteed layout of structs.</i> <br><br>  I do not like him.  I recommend writing something like this: <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Eina_Matrix4</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">union</span></span> { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> xx; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> xy; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> xz; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> xw; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> yx; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> yy; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> yz; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> yw; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> zx; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> zy; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> zz; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> zw; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> wx; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> wy; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> wz; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> ww; }; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> RawArray[<span class="hljs-number"><span class="hljs-number">16</span></span>]; }; }; <span class="hljs-function"><span class="hljs-function">EAPI </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eina_matrix4_array_set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Eina_Matrix4 *m, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *v)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">memcpy</span></span>(m-&gt;RawArray, v, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>) * <span class="hljs-number"><span class="hljs-number">16</span></span>); }</code> </pre> <br>  It is a little longer, but more ideologically true.  However, if you do not want to edit the code, you can suppress the warning in one of the following ways. <br><br>  The first way.  Add a comment to the code: <br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">memcpy</span></span>(&amp;MATRIX_XX(m), v, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>) * <span class="hljs-number"><span class="hljs-number">16</span></span>); <span class="hljs-comment"><span class="hljs-comment">//-V512</span></span></code> </pre> <br>  The second way.  Add a line to the configuration file: <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//-V:MATRIX_:512</span></span></code> </pre> <br>  The third way.  <a href="https://www.viva64.com/ru/m/0032/">Use markup base</a> . <br><br>  Other errors: <ul><li>  V512 A call of the memcpy function will lead to overflow of the buffer '&amp; (m) -&gt; xx'.  eina_matrix.c 1098 </li><li>  V512 A call of the memcpy function will lead to overflow of the buffer '&amp; (m) -&gt; xx'.  eina_matrix.c 1265 </li><li>  V512 A call to the 'memcpy' function will lead to the '&amp; pd-&gt; projection.xx' buffer becoming out of range.  evas_canvas3d_camera.c 120 </li><li>  V512 A call to the 'memcpy' function will lead to the '&amp; pd-&gt; projection.xx' buffer becoming out of range.  evas_canvas3d_light.c 270 </li><li>  V512 A call of the memcpy function will lead to overflow of the buffer. Bgra + k * 16 '.  draw_convert.c 350 </li></ul><br><br><h3>  V517 (3 errors) </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Eina_Bool </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evas_image_load_file_head_bmp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *loader_data, Evas_Image_Property *prop, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *error)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (header.comp == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-comment"><span class="hljs-comment">// no compression { // handled } else if (header.comp == 3) // bit field { // handled } else if (header.comp == 4) // jpeg - only printer drivers goto close_file; else if (header.comp == 3) // png - only printer drivers goto close_file; else goto close_file; .... }</span></span></code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V517/">warning</a> : <a href="http://www.viva64.com/ru/w/V517/">V517</a> The use of if (A) {...} else if (A) {...} 'pattern was detected.  There is a possibility of logical error presence.  Check lines: 433, 439. evas_image_load_bmp.c 433 <br><br>  Two times the variable <i>header.comp is</i> compared to a constant of <i>3</i> . <br><br>  Other errors: <ul><li>  V517 The use of if (A) {...} else if (A) {...} 'pattern was detected.  There is a possibility of logical error presence.  Check lines: 1248, 1408. evas_image_load_bmp.c 1248 </li><li>  V517 The use of if (A) {...} else if (A) {...} 'pattern was detected.  There is a possibility of logical error presence.  Check lines: 426, 432. parser.c 426 </li></ul><br><br><h3>  V519 (1 error) </h3><br><pre> <code class="cpp hljs">EOLIAN <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Efl_Object * _efl_net_ssl_context_efl_object_finalize(....) { Efl_Net_Ssl_Ctx_Config cfg; .... cfg.load_defaults = pd-&gt;load_defaults; <span class="hljs-comment"><span class="hljs-comment">// &lt;= cfg.certificates = &amp;pd-&gt;certificates; cfg.private_keys = &amp;pd-&gt;private_keys; cfg.certificate_revocation_lists = &amp;pd-&gt;certificate_revocation_lists; cfg.certificate_authorities = &amp;pd-&gt;certificate_authorities; cfg.load_defaults = pd-&gt;load_defaults; // &lt;= .... }</span></span></code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V519/">warning</a> : <a href="http://www.viva64.com/ru/w/V519/">V519</a> The 'cfg.load_defaults' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 304, 309. efl_net_ssl_context.c 309 <br><br>  Reassignment is repeated.  One assignment is superfluous or you forgot to copy something else. <br><br>  <b><i>Comment by Carsten Haitzler.</i></b>  <i>Not a bug.</i>  <i>Just an overzealous copy &amp; paste of the line.</i> <br><br>  Another simple case: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">EAPI Eina_Bool </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">edje_edit_size_class_add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Evas_Object *obj, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *name)</span></span></span><span class="hljs-function"> </span></span>{ Eina_List *l; Edje_Size_Class *sc, *s; .... <span class="hljs-comment"><span class="hljs-comment">/* set default values for max */</span></span> s-&gt;maxh = <span class="hljs-number"><span class="hljs-number">-1</span></span>; s-&gt;maxh = <span class="hljs-number"><span class="hljs-number">-1</span></span>; .... }</code> </pre> <br>  PVS-Studio warning: V519 The 's-&gt; maxh' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 8132, 8133. edje_edit.c 8133 <br><br>  Of course, not all cases are so obvious.  However, I believe that the warnings listed below most likely indicate errors: <ul><li>  V519 The 'pdata-&gt; seat-&gt; object.in' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 1519, 1521. evas_events.c 1521 </li><li>  V519 The 'pdata-&gt; seat-&gt; object.in' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 2597, 2599. evas_events.c 2599 </li><li>  V519 The 'b-&gt; buffer [r]' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 348, 353. evas_image_load_pmaps.c 353 </li><li>  V519 The 'attr_amount' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 13891, 13959. edje_edit.c 13959 </li><li>  V519 The 'async_loader_running' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 152, 165. evas_gl_preload.c 165 </li><li>  V519 The 'textlen' variable is assigned twice twice successively.  Perhaps this is a mistake.  Check lines: 86, 87. elm_code_widget_undo.c 87 </li><li>  V519 The 'content' variable is assigned twice successively.  Perhaps this is a mistake.  Check lines: 313, 315. elm_dayselector.c 315 </li><li>  V519 The 'wd-&gt; resize_obj' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 3099, 3105. elm_entry.c 3105 </li><li>  V519 The 'wd-&gt; resize_obj' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 3125, 3131. elm_entry.c 3131 </li><li>  V519 The 'idata-&gt; values' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 128, 129. elm_view_list.c 129 </li><li>  V519 The 'wd-&gt; resize_obj' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 2602, 2608. efl_ui_text.c 2608 </li><li>  V519 The 'wd-&gt; resize_obj' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 2628, 2634. efl_ui_text.c 2634 </li><li>  V519 The 'finfo' variable is assigned twice twice successively.  Perhaps this is a mistake.  Check lines: 706, 743. evas_image_load_gif.c 743 </li><li>  V519 The 'current_program_lookups' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 15819, 15820. edje_cc_handlers.c 15820 </li></ul><br>  <b><i>Note.</i></b>  <i>Carsten Haitzler, commenting on the article, wrote that the V519 warnings listed in the list are false positives.</i>  <i>I do not agree with this approach.</i>  <i>Perhaps the code works correctly, but still it deserves attention and editing.</i>  <i>I decided to leave the list in the article so that the readers themselves could evaluate whether, from their point of view, repetitions in the assignment of variables are false positives or not.</i>  <i>But since Carsten says that these are not errors, I will not take them into account when calculating.</i> <br><br><h3>  V522 (563 errors) </h3><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/551/4e3/0fe/5514e30fef2f9b502378744735ccf67f.png"></div><br><br>  In the EFL project there is a problem with the presence of checks: memory has been allocated or not.  In general, there are such checks in the project.  Example: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(el = <span class="hljs-built_in"><span class="hljs-built_in">malloc</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(Evas_Stringshare_El) + slen + <span class="hljs-number"><span class="hljs-number">1</span></span>))) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>;</code> </pre> <br>  Moreover, they are even where they are not needed (see below for warning <a href="http://www.viva64.com/ru/w/V668/">V668</a> ). <br><br>  But in a huge number of places there is no verification.  Consider for example a couple of analyzer messages. <br><br>  <b><i>Comment by Carsten Haitzler.</i></b>  <i>It‚Äôs not always a good idea.</i>  <i>Linux overcommits memory by default.</i>  <i>This is not what you have been assigned.</i>  <i>Only virtual space.</i>  <i>Not until you touch it.</i>  <i>It seems like a valid pointer.</i>  <i>It is low.</i>  <i>Sometimes we do it ... sometimes not.</i>  <i>It can be used for a small number of people.</i>  <i>It can be tune.</i>  <i>Secondly, it is a list of chunk of memory - eg a linked list node ... realistically if NULL is returned ... you can do.</i>  <i>If you can not allocate 20-40 bytes ... you can‚Äôt allocate 20‚Äì40 bytes ...</i>  <i>But there are few megabytes of memory etc.</i>  <i>which has been our target.</i>  <i>I can see why PVS-Studio doesn't like this.</i>  <i>It wasn‚Äôt been a reality that it wasn‚Äôt spent on it.</i>  <i>I'll get more into that later.</i> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Eina_Debug_Session * _session_create(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> fd) { Eina_Debug_Session *session = <span class="hljs-built_in"><span class="hljs-built_in">calloc</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(*session)); session-&gt;dispatch_cb = eina_debug_dispatch; session-&gt;fd = fd; <span class="hljs-comment"><span class="hljs-comment">// start the monitor thread _thread_start(session); return session; }</span></span></code> </pre> <br>  <b><i>Comment by Carsten Haitzler.</i></b>  <i>2 months ago and it‚Äôs still being built out.</i>  <i>If you‚Äôre running, you‚Äôll be able to control it. What is the timeline of the logs? it‚Äôs so that it‚Äôs triggered the wakeup, it‚Äôs so you can‚Äôt get it. above on memory and aborts etc.</i> <br><br>  <b><i>Comment by Andrei Karpov.</i></b>  <i>Not very clear, and here is a new and untested code.</i>  <i>Static analyzers are designed primarily to look for errors in the new code.</i> <br><br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V522/">warning</a> : <a href="http://www.viva64.com/ru/w/V522/">V522</a> There might be dereferencing of a potential null pointer 'session'.  eina_debug.c 440 <br><br>  Allocated memory using the <i>calloc</i> function and immediately using it. <br><br>  Another example: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Reference * _entry_reference_add(Entry *entry, Client *client, <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> client_entry_id) { Reference *ref; <span class="hljs-comment"><span class="hljs-comment">// increase reference for this file ref = malloc(sizeof(*ref)); ref-&gt;client = client; ref-&gt;entry = entry; ref-&gt;client_entry_id = client_entry_id; ref-&gt;count = 1; entry-&gt;references = eina_list_append(entry-&gt;references, ref); return ref; }</span></span></code> </pre> <br>  PVS-Studio warning: V522 There might be dereferencing of a potential null pointer 'ref'.  evas_cserve2_cache.c 1404 <br><br>  And so it is 563 times.  In the article, I can not bring them.  I give a link to the file: <a href="http://cppfiles.com/EFL/EFL_V522.txt">EFL_V522.txt</a> . <br><br><h3>  V547 (39 errors) </h3><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> _ecore_con_url_dialer_error(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span> *data, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Efl_Event *event) { Ecore_Con_Url *url_con = data; Eina_Error *perr = event-&gt;info; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> status; status = efl_net_dialer_http_response_status_get(url_con-&gt;dialer); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((status &lt; <span class="hljs-number"><span class="hljs-number">500</span></span>) &amp;&amp; (status &gt; <span class="hljs-number"><span class="hljs-number">599</span></span>)) { DBG(<span class="hljs-string"><span class="hljs-string">"HTTP error %d reset to 1"</span></span>, status); status = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* not a real HTTP error */</span></span> } WRN(<span class="hljs-string"><span class="hljs-string">"HTTP dialer error url='%s': %s"</span></span>, efl_net_dialer_address_dial_get(url_con-&gt;dialer), eina_error_msg_get(*perr)); _ecore_con_event_url_complete_add(url_con, status); }</code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V547/">warning</a> : <a href="http://www.viva64.com/ru/w/V547/">V547</a> Expression '(status &lt;500) &amp;&amp; (status&gt; 599)' is always false.  ecore_con_url.c 351 <br><br>  The correct verification option should be: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((status &lt; <span class="hljs-number"><span class="hljs-number">500</span></span>) || (status &gt; <span class="hljs-number"><span class="hljs-number">599</span></span>))</code> </pre> <br>  The code fragment with this error was copied to 2 more places: <ul><li>  V547 Expression '(status &lt;500) &amp;&amp; (status&gt; 599)' is always false.  ecore_con_url.c 658 </li><li>  V547 Expression '(status &lt;500) &amp;&amp; (status&gt; 599)' is always false.  ecore_con_url.c 1340 </li></ul><br>  The following error situation: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">EAPI </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eina_rectangle_pool_release</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Eina_Rectangle *rect)</span></span></span><span class="hljs-function"> </span></span>{ Eina_Rectangle *match; Eina_Rectangle_Alloc *<span class="hljs-keyword"><span class="hljs-keyword">new</span></span>; .... match = (Eina_Rectangle *) (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (match) era-&gt;pool-&gt;empty = _eina_rectangle_skyline_list_update( era-&gt;pool-&gt;empty, match); .... }</code> </pre> <br>  PVS-Studio warning: V547 Expression 'match' is always true.  eina_rectangle.c 798 <br><br>  Once a unit has been added to the pointer, it makes no sense to check it for <i>NULL</i> equality. <br><br>  The <i>match</i> pointer can become zero only if an overflow occurs during the addition.  However, pointer overflow is considered undefined behavior, so this option should not be considered. <br><br>  And one more case. <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">EAPI </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evas_object_smart_interface_get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Evas_Object *eo_obj, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *name)</span></span></span><span class="hljs-function"> </span></span>{ Evas_Smart *s; .... s = evas_object_smart_smart_get(eo_obj); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!s) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (s) .... }</code> </pre> <br>  PVS-Studio warning: V547 Expression 's' is always true.  evas_object_smart.c 160 <br><br>  If the pointer is <i>NULL</i> , then the function exits.  Rechecking does not make sense. <br><br>  Other errors: <a href="http://cppfiles.com/EFL/EFL_V547.txt">EFL_V547.txt</a> . <br><br>  There are warnings V547, which I missed and did not write out, since I was not interested in understanding them.  Among them may be a few more errors. <br><br><h3>  V556 (8 errors) </h3><br>  All 8 errors were issued for one code fragment.  To start, look at the announcement of the two listings. <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> _Elm_Image_Orient_Type { ELM_IMAGE_ORIENT_NONE = <span class="hljs-number"><span class="hljs-number">0</span></span>, ELM_IMAGE_ORIENT_0 = <span class="hljs-number"><span class="hljs-number">0</span></span>, ELM_IMAGE_ROTATE_90 = <span class="hljs-number"><span class="hljs-number">1</span></span>, ELM_IMAGE_ORIENT_90 = <span class="hljs-number"><span class="hljs-number">1</span></span>, ELM_IMAGE_ROTATE_180 = <span class="hljs-number"><span class="hljs-number">2</span></span>, ELM_IMAGE_ORIENT_180 = <span class="hljs-number"><span class="hljs-number">2</span></span>, ELM_IMAGE_ROTATE_270 = <span class="hljs-number"><span class="hljs-number">3</span></span>, ELM_IMAGE_ORIENT_270 = <span class="hljs-number"><span class="hljs-number">3</span></span>, ELM_IMAGE_FLIP_HORIZONTAL = <span class="hljs-number"><span class="hljs-number">4</span></span>, ELM_IMAGE_FLIP_VERTICAL = <span class="hljs-number"><span class="hljs-number">5</span></span>, ELM_IMAGE_FLIP_TRANSPOSE = <span class="hljs-number"><span class="hljs-number">6</span></span>, ELM_IMAGE_FLIP_TRANSVERSE = <span class="hljs-number"><span class="hljs-number">7</span></span> } Elm_Image_Orient; <span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> { EVAS_IMAGE_ORIENT_NONE = <span class="hljs-number"><span class="hljs-number">0</span></span>, EVAS_IMAGE_ORIENT_0 = <span class="hljs-number"><span class="hljs-number">0</span></span>, EVAS_IMAGE_ORIENT_90 = <span class="hljs-number"><span class="hljs-number">1</span></span>, EVAS_IMAGE_ORIENT_180 = <span class="hljs-number"><span class="hljs-number">2</span></span>, EVAS_IMAGE_ORIENT_270 = <span class="hljs-number"><span class="hljs-number">3</span></span>, EVAS_IMAGE_FLIP_HORIZONTAL = <span class="hljs-number"><span class="hljs-number">4</span></span>, EVAS_IMAGE_FLIP_VERTICAL = <span class="hljs-number"><span class="hljs-number">5</span></span>, EVAS_IMAGE_FLIP_TRANSPOSE = <span class="hljs-number"><span class="hljs-number">6</span></span>, EVAS_IMAGE_FLIP_TRANSVERSE = <span class="hljs-number"><span class="hljs-number">7</span></span> } Evas_Image_Orient;</code> </pre> <br>   ,      .    . <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">EAPI </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">elm_image_orient_set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Evas_Object *obj, Elm_Image_Orient orient)</span></span></span><span class="hljs-function"> </span></span>{ Efl_Orient dir; Efl_Flip flip; EFL_UI_IMAGE_DATA_GET(obj, sd); sd-&gt;image_orient = orient; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (orient) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> EVAS_IMAGE_ORIENT_0: .... <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> EVAS_IMAGE_ORIENT_90: .... <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> EVAS_IMAGE_FLIP_HORIZONTAL: .... <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> EVAS_IMAGE_FLIP_VERTICAL: .... }</code> </pre> <br>  PVS-Studio: <ul><li> V556 The values of different enum types are compared: switch(ENUM_TYPE_A) { case ENUM_TYPE_B:‚Ä¶ }. efl_ui_image.c 2141 </li><li> V556 The values of different enum types are compared: switch(ENUM_TYPE_A) { case ENUM_TYPE_B:‚Ä¶ }. efl_ui_image.c 2145 </li><li> V556 The values of different enum types are compared: switch(ENUM_TYPE_A) { case ENUM_TYPE_B:‚Ä¶ }. efl_ui_image.c 2149 </li><li> V556 The values of different enum types are compared: switch(ENUM_TYPE_A) { case ENUM_TYPE_B:‚Ä¶ }. efl_ui_image.c 2153 </li><li> V556 The values of different enum types are compared: switch(ENUM_TYPE_A) { case ENUM_TYPE_B:‚Ä¶ }. efl_ui_image.c 2157 </li><li> V556 The values of different enum types are compared: switch(ENUM_TYPE_A) { case ENUM_TYPE_B:‚Ä¶ }. efl_ui_image.c 2161 </li><li> V556 The values of different enum types are compared: switch(ENUM_TYPE_A) { case ENUM_TYPE_B:‚Ä¶ }. efl_ui_image.c 2165 </li><li> V556 The values of different enum types are compared: switch(ENUM_TYPE_A) { case ENUM_TYPE_B:‚Ä¶ }. efl_ui_image.c 2169 </li></ul><br>    ,    . <br><br>  ,  ,   .  : <ul><li> ELM_IMAGE_ORIENT_NONE = 0; EVAS_IMAGE_ORIENT_NONE = 0, </li><li> ELM_IMAGE_ORIENT_0 = 0; EVAS_IMAGE_ORIENT_0 = 0 </li><li> ELM_IMAGE_ROTATE_90 = 1; EVAS_IMAGE_ORIENT_90 = 1 </li><li>  and so on. </li></ul><br>    ,     . <br><br> <b><i>Comment by Carsten Haitzler.</i></b> <i>All of the above orient/rotate enum stuff is intentional. We had to cleanup duplication of enums and we ensured they had the same values so they were interchangeable ‚Äî we moved from rotate to orient and kept the compatibility. It's part of our move over to the new object system and a lot of code auto-generation etc. that is still underway and beta. It's not an error but intended to do this as part of transitioning, so it's a false positive.</i> <br><br> <b><i>  .</i></b> <i>        ,   false positives.    ,    ,   -   ,   .</i> <br><br><h3> V558 (4 ) </h3><br><pre> <code class="cpp hljs">accessor_iterator&lt;T&gt;&amp; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>++(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) { accessor_iterator&lt;T&gt; tmp(*<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); ++*<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tmp; }</code> </pre> <br>  PVS-Studio: <a href="http://www.viva64.com/ru/w/V558/">V558</a> Function returns the reference to temporary local object: tmp. eina_accessor.hh 519 <br><br>   ,   <i>&amp;</i>   : <br><pre> <code class="cpp hljs">accessor_iterator&lt;T&gt; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>++(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)</code> </pre> <br>  : <ul><li> V558 Function returns the reference to temporary local object: tmp. eina_accessor.hh 535 </li><li> V558 Function returns the reference to temporary local object: tmp. eina_accessor.hh 678 </li><li> V558 Function returns the reference to temporary local object: tmp. eina_accessor.hh 694 </li></ul><br><br><h3> V560 (32 ) </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsigned</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_compressed_channel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">signed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> headbyte; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (headbyte &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (headbyte &gt;= <span class="hljs-number"><span class="hljs-number">-127</span></span> &amp;&amp; headbyte &lt;= <span class="hljs-number"><span class="hljs-number">-1</span></span>) <span class="hljs-comment"><span class="hljs-comment">// &lt;= .... }</span></span></code> </pre> <br>  PVS-Studio: <a href="http://www.viva64.com/ru/w/V560/">V560</a> A part of conditional expression is always true: headbyte &lt;= ‚Äî 1. evas_image_load_psd.c 221 <br><br>   <i>headbyte</i>  &gt;= 0,      <i>&lt;= -1</i> . <br><br>   . <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Eeze_Disk_Type _eeze_disk_type_find(Eeze_Disk *disk) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *test; .... test = udev_device_get_property_value(disk-&gt;device, <span class="hljs-string"><span class="hljs-string">"ID_BUS"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (test) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(test, <span class="hljs-string"><span class="hljs-string">"ata"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> EEZE_DISK_TYPE_INTERNAL; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(test, <span class="hljs-string"><span class="hljs-string">"usb"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> EEZE_DISK_TYPE_USB; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> EEZE_DISK_TYPE_UNKNOWN; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((!test) &amp;&amp; (!filesystem)) <span class="hljs-comment"><span class="hljs-comment">// &lt;= .... }</span></span></code> </pre> <br>  PVS-Studio: V560 A part of conditional expression is always true: (!test). eeze_disk.c 55 <br><br>   .   <i>test</i>  ,       . <br><br>  : <a href="http://cppfiles.com/EFL/EFL_V560.txt">EFL_V560.txt</a> . <br><br><h3> V568 (3 ) </h3><br><pre> <code class="cpp hljs">EOLIAN <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Eina_Error _efl_net_server_tcp_efl_net_server_fd_socket_activate(....) { .... <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sockaddr_storage</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">addr</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">socklen_t</span></span> addrlen; .... addrlen = <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(addr); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (getsockname(fd, (struct sockaddr *)&amp;addr, &amp;addrlen) != <span class="hljs-number"><span class="hljs-number">0</span></span>) .... }</code> </pre> <br>  PVS-Studio: <a href="http://www.viva64.com/ru/w/V568/">V568</a> It's odd that 'sizeof()' operator evaluates the size of a pointer to a class, but not the size of the 'addr' class object. efl_net_server_tcp.c 192 <br><br>     ,      ,   .     : <br><pre> <code class="cpp hljs">addrlen = <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(*addr);</code> </pre> <br>  : <ul><li> V568 It's odd that 'sizeof()' operator evaluates the size of a pointer to a class, but not the size of the 'addr' class object. efl_net_server_udp.c 228 </li><li> V568 It's odd that 'sizeof()' operator evaluates the size of a pointer to a class, but not the size of the 'addr' class object. efl_net_server_unix.c 198 </li></ul><br><br><h3> V571 (6 ) </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">EAPI </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eeze_disk_scan</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Eeze_Disk *disk)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!disk-&gt;cache.vendor) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!disk-&gt;cache.vendor) disk-&gt;cache.vendor = udev_device_get_sysattr_value(....); .... }</code> </pre> <br>  PVS-Studio: <a href="http://www.viva64.com/ru/w/V571/">V571</a> Recurring check. The 'if (!disk-&gt;cache.vendor)' condition was already verified in line 298. eeze_disk.c 299 <br><br>    . <br><br>  : <ul><li> V571 Recurring check. The 'if (!disk-&gt;cache.model)' condition was already verified in line 302. eeze_disk.c 303 </li><li> V571 Recurring check. The 'if (priv-&gt;last_buffer)' condition was already verified in line 150. emotion_sink.c 152 </li><li> V571 Recurring check. The 'if (pd-&gt;editable)' condition was already verified in line 892. elm_code_widget.c 894 </li><li> V571 Recurring check. The 'if (mnh &gt;= 0)' condition was already verified in line 279. els_box.c 281 </li><li> V571 Recurring check. The 'if (mnw &gt;= 0)' condition was already verified in line 285. els_box.c 287 </li></ul><br>  <b><i>Note.</i></b> <i>Carsten Haitzler    .       .   ,        .    ,  .    ,    .</i> <br><br><h3> V575 (126 ) </h3><br>  ,      .      . <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">free_buf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Eina_Evlog_Buf *b)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!b-&gt;buf) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; b-&gt;size = <span class="hljs-number"><span class="hljs-number">0</span></span>; b-&gt;top = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-meta"><span class="hljs-meta"># </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> HAVE_MMAP munmap(b-&gt;buf, b-&gt;size); # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> free(b-&gt;buf); # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> b-&gt;buf = NULL; }</span></span></code> </pre> <br>  PVS-Studio: <a href="http://www.viva64.com/ru/w/V575/">V575</a> The 'munmap' function processes '0' elements. Inspect the second argument. eina_evlog.c 117 <br><br>    <i>b-&gt;size</i>  0,       <i>munmap</i> . <br><br>  ,    : <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">free_buf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Eina_Evlog_Buf *b)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!b-&gt;buf) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; b-&gt;top = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-meta"><span class="hljs-meta"># </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> HAVE_MMAP munmap(b-&gt;buf, b-&gt;size); # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> free(b-&gt;buf); # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> b-&gt;buf = NULL; b-&gt;size = 0; }</span></span></code> </pre> <br>  We continue. <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">EAPI Eina_Bool </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eina_simple_xml_parse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((itr + <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-string"><span class="hljs-string">"&lt;!&gt;"</span></span>) - <span class="hljs-number"><span class="hljs-number">1</span></span> &lt; itr_end) &amp;&amp; (!<span class="hljs-built_in"><span class="hljs-built_in">memcmp</span></span>(itr + <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-string"><span class="hljs-string">""</span></span>) - <span class="hljs-number"><span class="hljs-number">1</span></span>))) .... }</code> </pre> <br>  PVS-Studio: V575 The 'memcmp' function processes '0' elements. Inspect the third argument. eina_simple_xml_parser.c 355 <br><br> ,   0  . <br><br>  We continue. <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> _edje_key_down_cb(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *compres = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, *<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> = (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *)ev-&gt;<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (compres) { <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> = compres; free_string = EINA_TRUE; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-built_in"><span class="hljs-built_in">free</span></span>(compres); .... }</code> </pre> <br>  PVS-Studio: V575 The null pointer is passed into 'free' function. Inspect the first argument. edje_entry.c 2306 <br><br>   <i>compress</i> ,      .  <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-built_in"><span class="hljs-built_in">free</span></span>(compres);</code> </pre> <br>  . <br><br> <b><i>Comment by Carsten Haitzler.</i></b> <i>Not a bug but indeed some extra if paranoia like code that isn't needed. Micro optimizations again?</i> <br><br> <b><i>  .</i></b> <i>    .     ,   .  ,         ,      .    ,   ,       .</i> <br><br>  Similarly: <ul><li> V575 The null pointer is passed into 'free' function. Inspect the first argument. efl_ui_internal_text_interactive.c 1022 </li><li> V575 The null pointer is passed into 'free' function. Inspect the first argument. edje_cc_handlers.c 15962 </li></ul><br>      V575      .  -    ,   ,    V522. <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> _fill_all_outs(<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> **outs, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *val) { <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> vlen = <span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>(val); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; (<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(_dexts) / <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *)); ++i) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (outs[i]) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> dlen = <span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>(_dexts[i]); <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *str = <span class="hljs-built_in"><span class="hljs-built_in">malloc</span></span>(vlen + dlen + <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">memcpy</span></span>(str, val, vlen); <span class="hljs-built_in"><span class="hljs-built_in">memcpy</span></span>(str + vlen, _dexts[i], dlen); str[vlen + dlen] = <span class="hljs-string"><span class="hljs-string">'\0'</span></span>; outs[i] = str; } }</code> </pre> <br>  PVS-Studio: V575 The potential null pointer is passed into 'memcpy' function. Inspect the first argument. main.c 112 <br><br>  ,  ,    . <br><br>  : <a href="http://cppfiles.com/EFL/EFL_V575.txt">EFL_V575.txt</a> . <br><br><h3> V587 (2 ) </h3><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> _ecore_x_event_handle_focus_in(XEvent *xevent) { .... e-&gt;time = _ecore_x_event_last_time; _ecore_x_event_last_time = e-&gt;time; .... }</code> </pre> <br>  PVS-Studio: <a href="http://www.viva64.com/ru/w/V587/">V587</a> An odd sequence of assignments of this kind: A = B; B = A;. Check lines: 1006, 1007. ecore_x_events.c 1007 <br><br> <b><i>Comment by Carsten Haitzler.</i></b> <i>Not bugs as such ‚Äî looks like just overzealous storing of last timestamp. This is adding a timestamp to an event when no original timestamp exists so we can keep a consistent structure for events with timestamps, but it is code clutter and a micro optimization.</i> <br><br> <b><i>  .</i></b> <i>,         .   , Carsten ,   .                .</i> <br><br>   : V587 An odd sequence of assignments of this kind: A = B; B = A;. Check lines: 1050, 1051. ecore_x_events.c 1051 <br><br><h3> V590 (3 ) </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">command</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (*lptr == <span class="hljs-string"><span class="hljs-string">' '</span></span> &amp;&amp; *lptr != <span class="hljs-string"><span class="hljs-string">'\0'</span></span>) lptr++; <span class="hljs-comment"><span class="hljs-comment">/* skip whitespace */</span></span> .... }</code> </pre> <br>  PVS-Studio: <a href="http://www.viva64.com/ru/w/V590/">V590</a> Consider inspecting the '* lptr == ' ' &amp;&amp; * lptr != '\0'' expression. The expression is excessive or contains a misprint. embryo_cc_sc2.c 944 <br><br>  .   : <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (*lptr == <span class="hljs-string"><span class="hljs-string">' '</span></span>)</code> </pre> <br>    : <ul><li> V590 Consider inspecting the 'sym-&gt;ident == 9 || sym-&gt;ident != 10' expression. The expression is excessive or contains a misprint. embryo_cc_sc3.c 1782 </li><li> V590 Consider inspecting the '* p == '\n' || * p != '\"'' expression. The expression is excessive or contains a misprint. cpplib.c 4012 </li></ul><br><br><h3> V591 (1 ) </h3><br><pre> <code class="cpp hljs">_self_type&amp; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>=(_self_type <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>&amp; other) { _base_type::<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>=(other); }</code> </pre> <br>  PVS-Studio: <a href="http://www.viva64.com/ru/w/V591/">V591</a> Non-void function should return a value. eina_accessor.hh 330 <br><br><h3> V595 (4 ) </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eng_image_size_get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *engine EINA_UNUSED, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *image, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *w, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *h)</span></span></span><span class="hljs-function"> </span></span>{ Evas_GL_Image *im; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!image) { *w = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">// &lt;= *h = 0; // &lt;= return; } im = image; if (im-&gt;orient == EVAS_IMAGE_ORIENT_90 || im-&gt;orient == EVAS_IMAGE_ORIENT_270 || im-&gt;orient == EVAS_IMAGE_FLIP_TRANSPOSE || im-&gt;orient == EVAS_IMAGE_FLIP_TRANSVERSE) { if (w) *w = im-&gt;h; if (h) *h = im-&gt;w; } else { if (w) *w = im-&gt;w; if (h) *h = im-&gt;h; } }</span></span></code> </pre> <br>  PVS-Studio: <ul><li> V595 The 'w' pointer was utilized before it was verified against nullptr. Check lines: 575, 585. evas_engine.c 575 </li><li> V595 The 'h' pointer was utilized before it was verified against nullptr. Check lines: 576, 586. evas_engine.c 576 </li></ul><br>  <i>if (w)</i>  <i>if (h)</i>  ,    <i>w</i>  <i>h</i>    <i>NULL</i> . ,        . <br><br>    <i>eng_image_size_get</i>  : <br><pre> <code class="cpp hljs">eng_image_size_get(<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>);</code> </pre> <br>            . <br><br> , ,   ,    : <ul><li> V595 The 'cur-&gt;node' pointer was utilized before it was verified against nullptr. Check lines: 9889, 9894. evas_object_textblock.c 9889 </li><li> V595 The 'subtype' pointer was utilized before it was verified against nullptr. Check lines: 2200, 2203. eet_data.c 2200 </li></ul><br><br><h3> V597 (6 ) </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">EAPI Eina_Binbuf * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">emile_binbuf_decipher</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Emile_Cipher_Algorithm algo, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Eina_Binbuf *data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *key, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> length)</span></span></span><span class="hljs-function"> </span></span>{ .... Eina_Binbuf *result = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> *over; EVP_CIPHER_CTX *ctx = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> ik[MAX_KEY_LEN]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> iv[MAX_IV_LEN]; .... on_error: <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(iv, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span> (iv)); <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(ik, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span> (ik)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ctx) EVP_CIPHER_CTX_free(ctx); eina_binbuf_free(result); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; }</code> </pre> <br>  PVS-Studio: <ul><li> V597 The compiler could delete the 'memset' function call, which is used to flush 'iv' buffer. The memset_s() function should be used to erase the private data. emile_cipher_openssl.c 293 </li><li> V597 The compiler could delete the 'memset' function call, which is used to flush 'ik' buffer. The memset_s() function should be used to erase the private data. emile_cipher_openssl.c 294 </li></ul><br>       ,          <i>memset</i> .   .  -      ,      <a href="https://www.viva64.com/ru/w/V597/">V597</a> . <br><br> <b><i>Comment by Carsten Haitzler.</i></b> <i>Above 2 ‚Äî totally familiar with the issue. The big problem is memset_s is not portable or easily available, thus why we don't use it yet. You have to do special checks for it to see if it exists as it does not exist everywhere. Just as a simple example add AC_CHECK_FUNCS([memset_s]) to your configure.ac and memset_s is not found you have to jump through some more hoops like define __STDC_WANT_LIB_EXT1__ 1 before including system headers‚Ä¶ and it's still not declared. On my pretty up to date Arch system memset_s is not defined by any system headers, same on debian testing‚Ä¶ warning: implicit declaration of function 'memset_s'; did you mean memset'? [-Wimplicit-function-declaration], and then compile failure‚Ä¶ no matter what I do. A grep -r of all my system includes shows no memset_s declared‚Ä¶ so I think advising people to use memset_s is only a viable advice if its widely available and usable. Be aware of this.</i> <br><br>  : <ul><li> V597 The compiler could delete the 'memset' function call, which is used to flush 'key_material' buffer. The memset_s() function should be used to erase the private data. emile_cipher_openssl.c 144 </li><li> V597 The compiler could delete the 'memset' function call, which is used to flush 'iv' buffer. The memset_s() function should be used to erase the private data. emile_cipher_openssl.c 193 </li><li> V597 The compiler could delete the 'memset' function call, which is used to flush 'ik' buffer. The memset_s() function should be used to erase the private data. emile_cipher_openssl.c 194 </li><li> V597 The compiler could delete the 'memset' function call, which is used to flush 'key_material' buffer. The memset_s() function should be used to erase the private data. emile_cipher_openssl.c 249 </li></ul><br><br><h3> V609 (1 ) </h3><br>     <i>eina_value_util_type_size</i> . <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> size_t </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eina_value_util_type_size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Eina_Value_Type *type)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (type == EINA_VALUE_TYPE_INT) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (type == EINA_VALUE_TYPE_UCHAR) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((type == EINA_VALUE_TYPE_STRING) || (type == EINA_VALUE_TYPE_STRINGSHARE)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>*); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (type == EINA_VALUE_TYPE_TIMESTAMP) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">time_t</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (type == EINA_VALUE_TYPE_ARRAY) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(Eina_Value_Array); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (type == EINA_VALUE_TYPE_DOUBLE) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (type == EINA_VALUE_TYPE_STRUCT) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(Eina_Value_Struct); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br>  ,     0.  ,    : <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsigned</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eina_value_util_type_offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Eina_Value_Type *type, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> base)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> size, padding; size = eina_value_util_type_size(type); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(base % size)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> base; padding = ( (base &gt; size) ? (base - size) : (size - base)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> base + padding; }</code> </pre> <br>  PVS-Studio: <a href="http://www.viva64.com/ru/w/V609/">V609</a> Mod by zero. Denominator range [0..24]. eina_inline_value_util.x 60 <br><br>    .        ,   <i>eina_value_util_type_size</i>   0.      . <br><br> <b><i>Comment by Carsten Haitzler.</i></b> <i>The 0 return would only happen if you have provided totally invalid input, like again strdup(NULL)‚Ä¶ So I call this a false positive as you cant have an eina_value generic value that is not valid without bad stuff happening ‚Äî validate you passes a proper value in first. eina_value is performance sensitive btw so every check here costs something. it's like adding if() checks to the add opcode.</i> <br><br><h3> V610 (1 ) </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetch_linear_gradient</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (t + inc*length &lt; (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)(INT_MAX &gt;&gt; (FIXPT_BITS + <span class="hljs-number"><span class="hljs-number">1</span></span>)) &amp;&amp; t+inc*length &gt; (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)(INT_MIN &gt;&gt; (FIXPT_BITS + <span class="hljs-number"><span class="hljs-number">1</span></span>))) .... }</code> </pre> <br>  PVS-Studio: <a href="http://www.viva64.com/ru/w/V610/">V610</a> Unspecified behavior. Check the shift operator '&gt;&gt;'. The left operand '(- 0x7fffffff ‚Äî 1)' is negative. ector_software_gradient.c 412 <br><br><h3> V614 (1 ) </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> struct tm *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gmtime</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">time_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *__timer)</span></span></span><span class="hljs-function"> __</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">attribute__</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((__nothrow__ , __leaf__))</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> _set_headers(Evas_Object *obj) { <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> part[] = <span class="hljs-string"><span class="hljs-string">"ch_0.text"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">tm</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">t</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">time_t</span></span> temp; ELM_CALENDAR_DATA_GET(obj, sd); elm_layout_freeze(obj); sd-&gt;filling = EINA_TRUE; t = gmtime(&amp;temp); <span class="hljs-comment"><span class="hljs-comment">// &lt;= .... }</span></span></code> </pre> <br>  PVS-Studio: <a href="http://www.viva64.com/ru/w/V614/">V614</a> Uninitialized variable 'temp' used. Consider checking the first actual argument of the 'gmtime' function. elm_calendar.c 720 <br><br><h3> V621 (1 ) </h3><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> _opcodes_unregister_all(Eina_Debug_Session *session) { Eina_List *l; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; _opcode_reply_info *info = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!session) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; session-&gt;cbs_length = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; session-&gt;cbs_length; i++) eina_list_free(session-&gt;cbs[i]); .... }</code> </pre> <br>  PVS-Studio: <a href="http://www.viva64.com/ru/w/V621/">V621</a> Consider inspecting the 'for' operator. It's possible that the loop will be executed incorrectly or won't be executed at all. eina_debug.c 405 <br><br><h3> V630 (2 ) </h3><br>    <i>btVector3</i>  . ,     . <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">btVector3</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: .... btScalar m_floats[<span class="hljs-number"><span class="hljs-number">4</span></span>]; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btVector3</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } .... };</code> </pre> <br>      <i>Simulation_Msg</i> : <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Simulation_Msg</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Simulation_Msg</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Simulation_Msg</span></span></span><span class="hljs-class"> {</span></span> EPhysics_Body *body_0; EPhysics_Body *body_1; btVector3 pos_a; btVector3 pos_b; Eina_Bool tick:<span class="hljs-number"><span class="hljs-number">1</span></span>; };</code> </pre> <br>  ,       <i>btVector3</i> .  ,   : <br><pre> <code class="cpp hljs">_ephysics_world_tick_dispatch(EPhysics_World *world) { Simulation_Msg *msg; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!world-&gt;ticked) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; world-&gt;ticked = EINA_FALSE; world-&gt;pending_ticks++; msg = (Simulation_Msg *) <span class="hljs-built_in"><span class="hljs-built_in">calloc</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(Simulation_Msg)); msg-&gt;tick = EINA_TRUE; ecore_thread_feedback(world-&gt;cur_th, msg); }</code> </pre> <br>  PVS-Studio: <a href="http://www.viva64.com/ru/w/V630/">V630</a> The 'calloc' function is used to allocate memory for an array of objects which are classes containing constructors. ephysics_world.cpp 299 <br><br> ,    non-POD ,      <i>calloc</i> . <br><br>      ,      .         . <br><br>   : V630 The 'calloc' function is used to allocate memory for an array of objects which are classes containing constructors. ephysics_world.cpp 471 <br><br> <b><i>Comment by Carsten Haitzler.</i></b> <i>Because the other end of the pipe is C code that is passing around a raw ptr as the result from thread A to thread B, it's a mixed c and c++ environment. In the end we'd be sending raw ptr's around no matter what...</i> <br><br><h3> V654 (2 ) </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evas_mem_free</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mem_required EINA_UNUSED)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evas_mem_degrade</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mem_required EINA_UNUSED)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evas_mem_calloc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> size)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> *ptr; ptr = <span class="hljs-built_in"><span class="hljs-built_in">calloc</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>, size); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ptr) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ptr; MERR_BAD(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((!ptr) &amp;&amp; (evas_mem_free(size))) ptr = <span class="hljs-built_in"><span class="hljs-built_in">calloc</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>, size); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ptr) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ptr; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((!ptr) &amp;&amp; (evas_mem_degrade(size))) ptr = <span class="hljs-built_in"><span class="hljs-built_in">calloc</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>, size); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ptr) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ptr; MERR_FATAL(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; }</code> </pre> <br>  PVS-Studio: <ul><li> V654 The condition '(!ptr) &amp;&amp; (evas_mem_free(size))' of loop is always false. main.c 44 </li><li> V654 The condition '(!ptr) &amp;&amp; (evas_mem_degrade(size))' of loop is always false. main.c 46 </li></ul><br>   -  . <br><br> <b><i>Comment by Carsten Haitzler.</i></b> <i>Old old code because caching was implemented, so it was basically a lot of NOP's waiting to be filled in. since evas speculatively cached data (megabytes of it) the idea was that if allocs fail ‚Äî free up some cache and try again‚Ä¶ if that fails then actually try nuke some non-cached data that could be reloaded/rebuilt but with more cost‚Ä¶ and only fail after that. But because of overcommit this didn't end up practical as allocs would succeed then just fall over often enough if you did hit a really low memory situation, so I gave up. it's not a bug. it's a piece of history :).</i> <br><br>      . <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a31/86c/2e0/a3186c2e0b43279496dc2333f378faf7.png" alt="WTF"></div><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">EAPI </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evas_common_font_query_size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> cluster = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> cur_cluster = <span class="hljs-number"><span class="hljs-number">0</span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { cur_cluster = cluster + <span class="hljs-number"><span class="hljs-number">1</span></span>; glyph--; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cur_w &gt; ret_w) { ret_w = cur_w; } } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((glyph &gt; first_glyph) &amp;&amp; (cur_cluster == cluster)); .... }</code> </pre> <br>  PVS-Studio: <a href="http://www.viva64.com/ru/w/V654/">V654</a> The condition of loop is always false. evas_font_query.c 376 <br><br>      : <br><pre> <code class="cpp hljs">cur_cluster = cluster + <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br>  ,   <i>(cur_cluster == cluster)</i>    <i>false</i> . <br><br> <b><i>Comment by Carsten Haitzler.</i></b> <i>Above‚Ä¶ it seems you built without harfbuzz support‚Ä¶ we highly don't recommend that. it's not tested. Building without basically nukes almost all of the interesting unicode/intl support for text layout. You do have to explicitly ‚Äî disable it‚Ä¶ because with harfbuzz support we have opentype enabled and a different bit of code is executed due to ifdefs‚Ä¶ if you actually check history of the code before adding opentype support it didn't loop over clusters at all or even glyphs‚Ä¶ so really the ifdef just ensures the loop only loops one and avoids more ifdefs later in the loop conditions making the code easier to maintain ‚Äî beware the ifdefs!</i> <br><br><h3> V668 (21 ) </h3><br>    ,     ,           <i>malloc</i> / <i>calloc</i> . <br><br>        <i>new</i>   - . <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b60/65a/0fe/b6065a0feb1078367727b4e1749ed1a3.png"></div><br><br>   : <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> EPhysics_Body * _ephysics_body_rigid_body_add(....) { .... motion_state = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> btDefaultMotionState(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!motion_state) { ERR(<span class="hljs-string"><span class="hljs-string">"Couldn't create a motion state."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> err_motion_state; } .... }</code> </pre> <br>  PVS-Studio: <a href="http://www.viva64.com/ru/w/V668/">V668</a> There is no sense in testing the 'motion_state' pointer against null, as the memory was allocated using the 'new' operator. The exception will be generated in the case of memory allocation error. ephysics_body.cpp 837 <br><br>     ,           <i>std::bad_alloc</i> . <br><br> <b><i>Comment by Carsten Haitzler.</i></b> <i>Fair enough, but be aware some compiler DON'T throw exceptions‚Ä¶ they return NULL on new‚Ä¶ so not totally useless code depending on the compiler. I believe VSC6 didn't throw an exception ‚Äî so before exceptions were a thing this actually was correct behavior, also I depends on the allocator func if it throws and exception or not, so all in all, very minor harmless code.</i> <br><br> <b><i>  .</i></b> <i> . .   .</i> <br><br>     : <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">EAPI EPhysics_Constraint * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ephysics_constraint_linked_add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(EPhysics_Body *body1, EPhysics_Body *body2)</span></span></span><span class="hljs-function"> </span></span>{ .... constraint-&gt;bt_constraint = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> btGeneric6DofConstraint( *ephysics_body_rigid_body_get(body1), *ephysics_body_rigid_body_get(body2), btTransform(), btTransform(), <span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!constraint-&gt;bt_constraint) { ephysics_world_lock_release(constraint-&gt;world); <span class="hljs-built_in"><span class="hljs-built_in">free</span></span>(constraint); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; } .... }</code> </pre> <br>  PVS-Studio: V668 There is no sense in testing the 'constraint-&gt;bt_constraint' pointer against null, as the memory was allocated using the 'new' operator. The exception will be generated in the case of memory allocation error. ephysics_constraints.cpp 382 <br><br>   ,       ,      ,       <i>free</i> . <br><br> <b><i>Comment by Carsten Haitzler.</i></b> <i>Same as previous new + NULL check.</i> <br><br> <b><i>  .</i></b> <i>  ,   Visual C++  6.0. ,             new. ,    ,     .  Tizen       Visual C++ 6.0!     .     ,     .   ,     .    ,   .  ,      memory-leak.   ,  new   ,     new(nothrow).      .  ,      ,  .</i> <br><br>  : <a href="http://cppfiles.com/EFL/EFL_V668.txt">EFL_V668.txt</a> . <br><br><h3> V674 (2 ) </h3><br>   ,    <i>abs</i> : <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">abs</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __x)</span></span></span><span class="hljs-function"> __</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">attribute__</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((__nothrow__ , __leaf__))</span></span></span><span class="hljs-function"> __</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">attribute__</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((__const__))</span></span></span><span class="hljs-function"> </span></span>;</code> </pre> <br>  ,       <i>int</i> . <br><br>  ,    . <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ELM_GESTURE_MINIMUM_MOMENTUM 0.001 typedef int Evas_Coord; struct _Elm_Gesture_Momentum_Info { .... Evas_Coord mx; Evas_Coord my; .... }; static void _momentum_test(....) { .... </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> ((abs(st-&gt;info.mx) &gt; ELM_GESTURE_MINIMUM_MOMENTUM) || (abs(st-&gt;info.my) &gt; ELM_GESTURE_MINIMUM_MOMENTUM)) state_to_report = ELM_GESTURE_STATE_END; .... }</span></span></code> </pre> <br>  PVS-Studio: <ul><li> V674 The '0.001' literal of the 'double' type is compared to a value of the 'int' type. Consider inspecting the 'abs(st-&gt;info.mx) &gt; 0.001' expression. elm_gesture_layer.c 2533 </li><li> V674 The '0.001' literal of the 'double' type is compared to a value of the 'int' type. Consider inspecting the 'abs(st-&gt;info.my) &gt; 0.001' expression. elm_gesture_layer.c 2534 </li></ul><br> ,     <i>int</i>   0.001.  - . <br><br><h3> V686 (3 ) </h3><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Image_Entry * _scaled_image_find(Image_Entry *im, ....) { <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> pathlen, keylen, size; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *hkey; Evas_Image_Load_Opts lo; Image_Entry *ret; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((!im-&gt;file) || ((!im-&gt;file) &amp;&amp; (!im-&gt;key))) || (!im-&gt;data1) || ((src_w == dst_w) &amp;&amp; (src_h == dst_h)) || ((!im-&gt;flags.alpha) &amp;&amp; (!smooth))) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; .... }</code> </pre> <br>  PVS-Studio: <a href="http://www.viva64.com/ru/w/V686/">V686</a> A pattern was detected: (!im-&gt;file) || ((!im-&gt;file) &amp;&amp; ...). The expression is excessive or contains a logical error. evas_cache2.c 825 <br><br>      ,   .  Let me explain with a simple example. <br><br> if (A || (A &amp;&amp; B) || C) <br><br>     : <br><br> if (A || C) <br><br>   ,     -     - .      .       . <br><br>   : <ul><li> V686 A pattern was detected: (!im-&gt;file) || ((!im-&gt;file) &amp;&amp; ...). The expression is excessive or contains a logical error. evas_cache2.c 905 </li><li> V686 A pattern was detected: (nextc == '*') || ((nextc == '*') &amp;&amp; ...). The expression is excessive or contains a logical error. cpplib.c 1022 </li></ul><br><br><h3> V694 (2 ) </h3><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CPP_PREV_BUFFER(BUFFER) ((BUFFER)+1) static void initialize_builtins(cpp_reader * pfile) { .... cpp_buffer *pbuffer = CPP_BUFFER(pfile); while (CPP_PREV_BUFFER(pbuffer)) pbuffer = CPP_PREV_BUFFER(pbuffer); .... }</span></span></code> </pre> <br>  PVS-Studio: <a href="http://www.viva64.com/ru/w/V694/">V694</a> The condition ((pbuffer) + 1) is only false if there is pointer overflow which is undefined behavior anyway. cpplib.c 2496 <br><br>   ,  . <br><pre> <code class="cpp hljs">cpp_buffer *pbuffer = ....; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (pbuffer + <span class="hljs-number"><span class="hljs-number">1</span></span>) ....</code> </pre> <br>    .       ,      .    .   undefined behavior,         .     ,   : <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) pbuffer = CPP_PREV_BUFFER(pbuffer);</code> </pre> <br>    . <br><br>     : V694 The condition ((ip) + 1) is only false if there is pointer overflow which is undefined behavior anyway. cpplib.c 2332 <br><br> <b><i>Comment by Carsten Haitzler.</i></b> <i>This old code indeed has issues. There should be checks against CPP_NULL_BUFFER(pfile) because if its a linked list this is a null heck, if its a static buffer array as a stack, it checks stack end position ‚Äî interestingly in decades it's never been triggered that I know of.</i> <br><br><h3> V701 (69 ) </h3><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> _efl_vg_gradient_efl_gfx_gradient_stop_set( ...., Efl_VG_Gradient_Data *pd, ....) { pd-&gt;colors = <span class="hljs-built_in"><span class="hljs-built_in">realloc</span></span>(pd-&gt;colors, length * <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(Efl_Gfx_Gradient_Stop)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!pd-&gt;colors) { pd-&gt;colors_count = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ; } <span class="hljs-built_in"><span class="hljs-built_in">memcpy</span></span>(pd-&gt;colors, colors, length * <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(Efl_Gfx_Gradient_Stop)); pd-&gt;colors_count = length; _efl_vg_changed(obj); }</code> </pre> <br>  PVS-Studio: <a href="http://www.viva64.com/ru/w/V701/">V701</a> realloc() possible leak: when realloc() fails in allocating memory, original pointer 'pd-&gt;colors' is lost.  Consider assigning realloc () to a temporary pointer. evas_vg_gradient.c 14 <br><br>     : <br><pre> <code class="cpp hljs">pd-&gt;colors = <span class="hljs-built_in"><span class="hljs-built_in">realloc</span></span>(pd-&gt;colors, ....);</code> </pre> <br>    <i>pd-&gt;colors</i>   .     ,    .     ,    <i>pd-&gt;colors</i>    <i>NULL</i> . <br><br>           .       ,    .  ,    ,    .    : <br><pre> <code class="cpp hljs">EOLIAN <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> _evas_canvas_key_lock_add( Eo *eo_e, Evas_Public_Data *e, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *keyname) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!keyname) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e-&gt;locks.lock.count &gt;= <span class="hljs-number"><span class="hljs-number">64</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; evas_key_lock_del(eo_e, keyname); e-&gt;locks.lock.count++; e-&gt;locks.lock.<span class="hljs-built_in"><span class="hljs-built_in">list</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">realloc</span></span>(e-&gt;locks.lock.<span class="hljs-built_in"><span class="hljs-built_in">list</span></span>, e-&gt;locks.lock.count * <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *)); e-&gt;locks.lock.<span class="hljs-built_in"><span class="hljs-built_in">list</span></span>[e-&gt;locks.lock.count - <span class="hljs-number"><span class="hljs-number">1</span></span>] = strdup(keyname); eina_hash_free_buckets(e-&gt;locks.masks); }</code> </pre> <br>  PVS-Studio: V701 realloc() possible leak: when realloc() fails in allocating memory, original pointer 'e-&gt;locks.lock.list' is lost.  Consider assigning realloc () to a temporary pointer. evas_key.c 142 <br><br>  : <a href="http://cppfiles.com/EFL/EFL_701.txt">EFL_701.txt</a> . <br><br><h3> V728 (4 ) </h3><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Eina_Bool _evas_textblock_node_text_adjust_offsets_to_start(....) { Evas_Object_Textblock_Node_Format *last_node, *itr; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!itr || (itr &amp;&amp; (itr-&gt;text_node != n))) .... }</code> </pre> <br>  PVS-Studio: <a href="http://www.viva64.com/ru/w/V728/">V728</a> An excessive check can be simplified.  The '||' operator is surrounded by opposite expressions '!itr' and 'itr'. evas_object_textblock.c 9505 <br><br>  ,    .   : <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!itr || (itr-&gt;text_node != n))</code> </pre> <br>   : <ul><li> V728 An excessive check can be simplified.  The '||' operator is surrounded by opposite expressions '!p' and 'p'. elm_theme.c 447 </li><li> V728 An excessive check can be simplified.  The '||' operator is surrounded by opposite expressions '!ss' and 'ss'. config.c 3932 </li><li> V728 An excessive check can be simplified.  The '||' operator is surrounded by opposite expressions '!icon_version' and 'icon_version'. efreet_icon_cache_create.c 917 </li></ul><br><br><h3> V769 (11 ) </h3><br>     V522,        .      . <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">EAPI Eina_Bool </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">edje_edit_sound_sample_add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( Evas_Object *obj, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *snd_src)</span></span></span><span class="hljs-function"> </span></span>{ .... ed-&gt;file-&gt;sound_dir-&gt;samples = <span class="hljs-built_in"><span class="hljs-built_in">realloc</span></span>(ed-&gt;file-&gt;sound_dir-&gt;samples, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(Edje_Sound_Sample) * ed-&gt;file-&gt;sound_dir-&gt;samples_count); sound_sample = ed-&gt;file-&gt;sound_dir-&gt;samples + ed-&gt;file-&gt;sound_dir-&gt;samples_count - <span class="hljs-number"><span class="hljs-number">1</span></span>; sound_sample-&gt;name = (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *)eina_stringshare_add(name); .... }</code> </pre> <br>  PVS-Studio: <a href="http://www.viva64.com/ru/w/V769/">V769</a> The 'ed-&gt;file-&gt;sound_dir-&gt;samples' pointer in the expression could be nullptr. In such case, resulting value of arithmetic operations on this pointer will be senseless and it should not be used. edje_edit.c 1271 <br><br>    .    ,    .        ,    ,  .      ,     ,     .       . <br><br> ,    ,  .        .   (NULL + N)     ,    -      . <br><br>  : <ul><li> V769 The 'new_txt' pointer in the 'new_txt + outlen' expression could be nullptr. In such case, resulting value will be senseless and it should not be used. eina_str.c 539 </li><li> V769 The 'new_txt' pointer in the 'new_txt + outlen' expression could be nullptr. In such case, resulting value will be senseless and it should not be used. eina_str.c 611 </li><li> V769 The 'tmp' pointer in the 'tmp ++' expression could be nullptr. In such case, resulting value will be senseless and it should not be used. evas_object_textblock.c 11131 </li><li> V769 The 'dst' pointer in the 'dst += sizeof (int)' expression could be nullptr. In such case, resulting value will be senseless and it should not be used. evas_font_compress.c 218 </li><li> V769 The 'content' pointer in the 'content + position' expression could be nullptr. In such case, resulting value will be senseless and it should not be used. elm_code_line.c 78 </li><li> V769 The 'newtext' pointer in the 'newtext + length1' expression could be nullptr. In such case, resulting value will be senseless and it should not be used. elm_code_line.c 102 </li><li> V769 The 'tmp' pointer in the 'tmp + dirlen' expression could be nullptr. In such case, resulting value will be senseless and it should not be used. elm_code_file.c 101 </li><li> V769 The 'ptr' pointer in the 'ptr += strlen(first) + newline_len' expression could be nullptr. In such case, resulting value will be senseless and it should not be used. elm_code_widget_text.c 72 </li><li> V769 The 'content' pointer in the 'content + 319' expression could be nullptr. In such case, resulting value will be senseless and it should not be used. test_store.c 198 </li><li> V769 The 'pos' pointer in the 'pos += sizeof (msg)' expression could be nullptr. In such case, resulting value will be senseless and it should not be used. evas_cserve2_cache.c 2534 </li></ul><br><br><h3> V779 (19 ) </h3><br>   <a href="http://www.viva64.com/ru/w/V779/">V779</a>   ,   ,  .  Example: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">EAPI Eina_Bool </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ecore_x_xinerama_screen_geometry_get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> screen, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *w, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *h)</span></span></span><span class="hljs-function"> </span></span>{ LOGFN(__FILE__, __LINE__, __FUNCTION__); <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> ECORE_XINERAMA </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (_xin_info) { int i; for (i = 0; i &lt; _xin_scr_num; i++) { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (_xin_info[i].screen_number == screen) { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (x) *x = _xin_info[i].x_org; </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (y) *y = _xin_info[i].y_org; </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (w) *w = _xin_info[i].width; </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (h) *h = _xin_info[i].height; return EINA_TRUE; } } } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* ifdef ECORE_XINERAMA */</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (x) *x = 0; </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (y) *y = 0; </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (w) *w = DisplayWidth(_ecore_x_disp, 0); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (h) *h = DisplayHeight(_ecore_x_disp, 0); return EINA_FALSE; screen = 0; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// &lt;= }</span></span></span></span></code> </pre> <br>  PVS-Studio: V779 Unreachable code detected. It is possible that an error is present. ecore_x_xinerama.c 92 <br><br>    ,        <i>screen</i> .  -       ,     ,  ,       . <br><br>           <i>EINA_UNUSED</i> . <br><br>     : <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> _exit (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> __status) __attribute__ ((__noreturn__)); <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> _timeout(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> val) { _exit(<span class="hljs-number"><span class="hljs-number">-1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (val) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; }</code> </pre> <br>  PVS-Studio: V779 Unreachable code detected. It is possible that an error is present. timeout.c 30 <br><br>  <i>_exit</i>   .   .  ,     : <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> _timeout(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> val) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (val) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; _exit(<span class="hljs-number"><span class="hljs-number">-1</span></span>); }</code> </pre> <br> <b><i>Comment by Carsten Haitzler.</i></b> <i>Not a bug. it's also an unused param thing from before the macros. The timeout has the process self exit in case it takes too long (assuming the decoder lib is stuck if a timeout happens).</i> <br><br> <b><i>  .</i></b> <i>  . ,   ,         .         .   ,     .</i> <br><br>  : <a href="http://cppfiles.com/EFL/EFL_V779.txt">EFL_V779.txt</a> . <br><br><h3> V1001 (6 ) </h3><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Elocation_Address *address = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; <span class="hljs-function"><span class="hljs-function">EAPI Eina_Bool </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">elocation_address_get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Elocation_Address *address_shadow)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!address) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> EINA_FALSE; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (address == address_shadow) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> EINA_TRUE; address_shadow = address; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> EINA_TRUE; }</code> </pre> <br>  PVS-Studio: <a href="http://www.viva64.com/ru/w/V1001/">V1001</a> The 'address_shadow' variable is assigned but is not used until the end of the function. elocation.c 1122 <br><br>  .  ,        : <br><pre> <code class="cpp hljs">*address_shadow = *address;</code> </pre> <br>  : <ul><li> V1001 The 'screen' variable is assigned but is not used until the end of the function. ecore_x_xinerama.c 92 </li><li> V1001 The 'ret' variable is assigned but is not used until the end of the function. edje_edit.c 12774 </li><li> V1001 The 'ret' variable is assigned but is not used until the end of the function. edje_edit.c 15884 </li><li> V1001 The 'position_shadow' variable is assigned but is not used until the end of the function. elocation.c 1133 </li><li> V1001 The 'status_shadow' variable is assigned but is not used until the end of the function. elocation.c 1144 </li></ul><br><br><h2>  Carsten Haitzler </h2><br> PVS-Studio       Coverity.      (  ,   ).       ,         ,         ().     ,   Coverity,     .   ,    PVS-Studio       Coverity       ,  Coverity  ,       ,   .     ,    ,     -,      PVS-Studio  Coverity,      ‚Äî   . <br><br><h2>  Conclusion </h2><br>   ,      <a href=""></a>   ,        . <br><br>        ,    .    ,  EFL     Coverity.    ,  PVS-Studio      . , PVS-Studio     ,            :).    , ,     PVS-Studio,     Coverity,  PVS-Studio    . <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/26e/948/a7e/26e948a7e6ea0fd83f1f89eea3f1ce0c.png" alt=" PVS-Studio"></div><br><br>      PVS-Studio    : <ul><li> <a href="https://www.viva64.com/ru/pvs-studio-download/">PVS-Studio for Windows</a> . </li><li>  <a href="https://www.viva64.com/ru/pvs-studio-download-linux/">PVS-Studio for Linux</a> . </li></ul><br>          . <br><br><div style="text-align:center;"> <a href="http://www.viva64.com/en/b/0523/"><img src="https://habrastorage.org/files/8d2/41b/5bf/8d241b5bf34747169141ed7c1997143b.png"></a> </div><br><br>        ,      : Andrey Karpov. <a href="http://www.viva64.com/en/b/0523/">Characteristics of PVS-Studio Analyzer by the Example of EFL Core Libraries, 10-15% of False Positives</a> <br><br><div class="spoiler"> <b class="spoiler_title">    ?</b> <div class="spoiler_text">          .      : <a href="http://www.viva64.com/ru/a/0085/">      PVS-Studio,  2015</a> . ,   . </div></div></div><p>Source: <a href="https://habr.com/ru/post/334554/">https://habr.com/ru/post/334554/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../334544/index.html">Smok testing on a small project: how it started and what the results</a></li>
<li><a href="../334546/index.html">About Reflect API available language</a></li>
<li><a href="../334548/index.html">The unrealized potential of the Internet of Things</a></li>
<li><a href="../334550/index.html">Company Development with Open Source</a></li>
<li><a href="../334552/index.html">A quarter of a million for the "beetle": Microsoft is beginning an active struggle with bugs</a></li>
<li><a href="../334556/index.html">Machine Learning for an Insurance Company: Improving the Model through Algorithm Optimization</a></li>
<li><a href="../334558/index.html">Differentiation of access rights in PostgreSQL</a></li>
<li><a href="../334560/index.html">Let's play in Firebase</a></li>
<li><a href="../334562/index.html">hh and in production: how to release a new feature</a></li>
<li><a href="../334564/index.html">Defice ask.mcdonalds.ru</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>