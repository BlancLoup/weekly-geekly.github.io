<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Installation for dummies: nginx + php-cgi + mysql + eaccelerator + memcache on Debian 5.0 "lenny"</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This note is a cheat sheet for beginners to install a normally working complex, described in the title. All installation points have been tested sever...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Installation for dummies: nginx + php-cgi + mysql + eaccelerator + memcache on Debian 5.0 "lenny"</h1><div class="post__text post__text-html js-mediator-article">  This note is a cheat sheet for beginners to install a normally working complex, described in the title.  All installation points have been tested several times on different vds, so there should not be any problems with the lack of something, as is usually the case when you put something on manuals that are pulled from different sources.  Detailed description of the settings and "tuning" in the note is not, because  it is all very individual and requires an understanding of what, how and why it is done, and it is impossible to embrace it in one very large spur. <br><a name="habracut"></a><br>  First of all we update the list of packages: <br><br><pre><code class="hljs pgsql">apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">update</span></span></code> </pre> <br>  We put necessary for manual installation and some other artful manipulations: <br><br><pre> <code class="hljs sql">apt-get <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> <span class="hljs-keyword"><span class="hljs-keyword">build</span></span>-essential</code> </pre><br><h2>  Nginx </h2><br>  We put the libraries necessary for installing nginx in the configuration that we will install (always pcre mandatory, ssl is optional if we configure nginx with it): 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="hljs sql">apt-get <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> libpcre3-dev apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> openssl apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> libcurl4-openssl-dev</code> </pre><br>  In Debian packages, unfortunately, a very old version of nginx is in a stable version, so we will install the server manually.  We go to the pace: <br><br><pre> <code class="hljs dos"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /tmp</code> </pre><br>  Download the latest stable version of nginx, unpack it and go to the installation folder: <br><br><pre> <code class="hljs ruby">wget htt<span class="hljs-symbol"><span class="hljs-symbol">://sysoev</span></span>.ru/nginx/nginx-<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">7.61</span></span>.tar.gz tar -zxvf nginx-<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">7.61</span></span>.tar.gz cd nginx-<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">7.61</span></span></code> </pre><br>  Configure and install: <br><br><pre> <code class="hljs tex">./configure <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>--user=www-data <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>--group=www-data <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>--with-http_ssl_module <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>--with-http_realip_module <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>--with-http_addition_module <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>--with-http_sub_module <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>--with-http_dav_module <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>--with-http_flv_module <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>--with-http_gzip_static_module <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>--with-mail <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>--with-mail_ssl_module make make install</code> </pre><br><br>  Run: <br><pre> <code class="hljs pgsql">/usr/<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/nginx/sbin/nginx</code> </pre><br>  Go to the browser, type our ip / domain and see: <br><br>  <b>Welcome to nginx!</b> <br><br>  It means everything is OK.  Now we need to add nginx to autoload.  To do this, create the file '/etc/init.d/nginx' with the following content: <br><br><pre> <code class="hljs vbscript">#! /bin/sh ### BEGIN INIT INFO # Provides: nginx # Required-Start: $all # Required-<span class="hljs-keyword"><span class="hljs-keyword">Stop</span></span>: $all # <span class="hljs-keyword"><span class="hljs-keyword">Default</span></span>-Start: <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> # <span class="hljs-keyword"><span class="hljs-keyword">Default</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">Stop</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> # Short-Description: starts the nginx web <span class="hljs-built_in"><span class="hljs-built_in">server</span></span> # Description: starts nginx using start-<span class="hljs-keyword"><span class="hljs-keyword">stop</span></span>-daemon ### <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> INIT INFO PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin DAEMON=/usr/local/nginx/sbin/nginx NAME=nginx DESC=nginx test -x $DAEMON || <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> # Include nginx defaults <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> available <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -f /etc/<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>/nginx ] ; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> . /etc/<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>/nginx fi <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> -e <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"$1"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> start) echo -n <span class="hljs-string"><span class="hljs-string">"Starting $DESC: "</span></span> start-<span class="hljs-keyword"><span class="hljs-keyword">stop</span></span>-daemon --start --quiet --pidfile /usr/local/nginx/logs/nginx.pid --exec $DAEMON -- $DAEMON_OPTS echo <span class="hljs-string"><span class="hljs-string">"$NAME."</span></span> ;; <span class="hljs-keyword"><span class="hljs-keyword">stop</span></span>) echo -n <span class="hljs-string"><span class="hljs-string">"Stopping $DESC: "</span></span> start-<span class="hljs-keyword"><span class="hljs-keyword">stop</span></span>-daemon --<span class="hljs-keyword"><span class="hljs-keyword">stop</span></span> --quiet --pidfile /usr/local/nginx/logs/nginx.pid --exec $DAEMON echo <span class="hljs-string"><span class="hljs-string">"$NAME."</span></span> ;; restart|force-reload) echo -n <span class="hljs-string"><span class="hljs-string">"Restarting $DESC: "</span></span> start-<span class="hljs-keyword"><span class="hljs-keyword">stop</span></span>-daemon --<span class="hljs-keyword"><span class="hljs-keyword">stop</span></span> --quiet --pidfile /usr/local/nginx/logs/nginx.pid --exec $DAEMON sleep <span class="hljs-number"><span class="hljs-number">1</span></span> start-<span class="hljs-keyword"><span class="hljs-keyword">stop</span></span>-daemon --start --quiet --pidfile /usr/local/nginx/logs/nginx.pid --exec $DAEMON -- $DAEMON_OPTS echo <span class="hljs-string"><span class="hljs-string">"$NAME."</span></span> ;; reload) echo -n <span class="hljs-string"><span class="hljs-string">"Reloading $DESC configuration: "</span></span> start-<span class="hljs-keyword"><span class="hljs-keyword">stop</span></span>-daemon --<span class="hljs-keyword"><span class="hljs-keyword">stop</span></span> --signal HUP --quiet --pidfile /usr/local/nginx/logs/nginx.pid --exec $DAEMON echo <span class="hljs-string"><span class="hljs-string">"$NAME."</span></span> ;; *) N=/etc/init.d/$NAME echo <span class="hljs-string"><span class="hljs-string">"Usage: $N {start|stop|restart|force-reload}"</span></span> &gt;&amp;<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> ;; esac <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br>  Make it executable and add nginx to autoload: <br><br><pre> <code class="hljs sql">chmod 755 /etc/init.d/nginx <span class="hljs-keyword"><span class="hljs-keyword">update</span></span>-rc.d nginx <span class="hljs-keyword"><span class="hljs-keyword">defaults</span></span></code> </pre><br>  Now we can manage our http server with the following commands: <br><br><pre> <code class="hljs swift">/etc/<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>.d/nginx start /etc/<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>.d/nginx restart /etc/<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>.d/nginx stop</code> </pre><br><br><h2>  PHP-FASTCGI </h2><br>  PHP I suggest to put from the collection of packages.  Now there is a stable version 5.2.6 - yes, not the last of 5.2, but it‚Äôs not buggy.  I tried to install 5.2.10 from test packages, in conjunction with nginx it was not working stably.  Install PHP with some required extensions (you can add the extensions you need immediately or later): <br><br><pre> <code class="hljs pgsql">apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> install php5-cgi php5-mysql php5-curl php5-gd php5-<span class="hljs-type"><span class="hljs-type">json</span></span> php5-mcrypt php5-memcache</code> </pre><br>  Next, go to '/etc/php5/cgi/php.ini', where we add a line to the end of the file: <br><br><pre> <code class="hljs">cgi.fix_pathinfo = 1</code> </pre><br>  Add php to autoload.  For this, we create the following script '/etc/init.d/php-fastcgi': <br><br><pre> <code class="hljs vbscript">#! /bin/sh ### BEGIN INIT INFO # Provides: php-fastcgi # Required-Start: $all # Required-<span class="hljs-keyword"><span class="hljs-keyword">Stop</span></span>: $all # <span class="hljs-keyword"><span class="hljs-keyword">Default</span></span>-Start: <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> # <span class="hljs-keyword"><span class="hljs-keyword">Default</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">Stop</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> # Short-Description: Start <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">stop</span></span> php-cgi <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> external FASTCGI mode # Description: Start <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">stop</span></span> php-cgi <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> external FASTCGI mode ### <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> INIT INFO # Author: Kurt Zankl &lt;kz@xon.uni.cc&gt; # <span class="hljs-keyword"><span class="hljs-keyword">Do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-string"><span class="hljs-string">"set -e"</span></span> PATH=/sbin:/usr/sbin:/bin:/usr/bin DESC=<span class="hljs-string"><span class="hljs-string">"php-cgi in external FASTCGI mode"</span></span> NAME=php-fastcgi DAEMON=/usr/bin/php-cgi PIDFILE=/var/run/$NAME.pid SCRIPTNAME=/etc/init.d/$NAME # <span class="hljs-keyword"><span class="hljs-keyword">Exit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> the package <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> installed [ -x <span class="hljs-string"><span class="hljs-string">"$DAEMON"</span></span> ] || <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> # Read configuration variable file <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> it <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> present [ -r /etc/<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>/$NAME ] &amp;&amp; . /etc/<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>/$NAME # Load the VERBOSE setting <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> other rcS variables . /lib/init/vars.sh # Define LSB log_* functions. # Depend <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> lsb-base (&gt;= <span class="hljs-number"><span class="hljs-number">3.0</span></span><span class="hljs-number"><span class="hljs-number">-6</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> ensure that this file <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> present. . /lib/lsb/init-functions # <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> the daemon <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> enabled, give the user a warning <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>, # unless we are stopping the daemon <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-string"><span class="hljs-string">"$START"</span></span> != <span class="hljs-string"><span class="hljs-string">"yes"</span></span> -a <span class="hljs-string"><span class="hljs-string">"$1"</span></span> != <span class="hljs-string"><span class="hljs-string">"stop"</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> log_warning_msg <span class="hljs-string"><span class="hljs-string">"To enable $NAME, edit /etc/default/$NAME and set START=yes"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> fi # Process configuration export PHP_FCGI_CHILDREN PHP_FCGI_MAX_REQUESTS DAEMON_ARGS=<span class="hljs-string"><span class="hljs-string">"-q -b $FCGI_HOST:$FCGI_PORT"</span></span> do_start() { # Return # <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> daemon has been started # <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> daemon was already running # <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> daemon could <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> be started start-<span class="hljs-keyword"><span class="hljs-keyword">stop</span></span>-daemon --start --quiet --pidfile $PIDFILE --exec $DAEMON --test &gt; /dev/<span class="hljs-literal"><span class="hljs-literal">null</span></span> || return <span class="hljs-number"><span class="hljs-number">1</span></span> start-<span class="hljs-keyword"><span class="hljs-keyword">stop</span></span>-daemon --start --quiet --pidfile $PIDFILE --exec $DAEMON --background --make-pidfile --chuid $EXEC_AS_USER --startas $DAEMON -- $DAEMON_ARGS || return <span class="hljs-number"><span class="hljs-number">2</span></span> } do_stop() { # Return # <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> daemon has been stopped # <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> daemon was already stopped # <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> daemon could <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> be stopped # other <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> a failure occurred start-<span class="hljs-keyword"><span class="hljs-keyword">stop</span></span>-daemon --<span class="hljs-keyword"><span class="hljs-keyword">stop</span></span> --quiet --retry=TERM/<span class="hljs-number"><span class="hljs-number">30</span></span>/KILL/<span class="hljs-number"><span class="hljs-number">5</span></span> --pidfile $PIDFILE &gt; /dev/<span class="hljs-literal"><span class="hljs-literal">null</span></span> # --name $DAEMON RETVAL=<span class="hljs-string"><span class="hljs-string">"$?"</span></span> [ <span class="hljs-string"><span class="hljs-string">"$RETVAL"</span></span> = <span class="hljs-number"><span class="hljs-number">2</span></span> ] &amp;&amp; return <span class="hljs-number"><span class="hljs-number">2</span></span> # Wait <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> children <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> finish too <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> this <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> a daemon that forks # <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> the daemon <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> only ever run from this initscript. # <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> the above conditions are <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> satisfied <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> add some other code # that waits <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the process <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> drop all resources that could be # needed by services started subsequently. A last resort <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> # sleep <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> some <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>. start-<span class="hljs-keyword"><span class="hljs-keyword">stop</span></span>-daemon --<span class="hljs-keyword"><span class="hljs-keyword">stop</span></span> --quiet --oknodo --retry=<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">30</span></span>/KILL/<span class="hljs-number"><span class="hljs-number">5</span></span> --exec $DAEMON [ <span class="hljs-string"><span class="hljs-string">"$?"</span></span> = <span class="hljs-number"><span class="hljs-number">2</span></span> ] &amp;&amp; return <span class="hljs-number"><span class="hljs-number">2</span></span> # Many daemons don<span class="hljs-comment"><span class="hljs-comment">'t delete their pidfiles when they exit. rm -f $PIDFILE return "$RETVAL" } case "$1" in start) [ "$VERBOSE" != no ] &amp;&amp; log_daemon_msg "Starting $DESC" "$NAME" do_start case "$?" in 0|1) [ "$VERBOSE" != no ] &amp;&amp; log_end_msg 0 ;; 2) [ "$VERBOSE" != no ] &amp;&amp; log_end_msg 1 ;; esac ;; stop) [ "$VERBOSE" != no ] &amp;&amp; log_daemon_msg "Stopping $DESC" "$NAME" do_stop case "$?" in 0|1) [ "$VERBOSE" != no ] &amp;&amp; log_end_msg 0 ;; 2) [ "$VERBOSE" != no ] &amp;&amp; log_end_msg 1 ;; esac ;; restart|force-reload) log_daemon_msg "Restarting $DESC" "$NAME" do_stop case "$?" in 0|1) do_start case "$?" in 0) log_end_msg 0 ;; 1) log_end_msg 1 ;; # Old process is still running *) log_end_msg 1 ;; # Failed to start esac ;; *) # Failed to stop log_end_msg 1 ;; esac ;; *) echo "Usage: $SCRIPTNAME {start|stop|restart|force-reload}" &gt;&amp;2 exit 3 ;; esac</span></span></code> </pre><br>  We do it: <br><br><pre> <code class="hljs swift">chmod <span class="hljs-number"><span class="hljs-number">755</span></span> /etc/<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>.d/php-fastcgi</code> </pre><br>  Create another '/ etc / default / php-fastcgi' file so that we can control php-fastcgi (listen to ports, get the number of child processes and other requests) with the following content: <br><br><pre> <code class="hljs pgsql"># # Settings <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> php-cgi <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">external</span></span> FASTCGI Mode # # Should php-fastcgi run automatically <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> startup? (<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">no</span></span>) START=yes # Which <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> runs PHP? (<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: www-data) EXEC_AS_USER=www-data # Host <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> TCP port <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> FASTCGI-Listener (<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: localhost:<span class="hljs-number"><span class="hljs-number">9000</span></span>) FCGI_HOST=localhost FCGI_PORT=<span class="hljs-number"><span class="hljs-number">9000</span></span> # Environment variables, which are processed <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> PHP PHP_FCGI_CHILDREN=<span class="hljs-number"><span class="hljs-number">5</span></span> PHP_FCGI_MAX_REQUESTS=<span class="hljs-number"><span class="hljs-number">1000</span></span></code> </pre><br><br>  Run php-fastcgi: <br><pre> <code class="hljs swift">/etc/<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>.d/php-fastcgi start</code> </pre><br>  Add to autoload: <br><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">update</span></span>-rc.d php-fastcgi <span class="hljs-keyword"><span class="hljs-keyword">defaults</span></span></code> </pre><br><br><h2>  We are friends with NGINX and PHP </h2><br>  Create a folder for sites, for example, '/ home / www'. <br><br>  Edit '/usr/local/nginx/conf/nginx.conf'.  Specify by whom we will run nginx: <br><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">user</span></span> www-<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> www-</span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">;</span></span></code> </pre><br><br>  In the server {} container, we will change / uncomment the following lines: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">location</span></span> / { <span class="hljs-attribute"><span class="hljs-attribute">root</span></span> /home/www; <span class="hljs-attribute"><span class="hljs-attribute">index</span></span> index.php index.html index.htm; } <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> <span class="hljs-regexp"><span class="hljs-regexp">~ \.php$</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">root</span></span> /home/www; <span class="hljs-attribute"><span class="hljs-attribute">fastcgi_pass</span></span> <span class="hljs-number"><span class="hljs-number">127.0.0.1:9000</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">fastcgi_index</span></span> index.php; <span class="hljs-attribute"><span class="hljs-attribute">fastcgi_param</span></span> SCRIPT_FILENAME /home/www<span class="hljs-variable"><span class="hljs-variable">$fastcgi_script_name</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">include</span></span> fastcgi_params; }</code> </pre><br>  Restart nginx: <br><br><pre> <code class="hljs swift">/etc/<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>.d/nginx restart</code> </pre><br>  Create a file for the test '/home/www/info.php' of the following content: <br><br><pre> <code class="hljs xml"><span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?php</span></span></span><span class="php"> phpinfo(); </span><span class="hljs-meta"><span class="php"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre> <br>  Check in the browser - https: //your-address/info.php <br><br><h2>  MYSQL </h2><br>  We put: <br><br><pre> <code class="hljs sql">apt-get <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> mysql-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> mysql-<span class="hljs-keyword"><span class="hljs-keyword">client</span></span></code> </pre><br>  In the process you will be prompted to set a root password, which can always be changed like this: <br><br><pre> <code class="hljs pgsql">mysqladmin -u root <span class="hljs-keyword"><span class="hljs-keyword">password</span></span> tralala</code> </pre><br><h2>  EACCELERATOR </h2><br>  Sadly, eAccelerator is completely missing from the Debian installation packages.  We will put hands.  Before we need to install the library php-developer: <br><br><pre> <code class="hljs swift">apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> install php5-dev</code> </pre> <br>  Now download and install eAccelerator: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">cd</span></span> /tmp wget htt://bart.eaccelerator.net/source/<span class="hljs-number"><span class="hljs-number">0.9.5.3</span></span>/eaccelerator-<span class="hljs-number"><span class="hljs-number">0.9.5.3</span></span>.tar.bz2 tar xvfj eaccelerator-<span class="hljs-number"><span class="hljs-number">0.9.5.3</span></span>.tar.bz2 cd eaccelerator-<span class="hljs-number"><span class="hljs-number">0.9.5.3</span></span> phpize ./configure make make install</code> </pre> <br>  Create a configuration file '/etc/php5/conf.d/eaccelerator.ini' with the following content: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">extension</span></span>="eaccelerator.so" eaccelerator.shm_size="64" eaccelerator.cache_dir="/var/cache/eaccelerator" eaccelerator.<span class="hljs-keyword"><span class="hljs-keyword">enable</span></span>="1" eaccelerator.optimizer="1" eaccelerator.check_mtime="1" eaccelerator.<span class="hljs-keyword"><span class="hljs-keyword">debug</span></span>="0" eaccelerator.<span class="hljs-keyword"><span class="hljs-keyword">filter</span></span>="" eaccelerator.shm_max="0" eaccelerator.shm_ttl="3600" eaccelerator.shm_prune_period="1800" eaccelerator.shm_only="0" eaccelerator.compress="1" eaccelerator.compress_level="9"</code> </pre><br>  Create a folder to store eAccelerator files: <br><br><pre> <code class="hljs pgsql">mkdir -p /var/<span class="hljs-keyword"><span class="hljs-keyword">cache</span></span>/eaccelerator chmod <span class="hljs-number"><span class="hljs-number">0777</span></span> /var/<span class="hljs-keyword"><span class="hljs-keyword">cache</span></span>/eaccelerator</code> </pre><br>  Restart php: <br><br><pre> <code class="hljs swift">/etc/<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>.d/php-fastcgi restart</code> </pre><br><h2>  MEMCACHE </h2><br>  Install: <br><br><pre> <code class="hljs swift">apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> install memcached</code> </pre><br>  Restart php one more time: <br><br><pre> <code class="hljs swift">/etc/<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>.d/php-fastcgi restart</code> </pre><br><br>  Have a good job! <br><br>  btw, who cares, <a href="http://habrahabr.ru/blogs/livestreet/67415/">here</a> you can see the tests of this complex on vds: 480 MHz / 256 Mb and 1280 MHz / 1024 Mb. </div><p>Source: <a href="https://habr.com/ru/post/67557/">https://habr.com/ru/post/67557/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../67549/index.html">Conspiracy theories and stuff</a></li>
<li><a href="../67550/index.html">Spaceship Doctor Evil</a></li>
<li><a href="../67551/index.html">To-do lists</a></li>
<li><a href="../67554/index.html">Project on enthusiasm, part 2: Realities</a></li>
<li><a href="../67555/index.html">Canon G11: less megapixels</a></li>
<li><a href="../67558/index.html">UUID and / dev / disk / by-id rush to the rescue</a></li>
<li><a href="../67559/index.html">Appendix "harmonious couple." Second wind!</a></li>
<li><a href="../67560/index.html">Flickr galleries</a></li>
<li><a href="../67563/index.html">Leechcraft 0.3.0</a></li>
<li><a href="../67564/index.html">Watch James Bond</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>