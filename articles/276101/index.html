<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Well, this day has come: quick joint editing in ONLYOFFICE editors</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This day still came. We rolled out an updated version of the ONLYOFFICE Document Editors 3.6 document editors with fast co-editing, like in Google Doc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Well, this day has come: quick joint editing in ONLYOFFICE editors</h1><div class="post__text post__text-html js-mediator-article">  This day still came.  We rolled out an updated version of the ONLYOFFICE Document Editors 3.6 document editors with fast co-editing, like in Google Docs.  He has long been asked, demanded, threatened, but we were inexorable.  Until then, until you surrendered under the pressure of users who want to edit their secret materials, in real time watching what a collaborator is typing. <br><br>  Next, we will explain why we were so opposed to ‚Äúfast‚Äù joint editing, how our version differs from the similar mode in other online editors, and how we are going to solve the issue of undo / redo. <br><br><img src="https://habrastorage.org/files/20b/894/c56/20b894c566804a2f8cbe704612381790.png"><br><a name="habracut"></a><br><h1>  Strict vs fast </h1><br>  When we chose how collaboration with documents in our editors will be implemented, we had no doubt that a ‚Äústrict‚Äù mode is the best option.  Working in this way, the user sees the edits of the collaborator only after he has saved the changes. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It is with this editing mode that users can simultaneously edit a multi-page document without interfering with each other.  That is, editing the user editing the document on the first page will not create any inconvenience for his co-author working on the 20th.  In the case of ‚Äúfast‚Äù editing, the first one could interfere with the second, since its changes trigger the recalculation of the document pages.  In addition, if users write something on different pages, they do not need to know about the changes that have occurred literally at the other end of the document. <br><br>  <u>Other arguments in favor of "strict" editing mode</u> : <br><br><ul><li>  The absence of distracting factors in the form of comments from colleagues regarding the changes made and their own edits; <br></li><li>  No conflicts with undo / redo; <br></li><li>  And, of course, the opportunity to correct grammatical and punctuation errors, before colleagues break out into a whirlwind of jokes about it. <br></li></ul><br>  In general, this approach seemed to us more productive and universal, therefore the classic co-editing mode in ONLYOFFICE is precisely ‚Äústrict‚Äù.  More information about him can be found in our old, but not lost the <a href="https://habrahabr.ru/company/teamlab/blog/169841/">text</a> . <br><br>  We did not complex about the lack of a quick co-editing mode, but users wanted it.  Like our PR department, practicing co-creation in real-time mode.  In general, we gave up and even found <br><br>  <u>Pros of the "fast" mode</u> : <br><br><ul><li>  Convenience and speed when working with small documents (several pages); <br></li><li>  Entertainment; <br></li><li>  Convenience for joint development of ideas, such as brainstorming; <br></li><li>  The ability to quickly make and track the final edits when working together on the final version of the document. <br></li></ul><br>  In the new version of editors, the ‚Äúfast‚Äù mode of joint editing is set by default.  You can return the classic ‚ÄúStrict‚Äù by following a simple scheme: the ‚ÄúFile‚Äù menu - the ‚ÄúAdvanced Settings‚Äù tab - ‚ÄúCo-editing mode‚Äù.  You can switch between modes at any time. <br><br><h1>  How things are arranged </h1><br>  With "strict" editing, there is a "clamping" of a fragment of the document that the user is working on.  For his collaborators, the object is locked until the user saves his changes.  After saving, the object is unlocked, until someone again starts frantically editing it.  With "strict" editing, the user saves his edits with his hands.  In addition, the document is automatically saved every ten minutes. <br><br>  With the "fast" editing mechanism of work, in fact, does not change.  Except that autosave happens more often.  25 times a second, the timer asks for changes and, if they were made, makes a save.  Immediately after saving the object is unlocked.  Thus, it seems that the edited fragment was not even blocked.  In fact, lock existed for only 1/25 of a second and, if Flash does not type the text in our editor, then in general no one will notice this little trick. <br><br><h1>  Operational transformation </h1><br>  The clamping scheme was almost perfect for everything except typing and deleting text.  In these cases, blocking a paragraph, even the shortest, caused unpleasant natural phenomena: some letters were simply not typed.  Therefore, we had to abandon the blocking of paragraphs when entering and deleting text (in other cases, the blocking is still present). <br><br>  Next, we needed to provide simultaneous input / deletion of text from one paragraph for several users.  For this we needed an algorithm for transforming changes, or, as it is also called, an <a href="https://en.wikipedia.org/wiki/Operational_transformation"><i>operational transformation</i></a> .  In fact, this algorithm already existed in our editor.  In the ‚Äústrict‚Äù editing mode, he was responsible for merging the added / deleted paragraphs in the document.  Although at the time of development we did not even know that we were ‚Äúinventing‚Äù an operational transformation. <br><br>  <u>The essence of the algorithm is as follows</u> : <br><br>  Suppose we have a paragraph with the text "avbr" and two users - Number One and Number Two, who want to simultaneously make changes to this text.  For example, Number One inserts the letter ‚Äúx‚Äù at the beginning of the word, and Number Two deletes the letter ‚Äúc‚Äù.  When you merge should get "Habr." <br><br><img src="https://habrastorage.org/files/cdd/11e/7d4/cdd11e7d4a9b4a98b65ea9c9b83a1e87.png"><br><br>  For the algorithm, user actions can be written as ins (‚Äúx‚Äù, 0) (insert the letter ‚Äúx‚Äù in the zero position) and del (1) (delete in position 1).  Let's try to consistently perform these transformations, taking into account whose changes will come first to the server: <br><br><img src="https://habrastorage.org/files/472/d4f/43b/472d4f43bf704abeaf4fc33774de0646.png"><br><br>  It can be seen that the complexity lies not only in the changes themselves, but also in who of the users managed to send their edits first.  The solution to this problem is that the user changes that come second to the server need to be transformed through the changes that came first.  In the first case, since deleting at position 1 does not change the insertion at position 0, the second change does not change. <br><br>  In the second case, insertion at position 0 affects the subsequent deletion at position 1, it is converted into deletion at position 2. Finally, after conversion, we get the following scheme. <br><br><img src="https://habrastorage.org/files/c1f/385/23f/c1f38523ff664ac89e36e9ed38447cb9.png"><br><br>  According to this principle, all text (and not just text) editors that have co-editing online work.  However, our version is somewhat different from how everything is arranged in other online editors. <br><br><h1>  The main difference </h1><br>  The difference is where the conversion of the submitted changes takes place.  For other online editors (for example, Google Docs), the server is responsible for the conversion processes.  The changes come to him in an untouched form: in our case, these are ins (‚Äúx‚Äù, 0) from Number One and del (1) from Number Two.  Next, the server converts the edits received and sends them to users.  Thus, Number One will receive del (2), and Number Two - ins ("x", 0). <br><br><img src="https://habrastorage.org/files/3be/85c/5ca/3be85c5ca6fc4c5abd373114f74da6a4.png"><br><br>  In our scheme, everything will happen differently.  Both users will send to the server a request to save their changes.  One of them will receive the answer ‚Äúcan‚Äù, and the second ‚Äúcannot‚Äù.  The one to whom it is ‚Äúpossible‚Äù will immediately send their changes to the server, which, in turn, will send them to the second user.  The second user applies these changes and (according to the scheme described above) converts his own changes through them.  Only then will he send his converted changes to the server.  Then edits will come to the first user. <br><br><img src="https://habrastorage.org/files/c46/d03/e60/c46d03e60ff54f0eb0a44fa0685919c6.png"><br><br>  The main advantage of our scheme is that we do not load the server - it only stores a list of changes that were made to the document, and a save queue is organized. <br><br><h1>  Cancel / return </h1><br>  We immediately recognize that we do not yet have undo in the mode of ‚Äúfast‚Äù joint editing.  Unfortunately, no one has such an undo that users would like. <br><br>  For example, undo editors Google Docs works partially.  Rather, it is designed for the fact that users will cancel minor missteps, typos.  Attempts to roll back more serious changes can lead to unpredictable consequences. <br><br>  Suppose one person added a table, and another began to change it, say, move the boundaries, enter text.  Then the first one decided to make an undo table addition.  In fact, the table will disappear with everything that the second user did in it.  If he, for example, dragged into the table a part of the text from the document, then it will sink into oblivion along with the canceled table.  In addition, for this option undo it is impossible to make the correct redo in terms of changes made to the document. <br><br>  The undo / redo scheme in Google Docs does not return the document to its original form, as the user would like, on the contrary, it can make it the way this document has never been. <br><br>  We are more impressed with the option invented by Microsoft: the user makes his edits and can roll them back as long as necessary, but only until user number two joins editing and makes his own edits.  Then undo will work for the second user.  Until the third appears.  This option seems to us to be correct from the point of view of editing, so now we are working on the implementation of this scheme in our editors. <br><br>  However, we are also thinking about adding undo, which would work just like Google‚Äôs.  In our plans, it coexists peacefully with the Microsoft option: as long as you can do the correct undo / redo, we do it, then we try to do the undo as in Google Docs. <br><br><h1>  In different modes </h1><br>  The ability to switch edit modes is our innovation.  Users who work with the document at the same time can choose the most convenient way to edit. <br><br>  For example, Number One has ‚Äústrict‚Äù mode enabled, and Number Two has ‚Äúfast‚Äù mode.  The first blocks objects and saves its changes by itself.  The second does not block anything, and saving it happens automatically.  If the first is editing an object or a piece of text, the second can do nothing in them.  At the same time, the first one does not see what the second one does - let it be a surprise.  After saving, Number One will send its changes and accept the changes to Number Two. <br><br>  If Number Three is connected with the ‚Äúfast‚Äù mode, then they with Number Two are quietly working in the mode of fast co-editing.  At the same time, they do not see and cannot rule what the introvert Number One blocked.  The latter, by the way, employs both undo and redo. <br><br>  This scheme of work seems logical and convenient to us - it allows users to choose the way of interaction with collaborators depending on the tasks and mood.  Switching between modes is possible at any time editing. <br><br>  Try quick collaborative editing in action <a href="https://personal.onlyoffice.com/products/files/doceditor.aspx%3Ffileid%3D937011%26doc%3DTlA0VkhzSStxR0RmUWR0S2dyZUxORmhwZ2U4dUh2QmZpck1tT3YwVGtvUT0_IjkzNzAxMSI1">here</a> . <br><br>  PS In the new version of the ONLYOFFICE editors, <a href="http://helpcenter.onlyoffice.com/ru/ONLYOFFICE-Editors/ONLYOFFICE-Document-Editor/HelpfulHints/Review.aspx">a review mode</a> has also appeared with tracking of changes made during document verification.  The proposed edits can be accepted or rejected. <br><br>  PPS Editors never stop working at all.  We always think that this would add and improve.  Therefore, there is still a lot of things ahead. <br></div><p>Source: <a href="https://habr.com/ru/post/276101/">https://habr.com/ru/post/276101/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../276091/index.html">A game for those learning to program: Colobot</a></li>
<li><a href="../276093/index.html">TensorFlow and Logistic Regression</a></li>
<li><a href="../276095/index.html">Prediction, cloud computing in 2016</a></li>
<li><a href="../276097/index.html">Game design: on the other side of the game</a></li>
<li><a href="../276099/index.html">Add local search system to Android application</a></li>
<li><a href="../276103/index.html">Data Center Experience and Problems: How to Verify Data Center Reliability</a></li>
<li><a href="../276105/index.html">SEO-tools - an extension for Opera (webmaster and optimizer tools)</a></li>
<li><a href="../276107/index.html">Who celebrated the New Year with the Russians?</a></li>
<li><a href="../276109/index.html">Domains: is there life after death?</a></li>
<li><a href="../276115/index.html">Source codes of the neural network library on F # for the .NET Framework</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>