<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Introduction to optimization. Annealing imitation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I will try to speak in the most intelligible way about such a simple but effective method of optimization as simulated annealing. And ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Introduction to optimization. Annealing imitation</h1><div class="post__text post__text-html js-mediator-article">  In this article I will try to speak in the most intelligible way about such a simple but effective method of optimization as simulated annealing.  And in order not to be numbered among those who are far from practice, those who like to theorize, I will show how to apply this method to solve the traveling salesman problem. <br><br>  To understand the article, you will need minimal programming skills and mastery of mathematics at the grade 9 level of high school.  The article is intended for people who are not familiar with optimization methods or who are just taking the first steps in this direction. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/366/dcc/e23/366dcce23cab26db80f7717f6828cced.gif" alt="image"></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br>  In order to maximize the circle of readers, I had to almost completely abandon formal definitions and consciously go for some not entirely accurate simplifications.  I hope that with the water I did not throw out the child (and if this happened, I will be glad to your comments). <br><br><h4>  About optimization </h4><br>  In order to understand what optimization is, you first need to know what it is for.  At once I will say that with the ‚Äúoptimization problems‚Äù in everyday life we ‚Äã‚Äãare confronted with enviable regularity, without giving ourselves a report on this. <br><br>  Suppose we, having received the next salary, decide to line up the family budget.  It is necessary to allocate money so that first of all to satisfy the most important needs (food, electricity, Internet, etc.), and the rest can be lowered to something lower priority.  Buy all the money designer phone and die of hunger - not the best solution, is not it? <br><br>  Or another option, we decided to go hiking and collect a satchel.  One problem is that there is a lot of things, and our backpack is not too big (and we ourselves have limited carrying capacity).  We want to take as many of the most important items for us as possible.  If we go to the mountains, grabbing a safety cable with us is a good decision, take your favorite PlayStation Vita instead, and probably don‚Äôt give you the rest of the time with cookies. <br><br>  So what does the optimization do?  She is looking for the very good solution.  Perhaps not the best of all, but definitely good. <br>  Now a little bit more formal.  If you look at Wikipedia, you can easily find the following definition: <br><br>  <i>The optimal (from the Latin. Optimus - the best) solution - a solution that, in one way or another, is preferable to others.</i>  Therefore, optimization is a way to find the optimal solution. <br><br>  Now, let's imagine that we can measure how good our decision is.  For example, in the case of a ‚Äúknapsack problem‚Äù, we assign each thing a natural number (the larger the number, the more important the thing).  Then our task gets a clearer statement: we want to fill the satchel with such things, the total priority of which will be maximum, and the weight will not exceed a certain value.  Those.  we <i>are looking for the maximum of a certain function</i> , which is called the <i>target</i> . <br><br>  To reduce everything to a common denominator, look again at Wikipedia: <br>  Optimization (mathematics) - finding the extremum (minimum or maximum) of the objective function in a certain area. <br><br>  Now that we have more or less decided on what the optimization is doing, a reasonable question appears - ‚ÄúHow?‚Äù. <br>  Of course, we can not particularly bother and go through all the solutions, and then compare them.  In the case of the knapsack, we can probably even do this.  But now let's imagine that our satchel is not a satchel at all, but a whole train with many wagons, but we transport different goods to another city.  The task has not changed (load as much as possible valuable), and the target function will be the total value of the goods.  How long will it take us to complete a bust of solutions?  I think a lot. <br><br>  You can choose solutions randomly.  Suppose there are a hundred solutions, and then take the best of them.  Undoubtedly, it will be much faster than complete enumeration, but who will guarantee that our final solution will be at all close to the extremum? <br><br>  I will not torment and say that there are a great many <a href="http://ru.wikipedia.org/wiki/%25CE%25EF%25F2%25E8%25EC%25E8%25E7%25E0%25F6%25E8%25FF_(%25EC%25E0%25F2%25E5%25EC%25E0%25F2%25E8%25EA%25E0)">optimization methods</a> .  So much that they are usually divided into classes, I will not list them all.  Let me just say that ‚Äúannealing imitation‚Äù refers to the class of stochastic (from the Greek. Œ£œÑœáœáœÉœÉœÑŒπŒ∫œåœÇ - ‚Äú <i>able to guess</i> ‚Äù) or probabilistic methods.  And where is the probability and how it will help find a solution - just below. <br><br><h4>  Annealing imitation </h4><br>  Like all brilliant, this method is peeped at Mother Nature.  It is based on the process of crystallization of the substance, which in turn was ‚Äútamed‚Äù by sly metallurgists, in order to increase the homogeneity of the metal. <br><br>  Let me remind you that every metal has a <i>crystal lattice</i> , if very briefly, it describes the geometric position of the atoms of matter.  The set of positions of all atoms will be called the <i>state of the</i> system, each state corresponds to a certain level of energy.  The purpose of annealing is to bring the system to the lowest energy state.  The lower the energy level, the ‚Äúbetter‚Äù the crystal lattice, i.e.  the fewer defects and stronger the metal. <br><br>  During the "annealing" the metal is first heated to a certain temperature, which causes the atoms of the crystal lattice to leave their positions.  Then begins a slow and controlled cooling.  Atoms tend to get into a state with less energy, however, with a certain probability they can go into a state with more.  This probability decreases with temperature.  The transition to the worst state, oddly enough, helps in the end to find a state with energy less than the initial one.  The process ends when the temperature drops to a predetermined value. <br><br>  As you can see, in the framework of this process, energy is minimized.  We change the energy to our target function, and voil√†!  Or not?  Let's think, and why is so tricky process so good?  Why don't we, for example, always go to lower energy states? <br>  This is how the <a href="http://www.machinelearning.ru/wiki/index.php%3Ftitle%3D%25D0%259C%25D0%25B5%25D1%2582%25D0%25BE%25D0%25B4_%25D0%25B3%25D1%2580%25D0%25B0%25D0%25B4%25D0%25B8%25D0%25B5%25D0%25BD%25D1%2582%25D0%25BD%25D0%25BE%25D0%25B3%25D0%25BE_%25D1%2581%25D0%25BF%25D1%2583%25D1%2581%25D0%25BA%25D0%25B0">gradient descent</a> method works widely. <br><br>  On the Internet, I managed to find a completely wonderful picture that illustrates the best of the algorithm. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8bc/9a1/02e/8bc9a102e8d940b758ba21afc2997ac9.gif" alt="image" width="350" align="left"><br><br>  Let us imagine for a moment a skier, rushing along the steep slope of our objective function.  The task is to go down to the lowest point (global minimum).  But, as you can see, the slope we got was not quite even, there are lowlands on it, having come to them, it may seem to us that we are already at the foot.  In order not to stay in the cold, we will have to show curiosity and climb a small mound to continue the descent. <br><br>  In order for the metaphor to be finally understood, in the skier example, the slope is the function of measuring the energy of a substance (it is the objective function).  A probabilistic transition to a state with more energy - climbing on a hill to the right of the lowlands. <br><br>  As you can see, such an algorithm allows us with a high probability to avoid ‚Äúgetting stuck‚Äù in the local minimum. <br><br>  Now we are ready to move to a more rigorous description of the method.  We introduce the notation: <br>  Let S be the set of all states (solutions) of our problem.  For example, for the knapsack problem, this will be a multitude of various sets of things. <br>  Let be <img src="https://habrastorage.org/getpro/habr/post_images/d7d/67a/d64/d7d67ad64dc9a965cb9abbdd6d837f81.gif">  - state on the i-th step of the algorithm. <img src="https://habrastorage.org/getpro/habr/post_images/1e8/c15/f0f/1e8c15f0f7c42b8bdd56d798d8e0f04d.gif">  . <br><img src="https://habrastorage.org/getpro/habr/post_images/857/05e/319/85705e319fd13a8de4d16a6ca54fc6ba.gif">  - temperature at the i-th step. <br><br>  In order to use the annealing simulation, we need to define three functions: <br><ul><li>  The function of energy or, more simply, what we optimize. <br><img src="https://habrastorage.org/getpro/habr/post_images/cc1/c3d/293/cc1c3d293034cc070c07ab39b64505df.gif"><br></li><li>  The function of temperature changes over time.  Just in case, make a reservation that it must be decreasing. <br><img src="https://habrastorage.org/getpro/habr/post_images/d5b/892/a7e/d5b892a7ea20d488007b97a682b79502.gif"><br></li><li>  The function that generates the new state. <br><img src="https://habrastorage.org/getpro/habr/post_images/aec/5f8/0b4/aec5f80b45f173b3eb47fd6755e2fb9e.gif"><br></li></ul><br>  Now we will dwell on each detail. <br>  E to each decision according to some rule puts a number in correspondence.  Depends on the specific task. <br><br>  T sets the iteration number i to the corresponding temperature.  The function determines how long our algorithm will work (in fact, it has a deeper meaning, but for now we don‚Äôt need to know this).  If T is a linear function, then the running time will be relatively large.  In the case of a power function, say <img src="https://habrastorage.org/getpro/habr/post_images/0bb/4a0/4b9/0bb4a04b909a3b40e62503735c4a7818.gif">  , everything will end very quickly, but it is far from a fact that we will not get stuck in the lowlands, so not having reached the finish line. <br><br>  For this article, I chose the simplest, linear option. <br><br><pre><code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[ T ]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DecreaseTemperature</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( initialTemperature, i)</span></span></span><span class="hljs-function"> %</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initialTemperature</span></span></span><span class="hljs-function"> -   %</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function"> -   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initialTemperature</span></span></span><span class="hljs-function"> * 0.1 / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><br>  At once I will make a reservation that all the code in this article was written on <a href="http://ru.wikipedia.org/wiki/MATLAB">Matlab</a> .  I chose this medium, as out of the box you can draw beautiful graphics - no more.  I tried to write without using specific matlab magic so that the code could be easily ported to your favorite language. <br><br>  The function F, based on the previous state, generates a new candidate state, into which the system can go, and it can also drop it.  Denote it <img src="https://habrastorage.org/getpro/habr/post_images/9ef/9a0/f20/9ef9a0f20ab0fbd35d3dae92c3825660.gif">  .  The method of obtaining a candidate depends entirely on the problem being solved, you can see a specific function in the example. <br><br>  Now we can describe the algorithm of the simulated annealing method in the most general form: <br><ul><li>  Inlet: minimum temperature <img src="https://habrastorage.org/getpro/habr/post_images/e22/39c/5b2/e2239c5b20bede6152f1777342809c7c.gif">  initial temperature <img src="https://habrastorage.org/getpro/habr/post_images/0e6/92b/c2e/0e692bc2ed39a906bde6d75ab3c83502.gif"></li><li>  Set an arbitrary first state <img src="https://habrastorage.org/getpro/habr/post_images/a37/918/cc3/a37918cc30b85855a6740d3b09e6c265.gif"></li><li><img src="https://habrastorage.org/getpro/habr/post_images/16c/f39/dd3/16cf39dd392e2a6287b135793b570c81.gif"></li><li>  Until <img src="https://habrastorage.org/getpro/habr/post_images/895/de7/a18/895de7a18f3f71ab7ac1b7e5f4974f7d.gif"><br><ul><li><img src="https://habrastorage.org/getpro/habr/post_images/55e/703/a3f/55e703a3f6ab67fdc0a1a20e4b9003f2.gif"></li><li><img src="https://habrastorage.org/getpro/habr/post_images/148/dd9/95a/148dd995a9997cd4ddee817741a5db4b.gif"></li><li>  If a <img src="https://habrastorage.org/getpro/habr/post_images/81f/c61/314/81fc61314273e1868992ce7ed25d0c12.gif">  then <img src="https://habrastorage.org/getpro/habr/post_images/5c0/eb7/74e/5c0eb774e4cc863cf137868254b3c550.gif"></li><li>  If a <img src="https://habrastorage.org/getpro/habr/post_images/c94/69b/7af/c9469b7af62b0638ec77cf9164285b26.gif">  the transition is carried out with probability <img src="https://habrastorage.org/getpro/habr/post_images/816/d5a/71f/816d5a71fccd9d985da0cb2012db3a0e.gif"></li><li>  Lower the temperature <img src="https://habrastorage.org/getpro/habr/post_images/592/061/e29/592061e2926eee2519aa4b618e93bcf2.gif"></li></ul><br></li><li>  Return the last state s </li></ul><br><br>  As you can see, everything is very simple, it is worthwhile to separately explain only the transition to a new state.  If the energy of the ‚Äúcandidate‚Äù is less, it becomes a new state, otherwise, the transition will be probabilistic (therefore, the method is referred to the stochastic class). <br><br>  So that this does not cause any difficulties, I will allow myself to recall some of the most basic concepts of probability theory. <br><br>  We informally define the probability as a measure of the possibility of the occurrence of a certain event.  The probability of a reliable event (an event that just happens) is equal to one, the impossible - zero.  All other values ‚Äã‚Äãare between. <br>  For example, when throwing a die, the probability of dropping any number is one, and triples - 1/6. <br>  In our case, substituting the energy difference values ‚Äã‚Äãin the formula <img src="https://habrastorage.org/getpro/habr/post_images/6e1/b68/2c8/6e1b682c855a7da11e5ef69ad4c83aa3.gif">  and temperatures <img src="https://habrastorage.org/getpro/habr/post_images/e35/28c/10a/e3528c10a9704278f16bbbf7110a986b.gif">  we get the probability of transition.  It remains only to make this transition, but how to do it? <br><br>  Probability calculation code: <br><pre> <code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[ P ]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetTransitionProbability</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( dE, T )</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">P</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">exp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(-dE/T)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  Let's imagine a single segment and divide it into two parts relative to the value of our probability. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/76a/44c/882/76a44c882c264425a5b0cc0aa98af372.png"></div><br><br>  Then we use the function of generating a uniformly distributed random number, in Matlab this is rand (as in almost all other languages).  Now we note this number on the segment. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/48d/bd9/f1c/48dbd9f1cb254b3ce8b660c0c38cfde5.png"></div><br><br>  If the number is in the left part - we make the transition, in the right - we do not do anything. <br><pre> <code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[ a ]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsTransition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(probability)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">value</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value &lt;= probability)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = 1; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span></span></code> </pre><br><br>  Now, I think everything is clear, and we can go directly to the solution of our first task. <br><br><h4>  Traveling salesman task </h4><br>  Imagine that you are a wandering merchant and want to offer your goods to the inhabitants of every city in the country.  Traveling takes a lot of time and effort, so it is logical that you want to make your route in such a way that the distance to be covered is minimal.  This route is to be found. <br>  More formally: you need to find the shortest path that passes through each city and ends at the point of departure. <br>  In this formulation, the problem is called the closed-door traveling salesman problem. <br><br>  First, let's define the data.  Let our cities be randomly scattered in a 10x10 square.  Each city, respectively, is represented by a pair of coordinates.  Only 100 cities. <br><div style="text-align:center;"><img src="http://habrastorage.org/storage3/3d0/cf2/519/3d0cf2519c6bc23f3b8a6cb6def24774.png" width="500"></div><br><br>  Data can be easily obtained in Matlab with the following code: <br><pre> <code class="matlab hljs">data = <span class="hljs-built_in"><span class="hljs-built_in">rand</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>)*<span class="hljs-number"><span class="hljs-number">10</span></span>;</code> </pre><br>  In other languages, you have to write a cycle, but in fact it does not change anything.  We generate random numbers with the rand () function already familiar to us and multiply them by 10 so that they lie in a given area. <br><br><h4>  Solving the problem by simulating annealing </h4><br>  Denote the set of all cities by C, the total number is denoted by | C |  and in our case it is 100. Every city <img src="http://1450828419268797433207">  represented as a pair of coordinates <img src="http://habrastorage.org/storage3/2af/3a0/a2c/2af3a0a2c104402c5c228e1b96fbd8bf.gif">  with the appropriate index. <br><br>  By convention, the solution is a route between all cities, which means the set of states S are all possible routes passing through each city.  In other words, the set of all ordered sequences of elements of C, in which any <img src="http://1450828419268797433207">  occurs exactly once.  Obviously, the length of each such sequence | C |. <br><br>  As we remember, in order to use the method of simulating annealing, we must define two functions depending on each specific task.  This is the energy function E (or the ‚Äúobjective function‚Äù in the common terminology) and the function F generating the new state. <br>  As we strive to minimize the distance, it will be ‚Äúenergy‚Äù.  Therefore, our objective function will be as follows: <br><br><div style="text-align:center;"><img src="http://habrastorage.org/storage3/fd1/2d0/aec/fd12d0aec9f4af29c2de5286e809feb9.gif"></div><br><br>  It says nothing more than the sum of the <a href="http://ru.wikipedia.org/wiki/%25C5%25E2%25EA%25EB%25E8%25E4%25EE%25E2%25E0_%25EC%25E5%25F2%25F0%25E8%25EA%25E0" title="Euclidean metric">Euclidean distances</a> between pairs of cities in the route <img src="http://habrastorage.org/storage3/40b/d8d/059/40bd8d059560f056ccfe25a35f0db609.gif">  .  Since the task is closed, we were forced to sign <img src="http://habrastorage.org/storage3/f7c/3dd/130/f7c3dd130eceefa694739a437fad15db.gif">  at the end, this is the distance between the last and the first city.  If you do not go deep, then Euclidean is the very distance between points that we all went through in geometry lessons.  It is given by the following formula: <br><br><div style="text-align:center;"><img src="http://habrastorage.org/storage3/2d7/95a/ebb/2d795aebb28ef275dc0a6c673c45a0e6.gif"></div><br><br>  Where <img src="http://habrastorage.org/storage3/d25/361/221/d253612219d26ccd1b5d13433ee2d18a.gif"><br><br>  Now let's think about how we get a new state?  The first thing that comes to mind is to swap two arbitrary cities in the route.  The idea is correct, but such a change unpredictably affects <img src="http://habrastorage.org/storage3/343/f90/43f/343f9043f373172f510a0cff5ff064b6.gif">  , the method will work for a long time and not the fact that it is successful. <br><br>  A good option in this case would be to choose two arbitrary cities in the route and invert the path between them.  For example, we had a route (1,2,3,4,5,6,7).  The random number generator chose cities 2 and 7, we performed the procedure and got (1,7,6,5,4,3,2). <br><br>  Below is the code for function F: <br><pre> <code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[ seq ]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateStateCandidate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(seq)</span></span></span><span class="hljs-function"> %</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">seq</span></span></span><span class="hljs-function"> -   </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">,   %   - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">n</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(seq,1)</span></span></span><span class="hljs-function">; %    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">randi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n,1)</span></span></span><span class="hljs-function">; %     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">j</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">randi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n, 1)</span></span></span><span class="hljs-function">;%     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i &gt; j)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">seq</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(j:i)</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flipud</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(seq(j:i)</span></span></span><span class="hljs-function">); %   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">seq</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i:j)</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flipud</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(seq(i:j)</span></span></span><span class="hljs-function">);%   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span></span></code> </pre><br><br>  Now we have everything we need, and we can start the optimization process.  But before we go to the most interesting, I will give the full program code.  I think it would be very interesting to compare it with the above pseudocode paragraph pair: <br><pre> <code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[ state ]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SimulatedAnnealing</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( cities, initialTemperature, endTemperature)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">n</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(cities,1)</span></span></span><span class="hljs-function">; %     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">state</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">randperm</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span><span class="hljs-function">; %   ,    %  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">randperm</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span><span class="hljs-function"> -        1  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">n</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currentEnergy</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CalculateEnergy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(state, cities)</span></span></span><span class="hljs-function">; %      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initialTemperature</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function"> = 1:100000 %      %          </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stateCandidate</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateStateCandidate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(state)</span></span></span><span class="hljs-function">; %  - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">candidateEnergy</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CalculateEnergy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(stateCandidate, cities)</span></span></span><span class="hljs-function">; %    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(candidateEnergy &lt; currentEnergy)</span></span></span><span class="hljs-function"> %      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currentEnergy</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">candidateEnergy</span></span></span><span class="hljs-function">; %      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">state</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stateCandidate</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">p</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetTransitionProbability</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(candidateEnergy-currentEnergy, T)</span></span></span><span class="hljs-function">; % ,   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MakeTransit(p)</span></span></span><span class="hljs-function">) %  ,    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currentEnergy</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">candidateEnergy</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">state</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stateCandidate</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DecreaseTemperature</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(initialTemperature, i)</span></span></span><span class="hljs-function"> ; %   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T &lt;= endTemperature)</span></span></span><span class="hljs-function"> %   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">break</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  As you can see, nothing complicated. <br><br><h4>  results </h4><br>  Since the algorithm has a probabilistic nature, the case can be ordered so that the ‚Äúannealing‚Äù will take, and even get stuck in a local minimum.  Therefore, it is worth making several launches and paying attention to what minimum value the results converge. <br><br>  The program started with <img src="http://habrastorage.org/storage3/6bd/7ce/e90/6bd7cee90c883948c8fca0114aaed232.gif">  = 10 and <img src="http://habrastorage.org/storage3/bd6/345/981/bd63459812ad62b344bc14a77876d19a.gif">  = 0.00001. <br><br>  The figure shows the state at the very first iteration.  It is unlikely that the salesman would have experienced great joy, we offer him such a route. <br><div style="text-align:center;"><img src="http://habrastorage.org/storage3/560/0cc/750/5600cc750af7c269bcc624d3841c5c56.png" width="500"></div><br><br>  The output result looks much nicer: <br><div style="text-align:center;"><img src="http://habrastorage.org/storage3/1db/b97/c2c/1dbb97c2c168e6356c494d263c391f0c.png" width="500"></div><br><br>  However, it is worth noting that in spite of the fact that the algorithm in the current implementation works quite efficiently (exactly much faster than exhaustive search), it is believed that much better time can be achieved without losing ‚Äúquality‚Äù.  To do this, I suggest you, as a practical task, experiment with the T function and share the results in the comments. <br><br>  Source codes can be downloaded <a href="http://yadi.sk/d/rO21sFCqGRmus">here</a> . <br><br>  I hope that the read turned out to be useful for you.  Constructive criticism is welcome. <br><br>  PS <br><br>  Taking this opportunity, I would like to thank Anna Antonova and Dmitry Ignatov, who read the article before publication and gave me some good advice. </div><p>Source: <a href="https://habr.com/ru/post/209610/">https://habr.com/ru/post/209610/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../209592/index.html">Modify, but verify: the role of web analytics in interface design</a></li>
<li><a href="../209594/index.html">Making hardware startups becomes easier.</a></li>
<li><a href="../209600/index.html">Surprise from the unknown: trust in Chrome extensions</a></li>
<li><a href="../209604/index.html">The existence of DOU.ua in the framework of the Ukrainian legal field is not possible</a></li>
<li><a href="../209606/index.html">The future of hardware accelerator programming</a></li>
<li><a href="../209612/index.html">Encrypted client-server communication on Laravel 4</a></li>
<li><a href="../209614/index.html">Begin courses "Universarium"</a></li>
<li><a href="../209616/index.html">Role-playing technology. Part 3. Technology in the entourage and mastering</a></li>
<li><a href="../209618/index.html">Why not use RJS</a></li>
<li><a href="../209624/index.html">Panorama of the Moon from "Chang'e 3" and the failure of the main color camera of the landing module</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>