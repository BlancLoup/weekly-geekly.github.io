<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to avoid injections</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Attacks to web systems are based on input processing bugs. Using various software vulnerabilities and developer inattention, a hacker can compile data...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to avoid injections</h1><div class="post__text post__text-html js-mediator-article">  Attacks to web systems are based on input processing bugs.  Using various software vulnerabilities and developer inattention, a hacker can compile data that will compromise the system during processing - shell, <a href="http://habrahabr.ru/blogs/infosecurity/120523/">unencrypted passwords</a> , and even emulation of user actions in the browser (for example, in the banking system will transfer money from the account). <br><br>  One of the popular attack vectors is various injections: html, javascript, sql.  Therefore, many reputable sources recommend shielding the user input through various spells.  In this post I will show one simple rule, following which you are guaranteed to solve the problem of injections. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/37b/2bf/f0d/37b2bff0ded0a558427171188c73f60f.jpg" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br>  The rule is simple: <b>Do not mix data formats!</b> <br><ul><li>  Do not assign strings of different formats: <br><pre><code class="cs hljs">lblName.Text = person.Name;</code> </pre>  <font color="red">Bad: HTML ‚Üê plain text</font> <br><br><pre> <code class="cs hljs">lblName.Text = HtmlEncode(person.Name);</code> </pre>  <font color="green">Good: HTML ‚Üê HTML</font> <br><br></li><li>  Do not connect lines of different formats: <br><pre> <code class="html hljs xml">"<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span>" + person.Name + "<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span>"</code> </pre>  <font color="red">Bad: HTML + Plain Text + HTML</font> <br><br><pre> <code class="html hljs xml">"<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span>" + HtmlEncode(person.Name) + "<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span>"</code> </pre>  <font color="green">Good: HTML + HTML + HTML</font> <br><br></li><li>  Be careful with nested formats: <br><pre> <code class="cs hljs">label.Text = <span class="hljs-string"><span class="hljs-string">"&lt;script&gt;"</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(script, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(summary, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(personUrl, id)) + <span class="hljs-string"><span class="hljs-string">"&lt;script&gt;"</span></span>;</code> </pre>  <font color="red">Bad: HTML + JavaScript + URI + Text + HTML</font> <br><br><pre> <code class="cs hljs">label.Text = <span class="hljs-string"><span class="hljs-string">"&lt;script&gt;"</span></span> + HtmlEncode(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(script, JavaScriptEncode(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(person.Summary, UrlEncode(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(personUrl, id)))))) + <span class="hljs-string"><span class="hljs-string">"&lt;/script&gt;"</span></span>;</code> </pre>  <font color="green">Good: HTML + HTML (JavaScript (URI (text)) + HTML</font> <br></li></ul><br><br><h5>  Format </h5><br>  All data has a format.  The simplest format is plain text where all characters are equal and carry no additional meaning.  Any other format based on textual data be it csv, html, javascript has control characters - commas, tags, specials.  characters.  With the above mixing formats, dangerous situations arise when one format is treated as another. <br>  For example, in ASP.NET for Label controls, the Text property is treated as HTML.  Therefore, if we assign this property a value in another format (for example, plain text), then we will open a potential HTML vulnerability.  That is why you need to use special adapters between formats that screen specials.  characters.  So the plain text to HTML adapter will turn the "&lt;script&gt;" into "&amp; lt; script &amp; gt;".  A plain-text URI adapter will turn ‚Äúexample.com?&lt;script&gt;alert('pwned '); &lt;/ script&gt;‚Äù into ‚Äúexample.com% 3F% 3Cscript% 3Ealert (' pwned ')% 3B% 3C% 2Fscript % 3E. <br>  Similar adapters exist in almost all languages ‚Äã‚Äãand platforms - .NET: <a href="httpserverutility.htmlencode.aspx">HtmlEncode</a> , <a href="httputility.urlencode.aspx">UrlEncode</a> , PHP: <a href="http://www.php.net/manual/en/function.htmlentities.php">htmlentities</a> , <a href="http://php.net/manual/en/function.urlencode.php">urlencode</a> , server-side JavaScript: <a href="http://xkr.us/articles/javascript/encode-compare/">escape, encodeURI &amp; encodeURIComponent</a> .  For an SQL query, it is sufficient to use parameterized queries that will be processed by the database itself. <br><br>  Here are 3 simple points that will make your life easier: <br><ul><li>  Know the format of the used text variables, properties, fields.  For convenience, you can add suffixes to the names: HeaderHtml, AvatarUrl. </li><li>  Make an adapter library: HtmlEncode, UrlEncode, JavaScriptEncode. </li><li>  Be careful when working with data in different formats. </li></ul><br><br>  <b>UPD: About PHP injection</b> <br>  In one of the discussions in this article, I was given the argument that my rule does not work with php injections.  I want to show that it works.  So, consider the banal code: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">include</span></span>($_GET[<span class="hljs-string"><span class="hljs-string">'path'</span></span>]);</code> </pre>  If I pass in the GET request "evil.php", then the script will safely launch the specified exploit.  Now consider this situation in the style of my rule.  From the <a href="http://php.net/manual/en/function.include.php">description</a> it is clear that the include function expects a file path in the format of the current file system or a URI.  And the content format of $ _GET ['path'] is plain text.  How to avoid injections?  Write pathEncode which will lead this text to the correct format of the path, or if it is impossible, it will return an empty string (for example, it will check the white list of allowed paths).  In this case <pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">include</span></span>(pathEncode($_GET[<span class="hljs-string"><span class="hljs-string">'path'</span></span>]));</code> </pre>  or it will crash with an exepshin or load the file.  The main thing to clearly understand what format expects include and what format comes from the user. </div><p>Source: <a href="https://habr.com/ru/post/122304/">https://habr.com/ru/post/122304/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../122295/index.html">Search for Hamiltonian paths using a membrane system in polynomial time</a></li>
<li><a href="../122296/index.html">VKontakte added public lists of friends</a></li>
<li><a href="../122297/index.html">Suggestion: field for references to used sources of information</a></li>
<li><a href="../122301/index.html">Interactive demonstration of "Tanks Online 2.0" on Alternativa3D 8 under Molehill</a></li>
<li><a href="../122302/index.html">Foursquare has passed for 10.000.000</a></li>
<li><a href="../122308/index.html">Fuse4X - the standard implementation of the Fuse API for MacOSX</a></li>
<li><a href="../122310/index.html">AMD Fusion 11 Developer Summit - as it was, Part 1</a></li>
<li><a href="../122311/index.html">‚ÄúI am an ordinary stylus for capacitive screens‚Äù</a></li>
<li><a href="../122313/index.html">42th edition of Russian Full Circle Magazine</a></li>
<li><a href="../122315/index.html">I trade online. When is the time for me to go real?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>