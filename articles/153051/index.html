<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Play on QuickTiGame2d in Appcelerator Titanium. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the first part of this article " Playing on QuickTiGame2d in Appcelerator Titanium. Part 1 " I told about some points of working with the engine th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Play on QuickTiGame2d in Appcelerator Titanium. Part 2</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/974/e1a/dac/974e1adac6932b2187cced536b5d693b.png"><br>  In the first part of this article " <a href="http://habrahabr.ru/company/ruswizards/blog/149812/">Playing on QuickTiGame2d in Appcelerator Titanium. Part 1</a> " I told about some points of working with the engine that, in my opinion, will be useful to those who are going to read this publication.  Now I propose to consider the creation of the simplest game on Appcelerator Titanium. <br><a name="habracut"></a><br>  The essence of the game is that from the letters that appear, you need to collect the word "TITANIUM", after which a corresponding message about the victory will be displayed and the game will be over. <br><br>  First, create the file pathsToFiles.js, in which we assign the paths to the available resources: <br><br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//menuScene var pngMenuBackground = "pictures/menu/background.png"; var pngButtonNewGame = "pictures/menu/newGame.png"; var pngButtonHelp = "pictures/menu/help.png"; //helpScene var pngHelp = "pictures/help/help.png"; var pngBackFromHelp = "pictures/help/back.png"; //mainLoadingScene var pngMainBackground = "pictures/game/background.png"; var pngBackToMenu = "pictures/game/back.png"; var pngVictory = "pictures/game/victory.png"; var xmlCharactersPosition = "pictures/game/charactersPosition.xml"; //sound var soundClick = "sound/click.wav";</span></span></code> </pre> <br>  First of all, let's turn to the app.js file.  Let's create the game screen, connect the js files with which we will work, and also describe the screen layout for Android and iOS: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-built_in"><span class="hljs-built_in">window</span></span> = Ti.UI.createWindow({ <span class="hljs-attr"><span class="hljs-attr">backgroundColor</span></span> : <span class="hljs-string"><span class="hljs-string">'black'</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> quicktigame2d = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'com.googlecode.quicktigame2d'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> game = quicktigame2d.createGameView(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Titanium.Platform.osname === <span class="hljs-string"><span class="hljs-string">'android'</span></span>) { game.orientation = Ti.UI.LANDSCAPE_LEFT; <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.orientationModes = [Titanium.UI.LANDSCAPE_LEFT]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { game.orientation = Ti.UI.LANDSCAPE_RIGHT; <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.orientationModes = [Titanium.UI.LANDSCAPE_RIGHT]; } Ti.include(<span class="hljs-string"><span class="hljs-string">'pathsToFiles.js'</span></span>); Ti.include(<span class="hljs-string"><span class="hljs-string">'helpScene.js'</span></span>); Ti.include(<span class="hljs-string"><span class="hljs-string">'menuScene.js'</span></span>); Ti.include(<span class="hljs-string"><span class="hljs-string">'mainScene.js'</span></span>);</code> </pre><br>  Next, we calculate the required scale of the game for the device, initialize the loaded scenes, which will be described below, add the game screen to the application window, open it and launch MenuScene. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> WINDOW_SCALE_FACTOR_X = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> WINDOW_SCALE_FACTOR_Y = <span class="hljs-number"><span class="hljs-number">1</span></span>; game.addEventListener(<span class="hljs-string"><span class="hljs-string">'onload'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> screenScale = game.size.height / <span class="hljs-number"><span class="hljs-number">640</span></span>; game.screen = { <span class="hljs-attr"><span class="hljs-attr">width</span></span> : game.size.width / screenScale, <span class="hljs-attr"><span class="hljs-attr">height</span></span> : game.size.height / screenScale }; WINDOW_SCALE_FACTOR_X = game.screen.width / game.size.width; WINDOW_SCALE_FACTOR_Y = game.screen.height / game.size.height; MenuScene.init(); HelpScene.init(); MainScene.init(); game.pushScene(MenuScene.scene); game.start(); }); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.add(game); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.open({ <span class="hljs-attr"><span class="hljs-attr">fullscreen</span></span> : <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">navBarHidden</span></span> : <span class="hljs-literal"><span class="hljs-literal">true</span></span> });</code> </pre><br>  Now let's create MenuScene for the game.  To begin, create it directly: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> buttonMargin = <span class="hljs-number"><span class="hljs-number">20</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> clickSound = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> MenuScene = { <span class="hljs-attr"><span class="hljs-attr">scene</span></span> : <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">background</span></span> : <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">buttonNewGame</span></span> : <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">buttonHelp</span></span> : <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">init</span></span> : <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scene = quicktigame2d.createScene(); ... }, };</code> </pre><br>  Here buttonMargin is the indent that will be used later, and clickSound is a variable for storing sound. <br><br>  Now it‚Äôs worth adding some actions.  Run the current scene when loading sprites: <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> onloadsprite = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">self</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.name == pngButtonHelp) { game.startCurrentScene(); } }; })(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>);</code> </pre><br>  We describe the events of clicking on the "New game" and "Help" buttons.  When you press and when you release the button, its picture will change. Also, when pressed, a short sound will be produced, and if you ‚Äúrelease‚Äù, the game scene will be changed to the selected one: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> touchstart = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">self</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = ex * WINDOW_SCALE_FACTOR_X; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> y = ey * WINDOW_SCALE_FACTOR_Y; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (self.buttonNewGame.contains(x, y)) { self.buttonNewGame.frame = <span class="hljs-number"><span class="hljs-number">0</span></span>; clickSound.play(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (self.buttonHelp.contains(x, y)) { self.buttonHelp.frame = <span class="hljs-number"><span class="hljs-number">0</span></span>; clickSound.play(); } } })(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> touchend = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">self</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = ex * WINDOW_SCALE_FACTOR_X; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> y = ey * WINDOW_SCALE_FACTOR_Y; self.buttonNewGame.frame = <span class="hljs-number"><span class="hljs-number">1</span></span>; self.buttonHelp.frame = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (self.buttonNewGame.contains(x, y)) { game.pushScene(MainScene.scene); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (self.buttonHelp.contains(x, y)) { game.pushScene(HelpScene.scene); } }; })(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>);</code> </pre><br>  Now we initialize the variables and set the coordinates of the buttons and the game menu background.  Add the relevant elements to the scene, as well as event listeners: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> activated = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">self</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (clickSound == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { clickSound = Ti.Media.createSound({ <span class="hljs-attr"><span class="hljs-attr">url</span></span> : soundClick }); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (self.background == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { self.background = quicktigame2d.createSprite({ <span class="hljs-attr"><span class="hljs-attr">image</span></span> : pngMenuBackground }); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (self.buttonNewGame == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { self.buttonNewGame = quicktigame2d.createSpriteSheet({ <span class="hljs-attr"><span class="hljs-attr">image</span></span> : pngButtonNewGame, <span class="hljs-attr"><span class="hljs-attr">width</span></span> : <span class="hljs-number"><span class="hljs-number">275</span></span>, <span class="hljs-attr"><span class="hljs-attr">height</span></span> : <span class="hljs-number"><span class="hljs-number">100</span></span> }); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (self.buttonHelp == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { self.buttonHelp = quicktigame2d.createSpriteSheet({ <span class="hljs-attr"><span class="hljs-attr">image</span></span> : pngButtonHelp, <span class="hljs-attr"><span class="hljs-attr">width</span></span> : <span class="hljs-number"><span class="hljs-number">275</span></span>, <span class="hljs-attr"><span class="hljs-attr">height</span></span> : <span class="hljs-number"><span class="hljs-number">100</span></span> }); } self.background.x = (game.screen.width * <span class="hljs-number"><span class="hljs-number">0.5</span></span>) - (self.background.width * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); self.background.y = (game.screen.height * <span class="hljs-number"><span class="hljs-number">0.5</span></span>) - (self.background.height * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); self.buttonNewGame.x = (game.screen.width - self.buttonNewGame.width) / <span class="hljs-number"><span class="hljs-number">4</span></span>; self.buttonNewGame.y = (game.screen.height * <span class="hljs-number"><span class="hljs-number">0.8</span></span>); self.buttonHelp.x = (game.screen.width - self.buttonNewGame.width) / <span class="hljs-number"><span class="hljs-number">4</span></span>*<span class="hljs-number"><span class="hljs-number">3</span></span>; self.buttonHelp.y = self.buttonNewGame.y; self.buttonNewGame.frame = <span class="hljs-number"><span class="hljs-number">1</span></span>; self.buttonHelp.frame = <span class="hljs-number"><span class="hljs-number">1</span></span>; self.scene.add(self.background); self.scene.add(self.buttonNewGame); self.scene.add(self.buttonHelp); game.addEventListener(<span class="hljs-string"><span class="hljs-string">'touchstart'</span></span>, touchstart); game.addEventListener(<span class="hljs-string"><span class="hljs-string">'touchend'</span></span>, touchend); self.scene.addEventListener(<span class="hljs-string"><span class="hljs-string">'enterframe'</span></span>, enterframe); }; })(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>);</code> </pre><br>  We describe the function of deleting all created elements (unloading textures, deleting event listeners): <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> deactivated = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dea</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">self</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ self.scene.remove(self.background); self.background = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; self.scene.remove(self.buttonNewGame); self.scene.remove(self.buttonHelp); self.buttonNewGame = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; self.buttonHelp = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; game.unloadTexture(pngButtonNewGame); game.unloadTexture(pngButtonHelp); game.removeEventListener(<span class="hljs-string"><span class="hljs-string">'touchstart'</span></span>, touchstart); game.removeEventListener(<span class="hljs-string"><span class="hljs-string">'touchend'</span></span>, touchend); }; })(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>);</code> </pre><br>  It remains only to add listeners of events for activating / deactivating scenes and loading sprites: <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scene.addEventListener(<span class="hljs-string"><span class="hljs-string">'activated'</span></span>, activated); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scene.addEventListener(<span class="hljs-string"><span class="hljs-string">'deactivated'</span></span>, deactivated); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scene.addEventListener(<span class="hljs-string"><span class="hljs-string">'onloadsprite'</span></span>, onloadsprite);</code> </pre><br>  Scene menu is ready.  We turn to the scene Help.  In principle, all the processes of loading and unloading elements are very similar, so we will not repeat and consider the elements that are most interesting to us.  One of them is to create a background help: <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (self.background == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { self.background = quicktigame2d.createSprite({ <span class="hljs-attr"><span class="hljs-attr">image</span></span> : pngMenuBackground }); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (self.menuLayer == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { self.menuLayer = quicktigame2d.createSprite({ <span class="hljs-attr"><span class="hljs-attr">width</span></span> : self.background.width, <span class="hljs-attr"><span class="hljs-attr">height</span></span> : self.background.height }); self.menuLayer.color(<span class="hljs-number"><span class="hljs-number">0.5</span></span>, <span class="hljs-number"><span class="hljs-number">0.5</span></span>, <span class="hljs-number"><span class="hljs-number">0.5</span></span>); self.menuLayer.alpha = <span class="hljs-number"><span class="hljs-number">0.78</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (self.foreground == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { self.foreground = quicktigame2d.createSpriteSheet({ <span class="hljs-attr"><span class="hljs-attr">image</span></span> : pngHelp, <span class="hljs-attr"><span class="hljs-attr">width</span></span> : <span class="hljs-number"><span class="hljs-number">960</span></span>, <span class="hljs-attr"><span class="hljs-attr">height</span></span> : <span class="hljs-number"><span class="hljs-number">640</span></span> }); }</code> </pre><br>  Here we load 3 background layers.  One of them is a layer in the menu, it will be the bottom.  We set the second background on top (it has color and transparency).  The third is the text layer.  We define it as SpriteSheet to use multiple images for it. <br><br>  We describe the location of the button in the corner of the screen relative to its size: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (game.screen.width &gt; self.background.width) { self.okButton.x = self.background.x + self.background.width - self.okButton.width - buttonMargin; self.okButton.y = self.background.y + self.background.height - self.okButton.height - buttonMargin; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { self.okButton.x = game.screen.width - self.okButton.width - buttonMargin; self.okButton.y = game.screen.height - self.okButton.height - buttonMargin; }</code> </pre><br>  And add a text background animation: <br><br><pre> <code class="javascript hljs">self.foreground.animate(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2000</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>);</code> </pre><br>  We now turn to creating a scene for the game process.  It is worth creating a few variables: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> COUNT_OF_CHARACTERS = <span class="hljs-number"><span class="hljs-number">9</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> word = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> wordTitanium = <span class="hljs-string"><span class="hljs-string">"titanium"</span></span>;</code> </pre><br>  Where COUNT_OF_CHARACTERS is the number of places on the field for the appearance of letters, word is the assembled word, wordTitanium is the word to be collected. <br><br>  In the activated function, add the process of creating an array of elements with images of letters: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xCoef = self.background.width / <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> yCoef = self.background.height / <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xParam = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> yParam = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; COUNT_OF_CHARACTERS; i++) { self.characters[i] = quicktigame2d.createSpriteSheet({ <span class="hljs-attr"><span class="hljs-attr">image</span></span> : xmlCharactersPosition }); self.characters[i].x = self.background.x + xCoef * xParam; self.characters[i].y = self.background.x + yCoef * yParam; xParam++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xParam &gt; <span class="hljs-number"><span class="hljs-number">3</span></span>) { xParam = <span class="hljs-number"><span class="hljs-number">1</span></span>; yParam++; } self.characters[i].z = <span class="hljs-number"><span class="hljs-number">3</span></span>; self.characters[i].hide(); self.characters[i].index = i; self.characters[i].status = <span class="hljs-string"><span class="hljs-string">"waiting"</span></span>; self.characters[i].selectFrame(<span class="hljs-string"><span class="hljs-string">"character0"</span></span>); self.scene.add(self.characters[i]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (self.charactersTransforms[i] == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { self.charactersTransforms[i] = quicktigame2d.createTransform(); self.charactersTransforms[i].addEventListener(<span class="hljs-string"><span class="hljs-string">'complete'</span></span>, oncharactersCompleted); self.charactersTransforms[i].index = i; } }</code> </pre><br>  Here we set the location for each element, hide it, set the status, the current image.  It also sets its own event listener for each element.  The event listener will look like this: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> oncharactersCompleted = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">self</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> transform = e.source; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> choosenCharacter = self.characters[transform.index]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (choosenCharacter != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (choosenCharacter.status == <span class="hljs-string"><span class="hljs-string">"moving"</span></span>) { choosenCharacter.show(); choosenCharacter = changeStatus(choosenCharacter, transform, <span class="hljs-string"><span class="hljs-string">"living"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (choosenCharacter.status == <span class="hljs-string"><span class="hljs-string">"living"</span></span>) { choosenCharacter = changeStatus(choosenCharacter, transform, <span class="hljs-string"><span class="hljs-string">"dying"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (choosenCharacter.status == <span class="hljs-string"><span class="hljs-string">"dying"</span></span>) { choosenCharacter = changeStatus(choosenCharacter, transform, <span class="hljs-string"><span class="hljs-string">"hiding"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (choosenCharacter.status == <span class="hljs-string"><span class="hljs-string">"hiding"</span></span>) { transform.scale(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); choosenCharacter = changeStatus(choosenCharacter, transform, <span class="hljs-string"><span class="hljs-string">"queue_waiting"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (choosenCharacter.status == <span class="hljs-string"><span class="hljs-string">"queue_waiting"</span></span>) { choosenCharacter.hide(); choosenCharacter.status = <span class="hljs-string"><span class="hljs-string">"waiting"</span></span>; transform.duration = <span class="hljs-number"><span class="hljs-number">1000</span></span>; choosenCharacter.transform(transform); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (choosenCharacter.status == <span class="hljs-string"><span class="hljs-string">"killed"</span></span>) { transform.rotate(<span class="hljs-number"><span class="hljs-number">-360</span></span>); transform.scale(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); choosenCharacter = changeStatus(choosenCharacter, transform, <span class="hljs-string"><span class="hljs-string">"queue_waiting"</span></span>); } } }; })(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">changeStatus</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">choosenCharacter, transform, statuscharacter</span></span></span><span class="hljs-function">) </span></span>{ transform.duration = <span class="hljs-number"><span class="hljs-number">2000</span></span>; choosenCharacter.status = statuscharacter; choosenCharacter.transform(transform); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> choosenCharacter; }</code> </pre><br>  Here, depending on the status of the element, various kinds of actions will occur with it: rotation, zooming, hiding and appearing on the screen. <br><br>  Add a method to complete the game, in which we remove the text in the already typed word, and also add to the scene the information that the player won, which in turn will cause the event listener victoryText: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">finishActivity</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">self</span></span></span><span class="hljs-function">) </span></span>{ word = <span class="hljs-string"><span class="hljs-string">""</span></span>; self.scene.add(self.victoryText); self.victoryTextTransform.duration = <span class="hljs-number"><span class="hljs-number">1000</span></span>; self.victoryText.transform(self.victoryTextTransform); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> onVictoryTextCompleted = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">self</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (self.victoryTextTransform.completed) { self.scene.remove(self.victoryText); closeGame(self); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { self.victoryTextTransform.y = game.screen.height; self.victoryTextTransform.completed = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; self.victoryText.transform(self.victoryTextTransform); } }; })(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>);</code> </pre><br>  In the enterframe should add the process of changing letters in the relevant elements.  This will happen with the waiting status: elements will appear on the screen with a letter randomly created for them. <br><br><pre> <code class="javascript hljs">self.charactersTransforms[i].show(); self.charactersTransforms[i].scale(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); self.charactersTransforms[i].duration = <span class="hljs-number"><span class="hljs-number">500</span></span>; self.charactersTransforms[i].delay = <span class="hljs-number"><span class="hljs-number">0</span></span>; self.charactersTransforms[i].easing = quicktigame2d.ANIMATION_CURVE_CUBIC_IN; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> face = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor((randomNumber * <span class="hljs-number"><span class="hljs-number">100</span></span>) % <span class="hljs-number"><span class="hljs-number">8</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> count = <span class="hljs-number"><span class="hljs-number">0</span></span>; count &lt; wordTitanium.length; count++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (face == count) { self.characters[i] = addDataToWord(self.characters[i], self.charactersTransforms[i], <span class="hljs-string"><span class="hljs-string">"character"</span></span>+count, wordTitanium[count]); self.characters[i].transform(self.charactersTransforms[i]); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } }</code> </pre><br>  where the addDataToWord function is: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addDataToWord</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">choosenCharacter, choosenCharacterTransform, frame, symbol</span></span></span><span class="hljs-function">) </span></span>{ choosenCharacter.isMoving = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; choosenCharacter.faceName = frame; choosenCharacter.symbol = symbol; choosenCharacter.status = <span class="hljs-string"><span class="hljs-string">"moving"</span></span>; choosenCharacter.selectFrame(frame); choosenCharacterTransform.duration = <span class="hljs-number"><span class="hljs-number">0</span></span>; choosenCharacter.transform(choosenCharacterTransform); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> choosenCharacter; }</code> </pre><br>  The last thing left to do is to register the function of clicking on the element: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dblclick = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">self</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = ex * WINDOW_SCALE_FACTOR_X; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> y = ey * WINDOW_SCALE_FACTOR_Y; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!self.loaded) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!self.started) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; COUNT_OF_CHARACTERS; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (self.characters[i].status != <span class="hljs-string"><span class="hljs-string">"killed"</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (self.characters[i].contains(x, y)) { clickSound.play(); self.charactersTransforms[i].rotate(<span class="hljs-number"><span class="hljs-number">360</span></span>); self.charactersTransforms[i].duration = <span class="hljs-number"><span class="hljs-number">2000</span></span>; self.characters[i].transform(self.charactersTransforms[i]); self.characters[i].status = <span class="hljs-string"><span class="hljs-string">"killed"</span></span>; word += self.characters[i].symbol; Ti.API.info(word); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (wordTitanium.indexOf(word) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { Ti.API.info(word + <span class="hljs-string"><span class="hljs-string">" "</span></span> + wordTitanium); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(wordTitanium.length == word.length){ finishActivity(self); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { word = <span class="hljs-string"><span class="hljs-string">""</span></span>; } } } } }; })(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>);</code> </pre><br>  At the same time, we change its status, add animation and check for the occurrence of this letter in the order of the letters in the corresponding word. <br><br>  The result is: <br><br><img src="http://habrastorage.org/storage2/93c/2d4/87e/93c2d487ebc81155850f6e1361b9ed92.png"><br><br><img src="http://habrastorage.org/storage2/06d/e51/552/06de51552680967328be56e083978f05.png"><br><br><img src="http://habrastorage.org/storage2/10e/62a/1b9/10e62a1b900c6fd0d829b48417a4ab68.png"><br><br><img src="http://habrastorage.org/storage2/fdb/127/155/fdb127155f771ac6ce32a73d53459009.png"><br><br><img src="http://habrastorage.org/storage2/f84/c42/1cf/f84c421cfbf30860f9336f6a9493e9e3.png"></div><p>Source: <a href="https://habr.com/ru/post/153051/">https://habr.com/ru/post/153051/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../153041/index.html">A couple of problems with YAC 2012</a></li>
<li><a href="../153043/index.html">Twitter Bootstrap in the style of Windows 8</a></li>
<li><a href="../153045/index.html">New Yandex.Store - what, why and why</a></li>
<li><a href="../153047/index.html">American freak offers kits for implanting a RFID chip under the skin</a></li>
<li><a href="../153049/index.html">Watir WebDriver as a test automation tool</a></li>
<li><a href="../153053/index.html">30 years old cd</a></li>
<li><a href="../153055/index.html">Simplify working with oDesk</a></li>
<li><a href="../153057/index.html">CSS principles</a></li>
<li><a href="../153059/index.html">Installing node.js on a VPS</a></li>
<li><a href="../153061/index.html">Google surpassed Microsoft by capitalization</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>