<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Docker Volume plugin for Nutanix on AOS 4.7</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I already briefly mentioned that a feature appeared in Nutanix in July, which we called Acropolis Container Services, and its first use - Docker infra...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Docker Volume plugin for Nutanix on AOS 4.7</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/725/e34/773/725e3477381841b698d0241ae77f4ede.png"><br><br>  I already <a href="https://habrahabr.ru/company/nutanix/blog/304156/">briefly mentioned</a> that a feature appeared in Nutanix in July, which we called Acropolis Container Services, and its first use - Docker infrastructure support on the Nutanix cluster, in our own free hypervisor AHV (Acropolis Hypervisor, fork and deep modification of KVM ). <br>  I will not talk about what is a Docker, there is a <a href="https://habrahabr.ru/post/253877/">good article</a> on Habr√©.  And why Nutanix took up container virtualization better than a thousand words will say one picture, which I, while writing this article, did in Google Trends. <br><a name="habracut"></a><br><img src="https://habrastorage.org/files/db0/934/344/db093434422c4ddfb0d1454dc7717895.png"><br><br>  But why do we need to cut special support for containers and data volumes and integration with Docker?  This is clear to those who have already tried to implement Docker in production. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The fact is that after a couple of days of experiments and showdowns it works for Test / Dev, it is extremely capricious when transferred to serious production.  And above all, this is a problem with stateless data containers. <br><br>  Beginners who are familiar with Docker, and who are thinking about the practical use of container virtualization "in battle", immediately have a whole bunch of questions for Docker (and the Docker guru): <br><br><ul><li>  How to ensure data persistence when using containers? </li><li>  Where to write logs of all my containers? </li><li>  How to deploy Docker image on hundreds of machines? </li><li>  How to quickly roll back if the next push on these machines was unsuccessful? </li><li>  What with automatic builds and tests in containers? </li><li>  How to provide interaction between containers? </li><li>  How to collect application metrics in containers? </li></ul><br>  ... and many, many <a href="http://www.heavybit.com/library/blog/realities-of-docker-in-production/">other questions</a> . <br>  But one of the most important is the persistence of storing data in containers. <br><br>  In contrast to the already familiar to most "virtual machines", containers are transient objects, as well as storage related to them.  When you restart the Docker container, you lose all the data that was changed in the previously running container. <br>  Why this is so is related to how the Docker architecture is designed.  It is based on the so-called <a href="http://12factor.net/">‚Äú12-factor‚Äù</a> , a development pattern that originally appeared in Heroku, which was one of the first PaaS providers.  This scheme declares that the state of the application must be separate from the application itself, in a separate repository.  This works great for front-end applications that do not have a problem losing their state, since they are stateless by nature, but for the rest there is a serious difficulty.  How to deal with application logs, web server cache or SSH keys? <br>  How to share data between different containers, or between a host and containers? <br><br>  Usually in all such cases, it is common practice to use third-party disk-mounted disk volumes located on the host.  But in this case, the containers become dependent on the operation of the host, and Single Point of Failure is potentially created, since the loss of the host automatically means the loss of data in the volume mounted on this host for all applications using it in containers.  Containers restart is not a problem, but the volume with the data on the host will be lost. <br><br>  It should also be remembered that the disk I / O performance in the container is rather low, so Docker itself recommends using Volumes for high-performance applications. <br>  By default, containers use UnionFS to implement copy-on-write behavior for data, something that allows us to use git-like behavior for our changes to the container.  However, if we need to get maximum disk I / O performance for applications, and storage persistence, regardless of the container, you need to use Docker Volume. <br><br>  Starting with version 1.8 of Docker, the concept of a volume plugin has appeared, with which you can interact between the Docker and the repository API.  This was the first attempt to organize the integration between Docker and the repository, but everything was implemented extremely spartan.  Starting with version 1.9, so-called named volumes have appeared, with which it has become possible to interact with volumes as separate named entities, instead of managing them from within the container. <br><br>  Using these new features, Nutanix has written tools that make it more convenient to use Nutanix systems as a platform for Docker infrastructure and ‚Äúcontainer virtualization‚Äù in general in production. <br><br>  For this were created: <br><br>  <b>The Docker Machine Driver</b> is a provisioning tool that allows you to create Docker hosts on your local computer, from a cloud provider, or inside your own data center.  He creates servers, installs the Docker Engine on them and configures the Docker client to work with them.  Docker Machine Support for Docker Machine for Docker Engine for VMs with docker-machine cli commands. <br><br>  <b>Docker Volume Plugin</b> - allows Docker Engine deployment tools to integrate with external storage and create persistent volumes for application data. <br><br>  Well, now that we mention it below and use it: <br>  <b>Docker Datacenter (UCP)</b> is a Docker control solution that allows volume plugin users to use Nutanix DSF as Persistent Storage. <br>  In the Acropolis OS 4.7 version, container management is implemented only through the CLI, but in the Asterix release (4.8) it will be integrated into the Prism GUI. <br><br>  Now we have the opportunity to provide highly accessible, conveniently mounted storage for containers, which are located separately from the containers and docker hosts. <br><br>  Starting with Acrpolis OS 4.7 in DSF (Distributed Storage Fabric, our distributed cluster file system, we called it NDFS earlier), support for these Docker mechanisms listed above has appeared. <br><br>  Nutanix Acropolis DSF Volume driver is written in Go, and works as a Docker Volume extension.  It acts as an intermediate sidekick-container.  The Nutanix Acropolis DSF Volume plugin forwards a link to the DSF via the iSCSI Volume Groups mechanism, which provides access from the container in DSF bypassing the hypervisor and eliminating access overheads. <br><br><img src="https://habrastorage.org/files/7e4/bbf/334/7e4bbf3343f14b8381087714981b8a8c.png"><br><br>  The consequence of this is that even losing a container or host, you do not lose access to the volume data.  Moreover, since we follow the principle of data locality, when you move a container, after it will move through the Nutanix cluster and its data. <br>  All of the above is a completely native implementation on our platform that does not require third-party solutions. <br><br>  Using the Nutanix platform with the Acropolis DSF Volume plugin for Docker and the Docker Machine Driver to deploy the Docker infrastructure, you get the native integration of the Nutanix platform with the Docker API, you can take full advantage of data storage in the Nutanix storage, such as transparency, deduplication, compression, snapshots for data replication, both synchronous and asynchronous.  You get the highest disk I / O performance for your applications. <br>  Last but not least, all this is installed and working quickly and easily, including the support by our forces of online technical support. <br><br>  Here is how it works in the form of a small ten-minute screencast (do not forget to enable HD in the Youtube settings!): <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/2GhNMB0G8OQ%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjkmZxKtlJyi1va5546RrjfQ-lfrQ" frameborder="0" allowfullscreen=""></iframe><br><br>  By the way, it is possible that you can try it live already on Nutanix CE. </div><p>Source: <a href="https://habr.com/ru/post/306580/">https://habr.com/ru/post/306580/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../306566/index.html">How we made the converter and player for CinemaDNG to CUDA</a></li>
<li><a href="../306568/index.html">Learning machines - fun stuff: modern face recognition with deep learning</a></li>
<li><a href="../306570/index.html">Low cost VDS hosting in Russia and its technical support</a></li>
<li><a href="../306572/index.html">iOS 10: Notification Content Extension</a></li>
<li><a href="../306574/index.html">Study: What will happen if you tell users how you target advertising?</a></li>
<li><a href="../306582/index.html">Rust: & and ref in patterns</a></li>
<li><a href="../306584/index.html">Node.js and JavaScript instead of the old web</a></li>
<li><a href="../306586/index.html">Rating of countries in which it is more favorable to deploy a server farm</a></li>
<li><a href="../306588/index.html">Our development centers around the country with "teleports" to any city</a></li>
<li><a href="../306590/index.html">Fast TCP Sockets on Erlang</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>