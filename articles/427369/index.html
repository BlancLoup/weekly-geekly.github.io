<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Conference BLACK HAT USA. How a Hollywood hacker uses surveillance cameras. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Conference BLACK HAT USA. How a Hollywood hacker uses surveillance cameras. Part 1 

 We can also use this error to get or replace the encrypted admin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Conference BLACK HAT USA. How a Hollywood hacker uses surveillance cameras. Part 2</h1><div class="post__text post__text-html js-mediator-article"> <a href="https://habr.com/company/ua-hosting/blog/427367/">Conference BLACK HAT USA.</a>  <a href="https://habr.com/company/ua-hosting/blog/427367/">How a Hollywood hacker uses surveillance cameras.</a>  <a href="https://habr.com/company/ua-hosting/blog/427367/">Part 1</a> <br><br>  We can also use this error to get or replace the encrypted admin password stored in / etc / privpasswd. <br><br><img src="https://habrastorage.org/webt/_o/vj/ks/_ovjkseaaz-oy3lfadexjrvtsho.jpeg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We can extract content from this file.  As you can see, it contains the username root and an encrypted password. <br><br><img src="https://habrastorage.org/webt/ks/xi/wf/ksxiwfxwvunaektxeno1idlc1zq.jpeg"><br><br>  At the moment we have 2 options: you can try to decrypt the password using a tool such as John the Ripper: <br><br><img src="https://habrastorage.org/webt/7o/ua/hh/7ouahhpqja4nntiipe4xe9g5of8.jpeg"><br><br>  If it doesn‚Äôt work, damn it - we have root, and we just overwrite this file.  In any case, we get access to the "admin", and just as in the case of the previous camera, we will again have the rights of both the administrator and the root user. <br><br><img src="https://habrastorage.org/webt/oq/sk/_v/oqsk_vcpqjfpb7t7u0gr4if3oey.jpeg"><br><br>  These vulnerabilities are present in most IQ InVision cameras, including Series 3 and Series 7, Sentinel, Alliance-Pro, Alliance-MX and Alliance-Mini series.  I will not list all the models, otherwise I will stay here forever, the entire list of these cameras is available on the Internet in the Shodan Dork list.  The sad thing is that, as you know, the cameras of this manufacturer are widely used in schools, police stations, banks, casinos, financial and consulting companies, the DHL service and so on. <br><br>  I looked that today the most expensive camera is the model N5072 of 3SVision.  Her price is indicated by the phrase "Contact us", so I immediately realized that I could not afford it.  I had some problems with this camera, because for all the other cameras I could just go to the manufacturer‚Äôs site, download the firmware and analyze the code for vulnerabilities.  I did not need to buy a device, at least in order to conduct initial testing. <a name="habracut"></a><br><br><img src="https://habrastorage.org/webt/vj/fm/gw/vjfmgwkf2nz-2h4ce9dm_f8mifu.jpeg"><br><br>  But when I went to the manufacturer‚Äôs website to download the firmware for this camera, a JavaScript pop-up window appeared in front of me asking me to enter my password.  I immediately tried all the most common passwords: love, sex, god, but it did not work.  But, in the end, the password tab = 4 worked.  And you know why?  Because if you look at the JavaScript that sends the password back to the server, I don‚Äôt even need to explain what you see there (laughter in the hall), it‚Äôs just great. <br><br><img src="https://habrastorage.org/webt/za/aa/l-/zaaal-1foxxhd6ixwdsz_pzrb2s.jpeg"><br><br>  Until you get the correct password, you are simply redirected to the current URL with an ampersand tab = 4 at the end of the line.  Since I am literate enough to understand what it is, I entered this thing as a password and went to the firmware download page. <br><br>  Such an approach does not bode well for the security of their system.  The fact that they use the custom httpd web server in the firmware looks pretty innocuous, but if you look at the lines in this binary file, you will notice that they are all fine tuned. <br><br><img src="https://habrastorage.org/webt/eq/ny/14/eqny14l2qobedn2cxg_gs4eanuo.jpeg"><br><br>  So I decided that since this looks really customizable, I need to consider how their web server manages authentication.  Now that I know that cameras use basic HTTP devices for authentication, I use base64 to decrypt.  If you are familiar with authentications via http, then you know that here the login and password are combined, and then encoded in base64. <br><br><img src="https://habrastorage.org/webt/wp/g6/qf/wpg6qfuxetda18sr14nqy178kya.jpeg"><br><br>  So I began to look at the code for cross-references, in which b64_decode is mentioned.  All that they do when they decrypt your password is that they pass it on to b64_decode for verification, and great, everything is in order, they have decrypted your password.  Then they make two string comparisons: strings with the hard-coded parameter 3sadmin and another hard-coded string 27988303. <br><br>  I used to think that it is impossible to be so stupid as to place hard-coded things in my HTTP server, since this is not credible, but it continues to work. <br><br><img src="https://habrastorage.org/webt/ue/pc/oe/uepcoeckvijnpdcc8m0n3qwpkvy.jpeg"><br><br>  Thus, you can access any 3SVision camera and become an administrator.  This gives you access to video of cash registers, Taiwanese checkpoints and basements of Russian industrial enterprises. <br><br>  But looking at all this video quickly becomes boring, so I wanted to get to root.  Fortunately, their code is replete with all sorts of unsafe system calls, and the attacker opens a wide field for attack, especially if he logs in as an administrator.  The best example is the video recorder records.cgi. <br><br><img src="https://habrastorage.org/webt/jv/zk/zy/jvzkzyx7ihm3xdhnpwaabwxaotg.jpeg"><br><br>  Not all, but many of these cameras support local storage, so you can, say, insert your SD memory card inside the camera and store video on it for yourself.  You are also given the opportunity to manage some basic files through the admin interface, and this is done through the do_records function on the cgi page.  Cgi is not a physical page on disk.  When the web server sees that you have requested a CGI record, it calls the do_records function handler, which checks what action you are performing.  For example, if you want to delete a file, you must give it the value of the aRemove command, equal to "remove". <br><br><img src="https://habrastorage.org/webt/kj/a1/-1/kja1-1-nxvskzv07qnr91radrbe.jpeg"><br><br>  In addition, you must tell which file you want to delete. <br><br><img src="https://habrastorage.org/webt/eo/ud/m4/eoudm4e2e3saetpwvncgb0dephw.jpeg"><br><br>  This file name is inserted into the RM command, which is passed to the system. <br><br><img src="https://habrastorage.org/webt/fr/tt/us/frttuszt_u67a2wpp9nymedxxrw.jpeg"><br><br>  I think you already understand what this might lead to.  Instead of the file name, you can insert a command that will cause a system reboot, and so on.  At the same time, we will get full control over the system, as was the case with the burglary of previous cameras. <br><br><img src="https://habrastorage.org/webt/wu/yk/n3/wuykn3sklwmpefudoejwxipbn-i.jpeg"><br><br>  This works on almost the entire 3SVision product line, and affects not only the cameras, but also their video server, because they use the same web server.  When I conducted my research, I discovered another company called A-Linking, which uses the same firmware in their cameras.  But they changed the hard-coded credentials to something else.  So they still have these hard-coded data, but now they are different from the credentials used in the firmware of 3SVision cameras.  I will not list all the models of such cameras, just note that all of them are in the rating of vulnerabilities Shodan Dork. <br><br><img src="https://habrastorage.org/webt/bh/iz/qd/bhizqddyiutycelkh7xvoums6xm.jpeg"><br><br>  Given their high cost compared to cameras from other manufacturers, this is especially interesting, and, as you know, these cameras are used in foreign military, energy and industrial enterprises.  If you saw them on Shodan Dork, be careful with selling these cameras abroad and don't blame me if the Chinese military follow you. <br><br>  So, what gives what I told you?  I penetrate your network, I see you and I have root-rights.  This is a great opportunity for any intruder, given that most of these cameras are also connected to the internal network.  You can remotely access them, get inside, get root-rights, get into a Linux-based computer and from there do anything with their local network. <br><br>  Here I stepped back a bit and said: ‚Äúok, this is all great, but what can I do with the camera itself‚Äù?  I got root access to the camera, which is awesome, but if you go to the usual surveillance system administrator and tell him that you have root access to the camera, he won‚Äôt even understand what that means.  So I wanted to do something more interesting, something that would truly demonstrate all the possibilities.  I wanted to intercept the video stream, which looks like this: <br><br><img src="https://habrastorage.org/webt/7v/rw/ft/7vrwftrag-3ce3mxa1rale08cgk.jpeg"><br><br>  And replace it with something that looks like this: <br><br><img src="https://habrastorage.org/webt/4q/oa/3b/4qoa3bhqpgfbslhwr4lsho2ip3s.jpeg"><br><br>  This is a kind of classic Hollywood hacking, when you want to penetrate a guarded object stuffed with surveillance cameras, and a hacker from your group has to hack this camera so that it shows that there is no one there, although in reality there is someone there.  To prove the possibility of such a stunt, I chose the Trendnet TV-IP410WN surveillance camera. <br><br><img src="https://habrastorage.org/webt/ru/8n/ds/ru8ndsofvem7t4gw_tcmlztvyco.jpeg"><br><br>  I chose it for several reasons.  First of all, I can afford to buy it, which is a big plus.  Secondly, it has a backdoor account: <br><br><img src="https://habrastorage.org/webt/nz/ke/us/nzkeus-9v1abkue8qtngldszexm.jpeg"><br><br>  Allowing you to get here to these files: <br><br><img src="https://habrastorage.org/webt/zy/bu/jt/zybujtxkuw2gxo2bt4escas5kh8.jpeg"><br><br>  Which have a very widespread vulnerability, which allows for the injection of commands: <br><br><img src="https://habrastorage.org/webt/ip/ml/hr/ipmlhre-0ungitbi8go9znmh3oe.jpeg"><br><br>  That, in turn, can be very simply used to send the necessary packages to the camera: <br><br><img src="https://habrastorage.org/webt/iq/na/tu/iqnatufjxtpwl9mhcfws0mgk9oy.jpeg"><br><br><img src="https://habrastorage.org/webt/14/3o/tn/143otn3vyhctqylq3nthlsxqx8g.jpeg"><br><br>  Here there are the same opportunities for hacking, which I mentioned earlier, only in this case we have a cheaper camera. <br><br>  As it turned out, this particular error became known in 2011.  But the problem was that neither I nor anyone else could use this information, because in describing this vulnerability there was not a list of devices in which it was present, or indications of a specific firmware, so everyone ignored it. message.  Therefore, if you turned to Google with the query "TV-IP410WN cameras vulnerability", you would not find anything. <br>  Another problem in not providing such information is that this vulnerability remains unknown, not only for people involved in computer security, but for manufacturers and suppliers of products.  This does not allow them to determine which firmware and which camera models need to be fixed.  So these devices are still sold everywhere with the same bug - Shodan Dork points to more than 28 thousand such cameras. <br><br>  So, suppose that the image of the video channel observed by the administrator is shown here, which most closely matches the objectives of our experiment.  We assume that the administrator is viewing this video through a web interface, and not through some user service, RTPID or something like that. <br><br><img src="https://habrastorage.org/webt/xm/x2/kn/xmx2knftmnfmvdmq_qu6xzcwi1g.jpeg"><br><br>  If you take an image from this particular camera viewed in a browser, you can see that the process mjpg.cgi is responsible for viewing this streaming video. <br><br><img src="https://habrastorage.org/webt/un/wr/tx/unwrtx6ewaprecviax73gvhsngg.jpeg"><br><br>  With the help of the injection command, we can see which processes are running, and then actually ‚Äúkill‚Äù all the processes of mjpg.cgi: <br><br><img src="https://habrastorage.org/webt/hn/ha/kt/hnhakttuchdksbpbaaos_nrzpxq.jpeg"><br><br>  That will lead to the effect of a temporary ‚Äúfreezing‚Äù of the image of the administrator‚Äôs video channel.  This will happen because the browser will show him the last image he received and will no longer receive any images from this camera.  But we will not do that, because if the administrator updates the browser or navigates to a new page, and then returns to viewing from the camera, streaming video transmission will resume and he will see the image in real time. <br><br>  Therefore, we will try to replace the mjpg.cgi file, which shouldn‚Äôt be difficult - two lines of the bash script will suffice. <br><br><img src="https://habrastorage.org/webt/ra/io/r3/raior3oskir8ivcezhcpcxpyfl4.jpeg"><br><br>  In particular, all you have to do is replace this cgi page on disk with a script that returns some basic headers to the browser, and then use the cat command to insert a static JPEG image of an empty elevator into the program.  It can be a goatse image, anything.  But in our case, the administrator will now constantly see an empty elevator, regardless of what actually happens there. <br><br><img src="https://habrastorage.org/webt/ol/45/sa/ol45sank4y7_j1fkxg_41d9z1hc.jpeg"><br><br>  In fact, it is much more interesting to look in a ‚Äúlive‚Äù video, so if the gods of demonstration are with me today, we will be all right.  So, as seen on the screen, my camera is guarding my treasure - a bottle of beer.  See, I take it, and the camera displays it.  Now I will use one exploit in the form of this script, which will ‚Äúkill‚Äù the video in real time and replace it with a static image file, which I just talked about. <br><br>  He will also give me administrative rights to control the camera and set up a secret URL so that I can still watch the real video while the admin channel continues to broadcast the frozen video.  On the screen you see how this exploit is being sent. <br><br><img src="https://habrastorage.org/webt/u0/tr/h_/u0trh_1v7b7rua7n8talrteltk4.jpeg"><br><br>  So, everything went fine, he gave me the user credentials - administrator login and password securecam1234. <br><br><img src="https://habrastorage.org/webt/30/s1/hm/30s1hm-vlhumogzlqc5mazvzeq0.jpeg"><br><br>  He also informs me that the URL is configured so that I can watch the real video feed, so if I now go to my hacker browser, enter my credentials, I can see what is happening. <br><br><img src="https://habrastorage.org/webt/0u/88/u2/0u88u2vahb3m74hr7kz7um9hyow.jpeg"><br><br>  So, if someone takes the bottle, I'll find out about it: <br><br><img src="https://habrastorage.org/webt/7r/kv/lv/7rkvlvdm1mew2ksqjcyn52nvfze.jpeg"><br><br>  And the administrator - no, his bottle will remain on the table. <br><br><img src="https://habrastorage.org/webt/bu/ge/ie/bugeiex6lotb5q0lvnqarhjt4pa.jpeg"><br><br>  So, some final thoughts on this subject that I want to dwell on.  I have provided you with a far from comprehensive list of vulnerable cameras; my research was not of this nature.  In fact, there are many more such cameras, and most of them are very easy to hack. <br><br>  Virtually every camera will show the model number on the login page or the credential entry page, even if you have not been authenticated, depending on how they verify this authentication.  If the attacker knows the model number, not knowing anything about this camera, he can go to Google, find the manufacturer‚Äôs website and download the firmware. <br><br>  You may need to learn more that tab = 4, but after receiving the firmware, you can search for vulnerabilities of this camera, even without buying it. <br><br>  This is exactly what I did with all these cameras - everything was done with the help of firmware analysis, all the exploits were based on it and I did not purchase a single camera.  Then it was enough to use Binwalk for analyzing and unpacking the firmware, and IDA and Qemu for disassembling and emulating, if necessary, after which a victory awaited me. <br>  And now I will answer your questions.  Regarding the security of cameras, I will say this: I could describe all the cameras that I researched for a couple of hours, but among them there was not a single camera that would be perfectly protected.  Meanwhile, there are manufacturers, with the products of which I simply did not have the opportunity to get acquainted, because there was no money to buy such a camera, since they do not provide the opportunity to download the firmware for free.  Therefore, I do not dare to assert that there are no reliable surveillance cameras at all. <br><br>  They ask me whether it is possible to replace a static image when hacking something dynamic.  The easiest thing would be to insert something like an animation file.gif, it would be a purely hacker solution.  However, I think that it is possible to write your own cgi, which will allow you to show video in real time.  I'm too lazy for that, despite my demo.  But if you know the concept of these devices, you can do whatever you want with them. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/B8DjTcANBx0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Thank you for staying with us.  Do you like our articles?  Want to see more interesting materials?  Support us by placing an order or recommending to friends, <b>30% discount for Habr users on a unique analogue of the entry-level servers that we invented for you:</b> <a href="https://habr.com/company/ua-hosting/blog/347386/">The whole truth about VPS (KVM) E5-2650 v4 (6 Cores) 10GB DDR4 240GB SSD 1Gbps from $ 20 or how to share the server?</a>  (Options are available with RAID1 and RAID10, up to 24 cores and up to 40GB DDR4). <br><br>  <b>VPS (KVM) E5-2650 v4 (6 Cores) 10GB DDR4 240GB SSD 1Gbps until December for free</b> if you pay for a period of six months, you can order <a href="https://ua-hosting.company/vpsnl">here</a> . <br><br>  <b>Dell R730xd 2 times cheaper?</b>  Only we have <b><a href="https://ua-hosting.company/serversnl">2 x Intel Dodeca-Core Xeon E5-2650v4 128GB DDR4 6x480GB SSD 1Gbps 100 TV from $ 249</a> in the Netherlands and the USA!</b>  Read about <a href="https://habr.com/company/ua-hosting/blog/329618/">How to build an infrastructure building.</a>  <a href="https://habr.com/company/ua-hosting/blog/329618/">class c using servers Dell R730xd E5-2650 v4 worth 9000 euros for a penny?</a> </div><p>Source: <a href="https://habr.com/ru/post/427369/">https://habr.com/ru/post/427369/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../427359/index.html">How ECS, C # Job System and SRP change the approach to architecture</a></li>
<li><a href="../427361/index.html">Features of window filtering on FPGA</a></li>
<li><a href="../427363/index.html">Introduction of LoRaWAN in an agricultural enterprise. All about construction, start-up and solutions</a></li>
<li><a href="../427365/index.html">Report from RedSlerma about monitoring (Monit, Zabbix)</a></li>
<li><a href="../427367/index.html">Conference BLACK HAT USA. How a Hollywood hacker uses surveillance cameras. Part 1</a></li>
<li><a href="../427371/index.html">Video course "Basics of working with BPMN notations". Free</a></li>
<li><a href="../427373/index.html">Firefox may be monetized by the built-in paid VPN add-on.</a></li>
<li><a href="../427377/index.html">CI / CD simple system administrator</a></li>
<li><a href="../427379/index.html">Senior Junior: Snom D715 IP Phone Review</a></li>
<li><a href="../427381/index.html">Scrum Board Funeral</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>