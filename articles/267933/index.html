<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Microsoft Speech and Streaming Audio</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It became interesting how well Microsoft Speech can recognize speech. As a source for recognition, I decided to take an audio stream of police talks f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Microsoft Speech and Streaming Audio</h1><div class="post__text post__text-html js-mediator-article"><img width="500" height="350" src="https://habrastorage.org/files/f06/11f/f76/f0611ff769b74b96a826dd9774cac756.JPG" alt="image"><br><br>  It became interesting how well Microsoft Speech can recognize speech.  As a source for recognition, I decided to take an audio stream of police talks from youarelistening.to. <br><a name="habracut"></a><br>  There are two namespaces System.Speech and Microsoft.Speech.  As I understand it, in order to use Microsoft.Speech, you must install the Microsoft Speech Platform Runtime and the Microsoft Speech Platform SDK.  And System.Speech is already in the latest versions of the .NET Framework. <br><br>  We will use System.Speech, tk.  in this case dictation is supported, but in the case of Microsoft.Speech it is not. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We also need a library for working with NAudio sound.  There is an example of Mp3StreamingDemo that can work with streaming audio.  We need him.  Create your project.  From MP3StreamingPanel we drag the StreamMp3 method to ourselves and all it needs.  Add a link to NAudio. <br><br>  In our class, we create the StartStreaming method, which will launch StreamMp3 in a separate stream: <br><br><pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StartStreaming</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { playbackState = StreamingPlaybackState.Buffering; bufferedWaveProvider = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; ThreadPool.QueueUserWorkItem(StreamMp3, <span class="hljs-string"><span class="hljs-string">"http://relay.broadcastify.com:80/949398448"</span></span>); }</code> </pre> <br>  The constructor of our class will create and configure SpeechRecognitionEngine. We will use the dictation as grammar: <br><br><pre> <code class="hljs cs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> completed = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> SpeechRecognitionEngine sre = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SpeechRecognitionEngine(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Recognition</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> grammarBuilder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GrammarBuilder(); grammarBuilder.Culture = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CultureInfo(<span class="hljs-string"><span class="hljs-string">"en-Gb"</span></span>); grammarBuilder.AppendDictation(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> grammar = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Grammar(grammarBuilder); grammar.Enabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; sre.LoadGrammar(grammar); sre.BabbleTimeout = TimeSpan.FromHours(<span class="hljs-number"><span class="hljs-number">1</span></span>); sre.EndSilenceTimeout = TimeSpan.FromSeconds(<span class="hljs-number"><span class="hljs-number">10</span></span>); sre.InitialSilenceTimeout = TimeSpan.FromSeconds(<span class="hljs-number"><span class="hljs-number">10</span></span>); sre.SpeechRecognized += sre_SpeechRecognized; sre.RecognizeCompleted += sre_RecognizeCompleted; }</code> </pre><br>  The data from the buffer is copied to the MemoryStream, which is passed to SetInputToAudioStream.  Here it is necessary to set the audio format parameters correctly.  The SetInputToWaveStream method did not work for me. <br><br><pre> <code class="hljs cs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Recognize</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> size = bufferedWaveProvider.BufferLength; <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] bytes = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[size]; bufferedWaveProvider.Read(bytes, <span class="hljs-number"><span class="hljs-number">0</span></span>, size); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ms = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MemoryStream(bytes)) { sre.SetInputToAudioStream(ms, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SpeechAudioFormatInfo( bufferedWaveProvider.WaveFormat.SampleRate, AudioBitsPerSample.Sixteen, AudioChannel.Mono)); sre.RecognizeAsync(RecognizeMode.Multiple); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!completed) { Thread.Sleep(<span class="hljs-number"><span class="hljs-number">333</span></span>); } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sre_RecognizeCompleted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RecognizeCompletedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { Debug.WriteLine(<span class="hljs-string"><span class="hljs-string">"Finished"</span></span>); completed = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sre_SpeechRecognized</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, SpeechRecognizedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { Console.WriteLine(e.Result.Text); }</code> </pre><br>  Manipulations with the completed flag and the loop with Thread.Sleep I took from the documentation for the Speech API.  For some reason, without this cycle, recognition does not occur. <br><br>  Now it remains to modify the borrowed method StreamMp3.  As soon as the buffer is almost full, we read data from it: <br><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsBufferNearlyFull) { <span class="hljs-keyword"><span class="hljs-keyword">Debug</span></span>.WriteLine("Buffer getting full, taking a break"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (completed) { completed = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; Recognize(); } Thread.Sleep(<span class="hljs-number"><span class="hljs-number">200</span></span>); }</code> </pre><br>  And you can run: <br><br><pre> <code class="hljs cs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> recognition = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Recognition(); recognition.StartStreaming(); Console.ReadKey(); }</code> </pre><br>  Of course, the output is a complete frantic: <br><br><div class="spoiler">  <b class="spoiler_title">Recognition Results</b> <div class="spoiler_text">  Michio politically inclined to <br>  it and <br>  regarded <br>  it <br>  her have her had <br>  had <br>  her her <br>  her <br>  in any category goalkeeper were adequate he will <br>  ye cant <br>  have been to ensure tha <br>  may take it nine <br>  but lineup plenty alignment <br>  there get them into productive <br>  all the legal <br>  definitely been likely <br>  a moment <br>  building unlucky in allied <br>  january initiative commissioner <br>  clive be clinging <br>  the Italian Italian open <br>  the relational for transplant <br>  partner new-line <br>  there that they are likely to be alive <br>  Eddie then entitling and it didn't go <br>  thirteen and children ultima <br>  te <br>  augusting inundated with an <br>  it entailed million any luckily a <br>  English allowed her <br>  lineker nine treated for nine <br>  there are <br>  point overhauled understanding complain a <br>  bout it because frankly and that <br>  it is essential either a touchline play <br>  he <br>  scooped old lucky enough to get losing <br>  htly down to that internal it changed <br>  near the of light relief Latino fondly <br></div></div><br>  <b>Findings:</b> <br><ul><li>  Police wave recognizes very bad </li><li>  It works quite quickly, the buffer does not have time to fill </li><li>  System.Speech does not have Russian language support.  It is in Microsoft.Speech, but there is no dictation support </li></ul></div><p>Source: <a href="https://habr.com/ru/post/267933/">https://habr.com/ru/post/267933/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../267923/index.html">Search and read legacy code</a></li>
<li><a href="../267925/index.html">OTRS for pumping in the style of REG.RU</a></li>
<li><a href="../267927/index.html">Storing configs under version control</a></li>
<li><a href="../267929/index.html">Macroscop video surveillance and analytics in detail</a></li>
<li><a href="../267931/index.html">Cybercriminals kidnapped fingerprints 5.6 million US civil servants</a></li>
<li><a href="../267935/index.html">How to monitor the appearance of inappropriate content on your site</a></li>
<li><a href="../267939/index.html">The continuation of the candy problem (or, once again, the Central Limit Theorem)</a></li>
<li><a href="../267943/index.html">GO Download Manager Development</a></li>
<li><a href="../267945/index.html">Google mobile tips and resources</a></li>
<li><a href="../267947/index.html">DDoS attacks and e-commerce: modern approaches to protection</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>