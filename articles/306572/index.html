<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>iOS 10: Notification Content Extension</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article will discuss the new feature in iOS 10 - Notification Content Extension. This is a type of extension that allows the user to display its ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>iOS 10: Notification Content Extension</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/c51/1b5/fa4/c511b5fa4da1433abe13baaeeb95f6cb.png"></div><br>  This article will discuss the new feature in iOS 10 - Notification Content Extension.  This is a type of extension that allows the user to display its own interface when interacting with a notification (remote or local).  And separately we will touch on what is possible and what cannot be done in this new extension, including how much it is flexibly configured and configured. <br><a name="habracut"></a><br>  Notification Content Extension allows you to interact with the application without formally launching it.  This extension brings the greatest productivity if one or several simple actions are required from the user in response to the received notification.  In the latest beta-version, the ability of users to interact with such notifications is not limited to 3D Touch devices, on older devices, the expansion screen will appear with a gesture down on the notification banner. <br><br>  Let us examine in detail this new mechanism on a test project, which you can find <a href="https://github.com/vani2/Call-Provider-Example">here</a> : <br><br><ul><li>  Adding target for extension to the project. </li><li>  Design and stylization of the interface. </li><li>  Adding actions and their processing. </li><li>  Restrictions on customization of the interface. </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Adding target for extension to the project </h2><br>  To create a project, we need Xcode 8 (beta version is currently available).  We create a new project in a way familiar to us, then we need to create a new target for expansion through the menu File - New - Target and select the Notification Content Extension. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/d4b/094/d57/d4b094d5711b44bba64528123987c7fd.png"></div><br>  For the extension, you create your own storyboard and view controller, which obeys the <code>UNNotificationContentExtension. <br></code> protocol <code>UNNotificationContentExtension. <br></code> <code>UNNotificationContentExtension. <br></code> <br>  It has one mandatory method. <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">func </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">didReceive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(_ notification: UNNotification)</span></span></span></span></code> </pre><br>  which is called when a new notification is received when the extension is displayed on the screen.  In this method, we can get the necessary information from the notification and display it.  In this example, for simplicity, we will not implement it. <br><br>  Next we will use another optional method. <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">func </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">didReceive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(_ response: UNNotificationResponse, completionHandler completion: (UNNotificationContentExtensionResponseOption) -&gt; Swift.Void)</span></span></span></span></code> </pre><br>  to process button presses (Notification Actions) and make changes in the interface, open the main application. <br><br><h2>  Interface design and styling </h2><br>  Then we set up the interface as you please in the storyboard file, and configure it in the inherited <code>UIViewController</code> methods. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/2a2/590/8e5/2a25908e5ea84beba7a1a68d7dbc48ce.png"></div><br>  If we do not want the title, subtitle, notification text to be shown on the extension screen, we need to specify the <code>UNNotificationExtensionDefaultContentHidden</code> key with the value <code>YES</code> in plist. <br><br>  When displaying a screen with an extension, you can notice a problem with its height.  Unfortunately, the automatic height calculation mechanism is not available here.  This can be <code>viewDidLoad</code> following code, for example, in the <code>viewDidLoad</code> method, assuming a height of 50%, sufficient to display all the content: <br><br><pre> <code class="cpp hljs">let size = view.bounds.size preferredContentSize = CGSize(width: size.width, height: size.width / <span class="hljs-number"><span class="hljs-number">2</span></span>)</code> </pre> <br>  In this case, artifacts may be observed during the display - the user may notice an animation of a change in the size of the screen height. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/ba5/ad1/626/ba5ad1626d8b4ff98ea303beac7ee9c6.gif"></div><br>  Fortunately, this can be fixed by setting the coefficient from the maximum height in the plist ( <code>UNNotificationExtensionInitialContentSizeRatio</code> key). <br><br>  The final plist is as follows: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/5ff/f98/1b5/5fff981b5b8848d498abcf1d22b7b6ba.png"></div><br><h2>  Add actions and process them </h2><br>  In order to configure user actions with a notification (Notification Actions), you need to prepare them in advance - create a category of notification and assign to it possible actions on the notification: <br><br><pre> <code class="cpp hljs">let showMoreAction = UNNotificationAction(identifier: <span class="hljs-string"><span class="hljs-string">"showMore"</span></span>, title: <span class="hljs-string"><span class="hljs-string">""</span></span>, options: []) let addBalanceAction = UNNotificationAction(identifier: <span class="hljs-string"><span class="hljs-string">"addBalance"</span></span>, title: <span class="hljs-string"><span class="hljs-string">"  500 ‚ÇΩ"</span></span>, options: []) let myPlanAction = UNNotificationAction(identifier: <span class="hljs-string"><span class="hljs-string">"myPlan"</span></span>, title: <span class="hljs-string"><span class="hljs-string">" "</span></span>, options: []) let balanceCategory = UNNotificationCategory(identifier: <span class="hljs-string"><span class="hljs-string">"balance"</span></span>, actions: [showMoreAction, addBalanceAction, myPlanAction], intentIdentifiers: [], options: []) UNUserNotificationCenter.current().setNotificationCategories([balanceCategory])</code> </pre><br>  The category is needed so that the operating system by its identifier shows possible actions.  The category should come in the appropriate field in the push: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">aps</span></span> : { <span class="hljs-attr"><span class="hljs-attr">alert</span></span> : <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-attr"><span class="hljs-attr">category</span></span>: <span class="hljs-string"><span class="hljs-string">"balance"</span></span> } }</code> </pre> <br>  In order for these actions to be applied to a local notification, you need to fill in the appropriate field of the <code>UNNotificationContent</code> class: <br><br><pre> <code class="cpp hljs">content.categoryIdentifier = <span class="hljs-string"><span class="hljs-string">"balance"</span></span></code> </pre><br>  Additionally, in order to display a specific extension (if there are several of them), you need to add a category identifier in plist to the array with the <code>UNNotificationExtensionCategory</code> key.  If the operating system does not find the category key in the available extensions, the notification is processed as standard (without displaying any extension screen). <br><br>  Button presses are processed as follows: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> response.actionIdentifier { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"addBalance"</span></span>: addBalance() completion(.doNotDismiss) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"myPlan"</span></span>: openMainApplication() completion(.dismiss) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"showMore"</span></span>: openMainApplication() completion(.dismiss) <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: completion(.dismiss) }</code> </pre> <br>  In this method, we can perform any (including asynchronous) operations, but the time for processing the action is limited, so you should not overload the method with complex and lengthy processes. <br><br>  Completion must be invoked with the <code>UNNotificationContentExtensionResponseOption</code> enum <code>UNNotificationContentExtensionResponseOption</code> : <br><br><ul><li>  dismiss - after execution the notification will disappear </li><li>  doNotDismiss - after execution, the notification will not be hidden </li><li>  dismissAndForwardAction - after execution, the notification will disappear and the action will be redirected to the main application to the <code>func userNotificationCenter(_ center:, didReceive response:, withCompletionHandler completionHandler: )</code> method <code>func userNotificationCenter(_ center:, didReceive response:, withCompletionHandler completionHandler: )</code> delegate to <code>UNUserNotificationCenterDelegate</code> </li></ul><br>  In our test application, we refill the account asynchronously: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/ca0/686/5b9/ca06865b9ce849c98642ec944923a135.gif"></div><br>  For other actions, we are switching to the main application in the usual extension way (after registering the application URL scheme): <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> let url = URL(<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>: <span class="hljs-string"><span class="hljs-string">"callProvider://"</span></span>) { extensionContext?.open(url, completionHandler: nil) }</code> </pre><br><h2>  Restrictions on customization of the interface </h2><br>  In conclusion, I will list the restrictions on customization of the extension (this knowledge should be shared with designers): <br><br><ol><li>  Notification action button styles are not customized.  You can not change the font, alignment, add icons to the buttons, etc. </li><li>  The background of the expansion screen does not support (I hope this only applies to the beta version) transparency.  All attempts to set the background to transparent and get a standard blur in the background (as it works in the widget) were unsuccessful. </li><li>  The white header of the extension screen (with the application name and the ‚Äúclose‚Äù icon) is also completely non-configurable. </li></ol><br><br>  Read more about notifications in lectures from WWDC 2016: <a href="https://developer.apple.com/videos/play/wwdc2016/707/">Introduction to Notifications</a> and <a href="https://developer.apple.com/videos/play/wwdc2016/708/">Advanced Notifications</a> . <br><br>  Thanks for the design: Nikita Stepanov, Denis Otroshchenko. </div><p>Source: <a href="https://habr.com/ru/post/306572/">https://habr.com/ru/post/306572/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../306562/index.html">The story ‚ÄúNIICHOSHI. Duty night "</a></li>
<li><a href="../306564/index.html">Ruby Ecosystem (on Rails) with a bitter aftertaste, or ‚ÄúHow we love to poke PHP‚Äù</a></li>
<li><a href="../306566/index.html">How we made the converter and player for CinemaDNG to CUDA</a></li>
<li><a href="../306568/index.html">Learning machines - fun stuff: modern face recognition with deep learning</a></li>
<li><a href="../306570/index.html">Low cost VDS hosting in Russia and its technical support</a></li>
<li><a href="../306574/index.html">Study: What will happen if you tell users how you target advertising?</a></li>
<li><a href="../306580/index.html">Docker Volume plugin for Nutanix on AOS 4.7</a></li>
<li><a href="../306582/index.html">Rust: & and ref in patterns</a></li>
<li><a href="../306584/index.html">Node.js and JavaScript instead of the old web</a></li>
<li><a href="../306586/index.html">Rating of countries in which it is more favorable to deploy a server farm</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>