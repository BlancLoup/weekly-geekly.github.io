<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Use Webpack instead of Sprockets in Ruby on Rails</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The work of the frontend part of the application in Ruby on Rails is the responsibility of the Sprockets library, which does not meet the needs of the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Use Webpack instead of Sprockets in Ruby on Rails</h1><div class="post__text post__text-html js-mediator-article"><p>  The work of the frontend part of the application in Ruby on Rails is the responsibility of the <a href="https://github.com/rails/sprockets">Sprockets</a> library, which does not meet the needs of the modern frontend application.  What exactly does not reach can be read, for example, <a href="https://www.reinteractive.net/posts/213-rails-with-webpack-why-and-how">here</a> and <a href="https://forum.shakacode.com/t/using-webpack-with-rails/199">here</a> . </p><br><p>  Although there are already enough articles on the webpack + rails bundle and there is even a special <a href="https://github.com/mipearson/webpack-rails">gem</a> , I suggest looking at another bike that can also deploy. </p><br><img src="https://habrastorage.org/files/46b/72c/225/46b72c225cf54a15aaa4055c07a8ed6b.png"><br><a name="habracut"></a><br><p> So, all the frontend application will be in <code>#{Rails.root}/frontend</code> .  Standard <code>assets</code> will only contain image files that are connected via <code>image_tag</code> . <br>  To start, you need Node JS, npm, the webpack itself and plugins for it.  You also need to add the following to <code>.gitignore</code> : </p><br><pre> <code class="hljs pgsql">/node_modules /<span class="hljs-built_in"><span class="hljs-built_in">public</span></span>/assets /webpack-assets.json /webpack-assets-deploy.json</code> </pre> <br><h1>  Webpack configuration </h1><br><p>  When using the console utility, webpack loads the <code>webpack.config.js</code> file. <br>  In our case, it will be used to separate the different environments defined in the variable <code>NODE_ENV</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// frontend/webpack.config.js const webpack = require('webpack'); const merge = require('webpack-merge'); const env = process.env.NODE_ENV || 'development'; module.exports = merge( require('./base.config.js'), require(`./${env}.config.js`) );</span></span></code> </pre><br><p>  In the basic configuration for all environments, we set general settings for directories, loaders, plug-ins.  We also define <a href="https://webpack.github.io/docs/multiple-entry-points.html">entry points</a> for the frontend application. </p><br><pre> <code class="hljs lua">// frontend/base.<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>.js const <span class="hljs-built_in"><span class="hljs-built_in">path</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>); const webpack = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'webpack'</span></span>); module.exports = { context: __dirname, <span class="hljs-built_in"><span class="hljs-built_in">output</span></span>: { //     <span class="hljs-built_in"><span class="hljs-built_in">path</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">path</span></span>.join(__dirname, <span class="hljs-string"><span class="hljs-string">'..'</span></span>, <span class="hljs-string"><span class="hljs-string">'public'</span></span>, <span class="hljs-string"><span class="hljs-string">'assets'</span></span>, <span class="hljs-string"><span class="hljs-string">'webpack'</span></span>), filename: <span class="hljs-string"><span class="hljs-string">'bundle-[name].js'</span></span> }, //   (entry point) entry: { //    : [<span class="hljs-string"><span class="hljs-string">'./app/base-entry'</span></span>],    //       //     <span class="hljs-number"><span class="hljs-number">2.0</span></span> application: [<span class="hljs-string"><span class="hljs-string">'./app/base-entry'</span></span>], main_page: [<span class="hljs-string"><span class="hljs-string">'./app/pages/main'</span></span>], admin_panel: [<span class="hljs-string"><span class="hljs-string">'./app/pages/admin_panel'</span></span>] }, resolve: { //   <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>    extensions: [<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'.js'</span></span>, <span class="hljs-string"><span class="hljs-string">'.coffee'</span></span>], modulesDirectories: [ <span class="hljs-string"><span class="hljs-string">'node_modules'</span></span> ], //     <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>:      // <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'libs/some.lib'</span></span>) alias: { libs: <span class="hljs-built_in"><span class="hljs-built_in">path</span></span>.join(__dirname, <span class="hljs-string"><span class="hljs-string">'libs'</span></span>) } }, module: { <span class="hljs-built_in"><span class="hljs-built_in">loaders</span></span>: [ //    ES6 { test: /\.js$/, include: [ <span class="hljs-built_in"><span class="hljs-built_in">path</span></span>.resolve(__dirname + <span class="hljs-string"><span class="hljs-string">'frontend/app'</span></span>) ], loader: <span class="hljs-string"><span class="hljs-string">'babel?presets[]=es2015'</span></span> }, //  CoffeeScript { test: /\.coffee$/, loader: <span class="hljs-string"><span class="hljs-string">'coffee-loader'</span></span> }, //  Vue JS  { test: /\.vue$/, loader: <span class="hljs-string"><span class="hljs-string">'vue'</span></span> }, //   jquery  //     $  { test: <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>.resolve(<span class="hljs-string"><span class="hljs-string">'jquery'</span></span>), loader: <span class="hljs-string"><span class="hljs-string">'expose?$!expose?jQuery'</span></span> } ], }, plugins: [ //    RAILS_ENV  js  new webpack.DefinePlugin({ __RAILS_ENV__: JSON.stringify(process.env.RAILS_ENV || <span class="hljs-string"><span class="hljs-string">'development'</span></span>) ), }) ] };</code> </pre><br><h2>  Environment development </h2><br><p>  The configuration for the development environment is different with the debug mode enabled and the source map.  I use Vue JS, so I also added a <a href="https://github.com/vuejs/vue-loader/issues/146">small fix</a> here to correctly display the source code of the components of the framework. <br>  Also here we define loaders for styles, images and fonts (for production environments, the settings of these loaders will be different, taking into account the features of caching). </p><br><pre> <code class="hljs markdown">// frontend/development.config.js const webpack = require('webpack'); const AssetsPlugin = require('assets-webpack-plugin'); module.exports = { debug: true, displayErrorDetails: true, outputPathinfo: true, //  source map devtool: 'eval-source-map', output: { //     source map  Vue JS  devtoolModuleFilenameTemplate: info =&gt; { if (info.resource.match(/\.vue$/)) { $filename = info.allLoaders.match(/type=script/) ? info.resourcePath : 'generated'; } else { $filename = info.resourcePath; } return $filename; }, }, module: { loaders: [<span class="hljs-string"><span class="hljs-string"> { test: /\.css$/, loader: 'style!css?sourceMap' }, //     resolve-url, //        //  *.scss  { test: /\.scss$/, loader: 'style!css?sourceMap!resolve-url!sass?sourceMap' }, //  { test: /\.(png|jpg|gif)$/, loader: 'url?name=[path</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">name</span></span>].[<span class="hljs-string"><span class="hljs-string">ext</span></span>]&amp;limit=8192' }, //  { test: /\.(ttf|eot|svg|woff(2)?)(\?.+)?$/, loader: 'file?name=[<span class="hljs-string"><span class="hljs-string">path</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">name</span></span>].[ext]' } ] }, plugins: [ //     -,    //    js  css new AssetsPlugin({ prettyPrint: true }) ] };</code> </pre><br><p>  For development, you still need a server that will give out static, monitor changes in files and do a regeneration as needed.  A nice bonus - hot module replacement - changes are applied without reloading the page.  In my case, it always works for styles, and Javascript is only for Vue JS components. </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// frontend/server.js const webpack = require('webpack'); const WebpackDevServer = require('webpack-dev-server'); const config = require('./webpack.config'); const hotRailsPort = process.env.HOT_RAILS_PORT || 3550; config.output.publicPath = `http://localhost:${hotRailsPort}/assets/webpack`; ['application', 'main_page', 'inner_page', 'product_page', 'admin_panel'].forEach(entryName =&gt; { config.entry[entryName].push( 'webpack-dev-server/client?http://localhost:' + hotRailsPort, 'webpack/hot/only-dev-server' ); }); config.plugins.push( new webpack.optimize.OccurenceOrderPlugin(), new webpack.HotModuleReplacementPlugin(), new webpack.NoErrorsPlugin() ); new WebpackDevServer(webpack(config), { publicPath: config.output.publicPath, hot: true, inline: true, historyApiFallback: true, quiet: false, noInfo: false, lazy: false, stats: { colors: true, hash: false, version: false, chunks: false, children: false, } }).listen(hotRailsPort, 'localhost', function (err, result) { if (err) console.log(err) console.log( '=&gt; Webpack development server is running on port ' + hotRailsPort ); })</span></span></code> </pre> <br><h2>  Production environment </h2><br><p>  For production, you can allocate CSS in a separate file using the <code>extract-text-webpack-plugin</code> .  Also various optimizations are applied for the generated code. </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// frontend/production.config.js const path = require('path') const webpack = require('webpack'); const CleanPlugin = require('clean-webpack-plugin'); const ExtractTextPlugin = require("extract-text-webpack-plugin"); const CompressionPlugin = require("compression-webpack-plugin"); const AssetsPlugin = require('assets-webpack-plugin'); module.exports = { output: { //      filename: './bundle-[name]-[chunkhash].js', chunkFilename: 'bundle-[name]-[chunkhash].js', publicPath: '/assets/webpack/' }, module: { loaders: [ //     CSS    { test: /\.css$/, loader: ExtractTextPlugin.extract("style-loader", "css?minimize") }, // sourceMap   -  { test: /\.scss$/, loader: ExtractTextPlugin.extract( "style-loader", "css?minimize!resolve-url!sass?sourceMap" ) }, { test: /\.(png|jpg|gif)$/, loader: 'url?limit=8192' }, { test: /\.(ttf|eot|svg|woff(2)?)(\?.+)?$/, loader: 'file' }, ] }, plugins: [ //     ,      // developoment  new AssetsPlugin({ prettyPrint: true, filename: 'webpack-assets-deploy.json' }), //    js-     // Webpack   ,    new webpack.optimize.CommonsChunkPlugin( 'common', 'bundle-[name]-[hash].js' ), //  CSS    new ExtractTextPlugin("bundle-[name]-[chunkhash].css", { allChunks: true }), // ... new webpack.optimize.DedupePlugin(), new webpack.optimize.OccurenceOrderPlugin(), new webpack.optimize.UglifyJsPlugin({ mangle: true, compress: { warnings: false } }), //  gzip  new CompressionPlugin({ test: /\.js$|\.css$/ }), //     new CleanPlugin( path.join('public', 'assets', 'webpack'), { root: path.join(process.cwd()) } ) ] };</span></span></code> </pre><br><h2>  Ruby on Rails integration </h2><br><p>  In the application configuration, we will add a new option to enable / disable inserting webpack statics on the page.  It is useful, for example, when running tests, when there is no need to generate statics. </p><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># config/application.rb config.use_webpack = true</span></span></code> </pre> <br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># config/environments/test.rb config.use_webpack = false</span></span></code> </pre> <br><p>  Create an initializer for parsing the manifest when the Rails application starts </p><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># config/initializers/webpack.rb assets_manifest = Rails.root.join('webpack-assets.json') if File.exist?(assets_manifest) Rails.configuration.webpack = {} manifest = JSON.parse(File.read assets_manifest).with_indifferent_access manifest.each do |entry, assets| assets.each do |kind, asset_path| if asset_path =~ /(http[s]?):\/\//i manifest[entry][kind] = asset_path else manifest[entry][kind] = Pathname.new(asset_path).cleanpath.to_s end end end Rails.configuration.webpack[:assets_manifest] = manifest #   Sprockets       ; #  webpack  (. )      Sprockets Rails.application.config.assets.configure do |env| env.context_class.class_eval do include Webpack::Helpers end end else raise "File #{assets_manifest} not found" if Rails.configuration.use_webpack end</span></span></code> </pre><br><p>  Also useful are webpack helpers <code>webpack_bundle_js_tags</code> and <code>webpack_bundle_css_tags</code> , which are wrappers for <code>javascript_include_tag</code> and <code>stylesheet_link_tag</code> .  The argument is the name of the entry point from the webpack config </p><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># lib/webpack/helpers.rb module Webpack module Helpers COMMON_ENTRY = 'common' def webpack_bundle_js_tags(entry) webpack_tags :js, entry end def webpack_bundle_css_tags(entry) webpack_tags :css, entry end def webpack_tags(kind, entry) common_bundle = asset_tag(kind, COMMON_ENTRY) page_bundle = asset_tag(kind, entry) if common_bundle common_bundle + page_bundle else page_bundle end end def asset_tag(kind, entry) if Rails.configuration.use_webpack manifest = Rails.configuration.webpack[:assets_manifest] if manifest.dig(entry, kind.to_s) file_name = manifest[entry][kind] case kind when :js javascript_include_tag file_name when :css stylesheet_link_tag file_name else throw "Unknown asset kind: #{kind}" end end end end end end</span></span></code> </pre> <br><p>  Add an auxiliary method to the base controller to connect the controller with the entry point </p><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># app/controllers/application_controller.rb class ApplicationController &lt; ActionController::Base attr_accessor :webpack_entry_name helper_method :webpack_entry_name def self.webpack_entry_name(name) before_action -&gt; (c) { c.webpack_entry_name = name } end end</span></span></code> </pre> <br><p>  Now in the controller you can do this: </p><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># app/controllers/main_controller.rb class MainController &lt; ApplicationController webpack_entry_name 'main_page' end</span></span></code> </pre> <br><p>  Use in view: </p><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%=</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">webpack_bundle_css_tags</span></span></span><span class="hljs-tag">(</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">webpack_entry_name</span></span></span><span class="hljs-tag">) %&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%=</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">webpack_bundle_js_tags</span></span></span><span class="hljs-tag">(</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">webpack_entry_name</span></span></span><span class="hljs-tag">) %&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><h1>  <code>npm</code> command </h1><br><p>  Now all frontend libraries should be installed like this: </p><br><pre> <code class="hljs sql">npm <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> &lt;package_name&gt; <span class="hljs-comment"><span class="hljs-comment">--save</span></span></code> </pre> <br><p>  It is highly desirable to ‚Äúfreeze‚Äù the exact versions of all packages in the <code>npm-shrinkwrap.json</code> (equivalent to <code>Gemfile.lock</code> ).  You can do this with the command (although <code>npm</code> when installing / updating packages, keeps <code>npm-shrinkwrap.json</code> relevance of <code>npm-shrinkwrap.json</code> , it is better to be safe): </p><br><pre> <code class="hljs pgsql">npm shrinkwrap <span class="hljs-comment"><span class="hljs-comment">--dev</span></span></code> </pre> <br><p>  For convenience, you can add webpack commands to the <code>scripts</code> section for quick launch in <code>package.json</code> : </p><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: { <span class="hljs-string"><span class="hljs-string">"server"</span></span>: <span class="hljs-string"><span class="hljs-string">"node frontend/server.js"</span></span>, <span class="hljs-string"><span class="hljs-string">"build:dev"</span></span>: <span class="hljs-string"><span class="hljs-string">"webpack -v --config frontend/webpack.config.js --display-chunks --debug"</span></span>, <span class="hljs-string"><span class="hljs-string">"build:production"</span></span>: <span class="hljs-string"><span class="hljs-string">"NODE_ENV=production webpack -v --config frontend/webpack.config.js --display-chunks"</span></span> }</code> </pre> <br><p>  For example, you can start the webpack server with the command: </p><br><pre> <code class="hljs pgsql">npm run <span class="hljs-keyword"><span class="hljs-keyword">server</span></span></code> </pre> <br><h1>  Depla: recipe for capistrano </h1><br><p>  I chose an economical option: not to drag the entire JS zoo to the production server, but to build the webpack locally and upload it to the server using <code>rsync</code> . <br>  This is done by the command <code>deploy:webpack:build</code> , the implementation of which is based on the <a href="https://github.com/capistrano-plugins/capistrano-faster-assets">capistrano-faster-assets game</a> .  The generation occurs conditionally: if there were changes in the frontend code or packages were installed / updated.  If you wish, you can add your own conditions (files, folders, according to which <code>diff</code> is made) by setting the variable <code>:webpack_dependencies</code> .  You also need to specify the local folder for the generated statics and the manifest file: </p><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># config/deploy.rb set :webpack_dependencies, %w(frontend npm-shrinkwrap.json) set :local_assets_dir, proc { File.expand_path("../../public/#{fetch(:assets_prefix)}/webpack", __FILE__) } set :local_webpack_manifest, proc { File.expand_path("../../webpack-assets-deploy.json", __FILE__) }</span></span></code> </pre> <br><p>  The <code>deploy:webpack:build</code> command <code>deploy:webpack:build</code> runs automatically before standard <code>deploy:compile_assets</code> . </p><br><p>  The recipe code for capistrano itself: </p><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># lib/capistrano/tasks/webpack_build.rake class WebpackBuildRequired &lt; StandardError; end namespace :deploy do namespace :webpack do desc "Webpack build assets" task build: 'deploy:set_rails_env' do on roles(:all) do begin latest_release = capture(:ls, '-xr', releases_path).split[1] raise WebpackBuildRequired unless latest_release latest_release_path = releases_path.join(latest_release) dest_assets_path = shared_path.join('public', fetch(:assets_prefix)) fetch(:webpack_dependencies).each do |dep| release = release_path.join(dep) latest = latest_release_path.join(dep) # skip if both directories/files do not exist next if [release, latest].map{ |d| test "test -e #{d}" }.uniq == [false] # execute raises if there is a diff execute(:diff, '-Nqr', release, latest) rescue raise(WebpackBuildRequired) end info "Skipping webpack build, no diff found" execute( :cp, latest_release_path.join('webpack-assets.json'), release_path.join('webpack-assets.json') ) rescue WebpackBuildRequired invoke 'deploy:webpack:build_force' end end end before 'deploy:compile_assets', 'deploy:webpack:build' task :build_force do run_locally do info 'Create webpack local build' %x(RAILS_ENV=#{fetch(:rails_env)} npm run build:production) invoke 'deploy:webpack:sync' end end desc "Sync locally compiled assets with current release path" task :sync do on roles(:all) do info 'Sync assets...' upload!( fetch(:local_webpack_manifest), release_path.join('webpack-assets.json') ) execute(:mkdir, '-p', shared_path.join('public', 'assets', 'webpack')) end roles(:all).each do |host| run_locally do `rsync -avzr --delete #{fetch(:local_assets_dir)} #{host.user}@#{host.hostname}:#{shared_path.join('public', 'assets')}` end end end end end</span></span></code> </pre> <br><p>  Impressions of using in favor of the webpack: modularity out of the box, precise control of library versions and their easy updating, development server is not busy processing statics, deploying is faster and not loading by precompiling production server. </p><br><p>  That's all ;) </p><br><p>  <strong>Update!</strong>  .  If you use Sprockets in parallel (or something other than the webpack, it uses <code>public/assets</code> ), then to generate the webpack assets it is better to select a separate directory, for example: <code>public/assets/webpack</code> (made the appropriate changes to the post).  Now with the deployment you can run <code>rsync</code> with the option - <code>--delete</code> , so as not to accumulate unused assets on the production.  This solution has a drawback: synchronization with deletion makes it impossible to roll back assets to a previous release.  Therefore, when deploying, you need to make a backup of the manifest and restore it to the necessary version of assets in case of rollback. </p><br><p>  <strong>Update 2</strong> .  Designed the integration process described above as a heme <a href="https://github.com/Darkside73/webpacked">https://github.com/Darkside73/webpacked</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/282584/">https://habr.com/ru/post/282584/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../282572/index.html">Cryptodisk synchronization between PC and Android</a></li>
<li><a href="../282574/index.html">Paul Graham: The Other Road Ahead, Part 1</a></li>
<li><a href="../282576/index.html">The book "Font and Design. Modern typography</a></li>
<li><a href="../282578/index.html">Mobx - managing the status of your application</a></li>
<li><a href="../282580/index.html">Installing CrashPlan in the Docker container on Synology NAS</a></li>
<li><a href="../282586/index.html">Non-visual methods to protect the site from spam. Part 1. Statistics</a></li>
<li><a href="../282588/index.html">What are they scolding Golang for and how to fight it?</a></li>
<li><a href="../282590/index.html">Rendering drops with transparency and reflections on OpenGL</a></li>
<li><a href="../282592/index.html">Perl plugin version 1.5 released for IntelliJ IDEA</a></li>
<li><a href="../282600/index.html">Autonomous ftp-client with resume files</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>