<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What makes software quality?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="KDPV 

 Someone creates open source software, and I spend a lot of time thinking about how to make software better. An endless stream of requests for ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What makes software quality?</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/0ea/fba/a64/0eafbaa64ffa4af65a5473aef822ab91.png" alt="image"><br>  <i>KDPV</i> <br><br>  Someone creates open source software, and I spend a lot of time thinking about how to make software better.  An endless stream of requests for help on the Stack Overflow, GitHub, Slack forums, emails and private messages is inevitable.  Fortunately, in the end, you know many people who have achieved some success and did fantastic things, and knowing that you took part in this thanks to you and your help is a good motivation for new achievements. <br><br>  You have a question: what qualities of software lead a developer to success or to failure?  How can I improve my software and help more people become successful?  Can I articulate some basic principles or rely on intuition on a case-by-case basis?  (The birth and embodiment of one thought are two completely different actions). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Perhaps this is something like <a href="https://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25B0%25D0%25BC%25D1%2581,_%25D0%2594%25D0%25B8%25D1%2582%25D0%25B5%25D1%2580">Dieter Rams</a> principles promoting quality software design? <br><br><ul><li>  Good design is innovative. </li><li>  A good design makes the product useful. </li><li>  A good design is aesthetic. </li><li>  A good design makes the product understandable. </li><li>  Good design is unobtrusive. </li><li>  Good design is honest. </li><li>  Good design is long lasting. </li><li>  A good project is thought out to the smallest detail. </li><li>  Good design is environmentally friendly. </li><li>  In a good design project as little as possible. </li></ul><a name="habracut"></a><br>  The overall picture is probably more important than what I‚Äôm writing today, but I know that its ‚Äúadvice‚Äù is sometimes impractical or not applicable at all, or, worse, <a href="https://ru.wikipedia.org/wiki/%25D0%25A2%25D1%2580%25D1%258E%25D0%25B8%25D0%25B7%25D0%25BC">truisms</a> .  It's like saying: "Make it as simple as possible, but not too simple."  <i>("Make it as simple as possible, but no simpler". Original note.)</i> .  It is clear that we all want things to be simpler.  But sometimes we do not know what needs to be done to achieve this goal. <br><br>  And even if you have the right "general idea" of what you are doing, there is no guarantee that your project will be successful.  Methods for translating ideas into life are just as important as the idea itself.  The devil is in the details. <br><br>  I cannot give effective universal advice, but perhaps there is less another way.  I was inspired by <a href="https://en.wikipedia.org/wiki/Cognitive_dimensions_of_notations">Thomas Green and Marian Petre</a> , whose ‚Äúcognitive dimensions‚Äù define a set of ‚Äúdiscussion tools‚Äù to ‚Äúincrease the level of discourse‚Äù about the suitability of such ‚Äúinformational artifacts‚Äù like code. <br><br><ul><li>  Abstract gradient; </li><li>  The proximity of the display; </li><li>  Sequence; </li><li>  Blurry; </li><li>  Propensity to mistakes; </li><li>  Complex mental operations; </li><li>  Hidden dependencies; </li><li>  Premature commitment; </li><li>  Progressive assessment; </li><li>  Role expressiveness; </li><li>  Secondary designation; </li><li>  Viscosity; </li><li>  Visibility. </li></ul><br>  No platform is perfect.  It (some kind of abstract platform) was created to study the visual programming environment, and in some cases for specific applications.  (Consider a situation that simulates the observation of the entire code at the same time. Is any software today small enough to be fully visible on one screen? Perhaps a modular principle would be better?).  I believe that it is difficult to assign some problems of usability of one or another dimension.  (Both hidden dependencies and role expressiveness imply that with the help of this code something different will be done that is different from what was done before).  However, it is good food for thinking about the ‚Äúcognitive effects‚Äù of software design. <br><br>  I will not define a "general framework."  But I do have some observations that I would like to share, and this is just as suitable a time as any other to accomplish the a posteriori rationalization of the past year: I spent approximately as much on <a href="https://github.com/mbostock/d3/tree/4">D3 4.0</a> . <br><br>  I am not returning to the ‚Äúlarge-scale‚Äù <a href="https://github.com/mbostock/d3/tree/4">project D3</a> .  I am quite satisfied with such concepts as data connection, scale and markup, separate from the visual presentation.  There is also an interesting study here and this is not my last focus.  I break D3 into modules to make it suitable for use in more applications, to make it easier to expand for other applications, and easier to develop - but in the process of working with it.  I also identify and fix a large number of defects and flaws in the API.  These things can easily be overlooked, but at the same time, they largely limit the actions of people. <br><br>  Sometimes I worry that these changes are trivial, especially if we consider them individually.  I hope I can convince you otherwise.  I'm worried because I think that we (ie, people who write software) tend to underestimate the usability of programming interfaces, instead considering more objective qualities that are easier to measure: functionality, performance, accuracy. <br><br>  Such qualities matter, but poor usability has its own, real value.  Just ask anyone who struggled to figure out the tangled block of code or tore his hair out while fighting the debugger.  Rather, we should better assess usability and create high-quality software that we use first. <br><br>  You cannot just take a piece of code and feel its weight or texture in your hands.  The code is an ‚Äúinformation object‚Äù, but not a physical or graphic one.  You interact with the API by manipulating text in the editor or on the command line. <br><br>  And yet it is - the interaction according to a given standard with the presence of the human factor.  Thus, we can evaluate the code, like any tool, simply by the criterion of the feasibility of its intended task, but is it really that easy to become an experienced programmer and use it effectively?  We must consider the possibilities and aesthetics of the code.  Is everything pretty clear?  Or, on the contrary, sad?  Or maybe beautiful? <br><br>  Programming interfaces are user interfaces.  Or, to put it another way: Programmers are people too.  On the subject of underestimating the human aspect in developing the design, we will again hear Rams: <br><br><blockquote>  ‚ÄúIndifference towards people and the reality in which they live is in fact the one and only mortal sin in design.‚Äù </blockquote><br>  It follows, for example, that good documentation does not justify a bad design.  You can advise people to "go smoking mana," but it's silly to assume that they read everything and remember every detail.  Clarity of examples, the ability to decrypt and edit software in the real world, is probably much more important.  The form must pass the function. <br><br>  Here are some changes that I make to the eye in D3 for ease of use.  But first, an intensive course in data processing in D3. <br><br><h4>  Case 1. Remove enter.append magic. </h4><br>  ‚ÄúD3‚Äù stands for data-driven documents.  The data refers to the things you want to visualize, and the document refers to its visual presentation.  This is called a ‚Äúdocument‚Äù because D3 is based on the standard model for web pages: in <a href="https://www.w3.org/DOM/">the document object model</a> . <br><br>  A simple page might look like this: <br><br><pre><code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">svg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"960"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"540"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">g</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">transform</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"translate(32,270)"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">text</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag">&gt;</span></span>b<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">text</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">text</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"32"</span></span></span><span class="hljs-tag">&gt;</span></span>c<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">text</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">text</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"64"</span></span></span><span class="hljs-tag">&gt;</span></span>d<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">text</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">text</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"96"</span></span></span><span class="hljs-tag">&gt;</span></span>k<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">text</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">text</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"128"</span></span></span><span class="hljs-tag">&gt;</span></span>n<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">text</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">text</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"160"</span></span></span><span class="hljs-tag">&gt;</span></span>r<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">text</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">text</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"192"</span></span></span><span class="hljs-tag">&gt;</span></span>t<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">text</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">g</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">svg</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  This becomes an HTML document containing an SVG element, but you do not need to know the semantics of each element and attribute in order to understand the concept.  Just know that each element, for example, ... for a particular piece of text is a discrete graphic character.  Elements are grouped in a hierarchical order (hereinafter contains, which contains, and so on) in such a way that you can position and style element groups. <br><br>  The corresponding sample data set might look like this: <br><br><pre> <code class="html hljs xml">var data = [ "b", "c", "d", "k", "n", "r", "t" ];</code> </pre> <br>  This data set is an array of strings.  (A string is a sequence of characters, individual letters are located through the lines.) But the data can have any structure you want if you can represent them in JavaScript. <br><br>  For each record (each line) in the data array, we need the corresponding element in the document.  This is the purpose of data-join: a quick method of transforming a document is adding, deleting, or modifying elements so that it matches the data. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/97e/44b/667/97e44b667ce29f46b22143d40cd2e569.png" alt="image"><br>  The data-join as the source takes an array of data and an array of document elements, and returns three options to choose from. <br>  Input selection is the "missing" elements (input data) that may be needed to create and add to the document. <br><br>  Selecting an update represents existing items (data storage) that may need to be modified (for example, repositioning).  The selection of the type of output represents the "remaining" elements (outgoing data) that may need to be removed from the document. <br><br>  Combining data does not change the document itself.  It calculates, enters, updates and displays the result, and then you perform all the necessary operations.  This provides visibility: for example, to animate input and output elements. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8dd/a26/014/8dda26014c720261363c4339005b9184.png" alt="image"><br>  As you might expect, data merging is something you often use both during the first visualization and during each change.  The usability of this functional is extremely important for the overall "utility" of D3.  It looks like this: <br><br><pre> <code class="html hljs xml">var text = g .selectAll("text") .data(data, key); // JOIN text.exit() // EXIT .remove(); text // UPDATE .attr("x", function(d, i) { return i * 32; }); text.enter() // ENTER .append("text") .attr("x", function(d, i) { return i * 32; }) // .text(function(d) { return d; });</code> </pre> <br>  I did not mention some details (for example, a key function that assigns data to elements), but I hope that the essence of the topic is disclosed.  After merging with the data, the above code deletes existing elements, rearranges the update adds the incoming elements. <br><br>  In the above code, there is a <code>.attr("x", function(d, i) { return i * 32; }) //</code> usability problem (the string <code>.attr("x", function(d, i) { return i * 32; }) //</code> ).  This is a duplicate code: sets the attribute "x" to enter and update. <br><br>  Usually these operations are used both for input and for updating elements.  If an item is updated (that is, you are not creating it from scratch), you may need to change it.  Such modifications are often used to enter items, as they must reflect new data. <br><br>  D3 2.0 made certain changes to solve the duplication problem: adding an input to the selection will now copy the input of items into the update selection.  Thus, any operations applied to the list of updates after adding to the input selection will be used both for input and for modification of elements, thus duplicating code will be eliminated: <br><br><pre> <code class="html hljs xml">var text = g .selectAll("text") .data(data, key); // JOIN text.exit() // EXIT .remove(); text.enter() // ENTER .append("text") // .text(function(d) { return d; }); text // ENTER + UPDATE .attr("x", function(d, i) { return i * 32; });</code> </pre> <br>  <i>Alas, it worsened usability.</i> <br><br>  First, there are no indicators of what is going on inside (poor expressiveness of roles, or perhaps hidden dependencies).  Most of the time, <code>selection.append</code> creates, adds, and selects new items;  and by default changes the selection of updates.  Surprise! <br><br>  Secondly, the code now depends on the order of operations: if the operations for selecting updates are applied before <code>enter.append</code> , they only affect the update of nodes;  if they are applied later, then, in this case, they affect both the input and the updates.  The goal of data aggregation is to eliminate such complex logic, as well as to apply a more declarative specification of document conversions without complex branching and iteration.  The code may look much simpler. <br><br>  D3 4.0 removes the <code>enter.append</code> .  (In fact, D3 4.0 completely eliminates the distinction between input and selection: now there is only one class to choose from).  In its place is the new <code>selection.merge</code> method, which can combine input selection and updating: <br><br><pre> <code class="html hljs xml">var text = g .selectAll("text") .data(data, key); // JOIN text.exit() // EXIT .remove(); text.enter() // ENTER .append("text") .text(function(d) { return d; }) .merge(text) // ENTER + UPDATE .attr("x", function(d, i) { return i * 32; });</code> </pre> <br>  This method eliminates duplicate code without distorting the behavior of the generally accepted method (selection.append) and without introducing a dependency ordering.  In addition, the selection.merge method is an unfamiliar pointer for readers, which they can find in the documentation. <br><br><h4>  Principle 1. Avoid semantic overload. </h4><br>  What conclusion can we draw from this failure?  D3 3.x violated the Rams principle: good design makes the product understandable.  Regarding the dimension, it was not consistent because <code>selection.append</code> behaved differently on the input selection.  This method had poor expressiveness of roles, because its behavior in the past was not obvious.  There is also a hidden relationship: text selection operations should be run after adding input, although nothing in the code makes this requirement obvious. <br><br>  D3 4.0 avoids overloading the value.  Instead of adding functionality to <code>enter.append</code> by default - even if it is useful in the general case - <code>selection.append</code> always adds only elements.  If you want to combine samples, you need a new method!  Therefore, this is <code>selection.merge</code> . <br><br><h4>  Case 2. Elimination of magic transition.each </h4><br>  <a href="https://github.com/d3/d3-transition">The transition</a> is similar to choosing an interface for animating changes to a document.  Instead of changing the document instantly, transitions smoothly interpolate the document from its current state to the desired target state for a certain time. <br><br>  Transitions can be non-uniform: sometimes you need to synchronize the transition through multiple selections.  For example, to go on an axis, you should tick off the location of lines and tags at the same time: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/036/cb1/fec/036cb1fecca35ea788cb8c30c0816c3e.png" alt="image"><br>  Or as one of the options: <br><br><pre> <code class="html hljs xml">bl.ocks.org/1166403 One way of specifying such a transition: d3.selectAll("line").transition() .duration(750) .attr("x1", x) .attr("x2", x); d3.selectAll("text").transition() // .duration(750) // .attr("x", x);</code> </pre> <br>  <i>(Here, x is a function, the same as the linear scale, which serves to calculate the horizontal position of each tick from its corresponding data value).</i> <br><br>  With these two lines ( <code>d3.selectAll("text").transition() //</code> and <code>.duration(750) //</code> ) you need to be careful.  Duplicate code appears again: transitions for the string and text elements are created independently, so we need to duplicate synchronization parameters such as delay and duration. <br><br>  The problem is the absence of any guarantee that these two transitions are synchronized!  The second transition is created after the first, so it starts a little later.  The difference of one or two milliseconds can be invisible here, unlike other applications. <br><br>  D3 2.8 introduced a new function to synchronize this kind of heterogeneous transitions: it added the magic of <code>transition.each</code> - a method for iterating over each selected element - in such a way that any new transition created within the callback will inherit synchronization from the surrounding transition.  Now we can say that: <br><br><pre> <code class="html hljs xml">var t = d3.transition() .duration(750); t.each(function() { d3.selectAll("line").transition() // .attr("x1", x) .attr("x2", x); d3.selectAll("text").transition() // .attr("x", x); });</code> </pre> <br>  Just like <code>enter.append</code> , it has poor usability: it changes the behavior of existing methods (selection.each and selection.transition) without notifying it.  If you create a second transition at a given choice, it does not replace the old one;  you simply re-select the old transition.  Oops! <br><br>  This example, unfortunately, was invented for pedagogy.  There is another clearer way (even in D3 3.x) to synchronize transitions by sampling, using transition.select and transition.selectAll: <br><br><pre> <code class="html hljs xml">var t = d3.transition() .duration(750); t.selectAll("line") .attr("x1", x) .attr("x2", x); t.selectAll("text") .attr("x", x);</code> </pre> <br>  In this case, the transition t to the root directory of the document is applied to the string and text elements by selecting them.  This transition is a limited solution to this problem: the transition can only be applied to a new choice.  Repeated selection is always possible, but it is unnecessary work and extra code (especially for temporary input, updating, and exit choices returned by the data fusion). <br><br>  D3 4.0 removes the ambiguity of the transition.each transition logic;  it now provides an implementation of the selection.each command.  Instead, the selection.transition command can be transferred via conversion tools, with the result that the new transition will inherit the time from the specified transition.  Now we can achieve the desired synchronization when creating new choices: <br><br><pre> <code class="html hljs xml">var t = d3.transition() .duration(750); d3.selectAll("line").transition(t) .attr("x1", x) .attr("x2", x); d3.selectAll("text").transition(t) .attr("x", x); Or when using existing selections: var t = d3.transition() .duration(750); line.transition(t) .attr("x1", x) .attr("x2", x); text.transition(t) .attr("x", x);</code> </pre> <br>  New design distorts selection.transition behavior.  But the new signature method (method with the same name, but with different parameters) is a fairly common design pattern, the difference in behavior is located in a single call. <br><br><h4>  Principle 2. Avoid behavior patterns. </h4><br>  This principle is a continuation of the previous one, in order to avoid overloading the value for a more egregious violation.  Here D3 2.8 introduced an inconsistency with selection.transition, but the behavioral trigger was not another class;  he was just inside the transition.each call.  A remarkable consequence of this construction is that you can change the behavior of code that you did not write by wrapping it with transition.each! <br>  If you see code that sets a global variable to trigger a global change in behavior, this is most likely a bad idea. <br><br>  Looking back, I conclude that this time it is particularly striking.  What was I just thinking about?  Maybe I'm a failed designer?  There is some consolation in understanding why bad ideas are attractive: it is easier to recognize and avoid in the future.  Here I recall trying to minimize the imaginary complexity, avoiding the use of new methods.  However, this is a clear example of where the introduction of new methods (or signatures) is easier than overloading existing ones. <br><br><h4>  Case 3. Remove the magic d3.transition (selection) </h4><br>  A powerful concept in most modern programming languages ‚Äã‚Äãis the ability to define reusable blocks of code as a function.  Turning code into a function, you can call it wherever you want, without resorting to copying and pasting.  While some software libraries define their own abstractions for code reuse (say, extending the diagram type), D3 is an indicator of how to encapsulate code, I recommend doing it only with a function. <br><br>  Since selection queries and transitions share many methods such as selection.style and transition.style for setting style properties, you can write a function that will affect both selection queries and transitions.  For example: <br><br><pre> <code class="html hljs xml">function makeitred(context) { context.style("color", "red"); }</code> </pre> <br>  You can set the makeitred selection to instantly repaint the text to red: <br> <code>d3.select ("body") .call (makeitred);</code> <br>  But you can also pass makeitred a transition, in which case the text color will turn red for a short period of time: <br> <code>d3.select("body").transition().call(makeitred);</code> <br> <br>  This approach is applied with embedded D3 components, such as axes and brushes, as well as modes such as zooming. <br>  The glitch of this approach is that transitions and selections do not have identical APIs, so not all code can be agnostic.  Operations such as counting data aggregation in order to update axis check marks require sampling queries. <br><br>  D3 2.8 provided another erroneous function for this use case: it overloaded d3.transition, which usually returns a new transition to the root directory of documents.  If you entered the d3.transition command, and were inside the transition.each callback, then the d3.transition command would return a new transition to the specified choice;  otherwise, it would simply return the specified selection.  (This function was added to the same commit as the transition.each defect mentioned above. There is no trouble alone!) <br><br>  From my cumbersome description, you must conclude that creating this function was a bad idea.  But let's look at it in more detail, for science.  Here is a similar way of writing the above-mentioned <code>makeitred</code> function, which limits the code (using s) in choosing an API with another code (using t), instead applied to the API transition, if the context is a transition: <br><br><pre> <code class="html hljs xml">unction makeitred(context) { context.each(function() { // var s = d3.select(this), t = d3.transition(s); // t.style("color", "red"); }); }</code> </pre> <br>  The confusion of the <code>transition.each</code> function is as follows: <code>d3.transition</code> calls the <code>selection.transition</code> and is inside the <code>transition.each</code> callback, so the new transition inherits synchronization from the surrounding transition.  The problem is that d3.transition does not do what it should.  And there is also confusion in the fact that both the context and t are unknown types ‚Äî either of choice or of transition ‚Äî although this may be justified by the convenience of calling the makeitred function both for selection and for transition. <br><br>  D3 4.0 removes <code>d3.transition</code> (choice);  <code>d3.transition</code> can now be used only to create a transition to the root directory of the document, in the same way as <code>d3.selection</code> .  To share the choice and the transition, use your usual JavaScript command to check the types: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/instanceof">instanceof</a> or <a href="https://en.wikipedia.org/wiki/Duck_typing">duck typing</a> , depending on your preferences: <br><br><pre> <code class="html hljs xml">function makeitred(context) { var s = context.selection ? context.selection() : context, t = context; t.style("color", "red"); }</code> </pre> <br>  Notice that in addition to removing the magic of <code>transition.each</code> and <code>d3.transition</code> functions, the new <code>makeitred</code> function avoids <code>transition.each</code> completely, still allowing you to write code that is specific to choosing D3 4.0's and using the new transition.selection method.  This is a contrived example of when the choice of s is not used, and t has the same meaning as the context, and thus it can be trivially reduced to the original definition: <br><br><pre> <code class="html hljs xml">function makeitred(context) { context.style("color", "red"); }</code> </pre> <br>  But this is my personal opinion.  The need to select a particular code should not require complete correspondence using the <code>transition.each</code> !  Green and Petra called it a premature commitment. <br><br><h4>  Principle 3. Neat use </h4><br>  The <code>d3.transition</code> method <code>d3.transition</code> to merge the two operations.  The first is checking your presence within the <code>transition.each callback</code> command.  If you are still there, the second operation retrieves the new transition from the sample.  However, the latter can use selection.transition, so <code>d3.transition</code> trying to do too much and, as a result, it also hides too much. <br><br><h4>  Case 4. Repetition of transitions from d3.active </h4><br>  D3 transitions are finite sequences.  Most often, the transition is the stage of transition from the current state of the document to the desired one.  However, sometimes you need more thoughtful sequences that go through several stages: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/74f/b20/4b9/74fb204b922b316ec0730169b38ba37a.png" alt="image"><br>  (Be careful when preparing your animation! Read the information about animation transitions in Statistical Data Graphics by Heer &amp; Robertson.) <br>  You may want to repeat the sequence that is described in this example: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d4f/52f/9a9/d4f52f9a939f19a4acf4e0d42c6dd226.png" alt="image"><br>  D3 does not have a special method for infinite transition sequences, but you can create a new transition when the old one is already finished.  This led to the most confusing example of code I've ever written: <br><br><pre> <code class="html hljs xml">svg.selectAll("circle") .transition() .duration(2500) .delay(function(d) { return d * 40; }) .each(slide); // function slide() { var circle = d3.select(this); (function repeat() { circle = circle.transition() // .attr("cx", width) .transition() .attr("cx", 0) .each("end", repeat); })(); // }</code> </pre> <br>  I do not even dare to try to explain something after the "cognitive consequences", from which we previously abstained.  But you are very far from this, so I will do my best.  First, <code>transition.each</code> runs a <code>callback</code> that iterates through the loop.  <code>Callback</code> specifies the closing of a repeated call that fixes a circular variable.  Initially, a cycle is a selection of a single cycle element;  The first stage of the transition is thus created using <code>selection.transition</code> , inheriting time from the surrounding transition!  The second stage is created using <code>transition.transition</code> so that it begins only after the end of the first.  The second stage is assigned to the cycle.  Finally, each time a two-step transition sequence ends, a repeat command is executed, which repeats and revises the transition cycle. <br><br>  In addition, you probably noticed that <code>transition.each</code> with one parameter does something completely different from <code>transition.each</code> with two parameters? <br>  Wow! <br><br>  Now let's compare with D3 4.0: <br><br><pre> <code class="html hljs xml">svg.selectAll("circle") .transition() .duration(2500) .delay(function(d) { return d * 40; }) .on("start", slide); function slide() { d3.active(this) .attr("cx", width) .transition() .attr("cx", 0) .transition() .on("start", slide); }</code> </pre> <br>  D3 4.0 provides <code>d3.active</code> , which returns the active transition on the specified element.  This eliminates the need to obtain a local variable for each loop (cyclic variable), and increases the need to close the call (repeated function), as well as the need for an incomprehensible command <code>transition.each</code> ! <br><br><h4>  Principle 4. Incomprehensible solutions are not solutions. </h4><br>  This is the case when there is a way to solve the problem, but it is so complex and wobbly that you can hardly find it, and hardly remember it at all.  Although I wrote the library, I still constantly appeal to Google. <br><br>  In addition, it is ugly. <br><br><h4>  Case 5: Hanging in the background </h4><br>     D3 3.x   ,            . ,   ""    .     : <br><br>  ,  ,      ,      ,   .         ,    ,           ,    ""  ! <br><br> ,       :          ,   .         ,   . <br><br> D3 4.0       .         ;           .  D3 4.0     ,    ,      .      ,     . <br><br><h4>  5.     </h4><br>           .     ,    ,     . <br><br><h4>  6.    selection.interrupt </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transitions are often triggered by events, such as the arrival of new data through wire or user interaction. Since the transitions are not instantaneous - there may be several of them and they can compete with each other for the right to control the elements. To avoid this, the transitions must be monopoly, which will allow the new transition to exceed (interrupt) the old one. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">However, such exclusivity should not be global. Multiple simultaneous transitions must be allowed, provided they work with different elements. If you quickly switch between the grouped panels below, you can send waves that slightly oscillate through the diagram: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/2a6/880/b4d/2a6880b4dfeca520956220bd58a81989.png" alt="image"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transitions D3 are exclusive for each element by default. If you need exclusivity, there is</font></font><code>selection.interrupt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">which interrupts the active transition on the selected items. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The problem with </font></font><code>selection.interrupt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D3 3.x is that it does not cancel the unfinished transitions that are scheduled for the selected items. There is no control - the reason may be in another design flaw in D3 3.x's timers, which cannot be stopped by external factors, the abolition of transitions is inappropriate in this case. (Instead, the ousted transition independently ends at the start). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The solution to this problem in D3 3.x can be the creation of a blank command, a transition with zero delay after an interruption:</font></font><br><br><pre> <code class="html hljs xml">selection .interrupt() // interrupt the active transition .transition(); // pre-empt any scheduled transitions That mostly works. But you can cheat it by scheduling another transition: selection .transition() .each("start", alert); // selection .interrupt() .transition();</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since the first transition is not yet active, it is not interrupted. </font><font style="vertical-align: inherit;">And since the second transition is scheduled after the first transition, the first transition may start before it is subsequently interrupted. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In D3 4.0, </font></font><code>selection.interrupt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interrupts the active transition, if any, and cancels all scheduled transitions. </font><font style="vertical-align: inherit;">Cancellation is stronger than crowding out: scheduled transitions are immediately destroyed, freeing resources and ensuring that they cannot be launched.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Principle 6. Consider all possible uses. </font></font></h4><br>  ,  ,   ,       .   ,        API-, ,    "".     "    ." <br><br><h4>  7.   </h4><br>    . D3 4.0       ,       -.  ,  D3 3.x: <br><br><pre> <code class="html hljs xml">selection.transition() .duration(750) .ease("elastic-out", 1, 0.3);</code> </pre> <br>  ,   : <br><br><ul><li>    1? </li><li>    0,3? </li><li>    ,  ‚Äúelastic-out‚Äù ? </li><li>       ? </li></ul><br>    D3 4.0: <br><br><pre> <code class="html hljs xml">selection.transition() .duration(750) .ease(d3.easeElasticOut .amplitude(1) .period(0.3));</code> </pre> <br>  1  0,3  , ,   ,         <a href="https://github.com/d3/d3-ease">  API</a> ,    : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c80/aef/5b8/c80aef5b84aa2ff1d22739fb89144acc.png" alt="image"><br>  ,       ,   <code>transition.ease</code> ;    . D3 4.0            . <br><br><h4>  7.   </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Functions that use many parameters obviously have a poor design. </font><font style="vertical-align: inherit;">People should not try to remember such complex definitions. </font><font style="vertical-align: inherit;">(I can't even tell you how many times I had to look for parameters </font></font><code>context.arc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in working with 2D canvas.) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since its inception, D3 has approved these properties using the chain method and the single parameter method. </font><font style="vertical-align: inherit;">But there is still room for improvement. </font><font style="vertical-align: inherit;">If the code cannot be absolutely obvious, at least it can point to the right place in the documentation.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> What is the purpose of good software? </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is not only about quick and correct calculation of the result. And not even just a brief or elegant notation. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">People have powerful but limited cognitive abilities. Many actors compete for this ability like little children. The most important thing is that people learn. I hope that my examples have shown how strongly the design of programming interfaces influences the ability of people to understand the code and become experienced programmers.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But learning is beyond the scope of ownership of this tool. If you can apply your knowledge about one domain to other domains, such knowledge is very valuable. That is why, for example, D3 uses the standard document object model, rather than a specific view. It may be more effective in the future when the tools change, but the time you have spent studying a narrow field of knowledge may be wasted! </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I do not want you to learn D3 for D3. I want you to learn how to examine data and interact effectively. </font></font></i> <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Good software is affordable.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> This can be understood by the example of simple things. You do not need to know everything before you can understand anything. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Good software compatible.</font></font></b>    ,            .   .      . <br><br> <b>    .</b>       .         . <br><br> <b>   .</b>      ,         . <br><br> <b>     .</b>     ,    .   ,      .        . <br></div><p>Source: <a href="https://habr.com/ru/post/279459/">https://habr.com/ru/post/279459/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../279449/index.html">Some thoughts and tips on optimizing C ++ code</a></li>
<li><a href="../279451/index.html">Happy birthday, Richard Stallman</a></li>
<li><a href="../279453/index.html">Why does a programmer need to know algorithms</a></li>
<li><a href="../279455/index.html">What is in Visual Studio 2015 for a developer in Python</a></li>
<li><a href="../279457/index.html">New useragent search robot Google Smartphone</a></li>
<li><a href="../279461/index.html">What are PHP trends saying in 2016?</a></li>
<li><a href="../279469/index.html">Plotti.co: the easiest microservice to monitor live graphs</a></li>
<li><a href="../279477/index.html">How to write custom activation for a business process for cloud Bitrix24</a></li>
<li><a href="../279479/index.html">Peculiarities of national support: in 6 languages ‚Äã‚Äãfrom Moscow, plus Delhi, Bangalore, Bucharest and Tokyo teams</a></li>
<li><a href="../279481/index.html">Interesting cases of work organization on the second line of technical support</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>