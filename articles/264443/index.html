<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Parsing a Word document to pictures or a story about pre-diploma weekdays</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I want to present to your attention a method of extracting data from a word document in the form of pictures. Perhaps the ideas presented will be for ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Parsing a Word document to pictures or a story about pre-diploma weekdays</h1><div class="post__text post__text-html js-mediator-article">  I want to present to your attention a method of extracting data from a word document in the form of pictures.  Perhaps the ideas presented will be for some primitive and obvious.  But I had to spend a couple of sleepless nights before reaching a normal solution.  So, I start. <br><br>  It was the beginning of 2015.  Winter.  I rejoiced at the good weather and delightedly thought that I would finally finish the university (I'm lying, now I'm enrolling in magistracy).  I recently completed my diploma, so I was even more happy.  However, soon, by nature human, the state of serenity smoothly began to be replaced by boredom.  And then, as if on purpose, silence was replaced by a phone call. <br><br>  ‚ÄúHello, hello, how are you?‚Äù A familiar voice sounded. <br><a name="habracut"></a><br>  Intuition immediately determined that the conversation would most likely be on the topic of a ‚Äútyprogrammer‚Äù.  So it was.  With a sad look, at first I listened about hard times familiar and everything else, but her final request made me interested. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      ‚ÄúYou could not help me with a diploma?  In general, it is necessary to make a website-simulator in mathematics, ‚Äùshe said. <br><br>  It was interesting.  I'm just fascinated by the development of complex frontends.  I immediately approved the request. <br><br>  On the implementation of the simulator took a total of no more than 2 days.  Site simulator allows you to take tests in higher mathematics and view theory.  Tests can be performed in two modes: in the training mode with the answers highlighted and in the testing mode with the result displayed at the end.  The implementation was done on ReactJS and Bootstrap and the process itself was quite enjoyable.  But that was only the beginning.  It was necessary to fill in the test questions database with data that were not at all in the form of ready-made ordered data. <br><br><h3>  Formulation of the problem </h3><br>  While I was satisfied with the result of work, a friend called again.  She notified me that she had sent me a small archivist with questions in * .doc files to the mail.  "If anything, I can help throw questions and answers into the database," she added. <br><br>  This slightly spoiled my mood, because I did not think that I would have to fill in the base of test questions myself. <br><br>  Okay.  I went to open my GMail and here: <br><br><img src="https://habrastorage.org/files/c81/4cd/c27/c814cdc276744719b34253eade881288.png"><br><br>  And in each file there are ~ 50 test tasks in the form: <br><br><img src="https://habrastorage.org/files/c88/cc9/e89/c88cc9e89e5d40f9b3c196db337de07d.png"><br><br>  Hmmm, it‚Äôs unlikely to work out manually in the database.  By the way, each test task in the database was stored as one picture-question, five picture-answers, difficulty level (A, B, C) and the correct answer number (1-5).  Frustrated, I decided to postpone this issue for a long time so far, the benefit of the time was enough.  But after a few days, another message from a friend fell on the mail, and then another ... As a result, there were 4 sections on higher mathematics, each of the sections consisted of 14-23 subsections, each subsection contained about 30-100 test tasks.  And here I was finally convinced that it would definitely not work out to manually drive all this into the database. <br><br>  By the way about the database.  This is a MySQL with three tables: sections, subsections and test questions.  Pictures of the quest question and the five answers are stored directly in the database, in the BLOB column.  It seems to me more comfortable because there are a lot of these pictures, besides, they weigh a little.  And they will all be stored in one place, along with other data. <br><br>  So what was necessary?  In the best case, it was necessary to get ready-made corresponding records in the database from the folder with all word test files, which practically was obtained in the final result.  We are also interested in the main thing: directly extracting the images themselves. <br><br>  <b>Input</b> : word file with test items. <br>  <b>Output data (for example)</b> : a folder with PNG images, where the task has a name like 1.png, and the answers are named 1.1.png, 1.2.png, 1.3.png, 1.4.png, 1.5.png, plus the answers file. txt, inside which the i-th line contains a number from 1 to 5, corresponding to the correct answer of the i-th task. <br><br><h3>  Implementation </h3><br>  I love Qt Creator.  And why should I love him?  Most likely because in the university we are trained precisely for it, I do not know.  And while using it, I feel some kind of quiet delight.  Well, in general, you understand what I began to write a parser program. <br><br>  At first, I wondered how to interact with this Word at all, in order to somehow pull out the data from there.  All sorts of horrible thoughts came to mind, like converting a word file to HTML with subsequent processing.  But google immediately sent me on an adequate path, giving information about the language of VBA.  I was immediately struck by the abundance of ready-made functions, I learned what paragraphs, positions, etc., are, at the same time, of the complexity of the structure of the word document tree. <br><br>  However, I was disappointed because I did not understand how to turn a piece of text into a picture.  At first I wanted to use something like text2png, after having pulled out the necessary piece of text.  But what about the formulas and pictures?  There was no built-in function in VBA.  At one point, I accidentally flashed a little thought that, like I used to insert into the word document cells from excel in the form of pictures.  So it was!  This was called a "special insert" and allowed to insert any part of the document in the form of a picture.  Suppose we have entered into the clipboard a certain piece of the document, which must be saved as an image.  But how to save this picture to disk?  Googling also helped find a solution.  The code section below saves the contents of the clipboard to disk as a universal EMF vector file. <br><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;windows.h&gt; void clipboardDataToEmfFile(QString fileName){ OpenClipboard(0); GetEnhMetaFileBits((HENHMETAFILE)GetClipboardData(14),0,0); HENHMETAFILE returnValue = CopyEnhMetaFileA((HENHMETAFILE)GetClipboardData(14), QDir::toNativeSeparators(fileName).toStdString().c_str()); EmptyClipboard(); CloseClipboard(); DeleteEnhMetaFile(returnValue); }</span></span></span></span></code> </pre> <br>  Fine.  However, what kind of beast is this, this EMF?  It was necessary to turn it into PNG.  I started looking for image converters.  After going through a bunch, and did not find adequate.  And here again (does anyone believe in intuition?) In my head I began to recall some sophisticated image viewer, which I put in my school years from the disc with the ‚ÄúGolden Software‚Äù for fun.  But it seems it was not a converter.  However, it was necessary to make sure.  In my head there was some sort of whether ‚ÄúIfran‚Äù, or ‚ÄúIrfan‚Äù, in general, the program was found.  Free, with the batch image processing feature, supports command line!  And most importantly, it supports EMF.  That was what was needed.  The IrfanView executable file with the necessary DLL and ini-file of parameters lies in the same folder with the compiled program (I hope this does not violate the license) and is used through the function like this. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convertEmfsToPng</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(QString inFolder, QString outFolder)</span></span></span></span>{ QProcess proc; QString exeStr = <span class="hljs-string"><span class="hljs-string">"\""</span></span> + QDir::toNativeSeparators(QDir::currentPath()+<span class="hljs-string"><span class="hljs-string">"/i_view32.exe"</span></span>) + <span class="hljs-string"><span class="hljs-string">"\""</span></span>; QString inFilesStr = <span class="hljs-string"><span class="hljs-string">"\""</span></span> + QDir::toNativeSeparators(inFolder + <span class="hljs-string"><span class="hljs-string">"*.emf"</span></span>) + <span class="hljs-string"><span class="hljs-string">"\""</span></span>; QString outFilesStr = <span class="hljs-string"><span class="hljs-string">"\""</span></span> + QDir::toNativeSeparators(outFolder + <span class="hljs-string"><span class="hljs-string">"*.png"</span></span>) + <span class="hljs-string"><span class="hljs-string">"\""</span></span>; QString iniFolderStr = <span class="hljs-string"><span class="hljs-string">"\""</span></span> + QDir::toNativeSeparators(QDir::currentPath()) + <span class="hljs-string"><span class="hljs-string">"\""</span></span>; proc.start(exeStr + <span class="hljs-string"><span class="hljs-string">" "</span></span> + inFilesStr + <span class="hljs-string"><span class="hljs-string">" /advancedbatch /ini="</span></span> + iniFolderStr + <span class="hljs-string"><span class="hljs-string">" /convert="</span></span> + outFilesStr); proc.waitForFinished(<span class="hljs-number"><span class="hljs-number">30</span></span>*<span class="hljs-number"><span class="hljs-number">60</span></span>*<span class="hljs-number"><span class="hljs-number">1000</span></span>); }</code> </pre><br>  Now it remains to copy the necessary pieces from the word document to the buffer.  To do this, you need to come up with an algorithm for splitting the source text into separate blocks with the task, the answers, the correct answer number and the level of complexity. <br><br>  The first implementation attempt was the following.  We take the original document, replace the text of the form ([1-5]) \) with \ n $ 1 \), i.e.  before the beginning of each answer we add a line feed.  Replacement lines are written differently on VBA, I don‚Äôt remember.  Now in the document settings, we set the page width to the maximum, and reduce the font for the entire document.  The result is that in the document each task will occupy exactly 8 lines, and: <br><ul><li>  line 8 * i is the text with the correct answer number and level of complexity </li><li>  line 8 * i + 1 is the task </li><li>  line 8 * i + 2 is the answer number 1 </li><li>  ... </li><li>  line 8 * i + 6 is the answer number 5 </li><li>  line 8 * i + 7 - empty </li></ul><br><div class="spoiler">  <b class="spoiler_title">Repeat how tasks look</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/c88/cc9/e89/c88cc9e89e5d40f9b3c196db337de07d.png"><br></div></div><br>  Now, after this processing, there is nothing left but to walk through the array of a collection of document lines, start counter i, and depending on i% 8 save task / response pictures or retrieve the number of the correct answer with a level of complexity. <br><br>  But it did not fit.  Blame long tasks that are written in one line, look terrible, small and not always fit.  In addition, sometimes the replacement of the text "1)" affects other places than the answer numbers.  Saddened by the result, I again began to think what could be done in this case.  And then I remembered the state machines.  I remembered about the state, I remembered about the character input.  Remembered the parser.  Perhaps this was another decision, but I, as a person far from complex algorithms, was extremely happy with my idea. <br><br>  Now it is the turn to write and try the parser code based on the finite state machine.  We have 7 states: <br><ul><li>  reading space between jobs, starts with a blank line </li><li>  Reading the line with the number of the task, in which the number of the correct answer and the level of complexity, begins with "Number" </li><li>  reading the text of the task, begins with the "Task" </li><li>  reading the text of the answer number 1, begins with "Answers: 1)." </li><li>  reading the text of the answer number 2, begins with "2)." </li><li>  ... </li><li>  reading the text of the answer number 5, begins with "5)." </li></ul><br>  We implement using the conditions of the beginning of the next state.  After testing the first version of the parser, everything went great.  Pictures were obtained as in the very word of the document, pretty, large.  But here ... from time to time shoals appeared, for example, in one picture an extra piece was captured until the next block of the task.  So the parser did not recognize correctly.  What is the matter?  Everything turned out to be simple - the tasks in the word document were typed by hand and therefore there was a human factor, for example: <br><ul><li>  instead of "Task" was written "Task" </li><li>  instead of "Answers" was written "Answer" </li><li>  instead of "1)." was written "1)." or "1)" or even "1)." </li></ul><br>  It was a nightmare.  Fortunately, the main mistakes were in the writing of numbers of tasks; at least they were taken into account by the parser.  The remaining errors after extracting the images were found by a cursory scan of the largest and smallest in size images, followed by correction and re-extraction. <br><br>  The final piece of the parser is the code below.  He is terrible, please do not judge strictly.  To store VBA objects, QAxObject is used. <br><br><div class="spoiler">  <b class="spoiler_title">Explanations of variable names, state of the automaton, additional functions used</b> <div class="spoiler_text"><ul><li>  status - state of the machine: <br><ul><li>  -3 - between tasks </li><li>  -2 - inside task number </li><li>  -1 - inside the job </li><li>  0 - after the word Answers </li><li>  1 - inside answer 1 </li><li>  2 - inside answer 2 </li><li>  3 - inside answer 3 </li><li>  4 - inside answer 4 </li><li>  5 - inside answer 5 </li></ul><br></li><li>  startind - position of the beginning of the current block (task, response, line with the number of the correct answer and the level of complexity) </li><li>  n is the ordinal number of the task </li><li>  nstr - the string of the serial number of the job with leading zeros to three digits </li><li>  str - the current block string to the current position </li><li>  lineStart, lineEnd - position numbers of the beginning and end of the current paragraph </li><li>  lines - the object of the collection of paragraphs of the document </li><li>  tline - the current paragraph object </li><li>  line - Range object of the current paragraph </li><li>  ipar - current paragraph number </li><li>  tmpObj - the range object of the current character </li><li>  currChar - current character </li><li>  outdir - the path of the output folder of the images </li><li>  getAnswerLine (QString) function - returns a string of two numbers: difficulty level (1-3) and correct answer number (1-5), for example, 24 is a task with difficulty level B and correct answer number 4 </li><li>  the rangeToEmfFile function (QString fname, int start, int end, QAxObject * activeDoc) - saves a piece of the document between the start and end positions of the activeDoc document as an EMF file with the name fname </li></ul><br></div></div><div class="spoiler">  <b class="spoiler_title">Awful, long code</b> <div class="spoiler_text"><pre> <code class="cpp hljs">QAxObject *activeDoc = wordApp-&gt;querySubObject(<span class="hljs-string"><span class="hljs-string">"ActiveDocument"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> status = <span class="hljs-number"><span class="hljs-number">-3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> startind = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n=<span class="hljs-number"><span class="hljs-number">0</span></span>; QString nstr; QString str = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> lineStart, lineEnd; QAxObject *lines = activeDoc-&gt;querySubObject(<span class="hljs-string"><span class="hljs-string">"Paragraphs"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (onlyAsnwers) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ipar = <span class="hljs-number"><span class="hljs-number">1</span></span>; ipar &lt;= lines-&gt;property(<span class="hljs-string"><span class="hljs-string">"Count"</span></span>).toInt(); ipar++){ QAxObject *tline = lines-&gt;querySubObject(<span class="hljs-string"><span class="hljs-string">"Item(QVariant)"</span></span>, ipar); QAxObject *line = tline-&gt;querySubObject(<span class="hljs-string"><span class="hljs-string">"Range"</span></span>); QString str = line-&gt;property(<span class="hljs-string"><span class="hljs-string">"Text"</span></span>).toString(); line-&gt;clear(); <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> line; tline-&gt;clear(); <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> tline; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ind = str.indexOf(<span class="hljs-string"><span class="hljs-string">":"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ind != <span class="hljs-number"><span class="hljs-number">-1</span></span>){ str = str.mid(ind+<span class="hljs-number"><span class="hljs-number">6</span></span>); answersTxt &lt;&lt; getAnswerLine(str); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ipar = <span class="hljs-number"><span class="hljs-number">1</span></span>; ipar &lt;= lines-&gt;property(<span class="hljs-string"><span class="hljs-string">"Count"</span></span>).toInt(); ipar++){ QAxObject *tline = lines-&gt;querySubObject(<span class="hljs-string"><span class="hljs-string">"Item(QVariant)"</span></span>, ipar); QAxObject *line = tline-&gt;querySubObject(<span class="hljs-string"><span class="hljs-string">"Range"</span></span>); lineStart = line-&gt;property(<span class="hljs-string"><span class="hljs-string">"Start"</span></span>).toInt(); lineEnd = line-&gt;property(<span class="hljs-string"><span class="hljs-string">"End"</span></span>).toInt(); line-&gt;clear(); <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> line; tline-&gt;clear(); <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> tline; str = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j=lineStart; j&lt;lineEnd; j++){ QAxObject *tmpObj = activeDoc-&gt;querySubObject(<span class="hljs-string"><span class="hljs-string">"Range(QVariant,QVariant)"</span></span>, j, j+<span class="hljs-number"><span class="hljs-number">1</span></span>); QString currChar = tmpObj-&gt;property(<span class="hljs-string"><span class="hljs-string">"Text"</span></span>).toString(); tmpObj-&gt;clear(); <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> tmpObj; str += currChar; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (status){ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">-3</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (j&gt;=<span class="hljs-number"><span class="hljs-number">4</span></span> &amp;&amp; str.right(<span class="hljs-number"><span class="hljs-number">5</span></span>) == <span class="hljs-string"><span class="hljs-string">""</span></span>){ status = <span class="hljs-number"><span class="hljs-number">-2</span></span>; startind = j+<span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">-2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (str.right(<span class="hljs-number"><span class="hljs-number">6</span></span>) == <span class="hljs-string"><span class="hljs-string">""</span></span>){ n++; nstr = QString::number(n); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (nstr.length() &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>) nstr = <span class="hljs-string"><span class="hljs-string">"0"</span></span> + nstr; status = <span class="hljs-number"><span class="hljs-number">-1</span></span>; QAxObject *tmpObj = activeDoc-&gt;querySubObject(<span class="hljs-string"><span class="hljs-string">"Range(QVariant,QVariant)"</span></span>, startind, j<span class="hljs-number"><span class="hljs-number">-6</span></span>); QString tmp = tmpObj-&gt;property(<span class="hljs-string"><span class="hljs-string">"Text"</span></span>).toString(); tmpObj-&gt;clear(); <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> tmpObj; answersTxt &lt;&lt; getAnswerLine(tmp); startind = j+<span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (str.right(<span class="hljs-number"><span class="hljs-number">7</span></span>) == <span class="hljs-string"><span class="hljs-string">""</span></span>){ n++; nstr = QString::number(n); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (nstr.length() &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>) nstr = <span class="hljs-string"><span class="hljs-string">"0"</span></span> + nstr; status = <span class="hljs-number"><span class="hljs-number">-1</span></span>; QAxObject *tmpObj = activeDoc-&gt;querySubObject(<span class="hljs-string"><span class="hljs-string">"Range(QVariant,QVariant)"</span></span>, startind, j<span class="hljs-number"><span class="hljs-number">-7</span></span>); QString tmp = tmpObj-&gt;property(<span class="hljs-string"><span class="hljs-string">"Text"</span></span>).toString(); tmpObj-&gt;clear(); <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> tmpObj; answersTxt &lt;&lt; getAnswerLine(tmp); startind = j+<span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (str.right(<span class="hljs-number"><span class="hljs-number">7</span></span>) == <span class="hljs-string"><span class="hljs-string">":"</span></span>){ status = <span class="hljs-number"><span class="hljs-number">0</span></span>; rangeToEmfFile(outdir+nstr+<span class="hljs-string"><span class="hljs-string">".emf"</span></span>, startind, j<span class="hljs-number"><span class="hljs-number">-7</span></span>, activeDoc); startind = j+<span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (str.right(<span class="hljs-number"><span class="hljs-number">6</span></span>) == <span class="hljs-string"><span class="hljs-string">":"</span></span>){ status = <span class="hljs-number"><span class="hljs-number">0</span></span>; rangeToEmfFile(outdir+nstr+<span class="hljs-string"><span class="hljs-string">".emf"</span></span>, startind, j<span class="hljs-number"><span class="hljs-number">-6</span></span>, activeDoc); startind = j+<span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (str.right(<span class="hljs-number"><span class="hljs-number">2</span></span>) == <span class="hljs-string"><span class="hljs-string">"1)"</span></span> || str.right(<span class="hljs-number"><span class="hljs-number">3</span></span>) == <span class="hljs-string"><span class="hljs-string">"1 )"</span></span>){ status = <span class="hljs-number"><span class="hljs-number">1</span></span>; startind = j+<span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (str.right(<span class="hljs-number"><span class="hljs-number">2</span></span>) == <span class="hljs-string"><span class="hljs-string">"2)"</span></span>){ rangeToEmfFile(outdir+nstr+<span class="hljs-string"><span class="hljs-string">".1.emf"</span></span>, startind, j<span class="hljs-number"><span class="hljs-number">-2</span></span>, activeDoc); status = <span class="hljs-number"><span class="hljs-number">2</span></span>; startind = j+<span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (str.right(<span class="hljs-number"><span class="hljs-number">3</span></span>) == <span class="hljs-string"><span class="hljs-string">"2 )"</span></span>){ rangeToEmfFile(outdir+nstr+<span class="hljs-string"><span class="hljs-string">".1.emf"</span></span>, startind, j<span class="hljs-number"><span class="hljs-number">-3</span></span>, activeDoc); status = <span class="hljs-number"><span class="hljs-number">2</span></span>; startind = j+<span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (str.right(<span class="hljs-number"><span class="hljs-number">2</span></span>) == <span class="hljs-string"><span class="hljs-string">"3)"</span></span>){ rangeToEmfFile(outdir+nstr+<span class="hljs-string"><span class="hljs-string">".2.emf"</span></span>, startind, j<span class="hljs-number"><span class="hljs-number">-2</span></span>, activeDoc); status = <span class="hljs-number"><span class="hljs-number">3</span></span>; startind = j+<span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (str.right(<span class="hljs-number"><span class="hljs-number">3</span></span>) == <span class="hljs-string"><span class="hljs-string">"3 )"</span></span>){ rangeToEmfFile(outdir+nstr+<span class="hljs-string"><span class="hljs-string">".2.emf"</span></span>, startind, j<span class="hljs-number"><span class="hljs-number">-3</span></span>, activeDoc); status = <span class="hljs-number"><span class="hljs-number">3</span></span>; startind = j+<span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (str.right(<span class="hljs-number"><span class="hljs-number">2</span></span>) == <span class="hljs-string"><span class="hljs-string">"4)"</span></span>){ rangeToEmfFile(outdir+nstr+<span class="hljs-string"><span class="hljs-string">".3.emf"</span></span>, startind, j<span class="hljs-number"><span class="hljs-number">-2</span></span>, activeDoc); status = <span class="hljs-number"><span class="hljs-number">4</span></span>; startind = j+<span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (str.right(<span class="hljs-number"><span class="hljs-number">3</span></span>) == <span class="hljs-string"><span class="hljs-string">"4 )"</span></span>){ rangeToEmfFile(outdir+nstr+<span class="hljs-string"><span class="hljs-string">".3.emf"</span></span>, startind, j<span class="hljs-number"><span class="hljs-number">-3</span></span>, activeDoc); status = <span class="hljs-number"><span class="hljs-number">4</span></span>; startind = j+<span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (str.right(<span class="hljs-number"><span class="hljs-number">2</span></span>) == <span class="hljs-string"><span class="hljs-string">"5)"</span></span>){ rangeToEmfFile(outdir+nstr+<span class="hljs-string"><span class="hljs-string">".4.emf"</span></span>, startind, j<span class="hljs-number"><span class="hljs-number">-2</span></span>, activeDoc); status = <span class="hljs-number"><span class="hljs-number">5</span></span>; startind = j+<span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (str.right(<span class="hljs-number"><span class="hljs-number">3</span></span>) == <span class="hljs-string"><span class="hljs-string">"5 )"</span></span>){ rangeToEmfFile(outdir+nstr+<span class="hljs-string"><span class="hljs-string">".4.emf"</span></span>, startind, j<span class="hljs-number"><span class="hljs-number">-3</span></span>, activeDoc); status = <span class="hljs-number"><span class="hljs-number">5</span></span>; startind = j+<span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (j&gt;=<span class="hljs-number"><span class="hljs-number">4</span></span> &amp;&amp; str.right(<span class="hljs-number"><span class="hljs-number">5</span></span>) == <span class="hljs-string"><span class="hljs-string">""</span></span>){ rangeToEmfFile(outdir+nstr+<span class="hljs-string"><span class="hljs-string">".5.emf"</span></span>, startind, j<span class="hljs-number"><span class="hljs-number">-5</span></span>, activeDoc); status = <span class="hljs-number"><span class="hljs-number">-2</span></span>; str = <span class="hljs-string"><span class="hljs-string">""</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lineEnd-lineStart &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>){ rangeToEmfFile(outdir+nstr+<span class="hljs-string"><span class="hljs-string">".5.emf"</span></span>, startind, j, activeDoc); status = <span class="hljs-number"><span class="hljs-number">-3</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (status == <span class="hljs-number"><span class="hljs-number">5</span></span>) rangeToEmfFile(outdir+nstr+<span class="hljs-string"><span class="hljs-string">".5.emf"</span></span>, startind, lineEnd, activeDoc); } lines-&gt;clear(); <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> lines; activeDoc-&gt;clear(); <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> activeDoc;</code> </pre><br></div></div><br>  The logic of the above code is slightly different from the one described above.  It also uses paragraph breaks.  But this does not greatly change the main idea. <br><br>  This is how it came to ‚Äúconquer‚Äù this Word! <br><br><h3>  Conclusion </h3><br>  As a result, all tasks in the amount of ~ 4 thousand were retrieved. The necessary parser shell was written.  The program for downloading tasks to the remote database and its administration has also been written.  The fee was received, her diploma is protected perfectly, mine is also protected perfectly. <br><br>  Thank you for your attention, I hope this post will help someone with a similar problem.  Or maybe someone knows the best implementation? <br><br>  Update: <br><div class="spoiler">  <b class="spoiler_title">A couple of pictures of the result</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/3f0/269/942/3f026994273f482bbbe0469e2c4c3888.PNG"><br><img src="https://habrastorage.org/files/aef/a40/740/aefa40740ad24999a2b2824c33345cf1.PNG"><br><img src="https://habrastorage.org/files/f04/2e5/809/f042e5809eda428d9072dd8855796b00.PNG"><br><img src="https://habrastorage.org/files/fb8/927/5d7/fb89275d7f164540a52eba659e92c65f.PNG"><br></div></div></div><p>Source: <a href="https://habr.com/ru/post/264443/">https://habr.com/ru/post/264443/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../264433/index.html">Natural genetic algorithm or evidence of the evolution of living organisms in C ++</a></li>
<li><a href="../264435/index.html">Implementing multilingualism on Laravel 5 by the framework</a></li>
<li><a href="../264437/index.html">The digest of interesting materials from the world of web development and IT for the last week? 171 (August 3 - 10, 2015)</a></li>
<li><a href="../264439/index.html">PAP - old, but not useless !?</a></li>
<li><a href="../264441/index.html">ARM programming on Pascal</a></li>
<li><a href="../264445/index.html">How does ecology affect data center cooling</a></li>
<li><a href="../264447/index.html">The realities of SharePoint migration to the cloud</a></li>
<li><a href="../264449/index.html">Cloud for developer companies, release one: Azure Marketplace - a store of services and solutions for every taste</a></li>
<li><a href="../264451/index.html">On limitations in the applicability of the Minkowski metric in digital data processing</a></li>
<li><a href="../264453/index.html">Cyber ‚Äã‚Äãgroup Hacking Team specialized in compromising Apple iDevice without jailbreak</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>