<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Depla: Nginx, Puma and Mina</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this small article I would like to show the configuration of Rails - an application running on Nginx with Puma and how this is all deployed using M...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Depla: Nginx, Puma and Mina</h1><div class="post__text post__text-html js-mediator-article">  In this small article I would like to show the configuration of Rails - an application running on Nginx with Puma and how this is all deployed using Mina. <br><a name="habracut"></a><br>  We will assume that you have already installed the whole environment on your server, except for the above-mentioned things (I prefer to put ruby ‚Äã‚Äãthrough rbenv, therefore the above configs for Mina will be intended for him.) <br><br>  <b>Mina</b> <br>  Putting Mina is very simple - we put gems and that's it (there is no need to place the installation in the Gemfile): <br>  <i>gem install mina</i> <br><br>  Then enter the command: <br>  <i>mina init</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This command will generate a config / deploy.rb file that will contain the minimum required configuration. <br>  Remember that git you need to be configured or (in extreme cases) login and password from the repository can be written directly in the config file Mina, as shown in the example.  You must have all the settings that relate to databases.  I also want to note that if you have not created any folders / files listed in the config, you need to create them. <br>  Full configuration example: <br><div class="spoiler">  <b class="spoiler_title">deploy.rb</b> <div class="spoiler_text"><pre><code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">'mina/bundler'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">'mina/rails'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">'mina/git'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">'mina/rbenv'</span></span> lock <span class="hljs-string"><span class="hljs-string">'3.2.1'</span></span> set <span class="hljs-symbol"><span class="hljs-symbol">:user</span></span>, <span class="hljs-string"><span class="hljs-string">'admin'</span></span> set <span class="hljs-symbol"><span class="hljs-symbol">:domain</span></span>, <span class="hljs-string"><span class="hljs-string">'100.100.100.100'</span></span> set <span class="hljs-symbol"><span class="hljs-symbol">:identity_file</span></span>, <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{ENV[</span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">'HOME'</span></span></span></span><span class="hljs-string"><span class="hljs-subst">]}</span></span></span><span class="hljs-string">/.ssh/google"</span></span> set <span class="hljs-symbol"><span class="hljs-symbol">:deploy_to</span></span>, <span class="hljs-string"><span class="hljs-string">'/var/www/admin_app'</span></span> set <span class="hljs-symbol"><span class="hljs-symbol">:app_path</span></span>, lambda { <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{deploy_to}</span></span></span><span class="hljs-string">/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{current_path}</span></span></span><span class="hljs-string">"</span></span> } set <span class="hljs-symbol"><span class="hljs-symbol">:repository</span></span>, <span class="hljs-string"><span class="hljs-string">'https://admin:admin@github.com/Admin_app.git'</span></span> set <span class="hljs-symbol"><span class="hljs-symbol">:branch</span></span>, <span class="hljs-string"><span class="hljs-string">'master'</span></span> set <span class="hljs-symbol"><span class="hljs-symbol">:forward_agent</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span> set <span class="hljs-symbol"><span class="hljs-symbol">:rbenv_path</span></span>, <span class="hljs-string"><span class="hljs-string">'/home/admin/.rbenv/'</span></span> set <span class="hljs-symbol"><span class="hljs-symbol">:shared_paths</span></span>, [<span class="hljs-string"><span class="hljs-string">'config/database.yml'</span></span>, <span class="hljs-string"><span class="hljs-string">'log'</span></span>] task <span class="hljs-symbol"><span class="hljs-symbol">:environment</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> invoke <span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">'rbenv:load'</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> task <span class="hljs-symbol"><span class="hljs-symbol">:setup</span></span> =&gt; <span class="hljs-symbol"><span class="hljs-symbol">:environment</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> queue! <span class="hljs-string"><span class="hljs-string">%[mkdir -p "</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{deploy_to}</span></span></span><span class="hljs-string">/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{shared_path}</span></span></span><span class="hljs-string">/log"]</span></span> queue! <span class="hljs-string"><span class="hljs-string">%[chmod g+rx,u+rwx "</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{deploy_to}</span></span></span><span class="hljs-string">/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{shared_path}</span></span></span><span class="hljs-string">/log"]</span></span> queue! <span class="hljs-string"><span class="hljs-string">%[mkdir -p "</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{deploy_to}</span></span></span><span class="hljs-string">/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{shared_path}</span></span></span><span class="hljs-string">/config"]</span></span> queue! <span class="hljs-string"><span class="hljs-string">%[chmod g+rx,u+rwx "</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{deploy_to}</span></span></span><span class="hljs-string">/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{shared_path}</span></span></span><span class="hljs-string">/config"]</span></span> queue! <span class="hljs-string"><span class="hljs-string">%[touch "</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{deploy_to}</span></span></span><span class="hljs-string">/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{shared_path}</span></span></span><span class="hljs-string">/config/database.yml"]</span></span> queue <span class="hljs-string"><span class="hljs-string">%[echo "-----&gt; Be sure to edit '</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{deploy_to}</span></span></span><span class="hljs-string">/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{shared_path}</span></span></span><span class="hljs-string">/config/database.yml'."]</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> desc <span class="hljs-string"><span class="hljs-string">"Deploys the current version to the server."</span></span> task <span class="hljs-symbol"><span class="hljs-symbol">:deploy</span></span> =&gt; <span class="hljs-symbol"><span class="hljs-symbol">:environment</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> to <span class="hljs-symbol"><span class="hljs-symbol">:before_hook</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-comment"><span class="hljs-comment"># Put things to run locally before ssh end deploy do invoke :'git:clone' invoke :'server:stop_server' invoke :'deploy:link_shared_paths' invoke :'bundle:install' invoke :'rails:db_migrate' invoke :'rails:assets_precompile' invoke :'deploy:cleanup' to :launch do queue "mkdir -p #{deploy_to}/#{current_path}/tmp/" queue "touch #{deploy_to}/#{current_path}/tmp/restart.txt" invoke :'server:start_server' end end end namespace :server do desc 'Stop server' task :stop_server do queue 'echo "-----&gt; Stop Server"' queue 'kill -9 $(lsof -i :3000 -t) || true' queue '[ -f /var/www/admin/admin_app.pid ] &amp;&amp; rm /var/www/admin/admin_app.pid || echo "File admin_app.pid not exist"' end desc 'Start server' task :start_server do queue 'echo "-----&gt; Start Server"' queue! 'rails s -b 0.0.0.0 -e production -P /var/www/admin/admin_app.pid -d &amp;' end end</span></span></code> </pre> <br></div></div><br>  After you have verified that your deploy.rb file looks like the truth and seems to work, you need to enter the command: <br>  <i>mina setup</i> <br><br>  This command will create the necessary infrastructure of folders inside the root folder for your application (in the config it is / var / www / admin_app). <br>  Make sure the database.yml file contains the information and it is correct.  The file is in / var / www / myapp / shared / config. <br>  Next, enter: <br>  <i>mina deploy</i> <br><br>  If this operation was successful, your application will wait for you along the path: / var / www / admin_app. <br><br>  You can easily expand your deployment by writing tasks to deploy.rb and calling them inside: deploy =&gt;: environment. <br>  For example, we will write two tasks for starting and stopping resque - workers. <br><div class="spoiler">  <b class="spoiler_title">Task'i for resque</b> <div class="spoiler_text"><pre> <code class="ruby hljs">desc <span class="hljs-string"><span class="hljs-string">'Start resque-workers'</span></span> task <span class="hljs-symbol"><span class="hljs-symbol">:start_workers</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> queue <span class="hljs-string"><span class="hljs-string">'echo "-----&gt; Start resque-workers"'</span></span> queue <span class="hljs-string"><span class="hljs-string">"cd </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{app_path}</span></span></span><span class="hljs-string"> &amp;&amp; RAILS_ENV=</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{stage}</span></span></span><span class="hljs-string"> &amp;&amp; touch resque.pid"</span></span> queue <span class="hljs-string"><span class="hljs-string">"cd </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{app_path}</span></span></span><span class="hljs-string"> &amp;&amp; bundle exec rake resque:work QUEUE=contacts_adder BACKGROUND=yes TERM_CHILD=1"</span></span> queue <span class="hljs-string"><span class="hljs-string">"cd </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{app_path}</span></span></span><span class="hljs-string"> &amp;&amp; bundle exec rake resque:work QUEUE=photo_downloader BACKGROUND=yes TERM_CHILD=1"</span></span> <span class="hljs-comment"><span class="hljs-comment">#      queue 'echo "-----&gt; Start resque-scheduler"' queue "cd #{app_path} &amp;&amp; rake resque:scheduler BACKGROUND=yes VERBOSE=yes RAILS_ENV=production " end desc 'Stop resque-workers' task :stop_workers do queue 'echo "-----&gt; Stop resque-workers"' queue 'kill -9 `ps aux | grep [r]esque | grep -v grep | cut -c 10-16` || true' end</span></span></code> </pre><br></div></div><br>  You can view the list of available tasks using the command: <br>  <i>mina tasks</i> <br><br>  <b>Puma</b> <br>  To configure Puma, you will need two files: the configuration file puma.rb and the shell - a script intended for starting / stopping / restarting Puma. <br><br>  Create a file puma.rb in config /.  And fill it with the following information: <br><div class="spoiler">  <b class="spoiler_title">puma.rb</b> <div class="spoiler_text"><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env puma environment ENV['RAILS_ENV'] || 'production' pidfile "/var/www/admin/current/shared/tmp/pids/puma.pid" stdout_redirect "/var/www/admin/current/shared/tmp/log/stdout", "/var/www/admin/current/shared/tmp/log/stderr" threads 2, 16 workers 2 bind "unix:///var/www/admin/current/shared/tmp/sockets/puma.sock" daemonize true</span></span></code> </pre><br></div></div><br>  Carefully check the path when filling configs! <br><br>  Create a file bin / puma.sh.  Fill it in: <br><div class="spoiler">  <b class="spoiler_title">puma.sh</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#! /bin/sh PUMA_CONFIG_FILE=/var/www/admin/current/config/puma.rb PUMA_PID_FILE=/var/www/admin/current/shared/tmp/pids/puma.pid PUMA_SOCKET=/var/www/admin/current/shared/tmp/sockets/puma.sock # check if puma process is running puma_is_running() { if [ -e $PUMA_SOCKET ] ; then if [ -r $PUMA_PID_FILE ] ; then if ps -p `cat $PUMA_PID_FILE` &gt; /dev/null; then return 0 else echo "No puma process found" fi else echo "No puma pid file found" fi else echo "No puma socket found" fi return 1 } case "$1" in start) echo "Starting puma..." if [ -e $PUMA_SOCKET ] ; then # if socket exists rm -f $PUMA_SOCKET echo "removed $PUMA_SOCKET" fi if [ -e $PUMA_CONFIG_FILE ] ; then echo "config" bundle exec puma -C $PUMA_CONFIG_FILE else echo "socket" bundle exec puma --daemon --bind unix://$PUMA_SOCKET --pidfile $PUMA_PID_FILE fi echo "done" ;; stop) echo "Stopping puma..." kill -s SIGTERM `cat $PUMA_PID_FILE` rm -f $PUMA_PID_FILE rm -f $PUMA_SOCKET echo "done" ;; restart) if puma_is_running ; then echo "Hot-restarting puma..." kill -s SIGUSR2 `cat $PUMA_PID_FILE` echo "Doublechecking the process restart..." sleep 5 if puma_is_running ; then echo "done" exit 0 else echo "Puma restart failed :/" exit 1 fi fi echo "Trying cold reboot" bin/puma.sh start ;; *) echo "Usage: script/puma.sh {start|stop|restart}" &gt;&amp;2 ;; esac</span></span></code> </pre><br></div></div><br>  Now we add the Puma settings to the deploy.rb file: <br><div class="spoiler">  <b class="spoiler_title">Task for puma</b> <div class="spoiler_text"><pre> <code class="ruby hljs">namespace <span class="hljs-symbol"><span class="hljs-symbol">:puma</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> desc <span class="hljs-string"><span class="hljs-string">'Start the application'</span></span> task <span class="hljs-symbol"><span class="hljs-symbol">:start</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> queue <span class="hljs-string"><span class="hljs-string">'echo "-----&gt; Start Puma"'</span></span> queue <span class="hljs-string"><span class="hljs-string">"cd </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{app_path}</span></span></span><span class="hljs-string"> &amp;&amp; RAILS_ENV=</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{stage}</span></span></span><span class="hljs-string"> &amp;&amp; bin/puma.sh start"</span></span> , <span class="hljs-symbol"><span class="hljs-symbol">:pty</span></span> =&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> desc <span class="hljs-string"><span class="hljs-string">'Stop the application'</span></span> task <span class="hljs-symbol"><span class="hljs-symbol">:stop</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> queue <span class="hljs-string"><span class="hljs-string">'echo "-----&gt; Stop Puma"'</span></span> queue <span class="hljs-string"><span class="hljs-string">"cd </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{app_path}</span></span></span><span class="hljs-string"> &amp;&amp; RAILS_ENV=</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{stage}</span></span></span><span class="hljs-string"> &amp;&amp; bin/puma.sh stop"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> desc <span class="hljs-string"><span class="hljs-string">'Restart the application'</span></span> task <span class="hljs-symbol"><span class="hljs-symbol">:restart</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> queue <span class="hljs-string"><span class="hljs-string">'echo "-----&gt; Restart Puma"'</span></span> queue <span class="hljs-string"><span class="hljs-string">"cd </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{app_path}</span></span></span><span class="hljs-string"> &amp;&amp; RAILS_ENV=</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{stage}</span></span></span><span class="hljs-string"> &amp;&amp; bin/puma.sh restart"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br></div></div><br>  Inside the block ‚Äúto: launch do‚Äù (before starting the server) we write: <br><pre> <code class="ruby hljs">invoke <span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">'puma:restart'</span></span></span></span></code> </pre><br>  Remember to make the puma.sh file executable: <br>  <i>chmod + x bin / puma.sh</i> <br><br>  And re-produce warmly: <br>  <i>mina deploy</i> <br><br>  <b>Nginx</b> <br>  Nginx can be installed directly from the package manager: <br>  <i>sudo apt-get install nginx</i> <br><br>  After nginx is installed, you need to remove the default site. <br>  <i>sudo rm /etc/nginx/conf.d/sites-enabled/default</i> <br><br>  Create the /etc/nginx/sites-available/my_app.conf file: <br><div class="spoiler">  <b class="spoiler_title">Nginx config</b> <div class="spoiler_text"><pre> <code class="bash hljs">upstream my_app { server unix:///var/www/admin/current/shared/tmp/sockets/puma.sock; } server { listen 80; server_name 100.100.100.100; <span class="hljs-comment"><span class="hljs-comment"># change to match your URL root /var/www/admin/current/public; location / { root /var/www/admin/current/public; try_files $uri @app; gzip_static on; expires max; proxy_read_timeout 150; add_header Cache-Control public; } location @app { proxy_pass http://my_app; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto http; proxy_set_header Host $http_host; proxy_redirect off; proxy_next_upstream error timeout invalid_header http_502; }</span></span></code> </pre><br></div></div><br>  If you suddenly have any problems, you can try to register these lines directly in the /etc/nginx/nginx.conf file.  Server information (server {}) must be located inside the http (http {}) block. <br><br>  Then create a link: <br>  <i>sudo ln -sf /etc/nginx/sites-available/my_app.conf /etc/nginx/sites-enabled/my_app.conf</i> <br><br>  And we will restart nginx'a: <br>  <i>sudo service nginx restart</i> <br><br>  That's all.  Enjoyable :) </div><p>Source: <a href="https://habr.com/ru/post/265459/">https://habr.com/ru/post/265459/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../265449/index.html">How I use PostCSS</a></li>
<li><a href="../265451/index.html">CSS3 hover effects. Step by step tutorial</a></li>
<li><a href="../265453/index.html">We write voice IVR menu in TCL language using Cisco IVR API</a></li>
<li><a href="../265455/index.html">Reversible Cyrillic transliteration</a></li>
<li><a href="../265457/index.html">Protection of negotiations. Anti-bugs and field indicators</a></li>
<li><a href="../265461/index.html">Another way to automatically invoke unit tests in the C language</a></li>
<li><a href="../265463/index.html">"I came to eat, and stayed to study at the Technopark." Student stories from our educational projects</a></li>
<li><a href="../265465/index.html">Big Data - the first experience of ED IB</a></li>
<li><a href="../265469/index.html">Publication of iFrame / HTML5 games on VKontakte. The basics</a></li>
<li><a href="../265471/index.html">Intel Parallel Studio XE 2016 - more free products</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>