<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Power Query: steroids for MS Excel and Power BI</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I want to talk about some of the features of a free and extremely useful, but still little-known add-in over MS Excel called Power Que...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Power Query: steroids for MS Excel and Power BI</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/39f/203/444/39f203444c527bc5284f942f902cf1a5.png" alt="image"><br><br>  In this article I want to talk about some of the features of a free and extremely useful, but still little-known add-in over MS Excel called <a href="http://s.40-02.ru/1NAtCJV">Power Query</a> . <br><br>  Power Query allows you to take data from various sources (such as csv, xls, json, text files, folders with these files, various databases, various api like Facebook opengraph, Google Analytics, Yandex.Metrica, CallTouch and much more) , create <u>repeatable processing sequences for</u> this data and load them into Excel tables or the data model itself. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And under the cut you can find the details of all this magnificence of possibilities. <br><a name="habracut"></a><br><h4>  Compatibility and technical details </h4><br>  Power Query is available for free for all versions of Windows Excel 2010, 2013 and is built in by default in Windows Excel 2016. For MacOS X users, Power Query is not available (however, even without this, Mac Excel is ugly and advanced users, including me, most often work with normal Excel through Parallels or running it on a remote Windows machine). <br><br>  Also, Power Query is built into a new business intelligence product, <a href="https://powerbi.microsoft.com/en-us/">Power BI</a> , and it is also rumored that Power Query will also appear as part of other Microsoft products.  Those.  Power Query is waiting for a bright future and it's time for the followers of Microsoft technologies (and not only) to master its development. <br><br><h4>  How does it work </h4><br>  After installing Power Query, a separate tab of the same name appears in the Excel 2010‚Äì2013 interface. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/71a/6ec/817/71a6ec817b2ce6eba6f4b143323c0899.png"><br><br><br>  In the new Excel 2016, the Power Query functionality is available on the Data tab, in the ‚ÄúGet &amp; Transform‚Äù block. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7d1/9d5/10a/7d19d510add60c14fd8763d658bf5cba.png"><br><br><br>  First, in the Excel interface, we select a specific data source, from where we need to get them, and the Power Query window itself opens with a preview of the first lines of the loaded data (area 1).  In the upper part of the window is the Ribbon with data processing commands (area 2).  And on the right side of the screen (area 3) we have a panel with a sequence of all actions that apply to the data. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/56c/b90/1cc/56cb901cc4f84488d6507221c8461ff6.png"><br><br><br><h4>  Power Query Features </h4><br>  Power Query has a lot of features and I want to highlight some of my favorites. <br><br>  As I wrote above, Power Query is remarkable in that it allows you to connect to a variety of data sources.  So it allows you to download data from CSV, TXT, XML, json files.  Moreover, the process of selecting download options for the same CSV files is more flexible and more convenient than it is implemented by standard Excel tools: the encoding is often selected correctly and the column separator character can be specified. <br><br><h4>  Combining files in a folder </h4><br>  Power Query is able to take data from the specified folder and merge their contents into single tables.  This can be useful, for example, if you periodically receive some specialized reports for a specific period of time, but the data for analysis is needed in the general table.  <a href="">Gif</a> <br><br><img src="https://habrastorage.org/files/d14/6eb/480/d146eb480c494c3f9dfa1cb642c53e78.gif"><br><br><h4>  Text functions </h4><br>  For columns from text in Power Query, by clicking on the buttons on the Ribbon, you can use such functions as: <br><ol><li>  Split a column by character or number of characters.  And unlike Excel, you can specify the maximum number of columns, as well as the direction from where you need to count the characters - on the left, on the right. </li><li>  Change the register of cells in a column </li><li>  Count the number of characters in the column cells. </li></ol><br><br><h4>  Numeric Functions </h4><br>  For columns with numeric values ‚Äã‚Äãby clicking on the buttons on the Ribbon, you can apply: <br><br><ol><li>  Arithmetic operations </li><li>  Erect to degree, calculate logarithms, factorials, roots </li><li>  Trigonometric operations </li><li>  Round to preset values </li><li>  Determine parity, etc. </li></ol><br><br><h4>  Functions for working with dates, time and duration </h4><br>  For columns with date and time values ‚Äã‚Äãby clicking on the buttons on the Ribbon, you can apply: <br><br><ol><li>  Automatic determination of the format of the entered date (in excel c this is a big pain) </li><li>  Retrieve in one click the number of the month, day of the week, the number of days or hours in the period, etc. </li></ol><br><br><h4>  Unpivot - Pivot </h4><br>  In the Power Query interface, there is a ‚ÄúUnpivot‚Äù function, which in one click allows you to bring data with one metric laid out in columns in periods into a form that will be convenient for use in pivot tables (I understand that it is difficult to write - see an example).  Also, there is a function with the reverse action of Pivot.  <a href="">Gif</a> <br><br><img src="https://habrastorage.org/files/91c/a6a/b6f/91ca6ab6f9884cd99ba4d052bb4a922b.gif"><br><br><h4>  Operation Merge - Death of WRT </h4><br>  The <a href="https://support.office.com/ru-ru/article/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D1%258F-%25D0%2592%25D0%259F%25D0%25A0-0bbc8083-26fe-4963-8ab8-93a18ad188a1">VLOOKUP</a> function is one of the most used functions in MS Excel.  It allows you to pull data into one table from another table using a single key.  And just for this function in Power Query there is a much more convenient alternative - the operation Merge.  With this operation, the connection of tables of several tables into one key (simple or composite key, when you need to find a match across several columns) is performed in just 7 mouse clicks without keyboard input. <br><br>  The Merge operation is an analogue of join in sql, and it can be configured to join different types - Inner (default), Left Outer, Right Outer, Full Outer. <br><br>  Upd. I was told here that Power Query doesn‚Äôt know how to do the Aproximate join, but it does.  True, out of the box there are no alternatives.  <a href="">Gif</a> <br><br><img src="https://habrastorage.org/files/c1f/57d/889/c1f57d889f884b03a817b220c33ab0fe.gif"><br><br><br><h4>  Connect to various databases.  Query Folding. </h4><br><br>  Power Query is also remarkable for being able to cling to a wide variety of databases - from MS SQL and MySQL to Postgres and HP Vertica.  At the same time, you do not even need to know SQL or another database language, because  A preview of the data is displayed in the Power Query interface and all those operations that are performed in the interface are transparently translated into the database query language. <br><br>  Power Query also has the concept of Query Folding: if you are connected to a compatible database (currently MS SQl), then Power Query will try to perform heavy data processing operations on the server side and take only processed data to itself.  This feature drastically improves the speed of many treatments. <br><br><h4>  Programming language <em>"M"</em> </h4><br>  Power Query add-on is an interpreter of a new, scripted, specialized for working with data, M programming language. <br><br>  For each action that we perform with the data in the Power Query GUI, we write a new line of code to the script.  Reflecting this, in a panel with a sequence of actions (area 3), a new step is created with a talking name.  Due to this, using the panel with a sequence of actions, we can always see how the data looks at us at each processing step, we can add new steps, change the settings of the applied operation at a specific step, change their order or delete unnecessary steps.  <a href="">Gif</a> <br><br><img src="https://habrastorage.org/files/a50/b9b/5ad/a50b9b5ada2d483e91181de15cbe753d.gif"><br><br>  Also, we can always see and edit the code of the written script itself.  And it will look like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0a1/d0a/9de/0a1d0a9de71786e86340a86e9e018cd1.png"><br><br><br>  The M language, unfortunately, is not similar to the formula language in Excel or to MDX and, fortunately, is not similar to Visual Basic.  However, it is very easy to learn and opens up tremendous possibilities for manipulating data that is not available using the graphical interface. <br><br><h4>  Downloading data from Yandex.Metrics, Google Analytics and other Api </h4><br>  Having mastered the ‚ÄúM‚Äù language a bit, I was able to write programs in Power Query that can connect to the Yandex.Metrics and Google Analytics API and take data from there with the specified settings.  I put the <a href="http://s.40-02.ru/1HRxJVe">PQYandexMetrika</a> and <a href="http://s.40-02.ru/1SUNpIK">PQGoogleAnalytics programs</a> in the open source on the githab under the GPL license.  I urge to use.  And I will be very happy if these programs are updated by enthusiasts. <br><br>  Google Analytics has quite a lot of such exporters in different implementations, but for Yandex.Metrica, as far as I know, my exporter was the first publicly available, and even free :) <br><br>  Power Query can generate headers for post and get requests and retrieve data from the Internet.  Because of this, with the proper level of skill, Power Query can be connected to almost any API.  In particular, for my research, I jerk data on customer phone calls from the CallTouch API, from the Rescuetime computer monitoring service API, and parse the web pages I need to retrieve relevant information. <br><br><h4>  Once again about repeatability and about applications </h4><br>  As I wrote above, the Power Query script is a repeatable sequence of manipulations applied to the data.  This means that once you have set up the processing you need, you can apply it to new files by changing just one step in the script - specifying the path to the new file.  Thanks to this, you can get rid of a huge amount of routine and free up time for productive work - data analysis. <br><br>  I do web analytics and contextual advertising.  And it just so happened that since I met Power Query in its interfaces, I spend more time than in Excel itself.  It's more comfortable for me.  At the same time, my consumption of another great add-in in MS Excel, PowerPivot, has also increased. <br><br>  Here are some of the tasks I do using Power Query: <br><ol><li>  parse semantics for Fat projects, </li><li>  I make frequency dictionaries, </li><li>  I create web analytic dashboards and reports for analyzing specific cuts, </li><li>  Restoring the achievement of goals in web analytics systems, if they are not configured on the project, </li><li>  I smooth the prediction of probability with the methods of Andrey Belousov (+ Bayes :), </li><li>  I do an audit of contextual advertising on data from K50 statistics, </li><li>  And many other different ad-hoc analysis tasks that need to be done only once </li></ol><br><br>  Here is the bi system that I talked about on Yac / M 2015 ( <a href="http://s.40-02.ru/1S3vsXs">video</a> ) I did with full Power Query and loaded the data inside PowerPivot. <br><br><h4>  A few words about localization </h4><br>  On the Microsoft website for users from Russia, Power Query is downloaded by default with the interface translated into Russian.  Fortunately, localizers did not get to the translation into Russian of the programming language (as it is done with the language of formulas in excel), however, the life of users with ambiguous translations made it very difficult.  And I urge you to download, install and use the English version of Power Query.  Believe me, it will be much clearer. <br><br><h4>  Related Links </h4><br><br>  Official resources in English: <br><br><ol><li>  <a href="http://s.40-02.ru/1NAtCJV">Download English version of Power Query</a> </li><li>  <a href="http://s.40-02.ru/1NAtvhp">M Formula Help</a> </li><li>  <a href="http://s.40-02.ru/1NAtZUK">Microsoft Technet Forum branch about Power Query</a> </li></ol><br><br>  At the time of writing the article in Russian, there is practically no information on Power Query, and what I found is shown below: <br><ol><li>  <a href="http://s.40-02.ru/1NAtnyA">Import data from spreadsheets to Google Spreadsheets</a> </li><li>  <a href="https://habrahabr.ru/company/microsoft/blog/264645/">Power BI.</a>  <a href="https://habrahabr.ru/company/microsoft/blog/264645/">Get data from REST API</a> </li><li>  <a href="http://s.40-02.ru/1NAtD0m">Advanced Excel, Power Pivot and Power Query Facebook Community</a> </li><li>  <a href="http://marketing-wiki.ru/wiki/Power_Query">Updated page in the Marketing-wiki about Power Query</a> </li></ol><br><br>  In English: <br><ol><li>  <a href="http://s.40-02.ru/1NAu7DV">Video demonstrating Power Query features at TechEd North America</a> </li><li>  <a href="http://s.40-02.ru/1NAtHx8">Blog Chris Webb, perhaps the most complete resource with examples of using Power Query</a> </li><li>  <a href="http://s.40-02.ru/1NAtWZi">Book Chris Webb - Power Query for Power BI and Excel</a> </li><li>  <a href="http://s.40-02.ru/1NAtWZ2">Ken Puls blog</a> </li><li>  <a href="https://learn.needfordata.ru/excel">The course "Excel for Internet Marketing"</a> </li><li>  <a href="http://s.40-02.ru/1NAtUR4">Ken Puls and Miguel Escobar - M is for Data Monkey</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/271019/">https://habr.com/ru/post/271019/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../271007/index.html">Moff.js and modulated Bootstrap</a></li>
<li><a href="../271011/index.html">Cross-compiling and building a package under Synology DSM</a></li>
<li><a href="../271013/index.html">Preparing FMOD, Cocos2D-x, OpenAL and OpenSSL libraries for Android devices built on the Intel platform</a></li>
<li><a href="../271015/index.html">We write our own interface management corporate FMC SIM-cards</a></li>
<li><a href="../271017/index.html">Different chips for office automation: intercoms, curtains, lighting, and so on</a></li>
<li><a href="../271021/index.html">Why does WhatsApp collect and store confidential information about the user and their conversations?</a></li>
<li><a href="../271023/index.html">Data transfer to Russia. Short FAQ on Misconceptions</a></li>
<li><a href="../271025/index.html">Spring 4 MVC, Hibernate: many to many association</a></li>
<li><a href="../271031/index.html">VK Open Api CSRF vulnerability, which allows to get Access Tokens of third-party sites that use authorization via VK</a></li>
<li><a href="../271033/index.html">How to implement a SOAP service for working with Google tables through SQL</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>