<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Review Board + Mercurial - experience in implementing and automating the process code review</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some time ago in the company where I work in connection with the expansion of the team, it was decided to introduce the code review process. The choic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Review Board + Mercurial - experience in implementing and automating the process code review</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/8fc/177/df9/8fc177df9df188d430181ca10e339c74.jpg" alt="mercurial-review-board" align="left">  Some time ago in the company where I work in connection with the expansion of the team, it was decided to introduce the code review process.  The choice of instrument fell on the <a href="http://www.reviewboard.org/">Review Board</a> - the product has sufficient functionality, has been actively developed since 2006 and is open source.  We use Mercurial as our version control system. <br><br>  About what tasks the review code for the bundle Review Board + Mercurial - under the cat faced with when organizing the process. <br><a name="habracut"></a><br>  And so, we began with server deployment.  Unfortunately, information on server requirements on the RB website could not be found.  After getting acquainted with the results of the search on the topic, it became clear that the main parameter in which the RB ‚Äúrests‚Äù is the RAM.  Most often, the figure ‚Äú4GB‚Äù was mentioned as a ‚Äúcomfortable volume‚Äù.  We started with 2, but the RB didn‚Äôt ‚Äúfly up‚Äù on them - while viewing diffs, the error ‚ÄúCan not allocate memory‚Äù now and again crashed.  Raised to 4GB and everything went like clockwork. <br><br>  Then began the <a href="http://www.reviewboard.org/docs/manual/1.7/admin/configuration/">process of setting up</a> and <a href="http://www.reviewboard.org/docs/manual/1.7/users/getting-started/workflow/">introducing the process of the code review</a> on the docks off.  site. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Everything went more or less smoothly until we reached the choice of a tool for publishing a review.  The choice was between the official tool from the Review Board team - <a href="http://www.reviewboard.org/docs/manual/1.7/users/tools/post-review/">post-review</a> and the <a href="http://mercurial.selenic.com/wiki/ReviewboardExtension">plugin for Mercurial</a> <br>  The official tool has a clear advantage - it is supported by Review Board developers, while its main drawback is that it does not have a GUI.  The plugin is sharpened specifically for Mercurial, so it has some advantages over post-review, but its main advantage is the integration into TortoiseHg GUI.  Since most developers are sitting on TortoiseHg, it was decided to use the plugin. <br>  Acquainted with the dock plugin - everything seems to be smooth.  The main version was downloaded (another alternative is offered on the page), which at that moment was still hosted by <a href="https://code.google.com/p/mercurial-reviewboard/">Google Code</a> .  We tried to use it - and it was not there - it was in a very deplorable state - bugs were crawling, and compatibility with the latest versions of Mercurial was not complete.  They put <a href="https://bitbucket.org/mdelagra/mercurial-reviewboard">an alternative</a> - things went better, but she didn‚Äôt have full compatibility with Mercurial&gt; = 2.3 either.  But we did not lose hope and by digging in forks, a <a href="https://bitbucket.org/windix/mercurial-reviewboard">worker</a> was discovered!  But there were problems with it - for some reason, some users constantly dumped a 404 error when trying to post a revision, both from under a virtual machine with Unix, and from under a ‚Äúreal‚Äù piece of hardware with Windows.  There were still some minor glitches, now I do not remember.  At that time, there was no time to deal with this, so they used what they had. <br><br>  This went on for a good half a year.  During this time, we realized that the formed posting revision process takes a lot of time, and some users forgot (and some were killed) to post a review.  Therefore, it was decided to automate the process as much as possible. <br><br>  Rush information about this, the following plan was adopted: <br><br><ul><li>  Clone on the server running 24/7 our repository </li><li>  We launch on schedule pull repository </li><li>  We hang on the <a href="http://hgbook.red-bean.com/read/handling-repository-events-with-hooks.html">incoming</a> Mercurial-a <a href="http://hgbook.red-bean.com/read/handling-repository-events-with-hooks.html">hook with</a> a script that will automatically post a review for each ‚Äútightened‚Äù commit </li></ul><br>  In the process of thinking through the implementation, we realized that we would need the opportunity to post a review on behalf of another user.  The plug-in to Mercurial did not know how.  In the hope of a miracle, we go to <a href="http://mercurial.selenic.com/wiki/ReviewboardExtension">the plug-</a> in <a href="http://mercurial.selenic.com/wiki/ReviewboardExtension">page on the Mercury website</a> and ... do not believe our eyes - the plug-in came to life and began to develop!  The official repository <a href="https://bitbucket.org/ccaughie/hgreviewboard">moved to bitbucket</a> , the plugin now works with the latest version of Mercurial, and also supports posting a review on behalf of another user.  Inspired, started to implement. <br><br>  So, how it is implemented (all actions occur on the server c CentOS 6.3). <br><br><ol><li>  We're putting our repo in the folder ~ / home / viktor / autoreview / gdam_frontend / </li><li>  Let's get the plugin for RB in the folder ~ / home / Viktor / autoreview / hgreviewboard / </li><li>  In the Review Board, <a href="http://www.reviewboard.org/docs/manual/1.7/admin/configuration/users/">we create a user</a> with the intuitive username review_bot and give him the right to post a review on behalf of another user (‚ÄúCan submit as user‚Äù permission) </li><li>  Go to the configuration file of the repository /home/viktor/gdam_frontend/.hg/hgrc and add the following lines there: <br><blockquote>  [extensions] <br>  reviewboard = / home / Viktor / autoreview / hgreviewboard <br><br>  [reviewboard] <br>  # Review Board Repository ID, details - <a href="http://www.reviewboard.org/docs/manual/1.7/admin/configuration/repositories/">www.reviewboard.org/docs/manual/1.7/admin/configuration/repositories</a> <br>  repoid = 1 <br><br>  # Review Board Review Group, details - <a href="http://www.reviewboard.org/docs/manual/1.7/admin/configuration/review-groups/">www.reviewboard.org/docs/manual/1.7/admin/configuration/review-groups</a> <br>  target_groups = A5_Reviewers <br><br>  # Review Board Site, details - <a href="http://www.reviewboard.org/docs/manual/1.7/admin/installation/creating-sites/">www.reviewboard.org/docs/manual/1.7/admin/installation/creating-sites</a> <br>  server = <a href="http://reviews/revievboard">reviews / revievboard</a> <br>  user = review_bot <br>  password = bot_password <br><br>  [hooks] <br>  # Mercurial incoming hook, details - <a href="http://hgbook.red-bean.com/read/handling-repository-events-with-hooks.html">hgbook.red-bean.com/read/handling-repository-events-with-hooks.html#sec</a> : hook: incoming <br>  incoming.autoreview = /home/viktor/autoreview/a5.sh $ HG_NODE </blockquote><br></li><li>  Now we create the script /home/viktor/autoreview/a5.sh hung on incoming hook: <br><pre><code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'&gt;&gt; '</span></span><span class="hljs-variable"><span class="hljs-variable">$1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> `date`<span class="hljs-string"><span class="hljs-string">' &gt;&gt; '</span></span> <span class="hljs-variable"><span class="hljs-variable">$1</span></span> &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">$script_dir</span></span>/autoreview.log } script_path=`readlink -f <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$0</span></span></span><span class="hljs-string">"</span></span>` script_dir=`dirname <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$script_path</span></span></span><span class="hljs-string">"</span></span>` revision=<span class="hljs-variable"><span class="hljs-variable">$1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> <span class="hljs-string"><span class="hljs-string">"Processing revision </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$revision</span></span></span><span class="hljs-string">"</span></span> messages_file=<span class="hljs-string"><span class="hljs-string">'/home/viktor/autoreview/messages.txt'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /home/viktor/autoreview/gdam_frontend user=`hg <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> -r <span class="hljs-variable"><span class="hljs-variable">$revision</span></span> | grep <span class="hljs-string"><span class="hljs-string">'user:'</span></span> | sed -r <span class="hljs-string"><span class="hljs-string">'s/^user:\s{0,}//g'</span></span>` <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> <span class="hljs-string"><span class="hljs-string">"Revision </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$revision</span></span></span><span class="hljs-string"> is made by </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$user</span></span></span><span class="hljs-string"> "</span></span> user_found=`grep <span class="hljs-string"><span class="hljs-string">"^'</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$user</span></span></span><span class="hljs-string">'"</span></span> <span class="hljs-variable"><span class="hljs-variable">$script_dir</span></span>/users.txt` <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$user_found</span></span></span><span class="hljs-string">"</span></span> != <span class="hljs-string"><span class="hljs-string">""</span></span> ] <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> commit_message=`hg <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> -r <span class="hljs-variable"><span class="hljs-variable">$revision</span></span> | grep <span class="hljs-string"><span class="hljs-string">'summary:'</span></span> | sed -r <span class="hljs-string"><span class="hljs-string">'s/summary:\s{1,}//g'</span></span>` message_found=`grep <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$commit_message</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$messages_file</span></span></span><span class="hljs-string">"</span></span>` <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$message_found</span></span></span><span class="hljs-string">"</span></span> == <span class="hljs-string"><span class="hljs-string">""</span></span> ] <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> merge_commit=`<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$commit_message</span></span> | grep <span class="hljs-string"><span class="hljs-string">'^\s\{0,\}[M|m]erge'</span></span>` <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$merge_commit</span></span></span><span class="hljs-string">"</span></span> == <span class="hljs-string"><span class="hljs-string">""</span></span> ] <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$commit_message</span></span> &gt;&gt; <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$messages_file</span></span></span><span class="hljs-string">"</span></span> rb_user=`<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$user_found</span></span> | sed -r <span class="hljs-string"><span class="hljs-string">"s/^'</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$user</span></span></span><span class="hljs-string">'\s//g"</span></span>` <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> <span class="hljs-string"><span class="hljs-string">"Found revision board user - </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$rb_user</span></span></span><span class="hljs-string">"</span></span> review_id=`<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$commit_message</span></span> | grep -o <span class="hljs-string"><span class="hljs-string">'[Rr][Bb]-[[:digit:]]\{1,\}'</span></span> | sed -r <span class="hljs-string"><span class="hljs-string">'s/^[R|r][B|b]-//g'</span></span>` <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$review_id</span></span></span><span class="hljs-string">"</span></span> != <span class="hljs-string"><span class="hljs-string">""</span></span> ] <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> <span class="hljs-string"><span class="hljs-string">"Updating review </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$review_id</span></span></span><span class="hljs-string">"</span></span> hg postreview -e <span class="hljs-variable"><span class="hljs-variable">$review_id</span></span> --submit_as <span class="hljs-variable"><span class="hljs-variable">$rb_user</span></span> -p <span class="hljs-variable"><span class="hljs-variable">$revision</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> <span class="hljs-string"><span class="hljs-string">"Posting new review for </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$revision</span></span></span><span class="hljs-string">"</span></span> hg postreview --submit_as <span class="hljs-variable"><span class="hljs-variable">$rb_user</span></span> -p <span class="hljs-variable"><span class="hljs-variable">$revision</span></span> <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> <span class="hljs-string"><span class="hljs-string">"Skipping merge revision </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$revision</span></span></span><span class="hljs-string"> (</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$commit_message</span></span></span><span class="hljs-string">)"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> <span class="hljs-string"><span class="hljs-string">"Skipping already processed revision </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$revision</span></span></span><span class="hljs-string"> (</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$commit_message</span></span></span><span class="hljs-string">)"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> <span class="hljs-string"><span class="hljs-string">"User </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$user</span></span></span><span class="hljs-string"> is not listed in users.txt mapping file"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span></code> </pre> <br>  Let's go through the key points of the script: <br><br><ol><li>  Determine the directory where the script is located <br><pre> <code class="bash hljs">script_path=`readlink -f <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$0</span></span></span><span class="hljs-string">"</span></span>` script_dir=`dirname <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$script_path</span></span></span><span class="hljs-string">"</span></span>`</code> </pre> </li><li>  We define the hash of the processed commit, it comes as the $ HG_NODE parameter with the incoming hook <br><pre> <code class="bash hljs">revision=<span class="hljs-variable"><span class="hljs-variable">$1</span></span></code> </pre> </li><li>  We define a file with commit messages, used to skip commits with the same messages (often, these appear when there are graft-e commits) <br><pre> <code class="bash hljs">messages_file=<span class="hljs-string"><span class="hljs-string">'/home/viktor/autoreview/messages.txt'</span></span></code> </pre> </li><li>  Determine the user who made the commit (output commit info (hg log -r $ revision) + grep + sed to ‚Äúpull out‚Äù the user) <br><pre> <code class="bash hljs">user=`hg <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> -r <span class="hljs-variable"><span class="hljs-variable">$revision</span></span> | grep <span class="hljs-string"><span class="hljs-string">'user:'</span></span> | sed -r <span class="hljs-string"><span class="hljs-string">'s/^user:\s{0,}//g'</span></span>`</code> </pre> </li><li>  We define the hash of the processed commit, it comes as the $ HG_NODE parameter with the incoming hook <br><pre> <code class="bash hljs">revision=<span class="hljs-variable"><span class="hljs-variable">$1</span></span></code> </pre> </li><li>  We determine the line matching the user of the Review Board to the user who made the commit.  It is determined by searching in a special file - users.txt, which looks like this: <br><blockquote><pre>  'Vasya Pupkin &lt;Vasya.Pupkin@example.com&gt;' vasya-p
 'Ivan Petrov &lt;Ivan.Petrov@example.com&gt;' ivan-p </pre></blockquote>  For the first line: Vasya Pupkin &lt;Vasya.Pupkin@example.com&gt; is a user registered in commits, vasya-p is the login of the corresponding user in the Review Board <br><pre> <code class="bash hljs">user_found=`grep <span class="hljs-string"><span class="hljs-string">"^'</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$user</span></span></span><span class="hljs-string">'"</span></span> <span class="hljs-variable"><span class="hljs-variable">$script_dir</span></span>/users.txt`</code> </pre> </li><li>  Rip out a commit message <br><pre> <code class="bash hljs">commit_message=`hg <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> -r <span class="hljs-variable"><span class="hljs-variable">$revision</span></span> | grep <span class="hljs-string"><span class="hljs-string">'summary:'</span></span> | sed -r <span class="hljs-string"><span class="hljs-string">'s/summary:\s{1,}//g'</span></span>`</code> </pre> </li><li>  Check if there is such a message in the file messages_file <br><pre> <code class="bash hljs">message_found=`grep <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$commit_message</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$messages_file</span></span></span><span class="hljs-string">"</span></span>`)</code> </pre> </li><li>  Check if it is merge <br><pre> <code class="bash hljs">merge_commit=`<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$commit_message</span></span> | grep <span class="hljs-string"><span class="hljs-string">'^\s\{0,\}[M|m]erge'</span></span>`)</code> </pre> </li><li>  We write commit in message_file <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$commit_message</span></span> &gt;&gt; <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$messages_file</span></span></span><span class="hljs-string">"</span></span></code> </pre> </li><li>  We rip the user‚Äôs RB login from the match string <br><pre> <code class="bash hljs">rb_user=`<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$user_found</span></span> | sed -r <span class="hljs-string"><span class="hljs-string">"s/^'</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$user</span></span></span><span class="hljs-string">'\s//g"</span></span>`</code> </pre> </li><li>  We check if it is an update of an existing review - agreement of updates to designate RB - {{id}} in a commit message, where {{id}} is an ID review in RB <br><pre> <code class="bash hljs">review_id=`<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$commit_message</span></span> | grep -o <span class="hljs-string"><span class="hljs-string">'[Rr][Bb]-[[:digit:]]\{1,\}'</span></span> | sed -r <span class="hljs-string"><span class="hljs-string">'s/^[R|r][B|b]-//g'</span></span>`</code> </pre> </li><li>  Post review <br><pre> <code class="bash hljs">hg postreview --submit_as <span class="hljs-variable"><span class="hljs-variable">$rb_user</span></span> -p <span class="hljs-variable"><span class="hljs-variable">$revision</span></span></code> </pre>  or update existing <br><pre> <code class="bash hljs">hg postreview -e <span class="hljs-variable"><span class="hljs-variable">$review_id</span></span> --submit_as <span class="hljs-variable"><span class="hljs-variable">$rb_user</span></span> -p <span class="hljs-variable"><span class="hljs-variable">$revision</span></span></code> </pre> </li></ol><br></li><li>  Create a script that will pull our repository on schedule /home/viktor/autoreview/pull_a5.sh <br><pre> <code class="bash hljs">message_file=<span class="hljs-string"><span class="hljs-string">'/home/viktor/autoreview/messages.txt'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> &gt; <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$message_file</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-string"><span class="hljs-string">'/home/viktor/autoreview/gdam_frontend'</span></span> hg pull rm <span class="hljs-variable"><span class="hljs-variable">$message_file</span></span></code> </pre><br>  Please note that in this file we create empty messages.txt, which is used in a5.sh to determine if the commit is repeated in the current pull.  After running the pool, we delete this file. <br></li><li>  <a href="http://www.cyberciti.biz/faq/how-do-i-add-jobs-to-cron-under-linux-or-unix-oses/">Add the</a> created script <a href="http://www.cyberciti.biz/faq/how-do-i-add-jobs-to-cron-under-linux-or-unix-oses/">to the cron schedule</a> .  An example to run every 5 minutes: <br><pre>  0,5,10,15,20,25,30,35,40,45,50,55 * * * * /home/viktor/autoreview/pull_a5.sh </pre>  in comments suggested a more optimal recording option: <pre>  * / 5 * * * * /home/viktor/autoreview/pull_a5.sh </pre></li></ol><br>  At the output we have the following directory structure autoreview: <br><blockquote>  / home / Viktor / autoreview <br>  - / gdam_frontend - clone of the repository, for which we organize code review <br>  - / hgreviewboard - Review Board Plugin for Mercurial <br>  - * a5.sh - a script that posts a review of rickshaws. <br>  --autoreview.log - a5.sh script action log <br>  - * pull_a5.sh - the script that executes the pull repository is launched according to a schedule using cron <br>  --users.txt - Mercurial Users Match File to Review Board Users <br></blockquote><br>  * means that the file has an "executable" flag. <br><br>  Moreover, the process of posting a review of rickstavs is automated and takes place "unnoticed" for committers.  The only thing that committers need to do is when committing changes for a review of a ticket, a commit message must begin with a RB - {{ID}}, where {{ID}} is an ID of a review of a ticket. <br><br>  What can be improved? <br><br><ol><li>  Filter out branch closing commits (by analogy with merzes) </li><li>  Filter backout commits (by analogy with merzes) </li><li>  Improve the verification of the uniqueness of commit messages so that it occurs without using the messages.txt file (there are no ideas how to do this yet) </li></ol><br>  We are happy to review all comments and comments. <br>  Thank you for reading to the end! </div><p>Source: <a href="https://habr.com/ru/post/187058/">https://habr.com/ru/post/187058/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../187044/index.html">Search all AD user groups by LDAP protocol</a></li>
<li><a href="../187046/index.html">Adding synchronized transcription text to HTML5 video</a></li>
<li><a href="../187052/index.html">8 things that a developer should not be afraid of</a></li>
<li><a href="../187054/index.html">Confidence in the certificates of the MEP or ‚ÄúVasya's dad is strong in mathematics‚Äù</a></li>
<li><a href="../187056/index.html">Month with 3Q RC9730C tablet</a></li>
<li><a href="../187062/index.html">About it</a></li>
<li><a href="../187070/index.html">Help is needed to work on a new web-series about IT people</a></li>
<li><a href="../187072/index.html">Looking for level codes in Prehistorik-2</a></li>
<li><a href="../187074/index.html">Localization ISO / IEC 14977: 1996 (E) (Extended BNF)</a></li>
<li><a href="../187076/index.html">Image as an information unit</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>