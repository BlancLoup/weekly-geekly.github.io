<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Chain replication: building efficient KV storage (part 2/2)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue to consider examples of the use of chain replication. Basic definitions and architectures were given in the first part , I recommend to ge...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Chain replication: building efficient KV storage (part 2/2)</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img width="400" src="https://habrastorage.org/webt/ou/4j/jl/ou4jjlsyjknckeriwguidrfcqqs.jpeg"></div><br>  We continue to consider examples of the use of chain replication.  Basic definitions and architectures were given in the <a href="https://habr.com/post/430396/">first part</a> , I recommend to get acquainted with it before reading the second part. <br><a name="habracut"></a><br>  In this article we will study the following systems: <br><br><ul><li>  Hibari is a distributed, fault-tolerant repository written in erlang. </li><li>  HyperDex is a distributed key-value repository with support for fast search by secondary attributes and search by range. </li><li>  ChainReaction - Causal + consistency and geo-replication. </li><li>  Building a distributed system without using additional external monitoring / reconfiguration processes. </li></ul><br><h1>  5. Hibari </h1><br>  Hibari is a distributed, fault-tolerant KV-repository written in erlang.  Uses chain replication (basic approach), so  achieves strict consistency.  In tests, Hibari shows high performance - on two-unit servers, several thousand updates per second are achieved (requests for 1Kb) <br><br><h3>  5.1 Architecture </h3><br>  For posting data is used consistent hashing.  The storage is based on physical and logical blocks.  The physical block ( <i>physical brick</i> ) is a server with Linux, maybe an EC2 instance and in general a VM as a whole.  Logical block ( <i>logical brick</i> ) is the storage instance with which the main processes of the cluster work and each block is a node of any <b>one</b> chain.  In the example below, the cluster is configured with the placement of 2 logical blocks on each physical block and with a chain length of 2. Note that the nodes of the circuit are ‚Äúsmeared‚Äù across the physical blocks to increase reliability. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The master process (see definition in the first part) is called the <i>Admin server</i> . <br><br>  Data is stored in ‚Äútables‚Äù, which simply serve as a division into neimspaces, each table is stored in at least one chain, and each chain stores data from only one table. <br><br>  The Hibari client receives updates from the Admin server with a list of all the head and tail of all the chains (and all tables).  Thus, clients know immediately which logical node to send a request to. <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/k1/nh/yg/k1nhygstpeqkgzv5vyuwwsjoffm.png"></div><br><br><h3>  5.2 Hashing </h3><br>  Hibari uses a couple <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><span class="noError" style="display: inline-block;">\&nbsp;{T,&nbsp;K&nbsp;\}</span></span><script type="math/tex" id="MathJax-Element-1"> \ {T, K \} </script>  to determine the name of the chain that stores the key <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.066ex" height="2.057ex" viewBox="0 -780.1 889.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-4B" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-2"> K </script>  in the table <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.636ex" height="2.057ex" viewBox="0 -780.1 704.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-54" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-3"> T </script>  : key <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.066ex" height="2.057ex" viewBox="0 -780.1 889.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-4B" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-4"> K </script>  displayed on the interval <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.529ex" height="2.66ex" viewBox="0 -832 3672.2 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-5B" x="0" y="0"></use><g transform="translate(278,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-31" x="779" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-2C" x="1558" y="0"></use><g transform="translate(2003,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-30" x="779" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-29" x="3282" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-5"> [0.1, 1.0) </script>  (using MD5), which is divided into sections for which any one circuit is responsible.  Sections can be of different widths, depending on the "weight" of the chain, for example: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/kt/hy/hq/kthyhqgqi5bn5xthknmw4f5sjou.png"></div><br><br>  Thus, if some physical blocks are very powerful, then wider sections can be given to chains located on them (then more keys will fall on them). <br><br><h1>  6. HyperDex </h1><br>  The goal of this project was to build a distributed key-value store, which, unlike other popular solutions (BigTable, Cassandra, Dynamo), will support fast search by secondary attributes and will be able to quickly search by range.  For example, in the previously reviewed systems, to search for all values ‚Äã‚Äãin a certain range, one will have to go through all the servers, which is obviously unacceptable.  HyperDex solves this problem using <i>Hyperspace Hashing</i> . <br><br><h3>  6.1 Architecture </h3><br>  The idea behind hyperspace hashing is to build <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.395ex" height="1.455ex" viewBox="0 -520.7 600.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6E" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-6"> n </script>  -dimensional space where each attribute corresponds to one coordinate axis.  For example, for objects (first-name, last-name, phone-number) the space might look like this: <br><br><div style="text-align:center;"><img width="400" src="https://habrastorage.org/webt/zf/be/hu/zfbehu3mpmbsb1bwdfpofn_xywa.png"></div><br><br>  The gray hyperplane traverses all the keys, where is last-name = Smith, the yellow one goes through all the keys, where first-name = John.  The intersection of these planes forms the answer to the search query phone numbers of people with the name John and the last name Smith.  So the request for <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.211ex" height="2.057ex" viewBox="0 -780.1 521.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6B" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-7"> k </script>  attribute returns <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.256ex" height="2.66ex" viewBox="0 -832 3123.9 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-28" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6E" x="389" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-2212" x="1212" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6B" x="2212" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-29" x="2734" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-8"> (n-k) </script>  -dimensional subspace. <br><br>  The search space is split into <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.395ex" height="1.455ex" viewBox="0 -520.7 600.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6E" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-9"> n </script> -dimensional non-intersecting regions, and each region is assigned to a single server.  The object with coordinates from the region is stored on the server of this region.  Thus a hash is built between objects and servers. <br><br>  A search query (by range) will determine the regions included in the resulting hyperplane and, thus, reduce the number of polled servers to a minimum. <br><br>  In this approach, there is one problem - the number of required servers grows exponentially with the number of attributes, i.e.  if attributes <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.211ex" height="2.057ex" viewBox="0 -780.1 521.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6B" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-10"> k </script>  then need <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.834ex" height="3.021ex" viewBox="0 -987.6 2511.8 1300.8" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-4F" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-28" x="763" y="0"></use><g transform="translate(1153,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-32" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6B" x="707" y="557"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-29" x="2122" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-11"> O (2 ^ k) </script>  servers.  To solve this problem, HyperDex uses a partition of the hyperspace into subspaces (with a smaller dimension) with, respectively, a subset of attributes: <br><br><div style="text-align:center;"><img width="400" src="https://habrastorage.org/webt/s1/nf/tk/s1nftktukf2qd4e9ljjuzsgj_b0.png"></div><br><h3>  6.2 Replication </h3><br>  To ensure strict consistency, the authors developed a special approach based on chain replication - <i>value dependent chaining</i> , where each next node is determined by hashing the corresponding attribute.  For example, the key <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="21.927ex" height="2.66ex" viewBox="0 -832 9440.8 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-28" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-22" x="389" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-4A" x="1167" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6F" x="1801" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-68" x="2286" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6E" x="2863" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-22" x="3741" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-2C" x="4242" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-22" x="4687" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-53" x="5465" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6D" x="6111" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-69" x="6989" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-74" x="7335" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-68" x="7696" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-22" x="8550" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-29" x="9051" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-12"> ("John", "Smith") </script>  first will be hashed into the key space (we will get the head of the chain, also called <i>point leader</i> ), then the hash from <math> </math> $ inline $ "John" $ inline $   to the coordinate on the corresponding axis and so on.  (See the picture below for the update example. <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-14-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.384ex" height="1.696ex" viewBox="0 -520.7 1026.4 730.2" role="img" focusable="false" style="vertical-align: -0.487ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-75" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-31" x="809" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-14"> u_1 </script>  ). <br><br>  All updates go through the point leader, which orders the queries (linearizability). <br><br><div style="text-align:center;"><img width="400" src="https://habrastorage.org/webt/qp/ab/z4/qpabz4f0rpxaybrtt5pzhegrrqk.png"></div><br><br>  If an update leads to a change in the region, then first the new version is recorded immediately after the old one (see update <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-15-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.384ex" height="1.696ex" viewBox="0 -520.7 1026.4 730.2" role="img" focusable="false" style="vertical-align: -0.487ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-75" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-32" x="809" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-15"> u_2 </script>  ), and after receiving the ACK from tail, the link to the old version from the previous server will be changed.  To simultaneous requests (for example, <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-16-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.384ex" height="1.696ex" viewBox="0 -520.7 1026.4 730.2" role="img" focusable="false" style="vertical-align: -0.487ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-75" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-32" x="809" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-16"> u_2 </script>  and <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-17-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.384ex" height="1.817ex" viewBox="0 -520.7 1026.4 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-75" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-33" x="809" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-17"> u_3 </script>  ) did not violate the consistency. point leader adds versioning and other meta-information to the server, in case of <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-18-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.384ex" height="1.817ex" viewBox="0 -520.7 1026.4 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-75" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-33" x="809" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-18"> u_3 </script>  earlier <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-19-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.384ex" height="1.696ex" viewBox="0 -520.7 1026.4 730.2" role="img" focusable="false" style="vertical-align: -0.487ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-75" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-32" x="809" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-19"> u_2 </script>  could determine that the order is broken and you need to wait <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-20-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.384ex" height="1.696ex" viewBox="0 -520.7 1026.4 730.2" role="img" focusable="false" style="vertical-align: -0.487ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-75" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-32" x="809" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-20"> u_2 </script>  . <br><br><h1>  7. ChainReaction </h1><br>  The causal + convergence model is used, which adds the condition of conflict-free convergence to causal (causal) convergence.  To accomplish causal convergence, metadata is added to each query, which lists the versions of all cause-dependent keys.  ChainReaction allows geo-replication in several data centers and is a further development of the CRAQ idea. <br><br><h3>  7.1 Architecture </h3><br>  The architecture from FAWN is used with small changes - each DC consists of <i>data servers</i> - backends (data storage, replication, form a DHT ring) and <i>client proxies</i> - frontends (send a request to a specific node).  Each key replicates to R consecutive nodes, forming a chain.  Requests for reading are processed tail, write - head. <br><br><div style="text-align:center;"><img width="500" src="https://habrastorage.org/webt/xz/lv/ei/xzlveipiopeqi4enyao1b_fuehw.png"></div><br><h3>  7.2 One data center </h3><br>  Note one important property resulting from chain replication - if the node <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-21-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.211ex" height="2.057ex" viewBox="0 -780.1 521.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6B" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-21"> k </script>  causal-consistent with some client operations, then all previous nodes - too.  So, if the operation <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-22-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.943ex" height="2.419ex" viewBox="0 -780.1 1267 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-4F" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-70" x="763" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-22"> Op </script>  was seen by us last time on site <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-23-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.985ex" height="2.298ex" viewBox="-11.5 -728.2 424 989.6" role="img" focusable="false" style="vertical-align: -0.607ex; margin-left: -0.027ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6A" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-23"> j </script>  then all are causal-dependent (from <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-24-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.943ex" height="2.419ex" viewBox="0 -780.1 1267 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-4F" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-70" x="763" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-24"> Op </script>  ) read operations can only be performed on nodes from head to <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-25-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.985ex" height="2.298ex" viewBox="-11.5 -728.2 424 989.6" role="img" focusable="false" style="vertical-align: -0.607ex; margin-left: -0.027ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6A" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-25"> j </script>  .  Once <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-26-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.943ex" height="2.419ex" viewBox="0 -780.1 1267 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-4F" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-70" x="763" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-26"> Op </script>  will be executed on the tail - there will be no restrictions on reading.  Denote the write operations that were performed tail in DC <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-27-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.216ex" height="2.057ex" viewBox="0 -780.1 523.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-64" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-27"> d </script>  as <b>DC-Write-Stable (d)</b> . <br><br>  Each client stores a list (metadata) of all keys requested by the client in the format (key, version, chainIndex), where chainIndex is the position of the node in the chain that responded to the last request about the key key.  <b>The metadata is stored only for keys that the client does not know whether it is DC-Write-Stable (d) or not</b> . <br><br><h4>  7.2.1 Performing a write operation </h4><br>  Note that once the operation has become DC-Write-Stable (d), then no read request can read previous versions. <br><br>  For each write request, a list is added of all the keys to which read operations were performed before the last write operation.  As soon as the client proxy receives the request, it performs blocking read operations on the tails of all keys from the metadata (we are waiting for confirmation of the presence of the same or a newer version, in other words, we fulfill the causal consistency condition).  Once confirmations are received, the write request is sent to the head of the corresponding circuit. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/l2/qo/k_/l2qok_yldb0_aaqjcfmzj2ap_gk.png"></div><br><br>  As soon as the new value is stored on <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-28-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.211ex" height="2.057ex" viewBox="0 -780.1 521.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6B" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-28"> k </script>  chain nodes, the notification is sent to the client (with the index of the last node).  The client updates chainIndex and removes the metadata of the sent keys, since  it became known about them that they are DC-Write-Stable (d).  Parallel to this, the recording continues further - <i>lazy propagation</i> .  Thus, priority is given to write operations at first. <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-29-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.211ex" height="2.057ex" viewBox="0 -780.1 521.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6B" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-29"> k </script>  knots.  As soon as tail saves the new version of the key, the notification is sent to the client and transmitted to all nodes in the chain so that they mark the key as stable. <br><br><h4>  7.2.2 Performing a read operation </h4><br>  The client proxy sends a read request to <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-30-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="30.435ex" height="2.66ex" viewBox="0 -832 13103.7 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-69" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6E" x="345" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-64" x="946" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-65" x="1469" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-78" x="1936" y="0"></use><g transform="translate(2786,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-3A"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-3D" x="278" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-72" x="4121" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-61" x="4572" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6E" x="5102" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-64" x="5702" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-28" x="6226" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-31" x="6615" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-2C" x="7116" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-63" x="7561" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-68" x="7994" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-61" x="8571" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-69" x="9100" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6E" x="9446" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-49" x="10046" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6E" x="10551" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-64" x="11151" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-65" x="11675" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-78" x="12141" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-29" x="12714" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-30"> index: = rand (1, chainIndex) </script>  node in the chain, while distributing the load.  In response, the node sends the value and version of this value.  The response is sent to the client, with: <br><br><ul><li>  If the version is stable, then the new chainIndex is equal to the size of the chain. </li><li>  If the version is newer, then the new chainIndex = index. </li><li>  Otherwise chainIndex does not change. </li></ul><br><h4>  7.2.3 Processing node failures </h4><br>  Almost completely identical to the basic approach, with some differences in that in some cases the chainIndex on the client becomes invalid - this is easily determined when executing queries (there is no key with this version) and the request is redirected to the head of the chain to find the node with the desired version. <br><br><h3>  7.3 Several ( <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-31-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.064ex" height="1.939ex" viewBox="0 -749.6 888.5 834.7" role="img" focusable="false" style="vertical-align: -0.198ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-4E" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-31"> N </script>  a) data centers (geo-replication) </h3><br>  Let's take as a basis the algorithms from the single-server architecture and adapt them to a minimum.  To begin with, in the metadata, instead of just the version and chainIndex values, we will need versioned vectors of dimensions N. <br><br>  Define Global-Write-Stable in a similar way with DC-Write-Stable (d) - the write operation is considered Global-Write-Stable if it was performed on the tails in all DCs. <br><br>  Each DC has a new component - <i>remote_proxy</i> , its task is to receive / send updates from other DCs. <br><br><h4>  7.3.1 Performing a write operation (on the server <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-32-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.802ex" height="1.842ex" viewBox="0 -708.1 345.5 793.1" role="img" focusable="false" style="vertical-align: -0.198ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-69" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-32"> i </script>  ) </h4><br>  The beginning is similar to the single-server architecture - we perform blocking reads, write to the first <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-33-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.211ex" height="2.057ex" viewBox="0 -780.1 521.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6B" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-33"> k </script>  chain nodes.  At this point, the client proxy sends the client a new vector chainIndex, where zeros are everywhere, except for the position <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-34-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.802ex" height="1.937ex" viewBox="0 -728.2 345.5 834" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-69" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-34"> i </script>  - there is meaning <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-35-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.211ex" height="2.057ex" viewBox="0 -780.1 521.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6B" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-35"> k </script>  .  Further - as usual.  Additional operation at the very end - the update is sent to remote_proxy, which accumulates several requests and then sends everything. <br><br>  There are two problems here: <br><br><ul><li>  How to ensure dependencies between different updates coming from different DCs? <br><br>  Each remote_proxy stores a local version vector. <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-36-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.346ex" height="1.817ex" viewBox="0 -520.7 1440.5 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-72" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-76" x="451" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-70" x="937" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-36"> rvp </script>  dimensions <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-37-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.064ex" height="2.057ex" viewBox="0 -780.1 888.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-4E" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-37"> N </script>  which stores the number of sent and received updates, and sends it in each update.  Thus, when receiving an update from another DC, remote_proxy checks the counters, and if the local counter is smaller, the operation is blocked until the corresponding update is received. </li><li>  How to provide dependencies for this operation in other DC? <br><br>  This is achieved using a bloom filter.  When performing write / read operations from the client proxy, in addition to the metadata, a bloom filter is also sent to each key (called response filters).  These filters are stored in the <i>AccessedObjects</i> list, and, when requesting write / read operations, the OR is also sent to the metadata using the filters sent by the keys (called a dependency filter).  Similarly, after the write operation is completed, the corresponding filters are deleted.  When sending a write operation to another DC, a dependency filter and response filter of this request are also sent. <br><br>  Further, the remote DC, having received all this information, checks - if the set bits of the response filter coincide with the set bits of several query filters - then such operations are potentially casual-dependent.  Potentially - because the bloom filter. </li></ul><br><h4>  7.3.2 Performing a read operation </h4><br>  Similarly, a single-server architecture, adjusted for using the vector chainIndex instead of a scalar and the possibility of missing a key in a DC (because updates are asynchronous), then either wait or redirect the request to another DC. <br><br><h4>  7.3.3 Conflict Resolution </h4><br>  Thanks to the metadata, causal-dependent operations are always performed in the correct order (sometimes you have to block the process for this).  But competitive changes in different DC can lead to conflicts.  To resolve such situations, Last Write Wins is used, for which a pair is present in each update operation. <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-38-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.98ex" height="2.66ex" viewBox="0 -832 3866.2 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-28" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-63" x="389" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6C" x="823" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6F" x="1121" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-63" x="1607" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6B" x="2040" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-2C" x="2562" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-73" x="3007" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-29" x="3476" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-38"> (clock, s) </script>  where <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-39-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.007ex" height="1.455ex" viewBox="0 -520.7 433.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-63" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-39"> c </script>  - clock on proxy, and <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-40-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="1.455ex" viewBox="0 -520.7 469.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-73" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-40"> s </script>  - id DC. <br><br><h4>  7.3.4 Handling node failures </h4><br>  Similar to single-server architecture. <br><br><h1>  8. Leveraging Sharding in the Design of Scalable Replication Protocols </h1><br>  The aim of the study is to build a distributed system with shards and with replication without using an external master process to reconfigure / monitor the cluster. <br><br>  In the main current approaches, the authors see the following disadvantages: <br><br>  Replication: <br><br><ul><li>  Primary / Backup - causes a state to diverge if the Primary was mistakenly identified as failed. </li><li>  Quorum Intersection - may cause a state to diverge during cluster reconfiguration. </li></ul><br>  Strict consistency: <br><br><ul><li>  Protocols rely on majority-choice voting (for example, Paxos), where required <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-41-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.424ex" height="2.178ex" viewBox="0 -780.1 4057.4 937.7" role="img" focusable="false" style="vertical-align: -0.366ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-32" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-2217" x="722" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-4E" x="1445" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-2B" x="2556" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-31" x="3556" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-41"> 2 * N + 1 </script>  knots for keeping fall <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-42-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.064ex" height="2.057ex" viewBox="0 -780.1 888.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-4E" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-42"> N </script>  knots. </li></ul><br>  Detection of node failures: <br><br><ul><li>  P / B and CR implies the presence of perfect detection of failed nodes with the fail-stop model, which in practice is unattainable and one has to choose a satisfying scan interval. </li><li>  ZooKeeper is subject to the same problems - with a large number of clients, a significant amount of time (&gt; 1 second) is required for them to update the configuration. </li></ul><br>  The approach proposed by the authors, called <i>Elastic replication</i> , is devoid of these shortcomings, and has the following characteristics: <br><br><ul><li>  Strict consistency. </li><li>  To withstand the fall <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-43-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.064ex" height="2.057ex" viewBox="0 -780.1 888.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-4E" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-43"> N </script>  nodes must have <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-44-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.066ex" height="2.178ex" viewBox="0 -780.1 2611.9 937.7" role="img" focusable="false" style="vertical-align: -0.366ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-4E" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-2B" x="1110" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-31" x="2111" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-44"> N + 1 </script>  knot. </li><li>  Reconfiguration without losing consistency. </li><li>  There is no need for consensus protocols based on majority voting. </li></ul><br>  Summary plate: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/al/nh/yf/alnhyf9vzquirk-ztizoplkeypa.png"></div><br><h3>  8.1 Organization of replicas </h3><br>  On each shard the sequence of configurations is determined. <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-45-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="31.995ex" height="2.419ex" viewBox="0 -780.1 13775.4 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6D" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-61" x="1128" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-74" x="1658" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-68" x="2019" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-63" x="2596" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-61" x="3029" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6C" x="3559" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-43" x="3857" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-3D" x="4895" y="0"></use><g transform="translate(5952,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-43" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-31" x="1011" y="-213"></use></g><g transform="translate(7399,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-3A"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-3A" x="278" y="0"></use></g><g transform="translate(8234,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-43" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-32" x="1011" y="-213"></use></g><g transform="translate(9681,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-3A"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-3A" x="278" y="0"></use></g><g transform="translate(10515,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-43" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-33" x="1011" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-64" x="11935" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6F" x="12458" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-74" x="12944" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-73" x="13305" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-45"> \ mathcal {C} = C_1 :: C_2 :: C_3 \ dots </script>  for example, the new configuration does not contain any fallen cue <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-46-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="50.709ex" height="2.78ex" viewBox="0 -832 21832.8 1197.1" role="img" focusable="false" style="vertical-align: -0.848ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6D" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-61" x="1128" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-74" x="1658" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-68" x="2019" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-63" x="2596" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-61" x="3029" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6C" x="3559" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-43" x="3857" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-3D" x="4895" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6D" x="6202" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-61" x="7080" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-74" x="7610" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-68" x="7971" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-63" x="8548" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-61" x="8981" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6C" x="9511" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-43" x="9809" y="0"></use><g transform="translate(10847,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-3A"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-3A" x="278" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-28" x="11682" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-52" x="12072" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-65" x="12831" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-70" x="13298" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6C" x="13801" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-69" x="14100" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-63" x="14445" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-61" x="14879" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-73" x="15408" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-73" x="16128" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-65" x="16597" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-74" x="17064" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6D" x="17425" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-69" x="18304" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6E" x="18649" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-75" x="19250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-73" x="19822" y="0"></use><g transform="translate(20292,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6A" x="1074" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-29" x="21443" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-46"> \ mathcal {C} = \ mathcal {C}: :( Replicas \ setminus R_j) </script><br><br>  Each element of the configuration sequence consists of: <br><br><ul><li>  replicas - a set of replicas. </li><li>  <i>orderer</i> - replica id with a special role (see below). </li></ul><br>  Each shard is represented by a set of replicas (by construction - <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-47-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.064ex" height="2.057ex" viewBox="0 -780.1 888.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-4E" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-47"> N </script>  ), so  we do not divide into roles ‚Äúshard‚Äù and ‚Äúcue‚Äù. <br><br>  Each replica stores the following data: <br><br><ul><li>  conf is the id of the configuration to which this replica belongs. </li><li>  orderer - which replica is the orderer of this configuration. </li><li>  mode - replica mode, one of the three: <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-48-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="12.571ex" height="2.057ex" viewBox="0 -780.1 5412.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-50" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-45" x="751" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-4E" x="1516" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-44" x="2404" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-49" x="3233" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-4E" x="3737" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-47" x="4626" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-48"> PENDING </script>  (all replicas from non- <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-49-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.716ex" height="2.298ex" viewBox="0 -780.1 1169.4 989.6" role="img" focusable="false" style="vertical-align: -0.487ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-43" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-31" x="1011" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-49"> C_1 </script>  ), <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-50-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.88ex" height="2.057ex" viewBox="0 -780.1 4254 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-41" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-43" x="750" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-54" x="1511" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-49" x="2215" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-56" x="2720" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-45" x="3489" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-50"> ACTIVE </script>  (all replicas from <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-51-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.716ex" height="2.298ex" viewBox="0 -780.1 1169.4 989.6" role="img" focusable="false" style="vertical-align: -0.487ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-43" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-31" x="1011" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-51"> C_1 </script>  ), <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-52-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="16.341ex" height="2.057ex" viewBox="0 -780.1 7035.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-49" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-4D" x="504" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-4D" x="1556" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-55" x="2607" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-54" x="3375" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-41" x="4079" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-42" x="4830" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-4C" x="5589" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-45" x="6271" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-52"> IMMUTABLE </script>  . </li><li>  history - the sequence of operations on the actual replica data <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-53-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="16.725ex" height="2.419ex" viewBox="0 -780.1 7200.9 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6F" x="0" y="0"></use><g transform="translate(485,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-31" x="712" y="-213"></use></g><g transform="translate(1720,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-3A"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-3A" x="278" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6F" x="2555" y="0"></use><g transform="translate(3040,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-32" x="712" y="-213"></use></g><g transform="translate(4276,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-3A"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-3A" x="278" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-64" x="5360" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6F" x="5884" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-74" x="6369" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-73" x="6731" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-53"> op_1 :: op_2 :: \ dots </script>  (or just state). </li><li>  stable - the maximum length of the history prefix that is fixed by this replica.  It's obvious that <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-54-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="32.589ex" height="2.66ex" viewBox="0 -832 14031.1 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-30" x="0" y="0"></use><g transform="translate(778,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-3C"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-3D" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-73" x="2613" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-74" x="3082" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-61" x="3444" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-62" x="3973" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6C" x="4403" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-65" x="4701" y="0"></use><g transform="translate(5445,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-3C"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-3D" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6C" x="7280" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-65" x="7579" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6E" x="8045" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-67" x="8646" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-74" x="9126" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-68" x="9488" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-28" x="10064" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-68" x="10454" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-69" x="11030" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-73" x="11376" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-74" x="11845" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-6F" x="12207" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-72" x="12692" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-79" x="13144" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMAIN-29" x="13641" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-54"> 0 <= stable <= length (history) </script>  . </li></ul><br>  The main task of the replica orderer is to send requests to the rest of the replicas and support the largest history prefix: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/7_/hk/lo/7_hklowfxczcx0tjd5grugrw9a8.png"></div><br><h3>  8.2 Organization of shards </h3><br>  Shards are combined into rings called <i>elastic bands</i> .  Each shard belongs to only one ring.  Predecessor of every shard <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-55-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.98ex" height="2.057ex" viewBox="0 -780.1 852.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/432020/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiwXgCnJJqjH_4ias813Q0s-wCD3A#MJMATHI-58" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-55"> X </script>  performs a special role - it is a <i>sequencer</i> for it.  The task of the sequencer is to issue its successor a new configuration in case of replica failures. <br><br><div style="text-align:center;"><img width="300" src="https://habrastorage.org/webt/sc/8g/se/sc8gsegolx8iarmilhrkeftetfo.png"></div><br>  Two conditions are required: <br><br><ul><li>  Each elastic band has at least one shard and one working replica. </li><li>  In each elastic band there is at least one shard, which has all the replicas - workers. </li></ul><br>  The second condition seems too strict, but it is equivalent to the ‚Äútraditional‚Äù condition that the master process never falls. <br><br><h3>  8.3 Using Chain replication </h3><br>  As you might have guessed, the replicas are organized as a chain (basic approach) - the orderer will be the head, with some differences: <br><br><ul><li>  In case of failure in the CR node is thrown out of the chain (and replaced with a new one), in the ER a new chain is created. </li><li>  Read requests in CR are processed by tail, in ER - they go through the whole chain in the same way as write requests. </li></ul><br><h3>  8.5 Reconfiguration in case of failure </h3><br><ul><li>  Replicas are monitored as replicas of their shard, and replicas of sequencer shard. </li><li>  As soon as a failure is detected, a command is sent by the remarks about it. </li><li>  Sequencer sends new configuration (without failed replica). </li><li>  A new replica is created, which synchronizes its state with the elastic band. </li><li>  After that, sequencer sends a new configuration with the added replica. </li></ul><br><h1>  Links </h1><br><ul><li>  <a href="https//dl.acm.org/citation.cfm%3Fid%3D1863515dl.acm.org/citation.cfm%3Fid%3D1863515">Hibari</a> </li><li>  <a href="https://hyperdex.orgerdex.org/">hyperdex.orgerdex.org</a> </li><li>  <a href="https://www.cs.cornell.edu/people/egs/papers/hyperdex-sigcomm.pdf">HyperDex: A Distributed Searchable Key-Value Store</a> </li><li>  <a href="https://dl.acm.org/citation.cfm%3Fid%3D2465361">ChainReaction</a> </li><li>  <a href="https://ymsir.com/papers/sharding-socc.pdf">Leveraging Sharding in Design of Scalable Replication Protocols</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/432020/">https://habr.com/ru/post/432020/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../432006/index.html">The tale of how I was brought to the topic of women's health</a></li>
<li><a href="../432008/index.html">In pursuit of web standards</a></li>
<li><a href="../432012/index.html">How to test smart contracts</a></li>
<li><a href="../432014/index.html">Kali Linux for beginners</a></li>
<li><a href="../432016/index.html">How music and drawing taught me how to program</a></li>
<li><a href="../432022/index.html">Fork it: 8 projects on Go, in the source code of which it is interesting to dig</a></li>
<li><a href="../432024/index.html">Gradle 5.0 - what's new</a></li>
<li><a href="../432030/index.html">The path to the contactless lie detector, or How to arrange a hackathon at maximum speed</a></li>
<li><a href="../432032/index.html">We finish the nailed Google search box</a></li>
<li><a href="../432034/index.html">The book "Electricity step by step" by Rudolph Svoren</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>