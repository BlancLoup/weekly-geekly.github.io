<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Introduction to kube-spawn - a utility for creating local Kubernetes-clusters</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Note trans. : kube-spawn is a fairly new (announced in August) Open Source project created by the German company Kinvolk for local launch of Kubernete...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Introduction to kube-spawn - a utility for creating local Kubernetes-clusters</h1><div class="post__text post__text-html js-mediator-article">  <i><b>Note</b></i>  <i><b>trans.</b></i>  <i>: kube-spawn is a fairly new (announced in August) Open Source project created by the German company Kinvolk for local launch of Kubernetes clusters.</i>  <i>It is written in Go, works with Kubernetes versions 1.7.0+, uses the capabilities of kubeadm and systemd-nspawn, and is focused only on the GNU / Linux operating system.</i>  <i>Unlike Minikube, it does not start a virtual machine for Kubernetes, which means that the overhead will be minimal and all processes running inside the containers can be seen on the host machine (including through top / htop).</i>  <i>The article below is the announcement of this utility, published by one of the company's employees (Chris K√ºhl) in the corporate blog.</i> <br><br><img src="https://habrastorage.org/web/0d2/0c6/fc2/0d20c6fc2cad454db32562211866fe03.png"><a name="habracut"></a><br><br>  <a href="https://github.com/kinvolk/kube-spawn/">kube-spawn</a> is a tool for simply launching a local cluster of Kubernetes from multiple nodes on a Linux machine.  Initially, it was created primarily for the developers of Kubernetes himself, but over time it turned into a utility that is great for trying and exploring Kubernetes.  This article offers a general introduction to kube-spawn and shows how to use this tool. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Overview </h2><br>  kube-spawn aims to be the easiest way to conduct tests and other experiments with Kubernetes in Linux.  This project came about because of the difficulties that arose when starting a Kubernetes cluster with many nodes on development machines.  Utilities that offer the necessary functionality usually do not provide environments in which Kubernetes will be subsequently launched, that is, a full-fledged operating system GNU / Linux. <br><br><h2>  Starting Kubernetes cluster with kube-spawn </h2><br>  So let's run the cluster.  In kube-spawn, one command is enough to get an image of the <a href="https://coreos.com/os/docs/latest">Container Linux</a> , prepare the nodes and expand the cluster.  These steps can be performed separately using <code>machinectl pull-raw</code> and the kube-spawn <code>setup</code> and <code>init</code> subcommands.  However, the <code>up</code> subcommand will do everything for us: <br><br><pre> <code class="bash hljs">$ sudo GOPATH=<span class="hljs-variable"><span class="hljs-variable">$GOPATH</span></span> CNI_PATH=<span class="hljs-variable"><span class="hljs-variable">$GOPATH</span></span>/bin ./kube-spawn up --nodes=3</code> </pre> <br>  When the command has finished executing, you will receive a cluster of Kubernetes with 3 nodes.  We'll have to wait until the nodes are ready for use. <br><br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> KUBECONFIG=<span class="hljs-variable"><span class="hljs-variable">$GOPATH</span></span>/src/github.com/kinvolk/kube-spawn/.kube-spawn/default/kubeconfig $ kubectl get nodes NAME STATUS AGE VERSION kube-spawn-0 Ready 1m v1.7.0 kube-spawn-1 Ready 1m v1.7.0 kube-spawn-2 Ready 1m v1.7.0</code> </pre> <br>  Now you can see that all nodes are ready.  Moving on. <br><br><h2>  Demo application </h2><br>  We will check the cluster performance by deploying the <a href="https://github.com/microservices-demo/microservices-demo">Sock Shop</a> demo microservice application created in <a href="https://www.weave.works/">Weaveworks</a> .  Sock Shop is a complex application consisting of microservices and using many components that can usually be found in real installations.  Thus, it allows you to check that everything really works, and provides a more substantial ground for research than a simple ‚Äúhello world‚Äù. <br><br><h3>  Application cloning </h3><br>  To continue, you will need to clone the <code>microservices-demo</code> repository and go to the <code>deploy/kubernetes</code> : <br><br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/repos $ git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/microservices-demo/microservices-demo.git sock-shop $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> sock-shop/deploy/kubernetes/</code> </pre> <br><h3>  Application deployment </h3><br>  Now everything is ready for deployment.  But the first thing to do is create a <code>sock-shop</code> namespace - the deployment assumes its presence: <br><br><pre> <code class="bash hljs">$ kubectl create namespace sock-shop namespace <span class="hljs-string"><span class="hljs-string">"sock-shop"</span></span> created</code> </pre> <br>  Now everything is really ready for application deployment: <br><br><pre> <code class="bash hljs">$ kubectl create -f complete-demo.yaml deployment <span class="hljs-string"><span class="hljs-string">"carts-db"</span></span> created service <span class="hljs-string"><span class="hljs-string">"carts-db"</span></span> created deployment <span class="hljs-string"><span class="hljs-string">"carts"</span></span> created service <span class="hljs-string"><span class="hljs-string">"carts"</span></span> created deployment <span class="hljs-string"><span class="hljs-string">"catalogue-db"</span></span> created service <span class="hljs-string"><span class="hljs-string">"catalogue-db"</span></span> created deployment <span class="hljs-string"><span class="hljs-string">"catalogue"</span></span> created service <span class="hljs-string"><span class="hljs-string">"catalogue"</span></span> created deployment <span class="hljs-string"><span class="hljs-string">"front-end"</span></span> created service <span class="hljs-string"><span class="hljs-string">"front-end"</span></span> created deployment <span class="hljs-string"><span class="hljs-string">"orders-db"</span></span> created service <span class="hljs-string"><span class="hljs-string">"orders-db"</span></span> created deployment <span class="hljs-string"><span class="hljs-string">"orders"</span></span> created service <span class="hljs-string"><span class="hljs-string">"orders"</span></span> created deployment <span class="hljs-string"><span class="hljs-string">"payment"</span></span> created service <span class="hljs-string"><span class="hljs-string">"payment"</span></span> created deployment <span class="hljs-string"><span class="hljs-string">"queue-master"</span></span> created service <span class="hljs-string"><span class="hljs-string">"queue-master"</span></span> created deployment <span class="hljs-string"><span class="hljs-string">"rabbitmq"</span></span> created service <span class="hljs-string"><span class="hljs-string">"rabbitmq"</span></span> created deployment <span class="hljs-string"><span class="hljs-string">"shipping"</span></span> created service <span class="hljs-string"><span class="hljs-string">"shipping"</span></span> created deployment <span class="hljs-string"><span class="hljs-string">"user-db"</span></span> created service <span class="hljs-string"><span class="hljs-string">"user-db"</span></span> created deployment <span class="hljs-string"><span class="hljs-string">"user"</span></span> created service <span class="hljs-string"><span class="hljs-string">"user"</span></span> created</code> </pre> <br>  After performing these operations, you have to wait until all the subs appear: <br><br><pre> <code class="bash hljs">$ watch kubectl -n sock-shop get pods NAME READY STATUS RESTARTS AGE carts-2469883122-nd0g1 1/1 Running 0 1m carts-db-1721187500-392vt 1/1 Running 0 1m catalogue-4293036822-d79cm 1/1 Running 0 1m catalogue-db-1846494424-njq7h 1/1 Running 0 1m front-end-2337481689-v8m2h 1/1 Running 0 1m orders-733484335-mg0lh 1/1 Running 0 1m orders-db-3728196820-9v07l 1/1 Running 0 1m payment-3050936124-rgvjj 1/1 Running 0 1m queue-master-2067646375-7xx9x 1/1 Running 0 1m rabbitmq-241640118-8htht 1/1 Running 0 1m shipping-2463450563-n47k7 1/1 Running 0 1m user-1574605338-p1djk 1/1 Running 0 1m user-db-3152184577-c8r1f 1/1 Running 0 1m</code> </pre> <br><h3>  Access to sock shop </h3><br>  When all of them are ready, it remains to find out which port and IP address to go in to gain access to the store.  To find out the port, let's see where the frontend services are being forwarded: <br><br><pre> <code class="bash hljs">$ kubectl -n sock-shop get svc NAME CLUSTER-IP EXTERNAL-IP PORT(S) AGE carts 10.110.14.144 &lt;none&gt; 80/TCP 3m carts-db 10.104.115.89 &lt;none&gt; 27017/TCP 3m catalogue 10.110.157.8 &lt;none&gt; 80/TCP 3m catalogue-db 10.99.103.79 &lt;none&gt; 3306/TCP 3m front-end 10.105.224.192 &lt;nodes&gt; 80:30001/TCP 3m orders 10.101.177.247 &lt;none&gt; 80/TCP 3m orders-db 10.109.209.178 &lt;none&gt; 27017/TCP 3m payment 10.107.53.203 &lt;none&gt; 80/TCP 3m queue-master 10.111.63.76 &lt;none&gt; 80/TCP 3m rabbitmq 10.110.136.97 &lt;none&gt; 5672/TCP 3m shipping 10.96.117.56 &lt;none&gt; 80/TCP 3m user 10.101.85.39 &lt;none&gt; 80/TCP 3m user-db 10.107.82.6 &lt;none&gt; 27017/TCP 3m</code> </pre> <br>  It can be seen that the <code>front-end</code> ( <code>front-end</code> ) uses port 30001 and external IP-address.  This means that we can reach its services through the IP address of any worker (port) and port 30001. You can get the IP addresses of all nodes in the cluster through the <code>machinectl</code> : <br><br><pre> <code class="bash hljs">$ machinectl MACHINE CLASS SERVICE OS VERSION ADDRESSES kube-spawn-0 container systemd-nspawn coreos 1492.1.0 10.22.0.137... kube-spawn-1 container systemd-nspawn coreos 1492.1.0 10.22.0.138... kube-spawn-2 container systemd-nspawn coreos 1492.1.0 10.22.0.139...</code> </pre> <br>  Remember that the first node is the master, and all the rest are the workers (workers).  In our case, it is enough to open the browser and go to the address <code>10.22.0.138:30001</code> or <code>10.22.0.139:30001</code> , where the shop selling socks will greet us. <br><br><h2>  Stop cluster </h2><br>  When the sock purchases are finished, you can stop the cluster: <br><br><pre> <code class="bash hljs">$ sudo ./kube-spawn stop 2017/08/10 01:58:00 turning off machines [kube-spawn-0 kube-spawn-1 kube-spawn-2]... 2017/08/10 01:58:00 All nodes are stopped.</code> </pre> <br><h2>  Demonstration with instructions </h2><br>  For those who prefer ‚Äúguided tours‚Äù, watch the <a href="https://www.youtube.com/watch%3Fv%3DZp3AtfibXdM">video on YouTube</a> <i>(about 7 minutes in English - approx. Transl.)</i> . <br><br>  As mentioned in the video, kube-spawn creates a .kube-spawn directory in the current directory, in which you will find several files and directories in <code>default</code> .  In order not to be limited by the size of each OS Container, we mount <code>/var/lib/docker</code> each node here.  Because of this, we can use the disk space of the host machine.  Finally, at the moment we do not have a clean command.  Those who want to completely cover the traces of kube-spawn activity can execute the command <code>rm -rf .kube-spawn/</code> . <br><br><h2>  Conclusion </h2><br>  We hope you also find the kube-spawn utility useful.  For us, this is the simplest way to check for changes to Kubernetes or to deploy a cluster to learn Kubernetes. <br><br>  Many improvements can still be made to kube-spawn (and some of them are very obvious).  Very welcome pull requests! <br><br>  <b>PS from the translator</b> .  About the installation and other features of kube-spawn is written in <a href="https://github.com/kinvolk/kube-spawn/">the project's GitHub repository</a> .  Read also in our blog: <br><br><ul><li>  ‚Äú <a href="https://habrahabr.ru/company/flant/blog/333470/">Getting started in Kubernetes using Minikube</a> ‚Äù <i>(translation)</i> ; </li><li>  " <a href="https://habrahabr.ru/company/flant/blog/331188/">Our experience with Kubernetes in small projects</a> " <i>(video of the report, which includes an introduction to the technical device Kubernetes);</i> </li><li>  " <a href="https://habrahabr.ru/company/flant/blog/337698/">We write the operator for Kubernetes at Golang</a> " <i>(translation)</i> ; </li><li>  ‚Äú <a href="https://habrahabr.ru/company/flant/blog/335552/">How does the Kubernetes scheduler actually work?</a>  " <i>(Translation)</i> . </li></ul></div><p>Source: <a href="https://habr.com/ru/post/338132/">https://habr.com/ru/post/338132/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../338122/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ280 (September 11 - 17, 2017)</a></li>
<li><a href="../338124/index.html">‚ÄúUse the Power of Machine Learning, Luke!‚Äù Or automatic classification of luminaires according to the CIL</a></li>
<li><a href="../338126/index.html">Travis CI: automatic loading of collected modules on GitHub</a></li>
<li><a href="../338128/index.html">Where to go after ‚ÄúKickstarter‚Äù: difficulties of promotion of manufacturers of niche electronics</a></li>
<li><a href="../338130/index.html">It's a (focus) Trap</a></li>
<li><a href="../338134/index.html">How to assemble Ceylon in a container if your container ship is blocked</a></li>
<li><a href="../338136/index.html">OO VS FP</a></li>
<li><a href="../338140/index.html">PHP is alive. PHP 7 in practice</a></li>
<li><a href="../338142/index.html">Shopping with full-stack redux</a></li>
<li><a href="../338144/index.html">Rapid development of monitoring scripts with Bash, Outthentic and Sparrow</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>