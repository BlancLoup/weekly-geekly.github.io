<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>You do not have enough speed R? We are looking for hidden reserves</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sometimes one has to face the conviction that R, being an interpreter, is too slow to analyze the tasks of a ‚Äúfast‚Äù business. In most cases, such abst...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>You do not have enough speed R? We are looking for hidden reserves</h1><div class="post__text post__text-html js-mediator-article"><p>  Sometimes one has to face the conviction that R, being an interpreter, is too slow to analyze the tasks of a ‚Äúfast‚Äù business.  In most cases, such abstracts come from analysts who do not have experience developing serious software, including  high-performance or embedded systems that are extremely demanding of limited hardware resources.  This is perfectly normal, no one can know everything.  however, in 95% of cases, it turns out that R has nothing to do with it, the problem lies in inefficient memory management and the calculation process. <a name="habracut"></a></p><br><p>  Exactly therefore, in this note, 5 important points will be touched upon (6 and 10 can be called, but let it be 5), work on which very often helps to transform a slow code.  The record is rather abstract and in landing on R, since the principles themselves have long been known.  "Cheat Sheet" to start research on the possible optimization of the existing code. </p><br><ol><li><p>  All calculated data must be in RAM. </p><br></li><li><p>  All invariants with respect to loop variables must be calculated outside the loop. </p><br></li><li><p>  Use object copying effectively. </p><br></li><li><p>  Keep track of the structure of objects, clean the garbage. </p><br></li><li>  Optimize wisely. </li></ol><br><p>  Now step by step. </p><br><h1>  All in RAM </h1><br><p>  Do not do "just" data processing.  Analyze the task, calculate the amount of data you are working with, see how you can divide the data into autonomous data blocks, commensurate with the available RAM.  You can cheat these blocks sequentially, or you can, if there is such an opportunity, parallelize the work on each independent block (‚ÄúMap - Reduce‚Äù).  Swap to disk - downsizing in performance by several orders of magnitude. </p><br><h1>  "Take out the brackets" </h1><br><p>  The simple algebraic property of distributivity is relevant for cyclic calculations more than ever.  Any calculations, explicit or hidden in the functional approach that are not tied to the cycle index, should be moved out of the cycle.  Any long-calculated values ‚Äã‚Äãthat are used several times are highly desirable to move beyond the main body of the program and then to appear in the form of table values.  A long cycle of a few extra microseconds can make minutes-hours-days. </p><br><h1>  Watch copying </h1><br><p>  In high-level languages, behind each object / variable, quite complex structures can be hidden, containing a lot of additional service and meta information.  And then a simple procedure for performing an operation on an object, like this: </p><br><pre><code class="cpp hljs">t &lt;- f(t, n)</code> </pre> <br><p>  can lead to dynamic memory allocation and copying is far from a dozen bytes.  Being placed in a cycle, such a procedure can eat any frequency of any processor and ask for more. </p><br><h2>  Throw away trash </h2><br><p>  Take care of RAM.  Used the object and more you do not need it?  Remove manually, do not wait for the work of the scavenger.  You can not wait. </p><br><p>  Calculated regression and need only a table of values?  Do you know how much an <code>lm</code> object weighs and what is there too much? <br>  As an example, a blog post: <a href="http://blog.yhat.com/posts/reducing-your-r-memory-footprint-by-7000x.html">‚ÄúReducing your R memory footprint by 7000x‚Äù</a> </p><br><p>  Are you sure that you use the functions effectively?  Do you know how they work?  Here is another interesting example: </p><br><pre> <code class="cpp hljs">t &lt;- raw.df$timestamp object.size(t) #    <span class="hljs-number"><span class="hljs-number">130</span></span>  m &lt;- lapply(t, function(x){round(x, units=<span class="hljs-string"><span class="hljs-string">"hours"</span></span>)}) #   <span class="hljs-number"><span class="hljs-number">130</span></span>   <span class="hljs-number"><span class="hljs-number">35</span></span>  m &lt;- lapply(t, function(x){round_date(x, unit = <span class="hljs-string"><span class="hljs-string">"hour"</span></span>)}) #   <span class="hljs-number"><span class="hljs-number">8</span></span> !!! m &lt;- round_date(t, unit = <span class="hljs-string"><span class="hljs-string">"hour"</span></span>) # <span class="hljs-number"><span class="hljs-number">130</span></span> ,     </code> </pre> <br><p>  If you continue to work with this object <code>m</code> not only for reading, what will be faster to process 130kb or 35Mb?  In my opinion, the answer is quite obvious. </p><br><h1>  Code optimization </h1><br><p>  If the code runs slowly, see the execution profile.  Find bottlenecks and optimize them.  Do not waste time optimizing non-critical nodes. </p><br><p>  And we don‚Äôt forget the great scientist‚Äôs statement: "It‚Äôs a real problem." programming. "  - Donald Knuth, lecture "Computer Programming as an Art", published in the collection "Communications of the ACM" (Vol. 17, Issue 12, December 1974, p. 671) </p><br><p>  Useful links with debugging and profiling recommendations. </p><br><ul><li>  <a href="https://support.rstudio.com/hc/en-us/articles/218221837-Profiling-with-RStudio">Profiling with RStudio</a> </li><li>  <a href="https://support.rstudio.com/hc/en-us/articles/205612627-Debugging-with-RStudio">Debugging with RStudio</a> </li><li>  <a href="http://shiny.rstudio.com/articles/debugging.html">Debugging Shiny applications</a> </li><li>  <a href="http://shiny.rstudio.com/reference/shiny/latest/shiny-options.html">Global options for Shiny</a> </li><li>  <a href="https://www.rstudio.com/resources/videos/profiling-and-performance/">Shiny Developer Conference: Profiling and performance</a> </li><li>  <a href="https://www.rstudio.com/resources/webinars/profvis-profiling-tools-for-faster-r-code/">Shiny Developer Conference: Profvis - Profiling Tools for Faster R Code</a> </li></ul><br><h1>  Conclusion </h1><br><p>  Practice inevitably shows that these simple recommendations often help to speed up the code many times simply by making small modifications, without expensive iron upgrades, switching to parallel computing with complex orchestration, or moving some of the computational functions into C \ C ++ modules. </p><br><p>  Previous post: <a href="https://habrahabr.ru/post/310108/">‚ÄúUsing R to work with the statement‚Äú Who is to blame? Of course IT! ‚Äù‚Äù</a> <br>  Next post: <a href="https://habrahabr.ru/post/311330/">"We harness R to serve the business on" 1-2-3 ""</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/310472/">https://habr.com/ru/post/310472/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../310460/index.html">The Complete Docker Practical Guide: From Scratch to AWS Cluster</a></li>
<li><a href="../310462/index.html">Put on a diet PostgreSQL indices for Zabbix</a></li>
<li><a href="../310464/index.html">Work with Apache Ignite topology</a></li>
<li><a href="../310466/index.html">Automation of IT services</a></li>
<li><a href="../310470/index.html">Solar JSOC - the experience of building a commercial SOC</a></li>
<li><a href="../310474/index.html">16 myths about CRM-systems</a></li>
<li><a href="../310478/index.html">Stable version of Android Studio 2.2 released</a></li>
<li><a href="../310480/index.html">Why does the network of mobile operators sometimes ‚Äúfall‚Äù?</a></li>
<li><a href="../310482/index.html">Another type of XSS attack on the site</a></li>
<li><a href="../310484/index.html">Compress mobile graphics to ETC1 format and open utility</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>