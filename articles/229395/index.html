<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Generate pictures for Android applications from SVG</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 Hello. Not so long ago, I decided to try myself as a developer under the well-known Android platform. On the way of development, I ran ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Generate pictures for Android applications from SVG</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  Hello.  Not so long ago, I decided to try myself as a developer under the well-known Android platform.  On the way of development, I ran into many problems and one of them was the creation of images for different screen resolutions.  At first I tried to create pictures in PhotoShop, but it turned out to be a chore, you need to save 5 changes in any resolutions at any change, and I am not the genius of this program.  And then the thought occurred to me to draw pictures in SVG, before that I had experience with this format, I did visualization for cursors on queuing systems (emoticons ran to the cashier and sometimes accumulated in the queue). <br><a name="habracut"></a><br><h4>  Implementation </h4><br>  So, in Sublime Text I put the necessary pictures, everything is great and scalable, but it‚Äôs like to save these SVGs in different resolutions automatically.  For Java, there are libraries that convert this kind of graphics, but it turns out they don‚Äôt understand, for example, the &lt;use&gt; tags.  As a result, I thought and decided to write an application myself that would save everything in the necessary permissions according to its folders.  The language my choice fell on is JavaScript and the Node.js platform, since I have a primary employment with them. <br><br>  I started by searching for a module for Node.js, which could convert SVG to regular PNG images, but the modules found saved the image only in the resolution specified by the width and height parameters of the image.  Having spat, I decided to write everything myself.  A small list of tasks assigned to the application: <br><br><ul><li>  Client part converting images </li><li>  A server that gives the necessary information to the client and saves pictures </li><li>  Description in json format, which image in which permissions to save </li><li>  After converting all the images, the page in the browser should close and the server should stop </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Client part </h5><br>  The following is the algorithm of the client part. <br><br><ol><li>  Download information about the images and the permissions into which they need to be converted. </li><li>  We load the original SVG in the img tag and hang on the load event. </li><li>  After loading, draw this image on the &lt;canvas&gt; element </li><li>  Pull the image from &lt;canvas&gt; in text format by calling the function toDataURL ('image / png') </li><li>  We send the text of the picture to the server and, if we still have something to convert, go back to step 2 or 3, depending on whether you need to upload another picture, otherwise close the page </li></ol><br><br><pre><code class="javascript hljs">(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> DRAWABLE_RES_TYPES = [ <span class="hljs-string"><span class="hljs-string">'ldpi'</span></span>, <span class="hljs-string"><span class="hljs-string">'mdpi'</span></span>, <span class="hljs-string"><span class="hljs-string">'hdpi'</span></span>, <span class="hljs-string"><span class="hljs-string">'xhdpi'</span></span>, <span class="hljs-string"><span class="hljs-string">'xxhdpi'</span></span> ] , SVG_IMAGE_NAME_REGEXP = <span class="hljs-regexp"><span class="hljs-regexp">/[.*]*\/([^\/]+)\.svg$/i</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> canvas = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">'canvas'</span></span>) , context = canvas.getContext(<span class="hljs-string"><span class="hljs-string">'2d'</span></span>) , image = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'origin_image'</span></span>); sendMsg(<span class="hljs-string"><span class="hljs-string">'get_image_list'</span></span>, {}, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">imageInfo</span></span></span><span class="hljs-function">) </span></span>{ imageInfo.forEachAsync(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">group, callback</span></span></span><span class="hljs-function">) </span></span>{ group.imageList.forEachAsync(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">imagePath, callback</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imageName = imagePath.match(SVG_IMAGE_NAME_REGEXP)[<span class="hljs-number"><span class="hljs-number">1</span></span>]; image.setAttribute(<span class="hljs-string"><span class="hljs-string">'src'</span></span>, imagePath); image.addEventListener(<span class="hljs-string"><span class="hljs-string">'load'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ image.removeEventListener(<span class="hljs-string"><span class="hljs-string">'load'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>.callee); DRAWABLE_RES_TYPES.forEachAsync(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">drawableType, callback</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(drawableType <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> group.sizes)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> callback(); canvas.width = group.sizes[drawableType].width; canvas.height = group.sizes[drawableType].height; context.drawImage(image, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, canvas.width, canvas.height); sendMsg(<span class="hljs-string"><span class="hljs-string">'save_image'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: imageName, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: drawableType, <span class="hljs-attr"><span class="hljs-attr">body</span></span>: canvas.toDataURL(<span class="hljs-string"><span class="hljs-string">'image/png'</span></span>) }, callback); }, callback); }); }, callback); }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ sendMsg(<span class="hljs-string"><span class="hljs-string">'all_is_done'</span></span>, {}, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.close(); }); }); }); })();</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Secondary functions</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendMsg</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">action, data, callback</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xhr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); xhr.open(<span class="hljs-string"><span class="hljs-string">'POST'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://127.0.0.1:1337/'</span></span> + action, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); xhr.addEventListener(<span class="hljs-string"><span class="hljs-string">'readystatechange'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xhr.readyState === xhr.DONE) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xhr.status === <span class="hljs-number"><span class="hljs-number">200</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parsedAnswer = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(xhr.responseText); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(e); } callback(parsedAnswer); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Error with code '</span></span> + xhr.status + <span class="hljs-string"><span class="hljs-string">': '</span></span> + xhr.statusText); } }); xhr.send(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(data)); } <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>.prototype.forEachAsync = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">handler, callback</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> self = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> , index = <span class="hljs-number"><span class="hljs-number">-1</span></span> , tempCallback = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ index++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (self.length === index) callback &amp;&amp; callback(); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> handler(self[index], tempCallback); }; tempCallback(); }</code> </pre></div></div><br><br><h5>  Server part </h5><br>  Everything is clear, the usual server on Node.js, which responds to client requests and saves pictures that came from the client.  Attention, in my opinion, only the image saving function deserves, the rest can be viewed on GitHub, the link to the repository will be posted below.  So the save function looks like this: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveImage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options, callback</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> regex = <span class="hljs-regexp"><span class="hljs-regexp">/^data:.+\/(.+);base64,(.*)$/</span></span> , matches = options.body.match(regex) , imageExt = matches[<span class="hljs-number"><span class="hljs-number">1</span></span>] , imageBody = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Buffer(matches[<span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-string"><span class="hljs-string">'base64'</span></span>) , imagePath = config.outputFolder + <span class="hljs-string"><span class="hljs-string">'\\drawable-'</span></span> + options.type + <span class="hljs-string"><span class="hljs-string">'\\'</span></span> + options.name + <span class="hljs-string"><span class="hljs-string">'.'</span></span> + imageExt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!fs.existsSync(config.outputFolder + <span class="hljs-string"><span class="hljs-string">'\\drawable-'</span></span> + options.type)) fs.mkdirSync(config.outputFolder + <span class="hljs-string"><span class="hljs-string">'\\drawable-'</span></span> + options.type); fs.writeFile(imagePath, imageBody, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> err; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> msg = <span class="hljs-string"><span class="hljs-string">'File '</span></span> + imagePath + <span class="hljs-string"><span class="hljs-string">' is created.'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(msg); callback(err, { <span class="hljs-attr"><span class="hljs-attr">msg</span></span>: msg }); }); }</code> </pre><br><br>  It's all quite simple, in the options parameter come the parameters from the client, containing the text of the picture, the name and type of resources for Android.  Data is processed and written to a file.  On the server side, the fs, http module and one third-party module called <a href="https://www.npmjs.org/package/open">open is used</a> , which provides a function for opening a link in the default browser. <br><br><h5>  config.json </h5><br>  This file contains basic information.  Server information with port and hostname fields.  Path to the folder with the application resources for which you want to generate images.  And of course, information about SVG, their path and size for different resolutions.  For an example, there is only one object in which a list of files is placed, permission information and a description that is not used anywhere, but serves merely as a convenience.  If other images need their own resolution, we simply create a new object in the input data.  Example: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"server"</span></span>: { <span class="hljs-string"><span class="hljs-string">"port"</span></span>: <span class="hljs-number"><span class="hljs-number">1337</span></span>, <span class="hljs-string"><span class="hljs-string">"hostname"</span></span>: <span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span> }, <span class="hljs-string"><span class="hljs-string">"input"</span></span>: [{ <span class="hljs-string"><span class="hljs-string">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Action bar icons"</span></span>, <span class="hljs-string"><span class="hljs-string">"imageList"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"/svg/ic_bar_add.svg"</span></span>, <span class="hljs-string"><span class="hljs-string">"/svg/other_picture.scg"</span></span> ], <span class="hljs-string"><span class="hljs-string">"sizes"</span></span>: { <span class="hljs-string"><span class="hljs-string">"ldpi"</span></span>: { <span class="hljs-string"><span class="hljs-string">"width"</span></span>: <span class="hljs-number"><span class="hljs-number">24</span></span>, <span class="hljs-string"><span class="hljs-string">"height"</span></span>: <span class="hljs-number"><span class="hljs-number">24</span></span> }, <span class="hljs-string"><span class="hljs-string">"mdpi"</span></span>: { <span class="hljs-string"><span class="hljs-string">"width"</span></span>: <span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-string"><span class="hljs-string">"height"</span></span>: <span class="hljs-number"><span class="hljs-number">32</span></span> }, <span class="hljs-string"><span class="hljs-string">"hdpi"</span></span>: { <span class="hljs-string"><span class="hljs-string">"width"</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span>, <span class="hljs-string"><span class="hljs-string">"height"</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span> }, <span class="hljs-string"><span class="hljs-string">"xhdpi"</span></span>: { <span class="hljs-string"><span class="hljs-string">"width"</span></span>: <span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-string"><span class="hljs-string">"height"</span></span>: <span class="hljs-number"><span class="hljs-number">64</span></span> }, <span class="hljs-string"><span class="hljs-string">"xxhdpi"</span></span>: { <span class="hljs-string"><span class="hljs-string">"width"</span></span>: <span class="hljs-number"><span class="hljs-number">96</span></span>, <span class="hljs-string"><span class="hljs-string">"height"</span></span>: <span class="hljs-number"><span class="hljs-number">96</span></span> } } }], <span class="hljs-string"><span class="hljs-string">"outputFolder"</span></span>: <span class="hljs-string"><span class="hljs-string">"C:\\svg-android\\out"</span></span> }</code> </pre><br><br><h4>  Conclusion </h4><br>  The project can be downloaded from GitHub at <a href="https://github.com/LavrovArtem/svg-to-png-for-android">this link</a> . <br><br>  To start, enter the following line in the console: <br> <code>node index.js</code> <br> <br>  Do not forget to specify the folder in which you want to save the images, it must exist. </div><p>Source: <a href="https://habr.com/ru/post/229395/">https://habr.com/ru/post/229395/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../229383/index.html">Flying single Apollo mission vehicle on the moon: the story of one project</a></li>
<li><a href="../229385/index.html">On an effective software development process</a></li>
<li><a href="../229389/index.html">Lync 2013. Changing the domain name sip address</a></li>
<li><a href="../229391/index.html">Sound Blaster ROAR: Boombox XXI Century</a></li>
<li><a href="../229393/index.html">Travel Banking Transaction</a></li>
<li><a href="../229401/index.html">DKIM signature in MS Exchange</a></li>
<li><a href="../229403/index.html">Amateur approach to computational linguistics</a></li>
<li><a href="../229407/index.html">Parsek 2014: We continue to talk about space</a></li>
<li><a href="../229409/index.html">Agile practices in mobile development projects, July 16, Minsk</a></li>
<li><a href="../229411/index.html">How to educate the user and not drive him crazy. Experience Yandex Browser</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>