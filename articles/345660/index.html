<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Magic CharSequence</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Only at first glance, java.lang.CharSequence seems to be a simple interface of three methods, but upon detailed examination it opens us with several i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Magic CharSequence</h1><div class="post__text post__text-html js-mediator-article">  Only at first glance, <b>java.lang.CharSequence</b> seems to be a simple interface of three methods, but upon detailed examination it opens us with several interesting nuances. <br>  The interface is implemented by such java-classes as <b>String</b> , <b>StringBuffer</b> , <b>StringBuilder</b> , <b>GString</b> (groovy) and not only. <br><br>  <b>TL; DR.</b> If you add this interface to a class, it will receive some string properties and a number of possibilities will appear - comparisons with strings (for example, <b>String.contentEquals</b> ), use of various string APIs (for example, <b>Pattern.matcher</b> ), as well as in places for automatic behavior detection depending on the type (for example, binding query parameters in jdbc). <br><br>  In addition, this approach will simplify the implementation of a number of refactorings to enhance the type system in an application ‚Äî primarily replacing String objects with specialized wrappers or enum constants. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  String scalars </h4><br>  To add restrictions on the format of the value, as well as enhancing type safety, instead of strings, special scalar wrappers can be used.  For understanding, consider an example - let the client ID be a string corresponding to a regular expression.  Its wrapper class will look something like this: <br><a name="habracut"></a><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ClientId</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String value; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ClientId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.value = value; } <span class="hljs-comment"><span class="hljs-comment">/** * ... * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> IllegalArgumentException ... */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> ClientId </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fromString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String value)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IllegalArgumentException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (value == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || !value.matches(<span class="hljs-string"><span class="hljs-string">"^CL-\\d+$"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalArgumentException(<span class="hljs-string"><span class="hljs-string">"Illegal ClientId format ["</span></span> + value + <span class="hljs-string"><span class="hljs-string">"]"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ClientId(value); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> value; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eq</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ClientId that)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.value.equals(that.value); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object o)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (o <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> String) { <span class="hljs-comment"><span class="hljs-comment">//   -   ( false) // -  equals     throw new IllegalArgumentException("You should not check equals with String"); } return o instanceof ClientId &amp;&amp; eq((ClientId) o); } @Override public int hashCode() { return value.hashCode(); } @Override public String toString() { return value; } }</span></span></code> </pre> <br>  Such an object loses the properties of the string, and to return them, you need to make a call to getValue () or toString ().  But you can do otherwise - mix in our class CharSequence. <br><br>  Consider the interface (java 8): <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DefaultCharSequence</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CharSequence</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">length</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> toString().length(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">charAt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> toString().charAt(index); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> CharSequence </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">subSequence</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> start, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> end)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> toString().subSequence(start, end); } }</code> </pre><br>  If we add it to our class, i.e. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ClientId</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DefaultCharSequence</span></span></span><span class="hljs-class"> </span></span>{</code> </pre><br>  then a number of possibilities will appear. <br><br>  For example, now you can write like this: <br><br><pre> <code class="java hljs">ClientId clientId = ClientId.fromString(<span class="hljs-string"><span class="hljs-string">"CL-123"</span></span>); String otherClientId = ...; <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">NOTE:</span></span></span><span class="hljs-comment"> equals      ,    if (otherClientId.contentEquals(clientId)) { // do smth }</span></span></code> </pre><br><h4>  String comparison </h4><br>  String comparison is one of the most commonly used string operations.  The most common option is to call <b>String.equals (otherString)</b> .  The first problem we may encounter is null-safety, traditionally it is solved by flip an object with an argument if one of them is a constant: <b>STRING_CONSTANT.equals (value)</b> .  If any of the arguments can be null, <b>java.util.Objects.equals (o1, o2)</b> comes to the rescue. <br><br>  In the realities of complex and large projects, another problem of <b>equals</b> awaits us - weak typesafety argument (any Object).  In practice, this means that as an equals argument, you can pass any object (for example, <b>Integer</b> or <b>Enum</b> ), the compiler will not even give a warning to this, the call will simply return false.  It is reasonable to note that such an error is easy to detect at the development stage - here the IDE will prompt and it will be revealed at the first tests.  But when the project grows in size, turns into legacy and at the same time continues to evolve, a situation may arise sooner or later when <b>STRING_CONSTANT</b> turns from String into <b>Enum</b> or <b>Integer</b> .  If the test coverage is not high enough, <b>equals</b> will start giving false <b>false</b> . <br><br><div class="spoiler">  <b class="spoiler_title">This can also be solved.</b> <div class="spoiler_text">  This can be identified after the fact by manually running Code Analyze, or using tools like <b>Sonar</b> .  In IDEA, this code analyze is called "equals () between objects of inconvertible types" </div></div>  but good practices are about prevention, not about fighting the consequences. <br><br>  To enhance type checking at compile time, the <b>equals</b> call can be replaced with <b>String.contentEquals (CharSequence)</b> , or <b>org.apache.commons.lang3.StringUtils.equals (CharSequence, CharSequence)</b> <br>  Both of these options are good because now we can compare the String with our ClientId without additional conversions, in the case of the latter - including.  also null-safe. <br><br><h4>  Refactoring </h4><br>  The situation described above may seem somewhat far-fetched, but this decision came as a result of various legacy-code refactorings.  A typical revision, which in this case is referred to, is the replacement of objects of type String with wrapper classes or enum constants.  Wrapper classes can be used for a number of typical immutable strings - contract, card, phone number numbers, passwords, hash sums, names of specific element types, etc. A wrapper class can also add specific methods for working with it.  If this refactoring is not approached very carefully, you may encounter a number of problems - the first of which is insecure equals. <br><br>  There is a restriction for wrapper classes that do not wrap a String, but for example numeric values.  In this case, the toString call can be relatively expensive (for the same successive call to the <b>charAt</b> for the entire string) - here you can potentially use a lazy cached String representation. <br><br><h4>  Binding arguments to jdbc requests </h4><br>  At once I will clarify that we are talking about <b>spring-jdbc</b> , binding through <b>JdbcTemplate / NamedParameterJdbcTemplate</b> <br>  We can pass an object of the class ClientId in the binding of the parameter value, since  it implements a charsequence: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Client </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getClient</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ClientId clientId)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> jdbcTemplate.queryForObject( <span class="hljs-string"><span class="hljs-string">"SELECT * FROM clients "</span></span> + <span class="hljs-string"><span class="hljs-string">"WHERE clientId_id = ?"</span></span>, (row, rowNum) -&gt; mapClient(row), clientId ); }</code> </pre><br>  If we consider this code as remade from the initial <b>getClient (String clientId)</b> declaration, then as far as the use of the passed value is concerned, everything will remain unchanged. <br><br><div class="spoiler">  <b class="spoiler_title">How it works</b> <div class="spoiler_text">  <b>org.springframework.jdbc.core.StatementCreatorUtils.setValue</b> determine the type of the argument first as CharSequence (see. <b>isStringValue ()),</b> then make the conversion to toString, and Binding himself to become a PreparedStatement <b>ps.setString (paramIndex, inValue.toString ()) ;</b> <br></div></div><br><h4>  Conclusion </h4><br>  I have been using this method in my projects for several months and have not yet encountered any problems. <br><br>  The API that uses CharSequence instead of String is quite rich - just find usages for CharSequence is enough.  Particular attention can be paid to the Android library - there is especially a lot of it, but here I am afraid to advise anything, because  This method has not yet been tested on it. <br><br>  I would be happy to get feedback on the question - what do you think about this, what profit / rake is there and is there any point in using such practices at all. </div><p>Source: <a href="https://habr.com/ru/post/345660/">https://habr.com/ru/post/345660/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../345650/index.html">Achieving Maximum Performance Fast Fourier Transform Based on Data Management</a></li>
<li><a href="../345652/index.html">PostgreSQL News Digest</a></li>
<li><a href="../345654/index.html">Happy semi-final stories about the automation of test schemes</a></li>
<li><a href="../345656/index.html">We try q-learning to taste, the story in three parts</a></li>
<li><a href="../345658/index.html">Why does it seem to me that students are learning OOP wrong</a></li>
<li><a href="../345662/index.html">How to replace HR-a with a robot?</a></li>
<li><a href="../345664/index.html">Data mining in R</a></li>
<li><a href="../345666/index.html">My first job</a></li>
<li><a href="../345668/index.html">A bit about IT in New Zealand</a></li>
<li><a href="../345670/index.html">JetBrains CLion for microcontrollers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>