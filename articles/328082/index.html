<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Stress test teams: how to make a GPU benchmark and do not overheat</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! We returned to the blog with a story about the latest release. UNIGINE team released a new GPU-benchmark Superposition with VR features in A...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Stress test teams: how to make a GPU benchmark and do not overheat</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr!  We returned to the blog with a story about the latest release.  UNIGINE team released a new GPU-benchmark Superposition with VR features in April.  We filled new bumps, invented a couple of dozen sudden rescue solutions and a new technology in 3D graphics. <br><br>  Inside the post there are many beautiful renderers, several dramas with a technical slant, 4.5 artists, evil Valve moderators, upset AMD, NVIDIA and Intel and commits from the operating room.  Come on in! <br><br> <a href=""><img src="https://habrastorage.org/web/360/b00/aa5/360b00aa57714ad3a3413398c4235daa.jpg"></a> <br><a name="habracut"></a><br><h2>  In the beginning there was a demo </h2><br>  We released our first benchmark 10 years ago, in 2007.  Then we made another 3D demo, which turned out to be so demanding that it only worked on top-end video cards at that time, the rest did not cope, braked and overheated.  Began to think what to do with it?  And they decided: since the demo loads iron so much, why not use it?  What can it be useful for?  Thus, the first benchmark Sanctuary emerged from the by-product, and at UNIGINE - one more direction. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <a href=""><img src="https://habrastorage.org/web/fd7/f8e/f47/fd7f8ef47b1b4167b2a9c0a7f07ae99d.png"></a> <br>  <i>Graphics in 2007 is no longer impressive, but it is nostalgic.</i> <br><br><h2>  Who and why do we need benchmarks? </h2><br>  GPU benchmarks have a rather specific, but constant audience.  Basic free versions diverge in tens of millions.  Overclockers need them to compete in squeezing performance out of iron.  For gamers, assess whether their video card will pull the latest hit toy.  Iron manufacturers need benchmarks as a ‚Äúruler‚Äù, which can measure the results during development.  Computer stores and repair shops benchmark is useful as a tool for output control of the stability of the computer assembly. <br><br> <a href=""><img src="https://habrastorage.org/web/09b/757/1e2/09b7571e2f944a13a39ab52648519b2d.jpg"></a> <br>  <i>We released the third benchmark (Heaven) in 2009, and it is still used by millions of people around the world.</i> <br><br>  And why do they need us?  Since the benchmark task is to load iron to the maximum, we, without being embarrassed in the media, show the level of graphics that can be done on the UNIGINE engine, and what will become the standard in 3D graphics tomorrow and the day after tomorrow.  So benchmarks are also a very clear demonstration of technology, and additional marketing.  The most frequent phrase of customers who came for the engine: "And, I know your benchmarks, I use them all my life!" However, there is a minus: some people think that the benchmark is just an application on the brake engine (and this is far from it).  We have to explain that extreme load is so conceived. <br><br>  And thanks to the benchmarks, we work closely with the manufacturers of graphics processors, so that in the video drivers inside your computer there is always optimization for UNIGINE.  All is well: vendors have a reliable performance test, and our developers have access to tomorrow's hardware.  Naturally, there is a fly in the ointment: vendors often hate us.  It seems to everyone that on our benchmarks, their video cards have a weak performance and, on the contrary, their competitors are too high.  So NVIDIA periodically believes that we sold out to AMD, and AMD - that we sold out to NVIDIA. <br><br><h2>  They thought about the demo, and then it started </h2><br>  The project, which eventually turned into a benchmark Superposition, began in March 2016.  We wanted to complement the SDK engine UNIGINE 2 with a new interior 3D demo.  Why the interior? <br><br>  We have accumulated a lot of demos with large spaces from horizon to horizon.  Therefore, some clients began to perceive UNIGINE 2 exclusively as an engine for scenes of planetary scale.  He really does a great job with them, but he also knows how to make detailed detailed plans.  Here is a project that would show all the capabilities of the engine when working with close plans, we as part of the UNIGINE 2 SDK just did not have enough. <br><br> <a href=""><img src="https://habrastorage.org/web/4af/06a/744/4af06a744dea43f6ac97b6a48466e5ff.jpg"></a> <br>  <i>On the UNIGINE 2 engine, you can create scenes in real-time up to the size of the solar system.</i> <br><br><h2>  Lamp setting </h2><br>  We immediately decided that we didn‚Äôt want to make a modern designer interior: too sterile, too visually boring.  Yes, beautiful.  But from the next licked picture of the eye just slides off: oh, interiorik, we look further. <br><br>  We were going to make our demo scene like looking at and exploring.  For this, it is not enough just to fill the space with objects and make a cool render.  In order for the room to be interesting to ‚Äústay‚Äù and carefully consider it, there should be a story behind it. <br><br>  So, artists had to come up with a concept and a setting.  To the room was both unique and recognizable.  Since our engine, and especially benchmarks, are used from Australia to Scandinavia and from Singapore to California, we needed human images that were understandable in any country and culture.  And such that at first glance fantasy played out and asked for supplements. <br><br><img src="https://habrastorage.org/web/86e/ac3/27c/86eac327c82a4f9e9603061fcd47833a.jpg"><br>  <i>The first refs for the concept of the future benchmark were collected from films: fiction and films about prominent scientists of the 20th century.</i> <br><br>  Best of all for the international product were the visual refs from the cinema: made in Hollywood know everything and everywhere.  We have already decided that the ‚Äúroom‚Äù will be a classroom or laboratory.  So the artists reviewed the sea of ‚Äã‚Äãfilms where they study or conduct experiments: from "Edward Scissorhands" and "Flies" to "Imitation Games." <br><br>  Most of all, the style of scientific laboratories of the 40s and 50s caught on: a boom in the development of science and related romance, a type of genius scientist that appeared at the same time, spending days and nights at work.  So we decided on the setting: we are making an educational lab-laboratory from the 1950s.  A team of artists gathered a rough first scene from primitives and sat down to create content. <br><br> <a href=""><img src="https://habrastorage.org/web/030/947/289/030947289ca24e2a9451cffab39373fa.jpg"></a> <br> <a href=""><img src="https://habrastorage.org/web/d00/377/e01/d00377e017bd454da88ce6ed66c4c87e.jpg"></a> <br>  <i>Pre-production: outline composition of the scene.</i> <br><br>  Artists were given complete freedom and 3 months time.  The main thing that was required: to give the maximum quality and rich content scene.  Although the prospect of turning a demo into a benchmark was right as long as the task was limited to a static scene without logic, but with a lot of different objects.  At the pre-production, we considered that we needed to make unique items about 120. For a period of 3 months by 4 people the task was difficult.  But not impracticable. <br><br> <a href=""><img src="https://habrastorage.org/web/6a3/98b/124/6a398b1241a042dba664545b5707f56c.png"></a> <br>  <i>So the laboratory looked for the second month of work.</i> <br><br> <a href=""><img src="https://habrastorage.org/web/fd1/cfe/bb8/fd1cfebb81fc46c7a57e1c2d25147ba0.jpg"></a> <br>  <i>So she began to look six months later, in October.</i> <br><br><h2>  And not a telescope at all, but a very portal. </h2><br>  It was the second half of the second month.  Our laboratory has overgrown with details and more and more became similar to itself.  But she still lacked very little - the central object.  The leading 3D artist and art director of the entire project Davyd was responsible for the concept and production of the ‚Äúmain character‚Äù. <br><br>  To design a lot of references were collected: laboratory equipment, machine tools, robots, sci-fi units.  The number of files in the classroom \ refs \ center_object folder has grown.  Initially, the idea was to make a teleport from small objects.  Two coasters, with one object disappeared, and on the other teleport.  But after a couple of days of stubborn blocking (as the artists call the stage of building a silhouette out of primitives), the result still did not suit.  Everything invented did not fit into the geometry of the room.  The central object either needed to be placed in the very center of the room, and then it looked like an altar, or somewhere in a corner, but in this case the object ceased to be central. <br><br><img src="https://habrastorage.org/web/a7a/b7e/ee9/a7ab7eee99314be2b9c80fc2a13f2183.jpg"><br>  <i>There were a lot of ideas of the central object, even more visual references.</i> <br><br>  As a result, Davyd came to the conclusion: you need to try symmetrical geometry.  Having rummaged in the reference, I found a photo of this symmetric unit with colored protruding "horns".  Something they resembled thorns on the head of the Statue of Liberty, and at this moment immediately before my eyes I "clicked" on the image: we need a large, detailed piecework with thorns on the "head".  Yeah, we'll put the doors in the front, so that a person can enter there and somehow settle down inside.  And to make it easier for him, we will make a slight slope.  And behind it is necessary "meat" - cylinders, tubes, wires, and surely asymmetric!  The idea and image formed, it remained only to sit down and do. <br><br><img src="https://habrastorage.org/web/337/d68/35c/337d6835c0bf46e7a7d217213f0b5acd.jpg"><br>  <i>This photo helped to finally come up with a portal from the Superposition.</i> <br><br>  As we learned after the release, this photo shows a gas-dynamic trap at the Novosibirsk Institute of Nuclear Physics.  They say that you can go on an excursion to the institute.  So if you are from Novosibirsk, you have every chance to see the prototype of our portal alive. <br><br><div class="spoiler">  <b class="spoiler_title">By the way, we wrote that we had 4 artists, but in fact there were 4.5 of them.</b> <div class="spoiler_text">  Closer to winter, when the number of objects in the laboratory was selected to 700 (and all were interactive!), We had a freelance remote artist from the mining town of Prokopyevsk.  Stepan, a classmate of our lead over the artists Davyd, together with him began to ‚Äúmodel something‚Äù at school, but then he abandoned it.  And now decided to make up. <br><br>  ‚ÄúMaybe you need to model something there?  Otherwise, I'll die here, ‚Äùwrote Stepan from somewhere in the Kuzbass winter.  He was ready for the interest and pumping skills to do small objects.  Rulers, scissors, compasses, pens, pencils, erasers, a whole sea of ‚Äã‚Äãother trifles that are important to the atmosphere of a working disorder in the laboratory are all made by Stepan‚Äôs hands.  So in the release version of Superposition of objects it became more than 900. <br></div></div><br><h2>  We will make a new benchmark, with VR and interactive </h2><br>  Three months allocated for the production of content, resulted in four.  Conceived scene was ready.  It remained to add a minimum of logic and interactivity - and that's it, you can send it to the SDK! <br><br>  But the final transformation of the demo in the benchmark was influenced by two things.  By September, there were already 600 objects in the scene, and she was successfully doing what was required of the benchmark: how well the GPU was loaded.  Second, Sasha, a game logic programmer, came to the team.  All the other programmers were painted on projects, but now we had another person with the necessary skills to create an interactive part. <br><br>  And I wanted to have interactivity for a long time, because until this point all UNIGINE benchmarks were somewhat static.  By Heaven and Valley you can walk, but no more.  Because of this, we often encountered the opinion that everything is static in the UNIGINE engine.  Do you want interactive?  Will you interactive! <br><br>  In parallel, there was a mass VR boom.  HTC Vive came out, Oculus Touch should have appeared for Christmas.  For the clients of the UNIGINE 2 engine, we have added VR support for a long time - with the same Oculus Rift, the engine is compatible with 2013.  But UNIGINE has not yet had a publicly available VR product.  And in our room-laboratory with a bunch of items and a legend about the professor VR and it was suggested. <br><br><img src="https://habrastorage.org/web/b60/803/ff9/b60803ff919e48a3b8afc04760d12a0a.jpg"><br><br>  So, by the autumn the task has become more complicated: it will be a benchmark with an interactive mode, VR support and the most advanced graphics, so that the video cards will have enough of it until 2020.  Hurray, work again! <br><br>  Because of the sudden VR, a problem appeared: what looked normal on the monitor seemed distorted or disproportionate in virtual reality.  For example, the teaching desk turned out to be too big: ‚ÄúYes, you can carve a horse on it!‚Äù Said the artists when they looked at the stage through the helmet.  And once again sat down for the content, adapt everything for VR. <br><br>  We had to spend a lot of time interacting with objects in VR: the controllers have no feedback, but you need to give the user a realistic feeling of different objects in their hands.  Throwing objects is also a non-trivial moment, done in several iterations (difficulty in determining a realistic throw vector).  About this there are already good articles, for example, this one is the <a href="http://www.gamasutra.com/blogs/CharlieDeck/20161118/285808/Why_Throwing_in_VR_Sucksand_How_to_Make_it_Better.php">original</a> and the <a href="https://habrahabr.ru/post/319250/">translation in Habr√©</a> . <br><br>  Moving to VR is also special.  For example, experimentally, we found out that it is better to turn the camera discretely when turning with the buttons, and not to accelerate it smoothly - this way the user is less swayed.  Fortunately, with teleport in VR applications, everything is more or less standard, took aim and jumped. <br><br>  The first "field tests" benchmark Superposition was held at the Tomsk IT conference in November.  In the same place, without departing from the stand, we programmed two new features: a hat and a cigarette became interactive. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/4TYhmICwZe4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2>  Steam drama </h2><br>  When all the TTX benchmark finally formulated, we decided to try to send the release on Steam through the Greenlight system.  From past experience with Heaven, which was given the "green light" when it was no longer necessary, we knew that the software section on Steam is such a black box with the illusion of democracy.  It seems that users vote, but still decide the moderators Valve.  Moreover, the timing and selection criteria are unknown to anyone.  Even if you are six months in the first place, the passage of Greenlight is not guaranteed. <br><br> <a href=""><img src="https://habrastorage.org/web/ab3/775/671/ab37756713cd4c03b9c53a307d91d779.jpg"></a> <br>  <i>The superposition took off right away: in the first two weeks of voting, the benchmark received 95% of the votes in favor (the usual rating of projects at Greenlight is about 40%).</i>  <i>But it turned out it does not matter.</i> <br><br>  Just before the New Year, we happily ordered a pizza in honor of the first place in the Greenlight Run: out of 2,000 participants, Superposition on Steam was the most waited. <br><br>  And almost immediately after the New Year holidays, we received a letter from the moderators that we were removed from the vote.  It turned out that literally before applying for Steam introduced new rules.  Now the benchmark did not fall into any category of software allowed to participate in Greenlight. <br><br> <a href=""><img src="https://habrastorage.org/web/748/01e/b4f/74801eb4f218460b82a6f7d4b46da766.jpg"></a> <br>  <i>Deciding that the festive mood does not happen much, we dressed up the portal.</i>  <i>But - early rejoiced.</i> <br><br>  Steam exploded with evil comments to Valve, <a href="https://www.techpowerup.com/229719/unigine-superposition-benchmark-not-good-enough-for-steam">they wrote about it in the newspapers</a> , wrote on the forums.  But Valve did not give up.  What turned out to be not so bad: we later found out that launching through the Steam application slows down the system and degrades performance.  Not too hard, but for professional overclockers, any error in performance is critical. <br><br><h2>  I guess this video card on four numbers! </h2><br>  Four years have passed since the release of Valley, and the algorithm recognizing the type of GPU and other system characteristics needed to be seriously updated.  For the development of an updated detector sat down programmer Tolya.  He came to UNIGINE at the second attempt and was actually a web programmer.  But by the second approach I pulled C ++ up to the level ‚ÄúI can, I practice‚Äù and voluntarily took up the detector upgrade to get even more pumped. <br><br><img src="https://habrastorage.org/web/892/eea/495/892eea495a2f4b558aa1e218684c1037.jpg"><br><br>  Where do I get the data about the GPU?  In each video card, four numerical IDs are sequentially sewn: vendor, chip vendor, sub vendor and sub device.  The easiest option is to pull them out of the driver API.  We take the ID, compare it with the iron base, we get the exact and full name of the video card.  But this is the ‚Äúlucky‚Äù option. <br><br><img src="https://habrastorage.org/web/139/645/2bf/1396452bf1544fb19e06167bed6bd631.jpg"><br>  <i>Even one video card is not easy to recognize, but what if there are three different ones in the system?</i>  <i>The answer will be lower.</i> <br><br>  Just like that, you can get an ID from the driver API only on Windows.  There the drivers are proprietary, of which our detector extracted the necessary data without serious consequences.  On Linux, the zoo has many more drivers.  There are proprietary drivers too, but Linux users love everything open, so there are a lot of options.  Even more complicated Tolin's life is that in most Linux ‚Äúfirewood‚Äù there are no necessary APIs at all and the configuration of a video card with a few lines of code can no longer be pulled out.  We have to get florid. <br><br>  On Linux, the detector needs to get into the files that are produced by the video drivers.  Depending on the model of the card and the ‚Äúfirewood‚Äù, these files are stored in different places and are called differently.  A pack of detector code knocks on system commands, on thermal sensors and other places, finds files and, like a good cop, extracts information from them.  It is especially difficult to do this without a root access level. <br><br> <a href=""><img src="https://habrastorage.org/web/1e1/d0c/85e/1e1d0c85e44c43fd8e91d98fe4402112.png"></a> <br>  <i>Fragment of the very detector code that got us data under Linux.</i> <br><br>  And what if there are several video cards in the system from different vendors?  In order to understand, in principle, which video card is active, Tolya wrote a piece of code for 300 lines, which in parallel with the work of the benchmark made snapshots. <br><br>  First of all, the code checked the utilization of the video card (the idea with the recycling was suggested by Misha, the lead graphics programmer).  Experienced to find out that even when the video card is turned off, recycling can be from 1 to 10%.  Therefore, we had to set the value to 15%, if the utilization went out more, the video card was recognized as active. <br><br>  But the measurement of recycling was not obtained on all video cards.  Therefore, we had to look further.  The code looked at the Windows drivers and Linux nooks and asked every 200 milliseconds: ‚ÄúHey, how are you going with temperature and frequency?‚Äù At the end of the run, the minimum and maximum of these parameters made it clear which video card was active.  Although there also appeared "nuances".  For example, we had to take into account that if the video cards are nearby, one can simply heat the other.  So, the drops did not count up to 2 ¬∞ C for the changes. <br><br>  Another of the heaps of "private" examples.  With some AMD cards, the ID of the vendor 1002 did not return in the hexadecimal system, as it should, but in the decimal.  In this case, the video card was not detected at all, and the detector produced the result ‚Äú0 video cards‚Äù. <br><br> <a href=""><img src="https://habrastorage.org/web/fc4/339/19e/fc433919e4184c9d95a85cc68d248dfe.png"></a> <br>  <i>For each such particular algorithm had to file.</i>  <i>Considering that in the database we assembled, the currently living video cards turned out to be more than 9000 variants, there were a little more details than a lot.</i> <br><br>  In general, the definition of iron is not a trivial task, and almost no one knows how to do it cross-platform.  You can, of course, license the CPU ID SDK libraries (as was done in 3dmark) and the GPU-Z SDK, but they only work under Windows. <br><br>  When, after three weeks of the inhuman efforts of Toli, the detector was ready and we checked everything we could reach, it became clear that this was a drop in the sea of ‚Äã‚Äãthe whole variety of GPUs.  Attention, the question is: where to get more different iron to test on any decent sample? <br><br><h2>  Full internet configurations </h2><br>  And we decided to announce open testing.  Two detector assemblies for Windows and for Linux, respectively, scattered across the forums and community asking for help with the tests.  Those who wanted to participate in the development needed to launch a detector and send us the resulting logs and screenshots of CPU-Z and GPU-Z, as the only intelligible standard. <br><br>  Have you ever asked strangers on the forum to download and run unidentified * .exe?  Try it!  ‚ÄúDo not run, there is a virus!‚Äù, ‚ÄúYes, it bitcoins mine!‚Äù, ‚ÄúDoctor, it determined the serial of my motherboard!‚Äù, ‚ÄúYes, these are generally some Russians.  What do you want to say, do Russians work in UNIGINE?  Clearly phishing, do not get fooled! ‚Äù <br><br><img src="https://habrastorage.org/web/d0a/d0f/5b3/d0ad0f5b3b7743d898952417ed81872e.PNG"><br>  <i>Open testing is awesome.</i>  <i>But when you have more than 400 such screenshots, you have to sweat.</i> <br><br>  We were banned, we were banned, the PR man corresponded with the moderators, arguing that this is not a camel, but really UNIGINE.  Then we wrote in official social networks: calmly, comrades, testing is underway.  The cautious public realized that this is really us.  And that you can participate in the development of a new benchmark UNIGINE. <br><br>  And the real Log Rush began.  Andrei, the main Superposition project, raked mail for days, answered emails and downloaded user logs scattered across the forums and social networks.  As a result, we collected 450 results, with the help of which we managed to calibrate the detector.  And volunteers still continue to send their logs sometimes. <br><br><h2>  Want some new tracing? </h2><br>  The benchmark was originally wanted to be released at the end of 2016, but the release moved to the first quarter of 2017.  First, the Christmas rush is not the best time to release a mass product.  Secondly, the priority for us is, after all, the engine and the non-shifting release of the <a href="">UNIGINE 2.4 SDK</a> .  But now there is a time to add to the Superposition a new tracing technology - SSRTGI (Screen Space Ray Tracing Global Illumination), on which Michael, one of the programmers of the engine, and Davyd, the leading artist, worked together. <br><br> <a href=""><img src="https://habrastorage.org/web/67e/b51/a06/67eb51a063384bdc81f42acae072c4bc.gif"></a> <br>  <i>Lighting without SSRTGI // Lighting with SSRTGI on</i> <br><br>  The usual screensaver effects SSAO and SSGI do not use tracing.  Yes, they make a 3D-image more similar to reality, but ‚Äúcheat‚Äù: they try to reproduce a similar picture to a real one, but not at all in the way real lighting works.  It helps to a certain extent, but the difference is still visible at first glance. <br><br>  We made a technology built on the principle of ray tracing in the real world.  SSRTGI takes into account the movement of rays, reflection from objects, obstacles, shading, and evens out the normals in the transitions between objects.  In the end, we got a picture that is comparable in quality to the offline renderer, but in real time.  Objects remain interactive.  Each can be moved as you please, and it will not stand out sharply from the rest of the picture, as often happens in games. <br><br> <a href=""><img src="https://habrastorage.org/web/4b7/d58/db8/4b7d58db890a4d10a290e110e023aa40.gif"></a> <br>  <i>Lighting without SSRTGI // Lighting with SSRTGI on</i> <br><br>  How the SSRTGI technology works, we will tell in details in the next post, along with the release of UNIGINE 2.5.  In the meantime, the device effects and their work on different settings can be viewed in the game mode Superposition, including debug. <br><br><h2>  Music perfect for repit </h2><br>  Misha Paralyzah wrote the music for all our projects (the previous benchmarks and the game Oil Rush), he also started the Superposition soundtrack.  The difficulty is that the benchmark is usually run repeatedly, and the music should not tire the user, but at the same time it is an important component that forms the overall impression.  Plus, the music should ideally fall on the spans of the cameras in order to maintain the pace of what is happening. <br><br>  We did not have the opportunity to record the symphony orchestra alive, so Micah collected the soundtrack in his home studio, with just a good base of virtual instruments, midi-keyboard and many years of experience.  You can listen to the result yourself - the measured sounds of the piano are picked up by the fierce cello, and electronic notes are intertwined with them, when on the screen the power of science overcomes gravity and time. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://w.soundcloud.com/player/" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> All the pain of manufacturers </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We have already mentioned that one of the advantages of benchmarking is working closely with the developers of graphics processors. </font><font style="vertical-align: inherit;">On the one hand, this is a great perk: direct contact with engineers and access to the hardware of tomorrow. </font><font style="vertical-align: inherit;">On the other hand, the project adds a large amount of work.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The first pre-pre-alpha vendors issued before anyone else, in November. But they got into an unsuccessful period: then their laboratories were fully occupied with tests of Advent games. "Let go" of producers closer to March, but all at once. We were alternately and simultaneously fired from three sides with the results of lab tests and NVIDIA, and AMD, and Intel. It seemed to those and others that it was their Superposition video card that somehow underestimated. We are only interested in the optimization of critical things for users. Due to the lingering silence of the vendors, a large chunk of this work came in the last weeks. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GPU manufacturers suffered. ‚ÄúOver the weekend, your settings have changed three times!‚Äù - Some were indignant. ‚ÄúOur video cards are much better, this is your wrong benchmark!‚Äù Others were indignant.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After refinement and optimization, we reached a balance by long correspondence: the benchmark still did not suit all manufacturers equally, but at a minimum. </font><font style="vertical-align: inherit;">But the benchmark had everything the user needed: an accurate measurement of the performance of a wide variety of video cards.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leaderboards? </font><font style="vertical-align: inherit;">Leaderboards!</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Under each news about UNIGINE benchmarks, screenshots with results are sure to appear. </font><font style="vertical-align: inherit;">On every self-respecting overclocker and computer hardware forum, threads grow with results, for example, Valley has an </font></font><a href="http://www.overclock.net/t/1360884/official-top-30-unigine-valley-benchmark-1-0/13280"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">epic thread of</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1300 pages. </font><font style="vertical-align: inherit;">And we decided: since we are already the fifth benchmark, it‚Äôs enough to sit on other people's forums. </font><font style="vertical-align: inherit;">It's time to start </font><a href="https://benchmark.unigine.com/leaderboards"><font style="vertical-align: inherit;">your own leaderboards</font></a><font style="vertical-align: inherit;"> ! </font><font style="vertical-align: inherit;">About them, we suddenly and stumbled. </font><font style="vertical-align: inherit;">The whole process of production and release of the benchmark from and to was known for a long time, and it was easy to plan it. </font><font style="vertical-align: inherit;">But the development of leaderboards was until the time hidden by the fog of war.</font></font><br><br> <a href=""><img src="https://habrastorage.org/web/f91/d51/c23/f91d51c23fb949d687f6a8caf269ac90.jpg"></a> <br><br><font style="vertical-align: inherit;"></font><a href="https://benchmark.unigine.com/leaderboards"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hurray, release! </font><font style="vertical-align: inherit;">Oh, wait ...</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We postponed the release to the end of the first quarter, and it took just a few days to meet the deadline. Benchmark should be done immediately with high quality, release patches and versions 1.1.1., 1.1.2. no opportunity: ‚Äúfloat‚Äù the results. The product should be immediately finished and stable. So that both our engineers, vendor laboratories, and beta testers could test the benchmark to the maximum, we moved the release to April 6th.</font></font><br><br><img src="https://habrastorage.org/web/34c/1c0/1d4/34c1c01d436c4895a2079a0c98df9d79.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On the morning of April 6, it turned out that the world froze in anticipation. ‚ÄúI specifically took the day off, because the Superposition is coming out! When is the rock? ‚ÄùWrote James from the UK. ‚ÄúIt's April 6th! Where is the benchmark? ‚Äù- wrote Bruce from the east coast of the USA. ‚ÄúI started this thread in advance, because today Superposition will be released. In the meantime, I will arrange the theme beautifully! ‚Äù- wrote on overclocking forums. "How are you doing? Soon? And you will write to me? ‚ÄùJames wrote again. Then Bruce. And Steve. And Marco. And a few dozen users through all possible channels of communication.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A couple of weeks before the release date, we realized that the amount of work on launching a new website with leaderboards and the entire back-end associated with it was underestimated. We chose the most critical one: launch a new website with benchmarks, download from it, user authorization, the payment system and, most importantly, the collection of results into the database, from which the standings will then be formed. Plus dock the front end with the back end. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">About the evening of the first attempt at release, we shot a small but dramatic video:</font></font><br><iframe width="560" height="315" src="https://www.youtube.com/embed/8jyd477-SL0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On the night of April 6-7, the Superposition benchmark itself was ready and hands were removed from it. But the critical part of the back-end and the front-end still refused to work as it should. The release decision was moved by April 11th. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">During these 4 days, the frequency of commits on the web has tripled. Twice the hero of Tolya‚Äôs detector and back-end according to plan (not because of the release!) He went to the hospital where he never stopped committing, and only the anesthesia stopped him. For an hour. Web programmer Lenya also stopped leaving work. Stop quitting QA.</font></font><br><br><img src="https://habrastorage.org/web/617/e40/bf7/617e40bf7b9e4379acdf7bed5faa7bb7.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here we have to go back a little to the drama with Steam. The volume of distributable distributions on this release was significantly larger: the build of Superposition weighed 3 times more than the last Valley. And those who want to quickly download the new benchmark UNIGINE has also increased since then. We were counting on Greenlight and Valve's server, which would have distributed files without any problems. And they were absolutely not prepared to distribute a couple of tens of terabytes of traffic per day. Yes, we are aware of the torrent, but a significant part of users for ideological reasons does not use them. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It was necessary to have a quick solution so that everyone could download the long-awaited benchmark, our servers would not fall and that would not cost the company astronomical money. Sergey, our IT director, turned gray by 10% while his department was looking for how to do it.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As a result, they came up with a scheme: buy a bunch of small hosting sites for $ 5-10 and scatter our files over them. People coming to the benchmarks, redirect to these hosting servers and mirrors in random order, and so unload our servers. As a result, we made 11 mirrors for a budget of 3000 rubles. </font><i><font style="vertical-align: inherit;">This is how the traffic of only one server on the night of release looks.</font></i><font style="vertical-align: inherit;"> We distributed a part from our servers with restrictions in order not to lie. Part - from the mirrors, which periodically fell on and off. The second Sergey from the IT department wrote a separate utility with 150 lines of code, which once a minute monitored the state of the mirrors, turned off the ‚Äúdead‚Äù, and when they came to life, turned them on back into the distribution. </font><i><font style="vertical-align: inherit;">In order to be in time for the release, I had to choose priorities: launch a new </font></i><i><a href="https://benchmark.unigine.com/"><font style="vertical-align: inherit;">website</font></a></i></font><br><br> <a href=""><img src="https://habrastorage.org/web/1dc/394/ea3/1dc394ea3f564e9489b92a7679d41075.png"></a> <br> <i><font style="vertical-align: inherit;"></font></i> <br><br><font style="vertical-align: inherit;"></font><br><br><img src="https://habrastorage.org/web/510/cbe/1a6/510cbe1a63b64ac4b40c5e3ae880539c.jpg"><br> <i><font style="vertical-align: inherit;"></font><a href="https://benchmark.unigine.com/"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, prepare everything for distribution of builds, set up the collection of user results into the database of future leaderboards.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The requirements from web developers have suddenly fallen - we would have 32 GB of RAM on the server. All other UNIGINE web-projects were not sharpened by the download: for each site only a gig-two RAM was required. Therefore, a request of 32 GB of RAM for one site turned out to be extremely unexpected. The IT director turned gray by another 10%, but still managed to buy and configure the server in just half a day.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">By April 11, we had a ready-to-launch part of the back-end and front-end. </font><font style="vertical-align: inherit;">No sooner had the sun come up over California, and the entire invisible part ‚Äúunder the hood‚Äù was already finished. </font><font style="vertical-align: inherit;">And after the final tests and the three ‚Äúfinal‚Äù versions of the final build, on April 11 at 23:00, we put the Superposition into the download. </font><font style="vertical-align: inherit;">And finally exhaled: the release happened. </font></font><br><br><img src="https://habrastorage.org/web/09f/dba/bc3/09fdbabc38444cd9a58461f2ca0d2ff6.jpg"> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It was easier to push the release than to cancel the cake ordered in his honor. </font><font style="vertical-align: inherit;">So the cake came to us on April 7th. </font><font style="vertical-align: inherit;">The team of artists is tired but happy: their work on the project has definitely ended.</font></font></i> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> What is not finished? </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">From the very first post about the benchmark, the most questions were asked about the support of Vulkan and DX12. Vulkan has a promising future, but for now the API is not yet stable on all platforms. DX12 works only on Windows 10, and not all users of our benchmarks (which we know for sure thanks to the detector) have moved to the top ten. Therefore, we have postponed the integration of Vulkan and DX12 to the next versions. </font></font><br><br><img src="https://habrastorage.org/web/191/bde/14c/191bde14cd00466e8bfe14e9bde89682.jpg"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Overclockers from all over the world stocked up with liquid nitrogen in anticipation of a superposition.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">By the release, we never mastered the support for SLI and CrossFire. Physically, both work. But CrossFire produces graphical artifacts, and SLI does not affect performance and sometimes also produces artifacts, depending on the configuration. This is due to the peculiarities of the effects of TAA (Temporal Anti Aliasing) and SSRTGI and the design features of multi-GPU interfaces. Textures for rendering each frame in SLI and CrossFire should be synchronized between two or more video cards, but the transfer speed is strongly limited by the bandwidth of the PCI Express bus. If the render goes to the extreme settings of 4K and 8K, the size of the textures becomes even larger, as the volume of data transmitted through PCI Express. Therefore, often real-time graphics, where there are temporal effects, do not scale well in SLI and CrossFire.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On individual configurations, there will be a performance boost - if SLI and Crossfire support AFR Friendly. Then the textures are not synchronized, each video card counts its frame, the bus is not loaded with the transfer of unnecessary information, and the performance grows (although in SLI, again, not on all configurations). But due to the lack of synchronization, graphic artifacts appear. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How to stabilize this for all configurations, we have not invented for the release. There are options for how to defeat this: reduce the number of synchronized textures, compress the data, try changing the synchronization method, abandon temporal effects altogether. But this task is not fast, so the optimization for multi-GPU moved to future versions of Superposition.</font></font><br><br><img src="https://habrastorage.org/web/f7a/c62/043/f7ac620435414f3db530c8ee2e0503c5.jpg"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Superposition conquers the world - photo from Gamers Assembley in France, the largest European game festival</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Leaderboards with the entire front-end and back-end completely overpowered and launched 3 weeks after the release. </font><font style="vertical-align: inherit;">Overclockers with liquid nitrogen have already been registered in them on the top lines - it‚Äôs quite difficult to catch up with the average user, but you can try!</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dry total </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In fact, in a post, far from all the dramas are told and not all the characters are mentioned. </font><font style="vertical-align: inherit;">The whole saga would have taken a couple more posts. </font><font style="vertical-align: inherit;">And, although it didn‚Äôt go without files, it‚Äôs impossible not to be proud of the results of the year of work that has passed from the beginning of the production of the demo to the release of the benchmark Superposition.</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> We made the most beautiful benchmark in the world. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Artists pumped so that surprised themselves. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Improved SSRTGI technology in the engine. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Launched finally online service. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Learned to determine the iron of all grades much more accurately. </font></font></li></ul><br><img src="https://habrastorage.org/web/fd7/5fe/452/fd75fe452e334e4dba7e7f6ef3f87e98.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For the first day we collected 13,000 results in the database. </font><font style="vertical-align: inherit;">At the time of publication of the post, Superposition was installed more than 100,000 times and the installation rate is stable. </font><font style="vertical-align: inherit;">In total, the work did not exceed 6100 commits, 1,437 of them in the last 90 days before the release. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The code is written (not counting engine modifications), in the lines:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C ++: 41952 </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> UnigineScript: 10,000 </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PHP: 69000 </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Javascript 4000 </font></font></li></ul><br>  In the final assembly of 900+ objects and 400+ textures. <br>  Collected RC-versions - 7. <br>  Burned in the name of the release of video cards - 1. <br><br>  And finally, on the day of release, a lot of reviews and articles about Superposition.  The release of the benchmark was written by all the top popular world portals for hardware, for example, <a href="http://www.tomshardware.com/news/unigine-superposition-graphics-benchmark-test,34121.html">Tom's Hardware</a> , <a href="https://www.techpowerup.com/232288/unigine-superposition-1-0-benchmark-released">TechPowerUp</a> , <a href="https://videocardz.com/68354/unigine-launches-superposition-gpu-benchmark">VideoCardz.com</a> and native <a href="http://www.ixbt.com/video4/unigine-superposition.shtml">IXBT</a> .  Began to go <a href="https://www.youtube.com/watch%3Fv%3D9dpLnNSoR9E">video reviews</a> from users and videoblogerov. <br><br>  You can evaluate the result yourself by downloading the <a href="https://benchmark.unigine.com/superposition">Superposition</a> .  Despite the fact that at the highest settings, the benchmark is able to bend any modern system, thanks to the different quality presets, you can run it on a computer 4-5 years old. <br><br>  Or look into the future of real-time 3D graphics by watching the video in maximum quality and at a resolution of 8K.  This mode is also in the benchmark, but not all top-end video cards can withstand it: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/Ya4Z-obAkWA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br><h3>  All beautiful graphics and powerful iron.  See you soon in our blog! </h3></div><p>Source: <a href="https://habr.com/ru/post/328082/">https://habr.com/ru/post/328082/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../328072/index.html">‚Äú55% of our users do not use the web version at all‚Äù - Tinkoff.ru about mobile development</a></li>
<li><a href="../328074/index.html">Do not miss the online broadcast of the conference Build 2017</a></li>
<li><a href="../328076/index.html">Unusual hackathon May 20-21: S7 Airlines</a></li>
<li><a href="../328078/index.html">Working with Dunno - Proactive Reading Technologies and Hybrid Storage</a></li>
<li><a href="../328080/index.html">‚ÄúRunn Me!‚Äù - tells us another PHP framework *. And heard "Throw Me!". Part 2</a></li>
<li><a href="../328084/index.html">On the issue of restrictions</a></li>
<li><a href="../328086/index.html">Distributed data structures [part 1, overview]</a></li>
<li><a href="../328088/index.html">Using the KOMPAS-3D API ‚Üí Lesson 1 ‚Üí Basics</a></li>
<li><a href="../328090/index.html">.NET API in web development: past and future</a></li>
<li><a href="../328092/index.html">CI & CD Fengshun Automation with Jenkins and Jira</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>