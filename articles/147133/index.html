<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MVC approach to developing user interfaces in Delphi. Part 1. Tick</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I will not write beautiful prefaces, because the article is not entertaining, but rather technical. In it, I want to turn to the user interface progra...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MVC approach to developing user interfaces in Delphi. Part 1. Tick</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/850/099/4a8/8500994a89d8670cd8a43dff145f6f3d.png"><br>  I will not write beautiful prefaces, because the article is not entertaining, but rather technical.  In it, I want to turn to the user interface programming techniques of classic Delphi desktop applications in MVC style.  This is an introductory article from the subsequent series. <br>  Those few who still use this development environment, I ask under kat. <br><a name="habracut"></a><br><br>  By classic applications, I mean desktop GUI applications for Windows based on VCL.  About the FireMonkey framework, which appeared in new versions of Delphi, let someone else write an article. <br>  User interfaces are very diverse.  And if on the web they are a complete menagerie, in desktop applications everything is more conservative.  Of course, the developers of some applications (see Skype, Mikogo, Office 2010) continue to come up with all sorts of visual tricks that are designed to further improve usability, for most of us (the people of the old school), we are still more accustomed to the standard Windows and VCL controls that were invented, probably back in the days of Windows 3.1: <br>  - button (TButton) <br>  - tick (TCheckBox) <br>  - switch (radio button, TRadioButton) <br>  - single line input field (TEdit) <br>  - multi-line input field (TMemo or TRichEdit) <br>  - all kinds of combined controls (TSpinEdit, TDateTimeEdit) <br>  - multipage controls (TPageControl, TTabControl) <br>  - grids <br>  - panels, group boxes, bevels, shapes, imageboxes, etc. <br><br>  The main task when creating a user interface is to come up with a representation of the internal data of the program using the above elements, so that the user is comfortable with this data.  Well, or on the other hand, come up with such a set of elements with which the user could tell the program what the program should hear from it. <br>  Designing the interface from the point of view of the layout of the elements is in itself a rather complicated and important task.  The interface is the face and the main way for the user to interact with your program (not counting its removal by Ctrl + Alt + Del :)).  That is why you should always do interface design iteratively, receiving feedback from users each time, is it convenient for them to work with your program, do you have to click the mouse 200 times, go to the nested windows (which at the last moment are also modal), 10 each just enter the same data due to the fact that they are not saved when you re-enter the window, etc.  etc.  (I am sure, the sophisticated reader can give a lot more examples of how the user interface should not be :)). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      They say that smart guys overseas, who approach interface design seriously and thoroughly, also use such technologies as tracking mouse movements when working with the program (so that they don‚Äôt take it back), counting clicks and even tracking the direction of the user's gaze (if eyes start to run in random directions, it should already be alarming). <br>  But this article is not about these miracles.  Let me suggest that you have already figured out what this window will look like.  You just need to somehow link this view with the internal data of the program.  And it is about the ways of this connection, I would like to talk. <br><br><h5>  Let's start with a primitive.  Check mark. </h5><br>  Suppose you have a checkbox (TCheckBox) in some window that reflects the choice of one of two options.  To talk not about spherical horses in a vacuum, let's give it some meaning.  Let it be a window to import some data from files of a specific directory into the database.  A check mark will indicate whether to delete imported files after the operation is completed.  Then let's call our tick <br><pre><code class="delphi hljs">cbNeedDeleteFiles: TCheckBox;</code> </pre> <br>  By the way, prefixing control names based on the type of control is very convenient.  For example, cb for TCheckBox, rb for TRadioButton, bt for TButton.  If you install the <a href="http://www.cnpack.org/">cnPack</a> extension pack in Delphi, then when placing the next control on the form, a window will pop up with a proposal to immediately rename this control in accordance with your rules.  This avoids the dominance of Button87, CheckBox32, etc. appearing on the form. <br><br>  As a rule, after placing the control in the right place on the form, the programmer sighs with relief and calms down.  Now he can, from any place of the program, contact cbNeedDeleteFiles.Checked to find out if a check mark is set or not.  Probably, the programmer will not have access to the Checked property in a single place: when creating a window, he may want to set the default state of this property or its stored value, then in the main place (where the import is performed) you need to check this attribute again, and finally, where to save the value of this attribute when the window is closed in order to restore the state of the checkmark the next time the window is opened.  You may also need to programmatically change the value of this attribute based on some other conditions.  For example, a user may ask that this check box is always set automatically when selecting a directory with input files, if this directory contains only files of one strictly specific type, or if the names of all the directory files meet a certain mask.  And so, in a heap of program locations we have something like this: <br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> cbNeedDeleteFiles.Checked <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Something <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> cbNeedDeleteFiles.Checked := True; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> SomethingElse <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> cbNeedDeleteFiles.Checked := False;</code> </pre><br>  At first glance, nothing bad is not here.  But as the long-term practice shows, this is AWESOME.  This is called a tight string of code on the user interface.  Suppose you subsequently have to replace TCheckBox with two radio buttons: ‚ÄúDelete imported files‚Äù and ‚ÄúDo not delete imported files‚Äù.  This does not make much sense, but you can do it for better visualization or as part of refactoring before adding the third state of this setting, such as ‚ÄúDelete files only if there are no import errors‚Äù.  And at this moment you will have to insert some code for working with RadioButtons in a heap of places where you used to access cbNeedDeleteFiles.Checked. <br><br><h5>  How to avoid it? </h5><br>  In the network for a long time and a lot of trumpeting about <a href="http://ru.wikipedia.org/wiki/MVC">MVC</a> , <a href="http://ru.wikipedia.org/wiki/Model-View-Presenter">MVP</a> , <a href="http://ru.wikipedia.org/wiki/MVVM">MVVM</a> .  As if these are such miraculous techniques, following which you can program the user interface "correctly" and not have the crap described above.  In fact, these are only approaches that really help, but which can be implemented absolutely differently in different programming languages ‚Äã‚Äãand even in one language.  Those.  these are rather tips on which side is better to approach user interface programming. <br>  If you look at the abbreviations again, you can see that in all three there are letters M (Model, model) and V (View, representation).  Speaking in a very simple language, the model is the internal data of the program, and the presentation is external (user interface).  Returning to the tick, it is obvious that the internal representation of this tick is a boolean value.  The decision on which attribute of the class should store this value is made in each case individually.  For example, it may be the TConfig class, which provides access to the program settings.  However, in simple cases, it is enough to create the corresponding attribute just for the form class: <br><pre> <code class="delphi hljs"><span class="hljs-title"><span class="hljs-title">TfmImport</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TForm) ... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ... FNeedDeleteFiles: Boolean; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">property</span></span> NeedDeleteFiles: Boolean <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> FNeedDeleteFiles <span class="hljs-keyword"><span class="hljs-keyword">write</span></span> SetNeedDeleteFiles; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br><br>  Next, you need to associate the state of the NeedDeleteFiles property with the state of the visual component (TCheckBox) cbNeedDeleteFiles.  This is conveniently done through the set property method: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfmImport</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetNeedDeleteFiles</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Value: Boolean)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> FNeedDeleteFiles &lt;&gt; Value <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> FNeedDeleteFiles := Value; cbNeedDeleteFiles.Checked := FNeedDeleteFiles; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br><br>  Why do I need the condition FNeedDeleteFiles &lt;&gt; Value, I will explain later.  The main thing is that now when we assign the value to the NeedDeleteFiles property, we will automatically have a check mark (this is almost the MVC model - we change the value of the model element, and the view changes automatically).  But this connection is only in one direction - from internal data to the interface.  It is also necessary to achieve feedback - from the presentation (ie, from the tick) to the model.  To do this, in the OnClick handler of our checkbox, we will write the following code: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfmImport</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cbNeedDeleteFilesClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> NeedDeleteFiles := cbNeedDeleteFiles.Checked; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  Those.  an action on a view (in this case, clicking on the check mark) will bring the model into line with the current state of the view.  However, the model never trusts the view and therefore causes the view state to be re-brought to the model state (forcing cbNeedDeleteFiles.Checked: = FNeedDeleteFiles to be forced. There is nothing wrong with this. And we are even insured by checking if FNeedDeleteFiles &lt;&gt; Value from a situation that visual control will call the OnClick handler again. In fact, it will not do this, because there is a similar check: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TCustomCheckBox</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetChecked</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Value: Boolean)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Value <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> State := cbChecked <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> State := cbUnchecked; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TCustomCheckBox</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Value: TCheckBoxState)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> FState &lt;&gt; Value <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> FState := Value; ... <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br><br>  Now we have the state of the TfmImport.NeedDeleteFiles property in sync with the state of the cbNeedDeleteFiles.Checked daw in both directions.  In all places of the program where we used to access cbNeedDeleteFiles.Checked, now you should access the NeedDeleteFiles property.  This allows us to completely forget that the representation of the NeedDeleteFiles element is a CheckBox.  You have no idea how wonderful it is.  Subsequently, we can replace the CheckBox with two radio buttons or whatever, and we need to rewrite only the SetNeedDeleteFiles set method (Model -&gt; View direction) and the handler that is triggered when the view state changes, i.e.  visual components (direction View -&gt; Model). <br><br>  I missed such an important moment as the initial synchronization of the value of the NeedDeleteFiles property with the state of the visual component.  Of course, if when you open the window, your daw will either be always always set or always removed, you can simply set the correct state in DesignTime, and assign the appropriate value to the FNeedDeleteFiles field in the OnCreate form class.  However, this is not very reliable (this should be monitored, it is easy to make a discrepancy), so in OnCreate it is better to place the following code in the form class: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfmImport</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FormCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> FNeedDeleteFiles := False; <span class="hljs-comment"><span class="hljs-comment">//   ,   ,   ,   set- NeedDeleteFiles := True; //   set-   GUI    ( ) end;</span></span></code> </pre><br><br>  In the next part of the article I will try to talk about more complex cases: working in MVC-style with lists of elements (TListBox, TCheckListBox, TComboBox) and about pitfalls when memorizing the state of visual elements of a window when it is closed. <br><br>  <b>UPD.</b>  Added the <a href="http://habrahabr.ru/post/147198/">second part of the article</a> <br>  <b>UPD.</b>  Added the <a href="http://habrahabr.ru/post/147466/">third part of the article</a> </div><p>Source: <a href="https://habr.com/ru/post/147133/">https://habr.com/ru/post/147133/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../147125/index.html">Detailed video review Android 4.1 Jelly Bean</a></li>
<li><a href="../147126/index.html">Saving contact information from sites</a></li>
<li><a href="../147128/index.html">Little C-function from the underworld</a></li>
<li><a href="../147129/index.html">I want my Luna Park with Fortran and C</a></li>
<li><a href="../147132/index.html">Ultrabook Software Contest: Let‚Äôs give free rein to our fantasy!</a></li>
<li><a href="../147134/index.html">White Nights Results: Mobile Games Conference</a></li>
<li><a href="../147135/index.html">Cloud4Y cloud is now in the Netherlands</a></li>
<li><a href="../147136/index.html">Apple has registered a patent for head-mounted display technology</a></li>
<li><a href="../147137/index.html">Tracks Flow from the inside</a></li>
<li><a href="../147138/index.html">Transport Tycoon Deluxe / Emscripten Part 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>