<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing a platformer in Python using pygame</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Immediately make a reservation that it is written for the smallest beginners. 

 I have long wanted to try myself as an igrodel, and recently I had a ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Writing a platformer in Python using pygame</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/4b2/eb8/663/4b2eb8663b347bdddeb4c09b144743eb.png" alt="image"><br>  Immediately make a reservation that it is written for <s>the smallest</s> beginners. <br><br>  I have long wanted to try myself as an igrodel, and recently I had a chance to learn Python and fulfill an old dream. <br><br><h4>  What is a platformer? </h4><br>  Platformer (platformer) - a genre of computer games in which the main feature of the gameplay is jumping on platforms, climbing stairs, picking up items that are usually necessary to complete a level. <br>  <a href="http://ru.wikipedia.org/wiki/%25D0%259F%25D0%25BB%25D0%25B0%25D1%2582%25D1%2584%25D0%25BE%25D1%2580%25D0%25BC%25D0%25B5%25D1%2580">Wiki</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      One of my favorite games of this genre are Super Mario Brothers and Super Meat Boy.  Let's try to create something in between. <br><a name="habracut"></a><br><br><h4>  The most - the very beginning. </h4><br>  <i>Attention!</i>  <i>Using python branches 2.x, from 3.x problems with running the scripts described below were found!</i> <br><br>  Probably not only games, but all applications that use pygame start like this: <br><br><pre><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env python # -*- coding: utf-8 -*- #   pygame import pygame from pygame import * #  WIN_WIDTH = 800 #   WIN_HEIGHT = 640 #  DISPLAY = (WIN_WIDTH, WIN_HEIGHT) #        BACKGROUND_COLOR = "#004400" def main(): pygame.init() #  PyGame,   screen = pygame.display.set_mode(DISPLAY) #   pygame.display.set_caption("Super Mario Boy") #    bg = Surface((WIN_WIDTH,WIN_HEIGHT)) #    #     bg.fill(Color(BACKGROUND_COLOR)) #     while 1: #    for e in pygame.event.get(): #   if e.type == QUIT: raise SystemExit, "QUIT" screen.blit(bg, (0,0)) #      pygame.display.update() #        if __name__ == "__main__": main()</span></span></code> </pre> <br><br>  The game will ‚Äúspin‚Äù in a loop (while 1), each iteration needs to redraw everything (background, platforms, monsters, digital messages, etc.).  It is important to note that the drawing goes sequentially, i.e.  if you first draw a hero, and then fill the background, then the hero will not be visible, consider this for the future. <br><br>  Running this code, we will see a window filled with green color. <br><br> <a href="http://img.tatfisher.ru/%3Fv%3D1sts.png"><img src="https://habrastorage.org/getpro/habr/post_images/2d2/091/d73/2d2091d737c241e7ad8b0fe75d09db8f.png"></a> <br>  (The picture is clickable) <br><br>  Well, a start, we go further. <br><br><h4>  Level. </h4><br><br>  And how without him?  By the word ‚Äúlevel‚Äù we will mean a limited area of ‚Äã‚Äãvirtual two-dimensional space, filled with all sorts of things, and along which our character will move. <br><br>  To build a level, create a two-dimensional array of m by n.  Each cell (m, n) will be a rectangle.  A rectangle can contain something, or it can be empty.  We are in the rectangles will draw the platform. <br><br>  Add more constants <br><br><pre> <code class="python hljs">PLATFORM_WIDTH = <span class="hljs-number"><span class="hljs-number">32</span></span> PLATFORM_HEIGHT = <span class="hljs-number"><span class="hljs-number">32</span></span> PLATFORM_COLOR = <span class="hljs-string"><span class="hljs-string">"#FF6262"</span></span></code> </pre><br><br>  Then add a level declaration to the <b>main</b> function. <br><br><pre> <code class="python hljs">level = [ <span class="hljs-string"><span class="hljs-string">"-------------------------"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"-- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- --- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- --- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- ----------- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- - -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"-------------------------"</span></span>]</code> </pre><br>  And add the following to the main loop: <br><pre> <code class="python hljs">x=y=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment">#  for row in level: #   for col in row: #   if col == "-": # ,       pf = Surface((PLATFORM_WIDTH,PLATFORM_HEIGHT)) pf.fill(Color(PLATFORM_COLOR)) screen.blit(pf,(x,y)) x += PLATFORM_WIDTH #      y += PLATFORM_HEIGHT #      x = 0 #      </span></span></code> </pre><br><br>  Those.  We iterate over the two-dimensional level array, and if we find the ‚Äú-‚Äù character, then by coordinates (x * PLATFORM_WIDTH, y * PLATFORM_HEIGHT), where x, y is the index in the level array <br><br>  Running, we will see the following: <br><br> <a href="http://img.tatfisher.ru/%3Fv%3D2joj.png"><img src="https://habrastorage.org/getpro/habr/post_images/753/e15/838/753e158382b8b9ff53d14943a9dec4b0.png"></a> <br><br><h4>  Character </h4><br><br>  Just cubes on the background - it is very boring.  We need our character who will run and jump on the platforms. <br><br>  Create a class of our hero. <br><br>  For convenience, we will keep our character in a separate file <b>player.py</b> <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env python # -*- coding: utf-8 -*- from pygame import * MOVE_SPEED = 7 WIDTH = 22 HEIGHT = 32 COLOR = "#888888" class Player(sprite.Sprite): def __init__(self, x, y): sprite.Sprite.__init__(self) self.xvel = 0 # . 0 -    self.startX = x #   ,      self.startY = y self.image = Surface((WIDTH,HEIGHT)) self.image.fill(Color(COLOR)) self.rect = Rect(x, y, WIDTH, HEIGHT) #   def update(self, left, right): if left: self.xvel = -MOVE_SPEED #  = x- n if right: self.xvel = MOVE_SPEED #  = x + n if not(left or right): # ,     self.xvel = 0 self.rect.x += self.xvel #     xvel def draw(self, screen): #     screen.blit(self.image, (self.rect.x,self.rect.y))</span></span></code> </pre><br><br><br>  What's so interesting? <br>  To begin with, we create a new class, inheriting from the <b>pygame.sprite.Sprite</b> class, thereby inheriting all the characteristics of the sprite. <br>  <a href="http://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25BF%25D1%2580%25D0%25B0%25D0%25B9%25D1%2582_(%25D0%25BA%25D0%25BE%25D0%25BC%25D0%25BF%25D1%258C%25D1%258E%25D1%2582%25D0%25B5%25D1%2580%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25B3%25D1%2580%25D0%25B0%25D1%2584%25D0%25B8%25D0%25BA%25D0%25B0)">A sprite</a> is a moving bitmap.  It has a number of useful methods and properties. <br><br>  <b>self.rect = Rect (x, y, WIDTH, HEIGHT)</b> , in this line we create the actual borders of our character, a rectangle along which we will not only move the hero, but also check him for collisions.  But more about that below. <br><br>  The <b>update</b> method <b>(self, left, right)) is</b> used to describe the behavior of an object.  Overrides the parent <b>update (* args) ‚Üí None</b> .  May be called in groups of sprites. <br><br>  The <b>draw (self, screen)</b> method is used to display a character on the screen.  Next, we remove this method and use a more interesting way to display the hero. <br><br>  Let's add our hero to the main part of the program. <br><br>  Before determining the level, we will add a definition of the hero and its movement variables. <br><br><pre> <code class="python hljs">hero = Player(<span class="hljs-number"><span class="hljs-number">55</span></span>,<span class="hljs-number"><span class="hljs-number">55</span></span>) <span class="hljs-comment"><span class="hljs-comment">#    (x,y)  left = right = False #   ‚Äî </span></span></code> </pre><br><br>  In the event check we add the following: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> e.type == KEYDOWN <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> e.key == K_LEFT: left = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> e.type == KEYDOWN <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> e.key == K_RIGHT: right = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> e.type == KEYUP <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> e.key == K_RIGHT: right = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> e.type == KEYUP <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> e.key == K_LEFT: left = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span></code> </pre><br><br>  Those.  If you press the "left" key, then go left.  If you let go - stop.  Also with the "right" button <br><br>  The movement itself is invoked as follows: (add after redrawing the background and platforms) <br><br><pre> <code class="python hljs">hero.update(left, right) <span class="hljs-comment"><span class="hljs-comment">#  hero.draw(screen) # </span></span></code> </pre><br><br><img src="https://habrastorage.org/getpro/habr/post_images/6db/eda/a65/6dbedaa65c00e3d026a8145424e058be.gif" alt="image"><br><br>  But, as we see, our gray block moves too quickly, we add a limit in the number of frames per second.  To do this, after determining the level, add a timer. <br><br><pre> <code class="python hljs">timer = pygame.time.Clock()</code> </pre><br><br>  And at the beginning of the main loop, add the following: <br><br><pre> <code class="python hljs">timer.tick(<span class="hljs-number"><span class="hljs-number">60</span></span>)</code> </pre><br><br><h4>  Hung in the air </h4><br><br>  Yes, our hero is in a hopeless situation, he is frozen in the air. <br>  Add gravity and the ability to jump. <br><br>  And so, we work in the file <b>player.py</b> <br><br>  Add more constants <br><br><pre> <code class="python hljs">JUMP_POWER = <span class="hljs-number"><span class="hljs-number">10</span></span> GRAVITY = <span class="hljs-number"><span class="hljs-number">0.35</span></span> <span class="hljs-comment"><span class="hljs-comment"># ,     </span></span></code> </pre><br><br>  Add the <b>following</b> lines to the <b>_init_</b> method: <br><br><pre> <code class="python hljs"> self.yvel = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment">#    self.onGround = False #    ?</span></span></code> </pre><br><br>  Add an input argument to the <b>update</b> method <br>  def update (self, left, right, up): <br>  And at the beginning of the method add: <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> up: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.onGround: <span class="hljs-comment"><span class="hljs-comment"># ,       self.yvel = -JUMP_POWER</span></span></code> </pre><br><br>  And before the line <b>self.rect.x + = self.xvel</b> <br>  Add <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.onGround: self.yvel += GRAVITY self.onGround = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>; <span class="hljs-comment"><span class="hljs-comment">#   ,    (( self.rect.y += self.yvel</span></span></code> </pre><br><br>  And add to the main part of the program: <br>  After the line <b>left = right = False</b> <br>  Add a variable up <br><pre> <code class="python hljs">up = false</code> </pre><br><br>  In the event check we add <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> e.type == KEYDOWN <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> e.key == K_UP: up = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> e.type == KEYUP <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> e.key == K_UP: up = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span></code> </pre><br><br>  And change the call to the <b>update</b> method by adding a new argument <b>up</b> : <br>  <b>hero.update (left, right</b> ) <br>  on <br><pre> <code class="python hljs">hero.update(left, right, up)</code> </pre><br><br>  Here we have created the force of gravity, which will pull us down, constantly increasing speed, if we do not stand on the ground, and we do not know how to jump in flight.  And we still can not firmly stand on something, so the next animation, our hero falls far beyond the limits of visibility. <br><img src="https://habrastorage.org/getpro/habr/post_images/9c6/b95/487/9c6b9548711e66011042aab3b4d277bc.gif" alt="image"><br><br><h4>  Stand with both feet on your land. </h4><br><br>  How to know that we are on the ground or another solid surface?  The answer is obvious - use the check for intersection, but for this we will change the creation of platforms. <br><br>  Let's create another <b>file.py</b> , and transfer the platform description to it. <br><br><pre> <code class="python hljs">PLATFORM_WIDTH = <span class="hljs-number"><span class="hljs-number">32</span></span> PLATFORM_HEIGHT = <span class="hljs-number"><span class="hljs-number">32</span></span> PLATFORM_COLOR = <span class="hljs-string"><span class="hljs-string">"#FF6262"</span></span></code> </pre><br><br>  Next, create a class, inheriting from <b>pygame.sprite.Sprite</b> <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Platform</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(sprite.Sprite)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y)</span></span></span><span class="hljs-function">:</span></span> sprite.Sprite.__init__(self) self.image = Surface((PLATFORM_WIDTH, PLATFORM_HEIGHT)) self.image.fill(Color(PLATFORM_COLOR)) self.rect = Rect(x, y, PLATFORM_WIDTH, PLATFORM_HEIGHT)</code> </pre><br><br>  There is not anything we do not already know, go ahead. <br><br>  We make changes in the main file, before adding the <b>level</b> array we add <br><br><pre> <code class="python hljs">entities = pygame.sprite.Group() <span class="hljs-comment"><span class="hljs-comment">#   platforms = [] # ,        entities.add(hero)</span></span></code> </pre><br><br>  Group sprites will use <b>entities</b> to display all elements of this group. <br>  We will use the <b>platforms</b> array to check for intersection with the platform. <br><br>  Next, block <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> col == <span class="hljs-string"><span class="hljs-string">"-"</span></span>: <span class="hljs-comment"><span class="hljs-comment"># ,       pf = Surface((PLATFORM_WIDTH,PLATFORM_HEIGHT)) pf.fill(Color(PLATFORM_COLOR)) screen.blit(pf,(x,y))</span></span></code> </pre><br><br>  Replace with <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> col == <span class="hljs-string"><span class="hljs-string">"-"</span></span>: pf = Platform(x,y) entities.add(pf) platforms.append(pf)</code> </pre><br><br>  Those.  create an instance of the <b>Platform</b> class, add it to the group of sprites <b>entities</b> and the array of <b>platforms</b> .  In <b>entities</b> , for each block not to write display logic.  In <b>platforms</b> added to then check the array of blocks at the intersection with the player. <br><br>  Further, we remove all level generation code from the loop. <br><br>  And the same line <br>  <b>hero.draw (screen) # display</b> <br>  Replace with <br><pre> <code class="python hljs">entities.draw(screen) <span class="hljs-comment"><span class="hljs-comment">#  </span></span></code> </pre><br><br>  Running, we will see that nothing has changed.  Right.  After all, we do not check our hero for collisions.  Let's start this fix. <br><br>  We work in the file <b>player.py</b> <br><br>  Remove the <b>draw</b> method, we no longer need it.  And add a new <b>collide</b> method <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">collide</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, xvel, yvel, platforms)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> platforms: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> sprite.collide_rect(self, p): <span class="hljs-comment"><span class="hljs-comment">#       if xvel &gt; 0: #    self.rect.right = p.rect.left #     if xvel &lt; 0: #    self.rect.left = p.rect.right #     if yvel &gt; 0: #    self.rect.bottom = p.rect.top #     self.onGround = True #    -  self.yvel = 0 #     if yvel &lt; 0: #    self.rect.top = p.rect.bottom #     self.yvel = 0 #    </span></span></code> </pre><br>  In this method there is a check for the intersection of the coordinates of the hero and the platforms, if there is one, then the above described logic takes place. <br><br>  Well, and for this to happen, you need to call this method. <br>  Change the number of arguments for the <b>update</b> method, now it looks like this: <br><br><pre> <code class="python hljs">update(self, left, right, up, platforms)</code> </pre><br><br>  And do not forget to change his call in the main file. <br><br>  And lines <br><pre> <code class="python hljs">self.rect.y += self.yvel self.rect.x += self.xvel <span class="hljs-comment"><span class="hljs-comment">#     xvel</span></span></code> </pre><br><br>  Replace with: <br><pre> <code class="python hljs">self.rect.y += self.yvel self.collide(<span class="hljs-number"><span class="hljs-number">0</span></span>, self.yvel, platforms) self.rect.x += self.xvel <span class="hljs-comment"><span class="hljs-comment">#     xvel self.collide(self.xvel, 0, platforms)</span></span></code> </pre><br><br>  Those.  they moved the hero vertically, checked the intersection vertically, moved horizontally, again checked the intersection horizontally. <br><br>  That's what happens when we run. <br><br><img src="http://habrastorage.org/getpro/habr/post_images/547/415/6d7/5474156d7eadb5ce39003f8605ae0834.gif" alt="image"><br><br><h4>  Fu [y]!  A moving rectangle is not beautiful! </h4><br><br>  Let's embellish our <i>MarioBoy a bit</i> . <br><br>  Let's start with the platforms.  To do this, in the <b>blocks.py</b> file <b>we</b> will make small changes. <br><br>  Replace the fill color with a picture, for this line <br>  <b>self.image.fill (Color (PLATFORM_COLOR))</b> <br>  Replace with <br><pre> <code class="python hljs">self.image = image.load(<span class="hljs-string"><span class="hljs-string">"blocks/platform.png"</span></span>)</code> </pre><br><br>  We upload a picture instead of a solid color.  Of course, the file <b>‚Äúplatform.png‚Äù</b> should be located in the <b>‚Äúblocks‚Äù</b> folder, which should be located <i>in the directory with source codes</i> . <br><br>  That's what happened <br><br> <a href="http://img.tatfisher.ru/%3Fv%3D6nln.png"><img src="http://habrastorage.org/getpro/habr/post_images/ae9/1ae/31a/ae91ae31af0ca24756bd7bf34ae97b4d.png"></a> <br><br>  Now go to our hero.  For a moving object, you need not a static picture, but an animation.  In order to facilitate this task, <a href="http://inventwithpython.com/pyganim/index.html">let us</a> use the wonderful library <a href="http://inventwithpython.com/pyganim/index.html">pyganim</a> .  Let's get started <br><br>  First we add constants to the block. <br><br><pre> <code class="python hljs">ANIMATION_DELAY = <span class="hljs-number"><span class="hljs-number">0.1</span></span> <span class="hljs-comment"><span class="hljs-comment">#    ANIMATION_RIGHT = [('mario/r1.png'), ('mario/r2.png'), ('mario/r3.png'), ('mario/r4.png'), ('mario/r5.png')] ANIMATION_LEFT = [('mario/l1.png'), ('mario/l2.png'), ('mario/l3.png'), ('mario/l4.png'), ('mario/l5.png')] ANIMATION_JUMP_LEFT = [('mario/jl.png', 0.1)] ANIMATION_JUMP_RIGHT = [('mario/jr.png', 0.1)] ANIMATION_JUMP = [('mario/j.png', 0.1)] ANIMATION_STAY = [('mario/0.png', 0.1)]</span></span></code> </pre><br><br>  Here, I think, clearly, animation of different actions of the hero. <br><br>  Now add the following to the <b>__init__</b> method <br><pre> <code class="python hljs">self.image.set_colorkey(Color(COLOR)) <span class="hljs-comment"><span class="hljs-comment">#    #    boltAnim = [] for anim in ANIMATION_RIGHT: boltAnim.append((anim, ANIMATION_DELAY)) self.boltAnimRight = pyganim.PygAnimation(boltAnim) self.boltAnimRight.play() #    boltAnim = [] for anim in ANIMATION_LEFT: boltAnim.append((anim, ANIMATION_DELAY)) self.boltAnimLeft = pyganim.PygAnimation(boltAnim) self.boltAnimLeft.play() self.boltAnimStay = pyganim.PygAnimation(ANIMATION_STAY) self.boltAnimStay.play() self.boltAnimStay.blit(self.image, (0, 0)) # -,  self.boltAnimJumpLeft= pyganim.PygAnimation(ANIMATION_JUMP_LEFT) self.boltAnimJumpLeft.play() self.boltAnimJumpRight= pyganim.PygAnimation(ANIMATION_JUMP_RIGHT) self.boltAnimJumpRight.play() self.boltAnimJump= pyganim.PygAnimation(ANIMATION_JUMP) self.boltAnimJump.play()</span></span></code> </pre><br><br>  Here for each action we create a set of animations, and turn them on (that is, turn on frame changes). <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> anim <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ANIMATION_LEFT: boltAnim.append((anim, ANIMATION_DELAY</code> </pre>  )) <br>  Each frame has a picture and a show time. <br><br><h6>  It remains at the right time to show the desired animation. </h6><br><br>  Add a animation change to the <b>update</b> method <b>.</b> <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> up: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.onGround: <span class="hljs-comment"><span class="hljs-comment"># ,       self.yvel = -JUMP_POWER self.image.fill(Color(COLOR)) self.boltAnimJump.blit(self.image, (0, 0)) if left: self.xvel = -MOVE_SPEED #  = x- n self.image.fill(Color(COLOR)) if up: #       self.boltAnimJumpLeft.blit(self.image, (0, 0)) else: self.boltAnimLeft.blit(self.image, (0, 0)) if right: self.xvel = MOVE_SPEED #  = x + n self.image.fill(Color(COLOR)) if up: self.boltAnimJumpRight.blit(self.image, (0, 0)) else: self.boltAnimRight.blit(self.image, (0, 0)) if not(left or right): # ,     self.xvel = 0 if not up: self.image.fill(Color(COLOR)) self.boltAnimStay.blit(self.image, (0, 0))</span></span></code> </pre><br>  Voila! <br><img src="http://habrastorage.org/getpro/habr/post_images/611/191/578/6111915784c55c702621f13ecf35890c.gif" alt="image"><br><br><h4>  More, need more space </h4><br>  We will overcome the size limit of the window by creating a <i>dynamic camera</i> . <br><br>  To do this, create a class <b>Camera</b> <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Camera</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, camera_func, width, height)</span></span></span><span class="hljs-function">:</span></span> self.camera_func = camera_func self.state = Rect(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, width, height) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apply</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, target)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> target.rect.move(self.state.topleft) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, target)</span></span></span><span class="hljs-function">:</span></span> self.state = self.camera_func(self.state, target.rect)</code> </pre><br><br>  Next, add the initial configuration of the camera. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">camera_configure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(camera, target_rect)</span></span></span><span class="hljs-function">:</span></span> l, t, _, _ = target_rect _, _, w, h = camera l, t = -l+WIN_WIDTH / <span class="hljs-number"><span class="hljs-number">2</span></span>, -t+WIN_HEIGHT / <span class="hljs-number"><span class="hljs-number">2</span></span> l = min(<span class="hljs-number"><span class="hljs-number">0</span></span>, l) <span class="hljs-comment"><span class="hljs-comment">#      l = max(-(camera.width-WIN_WIDTH), l) #      t = max(-(camera.height-WIN_HEIGHT), t) #      t = min(0, t) #      return Rect(l, t, w, h)</span></span></code> </pre><br><br>  Create an instance of the camera, add before the main loop: <br><br><pre> <code class="python hljs">total_level_width = len(level[<span class="hljs-number"><span class="hljs-number">0</span></span>])*PLATFORM_WIDTH <span class="hljs-comment"><span class="hljs-comment">#     total_level_height = len(level)*PLATFORM_HEIGHT #  camera = Camera(camera_configure, total_level_width, total_level_height)</span></span></code> </pre><br><br>  What have we done? <br><br>  We created inside a large rectangle whose dimensions are calculated as follows: <br><br><pre> <code class="python hljs">total_level_width = len(level[<span class="hljs-number"><span class="hljs-number">0</span></span>])*PLATFORM_WIDTH <span class="hljs-comment"><span class="hljs-comment">#     total_level_height = len(level)*PLATFORM_HEIGHT # </span></span></code> </pre><br><br>  smaller rectangle, identical in size to the window size. <br><br>  The smaller rectangle is centered relative to the main character ( <b>update</b> method), and all objects are drawn in a smaller rectangle ( <b>apply</b> method), thereby creating the impression of camera movement. <br><br>  For the above, you need to change the drawing objects. <br><br>  Replace the line <br>  <b>entities.draw (screen) # display</b> <br>  On <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> e <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> entities: screen.blit(e.image, camera.apply(e))</code> </pre><br><br>  And before it we add <br><pre> <code class="python hljs">camera.update(hero) <span class="hljs-comment"><span class="hljs-comment">#    </span></span></code> </pre><br><br>  Now we can change the level. <br><br><pre> <code class="python hljs">level = [ <span class="hljs-string"><span class="hljs-string">"----------------------------------"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"-- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- ---- --- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"-- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- --- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- --- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- ------- ---- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- - -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"----------------------------------"</span></span>]</code> </pre><br>  This is the result. <br><img src="http://habrastorage.org/getpro/habr/post_images/6e9/a79/82a/6e9a7982ab06d9df8874625bfb0a261f.gif" alt="image"><br><br>  The result can be downloaded, a <a href="">link to GitHub</a> <br><br>  In the next part, if it is claimed by the community, we will create our own level generator <s>with blackjack and whores</s> with different types of platforms, monsters, teleports, and of course, a princess. <br><br>  <b>upd</b> pygame can be downloaded <a href="http://pygame.info/downloads/">from here</a> , thank you, <a href="http://habrahabr.ru/users/chris_griffin/" class="user_link">Chris_Griffin</a> for the comment <br>  <b>upd1</b> <a href="http://habrahabr.ru/post/196432/">second part</a> </div><p>Source: <a href="https://habr.com/ru/post/193888/">https://habr.com/ru/post/193888/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../193876/index.html">CodeBender.cc - Arduino programming from a browser</a></li>
<li><a href="../193878/index.html">Where dreams lead</a></li>
<li><a href="../193880/index.html">A passion for programming. Chapter 4. Be the worst</a></li>
<li><a href="../193882/index.html">Infection on the site - history by example</a></li>
<li><a href="../193886/index.html">The birth of magic from the spirit of the torrent protocol (scheme of the organization of a free uncensored indestructible information network)</a></li>
<li><a href="../193890/index.html">Python memory usage</a></li>
<li><a href="../193892/index.html">A car dial tachometer for a beginner or some fixed-point shamanism on the AVR</a></li>
<li><a href="../193894/index.html">Review of modern heuristic optimization methods</a></li>
<li><a href="../193898/index.html">Cut off the finger does not help unlock the iPhone 5S</a></li>
<li><a href="../193900/index.html">Making your flying robot</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>