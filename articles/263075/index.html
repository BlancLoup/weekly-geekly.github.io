<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Protecting PHP Script Domain Name Paths</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I think many people have come across the fact that sometimes it is necessary to protect your script from being copied, and you used different Ioncube,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Protecting PHP Script Domain Name Paths</h1><div class="post__text post__text-html js-mediator-article">  I think many people have come across the fact that sometimes it is necessary to protect your script from being copied, and you used different Ioncube, PHPLockit, but many people find it inconvenient to encode each time.  I understand that in Ioncube there is such a thing, thanks to which it is possible to generate security keys, etc., but it is not profitable for many to buy or use someone else‚Äôs services, but it is not enough, everything happens. <br><br>  Some people do not want to encode all the code, but only part of it, and for this many use this ‚Äúarray‚Äù to protect: <br><br><pre><code class="php hljs">$_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_HOST'</span></span>]</code> </pre> <br>  But it's easy to get around: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="php hljs">$_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_HOST'</span></span>]=<span class="hljs-string"><span class="hljs-string">' '</span></span>;</code> </pre><br>  Therefore, there is a solution to this problem, and it can be solved by anyone with an initial knowledge of PHP, MySQL. <br><a name="habracut"></a><br>  As a result, we get: <br><ul><li>  The script will be encoded by obfuscator, which sends an API request to the site, where the API searches for the domain name and key in the database;  if it is, the script will work; if not, it will redirect to the main site (the example would be: domain.com/api.php?domain=mysite1.ru&amp;key=4024B-C0876-4FF0C-9A298-80EFA); </li><li>  We will also have a script api.php, which will be responsible for the operation of license verification, etc .; </li><li>  I also want to highlight the license key that we will receive.  The license key is the md5 hash of the domain, which will be verified via api, and only the domain and its status will be recorded in the database. </li></ul><br><h4>  Decision </h4><br>  <b>1. Issuing licenses and checking the validity of the script via api:</b> <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $config = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'host'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'localhost'</span></span>, <span class="hljs-string"><span class="hljs-string">'user'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'root'</span></span>, <span class="hljs-string"><span class="hljs-string">'pass'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'base'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'lic'</span></span> ); $db = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> mysqli($config[<span class="hljs-string"><span class="hljs-string">'host'</span></span>], $config[<span class="hljs-string"><span class="hljs-string">'user'</span></span>], $config[<span class="hljs-string"><span class="hljs-string">'pass'</span></span>], $config[<span class="hljs-string"><span class="hljs-string">'base'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($db-&gt;connect_errno) { <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>(<span class="hljs-string"><span class="hljs-string">':      !'</span></span>); } $db-&gt;set_charset(<span class="hljs-string"><span class="hljs-string">"utf8"</span></span>); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Main</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">keygen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($domain)</span></span></span></span>{ $key[<span class="hljs-number"><span class="hljs-number">0</span></span>] = strtoupper(md5($domain)); $key[<span class="hljs-number"><span class="hljs-number">1</span></span>] = substr($key[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>); $key[<span class="hljs-number"><span class="hljs-number">2</span></span>] = substr($key[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>); $key[<span class="hljs-number"><span class="hljs-number">3</span></span>] = substr($key[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>); $key[<span class="hljs-number"><span class="hljs-number">4</span></span>] = substr($key[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>); $key[<span class="hljs-number"><span class="hljs-number">5</span></span>] = substr($key[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $key[<span class="hljs-number"><span class="hljs-number">1</span></span>].<span class="hljs-string"><span class="hljs-string">'-'</span></span>.$key[<span class="hljs-number"><span class="hljs-number">2</span></span>].<span class="hljs-string"><span class="hljs-string">'-'</span></span>.$key[<span class="hljs-number"><span class="hljs-number">3</span></span>].<span class="hljs-string"><span class="hljs-string">'-'</span></span>.$key[<span class="hljs-number"><span class="hljs-number">4</span></span>].<span class="hljs-string"><span class="hljs-string">'-'</span></span>.$key[<span class="hljs-number"><span class="hljs-number">5</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLicInfo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($domain)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> $db, $config; $sql = <span class="hljs-string"><span class="hljs-string">"SELECT * FROM `licenses` WHERE `domain` = '{$domain}' LIMIT 1"</span></span>; $result = $db-&gt;query($sql); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($result-&gt;num_rows == <span class="hljs-number"><span class="hljs-number">1</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $result-&gt;fetch_assoc(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } } $main = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Main; $domain = <span class="hljs-string"><span class="hljs-string">""</span></span>.$_GET[<span class="hljs-string"><span class="hljs-string">'domain'</span></span>].<span class="hljs-string"><span class="hljs-string">""</span></span>; $key = strtoupper($_GET[<span class="hljs-string"><span class="hljs-string">'key'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($lic = $main-&gt;getLicInfo($domain)){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($lic[<span class="hljs-string"><span class="hljs-string">'license_status'</span></span>]){ $twokey = $main-&gt;keygen($lic[<span class="hljs-string"><span class="hljs-string">'license_domain'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($twokey == $key){ $a = <span class="hljs-string"><span class="hljs-string">'OK_'</span></span>.$lic[<span class="hljs-string"><span class="hljs-string">'license_domain'</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $a = <span class="hljs-string"><span class="hljs-string">'ERROR_wrongkey'</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $a = <span class="hljs-string"><span class="hljs-string">'ERROR_nolicense'</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $a = <span class="hljs-string"><span class="hljs-string">'ERROR_nolicense'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $a; <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>(); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br>  Here is the code itself api.php.  Here I would like to draw your attention to the following code: <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Main</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">keygen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($domain)</span></span></span></span>{ $key[<span class="hljs-number"><span class="hljs-number">0</span></span>] = strtoupper(md5($domain)); $key[<span class="hljs-number"><span class="hljs-number">1</span></span>] = substr($key[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>); $key[<span class="hljs-number"><span class="hljs-number">2</span></span>] = substr($key[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>); $key[<span class="hljs-number"><span class="hljs-number">3</span></span>] = substr($key[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>); $key[<span class="hljs-number"><span class="hljs-number">4</span></span>] = substr($key[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>); $key[<span class="hljs-number"><span class="hljs-number">5</span></span>] = substr($key[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $key[<span class="hljs-number"><span class="hljs-number">1</span></span>].<span class="hljs-string"><span class="hljs-string">'-'</span></span>.$key[<span class="hljs-number"><span class="hljs-number">2</span></span>].<span class="hljs-string"><span class="hljs-string">'-'</span></span>.$key[<span class="hljs-number"><span class="hljs-number">3</span></span>].<span class="hljs-string"><span class="hljs-string">'-'</span></span>.$key[<span class="hljs-number"><span class="hljs-number">4</span></span>].<span class="hljs-string"><span class="hljs-string">'-'</span></span>.$key[<span class="hljs-number"><span class="hljs-number">5</span></span>]; }</code> </pre><br>  This class creates a domain key by using the md5 hash. <br><br>  <b>2. Checking domain names for availability in the database</b> <br>  In paragraph 1, we reviewed the code api.php, which is responsible for the script.  I want to highlight the code that I have already allocated: <br><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLicInfo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($domain)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> $db, $config; $sql = <span class="hljs-string"><span class="hljs-string">"SELECT * FROM `licenses` WHERE `domain` = '{$domain}' LIMIT 1"</span></span>; $result = $db-&gt;query($sql); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($result-&gt;num_rows == <span class="hljs-number"><span class="hljs-number">1</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $result-&gt;fetch_assoc(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } }</code> </pre><br><br>  This class checks the domain name for availability in the database, and if everything is successful, the script works;  if not, it will redirect to the main site. <br><br>  So, we‚Äôve finished reviewing the api.php code, which is responsible for the main work of checking the license, but now the question is: ‚ÄúHow to implement it in the script itself?‚Äù <br><br>  It is done thanks to the following code: <br><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__destruct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $request = file_get_contents(<span class="hljs-string"><span class="hljs-string">"http://domain.com/api.php?domain="</span></span>. $_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_HOST'</span></span>] .<span class="hljs-string"><span class="hljs-string">"&amp;key="</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;config-&gt;lic_key); $status = explode(<span class="hljs-string"><span class="hljs-string">"_"</span></span>, $request); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($status[<span class="hljs-number"><span class="hljs-number">0</span></span>] != <span class="hljs-string"><span class="hljs-string">"OK"</span></span> &amp;&amp; <span class="hljs-string"><span class="hljs-string">""</span></span>.$_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_HOST'</span></span>].<span class="hljs-string"><span class="hljs-string">""</span></span> != $status[<span class="hljs-number"><span class="hljs-number">1</span></span>]){ header(<span class="hljs-string"><span class="hljs-string">"Location: http://domain.com/"</span></span>); } }</code> </pre><br>  This code sends a request to the API and if it exists in the database, and if the domain name is in the database, the script works, if not, it does not work.  The same situation, if the code is wrong, for this in api.php there is the following "segment" of code: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($lic = $main-&gt;getLicInfo($domain)){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($lic[<span class="hljs-string"><span class="hljs-string">'license_status'</span></span>]){ $twokey = $main-&gt;keygen($lic[<span class="hljs-string"><span class="hljs-string">'license_domain'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($twokey == $key){ $a = <span class="hljs-string"><span class="hljs-string">'OK_'</span></span>.$lic[<span class="hljs-string"><span class="hljs-string">'license_domain'</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $a = <span class="hljs-string"><span class="hljs-string">'ERROR_wrongkey'</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $a = <span class="hljs-string"><span class="hljs-string">'ERROR_nolicense'</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $a = <span class="hljs-string"><span class="hljs-string">'ERROR_nolicense'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $a; <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>();</code> </pre><br>  I think it‚Äôs clear here: if everything is correct, the message ‚Äúok_myssite.com‚Äú comes out ‚Äùand it satisfies, the script continues to work, and if the wrong key or domain name is entered, then the following messages come out (depending on where there is an error): <br><br>  ERROR_nolicense <br><br>  or <br><br>  ERROR_wrongkey <br><br>  I think everything.  I <a href="http://habrahabr.ru/users/pixxxel/" class="user_link">am</a> also waiting for constructive comments, and I thank <a href="http://habrahabr.ru/users/pixxxel/" class="user_link">pixxxel</a> for his article <a href="http://habrahabr.ru/post/29301/">‚ÄúProtecting PHP scripts from being copied - is this possible?‚Äù</a> </div><p>Source: <a href="https://habr.com/ru/post/263075/">https://habr.com/ru/post/263075/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../263063/index.html">What else can a browser know about you?</a></li>
<li><a href="../263065/index.html">Release of InterSystems Cach√© 2015.2 DBMS</a></li>
<li><a href="../263067/index.html">About Burali-Forti, Poincar√© and the very definition of a unit</a></li>
<li><a href="../263069/index.html">UINavigationController and what it eats with: basic principles, subclassing, protection against double transitions and much more</a></li>
<li><a href="../263073/index.html">Steal for 9 characters</a></li>
<li><a href="../263077/index.html">Under the hood of ATM software</a></li>
<li><a href="../263079/index.html">6 things I would like to know before developing my first Android application</a></li>
<li><a href="../263081/index.html">We clean the home Internet from very annoying ads (Ad's blocker for OpenWRT)</a></li>
<li><a href="../263083/index.html">Build docker containers with docker containers</a></li>
<li><a href="../263085/index.html">Site security audit through the eyes of the customer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>