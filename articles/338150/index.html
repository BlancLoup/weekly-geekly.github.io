<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How JS works: memory management, four types of memory leaks and how to deal with them</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="[We advise you to read] Other 19 parts of the cycle  Part 1: Overview of the engine, execution time mechanisms, call stack 
 Part 2: About the V8 inte...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How JS works: memory management, four types of memory leaks and how to deal with them</h1><div class="post__text post__text-html js-mediator-article"><div class="spoiler">  <b class="spoiler_title">[We advise you to read] Other 19 parts of the cycle</b> <div class="spoiler_text">  Part 1: <a href="https://habrahabr.ru/company/ruvds/blog/337042/">Overview of the engine, execution time mechanisms, call stack</a> <br>  Part 2: <a href="https://habrahabr.ru/company/ruvds/blog/337460/">About the V8 internals and code optimization</a> <br>  Part 3: <a href="https://habrahabr.ru/company/ruvds/blog/338150/">Memory management, four types of memory leaks and dealing with them</a> <br>  Part 4: <a href="https://habrahabr.ru/company/ruvds/blog/340508/">Event loop, asynchrony, and five ways to improve code with async / await</a> <br>  Part 5: <a href="https://habrahabr.ru/company/ruvds/blog/342346/">WebSocket and HTTP / 2 + SSE.</a>  <a href="https://habrahabr.ru/company/ruvds/blog/342346/">What to choose?</a> <br>  Part 6: <a href="https://habrahabr.ru/company/ruvds/blog/343568/">Features and Scope of WebAssembly</a> <br>  Part 7: <a href="https://habrahabr.ru/company/ruvds/blog/348424/">Web Workers and Five Use Cases</a> <br>  Part 8: <a href="https://habrahabr.ru/company/ruvds/blog/349858/">Service Workers</a> <br>  Part 9: <a href="https://habrahabr.ru/company/ruvds/blog/350486/">Web push notifications</a> <br>  Part 10: <a href="https://habrahabr.ru/company/ruvds/blog/351256/">Tracking DOM Changes with MutationObserver</a> <br>  Part 11: <a href="https://habrahabr.ru/company/ruvds/blog/351802/">The engines of rendering web pages and tips to optimize their performance</a> <br>  Part 12: <a href="https://habr.com/company/ruvds/blog/354070/">Browser networking subsystem, optimizing its performance and security</a> <br>  Part 12: <a href="https://habr.com/company/ruvds/blog/354070/">Browser networking subsystem, optimizing its performance and security</a> <br>  Part 13: <a href="https://habr.com/company/ruvds/blog/354438/">Animation with CSS and JavaScript</a> <br>  Part 14: <a href="https://habr.com/company/ruvds/blog/415269/">How JS works: abstract syntax trees, parsing and its optimization</a> <br>  Part 15: <a href="https://habr.com/company/ruvds/blog/415377/">How JS Works: Classes and Inheritance, Babil and TypeScript Transformation</a> <br>  Part 16: <a href="https://habr.com/company/ruvds/blog/415505/">How JS Works: Storage Systems</a> <br>  Part 17: <a href="https://habr.com/company/ruvds/blog/415881/">How JS Works: Shadow DOM Technology and Web Components</a> <br>  Part 18: <a href="https://habr.com/company/ruvds/blog/416821/">How JS: WebRTC and P2P Communication Mechanisms Work</a> <br>  Part 19: <a href="https://habr.com/company/ruvds/blog/419831/">How JS Works: Custom Elements</a> </div></div>  In the third article from the series, which focuses on the features of JavaScript, we will talk about memory.  This topic is extremely important, however, developers often ignore it.  This situation is based on various reasons, among which are the ever-increasing complexity of modern programming languages ‚Äã‚Äãand the progress in the development of automatic memory management tools.  In addition to the story about the JS memory model, we will share with you some tips to combat memory leaks. <br><br> <a href="https://habrahabr.ru/company/ruvds/blog/338150/"><img src="https://habrastorage.org/getpro/habr/post_images/a8d/0b3/334/a8d0b333499f0224fa97ee450f2243e7.jpg"></a> <br><br>  According to the author of the article, <a href="https://www.sessionstack.com/">SessionStack</a> uses methods to prevent memory leaks in order to prevent unnecessarily high memory consumption in web applications that integrate their development. <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Overview</font> </h2><br>  Some languages, such as C, have low-level memory management tools, such as <code>malloc()</code> and <code>free()</code> .  These basic functions are used by developers when interacting with the operating system to explicitly allocate and free memory. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      At the same time, JavaScript allocates memory when something (objects, strings, and so on) is created, and ‚Äúautomatically‚Äù, when it is no longer in use, frees it up during a process called <i><font color="#999999">garbage collection</font></i> .  This seemingly ‚Äúautomatic‚Äù nature of resource release is a source of confusion and gives developers using JavaScript (and other high-level languages) a false sense that they may not care at all about memory management.  <b>This is a big mistake</b> . <br><br>  Even programming in high-level language, developers need to understand the principles, or at least know the basics of memory management.  Sometimes problems arise in the automatic memory management system (such as errors, restrictions in the implementation of the garbage collector, and so on), the nature of which developers must understand in order to correct them (or at least find the right ways to circumvent them, requiring minimal additional effort and not too large amounts of auxiliary code). <br><br><h2>  <font color="#3AC1EF">Memory life cycle</font> </h2><br>  Regardless of the programming language, the memory life cycle almost always looks the same: <br><br><img src="https://habrastorage.org/web/625/c3e/9ac/625c3e9acc884b19bf672e5befaf8992.png"><br>  <i><font color="#999999">Life cycle of memory: allocation, use, release</font></i> <br><br><ul><li>  <b>Memory allocation</b> - memory is allocated by the operating system, which allows the program to use the resources provided for it.  In low-level languages ‚Äã‚Äã(such as C), this is an explicit operation that the developer needs to perform.  In high-level languages, however, this problem is solved automatically. <br></li><li>  <b>Memory usage</b> is the time when the program performs any operations with previously allocated memory.  At this stage, when accessing variables, read and write operations are performed. <br></li><li>  <b>Memory freeing</b> - at this stage of the memory life cycle, the memory is released, which the program no longer needs, that is, it is returned to the system.  As in the case <b>of memory allocation</b> , the release is an explicit operation in low-level languages. <br></li></ul><br>  Recall that in the <a href="https://habrahabr.ru/company/ruvds/blog/337042/">first article of</a> this cycle, you can read about the call stack and the heap. <br><br><h2>  <font color="#3AC1EF">What is memory?</font> </h2><br>  Before we consider the issues of working with memory in JavaScript, let's talk, in a nutshell, about what memory is. <br><br>  At the hardware level, computer memory consists of many <a href="https://en.wikipedia.org/wiki/Flip-flop_%2528electronics%2529">triggers</a> .  Each trigger consists of several transistors, it is able to store one bit of data.  Each of the triggers has a unique address, so their contents can be read and rewritten.  Thus, conceptually, we can perceive computer memory as a huge array of bits that can be read and written. <br><br>  However, programmers are people, not computers; it is not particularly convenient for them to operate with individual bits.  Therefore, bits are usually organized into larger structures that can be represented as numbers.  8 bits form 1 byte.  In addition to the bytes, there is such a thing as words (sometimes - 16 bits long, sometimes 32). <br><br>  Many things are stored in memory: <br><br><ol><li>  All variable values ‚Äã‚Äãand other data used by programs. <br></li><li>  Program code, including the operating system code. <br></li></ol><br>  The compiler and the operating system jointly perform the bulk of the memory management work without the direct participation of the programmer, however, we encourage developers to ask about what is happening in the depths of the memory management mechanisms. <br><br>  When the code is compiled, the compiler can examine primitive data types and calculate in advance the amount of memory needed to work with them.  The required amount of memory is then allocated to the program in the call stack space.  The space in which space is allocated for variables is called the stack space, since when functions are called, the memory allocated to them is located at the top of the stack.  When returning from functions, they are removed from the stack in the order of LIFO (the last to come is the first to go, Last In First Out).  For example, consider the following variable declarations: <br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">int</span></span> n; // <span class="hljs-number"><span class="hljs-number">4</span></span>  <span class="hljs-type"><span class="hljs-type">int</span></span> x[<span class="hljs-number"><span class="hljs-number">4</span></span>]; //   <span class="hljs-number"><span class="hljs-number">4</span></span>-   <span class="hljs-number"><span class="hljs-number">4</span></span>   <span class="hljs-type"><span class="hljs-type">double</span></span> m; // <span class="hljs-number"><span class="hljs-number">8</span></span> </code> </pre> <br>  The compiler, after reviewing this code fragment (abstracting here from everything except the size of the data itself), can immediately find out that it will take 4 + 4 √ó 4 + 8 = 28 bytes to store the variables. <br><br>  It should be noted that the given sizes of integer variables and numbers with double precision reflect the current state of affairs.  Approximately 20 years ago, integers were usually represented as 2-byte constructs, 4 bytes were used for double precision numbers.  The code should not depend on the byte sizes of the basic data types. <br><br>  The compiler will generate code that will interact with the operating system, requesting the required number of bytes in the stack to store variables. <br><br>  In the above example, the compiler knows the addresses of the memory areas where each variable is stored.  In fact, if we use the name of the variable <code>n</code> in the code, it is converted to an internal representation that looks like this: ‚Äúmemory address 4127963‚Äù. <br><br>  Note that if we try to access the array element from our example using the <code>x[4]</code> construct <code>x[4]</code> , we will in fact refer to the data that corresponds to the variable <code>m</code> .  This is due to the fact that the array element with index 4 does not exist; a record of the form <code>x[4]</code> will indicate a memory area that is 4 bytes farther than that memory area allocated for the last of the array elements - <code>x[3]</code> .  An attempt to access <code>x[4]</code> may end up reading (or rewriting) some bits of the variable <code>m</code> .  This, almost guaranteed, will lead to undesirable consequences in the course of program execution. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e0c/96b/22d/e0c96b22d95cbaae824a89597d0c3cf8.png"><br>  <i><font color="#999999">Location of variables in memory</font></i> <br><br>  When a function calls another function, each of them gets its own stack.  All their local variables and a command pointer that stores data about where the call was made are stored here.  When the function completes, the memory blocks occupied by it are made available again for other purposes. <br><br><h2>  <font color="#3AC1EF">Dynamic memory allocation</font> </h2><br>  Unfortunately, everything gets complicated when, at compile time, we do not know how much memory we need for a variable.  Imagine that we want to do something like the following: <br><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n = readInput(); <span class="hljs-comment"><span class="hljs-comment">//  ,   ... //    n </span></span></code> </pre> <br>  In this situation, the compiler does not know how much memory is needed to store the array, since the size of the array determines the value that the user enters. <br><br>  As a result, the compiler will not be able to reserve memory for a variable on the stack.  Instead, our program will have to explicitly ask the operating system for the right amount of memory during its execution.  This memory is allocated in the so-called <b>heap</b> .  The following table lists the main differences between static and dynamic memory allocation. <br><br>  <b>The difference between static and dynamic memory allocation</b> <br><table><tbody><tr><td>  Static memory allocation <br></td><td>  Dynamic memory allocation <br></td></tr><tr><td>  Volume must be known at compile time. <br></td><td>  Volume may not be known at compile time. <br></td></tr><tr><td>  Produced at compile time. <br></td><td>  Produced during program execution. <br></td></tr><tr><td>  Memory is allocated on the stack. <br></td><td>  Memory is allocated on the heap. <br></td></tr><tr><td>  FILO memory allocation order (first entered - last left, First In Last Out) <br></td><td>  There is no defined order of memory allocation. <br></td></tr></tbody></table><br>  In order to fully understand how dynamic memory allocation works, we will need to discuss the concept of <b>pointers</b> in detail, but this way we will deviate too much from our main topic.  If you are interested in this, let the <a href="https://blog.sessionstack.com/%40zlatkov">author of</a> this material know, and perhaps this topic will be raised in future publications. <br><br><h2>  <font color="#3AC1EF">JavaScript memory allocation</font> </h2><br>  Now we will talk about how the first step of the life cycle of memory (allocation) is implemented in JavaScript. <br><br>  JavaScript frees a developer from responsibility for managing memory allocation.  JS does it on its own, along with the declaration of variables. <br><br><pre> <code class="hljs lua">var n = <span class="hljs-number"><span class="hljs-number">374</span></span>; //     var s = <span class="hljs-string"><span class="hljs-string">'sessionstack'</span></span>; //     var o = { a: <span class="hljs-number"><span class="hljs-number">1</span></span>, b: null }; //          var a = [<span class="hljs-number"><span class="hljs-number">1</span></span>, null, <span class="hljs-string"><span class="hljs-string">'str'</span></span>];  //                     //      (    ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a + <span class="hljs-number"><span class="hljs-number">3</span></span>; } //     (   ) //           someElement.addEventListener(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { someElement.style.backgroundColor = <span class="hljs-string"><span class="hljs-string">'blue'</span></span>; }, <span class="hljs-literal"><span class="hljs-literal">false</span></span>);</code> </pre> <br>  Calls to some functions also lead to the allocation of memory for an object: <br><br><pre> <code class="hljs pgsql">var d = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> <span class="hljs-type"><span class="hljs-type">Date</span></span>(); //      <span class="hljs-type"><span class="hljs-type">Date</span></span> var e = document.createElement(<span class="hljs-string"><span class="hljs-string">'div'</span></span>); //     DOM</code> </pre> <br>  Method calls can also lead to memory allocation for new values ‚Äã‚Äãor objects: <br><br><pre> <code class="hljs pgsql">var s1 = <span class="hljs-string"><span class="hljs-string">'sessionstack'</span></span>; var s2 = s1.substr(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>); // s2 -    //    , // JavaScript     , //     [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>]. var a1 = [<span class="hljs-string"><span class="hljs-string">'str1'</span></span>, <span class="hljs-string"><span class="hljs-string">'str2'</span></span>]; var a2 = [<span class="hljs-string"><span class="hljs-string">'str3'</span></span>, <span class="hljs-string"><span class="hljs-string">'str4'</span></span>]; var a3 = a1.concat(a2); //    <span class="hljs-number"><span class="hljs-number">4</span></span>    //   a1  a2</code> </pre> <br><h2>  <font color="#3AC1EF">Javascript memory usage</font> </h2><br>  Using allocated memory in JavaScript usually means reading and writing it. <br><br>  This can be done by reading or writing the value of a variable or an object property, or even by passing in a function argument. <br><br><h2>  <font color="#3AC1EF">Freeing up memory that is no longer needed.</font> </h2><br>  Most memory management problems occur at this stage. <br><br>  The biggest challenge is figuring out when the allocated memory is no longer needed by the program.  This often requires the developer to determine where in the program a certain fragment of memory is no longer needed and would release it. <br><br>  High-level languages ‚Äã‚Äãhave a built-in subsystem called the <b>garbage collector</b> .  The role of this subsystem is to track memory allocation operations and use it to find out when a fragment of allocated memory is no longer needed.  If so, the garbage collector can automatically free this fragment. <br><br>  Unfortunately, this process does not differ in absolute accuracy, since the general problem of finding out whether a fragment of memory is needed or not is <a href="http://en.wikipedia.org/wiki/Decidability_%2528logic%2529">insoluble</a> (it cannot be solved by algorithmic solutions). <br><br>  Most garbage collectors work by collecting memory that cannot be accessed, that is, such all the variables that point to are inaccessible.  This, however, is too bold an assumption about the possibility of freeing memory, since at any time a certain area of ‚Äã‚Äãmemory may have variables pointing to it in a certain area of ‚Äã‚Äãvisibility, although it will never work in this program anymore. <br><br><h2>  <font color="#3AC1EF">Garbage collection</font> </h2><br>  The basic concept that garbage collection algorithms rely on is the concept of <b>links</b> . <br><br>  In the context of memory management, an object refers to another object if the first, explicitly or implicitly, has access to the latter.  For example, a JavaScript object has a link to its own <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Inheritance_and_the_prototype_chain">prototype</a> ( <b>explicit link</b> ) and to the values ‚Äã‚Äãof the properties of the prototype ( <b>implicit link</b> ). <br><br>  Here, the idea of ‚Äã‚Äãan ‚Äúobject‚Äù expands to something larger than the usual JS object, which also includes functional scopes (or the global lexical scope). <br><br>  The principle of lexical scope allows you to set the rules for resolving variable names in nested functions.  Namely, the nested functions contain the scope of the parent function even if the return is from the parent function. <br><br><h2>  <font color="#3AC1EF">Garbage collection based on reference counting</font> </h2><br>  This is the simplest garbage collection algorithm.  The object is considered fit for destruction if it is not indicated by <b>any</b> references. <br>  Take a look at the following code: <br><br><pre> <code class="hljs ruby">var o1 = { <span class="hljs-symbol"><span class="hljs-symbol">o2:</span></span> {   <span class="hljs-symbol"><span class="hljs-symbol">x:</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> } }; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  <span class="hljs-number"><span class="hljs-number">2</span></span> . /<span class="hljs-regexp"><span class="hljs-regexp">/   o2     o1,      . /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/            . var o3 = o1; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  o3 -   ,          /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    ,     o1. o1 = 1;      /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   ,      o1,             /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  ,   o3 var o4 = o3.o2; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    o2 .               /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/      2 .  -                  /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  .               /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  -    o4 o3 = '374'; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   ,      o1,           /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    .           /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/      .           /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ ,    o2              /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  o4.   ,   ,           /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    . o4 = null; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   o2 ,     o1,          /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   ,           /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/      .</span></span></code> </pre> <br><h2>  <font color="#3AC1EF">Circular links - source of problems</font> </h2><br>  When cyclical links come into play, some limitations of the above-described search model for unnecessary objects appear.  The following example creates two objects that link to each other.  A circular reference is formed.  Objects will be out of reach after a function call, that is, they are useless, and the memory they occupy could be freed.  However, the reference counting algorithm considers that since each of the two objects has at least one reference, none of them can be destroyed. <br><br><pre> <code class="hljs actionscript"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> o1 = {}; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> o2 = {}; o1.p = o2; <span class="hljs-comment"><span class="hljs-comment">// o1   o2 o2.p = o1; // o2   o1.   . } f();</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/64c/937/5bd/64c9375bd1a0a446eaabce4dbdb58f9e.png"></div><br>  <i>Circular link</i> <br><br><h2>  <font color="#3AC1EF">Algorithm "mark and throw away"</font> </h2><br>  In order to decide whether to save an object, the ‚Äúmark and sweep‚Äù algorithm determines the object's reachability. <br>  The algorithm consists of the following steps: <br><br><ul><li>  The garbage collector builds a list of "root objects."  Such objects are usually global variables referenced in the code.  In JavaScript, an example of a global variable that can play the role of the root object is the <code>window</code> object. <br></li><li>  All root objects are scanned and marked as active (that is, it is not ‚Äúgarbage‚Äù).  Also, recursively, all child objects are viewed.  Everything that can be accessed from the root objects is not considered "garbage". <br></li><li>  All areas of memory that are not marked as active can be considered suitable for processing by the garbage collector, which can now free this memory and return it to the operating system. <br></li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/2f8/586/bad/2f8586bad441a261ebd9c976d2f5a2ea.gif"><br>  <i><font color="#999999">Visualization algorithm "mark and throw away"</font></i> <br><br>  This algorithm is better than the previous one, since the situation ‚Äúto the object is not referenced‚Äù leads to the fact that the object is unattainable.  The converse assertion, as demonstrated in the section on cyclical links, is not true. <br><br>  Since 2012, all modern browsers have been equipped with garbage collectors, based on the ‚Äúmark and throw away‚Äù algorithm.  In recent years, all the improvements made in the field of garbage collection in JavaScript (this is genealogical, incremental, competitive, parallel garbage collection) are improvements to this algorithm, without changing its basic principles, which consist in determining the reachability of an object. <br><br>  In <a href="https://en.wikipedia.org/wiki/Tracing_garbage_collection">this</a> article you can find details about the garbage collection model considered here. <br><br><h2>  <font color="#3AC1EF">Solving the problem of circular references</font> </h2><br>  In the first of the examples above, after returning from a called function, two objects no longer refer to something that can be addressed from the scope of the global object.  Therefore, the garbage collector will find them unreachable. <br><br><img src="https://habrastorage.org/web/26e/594/887/26e59488736a4087bd825c31400271e0.png"><br>  <i><font color="#999999">Circular links do not interfere with garbage collection</font></i> <br><br>  Although objects refer to each other, they cannot be accessed from the root object. <br><br><h2>  <font color="#3AC1EF">Paradoxical behavior of garbage collectors</font> </h2><br>  Although garbage collectors are convenient, you have to make certain trade-offs when using them.  One of them is non-determinism.  In other words, garbage collectors are unpredictable.  It is impossible to say exactly when the garbage collection will be performed.  This means that in some cases programs use more memory than they actually need. <br><br>  In other cases, short pauses caused by garbage collection may be noticeable in performance-demanding applications.  Although unpredictability means that it is not possible to know exactly when garbage collection will be performed, most garbage collectors use the same pattern for performing memory freeing operations.  Namely, they do this when allocating memory.    ,       .   : <br><br><ol><li>    ,       . <br></li><li>  ,     (  )    . ,    -   <code>null</code>  ,     ,    . <br></li><li>    . <br></li></ol><br>             .  ,       ,      .       ,     ,     ,      . <br><br><h2> <font color="#3AC1EF">   ?</font> </h2><br>   ,       ,     ,   -          . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f98/561/7fa/f985617fa843735179767ce039c31007.jpg"></div><br>       . ,    ,          ,    , <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Memory_Management"></a> .  ,   ,         . <br><br>          .             .         <a href="https://en.wikipedia.org/wiki/Manual_memory_management"></a>  <a href="https://en.wikipedia.org/wiki/Manual_memory_management"></a>  . <br><br>        JavaScript. <br><br><h2> <font color="#3AC1EF">   JavaScript    </font> </h2><br><h3> <font color="#3AC1EF">‚ñç </font> </h3><br>  JavaScript        .          .    ,    <code>window</code> .   : <br><br><pre> <code class="hljs actionscript"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(arg)</span></span></span><span class="hljs-function"> </span></span>{   bar = <span class="hljs-string"><span class="hljs-string">"some text"</span></span>; }</code> </pre> <br>    : <br><br><pre> <code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">arg</span></span></span><span class="hljs-function">) </span></span>{   <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.bar = <span class="hljs-string"><span class="hljs-string">"some text"</span></span>; }</code> </pre> <br>   <code>bar</code>        <code>foo</code> ,         <code>var</code> ,     . <br><br>     ,    ,    ,      . <br><br>  ,        ,         <code>this</code> : <br><br><pre> <code class="hljs actionscript"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.var1 = <span class="hljs-string"><span class="hljs-string">"potential accidental global"</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//     ,   this     (window), // this   undefined, ,    ,      foo();</span></span></code> </pre> <br>  ,    ,    <code>"use strict";</code>   JS-.      ,        .       <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Strict_mode"></a> . <br><br>        ,  ,      . ,  ,     (       <code>null</code>  -  ).  ,       ,          .           ,      <code>null</code>  - ,    ,  ,          . <br><br><h3> <font color="#3AC1EF">‚ñç   </font> </h3><br>  JS-   <code>setInterval ‚Äî</code>  . <br><br>  ,         ,  ,   ,         ,   ,   ,  . ,    <code>setInterval</code>    : <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> serverData = loadData(); setInterval(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> renderer = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'renderer'</span></span>);   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(renderer) {       renderer.innerHTML = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(serverData);   } }, <span class="hljs-number"><span class="hljs-number">5000</span></span>); <span class="hljs-comment"><span class="hljs-comment">//     5 .</span></span></code> </pre> <br>    ,     ,      DOM   ,       . <br><br> ,   <code>renderer</code> ,  ,  , ,           . ,   ,    ,      . ,   ,  .          ,        .  ,  ,   <code>serverData</code> , ,  ,    ,    . <br><br>    ,         ,      (  ,     ). <br><br>     ,     (  IE6, )      .          ,     ,         . ,        .  For example: <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> element = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'launch-button'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> counter = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{  counter++;  element.innerHtml = <span class="hljs-string"><span class="hljs-string">'text '</span></span> + counter; } element.addEventListener(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, onClick); <span class="hljs-comment"><span class="hljs-comment">//  - element.removeEventListener('click', onClick); element.parentNode.removeChild(element); // ,       , // ,      onClick      , //         .</span></span></code> </pre> <br>     (   Internet Explorer  Microsoft Edge)     ,          .  ,        <code>removeEventListener</code>  ,     . <br><br>   , ,  jQuery,      (       API).      , ,  ,             ,      IE 6. <br><br><h3> <font color="#3AC1EF">‚ñç</font> </h3><br>        JavaScript ‚Äî .  ‚Äî  ,      ,        .     JavaScript       : <br><br><pre> <code class="hljs lua">var theThing = null; var replaceThing = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { var originalThing = theThing; var unused = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (originalThing) //   originalThing     console.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>(<span class="hljs-string"><span class="hljs-string">"hi"</span></span>); }; theThing = {   longStr: new Array(<span class="hljs-number"><span class="hljs-number">1000000</span></span>).join(<span class="hljs-string"><span class="hljs-string">'*'</span></span>),   someMethod: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> {     console.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>(<span class="hljs-string"><span class="hljs-string">"message"</span></span>);   } }; }; setInterval(replaceThing, <span class="hljs-number"><span class="hljs-number">1000</span></span>);</code> </pre> <br>       ,      <code>replaceThing</code> ,  <code>theThing</code>     ,        ( <code>someMethod</code> ).    ,  <code>unused</code>  ,     <code>originalThing</code> (   ,     <code>theThing</code>    <code>replaceThing</code> ).      ,   ?    ,  <b>     ,          ,      </b> . <br><br>      ,    <code>someMethod</code> ,     <code>unused</code> .     <code>originalThing</code> .   ,  <code>unused</code>  , <code>someMethod</code>     <code>theThing</code>     <code>replaceThing</code> (  ‚Äî    ). ,   <code>someMethod</code>  <code>unused</code>        ,   <code>originalThing</code> ,   <code>unused</code> ,   ,      ( ‚Äî      ).       . <br><br>       ,       .       .   ,      (    <code>theThing</code> ),             ,      . <br><br>     Meteor,    <a href="https://blog.meteor.com/an-interesting-kind-of-javascript-memory-leak-8b47d2e7f156"> </a> ,      . <br><br><h3> <font color="#3AC1EF">‚ñç   DOM    DOM</font> </h3><br>         DOM    . , ,         .               .          DOM:      DOM,  ‚Äî  .   ,      ,     . <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> elements = {   <span class="hljs-attr"><span class="hljs-attr">button</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'button'</span></span>),   <span class="hljs-attr"><span class="hljs-attr">image</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'image'</span></span>) }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doStuff</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{   image.src = <span class="hljs-string"><span class="hljs-string">'http://example.com/image_name.png'</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeImage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{   <span class="hljs-comment"><span class="hljs-comment">//      body.   document.body.removeChild(document.getElementById('image'));   //         #button    //   elements.  ,  button   //     ,       . }</span></span></code> </pre> <br>    ,             DOM     . <br><br> ,        ( &lt;td&gt;)  JS-.        DOM,      .    ,      ,   ,   ,   ,            .   - .      .  ,          ,      .   ,     DOM  . <br><br><h2>  <font color="#3AC1EF">Results</font> </h2><br>     ,  ,      ,    .         ,    ,  ,   ,    .       JS-     ,     ,            . <br><br>  Dear readers!        JavaScript-?   ‚Äî  ,   ,      . </div><p>Source: <a href="https://habr.com/ru/post/338150/">https://habr.com/ru/post/338150/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../338140/index.html">PHP is alive. PHP 7 in practice</a></li>
<li><a href="../338142/index.html">Shopping with full-stack redux</a></li>
<li><a href="../338144/index.html">Rapid development of monitoring scripts with Bash, Outthentic and Sparrow</a></li>
<li><a href="../338146/index.html">Russia's first OpenHack from Microsoft (that is, from us)</a></li>
<li><a href="../338148/index.html">MultiSim + M2M OTA platform</a></li>
<li><a href="../338154/index.html">How to launch a patent process in an IT company</a></li>
<li><a href="../338156/index.html">Another HighLoadCup solution on Go</a></li>
<li><a href="../338158/index.html">kubernetes, playground, microservices and a bit of magic</a></li>
<li><a href="../338160/index.html">3CX technical support responds: how to replace or update the SSL certificate on the server</a></li>
<li><a href="../338164/index.html">Do not touch the logs with your hands! How to reduce the time for analysis using autotests</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>