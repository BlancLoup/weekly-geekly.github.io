<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The simplest voice menu on Cisco VoiceXML</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="An unprepared person who wants to write the simplest voice menu using VoiceXML on the voice gateway from Cisco will have to step on a lot of rakes. So...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The simplest voice menu on Cisco VoiceXML</h1><div class="post__text post__text-html js-mediator-article">  An unprepared person who wants to write the simplest voice menu using VoiceXML on the voice gateway from Cisco will have to step on a lot of rakes.  Some of them I will note in this article.  It is possible that some Cisco-specialist will snort and say that this is all elementary people, but nevertheless, when I faced this task, I did not know where to start.  Google did not give any sensible examples of ready IVR.  The only more or less good starting point was <a href="http://ciscomaster.ru/node/17">this article</a> .  My <a href="http://habrahabr.ru/qa/27551/">Habravopros</a> also did not give special results.  But discard the lyrics and get down to business.  Suppose that we have a Cisco voice gateway that supports VoiceXML scripts (for example, Cisco 3925).  We will develop the voice menu shown in the picture.  During business hours, a greeting will be played and the call will be transferred to the specified internal number, during off-hours and weekends - a special announcement that, they say, call on weekdays. <br><img src="https://habrastorage.org/storage2/5d7/3ac/8d6/5d73ac8d694b8eaef43bf4bf6e5d8ba7.png"><br><a name="habracut"></a><br>  Let us single out the main ‚Äúbuilding blocks‚Äù and stages of building our voice menu. <br>  1. Routing incoming call to our vxml script. <br>  2. Temporary condition <br>  3. Play a sound file <br>  4. Transfer call to extension number <br>  5. Download and Activate Vxml Script <br><br><h4>  1. Routing an incoming call </h4><br>  Suppose that the number we have comes from the provider via a regular telephone line (pots) in the form 7XXXYYYZZZZ.  You need to create a new dialpyr and specify that the incoming call should be routed to the ‚Äútest‚Äù service: <br><blockquote>  <b>gw #</b> conf t <br>  <b>gw (config) #</b> dial-peer voice 100 pots <br>  <b>gw (config-dial-peer) #</b> description IVR-Test <br>  <b>gw (config-dial-peer) #</b> incoming called-number 7XXXYYYZZZZ <br>  <b>gw (config-dial-peer) #</b> service test </blockquote>  Great, the call comes in, but as long as we don‚Äôt have the actual test application, we‚Äôll now write it in parts. <br><br><h4>  2. Temporary condition </h4><br>  Writing the first XML block.  First, we initialize the variables, then we make the necessary condition, not forgetting that we are working on the XML document, which means that all characters like "&lt;" and "&amp;" should be screened: <br><blockquote>  <font color="#808080">&lt;! - Time is in UTC -&gt;</font> <br>  <font color="#808080">&lt;! - Day of week: 0 - sunday, 1 - monday ... 6 - sunday -&gt;</font> <br>  <font color="#009900"><font color="#000000">&lt;var</font> <font color="#000066">name</font> = <font color="#ff0000">"VAR_Hour"</font> <font color="#000066">expr</font> = <font color="#ff0000">"new Date (). getHours ()"</font> <font color="#000000">/&gt;</font></font> <br>  <font color="#009900"><font color="#000000">&lt;var</font> <font color="#000066">name</font> = <font color="#ff0000">"VAR_Day"</font> <font color="#000066">expr</font> = <font color="#ff0000">"new Date (). getDay ()"</font> <font color="#000000">/&gt;</font></font> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <font color="#808080">&lt;! - Time condition -&gt;</font> <br>  <font color="#009900"><font color="#000000">&lt;form</font> <font color="#000066">id</font> = <font color="#ff0000">"IVR_TimeCondition"</font> <font color="#000000">&gt;</font></font> <br>  <font color="#009900"><font color="#000000">&lt;block <font color="#000000">&gt;</font></font></font> <br>  <font color="#009900"><font color="#000000">&lt;if</font> <font color="#000066">cond</font> = <font color="#ff0000">"5 &amp; lt; = VAR_Hour &amp; amp; &amp; amp; VAR_Hour &amp; lt; 14 &amp; amp; &amp; amp; &lt;0 &amp; lt; VAR_Day &amp; amp; &amp; amp; VAR_Day &amp; lt; 6"</font> <font color="#000000">&gt;</font></font> <br>  <font color="#009900"><font color="#000000">&lt;goto</font> <font color="#000066">next</font> = <font color="#ff0000">"#IVR_Business"</font> <font color="#000000">/&gt;</font></font> <br>  <font color="#009900"><font color="#000000">&lt;else</font> <font color="#000000">/&gt;</font></font> <br>  <font color="#009900"><font color="#000000">&lt;goto</font> <font color="#000066">next</font> = <font color="#ff0000">"#IVR_NonBusiness"</font> <font color="#000000">/&gt;</font></font> <br>  <font color="#009900"><font color="#000000">&lt;/ if <font color="#000000">&gt;</font></font></font> <br>  <font color="#009900"><font color="#000000">&lt;/ block <font color="#000000">&gt;</font></font></font> <br>  <font color="#009900"><font color="#000000">&lt;/ form <font color="#000000">&gt;</font></font></font> </blockquote>  Here we move to a block called IVR_Business during business hours, and IVR_NonBusiness during off-hours and weekends.  About them later. <br><br><h4>  3. Sound files and their playback. </h4><br>  I keep sound recordings in the flash memory of the gateway in G.711 Œº-law format.  In Windows, they can be recorded using the standard Sound Recorder, and in Linux I use the sox program.  The following command converts a PCM audio file to a Œº-law file: <br><br><pre>  sox input.wav -e u-law -V4 -r 8k -c 1 output.wav </pre><br>  We upload the necessary files into memory, for example, from the HTTP server 192.168.0.10: <br><blockquote>  <b>gw #</b> mkdir test <br>  <b>gw #</b> copy http: <font color="black">//</font> 192.168.0.10/ivr1.wav flash0: /test/ivr1.wav <br>  <b>gw #</b> copy http: <font color="black">//</font> 192.168.0.10/ivr2.wav flash0: /test/ivr2.wav <br></blockquote>  The XML block that is responsible for the announcement on weekends looks like this: <br><blockquote>  <font color="#808080">&lt;! - Non business hours -&gt;</font> <br>  <font color="#009900"><font color="#000000">&lt;form</font> <font color="#000066">id</font> = <font color="#ff0000">"IVR_NonBusiness"</font> <font color="#000000">&gt;</font></font> <br>  <font color="#009900"><font color="#000000">&lt;block <font color="#000000">&gt;</font></font></font> <br>  <font color="#009900"><font color="#000000">&lt;prompt <font color="#000000">&gt;</font></font> <font color="#000000">&lt;audio</font> <font color="#000066">src</font> = <font color="#ff0000">"flash0: /test/ivr2.wav"</font> <font color="#000000">/&gt;</font> <font color="#000000">&lt;/ prompt <font color="#000000">&gt;</font></font></font> <br>  <font color="#009900"><font color="#000000">&lt;/ block <font color="#000000">&gt;</font></font></font> <br>  <font color="#009900"><font color="#000000">&lt;/ form <font color="#000000">&gt;</font></font></font> </blockquote><br><h4>  4. Routing to an internal number </h4><br>  Here, according to the scheme, we also have a small greeting (ivr1) and transfer the call to the specified internal number.  This number can be either a phone number or, for example, a CUCM (Hunt Pilot) group number.  In my case, the call was transferred using the phone: // EXT address, although on the Internet I saw variations of the form tel: // EXT or sip: // EXT.  So you may have a little bit different. <br><blockquote>  <font color="#808080">&lt;! - Business hours -&gt;</font> <br>  <font color="#009900"><font color="#000000">&lt;form</font> <font color="#000066">id</font> = <font color="#ff0000">"IVR_Business"</font> <font color="#000000">&gt;</font></font> <br>  <font color="#009900"><font color="#000000">&lt;block <font color="#000000">&gt;</font></font></font> <br>  <font color="#009900"><font color="#000000">&lt;prompt <font color="#000000">&gt;</font></font> <font color="#000000">&lt;audio</font> <font color="#000066">src</font> = <font color="#ff0000">"flash0: /test/ivr1.wav"</font> <font color="#000000">/&gt;</font> <font color="#000000">&lt;/ prompt <font color="#000000">&gt;</font></font></font> <br>  <font color="#009900"><font color="#000000">&lt;/ block <font color="#000000">&gt;</font></font></font> <br>  <font color="#009900"><font color="#000000">&lt;transfer</font> <font color="#000066">name</font> = <font color="#ff0000">"mycall"</font> <font color="#000066">transferaudio</font> = <font color="#ff0000">"flash0: /test/music.wav"</font> <font color="#000066">bridge</font> = <font color="#ff0000">"false"</font> <font color="#000066">dest</font> = <font color="#ff0000">"phone: // 123"</font> <font color="#000000">&gt;</font></font> <br>  <font color="#009900"><font color="#000000">&lt;filled <font color="#000000">&gt;</font></font></font> <br>  <font color="#009900"><font color="#000000">&lt;log <font color="#000000">&gt;</font></font></font> TRANSFER RETURNED: <font color="#009900"><font color="#000000">&lt;value</font> <font color="#000066">expr</font> = <font color="#ff0000">"mycall"</font> <font color="#000000">/&gt;</font> <font color="#000000">&lt;/ log <font color="#000000">&gt;</font></font></font> <br>  <font color="#009900"><font color="#000000">&lt;/ filled <font color="#000000">&gt;</font></font></font> <br>  <font color="#009900"><font color="#000000">&lt;/ transfer <font color="#000000">&gt;</font></font></font> <br>  <font color="#009900"><font color="#000000">&lt;/ form <font color="#000000">&gt;</font></font></font> </blockquote>  If necessary, we will be able to catch the call result code in the mycall variable if we enable debug voip application vxml puts debug mode.  Note also that the transferaudio parameter is a sound file that will play until the number 123 picks up the phone. <br><br><h4>  5. Download and Activate Vxml Script </h4><br>  So now we have the final script <a href="http://pastebin.com/kGp7DLkh">test.vxml</a> , and we can upload it to the gateway.  Similarly, using an HTTP server: <br><blockquote>  <b>gw #</b> copy http: <font color="black">//</font> 192.168.0.10/test.vxml flash0: /test/test.vxml <br></blockquote>  Finally, activate the ‚Äútest‚Äù script: <br><blockquote>  <b>gw #</b> conf t <br>  <b>gw (config) #</b> application <br>  <b>gw (config-app) #</b> no service test flash0: /test/test.vxml <br>  <b>gw (config-app) #</b> service test flash0: /test/test.vxml <br></blockquote>  That's all!  I hope that with the help of this basic script even a beginner can write a simple voice menu.  I suppose the next step would be to screw up the selection of one of the menu branches by pressing one of the numbers on the phone.  But I did not need it yet, so we leave it behind the brackets. <br><br>  In conclusion, here are some links that can help in the development of IVR: <br><ul><li>  <a href="http://www.cisco.com/en/US/docs/ios/voice/vxml/developer/guide/vxmlprg.html">www.cisco.com</a> - an official document from Cisco - VoiceXML Programmer's Guide </li><li>  <a href="http://www.vxml.org/">www.vxml.org</a> - there are many tutorials, though this is not a Cisco implementation, but Voxeo companies </li><li>  <a href="http://www.w3.org/TR/voicexml30/">www.w3.org</a> - VoiceXML 3.0 Language Specification </li></ul></div><p>Source: <a href="https://habr.com/ru/post/159229/">https://habr.com/ru/post/159229/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../159215/index.html">How many portable computer devices do you have (smartphones, tablets, laptops)?</a></li>
<li><a href="../159217/index.html">Phalcon - Compiled PHP MVC Framework</a></li>
<li><a href="../159219/index.html">Knock and open you: smartphones will learn to recognize fingers, nails and knuckles</a></li>
<li><a href="../159223/index.html">Running ServerClub USA</a></li>
<li><a href="../159225/index.html">Start OpenSource Project</a></li>
<li><a href="../159231/index.html">Video review tablet Asus VivoTab RT</a></li>
<li><a href="../159233/index.html">Open lecture: "Organization of the full life cycle of applications"</a></li>
<li><a href="../159235/index.html">What computer technology did you use before exploring MySQL?</a></li>
<li><a href="../159243/index.html">I spend monthly Internet access fees</a></li>
<li><a href="../159247/index.html">New Brief: Samsung Launches New EMMC Pro Class 2000 Memory Modules</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>