<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A little about hashes and secure password storage</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Upd. If you know what BCrypt is, you can stop reading. If you are using PHP 5.5+ you can read this article . Below, I invented my own bicycle, a worke...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A little about hashes and secure password storage</h1><div class="post__text post__text-html js-mediator-article">  <b>Upd.</b>  If you know what BCrypt is, you can stop reading.  If you are using PHP 5.5+ you can read <a href="http://habrahabr.ru/post/194972/">this article</a> .  Below, I invented my own bicycle, a worker, but with two steering wheels, a rear spare.  He was young, hot. <br><br>  Hi, Habr!  Today, in the process of developing an authentication system for my project, I had the choice of how to store user passwords in a database?  A lot of options come to mind.  The most obvious: <br><br><ul><li>  Store passwords in the database in the clear. </li><li>  Use regular hash crc32, md5, sha1 </li><li>  Use the crypt () function </li><li>  Use static ‚Äúsalt‚Äù, constructions of the form md5 (md5 ($ pass)) </li><li>  Use a unique "salt" for each user. </li></ul><br><a name="habracut"></a><br>  The first option was dropped of course right away.  The use of ordinary hashes after a brief deliberation also had to be discarded for several reasons. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h6>  Hash Collision </h6><br>  A hash collision occurs when it produces the same result on different input data.  Of course, the probability of this is quite small, and depends on the length of the hash.  However, the obsolete (but still sometimes used) function crc32 () returns a 32-bit integer as a hash.  That is, in order to select a password for such a hash, according to the theory of probability, it is necessary to obtain 2 ^ 32 = 4,294,967,296 different hashes.  Even on my free hosting, crc32 runs at about 350,000 times per second - calculate for yourself how many seconds it takes to crack such a hash;) <br><br>  Of course, this does not apply to md5 () (128-bit hash) and especially sha1 () (160-bit hash).  Using their collision is almost impossible, although <a href="http://www.mscs.dal.ca/~selinger/md5collision/">there is one</a> little <a href="http://www.mscs.dal.ca/~selinger/md5collision/">article ...</a> <br><br><h6>  Rainbow tables </h6><br>  <a href="http://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25B0%25D0%25B4%25D1%2583%25D0%25B6%25D0%25BD%25D0%25B0%25D1%258F_%25D1%2582%25D0%25B0%25D0%25B1%25D0%25BB%25D0%25B8%25D1%2586%25D0%25B0">Rainbow tables</a> consist of hashes of the most frequently used passwords ‚Äî names, dates of birth, animal names, etc.  These tables can include millions, billions of values, but working with them is relatively fast, and it‚Äôs easy to check the hash for one of the values.  Partially, they can be protected from them with the help of ‚Äúsalt‚Äù or constructions of the md5 type (sha1 (md5 ($ pass))). <br><br><pre><code class="php hljs">$password = <span class="hljs-string"><span class="hljs-string">"easypassword"</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  ,   , ,     echo sha1($password); //       sha1()  : 6c94d3b42518febd4ad747801d50a8972022f956 $salt = "f#@V)Hu^%Hgfds"; //    ,      echo sha1($salt . $password); //     ,  : cd56a16759623378628c0d9336af69b74d9d71a5 //             </span></span></code> </pre> <br><br><h6>  Rainbow tables.  Part 2 </h6><br>  Static salt and similar structures can serve well enough ... as long as the structure of these structures and the salt are kept secret.  If the attacker finds out the secret of hashing, he can easily modify his ‚Äúrainbow table‚Äù for him.  And since  we cannot absolutely rely on the security system of our server, we need to look for another option.  One solution would be to generate a unique salt for each user, something like: <br><br><pre> <code class="php hljs">$hash = sha1($user_id . $password);</code> </pre> <br><br>  It is even better to generate a completely random salt, like this: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//      22  function unique_salt() { return substr(sha1(mt_rand()),0,22); } $unique_salt = unique_salt(); $hash = sha1($unique_salt . $password); //   </span></span></code> </pre><br><br>  Of course, a unique salt will have to be added to the database, but even if it gains access to it, an attacker is unlikely to be able to generate several million rainbow tables. <br><br><h6>  Hash rate </h6><br>  It would seem - the sooner the better.  The faster the hash is generated, the faster our user will be able to register and start already bringing profit.  However, the higher the hash rate, the faster the hacker will be able to pick it up. <br><br>  Modern PCs with powerful GPUs can count millions of hashes per second or more.  And it allows you to break passwords by simple selection, using brute-force attacks.  Do you think that a password of 8 characters is safe enough?  If the password uses lower case and upper case characters and numbers, the total number of possible characters will be 62 (26 + 26 + 10).  For a password of 8 characters, there are 62 ^ 8 different combinations (of the order of 218 trillion).  With a speed of 1 billion hashes per second (small enough for a brute force attack), the password will be broken in about 60 hours.  And for the most common password length of 6 characters, the decryption duration is less than two minutes. <br><br>  You can of course neglect users who use short and simple passwords, or force everyone to voluntarily-compulsorily use 10-character passwords with punctuation marks and Sumerian cuneiform symbols.  But it‚Äôs better to use slower hashing functions.  For example, you can slow down the hash function manually 1000 times with the following code: <br><br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myhash</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($password, $unique_salt)</span></span></span><span class="hljs-function"> </span></span>{ $salt = <span class="hljs-string"><span class="hljs-string">"f#@V)Hu^%Hgfds"</span></span>; $hash = sha1($unique_salt . $password); <span class="hljs-comment"><span class="hljs-comment">//      1000 ,     1000 ,      for ($i = 0; $i &lt; 1000; $i++) { $hash = sha1($hash); } return $hash; }</span></span></code> </pre> <br><br>  Using it, instead of 60 hours, the hacker will break an 8-character password for about 7 years.  A more convenient way to slow down is to use <a href="http://ru.wikipedia.org/wiki/Blowfish">the Blowfish algorithm</a> implemented in PHP via crypt ().  You can check the availability of this algorithm using if (CRYPT_BLOWFISH == 1) echo 'it works!';  PHP 5.3 Blowfish is already enabled. <br><br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myhash</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($password, $unique_salt)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   blowfish     22  return crypt($password, '$2a$10$'.$unique_salt); }</span></span></code> </pre><br><br>  $ 2a is an indication that the Blowfish algorithm will be used. <br>  $ 10 is the power of slowing function.  In this case, equal to 2 ^ 10.  Can take values ‚Äã‚Äãfrom 04 to 31 <br><br>  We use it on a specific example: <br><br><pre> <code class="php hljs">$hash = <span class="hljs-string"><span class="hljs-string">'$2a$10$dfda807d832b094184faeu1elwhtR2Xhtuvs3R9J1nfRGBCudCCzC'</span></span>; $password = <span class="hljs-string"><span class="hljs-string">"verysecret"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (check_password($hash, $password)) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">" !"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">" !"</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_password</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($hash, $password)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  29  ,  , ¬´ ¬ª   ¬´¬ª    $full_salt $full_salt = substr($hash, 0, 29); //  -   $password $new_hash = crypt($password, $full_salt); //   (¬´¬ª  ¬´¬ª) return ($hash == $new_hash);</span></span></code> </pre><br><br>  Such a code should provide maximum security - it is almost impossible to pick up a password of normal complexity and length (programmatically, of course). </div><p>Source: <a href="https://habr.com/ru/post/139974/">https://habr.com/ru/post/139974/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../139968/index.html">Nginx - we leave for technical work</a></li>
<li><a href="../139969/index.html">Crossbrowser CSS</a></li>
<li><a href="../139970/index.html">Fast image compression using JPEG for CUDA</a></li>
<li><a href="../139971/index.html">How was the Moscow Django Meetup</a></li>
<li><a href="../139972/index.html">Working with the coco / r translator generator</a></li>
<li><a href="../139976/index.html">Hello from NASA: an unusual jacket with a thermometer</a></li>
<li><a href="../139981/index.html">When will IPv4 end?</a></li>
<li><a href="../139983/index.html">Shkolnik participated in hacking the site of the space agency of Kazakhstan</a></li>
<li><a href="../139985/index.html">Energy accident in Kiev, lies a number of hosting companies</a></li>
<li><a href="../139986/index.html">Premiere heading Nexus TestDrive. First release, voice input</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>