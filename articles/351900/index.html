<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Flask Mega-Tutorial, Part XVI: Full-Text Search</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="(edition 2018) 
 Miguel grinberg 



 There 


 This is the sixteenth part of a series of Flask Mega-textbooks, in which I am going to add the possibi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Flask Mega-Tutorial, Part XVI: Full-Text Search</h1><div class="post__text post__text-html js-mediator-article"><h2 id="izdanie-2018">  (edition 2018) </h2><br><h3 id="miguel-grinberg">  <em>Miguel grinberg</em> </h3><br><hr><br><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://habrahabr.ru/post/351218/">There</a> <img src="https://habrastorage.org/webt/rw/dy/-g/rwdy-grsvbpcetjttrmecdkxtlk.png"></p><br><p>  This is the sixteenth part of a series of Flask Mega-textbooks, in which I am going to add the possibility of full-text search to a microblog. </p><a name="habracut"></a><br><p>  Under the spoiler is a list of all articles in this 2018 series. </p><br><div class="spoiler">  <b class="spoiler_title">Table of contents</b> <div class="spoiler_text"><ul><li>  <a href="https://habrahabr.ru/post/346306/"><strong>Chapter 1: Hello world!</strong></a> </li><li>  <a href="https://habrahabr.ru/post/346340/"><strong>Chapter 2: Templates</strong></a> </li><li>  <a href="https://habrahabr.ru/post/346342/"><strong>Chapter 3: Web Forms</strong></a> </li><li>  <a href="https://habrahabr.ru/post/346344/"><strong>Chapter 4: Database</strong></a> </li><li>  <a href="https://habrahabr.ru/post/346346/"><strong>Chapter 5: User Logins</strong></a> </li><li>  <a href="https://habrahabr.ru/post/346348/"><strong>Chapter 6: Profile Page and Avatars</strong></a> </li><li>  <a href="https://habrahabr.ru/post/346880/"><strong>Chapter 7: Error Handling</strong></a> </li><li>  <a href="https://habrahabr.ru/post/347450/"><strong>Chapter 8: Subscribers, Contacts, and Friends</strong></a> </li><li>  <a href="https://habrahabr.ru/post/347926/"><strong>Chapter 9: Pagination</strong></a> </li><li>  <a href="https://habrahabr.ru/post/348566/"><strong>Chapter 10: Email Support</strong></a> </li><li>  <a href="https://habrahabr.ru/post/349060/"><strong>Chapter 11: Reconstruction</strong></a> </li><li>  <a href="https://habrahabr.ru/post/349604/"><strong>Chapter 12: Date and Time</strong></a> </li><li>  <a href="https://habrahabr.ru/post/350148/"><strong>Chapter 13: I18n and L10n</strong></a> </li><li>  <a href="https://habrahabr.ru/post/350626/"><strong>Chapter 14: Ajax</strong></a> </li><li>  <a href="https://habrahabr.ru/post/351218/"><strong>Chapter 15: Improving Application Structure</strong></a> </li><li>  <a href="https://habrahabr.ru/post/351900/"><strong>Chapter 16: Full-Text Search</strong></a> (This article) </li><li>  <a href="https://habrahabr.ru/post/352266/"><strong>Chapter 17: Deploying to Linux</strong></a> </li><li>  <a href="https://habrahabr.ru/topic/post/352830/"><strong>Chapter 18: Deploying to Heroku</strong></a> </li><li>  <a href="https://habrahabr.ru/topic/post/353234/"><strong>Chapter 19: Deploying to Docker Containers</strong></a> </li><li>  <a href="https://habrahabr.ru/post/353804/"><strong>Chapter 20: JavaScript Magic</strong></a> </li><li>  Chapter 21: User Notifications (Available April 24, 2018) </li><li>  Chapter 22: Reference Tasks (Available May 1, 2018) </li><li>  Chapter 23: Application Programming Interfaces (APIs) (Available May 8, 2018) </li></ul></div></div><br><p>  <em>Note 1: If you are looking for old versions of this course, this is <a href="https://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-i-hello-world-legacy" title="here">here</a> .</em> </p><br><p>  <em>Note 2: If suddenly you would like to speak in support of my (Miguel) work, or simply do not have the patience to wait for the article for a week, I (Miguel Greenberg) offer the full version of this manual (in English) in the form of an electronic book or video.</em>  <em>For more information, visit <a href="http://learn.miguelgrinberg.com/" title="learn.miguelgrinberg.com">learn.miguelgrinberg.com</a> .</em> </p><br><p>  The purpose of this chapter is to implement the search function for Microblog so that users can find interesting messages using their usual language.  For many types of websites, you can simply allow Google, Bing, etc. To index all content and provide search results through their search APIs.  This works for sites that have mostly static pages, such as a forum.  But in my application, the main unit of content is the user post, which is a small part of the entire web page.  The search I need refers to these individual blog posts, not entire pages.  For example, if I‚Äôm looking for the word ‚Äúdog,‚Äù I want to see posts that include this word in blogs of different users.  The problem is that a page that shows all the posts that have the word "dog" (or any other possible search term) does not exist as a blog page that large search engines can find and index, so I have no other choice. except to create your own search function. </p><br><p>  <em>GitHub links for this chapter:</em> <a href="">Browse</a> , <a href="">Zip</a> , <a href="">Diff</a> . </p><br><h2 id="vvedenie-v-polnotekstovye-poiskovye-sistemy">  Introduction to Full-Text Search Engines </h2><br><p>  Full-text search support is not standardized like relational databases.  There are several open-source full-text engines: <a href="https://www.elastic.co/products/elasticsearch">Elasticsearch</a> , <a href="http://lucene.apache.org/solr/">Apache Solr</a> , <a href="http://whoosh.readthedocs.io/">Whoosh</a> , <a href="https://xapian.org/">Xapian</a> , <a href="http://sphinxsearch.com/">Sphinx</a> , etc.  As if this is not enough!  There are several databases that also provide search capabilities comparable to dedicated search engines, such as the ones I listed above.  <a href="https://www.sqlite.org/">SQLite</a> , <a href="https://www.mysql.com/">MySQL</a> and <a href="https://www.postgresql.org/">PostgreSQL</a> offer some support for text search, as well as NoSQL databases such as <a href="https://www.mongodb.com/">MongoDB</a> and <a href="http://couchdb.apache.org/">CouchDB</a> . </p><br><p>  If you are wondering which of them can work in the Flask application, the answer is all of them!  This is one of the strengths of Flask, it does its job and is not stubborn.  So what is the best choice? </p><br><p>  In my opinion, from the list of specialized search engines Elasticsearch stands out in particular.  Both as the most popular and significant, it stands first as an ‚ÄúE‚Äù character in the ELK stack for indexing logs, together with Logstash and Kibana.  Using search capabilities in one of the relational databases might be a good choice, but given the fact that SQLAlchemy does not support this functionality, I would have to process the search using raw SQL instructions or find a package with access to text queries, as well as sharing with SQLAlchemy. </p><br><p>  Based on the above, I choose Elasticsearch, but I am going to implement all of the text indexing and search functions in such a way that it is very easy to switch to another engine.  This will replace my implementation with an alternative version based on a different mechanism, simply by rewriting several functions in one module. </p><br><p> There are several ways to install Elasticsearch, including one-click installation or a zip file with binaries that you need to install yourself, and even a Docker image.  The <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/install-elasticsearch.html">documentation</a> has an installation page with detailed information about all these options.  If you are using Linux, you will probably have an available package for your distribution.  If you are using a Mac and you have Homebrew installed, then you can simply run <code>brew install elasticsearch</code> . </p><br><p>  After installing Elasticsearch on your computer, you can check whether it works by entering <code>http://localhost:9200</code> in the address bar of the browser, which should return some basic information about the service in JSON format. </p><br><p>  Since Elasticsearch will be managed from Python, I will use the Python client library: </p><br><pre> <code class="hljs sql">(venv) $ pip <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> elasticsearch</code> </pre> <br><p>  Now it doesn‚Äôt hurt to update the <em>requirements.txt</em> file: </p><br><pre> <code class="hljs pgsql">(venv) $ pip <span class="hljs-keyword"><span class="hljs-keyword">freeze</span></span> &gt; requirements.txt</code> </pre> <br><h2 id="elasticsearch-tutorial">  Elasticsearch Tutorial </h2><br><p>  First, I'll show you the basics of working with Elasticsearch from the Python shell.  This will help you familiarize yourself with this service and understand its implementation, which I will discuss later. </p><br><p>  To create a connection to Elasticsearch, create an instance of the <code>Elasticsearch</code> class by passing the connection URL as an argument: </p><br><pre> <code class="hljs python"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> elasticsearch <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Elasticsearch &gt;&gt;&gt; es = Elasticsearch(<span class="hljs-string"><span class="hljs-string">'http://localhost:9200'</span></span>)</code> </pre> <br><p>  Data in Elasticsearch is <em>indexed</em> during recording.  Unlike a relational database, this is just a <a href="http://www.json.org/">JSON</a> object.  The following example writes an object in a field of type <code>text</code> , under the index <code>my_index</code> : </p><br><pre> <code class="hljs pgsql">&gt;&gt;&gt; es.<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>=<span class="hljs-string"><span class="hljs-string">'my_index'</span></span>, doc_type=<span class="hljs-string"><span class="hljs-string">'my_index'</span></span>, id=<span class="hljs-number"><span class="hljs-number">1</span></span>, body={<span class="hljs-string"><span class="hljs-string">'text'</span></span>: <span class="hljs-string"><span class="hljs-string">'this is a test'</span></span>})</code> </pre> <br><p>  If desired, index can store documents of different types, in which case the argument <code>doc_type</code> can be set to different values ‚Äã‚Äãaccording to these different formats.  I'm going to keep all documents in the same format, so I set the document type to the name of the index. </p><br><p>  For each saved document, Elasticsearch receives a unique identifier and a JSON object with the data. </p><br><p>  Let's save the second document at the same index: </p><br><pre> <code class="hljs pgsql">&gt;&gt;&gt; es.<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>=<span class="hljs-string"><span class="hljs-string">'my_index'</span></span>, doc_type=<span class="hljs-string"><span class="hljs-string">'my_index'</span></span>, id=<span class="hljs-number"><span class="hljs-number">2</span></span>, body={<span class="hljs-string"><span class="hljs-string">'text'</span></span>: <span class="hljs-string"><span class="hljs-string">'a second test'</span></span>})</code> </pre> <br><p>  And now, when there are two documents in this index, I can perform a free-form search.  In this example, I will look for <code>this test</code> : </p><br><pre> <code class="hljs ruby"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;</span></span>&gt; es.search(index=<span class="hljs-string"><span class="hljs-string">'my_index'</span></span>, doc_type=<span class="hljs-string"><span class="hljs-string">'my_index'</span></span>, ... body={<span class="hljs-string"><span class="hljs-string">'query'</span></span>: {<span class="hljs-string"><span class="hljs-string">'match'</span></span>: {<span class="hljs-string"><span class="hljs-string">'text'</span></span>: <span class="hljs-string"><span class="hljs-string">'this test'</span></span>}}})</code> </pre> <br><p>  The <code>es.search()</code> response is a Python dictionary with search results: </p><br><pre> <code class="hljs pgsql">{ <span class="hljs-string"><span class="hljs-string">'took'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'timed_out'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">'_shards'</span></span>: {<span class="hljs-string"><span class="hljs-string">'total'</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-string"><span class="hljs-string">'successful'</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-string"><span class="hljs-string">'skipped'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'failed'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>}, <span class="hljs-string"><span class="hljs-string">'hits'</span></span>: { <span class="hljs-string"><span class="hljs-string">'total'</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'max_score'</span></span>: <span class="hljs-number"><span class="hljs-number">0.5753642</span></span>, <span class="hljs-string"><span class="hljs-string">'hits'</span></span>: [ { <span class="hljs-string"><span class="hljs-string">'_index'</span></span>: <span class="hljs-string"><span class="hljs-string">'my_index'</span></span>, <span class="hljs-string"><span class="hljs-string">'_type'</span></span>: <span class="hljs-string"><span class="hljs-string">'my_index'</span></span>, <span class="hljs-string"><span class="hljs-string">'_id'</span></span>: <span class="hljs-string"><span class="hljs-string">'1'</span></span>, <span class="hljs-string"><span class="hljs-string">'_score'</span></span>: <span class="hljs-number"><span class="hljs-number">0.5753642</span></span>, <span class="hljs-string"><span class="hljs-string">'_source'</span></span>: {<span class="hljs-string"><span class="hljs-string">'text'</span></span>: <span class="hljs-string"><span class="hljs-string">'this is a test'</span></span>} }, { <span class="hljs-string"><span class="hljs-string">'_index'</span></span>: <span class="hljs-string"><span class="hljs-string">'my_index'</span></span>, <span class="hljs-string"><span class="hljs-string">'_type'</span></span>: <span class="hljs-string"><span class="hljs-string">'my_index'</span></span>, <span class="hljs-string"><span class="hljs-string">'_id'</span></span>: <span class="hljs-string"><span class="hljs-string">'2'</span></span>, <span class="hljs-string"><span class="hljs-string">'_score'</span></span>: <span class="hljs-number"><span class="hljs-number">0.25316024</span></span>, <span class="hljs-string"><span class="hljs-string">'_source'</span></span>: {<span class="hljs-string"><span class="hljs-string">'text'</span></span>: <span class="hljs-string"><span class="hljs-string">'a second test'</span></span>} } ] } }</code> </pre> <br><p>  Here you can see that the search returned two documents, each with its own assessment.  The document with the highest score contains two words that I was looking for, and the other document contains only one.  But, as you can see, even the best result does not have a great score, because the words do not quite correspond to the text. </p><br><p>  Now let's see the result for the search for the word <code>second</code> : </p><br><pre> <code class="hljs ruby"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;</span></span>&gt; es.search(index=<span class="hljs-string"><span class="hljs-string">'my_index'</span></span>, doc_type=<span class="hljs-string"><span class="hljs-string">'my_index'</span></span>, ... body={<span class="hljs-string"><span class="hljs-string">'query'</span></span>: {<span class="hljs-string"><span class="hljs-string">'match'</span></span>: {<span class="hljs-string"><span class="hljs-string">'text'</span></span>: <span class="hljs-string"><span class="hljs-string">'second'</span></span>}}}) { <span class="hljs-string"><span class="hljs-string">'took'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'timed_out'</span></span>: False, <span class="hljs-string"><span class="hljs-string">'_shards'</span></span>: {<span class="hljs-string"><span class="hljs-string">'total'</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-string"><span class="hljs-string">'successful'</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-string"><span class="hljs-string">'skipped'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'failed'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>}, <span class="hljs-string"><span class="hljs-string">'hits'</span></span>: { <span class="hljs-string"><span class="hljs-string">'total'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'max_score'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">25316024</span></span>, <span class="hljs-string"><span class="hljs-string">'hits'</span></span>: [ { <span class="hljs-string"><span class="hljs-string">'_index'</span></span>: <span class="hljs-string"><span class="hljs-string">'my_index'</span></span>, <span class="hljs-string"><span class="hljs-string">'_type'</span></span>: <span class="hljs-string"><span class="hljs-string">'my_index'</span></span>, <span class="hljs-string"><span class="hljs-string">'_id'</span></span>: <span class="hljs-string"><span class="hljs-string">'2'</span></span>, <span class="hljs-string"><span class="hljs-string">'_score'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">25316024</span></span>, <span class="hljs-string"><span class="hljs-string">'_source'</span></span>: {<span class="hljs-string"><span class="hljs-string">'text'</span></span>: <span class="hljs-string"><span class="hljs-string">'a second test'</span></span>} } ] } }</code> </pre> <br><p>  The score is rather low because my search does not match the text in this document, but since only one of the two documents contains the word "second", the other document is not displayed at all. </p><br><p>  The Elasticsearch request object has many parameters and all of them are well <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-body.html">documented</a> .  Among them, such as pagination and sorting, as well as in the case of relational databases. </p><br><p>  Feel free to add more entries to this index and try different search options.  When you finish experimenting, you can delete the index with the following command: </p><br><pre> <code class="hljs ruby"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;</span></span>&gt; es.indices.delete(<span class="hljs-string"><span class="hljs-string">'my_index'</span></span>)</code> </pre> <br><h2 id="konfiguraciya-elasticsearch">  Elasticsearch configuration </h2><br><p>  Integrating Elasticsearch into an application is an excellent example of the coolness of Flask.  This service and the Python package, which has nothing to do with Flask, but I still try to get a decent level of integration.  I will start with the configuration that I will write in the <code>app.config</code> dictionary for Flask: </p><br><blockquote>  <em>config.py</em> : Elasticsearch Configuration. </blockquote><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>): # ... ELASTICSEARCH_URL = os.environ.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-string"><span class="hljs-string">'ELASTICSEARCH_URL'</span></span>)</code> </pre> <br><p>  As with many other configuration entries, the connection URL for Elasticsearch will be obtained from the environment variable.  If the variable is not defined, we get the value <code>None</code> , and this will be a signal to disable Elasticsearch.  This is done mainly for convenience, so as not to force us to always have the Elasticsearch service when working with the application, and in particular when performing unit tests.  Therefore, to make sure that the service is used, I need to define the <code>ELASTICSEARCH_URL</code> environment <code>ELASTICSEARCH_URL</code> , either directly in the terminal, or by adding its <em>.env</em> file as follows: </p><br><pre> <code class="hljs objectivec">ELASTICSEARCH_URL=http:<span class="hljs-comment"><span class="hljs-comment">//localhost:9200</span></span></code> </pre> <br><p>  Elasticsearch creates a problem because it is not decorated with the Flask extension.  I cannot create an instance of Elasticsearch in the global realm, as in the examples above, because to initialize it, I need access to the <code>app.config</code> , which becomes available only after calling the <code>create_app()</code> function.  So I decided to add the <code>elasticsearch</code> attribute to the <code>app</code> instance in the application factory functions: </p><br><blockquote>  <em>app / <strong>init</strong> .py</em> : Elasticsearch instance. </blockquote><br><pre> <code class="hljs scala"># ... from elasticsearch <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-type"><span class="hljs-type">Elasticsearch</span></span> # ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create_app</span></span></span></span>(config_class=<span class="hljs-type"><span class="hljs-type">Config</span></span>): app = <span class="hljs-type"><span class="hljs-type">Flask</span></span>(__name__) app.config.from_object(config_class) # ... app.elasticsearch = <span class="hljs-type"><span class="hljs-type">Elasticsearch</span></span>([app.config[<span class="hljs-symbol"><span class="hljs-symbol">'ELASTICSEARCH_UR</span></span>L']]) \ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> app.config[<span class="hljs-symbol"><span class="hljs-symbol">'ELASTICSEARCH_UR</span></span>L'] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-type"><span class="hljs-type">None</span></span> # ...</code> </pre> <br><p>  Adding a new attribute to an <code>app</code> instance may seem a bit odd, but Python objects are not too strict in their structure; new attributes can be added to them at any time.  An alternative, which you can also consider, is to create a subclass of <code>Flask</code> (perhaps call it <code>Microblog</code> ) with the elasticsearch attribute defined in its <code>__init__()</code> function. </p><br><p>  Notice how I use the <a href="https://docs.python.org/3/reference/expressions.html">conditional expression</a> to assign <code>None</code> Elasticsearch instance if the URL of the Elasticsearch service has not been defined in the environment. </p><br><h2 id="abstrakciya-full-text-search">  Abstraction Full-Text Search </h2><br><p>  As I said in the introduction to the chapter, I want to simplify the possible transition from Elasticsearch to other search engines.  And I don‚Äôt want to encode this function specifically for searching blog posts, but prefer to develop a solution that I can easily extend to other models in the future if I need it.  For all these reasons, I decided to create an abstraction for the search function.  The idea is to develop a function in general terms, so I will not assume that the <code>Post</code> model is the only one that needs to be indexed, and I also will not assume that Elasticsearch is the preferred index engine.  But if I can't make any assumptions about anything, how can I make this work? </p><br><p>  The first thing I need is to somehow find a common way to indicate which model and which field or fields in it should be indexed.  I want to say that any model that needs indexing should define an attribute of the <code>__searchable__</code> class that contains the fields that should be included in the index.  For the Post model it will look like this: </p><br><blockquote>  <em>app / models.py</em> : Add a __searchable__ attribute to the Post model. </blockquote><br><pre> <code class="hljs python"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Post</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(db.Model)</span></span></span><span class="hljs-class">:</span></span> __searchable__ = [<span class="hljs-string"><span class="hljs-string">'body'</span></span>] <span class="hljs-comment"><span class="hljs-comment"># ...</span></span></code> </pre> <br><p>  It says that this model should have an indexed <code>body</code> field.  Let me explain for clarity!  This attribute <code>__searchable__</code> , which I added, is simply a variable, it has no behavior associated with it.  It just helps me to write my indexing functions in general. </p><br><p>  I'm going to write all the code that interacts with the Elasticsearch index in the <em>app / search.py</em> module.  The idea is to save all Elasticsearch code in this module.  The rest of the application will use the functions in this new module to access the index and will not have direct access to Elasticsearch.  This is important because if one day I decide that I don‚Äôt like Elasticsearch anymore and get ready to switch to another engine, all I need to do is overwrite the functions in this one module and the application will continue to work as before. </p><br><p>  For this application, I decided that I needed three auxiliary functions related to text indexing: I needed: </p><br><ul><li>  Add entries to the full-text index </li><li>  remove entries from the index (provided that one day I support deleting blog posts), </li><li>  perform a search query. </li></ul><br><p>  Here is the <em>app / search.py</em> module, which implements these three functions for Elasticsearch, using the functionality I showed you above from the Python console: </p><br><blockquote>  app / search.py: Search functions. </blockquote><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flask <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> current_app def add_to_index(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>, model): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> current_app.elasticsearch: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> payload = {} <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> field <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> model.__searchable__: payload[field] = getattr(model, field) current_app.elasticsearch.<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>, doc_type=<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>, id=model.id, body=payload) def remove_from_index(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>, model): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> current_app.elasticsearch: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> current_app.elasticsearch.<span class="hljs-keyword"><span class="hljs-keyword">delete</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>, doc_type=<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>, id=model.id) def query_index(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>, query, page, per_page): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> current_app.elasticsearch: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [], <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">search</span></span> = current_app.elasticsearch.<span class="hljs-keyword"><span class="hljs-keyword">search</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>, doc_type=<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>, body={<span class="hljs-string"><span class="hljs-string">'query'</span></span>: {<span class="hljs-string"><span class="hljs-string">'multi_match'</span></span>: {<span class="hljs-string"><span class="hljs-string">'query'</span></span>: query, <span class="hljs-string"><span class="hljs-string">'fields'</span></span>: [<span class="hljs-string"><span class="hljs-string">'*'</span></span>]}}, <span class="hljs-string"><span class="hljs-string">'from'</span></span>: (page - <span class="hljs-number"><span class="hljs-number">1</span></span>) * per_page, <span class="hljs-string"><span class="hljs-string">'size'</span></span>: per_page}) ids = [<span class="hljs-type"><span class="hljs-type">int</span></span>(hit[<span class="hljs-string"><span class="hljs-string">'_id'</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> hit <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">search</span></span>[<span class="hljs-string"><span class="hljs-string">'hits'</span></span>][<span class="hljs-string"><span class="hljs-string">'hits'</span></span>]] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ids, <span class="hljs-keyword"><span class="hljs-keyword">search</span></span>[<span class="hljs-string"><span class="hljs-string">'hits'</span></span>][<span class="hljs-string"><span class="hljs-string">'total'</span></span>]</code> </pre> <br><p>  All of these functions begin with checking whether <code>app.elasticsearch</code> is <code>app.elasticsearch</code> .  In the case of <code>None</code> exit the function without any action.  This means that if the Elasticsearch server is not configured, the application will continue to work without searching and without any errors.  How convenient it will become clear during development or when performing unit tests. </p><br><p>  Functions take the name index as an argument.  In all calls that I pass to Elasticsearch, I use this name as the index name, as well as the document type, as I did in the Python console examples. </p><br><p>  Functions that add and remove records from the index take the SQLAlchemy model as the second argument.  The <code>add_to_index()</code> function uses the class variable <code>__searchable__</code> added to the model to build the document inserted into the index.  If you remember, Elasticsearch documents also needed a unique identifier.  For this, I use the <code>id</code> field of the SQLAlchemy model, which is also unique.  Using the same <code>id</code> value for SQLAlchemy and Elasticsearch is very useful when performing a search, because it allows me to link records in two databases.  Another joke is that if you try to add an entry with an existing identifier, Elasticsearch will replace the old entry with a new one, so <code>add_to_index()</code> can be used for both new and changed objects. </p><br><p>  I did not show you the <code>es.delete ()</code> function that I used to use in <code>remove_from_index()</code> .  This function deletes the document stored under the given identifier.  Here is a good example of the convenience of using the same identifier for linking records in both databases. </p><br><p>  The <code>query_index()</code> function accepts the index name and text for the search, as well as the paging controls, so the search results can be paginated as Flask-SQLAlchemy results.  You have already seen an example of using the <code>es.search()</code> function from the Python console.  The call I give out is quite similar, but instead of using the <code>match</code> query type, I decided to use <code>multi_match</code> , which can perform a search on several fields.  The field name <code>*</code> , allows the installation of Elasticsearch to look at all the fields for searching the index.  This is useful to make this feature universal, since different models may have different field names in the index. </p><br><p>  The <code>body</code> argument of <code>es.search()</code> complements the query itself with a <code>es.search()</code> argument.  The <code>from</code> and <code>size</code> arguments determine which subset of the entire result set needs to be returned.  Elasticsearch does not provide a full <code>Pagination</code> object, similar to the Flask-SQLAlchemy object, so I will have to write the pagination procedure myself to calculate the value <code>from</code> . </p><br><p>  The <code>return</code> in the <code>query_index()</code> function is somewhat more complicated.  It returns two values: the first is a list of identification elements for the search results, and the second is the total number of results.  Both are derived from the Python dictionary returned by the <code>es.search()</code> function.  If you are not familiar with the expression that I use to get a list of identifiers, then I‚Äôll explain: her name is <code>list comprehension</code> , and this is a fantastic Python function that allows you to convert lists from one format to another.  In this case, I use a list generator to extract <code>id</code> values ‚Äã‚Äãfrom a much larger list of results provided by Elasticsearch. </p><br><p>  Is it too confusing?  Perhaps a demonstration of these functions in the Python console can help you understand them better.  In the next session, I manually add all messages from the database to the Elasticsearch index.  In my test database, I had several messages that had the digits ‚Äúone,‚Äù ‚Äútwo,‚Äù ‚Äúthree,‚Äù ‚Äúfour,‚Äù and ‚Äúfive,‚Äù so I used them in search queries.  You may have to adapt your query to match the contents of your database: </p><br><pre> <code class="hljs python"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> app.search <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> add_to_index, remove_from_index, query_index &gt;&gt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> post <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Post.query.all(): ... add_to_index(<span class="hljs-string"><span class="hljs-string">'posts'</span></span>, post) &gt;&gt;&gt; query_index(<span class="hljs-string"><span class="hljs-string">'posts'</span></span>, <span class="hljs-string"><span class="hljs-string">'one two three four five'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>) ([<span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">14</span></span>], <span class="hljs-number"><span class="hljs-number">7</span></span>) &gt;&gt;&gt; query_index(<span class="hljs-string"><span class="hljs-string">'posts'</span></span>, <span class="hljs-string"><span class="hljs-string">'one two three four five'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) ([<span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>], <span class="hljs-number"><span class="hljs-number">7</span></span>) &gt;&gt;&gt; query_index(<span class="hljs-string"><span class="hljs-string">'posts'</span></span>, <span class="hljs-string"><span class="hljs-string">'one two three four five'</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) ([<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>], <span class="hljs-number"><span class="hljs-number">7</span></span>) &gt;&gt;&gt; query_index(<span class="hljs-string"><span class="hljs-string">'posts'</span></span>, <span class="hljs-string"><span class="hljs-string">'one two three four five'</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) ([<span class="hljs-number"><span class="hljs-number">14</span></span>], <span class="hljs-number"><span class="hljs-number">7</span></span>)</code> </pre> <br><p>  The query I sent returns seven results.  At first, I requested 1 page with 100 points per page and received all seven possible.  Then the following three examples show how I can break pages in a very similar way to how I did it for Flask-SQLAlchemy, except that the results come in the form of a list of identifiers instead of SQLAlchemy objects. </p><br><p>  If you want to keep everything clean, delete the <code>posts</code> index after experimenting with it: </p><br><pre> <code class="hljs ruby"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;</span></span>&gt; app.elasticsearch.indices.delete(<span class="hljs-string"><span class="hljs-string">'posts'</span></span>)</code> </pre> <br><h2 id="integraciya-poiska-s-sqlalchemy">  Search Integration with SQLAlchemy </h2><br><p>  The solution that I showed you in the previous section is acceptable, but it still has several unsolved problems.  The first and most obvious is that the results come in the form of a list of numeric identifiers.  This is very inconvenient, because I need the SQLAlchemy models so that I can transfer them to the templates for rendering, and I need a way to replace this list of numbers with the corresponding models from the database.  The second problem is that this solution requires the application to explicitly issue index calls.  Messages are added or removed, which is not terrible, but not ideal, because an error that causes missing call indexation when making changes on the SQLAlchemy side is not going to be easily detected.  Two databases will get out of sync more and more each time an error occurs and you probably won't notice it for a while.  The best solution would be to automatically include these calls when making changes to the SQLAlchemy database. </p><br><p>  The problem of replacing identifiers with objects can be solved by creating a SQLAlchemy query that reads these objects from the database.  It sounds simple, but it‚Äôs actually not so easy to implement efficiently performing a single request. </p><br><p>  To solve the second problem (automatic tracking of indexing changes), I decided to perform updates of the Elasticsearch index from the SQLAlchemy events.  SQLAlchemy provides a large list of events about which applications can receive notifications.  For example, for each commit commit ( <em>commit changes</em> ) session, I could have a function in an application called SQLAlchemy, in which I could apply the same updates that were made in the SQLAlchemy session to the Elasticsearch index. </p><br><p>  To implement the solutions of these two tasks, I am going to write a <em>mixin</em> class.  Remember to mixin?  In <a href="https://habrahabr.ru/post/346346/">Chapter 5,</a> I added the <code>UserMixin</code> class from Flask-Login to the user model to entrust it with some of the functions that Flask-Login required.  To support the search, I'm going to define my own <code>SearchableMixin</code> class, which, when connected to the model, will give it the ability to automatically manage the full-text index associated with the SQLAlchemy model.  The mixin class will act as a "glue" layer between the worlds of SQLAlchemy and Elasticsearch, providing solutions to the two problems I mentioned above. </p><br><p>  Let me show you the implementation, and then I will look at some interesting details.  Note the use of several advanced methods, so you will need to carefully study this code to fully understand it. </p><br><blockquote>  <em>app / models.py</em> : SearchableMixin class. </blockquote><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> app.search <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> add_to_index, remove_from_index, query_index <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SearchableMixin</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> @classmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">search</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(cls, expression, page, per_page)</span></span></span><span class="hljs-function">:</span></span> ids, total = query_index(cls.__tablename__, expression, page, per_page) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> total == <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cls.query.filter_by(id=<span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span> when = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(len(ids)): when.append((ids[i], i)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cls.query.filter(cls.id.in_(ids)).order_by( db.case(when, value=cls.id)), total @classmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before_commit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(cls, session)</span></span></span><span class="hljs-function">:</span></span> session._changes = { <span class="hljs-string"><span class="hljs-string">'add'</span></span>: list(session.new), <span class="hljs-string"><span class="hljs-string">'update'</span></span>: list(session.dirty), <span class="hljs-string"><span class="hljs-string">'delete'</span></span>: list(session.deleted) } @classmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after_commit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(cls, session)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> obj <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> session._changes[<span class="hljs-string"><span class="hljs-string">'add'</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isinstance(obj, SearchableMixin): add_to_index(obj.__tablename__, obj) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> obj <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> session._changes[<span class="hljs-string"><span class="hljs-string">'update'</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isinstance(obj, SearchableMixin): add_to_index(obj.__tablename__, obj) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> obj <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> session._changes[<span class="hljs-string"><span class="hljs-string">'delete'</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isinstance(obj, SearchableMixin): remove_from_index(obj.__tablename__, obj) session._changes = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> @classmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reindex</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(cls)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> obj <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> cls.query: add_to_index(cls.__tablename__, obj) db.event.listen(db.session, <span class="hljs-string"><span class="hljs-string">'before_commit'</span></span>, SearchableMixin.before_commit) db.event.listen(db.session, <span class="hljs-string"><span class="hljs-string">'after_commit'</span></span>, SearchableMixin.after_commit)</code> </pre> <br><p>  There are four functions in this mixin class ‚Äî all class methods (See the <em>classmethod</em> decorator).  This is a special method that is associated with the class, and not with a specific instance.  Notice how I renamed the <code>self</code> argument used in the usual instance methods for <code>cls</code> so that it is clear that this method takes a class as the first argument, not an instance.  For example, when connecting to the <code>Post</code> model, the <code>search()</code> method above will be called <code>Post.search()</code> without having an actual instance of the Post class. </p><br><p>  The class method <code>search()</code> wraps the <code>query_index()</code> function from <em>app / search.py,</em> replacing the list of object identifiers with actual objects.  Obviously, the first thing this function does is call <code>query_index()</code> , passing <code>cls.__ tablename__</code> as an index name.  With this arrangement, all indexes will be named with the Flask-SQLAlchemy name assigned to the relational table.  The function returns a list of result IDs and their total number.  The SQLAlchemy query, which retrieves the list of objects by their ID, is based on the <code>CASE</code> statement from the SQL language, which should be used to ensure that the results from the database come in the same order as the identifiers.  This is important because the Elasticsearch query returns results sorted from more to less relevant.  If you want to find out more about how this query works, you can refer to the answer to this question from <a href="https://stackoverflow.com/a/6332081/904393">StackOverflow</a> .  <code>search()</code>  ,    ,            . </p><br><p>  <code>before_commit()</code>  <code>after_commit()</code>       SQLAlchemy,       .  before ,       ,       ,    ,   ,   <code>session.new</code> <code>session.dirty</code>  <code>session.deleted</code> .         ,       .   <code>session._changes</code>       ,     ,  ,            Elasticsearch. </p><br><p>   <code>after_commit()</code> ,    ,         Elasticsearch.     <code>_changes</code> ,     <code>before_commit()</code> ,      ,             <em>app/search.py</em> . </p><br><p>   <code>reindex()</code> ‚Äî    ,            .  ,    -     Python ,         .   ,    <code>Post.reindex(),</code>           ( <em>search index</em> ). </p><br><p>  ,   <code>db.event.listen()</code>    ,    .    ,   before  after   .   <code>Post</code>       . </p><br><p>    <code>SearchableMixin</code>   <code>Post</code> ,       ,      befor  after  : </p><br><blockquote> <em>app/models.py</em> :  SearchableMixin class  Post model. </blockquote><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Post</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SearchableMixin</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">db</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Model</span></span></span><span class="hljs-class">): # ...</span></span></code> </pre> <br><p>     <code>reindex()</code>      ,       : </p><br><pre> <code class="hljs ruby"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;</span></span>&gt; Post.reindex()</code> </pre> <br><p>     ,    SQLAlchemy,  <code>Post.search()</code> .             : </p><br><pre> <code class="hljs xml">&gt;&gt;&gt; query, total = Post.search('one two three four five', 1, 5) &gt;&gt;&gt; total 7 &gt;&gt;&gt; query.all() [<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Post</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">five</span></span></span><span class="hljs-tag">&gt;</span></span>, <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Post</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">two</span></span></span><span class="hljs-tag">&gt;</span></span>, <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Post</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">one</span></span></span><span class="hljs-tag">&gt;</span></span>, <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Post</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">one</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">more</span></span></span><span class="hljs-tag">&gt;</span></span>, <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Post</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">one</span></span></span><span class="hljs-tag">&gt;</span></span>]</code> </pre> <br><h2 id="forma-poiska">   </h2><br><p>         ,    .                    .         . </p><br><p>     -   ,     ,   <code>q</code>    URL-. ,     <code>Python</code>  Google,      ,      URL-    ,     : </p><br><pre> <code class="hljs objectivec">https:<span class="hljs-comment"><span class="hljs-comment">//www.google.com/search?q=python</span></span></code> </pre> <br><p>       URL- ,         ,          . </p><br><p>     ,       -  .    <code>POST</code>       ,      ,    ,   ,        <code>GET</code> ,    ,     URL-     .       ,        ,        . </p><br><p>    ,     <code>q</code> : </p><br><blockquote> <em>app/main/forms.py</em> : Search form. </blockquote><br><pre> <code class="hljs python"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flask <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> request <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SearchForm</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(FlaskForm)</span></span></span><span class="hljs-class">:</span></span> q = StringField(_l(<span class="hljs-string"><span class="hljs-string">'Search'</span></span>), validators=[DataRequired()]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, *args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">'formdata'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> kwargs: kwargs[<span class="hljs-string"><span class="hljs-string">'formdata'</span></span>] = request.args <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">'csrf_enabled'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> kwargs: kwargs[<span class="hljs-string"><span class="hljs-string">'csrf_enabled'</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> super(SearchForm, self).__init__(*args, **kwargs)</code> </pre> <br><p>  <code>q</code>    ,      ,     .         .  ,    ,   ,    Enter    ,    .      <code>__init__</code> ,      <code>formdata</code>  <code>csrf_enabled</code> ,     .  <code>formdata</code> ,  Flask-WTF  .    <code>request.form</code> ,  Flask   ,     <code>POST</code> . ,    <code>GET</code> ,      ,     Flask-WTF  <code>request.args</code> ,  Flask    . ,   ,   CSRF-  ,    CSRF,       <code>form.hidden_tag()</code>  .       CSRF-  ,    <code>csrf_enabled</code>  <code>False</code> ,   Flask-WTF ,      CSRF   . </p><br><p>   ,        ,      <code>SearchForm</code>   ,   .     ,     ,           .  ,        ( <em>route</em> ),       ( <em>templates</em> ),      ,    ,        .     <code>before_request</code> ,   <a href="https://habrahabr.ru/post/346348/"> 6</a> ,        . ,    ,         ,   : </p><br><blockquote> <em>app/main/routes.py</em> :     before_request handler. </blockquote><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flask <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> g <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> app.main.forms <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> SearchForm @bp.before_app_request def before_request(): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">current_user</span></span>.is_authenticated: <span class="hljs-built_in"><span class="hljs-built_in">current_user</span></span>.last_seen = datetime.utcnow() db.<span class="hljs-keyword"><span class="hljs-keyword">session</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">commit</span></span>() g.search_form = SearchForm() g.locale = str(get_locale())</code> </pre> <br><p>         ,      . , ,  ,        ,        ,    -  .  -   <code>g</code> ,  Flask.  <code>g</code> ,  Flask,  ,     ,         .     <code>g.search_form</code> , ,    before   Flask   ,    URL,  <code>g</code>   ,      ,   .  ,    <code>g</code>       , ,    -       ,       <code>g</code>         ,   ,     ,   . </p><br><p>   ‚Äî    .   ,        ,        .     ,        ,    <code>g</code> ,                 <code>render_template()</code>  .         : </p><br><blockquote> <em>app/templates/base.html</em> :      . </blockquote><br><pre> <code class="hljs django"><span class="xml"><span class="xml"> ... </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"collapse navbar-collapse"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"bs-example-navbar-collapse-1"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"nav navbar-nav"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ... home and explore links ... </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">if</span></span></span></span></span><span class="hljs-template-tag"> g.search_form %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">form</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"navbar-form navbar-left"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"get"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ url_for('main.search') }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"form-group"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ g.search_form.q(size=20, class='form-control', placeholder=g.search_form.q.label.text) }}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">form</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endif</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> ...</span></span></code> </pre> <br><p>      ,   <code>g.search_form</code> .   ,    ,    ,    .      ,    .     <code>method</code>  <code>get</code> ,    ,           <code>GET</code> .  ,       <code>action</code> empty,         ,   .    ,       ,     ,   ,    ,     . </p><br><h2 id="funkciya-poiska-v-rezhime-prosmotra">      </h2><br><p>       -  ,     .  view ‚Äî      <em>/search</em> ,          <em><a href="http://localhost:5000/search%3Fq%3Dsearch-words">http://localhost:5000/search?q=search-words</a></em> ,   Google. </p><br><blockquote> <em>app/main/routes.py</em> : Search view function. </blockquote><br><pre> <code class="hljs pgsql">@bp.route(<span class="hljs-string"><span class="hljs-string">'/search'</span></span>) @login_required def <span class="hljs-keyword"><span class="hljs-keyword">search</span></span>(): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> g.search_form.<span class="hljs-keyword"><span class="hljs-keyword">validate</span></span>(): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> redirect(url_for(<span class="hljs-string"><span class="hljs-string">'main.explore'</span></span>)) page = request.args.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-string"><span class="hljs-string">'page'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>=<span class="hljs-type"><span class="hljs-type">int</span></span>) posts, total = Post.<span class="hljs-keyword"><span class="hljs-keyword">search</span></span>(g.search_form.q.data, page, current_app.config[<span class="hljs-string"><span class="hljs-string">'POSTS_PER_PAGE'</span></span>]) next_url = url_for(<span class="hljs-string"><span class="hljs-string">'main.search'</span></span>, q=g.search_form.q.data, page=page + <span class="hljs-number"><span class="hljs-number">1</span></span>) \ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> total &gt; page * current_app.config[<span class="hljs-string"><span class="hljs-string">'POSTS_PER_PAGE'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> prev_url = url_for(<span class="hljs-string"><span class="hljs-string">'main.search'</span></span>, q=g.search_form.q.data, page=page - <span class="hljs-number"><span class="hljs-number">1</span></span>) \ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> page &gt; <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> render_template(<span class="hljs-string"><span class="hljs-string">'search.html'</span></span>, title=_(<span class="hljs-string"><span class="hljs-string">'Search'</span></span>), posts=posts, next_url=next_url, prev_url=prev_url)</code> </pre> <br><p>  ,        <code>form.validate_on_submit()</code> ,  ,     .  ,      ,    <code>POST</code> ,        <code>form.validate()</code> ,     ,  ,    .    ,    ,      ,          ,       . </p><br><p>  <code>Post.search()</code>    <code>SearchableMixin</code>      .            ,            <code>Pagination</code>  Flask-SQLAlchemy.      ,       <code>Post.search()</code> . </p><br><p>  ,          , ,  -      .        <em>index.html</em>     ,  ,    ,     <em>search.html</em> ,      ,  <em>_post.html</em> sub-    : </p><br><blockquote> <em>app/templates/search.html</em> :   . </blockquote><br><pre> <code class="hljs django"><span class="xml"></span><span class="hljs-template-tag"><span class="xml"></span><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">extends</span></span></span></span></span><span class="hljs-template-tag"> "base.html" %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">block</span></span></span></span></span><span class="hljs-template-tag"> app_content %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ _('Search Results') }}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">for</span></span></span></span></span><span class="hljs-template-tag"> post </span><span class="hljs-keyword"><span class="hljs-template-tag"><span class="hljs-keyword">in</span></span></span><span class="hljs-template-tag"> posts %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">include</span></span></span></span></span><span class="hljs-template-tag"> '_post.html' %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endfor</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">nav</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">aria-label</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"..."</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"pager"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"previous</span></span></span></span></span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">if</span></span></span></span></span><span class="hljs-template-tag"> not prev_url %}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string"> disabled</span></span></span></span></span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endif</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ prev_url or '#' }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">aria-hidden</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">&amp;larr;</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ _('Previous results') }}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"next</span></span></span></span></span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">if</span></span></span></span></span><span class="hljs-template-tag"> not next_url %}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string"> disabled</span></span></span></span></span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endif</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ next_url or '#' }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ _('Next results') }}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">aria-hidden</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">&amp;rarr;</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">nav</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endblock</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"></span><span class="xml"></span></code> </pre> <br><p>         .     Bootstrap  <a href="https://getbootstrap.com/docs/3.3/components/">   </a> . </p><br><p><img src="https://habrastorage.org/webt/oc/2r/ky/oc2rkyqvlza5wtkc0d92ynluf3g.png"></p><br><p>   ?      ,      .           .         ,          Elasticsearch, ,    ,       <em>app/search.py</em> .        ,   ,           ,     ,     <code>SearchableMixin</code> ,  <code>__searchable__</code>          SQLAlchemy.  ,     ,          . </p><br><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://habrahabr.ru/post/351218/">There</a> <img src="https://habrastorage.org/webt/rw/dy/-g/rwdy-grsvbpcetjttrmecdkxtlk.png"></p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/351900/">https://habr.com/ru/post/351900/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../351888/index.html">Espresso: ‚ÄúCute little animals or dangerous predators?‚Äù</a></li>
<li><a href="../351890/index.html">REST API Best Practices</a></li>
<li><a href="../351894/index.html">Spread S3 Buckets across different pools in Ceph Luminous</a></li>
<li><a href="../351896/index.html">Issue # 15: IT training - current issues and challenges from leading companies</a></li>
<li><a href="../351898/index.html">Hackathon and game jam in Yekaterinburg</a></li>
<li><a href="../351904/index.html">Simple authentication on NGINX using LUA</a></li>
<li><a href="../351906/index.html">JavaScript compiler using ANTLR</a></li>
<li><a href="../351908/index.html">Cisco ASA: Patched Firewall Critical Vulnerability</a></li>
<li><a href="../351910/index.html">Monster of advanced threats and targeted attacks.</a></li>
<li><a href="../351912/index.html">Gartner Data & Analytics Summit 2018</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>