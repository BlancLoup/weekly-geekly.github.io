<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to wake up an application in iOS: on schedule and not</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Push notifications are a good way to interact with users, get them involved and return to applications (who hasn't woken up at night from a not receiv...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to wake up an application in iOS: on schedule and not</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/762/7ed/6fe/7627ed6fede049cb981ef2532166f8ee.jpg" align="left" width="256">  Push notifications are a good way to interact with users, get them involved and return to applications (who hasn't woken up at night from a not received message at the wrong time?).  However, there is one more interesting function in push, which not everyone knows about. <br><br>  Imagine that your messenger, so loved by the user, goes into the background and ‚Äúfalls asleep‚Äù there.  How can he take a call while not connected to the server?  The answer lies precisely in the push - the message ‚Äúwakes up‚Äù the application, it goes into active mode and can already take a call. <br><a name="habracut"></a><br>  In iOS, there are several ways to awaken an application and give it control over what is happening. <br><br>  There is <b>UILocalNotification</b> - pending notifications tied to a specific point in the future.  Since we do not know when the call will come, it is impossible to work with <b>UILocalNotification</b> for organizing newsgroups. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      There is a background <b>fetch</b> in the background, described by <b>UIBackgroudnModes</b> .  It is also tied to time and can wake up an application to download and update data at the right time.  Since we cannot specify the exact time of the call, the background wake-up cannot work with calls either. <br><br>  You can wake the application by remote notifications.  If you make your project, this option is enabled in the ‚ÄúCapabilities‚Äù tab of the project in Xcode, there is a section ‚ÄúBackground Modes‚Äù and the option ‚ÄúRemote notifications‚Äù (you can also enable the <b>UIBackgroundModes</b> key with the value ‚Äúremote-notification‚Äù in <b>Info.plist</b> ) . <br><br><img src="https://habrastorage.org/files/607/4ac/54f/6074ac54f6d2424a858bdeb154b76d7a.png"><br><br>  In the notification itself, you need to make the content-available key with a value of 1: <br><br><pre><code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"aps"</span></span> : { <span class="hljs-attr"><span class="hljs-attr">"content-available"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"content-id"</span></span> : <span class="hljs-number"><span class="hljs-number">42</span></span> }</code> </pre> <br>  only then will the application wake up (or start) and call the <b>application: didReceiveRemoteNotification: fetchCompletionHandler method</b> .  Just in it you can already implement the necessary functionality. <br><br><pre> <code class="hljs objectivec">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) application:(<span class="hljs-built_in"><span class="hljs-built_in">UIApplication</span></span> *)application didReceiveRemoteNotification:(<span class="hljs-built_in"><span class="hljs-built_in">NSDictionary</span></span> *)userInfo fetchCompletionHandler:(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span> (^)(<span class="hljs-built_in"><span class="hljs-built_in">UIBackgroundFetchResult</span></span>))completionHandler { <span class="hljs-built_in"><span class="hljs-built_in">NSLog</span></span>(<span class="hljs-string"><span class="hljs-string">@"Remote Notification userInfo is %@"</span></span>, userInfo); <span class="hljs-built_in"><span class="hljs-built_in">NSNumber</span></span> *contentID = userInfo[<span class="hljs-string"><span class="hljs-string">@"content-id"</span></span>]; <span class="hljs-comment"><span class="hljs-comment">// Do something with the content ID completionHandler(UIBackgroundFetchResultNewData); }</span></span></code> </pre><br>  In this handler, you can download the necessary content, connect to the server and, for example, check for calls (for working with push, I recommend the article ‚ÄúNotifications in iOS 10‚Äù from e-Legion, which discusses the issues in more detail). <br><br>  Apple for VoIP applications recommends waking up just through <b>UIBackgroundModes</b> , but, of course, not by time, but by listening to incoming traffic.  The messenger in the background monitors a specific socket and when traffic appears in it, it calls the handler that starts the necessary procedures. <br><br>  Voximplant pushes for iOS are based on the VoIP version.  To work you need: <br><br>  1. Subscribe to notifications when the application starts: <br><br><pre> <code class="hljs objectivec">PKPushRegistry *voipRegistry = [[PKPushRegistry alloc] initWithQueue:dispatch_get_main_queue()]; voipRegistry.delegate = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>; voipRegistry.desiredPushTypes = [<span class="hljs-built_in"><span class="hljs-built_in">NSSet</span></span> setWithObject:PKPushTypeVoIP];</code> </pre><br>  2. Process incoming messages and transfer the incoming token to the SDK: <br><br><pre> <code class="hljs pgsql">- (<span class="hljs-type"><span class="hljs-type">void</span></span>)pushRegistry:(PKPushRegistry *)registry didUpdatePushCredentials:(PKPushCredentials *)credentials forType:(PKPushType)<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> { // <span class="hljs-string"><span class="hljs-string">'self.sdk'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> an instance <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> the <span class="hljs-string"><span class="hljs-string">'VoxImplantSDK'</span></span> [self.sdk registerPushNotificationsToken:credentials.token]; }</code> </pre><br>  3. After receiving the push, if the application is not connected to the Voximplant cloud, you need to reconnect and receive an incoming call: <br><br><pre> <code class="hljs pgsql">- (<span class="hljs-type"><span class="hljs-type">void</span></span>)pushRegistry:(PKPushRegistry *)registry didReceiveIncomingPushWithPayload:(PKPushPayload *)payload forType:(PKPushType)<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> { NSDictionary* custom = [[payload.dictionaryPayload objectForKey:@"aps"] objectForKey:@"voximplant"]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (custom) { // This <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> notifies Voximplant cloud that notification <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> successfully received. [self.sdk handlePushNotification:payload.dictionaryPayload]; } }</code> </pre><br>  Pushi is a powerful tool for remote communication with the application, and not just a tool for showing the user information that outsiders have plundered his farm.  This is the ability to receive information in the background, "enable" the application by call, update user data.  Ultimately, all this is the means of convenient work and user involvement in the work of the application. <br><br>  <font color="gray"><i>Illustration to Kata: <a href="https://www.davidrevoy.com/">www.davidrevoy.com</a></i></font> </div><p>Source: <a href="https://habr.com/ru/post/323976/">https://habr.com/ru/post/323976/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../323962/index.html">Automating the desktop GUI in Python + pywinauto: how to make friends with MS UI Automation</a></li>
<li><a href="../323964/index.html">TargetSummit 2017: Prisma, AppsFlyer, Aviasales, KAYAK and 30 more speakers will speak in Moscow on March 29</a></li>
<li><a href="../323966/index.html">Configuring code style in Visual Studio 2017</a></li>
<li><a href="../323972/index.html">What was accepted in C ++ 17 is a photograph of Bjarne Straustrup and a survey for C ++ 20</a></li>
<li><a href="../323974/index.html">Want to know everything about web and mobile development? Ask me how: DevCon School IV</a></li>
<li><a href="../323978/index.html">Intel and Google - we are friends "clouds"</a></li>
<li><a href="../323980/index.html">Cloud Digest: 35 materials on information security and data center technology development</a></li>
<li><a href="../323982/index.html">How to extend the functionality of an application hosted on the Mac Store using Apple Script</a></li>
<li><a href="../323984/index.html">Two DHCP servers on Centos7 with failover, dhcp-relay and dynamic zone update</a></li>
<li><a href="../323986/index.html">Conference Axis Tel Aviv 2017, Israel (day one)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>