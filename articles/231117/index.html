<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Making a beautiful Progress Bar in an iOS application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good afternoon, dear Habrahabr! 

 In this article I want to describe the way with which we made such a beautiful custom progress bar - in the illustr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Making a beautiful Progress Bar in an iOS application</h1><div class="post__text post__text-html js-mediator-article"><img align="right" src="https://habrastorage.org/getpro/habr/post_images/0c9/236/c56/0c9236c56aaaf0c2c66f23c1d580c82e.png">  Good afternoon, dear Habrahabr! <br><br>  In this article I want to describe the way with which we made such a beautiful custom progress bar - in the illustration - in one of the latest projects. <br><br>  The task was set as follows: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  Pictures were drawn by the designer. </li><li>  The progress bar should block and block the entire UI. </li><li>  The element must be invoked by a notification in the NSNotificationCenter. </li><li>  It must be possible to complete the action of the element ahead of time. </li><li>  Progress bar should be one, regardless of the number of sent notifications. </li></ul><br>  Interested in the implementation of asking under the cat. <br><a name="habracut"></a><br>  First of all, create a BSBeautifulProgressBarManager singleton and set it up in <i>BSBeautifulProgressBarManager.h</i> : <br><br><div class="spoiler">  <b class="spoiler_title">Push me!</b> <div class="spoiler_text"><pre><code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><span class="hljs-meta"> #define kShouldShowBeautifulProgressBar @</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"kShouldShowBeautifulProgressBar"</span></span></span><span class="hljs-meta"> #define kShouldHideBeautifulProgressBar @</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"kShouldHideBeautifulProgressBar"</span></span></span><span class="hljs-meta"> #define beautifulProgressBarManager [BSBeautifulProgressBarManager sharedManager] @interface BSBeautifulProgressBarManager : NSObject + (BSBeautifulProgressBarManager *)sharedManager; @end</span></span></code> </pre> </div></div><br>  At work, we often use the define trick to get rid of the constant appeal to singletons by class name.  Here, instead of [BSBeautifulProgressBarManager sharedManager], we can write just BSBeautifulProgressBarManager.  We will not touch the header file anymore. <br><br>  Defaults of notifications, we usually place in some Config.h - then you do not need to import the manager's header to send notifications.  However, in this example, we will add a trick with getting rid of magic constants directly into the singleton header. <br><br>  Referring to the implementation of a singleton in the <i>BSBeautifulProgressBarManager.m</i> file: <br><br><div class="spoiler">  <b class="spoiler_title">Push me!</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">+ (BSBeautifulProgressBarManager *)sharedManager { <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> BSBeautifulProgressBarManager *sharedManager = <span class="hljs-literal"><span class="hljs-literal">nil</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-built_in"><span class="hljs-built_in">dispatch_once_t</span></span> onceToken; <span class="hljs-built_in"><span class="hljs-built_in">dispatch_once</span></span>(&amp;onceToken, ^{ sharedManager = [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> new]; [[<span class="hljs-built_in"><span class="hljs-built_in">NSNotificationCenter</span></span> defaultCenter] addObserver:sharedManager selector:<span class="hljs-keyword"><span class="hljs-keyword">@selector</span></span>(showProgressBar) name:kShouldShowBeautifulProgressBar object:<span class="hljs-literal"><span class="hljs-literal">nil</span></span>]; [[<span class="hljs-built_in"><span class="hljs-built_in">NSNotificationCenter</span></span> defaultCenter] addObserver:sharedManager selector:<span class="hljs-keyword"><span class="hljs-keyword">@selector</span></span>(hideProgressBar) name:kShouldHideBeautifulProgressBar object:<span class="hljs-literal"><span class="hljs-literal">nil</span></span>]; }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sharedManager; }</code> </pre></div></div><br>  Nothing much has happened yet - the usual implementation of thread-safe singleton.  The only remarkable thing in this method is the subscription to the progress bar'a show / hide notifications at the NSNotificationCenter. <br><br>  Let's proceed to the implementation of the showProgressBar and hideProgressBar methods: <br><br><div class="spoiler">  <b class="spoiler_title">Push me!</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)showProgressBar { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isShown) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; isShown = <span class="hljs-literal"><span class="hljs-literal">YES</span></span>; } - (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)hideProgressBar { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!isShown) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; isShown = <span class="hljs-literal"><span class="hljs-literal">NO</span></span>; }</code> </pre></div></div><br>  So far, they do nothing.  However, we have already fulfilled two working conditions for the element: the progress bar will be only one, and it will be called via the NSNotificationCenter.  Accordingly, we will add a private variable to the implementation: <br><br><div class="spoiler">  <b class="spoiler_title">Push me!</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@implementation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BSBeautifulProgressBarManager</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">BOOL</span></span> isShown; }</code> </pre></div></div><br>  Our idea will be this: <br><br><ul><li>  The first layer will be a translucent black UIView, which we will impose on the UIWindow.  So we will block the entire UI that is.  Leave a link to this UIView, then remove it by necessity. </li><li>  On top of it, add a white UIView, which will serve as the main upper band.  Also save the link - we will need to beautifully remove this UIView as needed. </li><li>  Add a static picture of gray lightning to a white UIView. </li><li>  Add a picture of orange lightning to a white UIView.  We set the width to 0, with the help of the animation block we will expand this picture to natural sizes.  In this way we will achieve a beautiful visual effect. </li></ul><br>  Let's start the implementation!  First, change the showProgressBar method: <br><br><div class="spoiler">  <b class="spoiler_title">Push me!</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)showProgressBar { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isShown) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; isShown = <span class="hljs-literal"><span class="hljs-literal">YES</span></span>; [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> addGreyView]; [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> addWhiteView]; [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> addGreyZip]; [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> addOrangeZip]; }</code> </pre></div></div><br>  Everything goes according to plan - we encapsulated the functionality of adding elements to separate methods.  Let's go through these methods, I will give the comments below: <br><br><div class="spoiler">  <b class="spoiler_title">Push me!</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@implementation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BSBeautifulProgressBarManager</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">BOOL</span></span> isShown; <span class="hljs-comment"><span class="hljs-comment">// 1 UIView *mainView; UIView *whiteView; } &lt;...&gt; - (void)addGreyView { // 2 UIWindow *window = [[[UIApplication sharedApplication] windows] lastObject]; mainView = [[UIView alloc] initWithFrame:window.bounds]; mainView.backgroundColor = [UIColor colorWithWhite:0.0 alpha:0.5]; mainView.alpha = 0.0; [window addSubview:mainView]; // 3 [UIView animateWithDuration:0.3 animations:^{ mainView.alpha = 1.0; }]; } - (void)addWhiteView { // 4 whiteView = [[UIView alloc] initWithFrame:CGRectMake(0, -64, 320, 64)]; whiteView.backgroundColor = [UIColor whiteColor]; [mainView addSubview:whiteView]; // 5 [UIView animateWithDuration:0.3 animations:^{ CGRect frame = whiteView.frame; frame.origin.y = 0; whiteView.frame = frame; }]; } - (void)addGreyZip { // 6 CGRect frame = CGRectMake(0, 39, 320, 14.5); UIImageView *greyImageView = [[UIImageView alloc] initWithFrame:frame]; greyImageView.image = [UIImage imageNamed:@"grey"]; [whiteView addSubview:greyImageView]; } - (void)addOrangeZip { // 7 CGRect frame = CGRectMake(0, 0, 320, 14.5); CGRect frameSmaller = CGRectMake(1, 39, 0, 14.5); // 8 UIView *container = [[UIView alloc] initWithFrame:frameSmaller]; container.clipsToBounds = YES; // 9 UIImageView *redImageView = [[UIImageView alloc] initWithFrame:frame]; redImageView.image = [UIImage imageNamed:@"red"]; [container addSubview:redImageView]; // 10 [whiteView addSubview:container]; // 11 [UIView animateWithDuration:15. animations:^{ CGRect frame = container.frame; frame.size.width = 320; container.frame = frame; }]; }</span></span></code> </pre></div></div><br>  Let's go in order: <br><br><ol><li>  Add links to the background (mainView) and to the white view (whiteView).  We will need to show and hide the background (fade-in and fade-out), and the white view must first be beautifully lowered and then beautifully raised. </li><li>  Create our background, which will be the main superview of the element, make it black, semi-transparent, and put it on the application window in order to block the entire UI. </li><li>  We make fade-in for our background, and with it and for all its descendants - the rest of the element. </li><li>  Create our white view background for the remaining elements, put it on the main view, hide it behind the upper edges of the ancestor. </li><li>  Beautifully, animatedly lowering the white view with all descendants down.  By the way, descendants will be lightning. </li><li>  Add a static picture of a gray lightning on a white view - nothing complicated. </li><li>  Orange lightning is harder.  We create two views - a UIView container and a UIImageView lightning.  The idea is this: add a UIImageView inside the view with a width of 0 and animate the container to the desired size.  We get a certain effect of orange lightning ‚Äúgrowing‚Äù to the right.  To do this, we prepare two frames: for the picture (frame) and container (frameSmaller). </li><li>  We create a container and make it so that its descendants do not go beyond. </li><li>  Add a picture of an orange lightning into a container - nothing supernatural. </li><li>  Add our container to the white view. </li><li>  We animate the container extension. </li></ol><br>  Wonderful!  Now we can show the progress bar when needed.  Let us turn to the implementation of the methods of hiding the progress bar: <br><br><div class="spoiler">  <b class="spoiler_title">Push me!</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)hideProgressBar { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!isShown) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; isShown = <span class="hljs-literal"><span class="hljs-literal">NO</span></span>; [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> hideGreyView]; [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> hideWhiteView]; [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> finish]; }</code> </pre></div></div><br>  The idea is simple: we hide the main view (black-translucent or, simply, gray), at this time we remove the white view with all its insides, and even orange lightning is brought to the end instantly - because if it is not expanded to the end, it means bring to show the user, they say, the action is completed. <br><br>  We proceed to the implementation, comments below: <br><br><div class="spoiler">  <b class="spoiler_title">Push me!</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)hideGreyView { <span class="hljs-comment"><span class="hljs-comment">// 1 [UIView animateWithDuration:0.3 animations:^{ mainView.alpha = 0.0; } completion:^(BOOL finished){ [mainView removeFromSuperview]; }]; } - (void)hideWhiteView { // 2 [UIView animateWithDuration:0.3 animations:^{ CGRect frame = whiteView.frame; frame.origin.y = -64; whiteView.frame = frame; }]; } - (void)finish { // 3 CGRect frame = CGRectMake(0, 39, 320, 14.5); UIImageView *greyImageView = [[UIImageView alloc] initWithFrame:frame]; greyImageView.backgroundColor = [UIColor whiteColor]; greyImageView.image = [UIImage imageNamed:@"grey"]; [whiteView addSubview:greyImageView]; // 4 frame = CGRectMake(1, 39, 320, 14.5); UIImageView *redImageView = [[UIImageView alloc] initWithFrame:frame]; redImageView.image = [UIImage imageNamed:@"red"]; [whiteView addSubview:redImageView]; }</span></span></code> </pre></div></div><br>  It's simple: <br><br><ol><li>  Make a fade-out with the removal from the ancestor for the main view and all its viscera, respectively. </li><li>  We remove up the white view with all the entrails </li><li>  The most cruel and ‚Äúvlob‚Äù method - we put a new gray zipper on top </li><li>  Put a new orange zipper on top - it will create the feeling that the zipper hidden from below has disappeared </li></ol><br>  By the way, here are the pictures you need: <br><br><div class="spoiler">  <b class="spoiler_title">Push me!</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/757/bca/601/757bca60121f40c42312f8da45377b08.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/597/84d/405/59784d405a8d6dbb1a86520ffaad3831.png"><br></div></div><br>  That's all!  You have learned a piece of real, working social network.  In fact, they plunged into the code from the production.  We can call a custom, beautiful progress bar by sending the necessary notifications. <br><br><h4>  Conclusion </h4><br>  Thank you for reading to the end!  I will be happy to answer any questions you may have.  If you have found any typos or inaccuracies, feel free to write to my Habracecenter! <br><br>  Be sure to write what you want to see in the next article. </div><p>Source: <a href="https://habr.com/ru/post/231117/">https://habr.com/ru/post/231117/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../231101/index.html">Asterisk-Butler or epic Intercom connection with Pascal-1510 board, SPA112 gateway and PBX Elastix</a></li>
<li><a href="../231103/index.html">We remind everyone in the office to congratulate the Sysadmin</a></li>
<li><a href="../231107/index.html">A lot of anonymity does not happen - we hide User-Agent</a></li>
<li><a href="../231111/index.html">That's what people are greedy for, or another remark about 44 50 49</a></li>
<li><a href="../231113/index.html">Home-made bike computer, or how the Arduino hit the street</a></li>
<li><a href="../231119/index.html">Managing the list of 1C 8.2 databases using Active Directory</a></li>
<li><a href="../231125/index.html">We do not give bandla spoil your life</a></li>
<li><a href="../231127/index.html">OnePlus One - first among the best</a></li>
<li><a href="../231129/index.html">THL T11 - a budget version of the famous flagship T100S</a></li>
<li><a href="../231131/index.html">How we integrated Backup-as-a-Service with Parallels Automation using the APS 2.0 standard</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>