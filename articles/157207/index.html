<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ping-flooding attack using WinPcap</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ICMP protocol 

 ICMP is one of the components of the TCP / IP Transmission Control Protocol / Internet Protocol (Internet Transmission Control Protoc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ping-flooding attack using WinPcap</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/613/8b2/648/6138b264876e76799c9471decb96c15f.png"><br><a name="habracut"></a><br><h1>  ICMP protocol </h1><br><br>  ICMP is one of the components of the TCP / IP Transmission Control Protocol / Internet Protocol (Internet Transmission Control Protocol / Internet Protocol) that compensates for the inability of the IP protocol to deliver data guaranteed.  However, ICMP does not eliminate the unreliability of data transmission by IP.  It only notifies the sender of the data that there were problems with their delivery. <br><br>  The figure shows the place of the ICMP protocol in the TCP / IP model. <br><img src="https://habrastorage.org/storage2/09a/779/ddd/09a779ddddf31e1e100cc4e5d488083b.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      ICMP is the IP error reporting mechanism. <br>  If an error occurs while delivering a datagram, the ICMP protocol informs the sender of the datagram.  For example, suppose PC1, shown in the following figure, sends datagram PC4.  If the corresponding router interface fails, this router uses ICMP to send PC1 a message that the delivery of the datagram was not possible.  ICMP does not fix a network problem. <br><img src="https://habrastorage.org/storage2/5c0/820/820/5c0820820dc1c518531f34d10a2e5157.png"><br><br>  ICMP messages are delivered using IP. <br>  ICMP messages are encapsulated in datagrams, just like regular data delivered via IP.  The table shows the ICMP packet encapsulation in the data field of an IP datagram.  The frame header can be configured using a local network protocol, such as Ethernet, or a distributed network protocol, such as HDLC, for example. <br><br><br>  <b>Frame</b> Header IP Datagram Header ICMP protocol header ICMP protocol data <br>  <b>Frame</b> Header IP Datagram Header IP Datagram Data Field <br>  <b>Frame Header</b> IP Datagram Data Field <br>  <b>Frame Header Frame</b> Data Field <br><br><br>  When data arrives at the network layer, it is encapsulated into a datagram.  After this, the datagram and the data encapsulated in it are again encapsulated into a frame at the channel level.  ICMP messages contain their own information in the headers.  However, this information, along with ICMP data, is encapsulated into a datagram and transmitted in the same way as all other data.  Therefore, error messages are also at risk of being lost during transmission.  Thus, a situation may arise in which the error messages themselves may create new errors, which will only complicate the situation with a deadlock in an already malfunctioning network.  For this reason, errors created by ICMP messages do not generate their own ICMP messages.  Therefore, it is possible that an error occurs during the delivery of a datagram, but is not reported to the data sender. <br><br><h1>  WinpCap ping and send pings </h1><br>  Everyone knows the ping command, which is designed to send an echo request and receive an echo reply.  We decided that we didn‚Äôt have enough system ping and tried to implement our ping program. <br>  The tool for implementation was the C ++ compiler and the <a href="http://www.winpcap.org/">WinPcap</a> library.  WinPcap - Low-level library for interacting with network interface drivers. <br>  And so we begin assembly of an ICMP packet. <br>  The ICMP package format was successfully taken from the <a href="http://ru.wikipedia.org/wiki/ICMP">Wiki</a> . <br><br><table><tbody><tr><th>  Octet </th><th>  0 </th><th>  one </th><th>  2 </th><th>  3 </th><th>  four </th><th>  five </th><th>  6 </th><th>  7 </th><th>  eight </th><th>  9 </th><th>  ten </th><th>  eleven </th><th>  12 </th><th>  13 </th><th>  14 </th><th>  15 </th><th>  sixteen </th><th>  17 </th><th>  18 </th><th>  nineteen </th><th>  20 </th><th>  21 </th><th>  22 </th><th>  23 </th><th>  24 </th><th>  25 </th><th>  26 </th><th>  27 </th><th>  28 </th><th>  29 </th><th>  thirty </th><th>  31 </th></tr><tr><td>  0‚Äî3 </td><td colspan="8">  Type of </td><td colspan="8">  Code </td><td colspan="16">  <a href="http://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BE%25D0%25BD%25D1%2582%25D1%2580%25D0%25BE%25D0%25BB%25D1%258C%25D0%25BD%25D0%25B0%25D1%258F_%25D1%2581%25D1%2583%25D0%25BC%25D0%25BC%25D0%25B0" title="Check sum">Check sum</a> </td></tr><tr><td>  ... </td><td colspan="32">  Data (format depends on the values ‚Äã‚Äãof the fields "Code" and "Type") </td></tr></tbody></table><br><br><pre><code class="hljs ruby">u_char packet[<span class="hljs-number"><span class="hljs-number">1514</span></span>]; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   /<span class="hljs-regexp"><span class="hljs-regexp">/MAC-  packet[0]=0x08; packet[1]=0x00; packet[2]=0x27; packet[3]=0x4c; packet[4]=0x18; packet[5]=0xDA; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">//</span></span><span class="hljs-regexp"><span class="hljs-regexp">/MAC-  packet[6]=0x08; packet[7]=0x00; packet[8]=0x27; packet[9]=0xca; packet[10]=0xb8; packet[11]=0x44; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ IP- packet[12]=0x08; packet[13]=0x00; packet[14]=0x45; packet[15]=0x00; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  *(WORD *)&amp;packet[16] = htons(1500); packet[18]=0x11; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/id packet[19]=0x22; packet[20]=0; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  packet[21]=0; packet[22]=0x80; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ttl packet[23]=1; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/icmp packet[24]=0; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  packet[25]=0; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  packet[26]=192; packet[27]=168; packet[28]=1; packet[29]=1; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ packet[30]=192; packet[31]=168; packet[32]=1; packet[33]=128; chS=ComputeIPChecksum(&amp;packet[14],20); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   printf("%x\n", chS); *(WORD *)&amp;packet[24] = chS; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/**************************************************** packet[34]=8; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/icmp packet[35]=0; packet[36]=0x29; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/csum packet[37]=0x31; packet[38]=0x11; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/icmp packet[39]=0x11; packet[40]=0x22; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/csum packet[41]=0x22; chS=ComputeIPChecksum(&amp;packet[34],8); printf("%x\n", chS); for(i=42; i&lt;1514; i++) { packet[i]= 'A'; } /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ if (pcap_sendpacket(fp, /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ Adapter packet, /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ buffer with the packet 1514 /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ size ) != 0) { fprintf(stderr,"\nError sending the packet: %s\n", pcap_geterr(fp)); return 3; }</span></span></code> </pre> <br><br>  The results look at the following figure. <br><br><img src="http://habrastorage.org/storage2/b49/85c/701/b4985c7011fc47319fb93dde11c1c790.png"><br><br>  We see the request and response.  All OK. <br>  <b>And what if you put the left MAC address of the sender?</b> <b><br></b>  <b>And what if you put the left IP address of the sender?</b> <b><br></b>  <b>And what if MAC = FF-FF-FF-FF-FF-FF?</b> <br><br>  You can go to the <a href="http://ru.wikipedia.org/wiki/ICMP">wiki</a> and see the following: <br><br>  <em>ICMP packets are never generated in response to IP packets with a broadcast or multicast address, so as not to cause network congestion (the so-called ‚Äúbroadcast storm‚Äù).</em> <br><br>  Let's try to break this rule.  From the machine with IP 192.168.1.2 we will send ping to 192.168.1.3, while the sender's IP will be equal to 192.168.1.1, and the sender's MAC is FF-FF-FF-FF-FF-FF. <br><img src="http://habrastorage.org/storage2/d7e/27e/5a7/d7e27e5a7868ad7fb8635f5e80792ea3.png"><br>  It turned out that we made 192.168.1.3 answer 192.168.1.1, while the latter did not want this.  The most interesting thing is that it was a broadcast ping and it passed! <br><br>  We look that on other machines. <br><img src="http://habrastorage.org/storage2/ee9/74b/c7c/ee974bc7c6ef1b094f7f9b018a6b7627.png"><br><img src="http://habrastorage.org/storage2/638/e69/a24/638e69a2464c69e8096cd25449162904.png"><br>  On other machines, we catch broadcast requests. <br>  And if so, then there is a reason to write in the program while (1) and enjoy the DOS-attack. <br><br>  <b>Bibliography:</b> <br><br>  Odom W. - CISCO Official Guide to Preparing for Certification Exams CCENTCCNA ICND1 - 2010 <br>  <a href="http://ru.wikipedia.org/">ru.wikipedia.org</a> </div><p>Source: <a href="https://habr.com/ru/post/157207/">https://habr.com/ru/post/157207/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../157193/index.html">Independent developer makes a remake of Descent</a></li>
<li><a href="../157197/index.html">Simple automation of versioning and building a C / C ++ project in Ruby</a></li>
<li><a href="../157199/index.html">PDF generation on the server in Ruby</a></li>
<li><a href="../157203/index.html">The digest of interesting news and materials from the world of PHP over the past two weeks, number 3 (10/20/2012 - 11/02/2012)</a></li>
<li><a href="../157205/index.html">The effectiveness of automatic application testing</a></li>
<li><a href="../157211/index.html">Indication of the subscriber's status in the queue on the phone with BLF buttons</a></li>
<li><a href="../157217/index.html">The digest of interesting news and materials from the world of ayti for the last week ‚Ññ29 (October 27 - November 2, 2012)</a></li>
<li><a href="../157219/index.html">Nokia Lumia 920 and Nokia Lumia 820 went on sale</a></li>
<li><a href="../157221/index.html">IOS 6.0.1 released</a></li>
<li><a href="../157223/index.html">Apple has printed an apology newspaper to Samsung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>