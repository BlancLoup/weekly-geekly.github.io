<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Veeam Backup & Replication: Useful Tips for Keeping Backups and Replicas Viable</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today, again, I am pleased to present you with useful tips from my colleague Yevgeny Ivanov, Team Lead of the Veeam technical support team. This time,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Veeam Backup & Replication: Useful Tips for Keeping Backups and Replicas Viable</h1><div class="post__text post__text-html js-mediator-article">  Today, again, I am pleased to present you with useful tips from my colleague Yevgeny Ivanov, Team Lead of the Veeam technical support team.  This time, Zhenya shared recommendations for working with backups and replicas.  I hope they will help you avoid common mistakes, and your replicas and backups will never be the ‚Äúweak link‚Äù in the recovery process, if needed. <br><br>  So, welcome under cat. <br><br><img src="https://habrastorage.org/webt/n2/lg/ct/n2lgctuzddu-htv1gqmsy-f8jx4.png"><br><a name="habracut"></a><br>  In my previous <a href="https://habr.com/ru/company/veeam/blog/428069/">article,</a> we figured out how to optimize the load on the components of the backup infrastructure, and looked at typical configuration errors.  We turn to another important topic - the proper preparation and implementation of recovery.  We will also analyze it with real examples with which the technical support team has worked. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  Backup without restaura - money to the wind </h1><br>  We are regularly approached by users who find themselves in similar difficult situations: you need to perform a recovery from the backup, but when you try to do this, people stumble upon an unsolvable problem for them.  And this problem is not a lack of backup, CryptoLocker activity or something like that.  This is ‚Äúonly‚Äù insufficient attention to checking backups and replicas for recoverability.  Many people often focus solely on the process of creating a backup, forgetting that simply having a backup copy is not a panacea for possible troubles.  It is necessary to understand that recovery is a completely different process, which has its own characteristics, and which must be controlled and tested before launching in production.  Here are some illustrative examples: <br><br><ol><li>  The user has a failure in the operation of a critical virtual machine with a size of 20 TB.  Downtime, of course, is unacceptable, and the admin starts the instant recovery process (VM instant recovery) - after 5 minutes the machine is raised.  But we remember that such a state of the machine can be involved only temporarily - it must be migrated to the production datastore.  And in this example, as it turned out, the infrastructure capabilities did not allow copying 20 TB of data in a reasonable time.  In the settings of the instant recovery process, it was chosen to save the changes to the <i>C</i> drive <i>:</i> Veeam Backup &amp; Replication server (as opposed to vSphere) - as a result, of course, the free disk space was quickly filled.  By the time the user turned in support, the VM had changes that could not be ignored.  That is, we have a situation when it is impossible to quickly finalize the process of instant recovery of a critical machine - how can we save the data <br><br>  Frankly, I don‚Äôt remember all the details of the final, but I remember that in the end we didn‚Äôt think of anything brilliant.  Clients on their side somehow solved this problem by expanding the C drive: from the reserves, copied the most important files and then turned off the VM and so migrated.  In general, the miracle did not happen. </li><li>  The user had one domain controller in the infrastructure, and all components of Veeam Backup &amp; Replication were configured using DNS.  Yes, yes, that's right, you heard right.  There were hundreds of options for the development of events, not less, but the reality went like this: people planned maintenance and decided to switch to a replica of their domain controller.  They involved a scheduled switch, which, in general, is recommended to do in such situations.  At the first stage, everything went fine, and at the second stage, the initial VM was turned off for a short time in order to transfer the remaining data.  Of course, the switch task immediately ended with an error, because the DNS has stopped working. <br><br>  Fortunately, here we managed to cope with the situation by turning on the replica manually from the vSphere (in general, this operation is not recommended to be performed independently, as you will see from the following example).  But, as you understand, the maintenance process was interrupted and postponed.  In addition, we had to manually add the host names to the file <i>C: \ Windows \ System32 \ drivers \ etc \ hosts</i> on the Veeam Backup &amp; Replication server to ensure correctness when switching back. </li><li>  At one client, the entire backup infrastructure was built around tape drives, and only short chains of files were stored on the disk.  When they needed to restore a number of files from a large file server, it turned out that no machine could be used as an auxiliary repository when restoring from tape, since none of them had enough free space.  (You can read about recovery from a magnetic tape directly and using an auxiliary repository <a href="https://helpcenter.veeam.com/docs/backup/vsphere/vm_restore_from_tape.html%3Fver%3D95u4">here</a> (for the time being in English)). </li></ol><br>  I think that in all three examples, users, so to speak, were in the grip of illusions - they assumed that if the backup was successful, then there would be no problems with the restoration.  But this, as you understand, is by no means always the case, and therefore it is necessary to prepare for recovery as carefully as for backup.  To get started is to study <a href="https://helpcenter.veeam.com/evaluation/backup/vsphere/ru/data_protection_tasks.html">the user manual</a> , which contains fairly detailed information on different types of recovery.  At the beginning of each paragraph lists the requirements, preparatory actions and possible limitations.  The description of recovery from magnetic tapes or from hardware storage images can be found in the documentation sections and in our <a href="https://habr.com/ru/company/veeam/blog/443716/">articles</a> on Habr√©.  In addition, steps to prepare the restoration of application objects using the tools of Veeam Explorers are described in the ‚ÄúPlanning and preparation‚Äù section of the planning <a href="https://helpcenter.veeam.com/docs/backup/explorers/veo_prerequisites.html%3Fver%3D95u4">guide</a> for each of the tools.  I recommend that you read them carefully - this will help you properly prepare the system for recovery if necessary.  In Russian, instructions for recovering a SQL Server database are provided <a href="https://helpcenter.veeam.com/evaluation/backup/vsphere/ru/sql_backup_and_restore.html">here</a> . <br><br><h1>  Why not work with replicas from the vSphere console? </h1><br>  The idea is that Veeam replicas are ordinary virtual machines that it would seem logical to work with using the vSphere toolkit, in particular, the vSphere client.  However, we do not recommend doing this, and here's why: switching to a replica in Veeam Backup &amp; Replication is a rather complicated process that requires strictly sequential steps (so that if something happens, you can roll back a step) and correct final actions - just look at picture illustrating the process: <br><br><img src="https://habrastorage.org/webt/zd/as/fl/zdasflixvqvvo8s_nd2v1u7druq.png"><br><br>  If you decide to include a replica from the vSphere client, then in the future you will most likely face a number of problems: <br><br><ol><li>  The mechanism for switching to a replica from Veeam Backup &amp; replication (shown in the diagram) will no longer work for this machine. </li><li>  The data in the Veeam Backup database will not correspond to the real state of the VM.  In the worst case, the repair will have to edit the database. </li><li>  Even data loss is possible, as in this example: the user manually included the replica in the vSphere client and decided to continue working with it.  After some time, he noticed that the replica is still displayed in the console Veeam Backup &amp; Replication, and decided to remove it as useless.  I clicked on it with the right button and gave the command <i>‚ÄúDelete from disk‚Äù</i> .  Veeam Backup &amp; Replication immediately deleted the replica from the disk, which, for a minute, was already used as a normal VM and contained the necessary and useful data. </li></ol><br>  Of course, there are situations when you still have to turn on the replica from the vSphere client - as a rule, these are cases when the Veeam server is turned off and the replica needs to be turned on with a delay.  But if everything is in order with the Veeam server, then you need to work with replicas from its console. <br><br>  Also, do not delete replicas using vSphere client.  Veeam Backup &amp; Replication will remain in the dark about such a change, and this is fraught with errors and outdated data.  If you no longer need a replica, delete it using the Veeam console, and not as a VM from the vSphere client.  So you will always have a current list of replicas. <br><br><h1>  "O" - caution, updates! </h1><br>  Here we mean, of course, updates for hypervisors and various applications that are backed up with Veeam.  If you look at them from the point of view of working with Veeam Backup &amp; Replication, the updates can be divided into 2 categories: large, serious, introducing a lot of changes - and small. <br><br>  Consider first the first category. <br><br>  The most important updates are those intended for the hypervisor.  Before you install such an update, you must make sure that it is supported by Veeam Backup &amp; Replication.  Such updates introduce many changes to the libraries and APIs that Veeam Backup &amp; Replication uses, so in order to officially declare their support, you need to update the code of Veeam Backup &amp; Replication and conduct thorough testing. <br><br>  It should also be borne in mind that, for example, VMware does not provide preliminary access to the latest vSphere versions for software manufacturers, so Veeam developers and testers receive a new version simultaneously with the rest of progressive humanity - therefore, between the release of VMware and officially announced support, certain time.  The number and variety of changes necessary for making is such that there is little chance of finding room for their simple hotfix - and official support is usually announced along with the release of the release version of Veeam Backup &amp; Replication. <br><br>  As a result, there is an awkward moment when, after the release of the new version of vSphere, the number of requests for technical support increases dramatically, because users rush headlong to install a new version, and their backups, of course, immediately stop working immediately.  We - technical support Veeam - have to explain to users what exactly they did wrong, ask them to roll back (if possible) or invent intricate ways to break the deadlock.  <b>Therefore, before installing a serious update, be sure to check its compatibility with the software that works for you, I beg you!</b> <br><br>  All of the above applies to applications that you back up and expect to restore using Veeam.  The Veeam Explorers toolbar also has a list of supported versions of the corresponding applications, which is updated with each release of Veeam Backup &amp; Replication.  Therefore, before installing your new version of your application - whether it be Exchange, Oracle or SharePoint - be sure to re-read the relevant section of the <a href="https://helpcenter.veeam.com/docs/backup/explorers/explorers_introduction.html%3Fver%3D95u4">Veeam Explorers documentation</a> . <br><br>  To the second category, i.e.  small updates include, for example, new versions of VMware Tools, cumulative updates from Exchange, vSphere security updates, etc.  As a rule, they do not carry with them any serious modifications, and in most cases Veeam Backup &amp; Replication does not have problems with them.  (Therefore, for them, there are no public announcements of official support in the product.) However, in our practice, there were cases when such updates so significantly changed the usual course of things that led to errors in the work of Veeam Backup &amp; Replication.  In such situations, after confirming the problem, Veeam engineers are trying to quickly release a hotfix. <br><br><div class="spoiler">  <b class="spoiler_title">Those who speak technical English</b> <div class="spoiler_text"> If you want to be aware of what the engineers are working on and what the system architects and technical support specialists are facing, I recommend to subscribe to <a href="https://forums.veeam.com/">our forums</a> .  Every week, for subscribers, the ‚ÄúWord from Gostev‚Äù mailing list is published by <a href="https://habr.com/ru/users/therealgostev/" class="user_link">TheRealGostev</a> .  In it, Anton Gostev, who heads the product management department, talks about the problems found recently (and not only on the Veeam side), plans for new versions and news from the IT world.  If you need more information, you can study the topics of the forum - if someone of your clients has a problem with the product after some update, he most likely has already written about it on the forum. <br></div></div><br>  As you understand, patches and updates can lead to problems not only with backups, but also with the applications for which these backups are made.  And here virtual labs will help you - Veeam DataLabs.  You have probably heard about the functionality of SureBackup, designed for verification of backups.  It is based on the use of DataLabs, with the creation of an isolated environment in which you can, in particular, test updates before installing them in production.  I strongly advise you to do so - save yourself a lot of nerve cells.  And if someone else does not know about SureBackup, I recommend reading the <a href="https://helpcenter.veeam.com/evaluation/backup/vsphere/ru/surebackup.html">documentation</a> . <br><br>  Perhaps today I have everything, thank you for your attention! <br><br><h1>  What else to read </h1><br>  Articles on Habr√©: <br><br><ul><li>  <a href="https://habr.com/ru/company/veeam/blog/193568/">The case of Pixar or again about the importance of testing backups</a> </li><li>  <a href="https://habr.com/ru/company/veeam/blog/170653/">Features long-term backup storage</a> </li><li>  <a href="https://habr.com/ru/company/veeam/blog/176927/">Best Practices for Backup Policy</a> </li><li>  <a href="https://habr.com/ru/company/veeam/blog/163405/">Recommendations for backup and recovery after the End of the World policy</a> </li></ul><br>  <a href="https://helpcenter.veeam.com/evaluation/backup/vsphere/ru/data_protection_tasks.html">User Guide (in Russian)</a> </div><p>Source: <a href="https://habr.com/ru/post/451770/">https://habr.com/ru/post/451770/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../451758/index.html">Additional Uplinks in the Intel C620 system logic architecture</a></li>
<li><a href="../451760/index.html">Using Golang to create microservices in The Economist: a retrospective</a></li>
<li><a href="../451766/index.html">Heisenbug 2019 Piter: what will be in the free broadcast, and that only at the event itself</a></li>
<li><a href="../451768/index.html">Improving the work of Wi-Fi. General principles and useful things</a></li>
<li><a href="../45177/index.html">PayPal in Russian</a></li>
<li><a href="../451772/index.html">What is special about Cloudera and how to cook it</a></li>
<li><a href="../451776/index.html">How I program engines for role-playing games in Google-tables</a></li>
<li><a href="../451778/index.html">Another monitoring system</a></li>
<li><a href="../45178/index.html">Illusion.net</a></li>
<li><a href="../451780/index.html">Audit in 60 minutes - free of charge, we check the resilience of employees to phishing attacks through Sophos Phish Threat</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>