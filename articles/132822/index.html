<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Deploying Kaviza VDI-in-a-Box</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When customers of DEPO Computers are asked to build a solution for desktop virtualization, we often face an understandable, in general, problem: flags...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Deploying Kaviza VDI-in-a-Box</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/106/b59/402/106b5940296886d628b6a8a6b6e3afb5.jpg" align="left">  When customers of <a href="http://www.depocomputers.ru/%3Futm_source%3Dtopic_171111%26utm_medium%3Dupcut%26utm_campaign%3Dhabrahabr">DEPO Computers</a> are asked to build a solution for desktop virtualization, we often face an understandable, in general, problem: flagship products such as Citrix XenDesktop and VMware View are quite expensive for small developing companies with limited IT budgets. <br><br>  But not so long ago, Citrix Systems acquired the company Kaviza, which developed a desktop virtualization solution for small and medium-sized businesses - Kaviza VDI-in-a-Box.  As the name implies, this is a boxed solution, which includes all the necessary tools (a detailed description and comparison with other Citrix products can be found in a recent <a href="http://habrahabr.ru/company/citrix/blog/129828">announcement</a> ). <br><br>  <a href="http://www.depocomputers.ru/%3Futm_source%3Dtopic_171111%26utm_medium%3Dupcut%26utm_campaign%3Dhabrahabr">DEPO Computers</a> has been cooperating with Citrix Systems for a long time and uses its products in its virtualization solutions.  Naturally, we decided to deploy Kaviza on our test site and see how easy it is to work with it in order to offer our clients. <br><a name="habracut"></a><br>  To deploy Kaviza (a trial applains can be downloaded from kaviza.com), you need a XenServer hypervisor or ESXi (already available beta 5 version also supports Hyper-V). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We import the Kaviza_VDI_kMGR_XenServer_v4_1_5.xva applains into the hypervisor. <br><br><img src="https://habrastorage.org/storage1/90e0ab16/f52cc459/ade034c8/f427a94f.jpg"><br><br>  After import, we will have a virtual machine Kaviza_VDI_kMGR_XenServer_v4_1_5.  Make sure that she was automatically assigned an IP address.  If the DHCP server is not configured, register the address manually in the console (login: kvm, password: kaviza123): <br><br><blockquote>  <i>sudo vi / etc / network / interfaces</i> <i><br></i>  <i>auto eth0 iface</i> <i><br></i>  <i>eth0 inet static</i> <i><br></i>  <i>address 10.0.100.33</i> <i><br></i>  <i>netmask 255.0.0.0</i> <i><br></i>  <i>gateway 10.0.0.1</i> <br></blockquote><br><br>  To specify DNS, you need to correct the resolv.conf file: <br><blockquote>  <i>$ sudo vi /etc/resolv.conf</i> </blockquote><br><br>  All Kaviza server configuration operations are performed via a browser: http: // [kMGR address] / admin, where ([kMGR address] IP address of the Kaviza server).  Deploying infrastructure on Kaviza consists of several steps. <br><br><h4>  Step 1. Setting up a Kaviza server </h4><br>  To log in to the administration page, use the login (kavizaadmin) and password (kaviza) by default.  The first configuration window opens in which you need to enter the IP address / DNS name of the hypervisor, username and password with root privileges.  Select the storage and network connection and click Save to save the settings. <br><br>  Please note that Kaviza cannot be deployed on a server that is part of the XenServer server pool ‚Äî this restriction is related to the implementation of the technology of pooling Kaviza servers and ensuring HighAvailability.  There is no such limitation on ESXi. <br><br><img src="https://habrastorage.org/storage1/bfd56f45/e69a6b7c/d9cefb6b/1fc4621d.gif"><br><br>  Now set up the grid.  Selecting 'Create a new Kaviza grid', set the name and save.  To join an already existing grid, select the 'Join a Kaviza server in an existing grid' option, set the IP address / DNS name of the Kaviza server from which you want to replicate the configuration and templates;  set the username and password to the server from which replication will be performed, and save the parameters.  The rest will happen automatically. <br><br><img src="https://habrastorage.org/storage1/cbaeab48/f11cfe4b/329f3b86/a5f59736.gif"><br><br>  The last step in setting up a server is to select a user base.  You can create an internal user database or use the Active Directory database.  We save. <br><br><img src="https://habrastorage.org/storage1/63a9a099/ec45bda6/6dad9f1a/bd3ffa45.gif"><br><br>  After the server configuration is completed, a welcome window will appear asking you to create a template for desktop deployment. <br><br><h4>  Step 2. Creating a "golden" image </h4><br>  So, for the further deployment of desktops, we need a "golden" image. <br>  Create a virtual machine, install Windows 7, update, XenTools and enter it into the domain.  We include the built-in administrator account and RemoteDesktop.  We add there groups of users from ActiveDirectory which can be connected on RDP.  If firewall is enabled, add RemoteDesktop to exceptions.  It is recommended to perform all actions under a local administrator account. <br><br><h5>  Houston, we have a problem </h5><br>  And here there is a nuance that is not described in the official documentation of Kaviza, and we have not met in other sources.  With virtual machines with the English version of Windows, there were no problems creating an image for future desktops.  When working with the Russian version, Kaviza refused to accept the local administrator account in Russian.  The problem is solved simply by renaming the account. <br>  If, after creating the template, try to add an administrator as a desktop user, Kaviza will report that he cannot find it, apparently his account is used for certain secret purposes. <br>  Installing Windows XP differs only in that you have to enter the activation key directly during installation. <br><br>  Select the configured virtual machine in the appropriate list for importing into the ‚Äúgolden‚Äù image and click OK.  In the window that appears, set the image name and description. <br><br>  The unavailable import section contains virtual machines that are not ready for some reason: for example, XenTools is not installed, RemoteDesktop is not enabled, the virtual machine is turned off, and so on. <br><br><img src="https://habrastorage.org/storage1/2d972fd6/d6b2d957/dc36e76d/8ea2fe63.gif"><br><br>  The creation of the image will begin, which can be traced by the progress bar.  When the image is ready, you need to connect to it via RDP and install an agent that matches the bitness of the OS.  After installing the agent, the virtual machine will restart, the Next button will become active. <br><br><img src="https://habrastorage.org/storage1/daebb8ed/160b9511/1b3c2c6c/a30c3315.gif"><br><br>  In the next image preparation window, we check connection via RDP and HDX protocol.  Also at this step you can install the necessary software or updates. <br><br>  In the security group 'Direct RDP Access Administrators' we add groups of domain users who will connect to desktops.  We make sure that all requirements are satisfied, and check the check boxes.  We go further. <br><br><img src="https://habrastorage.org/storage1/67378315/140f8a0b/7286d0bb/5a64f803.gif"><br><br>  The next step is to run the sysprep utility.  We fill in the form data, select the time zone, the prefix of the computer name, the activation method, the reinstallation of the drivers (recommended by default).  Click Prepare and wait for sysprep to finish. <br><br><img src="https://habrastorage.org/storage1/9429e901/22154d24/682247ff/18d45b3b.gif"><br><br>  Next, we test the image for the availability of the connection and the health of the installed software, again tick the list, click Next and save the "golden" image. <br><br><img src="https://habrastorage.org/storage1/5b11becd/99f599cf/a6852866/abdd8b96.gif"><br><br>  The created image goes into the category of published.  Naturally, if necessary, the ‚Äúgolden image‚Äù can be edited: add software, install updates, etc.  - the procedure is the same. <br><br><h4>  Step 3. Creating Desktop Templates </h4><br>  To create desktop templates, go to the Templates tab and click the green plus button.  In the window that appears, fill in the template name, description fields, choose the image from which the template will be created, set the RAM size (for Windows XP at least 512 MB is recommended, for Windows 7 - from 1536 MB), color depth, maximum number of desktops and number running desktops, select the desktop update mode and click the Save button. <br><br><img src="https://habrastorage.org/storage1/f8077fb3/3026e7f1/6bf9ee17/a22e6bd4.gif"><br><br>  Now go to the Admin tab, click Administer Users and add users or corresponding IDs to ActiveDirectory (for user groups, Administer Groups).  The Assign Desktop Templates link is used to assign available templates to users. <br><br>  Virtual machines are accessed via a browser (http: // [kMGR address] /), a Java client (http: // [kMGR address] /dt/kavizaclient.jnlp) or a Citrix plugin.  When using a Java client, the default connection is made via the HDX protocol, if it is not available, then via RDP.  In addition, you can connect from mobile devices. <br><br><h4>  Very short conclusion </h4><br>  Here, in general, and all.  As we have seen, Kaviza is really a very simple and easy-to-use product that allows you to customize the delivery of desktops to users in a couple of hours.  With the exception of a couple of the nuances described above, I didn‚Äôt have any problems in working with Kaviza, which I wish you. <br><br>  <a href="http://habrahabr.ru/users/bubarashka/" class="user_link">bubarashka</a> <br>  Systems Engineer <a href="http://www.depocomputers.ru/%3Futm_source%3Dtopic_171111%26utm_medium%3Dsign%26utm_campaign%3Dhabrahabr">DEPO Computers</a> </div><p>Source: <a href="https://habr.com/ru/post/132822/">https://habr.com/ru/post/132822/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../132815/index.html">DrupalSN: free registration!</a></li>
<li><a href="../132817/index.html">Comprehensive website optimization on WordPress</a></li>
<li><a href="../132818/index.html">Home Virtualization or Atom Virtualization</a></li>
<li><a href="../132819/index.html">Ubuntu 11.10 build from NNLUG</a></li>
<li><a href="../132821/index.html">Mobile version of 2GIS appeared in the OVI Store</a></li>
<li><a href="../132823/index.html">PROhq for legal freelance: each freelancer can apply for IE for free</a></li>
<li><a href="../132826/index.html">Simultaneous cross-site authentication without a bike</a></li>
<li><a href="../132828/index.html">Plugin Detector - jQuery plugin catalog and rating</a></li>
<li><a href="../132830/index.html">Bicyclist robot</a></li>
<li><a href="../132832/index.html">‚ÄúDouble‚Äù StartUp or how the customer became a performer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>