<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Dependency Injection with Scala validation using language tools</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I want to tell you about my small library Dependency Injection on Scala. The problem that I wanted to solve: the ability to test the dependency graph ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Dependency Injection with Scala validation using language tools</h1><div class="post__text post__text-html js-mediator-article"><p>  I want to tell you about my small library Dependency Injection on Scala.  The problem that I wanted to solve: the ability to test the dependency graph before their actual construction and fall as soon as possible if something went wrong, and also to see what exactly the error was.  This is exactly what is missing in the wonderful <a href="http://scaldi.org/">Scaldi</a> DI library.  At the same time, we wanted to preserve the external transparency of the syntax and get the most out of the means of the language, and not complicate and get into macros. </p><br><p>  I also want to immediately note that I concentrate on DI through the constructor, as in the simplest and most idiomatic way that does not require changes to the implementation of the classes. </p><a name="habracut"></a><br><p>  You can transfer the constructor as a function to Scala using a partial call, for example: </p><br><pre><code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">p0: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, p1: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class">(</span><span class="hljs-params"></span><span class="hljs-class"><span class="hljs-params"></span>).</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bind</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">new </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">A</span></span></span></span><span class="hljs-class"><span class="hljs-params">(_: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, _: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">))</span></span></code> </pre> <br><p>  Writing is quite cumbersome, it may be better to use predefined functions that call the constructor, which can be passed explicitly: </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">p0: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, p1: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getInstance</span></span></span></span>(p0: <span class="hljs-type"><span class="hljs-type">Int</span></span>, p1: <span class="hljs-type"><span class="hljs-type">Int</span></span>) = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">A</span></span>(p0, p1) } <span class="hljs-type"><span class="hljs-type">Module</span></span>().bind(<span class="hljs-type"><span class="hljs-type">A</span></span>.getInstance)</code> </pre> <br><p>  The readability of this style is much better, so in the examples below I will try to use it. </p><br><h2>  Usage example </h2><br><p>  build.sbt: </p><br><pre> <code class="scala hljs">libraryDependencies += <span class="hljs-string"><span class="hljs-string">"io.ics"</span></span> %% <span class="hljs-string"><span class="hljs-string">"disciple"</span></span> % <span class="hljs-string"><span class="hljs-string">"1.2.1"</span></span></code> </pre> <br><p>  Imports: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> io.ics.disciple._</code> </pre> <br><p>  Suppose we have a certain set of classes whose instances need to be injected into each other: </p><br><p>  <b>Domain entity "User"</b> </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">name: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span></span><span class="hljs-class">)</span></span></code> </pre> <br><p>  <b>A service</b> that takes an instance of an admin user as a parameter and has one method with a primitive implementation. </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserService</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">val admin: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">User</span></span></span></span></span><span class="hljs-class">) </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUser</span></span></span></span>(name: <span class="hljs-type"><span class="hljs-type">String</span></span>) = <span class="hljs-type"><span class="hljs-type">User</span></span>(name) }</code> </pre> <br><p>  We want to have an instance of this service in the form of a singleton - in order to make sure that it is created exactly once, we will get a static counter of instances of this class (for clarity, let's forget about multi-threaded execution). </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isCreated: <span class="hljs-type"><span class="hljs-type">Boolean</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getInstance</span></span></span></span>(admin: <span class="hljs-type"><span class="hljs-type">User</span></span>) = { isCreated = <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">UserService</span></span>(admin) } }</code> </pre> <br><p>  And also the conditional <b>controller</b> dependent on this service </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserController</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">service: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">UserService</span></span></span></span></span><span class="hljs-class">) </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">renderUser</span></span></span></span>(name: <span class="hljs-type"><span class="hljs-type">String</span></span>): <span class="hljs-type"><span class="hljs-type">String</span></span> = { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> user = service.getUser(name) <span class="hljs-string"><span class="hljs-string">s"User is </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">$user</span></span></span><span class="hljs-string">"</span></span> } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getInstance</span></span></span></span>(service: <span class="hljs-type"><span class="hljs-type">UserService</span></span>) = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">UserController</span></span>(service) }</code> </pre> <br><h2>  Types of Binding </h2><br><p>  By default, all our bindings are lazy - instances of classes are created only on demand - and are created as many times as requested. </p><br><p>  We can also add a <code>singleton</code> method to the declaration - in this case, the component will be created strictly once.  The nonLazy method marks the binding as non-lazy, which means that this component will be created when the module calls the <code>build()</code> method.  Only singleton components can be non-awkward. </p><br><p>  Let's see how the creation of a dependency graph will look like using the DIsciple library (note that the order of declaring bindings is not important): </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> depGraph = <span class="hljs-type"><span class="hljs-type">Module</span></span>(). <span class="hljs-comment"><span class="hljs-comment">//  ,    singleton bind(UserController.getInstance _).singleton. //  ,           ,    , //    nonLazy,          build(). forNames('admin).bind(UserService.getInstance).singleton.nonLazy. //    ,   'admin bind(User("Admin")).byName('admin). //    ,    'customer.    //                   bind(User("Jack")).byName('customer). //        build()</span></span></code> </pre> <br><p>  <em>Note 1</em> : You probably noticed that in the case of the controller, we force the transfer of the parameter as a function, and in the case of service - not.  This happens due to the fact that there is an overload of the bind function for the by-name function without arguments, in connection with which the compiler cannot understand how to treat a function without parameters - as an object or as a function.  I would be glad if someone tell me how to fix this minor inconsistency. </p><br><p>  Using: </p><br><pre> <code class="scala hljs">assert(<span class="hljs-type"><span class="hljs-type">UserService</span></span>.isCreated) <span class="hljs-comment"><span class="hljs-comment">//         build() println(depGraph[User]('customer)) //    User   customer println(depGraph[UserService].admin) //         println(depGraph[UserController].renderUser("George")) //      George</span></span></code> </pre> <br><p>  <em>Note 2</em> : if one argument needs to be obtained by name, and the other by type, then you can use the <code>*</code> operator: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">label: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">B</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">a: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">A</span></span></span></span><span class="hljs-class"><span class="hljs-params">, label: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">C</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">a: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">A</span></span></span></span><span class="hljs-class"><span class="hljs-params">, b: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">B</span></span></span></span><span class="hljs-class"><span class="hljs-params">, label: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">depGraph</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">Module</span></span>(). forNames(<span class="hljs-symbol"><span class="hljs-symbol">'labelA</span></span>).bind { <span class="hljs-type"><span class="hljs-type">A</span></span> }. forNames(*, <span class="hljs-symbol"><span class="hljs-symbol">'labelB</span></span>).bind { <span class="hljs-type"><span class="hljs-type">B</span></span> }. forNames(*, *, <span class="hljs-symbol"><span class="hljs-symbol">'labelC</span></span>).bind { <span class="hljs-type"><span class="hljs-type">C</span></span> }. bind(<span class="hljs-string"><span class="hljs-string">"instanceA"</span></span>).byName(<span class="hljs-symbol"><span class="hljs-symbol">'labelA</span></span>). bind(<span class="hljs-string"><span class="hljs-string">"instanceB"</span></span>).byName(<span class="hljs-symbol"><span class="hljs-symbol">'labelB</span></span>). bind(<span class="hljs-string"><span class="hljs-string">"instanceC"</span></span>).byName(<span class="hljs-symbol"><span class="hljs-symbol">'labelC</span></span>). build()</code> </pre> <br><h2>  Border conditions </h2><br><h3>  Incomplete set of dependencies </h3><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> depGraph = <span class="hljs-type"><span class="hljs-type">Module</span></span>(). bind { <span class="hljs-type"><span class="hljs-type">A</span></span>(<span class="hljs-string"><span class="hljs-string">"instanceA"</span></span>) }. bind { <span class="hljs-type"><span class="hljs-type">C</span></span>(_: <span class="hljs-type"><span class="hljs-type">A</span></span>, _: <span class="hljs-type"><span class="hljs-type">B</span></span>, <span class="hljs-string"><span class="hljs-string">"instanceC"</span></span>) }. build()</code> </pre> <br><p>  In this example, an exception will be thrown: IllegalStateException: Not found binding for {Type [io.ics.disciple.B]}.  <em>(it may be better to create a hierarchy of exceptions, instead of using IllegalStateException everywhere, but so far have not reached out)</em> </p><br><h3>  Cyclic Detection </h3><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Dep1</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">label: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-class"><span class="hljs-params">, d: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Dep2</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Dep2</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">d: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">DepCycle</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DepCycle</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">d: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Dep1</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class">(</span><span class="hljs-params"></span><span class="hljs-class"><span class="hljs-params"></span>). </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bind</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Dep1</span></span></span></span><span class="hljs-class"><span class="hljs-params">("test", _: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Dep2</span></span></span></span></span><span class="hljs-class">)). </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bind</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Dep2</span></span></span></span></span><span class="hljs-class">). </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bind</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">DepCycle</span></span></span></span></span><span class="hljs-class">). </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">build</span></span></span><span class="hljs-class">(</span><span class="hljs-params"></span><span class="hljs-class"><span class="hljs-params"></span>)</span></span></code> </pre> <br><p>  An exception will be thrown here: IllegalStateException: Dependency graph contains cyclic dependency: ({Type [io.ics.disciple.DepCycle]} -&gt; {Type [io.ics.disciple.Dep1]} -&gt; {Type [io.ics.disciple .Dep2]} -&gt; {Type [io.ics.disciple.DepCycle]}) </p><br><h3>  Polymorphic Binding </h3><br><p>  By default, components are linked by the final types of results of functions passed to <code>bind()</code> , but often this is not exactly the behavior we want, for example, if we need to bind a component by a treyt: </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServiceImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">depGraph</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">Module</span></span>(). bind(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">ServiceImpl</span></span>(): <span class="hljs-type"><span class="hljs-type">Service</span></span>). build()</code> </pre> <br><h2>  Under the hood </h2><br><p>  I will try to convey the general concept, without going into the details of implementation.  By calling the <code>.bind()</code> method, we generate a list of pairs <code>(DepId, List[Dep])</code> , where <code>DepId</code> is either a description of the type of result, or it is the same + identifier: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DepId</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TTId</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">tpe: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DepId</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toString</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">String</span></span> = <span class="hljs-string"><span class="hljs-string">s"{Type[</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">$tpe</span></span></span><span class="hljs-string">]}"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NamedId</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">name: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Symbol</span></span></span></span><span class="hljs-class"><span class="hljs-params">, tpe: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DepId</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toString</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">String</span></span> = <span class="hljs-string"><span class="hljs-string">s"{Name[</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${name.name}</span></span></span><span class="hljs-string">], Type[</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">$tpe</span></span></span><span class="hljs-string">]}"</span></span> }</code> </pre> <br><p>  A Dep is a pair wrapped constructor function (Injector) for a dependency + a list of IDs, components on which it itself depends: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Dep</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">R</span></span></span><span class="hljs-class">](</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">f: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Injector</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">R</span></span></span></span><span class="hljs-class"><span class="hljs-params">], depIds: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">List</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">DepId</span></span></span></span><span class="hljs-class"><span class="hljs-params">]</span></span></span><span class="hljs-class">)</span></span></code> </pre> <br><p>  How often one has to do in Scala in order to make method overloads for different numbers of arguments, one has to generate boilerplates.  One of these places is the <code>bind()</code> method.  But, fortunately, the <a href="https://github.com/sbt/sbt-boilerplate">sbt-boilerplate plugin</a> makes this occupation a little less sad.  You simply enclose duplicate parts of the declaration between square brackets and grids, and the plug-in understands that they need to be repeated, replacing the whole unit with n, deuces with n + 1, etc. <a href="https://github.com/KORPSE/disciple/blob/master/src/main/boilerplate/io/ics/disciple/module/BindBoilerplate.scala.template">BindBoilerplate.scala.template</a> .  As a result, the pattern is compact and eliminates the need to manually hold these huge sheets. </p><br><p>  When the <code>build()</code> method is called, the list of dependencies is converted into a graph (that is, DepId -&gt; Dep), checked for completeness and absence of cyclic dependencies using the DFS algorithm, whose complexity is estimated at O ‚Äã‚Äã(V + E), where V is the number of components , E - the number of dependencies between them.  If something goes wrong, an exception is thrown, otherwise a DepGraph class object is returned, which can already be used to get the final component: <code>depGraph[T]</code> or <code>depGraph[T]('Id)</code> - if we need to get a named component. </p><br><p>  I used the Symbol, and not the String for the names of the components, because it visually immediately distinguishes identifiers from ordinary string constants in the code.  Plus, in addition, we get forced internment, which can be useful in this case. </p><br><p>  More dry, but detailed and rich description of the examples, as well as the source code <a href="https://github.com/KORPSE/disciple">here</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/311590/">https://habr.com/ru/post/311590/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../311580/index.html">New management features: Intel RealSense and GestureWorks Fusion</a></li>
<li><a href="../311582/index.html">Twelve Useful Chrome DevTools Tips</a></li>
<li><a href="../311584/index.html">About hacking servers FirstVDS</a></li>
<li><a href="../311586/index.html">Restrictions (—Åonstraints) PostgreSQL: exclude, partial unique, pending restrictions, etc.</a></li>
<li><a href="../311588/index.html">What to do so that the organizer of the conference wants you</a></li>
<li><a href="../311592/index.html">Chat bots, and how will Microsoft help us with this?</a></li>
<li><a href="../311594/index.html">Keeping up with the times: Using JWT in ASP.NET Core</a></li>
<li><a href="../311596/index.html">Why traditional anti-money theft protection in RBS systems is vulnerable</a></li>
<li><a href="../311598/index.html">How to check causality without experiment?</a></li>
<li><a href="../311600/index.html">Power Query: how to stop being afraid of functional programming and start working in the advanced query editor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>