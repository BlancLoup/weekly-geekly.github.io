<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We solve Project Euler on F #: Tasks 3, 7, 10</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Well, let's continue our acquaintance with F #, and at the same time solving problems from the Euler Project, which I started in a previous post . Tod...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We solve Project Euler on F #: Tasks 3, 7, 10</h1><div class="post__text post__text-html js-mediator-article">  Well, let's continue our acquaintance with F #, and at the same time solving problems from the Euler Project, which I started in a <a href="http://meroving.habrahabr.ru/blog/52150/">previous post</a> .  Today I will consider several tasks from this project related to prime numbers.  In the first ten of these are three pieces, so we'll take a look at them. <br>  In these examples, we will continue to use only the functional aspects of the language, for the final, so to speak, consolidation.  And how to use F # in the imperative and object-oriented paradigm, I probably will tell you separately, next time. <br><br><a name="habracut"></a><br>  So, we have three tasks: <br>  <em>10. The sum of the primes below 10 is 2 + 3 + 5 + 7 = 17. Find the sum of all the primes below two million.</em> <em><br></em>  <em>3. The prime factors of the 13195 are 5, 7, 13 and 29. What is the largest factor of the number of 600851475143?</em> <em><br></em>  <em>7. By listing the first six prime numbers: 2, 3, 5, 7, 11, and 13, we can see that the 6 ^ (th) prime is 13. What is the 10001 ^ (st) prime number?</em> <em><br></em> <br><br>  In the first task, we will not run out, we are not gathered for this, but we will solve with the usual <a href="http://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25B5%25D1%2588%25D0%25B5%25D1%2582%25D0%25BE_%25D0%25AD%25D1%2580%25D0%25B0%25D1%2582%25D0%25BE%25D1%2581%25D1%2584%25D0%25B5%25D0%25BD%25D0%25B0">sieve of Eratosthenes</a> .  As a homework, you can try to implement the <a href="http://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25B5%25D1%2588%25D0%25B5%25D1%2582%25D0%25BE_%25D0%2590%25D1%2582%25D0%25BA%25D0%25B8%25D0%25BD%25D0%25B0">Atkin sieve</a> <br>  After several cleanings and improvements, I got the following code: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote><code><font color="black"><font color="#0000ff">#light</font> <br> <br> <font color="#0000ff">let</font> primes max = <br> <font color="#0000ff">let rec</font> next potentialPrimes = <br> <font color="#0000ff">match</font> potentialPrimes <font color="#0000ff">with</font> <br> |[] <font color="#0000ff">-&gt;</font> [] <br> |n::tail <font color="#0000ff">when</font> n &gt; int64 (sqrt (float max)) <font color="#0000ff">-&gt;</font> n::tail <br> |n::tail <font color="#0000ff">-&gt;</font> n :: next (List.filter ( <font color="#0000ff">fun</font> x <font color="#0000ff">-&gt;</font> x % n &lt;&gt; 0L) tail) <br> next [2L .. max] <br> <br> primes 2000000L |&gt; List.fold_left (+) 0L |&gt; printfn <font color="#A31515">"%d"</font></font> <br></code> </blockquote><br><br>  The internal recursive function next, which takes a list, compares it with three possible patterns.  The first of these, an empty list, is needed solely so that the compiler does not swear at incomplete pattern matches.  In fact, our function will never fall here, and the second comparison is terminal for it. <br>  In this template, in addition to the standard for working with lists of division into head and tail ( <font color="black">n :: tail</font> ), an additional condition is used, which is written after the keyword <font color="#0000ff">when</font> .  In this case, it checks if our number is not large enough (sqrt max), that the screening procedure could be stopped, and if so, it gives out the remaining list to it.  In the last pattern, the screening itself is specified, given by lambda. <br>  Since the sum of all primes can be quite impressive (and it is, answer 142913828922), we use 64-bit int64 in the code, and we hint about this to the compiler by writing ‚ÄúL‚Äù constants. <br>  In one case, it was not possible to manage with hints, since I had to cast the square root to int64.  By the way, before that, we had to bring our number to a floating point with the float function, since I did not want to take sqrt from the whole.  For C # programmers, this looks pretty weird.  The function does not work very quickly, but it fits into the framework outlined by the rules of the project with a margin. <br><br>  We will solve the second of the list of problems by the greatest mathematical method of all times and peoples, namely, the kettle method. <br><br>  If someone accidentally accidentally knows something, the method is described by the following anecdote: <br>  The mathematician asks the physicist: ‚ÄúYou have an empty kettle, a faucet with water, and a stove.  How to warm the kettle? ‚Äù‚Äú It is necessary to pour water from the tap into the kettle, light the fire and put the kettle on it, ‚Äùthe physicist replies.  "Fine!  - says the mathematician, - and now imagine that there is water in the kettle, and the fire is lit. ‚Äù  ‚ÄúWell, then it's very simple,‚Äù says the physicist, ‚Äúwe put the kettle on the stove.‚Äù  ‚ÄúThat's not it,‚Äù says the mathematician, ‚Äúwe must pour out the water, put out the fire and the task will be reduced to the previous one.‚Äù <br><br>  So we are reducing the problem to the previous one, build a list of all primes, filter those that divide the given number and find the maximum among them.  The only valuable thought is that you should look for primes not up to the number itself, but before its square root.  Thus we have the code: <br><br><blockquote> <code><font color="black"><font color="#0000ff">#light</font> <br> <font color="#0000ff">let</font> num = 600851475143L <br> <font color="#0000ff">let</font> primes max = <br> <font color="#0000ff">let rec</font> next potentialPrimes = <br> <font color="#0000ff">match</font> potentialPrimes <font color="#0000ff">with</font> <br> |[] <font color="#0000ff">-&gt;</font> [] <br> |n::tail <font color="#0000ff">when</font> n &gt; int64 (sqrt (float max)) <font color="#0000ff">-&gt;</font> n::tail <br> |n::tail <font color="#0000ff">-&gt;</font> n :: next (List.filter ( <font color="#0000ff">fun</font> x <font color="#0000ff">-&gt;</font> x % n &lt;&gt; 0L) tail) <br> <br> next [2L .. max] <br> <br> num |&gt; float |&gt; sqrt |&gt; int64 |&gt; primes <br> |&gt; List.filter ( <font color="#0000ff">fun</font> x <font color="#0000ff">-&gt;</font> num % x = 0L) |&gt; List.max |&gt; printfn <font color="#A31515">"%d"</font></font> <br></code> </blockquote><br><br>  With this example, you can once again appreciate the full power of Pipeline.  (How can you translate into Russian? The ‚Äúpipeline‚Äù somehow does not sound very much ...) Surely there are ways and quickly decide, without a ‚Äúteapot‚Äù, can anyone suggest? <br><br>  The third task, of course, can also be solved with the help of the same kitchen appliance, for example, by empirically checking that the primes &lt;2M we found are much more than 10001 (yes, there are more of them in a million), so simply without fear to take the 10001st element of the list.  But you must agree, such a decision somehow sickened our programming sense of beauty.  I'd like to solve the problem in general. <br><br>  As a result of the reflections, I decided to simply implement the naive method - filtering the full list of numbers according to the simplicity test, applied small optimizations, and, surprisingly, worked perfectly, and for 10001 it turned out disproportionately faster than the first proposed method. <br>  In my interpretation it looks like this: <br><br><blockquote> <code><font color="black"><font color="#0000ff">#light</font> <br> <br> <font color="#0000ff">let</font> isPrime n = <br> <font color="#0000ff">let</font> limit n = <font color="#0000ff">int</font> (sqrt (float n)) <font color="#0000ff">in</font> <br> { 2..limit n } |&gt; Seq.for_all ( <font color="#0000ff">fun</font> x <font color="#0000ff">-&gt;</font> n%x &lt;&gt; 0) <br> <br> let primes =  Seq.init_infinite ( <font color="#0000ff">fun</font> i <font color="#0000ff">-&gt;</font> i) <br> |&gt; Seq.filter ( <font color="#0000ff">fun</font> i <font color="#0000ff">-&gt;</font> i &gt;= 2) <br> |&gt; Seq.filter ( <font color="#0000ff">fun</font> i <font color="#0000ff">-&gt;</font> i%2 &lt;&gt; 0) <br> |&gt; Seq.filter isPrime <br> <br> primes |&gt; Seq.nth 10000 |&gt; printfn <font color="#A31515">"%d"</font></font> <br> <br></code> </blockquote><br><br>  Perhaps this is the most curious example of all three. <br>  The <font color="black">Seq.init_infinite</font> method sets, as the name implies, an infinite sequence.  Well, yes, it is infinite.  It is given by the lambda indicated in brackets, which is identical in our case.  This infinity is, of course, virtual, because in fact the sequence at the moment of determination does not exist yet, and it will be created only when it becomes necessary, just as operations on it will be done only when their results are required for further work.  In short, F # supports <a href="http://ru.wikipedia.org/wiki/%25D0%259B%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B2%25D1%258B%25D0%25B5_%25D0%25B2%25D1%258B%25D1%2587%25D0%25B8%25D1%2581%25D0%25BB%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F">lazy evaluation</a> (by adding the keyword <font color="#0000ff">lazy</font> before the function), and the class Seq has this ability a priori.  The topic of lazy calculations is quite extensive and complex to at least a little to fully illuminate it here, so I will not even try to do it.  I think Google is able to provide the necessary amount of information on this topic.  Haskell adepts may of course find fault with my self-defined definitions, but I, in turn, do not understand what could be so interesting for Haskell adepts in this article to read to this point. <br><br>  Well, the rest of the actions in the program are unlikely to cause questions.  Using the first two filters, we leave only those elements that we need (big two and not divisible into two), and the last filter applies the test for simplicity. <br>  Something like that. <br><br></div><p>Source: <a href="https://habr.com/ru/post/53414/">https://habr.com/ru/post/53414/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../53408/index.html">February's best startups</a></li>
<li><a href="../53409/index.html">Optimization of work. Electronic document management</a></li>
<li><a href="../53410/index.html">The PC market is stagnating, Microsoft is switching to AI</a></li>
<li><a href="../53411/index.html">idea for habr. habraboard.ru</a></li>
<li><a href="../53413/index.html">Fantastic story</a></li>
<li><a href="../53416/index.html">How to become an IT manager</a></li>
<li><a href="../53417/index.html">Former mayor of Nizhny Tagil was accused of negligence in creating the site</a></li>
<li><a href="../53418/index.html">Bug with the relocation of the line "zzzzz / zzzzzz /" in IE6 / IE7.</a></li>
<li><a href="../53419/index.html">The Pirate Bay is back online</a></li>
<li><a href="../53420/index.html">Internet users have chosen a new target for Hubble</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>