<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Jii: configuration and scaling</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello to all habrovchanam, fans of Yii and Node.js. There have been no articles about Jii for a long time, but the work did not stand still and I have...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Jii: configuration and scaling</h1><div class="post__text post__text-html js-mediator-article">  Hello to all habrovchanam, fans of Yii and Node.js.  There have been no articles about Jii for a long time, but the work did not stand still and I have something to tell! <br>  In this article, we will look at how to configure an application and launch applications as several processes. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/fba/793/a49/fba793a49bce4fc0b68ff8e99edd8667.png"></div><a name="habracut"></a><br>  For those who hears about this framework for the first time, I recommend reading <a href="http://habrahabr.ru/search/%3Fq%3D%255Bjii%255D%26target_type%3Dposts">previous articles</a> or <a href="http://jiiframework.ru/">visiting the site</a> . <br>  In short, <br><blockquote>  Jii is a framework, the architecture and API of which is based on the PHP framework Yii 2.0, taking the best sides out of it and retaining the advantages of JavaScript. </blockquote><br><h1>  Configuration </h1><br>  On Habr√© there were already many articles about how you need / can organize the configuration of the application.  From my own experience I can say that the configuration strongly depends on the specifics and scope of the application. <br>  Therefore, when creating a configuration in Jii, I tried first to create a constructor, and not a set of restrictions and rules. <br><br>  In addition to the environment name, the Jii configuration provides for dividing the application into several smaller ones, each of which may be responsible for a specific task.  One can implement the transport (http / comet), the other for asynchronous calculations in the background, the third - the demon that periodically monitors something, and so on. <br>  This distribution is usually observed only in large applications (projects), so Jii will not overload the programmer with unnecessary abstractions to create a simple application. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  Examples </h1><br>  Let's look at a few configuration examples, each of which will be more complicated than the previous one. <br><br><h2>  Basic </h2><div style="text-align:center;"><img src="https://habrastorage.org/files/24f/a9f/99b/24fa9f99bcc3450aa99b7e8cd84bd73f.jpg"></div><br>  The simplest configuration for a single application, without separation into environments, but with the ability to override the configuration through an additional configuration file. <br><br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   var Jii = require('jii'); require('jii-ar-sql'); //    ,     var custom = require('./config'); //          require('jii-workers') .application(Jii.mergeConfigs( //   { application: { basePath: __dirname, components: { db: { className: 'Jii.sql.mysql.Connection', database: 'site', username: 'site', password: '' } } } }, //   custom ));</span></span></code> </pre> <br>  If you put all this in the <i>server.js</i> file and start <i>node server.js</i> , the following will happen: <br><br><ol><li>  Using the native <a href="https://nodejs.org/api/cluster.html">Cluster</a> module, a master application (process) will be launched, the code of which is inside <a href="https://www.npmjs.com/package/jii-workers">jii-workers</a> ; </li><li>  The master application in a separate process will start our application with the configuration that we have shown above and will monitor its state ‚Äî if it dies, it will restart it. </li><li>  When you run our application, an instance of <i>Jii.application.WebApplication</i> will be created and filled with our configuration </li><li>  Components that support the service interface (have start, stop methods, for example, HttpServer) will start the start method - the application will start its work. </li></ol><br>  Full <a href="https://github.com/jiisoft/jii-workers/tree/master/examples/standart">GitHub</a> Code <br><br><h2>  Standard </h2><div style="text-align:center;"><img src="https://habrastorage.org/files/5a4/5b1/caf/5a45b1caf1c54e979a2231d5677ee97b.jpg"></div><br>  A more complex configuration, depending on the environment name, has several applications, each of which may have several duplicate workers. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Jii = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'jii'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'jii-urlmanager'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'jii-httpserver'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'jii-comet'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> custom = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./config'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'jii-workers'</span></span>) <span class="hljs-comment"><span class="hljs-comment">//    .setEnvironment(custom.environment) //         .application(['http', 'comet'], function (environment, name) { return Jii.mergeConfigs( // Main config require('./app/config/base')(environment), require('./app/config/' + name)(environment), // Custom configuration custom.base || {}, custom[name] || {} ); });</span></span></code> </pre><br>  Unlike the simplest example, we needed to create several applications ( <i>http</i> and <i>comet</i> ).  We set their names as the first optional argument of the <i>application</i> function.  We passed the second parameter to the configuration, but not as a finished object, but as a function.  This function will be called immediately (in this case twice), and the name of the environment and the name of the application specified in the first parameter will be passed as arguments.  A kind of syntactic sugar, no more. <br>  The remaining parts of the configuration are separated by the <i>app / config / *</i> files, all the code can be seen on the <a href="https://github.com/jiisoft/jii-workers/tree/master/examples/standart">github</a> . <br><br><h2>  Advanced </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/files/c9e/e62/7f9/c9ee627f971444c5b232e7d5b1d5eb7d.jpg"></div><br>  Well, briefly talk about the broader form of configuration, where there are many applications and everything is fragmented into folders and files. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Jii = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'jii'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> custom = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./config'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'jii-workers'</span></span>) .setEnvironment(custom.environment) <span class="hljs-comment"><span class="hljs-comment">// Comet server .application('comet', function (environment) { return Jii.mergeConfigs( require('./configuration/comet/main')(environment), custom.comet ); }) // Garbage collector .application('gc', function () { return Jii.mergeConfigs( require('./configuration/gc/main'), custom.gc ); }) // Http and Online applications .application(['http', 'online'], function (environment, name) { var envConfig = {}; try { envConfig = require('./configuration/' + name + '/' + environment.getName()); } catch (e) { } return Jii.mergeConfigs( // Main config require('./configuration/base/main'), require('./configuration/base/' + environment.getName()), require('./configuration/' + name + '/main'), envConfig, // Custom configuration custom.base, custom[name] ); });</span></span></code> </pre><br>  In this example, the <i>application</i> method is called several times to declare different applications.  The rest is all the same. <br>  All sample code can be seen <a href="https://github.com/jiisoft/jii-workers/tree/master/examples/advanced">here</a> . <br><br><h1>  Scaling </h1><br>  Node.js a worker can only occupy one processor core, so they usually recommend creating several workers according to the number of process cores.  Considering that with high memory consumption and the CPU, the node ‚Äústicks‚Äù, it is better to increase this amount at least twice. <br>  In the Jii configuration, for each application, you can specify the number of processes on which you want to run the application.  Scaling occurs by means of <a href="https://nodejs.org/api/cluster.html">Cluster</a> .  Each worker will be assigned an index, this is useful if you need to distribute a server to different ports. <br><br><h1>  Total </h1><br>  In fact, there are a lot of configuration options, as I said before - it is different for each application.  The tool in the form of the <a href="https://www.npmjs.com/package/jii-workers">jii-workers</a> module only allows to simplify its task. <br>  The Jii configuration is not a silver bullet, it is intended only for creating Jii applications. <br><br>  Let me remind you, Jii is an open source project, so I will be very happy if someone joins its development.  Write to affka@affka.ru. <br><br>  <a href="http://www.jiiframework.ru/">Framework</a> Site - <a href="http://www.jiiframework.ru/">jiiframework.ru</a> <br>  GitHub - <a href="https://github.com/jiisoft">github.com/jiisoft</a> <br><br>  Liked?  Put a <a href="https://github.com/jiisoft/jii/stargazers">star</a> on the githaba!  :) <br><br><div class="spoiler">  <b class="spoiler_title">Previous articles</b> <div class="spoiler_text"><ul><li>  <a href="http://habrahabr.ru/post/260931/">Jii - a JavaScript framework with architecture from Yii 2</a> </li><li>  <a href="http://habrahabr.ru/post/260569/">Jii: Active Record for Node.js with API from Yii 2</a> </li><li>  <a href="http://habrahabr.ru/post/260295/">Jii: Full Query Builder for Node.js with API from Yii 2</a> </li></ul></div></div></div><p>Source: <a href="https://habr.com/ru/post/266929/">https://habr.com/ru/post/266929/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../266919/index.html">VI Hi-Tech Tour Inoventica Cloud Center: ‚ÄúIndian Summer in the Clouds‚Äù</a></li>
<li><a href="../266921/index.html">Sipuni: development path from a virtual PBX to a SaaS-service for receiving phone calls</a></li>
<li><a href="../266923/index.html">HostGator vs. GoDaddy - Hosting Review</a></li>
<li><a href="../266925/index.html">A collection of practical PHP tasks to prepare for an interview</a></li>
<li><a href="../266927/index.html">A story about making friends with the Nexus Player (FUGU) and the Intel Mobile Development Kit</a></li>
<li><a href="../266933/index.html">Hone the skills of the console</a></li>
<li><a href="../266935/index.html">About safety UEFI, part zero and first</a></li>
<li><a href="../266937/index.html">Functional C #: Primitive obsession (primitive obsession)</a></li>
<li><a href="../266939/index.html">How to make friends HTML5 with mobile OS</a></li>
<li><a href="../266941/index.html">RailsClub 2015: Interview with Boris Goryachev</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>