<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The simplest implementation of cross-platform multiplayer on the example of the evolution of a single .NET game. Part two, more technical</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="So, the promised continuation of my first article from the sandbox , in which there will be some technical details on the implementation of a simple m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The simplest implementation of cross-platform multiplayer on the example of the evolution of a single .NET game. Part two, more technical</h1><div class="post__text post__text-html js-mediator-article">  So, the promised continuation of my <a href="http://habrahabr.ru/post/186486/">first article from the sandbox</a> , in which there will be some technical details on the implementation of a simple multiplayer game with the ability to play with clients on different platforms. <br>  I ended the previous part by the fact that in the latest version of my game ‚ÄúMagic Yatzy‚Äù I use WebSockets as a tool for client-server interaction.  Now for some technical details. <br><br><a name="habracut"></a><br><h5>  1. General </h5><br>  In general, everything looks as shown in this diagram: <br><br><img src="https://habrastorage.org/storage2/5f7/eed/55d/5f7eed55d951f5e855d5d0f1e58e48bc.png" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Above is a diagram of the interaction between the three clients on different platforms and the server.  Consider each part in more detail. <br><br><h5>  2. Server </h5><br>  My server is based on MVC4, working as a ‚ÄúCloud service‚Äù in Windows Azure.  Why such a choice.  It's simple: <br>  1) I don't know anything except .NET. <br>  2) I only have WebSocket for interactions related to the game, everything else, such as checking server status, getting / saving points and so on - through WebApi - therefore MVC. <br>  3) I have a subscription to Azure services. <br><br>  According to the scheme above - the server consists of three parts: <br>  1) ServerGame - the implementation of all the logic of the game; <br>  2) ServerClient - a kind of intermediary between the game and the network part; <br>  3) WSCommunicator - the part responsible for network interaction with the client - receiving / sending commands. <br><br>  The specific implementation of <b>ServerGame</b> and <b>ServerClient</b> depends on the particular game you are developing.  In the general case, the <b>ServerClient</b> receives a command from the client, processes it and notifies the game about the client's action.  At the same time, it monitors the change of the game state ( <b>ServerGame</b> ) and notifies (sends information via <b>WSCommunicator</b> ) his client about any changes. <br>  For example, regarding my dice game: a user on a Windows 8 client secured several bones on his turn (made sure that their value did not change on the next roll).  This information was passed to the server and <b>ServerClient was</b> notified of this by the <b>ServerGame</b> class, which made the necessary changes in the state of the game.  All other <b>ServerClients</b> connected to this game (in this case, WP and Android) were notified about this change, and they, in turn, sent information to devices to alert users via the UI. <br>  It should be said that there is nothing ‚Äúserver‚Äù in the <b>ServerGame</b> class <b>itself</b> .  This is a common .NET class that has a common interface with <b>ClientGame</b> .  Thus, we can substitute it instead of <b>ClientGame</b> in the client program and thus get a local game.  This is exactly how a local game works in my ‚Äúknuffle‚Äù - when both local and online games are possible from one UI page. <br>  <b>WSCommunicator</b> is, as I said, the class responsible for networking.  Specifically, this implements this interaction through WebSocket'ov.  In .NET 4.5 there appeared its own implementation of web sockets.  The core of this implementation is the WebSocket class, <b>WSCommunicator</b> is essentially a wrapper over it, which opens and closes the connection, attempts to reconnect, send / receive data in a specific format. <br>  Now for some code.  For the initial connection is used Http Handler.  It is not necessary to add a physical page.  It is enough to set the parameters in WebConfig: <br><br><pre><code class="xml hljs">‚Ä¶ <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">system.webServer</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">handlers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">remove</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ExtensionlessUrlHandler-Integrated-4.0"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"app"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"app.ashx"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">verb</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Sanet.Kniffel.Server.ClientRequestHandler"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ExtensionlessUrlHandler-Integrated-4.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*."</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">verb</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"System.Web.Handlers.TransferRequestHandler"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">resourceType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Unspecified"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">requireAccess</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Script"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">preCondition</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"integratedMode,runtimeVersionv4.0"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">handlers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">system.webServer</span></span></span><span class="hljs-tag">&gt;</span></span> ‚Ä¶</code> </pre> <br><br>  Thus, when accessing the (virtual) ‚Äúapp.ashx‚Äù page on the server, the code from the ‚ÄúSanet.Kniffel.Server.ClientRequestHandler‚Äù class will be called.  Here is the code: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ClientRequestHandler</span></span> : <span class="hljs-title"><span class="hljs-title">IHttpHandler</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProcessRequest</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HttpContext context</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (context.IsWebSocketRequest) <span class="hljs-comment"><span class="hljs-comment">//  WebSocket context.AcceptWebSocketRequest(new Func&lt;AspNetWebSocketContext, Task&gt;(MyWebSocket)); else //  Http context.Response.Output.Write("  ..."); } public async Task MyWebSocket(AspNetWebSocketContext context) { string playerId = context.QueryString["playerId"]; if (playerId == null) playerId = string.Empty; try { WebSocket socket = context.WebSocket; // ,   WSCommunicator'          ServerClientLobby clientLobby = null; if (!string.IsNullOrEmpty(playerId)) { //         if ( !ServerClientLobby.playerToServerClientLobbyMapping.TryGetValue(playerId, out clientLobby)) { //  -   clientLobby = new ServerClientLobby(ServerLobby, playerId); ServerClientLobby.playerToServerClientLobbyMapping.TryAdd(playerId, clientLobby); } } else { //       return; } //     clientLobby.WebSocket = socket; await clientLobby.Start(); } catch (Exception ex) { //-   ... } } }</span></span></code> </pre><br><br>  I think, taking into account the comments, everything should be clear.  The WSCommunicator.Start () method starts the "standby" command from the client.  Here‚Äôs what it looks like (): <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Interlocked.CompareExchange(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> isRunning, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> Run(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (WebSocket != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; WebSocket.State == WebSocketState.Open) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> Receive(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (OperationCanceledException) <span class="hljs-comment"><span class="hljs-comment">//     { } catch (Exception e) { //-  //  CloseConnections(); // ,       OnReceiveCrashed(e); } } }</span></span></code> </pre><br><br>  This is the general part, I will omit the further description of the server, since it will depend to a greater extent on the game you are doing.  I can only say that commands are transmitted via WebSocket (including) in text format.  The specific implementation of these commands again mainly depends on the game.  When receiving a command from a client, it will be processed by the WSCommunicator.Receive () method, for sending to the client - WSCommunicator.Send ().  Everything between - again depends on the logic of the game. <br><br><h5>  3. Customer </h5><br><h6>  3.1 WinRT. </h6><br>  If the client were on a full-fledged .NET 4.5, then it would be possible to use the same <b>WSCommunicator</b> class as on the server with small additions - instead of the WebSocket class, you would need the ClientWebSocket class, plus add logic on the server connection request.  But WinRT uses its own implementation of webboxes with the StreamWebSocket and MessageWebSocket classes.  For sending text messages, use the second.  Here is the code for establishing a connection with the server using it: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConnectAsync</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isreconnect = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">false</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-comment"><span class="hljs-comment">//    ,            //(,  ) MessageWebSocket webSocket = ClientWebSocket; //     if (!IsConnected) { //   (ws://myserver/app.ashx") var uri = ServerUri(); webSocket = new MessageWebSocket(); webSocket.Control.MessageType = SocketMessageType.Utf8; //  webSocket.MessageReceived += Receive; webSocket.Closed += webSocket_Closed; await webSocket.ConnectAsync(uri); ClientWebSocket = webSocket; //        if (Connected != null) Connected(); //,    return true; } return false; } catch (Exception e) { //-   return false; } }</span></span></code> </pre><br><br>  Then everything is like on the server: WSCommunicator.Receive () receives messages from the server, WSCommunicator.Send () sends.  <b>GameClient</b> works in accordance with the data received from the server and from the user. <br><br><h6>  3.2 Windows Phone, Xamarin and Silverlight (as well as .NET 2.0) </h6><br>  All of these platforms do not have out-of-the-box web socket support.  Fortunately, there is an excellent open source <a href="http://websocket4net.codeplex.com/">WebSocket4Net</a> library, which I mentioned in a previous article.  Replacing the class of the web socket in <b>WSCommunicatar</b> e with the one implemented in this library, we will be able to connect to the server from the specified platforms.  Here's how to change the connection code: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConnectAsync</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isreconnect = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">false</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-comment"><span class="hljs-comment">//    ,            //(,  ) WebSocket webSocket = ClientWebSocket; //     if (!IsConnected) { //   (ws://myserver/app.ashx") var uri = ServerUri(); webSocket = new WebSocket(uri.ToString()); //  webSocket.Error += webSocket_Error; webSocket.MessageReceived += Receive; webSocket.Closed += webSocket_Closed; //  ,  ""   var tcs = new TaskCompletionSource&lt;bool&gt;(); webSocket.Opened += (s, e) =&gt; { //        ClientWebSocket = webSocket; if (Connected != null) Connected(); //,    else tcs.SetResult(true); }; webSocket.Open(); return await tcs.Task; } return false; } catch (Exception ex) { //-   return false; } }</span></span></code> </pre><br><br>  As you can see, there are differences, but there are not so many of them, the main thing is not asynchronous opening of the connection to the server, but this is easy to fix (although to support async await in older versions of .NET, you need to install the Microsoft.Bcl package from nuget). <br><br><h5>  Instead of conclusion </h5><br>  I read what I wrote and understand that there are more questions than answers.  Unfortunately, it‚Äôs not physically possible to describe everything in one article, and it‚Äôs already not the shortest one ... but I will continue to train. </div><p>Source: <a href="https://habr.com/ru/post/187282/">https://habr.com/ru/post/187282/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../187270/index.html">WebRTC PeerConnection and DataChannel: Browser Data Exchange</a></li>
<li><a href="../187272/index.html">Type Family and Pokemon</a></li>
<li><a href="../187274/index.html">Danger! This mission to Mars will bore you to death!</a></li>
<li><a href="../187278/index.html">Computer generated efficient, but incomprehensible to man, TCP acceleration algorithms</a></li>
<li><a href="../187280/index.html">In Belarus, problems with access to Google</a></li>
<li><a href="../187284/index.html">Ubuntu Phone, Core Applications. Inside view</a></li>
<li><a href="../187286/index.html">Interplanetary rally of two centuries</a></li>
<li><a href="../187292/index.html">Development of IntelliJ IDEA plugin. Part 5</a></li>
<li><a href="../187294/index.html">Ice cream trailer on request from a mobile application</a></li>
<li><a href="../187298/index.html">Disney Research has developed a tactile feedback system based on a vortex cannon.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>