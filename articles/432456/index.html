<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Conference DEFCON 18. You have spent all this money, but you continue to "have". Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As usual, as in the past year, I cannot believe that people really come to my presentations to listen to what I am telling. Last year it was Sunday, a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Conference DEFCON 18. You have spent all this money, but you continue to "have". Part 1</h1><div class="post__text post__text-html js-mediator-article"> As usual, as in the past year, I cannot believe that people really come to my presentations to listen to what I am telling.  Last year it was Sunday, at 10 am, I was in a state of hangover and thought that no one would come to see me. <br><br><img src="https://habrastorage.org/webt/3e/ll/qv/3ellqvu1eneo8spic0we_udteto.jpeg"><br><br>  Today is again Sunday, 4 pm, today I wanted to fly home, but, despite this, I thank you and really appreciate your attention, as in the past year, and I damn like such people and DefCon. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Theme of the presentation - you have spent all this money, but you continue to ‚Äúhave‚Äù.  I did a lot of penetration tests, was in a lot of countries where I did pentesting, and everywhere I fought with various means of protection such as firewalls, AWS, and intrusion detection systems IDS and MAC.  We still give them a run-up and this is very bad.  Often, when I test, my report turns into an incident report, and I want to say: ‚Äúhey, man, but you are the owner of all this, how can you use this sludge‚Äù?  A whole topic was devoted to this, but let me first tell you who I am. <a name="habracut"></a><br><br>  I‚Äôm a network application penster and I‚Äôm teaching this to people, and I‚Äôm a black guy at security conferences, yes, it's me!  So, I break in, I'm fierce and I drink.  Orders change, but I remain the same.  So if you don't like guys like me, you can get up and leave. <br><br>  So let me go back a little, about 10 years. I always do that because I have a special nostalgia for those times.  In those days, pentesting was an easy task, we came to the client and said: ‚ÄúHi, man, we are people from security,‚Äù and the client raised his hands up, thinking: ‚ÄúDamn, here are people from security!‚Äù <br><br>  After that, we hacked into a client network with open source tools like ISS or Nessus.  How many remembers that Nessus was free then? <br><br><img src="https://habrastorage.org/webt/sf/ot/l1/sfotl1m0qitfjpgofcgsrq_wtou.jpeg"><br><br>  So, we came to the client with all these things and easily hacked his website using exploits like RootShell with PacketStorm - raise your hands, who remembers them!  We scanned the ports to find the target, used all sorts of compilations, point-slash, all of these libraries, and opened the control panel. <br><br><img src="https://habrastorage.org/webt/ru/6y/vb/ru6yvbuegbw0enb0xwfe8kiezm4.jpeg"><br><br><img src="https://habrastorage.org/webt/v5/ox/ff/v5oxffsrnxltstaptjad-fd2-ne.jpeg"><br><br>  Then we took screenshots of the vulnerability, on which you could see your passwords and other confidential information, and said: "well, everything, man, your network is captured!". <br><br><img src="https://habrastorage.org/webt/nm/mk/qx/nmmkqxadktgh6uiqwqpveoxucdw.jpeg"><br><br>  Then we compiled a report, wrote how lame was their network, and got paid for it.  ‚ÄúYour network is fucking sucks, so pay me!‚Äù <br><br><img src="https://habrastorage.org/webt/ys/w9/pi/ysw9piuh990ll20tiwxx64u9oe0.jpeg"><br><br>  But today, guys, all around is CISSP, independent certification of information security, and the dude who hires you thinks he knows more than you.  I want him to say: ‚Äúthen why the hell did you hire me?‚Äù, And he answers: ‚Äúyou know, we did it, and that, we have IDS and MAC, we have that, we have it ...‚Äù.  And you're spinning around in all this shit. <br>  Let me tell you a little story.  Everyone who knows me knows that I always have a story. <br><br>  A few years ago I had a client who ordered pentesting.  He said, ‚ÄúOK, Joe, I want you to audit these subnets and the ACL access control list for the VLAN.‚Äù  Probably some of you have already done an ACL for the VLAN, so you guys are smarter than me, because I have never done this. <br><br>  I say - well, what kind of audit should I do?  He responds - VLAN audit, okay, I think I will go, look at the configuration of their network.  And here I am sitting with a network administrator and I see that they have 90 VLANs for 300 users!  I was just in shock and told him how this is possible, but he just answered - well, it happened!  I took a small piece of paper and began to go around the people, asking, ‚ÄúDo you need this network?  Do you need this network?  Maybe you need this network? ‚Äù.  So, I got around to everyone, I learned that who needed it, and it was a big, damn big company.  I checked all these VLANs, certified some networks and reached one of the DMZ segments, which were 4 pieces in the company.  I said to myself: ‚ÄúHey, man, all these boxes need updating, they really need to be patched.‚Äù  I went to the deputy general director and said that you have all this hardware that needs a software update, since you missed some SQL patches, PHP patches, and much more. <br><br>  They had a meeting, because they constantly meet, and here one of the developers gets up and says: ‚ÄúNo, no, we can't update it, these are our servers for development!‚Äù (Laughter and applause in the hall).  How can I comment on the fact that the developer server is in the DMZ?  And they answer me: ‚ÄúThat's better!‚Äù. <br><br>  So, I continue to work for the client, start my small pentesting and ‚Äúbring down‚Äù a couple of racks, because it is easy to do.  The client asks why our IDS system could not catch you, and I answer, and what, was IDS there?  He says yes, we observe security with her help.  I answer: ‚Äúwell, probably because someone worked on this IDS‚Äù! <br><br>  Companies hire other companies to outsource their IDS, they manage them, compile reports and do a lot of other shitty things.  So, I had to take a look at their ‚Äúbox‚Äù and asked the guy to give me access to quickly examine it.  I, hell, spent more than 2 minutes to log in via SSH, and saw that this bitch is slow to hell, so I began to check it for rootkits.  It turned out that there were already 4 rootkits! <br><br><img src="https://habrastorage.org/webt/r0/j1/ov/r0j1ovuhghyuqnxxyrsl442rfbq.jpeg"><br><br>  So pentesting is a cool thing!  So, what do I do when I oppose these guys from large companies, when I audit all these fucking banks, all these fucking companies - I turn to Google for help.  First of all, I'm looking for SQL error messages, looking for files for remote control, everything that will give me quick access to the shell, the most vulnerable place.  Never engage in such nonsense, like scanning vulnerabilities, immediately take the system "by the throat."  So I always look for SQL injections, RF files, cross-site scripting, and after I find them, I turn to passive intelligence and OSINT, open source intelligence, for this I use Maltego.  I act as a woman who wants to catch her husband for adultery - I look everywhere!  I'm trying to understand what their subnets are, where all these things are located, I use this incredible tool called Firefox.  Believe me, what he can do will surprise you! <br><br>  Passive intelligence is a basic tool that you really should try.  I am sure that most of you are already using it, this technique definitely needs to be used.  Then I look for load balancers, now I pass about 30% of my penetration tests through load balancers, this is really a handy thing.  I adjust the load to the ‚Äúbox‚Äù and find out if it is load balancing DNS or HTTP.  For example, when you send packages and they fly through all of these paths, it makes testing a little more difficult. <br><br><img src="https://habrastorage.org/webt/gv/fe/ue/gvfeue7z1mjd6igg5mu7ttninqa.jpeg"><br><br>  Then I return to the awesome Firefox browser and change the contents of the HTTP Headers search bar header in real time.  This allows you to send some general requests to the server. <br><br><img src="https://habrastorage.org/webt/c3/wy/du/c3wyduwvyngyztwxjvjpjf5ni6q.jpeg"><br><br>  So if you send the first packet and the answer ‚Äú5‚Äù is returned to you, then you send another packet to the same box and it returns you the answer ‚Äú6‚Äù, it means that you have load balancing.  The same with the dig command and Netcraft. <br><br>  Netcraft is an amazing thing.  For example, you are looking for something like ‚ÄúF5 BigIP‚Äù and get IP addresses with already balanced load.  During pentesting this was very important to me.  The load balancer is detected by a shell script or using Halberd, a Python script that does the same thing.  So these are really good things that help you determine the real IP of the host that you intend to attack and which is behind the load balancer. <br><br><img src="https://habrastorage.org/webt/bk/gq/4g/bkgq4g4eca0pv4_qwk7osnqe7ai.jpeg"><br><br>  The next thing I come across is the detection of IPS, or intrusion prevention systems.  It seems that everyone has an IPS, but the vast majority of my clients use it in IDS mode.  Just as it makes no sense to use hacking tools against a load-balanced host, it makes no sense to use them against a host that is IPS protected.  Do any of you use this thing?  Turn it off to hell because it blocks traffic!  Indeed, try turning it off and see what happens.  How many of you believe that this system blocks illegal traffic, she wrote to you about this?  This is the same crap as all its similar systems.  Do you agree with me?  I just want to make sure that I'm not the only one who thinks so. <br><br>  So, I need to find out if I need to fight against IPS, that is, if the attacked host is not under its protection, and for this I do some really simple things. <br><br><img src="https://habrastorage.org/webt/fv/sr/6i/fvsr6irzjyqbz7omcvb7nn7_ufc.jpeg"><br><br>  I‚Äôm a Linux guy, but now I‚Äôm forced to use Windows, so I feel a little soiled.  First of all, I use cURL - these are command line tools, or scripts, and a library that passes data via a URL.  With cURL, I'm going to win ../../WINNT/system32/cmd.exe?d.  Believe me, this attack has not worked since Jesus walked the earth, so let me know if you can make it happen. <br><br>  The only reason why this should be done is to try to find out if something is blocking your IP address or sending packets to reset your connection.  Because if this thing sends you reset packets, you need to refer to cmd.exe? D, since it is likely that your address is blocking IPS.  Reflecting in the same way, the guys from purehacking.com came up with the Active Filter Detection tool, or active filter detection.  This is a very good Python tool that allows you to modify it a bit and customize to fit your needs. <br><br>  I often encounter IPS, so I use 3-4 different IP addresses from which I shoot packets and see if I get a reset packet in response.  If I receive, it means my IP address is blocked.  I note that most IDS / IPS solutions do not monitor SSL-encoded traffic and other encrypted traffic.  So the next thing I do is see if IPS can handle SSL.  Let me remind you once again why we use Linux. <br><br><img src="https://habrastorage.org/webt/d3/pp/z4/d3ppz4jkwoulr4rn1fsetl7zwns.jpeg"><br><br>  I create the xlnetd file and perform what I call the "SSL test".  You see that I open port 8888, and then any data that I transfer to the local host 8888 falls into this little shell script, you see server = /home/j0e/security/toolz/ssl_proxy.sh. <br><br>  On the next slide you can see the amazing abilities of my script - just look at this script from one line!  Thus, the traffic goes straight to the open SSL, and then the connection is made to the target and all the same Active Filter Detection or cmd.exe is launched against the local host in order to determine whether my IP address is blocked. <br><br><img src="https://habrastorage.org/webt/gk/cv/-6/gkcv-6srxshvxjvyvod7yvwdnue.jpeg"><br><br>  The vast majority of my clients who deploy IPS and use blocking mode do not decrypt SSL traffic before it goes through IPS or IDS.  Therefore, if you want to make your customers spend money with benefit, tell them to buy an SSL accelerator.  It interrupts the SSL protocol before IPS and tries to decrypt the traffic. <br>  Now let's see how you can attack a host through Tor and how to launch tools to scan the network through it.  I do this quite often, launching privoxy and in hidden mode I use tools like Nessus to attack the host through port 8080.  In this regard, it is worth recommending to your customers to block Tor output nodes. <br><br><img src="https://habrastorage.org/webt/ez/po/qk/ezpoqkwq3i13i6d-4uhnbidwzpw.jpeg"><br><br>  Most companies have no reason to allow their customers to connect to their network through private networks, but they never block such connections.  Therefore, you must force companies to block these nodes, this is what I primarily do for my clients.  I don't have a slide with a description of the GLib proxy, because the hangover really affected my ability to do these slides this morning. <br><br>  The last thing I do is identify WAF, Web Application Firewalls, or web application firewalls.  How can I determine if a host is using WAF? <br><br><img src="https://habrastorage.org/webt/pp/vo/7v/ppvo7vz3nzib5dkearlicfbu_mq.jpeg"><br><br>  Since I am doing a lot of PCI-pinging, I know that some brilliant heads in the PCI representation realized that if you have vulnerable web applications that you don‚Äôt want to fix them and fix the vulnerability, then you can use WAF.  In fact, detecting the use of such firewalls is easy.  To do this, it is enough to send 1 real request to the host, one malicious request and see how its answers will differ.  A malicious HTTP request may contain a payload that includes any nonsense such as apostrophe, quotes, question mark, minus, brackets, asterisks, and so on. <br><br><img src="https://habrastorage.org/webt/yr/et/yl/yretylycrnrtkmervm-hc_prbne.jpeg"><br><br>  So it‚Äôs not at all difficult to find out if you are attacking a host protected with WAF. <br>  So, you send any invalid characters, and then the tools shown on the next slide give you all kinds of these weird things.  So, if you query cmd.exe and use the grep command line utility for the ‚Äú501‚Äù method, that is, instead of error 404 ‚Äúnot found‚Äù, you will receive error message 501 - ‚Äúthe request method is not supported by the server‚Äù, then you probably encountered firewall mod_security, protecting the server Apache.  New versions of this firewall have changed the situation, but who really cares about updating your WAF? <br><br>  So I use the methods shown on the next slide quite widely, and also skip my attacks through the AQTRONIX Web Knight firewall. <br><br><img src="https://habrastorage.org/webt/d9/yj/k5/d9yjk55j1pgw_nz3qw2g6ghaavk.jpeg"><br><br>  You see in the response header the code 999 No Hacking, I launch such a thing while testing - ‚ÄúNo hacking‚Äù.  So you just start adding things to the address bar to see what it gives and if you do not receive a 404 error message for a file that is not on the host. <br><br><img src="https://habrastorage.org/webt/yr/kz/gc/yrkzgcgzkhppu2crx7r9hfl9fw0.jpeg"><br><br>  I mean, if you send the correct request, which gives you message 200, and then send the wrong request for a file that does not exist, and the server generates an error 404, and then suddenly insert something for cross-site scripting, the server will send you have a completely different meaning of error.  This will indicate that in this case there is some kind of protective mechanism. <br><br>  Let's return to our games with coding.  If you have determined that you are against WAF, see if this thing supports HEX, whether it processes utf7, utf-8, base16, base64, or a mixture of these encodings.  Most WAFs don't work well with encodings, especially if you start mixing them with each other. <br><br>  My good buddies, Sancho Gaci and Windell, last year created a Python tool called WAFW00F, a utility for detecting WAF. <br><br><img src="https://habrastorage.org/webt/yo/fq/8p/yofq8p56uevzl47b72za3gr946k.jpeg"><br><br>  This thing takes away the ‚Äúfingerprints‚Äù of HTTP response headers and identifies WAF.  I like this thing very much, now we already have a list of 10 or 12 WAFs, and it is constantly growing.  The next thing you should pay attention to is called WAF Fun, which is a tool that uses the brute-force method on a set of web application firewall rules, and it is also written in Python. <br><br>  I really admire these guys and wish that we have made even greater progress, but you know that we drink a little, then we work, then we drink again and we work again, so the process of creating such things is not easy.  But I still hope that at the next DefCon conference I will be able to demonstrate how WAF Fun works using the brute-force method. <br><br>  Another interesting thing is what we can do with Unicode.  True, it is written in Ruby, and we all know that Ruby is crap. <br><br>  17:00 min <br><br>  <a href="https://habr.com/company/ua-hosting/blog/432496/">Conference DEFCON 18. You have spent all this money, but you continue to "have".</a>  <a href="https://habr.com/company/ua-hosting/blog/432496/">Part 2</a> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/tJsNu0VRKYY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Thank you for staying with us.  Do you like our articles?  Want to see more interesting materials?  Support us by placing an order or recommending to friends, <b>30% discount for Habr users on a unique analogue of the entry-level servers that we invented for you:</b> <a href="https://habr.com/company/ua-hosting/blog/347386/">The whole truth about VPS (KVM) E5-2650 v4 (6 Cores) 10GB DDR4 240GB SSD 1Gbps from $ 20 or how to share the server?</a>  (Options are available with RAID1 and RAID10, up to 24 cores and up to 40GB DDR4). <br><br>  <b>VPS (KVM) E5-2650 v4 (6 Cores) 10GB DDR4 240GB SSD 1Gbps until January free of charge</b> if you pay for a period of six months, you can order <a href="https://ua-hosting.company/vpsnl">here</a> . <br><br>  <b>Dell R730xd 2 times cheaper?</b>  Only we have <b><a href="https://ua-hosting.company/serversnl">2 x Intel Dodeca-Core Xeon E5-2650v4 128GB DDR4 6x480GB SSD 1Gbps 100 TV from $ 249</a> in the Netherlands and the USA!</b>  Read about <a href="https://habr.com/company/ua-hosting/blog/329618/">How to build an infrastructure building.</a>  <a href="https://habr.com/company/ua-hosting/blog/329618/">class c using servers Dell R730xd E5-2650 v4 worth 9000 euros for a penny?</a> </div><p>Source: <a href="https://habr.com/ru/post/432456/">https://habr.com/ru/post/432456/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../432440/index.html">A variety of browsers begins with us.</a></li>
<li><a href="../432442/index.html">Features of work in an international team. India</a></li>
<li><a href="../432444/index.html">Recognition of numbers. Practical guide. Part 1</a></li>
<li><a href="../432448/index.html">DonorSearch's experience in attracting young people to donate blood through geo-targeting VKontakte</a></li>
<li><a href="../432452/index.html">"GDPR 2.0": what to expect from the ePrivacy Regulation</a></li>
<li><a href="../432460/index.html">A simple explanation of simplicity. Chapter 1: Theoretically Easy</a></li>
<li><a href="../432462/index.html">J'Accuse! Janna Kalman's 122-year longevity record - fake?</a></li>
<li><a href="../432464/index.html">We study nitrogen lasers - part 1. Transverse discharge lasers</a></li>
<li><a href="../432466/index.html">[bookmark] Handbook of the legislation of the Russian Federation in the field of information security</a></li>
<li><a href="../432468/index.html">The Russian company instead of treating files encrypted with a virus pays attackers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>