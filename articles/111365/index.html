<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Real Common Lisp website in 9 steps</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 



 This introductory article is for those who want to try Common Lisp in web programming tasks. I will not dwell on the advantages of t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Real Common Lisp website in 9 steps</h1><div class="post__text post__text-html js-mediator-article"><h2>  Introduction </h2><br><br><img src="https://habrastorage.org/storage/5ced3326/202be91f/491fc41b/38fc97ac.jpg"><br><br>  This introductory article is for those who want to try Common Lisp in web programming tasks.  I will not dwell on the advantages of this language, <a href="http://habrahabr.ru/users/ababo/" class="user_link">ababo</a> did it for me in my introductory post <a href="http://habrahabr.ru/blogs/webdev/104349/">Developing Common Web-based Web Applications (Part One)</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I have been working on developing web applications in Common Lisp for a little over a year and have made a large online store on Common Lisp, which I think will warn the objections of those who believe that lisp is useless for commercial use. <br><br>  Today my task is to tell in details about the method of deployment of all the necessary infrastructure that I use.  Using this article as a step-by-step guide, an attentive reader will be able to deploy their own website in Lisp. <br><br>  Perhaps my approaches are not perfect - in this case I will be glad to constructive criticism - please do not hesitate if you do not like something - one of the goals of writing this article was to correct your own mistakes. <br><br>  For those who like to squander boring installation procedures - at the end of the article there is a small delicacy that may expand your view on web programming, if you haven‚Äôt dealt with lisp before this point.  Search for keywords SLIME and SWANK :) <br><a name="habracut"></a><br><br><h2>  Installing the latest version of SBCL </h2><br><br>  I use SBCL as the most convenient, common and free implementation of Common Lisp, closely intergrated with the Emacs environment, which provides convenient and comfortable work.  In the repositories, as a rule, there is not the latest version of SBCL, so you can compile it from sorts or install a binary for your architecture.  The latter is trivial, so in this article I will describe a compilation from source. <br><br>  To compile a fresh SBCL, you can use the old one, which we will immediately install using the package manager: <br><br><pre><code class="bash hljs">$ apt-get install sbcl</code> </pre> <br><br>  SBCL sources can be obtained here: <a href="http://sbcl.sourceforge.net/platform-table.html">sbcl.sourceforge.net/platform-table.html</a> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  $ wget http://downloads.sourceforge.net/project/sbcl/sbcl/1.0.45/sbcl-1.0.45-source.tar.bz2 #  : $ bzip2 -cd sbcl-1.0.45.tar.bz2 | tar xvf - #      $ cd sbcl-1.0.45/ $ sh make.sh #   SBCL    $ apt-get remove sbcl #   sbcl $ sh install.sh # ,    : $ sbcl This is SBCL 1.0.45, an implementation of ANSI Common Lisp. More information about SBCL is available at &lt;http://www.sbcl.org/&gt;. SBCL is free software, provided as is, with absolutely no warranty. It is mostly in the public domain; some portions are provided under BSD-style licenses. See the CREDITS and COPYING files in the distribution for more information. *</span></span></code> </pre><br><br>  Congratulations, you now have a fresh version of sbcl.  At the moment I am deploying it with you on my server to avoid possible inaccuracies and at the end of the article you can be sure that at least everything worked for me.  Well, let's hope that it will be so :) <br><br><h2>  We put quicklisp </h2><br><br>  Two package managers, ASDF and QuickLisp, are most often used to manage libraries.  The latter is much more friendly, and the first is already preinstalled with SBCL, so for now we will install QuickLisp for ourselves.  On <a href="http://quicklisp.org/">quicklisp.org</a> all the introductory information is posted, so I will not repeat and we will go straight to the installation: <br><br><pre> <code class="bash hljs">$ wget http://beta.quicklisp.org/quicklisp.lisp $ sbcl --load quicklisp.lisp * (quicklisp-quickstart:install) * (ql:add-to-init-file)</code> </pre><br><br><h2>  We put hunchentoot </h2><br><br>  Now that we have a library manager, we install <br>  hunchentoot web server, along with all its dependencies with one command: <br><br><pre> <code class="lisp hljs">* (<span class="hljs-name"><span class="hljs-name">ql</span></span><span class="hljs-symbol"><span class="hljs-symbol">:quickload</span></span> 'hunchentoot)</code> </pre><br><br><h2>  We put swank and slime on the server </h2><br><br><blockquote>  ‚ÄúAn even more impressive example of remote debugging occurred at NASA‚Äôs Deep Space 1 mission in 1998.  Six months after the launch of the spacecraft, a small Lisp code had to fly the spacecraft for two days to conduct a series of experiments.  However, the elusive race condition in the code was not revealed when testing on the ground and was discovered already in space.  When the error was detected in space (100 million miles from Earth), the team was able to diagnose and correct the working code, which allowed the experiment to be completed.  One programmer said the following about this: <br><br>  - Debugging a $ 100 million hardware program that is 100 million miles away is an interesting experience.  A spacecraft REPL provides invaluable opportunities to find and fix problems. ‚Äù <br></blockquote><br><br>  I heard about this incident long before I started to work on lisp myself, and frankly I took it as a bike that could never be repeated in our modern world of multi-megabyte executable files and equally heavy dynamic libraries.  However, having become acquainted with the capabilities of remote control of the lisp-image, I was convinced that it is no more difficult than working with the code on my machine.  And no incremental builds, lengthy compilation or downloads of scripts via ftp - using slime, I connect to a working system and can see and change almost everything, for example, implement hot-swappable code, or inspect any object, function or macro using powerful introspection tools. <br><br>  How it works?  - you ask.  Inside the Lisp image on a remote server, SWANK is running - a special library that provides a backend that provides access to all the controls on a Lisp image.  SWANK is written in Common Lisp and communicates with SLIME over a fairly simple text protocol. <br><br>  In my Emacs-e, SLIME works in Emacs Lisp, which allows me to send commands, pieces of code, definitions of objects and structures to a remote Common Lisp image when I edit a code file.  Thus, you can even not even have a copy of the source code on a remote server ‚Äî in this case, no attacker can change it there, for example, to secure a backdoor. <br><br>  And given the advanced tools for code generation, which distinguishes the lisp, you can have practically no code at all - let it be generated according to the data - better than a samurai who does not fight, there can only be a programmer who does not write code ... Hmm, something I here got carried away, back to the installation :) <br><br>  So, if you have a remote server, like mine - you can put SWANK on it, and SLIME - on your work machine.  Or <br>  to put both that and there and there and there - the main thing then is not to confuse.  Install SWANK: <br><br><pre> <code class="bash hljs">$ sbcl * (ql:quickload <span class="hljs-string"><span class="hljs-string">'swank)</span></span></code> </pre><br><br>  ... and SLIME <br><br><pre> <code class="bash hljs">$ wget http://common-lisp.net/project/slime/snapshots/slime-current.tgz $ tar xvzf slime-current.tgz $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> slime-2011-01-06/</code> </pre><br><br>  Carefully read the README in this directory and add to your <br>  ~ / .emacs / init.el the following code, following the correct paths <br><br><pre> <code class="lisp hljs"><span class="hljs-comment"><span class="hljs-comment">;; SBCL (setq inferior-lisp-program "/opt/sbcl/bin/sbcl") ; your Lisp system (setq slime-lisp-implementations '((sbcl ("sbcl")))) (setq slime-startup-animation nil) ;; SLIME (add-to-list 'load-path "~/.emacs.d/slime") ;;   slime (require 'slime) (setq slime-net-coding-system 'utf-8-unix) (slime-setup '(slime-fancy)) (setq slime-enable-evaluate-in-emacs t)</span></span></code> </pre><br><br><h2>  Put the screen </h2><br><br>  Since my servers never crash (yes :) - I use screen to keep an ever-running copy of SBCL, although as far as I know, there are better practices (of which competent readers will no doubt be reminded in the comments) <br><br>  If you don‚Äôt have it yet - it's time to put it: <br><br><pre> <code class="bash hljs">$ apt-get install screen</code> </pre><br><br><h2>  We start sbcl in screen on the server and we start the swank-server on port 4005 </h2><br><br><pre> <code class="bash hljs">$ screen -S sbcl $ sbcl * (require <span class="hljs-string"><span class="hljs-string">'asdf) * (asdf:oos '</span></span>asdf:load-op <span class="hljs-string"><span class="hljs-string">'swank) * (setq swank:*use-dedicated-output-stream* nil) * (swank:create-server :coding-system "utf-8-unix" :dont-close t :port 4005)</span></span></code> </pre><br><br><h2>  Connecting from Emacs-a running on your machine to a lisp image on the server </h2><br><br>  In the terminal we prokadyvaem to the host ssh-tunnel <br><br><pre> <code class="bash hljs">ssh -2 -N -f -L 4005:localhost:4005 user@host.tld</code> </pre><br><br>  In Emacs, connect through this tunnel. <br><br><pre> <code class="bash hljs">Mx slime-connect 127.0.0.1 4005</code> </pre><br><br>  Or, if your server is your home machine, you don‚Äôt need to switch anything and raise SWANK - just type in Emacs-e: <br><br><pre> <code class="bash hljs">Mx slime</code> </pre><br><br><h2>  We start the hunchentoot web-server on port 4242 </h2><br><br>  Now we are ready to raise the web server hunchentoot.  I raise it on port 4242 and use nginx as a proxy.  Also nginx gives statics and does a number of things for which it is designed as well as possible. <br><br>  The nginx config for our test purposes can be very simple: <br><br><pre> server {
    listen 80;
    server_name localhost;
     location / {
       proxy_pass http: // localhost: 4242;
       proxy_redirect off;
    }
 }
</pre><br><br>  The following code, under the authorship of <a href="http://habrahabr.ru/users/archimag/" class="user_link">archimag</a> -a, creates a special class that allows you to immediately forward this error along with the stack-trace to a cozy emacs when an error occurs on a remote server, where you can deal with it properly.  Thus, if you are connected to the server where your website is running - you will always be aware of the errors that occur at the time they appear, unlike some other languages ‚Äã‚Äãused in web programming. <br><br>  If there are too many errors, for example, visitors regularly visit the erroneous country page - you can simply change the value of * catch-errors-p * so that you can easily understand the errors that have come to you. <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defparameter</span></span> *catch-errors-p* <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) (<span class="hljs-name"><span class="hljs-name">defclass</span></span> debuggable-acceptor (<span class="hljs-name"><span class="hljs-name">hunchentoot</span></span><span class="hljs-symbol"><span class="hljs-symbol">:acceptor</span></span>) ()) (<span class="hljs-name"><span class="hljs-name">defmethod</span></span> hunchentoot<span class="hljs-symbol"><span class="hljs-symbol">:acceptor-request-dispatcher</span></span> ((<span class="hljs-name"><span class="hljs-name">acceptor</span></span> debuggable-acceptor)) (<span class="hljs-name"><span class="hljs-name">if</span></span> *catch-errors-p* (<span class="hljs-name"><span class="hljs-name">call-next-method</span></span>) (<span class="hljs-name"><span class="hljs-name">let</span></span> ((<span class="hljs-name"><span class="hljs-name">dispatcher</span></span> (<span class="hljs-name"><span class="hljs-name">handler-bind</span></span> ((<span class="hljs-name"><span class="hljs-name">error</span></span> #'invoke-debugger)) (<span class="hljs-name"><span class="hljs-name">call-next-method</span></span>)))) (<span class="hljs-name"><span class="hljs-name">lambda</span></span> (<span class="hljs-name"><span class="hljs-name">request</span></span>) (<span class="hljs-name"><span class="hljs-name">handler-bind</span></span> ((<span class="hljs-name"><span class="hljs-name">error</span></span> #'invoke-debugger)) (<span class="hljs-name"><span class="hljs-name">funcall</span></span> dispatcher request)))))) (<span class="hljs-name"><span class="hljs-name">defun</span></span> request-dispatcher (<span class="hljs-name"><span class="hljs-name">request</span></span>) <span class="hljs-string"><span class="hljs-string">"Hello!"</span></span>) (<span class="hljs-name"><span class="hljs-name">defparameter</span></span> *debuggable-acceptor* (<span class="hljs-name"><span class="hljs-name">make-instance</span></span> 'debuggable-acceptor <span class="hljs-symbol"><span class="hljs-symbol">:request-dispatcher</span></span> 'request-dispatcher <span class="hljs-symbol"><span class="hljs-symbol">:port</span></span> <span class="hljs-number"><span class="hljs-number">4242</span></span>)) (<span class="hljs-name"><span class="hljs-name">hunchentoot</span></span><span class="hljs-symbol"><span class="hljs-symbol">:start</span></span> *debuggable-acceptor*) (<span class="hljs-name"><span class="hljs-name">setf</span></span> hunchentoot<span class="hljs-symbol"><span class="hljs-symbol">:*handle-http-errors-p*</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)</code> </pre><br><br>  The request-dispatcher function is called with each incoming request and in our case simply returns ‚ÄúHello!‚Äù - we will talk about its expansion in the next article. <br><br>  If you have read this far <s>you should put a bottle for you</s> <s><br></s>  <s>beer</s> , and even raised a test site on a lisp - I‚Äôm <br>  I envy you!  Acquaintance with lisp gave me almost a year and a half <br>  enjoying this amazing language - and in this respect you have all <br>  in front.  Happy hacking! </div><p>Source: <a href="https://habr.com/ru/post/111365/">https://habr.com/ru/post/111365/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../111360/index.html">testcreator - automate student testing</a></li>
<li><a href="../111361/index.html">Dijkstra's algorithm. Search for optimal routes on the graph</a></li>
<li><a href="../111362/index.html">Microsoft Touch Mouse</a></li>
<li><a href="../111363/index.html">My approach to website design</a></li>
<li><a href="../111364/index.html">Access to the gyro and accelerometer from javascript</a></li>
<li><a href="../111369/index.html">Engadget's BlackBerry PlayBook Review</a></li>
<li><a href="../111370/index.html">Programming under N900 in Python</a></li>
<li><a href="../111371/index.html">HTTPS support added to Picasa Web</a></li>
<li><a href="../111372/index.html">Android Motorola Atrix replaces the system unit</a></li>
<li><a href="../111373/index.html">More than half of Android devices already at 2.2 FroYo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>