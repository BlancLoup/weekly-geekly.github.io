<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>NB-IoT: how does it work? Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Last time we talked about the features of the NB-IoT standard in terms of the radio access network architecture. Today, we reflect on what has changed...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>NB-IoT: how does it work? Part 2</h1><div class="post__text post__text-html js-mediator-article">  <b>Last time we talked about the features of the NB-IoT standard in terms of the radio access network architecture.</b>  <b>Today, we reflect on what has changed in the core network (Core Network) with NB-IoT.</b>  <b>So let's go.</b> <b><br></b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8bd/02e/574/8bd02e574b24c9955dc693bb5a5f3642.jpg" alt="image"><br><br>  There have been significant changes in the network core.  Let's start with the fact that a new element has appeared, as well as a number of mechanisms that are defined by the standard as ‚ÄúCIoT EPS Optimization‚Äù or optimization of the core network for the cellular Internet of things. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As you know, in mobile networks there are two main communication channels called Control Plane (CP) and User Plane (UP).  The Control Plane is designed for exchanging service messages between various network elements and serves to provide mobility (Mobility management) of devices (UE) and establish / maintain a data transfer session (Session Management).  User Plane - this is, in fact, the transmission channel of user traffic.  In classic LTE, the distribution of CP and UP across interfaces is as follows: <a name="habracut"></a><br><br><img src="https://habrastorage.org/getpro/habr/post_images/e6a/f57/257/e6af5725701496cca134e7fde45de5d5.png" alt="image"><br><br>  The CP and UP optimization mechanisms for NB-IoT are implemented on MME, SGW and PGW nodes, which are conventionally combined into a single element called C-SGN (Cellular IoT Serving Gateway Node).  The standard also assumes the appearance of a new network element - SCEF (Service Capability Exposure Function).  The interface between MME and SCEF is called T6a and is based on the DIAMETER protocol.  Although DIAMETER is a signaling protocol, in NB-IoT it is adapted to transmit small amounts of non-IP data. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7d9/a36/d53/7d9a36d53e5fa359b1e7d02da98a0cfc.png" alt="image"><br><br>  Based on the name, SCEF is a site for exhibiting service capabilities.  In other words, SCEF hides the complexity of the operator‚Äôs network, and also removes the need for identification and authentication of mobile devices (UE) from application developers, allowing the application servers (Application Server, further AS) to receive data and manage devices through a single API interface. <br><br>  The UE identifier is not a phone number (MSISDN) or an IP address, as was the case in the classic 2G / 3G / LTE network, but the so-called ‚Äúexternal ID‚Äù, which is defined by the standard in the familiar for application developers format &lt;Local Identifier&gt; @ &lt;Domain Identifier&gt; ".  This is a separate big topic that deserves a separate material, therefore we will not discuss this in detail now. <br><br>  Now let's look at the most significant innovations.  CIoT EPS Optimization is the optimization of the traffic transmission and subscriber session management mechanisms.  Here are the main ones: <br><br><ul><li>  DoNAS </li><li>  NIDD </li><li>  PSM and eDRX power saving mechanisms </li><li>  Hlcom </li></ul><br>  <b>DoNAS (Data over NAS):</b> <br><br>  This is a mechanism designed to optimize the transfer of small amounts of data. <br><br>  In classic LTE, the subscriber device establishes a PDN connection (hereinafter PDN) through the eNodeB to the MME-SGW-PGW when registering on the network.  The UE-eNodeB-MME connection is the so-called ‚ÄúSignaling Radio Bearer‚Äù (SRB).  If it is necessary to transmit / receive data, the UE establishes another connection with the eNodeB - ‚ÄúData Radio Bearer‚Äù (DRB), to transfer user traffic to the SGW and then to the PGW (interfaces S1-U and S5, respectively).  At the end of the exchange and if there is no traffic for some time (usually 5-20 seconds), these connections are broken and the device goes into standby mode or ‚ÄúIdle Mode‚Äù.  If it is necessary to exchange a new portion of data, SRB and DRB are reset. <br><br>  In NB-IoT, user traffic can be transmitted through the signaling channel (SRB), in NAS protocol messages ( <a href="http://www.3gpp.org/more/96-nas">http://www.3gpp.org/more/96-nas</a> ).  Establishing a DRB is no longer required.  This significantly reduces the signaling load, saves the radio resources of the network and, most importantly, extends the life of the device's battery. <br><br>  In the eNodeB - MME section, user data begins to be transmitted via the S1-MME interface, which was not the case in the classical LTE technology, and the NAS protocol is used for this, in which ‚ÄúUser data container‚Äù appears. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b38/3ca/091/b383ca091aff5634b77f798c124ea537.png" alt="image"><br><br>  To implement the transfer of ‚ÄúUser Plane‚Äù from MME to SGW, a new interface S11-U appears, which is designed to transmit small amounts of user data.  The S11-U protocol is based on GTP-U v1, which is used to transmit User Plane and other interfaces of the 3GPP architecture network. <br><img src="https://habrastorage.org/getpro/habr/post_images/291/414/312/2914143120918a42d83230b40eb7f4e1.png" alt="image"><br>  <b>NIDD (non-IP data delivery):</b> <br><br>  As part of further optimizing the mechanisms for transferring small amounts of data, in addition to the existing types of PDNs, such as IPv4, IPv6 and IPv4v6, another type has emerged - non-IP.  In this case, the UE is not assigned an IP address, and the data is transmitted without using the IP protocol.  There are several reasons for this: <br><br><ol><li>  IoT devices, such as sensors, can transfer very small amounts of data, 20 bytes and even less.  Given that the minimum IP header size is 20 bytes, encapsulation in IP can sometimes be quite expensive; </li><li>  There is no need to implement an IP stack in the chip, which leads to their reduction in price (the question is discussed in the comments). </li></ol><br>  By and large, an IP address is needed by IoT devices to transmit data over the Internet.  In the NB-IoT concept, SCEF acts as a single point of connection AS, and data is exchanged between devices and application servers via an API.  In the absence of SCEF non-IP, data can be transmitted to the AS via Point-to-Point (PtP) tunnel from PGW and encapsulation in IP will be made already on it. <br><br>  All this fits into the NB-IoT paradigm - maximum simplification and cheapening of devices. <br><br>  <b>PSM and eDRX power saving mechanisms:</b> <br><br>  One of the key benefits of LPWAN networks is energy efficiency.  Declared up to 10 years of autonomous operation of the device on a single battery.  We will understand how such values ‚Äã‚Äãare achieved. <br><br>  When does the device consume the least energy?  That's right, when it's off.  And if it is impossible to completely de-energize the device, let's de-energize the radio module for the time it is not necessary.  Only it is necessary to coordinate this with the network. <br><br>  <b>PSM (Power saving mode):</b> <br><br>  The PSM power saving mode allows the device to permanently turn off the radio module, while remaining registered on the network, and not to reinstall the PDN every time it is necessary to transfer data. <br><br>  In order for the network to know that the device is still available, it periodically initiates the update procedure - Tracking Area Update (TAU).  The frequency of this procedure is set by the network using a timer T3412, the value of which is transmitted to the device during the Attach procedure or the next TAU.  In classic LTE, the default value of this timer is 54 minutes, and the maximum is 186 minutes.  However, to ensure high energy efficiency, the need to go on the air every 186 minutes is too expensive.  To solve this problem, the PSM mechanism was developed. <br><br>  The device activates the PSM mode by transmitting in the ‚ÄúAttach Request‚Äù or ‚ÄúTracking Area Request‚Äù messages the values ‚Äã‚Äãof the two timers T3324 and T3412-Extended.  The first determines the time that the device will be available after the transition to "Idle Mode".  The second is the time after which TAU should be produced, only now its value can reach 35712000 seconds or 413 days.  Depending on the settings, the MME may accept the timer values ‚Äã‚Äãreceived from the device, or modify them by sending new values ‚Äã‚Äãin the ‚ÄúAttach Accept‚Äù or ‚ÄúTracking Area Update Accept‚Äù messages.  Now the device may not turn on the radio module for 413 days and remain registered with the network.  As a result, we get a tremendous saving of network resources and energy efficiency of devices! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/454/acd/f5b/454acdf5be7596292b607513eeacaac7.png" alt="image"><br><br>  However, in this mode, the device is not available only for incoming communications.  If it is necessary to transfer something towards the application server, the device can exit PSM at any time and send data, remaining active during the T3324 timer for receiving informational messages from the AS (if any). <br><br>  <b>eDRX (extended discontinuous reception):</b> <br><br>  eDRX, advanced intermittent reception.  To transfer data to a device that is in ‚ÄúIdle mode‚Äù, the network performs the notification procedure - ‚ÄúPaging‚Äù.  When receiving a paging device initiates the establishment of SRB for further communication with the network.  But in order not to miss the Paging message addressed to him, the device must constantly monitor the airwaves, which is also quite energy-intensive. <br><br>  eDRX is a mode in which the device receives messages from the network not permanently, but periodically.  During Attach or TAU procedures, the device coordinates with the network the time intervals during which it will ‚Äúlisten‚Äù to the broadcast.  Accordingly, the Paging procedure will be performed at the same intervals.  In eDRX mode, the device operation is divided into cycles (eDRX cycle).  At the beginning of each cycle, there is a so-called ‚Äúpaging window‚Äù (Paging Time Window, hereinafter PTW) - this is the time that the device listens to the radio channel.  At the end of the PTW, the device turns off the radio module until the end of the cycle. <br><img src="https://habrastorage.org/getpro/habr/post_images/6db/904/b06/6db904b06c01b940885b43683cc8c905.png" alt="image"><br>  <b>HLCOM (high latency communication):</b> <br><br>  If it is necessary to transfer data to the Uplink, the device can exit any of these two power saving modes without waiting for the end of the PSM or eDRX cycle.  But transferring data to a device is possible only when it is active. <br><br>  HLCOM functionality or high latency communication is the downlink buffering of packets on the SGW for as long as the device is in power saving mode and is not available for communication.  The buffered packets will be delivered as soon as the device leaves PSM, making a TAU or transmitting Uplink traffic, or when PTW arrives. <br><br>  This, of course, requires awareness from the developers of IoT products, since communication with the device is not real-time and requires a certain approach to the design of business logic of the applications. <br><br>  In conclusion, let us say: the introduction of a new one always captures, and now we are dealing with a standard that is not completely tested even by world bison, like Vodafone and Telefonica - therefore it is doubly exciting.  Our presentation of the material does not pretend to be absolute, but we hope provides a sufficient understanding of the technology.  We would appreciate feedback. <br><br>  <i>Author: Expert of Convergent Solutions and Multimedia Services Alexey Lapshin <a href="https://habr.com/users/aslapsh/" class="user_link">aslapsh</a></i> </div><p>Source: <a href="https://habr.com/ru/post/431648/">https://habr.com/ru/post/431648/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../431636/index.html">How to celebrate the day of information security</a></li>
<li><a href="../431638/index.html">How we got into the IB department of a large company and started working in it. Diary of two young and promising professionals</a></li>
<li><a href="../431642/index.html">Beekeepers against microcontrollers or about the benefits of errors</a></li>
<li><a href="../431644/index.html">Straight line with TM. v4.0</a></li>
<li><a href="../431646/index.html">DataGrip 2018.3: Cassandra support, generating SQL files from objects, many improvements in auto-completion, and much more.</a></li>
<li><a href="../431650/index.html">Learning Latency: Queuing Theory</a></li>
<li><a href="../431652/index.html">Reservoir Sampling Algorithm</a></li>
<li><a href="../431654/index.html">Trends in programming languages ‚Äã‚Äã2019</a></li>
<li><a href="../431656/index.html">CraSSh: breaking all modern browsers with CSS calculations</a></li>
<li><a href="../431660/index.html">Game features with ECS: we add kits to the shooter</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>