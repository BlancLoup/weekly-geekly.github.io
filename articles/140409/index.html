<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Django Admin Actions - actions with an intermediate page</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hey. Useful thing action in the admin! I want to share how you can make an action that after selecting the elements will send the user to an intermedi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Django Admin Actions - actions with an intermediate page</h1><div class="post__text post__text-html js-mediator-article">  Hey.  Useful thing action in the admin!  I want to share how you can make an action that after selecting the elements will send the user to an intermediate page so that you can do something special with these elements.  Example?  For example, you have an online store, a table of products.  You want to transfer part of the goods from one section (book) to another (technical books).  Select the books you need, select the action ‚ÄúMove to another section‚Äù, click apply, go to the intermediate page, select the desired section and click save.  Great?  Let's try. <br><a name="habracut"></a><br>  We describe the form: <br><br><pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ChangeCategoryForm</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(forms.Form)</span></span></span><span class="hljs-class">:</span></span> _selected_action = forms.CharField(widget=forms.MultipleHiddenInput) category = forms.ModelChoiceField(queryset=Category.objects.all(), label=<span class="hljs-string"><span class="hljs-string">u' '</span></span>)</code> </pre> <br>  Mysterious field <b>_select_action</b> , yes?  There will be ID of the selected items.  Django will pick them up from the POST request and make a Queryset for which we will do our actions (see the code below). <br><br>  Our action is always a method.  Let's call it move_to_category. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_to_category</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(modeladmin, request, queryset)</span></span></span><span class="hljs-function">:</span></span> form = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">'apply'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> request.POST: form = ChangeCategoryForm(request.POST) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> form.is_valid(): category = form.cleaned_data[<span class="hljs-string"><span class="hljs-string">'category'</span></span>] count = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> queryset: item.category = category item.save() count += <span class="hljs-number"><span class="hljs-number">1</span></span> modeladmin.message_user(request, <span class="hljs-string"><span class="hljs-string">" %s   %d ."</span></span> % (category, count)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HttpResponseRedirect(request.get_full_path()) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> form: form = ChangeCategoryForm(initial={<span class="hljs-string"><span class="hljs-string">'_selected_action'</span></span>: request.POST.getlist(admin.ACTION_CHECKBOX_NAME)}) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> render(request, <span class="hljs-string"><span class="hljs-string">'catalog/move_to_category.html'</span></span>, {<span class="hljs-string"><span class="hljs-string">'items'</span></span>: queryset,<span class="hljs-string"><span class="hljs-string">'form'</span></span>: form, <span class="hljs-string"><span class="hljs-string">'title'</span></span>:<span class="hljs-string"><span class="hljs-string">u' '</span></span>}) move_to_category.short_description = <span class="hljs-string"><span class="hljs-string">u" "</span></span></code> </pre><br>  We declare an action in the class ProductAdmin: <br><br><pre> <code class="python hljs">actions = [move_to_category,]</code> </pre><br>  And create a template to show it all. <br><br><pre> <code class="html hljs xml">{% extends "admin/base_site.html" %} {% block content %} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span><span class="hljs-tag">&gt;</span></span>{% csrf_token %} {{ form }} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>      :<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span>{{ items|unordered_list }}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"action"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"move_to_category"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"apply"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> {% endblock %}</code> </pre><br>  That's all.  In this way you can do very, very much all sorts of important, necessary and interesting things. <br><br>  And finally, I want to bring screenshots from the working draft that show how it all works. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4d9/9ac/78e/4d99ac78e7ae6645664a26cd81886b62.jpg" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/ecc/03f/3ea/ecc03f3eac24f7d355e4f0003ecf1872.jpg" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/f56/0e4/b95/f560e4b9531da6345495b70138e9c388.jpg" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/b31/60f/bbc/b3160fbbcd064da18f2a79a27d58c45d.jpg" alt="image"><br><br>  Good luck! </div><p>Source: <a href="https://habr.com/ru/post/140409/">https://habr.com/ru/post/140409/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../140400/index.html">jQuery File Upload</a></li>
<li><a href="../140401/index.html">Published the full program of the conference WebProfessionals in Samara</a></li>
<li><a href="../140403/index.html">Runetology (139): special edition of Runet Salaries</a></li>
<li><a href="../140404/index.html">Why does the Feistel network work? Explanation "on the fingers"</a></li>
<li><a href="../140405/index.html">Bitcasa has started!</a></li>
<li><a href="../140411/index.html">Create moving pictures with Processing</a></li>
<li><a href="../140412/index.html">Muz.ru gives audio for free</a></li>
<li><a href="../140414/index.html">Caching in Yii using tags</a></li>
<li><a href="../140415/index.html">Connecting a color LCD touch screen to a microcontroller</a></li>
<li><a href="../140417/index.html">Intellect cards as a good way to systematize any activity.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>