<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Pastilde - open hardware password manager</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A lot of notes and discussions are devoted to the difficult issue of safe storage of passwords, an interesting topic and it seems to be relevant for a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Pastilde - open hardware password manager</h1><div class="post__text post__text-html js-mediator-article"> <a href="https://habrahabr.ru/post/305594/"><img alt="Pastilda - open source USB hardware password manager" src="https://habrastorage.org/files/278/ea9/c7e/278ea9c7e69d41b78e3642add4ec507e.JPG"></a> <br><br>  A lot of notes and discussions are devoted to the difficult issue of safe storage of passwords, an interesting topic and it seems to be relevant for a long time.  There are various software solutions for storing passwords, they are often written on Habr√© (for example, <a href="https://habrahabr.ru/post/225053/">here</a> and <a href="https://habrahabr.ru/post/125248/">here</a> ), but many of them, it seems to us, have the following disadvantages to one degree or another: <br><ul><li>  closed code reduces trust and the likelihood of promptly eliminating vulnerabilities </li><li>  for auto-fill you need to put additional software </li><li>  after entering the master password, the entire database is open and accessible, including for malware, which is especially important on untrusted devices </li><li>  the use of mobile applications for storing passwords still implies manual input from the keyboard, for example, when you need to log in to a stationary PC </li><li>  autocompletion is impossible in some cases (in bios, console) </li></ul><br>  We concluded that the most convenient solution would be a simple and inexpensive device that allows hardware to store and enter usernames / passwords on any devices without installing any software. <br><a name="habracut"></a><br><br> <a href=""><img alt="Pastilda - open source USB hardware password manager" src="https://habrastorage.org/files/db2/7d4/d55/db27d4d558ed4af786106bbd57421cf7.png" height="400"></a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For a start, we, of course, read the entire Internet in order to understand who else had the idea to store and enter passwords in hardware, and how it was implemented.  <a href="https://docs.google.com/spreadsheets/d/1q-vCx8QxtwEWVKSXha0V2XxxN7ILDdTP-DDhrjcpeiQ/edit%3Fusp%3Dsharing">Found options</a> can be divided into the following categories: <br><ul><li>  encrypted drives, in fact - just flash drives with a password (for example, <a href="http://www.byte-on.ru/catalog/Istorage-DatAshur/fleshka_istorage_datashur_pro_16gb/">such</a> ).  You can safely store documents, but we are not talking about automatic password input. </li><li>  devices with biometric identification ( <a href="https://www.kickstarter.com/projects/myidkey/myidkey-passwords-at-the-tip-of-your-finger/description">example</a> ).  Biometric identification looks attractive, but it is less versatile than a character password (for example, if you need to remotely give someone access to the device, fingerprint transmission will become a real problem), and additional sensors increase the cost of the product.  In the case of compromising difficult to quickly change prints </li><li>  software password managers with a hardware token-key, which gives access to the database ( <a href="https://www.kickstarter.com/projects/199263837/logmeonce-your-password-manager-secure-usb-and-pho/description">for example</a> ) have the same drawbacks as key-token-based software managers </li><li>  devices for entering 1-4 passwords and their generation ( <a href="https://www.kickstarter.com/projects/1048259057/openkey-the-two-factor-authentication-and-password/description">example</a> , <a href="https://hackaday.io/project/8342-memtype-open-source-password-keeper">example</a> ).  The closest solutions.  Among the shortcomings, a limited number of stored passwords should be noted, as well as the management of only buttons on the device, which is not always convenient. </li></ul><br>  None of the devices found fully corresponded to our idea.  We were delighted - and let's think further. <br><br><h2>  Idea </h2><br>  Not so long ago, we began to use <a href="http://keepass.info/">KeePass</a> for corporate tasks of storing passwords instead of paper, browsers and biological memory.  Fully satisfied with the convenience and versatility of this product, we decided to adapt it for the tasks of hardware password storage, porting to the microcontroller. <br>  However, a huge number of questions remained.  How to choose the desired entry in the database on the device?  How to show the user what record is selected?  Should I place buttons on the device?  Screen?  How is it supposed to connect to a computer?  To the tablet?  To the phone? <br><br>  The screen was abandoned immediately.  If the user already needs to enter a password - most likely, he already has a screen.  As for connection methods, we decided not to consider wireless interfaces, due to their potential vulnerability to interception. <br><br> <a href=""><img alt="Pastilda, use with keyboard" src="https://habrastorage.org/files/b68/33b/c29/b6833bc295db4c38b599f1b33630509e.jpg" height="400"></a> <br><br>  For management, we will use a standard keyboard, and for direct input of saved passwords into forms, we will emulate keyboard commands.  ‚ÄúInterception‚Äù control will occur when you enter a special key combination.  By default, we chose <i>Ctrl + Shift + ~</i> , because it is convenient for clicking and almost never used.  The project was named ‚ÄúPastilda‚Äù (from password, tilda), we associate it with something tasty and sweet, and also help not to forget the main keyboard shortcut for working with the device. <br><br>  Being in passive mode, Pastilda transmits all messages from the keyboard to the PC without changes, waiting for a special combination to be pressed.  After entering the combination, the device enters the active mode.  If at this moment the cursor is in the text entry field - it can be the ‚ÄúLogin‚Äù field, or any other text field - a single-line text menu appears in it. <br><br><img alt="Pastilda, password entry" src="https://habrastorage.org/files/b3a/db7/259/b3adb72598714007ba4ea43ecabf3e1a.gif"><br><br>  To work with the KeePass database stored in Pastilde‚Äôs memory, the user enters a master password, and then selects the name of the account of interest for him with the navigation keys and presses input.  Pastilde enters the necessary login and password in the appropriate fields.  In this case, the database is decrypted on the device, and the target system does not get access to the master password and to the entire database.  The exit from the active mode occurs either automatically, after entering the password, or after pressing the ‚ÄúShift + Ctrl + ~‚Äù combination again.  Yes, by the way, you can create your own combinations. <br><br><h2>  Implementation 0.1 </h2><br>  As always, I want to realize a lot of things, but decided to start small.  Revision 0.1 is designed to test ideas, ease of use and all kinds of pampering.  In the current version, the following minimum functions are scheduled: <br><ul><li>  composite USB device (HID + Mass Storage) </li><li>  USB host </li><li>  work with one base KeePass </li><li>  single line menu </li><li>  FAT16. </li></ul><br><br><h3>  Scheme </h3><br> <a href=""><img src="https://habrastorage.org/files/71d/4b5/8f5/71d4b58f57d84163ba99520f3f56a342.png" height="400"><br></a> <br>  Everything is simple - a Stm32f405 controller, two connectors and a flash drive on the SPI.  Just a bit of protection, a SWD connector and, of course, an RGB LED.  The choice of components did not cause difficulties - we just love STM <s>, it seems, the only one who implemented two USB hardware in the microcontroller</s> , and what memory was taken. <br><br><h3>  Pay </h3><br> <a href=""><img src="https://habrastorage.org/files/88b/c42/401/88bc42401a754b5da64a8efe5230d2b2.jpg" height="400"></a> <br><br>  All components are in conventional enclosures so that the board is cheap and fast to manufacture.  Size 40x17 mm, 4 layers.  The current version of the board looks like this: <br><br> <a href=""><img src="https://habrastorage.org/files/4d4/570/b2b/4d4570b2b173447a9adac2af703ed8fa.png" height="200"></a> <a href=""><img src="https://habrastorage.org/files/868/04e/232/86804e232bc645e0972aeaf4bf008a9c.png" height="200"></a> <br><br><h3>  Soft </h3><br>  Currently implemented: <br><ul><li>  USB host, in order to recognize the keyboard connected to the device and push messages from it further to the PC </li><li>  Composite USB device (msd + hid): in Pastilda mode, the device should be able to be a keyboard, in addition, always be available as an external drive, for easily adding and deleting passwords (By the way, @anaLazareva <a href="https://habrahabr.ru/post/304924/">solved the problem with usb_msc libopencm3.</a> </li></ul><br>  Waiting for his fate: <br><ul><li>  FAT for reading data stored in flash memory, so that we can go through directories and take the desired password </li><li>  KeePass decoding, work with records </li><li>  menu. <br></li></ul><br>  Programmers will write about their harsh everyday life in separate articles. <br><br><h2>  What's next? </h2><br>  Further more.  I want to implement work with any devices that understand the external keyboard.  We have already tested the work of our prototype with an Android-smartphone via USB OTG, everything works fine.  For the convenience of navigating the menu when using Pastilde with mobile devices, we will make a separate USB-module with a wheel-button. <br><br> <a href=""><img src="https://habrastorage.org/files/63d/0d8/b92/63d0d8b92df041a6ac1f64d727f9712e.jpg" height="400"></a> <br><br>  Another idea is a small flexible-rigid printed circuit board, which is loaded directly into the USB connector, being between the host and device contacts.  A hard piece of the board with components is glued onto the device case.  Thus, the device will be quite difficult to detect.  However, why would we need this?  Just an idea. <br><br> <a href=""><img src="https://habrastorage.org/files/ff8/0ba/c77/ff80bac77cb84534b02c8a67032c347e.png" height="400"></a> <br><br>  Pastelda's built-in memory can be used to store data (if speed is not particularly important), and there are options: just a USB drive, which is always visible when the device is connected, or an encrypted drive.  KeePass databases, key files, etc.  supposed to be stored in this space. <br><br><h2>  Open all </h2><br>  The code is laid out on <a href="https://github.com/thirdpin/pastilda">github</a> , together with iron.  GNU GPL license.  Naturally, you can cut something of your own on the basis of this project, such ideas came to our mind: <br><ul><li>  kbd + mouse emulation for game cheating </li><li>  Stream hardware encryption USB flash. </li></ul><br><br>  The main goal of this article is to hear your opinion, feel free to comment! <br><br>  <b>UPD Jun 27, 2017:</b> <br><ul><li>  The Pastilda project repository moved <a href="https://bitbucket.org/thirdpin_team/pastilda">here</a> .  The release 1.0 was recently published. </li><li>  Latest news on the project can be viewed <a href="https://www.crowdsupply.com/third-pin/pastilda">here</a> . </li><li>  And we finally launched <a href="http://www.pastilda.com/">the project site</a> ! </li></ul></div><p>Source: <a href="https://habr.com/ru/post/305594/">https://habr.com/ru/post/305594/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../305580/index.html">Global range of FINTECH accelerators</a></li>
<li><a href="../305582/index.html">9 Russian companies that make interesting content</a></li>
<li><a href="../305584/index.html">UltraVDS has launched a loyalty program for its VDS / VPS servers</a></li>
<li><a href="../305586/index.html">Everything under control: we protect corporate conversations</a></li>
<li><a href="../305590/index.html">Hidden e-commerce hazards and valid SSL certificates</a></li>
<li><a href="../305596/index.html">iOS 10: new in creating animations</a></li>
<li><a href="../305598/index.html">Citrix and OpenStack History</a></li>
<li><a href="../305600/index.html">Short cheat sheet on locks when reading and changing data depending on the transaction isolation level in MSSQL</a></li>
<li><a href="../305602/index.html">Two in one: USB host and composite USB device</a></li>
<li><a href="../305604/index.html">Self-learning chess program</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>