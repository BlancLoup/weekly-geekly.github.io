<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Home server from scratch</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When the capabilities of the staff router with ‚Äúopenwrt‚Äù on board were completely depleted and the processor load began to affect the stability of the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Home server from scratch</h1><div class="post__text post__text-html js-mediator-article">  When the capabilities of the staff router with ‚Äúopenwrt‚Äù on board were completely depleted and the processor load began to affect the stability of the network, it was decided to relieve the hard worker by transferring the functionality to the home server.  In view of the fact that the piece of iron will be several orders of magnitude more powerful, it was decided to provide it with a bunch of additional features that the old man never even dreamed of.  The hull was also decided to do it yourself. <br><br>  <b>The list of tasks that the home server performs:</b> <br><br><ol><li>  Virtualbox server based on virtualbox c WebGUI; </li><li>  Firewall; </li><li>  A torrent rocking chair based on the transmission and a file server; </li><li>  Telephony server based on Asterisk; </li><li>  TFTP server for network booting and configuration of various equipment; </li><li>  Private cloud to store files based on "owncloud"; </li><li>  HTTP proxy Ace Stream for viewing TorrentTV; </li><li>  Hosting for a home site with access via https; </li></ol><br>  Photos to attract attention: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/917/bfa/bbb/917bfabbb2df46b7a74b11f303a0c2e7.jpg"><br><a name="habracut"></a><br><h1>  Chapter 1. Build, Build </h1><br>  The main functionality described, proceed to the selection of iron for the whole of this economy. <br><br>  <b>After much deliberation and a couple of tests, the following components were purchased:</b> <br><ol><li>  Motherboard msi j1800i format Mini-ITX; </li><li>  2 levels of DDR3 memory for 2 GB each; </li><li>  230 watt power supply; </li><li>  2 2.5 'hard drives for 320 GB were available; </li><li>  The tp-link 1043ND router was available (It was a shame to throw it away); </li></ol><br><br>  After evaluating the dimensions, it was time to make a new house for them, I did not consider buying a case, because I don‚Äôt buy what I want in the city, and it‚Äôs interesting to do it myself. <br><br>  Unfortunately, there are no photos of the process of creating the case, but I will briefly describe the process.  After the creation of the drawing was completed, it was transferred to plywood 6 mm thick and cut with a cutter assembled on the knee from an old transformer and nichrome thread.  How to make this yourself, you can see <a href="https://www.youtube.com/watch%3Fv%3DDuKzOuVNqHQ">here</a> . <br><br><div class="spoiler">  <b class="spoiler_title">The result was the following</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/d2e/88a/892/d2e88a8928c44fc2901840bf3da63d16.jpg"><br><br><img src="https://habrastorage.org/files/956/b40/bc2/956b40bc252946538831cf4530ddc5eb.jpg"><br><br><img src="https://habrastorage.org/files/956/b40/bc2/956b40bc252946538831cf4530ddc5eb.jpg"><br><br><img src="https://habrastorage.org/files/e10/306/510/e1030651053f43dfa5b8b3afd35fe461.jpg"><br><br><img src="https://habrastorage.org/files/e70/cdd/cd0/e70cddcd0b5749bf81e0c13ef4285e30.jpg"><br><br><img src="https://habrastorage.org/files/917/bfa/bbb/917bfabbb2df46b7a74b11f303a0c2e7.jpg"><br></div></div><br><br><h1>  Chapter II  Customization </h1><br>  With the iron part sorted out, now it's time to start configuring the functionality.  The 64-bit ‚ÄúDebian 7 netinstall‚Äù was chosen as the OS, and during the installation the disks were merged into software RAID0.  Anticipating a holivar, on the topic of fault tolerance, all the important data lies in the clouds, so if a disk fails, the system can be deployed from a backup copy rather quickly. <br><br>  The system is installed, proceed to the implementation of the above plan. <br><br><h2>  2.1 Virtualbox server based on virtualbox c WebGUI </h2><br>  To maximize the use of iron resources, you will need to install a virtualization server; in this case, the virtualbox software package is used. <br><br><div class="spoiler">  <b class="spoiler_title">Install virtualbox + phpvirtualbox</b> <div class="spoiler_text">  <b>Install the virtualbox server virtualization, on our server, first we will add the repository and the keys to it:</b> <br><br><pre><code class="bash hljs">deb http://download.virtualbox.org/virtualbox/debian wheezy contrib non-free wget -q http://download.virtualbox.org/virtualbox/debian/oracle_vbox.asc -O- | apt-key add ‚Äì</code> </pre> <br><br>  <b>Update the repository and run the virtualbox installation:</b> <br><br><pre> <code class="bash hljs">aptitude update aptitude install virtualbox-4.3</code> </pre><br>  <b>Install the extension for virtualbox:</b> <br><br><pre> <code class="bash hljs">wget http://download.virtualbox.org/virtualbox/4.3.14/Oracle_VM_VirtualBox_Extension_Pack-4.3.14.vbox-extpack VBoxManage extpack install Oracle_VM_VirtualBox_Extension_Pack-4.3.12.vbox-extpack</code> </pre><br>  <b>Reboot the vboxweb-service service with the commands:</b> <br><br><pre> <code class="bash hljs">/etc/init.d/vboxweb-service stop /etc/init.d/vboxweb-service start</code> </pre><br>  For Virtualbox to work, you need to create a user under which virtual machines will run. <br><br>  <b>Add a vbox user:</b> <br><br><pre> <code class="bash hljs">adduser vbox</code> </pre><br><h3>  Install phpvirtualbox </h3><br>  <b>First, install apache and php:</b> <br><br><pre> <code class="bash hljs">apt-get install apache php</code> </pre><br>  <b>Download phpvirtualbox:</b> <br><br><pre> <code class="bash hljs">wget -c -t0 http://optimate.dl.sourceforge.net/project/phpvirtualbox/phpvirtualbox-4.3-2.zip</code> </pre><br>  <b>Unpack the contents of the phpvirtualbox-4.3-2.zip archive into the web server folder:</b> <br><br><pre> <code class="bash hljs">unzip phpvirtualbox-4.3-2.zip</code> </pre><br>  <b>Rebooting the web server:</b> <br><br><pre> <code class="bash hljs">/etc/init.d/apache2 restart</code> </pre><br>  <b>Go to the directory phpvirtualbox in the web server folder and create a configuration file:</b> <br><br><pre> <code class="bash hljs">mv config.php-example config.php</code> </pre><br>  <b>We make some edits:</b> <br><br><pre> <code class="bash hljs">nano config.php var <span class="hljs-variable"><span class="hljs-variable">$username</span></span> = <span class="hljs-string"><span class="hljs-string">'vbox'</span></span>; var <span class="hljs-variable"><span class="hljs-variable">$password</span></span> = <span class="hljs-string"><span class="hljs-string">'     vbox'</span></span>; var <span class="hljs-variable"><span class="hljs-variable">$location</span></span> = <span class="hljs-string"><span class="hljs-string">'http://IP   :18083/'</span></span>; var <span class="hljs-variable"><span class="hljs-variable">$consoleHost</span></span> = <span class="hljs-string"><span class="hljs-string">'IP   '</span></span>;</code> </pre><br>  <b>Edit the virtualbox configuration file:</b> <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'VBOXWEB_USER=vbox VBOXWEB_HOST= IP    VBOXWEB_PORT=18083 '</span></span> &gt; /etc/default/virtualbox</code> </pre><br>  <b>Restart virtualbox:</b> <br><br><pre> <code class="bash hljs">/etc/init.d/vboxweb-service restart</code> </pre><br>  <b>Open in the browser the address of our server:</b> <br><br>  http: // <b>IP Address of this machine</b> / phpvirtualbox / <br>  login: admin <br>  password: admin <br>  The web interface is almost the same as the desktop version of Virtualbox. <br></div></div><br><h2>  2.2 Firewall </h2><br>  We proceed to the design of the home network, in the general concept of the network is as follows: <br><br><img src="https://habrastorage.org/files/ab1/851/1d7/ab18511d73bd433aaadbedc062656fce.jpg"><br><br>  It is necessary to reconfigure the router a little.  In the ‚Äúopenwrt‚Äù settings, we create the required number of VLANs and distribute the ports on them, since this motherboard has only one ethernet port, then we make it trunked and we start all VLAN with tags to it. <br><br>  We re-configure network adapters on our server, before this you need to install a package to support vlan: <b>apt-get install vlan</b> . <br><br><div class="spoiler">  <b class="spoiler_title">Network setting on the server</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># The loopback network interface auto lo iface lo inet loopback #NATIVE VLAN NETWORK auto eth0.1 iface eth0.1 inet static address 192.168.1.3 netmask 255.255.255.0 gateway 192.168.1.1 vlan_raw_device eth0 up ifconfig eth0.1 up #PROVIDER1 VLAN auto eth0.2 iface eth0.2 inet manual vlan_raw_device eth0 up ifconfig eth0.2 up #PROVIDER2 VLAN auto eth0.3 iface eth0.3 inet manual vlan_raw_device eth0 up ifconfig eth0.3 up #SIP VLAN auto eth0.4 iface eth0.4 inet manual vlan_raw_device eth0 up ifconfig eth0.4 up # GUEST NETWORK auto eth0.10 iface eth0.10 inet manual vlan_raw_device eth0 up ifconfig eth0.10 up</span></span></code> </pre><br></div></div><br>  As a firewall, I chose the implementation of "cisco ASA" on a virtual machine.  I will not argue: the decision is strange, incredibly crutch, but due to the need to connect to the working networks of several companies via the ‚ÄúIPsec site to site vpn‚Äù with similar pieces of hardware, but in a normal design. <br><br>  Immediately I wanted to note that it has been working stably for 4 months, there are no problems, the link is stable, the connection speed for this implementation turned out to be ~ 20 Mbit / s, which is quite good, given that the amount of data transferred is small.  In my implementation, this virtual machine manages all incoming and outgoing connections in all VLANs of the home network, the total system load does not exceed 12%. <br><br>  Downloading the image of the Cisco ASA 8.4 for vmware virtual machine, I will not give links since the first link in the search engine will most likely lead you to it.  We load on our server, and we import our car in virtualbox.  Along the way, we change all adapters to ‚ÄúPCnet-PCI II‚Äù and after import we distribute from in bridge mode over the created VLANs.  Also in the settings of the serial port we create pipe / tmp / tts0 by means of which we will carry out the initial configuration of our <b>undercisco</b> . <br><br>  Further configuration is quite specific and depends on your tasks; in my opinion, it is meaningless to bring the ASA configuration file, since the settings of interfaces, access lists, NAT, VPN and other things are better read separately, since this is not one or even a dozen articles. .  I will describe only the basic things that I use.  First of all, routing, since all networks are established in it, and it is also the default gateway for the home network, and for the guest network.  Secondly, it will deploy "anyconnect" to access the home network via VPN.  The ‚ÄúCisco ASA‚Äù basic settings can be found in the <a href="http://habrahabr.ru/post/80414/">‚ÄúHands</a> Reached <a href="http://habrahabr.ru/post/80414/">: Continuing About ASA‚Äù</a> article of the <a href="http://habrahabr.ru/users/fedia/" class="user_link">Fedia Hubrauser</a> , the rest can be found on the network as needed. <br><br>  The first provider is the main one; the configuration implements the switching mechanism to the second provider in the event that the first is not available so that the second one does not get bored at this time, the free open guest access point is set to it.  Based on the workload of the second channel, the neighbors are very pleased with this gift of fate. <br><br><h2>  2.3 transmission torrent rocking chair and file server </h2><br>  About the description of the settings of this functionality is not broken a small number of keyboards, but still describe the setting here for the heap, so to speak. <br><br><div class="spoiler">  <b class="spoiler_title">Of course, you will have your own Samba configuration, but I‚Äôll give you my own example.</b> <div class="spoiler_text">  <b>First, install the Samba server with the command:</b> <br><br><pre> <code class="bash hljs">apt-get install samba</code> </pre><br>  <b>And edit the configuration file /etc/samba/smb.conf:</b> <br><br><pre> <code class="bash hljs">[global] workgroup = WORKGROUP netbios name = NAS server string = NAS File Server <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> level = 1 security = share unix charset = UTF-8 dos charset = cp1251 store dos attributes = yes max <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> size = 10 [NAS] comment = NAS SERVER FOLDER path = /home/NAS create mask = 0777 directory mask = 0777 public = yes writable = yes printable = no guest ok = yes <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> only = no [Share] comment = NAS SHARE FOLDER path = /home/NAS/Share create mask = 0777 directory mask = 0777 public = yes writable = yes printable = no guest ok = yes <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> only = no [cloud] comment = OWNCLOUD FOLDER path = /home/NAS/owncloud/ create mask = 0777 directory mask = 0777 public = yes writable = yes printable = no guest ok = yes <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> only = no [torrents] comment = TORRENTS FOLDER path = /home/NAS/torrents create mask = 0777 directory mask = 0777 public = yes writable = yes printable = no guest ok = yes <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> only = no [VM] comment = VIRTUAL MACHINES FOLDER path = /home/NAS/VM create mask = 0777 directory mask = 0777 public = yes writable = yes printable = no guest ok = yes <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> only = no [media] comment = MEDIA FOLDER path = /home/NAS/media create mask = 0777 directory mask = 0777 public = yes writable = yes printable = no guest ok = yes <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> only = no</code> </pre><br></div></div><br>  After configuring samba, you can install the workhorse to download torrents. <br><br><div class="spoiler">  <b class="spoiler_title">It‚Äôs time to do Transmission</b> <div class="spoiler_text">  <b>Install:</b> <br><pre> <code class="bash hljs">apt-get install transmission-daemon</code> </pre><br>  <b>Configure the transmission-daemon /etc/transmission-daemon/settings.json:</b> <br><pre> <code class="bash hljs">{ <span class="hljs-string"><span class="hljs-string">"alt-speed-down"</span></span>: 50, <span class="hljs-string"><span class="hljs-string">"alt-speed-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"alt-speed-time-begin"</span></span>: 540, <span class="hljs-string"><span class="hljs-string">"alt-speed-time-day"</span></span>: 127, <span class="hljs-string"><span class="hljs-string">"alt-speed-time-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"alt-speed-time-end"</span></span>: 1020, <span class="hljs-string"><span class="hljs-string">"alt-speed-up"</span></span>: 50, <span class="hljs-string"><span class="hljs-string">"bind-address-ipv4"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.0.0.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"bind-address-ipv6"</span></span>: <span class="hljs-string"><span class="hljs-string">"::"</span></span>, <span class="hljs-string"><span class="hljs-string">"blocklist-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"blocklist-url"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"cache-size-mb"</span></span>: 2, <span class="hljs-string"><span class="hljs-string">"dht-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"download-dir"</span></span>: <span class="hljs-string"><span class="hljs-string">"/home/NAS/torrents/Downloads"</span></span>, <span class="hljs-string"><span class="hljs-string">"download-limit"</span></span>: 100, <span class="hljs-string"><span class="hljs-string">"download-limit-enabled"</span></span>: 0, <span class="hljs-string"><span class="hljs-string">"encryption"</span></span>: 1, <span class="hljs-string"><span class="hljs-string">"idle-seeding-limit"</span></span>: 30, <span class="hljs-string"><span class="hljs-string">"idle-seeding-limit-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"incomplete-dir"</span></span>: <span class="hljs-string"><span class="hljs-string">"/home/NAS/torrents/Downloading"</span></span>, <span class="hljs-string"><span class="hljs-string">"incomplete-dir-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"lazy-bitfield-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"lpd-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"max-peers-global"</span></span>: 200, <span class="hljs-string"><span class="hljs-string">"message-level"</span></span>: 2, <span class="hljs-string"><span class="hljs-string">"open-file-limit"</span></span>: 32, <span class="hljs-string"><span class="hljs-string">"peer-limit-global"</span></span>: 200, <span class="hljs-string"><span class="hljs-string">"peer-limit-per-torrent"</span></span>: 60, <span class="hljs-string"><span class="hljs-string">"peer-port"</span></span>: 11523, <span class="hljs-string"><span class="hljs-string">"peer-port-random-high"</span></span>: 65535, <span class="hljs-string"><span class="hljs-string">"peer-port-random-low"</span></span>: 49152, <span class="hljs-string"><span class="hljs-string">"peer-port-random-on-start"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"peer-socket-tos"</span></span>: 0, <span class="hljs-string"><span class="hljs-string">"pex-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"port-forwarding-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"preallocation"</span></span>: 2, <span class="hljs-string"><span class="hljs-string">"ratio-limit"</span></span>: 1, <span class="hljs-string"><span class="hljs-string">"ratio-limit-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"rename-partial-files"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"rpc-authentication-required"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"rpc-bind-address"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.0.0.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"rpc-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"rpc-password"</span></span>: <span class="hljs-string"><span class="hljs-string">"**********"</span></span>, <span class="hljs-string"><span class="hljs-string">"rpc-port"</span></span>: 9091, <span class="hljs-string"><span class="hljs-string">"rpc-username"</span></span>: <span class="hljs-string"><span class="hljs-string">"transmission"</span></span>, <span class="hljs-string"><span class="hljs-string">"rpc-whitelist"</span></span>: <span class="hljs-string"><span class="hljs-string">"127.0.0.1,192.168.0.100"</span></span>, <span class="hljs-string"><span class="hljs-string">"rpc-whitelist-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"script-torrent-done-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"script-torrent-done-filename"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"speed-limit-down"</span></span>: 900, <span class="hljs-string"><span class="hljs-string">"speed-limit-down-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"speed-limit-up"</span></span>: 100, <span class="hljs-string"><span class="hljs-string">"speed-limit-up-enabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"start-added-torrents"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"trash-original-torrent-files"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"umask"</span></span>: 0, <span class="hljs-string"><span class="hljs-string">"upload-limit"</span></span>: 100, <span class="hljs-string"><span class="hljs-string">"upload-limit-enabled"</span></span>: 0, <span class="hljs-string"><span class="hljs-string">"upload-slots-per-torrent"</span></span>: 14 }</code> </pre><br></div></div><br><h2>  2.4 Server telephony based on Asterisk + FreePBX </h2><br>  Calls are not cheap, especially when working frequently and in different countries, even though there are vpn-tunnels before work ‚Äî it would be strange to say, not to deploy a telephony server.  Based on the above mentioned scheme, we are raising a new virtual machine and starting its network interfaces into the VLANs we need.  The asterisk + freepbx installation itself will not be described as, before me, <a href="http://habrahabr.ru/users/siv237/" class="user_link">siv237</a> did a great job with this task and described everything in the publication <a href="http://habrahabr.ru/post/171163/">Easy installation of Asterisk + FreePBX for beginners</a> . <br><br>  After installation, we start the necessary trunks in the FreePBX interface, set up a dial plan, create a user, and enjoy life.  Due to a miraculous expiration of circumstances, my main provider provides a city number via sip, which in fact was the main reason for the deployment of this server. <br><br>  A mobile phone, when I'm at home, is always connected to Wi-Fi, which is why it has become my main sip phone.  When unavailable, the server redirects to my mobile phone via the city line.  After connecting the Wi-Fi antenna located on the roof of the house, I can go for bread without any problems, without missing an important call and without paying for either the Internet or in minutes with the redirection. <br><br>  In the near future we plan to buy several USB modems that support the voice transfer function and configure the output to mobile networks.  Save as full. <br><br><h2>  2.5 TFTP server for network booting and configuration of various equipment; </h2><br>  If you honestly forgot about this very convenient function, it used to be redundant for me, and then just flew out of my head.  Somehow after the next viewing of my beloved Habra I came across a publication <a href="http://habrahabr.ru/company/serverclub/blog/250549/">‚ÄúBoot server - like a bootable USB flash drive, only a server and over the network‚Äù</a> , written by <a href="http://habrahabr.ru/users/romanenko_eugene/" class="user_link">Romanenko_Eugene</a> , with a description of all this.  Better than him, I probably won't be able to describe, so I'll leave this part behind him.  On the basis of this article, the distributives I needed were compiled and I forgot what a bootable USB flash drive is. <br><br><h2>  2.6 Private cloud for storing files based on "owncloud" </h2><br>  After several clients for cloud services have appeared on the phone, thoughts involuntarily begin to appear, how to unite the whole economy.  As a result, it was decided to build your own cloud, create directories in it to synchronize with other clouds and enjoy life. <br><br>  ‚ÄúOwncloud‚Äù was chosen as a platform, and I use box.com, dropbox, google drive, yandex disk, onedrive as external cloud providers.  The list is extensive, but the idea is simple.  To begin with, we put clients on the machine and set them up for synchronization in the directory previously created for each cloud, then put ‚Äúowncloud‚Äù on top of this farm. <br><br>  There is no sense to rewrite the client installation guide, they can be found on specialized sites.  And all that concerns the installation of "owncloud" described <a href="http://habrahabr.ru/users/blackice13/" class="user_link">BlackIce13</a> in the publication <a href="http://habrahabr.ru/post/208566/">"Experience installing ownCloud 6 on Debian 7 wheezy</a> . <a href="http://habrahabr.ru/post/208566/">"</a>  It remains for us to think about what and where to synchronize in order to sleep peacefully, having a server with RAID 0. <br><br><h2>  2.7 HTTP proxy Ace Stream for viewing TorrentTV </h2><br>  After the next disconnection of cable television for the delay in payment, the search for alternatives was started, which were found very quickly - TorrentTV.  The only negative is that you need the acestrem client to view. <br><br>  To keep the 750 watt monster on to distribute television directly to the television is quite wasteful.  After a brief search, a <a href="https://github.com/ValdikSS/aceproxy/wiki">solution</a> was found - a proxy that transforms the torrent stream into http.  The problem was solved rather quickly, now for 60 rubles a month you can watch a mountain of channels. <br><br>  The only negative is the rather slow channel switching. <br><br><div class="spoiler">  <b class="spoiler_title">Installation</b> <div class="spoiler_text">  <b>First, install the vlc:</b> <br><br><pre> <code class="bash hljs">apt-get install vlc</code> </pre><br>  <b>Download aceproxy and acestream and put them in one directory:</b> <br><br><pre> <code class="bash hljs">wget https://github.com/ValdikSS/aceproxy/archive/master.zip wget http://dl.acestream.org/debian/7/acestream_3.0.5.1_debian_7.4_x86_64.tar.gz</code> </pre><br>  <b>Create next several directories:</b> <br><br><pre> <code class="bash hljs">mkdir logs mkdir scripts</code> </pre><br>  <b>Create several scripts in the ./scripts directory:</b> <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ./scripts nano aceproxy.sh <span class="hljs-comment"><span class="hljs-comment">#!/bin/sh python ./aceproxy/acehttp.py &gt; ./logs/acehttp.log 2&gt;&amp;1 &amp; nano acestream.sh #!/bin/sh ./acestream/acestreamengine --lib-path ./acestream --client-console &gt; ./logs/acestream.log 2&gt;&amp;1 &amp; nano vlc.sh #!/bin/sh vlc -I telnet --clock-jitter -1 --network-caching -1 --sout-mux-caching 2000 --telnet-password admin &gt; ./logs/acevlc.log 2&gt;&amp;1 &amp;</span></span></code> </pre><br><br>  <b>Go to the directory above and create scripts to start and stop the broadcast:</b> <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../ nano start.sh <span class="hljs-comment"><span class="hljs-comment">#!/bin/bash /bin/kill -9 `/bin/ps ax |/bin/grep acestream |/usr/bin/awk {'print $1'}` ./scripts/acestream.sh echo "Start acestream" sleep 1 /bin/kill -9 `/bin/ps ax |/bin/grep vlc |/usr/bin/awk {'print $1'}` ./scripts/vlc.sh echo "Start VLC" sleep 1 /bin/kill -9 `/bin/ps ax |/bin/grep acehttp |/usr/bin/awk {'print $1'}` ./scripts/aceproxy.sh echo "Start aceproxy" nano stop.sh #!/bin/bash /bin/kill -9 `/bin/ps ax |/bin/grep acestream |/usr/bin/awk {'print $1'}` echo "Stop acestream" sleep 1 /bin/kill -9 `/bin/ps ax |/bin/grep vlc |/usr/bin/awk {'print $1'}` echo "Stop VLC" sleep 1 /bin/kill -9 `/bin/ps ax |/bin/grep acehttp |/usr/bin/awk {'print $1'}` echo "Stop aceproxy"</span></span></code> </pre><br><br>  <b>Edit the aceproxy configuration according to the wiki</b> <br><br>  [ <a href="https://github.com/ValdikSS/aceproxy/wiki/%25D0%25A3%25D1%2581%25D1%2582%25D0%25B0%25D0%25BD%25D0%25BE%25D0%25B2%25D0%25BA%25D0%25B0-%25D0%25B8-%25D0%25BD%25D0%25B0%25D1%2581%25D1%2582%25D1%2580%25D0%25BE%25D0%25B9%25D0%25BA%25D0%25B0-(Linux)">Wiki</a> ] <br><br>  <b>Let's launch the broadcast channels ./start.sh</b> <br></div></div><br>  That's all, it remains only to create a playlist of your own taste and enjoy watching your favorite channels. <br><br><h2>  2.8 Hosting for a home site with access via https </h2><br>  As for hosting, everything is ready with us.  Apache is for php lovers, everything is ready too, but I love Flask, but that's not the point, but in the green lock in the address bar.  Which pleases the eye so much when recruiting the cherished https: // thanks to an <a href="http://habrahabr.ru/post/249529/">article</a> written by the user <a href="http://habrahabr.ru/users/sly_g/" class="user_link">SLY_G</a> .  Just a couple of minutes you can please your eyes, seeing in the address bar a green miracle, receiving a free ssl certificate. <br><br>  I thought about buying a domain for a long time.  And there is a static, and a desire, but to give blood for a domain that does not please, for all the good names have already been bought, or I have no imagination.  But in general, it was decided to create an ssl certificate for the domain name from ddns.  Free and angry, but friends will not see a terrible warning about the insecurity of my cloud when I send links to various files from my repository.  Yes, and most constantly do not have to see these windows.  In general, I advise you to use the freebie. <br><br><h1>  findings </h1><br>  Having spent on equipment about 4 thousand rubles, you can get quite a lot of functionality and use iron almost to the fullest extent.  Currently, the average processor load is ~ 60% with rare peaks.  RAM is used almost completely by 80%, but these are consequences of virtualization.  The host and machines in the swap have not yet been. <br><br>  The server covers 90% of my desires.  Most pleased that such a modest iron works at 100% with low power consumption.  So, the electricity bill after switching from a router to such a server has not changed significantly. <br><br>  PS I ask in case of detection of errors and inaccuracies to report in the LAN.  This is my first article on Habr. <br><br>  PPS Dear community, this article is not a configuration guide or a benchmark for correct configurations.  This is just another article about what can be done with your old iron for the benefit of home LAN. <br><br>  PPPS I would be very grateful for feedback and new ideas on this topic. </div><p>Source: <a href="https://habr.com/ru/post/260617/">https://habr.com/ru/post/260617/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../260605/index.html">8 common design mistakes (and how to avoid them)</a></li>
<li><a href="../260609/index.html">Accelerate the Android application with Golang</a></li>
<li><a href="../260611/index.html">Where is the Internet ‚Äúliving in Russia well‚Äù?</a></li>
<li><a href="../260613/index.html">Electronics for the most beginners</a></li>
<li><a href="../260615/index.html">Editing Spatial Data in Leaflet</a></li>
<li><a href="../260619/index.html">Google hunting season is open</a></li>
<li><a href="../260621/index.html">Multiple / Class Table Inheritance in Rails</a></li>
<li><a href="../260623/index.html">High-performance code on the .NET platform</a></li>
<li><a href="../260629/index.html">Digest news of the gaming industry</a></li>
<li><a href="../260631/index.html">We pump HP t5325 thin client</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>