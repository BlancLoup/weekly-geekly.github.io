<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a full-fledged video hosting with their own hands (nginx + php5-fpm + ffmpeg + cumulusclips)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good afternoon, habrovchane! 

 Recently, our company has a need to create its own video resource, closed, but at the same time a bit public. And fina...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a full-fledged video hosting with their own hands (nginx + php5-fpm + ffmpeg + cumulusclips)</h1><div class="post__text post__text-html js-mediator-article">  Good afternoon, habrovchane! <br><br>  Recently, our company has a need to create its own video resource, closed, but at the same time a bit public.  And finally, it is finished and I am ready to share knowledge and applications. <br><br>  <b>The task was as follows:</b> <br>  <i>Create a video resource capable of conducting multi-stream one-way broadcasts from a web camera, as well as from any file (for example, to protect against direct download), a video game with the ability to view video in different formats and bitrates.</i> <br><a name="habracut"></a><br>  The basis was laid free server!  Not very powerful, but pretty suitable. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Intel¬Æ Xeon¬Æ CPU L5520 @ 2.27GHz</b> <b><br></b>  <b>number of cores 16</b> <b><br></b>  <b>16372 MB RAM</b> <br><br>  A little run ahead, when decoding a video processor load reaches 500% (approximately 6 cores); <br><br>  Let's start from the very beginning, I chose Ubuntu Server 13.04 x64 from the OS, because I spend more time with it and I actually understand it better than other Linux families. <br><br>  As a WEB server, I chose the nginx + php5-fpm bundle, because nginx quite successfully handles loads, as well as video output. <br><br>  nginx is installed by default without a streaming module, so we set of sorts <br><br>  Required dependencies for building packages: <br><br><pre><code class="bash hljs">apt-get install build-essential checkinstall subversion unzip yamdi imagemagick php5-curl libssl-dev zlib1g-dev libpcre3-dev rpl php5-fpm git</code> </pre> <br><br>  Download the source: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /tmp wget http://nginx.org/download/nginx-1.5.2.zip unzip nginx-1.5.2.zip -d nginx/ rm -f nginx-1.5.2.zip <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> nginx</code> </pre><br><br>  Download the necessary modules for streaming: <br><br><pre> <code class="bash hljs">mkdir modules git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/masterzen/nginx-upload-progress-module.git modules/nginx-upload-progress-module wget http://www.kernel-video-sharing.com/files/nginx_mod_h264_streaming-2.3.2.zip unzip nginx_mod_h264_streaming-2.3.2.zip -d modules/ rm -f nginx_mod_h264_streaming-2.3.2.zip git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/arut/nginx-rtmp-module.git modules/nginx-rtmp-module</code> </pre><br><br>  For convenience, create an installation script: <br><br><pre> <code class="bash hljs">touch nginx.sh nano nginx.sh</code> </pre><br>  with content <br><pre> <code class="bash hljs">./configure \ --conf-path=/etc/nginx/nginx.conf \ --error-log-path=/var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/nginx/error.log \ --pid-path=/var/run/nginx.pid \ --lock-path=/var/lock/nginx.lock \ --http-log-path=/var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/nginx/access.log \ --http-client-body-temp-path=/var/lib/nginx/body \ --http-proxy-temp-path=/var/lib/nginx/proxy \ --http-fastcgi-temp-path=/var/lib/nginx/fastcgi \ --with-debug \ --with-http_stub_status_module \ --with-http_secure_link_module \ --with-http_gzip_static_module \ --with-http_realip_module \ --with-http_mp4_module \ --with-http_flv_module \ --with-http_ssl_module \ --with-http_dav_module \ --with-md5=/usr/lib \ --add-module=modules/nginx-upload-progress-module \ --add-module=modules/nginx-rtmp-module \ --add-module=modules/nginx_mod_h264_streaming-2.3.2 make -j16 (16 -  .   .    <span class="hljs-string"><span class="hljs-string">"grep -c processor /proc/cpuinfo"</span></span>) checkinstall</code> </pre><br><br>  Perhaps during the compilation process errors may occur.  Therefore, we do this: <br><br>  In the auto / cc / gcc file, we comment the line: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#CFLAGS="$CFLAGS -Werror"</span></span></code> </pre><br><br>  Run: <br><pre> <code class="bash hljs">sh nginx.sh</code> </pre><br><br>  After installation, create the necessary symlinks and directories (if not created): <br><br><pre> <code class="bash hljs">ln -s /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/nginx/sbin/nginx /usr/sbin/nginx mkdir -p /var/lib/nginx/body mkdir /var/lib/nginx/proxy mkdir /var/lib/nginx/fastcgi chown -R root /var/lib/nginx/ wget http://nginx-init-ubuntu.googlecode.com/files/nginx-init-ubuntu_v2.0.0-RC2.tar.bz2 tar -jxvf nginx-init-ubuntu_v2.0.0-RC2.tar.bz2 -C /etc/init.d/ chmod 715 /etc/init.d/nginx /usr/sbin/update-rc.d -f nginx defaults rm -f nginx-init-ubuntu_v2.0.0-RC2.tar.bz2 rpl <span class="hljs-string"><span class="hljs-string">'DAEMON=/usr/local/sbin/nginx'</span></span> <span class="hljs-string"><span class="hljs-string">'DAEMON=/usr/local/nginx/sbin/nginx'</span></span> /etc/init.d/nginx rpl <span class="hljs-string"><span class="hljs-string">'NGINX_CONF_FILE="/usr/local/nginx/conf/nginx.conf"'</span></span> <span class="hljs-string"><span class="hljs-string">'NGINX_CONF_FILE="/etc/nginx/nginx.conf"'</span></span> /etc/init.d/nginx</code> </pre><br><br>  This completes the installation of nginx and php5-fpm. <br>  Go back to the setting later. <br><br>  Next in line is ffmpeg.  Installing apt-get is not desirable, the project is already deprecatet and much refuses to work.  In search of adequate and more recent instructions, I spent almost 2 nights.  I will not hide, I found a pretty good package for installation. <br><br>  <s>Oddly enough, the project is called <a href="http://www.ffmpeginstaller.com/">www.ffmpeginstaller.com,</a> and even with all the installers in the public domain, it offers its services for 50 bucks.</s> <s><br><br></s>  <s>And everything is done quite simply.</s> <s><br></s>  <s>Download the package:</s> <s><br><br></s> <pre> <s><code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /tmp wget http://mirror.ffmpeginstaller.com/old/scripts/ffmpeg7/ffmpeginstaller.7.4.tar.gz tar -xzf ffmpeginstaller.7.4.tar.gz ffmpeg <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ffmpeg</code></s> </pre> <s><br><br></s>  <s>After the first installation, I realized ... there is not enough codec.</s>  <s>Let off &lt;&lt;&lt; Put the codec before installation:</s> <s><br><br></s> <pre> <s><code class="bash hljs">apt-get install libvpx</code></s> </pre> <s><br><br></s>  <s>Open ffmpeg.sh and add the "--enable-libvpx" codec to the installation:</s> <s><br><br></s> <pre> <s><code class="bash hljs">nano ffmpeg.sh ./configure --prefix=<span class="hljs-variable"><span class="hljs-variable">$INSTALL_DDIR</span></span> --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-shared --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-nonfree \ --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-gpl --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-pthreads --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-libopencore-amrnb --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-decoder=liba52 \ --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-libopencore-amrwb --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-libfaac --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-libmp3lame \ --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-libtheora --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-libvorbis --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-libx264 --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-libxvid --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-libvpx \ --extra-cflags=-I/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/cpffmpeg/include/ --extra-ldflags=-L/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/cpffmpeg/lib \ --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-version3 --extra-version=syslint</code></s> </pre> <s><br><br></s>  <s>This completes the preparation.</s>  <s>You can install: sh start.sh</s> <s><br><br></s>  <s>Installation takes about 15-20 minutes, depending on the capabilities of the iron.</s>  <s>You can go to drink tea (or coffee).</s> <s><br><br></s>  <s>After installation we perform:</s> <s><br><br></s> <pre> <s><code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">hash</span></span> x264 ffmpeg ffplay</code></s> </pre><br><br>  Clip view in PS <br><br>  Everything.  Congratulations, we did it! <br><br>  Now we need a CMS to manage these tools. <br><br>  There were few options, or rather just 2 (and only one ‚Äî cumulusclips ‚Äî was suitable for my needs). <br>  The source code is clear, without much hassle figured out with the component.  That's just had to rewrite the project from mysql to mysqli.  All the CMS code is structured and the templates are separate and flexible.  For the basis of the chosen template pseudo YouTube. <br><br>  I had to completely twist the player, because  jwplayer was unable to switch video streams.  A little polaziv on github found a simple player under the simple name jQplayer. <br>  This player is able to switch streams easily.  True, there is one drawback.  Playing a file starts from the beginning.  And this was not a problem - video files are easily cut nginx out of the box. <br><br>  Now we need to set up web hosting for our project. <br>  I attach a small script to automate this process.  Included with CMS was .htaccess - and nginx refuses to understand it, so I rewrote it to the needs of this web server. <br><div class="spoiler">  <b class="spoiler_title">An example of my config</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash echo -n "   : " read host echo -n "   nginx: " read users sap=/etc/nginx/sites-available/$host.conf mkdir -p /var/hosting/ touch $sap chmod 777 $sap directives="upstream backend-${host} {server unix:/var/run/php5-${host}.sock;} server { listen 80; server_name ${host} www.${host}; root /var/hosting/${host}/www; access_log /var/log/nginx/${host}-access.log; error_log /var/log/nginx/${host}-error.log; index index.php; rewrite_log on; if ($host = '${host}' ) { rewrite ^/(.*)$ http://www.${host}/$1 permanent; } location /im { rewrite ^/im/(.*)$ /cc-core/controllers/thumbs.php?$1 last; } location /videos { rewrite ^/videos/([0-9]+)/(.*)$ /cc-core/controllers/play.php?vid=$1 last; rewrite ^/videos/page/([0-9]+)/$ /cc-core/controllers/videos.php?page=$1 last; rewrite ^/videos/(most-recent|most-viewed|most-discussed|most-rated)/$ /cc-core/controllers/videos.php?load=$1 last; rewrite ^/videos/(most-recent|most-viewed|most-discussed|most-rated)/page/([0-9]+)/$ /cc-core/controllers/videos.php?load=$1&amp;page=$2 last; rewrite ^/videos/([a-zA-Z0-9\-]+)/$ /cc-core/controllers/videos.php?category=$1 last; rewrite ^/videos/([a-zA-Z-]+)/page/([0-9]+)/$ /cc-core/controllers/videos.php?category=$1&amp;page=$2 last; rewrite ^/videos/([0-9]+)/comments/$ /cc-core/controllers/comments.php?vid=$1 last; rewrite ^/videos/([0-9]+)/comments/page/([0-9]+)/$ /cc-core/controllers/comments.php?vid=$1&amp;page=$2 last; rewrite ^/videos/$ /cc-core/controllers/videos.php last; } location /private { rewrite ^/private/get/$ /cc-core/controllers/play.php?get_private=true last; rewrite ^/private/videos/([a-zA-Z0-9]+)/$ /cc-core/controllers/play.php?private=$1 last; rewrite ^/private/comments/([a-zA-Z0-9]+)/$ /cc-core/controllers/comments.php?private=$1 last; rewrite ^/private/comments/([a-zA-Z0-9]+)/page/([a-z0-9]+)/$ /cc-core/controllers/comments.php?private=$1&amp;page=$2 last; } location /members { rewrite ^/members/page/([0-9]+)/$ /cc-core/controllers/members.php?page=$1 last; rewrite ^/members/([a-zA-Z0-9]+)/$ /cc-core/controllers/profile.php?username=$1 last; rewrite ^/members/([a-zA-Z0-9]+)/videos/$ /cc-core/controllers/member_videos.php?username=$1 last; rewrite ^/members/([a-zA-Z0-9]+)/videos/page/([0-9]+)/$ /cc-core/controllers/member_videos.php?username=$1&amp;page=$2 last; rewrite ^/members/$ /cc-core/controllers/members.php last; } location /search { rewrite ^/search(/page/([0-9]+))?/$ /cc-core/controllers/search.php?page=$2 last; } location /login { rewrite ^(.*)$ /cc-core/controllers/login.php last; } location /login/forgot { rewrite ^(.*)$ /cc-core/controllers/login.php?action=forgot last; } location /logout { rewrite ^(.*)$ /cc-core/system/logout.php last; } location /register { rewrite ^(.*)$ /cc-core/controllers/register.php last; } location /activate { rewrite ^(.*)$ /cc-core/controllers/activate.php last; } location /opt { rewrite ^/opt-out/$ /cc-core/controllers/opt_out.php last; } location /contact { rewrite ^(.*)$ /cc-core/controllers/contact.php last; } location /embed { rewrite ^/embed/([0-9]+)/$ /cc-core/system/embed.php?vid=$1 last; } location /page { rewrite ^(.*)$ /cc-core/system/page.php last; } location /translation { rewrite ^(.*)$ /cc-core/system/translation.php last; } location /notify { rewrite ^(.*)$ /cc-core/system/notify.php last; } location /language/get { rewrite ^(.*)$ /cc-core/system/language.php?get last; } location /language { rewrite ^/language/set/(.*)/$ /cc-core/system/language.php?set&amp;language=$1 last; } location /feed { rewrite ^/feed(/([a-zA-Z0-9]+))?/$ /cc-core/system/feed.php?username=$2 last; } location /video { rewrite ^/video-sitemap(-([0-9]+))?\.xml$ /cc-core/system/video_sitemap.php?page=$2 last; } location /myaccount/upload/avatar { rewrite ^(.*)$ /cc-core/system/avatar.ajax.php last; } location /myaccount/upload/validate { rewrite ^(.*)$ /cc-core/system/upload.ajax.php last; } location /myaccount/grab/validate { rewrite ^(.*)$ /cc-core/system/grab.ajax.php last; } location /actions/username { rewrite ^(.*)$ /cc-core/system/username.ajax.php last; } location /actions/flag { rewrite ^(.*)$ /cc-core/system/flag.ajax.php last; } location /actions/favorite { rewrite ^(.*)$ /cc-core/system/favorite.ajax.php last; } location /actions/subscribe { rewrite ^(.*)$ /cc-core/system/subscribe.ajax.php last; } location /actions/rate { rewrite ^(.*)$ /cc-core/system/rate.ajax.php last; } location /actions/comment { rewrite ^(.*)$ /cc-core/system/comment.ajax.php last; } location /actions/post { rewrite ^(.*)$ /cc-core/system/post.ajax.php last; } location /actions/stream { rewrite ^(.*)$ /cc-core/system/stream.ajax.php last; } location /actions { rewrite ^/actions/mobile-(videos|search)/$ /cc-core/system/mobile_$1.ajax.php?mobile last; } location /myaccount { rewrite ^/myaccount/upload/complete/$ /cc-core/controllers/myaccount/upload_complete.php last; rewrite ^/myaccount/upload/video/$ /cc-core/controllers/myaccount/upload_video.php last; rewrite ^/myaccount/upload/$ /cc-core/controllers/myaccount/upload.php last; rewrite ^/myaccount/myvideos(/page/([0-9]+))?/$ /cc-core/controllers/myaccount/myvideos.php?page=$2 last; rewrite ^/myaccount/myvideos/([0-9]+)/$ /cc-core/controllers/myaccount/myvideos.php?vid=$1 last; rewrite ^/myaccount/editvideo/([0-9]+)/$ /cc-core/controllers/myaccount/edit_video.php?vid=$1 last; rewrite ^/myaccount/myfavorites(/page/([0-9]+))?/$ /cc-core/controllers/myaccount/myfavorites.php?page=$2 last; rewrite ^/myaccount/myfavorites/([0-9]+)/$ /cc-core/controllers/myaccount/myfavorites.php?vid=$1 last; rewrite ^/myaccount/privacy-settings/$ /cc-core/controllers/myaccount/privacy_settings.php last; rewrite ^/myaccount/change-password/$ /cc-core/controllers/myaccount/change_password.php last; rewrite ^/myaccount/subscriptions(/([0-9]+))?/$ /cc-core/controllers/myaccount/subscriptions.php?id=$2 last; rewrite ^/myaccount/subscriptions(/page/([0-9]+))?/$ /cc-core/controllers/myaccount/subscriptions.php?page=$2 last; rewrite ^/myaccount/subscribers(/page/([0-9]+))?/$ /cc-core/controllers/myaccount/subscribers.php?page=$2 last; rewrite ^/myaccount/message/inbox(/page/([0-9]+))?/$ /cc-core/controllers/myaccount/message_inbox.php?page=$2 last; rewrite ^/myaccount/message/inbox/([0-9]+)/$ /cc-core/controllers/myaccount/message_inbox.php?delete=$1 last; rewrite ^/myaccount/message/read/([0-9]+)/$ /cc-core/controllers/myaccount/message_read.php?msg=$1 last; rewrite ^/myaccount/message/send/([a-zA-Z0-9]+)/$ /cc-core/controllers/myaccount/message_send.php?username=$1 last; rewrite ^/myaccount/message/reply/([0-9]+)/$ /cc-core/controllers/myaccount/message_send.php?msg=$1 last; rewrite ^/myaccount/$ /cc-core/controllers/myaccount/myaccount.php last; } location /myaccount/profile { rewrite ^(.*)$ /cc-core/controllers/myaccount/update_profile.php last; } location /myaccount/profile/reset { rewrite ^(.*)$ /cc-core/controllers/myaccount/update_profile.php?action=reset last; } location /myaccount/message/send { rewrite ^(.*)$ /cc-core/controllers/myaccount/message_send.php last; } location /m { rewrite ^/m/v/([0-9]+)/$ /cc-core/controllers/mobile/play.php?mobile&amp;vid=$1 last; rewrite ^/m/v/$ /cc-core/controllers/mobile/videos.php?mobile last; rewrite ^/m/s/$ /cc-core/controllers/mobile/search.php?mobile last; rewrite ^/m/$ /cc-core/controllers/mobile/index.php?mobile last; } location /system { rewrite ^/system-error/$ /cc-core/controllers/system_error.php last; } location /t { rewrite ^/t/(.*)$ /cc-core/system/translation.php last; } location / { if (!-e $request_filename){ #rewrite ^/(.*)$ /$request_uri/ permanent; rewrite ^/(.*)$ /cc-core/system/page.php last; } } location ~ \.php$ { include fastcgi_params; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; fastcgi_pass backend-${host}; } location ~* ^.+\.(jpg|jpeg|gif|css|png|js|ico|bmp)$ { access_log off; expires 10d; break; } location ~ \.(flv|mp4|webm|ogg|ogv|mp3)$ { mp4; mp4_buffer_size 1m; mp4_max_buffer_size 5m; } location ~ /\. { deny all; } } " echo "$directives"&gt;$sap sap_poll=/etc/php5/fpm/pool.d/$host.conf touch $sap_poll chmod 777 $sap_poll directives_poll="[${host}] listen = /var/run/php5-${host}.sock listen.mode = 0666 user = ${users} group = ${users} chdir = /var/hosting/${host} php_admin_value[upload_tmp_dir] = /var/hosting/${host}/tmp php_admin_value[soap.wsdl_cache_dir] = /var/hosting/${host}/tmp php_admin_value[date.timezone] = Asia/Yekaterinburg pm = dynamic pm.min_spare_servers = 10 pm.max_spare_servers = 20 pm.start_servers = 10 pm.max_children = 40" echo "$directives_poll"&gt;$sap_poll ln -s /etc/nginx/sites-available/$host.conf /etc/nginx/sites-enabled/$host.conf mkdir -p /var/hosting/$host/www/ mkdir -p /var/hosting/$host/tmp/ dir=/var/hosting/$host/www chown -R $users:$users "$dir"; find "$dir" -type d -exec chmod 0755 '{}' \; find "$dir" -type f -exec chmod 0644 '{}' \; /etc/init.d/nginx restart /etc/init.d/php5-fpm restart</span></span></code> </pre><br></div></div><br>  That's all.  This configuration can encode video in different formats, as well as stream the stream.  If this article is of interest to anyone, I will gladly give live examples of streaming. <br><br>  Unfortunately, I can‚Äôt show the full stuffing, but here‚Äôs what I got at <a href="http://stream.etagi.com/">stream.etagi.com</a> <br><br>  Thanks for attention. <br><br>  <b>PS1 Found a more relaxed build path ffmpeg.</b>  <b>Corrected below.</b> <br><br>  1. echo ‚Äúdeb <a href="http://www.deb-multimedia.org/">www.deb-multimedia.org</a> main non-free squeeze‚Äù /etc/apt/sources.list <br>  2. apt-get update <br>  3. apt-get install deb-multimedia-keyring <br>  4. apt-get update <br>  5. apt-get remove ffmpeg <br>  6. apt-get purge ffmpeg <br>  7. apt-get autoremove <br>  8. apt-get install ffmpeg x264 (the installation will tighten all necessary dependencies) <br>  9. ffmpeg -version <br>  (in the output should not be DEPRECATED, if not from 5 to 9 point again) <br><br>  <b>PS2 Main design feature</b> <br>  Only works on PHP 5.3 from dotdeb </div><p>Source: <a href="https://habr.com/ru/post/188380/">https://habr.com/ru/post/188380/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../188368/index.html">Simulation of a neural network</a></li>
<li><a href="../188370/index.html">Selection of mnemonic quotes for car and phone numbers</a></li>
<li><a href="../188372/index.html">Basic principles of game development</a></li>
<li><a href="../188374/index.html">The story of a bad start - the option "All myself"</a></li>
<li><a href="../188376/index.html">Emacs as an IDE for Python</a></li>
<li><a href="../188382/index.html">Customer Self Service with google ASR</a></li>
<li><a href="../188384/index.html">Ajax form validation in Django</a></li>
<li><a href="../188386/index.html">‚ÄúWhy upgrade the GCC compiler?‚Äù Or ‚ÄúThe performance of the GCC compiler on Intel Atom from version to version‚Äù</a></li>
<li><a href="../188390/index.html">Handwriting recognition</a></li>
<li><a href="../188392/index.html">Common misconceptions in project management</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>