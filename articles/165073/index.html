<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing an extension for google chrome</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="To write an extension for google chrome is easy. But when writing the first expansion, questions may arise (and arise). Most of the manuals for writin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Writing an extension for google chrome</h1><div class="post__text post__text-html js-mediator-article">  To write an extension for google chrome is easy.  But when writing the first expansion, questions may arise (and arise).  Most of the manuals for writing the first extension are designed to use the manifest of the first version, whose support will cease in the near future. <br><br>  This article will cover: <br><ul><li>  How to make a manifest v.2 </li><li>  How to work with remote resources </li><li>  How to work with cookies </li><li>  How to work with local storage </li><li>  How to work with notifications </li></ul><br><a name="habracut"></a><br><h4>  Introduction </h4><br>  By the end of the article we will have an organizer extension in which there will be a field for adding a new task, as well as a list of tasks for the current day.  Denote all the requirements for the organizer: <br><ul><li>  Must have a field to add an event (date, time, event) </li><li>  Must display all tasks for the current day, sorted by time </li><li>  All past events should display strikethrough </li><li>  Must have a field to enter the time for how much to show the notification, as well as the checkbox allowing and prohibiting the display of notifications </li><li>  A specified time before the event should display a notification about the upcoming event. </li></ul><br><h4>  Manifesto </h4><br>  Let's start creating an extension from the very beginning, that is, from the manifest.  The manifest is the same file in which all the extension parameters are written.  Name, description, version, permission to access sites, permission to use cookies, notifications, local storage.  In general, the manifesto is the brain of expansion.  Create file manifest.json.  The manifest is the only file that should have a predefined name; all other files can be named as you please.  There are three required fields in this file: <br><br>  <b>manifest.json</b> <br><pre><code class="javascript hljs">{ ‚Äúname‚Äù: ‚ÄúOrganizer extension‚Äù, <span class="hljs-comment"><span class="hljs-comment">//   ‚Äúversion‚Äù: ‚Äú1.0‚Äù, //  . ‚Äúmanifest_version‚Äù: 2 //   }</span></span></code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      There are a couple of rules here: <br><ul><li>  The <b>manifest</b> version must be integer, that is, must be written as 2, not ‚Äú2‚Äù. </li><li>  The <b>extension</b> version must be string, but contain only numbers and periods, that is, ‚Äú1.0‚Äù is good, and 1.0 and ‚Äú0.9 beta‚Äù is bad. </li></ul><br><br>  With the required fields - everything, let's move on to creating a pop-up extension window.  In order to open a window by clicking on the icon, you need to add the ‚Äúbrowser_action‚Äù field to the manifest <br><br>  <b>manifest.json</b> <br><pre> <code class="javascript hljs">{ ‚Ä¶ <span class="hljs-string"><span class="hljs-string">"browser_action"</span></span>: { <span class="hljs-string"><span class="hljs-string">"default_title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Open organizer"</span></span>, <span class="hljs-comment"><span class="hljs-comment">// .          "default_icon": "icon_small.png", //     "default_popup": "popup.html" //      } }</span></span></code> </pre><br><br>  Now create a popup window.  This is a regular html page, which can be of any size and color, no tricks.  Name the file ‚Äúpopup.html‚Äù.  Create this file is not enough - it must be specified in the manifest.  So we did: ‚Äúdefault_popup‚Äù: ‚Äúpopup.html‚Äù. <br><br>  <b>popup.html</b> <br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Content-Type"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/html; charset=UTF-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span>It works!<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><h4>  Adding an extension to the browser </h4><br>  Now it's time to test the performance of our extension.  To do this, upload the extension to the browser.  Open in the chrome menu extensions.  Put the bird on ‚ÄúDeveloper mode‚Äù. <br><img src="https://habrastorage.org/storage2/35b/309/bfd/35b309bfd62a78ac7c79ba8b9ff1f6f0.png"><br>  After that there will be three buttons.  Click ‚ÄúLoad unpacked extension ...‚Äù.  Select the folder with the extension files.  After this, our extension will appear.  If everything is correct, then by clicking on the icon - the window will pop up: <br><img src="https://habrastorage.org/storage2/05b/58a/369/05b58a3693b4df06238bac9dec09ceb3.png"><br><br><h4>  Connecting scripts </h4><br>  Now you can proceed to the interesting.  Connect two javascript files.  The first is popup.js, the second is jquery.  There will be no problem with the first one, but we will connect jquery not local, but remote, taken at <a href="">ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js</a> .  Problems will arise from the fact that the default extension does not have access to third-party resources.  To access, you must specify it in the manifest.  Access to something is indicated in the ‚Äúpermissions‚Äù field.  Also, for remote scripts and css, you must specify the available remote resources. <br><br>  <b>manifest.json</b> <br><pre> <code class="javascript hljs">{ ‚Ä¶ <span class="hljs-string"><span class="hljs-string">"permissions"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"https://ajax.googleapis.com/*"</span></span> ], <span class="hljs-string"><span class="hljs-string">"content_security_policy"</span></span>: <span class="hljs-string"><span class="hljs-string">"script-src 'self' https://ajax.googleapis.com; object-src 'self'"</span></span> }</code> </pre><br>  Now connect these scripts to popup.html <br><br>  <b>popup.html</b> <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"popup.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><h4>  Storage </h4><br>  With the help of storage in chrome, you can store user data.  And it is in the storage that our extension will store future events.  There are two reasons for this.  First, the data stored in storage can be synchronized if logged in to the browser.  And secondly, the data can be stored not only as strings, as in cookies, but in any form, that is, you can store arrays and objects.  To make it work, let's open access to storage in the manifest. <br><br>  <b>manifest.json</b> <br><pre> <code class="javascript hljs">{ ... <span class="hljs-string"><span class="hljs-string">"permissions"</span></span>: [ ‚Ä¶ <span class="hljs-string"><span class="hljs-string">"storage"</span></span> ] ... }</code> </pre><br>  Now we will remake the popup window.  In the pop-up window there will be a field with today's date, three inputs for the date, time and description of the new event, a button for adding a new event, as well as a list of all events for today. <br><br>  <b>popup.html</b> <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"container"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"today_date"</span></span></span><span class="hljs-tag">&gt;</span></span>Date<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"table"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"new_date"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"input_date"</span></span></span><span class="hljs-tag"> /&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"new_time"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"input_date"</span></span></span><span class="hljs-tag"> /&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"new_task"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"input_task"</span></span></span><span class="hljs-tag"> /&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  And immediately add the date display in the #today_date block. <br><br>  <b>popup.js</b> <br><pre> <code class="javascript hljs">$(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> today = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(); $(<span class="hljs-string"><span class="hljs-string">"#today_date"</span></span>).html(today.getDate()+<span class="hljs-string"><span class="hljs-string">"."</span></span>+(<span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(today.getMonth())+<span class="hljs-number"><span class="hljs-number">1</span></span>)+<span class="hljs-string"><span class="hljs-string">"."</span></span> + today.getFullYear()); }</code> </pre><br>  It should look like this: <br><img src="https://habrastorage.org/storage2/a4c/d15/c0c/a4cd15c0c5746b9c5907c7a5566a5a6f.png"><br><br>  So, when you click on the ‚Äú+‚Äù button, we should add an event.  At the beginning of the file we will declare a global variable storage - an object for working with storage, as well as a global array of tasks for storing events. <br><br>  <b>popup.js</b> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> storage = chrome.storage.sync; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tasks = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>(); $(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ ‚Ä¶ $(<span class="hljs-string"><span class="hljs-string">"#add_task"</span></span>).click(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> new_task = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>(); new_task.date = validateField($(<span class="hljs-string"><span class="hljs-string">"#new_date"</span></span>).val(), <span class="hljs-string"><span class="hljs-string">"date"</span></span>); new_task.time = validateField($(<span class="hljs-string"><span class="hljs-string">"#new_time"</span></span>).val(), <span class="hljs-string"><span class="hljs-string">"time"</span></span>); new_task.task = $(<span class="hljs-string"><span class="hljs-string">"#new_task"</span></span>).val(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!new_task.task || !new_task.date || !new_task.task){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } tasks[tasks.length] = new_task; storage.set({ <span class="hljs-attr"><span class="hljs-attr">tasks</span></span>:tasks }); }); });</code> </pre><br>  The validation function checks that the date is recorded in the dmyyyy format, and the time in the hh: mm format, and also that the description of the event contains at least three characters. <br><br>  <b>popup.js</b> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> validateField = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">val, type</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(type == <span class="hljs-string"><span class="hljs-string">"date"</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> date = val.split(<span class="hljs-string"><span class="hljs-string">"."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> year = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(); year = year.getFullYear(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(date.length == <span class="hljs-number"><span class="hljs-number">3</span></span> &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(date[<span class="hljs-number"><span class="hljs-number">0</span></span>]) == date[<span class="hljs-number"><span class="hljs-number">0</span></span>] &amp;&amp; date[<span class="hljs-number"><span class="hljs-number">0</span></span>] &lt;= <span class="hljs-number"><span class="hljs-number">31</span></span> &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(date[<span class="hljs-number"><span class="hljs-number">1</span></span>]) == date[<span class="hljs-number"><span class="hljs-number">1</span></span>] &amp;&amp; date[<span class="hljs-number"><span class="hljs-number">1</span></span>] &lt;= <span class="hljs-number"><span class="hljs-number">12</span></span> &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(date[<span class="hljs-number"><span class="hljs-number">2</span></span>]) == date[<span class="hljs-number"><span class="hljs-number">2</span></span>] &amp;&amp; date[<span class="hljs-number"><span class="hljs-number">2</span></span>] &gt;= year){<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> val;} } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(type == <span class="hljs-string"><span class="hljs-string">"time"</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> time = val.split(<span class="hljs-string"><span class="hljs-string">":"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(time.length == <span class="hljs-number"><span class="hljs-number">2</span></span> &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(time[<span class="hljs-number"><span class="hljs-number">0</span></span>]) == time[<span class="hljs-number"><span class="hljs-number">0</span></span>] &amp;&amp; time[<span class="hljs-number"><span class="hljs-number">0</span></span>] &lt; <span class="hljs-number"><span class="hljs-number">24</span></span> &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(time[<span class="hljs-number"><span class="hljs-number">1</span></span>]) == time[<span class="hljs-number"><span class="hljs-number">1</span></span>] &amp;&amp; time[<span class="hljs-number"><span class="hljs-number">1</span></span>] &lt; <span class="hljs-number"><span class="hljs-number">60</span></span>){<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> val;} } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(type == <span class="hljs-string"><span class="hljs-string">"task"</span></span> &amp;&amp; type.length &gt;= <span class="hljs-number"><span class="hljs-number">3</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> val; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }</code> </pre><br>  With the addition of understood, proceed to receive the events for today.  To do this, you need to get all the events from the database, select only today's events from all of them and sort them by time in ascending order. <br><br>  <b>popup.js</b> <br><pre> <code class="javascript hljs">$(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> now_hours = today.getHours() &lt; <span class="hljs-number"><span class="hljs-number">10</span></span> ? <span class="hljs-string"><span class="hljs-string">"0"</span></span> + today.getHours() : today.getHours(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> now_minutes = today.getMinutes() &lt; <span class="hljs-number"><span class="hljs-number">10</span></span> ? <span class="hljs-string"><span class="hljs-string">"0"</span></span> + today.getMinutes() : today.getMinutes(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> now_time = now_hours + <span class="hljs-string"><span class="hljs-string">""</span></span> + now_minutes; storage.get(<span class="hljs-string"><span class="hljs-string">"tasks"</span></span>,<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">items</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(items.tasks){ tasks = items.tasks; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> today_tasks = getTodayTasks(tasks); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(today_tasks.length &gt;<span class="hljs-number"><span class="hljs-number">0</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> today_tasks){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> this_time = today_tasks[i].time.replace(<span class="hljs-string"><span class="hljs-string">":"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> add = this_time &gt; now_time ? <span class="hljs-string"><span class="hljs-string">""</span></span> : <span class="hljs-string"><span class="hljs-string">' class="done"'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> add_html = <span class="hljs-string"><span class="hljs-string">'&lt;li'</span></span>+add+<span class="hljs-string"><span class="hljs-string">'&gt;&lt;strong&gt;'</span></span>+today_tasks[i].time+<span class="hljs-string"><span class="hljs-string">'&lt;/strong&gt; '</span></span>+today_tasks[i].task+<span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>; $(<span class="hljs-string"><span class="hljs-string">"ul"</span></span>).append(add_html); } } } }); ‚Ä¶ });</code> </pre><br>  The getTodayTasks () function returns from the general list only events with today's date. <br><br>  <b>popup.js</b> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> getTodayTasks = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">tasks</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> today_tasks = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> today = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> today_date = today.getDate()+<span class="hljs-string"><span class="hljs-string">"."</span></span>+(today.getMonth() + <span class="hljs-number"><span class="hljs-number">1</span></span> )+ <span class="hljs-string"><span class="hljs-string">"."</span></span> + today.getFullYear(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> tasks){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(tasks[i].date == today_date){ today_tasks[today_tasks.length] = tasks[i]; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(today_tasks.length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>){ today_tasks = sortTasks(today_tasks); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> today_tasks; }</code> </pre><br>  The sortTasks () function sorts events by time. <br><br>  <b>popup.js</b> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sortTasks = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">tasks</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(tasks.length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> swapped = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (swapped) { swapped = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; tasks.length<span class="hljs-number"><span class="hljs-number">-1</span></span>; i++) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> this_time = tasks[i].time.replace(<span class="hljs-string"><span class="hljs-string">":"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> next_time = tasks[i+<span class="hljs-number"><span class="hljs-number">1</span></span>].time.replace(<span class="hljs-string"><span class="hljs-string">":"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (this_time &gt; next_time) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> temp = tasks[i]; tasks[i] = tasks[i+<span class="hljs-number"><span class="hljs-number">1</span></span>]; tasks[i+<span class="hljs-number"><span class="hljs-number">1</span></span>] = temp; swapped = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tasks; }</code> </pre><br><h4>  Notifications </h4><br>  It's time to customize the display of notifications on the screen.  Add a special checkbox to the pop-up window.  If this checkbox is checked, notifications will be shown, if not checked, they will not.  Also add a text input.  The number in this route will show how long before the event the notification will be displayed.  That is, if we have an event scheduled for 19:00, in this text input there will be 5, then at 18:55 a notification will appear.  Add to popup.html code with these inputs. <br><br>  <b>popup.html</b> <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"checkbox"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"show_notifications"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">checked</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"checked"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"when_to_notify"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"input_date"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> /&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><img src="https://habrastorage.org/storage2/8b5/296/bda/8b5296bda37776a49ea91d9e4a6e046f.png"><br><br>  Now let's see how this will work.  When you click on the checkbox, its checked attribute will be checked, the attribute value will be recorded in the cookie ‚Äúshow_notifications‚Äù.  Let's move on to text input.  By changing its value, the new value will be validated, if it is an integer and not more than 120, we write the new value in the ‚Äúwhen_to_notify‚Äù cookie. <br><br>  But in order for it to work, we need to open access to cookies.  To do this, go to manifest.json and add to ‚Äúpermissions‚Äù <br><br>  <b>manifest.json</b> <br><pre> <code class="javascript hljs">{ ... <span class="hljs-string"><span class="hljs-string">"permissions"</span></span>: [ ‚Ä¶ ‚Äúcookies‚Äù ] ... }</code> </pre><br>  Now you can proceed to the script.  Go to popup.js.  To begin with we will establish initial values ‚Äã‚Äãin inputa.  By default, the checkbox is unchecked, that is, notifications are not shown, and the time is 0. When you click on the checkbox, the ‚Äúshow_notifications‚Äù cookie will change.  When changing the value in the text field, the value of the ‚Äúwhen_to_notify‚Äù cookie will change. <br><br>  <b>popup.js</b> <br><pre> <code class="javascript hljs">$(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ setCheckbox(); setWhenToNotify(getCookie(<span class="hljs-string"><span class="hljs-string">"when_to_notify"</span></span>)); ... $(<span class="hljs-string"><span class="hljs-string">"#show_notifications"</span></span>).click(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ setCookie(<span class="hljs-string"><span class="hljs-string">"show_notifications"</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"show_notifications"</span></span>).checked); }); $(<span class="hljs-string"><span class="hljs-string">"#when_to_notify"</span></span>).change(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ setWhenToNotify($(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>).val()); }); });</code> </pre><br>  Consider more features.  Let's start with the functions of working with cookies.  In this case, ready-made functions were taken from w3schools.com. <br><br>  <b>popup.js</b> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> setCookie = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">c_name,value,exdays</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* *  http://www.w3schools.com/js/js_cookies.asp */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> exdate=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(); exdate.setDate(exdate.getDate() + exdays); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c_value=<span class="hljs-built_in"><span class="hljs-built_in">escape</span></span>(value) + ((exdays==<span class="hljs-literal"><span class="hljs-literal">null</span></span>) ? <span class="hljs-string"><span class="hljs-string">""</span></span> : <span class="hljs-string"><span class="hljs-string">"; expires="</span></span>+exdate.toUTCString()); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.cookie=c_name + <span class="hljs-string"><span class="hljs-string">"="</span></span> + c_value; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> getCookie = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">c_name</span></span></span><span class="hljs-function">)</span></span>{  . <span class="hljs-comment"><span class="hljs-comment">/* *  http://www.w3schools.com/js/js_cookies.asp */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i,x,y,ARRcookies=<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.cookie.split(<span class="hljs-string"><span class="hljs-string">";"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;ARRcookies.length;i++){ x=ARRcookies[i].substr(<span class="hljs-number"><span class="hljs-number">0</span></span>,ARRcookies[i].indexOf(<span class="hljs-string"><span class="hljs-string">"="</span></span>)); y=ARRcookies[i].substr(ARRcookies[i].indexOf(<span class="hljs-string"><span class="hljs-string">"="</span></span>)+<span class="hljs-number"><span class="hljs-number">1</span></span>); x=x.replace(<span class="hljs-regexp"><span class="hljs-regexp">/^\s+|\s+$/g</span></span>,<span class="hljs-string"><span class="hljs-string">""</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x==c_name){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">unescape</span></span>(y); } } }</code> </pre><br>  We will deal with the setCheckbox () function.  It receives the cookie ‚Äúshow_notifications‚Äù and checks if the resulting value is ‚Äútrue‚Äù (text, yes), then the checked parameter of the check box is true, otherwise false. <br><br>  <b>popup.js</b> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> setCheckbox = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> val = getCookie(<span class="hljs-string"><span class="hljs-string">"show_notifications"</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'show_notifications'</span></span>).checked = ((val == <span class="hljs-string"><span class="hljs-string">"true"</span></span>) ? <span class="hljs-literal"><span class="hljs-literal">true</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre><br>  Now consider setWhenToNotify ().  It takes a new timer value.  If this value is integer and not more than 120 minutes, then in the ‚Äúwhen_to_notify‚Äù cookie the new value is set.  If the variable did not pass this validation, then the previous value from the ‚Äúwhen_to_notify‚Äù cookie is returned to the input. <br><br>  <b>popup.js</b> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> setWhenToNotify = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">val</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> last_val = getCookie(<span class="hljs-string"><span class="hljs-string">"when_to_notify"</span></span>); last_val = last_val != <span class="hljs-string"><span class="hljs-string">"undefined"</span></span>? last_val: <span class="hljs-number"><span class="hljs-number">0</span></span>; val = (<span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(val)==val &amp;&amp; val &lt;=<span class="hljs-number"><span class="hljs-number">120</span></span>) ? val : last_val; setCookie(<span class="hljs-string"><span class="hljs-string">"when_to_notify"</span></span>, val); $(<span class="hljs-string"><span class="hljs-string">"#when_to_notify"</span></span>).val(val); }</code> </pre><br>  Let's go to the notifications themselves.  To do this, open access to notifications and connect background background.js.  It is necessary to include the background file, since if notifications are called from popup.js, then notifications will appear only if a pop-up window is open. <br><br>  <b>manifest.json</b> <br><pre> <code class="javascript hljs">{ ... <span class="hljs-string"><span class="hljs-string">"permissions"</span></span>: [ ‚Ä¶ <span class="hljs-string"><span class="hljs-string">"notifications"</span></span> ], <span class="hljs-string"><span class="hljs-string">"background"</span></span>: { <span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: [<span class="hljs-string"><span class="hljs-string">"background.js"</span></span>] }, <span class="hljs-string"><span class="hljs-string">"web_accessible_resources"</span></span>: [<span class="hljs-string"><span class="hljs-string">"icon_small.png"</span></span>], ... }</code> </pre><br>  The last line gives access to the deleted file.  The fact is that the image that is displayed in the notification must be available to the extension remotely.  In this case, the file is local, but access is still necessary.  Now we will take on background.js.  We declare a storage variable and an empty tasks array.  Then once a minute, the script will receive a list of today's events and receive from them a list of tasks that should occur after a specified time.  After that, a notification will be displayed for each such task. <br><br>  <b>background.js</b> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> storage = chrome.storage.sync; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tasks = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>(); setInterval(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ storage.get(<span class="hljs-string"><span class="hljs-string">"tasks"</span></span>,<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">items</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(items.tasks &amp;&amp; getCookie(<span class="hljs-string"><span class="hljs-string">"show_notifications"</span></span>) == <span class="hljs-string"><span class="hljs-string">"true"</span></span>){ tasks = getTodayTasks(items.tasks); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.webkitNotifications){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> texts = getNextTask(tasks); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> texts){ show(texts[i]); } } } }); }, <span class="hljs-number"><span class="hljs-number">60000</span></span>);</code> </pre><br>  The getTodayTasks () and getCookie () functions are taken from popup.js.  So let's start parsing with the getNextTask () function.  The function compares the current time and the event time, if it is equal to the value stored in the ‚Äúwhen_to_notify‚Äù cookie, then a string from the event time and its description is added to the next array.  After checking all the events, it returns the array next. <br><br>  <b>background.js</b> <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> getNextTask = function(tasks){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> now = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Date(); now = now.getTime(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> next = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Array(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i in tasks){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> date = tasks[i].date.split(<span class="hljs-string"><span class="hljs-string">"."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> time = tasks[i].time.split(<span class="hljs-string"><span class="hljs-string">":"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> task_date = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Date(parseInt(date[<span class="hljs-number"><span class="hljs-number">2</span></span>]), parseInt(date[<span class="hljs-number"><span class="hljs-number">1</span></span>]-<span class="hljs-number"><span class="hljs-number">1</span></span>), parseInt(date[<span class="hljs-number"><span class="hljs-number">0</span></span>]), parseInt(time[<span class="hljs-number"><span class="hljs-number">0</span></span>]), parseInt(time[<span class="hljs-number"><span class="hljs-number">1</span></span>]), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); task_date = task_date.getTime(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> delta = Math.round((task_date-now)/<span class="hljs-number"><span class="hljs-number">60000</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(delta == getCookie(<span class="hljs-string"><span class="hljs-string">"when_to_notify"</span></span>)){ next[next.length] = tasks[i].time + <span class="hljs-string"><span class="hljs-string">" - "</span></span> + tasks[i].task; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> next; }</code> </pre><br>  The show () function displays a notification with the specified text. <br><br>  <b>background.js</b> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> show = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> notification = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.webkitNotifications.createNotification(<span class="hljs-string"><span class="hljs-string">'icon_small.png'</span></span>,<span class="hljs-string"><span class="hljs-string">' '</span></span>, text); notification.show(); }</code> </pre><br>  The result of this script will be the following notification: <br><img src="http://habrastorage.org/storage2/825/747/da5/825747da550fff1941be095b56b3a153.png"><br><br><h4>  Afterword </h4><br>  As promised, at the end of the article we have a ready-made organizer extension for Google Chrome. <br>  Now add the extension to the Chrome Web Store.  It is necessary to load the extension packed into .zip-archive.  First, go to the Web Store.  To do this, go to the chrome tab ‚ÄúApplications‚Äù and click ‚ÄúWeb Strore‚Äù <br><img src="http://habrastorage.org/storage2/c3f/33d/f42/c3f33df426d34d5725fb5b961e27af95.png"><br>  Now go to the menu.  To do this, click the hex and open the ‚ÄúDeveloper dashboard‚Äù <br><img src="http://habrastorage.org/storage2/fb8/0aa/7a9/fb80aa7a97e76062d243d284d00e0726.png"><br>  Click the large ‚ÄúAdd new item‚Äù button.  After that, you will need to select a zip-archive with the extension click ‚Äúupload‚Äù <br><img src="http://habrastorage.org/storage2/764/145/5cb/7641455cbdbf6e6424f115be50327e8d.png"><br>  Next you need to fill out a small form with a description of the extension.  Now there is a choice to either save the extension to Chernovil or publish  Just to publish it will not work because registration in the Web Store costs $ 5.  Registration fees must be paid once per account, not for each extension.  After payment there is a possibility to publish the extension, but even here we must be prepared for the fact that it will be validated for several days. <br><br><h4>  useful links </h4><br>  Description of the manifest fields: <a href="http://developer.chrome.com/trunk/extensions/manifest.html">developer.chrome.com/trunk/extensions/manifest.html</a> <br>  Working with storage: <a href="http://developer.chrome.com/trunk/extensions/storage.html">developer.chrome.com/trunk/extensions/storage.html</a> <br>  Notification information: <a href="http://developer.chrome.com/extensions/notifications.html">developer.chrome.com/extensions/notifications.html</a> <br>  Expansion sources: <a href="https://github.com/bozheville/orginaizer_extension">github.com/bozheville/orginaizer_extension</a> </div><p>Source: <a href="https://habr.com/ru/post/165073/">https://habr.com/ru/post/165073/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../165061/index.html">What can be difficult in calculating the hypotenuse?</a></li>
<li><a href="../165063/index.html">A PC created with Valve will be shown this week.</a></li>
<li><a href="../165067/index.html">Prediction of information epidemics by analyzing the social graph</a></li>
<li><a href="../165069/index.html">PHP class for convenient and safe work with MySQL</a></li>
<li><a href="../165071/index.html">We write the application for Android on Ruby (Ruboto)</a></li>
<li><a href="../165077/index.html">Android Conquering fragmentation</a></li>
<li><a href="../165085/index.html">JS module for Java developers</a></li>
<li><a href="../165087/index.html">The simplest image clustering by the k-means method (k-means)</a></li>
<li><a href="../165089/index.html">XIMA Chronicall emergency troubleshooting telephone monitoring and reporting system</a></li>
<li><a href="../165091/index.html">13 reasons not to be a manager</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>