<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Reverse engineering one line javascript</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A few months ago I received a letter from a friend: 


 Subject: Can you explain this one line of code to me? 

 Text: Consider me stupid, but ... I d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Reverse engineering one line javascript</h1><div class="post__text post__text-html js-mediator-article">  A few months ago I received a letter from a friend: <br><br><hr><br>  <b>Subject:</b> Can you explain this one line of code to me? <br><br>  <b>Text:</b> Consider me stupid, but ... I do not understand her and I will be grateful if you explain in detail.  This is a ray tracer in 128 characters.  I think he's amazing. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="javascript hljs">&lt;pre id=p&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="actionscript"><span class="xml"><span class="actionscript">n=setInterval(</span></span><span class="hljs-string"><span class="xml"><span class="actionscript"><span class="hljs-string">"for(n+=7,i=k,P='p.\\n';i-=1/k;P+=P[i%2?(i%2*j-j+n/k^j)&amp;1:2])j=k/i;p.innerHTML=P"</span></span></span></span><span class="xml"><span class="actionscript">,k=</span></span><span class="hljs-number"><span class="xml"><span class="actionscript"><span class="hljs-number">64</span></span></span></span><span class="xml"><span class="actionscript">)</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br><hr><br>  This line of JavaScript will draw the animation that is shown in the image below the cut.  In the browser, it runs <a href="https://codepen.io/akras14/pen/yXGzVd">here</a> .  The script is written by the author <a href="http://www.p01.org/">www.p01.org</a> , where you can find this and many other cool demos. <br><a name="habracut"></a><br><img src="https://habrastorage.org/getpro/habr/post_images/264/07a/cb2/26407acb273d35bfb8bb5f1bd21d8244.gif"><br><br>  Challenge accepted! <br><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-0" style="position: static; visibility: visible; display: block; transform: rotate(0deg); width: 500px; margin: 10px auto; max-width: 100%; min-width: 220px;" data-tweet-id="885491908922888192"></twitter-widget><script async="" src="//platform.twitter.com/widgets.js" charset="utf-8"></script></div><br><h2>  Part I. Extract the readable code. </h2><br>  The first thing I did was leave HTML in HTML, the JavaScript code was transferred to the <code>code.js</code> file, and <code>p</code> quoted in <code>id="p"</code> . <br><br>  <i>index.html</i> <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"code.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pre</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"p"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pre</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  I noticed that the variable <code>k</code> is just a constant, so I removed it from the line and renamed <code>delay</code> . <br><br>  <i>code.js</i> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> delay = <span class="hljs-number"><span class="hljs-number">64</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> draw = <span class="hljs-string"><span class="hljs-string">"for(n+=7,i=delay,P='p.\\n';i-=1/delay;P+=P[i%2?(i%2*j-j+n/delay^j)&amp;1:2])j=delay/i;p.innerHTML=P"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n = setInterval(draw, delay);</code> </pre> <br>  Further, <code>var draw</code> was just a string that was executed as a function of <code>eval</code> at intervals of setInterval, because setInterval can take both functions and strings.  I moved <code>var draw</code> to an explicit function, but I saved the original line for reference just in case. <br><br>  I also noticed that the <code>p</code> element actually referred to the DOM element with the <code>p</code> identifier declared in HTML, which I recently quoted.  It turns out that elements in JavaScript can be referenced by their identifier, if id consists only of letters and numbers.  I added <code>document.getElementById("p")</code> to make the code clearer. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> delay = <span class="hljs-number"><span class="hljs-number">64</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> p = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"p"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// &lt; -------------- // var draw = "for(n+=7,i=delay,P='p.\\n';i-=1/delay;P+=P[i%2?(i%2*j-j+n/delay^j)&amp;1:2])j=delay/i;p.innerHTML=P"; var draw = function() { for (n += 7, i = delay, P = 'p.\n'; i -= 1 / delay; P += P[i % 2 ? (i % 2 * j - j + n / delay ^ j) &amp; 1 : 2]) { j = delay / i; p.innerHTML = P; } }; var n = setInterval(draw, delay);</span></span></code> </pre> <br>  Then I declared the variables <code>i</code> , <code>p</code> and <code>j</code> and transferred them to the beginning of the function. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> delay = <span class="hljs-number"><span class="hljs-number">64</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> p = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"p"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// var draw = "for(n+=7,i=delay,P='p.\\n';i-=1/delay;P+=P[i%2?(i%2*j-j+n/delay^j)&amp;1:2])j=delay/i;p.innerHTML=P"; var draw = function() { var i = delay; // &lt; --------------- var P ='p.\n'; var j; for (n += 7; i &gt; 0 ;P += P[i % 2 ? (i % 2 * j - j + n / delay ^ j) &amp; 1 : 2]) { j = delay / i; p.innerHTML = P; i -= 1 / delay; } }; var n = setInterval(draw, delay);</span></span></code> </pre> <br>  I decomposed the <code>for</code> loop and converted it into a <code>while</code> .  Of the three parts of the former <code>for</code> , only one part of the CHECK_EVERY_LOOP remained, and the rest (RUNS_ONCE_ON_INIT; DO_EVERY_LOOP) moved beyond the cycle. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> delay = <span class="hljs-number"><span class="hljs-number">64</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> p = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"p"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// var draw = "for(n+=7,i=delay,P='p.\\n';i-=1/delay;P+=P[i%2?(i%2*j-j+n/delay^j)&amp;1:2])j=delay/i;p.innerHTML=P"; var draw = function() { var i = delay; var P ='p.\n'; var j; n += 7; while (i &gt; 0) { // &lt;---------------------- //Update HTML p.innerHTML = P; j = delay / i; i -= 1 / delay; P += P[i % 2 ? (i % 2 * j - j + n / delay ^ j) &amp; 1 : 2]; } }; var n = setInterval(draw, delay);</span></span></code> </pre> <br>  Here I have expanded the ternary operator <code>( condition ? do if true : do if false) in P += P[i % 2 ? (i % 2 * j - j + n / delay ^ j) &amp; 1 : 2];</code> <code>( condition ? do if true : do if false) in P += P[i % 2 ? (i % 2 * j - j + n / delay ^ j) &amp; 1 : 2];</code>  . <br><br>  <code>i%2</code> checks if the variable <code>i</code> even or odd.  If it is even, then it simply returns 2. If it is odd, then it returns the magic value magic <code>(i % 2 * j - j + n / delay ^ j) &amp; 1;</code>  (more on this later). <br><br>  This value (index) is used to shift the string P, so we call it <code>index</code> and turn the string into <code>P += P[index];</code>  . <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> delay = <span class="hljs-number"><span class="hljs-number">64</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> p = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"p"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// var draw = "for(n+=7,i=delay,P='p.\\n';i-=1/delay;P+=P[i%2?(i%2*j-j+n/delay^j)&amp;1:2])j=delay/i;p.innerHTML=P"; var draw = function() { var i = delay; var P ='p.\n'; var j; n += 7; while (i &gt; 0) { //Update HTML p.innerHTML = P; j = delay / i; i -= 1 / delay; let index; let iIsOdd = (i % 2 != 0); // &lt;--------------- if (iIsOdd) { // &lt;--------------- index = (i % 2 * j - j + n / delay ^ j) &amp; 1; } else { index = 2; } P += P[index]; } }; var n = setInterval(draw, delay);</span></span></code> </pre> <br>  I decomposed <code>&amp; 1</code> from the value <code>index = (i % 2 * j - j + n / delay ^ j) &amp; 1</code> into another <code>if</code> . <br><br>  Here is a clever way to check whether the result is even in parentheses, when 0 is returned for an even value, and 1. is returned for an odd value. <code>&amp;</code> is a bitwise AND operator.  It works like this: <br><br><ul><li>  1 &amp; 1 = 1 </li><li>  0 &amp; 1 = 0 </li></ul><br>  Consequently, <code>something &amp; 1</code> converts the "something" into a binary representation, and also finishes the required number of zeros before the unit to match the size of the "something", and returns just the AND result of the last bit.  For example, 5 in binary format equals <code>101</code> , so if we apply the logical AND operation with a unit on it, we get the following: <br><br><pre> <code class="javascript hljs"> <span class="hljs-number"><span class="hljs-number">101</span></span> AND <span class="hljs-number"><span class="hljs-number">001</span></span> <span class="hljs-number"><span class="hljs-number">001</span></span></code> </pre> <br>  In other words, the five is an odd number, and the result of 5 AND 1 (5 &amp; 1) will be 1. In the JavaScript console, it is easy to verify that this logic is adhered to. <br><br><pre> <code class="javascript hljs"><span class="hljs-number"><span class="hljs-number">0</span></span> &amp; <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-comment"><span class="hljs-comment">// 0 - even return 0 1 &amp; 1 // 1 - odd return 1 2 &amp; 1 // 0 - even return 0 3 &amp; 1 // 1 - odd return 1 4 &amp; 1 // 0 - even return 0 5 &amp; 1 // 1 - odd return 1</span></span></code> </pre> <br>  Note that I also renamed the rest of the <code>index</code> to <code>magic</code> , so the code with the expanded <code>&amp;1</code> will look like this: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> delay = <span class="hljs-number"><span class="hljs-number">64</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> p = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"p"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// var draw = "for(n+=7,i=delay,P='p.\\n';i-=1/delay;P+=P[i%2?(i%2*j-j+n/delay^j)&amp;1:2])j=delay/i;p.innerHTML=P"; var draw = function() { var i = delay; var P ='p.\n'; var j; n += 7; while (i &gt; 0) { //Update HTML p.innerHTML = P; j = delay / i; i -= 1 / delay; let index; let iIsOdd = (i % 2 != 0); if (iIsOdd) { let magic = (i % 2 * j - j + n / delay ^ j); let magicIsOdd = (magic % 2 != 0); // &amp;1 &lt; -------------------------- if (magicIsOdd) { // &amp;1 &lt;-------------------------- index = 1; } else { index = 0; } } else { index = 2; } P += P[index]; } }; var n = setInterval(draw, delay);</span></span></code> </pre> <br>  Next, I deployed <code>P += P[index];</code>  in the <code>switch</code> .  At this point, it became clear that <code>index</code> can take only one of three values ‚Äã‚Äã‚Äî 0, 1, or 2. It is also clear that the variable <code>P</code> always initialized with the values <code>var P ='p.\n';</code>  where 0 points to <code>p</code> , 1 points to <code>.</code>  , and 2 points to a <code>\n</code> newline character <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> delay = <span class="hljs-number"><span class="hljs-number">64</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> p = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"p"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// var draw = "for(n+=7,i=delay,P='p.\\n';i-=1/delay;P+=P[i%2?(i%2*j-j+n/delay^j)&amp;1:2])j=delay/i;p.innerHTML=P"; var draw = function() { var i = delay; var P ='p.\n'; var j; n += 7; while (i &gt; 0) { //Update HTML p.innerHTML = P; j = delay / i; i -= 1 / delay; let index; let iIsOdd = (i % 2 != 0); if (iIsOdd) { let magic = (i % 2 * j - j + n / delay ^ j); let magicIsOdd = (magic % 2 != 0); // &amp;1 if (magicIsOdd) { // &amp;1 index = 1; } else { index = 0; } } else { index = 2; } switch (index) { // P += P[index]; &lt;----------------------- case 0: P += "p"; // aka P[0] break; case 1: P += "."; // aka P[1] break; case 2: P += "\n"; // aka P[2] } } }; var n = setInterval(draw, delay);</span></span></code> </pre> <br>  I dealt with the operator <code>var n = setInterval(draw, delay);</code>  .  The setInterval method returns integers starting from one, increasing the value with each call.  This integer can be used for <i>clearInterval</i> (that is, for undo).  In our case, setInterval is called only once, and the variable <code>n</code> simply set to 1. <br><br>  I also renamed <code>delay</code> to <code>DELAY</code> to remind you that this is just a constant. <br><br>  And last but not least, I put the parentheses in <code>i % 2 * j - j + n / DELAY ^ j</code> to indicate that y <code>^</code> (bitwise XOR) is lower priority than the <code>%</code> , <code>*</code> , <code>‚àí</code> , <code>+</code> and <code>/</code> .  In other words, all the above calculations will be performed first, and only then <code>^</code> .  That is, it turns out <code>(i % 2 * j - j + n / DELAY) ^ j)</code> . <br><br>  <b>Clarification:</b> I was told that I mistakenly placed <code>p.innerHTML = P; //Update HTML</code>  <code>p.innerHTML = P; //Update HTML</code> into a loop, so I removed it from there. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> DELAY = <span class="hljs-number"><span class="hljs-number">64</span></span>; <span class="hljs-comment"><span class="hljs-comment">// approximately 15 frames per second 15 frames per second * 64 seconds = 960 frames var n = 1; var p = document.getElementById("p"); // var draw = "for(n+=7,i=delay,P='p.\\n';i-=1/delay;P+=P[i%2?(i%2*j-j+n/delay^j)&amp;1:2])j=delay/i;p.innerHTML=P"; /** * Draws a picture * 128 chars by 32 chars = total 4096 chars */ var draw = function() { var i = DELAY; // 64 var P ='p.\n'; // First line, reference for chars to use var j; n += 7; while (i &gt; 0) { j = DELAY / i; i -= 1 / DELAY; let index; let iIsOdd = (i % 2 != 0); if (iIsOdd) { let magic = ((i % 2 * j - j + n / DELAY) ^ j); // &lt; ------------------ let magicIsOdd = (magic % 2 != 0); // &amp;1 if (magicIsOdd) { // &amp;1 index = 1; } else { index = 0; } } else { index = 2; } switch (index) { // P += P[index]; case 0: P += "p"; // aka P[0] break; case 1: P += "."; // aka P[1] break; case 2: P += "\n"; // aka P[2] } } //Update HTML p.innerHTML = P; }; setInterval(draw, 64);</span></span></code> </pre> <br>  The final result of the execution can be seen <a href="https://codepen.io/akras14/pen/qjgrxz">here</a> . <br><br><h2>  Part 2. Understanding the code </h2><br>  So what's going on here?  Let's figure it out. <br><br>  Initially, the value of <code>i</code> set to 64 by means of <code>var i = DELAY;</code>  and then each cycle it decreases by 1/64 (0.016625) through <code>i -= 1 / DELAY;</code>  .  The loop continues until <code>i</code> greater than zero ( <code>while (i &gt; 0) {</code> code <code>while (i &gt; 0) {</code> ).  Since for each pass <code>i</code> decreases by 1/64, it takes 64 cycles before it decreases by one (64/64 = 1).  In general, a decrease in <code>i</code> will occur 64 √ó 64 = 4096 times in order to decrease to zero. <br><br>  The image consists of 32 lines, with 128 characters each.  It is very convenient that 64 √ó 64 = 32 √ó 128 = 4096. The value of <code>i</code> can be even (not odd <code>let iIsOdd = (i % 2 != 0);</code> ) if <code>i</code> is strictly an even number.  This will happen 32 times when it equals 64, 62, 60, etc. These 32 times the <code>index</code> will take the value 2 <code>index = 2;</code>  , and a new line character will be added to the line: <code>P += "\n"; // aka P[2]</code>  <code>P += "\n"; // aka P[2]</code> .  The remaining 127 characters in the string will take the values <code>p</code> or <code>.</code>  . <br><br>  But when to install <code>p</code> , and when <code>.</code>  ? <br><br>  Well, for a start we know exactly what should be installed <code>.</code>  for odd values, <code>let magic = ((i % 2 * j - j + n / DELAY) ^ j);</code>  , or set <code>p</code> if "magic" is even. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> P =<span class="hljs-string"><span class="hljs-string">'p.\n'</span></span>; ... if (magicIsOdd) { <span class="hljs-comment"><span class="hljs-comment">// &amp;1 index = 1; // second char in P - . } else { index = 0; // first char in P - p }</span></span></code> </pre> <br>  But when <code>magic</code> even and when is odd?  This is a million dollar question.  Before moving on to it, let's define something else. <br><br>  If you remove <code>+ n/DELAY</code> from <code>let magic = ((i % 2 * j - j + n / DELAY) ^ j);</code>  , you get a static picture in which nothing moves at all: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3cf/20f/8fa/3cf20f8fa0be07b8816672ea816ddf21.png"><br><br>  Now look at <code>magic</code> without <code>+ n/DELAY</code> .  How did this beautiful picture come about? <br><br> <code>(i % 2 * j - j) ^ j</code> <br> <br>  Pay attention to what happens in each cycle: <br><br><pre> <code class="javascript hljs">j = DELAY / i; i -= <span class="hljs-number"><span class="hljs-number">1</span></span> / DELAY;</code> </pre> <br>  In other words, we can express <code>j</code> through finite <code>i</code> as <code>j = DELAY/ (i + 1/DELAY)</code> .  But since 1 / DELAY is too small a number, for this example you can drop <code>+ 1/DELAY</code> and simplify the expression to <code>j = DELAY/i = 64/i</code> . <br><br>  In this case, we can rewrite <code>(i % 2 * j - j) ^ j</code> as <code>i % 2 * 64/i - 64/i) ^ 64/i</code> . <br><br>  We use an <a href="https://www.desmos.com/calculator">online graphing calculator</a> to draw graphs of some of these functions. <br><br>  First of all, draw <code>i%2</code> . <br><br>  There is a nice graph with y values ‚Äã‚Äãfrom 0 to 2. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8d7/f6c/2db/8d7f6c2db6c533fad32cfe3cf199d7a6.png"><br><br>  If we draw <code>64/i</code> , we get the following graph: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c36/4bd/d35/c364bdd35185f6ca36dc66918c4deb39.png"><br><br>  If you draw the entire left side of the expression, you get a graph that looks like a combination of the previous two. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c7b/677/692/c7b677692270a570eb2b2e2dc1c577aa.png"><br><br>  In the end, if we draw two functions next to each other, we will see the following. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/323/cc4/599/323cc4599c40a0f4913130b970aa8672.png"><br><br><h4>  What do these charts say? </h4><br>  Let's recall the question we are trying to answer, that is, how did such a beautiful static picture come up: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3cf/20f/8fa/3cf20f8fa0be07b8816672ea816ddf21.png"><br><br>  We know that if ‚Äúmagic‚Äù <code>(i % 2 * j - j) ^ j</code> takes an even value, then you need to add <code>p</code> , and for an odd number you need to add <code>.</code>  . <br><br>  Increase the first 16 lines of our graph, where <code>i</code> has values ‚Äã‚Äãfrom 64 to 32. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/365/840/8a5/3658408a5bca2a1248b55e25cbe42411.png"><br><br>  The bitwise XOR in JavaScript will drop all values ‚Äã‚Äãto the right of the comma, so this is equivalent to applying the <code>Math.floor</code> method, which rounds the number down. <br><br>  It will return 0 if both bits are 1 or both are 0. <br><br>  Our <code>j</code> starts from one and slowly moves to a two, stopping right next to it, so we can always consider it as a unit when rounding down ( <code>Math.floor(1.9999) === 1</code> ), and we need one more unit on the left side to get a result of zero and give us <code>p</code> . <br><br>  In other words, each green diagonal represents one row in our graph.  Since for the first 16 rows the value of j is always greater than 1, but less than 2, we can get an odd value only if the left side of the expression <code>(i % 2 * j - j) ^ j</code> , it is <code>i % 2 * i/64 ‚Äî i/64</code> , that is, the green diagonal, will also be higher than 1 or lower than ‚àí1. <br><br>  Here are some results from the JavaScript console to see the results of the calculations: 0 or ‚àí2 means that the result is even, and 1 means an odd number. <br><br><pre> <code class="javascript hljs"><span class="hljs-number"><span class="hljs-number">1</span></span> ^ <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-comment"><span class="hljs-comment">// 0 - even p 1.1 ^ 1.1 // 0 - even p 0.9 ^ 1 // 1 - odd . 0 ^ 1 // 1 - odd . -1 ^ 1 // -2 - even p -1.1 ^ 1.1 // -2 - even p</span></span></code> </pre> <br>  If you look at our graph, then there the rightmost diagonal line barely goes above 1 and below ‚àí1 (few even numbers ‚Äî few <code>p</code> characters).  The next one goes a little further beyond these boundaries, the third one goes a little further, and so on. Line number 16 is barely held between 2 and ‚àí2.  After line 16, we see that our static graph changes its character. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d77/ae6/4e8/d77ae64e8aba2174921af344da5b50a7.png"><br><br>  After the 16th row, the value of <code>j</code> crosses the limit 2, so that the expected result changes.  Now we will get an even number if the green diagonal line is higher than 2 or lower than ‚àí2, or inside frames 1 and ‚àí1, but does not touch them.  That is why we see in the picture two or more groups of <code>p</code> characters starting from the 17th line. <br><br>  If you look at the few bottom lines in the animated picture, you will notice that they do not follow the same pattern due to the large fluctuation of the graph. <br><br>  Now back to <code>+ n/DELAY</code> .  In the code, we see that the value of <code>n</code> begins with 8 (1 from setInteval and plus 7 on each method call).  It then increases by 7 each time setInteval is triggered. <br><br>  After reaching the value of 64, the graph changes as follows. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9da/b80/7db/9dab807dbf5f8e0ef5cdef4c4b3025ab.png"><br><br>  Notice that <code>j</code> is still around one, but now the left half of the red diagonal is around 62-63, around about zero, and the right half is around 63-64 around one.  Since our characters appear in descending order from 64 to 62, we can expect that the right half of the diagonal in the region of 63-64 (1 ^ 1 = 0 // even) will add a handful of characters <code>p</code> , and the left half of the diagonal in the region of 62-63 ( 1 ^ 0 = 1 // odd) will add a bunch of points.  All this will grow from left to right, as usual text. <br><br>  HTML rendering for such a condition looks like this (you can hard-drive the value of <code>n</code> in the CodePen editor and see).  This coincides with our expectations. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/80e/05a/865/80e05a865983e43d7fe7678a0120bdb6.png"><br><br>  By this time, the number of characters <code>p</code> has grown to a constant value.  For example, in the first row, half of all values ‚Äã‚Äãwill always be even.  Now the characters <code>p</code> and <code>.</code>  will only change places. <br><br>  For example, when <code>n</code> incremented by 7 on the next call to setInterval, the graph changes slightly. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ec2/d0e/87d/ec2d0e87df529c6a949ebe5de5ef3daa.png"><br><br>  Please note that the diagonal for the first row (near the 64 mark) has moved approximately one small square up.  Since the four large squares are 128 characters, there will be 32 characters in one large square, and 32/5 = 6.4 characters (approximately) in one small square.  If we look at rendering HTML, then there the first row really moved to the right by 7 characters. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/eb1/1f1/5b7/eb11f15b78c6b11938ebdc48ba766e12.png"><br><br>  And one last example.  This is what happens if you call setInterval seven more times, and <code>n</code> equals 64 + 9 √ó 7. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e22/6e2/e95/e226e2e95789f61e8cbac690381820c1.png"><br><br>  For the first row, <code>j</code> is still equal to 1. Now the upper half of the red diagonal near the 64 mark abutted approximately into two, and the lower end near the unit.  This turns the picture in the other direction, since now <code>1^2 = 3 // odd - .</code>  and <code>1 ^ 1 = 0 //even - p</code> .  So you can expect a bunch of points, followed by the characters <code>p</code> . <br><br>  It will look like this. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/960/c6e/60d/960c6e60d109d03971e019bfc0feb4c5.png"><br><br>  The schedule is endlessly looped. <br><br>  I hope our work has some meaning.  It is unlikely that I would ever be able to come up with something similar on my own, but it was interesting to understand this code. </div><p>Source: <a href="https://habr.com/ru/post/333372/">https://habr.com/ru/post/333372/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../333360/index.html">The balance between security devices in proxy mode and the impact on network performance</a></li>
<li><a href="../333362/index.html">Scala Collection: Secrets and Tricks</a></li>
<li><a href="../333364/index.html">Identify numbers with CallKit</a></li>
<li><a href="../333366/index.html">How much is your company worth? Brief on business valuation</a></li>
<li><a href="../333368/index.html">Startup cycle: how (in general) venture investment works</a></li>
<li><a href="../333374/index.html">Security Week 28: Petya was difficult to open, the Broadcomm chipset bug was closed in Android, Copycat infected 14 million devices</a></li>
<li><a href="../333376/index.html">Database as Code. Digging deeper</a></li>
<li><a href="../333378/index.html">IBM and the US Air Force are developing a new generation neuromorphous supercomputer</a></li>
<li><a href="../333380/index.html">AWS DeepLearning AMI - why (and how) is it worth using</a></li>
<li><a href="../333382/index.html">Non-productive training of a single-layer perceptron. Classification task</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>