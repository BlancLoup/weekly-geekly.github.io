<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Recognition of augmented reality marker</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="About augmented reality (Augumented reality, AR) many articles are written. On Habr√© there is a whole section dedicated to this area . In short, there...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Recognition of augmented reality marker</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/350/8da/a38/3508daa381f47e3c3f56820832d60371.jpg"><br>  About augmented reality (Augumented reality, AR) many articles are written.  On Habr√© there is a whole section dedicated to this <a href="http://habrahabr.ru/blogs/augmented_reality/">area</a> .  In short, there are two fundamental approaches for creating augmented reality: using a pre-prepared <a href="http://www.youtube.com/watch%3Fv%3DuXCvAafC3xk">marker</a> ( <a href="http://www.youtube.com/watch%3Fv%3Dc_LrVqI6StY">more</a> ) that needs to be printed and <a href="http://www.youtube.com/watch%3Fv%3DP9KPJlA5yds">without it</a> .  Both approaches, using computer vision algorithms, recognize objects in a frame and complement them. <br>  This article focuses on recognition algorithms for creating additional reality with a pre-prepared marker. <br><a name="habracut"></a><br><h5>  What could be the marker? </h5><br>  In theory, a marker can be any shape (object).  But in practice we are limited by the resolution of the webcam (phone), color rendering features, lighting, and the computing power of the equipment (everything happens in real time, and therefore must be done quickly), and therefore a black-and-white marker of simple form is usually chosen.  As a rule, it is a rectangle or square with an identifier-inscribed inside. <br>  The article [1] describes the main types of markers that may look like this: <br><br>  ArToolKit (ATK) marker system. <br><img src="https://habrastorage.org/storage2/047/0ed/682/0470ed682829596d9603c37caa6708a2.jpg"><br>  Institut Graphische Datenverarbeitung (IGD) marker system. <br><img src="https://habrastorage.org/storage2/bc5/a85/0f4/bc5a850f4e6b46d66aeae24da6510ad1.jpg"><br>  Siemens Corporate Research (SCR) marker system. <br><img src="https://habrastorage.org/storage2/874/7ba/605/8747ba605e3d2e69237f471a3890db2f.jpg"><br>  Ho Ô¨Ä man marker system (HOM) used by SCR and Framatome ANP. <br><img src="https://habrastorage.org/storage2/366/b59/9c6/366b599c64ee132c3b674a8e39cd4e09.jpg"><br><br>  The same article [1] compares the performance of different implementations of markers and recognition. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Generalized Marker Recognition Algorithm </h5><br>  In short, the marker recognition algorithm looks like this ( <a href="http://www.hitl.washington.edu/artoolkit/documentation/vision.htm">taken here</a> ): <br><img src="https://habrastorage.org/storage2/a18/9a2/d74/a189a2d748735673a0d5d0bc878e34a7.jpg"><br>  a) Given in grayscale. <br>  b) Image binarization (threshold). <br>  c) Definition of closed areas. <br>  d) Select the contours. <br>  e) Select the corners of the marker. <br>  f) Transform the coordinates. <br><br>  Let us consider in more detail what happens at each step with illustrations. <br><br><h5>  Color conversion to grayscale </h5><br>  We give three algorithms for converting a color image to grayscale. <br>  1. Lightness <br>  GS = (max (R, G, B) + min (R, G, B)) / 2 <br>  2. Luminosity (Luminosity) <br>  GS = 0.21 √ó R + 0.72 √ó G + 0.07 √ó B <br>  3. Average <br>  GS = (R + G + B) / 3 <br>  Here is an example of what these three ways look like.  As a rule, use "luminosity". <br>  Original Image: <br><img src="https://habrastorage.org/storage2/69c/938/ddf/69c938ddf34a2b6eef9785a2549c8662.jpg"><br>  Lightness: <br><img src="https://habrastorage.org/storage2/0ca/1df/b81/0ca1dfb81afe5a58e1409dfd263b4d65.jpg"><br>  Luminosity: <br><img src="https://habrastorage.org/storage2/08d/302/2dd/08d3022dd41fb4edf7b55dfadc56cd20.jpg"><br>  The average: <br><img src="https://habrastorage.org/storage2/eb9/681/d7f/eb9681d7fe53bb1d55f248bced08c4d3.jpg"><br><br><h5>  Image binarization.  Threshold </h5><br>  It is transparent that a certain threshold is used to translate an image into a two-color state.  The question is how and to what this threshold to apply.  The easiest way is to set a threshold.  For example, if we have 256 colors, we can set the threshold to 128. If we complicate things a little, we can choose the threshold using the color histogram.  In general, all methods of converting an image into an h / b form can be divided into six large groups that are listed and classified in article [2]. <br>  1) Methods based on histogram ‚Äúshape.‚Äù <br>  2) Methods based on clustering. <br>  3) Methods based on the study of entropy. <br>  4) Methods based on the search for similarities between gray and b / w image. <br>  5) Methods using correlation dependencies and features of the statistical distribution between pixels in the image areas. <br>  6) Methods based on local adaptation of the threshold for each pixel of the image. <br><br>  The most commonly used methods are based on local adaptation.  There are about forty binarization methods. If we compare them, we get another full-fledged article, so let's give an example of image binarization with a given threshold, <a href="http://homepages.inf.ed.ac.uk/rbf/HIPR2/adpthrsh.htm">adaptive</a> , and also the <a href="http://en.wikipedia.org/wiki/Otsu%2527s_method">Otsu</a> method <br><br>  Hard threshold: <br><img src="https://habrastorage.org/storage2/bc3/361/931/bc336193173f98e9526c3a435f5977f0.jpg"><br>  Adaptive: <br><img src="https://habrastorage.org/storage2/8d3/90e/9bc/8d390e9bcbd640e3cc485dfdb43f88c2.jpg"><br>  Otsu method: <br><img src="https://habrastorage.org/storage2/5f5/255/e50/5f5255e50b2c25dcf52ae4d6947c2371.jpg"><br><br><h5>  Definition of closed areas </h5><br>  We need to define closed areas on a white background.  As a rule, a combination of algorithms takes place here, but in the general case, as a rule, algorithms are used to fill white areas and select closed areas. <br>  Here <a href="http://habrahabr.ru/blogs/algorithm/116398/">the</a> person solved a similar problem and <a href="http://habrahabr.ru/blogs/image_processing/116374/">more</a> .  Variations are possible in this place.  First, the contours are selected, and then checked for closure.  Perhaps this approach is faster. <br><br>  Like this: <br><img src="https://habrastorage.org/storage2/2e6/b09/d87/2e6b09d876d7c112003022edfcd05716.jpg"><br>  Or so, at first selected contours, then checked for isolation: <br><img src="https://habrastorage.org/storage2/79f/8fb/c39/79f8fbc393081ce51fd5a4cb1d909246.jpg"><br><br><h5>  Outline selection </h5><br>  There are several approaches to the selection of contours in the image.  I will indicate the main found [3]: <br>  1) Marr-Hildreth Edge Detector <br>  2) Canny Edge Detector <br>  3) Boolean function based Edge Detector <br>  4) Euclidian distance and Vector Angle based Edge Detector <br>  5) Depth Edge Detection using Multi-Flash Imaging <br>  6) Sobel Edge Detector <br><br>  Again, the material is quite voluminous, the comparison and description of the algorithms can take more than one page.  Mainly used algorithm Canny and Sobel. <br>  Inside the white enclosed areas are looking for contours. <br>  As a result of the application, we get this image <br><br>  Kanni (need to play with the parameters of the algorithm) <br><img src="https://habrastorage.org/storage2/52f/d9b/d0c/52fd9bd0cb496b7f786344e974318d54.jpg"><br>  Sobel <br><img src="https://habrastorage.org/storage2/c6a/eeb/b26/c6aeebb2629fa459687255468a4b4947.jpg"><br><br><h5>  Marker corner selection </h5><br>  Having selected a contour, it is necessary to compare it with our marker.  Many different contours in the image can be highlighted, we need to find something ‚Äúsimilar‚Äù to a quadrilateral. <br>  To solve this problem, you can apply the <a href="http://en.wikipedia.org/wiki/Ramer%25E2%2580%2593Douglas%25E2%2580%2593Peucker_algorithm">Douglas-Pecker algorithm</a> (also known as the Rahmer-Douglas-Pecker algorithm, the iterative nearest point algorithm, the partitioning and merging algorithm), which allows to reduce the number of curve points approximated by a larger series of points. <br>  For example, in openCV there is a function approxPolyDP, which already does this.  If its result is further processed, then it turns out quite suitable result. <br><img src="https://habrastorage.org/storage2/33f/b4a/f11/33fb4af114982d25e882ea887f077848.jpg"><br>  So we got the coordinates of the corners of the marker. <br><br><h5>  Coordinate Transformation </h5><br>  Now we have the coordinates of the corners of the marker, which, in fact, ideally are perpendicular, but in reality are located at a different angle.  In addition, both ideally and in reality, the sides of the square are the axes of coordinates.  Thus, we can determine the position of the ‚Äúcamera‚Äù relative to our object, and the origin of the coordinates. <br>  What is the basis of the method of determining the coordinates can be shown graphically as follows [4]: <br><img src="https://habrastorage.org/storage2/e47/585/b76/e47585b76c5ed6df897b60c5cafe02c4.jpg"><br>  Those.  The idea is that when the angle from which the camera looks, the projection size changes.  For example: <br><img src="https://habrastorage.org/storage2/3ba/711/1d0/3ba7111d013539f00db142b3f0cc0b7d.jpg"><br>  Drawings and basic information <a href="http://mathhelpplanet.com/static.php%3Fp%3Dproektsii-vektorov-na-pryamuyu-i-na-ploskost">from here</a> .  Mathematics is described here [4]: <br>  Knowing the position of the camera and the point of reference, we can draw a projection for our 3D model.  In this case, the cube. <br>  As you can see, if we use a square with a clean field as a marker, then it is symmetrical, and we can only recognize the rotation in part.  Sometimes this is enough.  If not, then we can add an additional marker inside the square, then it will look like this <br><img src="https://habrastorage.org/storage2/0c1/e29/293/0c1e29293b3721c90ababc4e5c2988c7.jpg"><br>  and get the resulting rotation angle using the <a href="http://ru.wikipedia.org/wiki/%25D0%259F%25D1%2580%25D0%25B5%25D0%25BE%25D0%25B1%25D1%2580%25D0%25B0%25D0%25B7%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5_%25D0%25A5%25D0%25B0%25D1%2584%25D0%25B0">Hough</a> transform <br><br>  To build augmented reality, there are already libraries that can be used without going through the whole of this path again, for example, <a href="http://www.hitl.washington.edu/artoolkit/">ARToolkit</a> and its associated ones. <br><br>  This article was conceived as the first part of the training cycle on augmented reality.  In the second part, if this arouses interest in Habrayuzerov, I am going to consider the creation of applications with augmented reality for Android.  And then we can try to create an augmented reality without a specially prepared marker. <br><br>  Continued: <a href="http://habrahabr.ru/blogs/android_development/136075/">How to use the webcam in the Android emulator</a> <br><br><h5>  References </h5><br>  1.Xiang Zhang, Stephan Fronz, Nassir Navab.  Visual Marker Detection and Decoding in Systems: A Comparative Study. <br>  2. Mehmet Sezgin.  Survey over image thresholding techniques and quantitative performance evaluation. <br>  3.Ehsan Nadernejad.  Edge Detection Techniques: Evaluations and Comparisons. <br>  4.Hirokazu Kato, Mark Billinghurst.  Marker Tracking and HMD Calibration for a Video-Based Augmented Reality Conferencing System </div><p>Source: <a href="https://habr.com/ru/post/135659/">https://habr.com/ru/post/135659/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../135653/index.html">Literature for the winter - the new Windows Phone Training Kit</a></li>
<li><a href="../135654/index.html">We emulate PEAR DB when working with MySQL</a></li>
<li><a href="../135655/index.html">Microsoft will allow to run Linux in Windows Azure</a></li>
<li><a href="../135657/index.html">How do we learn</a></li>
<li><a href="../135658/index.html">Mugeda, HTML5 animation</a></li>
<li><a href="../135660/index.html">What social networks plug-ins are relevant in Russian-language projects?</a></li>
<li><a href="../135661/index.html">Wikimedia Foundation received $ 20 million from a million people</a></li>
<li><a href="../135662/index.html">Four sinister hexadecimal digits on error pages - and how to overcome them</a></li>
<li><a href="../135665/index.html">Teaching practice</a></li>
<li><a href="../135667/index.html">Usability Review Habra (wishes)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>