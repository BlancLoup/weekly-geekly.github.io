<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>About the pros and cons of Go</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, I want to share the experience gained during the rewriting of a single project from Perl to Go. It will be more about the disadvantag...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>About the pros and cons of Go</h1><div class="post__text post__text-html js-mediator-article">  In this article, I want to share the experience gained during the rewriting of a single project from Perl to Go.  It will be more about the disadvantages than about the pros, because so much has been said about the merits of Go, but about the pitfalls that await new developers, it is often impossible to find out except from their own bumps.  Fasting does not in any way pursue the goal of making Go language, although, I confess, I would be glad not to write some things.  It also covers a relatively small slice of the entire platform, in particular, there will be nothing about patterns, retexps, unpacking / packing data, and similar functionality often used in web programming. <br><a name="habracut"></a><br>  Since the post is not a member of the ‚ÄúI am PR‚Äù hub - I will describe the features of the project only briefly.  This is a high-load web application that is currently processing about 600M hits per day (peak load is more than 10k requests per second).  About 80% of requests can be sent from the cache, and the rest must be fully processed.  The working data mainly lies in the database on PostgreSQL, part in binary files with a flat structure (that is, in fact, an array, but not in memory, but in a file).  The cluster on Perl-e consisted of eight 24-nuclear machines with a practical exhausted performance margin, the cluster on Go will be already out of six with a confirmed more than threefold margin.  And the bottleneck is not so much the processor as the OS and the rest of the hardware with the software - it is not physically easy to process 10k nontrivial requests in one second on one machine, no matter how productive the backend software is. <br><br><h5>  Development speed </h5><br>  My experience with Go before refactoring was minimal.  For more than a year I have been looking at the language, I managed to study the <a href="http://golang.org/ref/spec">specification</a> from cover to cover, learned <a href="http://golang.org/doc/effective_go.html">useful</a> materials on the official <a href="http://golang.org/doc/">website</a> and <a href="http://4gophers.com/">beyond,</a> and felt myself ready to roll up my sleeves and get to work.  The initial estimate of the deadlines for work was 3-6 weeks.  The working beta was ready just at the end of the 6th week, although towards the end I began to think that I would not have time.  Clearing bugs and optimizing performance took another month. <br><br>  At first it was especially difficult, but over time, the specification had to drop in less and less, and the code was clearer.  If at first I had to use the functionality that I could code on Perl for an hour, spend Go on the whole day, then this gap was significantly reduced.  But all the same, it is much longer to program Go than on Perl ‚Äî you have to think over the structures, data types and interfaces you need for work, write all this in the code, take care of initializing the slices, maps and channels, prescribe checks for nil ... In Perl- This is all much simpler: for structures, you have to use hashes, there is no need to pre-declare the fields, and much more syntactic sugar for programmers.  Compare at least sorting - in Go there is no way to specify a closure for comparing data, you need to prescribe individual functions to get the length, and in addition to the comparison function by indexes, you must also prescribe a separate function for exchanging elements in places in the array.  Why all?  Because there are no generics, and the sorting function is easier to call the specially declared Swap (i, j) than to figure out what was slipped into it and what offsets to make this exchange of values. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In addition to sorting, I was also struck by the absence of the Perl <i>for / while () {...} continue {...}</i> construction (the <i>continue</i> block will be executed even if the current iteration is interrupted early by the <i>next</i> operator).  In Go, for this you have to use a non-kosher <i>goto</i> , which also forces you to write all the variable declarations in front of it, even those that are not used after the transition label: <br><pre><code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cnt <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ;; { <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> NEXT a := <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-comment"><span class="hljs-comment">// ./main.go:16: goto NEXT jumps over declaration of a at ./main.go:17 cnt += a NEXT: cnt ++ }</span></span></code> </pre> <br>  Also, the syntax unification paradigm for pointers and not pointers does not work completely - in the case of constructs, the compiler gives us the opportunity to use the same syntax, and for the map you already need to dereference and use parentheses, although the compiler could determine everything: <br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> T <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { cnt <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> } s := T{} p := <span class="hljs-built_in"><span class="hljs-built_in">new</span></span>(T) s.cnt ++ p.cnt ++</code> </pre>  but <br><pre> <code class="go hljs">m := <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>]T) p := <span class="hljs-built_in"><span class="hljs-built_in">new</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>]T) *p = <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>]T) m[<span class="hljs-number"><span class="hljs-number">1</span></span>] = T{} (*p)[<span class="hljs-number"><span class="hljs-number">1</span></span>] = T{} p[<span class="hljs-number"><span class="hljs-number">1</span></span>] = T{} <span class="hljs-comment"><span class="hljs-comment">// ./main.go:13: invalid operation: p[1] (type *map[int]T does not support indexing)</span></span></code> </pre><br>  By the end of the work, it was still necessary to spend time rewriting that part of the functionality that was implemented at the very beginning, due to the wrong original architecture.  The experience gained offers new architectural paradigms, but this experience must also be obtained)) <br><br>  By the way, the final amount of code in the characters almost coincided (only to align the code in Perl used two spaces, and in Go - one tab), but the lines in Go turned out to be 20% more.  True, the functionality is slightly different, Go, for example, added work with GC, but Perl also takes into account a separate library for caching SQL queries to the external file cache (with access via mmap ()).  In general, the code volume is almost equal, but Perl is still a bit more compact.  But in Go there are less brackets and semicolons - the code looks laconic and easier to read. <br><br>  In general, Go code is written quite quickly and accurately, much faster than, say, C / C ++, but for simple tasks without special performance requirements, I will continue to use Perl. <br><br><h5>  Performance </h5><br>  Let's face it, I have no particular complaints about Go in terms of performance, but I expected more.  The difference with Perl (it depends a lot on the type of computation, in arithmetic, for example, Perl does not shine at all) is about 5-10 times.  I did not have the opportunity to try gccgo, because  on FreeBSD, it is not going to hard, but sorry.  But now the backend software has ceased to be a bottleneck, their consumption of cpu is about 50% of one core, and with an increase in load, the problems will begin first with Nginx, PostgreSQL and the OS. <br><br>  In the process of optimizing performance, the profiler showed that, besides my code, the active part of the CPU also consumes runtime (this is not just a runtime package). <br>  Here is one example of top10 --cum: <br><pre> <code class="hljs swift"><span class="hljs-type"><span class="hljs-type">Total</span></span>: <span class="hljs-number"><span class="hljs-number">1945</span></span> samples <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0.0</span></span>% <span class="hljs-number"><span class="hljs-number">0.0</span></span>% <span class="hljs-number"><span class="hljs-number">1309</span></span> <span class="hljs-number"><span class="hljs-number">67.3</span></span>% runtime.gosched0 <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0.1</span></span>% <span class="hljs-number"><span class="hljs-number">0.1</span></span>% <span class="hljs-number"><span class="hljs-number">1152</span></span> <span class="hljs-number"><span class="hljs-number">59.2</span></span>% bitbucket.org/mjl/scgi.<span class="hljs-keyword"><span class="hljs-keyword">func</span></span>¬∑<span class="hljs-number"><span class="hljs-number">002</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0.1</span></span>% <span class="hljs-number"><span class="hljs-number">0.1</span></span>% <span class="hljs-number"><span class="hljs-number">1151</span></span> <span class="hljs-number"><span class="hljs-number">59.2</span></span>% bitbucket.org/mjl/scgi.serve <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0.0</span></span>% <span class="hljs-number"><span class="hljs-number">0.1</span></span>% <span class="hljs-number"><span class="hljs-number">953</span></span> <span class="hljs-number"><span class="hljs-number">49.0</span></span>% net/http.<span class="hljs-type"><span class="hljs-type">HandlerFunc</span></span>.<span class="hljs-type"><span class="hljs-type">ServeHTTP</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">0.2</span></span>% <span class="hljs-number"><span class="hljs-number">0.3</span></span>% <span class="hljs-number"><span class="hljs-number">952</span></span> <span class="hljs-number"><span class="hljs-number">48.9</span></span>% main.<span class="hljs-type"><span class="hljs-type">ProcessHttpRequest</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0.1</span></span>% <span class="hljs-number"><span class="hljs-number">0.3</span></span>% <span class="hljs-number"><span class="hljs-number">535</span></span> <span class="hljs-number"><span class="hljs-number">27.5</span></span>% main.<span class="hljs-type"><span class="hljs-type">ProcessHttpRequestFromCache</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0.0</span></span>% <span class="hljs-number"><span class="hljs-number">0.3</span></span>% <span class="hljs-number"><span class="hljs-number">418</span></span> <span class="hljs-number"><span class="hljs-number">21.5</span></span>% main.<span class="hljs-type"><span class="hljs-type">ProcessHttpRequestFromDb</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">0.8</span></span>% <span class="hljs-number"><span class="hljs-number">1.1</span></span>% <span class="hljs-number"><span class="hljs-number">387</span></span> <span class="hljs-number"><span class="hljs-number">19.9</span></span>% main.(*<span class="hljs-type"><span class="hljs-type">RequestRecord</span></span>).<span class="hljs-type"><span class="hljs-type">SelectServerInDc</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0.0</span></span>% <span class="hljs-number"><span class="hljs-number">1.1</span></span>% <span class="hljs-number"><span class="hljs-number">367</span></span> <span class="hljs-number"><span class="hljs-number">18.9</span></span>% <span class="hljs-type"><span class="hljs-type">System</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0.0</span></span>% <span class="hljs-number"><span class="hljs-number">1.1</span></span>% <span class="hljs-number"><span class="hljs-number">268</span></span> <span class="hljs-number"><span class="hljs-number">13.8</span></span>% <span class="hljs-type"><span class="hljs-type">GC</span></span></code> </pre><br>  As we see, only 49% of cpu consumed by the handler is spent on the processing of the actual scgi request, and as much as 33% is spent on System + GC <br><br>  But just top20 from the same profile: <br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">Total</span></span>: 1945 <span class="hljs-selector-tag"><span class="hljs-selector-tag">samples</span></span> 179 9<span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span>% 9<span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span>% 186 9<span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">syscall</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Syscall</span></span> 117 6<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span>% 15<span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span>% 117 6<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">runtime</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.MSpan_Sweep</span></span> 114 5<span class="hljs-selector-class"><span class="hljs-selector-class">.9</span></span>% 21<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span>% 114 5<span class="hljs-selector-class"><span class="hljs-selector-class">.9</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">runtime</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.kevent</span></span> 93 4<span class="hljs-selector-class"><span class="hljs-selector-class">.8</span></span>% 25<span class="hljs-selector-class"><span class="hljs-selector-class">.9</span></span>% 96 4<span class="hljs-selector-class"><span class="hljs-selector-class">.9</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">runtime</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.cgocall</span></span> 93 4<span class="hljs-selector-class"><span class="hljs-selector-class">.8</span></span>% 30<span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span>% 93 4<span class="hljs-selector-class"><span class="hljs-selector-class">.8</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">runtime</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.sys_umtx_op</span></span> 67 3<span class="hljs-selector-class"><span class="hljs-selector-class">.4</span></span>% 34<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span>% 152 7<span class="hljs-selector-class"><span class="hljs-selector-class">.8</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">runtime</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.mallocgc</span></span> 63 3<span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span>% 37<span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span>% 63 3<span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">runtime</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.duffcopy</span></span> 56 2<span class="hljs-selector-class"><span class="hljs-selector-class">.9</span></span>% 40<span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span>% 99 5<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">hash_insert</span></span> 56 2<span class="hljs-selector-class"><span class="hljs-selector-class">.9</span></span>% 43<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span>% 56 2<span class="hljs-selector-class"><span class="hljs-selector-class">.9</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">scanblock</span></span> 53 2<span class="hljs-selector-class"><span class="hljs-selector-class">.7</span></span>% 45<span class="hljs-selector-class"><span class="hljs-selector-class">.8</span></span>% 53 2<span class="hljs-selector-class"><span class="hljs-selector-class">.7</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">runtime</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.usleep</span></span> 39 2<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span>% 47<span class="hljs-selector-class"><span class="hljs-selector-class">.8</span></span>% 39 2<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">markonly</span></span> 36 1<span class="hljs-selector-class"><span class="hljs-selector-class">.9</span></span>% 49<span class="hljs-selector-class"><span class="hljs-selector-class">.7</span></span>% 41 2<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">runtime</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.mapaccess2_fast32</span></span> 28 1<span class="hljs-selector-class"><span class="hljs-selector-class">.4</span></span>% 51<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span>% 28 1<span class="hljs-selector-class"><span class="hljs-selector-class">.4</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">runtime</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.casp</span></span> 25 1<span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span>% 52<span class="hljs-selector-class"><span class="hljs-selector-class">.4</span></span>% 34 1<span class="hljs-selector-class"><span class="hljs-selector-class">.7</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">hash_init</span></span> 23 1<span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span>% 53<span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span>% 23 1<span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">hash_next</span></span> 22 1<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span>% 54<span class="hljs-selector-class"><span class="hljs-selector-class">.7</span></span>% 22 1<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">flushptrbuf</span></span> 22 1<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span>% 55<span class="hljs-selector-class"><span class="hljs-selector-class">.8</span></span>% 22 1<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">runtime</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xchg</span></span> 21 1<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span>% 56<span class="hljs-selector-class"><span class="hljs-selector-class">.9</span></span>% 29 1<span class="hljs-selector-class"><span class="hljs-selector-class">.5</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">runtime</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.mapaccess1_fast32</span></span> 21 1<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span>% 58<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span>% 21 1<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">settype</span></span> 20 1<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span>% 59<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span>% 31 1<span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">runtime</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.mapaccess1_faststr</span></span></code> </pre><br>  The calculations of my code are simply lost on the background of the tasks that runtime has to deal with (however, it should be so, I have no trace of heavy mathematics). <br><br>  IMHO, there is still a huge reserve for optimizing the compiler and libraries.  For example, I did not notice inlining, but all my mutexes are clearly visible in the scans of a stack of gorutin.  The compiler optimization process is not in place (not so long ago, Dmitry Vyukov <a href="https://docs.google.com/document/d/1yIAYmbvL3JxOKOjuCyon7JhW4cSv1wy5hC0ApeGMV9s/pub">presented a</a> significantly accelerated implementation of channels, for example), but fundamental changes are not often noticeable.  For example, after switching from Go 1.2 to Go 1.3, I practically did not see any difference in performance at all. <br><br>  Even during the optimization I had to abandon the math / rand package.  The fact is that in the course of processing a request, pseudo-random numbers were often needed, but with data binding, and rand.Seed () used too much CPU (the profiler showed 13% of the total).  Who needs it, that will generate a random pseudo random number generation method with Seed (), but all the same - for cryptographic purposes there is a crypto / rand package, and in math / rand you could not bother so much about high-quality mixing of bits during initialization. <br>  By the way, I ended up with the following algorithm: <br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RandFloat64</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(seed </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint64</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">float64</span></span></span></span> { seed ^= seed &gt;&gt; <span class="hljs-number"><span class="hljs-number">12</span></span> seed ^= seed &lt;&lt; <span class="hljs-number"><span class="hljs-number">25</span></span> seed ^= seed &gt;&gt; <span class="hljs-number"><span class="hljs-number">27</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float64</span></span>((seed*<span class="hljs-number"><span class="hljs-number">2685821657736338717</span></span>)&amp;<span class="hljs-number"><span class="hljs-number">0x7fffffffffffffff</span></span>) / (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">63</span></span>) }</code> </pre><br><br>  It is very convenient that all the calculations take place in one process, on Perl, separate workflow processes were used and I had to organize a shared cache ‚Äî something through memcached, something through a file.  On Go, this is much easier and more natural.  But now, in the absence of an external cache, the problem of a cold start arises, then I had to tinker a bit - first I tried to limit to nginx (so that one hundred thousand gorutins would not start at the same time and not everything) the number of simultaneous requests to the upstream via the <a href="https://github.com/cfsego/nginx-limit-upstream">https: //</a> module <a href="https://github.com/cfsego/nginx-limit-upstream">github.com/cfsego/nginx-limit-upstream</a> , but it didn‚Äôt work very well (when the connection pool was clogged, it was somehow difficult for him to return to the normal mode, even after the load was removed).  As a result, I patched the scgi module a bit and added a limiter on the number of simultaneously executed requests - until the processing of some of the current requests is finished - the new one will not be accepted Accept () - th: <br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ServeLimited</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(l net.Listener, handler http.Handler, limit </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> limit &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span> { Serve(l, handler) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> l == <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> err error l, err = net.FileListener(os.Stdin) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> err } <span class="hljs-keyword"><span class="hljs-keyword">defer</span></span> l.Close() } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> handler == <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { handler = http.DefaultServeMux } sem := <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">chan</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span>{}, limit) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> { sem &lt;- <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span>{}{} rw, err := l.Accept() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> err } <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rw net.Conn)</span></span></span></span> { serve(rw, handler) &lt;-sem }(rw) } }</code> </pre><br>  The <a href="http://bitbucket.org/mjl/scgi">scgi</a> module was also chosen for performance reasons - net / http / fcgi for some reason was ultimately slower than just net / http (and did not support persistent connection), and net / http additionally loaded the OS with generation of tcp packets and support for internal tcp connections (although it is technically possible to start it to listen on a unix-socket) - and if you could get rid of it, then why not get rid of it?  Using nginx as a frontend gives its advantages - control of timeouts, logging, forwarding failed requests to other servers from the cluster - and all this with minimal additional load on the server.  Another advantage of this approach is that by <i>netstat -Lan</i> , when the Accept queue grows on the scgi socket, it means that we have an overload somewhere and something needs to be done. <br><br><h5>  Code quality and debugging </h5><br>  The <a href="http/pprof/">net / http / pprof package</a> is a magic thing!  This is something like the Apache server-status module, but for the Go daemon.  And, by the way, I would not recommend including it in production if you use DefaultServeMux instead of the dedicated http handler - since the package is available to everyone via the link / debug / pprof /.  I have no such problem, on the contrary, in order to get access to the package functions via http, you need to run a separate mini-server on localhost: <br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">go</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { log.Println(http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">"127.0.0.1:8081"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)) }()</code> </pre><br>  In addition to getting a profile on the processor and memory, this module allows you to browse through the stack a list of all currently running gortuin, the whole chain of functions that are currently running and in what state: / debug / pprof / goroutine \? Debug = 1 gives a list of different gorutin and their states, and / debug / pprof / goroutine \? debug = 2 gives a list of all launched rods, incl.  and duplicate (i.e., in completely identical states).  Here is an example of one of them: <br><pre> <code class="hljs go">goroutine <span class="hljs-number"><span class="hljs-number">85</span></span> [IO wait]: net.runtime_pollWait(<span class="hljs-number"><span class="hljs-number">0x800c71b38</span></span>, <span class="hljs-number"><span class="hljs-number">0x72</span></span>, <span class="hljs-number"><span class="hljs-number">0x0</span></span>) /usr/local/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/src/pkg/runtime/netpoll.goc:<span class="hljs-number"><span class="hljs-number">146</span></span> +<span class="hljs-number"><span class="hljs-number">0x66</span></span> net.(*pollDesc).Wait(<span class="hljs-number"><span class="hljs-number">0xc20848d</span></span>aa0, <span class="hljs-number"><span class="hljs-number">0x72</span></span>, <span class="hljs-number"><span class="hljs-number">0x0</span></span>, <span class="hljs-number"><span class="hljs-number">0x0</span></span>) /usr/local/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/src/pkg/net/fd_poll_runtime.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>:<span class="hljs-number"><span class="hljs-number">84</span></span> +<span class="hljs-number"><span class="hljs-number">0x46</span></span> net.(*pollDesc).WaitRead(<span class="hljs-number"><span class="hljs-number">0xc20848d</span></span>aa0, <span class="hljs-number"><span class="hljs-number">0x0</span></span>, <span class="hljs-number"><span class="hljs-number">0x0</span></span>) /usr/local/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/src/pkg/net/fd_poll_runtime.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>:<span class="hljs-number"><span class="hljs-number">89</span></span> +<span class="hljs-number"><span class="hljs-number">0x42</span></span> net.(*netFD).accept(<span class="hljs-number"><span class="hljs-number">0xc20848d</span></span>a40, <span class="hljs-number"><span class="hljs-number">0x8df</span></span>378, <span class="hljs-number"><span class="hljs-number">0x0</span></span>, <span class="hljs-number"><span class="hljs-number">0x800c6c518</span></span>, <span class="hljs-number"><span class="hljs-number">0x23</span></span>) /usr/local/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/src/pkg/net/fd_unix.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>:<span class="hljs-number"><span class="hljs-number">409</span></span> +<span class="hljs-number"><span class="hljs-number">0x343</span></span> net.(*UnixListener).AcceptUnix(<span class="hljs-number"><span class="hljs-number">0xc208273880</span></span>, <span class="hljs-number"><span class="hljs-number">0x8019acea8</span></span>, <span class="hljs-number"><span class="hljs-number">0x0</span></span>, <span class="hljs-number"><span class="hljs-number">0x0</span></span>) /usr/local/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/src/pkg/net/unixsock_posix.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>:<span class="hljs-number"><span class="hljs-number">293</span></span> +<span class="hljs-number"><span class="hljs-number">0x73</span></span> net.(*UnixListener).Accept(<span class="hljs-number"><span class="hljs-number">0xc208273880</span></span>, <span class="hljs-number"><span class="hljs-number">0x0</span></span>, <span class="hljs-number"><span class="hljs-number">0x0</span></span>, <span class="hljs-number"><span class="hljs-number">0x0</span></span>, <span class="hljs-number"><span class="hljs-number">0x0</span></span>) /usr/local/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/src/pkg/net/unixsock_posix.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>:<span class="hljs-number"><span class="hljs-number">304</span></span> +<span class="hljs-number"><span class="hljs-number">0x4b</span></span> bitbucket.org/mjl/scgi.ServeLimited(<span class="hljs-number"><span class="hljs-number">0x800c7ec58</span></span>, <span class="hljs-number"><span class="hljs-number">0xc208273880</span></span>, <span class="hljs-number"><span class="hljs-number">0x800c6c898</span></span>, <span class="hljs-number"><span class="hljs-number">0x8df</span></span>178, <span class="hljs-number"><span class="hljs-number">0x1f</span></span>4, <span class="hljs-number"><span class="hljs-number">0x0</span></span>, <span class="hljs-number"><span class="hljs-number">0x0</span></span>) /home/user/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/src/bitbucket.org/mjl/scgi/scgi.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>:<span class="hljs-number"><span class="hljs-number">177</span></span> +<span class="hljs-number"><span class="hljs-number">0x20d</span></span> main.<span class="hljs-keyword"><span class="hljs-keyword">func</span></span>&lt;C2&gt;&lt;B7&gt;<span class="hljs-number"><span class="hljs-number">008</span></span>() /home/user/repo/main.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>:<span class="hljs-number"><span class="hljs-number">264</span></span> +<span class="hljs-number"><span class="hljs-number">0x90</span></span> created by main.main /home/user/repo/main.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>:<span class="hljs-number"><span class="hljs-number">265</span></span> +<span class="hljs-number"><span class="hljs-number">0x1f</span></span>5c</code> </pre><br>  It helped me to reveal a bug with locks (under certain conditions RUnlock () was called twice, and it is impossible to do this) - in the stack dump I saw the whole pack of locked gorutin and line numbers where there was a RUnlock () call. <br><br>  The CPU profile is also quite good, I recommend putting gv (ghostview) and looking at the Xorg transition diagram between functions with counters - you can see what you should pay attention to and optimize. <br><br>  go vet is a useful utility, but my main use has been reduced to warnings about missing format specifiers in all printf () - the compiler is unable to detect this.  On clearly bad code <br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> UintValue &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> { DoSomething() }</code> </pre>  vet does not respond. <br><br>  The main work on checking the code is performed by the compiler.  He regularly swears at unused variables and packages, but neither the compiler nor the vet react to the unused fields in the structures (at least with a warning), although there is something to pay attention to too. <br><br>  It should be neat with the operator <i>: =</i> .  I had a case when I had to calculate the difference between two uint, incl.  correctly consider the negative difference as negative, and the code <br><pre> <code class="go hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a, b <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span> ... diff := a - b</code> </pre>  thinks not what you expect - you need to use a cast to sign type (or not use unsigned). <br><br>  There is also a good practice to name the same data types with different purposes by different names.  For example: <br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ServerIdType <span class="hljs-keyword"><span class="hljs-keyword">uint32</span></span> <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> CustomerIdType <span class="hljs-keyword"><span class="hljs-keyword">uint32</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ServerId ServerIdType <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> CustomerId CustomerIdType</code> </pre>  And now for the CustomerId variable, the compiler will not allow just writing the ServerId value (without a type conversion), despite the fact that it is there and there inside uint32.  It helps from all sorts of typos, although now I often have to use type casting, especially when initializing variables. <br><br><h5>  Packages, libraries and bundle with C </h5><br>  An important role in Go's popularity was played by an effective (alas, not in terms of performance, with this while some problems) mechanism of interaction with C-libraries.  By and large - a significant part of the Go-libraries are just wrappers over their C counterparts.  For example, the github.com/abh/geoip and github.com/jbarham/gopgsqldriver packages are compiled with -lGeoIP and -lpq respectively (well, I use the native Go PostgreSQL driver - github.com/lib/pq). <br><br>  For example, consider the almost standard crypt () function from unistd.h ‚Äî this function is out of the box in many languages, for example, in the Nginx Perl module, it can be used without loading additional modules, which is useful.  But not in Go, here you need to forward it to C yourself.  This is done elementarily (in the example, the salt is cut off from the result): <br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// #cgo LDFLAGS: -lcrypt // #include &lt;unistd.h&gt; // #include &lt;stdlib.h&gt; import "C" import ( "sync" "unsafe" ) var cryptMutex sync.Mutex func Crypt(str, salt string) string { cryptStr := C.CString(str) cryptSalt := C.CString(salt) cryptMutex.Lock() key := C.GoString(C.crypt(cryptStr, cryptSalt))[len(salt):] cryptMutex.Unlock() C.free(unsafe.Pointer(cryptStr)) C.free(unsafe.Pointer(cryptSalt)) return key }</span></span></code> </pre>  Lock is needed because  crypt () returns the same char * to the internal state, the resulting string must be copied, otherwise it will be overwritten by the next call, i.e.  the function is not thread-safe. <br><br><h5>  database / sql </h5><br>  For each used Db handler, I recommend calling the prescribe maximum connection limit and specifying some non-zero limit of idle connections: <br><pre> <code class="go hljs">db.SetMaxOpenConns(<span class="hljs-number"><span class="hljs-number">30</span></span>) db.SetMaxIdleConns(<span class="hljs-number"><span class="hljs-number">8</span></span>)</code> </pre>  The first will avoid overloading the database and use it in maximum performance mode (with an increase in the number of simultaneous connections, database performance begins to fall at some point, there is an optimal number of simultaneous requests), and the second will remove the need to open a new connection on every request for PostgreSQL with its fork () mode is especially important.  Of course, for PostgreSQL, you can also use pgpool or pgbouncer, but this is all an extra overhead for sending data to the kernel and additional delays - so it‚Äôs best to ensure consistency of connections right at the application level. <br><br>  To exclude the overhead projector to parse the query and build the plan, use prepared statements instead of direct queries.  But it must be borne in mind - in some cases the query planner may not use the most optimal plan, since it is built at the stage of parsing the query (and not its execution) and the planner does not always have enough data to know which index is preferable to use.  By the way, placeholders for variables in the PostgreSQL Go driver use '$ 1', '$ 2', etc., instead of '?', As in Perl. <br><br>  sql. (Rows) .Scan () has one feature ‚Äî it does not understand renamed string types, for example, <i>type DomainNameType string</i> .  You have to set up a temporary variable of the <i>string</i> type and load the data from the database into it, and then make an assignment with type conversion.  With renamed numeric types, for some reason there is no such problem. <br><br><h5>  Channels and sync </h5><br>  There is a somewhat mistaken opinion that since we have channels in Go, then it is worth using them and only them.  This is not entirely true - each task has its own tool.  Channels are great for sending various kinds of messages, but it‚Äôs quite legal to use mutexes for working with shared resources, for example, the sql cache.  To work with the cache through the channels, we will have to write a query manager, which ultimately limits the performance of accessing the cache to one core, adds even more work to the scheduler, and adds an overhead to copy and read data to the channel, plus you need to create a temporary channel each time back to the calling function.  The code with the use of channels also often becomes many times larger and more complex than the code with mutexes (oddly enough).  But with mutexes you need to be extremely careful not to get into deadlock. <br><br>  In Go, there is a tricky feature like <i>struct {}</i> .  Those.  completely empty structure, borderless.  It occupies zero space, an array of any size of such structures also occupies zero space, and the buffered channel of empty structures also occupies zero space (plus internal data, of course).  Actually, this buffered channel of empty structures is a semaphore, in the compiler even a separate handler is made for it - if you need a semaphore with Go syntax - you can use <i>chan struct {}</i> . <br><br>  A bit sad is the package sync.  For example, there are no spinlockers, although they are very useful, as they are fast (although using GL spinlockers becomes a risky business).  Yes, and the operations with mutexes do not inline (as far as I can tell).  Even more frustrating is the inability to upgrade the RWMutex lock - if the lock is in the RLock status and it turned out that it is necessary to make changes - please do RUnlock (), then Lock () and check again whether there is still a need to make these changes or some kind of change. I managed to do everything.  There is also no non-blocking function TryLock (), again it is not clear why - for some cases, it is extremely necessary.  Here the developers of the language with their "we know better how you need to program," IMHO, have already gone too far. <br><br>  In some cases, sync / atomic with its atomic operations helps to avoid using mutexes.  For example, in my code, the current <i>uint32 timestamp</i> is often used - I keep it in a global variable and at the beginning of each query I just atomically keep the current value in it.  I know that a little dirty approach could have been written to the helper function, but in the struggle for performance sometimes I have to make such sacrifices - I can now use this variable in arithmetic expressions without special restrictions. <br><br>  There is another good optimization method for the case when some general data is updated only in one place (for example, periodically), and in other cases it is used in the ‚Äúread only‚Äù mode.  The bottom line is that there is no need to do RLock () / RUnlock () on read operations (and Lock () / Unlock () on updates) - the update function can load data into a new memory area and then atomically replace the pointer with old data with a pointer on new ones.  True, in Go, the function of the atomic pointer entry requires the unsafe.Pointer type, and you have to construct such a construction: <br><pre> <code class="go hljs">atomic.StorePointer((*unsafe.Pointer)(unsafe.Pointer(&amp;Data)), unsafe.Pointer(&amp;newData))</code> </pre>  But you can use this data in any expression, without worrying about locks.  This is of particular importance for Go, because  seemingly short locks can actually be very long - and all because of the GC. <br><br><h5>  GC (garbage collector) </h5><br>  He drank my krovushka fairly; (. Imagine the situation - you start a load test - everything is ok. You let live traffic - everything is fine too. And then bam - and everything becomes bad or very, very bad - old requests hang, new ones arrive and arrive (several thousand per second), you have to restart the application, after which everything again stupid, because the cache has to be filled again, but at least it works and after some time returns to normal. I measured the execution time of each request processing stages - and  I believe that periodically the execution time of all stages jumps up to three seconds and more, even those who do not use locks, do not use access to the database and files, but do only local calculations and usually fit into microseconds. It became clear that the source of the problem there was not some external factor, but the platform itself, more precisely, the garbage collector. <br><br>  It's good that in Go you can see the statistics of the work of GC via runtime / debug.ReadGCStats () - there is something to be surprised about.  In my case, the most unloaded server GC worked in the following mode: <br>  0.06 <br>  0.30 <br>  2.00 <br>  0.06 <br>  0.30 <br>  2.00 <br>  ... <br>  The order of magnitude is preserved, although the numbers themselves varied slightly.  This is the duration of the sleep application for the time of the GC, at the top of the most recent.  Pause all work for 2 seconds - what?  I'm afraid to even imagine what was happening on the busiest servers, but I did not touch them anymore, so as not to create unnecessary downtime. <br><br>  The solution is to run GC () more often, for reliability it is better to independently from the program.  You can even just periodically, but I got a little confused and made a query counter, as well as a forced launch of GC () after major cleansing of obsolete data.  As a result, GC () began to run every ten to twenty seconds instead of every few minutes, but each pass occupies stably around 0.1s - quite another thing!         20.      ,       ,     .       GC,        ,       ‚Äî          . <br><br><h5> maps </h5><br>    ,   (   Perl) ‚Äî   .                .  ,         : <br><pre> <code class="go hljs">valueType, ok := map_fetch(keyType) map_store(keyType, valueType) map_delete(keyType)</code> </pre>      .       ‚Äî  ,          (.. ,      ,     )    ‚Äî      <br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> T <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { cnt <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> } m := <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>]T) m[<span class="hljs-number"><span class="hljs-number">0</span></span>] = T{} m[<span class="hljs-number"><span class="hljs-number">0</span></span>].cnt++ <span class="hljs-comment"><span class="hljs-comment">// ./main.go:9: cannot assign to m[0].cnt</span></span></code> </pre>         m[0],    cnt  . <br><br>        <br><pre> <code class="go hljs">m := <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>]*T) m[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span>(T) m[<span class="hljs-number"><span class="hljs-number">0</span></span>].cnt++</code> </pre>        <br><pre> <code class="go hljs">m := <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>]T) tmp := m[<span class="hljs-number"><span class="hljs-number">0</span></span>] tmp.cnt++ m[<span class="hljs-number"><span class="hljs-number">0</span></span>] = tmp</code> </pre>        ,   ‚Äî  (   ) <br><br>   ,   ,        map_store    <br><pre> <code class="go hljs">*valueType = map_allocate(keyType)</code> </pre>    ,           . <br><br>  map_allocate          ,    ,    .       ,   ,     ‚Äî      ,   . <br><br>   ,              .         ‚Äî        ,          .  ,    ,             unsafe ‚Äî       ,   ,     ‚Äî               . <br><br>      ,          .     ,           ‚Äî     ,    ?          ,         ,         ,          . <br><br><h5>  Total </h5><br> ,    .     ,      . ,  Go   ,  ,  ,  ,   .  Go       ,           . <br><br>          .       C (     FreeBSD), Perl  Shell-scripting (  ).    Python, Ruby  JS      ,   ‚Äî         ,        . Go       ,    .                ‚Äî    . </div><p>Source: <a href="https://habr.com/ru/post/229169/">https://habr.com/ru/post/229169/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../229151/index.html">PFSense Package Writing: Controls</a></li>
<li><a href="../229157/index.html">TrulySecure: biometric user authentication for mobile devices</a></li>
<li><a href="../229161/index.html">Google Co-Founders on Industry Regulation and Innovation</a></li>
<li><a href="../229165/index.html">Armed robbers robbed Samsung plant for $ 6 million, stealing 40 thousand devices</a></li>
<li><a href="../229167/index.html">Automatic detection of the connection / disconnection of the second monitor</a></li>
<li><a href="../229171/index.html">Microsoft and Adobe released a set of updates, July 2014</a></li>
<li><a href="../229173/index.html">Humble 2K Bundle</a></li>
<li><a href="../229175/index.html">Manage object serialization in MultiCAD.NET</a></li>
<li><a href="../229177/index.html">Efficient campaign automation in Google AdWords</a></li>
<li><a href="../229179/index.html">Own dynamic dns on Go using Cloudflare</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>