<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Correct field output in Drupal 7</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Translation of an article from ComputerMinds : Rendering Drupal 7 fields (the right way) 

 Short answer 
 Use field_view_field ()! 

 Full answer 
 D...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Correct field output in Drupal 7</h1><div class="post__text post__text-html js-mediator-article">  Translation of an article from <a href="http://www.computerminds.co.uk/">ComputerMinds</a> : <a href="http://www.computerminds.co.uk/articles/rendering-drupal-7-fields-right-way">Rendering Drupal 7 fields (the right way)</a> <br><a name="habracut"></a><br><h5>  Short answer </h5><br>  Use field_view_field ()! <br><br><h5>  Full answer </h5><br>  Drupal 7 gives you the opportunity to work with entities (Entities), and with it a powerful API for working with fields that can be attached to entities.  If you manage the fields through the "Field Management" and "Display Management" tabs on the material type page, then Drupal will take care of the correct work with the fields. <br><br>  However, we often encounter the need to display a field outside the entity.  A typical example would be the display of data about the author of the node in the side column of the site.  Of course, modules such as Panels and CCK Blocks can do this on their own, but to do it manually is not so difficult. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      You may have seen (or wrote) a code that looks like this: <br><br><pre><code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//    $block['content'] = $node-&gt;field_name['und'][0]['safe_value'];</span></span></code> </pre> <br><br>  Digging into the node object was pretty common in Drupal 6, and the ‚Äúsafe_value‚Äù would seem to help avoid potential problems.  What's bad about it?  Let's consider. <br><br><ol><li>  First, the element ['und'] is part of the localization of the field in Drupal 7;  direct access to its meaning will lead to problems in any multilingual environment. <br></li><li>  By accessing the field value directly, we lose the ability to themeize the field render and use basic markup. <br></li><li>  [0] [safe_value] explicitly refers to the first field value - if you want to use each value from multiple field values ‚Äã‚Äã- you will have to use a loop. <br></li><li>  Some fields (for example, node references) do not have a safe_value element, only value, which can be easily displayed without corresponding preprocessing.  This is dangerous, and not only because node references contains dangerous data (the same nid), but also because it is a habit habit, especially for new developers.  Using the value of other types of fields can also be very dangerous. <br></li></ol><br><br>  Fortunately, there is a <a href="http://api.drupal.org/api/drupal/modules--field--field.module/function/field_view_field/7">field_view_field ()</a> ! <br><br><pre> <code class="php hljs">$output = field_view_field(<span class="hljs-string"><span class="hljs-string">'node'</span></span>, $node, <span class="hljs-string"><span class="hljs-string">'field_name'</span></span>);</code> </pre><br><br>  This function will return the cleared values ‚Äã‚Äã(fix 4) of the field in full (fix 3) in the current language (fix 1) and in an array format ready for rendering, therefore you will receive all the related data with markup (fix 2).  Victory!  If the field does not matter, the function will use the reserved parts of the logic language available for the current language.  You can also pass an array of formatting options or set the view mode as an additional function argument.  Isn't it a great option? <br><br><h5>  Additional tips </h5><br>  Suppose you just want to get one value without markup.  There are two Field API functions to help you in this case.  First, we have <a href="http://api.drupal.org/api/drupal/modules--field--field.module/function/field_get_items/7">field_get_items ()</a> which returns the element fields in the correct language (again, you can specify the language if you need it).  You can dig into it and get raw data, perhaps for use on the server side or if you want to do something exotic, like, for example, ‚Äúalt‚Äù values ‚Äã‚Äãfor an image field.  Do not forget that you are dealing with raw data and <b>you need to do the correct preliminary data processing</b> before using the values, otherwise you will create vulnerabilities in your project. <br><br>  In addition, there is another handy Field API function, <a href="http://api.drupal.org/api/drupal/modules--field--field.module/function/field_view_value/7">field_view_value ()</a> , which will help when you want to get a single field value using the built-in data cleaning rules.  This function also uses the format field.  It takes one field value, which is taken from the array returned by field_view_value ().  Here is an example: <br><br><pre> <code class="php hljs">$node = node_load($nid); $field = field_get_items(<span class="hljs-string"><span class="hljs-string">'node'</span></span>, $node, <span class="hljs-string"><span class="hljs-string">'field_name'</span></span>); $output = field_view_value(<span class="hljs-string"><span class="hljs-string">'node'</span></span>, $node, <span class="hljs-string"><span class="hljs-string">'field_name'</span></span>, $field[$delta]);</code> </pre><br><br>  Where $ delta is the index of the field whose value you want to get.  For a single field, the value of $ delta will be 0. Everything is very simple. <br><br>  And, just for fun, here is a final example using some formatting options that indicate the ImageCache style and make a reference to the node.  This example will work the same way as field_view_value () and field_view_field (). <br><br><pre> <code class="php hljs">$node = node_load($nid); $image = field_get_items(<span class="hljs-string"><span class="hljs-string">'node'</span></span>, $node, <span class="hljs-string"><span class="hljs-string">'field_image'</span></span>); $output = field_view_value(<span class="hljs-string"><span class="hljs-string">'node'</span></span>, $node, <span class="hljs-string"><span class="hljs-string">'field_image'</span></span>, $image[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'image'</span></span>, <span class="hljs-string"><span class="hljs-string">'settings'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'image_style'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'thumbnail'</span></span>, <span class="hljs-string"><span class="hljs-string">'image_link'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'content'</span></span>, ), ));</code> </pre><br><br><h5>  This is rock! </h5><br>  Of course, in the case of, for example, using the ‚Äúfield-as-a-block‚Äù Field API, it does it really well, cleanly and simply.  We are dealing with the visualization of arrays, so we can make changes until the trigger () function is invoked, which is called in the template file.  And, using <a href="http://api.drupal.org/api/drupal/modules--field--field.module/function/field_view_field/7">field_view_field ()</a> and <a href="http://api.drupal.org/api/drupal/modules--field--field.module/function/field_view_value/7">field_view_value ()</a> you can be sure that the data will be processed in accordance with the built-in data cleaning rules. </div><p>Source: <a href="https://habr.com/ru/post/163501/">https://habr.com/ru/post/163501/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../163491/index.html">Boomfox + Tracks Flow</a></li>
<li><a href="../163493/index.html">Thermal imager: we look at the world through the eyes of a Predator</a></li>
<li><a href="../163495/index.html">New year and new victories</a></li>
<li><a href="../163497/index.html">Instead of the end of the world. Apps beat browser</a></li>
<li><a href="../163499/index.html">Overview FLOWMASTER</a></li>
<li><a href="../163507/index.html">Print out the popcorn, it's time for a movie</a></li>
<li><a href="../163509/index.html">A reader of quote books that saves you time and traffic</a></li>
<li><a href="../163511/index.html">Pyongyang Racer: the first computer game from North Korea</a></li>
<li><a href="../163515/index.html">ETERNUS DX disk arrays, what's inside. Part 2</a></li>
<li><a href="../163519/index.html">Are you allowed not to go to the office and work from home?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>