<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PowerShell + Hyper-V</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I can not already through gui ... 
 Something like this was the beginning of my conversation with a friend who, for a short time, had to export virtua...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PowerShell + Hyper-V</h1><div class="post__text post__text-html js-mediator-article"><h4>  I can not already through gui ... </h4><br>  Something like this was the beginning of my conversation with a friend who, for a short time, had to export virtual machines from Hyper-V several times in a row.  Hyper-V Manager (HVM), which is installed with the Hyper-V role under Windows Server 2008 R2, is typically used for this.  I must admit that the interface of this program does not cause me any negative emotions.  Among all the management programs that Microsoft supplies to Server, this seems to me the most convenient and understandable (for example, I compare with the IIS Manager, which causes confusion among new users and violent indignation among those who used IIS 6 in 2003 Server).  However, if you need to export or import a virtual machine in the number of N-pieces in a period of t-time, then using the Hyper-V Manager, you can break the button at the mouse and you will terribly hate Hyper-V.  This is where PowerShell comes to the rescue. <br><a name="habracut"></a><br><h5>  Import-Module HyperV </h5><br>  ... And of course there is no such module in PowerShell by default.  Microsoft decided that no one would write cmdlets to manage Hyper-V (really a wild idea).  On the other hand, this world is full of people who are able and willing to simplify life for themselves and other users.  This is how the PowerShell management Library for Hyper-V was born. <br>  The first thing you need to do is download this module + documentation to your liking.  (Both are available at: <a href="http://pshyperv.codeplex.com/releases">http://pshyperv.codeplex.com/releases</a> ) <br>  Then you need to install this module.  The process is not complicated (the install file that is launched gives itself off). <br>  Now you can work.  Run PowerShell, import the module (what is written in the subtitle). <br>  And we have access to all the functions that we could use via HVM, here are some of them: <br><br>  <b>Connect to a virtual machine</b> <br>  New-VMConnectSession <br><br>  <b>Manipulating the state of virtual machines</b> <br>  Get-VMState, Set-VMState, Convert-VmState, <br>  Ping-VM, Test-VMHeartBeat, Shutdown-VM, Start-VM, Stop-VM, Suspend-VM <br>  Get-VMKVP, Add-KVP, Remove-KVP, Get-VMJPEG 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>The ability to make backups, exporting virtual machines and taking snapshots</b> <br>  Export-VM, Import-VM, Get-VMSnapshot, Choose-VMSnapshot, Apply-VMSnapshot, New-VMSnapshot, Remove-VMSnapshot, Rename-VMSnapShot, Update-VMSnapshot, Get-VMSnapshotTree, Get-VmBackupScript <br><br>  <b>Adding and removing Wirth.</b>  <b>machines, setting their properties</b> <br>  New-VM, Remove-VM, Set-VM, Get-VMCPUCount, Set-VMCPUCount, Get-VMMemory, Set-VMMemory, Set-VMSerialPort <br><br>  <b>Disk Controller Management</b> <br>  Get-VMDiskController <br>  Add-VMSCSIController, Remove-VMSCSIcontroller <br>  Get-VMDriveByController, Add-VMDRIVE, Remove-VMdrive <br>  Get-VMDiskByDrive, Add-VMDISK, Set-VMDisk, Get-VMDisk <br>  Get-VMFloppyDisk, Add-VMFloppyDisk <br>  Add-VMNewHardDisk <br><br>  <b>Network Interface Management</b> <br>  Get-VMNic, List-VMNic, Choose-VMNIC, Add-VMNIC, Remove-VMNIC, Set-VMNICAddress, Set-VMNICConnection, Get-VMNicport, <br>  Get-VMnicSwitch, Choose-VMSwitch, New-VMSwitchPort, Get-VMByMACaddress, Choose-VMExternalEthernet, <br>  New-VMExternalSwitch, New-VMInternalSwitch, New-VmPrivateSwitch <br><br>  <b>Work with VHD files</b> <br>  Get-VHDDefaultPath, Get-VHDInfo, New-VHD, Compact-VHD, Test-VHD, Convert-VHD, Merge-VHD, Mount-VHD, Unmount-VHD <br><br>  All the commands listed speak for themselves. <br>  For example, to get the state of the virtual machine, just enter: <br> <code>List-VMState <i> . </i></code> <br>  and as a result: <br><img src="https://habrastorage.org/storage/55dae715/0359b344/c97c7d20/02964a22.jpg" alt="image"><br>  In my example, there is only one virtual machine =&gt; I did not specify any parameters, but if you have a lot of them, then you should probably indicate its name explicitly, if you don‚Äôt want to then wade through the console output. <br>  It is also easy, for example, to learn about the used network interfaces for virtual machines, just enter: <br> <code>Get-VMNic</code> <br>  and we get: <br><img src="https://habrastorage.org/storage/1172b725/e466dded/fce230ea/1a12bb94.jpg" alt="image"><br>  Well and the most, that was necessary for my friend - an opportunity to do export in a background, according to the schedule.  To do this, you can write a cmdlet which then stuff in Scheduler.  For example, for me, this cmdlet stops a virtual machine, exports it, starts it again and sends me a letter about the error or success of the cmdlet execution.  After that, control is transferred to another script that archives and sends a backup to a remote ftp. <br>  Export: <code>export-vm -vm MyVM1 -path D:\backups\VM -copystate -wait -force</code> <br>  <i>The -copystate parameter says that you need to copy everything (including virtual disk =&gt; export size on the output can be very large)</i> <br><br><h5>  Instead of conclusion </h5><br>  As you can see, managing your virtual machines from PowerShell can be very convenient and relaxed.  Just read the parameters of the commands you need and write your own script. <br><br>  <b>PS</b> I don‚Äôt pretend to ‚Äúdiscover America‚Äù at all. I just decided that someone would find the information about this useful module useful.  I have described only the most simple options for which you can use the PowerShell management library for Hyper-V.  If someone knows or wrote their own more convenient tools to optimize the work with Hyper-V, I will be only too happy to learn about them. <br></div><p>Source: <a href="https://habr.com/ru/post/120575/">https://habr.com/ru/post/120575/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../120567/index.html">Appeal to the Minister of Communications on the division of responsibility of the owners of Internet resources and their visitors</a></li>
<li><a href="../120568/index.html">Writing programs for AVR microcontrollers in Code :: Blocks 10.5 environment</a></li>
<li><a href="../120569/index.html">Forensic examination of computers infected with TDL4</a></li>
<li><a href="../120570/index.html">Visual demonstration of machine learning algorithms</a></li>
<li><a href="../120572/index.html">Skype 2.2.0.35 released</a></li>
<li><a href="../120576/index.html">Three models of Asus netbooks with Ubuntu preinstalled</a></li>
<li><a href="../120577/index.html">Another version of the image comparison algorithm</a></li>
<li><a href="../120580/index.html">New content management system. NET Forge CMS 6.0 with free edition</a></li>
<li><a href="../120581/index.html">Disney Launches HTML5 Tron: Legacy Website</a></li>
<li><a href="../120585/index.html">JavaScript .NET compiler and browser XNA demo example</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>