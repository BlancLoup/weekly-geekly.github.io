<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>TornadIO2 = Tornado + Socket.IO</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What is Socket.IO ? 
 This library is designed to organize a permanent connection between the server and the browser. 

 The main advantage of the lib...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>TornadIO2 = Tornado + Socket.IO</h1><div class="post__text post__text-html js-mediator-article"><h4>  What is <a href="http://socket.io/">Socket.IO</a> ? </h4><br>  This library is designed to organize a permanent connection between the server and the browser. <br><br>  The main advantage of the library: it automatically adjusts to the capabilities of the browser and uses the most efficient transport protocol among those supported. <br><br>  Is the browser able to web sockets?  Great, we will use them.  Is the browser able to AJAX?  We will use long polling.  Is it an ancient Internet Explorer?  We will use html file object.  Well, and so on. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      About socket.io already <a href="http://habrahabr.ru/tag/socket.io/">wrote</a> on Habr√©.  The ‚Äúnative‚Äù Socket.IO server is written in node.js. <br><a name="habracut"></a><br><h4>  What is TornadIO2? </h4><br>  This is a library running on top of Tornado and supporting the current version of the Socket.IO protocol. <br><br>  The main advantage of the library is that it provides a convenient abstraction over a virtual connection, so the developer will not have to think about how the transport will work in different conditions. <br><br>  Why is TornadIO2 called?  Because there is TornadIO, which supports older versions of Socket.IO and older versions of Tornado (1.2, for example).  Starting with Socket.IO 0.7, the transport protocol changed and a new functionality appeared that did not fit into the architecture of the first TornadIO.  In addition, TornadIO2 requires Tornado 2.1 or higher. <br><br>  The project home page is here: <a href="http://github.com/MrJoes/tornadio2">http://github.com/MrJoes/tornadio2</a> <br>  Documentation (in English) is here: <a href="http://tornadio2.readthedocs.org/">http://tornadio2.readthedocs.org/</a> <br><br><h4>  Closer to the code </h4><br>  The simplest client Socket.IO looks like this: <br><pre><code class="hljs actionscript"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> conn = io.connect(<span class="hljs-string"><span class="hljs-string">'http://myserver'</span></span>); conn.on(<span class="hljs-string"><span class="hljs-string">'connect'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ alert(<span class="hljs-string"><span class="hljs-string">'connected'</span></span>); }); conn.on(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(msg)</span></span></span><span class="hljs-function"> </span></span>{ alert(<span class="hljs-string"><span class="hljs-string">'Got '</span></span> + msg); }); conn.on(<span class="hljs-string"><span class="hljs-string">'disconnect'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ alert(<span class="hljs-string"><span class="hljs-string">'disconnected'</span></span>); });</code> </pre> <br>  Roughly speaking, we create a connection object, and then add reactions to different events: connection, receiving a message, and disconnecting from the server. <br><br>  If we want to send a message to the server, we do: <br><br><pre> <code class="hljs swift">conn.send('<span class="hljs-type"><span class="hljs-type">Hello</span></span> <span class="hljs-type"><span class="hljs-type">World!</span></span>');</code> </pre><br><br>  Socket.IO supports sending json objects: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">conn</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.json</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.send</span></span>({<span class="hljs-attribute"><span class="hljs-attribute">msg</span></span>: <span class="hljs-string"><span class="hljs-string">'Hello World'</span></span>, a: <span class="hljs-number"><span class="hljs-number">10</span></span>});</code> </pre><br><br>  Now let's see how the simplest server looks like: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> tornado <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> web <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> tornadio2 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> SocketConnection, TornadioRouter, SocketServer <span class="hljs-comment"><span class="hljs-comment"># Declare connection class class MyConnection(SocketConnection): def on_open(self, info): print 'Client connected' def on_message(self, msg): print 'Got', msg self.send(msg) def on_close(self): print 'Client disconnected' # Create TornadIO2 router router = TornadioRouter(MyConnection) # Create Tornado application with urls from router app = web.Application(router.urls, socket_io_port=8001) # Start server if __name__ == '__main__': SocketServer(app)</span></span></code> </pre><br><br>  In this example, the main part is <i>MyConnection</i> .  When a client joins the server, TornadIO2 will create an instance of this class and call <i>on_open ()</i> .  When the server receives a message from the client, it will call <i>on_message</i> with the message sent.  And so on. <br><br>  <i>TornadioRouter</i> works with one class of connection and implements all the network logic necessary for the proper operation of the socket.io client. <br><br>  Then we create the Tornado application, feed it links from the router and start the server.  <i>SocketServer</i> is just a convenient wrapper for starting the Tornado HTTP server and <a href="http://www.adobe.com/devnet/flashplayer/articles/socket_policy_files.html">Flash Policy Server</a> to support FlashSocket transport. <br><br>  You can send both strings and regular objects, the main thing is that they are normally serialized in json. <br><br><h4>  Developments </h4><br>  In the latest versions of Socket.IO, the concept of events appeared - instead of sending ‚Äúnormal‚Äù messages, the function call is emulated and an RPC is obtained.  Naturally, if you make a mistake with the number of parameters (or their names), an exception will occur and the connection will simply close. <br><br>  The event is sent as follows: <br><br><pre> <code class="hljs actionscript"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> conn = io.connect(<span class="hljs-string"><span class="hljs-string">'http://myserver:1234'</span></span>); conn.on(<span class="hljs-string"><span class="hljs-string">'connect'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ conn.emit(<span class="hljs-string"><span class="hljs-string">'hello'</span></span>, <span class="hljs-string"><span class="hljs-string">'Joes'</span></span>); });</code> </pre><br><br>  And on the server they are processed like this: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> tornadio2 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> SocketConnection, event <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyConnection</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(SocketConnection)</span></span></span><span class="hljs-class">:</span></span> @event(<span class="hljs-string"><span class="hljs-string">'hello'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hello</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, name)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">'Got hello from %s'</span></span> % name</code> </pre><br><br>  Similarly, sending events from the server and processing them on the client works: <br><br><pre> <code class="hljs pgsql">var conn = io.<span class="hljs-keyword"><span class="hljs-keyword">connect</span></span>(<span class="hljs-string"><span class="hljs-string">'http://myserver:1234'</span></span>); conn.<span class="hljs-keyword"><span class="hljs-keyword">on</span></span>(<span class="hljs-string"><span class="hljs-string">'connect'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>() { conn.emit(<span class="hljs-string"><span class="hljs-string">'ping'</span></span>, <span class="hljs-string"><span class="hljs-string">'Joes'</span></span>); }); conn.<span class="hljs-keyword"><span class="hljs-keyword">on</span></span>(<span class="hljs-string"><span class="hljs-string">'pong'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(<span class="hljs-type"><span class="hljs-type">name</span></span>) { alert(<span class="hljs-type"><span class="hljs-type">name</span></span>); // Will <span class="hljs-keyword"><span class="hljs-keyword">show</span></span> Joes });</code> </pre><br><br>  And the server: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> tornadio2 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> SocketConnection, event <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyConnection</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(SocketConnection)</span></span></span><span class="hljs-class">:</span></span> @event(<span class="hljs-string"><span class="hljs-string">'ping'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ping</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, name)</span></span></span><span class="hljs-function">:</span></span> self.emit(<span class="hljs-string"><span class="hljs-string">'pong'</span></span>, name)</code> </pre><br><br><h4>  Confirmations </h4><br>  When sending a message or event, you can request a confirmation - when the message is received and processed, an ACK packet will be automatically sent and the transferred callback will be called. <br>  In the case of events, you can return the value from the handler and it will automatically go to the client, thereby obtaining a convenient code for the REQUEST / RESPONSE pattern. <br><br>  From an API point of view, it all looks like this: <br><br><pre> <code class="hljs pgsql">var conn = io.<span class="hljs-keyword"><span class="hljs-keyword">connect</span></span>(<span class="hljs-string"><span class="hljs-string">'http://localhost'</span></span>); conn.<span class="hljs-keyword"><span class="hljs-keyword">on</span></span>(<span class="hljs-string"><span class="hljs-string">'connect'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>() { // Emit <span class="hljs-string"><span class="hljs-string">'whoareyou'</span></span> event <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> provide callback <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> that will be // <span class="hljs-keyword"><span class="hljs-keyword">called</span></span> once event was handled <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">server</span></span>. conn.emit(<span class="hljs-string"><span class="hljs-string">'whoareyou'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(<span class="hljs-type"><span class="hljs-type">name</span></span>) { alert(<span class="hljs-type"><span class="hljs-type">name</span></span>); // Will print <span class="hljs-string"><span class="hljs-string">'Joes'</span></span> }); });</code> </pre><br><br>  And the server: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyConnection</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(SocketConnection)</span></span></span><span class="hljs-class">:</span></span> @event(<span class="hljs-string"><span class="hljs-string">'whoareyou'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">woohoo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'Joes'</span></span></code> </pre><br><br>  The server can also send messages with the need for confirmation.  To do this, you must pass a callback for <i>self.send ()</i> or use <i>self.emit_ack ()</i> for events: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyConnection</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(SocketConnection)</span></span></span><span class="hljs-class">:</span></span> @event(<span class="hljs-string"><span class="hljs-string">'hello'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myhello</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.emit_ack(<span class="hljs-string"><span class="hljs-string">'hello'</span></span>, self.on_ack) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_ack</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, msg, data)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">'Woohoo, got ACK'</span></span>, msg, data</code> </pre><br><br><h4>  <a href="http://www.tornadoweb.org/documentation/gen.html">Tornado.gen</a> support </h4><br>  Starting with Tornado 2.1.0, a convenient interface for writing asynchronous code without callbacks has appeared. <br><br>  When using <i>tornado.gen</i> , the code will work asynchronously - if there are two messages from the client and the first start is processed asynchronously, the second will be processed before the first one is finished.  This is not always what is expected from the server. <br><br>  The decorator <i>tornadio2.gen.sync_engine</i> was created specifically for this purpose. <br><br>  If you ‚Äúwrap‚Äù the message processor (or events) as a decorator, the messages will be processed in the order they are received, but ioloop will not be blocked. <br><br>  It is best to see <a href="https://github.com/MrJoes/tornadio2/blob/master/examples/gen/gen.py">an example</a> that illustrates how this all works. <br><br><h4>  Performance monitor </h4><br>  TornadIO2 includes a simple monitor that counts various events: the number of active connections, the number of sent and received messages per second, and so on.  The list of counters is not very big yet, so I will be happy with the wishes. <br><br>  There is a simple <a href="https://github.com/MrJoes/tornadio2/tree/master/examples/stats">example</a> that shows how to work with data - it builds a graph and shows statistics in real time, which looks something like this: <br><img src="https://habrastorage.org/getpro/habr/post_images/15c/256/7bc/15c2567bc54641439156ea46154c60ea.png"><br><br><h4>  Performance </h4><br>  Unfortunately, full-fledged load testing of the library has not yet been conducted, so I can‚Äôt voice any real figures on performance.  If anyone wants to test, I will be very grateful. <br><br>  The server code is quite lightweight and overhead should not be very noticeable. <br><br><h4>  Examples </h4><br>  TornadIO2 contains several examples of use: simple chat, ping via socket.io, and so on. <br>  All examples are <a href="https://github.com/MrJoes/tornadio2/tree/master/examples">here</a> . <br><br><h4>  Status and Future </h4><br>  TornadIO2 is not yet registered with PyPI - as soon as, so immediately. <br><br>  The server is ready for use (I hope) - it turns quite well on my small, closed projects.  All protocols work, so there should be no special surprises. <br><br>  I would be grateful for any help in load testing, identifying errors and I hope that someone else will need all this. </div><p>Source: <a href="https://habr.com/ru/post/133350/">https://habr.com/ru/post/133350/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../133344/index.html">The most necessary shield for Arduino!</a></li>
<li><a href="../133345/index.html">Tale of how harmful it is to put components out of the box</a></li>
<li><a href="../133346/index.html">Samsung Galaxy Note - video review of new products before the start of its official sales.</a></li>
<li><a href="../133347/index.html">Scala complexity issues</a></li>
<li><a href="../133348/index.html">Large manufacturers reduce prices for 7-inch tablets</a></li>
<li><a href="../133351/index.html">Loader of images and thumbnails. New standards, old problems</a></li>
<li><a href="../133353/index.html">How easy it is to create beautiful</a></li>
<li><a href="../133354/index.html">OpenStreetMap News ‚Ññ10: OSM on Russian TV, statistics on the streets of Russia, OSM goal is to be easier for ordinary people, interesting map screenshots</a></li>
<li><a href="../133355/index.html">Styling applications part two</a></li>
<li><a href="../133356/index.html">Candidates of Sciences may cancel, but will not</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>