<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Wi-Fi-lamp based on the WizFi250 module</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="While the world's best minds are arguing about the development of the Internet of Things and promise fabulous profits to the high-tech companies invol...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Wi-Fi-lamp based on the WizFi250 module</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/51f/3a6/cc3/51f3a6cc3b9d4edb9c484bccfb415eea.jpg" alt="Wi-Fi lamp"><br><br>  While the world's best minds are arguing about the development of the <a href="https://ru.wikipedia.org/wiki/%25D0%2598%25D0%25BD%25D1%2582%25D0%25B5%25D1%2580%25D0%25BD%25D0%25B5%25D1%2582_%25D0%25B2%25D0%25B5%25D1%2589%25D0%25B5%25D0%25B9">Internet of Things</a> and promise fabulous profits to the high-tech companies involved in this process, we also decided not to be idle.  Under the cut - a story about prototyping a light bulb control device based on <a href="http://wless.ru/technology/%3Faction%3Ddetails%26id%3D528%26pf%3Dtech%26pf_id%3D7%26prod%3D23%26tech%3D7%26type%3D20">the WizFi250 Wi-Fi module</a> . <br><a name="habracut"></a><br>  First, a little about the Wi-Fi module WizFi250.  Appearance - in the photo: <br><br><img src="https://habrastorage.org/files/c37/f4b/72c/c37f4b72c2ca45e4ba1c3e63ad479ef9.jpg" alt="WizFi250">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/428/986/3c9/4289863c90b84378a290c3178bbee5fe.jpg"><br><br>  The module supports IEEE 802.11b / g / n standards and is controlled by AT commands via UART (or SPI) or via WEB interface.  A full description of the WizFi250 AT commands can be found <a href="http://wless.ru/files/WiFi/Wiznet/WizFi250/wizfi250_programmer_s_guide.pdf">here</a> . <br><br>  The module has a PCB antenna, but an external antenna connection is provided.  Switching between antennas - automatic or using the AT + WANT command.  The PCB antenna can be cut (there is a perforation) - then the dimensions of the module will be reduced to 17 x 20 mm. <br><br>  Wired interfaces: UART, SPI, GPIO. <br><br>  Manufacturer - WizNet, Korea, here is the <a href="http://wless.ru/files/WiFi/Wiznet/WizFi250/wizfi250_ds_v101e.pdf">datasheet of the WizFi250 module</a> . <br><br>  For testing, there are boards in the style of Arduino UNO Wi-Fi Schild: <br><br><img src="https://habrastorage.org/files/696/797/8a0/6967978a0e574b8597752c5d82676c6b.jpg"><br><br>  But it is ‚Äúin style‚Äù, since in order to use it with Arduino, they need to be slightly modified.  Here we will use this board when designing in conjunction with the Arduino UNO board. <br><br>  In general, the plan is as follows: to use Wi-Fi to use the WizFi250 module, to control the module and the light bulb - Arduino UNO, transfer control commands from a phone or tablet via Wi-Fi in the form of UDP or TCP packets. <br><br>  Yes, by the way, the module has 2 useful indicator outputs: <br><br>  1) WiFi_STATUS: low - Wi-Fi is running, high level - Wi-Fi is off. <br>  2) MODE_STATUS: high level - command mode (Command Mode), low level - data mode (Data Mode). <br><br>  On the debug board, these signals are output to the ‚ÄúWi-Fi‚Äù and ‚ÄúMode‚Äù LEDs, respectively, which is convenient for debugging. <br><br>  The WizFi250's power supply and I / O are 3.3 V. The Arduino UNO is 5 volts, i.e., you need to adjust the levels to control the Wi-Fi module.  On the WizFi250 debug board, there are two four-channel level converters TXS0104EPWR integrated circuits, one of which, IC4, is used for the SPI interface, the other, and the IC5 for the RESET and GPIO14 Wi-Fi signals of the module.  But for some reason, the conversion of the UART interface levels on the WizFi250 debug board is not provided ... That is what I meant when I wrote about a minor revision. <br><br>  In theory, to convert the levels of the Rx and Tx UART lines, you can try using the remaining two channels of the IC5 converter, but you didn‚Äôt want to solder to the thin legs of the level converter chip and modify debugging, so we used the old method of converting signal levels using a pair of transistors: <br><br><img src="https://habrastorage.org/files/afa/6e3/26a/afa6e326ad60488b8d14c134081eaedc.JPG"><br><br>  The circuits are simple, maybe the only trick is to use a 1kOhm resistor (R3) at the output of a 5V converter -&gt; 3.3V.  When using a resistor of a higher rating, the circuit does not work correctly, this is all due to the fact that there are two outputs at one point: FTDI FT232 microcircuits and our homemade products.  Not good, but for the layout is quite acceptable. <br>  As a result, our debugging board WizFi250 with a self-made Voltage Level Translator looked like this: <br><br><img src="https://habrastorage.org/files/f4a/65f/cbb/f4a65fcbb8314661b6d327218623960a.jpg"><br><br>  The module can operate in two modes: access points (AP, Access Point, when other Wi-Fi devices are connected to it) or client (STA, Station, when it is connected to an access point). <br><br>  You can set different security settings (encryption), enable / disable the internal WEB-server. <br>  The module supports UDP Server / Client, TCP Server / Client, TCP Secured Server / Client modes (SSL is used). <br>  Either data mode can be set (Data Mode, transparent mode, pure data are sent to the UART module, which arrive via TCP or UDP, the control command module does not accept), or command mode (Command Mode, data is sent and output to the UART in "wrappers" , the module continues to perceive commands).  Transition from data mode to command mode - using traditional +++. <br><br>  Before you begin, the module must be entered into the desired mode.  Such initialization can either be carried out every time after switching on, or use the ability to automatically configure the module when it is turned on. <br><br>  Here are a couple of examples of module initialization: <br><br>  1. If we need access point mode, UDP server and data mode, the initialization command sequence will be as follows: <br><ul><li>  AT + WSET = 1, WizFi250 - set the mode of the access point with the name WizFi250 </li><li>  AT + WSEC = 1, WPA2,12345678 - set the security mode and password </li><li>  AT + WNET = 0.192.168.10.1,255.255.255.0.0.0.0.0 - enter the IP address and subnet mask (in the case of an access point, the first and last parameters are ignored) </li><li>  AT + WJOIN - we launch Wi-Fi </li><li>  AT + SCON = O, USN ,, 7777.1 - we start the UDP server, port 7777, data mode. </li></ul><br><br>  2. If client mode, TCP server and command mode are needed: <br><ul><li>  AT + WSCAN = WizFi250 - scanning an access point named WizFi250 </li><li>  AT + WSET = 0, WizFi250 - we set the station mode, the name of the access point </li><li>  AT + WSEC = 0, WPA2,12345678 - we register the security mode, password </li><li>  AT + WNET = 0.192.168.10.2,255.255.255.0,192.168.10.1 - DHCP is disabled, IP address, subnet mask, gateway </li><li>  AT + WJOIN - connect to access point </li><li>  AT + SCON = O, TSN ,, 7777.0 - start TCP server, port 7777, command mode </li></ul><br>  After the initialization of the Wi-Fi module, we can only analyze the data coming from the module via the UART and turn our light on or off in case of receipt of the corresponding commands. <br>  Arduinovskiy sketch hardly makes sense to give here: it is as simple as possible and I don‚Äôt think that it will be useful / interesting to someone. <br><br>  The switching circuit of the bulb consists of a five-volt relay, a transistor switch and a pair of discrete components: <br><br><img src="https://habrastorage.org/files/e3b/df8/ad7/e3bdf8ad72004df7b119775027a6d705.JPG"><br><br>  GPIO 13 was used as the Arduino control output (initialization string: pinMode (13, OUTPUT);) <br>  In general, the layout is as follows: <br><br><img src="https://habrastorage.org/files/024/dc8/99f/024dc899f7084a73b47cd026f170f7ad.jpg"><br><br>  In the black box - power supply ~ 220V -&gt; = 9V. <br><br>  To quickly test the light control from a tablet or Android smartphone, you can use ready-made programs that can send TCP / UDP packets, such as UDP Sender or TCP / UDP Server.  Similarly for iOS. <br>  In general, testing has shown that even with the use of the simplest algorithms, it is possible to achieve stable operation of the system. <br><br>  Other options are the use of the module‚Äôs built-in WEB-server GPIO control (5 pcs.) And the ability to customize the module‚Äôs firmware by the manufacturer.  Both options are interesting because they allow to do without an external controller / processor.  But that's another story. <br><br>  * Small video - in the comments. </div><p>Source: <a href="https://habr.com/ru/post/363491/">https://habr.com/ru/post/363491/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../363481/index.html">Bike from Baidu monitors the health and charges the smartphone</a></li>
<li><a href="../363483/index.html">Renewable sources in the United States caught up with the classic at the cost of electricity received</a></li>
<li><a href="../363485/index.html">Intel promises 10 TB SSDs in two years</a></li>
<li><a href="../363487/index.html">Pebble: now banana ... in 80 languages, but still not in Russian!</a></li>
<li><a href="../363489/index.html">Mozilla Foundation started accepting Bitcoin donations</a></li>
<li><a href="../363493/index.html">We disassemble a radio-controlled paper airplane PowerUP 3.0 for spare parts</a></li>
<li><a href="../363495/index.html">Scientists suggest using television frequencies to create a super Wi-Fi network</a></li>
<li><a href="../363497/index.html">Rosette's mission: what does the interplanetary station and Philae probe expect in the near future?</a></li>
<li><a href="../363499/index.html">Torrent users are much more willing to buy licensed content than copyright holders think.</a></li>
<li><a href="../363501/index.html">It's not that life is unfair - you have the wrong concept of justice.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>