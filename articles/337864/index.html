<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Parallel Hystrix. Improve the performance of distributed applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="About a year ago, our team rewrote the backend of a little-known application with 5 million users using Hystrix's ‚Äúlatency and fault tolerance‚Äù. This ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Parallel Hystrix. Improve the performance of distributed applications</h1><div class="post__text post__text-html js-mediator-article">  About a year ago, our team rewrote the backend of a little-known application with 5 million users using <a href="https://github.com/Netflix/Hystrix">Hystrix's</a> ‚Äúlatency and fault tolerance‚Äù.  This made it possible to significantly increase the reliability of the application in case of drops or delays in downstream systems (there are about 10, which is not much for a serious system), provided a wonderful tool (Hystrix Dashboard) for monitoring the load of external systems (now we know who the brake is), it allowed to optimize the size of various pools in the application.  However, there remains the problem of long-term processing of individual heavy requests, the solution to which this article is devoted to. <br><a name="habracut"></a><br><h3>  Why paste histriks was easy </h3><br>  All the buns were achieved with minimal effort and very small code changes - Hystrix provides a synchronous programming model, as a result only a small code calling http clients was transferred from application threads to hystrix thread pools with as few problems as possible (I do not believe that these problems can be avoid completely). <br><br>  Consider a simple example - the CommandHelloWorld command, which with a delay retrieves very important data and client code that uses it. <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommandHelloWorld</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HystrixCommand</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> InterruptedException </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//          //        Thread.sleep(random.nextInt(500)); return "Hello " + name + "!"; } } //   String executeCommand(String str) { //    ,     . return new CommandHelloWorld(str).execute(); }</span></span></code> </pre> <br>  It turned out a very simple solution with controlled execution time.  Of course, over time, any initial advantage will result in flaws.  There are customers who need to provide a list of 200 elements, to form each element, you need to go once (or not one) to the external system (sometimes not one).  Not all external systems support batchy, not any code is so easy to parallelize without errors - by spending 20 ms per trip to the external system, we get a hefty 4 seconds for the entire request, during which the user suffered, and the tomkata thread pool did not receive its stream back, at the same time, the histrix thread pool was practically not filled with requests.  It's time to fix it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  How do we arrange histriks </h3><br>  Almost the entire application was built according to the following <b>pattern</b> : <br><br><ul><li>  get the list with the original data </li><li>  form stream from it </li><li>  we filter / mappie, with histrix including </li><li>  collect from stream list </li></ul><br>  Of course, theoretically, there is a parallel operation in java stream, but in fact it has extremely poor management of thread pools in which work will be done, and it was decided to refuse its use.  It would have been necessary to have some kind of a clear solution that would not break the original <b>Pattern</b> and not break the Moscow team.  As a result, 2 working solutions were proposed - based on reactivex.io and add-on for java stream. <br><br>  The demo can be found on a <a href="https://github.com/blaze79/rx1">githaba</a> , all working examples are placed in tests. <br><br><h3>  Option 1. Add reactivity </h3><br>  It should be noted that inside, histriks uses a reactive (this is a term, not a fact that it is fast) <a href="http://reactivex.io/">reactivex.io</a> library of "asynchronous data sources".  The article is not a guide to this uncooperative topic, but one elegant solution will be shown.  Unfortunately, I am not familiar with the well-established Russian translation of the term observable, therefore I will call it a source.  And so, wishing not to break the <b>Pattern</b> , we will act as follows: <br><br><ul><li>  get the list with the original data </li><li>  form the source of it </li><li>  we filter / map a source, with a histrix including </li><li>  collect from the source list </li></ul><br>  On the one hand, the last operation is not as simple as it seems, but since we know that all external connections are controlled by the histrix, and therefore strictly limited in time, and the application‚Äôs own code doesn‚Äôt do anything - we can assume that the data source is the timeout is required to raise the value or the exception will be thrown out by the histrix before the timeout expires (1 second).  Therefore, we will use a simple collector function: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> List&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Observable&lt;String&gt; observable)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> observable.timeout(<span class="hljs-number"><span class="hljs-number">1</span></span>, TimeUnit.SECONDS).toList().toBlocking().single(); }</code> </pre><br><br>  We will create teams and sources with two functions, using the native API: <br><br><pre> <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">/** *    - */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Observable&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">executeCommand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String str)</span></span></span><span class="hljs-function"> </span></span>{ LOG.info(<span class="hljs-string"><span class="hljs-string">"Hot Hystrix command created: {}"</span></span>, str); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CommandHelloWorld(str).observe(); } <span class="hljs-comment"><span class="hljs-comment">/** *    - */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Observable&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">executeCommandDelayed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String str)</span></span></span><span class="hljs-function"> </span></span>{ LOG.info(<span class="hljs-string"><span class="hljs-string">"Cold Hystrix command created: {}"</span></span>, str); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CommandHelloWorld(str).toObservable(); }</code> </pre><br>  And so, consider the simple case of processing a list of 6 items: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testNaive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ List&lt;Integer&gt; source = IntStream.range(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>).boxed().collect(Collectors.toList()); Observable&lt;String&gt; observable = Observable.from(source) .flatMap(elem -&gt; executeCommand(elem.toString())); toList(observable).forEach(el -&gt;LOG.info(<span class="hljs-string"><span class="hljs-string">"List element: {}"</span></span>, el)); }</code> </pre><br>  Everything works great in parallel for approximately 500ms, the program logs confirm the simultaneous use of histrix streams.  As a side effect, items are listed in a random order.  Such is the price of reactivity. <br><br>  Let's try to increase the size of the list to 49 - and get a natural bummer: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testStupid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ List&lt;Integer&gt; source = IntStream.range(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>).boxed().collect(Collectors.toList()); Observable&lt;String&gt; observable = Observable.from(source) .flatMap(elem -&gt; executeCommand(elem.toString())); toList(observable).forEach(el -&gt;LOG.info(<span class="hljs-string"><span class="hljs-string">"List element: {}"</span></span>, el)); }</code> </pre><br>  Here is such a funny exhaust in the log: <br><br><pre> <code class="hljs css"><span class="hljs-selector-attr"><span class="hljs-selector-attr">[main]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.RxHystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Cold</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Hystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">created</span></span>: 1 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[main]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.RxHystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Cold</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Hystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">created</span></span>: 2 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[main]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.RxHystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Cold</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Hystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">created</span></span>: 3 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[main]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.RxHystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Cold</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Hystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">created</span></span>: 4 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[main]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.RxHystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Cold</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Hystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">created</span></span>: 5 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[main]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.RxHystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Cold</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Hystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">created</span></span>: 6 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[main]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.RxHystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Cold</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Hystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">created</span></span>: 7 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[main]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.RxHystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Cold</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Hystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">created</span></span>: 8 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[main]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.RxHystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Cold</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Hystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">created</span></span>: 9 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[main]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.RxHystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Cold</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Hystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">created</span></span>: 10 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[main]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.RxHystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Cold</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Hystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">created</span></span>: 11 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-5]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">start</span></span>: 5 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-2]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">start</span></span>: 2 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-9]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">start</span></span>: 9 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-8]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">start</span></span>: 8 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-4]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">start</span></span>: 4 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-1]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">start</span></span>: 1 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-6]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">start</span></span>: 6 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-10]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">start</span></span>: 10 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-3]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">start</span></span>: 3 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[main]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ERROR</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.RxHystrixTest</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Ooops</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">com</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.netflix</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.hystrix</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.exception</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.HystrixRuntimeException</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">could</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">not</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">be</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">queued</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">for</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">execution</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">and</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">no</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">fallback</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">available</span></span>.</code> </pre><br>  The fact is that by default, the histrix creates a pool of 10 threads with zero queue.  When subscribing to a source, all its elements are emitted very quickly, instantly overflowing the entire pool, even the creation of a cold source did not help.  We do not need such histriks.  It is required to reasonably limit the greed of one client. <br><br>  The solution was found quite simple: <br><br><ol><li>  For a start, we will not use flatMap so that the subscription to the source does not cause the creation of all commands.  And create a double source using the map method. </li><li>  let's group these sources by the window method - we get a triple source! </li><li>  it's time to strictly streamline the triple sources - release them one by one by the concatMap method </li><li>  each double source is parallel computed by the flatmap method </li></ol><br>  The code turned out to be surprisingly compact, although it took a lot of time to understand its work: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testWindow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ List&lt;Integer&gt; source = IntStream.range(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>).boxed().collect(Collectors.toList()); Observable&lt;String&gt; observable = Observable.from(source) .map(elem -&gt; executeCommandDelayed(elem.toString())) .window(<span class="hljs-number"><span class="hljs-number">7</span></span>) .concatMap(window -&gt; window.flatMap(x -&gt; x)); toList(observable).forEach(el -&gt;LOG.info(<span class="hljs-string"><span class="hljs-string">"List element: {}"</span></span>, el)); }</code> </pre><br>  Let's see a fragment of the logs: <br><br><pre> <code class="hljs css"><span class="hljs-selector-attr"><span class="hljs-selector-attr">[main]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.RxHystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Cold</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Hystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">created</span></span>: 20 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[main]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.RxHystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Cold</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Hystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">created</span></span>: 21 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-3]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">start</span></span>: 3 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-7]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">start</span></span>: 7 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-5]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">start</span></span>: 5 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-4]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">start</span></span>: 4 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-2]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">start</span></span>: 2 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-6]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">start</span></span>: 6 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-1]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">start</span></span>: 1 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-3]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">calculation</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">finished</span></span>: 3 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-6]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">calculation</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">finished</span></span>: 6 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-2]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">calculation</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">finished</span></span>: 2 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-7]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">calculation</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">finished</span></span>: 7 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-1]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">calculation</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">finished</span></span>: 1 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-5]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">calculation</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">finished</span></span>: 5 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-4]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">calculation</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">finished</span></span>: 4 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-8]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">start</span></span>: 8 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-5]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">start</span></span>: 11 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-1]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">start</span></span>: 12</code> </pre><br>  From the logs of the application it is clear that the process of launching new commands has stopped after the launch of the 7th command.  The result is a very simple code modification that allows you to run requests to external systems with the necessary degree of parallelism, without clogging the entire pool. <br><br><h3>  Option 2. Nafig reactivity!  We have executors </h3><br>  Rare man understand rx.  Even if he says the opposite - ask to write the code above in your own words.  But after all, java 8 already has stream and future, the histrix seems to be able to work with the future as its own, let's try to start parallel processing with their help.  We will create the future like this: <br><br><pre> <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">//        static Future&lt;String&gt; executeCommandDelayed(String str) { LOG.info("Direct Hystrix command created: {}", str); return new CommandHelloWorld(str).queue(); } //     ,    static String executeCommand(String str) { LOG.info("Direct Hystrix command created: {}", str); return new CommandHelloWorld(str).execute(); }</span></span></code> </pre><br>  We try to process a list of 49 items: <br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testStupid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ IntStream.range(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>).boxed().map( value -&gt; executeCommandDelayed(value.toString()) ).collect(Collectors.toList()) .forEach(el -&gt; LOG.info(<span class="hljs-string"><span class="hljs-string">"List element (FUTURE): {}"</span></span>, el.toString())); }</code> </pre><br>  and again a familiar problem. <br><br><pre> <code class="hljs css"><span class="hljs-selector-attr"><span class="hljs-selector-attr">[main]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.stream</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ParallelAsyncServiceTest</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Direct</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Hystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">created</span></span>: 2 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[main]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.stream</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ParallelAsyncServiceTest</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Direct</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Hystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">created</span></span>: 3 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[main]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.stream</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ParallelAsyncServiceTest</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Direct</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Hystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">created</span></span>: 4 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[main]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.stream</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ParallelAsyncServiceTest</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Direct</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Hystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">created</span></span>: 5 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[main]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.stream</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ParallelAsyncServiceTest</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Direct</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Hystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">created</span></span>: 6 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[main]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.stream</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ParallelAsyncServiceTest</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Direct</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Hystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">created</span></span>: 7 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[main]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.stream</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ParallelAsyncServiceTest</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Direct</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Hystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">created</span></span>: 8 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[main]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.stream</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ParallelAsyncServiceTest</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Direct</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Hystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">created</span></span>: 9 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[main]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.stream</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ParallelAsyncServiceTest</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Direct</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Hystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">created</span></span>: 10 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[main]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.stream</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ParallelAsyncServiceTest</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Direct</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Hystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">created</span></span>: 11 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[main]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ERROR</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.stream</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ParallelAsyncServiceTest</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Ooops</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">com</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.netflix</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.hystrix</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.exception</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.HystrixRuntimeException</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">could</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">not</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">be</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">queued</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">for</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">execution</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">and</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">no</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">fallback</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">available</span></span>.</code> </pre><br>  In this case, the order of creating commands is controlled by the splitter, that is, it is generally completely opaque and dangerous.  We will try to solve the problem in 2 stages, keeping the rather familiar technique of working with the stream: <br><br>  1) zamapim stream source data to stream futures.  And with the control of actually running tasks.  To do this, we need an intermediate executor with the degree of parallelism we need. <br>  2) turn stream futures into stream values.  keeping in mind that every futures are ultimately executed by a histrix and have guaranteed lead times. <br><br>  To implement the first step, we will do a separate parallelWarp operator for converting a user-defined function; for the second step, we will have to write a waitStream function that receives and returns streams: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testSmart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ service.waitStream( IntStream.range(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>).boxed().map( service.parallelWarp( value -&gt; executeCommand(value.toString()) ) ) ).collect(Collectors.toList()) .forEach(el -&gt; LOG.info(<span class="hljs-string"><span class="hljs-string">"List element: {}"</span></span>, el)); }</code> </pre> <br>  It turned out almost usual for users of the stream record.  Let's see what's under the hood, this is the last code snippet for today: <br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//   threadSize = 7 public ParallelAsyncService(int threadSize) { ThreadFactory namedThreadFactory = new ThreadFactoryBuilder() .setNameFormat("parallel-async-thread-%d").build(); //   ,      executorService = Executors.newFixedThreadPool(threadSize, namedThreadFactory); } /** * Maps user function T -&gt; Ret to function T -&gt; Future&lt;Ret&gt;. Adds task to executor service * @param mapper user function * @param &lt;T&gt; user function argument * @param &lt;Ret&gt; user function result * @return function to future */ public &lt;T, Ret&gt; Function&lt;T, Future&lt;Ret&gt;&gt; parallelWarp(Function&lt;T, Ret&gt; mapper) { return (T t) -&gt; { LOG.info("Submitting task to inner executor"); Future&lt;Ret&gt; future = executorService.submit(() -&gt; { LOG.info("Sending task to hystrix"); return mapper.apply(t); }); return future; }; } /** * waits all futures in stream and rethrow exception if occured * @param futureStream stream of futures * @param &lt;T&gt; type * @return stream of results */ public &lt;T&gt; Stream&lt;T&gt; waitStream(Stream&lt;Future&lt;T&gt;&gt; futureStream) { List&lt;Future&lt;T&gt;&gt; futures = futureStream.collect(Collectors.toList()); // wait all futures one by one. for (Future&lt;T&gt; future : futures) { try { future.get(); } catch (InterruptedException e) { throw new RuntimeException(e); } catch (ExecutionException e) { Throwable cause = e.getCause(); if (cause instanceof RuntimeException) { throw (RuntimeException) cause; } throw new RuntimeException(e); } } // all futures have completed, it is safe to call get return futures.stream().map( future -&gt; { try { return future.get(); } catch (Exception e) { e.printStackTrace(); return null; //     } } );</span></span></code> </pre><br>  The waitStream method is very simple, only error handling has corrupted it.  The operator parallelWarp is extremely simple and certainly has a special name for adherents of functional programming.  New histrix commands are created only by an internal executor, which has the degree of parallelism we need.  Pruflink: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">main</span></span>] <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.RxHystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Cold</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Hystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">created</span></span>: 18 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[main]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.RxHystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Cold</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Hystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">created</span></span>: 19 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[main]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.RxHystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Cold</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Hystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">created</span></span>: 20 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[main]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.RxHystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Cold</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Hystrix</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">created</span></span>: 21 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-4]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">start</span></span>: 4 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-1]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">start</span></span>: 1 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-2]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">start</span></span>: 2 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-3]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">start</span></span>: 3 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-5]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">start</span></span>: 5 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-6]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">start</span></span>: 6 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-7]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">start</span></span>: 7 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-2]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">calculation</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">finished</span></span>: 2 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-5]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">calculation</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">finished</span></span>: 5 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-3]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">calculation</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">finished</span></span>: 3 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-7]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">calculation</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">finished</span></span>: 7 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-6]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">calculation</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">finished</span></span>: 6 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-4]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">calculation</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">finished</span></span>: 4 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-1]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">calculation</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">finished</span></span>: 1 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-4]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">start</span></span>: 11 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-6]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">start</span></span>: 12 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-8]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">start</span></span>: 8 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-7]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">start</span></span>: 13 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hystrix-ExampleGroup-9]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">INFO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.silentpom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.CommandHelloWorld</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Command</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">start</span></span>: 9</code> </pre><br>  With this approach, we needed an additional pool of flows for each pool of histrix flows, but the output list maintained order.  Which approach will win in the application - time will tell. <br><br>  I repeat that all examples can be viewed <a href="https://github.com/blaze79/rx1">in tests on a githaba</a> .  I would be glad to famous habrokritike. </div><p>Source: <a href="https://habr.com/ru/post/337864/">https://habr.com/ru/post/337864/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../337852/index.html">Final Imagine Cup 2017 through the eyes of the MIPT team</a></li>
<li><a href="../337854/index.html">My 5 kopecks about Highload Cup 2017 or the history of the 9th place</a></li>
<li><a href="../337856/index.html">Zabbix 3.4: Mass data collection using the examples of the counter Mercury and smartmontools</a></li>
<li><a href="../337860/index.html">DBaaS: databases in the cloud</a></li>
<li><a href="../337862/index.html">RailsClub 2017. Interview with Luca Guidi, author Hanami: mix FP and OOP in Ruby</a></li>
<li><a href="../337866/index.html">Hi, Programmer</a></li>
<li><a href="../337868/index.html">How to write a good solution for Highload Cup, but not good enough to get to the top</a></li>
<li><a href="../337870/index.html">Neural networks: how artificial intelligence helps in business and life</a></li>
<li><a href="../337874/index.html">Streaming api A small example in PHP</a></li>
<li><a href="../337878/index.html">A few words about the inevitable turn in the development of the IT industry</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>