<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PHP text encoding definition - overview of existing solutions plus another bike</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Faced a task - auto-detect page encoding / text / anything. The task is not new, and many bicycles have already been thought of. The article contains ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PHP text encoding definition - overview of existing solutions plus another bike</h1><div class="post__text post__text-html js-mediator-article">  Faced a task - auto-detect page encoding / text / anything.  The task is not new, and many bicycles have already been thought of.  The article contains a small review of what was found on the net - plus the offer of its own, as it seems to me, worthy of a solution. <br><br><h4>  1. Why not mb_detect_encoding ()? </h4><br>  In short - it does not work. <br><a name="habracut"></a><br>  Let's watch: <br><pre><code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//   -     CP1251 $string = iconv('UTF-8', 'Windows-1251', '    ,   ,       ,     .'); // ,    md_detect_encoding().  $strict = FALSE var_dump(mb_detect_encoding($string, array('UTF-8'))); // UTF-8 var_dump(mb_detect_encoding($string, array('UTF-8', 'Windows-1251'))); // Windows-1251 var_dump(mb_detect_encoding($string, array('UTF-8', 'KOI8-R'))); // KOI8-R var_dump(mb_detect_encoding($string, array('UTF-8', 'Windows-1251', 'KOI8-R'))); // FALSE var_dump(mb_detect_encoding($string, array('UTF-8', 'ISO-8859-5'))); // ISO-8859-5 var_dump(mb_detect_encoding($string, array('UTF-8', 'Windows-1251', 'KOI8-R', 'ISO-8859-5'))); // ISO-8859-5 //  $strict = TRUE var_dump(mb_detect_encoding($string, array('UTF-8'), TRUE)); // FALSE var_dump(mb_detect_encoding($string, array('UTF-8', 'Windows-1251'), TRUE)); // FALSE var_dump(mb_detect_encoding($string, array('UTF-8', 'KOI8-R'), TRUE)); // FALSE var_dump(mb_detect_encoding($string, array('UTF-8', 'Windows-1251', 'KOI8-R'), TRUE)); // FALSE var_dump(mb_detect_encoding($string, array('UTF-8', 'ISO-8859-5'), TRUE)); // ISO-8859-5 var_dump(mb_detect_encoding($string, array('UTF-8', 'Windows-1251', 'KOI8-R', 'ISO-8859-5'), TRUE)); // ISO-8859-5</span></span></code> </pre> <br>  As you can see, the output is a complete mess.  What do we do when it is unclear why the function behaves this way?  Right, google it.  Found a wonderful <a href="http://stackoverflow.com/questions/1846201/how-to-detact-the-encoding-using-mb-detect-encoding-correct">answer</a> . <br><br>  To finally dispel all hopes of using mb_detect_encoding (), you need to get into the sources of the mbstring extension.  So, rolled up the sleeves, let's go: <br><pre> <code class="hljs ruby">/<span class="hljs-regexp"><span class="hljs-regexp">/ ext/mbstring</span></span><span class="hljs-regexp"><span class="hljs-regexp">/mbstring.c:2629 PHP_FUNCTION(mb_detect_encoding) { ... /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  2703 ret = mbfl_identify_encoding_name(&amp;string, elist, size, strict); ...</span></span></code> </pre><br>  Ctrl + click: <br><pre> <code class="hljs lua">// ext/mbstring/libmbfl/mbfl/mbfilter.c:<span class="hljs-number"><span class="hljs-number">643</span></span> const <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>* mbfl_identify_encoding_name(mbfl_string *<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>, enum mbfl_no_encoding *elist, int elistsz, int strict) { const mbfl_encoding *encoding; encoding = mbfl_identify_encoding(<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>, elist, elistsz, strict); ...</code> </pre><br>  Ctrl + click: <br><pre> <code class="hljs ruby">/<span class="hljs-regexp"><span class="hljs-regexp">/ ext/mbstring</span></span><span class="hljs-regexp"><span class="hljs-regexp">/libmbfl/mbfl</span></span><span class="hljs-regexp"><span class="hljs-regexp">/mbfilter.c:557 /</span></span>* * identify encoding *<span class="hljs-regexp"><span class="hljs-regexp">/ const mbfl_encoding * mbfl_identify_encoding(mbfl_string *string, enum mbfl_no_encoding *elist, int elistsz, int strict) { ...</span></span></code> </pre><br>  I will not post the full text of the method, so as not to clutter an article with unnecessary sources.  Who is interesting to see for yourself.  We are truncated by the line number 593, where the actual check is made to see if the character fits the encoding: <br><pre> <code class="hljs haskell">// ext/mbstring/libmbfl/mbfl/mbfilter.c:<span class="hljs-number"><span class="hljs-number">593</span></span> (*filter-&gt;filter_function)(*p, filter); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (filter-&gt;flag) { bad++; }</code> </pre><br>  Here are the basic filters for single-byte Cyrillic: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Windows-1251 (original comments saved) <br><pre> <code class="hljs pgsql">// ext/mbstring/libmbfl/filters/mbfilter_cp1251.c:<span class="hljs-number"><span class="hljs-number">142</span></span> <span class="hljs-comment"><span class="hljs-comment">/* all of this is so ugly now! */</span></span> static <span class="hljs-type"><span class="hljs-type">int</span></span> mbfl_filt_ident_cp1251(<span class="hljs-type"><span class="hljs-type">int</span></span> c, mbfl_identify_filter *<span class="hljs-keyword"><span class="hljs-keyword">filter</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c &gt;= <span class="hljs-number"><span class="hljs-number">0x80</span></span> &amp;&amp; c &lt; <span class="hljs-number"><span class="hljs-number">0xff</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">filter</span></span>-&gt;flag = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">filter</span></span>-&gt;flag = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* not it */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> c; }</code> </pre><br><br>  KOI8-R <br><pre> <code class="hljs pgsql">// ext/mbstring/libmbfl/filters/mbfilter_koi8r.c:<span class="hljs-number"><span class="hljs-number">142</span></span> static <span class="hljs-type"><span class="hljs-type">int</span></span> mbfl_filt_ident_koi8r(<span class="hljs-type"><span class="hljs-type">int</span></span> c, mbfl_identify_filter *<span class="hljs-keyword"><span class="hljs-keyword">filter</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c &gt;= <span class="hljs-number"><span class="hljs-number">0x80</span></span> &amp;&amp; c &lt; <span class="hljs-number"><span class="hljs-number">0xff</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">filter</span></span>-&gt;flag = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">filter</span></span>-&gt;flag = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* not it */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> c; }</code> </pre><br><br>  ISO-8859-5 (in general, everything is fun) <br><pre> <code class="hljs pgsql">// ext/mbstring/libmbfl/mbfl/mbfl_ident.c:<span class="hljs-number"><span class="hljs-number">248</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span> mbfl_filt_ident_true(<span class="hljs-type"><span class="hljs-type">int</span></span> c, mbfl_identify_filter *<span class="hljs-keyword"><span class="hljs-keyword">filter</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> c; }</code> </pre><br>  As you can see, ISO-8859-5 always returns TRUE (to return FALSE, you need to set filter-&gt; flag = 1). <br><br>  When they looked at the filters, everything fell into place.  CP1251 from KOI8-R can not be distinguished in any way.  ISO-8859-5 in general, if it is in the list of encodings, will always be detected as true. <br><br>  In general, fail.  It is understandable - it is impossible to find out the encoding in the general case only by the character codes, since these codes intersect in different encodings. <br><br><h4>  2. What does Google give? </h4><br>  And Google gives all sorts of misery.  I will not even post the source code here, see for yourself if you want (remove the space after http: //, I don‚Äôt know how to show the text with a link): <br><br>  http: // deer.org.ua/2009/10/06/1/ <br>  http: // php.su/forum/topic.php?forum=1&amp;topic=1346 <br><br><h4>  3. Search by habr </h4><br>  1) again character codes: <a href="http://habrahabr.ru/blogs/php/27378/">habrahabr.ru/blogs/php/27378/#comment_710532</a> <br><br>  2) in my opinion, a very interesting solution: <a href="http://habrahabr.ru/blogs/php/27378/">habrahabr.ru/blogs/php/27378/#comment_1399654</a> <br>  Cons and pros in the comments on the link.  Personally, I think that only for detecting encoding this solution is redundant - it turns out too powerful.  The definition of the encoding in it - as a side effect). <br><br><h4>  4. Actually, my decision </h4><br>  The idea arose while viewing the second link from the previous section.  The idea is as follows: we take a large Russian text, measure the frequencies of different letters, with these frequencies we detect the encoding.  Looking ahead, I will immediately say - there will be problems with large and small letters.  Therefore, I post examples of the frequencies of letters (let's call it ‚Äúspectrum‚Äù), both case-sensitive and without (in the second case, I added more to the small letter with the same frequency, and I deleted more with all).  In these "spectra" all letters with frequencies less than 0.001 and space are cut out.  Here is what I did after the processing of "War and Peace": <br><br>  Register-dependent "spectrum": <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">array</span></span> ( <span class="hljs-string"><span class="hljs-string">''</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0.095249209893009</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0.06836817536026</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0.067481298384992</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0.055995027400041</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0.052242744063325</span></span>, .... <span class="hljs-string"><span class="hljs-string">''</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0.002252892226507</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0.0021318391371162</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0.0018574762967903</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0.0015961610948418</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0.0014044332975731</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0.0013188987793209</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0.0012623590130186</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0.0011804488387602</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0.001061932790165</span></span>, )</code> </pre><br><br>  Register independent: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">array</span></span> ( <span class="hljs-string"><span class="hljs-string">''</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0.095249209893009</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0.095249209893009</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0.06836817536026</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0.06836817536026</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0.067481298384992</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0.067481298384992</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0.055995027400041</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0.055995027400041</span></span>, .... <span class="hljs-string"><span class="hljs-string">''</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0.0029893589260344</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0.0029893589260344</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0.0024649163501406</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0.0024649163501406</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0.002252892226507</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0.002252892226507</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0.0015961610948418</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0.0015961610948418</span></span>, )</code> </pre><br><br>  Spectra in different encodings (array keys - codes of the corresponding characters in the corresponding encoding): <br><br>  Windows-1251: <a href="http://pastebin.com/NQyPrmxr">case sensitive</a> , <a href="http://pastebin.com/4XvrkRAa">case insensitive</a> <br>  KOI8-R: <a href="http://pastebin.com/iPMawzrJ">case sensitive</a> , <a href="http://pastebin.com/ag07T4ET">case insensitive</a> <br>  ISO-8859-5: <a href="http://pastebin.com/0YZSx7nQ">case sensitive</a> , <a href="http://pastebin.com/pfYzF4qa">case insensitive</a> <br><br>  Further.  We take the text of an unknown encoding, for each encoding being checked we find the frequency of the current character and add it to the ‚Äúrating‚Äù of this encoding.  The encoding with the highest rating is, most likely, the encoding of the text. <br><br><pre> <code class="php hljs">$encodings = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'cp1251'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">'specter_cp1251.php'</span></span>, <span class="hljs-string"><span class="hljs-string">'koi8r'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">'specter_koi8r.php'</span></span>, <span class="hljs-string"><span class="hljs-string">'iso88595'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">'specter_iso88595.php'</span></span> ); $enc_rates = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; len($str); ++$i) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($encodings <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $encoding =&gt; $char_specter) { $enc_rates[$encoding] += $char_specter[ord($str[$i])]; } } var_dump($enc_rates);</code> </pre><br>  Do not even try to execute this code in your home - it will not work.  You can consider this a pseudocode - I omitted the details so as not to clutter the article.  $ char_specter is just those arrays referenced by pastebin. <br><br><h5>  results </h5><br>  Table rows - text encoding, columns - the contents of the $ enc_rates array. <br><br>  1) $ str = 'Russian text'; <br> <code>cp1251 | koi8r | iso88595 | <br> 0.441 | 0.020 | 0.085 | Windows-1251 <br> 0.049 | 0.441 | 0.166 | KOI8-R <br> 0.133 | 0.092 | 0.441 | ISO-8859-5 <br></code> <br>  All perfectly.  The real encoding has already been 4 times higher rating than the rest - it is on such a short text.  On longer texts the ratio will be about the same. <br><br>  2) $ str = 'LINE CAPSOM RUSSIAN TEXT'; <br> <code>cp1251 | koi8r | iso88595 | <br> 0.013 | 0.705 | 0.331 | Windows-1251 <br> 0.649 | 0.013 | 0.201 | KOI8-R <br> 0.007 | 0.392 | 0.013 | ISO-8859-5 <br></code> <br><br>  Y-oops!  Complete porridge.  Because large letters in CP1251 usually correspond to small letters in KOI8-R.  And small letters are used in turn much more often than large ones.  So we define a caps string in CP1251 as KOI8-R. <br>  We try to do without taking into account the case ("spectra" case insensitive) <br><br>  1) $ str = 'Russian text'; <br> <code>cp1251 | koi8r | iso88595 | <br> 0.477 | 0.342 | 0.085 | Windows-1251 <br> 0.315 | 0.477 | 0.207 | KOI8-R <br> 0.216 | 0.321 | 0.477 | ISO-8859-5 <br></code> <br><br>  2) $ str = 'LINE CAPSOM RUSSIAN TEXT'; <br> <code>cp1251 | koi8r | iso88595 | <br> 1.074 | 0.705 | 0.465 | Windows-1251 <br> 0.649 | 1.074 | 0.201 | KOI8-R <br> 0.331 | 0.392 | 1.074 | ISO-8859-5 <br></code> <br><br>  As you can see, the correct encoding is consistently in the lead with both case-sensitive "spectra" (if the string contains a small number of capital letters), and with case-insensitive ones.  In the second case, with case-insensitive, the lead is not so confident, of course, but it is quite stable even on small lines.  You can play with the weights of letters - to make them non-linear with respect to frequency, for example. <br><br><h4>  5. Conclusion </h4><br>  In the topic, the work with UTF-8 is not considered - there is no fundamental difference, except that getting character codes and splitting a line into characters will be somewhat longer / more difficult. <br>  These ideas can be extended not only to Cyrillic encodings, of course - the question is only in the ‚Äúspectra‚Äù of the corresponding languages ‚Äã‚Äã/ encodings. <br><br>  PS If it is very necessary / interesting - then lay out the second part of a fully working library on GitHub.  Although I believe that the data in the post is quite enough to quickly write such a library and to your own needs - the ‚Äúspectrum‚Äù for the Russian language is laid out, it can be easily transferred to all the necessary encodings. <br><br>  UPDATED <br>  In the <a href="http://habrahabr.ru/blogs/php/107945/">comments</a> slipped a great feature, a link to which I published under the column "squalor".  Maybe I got excited with the words, but as published, I published it ‚Äî I was not used to editing such things.  Not to be unfounded, let's see if it works at 100%, as the alleged author <a href="http://habrahabr.ru/blogs/php/107945/">says</a> . <br>  1) Will there be errors in the "normal" operation of this function?  Suppose that our content is 100% valid. <br>  answer: yes, they will. <br>  2) Will it detect anything other than UTF-8 and non-UTF-8? <br>  Answer: No, it will not. <br><br>  Here is the code: <br><pre> <code class="php hljs">$str_cp1251 = iconv(<span class="hljs-string"><span class="hljs-string">'UTF-8'</span></span>, <span class="hljs-string"><span class="hljs-string">'Windows-1251'</span></span>, <span class="hljs-string"><span class="hljs-string">' '</span></span>); var_dump(md5($str_cp1251)); var_dump(md5(iconv(<span class="hljs-string"><span class="hljs-string">'Windows-1251'</span></span>, <span class="hljs-string"><span class="hljs-string">'Windows-1251'</span></span>, $str_cp1251))); var_dump(md5(iconv(<span class="hljs-string"><span class="hljs-string">'KOI8-R'</span></span>, <span class="hljs-string"><span class="hljs-string">'KOI8-R'</span></span>, $str_cp1251))); var_dump(md5(iconv(<span class="hljs-string"><span class="hljs-string">'ISO-8859-5'</span></span>, <span class="hljs-string"><span class="hljs-string">'ISO-8859-5'</span></span>, $str_cp1251))); var_dump(md5(iconv(<span class="hljs-string"><span class="hljs-string">'UTF-8'</span></span>, <span class="hljs-string"><span class="hljs-string">'UTF-8'</span></span>, $str_cp1251)));</code> </pre><br>  what is the output: <br><pre> <code class="bash hljs">m00t@m00t:~/workspace/<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>$ php detect_encoding.php string(32) <span class="hljs-string"><span class="hljs-string">"96e14d7add82668414ffbc498fcf2a4e"</span></span> string(32) <span class="hljs-string"><span class="hljs-string">"96e14d7add82668414ffbc498fcf2a4e"</span></span> string(32) <span class="hljs-string"><span class="hljs-string">"96e14d7add82668414ffbc498fcf2a4e"</span></span> string(32) <span class="hljs-string"><span class="hljs-string">"96e14d7add82668414ffbc498fcf2a4e"</span></span> PHP Notice: iconv(): Detected an illegal character <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> input string <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> /home/m00t/workspace/<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>/detect_encoding.php on line 36 PHP Stack trace: PHP 1. {main}() /home/m00t/workspace/<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>/detect_encoding.php:0 PHP 2. iconv() /home/m00t/workspace/<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>/detect_encoding.php:36 string(32) <span class="hljs-string"><span class="hljs-string">"d41d8cd98f00b204e9800998ecf8427e"</span></span></code> </pre><br>  What do we see?  Cyrillic single-byte after iconv ($ encoding, $ encodigng) will not change.  So you can only distinguish UTF-8 from non-UTF-8.  And then - at the cost of vorninga. <br>  IMHO is precisely because of these pieces of code and consider PHP "language for fools" <a href="http://habrahabr.ru/blogs/php/107945/">(c)</a> - how not to write the trolls in any topic about this language. </div><p>Source: <a href="https://habr.com/ru/post/107945/">https://habr.com/ru/post/107945/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../107937/index.html">Firefox 4.0b7</a></li>
<li><a href="../107938/index.html">5 million users: we will need more servers</a></li>
<li><a href="../107939/index.html">Linux vs Windows in school education</a></li>
<li><a href="../107940/index.html">A brief history of object-oriented programming.</a></li>
<li><a href="../107943/index.html">Vkontakte approach: you're doing it wrong</a></li>
<li><a href="../107946/index.html">Pylons and repoze.bfg are combined into a Pyramid project.</a></li>
<li><a href="../107948/index.html">BEGIN with Google technology</a></li>
<li><a href="../107949/index.html">Cloud Hosting Survey</a></li>
<li><a href="../107950/index.html">HP Lab at British Design High School</a></li>
<li><a href="../107953/index.html">Fast food recipe for popular browsers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>