<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Necessity on invention is cunning</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Most administrators know that in order to preserve their time, nerves and user data, it is necessary to use RAID arrays. However, their use is justifi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Necessity on invention is cunning</h1><div class="post__text post__text-html js-mediator-article"> Most administrators know that in order to preserve their time, nerves and user data, it is necessary to use RAID arrays.  However, their use is justified only if there is an adequate monitoring system. <br>  If a full-fledged operating system is used, problems usually do not arise: there are usually drivers and software for obtaining information from a RAID controller. <br><br>  But in the case of using ESXi server without additional binding in the form of vCenter, obtaining information from the controllers may not be completely trivial. <br><a name="habracut"></a><br>  Firstly, ESXi is not a full-fledged operating system, respectively, we are limited in the choice of software that we can install on it.  Theoretically, it is possible to install additional libraries on the server, which will make it possible to launch a cli interface for controlling the controller.  But this decision is bad in that it is necessary to intervene in the structure of the system, which can lead to poorly predictable consequences, moreover, it does not give a solution to the main task - obtaining an interface for automatic monitoring. <br><br>  To solve our problem, you can use the server provided with ESXi.  In this case, we need: a driver with CIM support, a CIM provider for VMware and software that can communicate with this CIM server. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, we have - Nagios, Nagios client on the Windows system and ESXi. <br><br>  By itself, installing drivers on ESXi is usually not a problem: you only need to upload a vib package to the server and install it using esxcli or esxupdate, like any other vib package.  Of course, before that it is necessary to turn off all guest systems and transfer ESXi to maintenance mode. <br><br>  The most interesting thing begins later - when the server is loaded, it is discovered that our datastore is no longer connected to the host.  To connect a datastore in ESXi 5, it is enough to add it to the list through the VMware client's snap-in with the UUID preserved; for ESXi 4.1, you will have to do a bit of work in the console. <br>  First, view the list of available volumes: <br> <code>esxcfg-volume -l</code> <br>  Then mount the volume we need, the ‚ÄìM key indicates that we want to mount the volume permanently: <br> <code><code>esxcfg-volume -M <br> <br>    cim     . (    ,   RAID      . ,           ,       .)            maintenance . <br> <br>      CIM   Adaptec           /var/log/arcconf.log,       . ..             : <br>   /var/spool/cron/crontabs/root,    : <br> */05 * * * * /vmfs/volumes/4ef49f1a-b2abe2ec-32c6-00123t13a19e2/arcconf_del.sh   /etc/rc.local  ,        cron   : <br> <code>/bin/kill $(cat /var/run/crond.pid) <br> /bin/echo '*/05 * * * * /vmfs/volumes/4ef49f1a-b2abe2ec-32c6-001b213a19e2/arcconf_del.sh' &gt;&gt; /var/spool/cron/crontabs/root <br> /bin/busybox crond</code>   /vmfs/volumes/4ef49f1a-b2abe2ec-32c6-001b213a19e2/arcconf_del.sh: <br> <code>#!/bin/sh <br> rm -f /var/log/arcconf.log</code>     : <code>chmod +x /vmfs/volumes/4ef49f1a-b2abe2ec-32c6-001b213a19e2/arcconf_del.sh</code>        5 . <br> <br>  SSH,  CIM          . <br> <br>           RAID-.        .  ,       ,    ,     . , Adaptec arcconf    Y, E  K    (  18856  ,        ). <br> <br> ,           . <br> <br>      ,          .  Windows NSClient++   <a href="http://exchange.nagios.org/directory/Plugins/Hardware/Storage-Systems/RAID-Controllers/Windows-nrpe-3A-Check-Raid-adaptec-AAC/details">exchange.nagios.org/directory/Plugins/Hardware/Storage-Systems/RAID-Controllers/Windows-nrpe-3A-Check-Raid-adaptec-AAC/details</a> <br> <br>      c  ,        ‚Äì    ,       PowerShell: <br> <br> $outputPath = 'C:\Program Files (x86)\Nagios\scripts\MegaSAS.log' Set-Content $outputPath ""; $raidCLI = 'C:\Program Files (x86)\CLI_Win_8.04.07\megacli64.exe' $raidArgs = '-LDInfo -Lall -aALL' $shiftString = 5 $searchPattern = "Virtual Drive:" Start-Process -FilePath $raidCLI -ArgumentList $raidArgs -Wait $arcconfOutput = Get-Content -Path $outputPath $logicalDevices = Select-String -Path $outputPath -Pattern $searchPattern; $healthCheckIndex = 0; foreach($logicalDevice in $logicalDevices) { $deviceState = $logicalDevice.get_linenumber(); $deviceStatus = $arcconfOutput.Get($deviceState+$shiftString); if($deviceStatus -match "/?Optimal") { $healthCheckIndex = $healthCheckIndex+1; } } if($healthCheckIndex -lt $logicalDevices.Count) { Write-Host "CRITICAL: Logical Device state failed"; } if($healthCheckIndex -eq $logicalDevices.Count) { Write-Host "OK: All logical devices works fine"; } else { Write-Host "Unknown: Error occured"; } <br> <br>                    ‚Äì Adaptec, LSI  - . LSI           ,  Adaptec         . <br> <br>        ‚Äì  .     ,       .      ,   .     .</code></code> <ol><li> <code><code>esxcfg-volume -M <br> <br>    cim     . (    ,   RAID      . ,           ,       .)            maintenance . <br> <br>      CIM   Adaptec           /var/log/arcconf.log,       . ..             : <br>   /var/spool/cron/crontabs/root,    : <br> */05 * * * * /vmfs/volumes/4ef49f1a-b2abe2ec-32c6-00123t13a19e2/arcconf_del.sh   /etc/rc.local  ,        cron   : <br> <code>/bin/kill $(cat /var/run/crond.pid) <br> /bin/echo '*/05 * * * * /vmfs/volumes/4ef49f1a-b2abe2ec-32c6-001b213a19e2/arcconf_del.sh' &gt;&gt; /var/spool/cron/crontabs/root <br> /bin/busybox crond</code>   /vmfs/volumes/4ef49f1a-b2abe2ec-32c6-001b213a19e2/arcconf_del.sh: <br> <code>#!/bin/sh <br> rm -f /var/log/arcconf.log</code>     : <code>chmod +x /vmfs/volumes/4ef49f1a-b2abe2ec-32c6-001b213a19e2/arcconf_del.sh</code>        5 . <br> <br>  SSH,  CIM          . <br> <br>           RAID-.        .  ,       ,    ,     . , Adaptec arcconf    Y, E  K    (  18856  ,        ). <br> <br> ,           . <br> <br>      ,          .  Windows NSClient++   <a href="http://exchange.nagios.org/directory/Plugins/Hardware/Storage-Systems/RAID-Controllers/Windows-nrpe-3A-Check-Raid-adaptec-AAC/details">exchange.nagios.org/directory/Plugins/Hardware/Storage-Systems/RAID-Controllers/Windows-nrpe-3A-Check-Raid-adaptec-AAC/details</a> <br> <br>      c  ,        ‚Äì    ,       PowerShell: <br> <br> $outputPath = 'C:\Program Files (x86)\Nagios\scripts\MegaSAS.log' Set-Content $outputPath ""; $raidCLI = 'C:\Program Files (x86)\CLI_Win_8.04.07\megacli64.exe' $raidArgs = '-LDInfo -Lall -aALL' $shiftString = 5 $searchPattern = "Virtual Drive:" Start-Process -FilePath $raidCLI -ArgumentList $raidArgs -Wait $arcconfOutput = Get-Content -Path $outputPath $logicalDevices = Select-String -Path $outputPath -Pattern $searchPattern; $healthCheckIndex = 0; foreach($logicalDevice in $logicalDevices) { $deviceState = $logicalDevice.get_linenumber(); $deviceStatus = $arcconfOutput.Get($deviceState+$shiftString); if($deviceStatus -match "/?Optimal") { $healthCheckIndex = $healthCheckIndex+1; } } if($healthCheckIndex -lt $logicalDevices.Count) { Write-Host "CRITICAL: Logical Device state failed"; } if($healthCheckIndex -eq $logicalDevices.Count) { Write-Host "OK: All logical devices works fine"; } else { Write-Host "Unknown: Error occured"; } <br> <br>                    ‚Äì Adaptec, LSI  - . LSI           ,  Adaptec         . <br> <br>        ‚Äì  .     ,       .      ,   .     .</code></code> </li> <li> <code><code>esxcfg-volume -M <br> <br>    cim     . (    ,   RAID      . ,           ,       .)            maintenance . <br> <br>      CIM   Adaptec           /var/log/arcconf.log,       . ..             : <br>   /var/spool/cron/crontabs/root,    : <br> */05 * * * * /vmfs/volumes/4ef49f1a-b2abe2ec-32c6-00123t13a19e2/arcconf_del.sh</code>   /etc/rc.local  ,        cron   : <br> <code>/bin/kill $(cat /var/run/crond.pid) <br> /bin/echo '*/05 * * * * /vmfs/volumes/4ef49f1a-b2abe2ec-32c6-001b213a19e2/arcconf_del.sh' &gt;&gt; /var/spool/cron/crontabs/root <br> /bin/busybox crond</code>   /vmfs/volumes/4ef49f1a-b2abe2ec-32c6-001b213a19e2/arcconf_del.sh: <br> <code>#!/bin/sh <br> rm -f /var/log/arcconf.log</code>     : <code>chmod +x /vmfs/volumes/4ef49f1a-b2abe2ec-32c6-001b213a19e2/arcconf_del.sh</code>        5 . <br> <br>  SSH,  CIM          . <br> <br>           RAID-.        .  ,       ,    ,     . , Adaptec arcconf    Y, E  K    (  18856  ,        ). <br> <br> ,           . <br> <br>      ,          .  Windows NSClient++   <a href="http://exchange.nagios.org/directory/Plugins/Hardware/Storage-Systems/RAID-Controllers/Windows-nrpe-3A-Check-Raid-adaptec-AAC/details">exchange.nagios.org/directory/Plugins/Hardware/Storage-Systems/RAID-Controllers/Windows-nrpe-3A-Check-Raid-adaptec-AAC/details</a> <br> <br>      c  ,        ‚Äì    ,       PowerShell: <br> <br> $outputPath = 'C:\Program Files (x86)\Nagios\scripts\MegaSAS.log' Set-Content $outputPath ""; $raidCLI = 'C:\Program Files (x86)\CLI_Win_8.04.07\megacli64.exe' $raidArgs = '-LDInfo -Lall -aALL' $shiftString = 5 $searchPattern = "Virtual Drive:" Start-Process -FilePath $raidCLI -ArgumentList $raidArgs -Wait $arcconfOutput = Get-Content -Path $outputPath $logicalDevices = Select-String -Path $outputPath -Pattern $searchPattern; $healthCheckIndex = 0; foreach($logicalDevice in $logicalDevices) { $deviceState = $logicalDevice.get_linenumber(); $deviceStatus = $arcconfOutput.Get($deviceState+$shiftString); if($deviceStatus -match "/?Optimal") { $healthCheckIndex = $healthCheckIndex+1; } } if($healthCheckIndex -lt $logicalDevices.Count) { Write-Host "CRITICAL: Logical Device state failed"; } if($healthCheckIndex -eq $logicalDevices.Count) { Write-Host "OK: All logical devices works fine"; } else { Write-Host "Unknown: Error occured"; } <br> <br>                    ‚Äì Adaptec, LSI  - . LSI           ,  Adaptec         . <br> <br>        ‚Äì  .     ,       .      ,   .     .</code> </li> <li> <code><code>esxcfg-volume -M <br> <br>    cim     . (    ,   RAID      . ,           ,       .)            maintenance . <br> <br>      CIM   Adaptec           /var/log/arcconf.log,       . ..             : <br>   /var/spool/cron/crontabs/root,    : <br> */05 * * * * /vmfs/volumes/4ef49f1a-b2abe2ec-32c6-00123t13a19e2/arcconf_del.sh</code>   /etc/rc.local  ,        cron   : <br> <code>/bin/kill $(cat /var/run/crond.pid) <br> /bin/echo '*/05 * * * * /vmfs/volumes/4ef49f1a-b2abe2ec-32c6-001b213a19e2/arcconf_del.sh' &gt;&gt; /var/spool/cron/crontabs/root <br> /bin/busybox crond</code>   /vmfs/volumes/4ef49f1a-b2abe2ec-32c6-001b213a19e2/arcconf_del.sh: <br> <code>#!/bin/sh <br> rm -f /var/log/arcconf.log</code>     : <code>chmod +x /vmfs/volumes/4ef49f1a-b2abe2ec-32c6-001b213a19e2/arcconf_del.sh</code>        5 . <br> <br>  SSH,  CIM          . <br> <br>           RAID-.        .  ,       ,    ,     . , Adaptec arcconf    Y, E  K    (  18856  ,        ). <br> <br> ,           . <br> <br>      ,          .  Windows NSClient++   <a href="http://exchange.nagios.org/directory/Plugins/Hardware/Storage-Systems/RAID-Controllers/Windows-nrpe-3A-Check-Raid-adaptec-AAC/details">exchange.nagios.org/directory/Plugins/Hardware/Storage-Systems/RAID-Controllers/Windows-nrpe-3A-Check-Raid-adaptec-AAC/details</a> <br> <br>      c  ,        ‚Äì    ,       PowerShell: <br> <br> $outputPath = 'C:\Program Files (x86)\Nagios\scripts\MegaSAS.log' Set-Content $outputPath ""; $raidCLI = 'C:\Program Files (x86)\CLI_Win_8.04.07\megacli64.exe' $raidArgs = '-LDInfo -Lall -aALL' $shiftString = 5 $searchPattern = "Virtual Drive:" Start-Process -FilePath $raidCLI -ArgumentList $raidArgs -Wait $arcconfOutput = Get-Content -Path $outputPath $logicalDevices = Select-String -Path $outputPath -Pattern $searchPattern; $healthCheckIndex = 0; foreach($logicalDevice in $logicalDevices) { $deviceState = $logicalDevice.get_linenumber(); $deviceStatus = $arcconfOutput.Get($deviceState+$shiftString); if($deviceStatus -match "/?Optimal") { $healthCheckIndex = $healthCheckIndex+1; } } if($healthCheckIndex -lt $logicalDevices.Count) { Write-Host "CRITICAL: Logical Device state failed"; } if($healthCheckIndex -eq $logicalDevices.Count) { Write-Host "OK: All logical devices works fine"; } else { Write-Host "Unknown: Error occured"; } <br> <br>                    ‚Äì Adaptec, LSI  - . LSI           ,  Adaptec         . <br> <br>        ‚Äì  .     ,       .      ,   .     .</code> </li> <li> <code><code>esxcfg-volume -M <br> <br>    cim     . (    ,   RAID      . ,           ,       .)            maintenance . <br> <br>      CIM   Adaptec           /var/log/arcconf.log,       . ..             : <br>   /var/spool/cron/crontabs/root,    : <br> */05 * * * * /vmfs/volumes/4ef49f1a-b2abe2ec-32c6-00123t13a19e2/arcconf_del.sh</code>   /etc/rc.local  ,        cron   : <br> <code>/bin/kill $(cat /var/run/crond.pid) <br> /bin/echo '*/05 * * * * /vmfs/volumes/4ef49f1a-b2abe2ec-32c6-001b213a19e2/arcconf_del.sh' &gt;&gt; /var/spool/cron/crontabs/root <br> /bin/busybox crond</code>   /vmfs/volumes/4ef49f1a-b2abe2ec-32c6-001b213a19e2/arcconf_del.sh: <br> <code>#!/bin/sh <br> rm -f /var/log/arcconf.log</code>     : <code>chmod +x /vmfs/volumes/4ef49f1a-b2abe2ec-32c6-001b213a19e2/arcconf_del.sh</code>        5 . <br> <br>  SSH,  CIM          . <br> <br>           RAID-.        .  ,       ,    ,     . , Adaptec arcconf    Y, E  K    (  18856  ,        ). <br> <br> ,           . <br> <br>      ,          .  Windows NSClient++   <a href="http://exchange.nagios.org/directory/Plugins/Hardware/Storage-Systems/RAID-Controllers/Windows-nrpe-3A-Check-Raid-adaptec-AAC/details">exchange.nagios.org/directory/Plugins/Hardware/Storage-Systems/RAID-Controllers/Windows-nrpe-3A-Check-Raid-adaptec-AAC/details</a> <br> <br>      c  ,        ‚Äì    ,       PowerShell: <br> <br> $outputPath = 'C:\Program Files (x86)\Nagios\scripts\MegaSAS.log' Set-Content $outputPath ""; $raidCLI = 'C:\Program Files (x86)\CLI_Win_8.04.07\megacli64.exe' $raidArgs = '-LDInfo -Lall -aALL' $shiftString = 5 $searchPattern = "Virtual Drive:" Start-Process -FilePath $raidCLI -ArgumentList $raidArgs -Wait $arcconfOutput = Get-Content -Path $outputPath $logicalDevices = Select-String -Path $outputPath -Pattern $searchPattern; $healthCheckIndex = 0; foreach($logicalDevice in $logicalDevices) { $deviceState = $logicalDevice.get_linenumber(); $deviceStatus = $arcconfOutput.Get($deviceState+$shiftString); if($deviceStatus -match "/?Optimal") { $healthCheckIndex = $healthCheckIndex+1; } } if($healthCheckIndex -lt $logicalDevices.Count) { Write-Host "CRITICAL: Logical Device state failed"; } if($healthCheckIndex -eq $logicalDevices.Count) { Write-Host "OK: All logical devices works fine"; } else { Write-Host "Unknown: Error occured"; } <br> <br>                    ‚Äì Adaptec, LSI  - . LSI           ,  Adaptec         . <br> <br>        ‚Äì  .     ,       .      ,   .     .</code> </li> <li> <code><code>esxcfg-volume -M <br> <br>    cim     . (    ,   RAID      . ,           ,       .)            maintenance . <br> <br>      CIM   Adaptec           /var/log/arcconf.log,       . ..             : <br>   /var/spool/cron/crontabs/root,    : <br> */05 * * * * /vmfs/volumes/4ef49f1a-b2abe2ec-32c6-00123t13a19e2/arcconf_del.sh</code>   /etc/rc.local  ,        cron   : <br> <code>/bin/kill $(cat /var/run/crond.pid) <br> /bin/echo '*/05 * * * * /vmfs/volumes/4ef49f1a-b2abe2ec-32c6-001b213a19e2/arcconf_del.sh' &gt;&gt; /var/spool/cron/crontabs/root <br> /bin/busybox crond</code>   /vmfs/volumes/4ef49f1a-b2abe2ec-32c6-001b213a19e2/arcconf_del.sh: <br> <code>#!/bin/sh <br> rm -f /var/log/arcconf.log</code>     : <code>chmod +x /vmfs/volumes/4ef49f1a-b2abe2ec-32c6-001b213a19e2/arcconf_del.sh</code>        5 . <br> <br>  SSH,  CIM          . <br> <br>           RAID-.        .  ,       ,    ,     . , Adaptec arcconf    Y, E  K    (  18856  ,        ). <br> <br> ,           . <br> <br>      ,          .  Windows NSClient++   <a href="http://exchange.nagios.org/directory/Plugins/Hardware/Storage-Systems/RAID-Controllers/Windows-nrpe-3A-Check-Raid-adaptec-AAC/details">exchange.nagios.org/directory/Plugins/Hardware/Storage-Systems/RAID-Controllers/Windows-nrpe-3A-Check-Raid-adaptec-AAC/details</a> <br> <br>      c  ,        ‚Äì    ,       PowerShell: <br> <br> $outputPath = 'C:\Program Files (x86)\Nagios\scripts\MegaSAS.log' Set-Content $outputPath ""; $raidCLI = 'C:\Program Files (x86)\CLI_Win_8.04.07\megacli64.exe' $raidArgs = '-LDInfo -Lall -aALL' $shiftString = 5 $searchPattern = "Virtual Drive:" Start-Process -FilePath $raidCLI -ArgumentList $raidArgs -Wait $arcconfOutput = Get-Content -Path $outputPath $logicalDevices = Select-String -Path $outputPath -Pattern $searchPattern; $healthCheckIndex = 0; foreach($logicalDevice in $logicalDevices) { $deviceState = $logicalDevice.get_linenumber(); $deviceStatus = $arcconfOutput.Get($deviceState+$shiftString); if($deviceStatus -match "/?Optimal") { $healthCheckIndex = $healthCheckIndex+1; } } if($healthCheckIndex -lt $logicalDevices.Count) { Write-Host "CRITICAL: Logical Device state failed"; } if($healthCheckIndex -eq $logicalDevices.Count) { Write-Host "OK: All logical devices works fine"; } else { Write-Host "Unknown: Error occured"; } <br> <br>                    ‚Äì Adaptec, LSI  - . LSI           ,  Adaptec         . <br> <br>        ‚Äì  .     ,       .      ,   .     .</code> </li> </ol> <code><code>esxcfg-volume -M <br> <br>    cim     . (    ,   RAID      . ,           ,       .)            maintenance . <br> <br>      CIM   Adaptec           /var/log/arcconf.log,       . ..             : <br>   /var/spool/cron/crontabs/root,    : <br> */05 * * * * /vmfs/volumes/4ef49f1a-b2abe2ec-32c6-00123t13a19e2/arcconf_del.sh</code>   /etc/rc.local  ,        cron   : <br> <code>/bin/kill $(cat /var/run/crond.pid) <br> /bin/echo '*/05 * * * * /vmfs/volumes/4ef49f1a-b2abe2ec-32c6-001b213a19e2/arcconf_del.sh' &gt;&gt; /var/spool/cron/crontabs/root <br> /bin/busybox crond</code>   /vmfs/volumes/4ef49f1a-b2abe2ec-32c6-001b213a19e2/arcconf_del.sh: <br> <code>#!/bin/sh <br> rm -f /var/log/arcconf.log</code>     : <code>chmod +x /vmfs/volumes/4ef49f1a-b2abe2ec-32c6-001b213a19e2/arcconf_del.sh</code>        5 . <br> <br>  SSH,  CIM          . <br> <br>           RAID-.        .  ,       ,    ,     . , Adaptec arcconf    Y, E  K    (  18856  ,        ). <br> <br> ,           . <br> <br>      ,          .  Windows NSClient++   <a href="http://exchange.nagios.org/directory/Plugins/Hardware/Storage-Systems/RAID-Controllers/Windows-nrpe-3A-Check-Raid-adaptec-AAC/details">exchange.nagios.org/directory/Plugins/Hardware/Storage-Systems/RAID-Controllers/Windows-nrpe-3A-Check-Raid-adaptec-AAC/details</a> <br> <br>      c  ,        ‚Äì    ,       PowerShell: <br> <br> $outputPath = 'C:\Program Files (x86)\Nagios\scripts\MegaSAS.log' Set-Content $outputPath ""; $raidCLI = 'C:\Program Files (x86)\CLI_Win_8.04.07\megacli64.exe' $raidArgs = '-LDInfo -Lall -aALL' $shiftString = 5 $searchPattern = "Virtual Drive:" Start-Process -FilePath $raidCLI -ArgumentList $raidArgs -Wait $arcconfOutput = Get-Content -Path $outputPath $logicalDevices = Select-String -Path $outputPath -Pattern $searchPattern; $healthCheckIndex = 0; foreach($logicalDevice in $logicalDevices) { $deviceState = $logicalDevice.get_linenumber(); $deviceStatus = $arcconfOutput.Get($deviceState+$shiftString); if($deviceStatus -match "/?Optimal") { $healthCheckIndex = $healthCheckIndex+1; } } if($healthCheckIndex -lt $logicalDevices.Count) { Write-Host "CRITICAL: Logical Device state failed"; } if($healthCheckIndex -eq $logicalDevices.Count) { Write-Host "OK: All logical devices works fine"; } else { Write-Host "Unknown: Error occured"; } <br> <br>                    ‚Äì Adaptec, LSI  - . LSI           ,  Adaptec         . <br> <br>        ‚Äì  .     ,       .      ,   .     .</code> <pre> <code class="hljs mel"><code>esxcfg-volume -M <br> <br>    cim     . (    ,   RAID      . ,           ,       .)            maintenance . <br> <br>      CIM   Adaptec           /var/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/arcconf.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>,       . ..             : <br>   /var/spool/cron/crontabs/root,    : <br> */<span class="hljs-number"><span class="hljs-number">05</span></span> * * * * /vmfs/volumes/<span class="hljs-number"><span class="hljs-number">4</span></span>ef49f1a-b2abe2ec<span class="hljs-number"><span class="hljs-number">-32</span></span>c6<span class="hljs-number"><span class="hljs-number">-00123</span></span>t13a19e2/arcconf_del.sh</code>   /etc/rc.local  ,        cron   : <br> <code>/bin/kill $(cat /var/run/crond.pid) <br> /bin/echo <span class="hljs-string"><span class="hljs-string">'*/05 * * * * /vmfs/volumes/4ef49f1a-b2abe2ec-32c6-001b213a19e2/arcconf_del.sh'</span></span> &gt;&gt; /var/spool/cron/crontabs/root <br> /bin/busybox crond</code>   /vmfs/volumes/<span class="hljs-number"><span class="hljs-number">4</span></span>ef49f1a-b2abe2ec<span class="hljs-number"><span class="hljs-number">-32</span></span>c6<span class="hljs-number"><span class="hljs-number">-001</span></span>b213a19e2/arcconf_del.sh: <br> <code>#!/bin/sh <br> rm -f /var/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/arcconf.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span></code>     : <code>chmod +x /vmfs/volumes/<span class="hljs-number"><span class="hljs-number">4</span></span>ef49f1a-b2abe2ec<span class="hljs-number"><span class="hljs-number">-32</span></span>c6<span class="hljs-number"><span class="hljs-number">-001</span></span>b213a19e<span class="hljs-number"><span class="hljs-number">2</span></span>/arcconf_del.sh</code>        <span class="hljs-number"><span class="hljs-number">5</span></span> . <br> <br>  SSH,  CIM          . <br> <br>           RAID-.        .  ,       ,    ,     . , Adaptec arcconf    Y, E  K    (  <span class="hljs-number"><span class="hljs-number">18856</span></span>  ,        ). <br> <br> ,           . <br> <br>      ,          .  Windows NSClient++   <a href="http://exchange.nagios.org/directory/Plugins/Hardware/Storage-Systems/RAID-Controllers/Windows-nrpe-3A-Check-Raid-adaptec-AAC/details">exchange.nagios.org/directory/Plugins/Hardware/Storage-Systems/RAID-Controllers/Windows-nrpe<span class="hljs-number"><span class="hljs-number">-3</span></span>A-Check-Raid-adaptec-AAC/details</a> <br> <br>      c  ,        ‚Äì    ,       PowerShell: <br> <br> $outputPath = <span class="hljs-string"><span class="hljs-string">'C:\Program Files (x86)\Nagios\scripts\MegaSAS.log'</span></span> Set-Content $outputPath <span class="hljs-string"><span class="hljs-string">""</span></span>; $raidCLI = <span class="hljs-string"><span class="hljs-string">'C:\Program Files (x86)\CLI_Win_8.04.07\megacli64.exe'</span></span> $raidArgs = <span class="hljs-string"><span class="hljs-string">'-LDInfo -Lall -aALL'</span></span> $shiftString = <span class="hljs-number"><span class="hljs-number">5</span></span> $searchPattern = <span class="hljs-string"><span class="hljs-string">"Virtual Drive:"</span></span> Start-Process -FilePath $raidCLI -ArgumentList $raidArgs -Wait $arcconfOutput = Get-Content -Path $outputPath $logicalDevices = Select-String -Path $outputPath -Pattern $searchPattern; $healthCheckIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>; foreach($logicalDevice <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $logicalDevices) { $deviceState = $logicalDevice.get_linenumber(); $deviceStatus = $arcconfOutput.Get($deviceState+$shiftString); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($deviceStatus -<span class="hljs-keyword"><span class="hljs-keyword">match</span></span> <span class="hljs-string"><span class="hljs-string">"/?Optimal"</span></span>) { $healthCheckIndex = $healthCheckIndex+<span class="hljs-number"><span class="hljs-number">1</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($healthCheckIndex -lt $logicalDevices.Count) { Write-Host <span class="hljs-string"><span class="hljs-string">"CRITICAL: Logical Device state failed"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($healthCheckIndex -eq $logicalDevices.Count) { Write-Host <span class="hljs-string"><span class="hljs-string">"OK: All logical devices works fine"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Write-Host <span class="hljs-string"><span class="hljs-string">"Unknown: Error occured"</span></span>; } <br> <br>                    ‚Äì Adaptec, LSI  - . LSI           ,  Adaptec         . <br> <br>        ‚Äì  .     ,       .      ,   .     .</code> </pre> <code><code>esxcfg-volume -M <br> <br>    cim     . (    ,   RAID      . ,           ,       .)            maintenance . <br> <br>      CIM   Adaptec           /var/log/arcconf.log,       . ..             : <br>   /var/spool/cron/crontabs/root,    : <br> */05 * * * * /vmfs/volumes/4ef49f1a-b2abe2ec-32c6-00123t13a19e2/arcconf_del.sh</code>   /etc/rc.local  ,        cron   : <br> <code>/bin/kill $(cat /var/run/crond.pid) <br> /bin/echo '*/05 * * * * /vmfs/volumes/4ef49f1a-b2abe2ec-32c6-001b213a19e2/arcconf_del.sh' &gt;&gt; /var/spool/cron/crontabs/root <br> /bin/busybox crond</code>   /vmfs/volumes/4ef49f1a-b2abe2ec-32c6-001b213a19e2/arcconf_del.sh: <br> <code>#!/bin/sh <br> rm -f /var/log/arcconf.log</code>     : <code>chmod +x /vmfs/volumes/4ef49f1a-b2abe2ec-32c6-001b213a19e2/arcconf_del.sh</code>        5 . <br> <br>  SSH,  CIM          . <br> <br>           RAID-.        .  ,       ,    ,     . , Adaptec arcconf    Y, E  K    (  18856  ,        ). <br> <br> ,           . <br> <br>      ,          .  Windows NSClient++   <a href="http://exchange.nagios.org/directory/Plugins/Hardware/Storage-Systems/RAID-Controllers/Windows-nrpe-3A-Check-Raid-adaptec-AAC/details">exchange.nagios.org/directory/Plugins/Hardware/Storage-Systems/RAID-Controllers/Windows-nrpe-3A-Check-Raid-adaptec-AAC/details</a> <br> <br>      c  ,        ‚Äì    ,       PowerShell: <br> <br> $outputPath = 'C:\Program Files (x86)\Nagios\scripts\MegaSAS.log' Set-Content $outputPath ""; $raidCLI = 'C:\Program Files (x86)\CLI_Win_8.04.07\megacli64.exe' $raidArgs = '-LDInfo -Lall -aALL' $shiftString = 5 $searchPattern = "Virtual Drive:" Start-Process -FilePath $raidCLI -ArgumentList $raidArgs -Wait $arcconfOutput = Get-Content -Path $outputPath $logicalDevices = Select-String -Path $outputPath -Pattern $searchPattern; $healthCheckIndex = 0; foreach($logicalDevice in $logicalDevices) { $deviceState = $logicalDevice.get_linenumber(); $deviceStatus = $arcconfOutput.Get($deviceState+$shiftString); if($deviceStatus -match "/?Optimal") { $healthCheckIndex = $healthCheckIndex+1; } } if($healthCheckIndex -lt $logicalDevices.Count) { Write-Host "CRITICAL: Logical Device state failed"; } if($healthCheckIndex -eq $logicalDevices.Count) { Write-Host "OK: All logical devices works fine"; } else { Write-Host "Unknown: Error occured"; } <br> <br>                    ‚Äì Adaptec, LSI  - . LSI           ,  Adaptec         . <br> <br>        ‚Äì  .     ,       .      ,   .     .</code> </div><p>Source: <a href="https://habr.com/ru/post/186950/">https://habr.com/ru/post/186950/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../186934/index.html">BitTorrent Sync goes into beta</a></li>
<li><a href="../186940/index.html">AOP in action. AspectJ (CTW) + Spring + LTW</a></li>
<li><a href="../186942/index.html">Monitoring server resources running * nix with RRDtool</a></li>
<li><a href="../186944/index.html">We write our system monitor (Linux)</a></li>
<li><a href="../186948/index.html">PMP Exam: Preparation, Audit, Recommendations</a></li>
<li><a href="../186952/index.html">The Voynich Manuscript. Manchurian Candidate</a></li>
<li><a href="../186956/index.html">Tesla Robotic Plant</a></li>
<li><a href="../186960/index.html">FlexCloud - Home P2P cloud of the future</a></li>
<li><a href="../186962/index.html">Technopark Mail.Ru from the inside</a></li>
<li><a href="../186968/index.html">Google fixed a vulnerability that allowed to get full remote access to Glass</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>