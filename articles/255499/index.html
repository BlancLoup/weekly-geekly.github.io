<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Pool objects for unity3d</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Everyone knows that creating and deleting objects is not cheap. For example, creating a bullet each time and destroying it is quite expensive for the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Pool objects for unity3d</h1><div class="post__text post__text-html js-mediator-article">  Everyone knows that creating and deleting objects is not cheap.  For example, creating a bullet each time and destroying it is quite expensive for the same mobile devices.  Maybe we should not destroy the bullet, but hide it.  So I decided to share my implementation of Pool Manager. <br><a name="habracut"></a><br><h4>  Structures </h4><br>  First, you need to create an interface: <br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IPoolObject</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; { T Group { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnPush</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FailedPush</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; }</code> </pre> <br>  What is the interface for?  Universally, let the pool not know what objects it works with, it only knows that they have special methods and properties. <br>  T - in this case, the group ID.  An example further. <br>  The Create () method will play the role of a pseudo-constructor.  After all, when you get an object from the pool, its state will not be determined, which may adversely affect its further use. <br>  The OnPush () method will play the role of a pseudo-destructor.  When an object enters the pool, you may need to do something, for example, turn off some related partitions or something else. <br>  Method FailedPush () - Will be called on the object, in case it is not possible to get into the pool.  For example, the pool is full.  And something the object would not remain ownerless, it may need to be destroyed. <br><br>  Now Pool Manager itself <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PoolManager</span></span>&lt;<span class="hljs-title"><span class="hljs-title">K</span></span>, <span class="hljs-title"><span class="hljs-title">V</span></span>&gt; <span class="hljs-title"><span class="hljs-title">where</span></span> <span class="hljs-title"><span class="hljs-title">V</span></span> :<span class="hljs-title"><span class="hljs-title">IPoolObject</span></span>&lt;<span class="hljs-title"><span class="hljs-title">K</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> MaxInstances { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> InctanceCount { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> objects.Count; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CacheCount { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cache.Count; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">delegate</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Compare&lt;T&gt;(T <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T: V; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Dictionary&lt;K, List&lt;V&gt;&gt; objects; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Dictionary&lt;Type, List&lt;V&gt;&gt; cache; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PoolManager</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> maxInstance</span></span></span><span class="hljs-function">)</span></span> { MaxInstances = maxInstance; objects = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;K, List&lt;V&gt;&gt;(); cache = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;Type, List&lt;V&gt;&gt;(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CanPush</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> InctanceCount + <span class="hljs-number"><span class="hljs-number">1</span></span> &lt; MaxInstances; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Push</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">K groupKey, V </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> result = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (CanPush()) { <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.OnPush(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!objects.ContainsKey(groupKey)) { objects.Add(groupKey, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;V&gt;()); } objects[groupKey].Add(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); Type type = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.GetType(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cache.ContainsKey(type)) { cache.Add(type, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;V&gt;()); } cache[type].Add(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.FailedPush(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> T Pop&lt;T&gt;(K groupKey) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : V { T result = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>(T); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Contains(groupKey) &amp;&amp; objects[groupKey].Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; objects[groupKey].Count; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (objects[groupKey][i] <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> T) { result = (T)objects[groupKey][i]; Type type = result.GetType(); RemoveObject(groupKey, i); RemoveFromCache(result, type); result.Create(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> T Pop&lt;T&gt;() <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T: V { T result = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>(T); Type type = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(T); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ValidateForPop(type)) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cache[type].Count; i++) { result = (T)cache[type][i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; objects.ContainsKey(result.Group)) { objects[result.Group].Remove(result); RemoveFromCache(result, type); result.Create(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> T Pop&lt;T&gt;(Compare&lt;T&gt; comparer) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : V { T result = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>(T); Type type = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(T); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ValidateForPop(type)) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cache[type].Count; i++) { T <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = (T)cache[type][i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (comparer(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>)) { objects[<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.Group].Remove(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); RemoveFromCache(result, type); result = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; result.Create(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Contains</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">K groupKey</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> objects.ContainsKey(groupKey); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clear</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { objects.Clear(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ValidateForPop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Type type</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cache.ContainsKey(type) &amp;&amp; cache[type].Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveObject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">K groupKey, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> idx</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (idx &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; idx &lt; objects[groupKey].Count) { objects[groupKey].RemoveAt(idx); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (objects[groupKey].Count == <span class="hljs-number"><span class="hljs-number">0</span></span>) { objects.Remove(groupKey); } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveFromCache</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">V </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Type type</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cache.ContainsKey(type)) { cache[type].Remove(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cache[type].Count == <span class="hljs-number"><span class="hljs-number">0</span></span>) { cache.Remove(type); } } } }</code> </pre><br>  What you should pay attention to. <br>  MaxInstances - the field of the maximum number of pool objects.  In case it is not possible to place another object in the pool. <br>  protected Dictionary &lt;K, List&gt; objects -Container is represented as a group - list.  When it enters the pool, it is sent to the appropriate group.  When it is required, the pool will return the first corresponding object in the group.  protected Dictionary &lt;Type, List&gt; cache - cache of objects by type.  It is necessary, exclusively, for the beautiful method Pop (). <br>  Method Pop (Compare comparer) - may need to get an object by condition. <br><br>  Shared Pool ready.  Now we need to make a variation for Unity3d.  Let's get started 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">UnityPoolManager</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> UnityPoolManager Instance {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>;} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> maxInstanceCount = <span class="hljs-number"><span class="hljs-number">128</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> PoolManager&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, UnityPoolObject&gt; poolManager; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Instance = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; poolManager = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PoolManager&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, UnityPoolObject&gt;(maxInstanceCount); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CanPush</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> poolManager.CanPush(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Push</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> groupKey, UnityPoolObject poolObject</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> poolManager.Push(groupKey, poolObject); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> T PopOrCreate&lt;T&gt;(T prefab) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : UnityPoolObject { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> PopOrCreate(prefab, Vector3.zero, Quaternion.identity); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> T PopOrCreate&lt;T&gt;(T prefab, Vector3 position, Quaternion rotation) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : UnityPoolObject { T result = poolManager.Pop&lt;T&gt;(prefab.Group); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { result = CreateObject&lt;T&gt;(prefab, position, rotation); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { result.SetTransform(position, rotation); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> UnityPoolObject </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Pop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> groupKey</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> poolManager.Pop&lt;UnityPoolObject&gt;(groupKey); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> T Pop&lt;T&gt;() <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : UnityPoolObject { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> poolManager.Pop&lt;T&gt;(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> T Pop&lt;T&gt;(PoolManager&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, UnityPoolObject&gt;.Compare&lt;T&gt; comparer) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : UnityPoolObject { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> poolManager.Pop&lt;T&gt;(comparer); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> T Pop&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> groupKey) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : UnityPoolObject { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> poolManager.Pop&lt;T&gt;(groupKey); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Contains</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> groupKey</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> poolManager.Contains(groupKey); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clear</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { poolManager.Clear(); } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> T CreateObject&lt;T&gt;(T prefab, Vector3 position, Quaternion rotation) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : UnityPoolObject { GameObject go = Instantiate(prefab.gameObject, position, rotation) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> GameObject; T result = go.GetComponent&lt;T&gt;(); result.name = prefab.name; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } }</code> </pre><br>  In fact, this is just a wrapper over the first pool and Singelton.  It could be wrapped differently.  But it would turn out something like UnityPoolManager.Instance.Pool.Pop (), and additionally create only a couple of methods specifically for the unit.  But it is at the discretion of the reader.  The code will be less but an additional Pool will appear. <br><br>  PopOrCreate () - we need this method for creating objects. <br>  Push () - at the pool of objects themselves or Push in the manager. <br><br>  Now we need the GameObject itself. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">UnityPoolObject</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span>, <span class="hljs-title"><span class="hljs-title">IPoolObject</span></span>&lt;<span class="hljs-title"><span class="hljs-title">string</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Group { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> {<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> name;} } <span class="hljs-comment"><span class="hljs-comment">//    public Transform MyTransform { get { return myTransform; } } protected Transform myTransform; protected virtual void Awake() { myTransform = transform; } public virtual void SetTransform(Vector3 position, Quaternion rotation) { myTransform.position = position; myTransform.rotation = rotation; } public virtual void Create() //    { gameObject.SetActive(true); } public virtual void OnPush() //    { gameObject.SetActive(false); } public virtual void Push() //   { UnityPoolManager.Instance.Push(Group, this); } public void FailedPush() //      { Debug.Log("FailedPush"); // !!! Destroy(gameObject); } }</span></span></code> </pre><br>  All objects will inherit from it, and it is possible to override the Create and OnPush methods. <br><br>  We now turn to use.  On the example of the bullet traces and UI List item. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Bullet</span></span> : <span class="hljs-title"><span class="hljs-title">UnityPoolObject</span></span> <span class="hljs-comment"><span class="hljs-comment">//   ,    { ... } //  Bullet bullet = UnityPoolManager.Instance.PopOrCreate&lt;Bullet&gt;(bulletPrefab, bulletPoint.position, Quaternion.identity); bullet.Execute(sender, bulletPoint.position, CalculateTarget(target, accuracy01), damage, blockTime, range, bulletSpeed); ... // ,     //   -    timer-= Time.deltaTime; if (timer&lt; 0) { Push(); }</span></span></code> </pre><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">StepObject</span></span> : <span class="hljs-title"><span class="hljs-title">UnityPoolObject</span></span> <span class="hljs-comment"><span class="hljs-comment">//  { ... } ///         StepObject stepObject = UnityPoolManager.Instance.PopOrCreate&lt;StepObject&gt;(prefab, sender.position, sender.rotation); FXManager.Instance.InitDecal(null, stepObject.gameObject, hit, direction); stepObject.MyTransform.rotation *= rotation; StartCoroutine(ApplyDecalC(stepObject)); ///   protected virtual IEnumerator ApplyDecalC(StepObject decalObject) { yield return new WaitForSeconds(waitTime); //  -  yield return StartCoroutine(FXManager.Instance.HideOjectC(decalObject.gameObject, hideTime)); //    decalObject.Push(); //   ,    }</span></span></code> </pre><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ProfileListItem</span></span> : <span class="hljs-title"><span class="hljs-title">UnityPoolObject</span></span> { ... } <span class="hljs-comment"><span class="hljs-comment">//   -  ProfileListItem profileItem = UnityPoolManager.Instance.PopOrCreate(prefab); ... //   profileItem.profileId = profileId; list.AddItem(profileItem); //    //  ,   .      Push foreach(ProfileListItem item in list) { item.Push(); }</span></span></code> </pre><br><br>  I hope this example will help you in writing your projects on Unity3d.  Special thanks to @ lexxpavlov who suggested that you need to describe in more detail than just the interface. </div><p>Source: <a href="https://habr.com/ru/post/255499/">https://habr.com/ru/post/255499/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../255485/index.html">Drawing an ellipse at an arbitrary canvas angle on javascript</a></li>
<li><a href="../255487/index.html">Resource Management with Explicit Template Specializations</a></li>
<li><a href="../255489/index.html">Automatic resize of icons for mobile applications, or how Inkscape + bash make life easier</a></li>
<li><a href="../255493/index.html">Codex and TechExpert in all iPads of the country</a></li>
<li><a href="../255497/index.html">Google has opened a new data center priced at $ 600 million</a></li>
<li><a href="../255501/index.html">Stories about the developers: Russian Brainy Studio, the winner of the Imagine Cup</a></li>
<li><a href="../255505/index.html">Weekly assembly Vivaldi 1.0.151.7</a></li>
<li><a href="../255507/index.html">Project Maelstrom went public beta</a></li>
<li><a href="../255509/index.html">The French TV channel was hacked after an interview with an employee on the background of stickers with passwords.</a></li>
<li><a href="../255511/index.html">Pure CSS3 Calculator</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>