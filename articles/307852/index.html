<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Why does Sberbank have an incorrect SPF record for a domain?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In short: Sberbank's main domain (sberbank.ru) has an incorrect SPF record. This leads to the fact that attackers have the opportunity to make fake em...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Why does Sberbank have an incorrect SPF record for a domain?</h1><div class="post__text post__text-html js-mediator-article">  <b>In short:</b> Sberbank's main domain (sberbank.ru) has an incorrect SPF record.  This leads to the fact that attackers have the opportunity to make fake emails on behalf of Sberbank.  The record itself is well-adjusted, fit, but with an error that nullifies all efforts. <br><br><pre><code class="bash hljs">&gt; host -t txt sberbank.ru sberbank.ru descriptive text <span class="hljs-string"><span class="hljs-string">"v=spf1 mx mx:shark11.sberbank.ru mx:shark12.sberbank.ru mx:shark13.sberbank.ru mx:shark14.sberbank.ru mx:email1.sberbank.ru -all"</span></span></code> </pre> <br>  <b>Happy finale:</b> during the day they fixed the record, now it is RFC compliant. <br><br><pre> <code class="bash hljs">&gt; host -t txt sberbank.ru sberbank.ru descriptive text <span class="hljs-string"><span class="hljs-string">"v=spf1 mx -all"</span></span></code> </pre><br>  Well, and for those who will master to read - welcome under kat. <br><a name="habracut"></a><br><h3>  Why do you need SPF? </h3><br>  SPF helps to deal with the fake sender addresses.  Do not confuse SPF with DMARC, SPF only allows you to determine whether a given IP address could send mail on behalf of that domain (with support for a number of exceptions and curtsies). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      There is an opinion that SPF is <a href="http://david.woodhou.se/why-not-spf.html">not needed and harmful</a> , however, as practice shows, SPF today is the main mechanism in DMARC and there is nothing like this on the horizon. <br><br><h3>  How it works? </h3><br>  The mail server, accepting mail, looks at the sender's address, and then goes and requests special records from the sender's domain, where it is formulated in a cunning language, which IP can send mail from this domain, and which is not.  As a result, a decision is made whether to accept this letter or not, and maybe to accept and count as spam. <br><br><h3>  And what really works? </h3><br>  Well, in general, not really.  Initially, a record type was provided in SPF that allows Softfail to be made.  It is like a joint, but excusable.  That is, I say that mail from my domain can come from these addresses, then it is exactly normal.  And if with some others, then this is forgivable. <br><br>  This excusable posting in general today practically nullifies the sense of SPF, since spammers often get into this excuse post. <br><br><h3>  What Sberbank fellow? </h3><br>  And in that their entry contains -all, this is precisely the avoidance of the apologetic Softfail.  That is, the guys from Sberbank as if tell us that the mail from them can only come from the specified addresses and nothing else.  Well done, that's great. <br><br><h3>  And what is Sberbank wrong? </h3><br>  And the fact that the record they have formulated incorrectly.  This causes a Permerror error, and then for most mail systems, the entry is not even checked, and the letter is simply skipped. <br><br>  Agree, stupid to do -all, hard record and at the same time to make a mistake, making the whole record incorrect. <br><br><h3>  But where is the mistake? </h3><br>  RFC 7208 introduces some restrictions on the number of DNS queries that the mail server must make in order to receive the necessary data in the SPF.  It is the same RFC limits the number of queries with an empty result or error. <br><br>  Parse the record: <br><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"v=spf1 mx mx:shark11.sberbank.ru mx:shark12.sberbank.ru mx:shark13.sberbank.ru mx:shark14.sberbank.ru mx:email1.sberbank.ru -all"</span></span></code> </pre> <br>  <strong>0.</strong> v = spf1 <br><br>  The version of the SPF record, i.e.  syntax <br><br>  <strong>1.</strong> mx <br><br>  Only servers that are listed as MX can send mail from the sberbank.ru domain. <br><br><pre> <code class="bash hljs">&gt; host -t mx sberbank.ru sberbank.ru mail is handled by 50 shark11.sberbank.ru. sberbank.ru mail is handled by 50 shark14.sberbank.ru. sberbank.ru mail is handled by 50 email1.sberbank.ru. sberbank.ru mail is handled by 50 shark12.sberbank.ru. sberbank.ru mail is handled by 50 shark13.sberbank.ru.</code> </pre> <br>  Well, we see these five servers. <br><br>  <strong>2.</strong> mx: shark11.sberbank.ru <br><br>  Mail from the sberbank.ru domain can be sent by those servers listed as MX for the shark11.sberbank.ru domain <br><br>  STOP!  Again. <br><br>  Mail from the sberbank.ru domain can be sent by those servers listed as MX for the shark11.sberbank.ru domain <br><br><pre> <code class="bash hljs">&gt; host -t mx shark11.sberbank.ru shark11.sberbank.ru has no MX record</code> </pre> <br>  And this result is counted as empty.  And according to the RFC, after the first two such errors, you should stop analyzing the SPF record and consider it erroneous.  What is happening. <br><br>  In short, the guys overdid it a bit. <br><br><h3>  How was it to be done? </h3><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"v=spf1 mx -all"</span></span></code> </pre> <br><br><h3>  Or maybe colleagues have done better? </h3><br>  In fact, Sberbank itself rarely sends letters, or rather, in our postal system, for example, there are not so many of them.  Much more of them come from the site "Sberbank AST", let's see there. <br><br><pre> <code class="bash hljs">&gt; host -t txt sberbank-ast.ru sberbank-ast.ru descriptive text <span class="hljs-string"><span class="hljs-string">"v=spf1 mx a:mail2.sberbank-ast.ru a:mail3.sberbank-ast.ru a:mail4.sberbank-ast.ru a:gw.sberbank-ast.ru a:mail7.sberbank-ast.ru ~all"</span></span></code> </pre> <br>  And then, alas, Softfail.  Which nullifies the value of SPF records. <br><br>  <b>UPDATE</b> <br>  Colleagues from Sberbank AST responded quickly.  Now like this: <br><br><pre> <code class="bash hljs">&gt; host -t txt sberbank-ast.ru <span class="hljs-string"><span class="hljs-string">"v=spf1 mx a:mail2.sberbank-ast.ru a:mail3.sberbank-ast.ru a:mail4.sberbank-ast.ru a:gw.sberbank-ast.ru a:mail7.sberbank-ast.ru -all"</span></span></code> </pre> <br>  In fact, of course, somewhat redundant, since there is an indication of mx and <br><br><pre> <code class="bash hljs">&gt; host -t mx sberbank-ast.ru sberbank-ast.ru descriptive text sberbank-ast.ru mail is handled by 5 mail4.sberbank-ast.ru.</code> </pre> <br>  But switching from ~ all to-all is commendable. </div><p>Source: <a href="https://habr.com/ru/post/307852/">https://habr.com/ru/post/307852/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../307840/index.html">Using gpio-generic and irq_chip_generic for gpio driver</a></li>
<li><a href="../307842/index.html">The art of forecasting in the SAP F & R system for inventory management</a></li>
<li><a href="../307844/index.html">Requirements collection methods or ‚ÄúHow to understand what the customer wants?‚Äù</a></li>
<li><a href="../307848/index.html">Python dependency management: it looks like you can already use it</a></li>
<li><a href="../307850/index.html">Corporate laboratories - an actual training program for information security specialists</a></li>
<li><a href="../307854/index.html">‚ÄúThink Financial Models‚Äù: Who are the quanta and how to become them</a></li>
<li><a href="../307856/index.html">Launch Node.js on JVM</a></li>
<li><a href="../307858/index.html">An example of autocomplete implementation using PostgreSQL tsearch2 FTS engine</a></li>
<li><a href="../307860/index.html">Testing under the SCRUM. Thorns, rakes and successes</a></li>
<li><a href="../307862/index.html">Hardware acceleration of corporate computing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>