<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>50 shades of stub *. Microcontrollers in switching power supplies</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="DEC * - Peripheral Independent of the Core in Microchip microcontrollers, also known as CIP - Core Independent Peripheral. 
 Previous articles about P...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>50 shades of stub *. Microcontrollers in switching power supplies</h1><div class="post__text post__text-html js-mediator-article"><p>  DEC * - Peripheral Independent of the Core in Microchip microcontrollers, also known as CIP - Core Independent Peripheral. </p><br><div class="spoiler">  <b class="spoiler_title">Previous articles about Peripherals Independent of the Core</b> <div class="spoiler_text"><p>  <a href="https://geektimes.ru/post/285896/">Hardware reception of PWM-coded signals by Microchip microcontrollers</a> <br>  <a href="https://geektimes.ru/post/280224/">ADC and ADC with the Microchip microcontroller computer</a> <br>  <a href="https://geektimes.ru/post/279374/">Microchip Microcontroller I / O Ports</a> <br>  <a href="https://geektimes.ru/post/278718/">Configurable logic cells in PIC microcontrollers</a> </p></div></div><br><h1>  Microcontrollers in switching power supplies <br>  Part 1 </h1><br><img src="https://habrastorage.org/web/ed0/2e4/39b/ed02e439b0824ee18131ff640ab388bb.png"><br><p>  Looking ahead, I would like to note that the purpose of this article is not to discuss the advantages or disadvantages of control methods, as well as recommendations for choosing optimal topologies for building Pulsed Power Sources (IIPS) and calculating circuit elements - there are tons of specialized literature for this. </p><br><p>  The purpose of the article is to show the fundamental possibility of implementing most topologies of SMPS on the universal periphery of Microchip microcontrollers, to demonstrate the advantages of microcontroller solutions in flexibility and versatility regarding specialized ‚Äúanalog‚Äù PWM controllers and ASIC for SMPS. </p><a name="habracut"></a><br><p>  Below, we will consider solutions based on microcontrollers, but such solutions cannot be called ‚Äúdigital‚Äù sources, since the feedback loop is still closed via analog blocks and the PWM signal parameters are generated by the hardware feedback loop, and are not calculated by the processor core.  For fully digital solutions, Microchip produces specialized 16-bit digital signal controllers (of the dsPIC33 GS-series series) [1]. </p><br><h2>  What is the IIP made of? </h2><br><p>  The heart of a switching power supply is a PWM controller.  The block diagram of one of the variants of the specialized PWM controller is shown in Figure 1. </p><br><img src="https://habrastorage.org/web/247/c7c/e31/247c7ce313974e2488804c860a9d6c33.png"><br><p>  Fig.1.  The structure of a specialized power supply driver chip. </p><br><p>  The main element of the circuit is the SR flip-flop, which controls the output stage of switching on the power switch. </p><br><p>  The trigger is triggered by clock signals (input S, Set).  The reset (input R, Reset) is controlled by the signals of the comparator C1, the reference signal for which is generated by the operational amplifier of the error signal A1.  The trigger output controls the output keys, the control of which can be blocked by overvoltage signals (comparator C2), blanking, etc. </p><br><p>  If it is necessary to control this or similar circuit from the outside (changing and measuring parameters, soft start, etc.), external control solutions, such as a microcontroller or control logic, must be used. </p><br><p>  So, to build a managed intelligent power source, we need to have a PWM controller chip and a microcontroller, or we can combine it ‚Äî on the basis of a microcontroller, to make a PWM controller for an energy converter. </p><br><h2>  SPS Topologies </h2><br><p>  Topology is the connection of inductance, capacitor, switching circuit elements to ensure energy conversion, the ratio of input and output parameters. </p><br><table><thead><tr><th>  scheme </th><th>  description </th></tr></thead><tbody><tr><td><img src="https://habrastorage.org/files/c91/27e/d47/c9127ed470d746dcb35cc17eb26735ed.png" width="300"></td><td>  boosting </td></tr><tr><td><img src="https://habrastorage.org/files/b27/fb2/8de/b27fb28dee9545cb8709a6809d764f9a.png" width="300"></td><td>  downward </td></tr><tr><td><img src="https://habrastorage.org/files/f2b/6d8/c2c/f2b6d8c2c9e84beaa8cc6f05feec7a21.png" width="300"></td><td>  Sepic </td></tr></tbody></table><br><p>  Fig.  2 Basic topologies of SMPS. </p><br><p>  The principle of control of the power key in the most commonly used topologies of the SMPS is in general the same (see Figure 2).  The duty ratio of the opening of the power switch  the relationship between the "open" and "closed" states.  The duty cycle is controlled either depending on the output voltage (voltage control, voltage-mode control), or depending on the current in the power inductance (current control, current-mode control). </p><br><p>  In each of the two modes, control can be hysteresis (Hysteretic Control) or proportional (Proportional Control).  In hysteresis control, the pulse duty cycle is fixed, and the output voltage is adjusted by turning on or off the supply of control pulses of the power switch. </p><br><p>  With proportional control, the duty cycle varies in proportion to the magnitude of the mismatch between the actual output voltage and the required one. </p><br><p>  For the widespread topologies of SMPs, industry produces specialized PWM controllers.  But what to do if there is no ready PWM controller for the desired topology?  In this case, a microcontroller with configurable peripherals can also come to the rescue. </p><br><h2>  Microcontrollers with PNY </h2><br><p>  Consider the composition of the periphery of Microchip 8-bit microcontrollers designed for building energy converters. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/web/7a2/bd0/aa8/7a2bd0aa8dee4ef2a270b394a7f4fe56.png" width="300"></div><br><p>  Fig.  3. Peripherals of PIC16F1769 Series Controllers <br>  The PIC16F176x series controllers (see Fig.3) have a set of peripheral modules sufficient for implementing multi-channel PWM controllers of a switching power supply: </p><br><ul><li>  fast comparators; </li><li>  operational amplifiers; </li><li>  complementary signal generator (COG); </li><li>  programmable sawtooth driver (PRG); </li><li>  voltage reference; </li><li>  DAC; </li><li>  ADC; </li><li>  zero crossing detector (ZCD); </li><li>  timers with reset and limit function, PWM; </li><li>  signal modulator; </li><li>  Configurable Logic Cells (CLC); </li><li>  temperature sensor. </li></ul><br><p>  Peripheral modules can be connected inside the microcontroller to perform certain functions.  For example, Figure 4 illustrates the configuration of the periphery to perform the function of an energy converter.  Moreover, such configured interconnections of peripheral modules do not require the intervention of the kernel during the operation of the device. </p><br><img src="https://habrastorage.org/web/ed0/2e4/39b/ed02e439b0824ee18131ff640ab388bb.png"><br><p>  Fig.  4. Boost LED power converter with current stabilization and dimming. </p><br><p>  Thus, on one chip / microcontroller we can implement the core of the switching power supply and the control logic (program), thus we can eliminate the specialized driver of the power converter from the circuit. <br>  Let us consider in more detail the different modes of operation of PWM controllers and the possibility of their implementation on the periphery of Microchip microcontrollers. </p><br><h2>  Voltage Control (Voltage Mode) </h2><br><p>  In this mode, the duty cycle of the PWM signal that controls the power switches is determined directly by the output voltage. </p><br><p>  With hysteresis control, if the voltage at the output is below the norm, the source is ‚Äúpumped‚Äù.  If the output voltage is greater than the threshold, the comparator blocks the control of the power switch, and the output storage capacity is discharged.  In English-language literature, this mode is called ‚Äúhiccup-mode‚Äù - ‚Äúmode with hiccups‚Äù. </p><br><p> This mode is used relatively rarely, as it is accompanied by large ripple output voltage and requires a storage capacitor of relatively high capacity. <br>  Figure 5 demonstrates the principle of operation of the hysteresis controlled voltage mode.  Hereinafter, the output part of the source is not shown, since it is determined by the topology, output power, etc. To illustrate how the PWM controller works, an example with the output part will sometimes be shown. </p><br><img src="https://habrastorage.org/web/447/e93/46c/447e9346c7b943158e229edccb0ccf75.png"><br><p>  Fig.  5a.  The first scheme - with a fixed output voltage, the second - with adjustable output voltage. </p><br><img src="https://habrastorage.org/web/28c/1ac/729/28c1ac729847402b98958c0ffcf18a53.png"><br><p>  Fig.  5 B.  Diagrams of PWM output and comparator output. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/web/e83/1ee/529/e831ee529d3042a3b4ab71c7ca033fe5.png" width="300"></div><br><p>  Fig.  6. An example of an output stage of a step-up switching power supply connected to a PWM controller (see figure 5). </p><br><p>  Configurable logical cells (CLC) in Fig. 5 can be enabled as an element I. To prevent high-frequency generation from the comparator, it is advisable to pass its output through another CLC, the D-trigger with synchronization from the PWM signal.  In this case, we get two ‚Äúbonuses‚Äù - the absence of high-frequency generation and the constant duty cycle of the PWM controller (see the explanations in Fig. 7).  For more information about configurable logic cells, see the article "Configurable logic cells in PIC microcontrollers" [2]. </p><br><img src="https://habrastorage.org/web/20c/78f/511/20c78f511c1c40a187941c1382a5989e.png"><br><p>  Fig.7.a.  Shortening control PWM pulses, the possibility of high-frequency generation </p><br><img src="https://habrastorage.org/web/f0d/9e6/cf0/f0d9e6cf073e43e29d70a5e5427ac36e.png"><br><p>  Fig.  7.b.  Synchronization of signals helps to prevent the shortening of PWM pulses </p><br><img src="https://habrastorage.org/web/ef8/3e3/f5c/ef83e3f5cde5438cbd7aefb0aba032c3.png"><br><p>  Fig.  8. Synchronization of signals to prevent the generation and shortening of PWM. </p><br><h2>  Voltage control with proportional control </h2><br><p>  For voltage control with proportional control, the output voltage mismatch should correct for the duty cycle of the control pulses.  The proportion between the magnitude of the mismatch and the magnitude of the correction of the duty ratio provides an error amplifier and filter control loop.  The proportional control voltage control is used relatively rarely, since with this control method the inductance may saturate when the source is started and during a short circuit at the output, a second-order loop filter is required and there is an effect of the input voltage on the gain of the error amplifier. </p><br><p>  Voltage control with proportional control can be implemented on the built-in peripherals of PIC controllers using a PWM modulator ‚Äî a saw generator is necessary (Ramp generator) and a comparator (we already considered the implementation of PWM modulators in [2]).  The reference PWM generated by the microcontroller is used to form a sawtooth voltage and determines the frequency of the control pulses, and the feedback voltage determines the duty cycle of the control pulses. </p><br><p>  To prevent inductance from saturation when starting the source or in case of a short circuit at the output, it is necessary to limit the duty cycle of the control signal.  To do this, we output the comparator output signal (CMP1_out) to the CLC (I element), and to the other input - the reference PWM of saw formation (PWM signal, Fig. 10).  The pulse width of the PWM will serve as a limiter for the duty ratio of the DRV control signal (limit the signal from the comparator output). </p><br><img src="https://habrastorage.org/web/8ce/8b2/75a/8ce8b275a0c34042af9fe7fcb7fc7ee0.png"><br><p>  Fig.9 PWM controller SMPS in the voltage control mode with proportional control. </p><br><img src="https://habrastorage.org/web/8d5/6f1/20f/8d56f120f7e9402baac89f49862c994d.png"><br><p>  Fig.10.  Work diagrams of the PWM controller with voltage control </p><br><h2>  Current Control (Current Mode) </h2><br><p>  This method eliminates the drawback of the voltage control mode.  In this method, the controller receives a second feedback loop.  The internal fast loop serves to control the current of the power switch (inductance) at each cycle of its activation.  When a signal is applied to the opening of the power key, the current through the inductance, and hence through the power key, begins to grow linearly.  When the threshold is reached, the power switch opens, and the output of the inductance through the diode begins.  By time or by detecting zero current in the inductance (in continuous current or critical conductivity mode, CCrM) the cycle repeats. </p><br><p>  Since the power switch opens when a peak current is reached, the stored energy in the inductance is constant regardless of the input voltage (a change in the input voltage affects the charge rate).  The second loop of the regulation loop controls the output voltage. </p><br><p>  Current control with hysteresis control: similar to the voltage control method ‚Äî the PWM control of the power switch is performed on / off depending on the output voltage. </p><br><img src="https://habrastorage.org/web/a12/db5/611/a12db5611c9142dd89160f298f0b0718.png"><br><p>  Fig.11a.  PWM controller with current control with hysteresis control.  Isence - control of the peak current Is through the inductance, Vout - check the output voltage, blocking the control PWM when the output voltage is exceeded.  Option with a fixed output voltage and output voltage adjustment. </p><br><img src="https://habrastorage.org/web/a95/6f4/f27/a956f4f2720f4afb8ac69aa33ce86ba4.png"><br><p>  Fig.  11b.  PWM controller and output topology option for step-up converter with peak current control. </p><br><h2>  Proportional control current control </h2><br><p>  With this control method, the variable PWM duty cycle depends on the output voltage and the active feedback filter. </p><br><img src="https://habrastorage.org/web/056/ed9/8aa/056ed98aa02f43c9a18dfd4502db6547.png"><br><p>  Fig.  12. PWM controller with current control with proportional control.  Option with fixed and with adjustable output voltage. </p><br><p>  In this method, the instability of the reverse loop is observed when the duty cycle is higher than 50% (the appearance of lasing at the frequency ¬Ω Fswx depends on the noise at Vin or Vout).  This process is well studied and the problem is solved by reducing the gain in the feedback loop, which can be achieved in two ways (Fig. 13): </p><br><ul><li>  adding sawtooth to Isense; </li><li>  subtracting the sawtooth voltage from the loop filter output. </li></ul><br><img src="https://habrastorage.org/web/f93/424/f4f/f93424f4f867454b969bd93041e1bdcb.png"><br><p>  Fig.13.  Add a sawtooth voltage shaping module (PRG) to the PWM controller to eliminate the instability of the feedback loop.  Option with fixed and with adjustable output voltage. </p><br><p>  Microchip controllers for energy converters, as part of the CIP, have a programmable ramp generator (Programmable Ramp Generator, PRG or Slope Compensation). </p><br><p>  The PRG module allows you to generate a sawtooth voltage with independent adjustment of the front and fall, as a triggering signal can be used various internal and external signals. </p><br><h2>  To be continued... </h2><br><p>  Further: <br>  Synchronous converter <br>  Complementary signal generator <br>  Multiphase alternating (interleave) PWM control <br>  Automation of functions <br>  Controller program <br>  Debugging </p><br><ol><li>  Microchip web site: <a href="http://www.microchip.com/promo/dspic33-gs-digital-power">digital-power</a> </li><li>  <a href="https://geektimes.ru/post/278718/">Configurable logic cells in PIC microcontrollers</a> </li><li>  <a href="https://geektimes.ru/post/279374/">Microchip Microcontroller I / O Ports</a> </li></ol></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/370637/">https://habr.com/ru/post/370637/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../370625/index.html">Reflections on the air: a bitcoin investor skeptical look</a></li>
<li><a href="../370629/index.html">W3C finally approved the DRM standard for HTML5</a></li>
<li><a href="../370631/index.html">Peak population: who will colonize the solar system?</a></li>
<li><a href="../370633/index.html">Challenges, breakpoints, sets and wins - processing information at Wimbledon using IBM Watson</a></li>
<li><a href="../370635/index.html">LePlant Levitating Plant Pot: Details</a></li>
<li><a href="../370639/index.html">IBM and BMW - cars will be able to work with information in real time</a></li>
<li><a href="../370641/index.html">Ask Ethan: how small are the elementary particles?</a></li>
<li><a href="../370643/index.html">Free energy or how to make a nightlight on ionistors and solar battery</a></li>
<li><a href="../370645/index.html">Climate change makes it harder for planes to take off</a></li>
<li><a href="../370647/index.html">Moto Z2 Play Review: Long-Awaited Update</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>