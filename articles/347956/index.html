<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>An article about how we tried to apply modern neural network technologies to find helmets on people's heads</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Previously, we built all our intellectual modules on traditional video analysis algorithms (hereinafter, we will call them ‚Äúclassic‚Äù). We, of course, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>An article about how we tried to apply modern neural network technologies to find helmets on people's heads</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/t6/mj/p3/t6mjp3uzko8kfh7f3cnsnsh7fyc.png"><br><br>  Previously, we built all our intellectual modules on traditional video analysis algorithms (hereinafter, we will call them ‚Äúclassic‚Äù).  We, of course, knew about neural networks, and tried to use them back in 2008. In particular, we could compare the images of people by clusters.  But the results were not outstanding (including due to the low level of development of neural networks).  And we became adherents of the ‚Äúclassics‚Äù of machine vision for many years.  And all the neural networks were in our heads :) <a name="habracut"></a><br><br>  With the advent of convolutional neural networks, there is also a hope that they will be able to show themselves well in solving video analysis tasks: first, to give higher accuracy under the same conditions in which we used the previous algorithms, and second, to expand the range of these very working conditions. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      On top of that, this development method seemed much more reliable - it immediately allows you to conclude "go or not go": when you start working with the "classical" algorithm, you don‚Äôt immediately understand whether the path is right or not, you can solve the problem this way or not.  And it takes some (often significant) time to get to a result that can be assessed.  For example, we spent about a month messing around with a stereo headset for a camera to implement a new visitor count, but we didn‚Äôt get anything sensible with it ( <a href="https://habrahabr.ru/company/macroscop/blog/345048/">see the article ‚ÄúThe Birth of a Supernova: How New Functions Appear on the Example of 3D Visitor Count‚Äù</a> ).  And with neural networks, everything is clearer: from a small sample of several images, you can evaluate whether it will go or not.  If not, change the sample and check again.  Find the right data type and approach is much faster, and then you just need to improve the sample to get better results. <br><br>  When the task appeared to create a <a href="https://habrahabr.ru/company/macroscop/blog/346726/">helmet</a> -free detector (for details on how it appeared <a href="https://habrahabr.ru/company/macroscop/blog/346726/">in the article ‚ÄúCustdev in the development of video surveillance products‚Äù</a> ), we <b>did not</b> immediately <b>understand</b> how to solve it using traditional methods.  We decided to check whether it will be possible to do this with the use of neural networks.  And in general, are modern neural networks as good as they say? .. <br><br>  So, the work of the detector should be reduced to finding the human head and determining whether there is a helmet on it or not.  In the development process, we tried <b>to solve the problem in two ways</b> . <br><br>  In advance, the neural network does not know that it needs to distinguish two kinds of people precisely by the presence of a helmet.  All that she has is two sets of images (people with and without helmets), and she tries to find signs on them by which these two sets can be distinguished.  She knows which picture corresponds to which set, but does not know why, and seeks to choose her parameters so that she can give the correct answers as often as possible. <br><br>  <i>I way</i> <br><br>  First, we filed images on the neural network, in which people got into the frame in full growth.  We immediately had fears that we would not get enough accuracy, but if it worked, the development would be as fast and simple as possible. <br><br><img src="https://habrastorage.org/webt/cb/lx/ia/cblxia7n4fy3ipd-yqqguv5f1wc.jpeg"><br><br>  The fears were confirmed: in such pictures, the neural network could not really learn - the accuracy of finding the helmets on the new test suite was about 70%.  It was completely unacceptable for the operation of the module, but at the same time, it proved that it is possible to solve the problem using neural networks! <br><br>  In general, the accuracy of the helmet detector is made up of sensitivity (responsible for ‚Äúcatching‚Äù people without helmets) and the percentage of false positives (responsible for mistaken ‚Äúcatching‚Äù people with helmets).  In a real enterprise, where the detector will be used, people in most cases wear helmets, so even a small percentage of false positives will turn into a large amount of incorrect data in the output. <br><br>  Accuracy was taken as the initial benchmark: at least 60% of sensitivity and no more than 3% of false positives.  And in fact, these were serious demands. <br><br>  Teaching on the images of people in full growth such accuracy was not achieved.  Perhaps it was the fact that on such pictures besides the human head in a helmet or without a helmet, there are many other elements that the neural network is ‚Äúdistracted‚Äù, taking for essential signs something that in fact is not. <br><br>  <i>II method</i> <br><br>  We decided that we can help the neural network if we show not the whole person in full growth, but only his head (with or without a helmet).  To highlight the image of the head, we applied the appropriate classifier, which we had long written for one of the modules, and trained new convolutional neural networks using the results of its work. <br><br><img src="https://habrastorage.org/webt/qv/xu/oy/qvxuoyqkwybjdxmv1qc9cdaygoo.jpeg"><br>  By the way, practice has shown that it is not so important how many layers and neurons there are in a neural network, and in general its parameters are not so important.  The main thing is the quality of the training sample.  On a large and diverse sample, there is a good chance of success; on a small sample, a neural network will simply remember the correct answers, but will not acquire the ability to generalize and will not be able to give the correct answers on new pictures for it. <br><br>  Our sample was medium in size (several thousand pictures of heads in helmets and without helmets), it included helmets of different colors and slightly different in shape.  To improve the results and avoid retraining, we had to seriously engage in augmentation techniques (artificially expanding the training set) and regularization (limiting the parameters of the neural network).  As a result, on the test sample, the accuracy reached 85-88%.  This is a good indicator, but in order to reduce errors, we did the post-processing: the decision that a person without a helmet needs to output an ‚Äúalarm‚Äù is not taken on one frame, but on the results of the analysis of each individual on several frames in a row. <br><br>  In the course of testing, we also were not very satisfied with the work of the head detector, so we made a refinement of the heads found in the image ... also using the neural network.  In fact, in one and in the other case, it is not one network, but several, combined in a cascade for greater accuracy (but here we will call them simply neural networks). <br><br>  For our neural network, we took the classical convolutional architecture, which has worked well in classification problems.  But they tried different architectures, including the most modern and sophisticated ones - out of a hundred layers with hundreds of millions of parameters.  In principle, with the complication of the neural network, the result has not improved.  In our experience, we confirmed that the Vapnik-Chervonenkis theorem works: the complexity of the classifier must correspond to the complexity of the problem.  If the classifier is too complex, it will just remember all the answers and will not work.  If it is too simple, it will not be able to learn. <br><br>  We had a fairly simple neural network to solve the relatively simple task of detecting helmets. <br><br>  The second method was the most effective.  In the end, we solved the problem and <br><br>  1) for 2.5 months, we developed a <b>working module</b> that went to the first objects for test use.  According to our estimates, the development of classical methods would take us no less than six months. <br><br>  2) in the absence of helmets we use 2 sets of neural networks trained on different data.  The first one finds the heads of people in the frame, and the second one determines whether this head is in a helmet or not. <br><br>  3) reached the stated accuracy threshold - more than 60% of sensitivity for 1.5% of false positives. <br><br>  <b>Conclusion: it is possible and even necessary to use neural networks for solving video analysis tasks, in particular, detecting the absence of a helmet on a person.</b> <br><br>  The first successful experience poses a legitimate question: are we now <b>developing all video analysis modules using neural networks?</b>  And while the answer to it is definitely difficult. <br>  There are modules in translation which we now see no point on the neural network.  Because there so everything is well solved by classical methods.  For example, counting visitors (especially in the new 3D implementation).  Now on the classical methods of machine vision, it works very well and reaches an accuracy of 98%.  And if we applied neural networks, it is not yet known whether they would work this way or not.  But for the detection of smoke and fire neural networks are exactly suitable. <br><br>  If we deduce the criterion of applicability of neural networks in video analysis, it can be formulated in some way: if it is clear in advance how to use what signs, then you can get by with the ‚Äúclassics‚Äù, otherwise you can try neural networks. <br><br>  There is a good sign in 3D counting - this is the distance to the point.  Or in the detector of left objects, for example, it is also easy to find it - a special point on the border of the object, which you can follow and compare it, or contour.  But in the fire it is not clear what kind of signs to take.  Colour?  - there is always something the same color as the fire.  The form?  - fire can be of various forms.  Flicker in time?  - but it is not clear exactly what it should be.  Coming up with signs in advance here is a bad job, so it's better that the neural network does it. <br><br>  But back to our task. <br><br>  So she solved.  The answer and the corresponding conclusions were obtained: <br><br><img src="https://habrastorage.org/webt/nm/zi/xu/nmzixuwk4cbocelg6gahdggsyai.png"></div><p>Source: <a href="https://habr.com/ru/post/347956/">https://habr.com/ru/post/347956/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../347942/index.html">HR analytics with R</a></li>
<li><a href="../347946/index.html">Vivaldi 1.14 - longitudinally transverse version</a></li>
<li><a href="../347948/index.html">Game Designer. Who is it?</a></li>
<li><a href="../347952/index.html">How to create a truly random and provably secure password</a></li>
<li><a href="../347954/index.html">How we developed the technology to detect devices nearby</a></li>
<li><a href="../347958/index.html">The story of how not to let me steal credit card numbers and passwords from visitors to your sites</a></li>
<li><a href="../347960/index.html">I am a developer from 9 to 17 (and you can become one)</a></li>
<li><a href="../347962/index.html">Partial wow effects: magic with simple words</a></li>
<li><a href="../347964/index.html">How does blocking access to pages that distribute prohibited content (now the RKN also checks the search engines)</a></li>
<li><a href="../347966/index.html">How we set up a search using Elasticsearch and Logstash using MSSQL data</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>