<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tarantool: how to handle 1.5 billion requests per day?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Report ‚Äú Tarantool: how to handle 1.5 billion requests per day? "- another in a series of transcripts from the Mail.Ru Technology Forum 2011 . For det...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tarantool: how to handle 1.5 billion requests per day?</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  <i>Report ‚Äú <a href="http://techforum.mail.ru/report/4">Tarantool: how to handle 1.5 billion requests per day?</a></i>  <i>"- another in a series of transcripts from <a href="http://techforum.mail.ru/">the Mail.Ru Technology Forum 2011</a> .</i>  <i>For details on how the report decryption system works, see the article <a href="http://habrahabr.ru/company/mailru/blog/132953/">‚ÄúReverse‚Äù of the Mail.Ru Technologies Forum: High-tech in event-management</a> .</i>  <i>There, as well as on the Forum website ( <a href="http://techforum.mail.ru/">http://techforum.mail.ru</a> ) - links to transcripts of other reports.</i> </blockquote><br><video>  http://video.mail.ru/corp/glavred/ftmailru/76.html </video><br>  <i>( <a href="">Download</a> video version for mobile devices - iOS / Android H.264 480 √ó 368, size 170 Mb, video bitrate 500 kbps, audio - 64 kbps)</i> <br>  <i>( <a href="">Download</a> video version of higher resolution H.264 624 √ó 480, size 610 Mb, video bitrate 1500 kbps, audio - 128 kbps)</i> <br>  <i>( <a href="http://www.slideshare.net/tfmailru/tarantool-15-10259428/download">Download</a> presentation slides, 520K)</i> <br><br>  It is difficult to present this speaker because everyone knows him.  Each of you, I am sure, use products to which Kostya had a hand.  This is, first of all, MySQL.  For many years Kostya has been developing this popular database, which is used, if not 100%, then 90% of Russian sites for sure.  Today Kostya works in the <a href="http://corp.mail.ru/">Mail.Ru Group company</a> .  Kostya today will tell us about what we have done, how it works and, most importantly, what kind of performance this will allow to get on your services. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0c2/f3b/78c/0c2f3b78c1bc842c8b7d58edbd25571c.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Good day.  You are very much today.  Thank you for coming!  I have already been introduced, so I would just like to add that I am still an engineer at heart and in the case.  Rather, I do not lead, but actively participate in the development of Tarantool, so if you are interested, today you have the opportunity to learn everything about him.  Anyway, this report, in addition to philosophizing on the topic of the future of the DBMS, about Tarantool. <a name="habracut"></a>  Therefore, I would like to understand the people who came here today, to understand why you did it. <br><br>  Who came to this report to try Tarantool, to learn more about it in this forum?  There are such people? <br><br>  This is great because, on the whole, <a href="http://tarantool.org/">Tarantool</a> is a system that is developed in Mail.Ru Group and is most actively used in our company, but has a much wider applicability.  This is an open-source system, which is well, in my opinion, documented, we have connectors to many programming languages ‚Äã‚Äã- Python, Ruby, Perl.  Recently, just two days ago, one of the community members wrote a new connector for Python.  Therefore, I hope that the result of our conversation today will be that you try Tarantool.  And, maybe, you will tell, why it sucks - it will be pleasant to me to hear also such response. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ceb/138/20a/ceb13820a881b73e56a8381405f711ff.png"><br><br>  What will I talk about?  Since the topic of the report is rather ambitious, I will talk about the place of Tarantool in the database ecosystem: why we now have so many different data storage solutions, why this number is adequate.  Then we go directly to the system, to the analysis of what it can do.  I will finish with a story about my plans, about the plans of the team, about what features we will add to the product, etc. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d75/5a1/f05/d755a1f0557505887c44ff93f18edaf5.png"><br><br>  There is such a picture, I literally half an hour dragged all these logos.  Who among you knows more than half of these logos?  Minority.  Those.  many of you know MySQL, maybe Memcached, maybe PostgreSQL.  That's all, actually. <br><br>  Today we heard a report on Hadoop and saw that in fact all these systems are very widely used and very popular.  And this is all open source system.  We see that the world of system software is increasingly moving toward open source.  The only non-open source system developed by former Yahoo programmers is Citrusleaf.  This is a fairly feature-rich commercial system. <br><br>  If we analyze this slide in terms of the characteristics of the data for which the systems mentioned are intended, we will find two dimensions.  The first dimension is the amount of data.  We see - Cassandra, Hadoop, Voldemort - these are systems that are designed to manage a huge amount of data.  On the other side of the picture we see systems that often work with not very large amounts of data, but they provide very high-performance access to this data.  The second dimension is the level of data structure.  And these are only two metrics by which we can compare these systems.  In fact, the dimensions of the NoSQL world are much larger.  Why did the NoSQL movement arise at all and why do we see this wealth?  In my opinion, there are 3 main unsolved problems in the world of traditional DBMS.  Problems can be found 10, 20, but the main and really poorly solved problems of relational databases are as follows: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c84/9b2/710/c849b2710bb193ff6cf4d63abb65c711.png"><br><br>  The first problem, the problem of horizontal scaling, is that secondary keys, complex queries, stored procedures are rather poorly scaled into a cluster of tens or hundreds of computers, i.e.  you cannot simply add nodes, like, say, in the previous report you heard that you can simply add new nodes to Hadoop.  In principle, the problem is solved.  There are enough scalable SQL systems, which, however, are very expensive - NonStop SQL, Teradata.  They are used, for example, in the banking sector.  That is, there are SQL systems that scale horizontally well, but so far these solutions are not open source. <br><br>  The second problem is relational DBMS: they are designed for the fact that you first define your data schema, and then you can write ad-hoc queries to the data.  Those.  you can write an arbitrary SELECT, an arbitrary JOIN, etc.  It often happens the other way around.  The data schema changes very dynamically, but the requests are more or less fixed - they change with the data schema, but that‚Äôs all. <br><br>  Well, ultimately, problem number 3 is performance.  It's like the price for gasoline, that is, if it was one 20 years ago and the engines were <nobr>4-6 liter,</nobr> now we are working out how to squeeze out much more horsepower or kilometers from the same liter of gasoline or liter of an internal combustion engine .  Traditional DBMSs look like old American cars - they are big, beautiful, with leather interior and high smoothness.  But the architecture of traditional DBMS was created in the calculation of other hardware, another use.  The speed of the hard drives, the speed of the memory, the ratio of the speeds of the CPU and CPU Cache to all this ... well, a lot has changed since System R.  And in data centers like the Mail.Ru Group, where there are tens of thousands of computers, this very factor - the energy efficiency of relational DBMS - becomes extremely important.  After all, when processing NoSQL requests, the entire overhead to parse SQL, search for an effective execution plan for the query, and ensure the consistency of multiple reads becomes unnecessary. <br><br>  And, despite the fact that the problems of traditional DBMS are generally understood, studied, and recognized by the community of scientists and practitioners, the world of NoSQL responded not just with new solutions to these problems, but with a fresh start, an explosion of ideas and often where to actually blow up do not need anything.  For example, in a field such as data models.  Those.  NoSQL world rejected the famous model of Edgar Codd and proposed paradigms such as, for example, Column Storage - column-oriented storage, Key-Value Storage, JSON and XML formats. <br><br><br>  Also, different data consistency models are reviewed and applied in practice.  Here we can recall the previously mentioned today CAP-theorem, which determines the ratio of consistency, data accessibility and the stability of a DBMS cluster to splitting, that is, dividing into unrelated segments.  As many try to interpret this theorem, an application programmer needs to choose two properties of the data model from three.  For example, we can choose the consistency of data on each node, and eventual consistency between the nodes, when eventually all the nodes will be consistent with each other. <br><br>  New data access languages ‚Äã‚Äãare also actively being offered, for example, but these are more likely examples from history, <a href="http://en.wikipedia.org/wiki/Object_Query_Language">Object Query Language</a> , XQL, NQL, etc. Ten years ago XML DBMS were very popular, but where are they now? <br><br>  And finally, we are witnessing a constant evolution of data storage algorithms, which is always very important, and the creation of a huge number of new scaling methods, such as consistent <a href="http://ru.wikipedia.org/wiki/%25D0%25A5%25D0%25B5%25D1%2588%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">hashing</a> , master <a href="http://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25B5%25D0%25BF%25D0%25BB%25D0%25B8%25D0%25BA%25D0%25B0%25D1%2586%25D0%25B8%25D1%258F_(%25D0%25B2%25D1%258B%25D1%2587%25D0%25B8%25D1%2581%25D0%25BB%25D0%25B8%25D1%2582%25D0%25B5%25D0%25BB%25D1%258C%25D0%25BD%25D0%25B0%25D1%258F_%25D1%2582%25D0%25B5%25D1%2585%25D0%25BD%25D0%25B8%25D0%25BA%25D0%25B0)">replication</a> , etc. <br><br>  What is the future of the DBMS world, what will the NoSQL movement lead to?  In my opinion, the world of storage solutions will expand, and application engineers will be forced to know that there are NoSQL storage, there are relational storage and there are distributed clusters like Hadoop.  Thus, from the variety of products in the future, three niches are formed, three basic solution clusters, one of which is relational DBMS, which, naturally, will remain for a long time. <br><br><br>  What will be the result of numerous experiments with data models?  Take, for example, the Redis paradigm, also known as data structures server, will this approach be spread?  In my opinion, data models will also be forced to stabilize around two principal approaches: an approach that implies the presence of model abstraction from presentation, and there is still no better abstraction than the relational model, and the data representation model itself. <br><br>  At this point I would like to complete the review of the world of modern DBMS.  The forecast is a thankless task, but in order to give an idea of ‚Äã‚Äãthe place of Tarantool in the world of NoSQL DBMS, I decided to give some general picture. <br><br>  Tarantool is a high-performance storage that stores all data in RAM.  Often at first you hear such an objection - ‚Äúbut this is very expensive.‚Äù  But, if you compare RAM with flash memory, then it turns out that RAM is cheaper than Flash. <br><br>  Tarantool is a persistent repository.  Data is stored in RAM, but all data changes are atomic, i.e.  everything in Tarantool is written to disk. <br><br>  Here I would like to digress a little and give an example from the past.  If we recall the history of MySQL, then it all started from the very beginning, because the MySQL user community did not need transactions, reliability and atomicity of data storage was not necessary.  MySQL <nobr>2000 is</nobr> remembered when only MyISAM was a stable storage system in MySQL, and Monty tried to convince users that transactions in many cases are not necessary. <br><br>  Based on the MySQL experience, I was convinced that transactions are required for any modern industrial storage system.  This is a fundamental parameter that determines the remaining parameters of the system architecture, and therefore Tarantool now supports atomic operations and at the moment we are developing full transaction support.  In the next version we will have it already. <br><br>  In the area of ‚Äã‚Äãthe data access language, the Tarantool solution is a SQL language, although there is support for other programming languages. <br><br><br>  However, it should be understood that in terms of the data model, Tarantool is a key-value storage, i.e.  our main data access scenario is to get the value by key.  Thus, not all SQL functionality is implemented. <br><br>  In addition to simple INSERT / UPDATE / SELECT / DELETE queries, we support Lua stored procedures that allow you to be very flexible in determining which data access scripts you have.  The presence of stored procedures allows you to turn Tarantool from a data server into a business logic server, since  it becomes possible to program an arbitrary data storage format, arbitrary data consistency invariants, arbitrary queries. <br><br>  Question from the audience: <br><br><blockquote>  <b>How is data persistence maintained?</b> </blockquote><br><br>  We use logging, i.e.  all records are logged to disk.  Now I will talk about this, but first about the data model. <br><br><br>  Our data model is not an invention.  I would describe it as a simplified relational model.  The basic element of storage is a tuple.  A tuple has any dimension; it‚Äôs just an arbitrarily long list of fields associated with a unique key.  Each tuple belongs to some space (space).  You can define indices by the fields of a tuple.  If we draw analogies with relational DBMS, then ‚Äúspace‚Äù corresponds to the table, and ‚Äúfields‚Äù correspond to columns.  We support two types of data ‚Äî integers and strings ‚Äî and two types of indices: hashes and binary trees. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1e1/dc4/bde/1e1dc4bde5195bd0cdd3789e7320b177.png"><br><br>  Indices can be both simple and compound, and any index can be used for searching.  However, in each space, a simple primary key must be specified, which should be accessed when it is inserted, updated, or deleted.  You can access by a composite secondary key, for example, by fields 3 and 5, or by fields 7, 9, 11. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/563/f84/e1e/563f84e1eef822bf316d9b782e74c497.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/cb0/dcf/058/cb0dcf0588f67a5ef82053baff3e6f37.png"><br><br>  Again, we are not any ideologists in the field of data access language - our client implements SQL access, and in the area of ‚Äã‚Äãconnectors from other programming languages ‚Äã‚Äãwe follow agreements from the world of traditional DBMS.  This is what PHP looks like: <br><img src="https://habrastorage.org/getpro/habr/post_images/4af/758/f34/4af758f34230a50ab0a3c7ada9351782.png"><br><br>  To get started, you need to establish a connection to the database.  To execute the query, it is necessary to determine which space of the tuples is addressed.  At this stage, all spaces and all objects in Tarantool are numbered, accessed by the object number.  There is an index number, a space number, and so on.  In the next slide, we see how after the connection is established, the tuple is inserted, then the tuple is accessed by the primary key, and the data is returned, in the case of PHP, as a simple array.  You can also update the tuple in the desired space using the key. <br><img src="https://habrastorage.org/getpro/habr/post_images/f5f/33e/3c5/f5f33e3c573b2c079a79544fc15d2a3c.png"><br><br>  In the case of sampling tuples, we select the key number for which the request is made ‚Äî either the primary key with the number 0, or other keys. <br><img src="https://habrastorage.org/getpro/habr/post_images/a98/b6e/f36/a98b6ef3698594bd9ac240516d1d0c2c.png"><br><br>  After giving a general overview of the functionality, I would like to move on to how we differ from other NoSQL systems with which you probably already worked. <br><br>  I'll start with the performance.  In general, since this is an in-memory data warehouse, the performance is initially substantially higher than that of traditional DBMS, such as, for example, MySQL.  We use asynchronous I / O and asynchronous support for multiple connections.  We easily hold 10,000 active compounds.  Our performance on one machine, despite the fact that we write all the changes to write ahead log, i.e.  log all changes to disk, up to 100,000 UPDATEs and INSERTs per second.  For read requests on this machine, we achieved a performance of 260,000 SELECTs per second.  These are not such super numbers: they are comparable to the performance of Memcache or Redis. <br><br><br><img src="https://habrastorage.org/getpro/habr/post_images/ab4/a2e/43b/ab4a2e43ba06d35d3f304c1c27dc9d20.png"><br><br><blockquote>  <b>And what is leytencie?</b>  <b>How much is the delay in response?</b> </blockquote><br><br>  The question is very good. <br><br>  The benchmark referenced by the slide was made in 10 threads and each thread sent 10 requests at a time.  The benchmark was built in such a way that the client side received multiple requests in a batch mode and sent answers in parallel.  As soon as the server sent the packet, the client read the packet.  Why did we choose such a performance measurement scheme?  Because we had only two machines at our disposal, whereas in order to load the Tarantool, we still need a cluster, a hundred or more machines.  With this approach to measuring performance, latency is, of course, higher than what can be observed on real workload.  In fact, the time it takes to execute a single query depends very much on whether it modifies data or not.  At SELECT, latency is minimal: the server simply reads data from memory by key and sends it to the client, there are no locks. <br><br>  Generally speaking, Tarantool is a lock-free system, access to all data, at the level of data structures and caches, is performed sequentially, while at the network level, of course, parallel processing of multiple connections is supported.  To implement this approach, we use the so-called coroutines, also known as "light" or "green" streams. <br><br><br>  If the request changes the data, then the changes must be recorded on the disk.  To implement packet writing, an algorithm is used that is often referred to as ‚Äúgroup commit‚Äù in serious DBMS, that is, simultaneous recording of several accumulated changes to disk.  The easiest way to imagine this is as a train connecting two stations - the frontend and the backend.  All requests that need to be recorded on the disk are accumulated on the ‚Äúapron‚Äù of the process responsible for working with the network (frontend).  Then all these requests are ‚Äúimmersed in the train,‚Äù that is, buffered and written to disk.  As soon as one group of requests is written to disk, the ‚Äútrain‚Äù returns after the next group of requests.  Thus, the delay in performing an INSERT / UPDATE / DELETE query depends on the moment at which you are on the platform.  The maximum on modern equipment is 0.01 seconds, the recording time of an arbitrary block on an arbitrary cylinder of a hard disk. <br><br><br><blockquote>  <b>What file system are you using?</b> </blockquote><br><br>  We use any file system.  If you are on this particular, for example, Linux, ZFS works - please.  In this case, we use the POSIX API for working with files.  The only non-POSIX call we use is the fallocate () call, which, in my opinion, is supported on JFS, XFS and EXT4. <br><br><br>  Why do we use fallocate ()?  This is due to the way the modern file system works.  It needs to be explained in more detail, let me do it later. <br><br><blockquote>  <b>A more specific question regarding clients is how we access simultaneously 1000 GETs of the same key from one place, from one client.</b>  <b>Can we somehow proxy this case?</b>  <b>Do not send 1000 requests to ...</b> </blockquote><br><br>  How does GET work and can it be proxied?  Tarantool has a client protocol.  For example, Memcache supports text and binary protocol.  We have done a similar way.  Mostly used is a binary protocol in which GET is one of the commands.  The command code takes 4 bytes in the packet header with the request, the entire header takes 12 bytes.  The second four bytes of the header contain the Request ID.  Request ID is a means for marking, unique identification of a specific request.  In response to a request, the server returns the request id transmitted to it.  This allows you to proxy requests is quite simple, and Mail.Ru Group is actively used.     ,   ,    Tarantool,   request-id          Tarantool'   . <br><br><blockquote> <b>    commit,     ?</b> </blockquote><br><br>  ,       .            .     group commit,         .     wal_fsync_delay ‚Äî 0.01 .              ,   Linux.       Tarantool,     MySQL.  , ,        NUMA-    MySQL,    .   ‚Äî        . ,  - Mail.Ru    wal_fsync_delay  0.01 ,      . <br><br><blockquote> <b>      Tarantool? <br></b> </blockquote><br><br>  Yes there is.      . <br><br><blockquote> <b> ,   Tarantool  MySQL?</b> </blockquote><br><br>    .    ,       Tarantool,    MySQL,    Mail.Ru Group,      .        MySQL,          . <br>       .        .     ,  GET,     ,    700    .             . ,         . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/973/a46/63d/973a4663d9cc33678a3a08c00e98e521.png"><br><br>  SET'    .  ,    (Intel Core I7,    7200   ),   300 000    700 000 . <br><br><br>   ,        .            1.5     1.4.    UPDATE's.         ,     UPDATE'.      . <br><br><br><img src="https://habrastorage.org/getpro/habr/post_images/095/99f/c94/09599fc948df0a84a6ce80676e110d7f.png"><br><br>  ,  ,   ,      .    Tarantool       Key-Value,       Trantool    ,      . <br><br><br>     auto-increment.  PHP,      NoSQL    Tarantool,  -    -.   UPDATE,   ,    ,         .  ,      .      -,    , ,   .         . <br><br><br><img src="https://habrastorage.org/getpro/habr/post_images/a04/06f/3c5/a0406f3c571fad1df3d354e5108c2187.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/a1e/412/525/a1e41252508989efe7dee964f0f447e3.png"><br><br>             Tarantool,      .        ,     ,        ‚Äî ..          space 0.  ,        .  ,      ‚Äî            ,        . <br><img src="https://habrastorage.org/getpro/habr/post_images/830/987/6fb/8309876fba99c27b18067f4c69ee1452.png"><br><br>     ,  ,  .  ,   Tarantool   . <br><br>          ¬´   =  tuple ()¬ª.  Because    ,         .         :  ‚Ññ 0 ‚Äî ,  ‚Ññ 1 ‚Äî  , ..   .    ‚Ññ 2     , ,        ,  ,    . ,             . ,        .    top  bottom,  UPDATE ,    box.update() ‚Äî   ,   callback  .  ,   UPDATE ,    ,  ,   printf().     , ,   =p=p=p,   '=' ()     1 'p' (  ) top, '=' ()     2 'p' (  ) bottom,  '=' ()     top    val. <br><br><br><img src="https://habrastorage.org/getpro/habr/post_images/661/111/8b6/6611118b6bd38b8b5eddec620f02dc1c.png"><br><br>     UPDATE,   , , ,      ,     .  ,       .     . <br><br><br><img src="https://habrastorage.org/getpro/habr/post_images/4a6/7b6/b30/4a67b6b308ef9b95a52eeb7ca075a753.png"><br><br>   ,                ,          Lua.  ,  Lua   .    Javascript‚Ä¶ <br><br><br>       . , LuaJIT ‚Äî    just-in-time compiler,     open source .       ‚Äî      .  Lua  ,  ,    ,   -     .  ,  GitHub       Tarantool,          . <br><br><br>  ,   ,   ,  - ‚Äî  ? <br><br><blockquote> <b> , -,  - .     ,      , 2   2  max+1.</b> </blockquote><br><br> ,   .    ,    .  Tarantool   .    ?          ,    ,     WAL. 1  Tarantool  1 .  ,    fiber',  coroutines      -  ,       -.           ,  ;       ,    ,    ,    multi-threaded ,      .    ?    nodes,  Tarantool.      <nobr>2-4 .</nobr> Tarantool ‚Äî  shared nothing MPI .       . <br><br>          ?     Mail.Ru Group. <br><br>       - ,    ,        .  ,     ,  , ,    .  Those.      ,                 .      ‚Äî      Memcache, Memcache-  Memcache expiry ‚Äî  ,         ,  ,   ,  Lua.         Mail.Ru.     4 ,      2  Tarantool'. 2    , 2     .       60  100   ,    Mail.Ru  . <br><br><br> ,  ,  ,    Tarantool   ,  Tarantool    ,       ,        ,    .  ,       . ,   ,      ,    .         -      ,     400 ,      .           ,         .  Tarantool      120    ,    ,        .     ,  2     ,     60    .    production ,        ,       .  ,       ,   20%. <br><br><blockquote> <b>     .      MongoDB.  Mongo  ,          .    ,    .   ,   ..</b> </blockquote><br><br>       Mongo ? Mongo ‚Äî  ,  c Write Ahead Log',    ? <br><br><blockquote> <b>,     .</b> </blockquote><br>   ,   Tarantool      .  Tarantool    snapshot',      .     ,       ,      .      copy-on-write,     Redis.          Write Ahead Log.   ,         Write Ahead Log'.      ,        0.01 . <br><br><blockquote> <b>    MySQL  ,   ,  ,  .    Tarantool ?</b> </blockquote><br><br>    .  Tarantool, ,   MSQL?  MSQL  ,     Write Ahead Log,   , .. MSQL        .  Tarantool  Write Ahead Log ‚Äî    .     :    Write Ahead Log     .  , ,     ,     .    Write Ahead Log    (log sequence number, LSN), ,    ,     ,           . <br><br><blockquote> <b>        ‚Äî ,  :</b> <b> </b> <b>   5,      8. ,     ,     , ,   .        ?</b> </blockquote><br><br> ,     .      ,     .     ,         . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/df2/3c1/bb7/df23c1bb74da39baef189d8018b83247.png"><br><br>  ,       ‚Äî  ,       . <br><br>     ,   6, 83, 1, 21, 8  ..    : ¬´   44 , 83       ¬ª.    ?       : ,   , friend-requests  ..       5.          .    30 friend-requests,        20, ..     20.      . <br><br>      Tarantool.       5     .  2  ,  ‚Äî  ¬´   ¬ª. Tarantool ,           .        , ,   ,            .   ,  SQL-    ?    . <br><br>       ‚Äî ¬´ ¬ª. ,     ,    ,  .      . <br><br>    ,        . <br><br>  notification_push()    .     ‚Äî user_id,      .            MySQL,             ,      MySQL,          . <br><br>      notification id        .         . <br>          GitHub. <br><br>      notification_push().        unread count,    UPDATE      .    . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c0b/78c/cde/c0b78ccdeff2f35985ddff869f215e59.png"><br><br>         .   , Tarantool ‚Äî , ,      .       ,        -,  ,  ,   ,      .             ,    ,         CAP-. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c50/ca5/32e/c50ca532e3600972fa341fb6b389c302.png"><br><br> Tarantool,   ,     Voldemort,  Riak,       ,      .     ,     100  ‚Äî  ,   Mail.Ru,    ,    4,  6 , ..    .     ,      . <br><br>  ,   ,      ,  , --,   .     :        .  Thank. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0eb/cf6/fa0/0ebcf6fa06925d6d534403c77565d5f1.png"><br><br><hr><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This text is a transcript of Osipov Konstantin's report at </font></font><a href="http://techforum.mail.ru/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the Mail.Ru 2011 Technology Forum</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , held on November 16 in the center of Infospace.</font></font></i>  <i>Details about the technology of creating texts of reports based on video recordings can be found here: <a href="http://habrahabr.ru/company/mailru/blog/132953/">‚ÄúWrong side‚Äù of the Mail.Ru Technologies Forum: High-tech in event-management</a> .</i>  <i>Video versions of other reports (including versions for mobile devices) are available on the Forum website - <a href="http://techforum.mail.ru/">techforum.mail.ru</a> .</i>  <i>Text versions of the reports will be published here and on the Forum website every week or less often in a similar format.</i>  <i>Please report in the "lichku" about typos in the text.</i> </div><p>Source: <a href="https://habr.com/ru/post/136288/">https://habr.com/ru/post/136288/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../136281/index.html">In the spring, MIT will launch a new online learning platform - MITx</a></li>
<li><a href="../136282/index.html">Packer for dsniff.db</a></li>
<li><a href="../136283/index.html">I don't know sy</a></li>
<li><a href="../136284/index.html">Coloring Tale</a></li>
<li><a href="../136285/index.html">Intel patents a new way to connect Wi-Fi devices to wireless networks</a></li>
<li><a href="../136289/index.html">Education in high school and beyond: a view from the department</a></li>
<li><a href="../136290/index.html">What is more important for a programmer?</a></li>
<li><a href="../136291/index.html">By lamers for lamers</a></li>
<li><a href="../136292/index.html">Compact gaming steering wheel Steelseries SRW-S1</a></li>
<li><a href="../136294/index.html">Prototype Lane Departure Warning or how to remind the driver that he did not have a very long time to live</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>