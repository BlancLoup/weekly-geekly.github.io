<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Asterisk: PVS-Studio is interested in telephony</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Asterisk is a free open source computer telephony solution from Digium. The application runs on operating systems such as Linux, FreeBSD, OpenBSD, Sol...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Asterisk: PVS-Studio is interested in telephony</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/66d/76c/210/66d76c210e9fdff33fbf2caaee71be3f.png" align="left"><br><br>  Asterisk is a free open source computer telephony solution from Digium.  The application runs on operating systems such as Linux, FreeBSD, OpenBSD, Solaris.  In combination with the necessary equipment, Asterisk has all the features of a classic PBX, supports many VoIP protocols, and provides rich call management functions. <br><br>  This article will look at the results of the <a href="http://www.asterisk.org/">Asterisk</a> verification obtained with <a href="http://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> 5.18. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The project, apparently, is checked by the Coverity analyzer, as evidenced by comments like: <br><br>  / * Ignore check_return warning from Coverity for ast_exists_extension below * / <br><br>  However, I noticed some annoying typos.  Let's try to understand them and in other suspicious places.  The source code is taken from the <a href="http://www.viva64.com/go.php%3Furl%3D1432">SVN</a> project repository. <br><br><a name="habracut"></a><br><br><h2>  Typo # 1 </h2><br>  <a href="http://www.viva64.com/ru/d/0183/">V581</a> The conditional expressions of the 'if' are located alongside each other are identical.  Check lines: 2513, 2516. chan_sip.c 2516 <br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sip_threadinfo_destructor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *obj)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sip_threadinfo</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">th</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">obj</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">tcptls_packet</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">packet</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (th-&gt;alert_pipe[<span class="hljs-number"><span class="hljs-number">1</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">-1</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//&lt;== close(th-&gt;alert_pipe[0]); } if (th-&gt;alert_pipe[1] &gt; -1) { close(th-&gt;alert_pipe[1]); } th-&gt;alert_pipe[0] = th-&gt;alert_pipe[1] = -1; .... }</span></span></code> </pre> <br>  Here it was planned to check the status of channels with numbers 0 and 1, after which they are closed, but due to a typo the status of channel 0 is not checked.  The code may work correctly for a long time, because in most cases both channels are involved. <br><br><h2>  Typo # 2 </h2><br>  <a href="http://www.viva64.com/ru/d/0092/">V503</a> This is a nonsensical comparison: pointer &lt;0. parking_manager.c 520 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">manager_park</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *timeout = astman_get_header(m, <span class="hljs-string"><span class="hljs-string">"Timeout"</span></span>); .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> timeout_override = <span class="hljs-number"><span class="hljs-number">-1</span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">sscanf</span></span>(timeout, <span class="hljs-string"><span class="hljs-string">"%30d"</span></span>, &amp;timeout_override) != <span class="hljs-number"><span class="hljs-number">1</span></span> || timeout &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//&lt;== astman_send_error(s, m, "Invalid Timeout value."); return 0; } }</span></span></code> </pre> <br>  At this point, a meaningless comparison of the pointer with zero is performed.  Most likely, we wanted to check the timeout_override variable that the sscanf function returned. <br><br><h2>  Typo # 3 </h2><br>  <a href="http://www.viva64.com/ru/d/0163/">V568</a> It's odd that the sizeof () operator is the 'data [0] * 2' expression.  channel.c 8853 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">redirecting_reason_build_data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (datalen &lt; pos + <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(data[<span class="hljs-number"><span class="hljs-number">0</span></span>] * <span class="hljs-number"><span class="hljs-number">2</span></span>) + length) { <span class="hljs-comment"><span class="hljs-comment">//&lt;== ast_log(LOG_WARNING, "No space left for %s string\n", label); return -1; } .... }</span></span></code> </pre> <br>  The sizeof () operator evaluates the type of expression and returns the size of this type, but the expression itself is not evaluated.  Complex expressions are a sign of an error.  Most often, these errors are associated with typos.  As in this example: most likely, multiplication by two should be behind the bracket sizeof () operator. <br><br><h2>  Typo # 4 </h2><br>  <a href="http://www.viva64.com/ru/d/0273/">V653</a> A suspicious string of two parts is used for array initialization.  It is possible that a comma is missing.  Consider inspecting this literal: ‚ÄúKW_INCLUDES‚Äù ‚ÄúKW_JUMP‚Äù.  ael.y 736 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *token_equivs1[] = { .... <span class="hljs-string"><span class="hljs-string">"KW_IF"</span></span>, <span class="hljs-string"><span class="hljs-string">"KW_IGNOREPAT"</span></span>, <span class="hljs-string"><span class="hljs-string">"KW_INCLUDES"</span></span> <span class="hljs-comment"><span class="hljs-comment">//&lt;== "KW_JUMP", "KW_MACRO", "KW_PATTERN", .... }; static char *ael_token_subst(const char *mess) { .... int token_equivs_entries = sizeof(token_equivs1)/sizeof(char*); .... for (i=0; i&lt;token_equivs_entries; i++) { .... } .... }</span></span></code> </pre> <br>  In the declaration of an array of string literals, the two strings are combined into one.  The error may be due to a typo when a comma is missing between string literals. <br><br>  This is how the elements of the token_equivs1 array actually look like: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5a4/136/531/5a4136531b1b720c1748c8feacf9b7db.png"></div><br><br>  Another such place: <ul><li>  V653 A suspicious string of two parts is used for array initialization.  It is possible that a comma is missing.  Consider inspecting this literal: includes includes jumping.  ael.y 776 </li></ul><br><h2>  Typo # 5 </h2><br>  <a href="http://www.viva64.com/ru/d/0090/">V501</a> There are identical sub-expressions 'strcasecmp (item-&gt; u1.str, "endwhile") == 0'  operator.  pval.c 2513 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_pval_item</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pval *item, ....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strcasecmp(item-&gt;u1.str,<span class="hljs-string"><span class="hljs-string">"GotoIf"</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span> || strcasecmp(item-&gt;u1.str,<span class="hljs-string"><span class="hljs-string">"GotoIfTime"</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span> || strcasecmp(item-&gt;u1.str,<span class="hljs-string"><span class="hljs-string">"while"</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span> || strcasecmp(item-&gt;u1.str,<span class="hljs-string"><span class="hljs-string">"endwhile"</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment">//&lt;== || strcasecmp(item-&gt;u1.str,"random") == 0 || strcasecmp(item-&gt;u1.str,"gosub") == 0 || strcasecmp(item-&gt;u1.str,"gosubif") == 0 || strcasecmp(item-&gt;u1.str,"continuewhile") == 0 || strcasecmp(item-&gt;u1.str,"endwhile") == 0 //&lt;== || strcasecmp(item-&gt;u1.str,"execif") == 0 || ....) {....} }</span></span></code> </pre> <br>  One of the cascade expressions of conditional statements is repeated.  There is always the possibility that a typo occurred in some very important condition. <br><br><h2>  Identical comparisons </h2><br>  <a href="http://www.viva64.com/ru/d/0106/">V517</a> The use of if (A) {...} else if (A) {...} 'pattern was detected.  There is a possibility of logical error presence.  Check lines: 851, 853. manager_channels.c 851 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">channel_hangup_handler_cb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *event; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(action, <span class="hljs-string"><span class="hljs-string">"type"</span></span>)) { event = <span class="hljs-string"><span class="hljs-string">"HangupHandlerRun"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(action, <span class="hljs-string"><span class="hljs-string">"type"</span></span>)) { event = <span class="hljs-string"><span class="hljs-string">"HangupHandlerPop"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(action, <span class="hljs-string"><span class="hljs-string">"type"</span></span>)) { event = <span class="hljs-string"><span class="hljs-string">"HangupHandlerPush"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } .... }</code> </pre> <br>  Extremely suspicious: here either the string ‚ÄúHangupHandlerRun‚Äù is assigned to the variable 'event', or the function is exited. <br><br><h2>  Always a lie </h2><br>  <a href="http://www.viva64.com/ru/d/0137/">V547</a> Expression is always false.  Unsigned type value is never &lt;0. enum.c 309 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ebl_callback</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((i = dn_expand((<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *)fullanswer, (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *)answer + len, (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *)answer, c-&gt;apex, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(c-&gt;apex) - <span class="hljs-number"><span class="hljs-number">1</span></span>)) &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { ast_log(LOG_WARNING, <span class="hljs-string"><span class="hljs-string">"Failed to expand hostname\n"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } }</code> </pre> <br>  The variable 'i' is unsigned and will never be less than zero.  The dn_expand () function returns the value -1 in case of failure, the type of the variable 'i' should not be 'unsigned'. <br><br><h2>  Insidious optimization </h2><br>  <a href="http://www.viva64.com/ru/d/0208/">V597</a> The compiler couldn‚Äôt delete the memset function call, which is used to flush the buf buffer.  The RtlSecureZeroMemory () function should be used to erase the private data.  channel.c 7742 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">silence_generator_generate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> buf[samples]; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ast_frame</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">frame</span></span></span><span class="hljs-class"> = {</span></span> .frametype = AST_FRAME_VOICE, .data.ptr = buf, .samples = samples, .datalen = <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(buf), }; frame.subclass.format = ast_format_slin; <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(buf, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(buf)); <span class="hljs-comment"><span class="hljs-comment">//&lt;== .... }</span></span></code> </pre> <br>  Since the array 'buf' is no longer used after calling the function 'memset', the compiler can remove the function call for optimization, and the array will not be zeroed as planned. <br><br>  Often the V597 warning remains misunderstood.  I propose additional materials that reveal the essence of the problem: <ul><li>  <a href="http://www.viva64.com/ru/k/0041/">Overwrite memory - why?</a> </li><li>  <a href="http://www.viva64.com/go.php%3Furl%3D1028">Zero and forget - caveats of zeroing memory in C</a> </li><li>  <a href="http://habrahabr.ru/company/abbyy/blog/161607/">Once you read about the volatile keyword ...</a> </li></ul><br><h2>  Pointers </h2><br>  <a href="http://www.viva64.com/ru/d/0205/">V595</a> The 'object_wizard-&gt; wizard' pointer has been verified against nullptr.  Check lines: 683, 686. sorcery.c 683 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sorcery_object_wizard_destructor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *obj)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ast_sorcery_object_wizard</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object_wizard</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">obj</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (object_wizard-&gt;data) { object_wizard-&gt;wizard-&gt;close(object_wizard-&gt;data); <span class="hljs-comment"><span class="hljs-comment">//&lt;== } if (object_wizard-&gt;wizard) { //&lt;== ast_module_unref(object_wizard-&gt;wizard-&gt;module); } ao2_cleanup(object_wizard-&gt;wizard); //&lt;== }</span></span></code> </pre> <br>  For some reason, there is a random check of the pointer to zero.  Usually such places say that a null pointer can still come to a function, therefore, it should be checked in all places before use. <br><br><h2>  Redundant code </h2><br>  I think the following two examples are not errors, but can be simplified. <br><br>  <a href="http://www.viva64.com/ru/d/0187/">V584</a> The '1' value is the operator.  The expression is not correct.  chan_unistim.c 1095 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_send_queue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct unistimsession *pte)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pte-&gt;last_buf_available == <span class="hljs-number"><span class="hljs-number">1</span></span>) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pte-&gt;last_seq_ack + <span class="hljs-number"><span class="hljs-number">1</span></span> == pte-&gt;seq_server + <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//&lt;== .... } }</span></span></code> </pre> <br>  In increasing the arguments by one on both sides of the equal sign, there is probably little practical meaning. <br><br>  <a href="http://www.viva64.com/ru/d/0169/">V571</a> Recurring check.  The 'wizard-&gt; wizard-&gt; retrieve_fields' condition was already verified in line 1520. sorcery.c 1521 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ast_sorcery_retrieve_by_fields</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((flags &amp; AST_RETRIEVE_FLAG_MULTIPLE)) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fields &amp;&amp; wizard-&gt;wizard-&gt;retrieve_fields) { <span class="hljs-comment"><span class="hljs-comment">//&lt;== if (wizard-&gt;wizard-&gt;retrieve_fields) { //&lt;== object = wizard-&gt;wizard-&gt;retrieve_fields(....); } } }</span></span></code> </pre> <br>  Not an error, but one pointer check can be explicitly removed. <br><br><h2>  Conclusion </h2><br>  Using static analysis regularly, you can save a lot of time on solving more useful tasks than catching silly mistakes and typos. <br><br>  There is also an interesting article about typos: <a href="http://www.viva64.com/ru/b/0260/">The effect of the last line</a> . <br><br><h2>  This article is in English. </h2><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Svyatoslav Razmyslov.  <a href="http://www.viva64.com/en/b/0276/">Asterisk: PVS-Studio Takes Up Telephony</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Read the article and have a question?</b> <div class="spoiler_text">  Often our articles are asked the same questions.  We collected the answers to them here: <a href="http://www.viva64.com/ru/a/0085/">Answers to questions from readers of articles about PVS-Studio and CppCat, version 2014</a> .  Please review the list. <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/234591/">https://habr.com/ru/post/234591/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../234577/index.html">runScribe helps to avoid injuries while running</a></li>
<li><a href="../234579/index.html">Freemium or Free Trial - which business model to choose when selling software?</a></li>
<li><a href="../234583/index.html">Amazon bought Twitch video streaming service for $ 970 million</a></li>
<li><a href="../234587/index.html">Anatomy of Melancholia</a></li>
<li><a href="../234589/index.html">Budget planning: hot September</a></li>
<li><a href="../234595/index.html">Instruments. How to legally form a partnership break</a></li>
<li><a href="../234597/index.html">28 mistakes of a startup in the eyes of an investor. Business angel experience</a></li>
<li><a href="../234599/index.html">Firefox OS smartphone went on sale for $ 33 (in India)</a></li>
<li><a href="../234601/index.html">7-inch TFT LCD backlight brightness control</a></li>
<li><a href="../234603/index.html">The story of the creation of iOS games about fast reaction and steel nerves</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>