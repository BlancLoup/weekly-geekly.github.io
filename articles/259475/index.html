<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Another language recognizer 4</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1. Prologue 
 A few years ago I developed an internal language for calculating reports, which is used in our company. The language turned out to be st...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Another language recognizer 4</h1><div class="post__text post__text-html js-mediator-article"><h4>  1. Prologue </h4><br>  A few years ago I developed an internal language for calculating reports, which is used in our company.  The language turned out to be strange, it has neither cycles nor standard conditional statements (if), dynamic typing, but it coped with its functions.  The idea of ‚Äã‚Äãthe language was to implement a simple expression evaluator.  Over time, the requirements became more and more, as a result, the language began to expand, it was necessary to develop a simple script for adding new functions. <br><br>  At the moment, the internal language for calculating reports has become a monster, not a twisting mutant.  This creation gave birth to the lack of documentation, ease of expansion and laziness of developers (it is easier to write something new than to figure out what is and find the right one).  The language began to be able to do a lot, too much of what it was not intended for (except that the pancakes did not teach him to bake the oven, which is a pity). <br><a name="habracut"></a><br><h4>  2. Rethinking </h4><br>  The department began to expand, newcomers appeared who need to be taught this language, and this is not easy.  It was decided to transfer the reports to a new system, devoid of the shortcomings of the current one; the task is complicated by the emerging department of analytics.  The interaction is about analytics -&gt; calculations -&gt; development -&gt; script -&gt; analytics.  The task is complicated by the fact that the code of the internal language must be read by analysts (not programmers) and send for revision if errors are detected.  Sounds awesome - do it!  This was the verdict, the task got to me, for the atonement of previous sins.  When the task was voiced and the voices of critics were posed somewhere ‚ÄúWhere are the cycles?  The developer apparently did not know about them ‚Äù,‚Äú Isn‚Äôt it easier to write all this in c #?  C = a + b ‚Äù.  Sharpe language constructs will be very relevant in the analytics department (where words like functional, ternary operator sound like a checkmate). <br><br><h4>  3. Search for a solution </h4><br>  The current version of the language was developed on the knees of neither knowledge nor experience at that time was not needed, it was necessary to develop something quickly that would satisfy current needs.  At the moment, there is an experience that says ‚ÄúNo, sit down to do this nonsense!  No knowledge!  It is necessary to use someone else‚Äôs experience and knowledge. ‚Äù.  The first thing that comes to mind is the development of a compiler (quite an idea).  <a href="https://www.lektorium.tv/course/22972">Found it</a> .  After viewing, I realized that it was very interesting, very difficult, and the campaign too I swung at the compiler.  Sometimes in the project we used configuration files of various services (usually xml), proudly calling it DSL!  I decided to get acquainted with the abbreviation in more detail - the campaign <a href="http://www.youtube.com/watch%3Fv%3DZfdAwV0HlEU">is what is needed</a> .  I am already familiar with this uncle, he has not a weak weight in the field of design - it is necessary to acquaint him with his works.  In <a href="http://martinfowler.com/books/dsl.html">this book,</a> he constantly mentions ANTLR. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  4. Installing ANTLR4 in VS </h4><br>  I did not find adequate articles on the use of ANTLR in VS, it made me write this article (in fact, everything is simple, when you know, when you know, everything is simple).  <a href="http://programming-pages.com/2013/12/14/antlr-4-with-c-and-visual-studio-2012/">Here,</a> in principle, an example is described (with manual editing of the project file).  Not okay.  Everything you need can be found in the studio extensions and nuget. <br>  ANTLR Language Support: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/078/91b/ad4/07891bad4fa2304fcda9cc177837c8be.png" alt="image"><br><br>  What it gives: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d63/89d/542/d6389d54249f7ad9375c8044c8f9c6f5.png" alt="image"><br><br>  Further two libraries with nuget: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f5c/7ed/e53/f5c7ede5393be445608ea230cf30789e.png" alt="image"><br><br>  Then create a grammar, add the file Calculator.g4 to the antlr4 Combined Grammar project.  With something like this: <br><br><pre><code class="cs hljs">grammar Calculator; @parser::members { <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> EOF = Eof; } @lexer::members { <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> EOF = Eof; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> HIDDEN = Hidden; } <span class="hljs-comment"><span class="hljs-comment">/* * Parser Rules */</span></span> prog: expr+ ; expr : left = expr op=(<span class="hljs-string"><span class="hljs-string">'*'</span></span>|<span class="hljs-string"><span class="hljs-string">'/'</span></span>) right = expr <span class="hljs-meta"><span class="hljs-meta"># MulDiv | left = expr op=('+'|'-') right = expr # AddSub | INT # int | '(' expr ')' # parens ; /* * Lexer Rules */ INT : [0-9]+; MUL : '*'; DIV : '/'; ADD : '+'; SUB : '-'; EQU : '='; WS : (' ' | '\r' | '\n') -&gt; channel(HIDDEN) ;</span></span></code> </pre> <br>  Taken almost unchanged from the site mentioned above.  In the file properties you need to set: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/33a/6f2/d57/33a6f2d57e100d8622cc264bb38be620.png" alt="image"><br><br>  Next F5 ... And nothing, no errors, no promised CalculatorBaseVisitor.cs.  Oh yes, how could I forget, I don‚Äôt have an environment for running programs on JAVA (epic, that for developing in C # you need JAVA). <br><br>  Repeated attempt to launch the project issued: <br><br>  Error 5 '@' came as a complete surprise to me <br>  Error 2 '‚ïó' came as a complete surprise to me <br>  Error 3 missing SEMI at '‚îêgrammar' <br><br>  Etc.  There is no despair in our hearts or Google to help, in general, the case in the encoding: utf8 (BOM) must be utf8 (without BOM). <br><br>  MS Word in shock when opening a file: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6a6/c9c/95e/6a6c9c95eaee470c532ce370c26b88d2.png" alt="image"><br><br>  I converted to windows - 1251 and the curved characters are immediately visible at the beginning of the file (funny, but there was no such problem on another machine). <br><br>  The project has gathered, but (there is always something lately, but) the CalculatorBaseVisitor.cs has not found the promised one in the project.  Yandex revealed all the maps (and no matter what search engine) ... \ obj \ Debug - the generated analyzer files live here, it is possible that these are correctly generated files, cannot be modified, wpf drops the .g files into the same folder, but resets the visitor there I was inconvenienced when Parser and Lexer were added to the project, but the visitor was not. <br><br>  Then you can use the link from where I took an example of grammar to complete the lesson. <br><br>  <a href="http://habrahabr.ru/post/259691/">Further</a> <br><br><h4>  PS </h4><br>  Perhaps all the problems are due to the fact that the ANTLR native language is JAVA, and the generator is not so popular in C #, but after overcoming all the connection problems (and this is not 1 hour), the system turned out to be quite good, although the examples for C # are very few. <br><br><h4>  Pps </h4><br>  <i>Based on real events.</i>  <i>Some names and events have been distorted in order to respect copyright and safety.</i> </div><p>Source: <a href="https://habr.com/ru/post/259475/">https://habr.com/ru/post/259475/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../259465/index.html">Modeling objects for animation on Canvas</a></li>
<li><a href="../259467/index.html">How to write your NIF in Elixir</a></li>
<li><a href="../259469/index.html">Manage Windows computers from the Linux console</a></li>
<li><a href="../259471/index.html">API Jellyfish: write full text RSS</a></li>
<li><a href="../259473/index.html">Compass with PWM on the stm32f3discovery debug board</a></li>
<li><a href="../259477/index.html">That the new versions of the UEFI standards are prepared for us, part two, ACPI 6.0</a></li>
<li><a href="../259479/index.html">Configure OpenSWAN IPsec PSK using NAT Traversal (NAT-T)</a></li>
<li><a href="../259483/index.html">Exploring the format of the level map of the Jackal NES game</a></li>
<li><a href="../259489/index.html">Experiment: Testing Live ReactOS Applications</a></li>
<li><a href="../259491/index.html">Motion sensor for switching radio stations - part II</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>