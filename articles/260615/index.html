<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Editing Spatial Data in Leaflet</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Despite the development of cartographic web frameworks, the editing of vector geographic data is still, for the most part, happening in desktop applic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Editing Spatial Data in Leaflet</h1><div class="post__text post__text-html js-mediator-article">  Despite the development of cartographic web frameworks, the editing of vector geographic data is still, for the most part, happening in desktop applications.  In the yard of 2015, it‚Äôs time to move on to editing in browsers. <br><br>  There are several open libraries for drawing web maps, for example, OpenLayers and Leaflet.  Quite a long time ago, our choice fell on Leaflet and we continue to actively use it in the implementation of projects.  To edit the geodata, I would like to use it and, at the same time, be able to integrate with existing spatial data stores. <br><br>  To achieve the latter goal, as a rule, GIS servers (geoserver, mapserver) are used, which are able to publish a large variety of data formats according to <a href="https://habr.com/ru/post/260615/">standards</a> <a name="OGC1"></a>  <acronym>OGC</acronym> .  Thus, the <acronym>WMS</acronym> protocol does an excellent job with the visualization function of the finished map, but does not imply an editing function, for which it is reasonable to use the <acronym>WFS</acronym> protocol with the ability to change data.  Requests to WMS return already drawn tiles - pictures, and to WFS - raw information, ‚Äúsource code‚Äù behind these tiles.  Leaflet supports extension modules, respectively, you can search for the finished component, or write your own.  Since  the search for ready-made modules for Leaflet did not give satisfactory results, we started our own implementation. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      According to statistics of requests for <a href="http://leaflet.uservoice.com/">leaflet.uservoice.com</a> it is clear that this module is interesting not only for us. <br><a name="habracut"></a><br><h2>  Let's start with a description of the WFS-T and what it is used for </h2><br>  The OGC Web Feature Service standard allows you to query and edit (in the case of the ‚Äú-T" - transaction) the spatial data using server requests. The CRUD standard functions are divided into GetFeature read and Transaction requests for the rest. <br><br>  Two ways can be used for client and server interaction: the first uses XML and POST requests, the second uses key / value pairs and GET requests. <br><br>  You can get data using GET requests of the form: <br>  % WFSServerURL%? Service = WFS &amp; version = 1.0.0 &amp; request = GetFeature &amp; typeName = osm_perm_region: perm_water_polygon &amp; maxFeatures = 50 &amp; outputFormat = application / json, <br><table><tbody><tr><td>  service = WFS </td><td>  service type is always the same </td></tr><tr><td>  version = 1.0.0 </td><td>  WFS standard version.  At the moment there are 3 versions: 1.0.0, 1.1.0, 2.0.0.  We will use version 1.1.0, since  2.0.0 is not implemented by all server-side manufacturers. </td></tr><tr><td>  request = GetFeature </td><td>  request type </td></tr><tr><td>  typeName = osm_perm_region: perm_water_polygon </td><td>  type of data published by the WFS server </td></tr><tr><td>  maxFeature = 50 </td><td>  the number of objects that will be returned by the server </td></tr><tr><td>  outputFormat = application / json </td><td>  The format of the data to be returned by the server.  The standard regulates only one data format - GML, but some implementations may use other than GML, for example, geoserver can give data to geoJson </td></tr></tbody></table><br>  In some cases, you can also use key-value pairs in a GET request to create \ change \ delete data, but performing a POST request on% WFSServerURL% with XML data gives more options. <br>  Examples of changing objects: <br><br><div class="spoiler">  <b class="spoiler_title">Creating</b> <div class="spoiler_text"><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wfs:Transaction</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">service</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"WFS"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.0.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:wfs</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.opengis.net/wfs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:topp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.openplans.org/topp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:gml</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.opengis.net/gml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:schemaLocation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/WFS-transaction.xsd http://www.openplans.org/topp http://localhost:8080/geoserver/wfs/DescribeFeatureType?typename=topp:tasmania_roads"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wfs:Insert</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">topp:tasmania_roads</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">topp:the_geom</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gml:MultiLineString</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">srsName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.opengis.net/gml/srs/epsg.xml#4326"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gml:lineStringMember</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gml:LineString</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gml:coordinates</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">decimal</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"."</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cs</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">","</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ts</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" "</span></span></span><span class="hljs-tag">&gt;</span></span> 494475.71056415,5433016.8189323 494982.70115662,5435041.95096618 <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gml:coordinates</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gml:LineString</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gml:lineStringMember</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gml:MultiLineString</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">topp:the_geom</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">topp:TYPE</span></span></span><span class="hljs-tag">&gt;</span></span>alley<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">topp:TYPE</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">topp:tasmania_roads</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wfs:Insert</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wfs:Transaction</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Update</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wfs:Transaction</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">service</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"WFS"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.0.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:topp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.openplans.org/topp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:ogc</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.opengis.net/ogc"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:wfs</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.opengis.net/wfs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:gml</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.opengis.net/gml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:schemaLocation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/WFS-transaction.xsd"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wfs:Update</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">typeName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"topp:tasmania_roads"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wfs:Property</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wfs:Name</span></span></span><span class="hljs-tag">&gt;</span></span>the_geom<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wfs:Name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wfs:Value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gml:MultiLineString</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">srsName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.opengis.net/gml/srs/epsg.xml#4326"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gml:lineStringMember</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gml:LineString</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gml:coordinates</span></span></span><span class="hljs-tag">&gt;</span></span>500000,5450000,0 540000,5450000,0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gml:coordinates</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gml:LineString</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gml:lineStringMember</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gml:MultiLineString</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wfs:Value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wfs:Property</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ogc:Filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ogc:FeatureId</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">fid</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tasmania_roads.1"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ogc:Filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wfs:Update</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wfs:Transaction</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Deletion</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wfs:Transaction</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">service</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"WFS"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.0.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:cdf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.opengis.net/cite/data"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:ogc</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.opengis.net/ogc"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:wfs</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.opengis.net/wfs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:topp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.openplans.org/topp"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wfs:Delete</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">typeName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"topp:tasmania_roads"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ogc:Filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ogc:PropertyIsEqualTo</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ogc:PropertyName</span></span></span><span class="hljs-tag">&gt;</span></span>topp:TYPE<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ogc:PropertyName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ogc:Literal</span></span></span><span class="hljs-tag">&gt;</span></span>alley<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ogc:Literal</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ogc:PropertyIsEqualTo</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ogc:Filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wfs:Delete</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wfs:Transaction</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  GML is used to describe spatial data.  In this format, the server returns data by default (with the outputFormat flag not set), and only in it requests are accepted when data changes.  For example, the point [0, 0] in GML can be represented as follows: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gml:Point</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">srsName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.opengis.net/def/crs/EPSG/0/4326"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gml:pos</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">srsDimension</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag">&gt;</span></span>0.0 0.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gml:pos</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gml:Point</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Filters are used to limit requests for deletion and alteration of data ‚Äî another of the OGC standards.  In the beginning it will be enough - GmlObjectId, it is used to update / delete objects.  Further other filters will be required. <br><br>  Example for ID = 1: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ogc:Filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ogc:GmlFeatureId</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">gml:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">1/</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ogc:Filter</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><h2>  Creating Leaflet Plugin </h2><br>  As mentioned above, Leaflet has a well-thought-out modular infrastructure, so you need to be able to write these very modules.  An introduction to creating a plugin is on <a href="http://leafletjs.com/2013/06/28/leaflet-plugin-authoring-guide.html">the Leaflet site</a> , and an example of the implementation of <a href="http://leafletjs.com/reference.html">ILayer</a> .  Also there are several articles on Habr√©. <br><br>  We need to create our own layer, which, when loaded, will receive data from the service and draw it.  Several plug-ins were found for reading the WFS, all of them inherited from the L.GeoJSON layer and read the data right away in the right format.  But the standard does not oblige the server-side manufacturers to provide data to geoJson (I have seen such a possibility only for geoserver), but the GML format is obligatory.  Having looked at how reading was done in OpenLayers, we took the idea from there: for reading, use a separate class that knows how to understand the format you want.  Like L.GeoJSON, we inherited our implementation from L.FeatureGroup.  2 GML and GeoJSON reading formats were implemented. <br><br><h3>  Data acquisition </h3><br>  This is done by the AJAX request and sent to the reading class for processing; here we simply transfer the geoJson transformation to the markers \ polygons \ polylines to the depths of the Leaflet itself: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> layers = []; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> geoJson = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(response.rawData); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; geoJson.features.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> layer = L.GeoJSON.geometryToLayer(geoJson.features[i], options.pointToLayer || <span class="hljs-literal"><span class="hljs-literal">null</span></span>, options.coordsToLatLng, <span class="hljs-literal"><span class="hljs-literal">null</span></span>); layer.feature = geoJson.features[i]; layers.push(layer); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> layers;</code> </pre><br>  Or GML parsim - the output is the same markers \ polygons \ polylines: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> layers = []; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xmlDoc = L.XmlUtil.parseXml(rawData); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> featureCollection = xmlDoc.documentElement; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> featureMemberNodes = featureCollection.getElementsByTagNameNS(L.XmlUtil.namespaces.gml, <span class="hljs-string"><span class="hljs-string">'featureMember'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; featureMemberNodes.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> feature = featureMemberNodes[i].firstChild; layers.push(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.processFeature(feature)); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> featureMembersNode = featureCollection.getElementsByTagNameNS(L.XmlUtil.namespaces.gml, <span class="hljs-string"><span class="hljs-string">'featureMembers'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (featureMembersNode.length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> features = featureMembersNode[<span class="hljs-number"><span class="hljs-number">0</span></span>].childNodes; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; features.length; j++) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> node = features[j]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (node.nodeType === <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.ELEMENT_NODE) { layers.push(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.processFeature(node)); } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> layers;</code> </pre><br><h3>  Editing objects </h3><br>  Functions are written which, interacting with the plug-ins of visual editing of Leaflet objects (leaflet.draw, Leaflet.Editable), remember the changes made.  After editing is finished, you need to call the save () method, which will form a GML description of the changes - the ‚Äúwfs: Transaction" element, and, for each of the changed objects, the corresponding Action (wfs: Insert, wfs: Update, wfs: Delete) After this, an AJAX request is made. <br><br>  Example of subscribing to events for Leaflet.Editable plugin: <br><br><pre> <code class="javascript hljs">map.on(<span class="hljs-string"><span class="hljs-string">'editable:created'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ wfst.addLayer(e.layer); }); map.on(<span class="hljs-string"><span class="hljs-string">'editable:editing'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ wfst.editLayer(e.layer); }); map.on(<span class="hljs-string"><span class="hljs-string">'editable:delete'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ wfst.removeLayer(e.layer); });</code> </pre><br>  For each Leaflet primitive (Marker, Polyline, Polygon, etc.), the function of its translation into the description of GML geometry was written, for example, for a marker it looks like this: <br><br><pre> <code class="javascript hljs">L.Marker.include({ <span class="hljs-attr"><span class="hljs-attr">toGml</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">crs</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> node = L.XmlUtil.createElementNS(<span class="hljs-string"><span class="hljs-string">'gml:Point'</span></span>, {<span class="hljs-attr"><span class="hljs-attr">srsName</span></span>: crs.code}); node.appendChild(L.GMLUtil.posNode(L.Util.project(crs, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getLatLng()))); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> node; } });</code> </pre><br><h2>  Examples of using </h2><br><h3>  Only reading </h3><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> map = L.map(<span class="hljs-string"><span class="hljs-string">'map'</span></span>).setView([<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> boundaries = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> L.WFS({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'http://demo.opengeo.org/geoserver/ows'</span></span>, <span class="hljs-attr"><span class="hljs-attr">typeNS</span></span>: <span class="hljs-string"><span class="hljs-string">'topp'</span></span>, <span class="hljs-attr"><span class="hljs-attr">typeName</span></span>: <span class="hljs-string"><span class="hljs-string">'tasmania_state_boundaries'</span></span>, <span class="hljs-attr"><span class="hljs-attr">crs</span></span>: L.CRS.EPSG4326, <span class="hljs-attr"><span class="hljs-attr">style</span></span>: { <span class="hljs-attr"><span class="hljs-attr">color</span></span>: <span class="hljs-string"><span class="hljs-string">'blue'</span></span>, <span class="hljs-attr"><span class="hljs-attr">weight</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> } }).addTo(map) .on(<span class="hljs-string"><span class="hljs-string">'load'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ map.fitBounds(boundaries); })</code> </pre><br>  <a href="http://flexberry.github.io/Leaflet-WFST/examples/tasmania.html">link</a> <br><br><h3>  Editing </h3><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> wfst = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> L.WFS.Transaction({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'http://myserver/geoserver/ows'</span></span>, <span class="hljs-attr"><span class="hljs-attr">typeNS</span></span>: <span class="hljs-string"><span class="hljs-string">'myns'</span></span>, <span class="hljs-attr"><span class="hljs-attr">typeName</span></span>: <span class="hljs-string"><span class="hljs-string">'POIPOINT'</span></span>, <span class="hljs-attr"><span class="hljs-attr">style</span></span>: { <span class="hljs-attr"><span class="hljs-attr">color</span></span>: <span class="hljs-string"><span class="hljs-string">'blue'</span></span>, <span class="hljs-attr"><span class="hljs-attr">weight</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> } }).addTo(map).once(<span class="hljs-string"><span class="hljs-string">'load'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ map.fitBounds(wfst); wfst.enableEdit(); }); map.on(<span class="hljs-string"><span class="hljs-string">'editable:created'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ wfst.addLayer(e.layer); }); map.on(<span class="hljs-string"><span class="hljs-string">'editable:editing'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ wfst.editLayer(e.layer); }); L.easyButton(<span class="hljs-string"><span class="hljs-string">'fa-save'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ wfst.save(); }, <span class="hljs-string"><span class="hljs-string">'Save changes'</span></span>);</code> </pre><br>  <a href="http://flexberry.github.io/Leaflet-WFST/examples/markers.html">link</a> <br><br><h2>  Plans for the development of the plugin </h2><br>  - Migration to Leaflet 0.8 (the interiors of the Multi-classes have changed, and the polylines with polygons have got the ring's); <br>  - Ability to use different versions of WFS; <br>  - Support for other items of the standard OGC Filter Encoding. <br><br><h2>  Sources and development </h2><br>  The project lives on <a href="https://github.com/Flexberry/Leaflet-WFST">GitHub</a> .  For automation, Grunt is used.  For testing using a bunch of karma + mocha + chai + sinon.  Those who wish to participate - welcome. <br><br><h2>  Links </h2><br><ol><li><a name="OGC"></a>  <a href="https://habr.com/ru/post/260615/">‚Üë</a> OGC Standards: <a href="http://www.opengeospatial.org/standards/wms">WMS</a> , <a href="http://www.opengeospatial.org/standards/wfs">WFS</a> , <a href="http://www.opengeospatial.org/standards/gml">GML</a> , <a href="http://www.opengeospatial.org/standards/filter">Filter Encoding</a> </li><li>  Description of some standards in Russian - <a href="http://live.osgeo.org/ru/standards/standards.html">live.osgeo.org</a> </li><li>  <a href="https://github.com/flatrockgeo/leaflet.wfs-t">leaflet.wfs-t</a> is the found wfst plugin for leaflet, from the minuses it is abandoned, alpha version, query assembly (xml) by concatenation, only markers and polygons, only geojson. </li><li>  <a href="http://geoserver.org/">geoserver.org</a> is one of the open gis servers with WFST support, it contains demo data. </li></ol></div><p>Source: <a href="https://habr.com/ru/post/260615/">https://habr.com/ru/post/260615/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../260603/index.html">VeeamON Forum 2015 Moscow. Results</a></li>
<li><a href="../260605/index.html">8 common design mistakes (and how to avoid them)</a></li>
<li><a href="../260609/index.html">Accelerate the Android application with Golang</a></li>
<li><a href="../260611/index.html">Where is the Internet ‚Äúliving in Russia well‚Äù?</a></li>
<li><a href="../260613/index.html">Electronics for the most beginners</a></li>
<li><a href="../260617/index.html">Home server from scratch</a></li>
<li><a href="../260619/index.html">Google hunting season is open</a></li>
<li><a href="../260621/index.html">Multiple / Class Table Inheritance in Rails</a></li>
<li><a href="../260623/index.html">High-performance code on the .NET platform</a></li>
<li><a href="../260629/index.html">Digest news of the gaming industry</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>