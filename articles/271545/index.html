<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Dinosaur Walking: How I Adapted a Web Application for IE 7</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, I decided to send my project, on which I had worked in my spare time over the past few years, to a competition in one company. I sat down an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Dinosaur Walking: How I Adapted a Web Application for IE 7</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/1ec/f35/d96/1ecf35d963f8921ce3f1569d8926d943.png" alt="image"><br><br>  Recently, I decided to send my project, on which I had worked in my spare time over the past few years, to a competition in one company.  I sat down and began to think if there were any nuances that I did not take into account and which could spoil the impression and reduce the chances of success.  And the first thing that occurred to me was that the project did not work under IE below version 9.  That is all, there was a lock.  After login, a window appeared with a beautiful warning that the browser is not supported, and the user was again thrown onto the login form.  Quite elegant - but unpleasant.  What if a person has Windows XP, and no third-party browsers?  Bad luck <br><br>  And so I decided to spend as much time as I need, but at the same time achieve a stable, error-free system at least in IE 8. I was ready to remove some of the functions, if necessary, but everything had to look neat and work without failures.  Anticipating long and heavy torment (I already had a similar experience several times), I got down to business.  If you are interested to know what difficulties I encountered, and what changes I had to make to different components, welcome to Cat. <br><a name="habracut"></a><br>  I began to remember why I did it - and remembered that I didn‚Äôt even try to correct the flaws in the layout after I saw that the data did not come through the XHR.  Judging that an instant messenger without auto-update, where you have to press F5 all the time is a complete circus, I introduced that lock. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      However, after this there were already 2-3 cases when I came across similar symptoms and successfully eliminated them.  And somehow I forgot about this project that the problem was the same here.  This first correction fixed the most important problem, which, in turn, opened the way for further improvements. <br><br>  Below I will list the main incompatibilities that may have to be considered if you decide to provide support for older versions of Internet Explorer.  So let's go! <br><br><h4>  IE doesn't know what CP1251 encoding is (all versions) </h4><br>  This problem - paradox - is still present.  All versions of IE are affected by it, up to the 11th.  Perhaps, Microsoft does not consider this a bug, but during development this has to be taken into account - otherwise the browser will ignore all data that came through AJAX.  There are two solutions here: either add the encoding via .htaccess (if you have Apache), or add it via <code>header()</code> directly in the PHP code.  The second option is more universal (should work with any web server), but more laborious, and obviously clogs the code, so I prefer the following line in the config file: <br><br><pre> <code class="apache hljs"><span class="hljs-attribute"><span class="hljs-attribute">AddDefaultCharset</span></span> windows-1251</code> </pre><br>  After this, the response header is <code>Content-Type: text/html; charset=CP1251</code>  <code>Content-Type: text/html; charset=CP1251</code> changes to <code>Content-Type: text/html; charset=windows-1251</code>  <code>Content-Type: text/html; charset=windows-1251</code> , and it will work. <br><br><h4>  Lack of support for some pseudo-classes (IE8 and below) </h4><br>  For example, the <code>nth-child()</code> selector does not work.  What creates big problems when the layout and styles are already written.  Again, there are only two adequate solutions - either prescribe the necessary blocks (for example, the second in the container) a special class in all places in HTML, or write a single JavaScript function, and assign the necessary styles in it through the style.  The second option seemed more advantageous to me, since the markup is not clogged with unnecessary classes, less work, easier to remove in case of anything - and most importantly, in this case, you can run this code only for IE of the necessary versions, turning it into <code>if()</code> .  Please note: if you choose the first option, you cannot do with conditional comments, you will have to change the markup itself, adding an extra <code>class</code> attribute where it is not needed in general. <br><br><h4>  Lack of background-size support (IE8 and below) </h4><br>  Yes, the <code>background-size</code> property is part of CSS3, so there is no support for it.  Predictable, but very sad.  Imagine, for example, that we have a small icon, which is almost the right size, but not quite (for example, it is more than 20-50 percent).  When developing, we could make an ordinary div, assign it as a background and set the background-size.  In IE8, we get it in full, larger size.  Here you can change the layout, making img, and giving him the size.  But it‚Äôs usually cheaper to make one (or as many as necessary) copies of a picture of the right size, and leave the markup as it is. <br><br><h4>  No display: inline-block (IE7 and below) </h4><br>  It should be replaced with <code>display: inline</code> , it works in exactly the same way (external indents are supported, and this is usually enough).  In especially difficult cases, you can try <code>float: left</code> (or <code>float: right</code> , if you need alignment along the right edge, though in this case the order of the elements will change to the opposite, and you will have to add more JS code). <br><br><h4>  List bug (IE7 and below) </h4><br>  I often use a list for a non-intended purpose: for example, to create a series of horizontal links, or drop-down menu items.  But this time I had to change the markup, because I could not find solutions for this problem.  IE7 (and IE8 in emulation mode) adds an indent to the left of all items.  At the same time, the container <code>padding</code> is zero, the <code>margin</code> on the <code>&lt;li&gt;</code> elements is also, and a fixed distance of 26 pixels is listed in the inspector as <code>offset</code> (to the left of the <code>margin</code> ).  At the same time through CSS it can not be removed in any way (or I did not find how to do it). <br><br>  UPD: <a href="https://habrahabr.ru/users/andy128k/" class="user_link">andy128k</a> prompted a solution to the problem: it is necessary to specify <code>list-style-position: outside</code> for the list items, and the indent disappears. <br><br><h4>  Difficulties with mixing own functions into prototype (IE8 and below) </h4><br>  In browsers like Chrome, Opera and Firefox, you can add the necessary properties to the prototype of the elements through the HTMLElement object.  In IE 8, when you try to do this, you get an exception, even if you just write an if with this name ‚Äî so you must use the <code>try {}</code> block.  But the Element object performs the same function there.  But in IE7 you can not do this.  You can of course add properties to the Object.prototype - but this is not very good practice, in my opinion.  Therefore, if IE7 support is necessarily needed, and there are not very many mixed functions, it is easier to abandon the syntax with a dot at all.  And write something like <code>addClass(obj, className)</code> instead of <code>obj.addClass(className)</code> . <br><br><h4>  Absence of nextElementSibling and previousElementSibling (IE7 and below) </h4><br>  Yes, yes, these properties also do not.  Totally.  There is of course a collection of children, which you can travel, but in a number of places where you need to get the next element, you have to use stupid <code>while()</code> loops on one line, going through nextSibling / previousSibling, until we find an element of the desired class, or with nodeType equal to one .  Here it should be noted that in IE, the corresponding versions of <code>nextSibling</code> and <code>previousSibling</code> just skip text nodes.  Only in other browsers this is not the case, and cross-browser compatibility will disappear immediately (the code will stop working everywhere except IE), if you make a simple replacement. <br><br><h4>  Missing JSON object (IE7 and below) </h4><br>  Everything is simple - we write our parser / encoder (good, it's not so difficult).  You can also use <code>eval</code> , especially if the data source is trusted, for example, our server.  But knowledgeable people do not recommend doing it anyway :) <br><br><h4>  Unexpected rake with HTTPS (IE7 and below) </h4><br>  In my project, data is obtained from a third-party resource via the API via the HTTPS protocol.  You can imagine my surprise when on a real IE7 on a virtual machine I didn‚Äôt get that data via JSONP, which I perfectly received in IE8 in IE7 emulation mode.  I don‚Äôt know what was the matter, but it looks like something with a set of supported ciphers - the server simply does not allow to establish a connection.  Check it was easy - just opened the desired address in a new tab and saw the SSL error.  And the same mistake was when opening any page of that site.  What's interesting - the encryption protocols in the settings for IE7 and IE8 are the same: SSL 2.0 (not checked), SSL 3.0 and TLS 1.0.  And the key length in the window "About" and there and there is equal to 128 bits.  But for some reason, IE7 server otshivaet.  If anyone knows the reason for this phenomenon - write in the comments. <br><br><h4>  Other device selection </h4><br>  If we need to somehow work with the selection - it does not matter, the selection is just on a web page, in <code>input</code> or <code>textarea</code> - for IE you need a separate code.  Not that it was much more difficult in the general case ‚Äî however, in simple situations (such as ‚Äúinserting text at the cursor position into the text field‚Äù), the approach is really less obvious and requires deeper knowledge. <br><br>  There are a lot of code variants for cross-browser framing a piece of text with a tag, or inserting text into an arbitrary position (which is essentially very similar) on the Internet.  My version, which I once copied from somewhere and did not really test it (since I am working on the Opera), did not work.  The correct version was found the other day in a well-known forum, its authorship is collective.  In general, I have nothing to do with him, but I will give it here in a very abbreviated and simplified form (so that the idea was clear, and there was not too much): <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (detectIE() &lt; <span class="hljs-number"><span class="hljs-number">9</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.sel = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> f = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.sel = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.selection.createRange().duplicate() } <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'inputField'</span></span>).onselect = f <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'inputField'</span></span>).onkeyup = f <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'inputField'</span></span>).onclick = f } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tagSelectedText</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">obj, tag</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.selection) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.sel) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'inputField'</span></span>).focus() <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sel = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.sel <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> len = sel.text.length sel.text = <span class="hljs-string"><span class="hljs-string">'&lt;'</span></span> + tag + <span class="hljs-string"><span class="hljs-string">'&gt;'</span></span> + sel.text + <span class="hljs-string"><span class="hljs-string">'&lt;/'</span></span> + tag + <span class="hljs-string"><span class="hljs-string">'&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (len == <span class="hljs-number"><span class="hljs-number">0</span></span>) sel.moveEnd(<span class="hljs-string"><span class="hljs-string">'character'</span></span>, -(tag.length+<span class="hljs-number"><span class="hljs-number">3</span></span>)); sel.select(); } <span class="hljs-comment"><span class="hljs-comment">// ...    }</span></span></code> </pre><br>  The idea is that there is an invisible object of selection (and often not in the singular, it is sometimes incidentally seen in Opera, if you select something with the mouse, before this, in JS, without having to programmatically reset everything in the Range).  But he disappears as soon as the field loses focus.  And on onblur assign the function of its duplication is useless: it's too late.  Therefore onselect.  onkeyup and onclick are needed in order to preserve an empty selection (zero length) as you type or move the cursor across the field with arrows or mouse clicks. <br><br>  At the moment of pressing the button, we take the saved object, update the <code>text</code> property of the real selection object, using the property of the saved object.  If necessary, move the cursor.  Do not forget to call <code>select()</code> - it is important to do so that the result is displayed in the browser. <br><br><h4>  Brakes sometimes detect errors in logic </h4><br>  In one place in the JavaScript code (in the place where the audio player interface is created) a request was made to an external server via JSONP.  The handler function received the desired player (the one that was used in the <code>createPlayer()</code> function at the time of creating the request) by its id, which was calculated based on the response to the request, and assigned an attribute with the track URL, calculated from the same answer.  Everywhere, including IE8, everything worked well and as planned.  And in IE7, the function called via JSONP could not get the player's container object by id. <br><br>  It turned out that the problem was that at the time of the <code>getElementByID()</code> call, the message container in which the player's desired container was located was not yet added to the right place by the <code>appendChild()</code> method that was after calling <code>createMessage()</code> , which creates the message.  But already existed, and id had the right one.  In fact, elements created through <code>createElement()</code> do not become available instantly.  This is normal.  And of course, you should add an element to the DOM, and then access it.  But usually I first assign all handlers and fill the element with child nodes, and only then add it.  Therefore, here the evil joke was that the function handler code worked at an unknown point in time, and in IE7 the execution of the main thread was not completed by that moment (or the DOM was not updated). <br><br><h4>  Features of working with DOM also reveal errors in logic </h4><br>  Here everything was more interesting to some extent.  The xPlayer library has the ability to connect and remove "listeners" (when it was developed at the time, it was specifically done in case it was needed, and that's what was needed).  This feature was used to connect controllers (those players that appear in messages) to the master player at the top of the page.  The master player allows you to scroll the conversation and even switch between rooms, all the while having access to control playback.  When returning to the room where the track was launched (or loading the message block where it was launched), the required controller ‚Äúgrabs‚Äù when it is initialized.  The controller's initialization code compares the special uid formed from the URL and the track name with the master's uid, and by their coincidence, and concludes that this controller is ‚Äúthe same‚Äù.  At the same time, all controllers, without exception, when creating, have a set of functions that update their UI during various events.  And these functions are registered as ‚Äúlisteners‚Äù in the master. <br><br>  An unexpected error was revealed in IE8 - after switching to another room, the listener function continues to execute and crashes when trying to determine the <code>clientWidth</code> element that is removed from the document after cleaning the <code>innerHTML</code> viewport! <br><br>  On the one hand, the reference to the element was passed as the context when registering the function, and the garbage collector should not destroy the object, even though it is no longer part of the DOM.  But this is in other browsers - it looks like the object was just being destroyed, and the <code>clientWidth</code> property was <code>clientWidth</code> taken from the null pointer.  Other browsers did not issue any errors to the console (most likely <code>clientWidth</code> there was 0, and the object existed with all its descendants outside the DOM), and when returning to the old room everything worked fine. <br><br>  Here, when the controller returned, the scale of the controller was not ‚Äúpicked up‚Äù, and the scale of the master player continued to be updated all the time (the update function is assigned when starting playback via <code>setInterval()</code> , all the functions from the list are started from it). <br><br>  Obviously, the update function itself worked, but the listener function did not.  Well, the problem most likely was that the new listener function was added to the list upon returning to the previous room (with reference to the new object), but it didn‚Äôt have time to go to it, because when the old one that was in front of it started, the code fell from by mistake.  And the mistake is utterly banal - when changing a room, the list of functions-listeners should be cleared :) <br><br>  By the way, this is the problem and solved. <br><br><h4>  Safety first (IE8 and below) </h4><br>  Probably, everyone who has worked more or less with the development of interfaces, knows a simple technique how to style <code>input</code> <code>file</code> type.  It is enough to make it hidden, and by clicking on an arbitrary element that will play the role of a button, hang up a handler function, within which to make a call <br><br><pre> <code class="javascript hljs">input.click()</code> </pre><br>  But in IE8 and lower versions, if you try to submit a form with a file selected in this way (for example, through a call to <code>form.submit()</code> hung on the <code>onchange</code> on the <code>onchange</code> ), we get an error: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d67/df1/109/d67df1109a602fa8b6a9dad4bc4c2431.png" alt="image"><br><br>  Microsoft believes that this is an unsafe operation, so it gives us a hands-on.  Therefore, to stylize the file in the usual way in Internet Explorer will not work.  By the way, even if you make it visible through JS before submitting the form, nothing will change.  It is necessary that the file was chosen by direct click on the input.  Therefore, the only way is to make the input transparent using <code>filter: alpha(opacity=0)</code> , and put a stylized button under it.  Then the user will click on the real (transparent) input. <br><br><h4>  What about IE6? </h4><br>  With IE6, everything is bad. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/686/6c1/932/6866c19328721184d5f09bbb580dde2b.png" alt="image"><br><br>  I never really worked with this browser as a developer - it was not possible due to age.  But I read somewhere briefly that there was another block model in general, and in general a bunch of crutches were needed.  So far, in IE6 everything looks the same as in IE7 with an unspecified DOCTYPE (so-called quirks mode), or as in IE8 in the emulation mode ‚ÄúIE7: compatibility mode‚Äù. <br><br>  But if someone has ideas that need to be added in the styles, so that the situation at least slightly corrected - I will be grateful. <br><br><hr><br>  In addition, we should not forget that work with events everywhere was organized crossbrowser (otherwise the code will fall, and nothing good will happen), that the rounded corners of the elements, where it is vital, were made with pictures (or at least have pictures as an alternative fallback).  In addition, objects that have the effect of smooth appearance and fading through transparency will not have font smoothing (though this bug can be circumvented by assigning a filter before setting the <code>display</code> to the <code>block</code> , and removing it altogether after the effect is completed). <br><br>  Well, even after all this, a serious web application will work rather slowly (even the usual custom scrolling slows down, and with not very large amounts of content).  But at least with all these conditions, the resulting result can be called graceful degradation.  Probably. </div><p>Source: <a href="https://habr.com/ru/post/271545/">https://habr.com/ru/post/271545/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../271533/index.html">Carefully, true class contracts may differ from formal</a></li>
<li><a href="../271535/index.html">Preview Android Studio 2.0 is available: two uber features</a></li>
<li><a href="../271537/index.html">Install and configure LXC on Debian 8</a></li>
<li><a href="../271541/index.html">Tracking Notifications on Android 4.0-4.2</a></li>
<li><a href="../271543/index.html">Announcement of laboratory work on the development, testing and management of the life cycle of software for Visual Studio 2015</a></li>
<li><a href="../271547/index.html">Key Performance Indicator Analysis - Part 1</a></li>
<li><a href="../271549/index.html">Lock-free algorithms and stack implementation</a></li>
<li><a href="../271555/index.html">Machine learning as a method of analyzing the microstructure of the market and its application in high-frequency trading</a></li>
<li><a href="../271557/index.html">AndroCAD: Rise to Power. Electronics and Android</a></li>
<li><a href="../271559/index.html">Vector, open and easy to use: Inkscape 0.91</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>