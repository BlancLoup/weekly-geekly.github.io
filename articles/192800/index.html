<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>OSSEC: Big Brother is watching you</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Perhaps I‚Äôm not mistaken if I say that it is important for any professional system administrator to know what happens to his servers and when. This is...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>OSSEC: Big Brother is watching you</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/f3c/d58/b3c/f3cd58b3c83409a50b4d03e77d2f045e.png" alt="image"><br><br>  Perhaps I‚Äôm not mistaken if I say that it is important for any professional system administrator to know what happens to his servers and when.  This issue is particularly acute in the field of information security. <br>  In this post, I want to introduce you, colleagues, to a host-based IDS deployment called OSSEC.  I ask under the cat ... <br><a name="habracut"></a><br><br><h4>  Theory </h4><br>  <b>Intrusion Detection System (IDS)</b> - software (as in our case) or hardware designed to detect unauthorized access (intrusion or network attack) to a computer system or network. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Goals achieved with IDS: <br><br><ul><li>  The most important is to detect an intrusion or network attack. </li><li>  Predicting a possible invasion - the attacker usually performs a series of actions while probing your security, this will leave a mark </li><li>  Provide centralized control over network security (especially large and distributed) </li><li>  Many other goals you can think of yourself :) </li></ul><br>  IDS systems are divided into <b>network-based</b> and <b>host-based</b> . <br><br>  Network-based IDS identify attacks by capturing and analyzing network packets.  By listening to a network segment, NIDS can view network traffic from multiple hosts that are connected to a network segment, and thus protect these hosts. <br><br>  Host-based IDS deals with information collected within a single computer.  This advantageous location allows HIDS to analyze activities with great certainty and accuracy, identifying only those processes and users that are related to a specific attack in the OS.  NIDS typically use two types of information sources: OS audit results and system logs. <br><br>  OSSEC is HIDS, but has the ability to work on the architecture of the <b>server &lt;-&gt; agents</b> .  In our case, we will consider just such a scheme. <br><br><h4>  Initial data </h4><br>  Suppose that we have a certain corporate network in which there is a DMZ zone with servers, for which we want to watch closely. <br>  Let all servers work under CentOS 6.x (in fact, installation is possible under any distribution, including on other OS - for example Windows) <br>  There is a server not in the DMZ, for which we will collect all the information from the OSSEC agents. <br><br><h4>  Installation </h4><br>  First of all, let's install the OSSEC server itself. <br><br><pre><code class="bash hljs">wget -q -O - https://www.atomicorp.com/installers/atomic |sh &amp;&amp; yum install ossec-hids ossec-hids-server</code> </pre> <br>  We answer all questions in the affirmative; after yum completes, we will receive a working OSSSEC installation. <br>  All OSSEC files are stored in <b>/ var / ossec</b> .  Open the file <b>/var/ossec/ossec.conf</b> and bring it to the following form: <br><br><pre> <code class="bash hljs">&lt;ossec_config&gt; &lt;global&gt; &lt;email_notification&gt;yes&lt;/email_notification&gt; &lt;email_to&gt;root@domain.local&lt;/email_to&gt; &lt;smtp_server&gt;smtp.domain.local&lt;/smtp_server&gt; &lt;email_from&gt;osssec@domain.local&lt;/email_from&gt; &lt;email_maxperhour&gt;200&lt;/email_maxperhour&gt; &lt;/global&gt; &lt;rules&gt; &lt;include&gt;rules_config.xml&lt;/include&gt; &lt;include&gt;pam_rules.xml&lt;/include&gt; &lt;include&gt;sshd_rules.xml&lt;/include&gt; &lt;include&gt;telnetd_rules.xml&lt;/include&gt; &lt;include&gt;syslog_rules.xml&lt;/include&gt; &lt;include&gt;arpwatch_rules.xml&lt;/include&gt; &lt;include&gt;symantec-av_rules.xml&lt;/include&gt; &lt;include&gt;symantec-ws_rules.xml&lt;/include&gt; &lt;include&gt;pix_rules.xml&lt;/include&gt; &lt;include&gt;named_rules.xml&lt;/include&gt; &lt;include&gt;smbd_rules.xml&lt;/include&gt; &lt;include&gt;vsftpd_rules.xml&lt;/include&gt; &lt;include&gt;pure-ftpd_rules.xml&lt;/include&gt; &lt;include&gt;proftpd_rules.xml&lt;/include&gt; &lt;include&gt;ms_ftpd_rules.xml&lt;/include&gt; &lt;include&gt;ftpd_rules.xml&lt;/include&gt; &lt;include&gt;hordeimp_rules.xml&lt;/include&gt; &lt;include&gt;roundcube_rules.xml&lt;/include&gt; &lt;include&gt;wordpress_rules.xml&lt;/include&gt; &lt;include&gt;cimserver_rules.xml&lt;/include&gt; &lt;include&gt;vpopmail_rules.xml&lt;/include&gt; &lt;include&gt;vmpop3d_rules.xml&lt;/include&gt; &lt;include&gt;courier_rules.xml&lt;/include&gt; &lt;include&gt;web_rules.xml&lt;/include&gt; &lt;include&gt;web_appsec_rules.xml&lt;/include&gt; &lt;include&gt;apache_rules.xml&lt;/include&gt; &lt;include&gt;nginx_rules.xml&lt;/include&gt; &lt;include&gt;php_rules.xml&lt;/include&gt; &lt;include&gt;mysql_rules.xml&lt;/include&gt; &lt;include&gt;postgresql_rules.xml&lt;/include&gt; &lt;include&gt;ids_rules.xml&lt;/include&gt; &lt;include&gt;squid_rules.xml&lt;/include&gt; &lt;include&gt;firewall_rules.xml&lt;/include&gt; &lt;include&gt;cisco-ios_rules.xml&lt;/include&gt; &lt;include&gt;netscreenfw_rules.xml&lt;/include&gt; &lt;include&gt;sonicwall_rules.xml&lt;/include&gt; &lt;include&gt;postfix_rules.xml&lt;/include&gt; &lt;include&gt;sendmail_rules.xml&lt;/include&gt; &lt;include&gt;imapd_rules.xml&lt;/include&gt; &lt;include&gt;mailscanner_rules.xml&lt;/include&gt; &lt;include&gt;dovecot_rules.xml&lt;/include&gt; &lt;include&gt;ms-exchange_rules.xml&lt;/include&gt; &lt;include&gt;racoon_rules.xml&lt;/include&gt; &lt;include&gt;vpn_concentrator_rules.xml&lt;/include&gt; &lt;include&gt;spamd_rules.xml&lt;/include&gt; &lt;include&gt;msauth_rules.xml&lt;/include&gt; &lt;include&gt;mcafee_av_rules.xml&lt;/include&gt; &lt;include&gt;trend-osce_rules.xml&lt;/include&gt; &lt;include&gt;ms-se_rules.xml&lt;/include&gt; &lt;!-- &lt;include&gt;policy_rules.xml&lt;/include&gt; --&gt; &lt;include&gt;zeus_rules.xml&lt;/include&gt; &lt;include&gt;solaris_bsm_rules.xml&lt;/include&gt; &lt;include&gt;vmware_rules.xml&lt;/include&gt; &lt;include&gt;ms_dhcp_rules.xml&lt;/include&gt; &lt;include&gt;asterisk_rules.xml&lt;/include&gt; &lt;include&gt;ossec_rules.xml&lt;/include&gt; &lt;include&gt;attack_rules.xml&lt;/include&gt; &lt;include&gt;openbsd_rules.xml&lt;/include&gt; &lt;include&gt;clam_av_rules.xml&lt;/include&gt; &lt;include&gt;bro-ids_rules.xml&lt;/include&gt; &lt;include&gt;dropbear_rules.xml&lt;/include&gt; &lt;include&gt;local_rules.xml&lt;/include&gt; &lt;/rules&gt; &lt;syscheck&gt; &lt;!-- Frequency that syscheck is executed - default to every 22 hours --&gt; &lt;frequency&gt;79200&lt;/frequency&gt; &lt;!-- Directories to check (perform all possible verifications) --&gt; &lt;directories check_all=<span class="hljs-string"><span class="hljs-string">"yes"</span></span>&gt;/etc,/usr/bin,/usr/sbin&lt;/directories&gt; &lt;directories check_all=<span class="hljs-string"><span class="hljs-string">"yes"</span></span>&gt;/bin,/sbin&lt;/directories&gt; &lt;!-- Files/directories to ignore --&gt; &lt;ignore&gt;/etc/mtab&lt;/ignore&gt; &lt;ignore&gt;/etc/mnttab&lt;/ignore&gt; &lt;ignore&gt;/etc/hosts.deny&lt;/ignore&gt; &lt;ignore&gt;/etc/mail/statistics&lt;/ignore&gt; &lt;ignore&gt;/etc/random-seed&lt;/ignore&gt; &lt;ignore&gt;/etc/adjtime&lt;/ignore&gt; &lt;ignore&gt;/etc/httpd/logs&lt;/ignore&gt; &lt;ignore&gt;/etc/utmpx&lt;/ignore&gt; &lt;ignore&gt;/etc/wtmpx&lt;/ignore&gt; &lt;ignore&gt;/etc/cups/certs&lt;/ignore&gt; &lt;ignore&gt;/etc/dumpdates&lt;/ignore&gt; &lt;ignore&gt;/etc/svc/volatile&lt;/ignore&gt; &lt;/syscheck&gt; &lt;rootcheck&gt; &lt;rootkit_files&gt;/var/ossec//etc/shared/rootkit_files.txt&lt;/rootkit_files&gt; &lt;rootkit_trojans&gt;/var/ossec//etc/shared/rootkit_trojans.txt&lt;/rootkit_trojans&gt; &lt;system_audit&gt;/var/ossec//etc/shared/system_audit_rcl.txt&lt;/system_audit&gt; &lt;system_audit&gt;/var/ossec//etc/shared/cis_rhel_linux_rcl.txt&lt;/system_audit&gt; &lt;system_audit&gt;/var/ossec//etc/shared/cis_rhel5_linux_rcl.txt&lt;/system_audit&gt; &lt;/rootcheck&gt; &lt;global&gt; &lt;white_list&gt;127.0.0.1&lt;/white_list&gt; &lt;white_list&gt;^localhost.localdomain$&lt;/white_list&gt; &lt;/global&gt; &lt;remote&gt; &lt;connection&gt;syslog&lt;/connection&gt; &lt;/remote&gt; &lt;remote&gt; &lt;connection&gt;secure&lt;/connection&gt; &lt;/remote&gt; &lt;alerts&gt; &lt;log_alert_level&gt;1&lt;/log_alert_level&gt; &lt;email_alert_level&gt;7&lt;/email_alert_level&gt; &lt;/alerts&gt; &lt;<span class="hljs-built_in"><span class="hljs-built_in">command</span></span>&gt; &lt;name&gt;host-deny&lt;/name&gt; &lt;executable&gt;host-deny.sh&lt;/executable&gt; &lt;expect&gt;srcip&lt;/expect&gt; &lt;timeout_allowed&gt;yes&lt;/timeout_allowed&gt; &lt;/<span class="hljs-built_in"><span class="hljs-built_in">command</span></span>&gt; &lt;<span class="hljs-built_in"><span class="hljs-built_in">command</span></span>&gt; &lt;name&gt;firewall-drop&lt;/name&gt; &lt;executable&gt;firewall-drop.sh&lt;/executable&gt; &lt;expect&gt;srcip&lt;/expect&gt; &lt;timeout_allowed&gt;yes&lt;/timeout_allowed&gt; &lt;/<span class="hljs-built_in"><span class="hljs-built_in">command</span></span>&gt; &lt;<span class="hljs-built_in"><span class="hljs-built_in">command</span></span>&gt; &lt;name&gt;<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-account&lt;/name&gt; &lt;executable&gt;<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-account.sh&lt;/executable&gt; &lt;expect&gt;user&lt;/expect&gt; &lt;timeout_allowed&gt;yes&lt;/timeout_allowed&gt; &lt;/<span class="hljs-built_in"><span class="hljs-built_in">command</span></span>&gt; &lt;<span class="hljs-built_in"><span class="hljs-built_in">command</span></span>&gt; &lt;name&gt;restart-ossec&lt;/name&gt; &lt;executable&gt;restart-ossec.sh&lt;/executable&gt; &lt;expect&gt;&lt;/expect&gt; &lt;/<span class="hljs-built_in"><span class="hljs-built_in">command</span></span>&gt; &lt;<span class="hljs-built_in"><span class="hljs-built_in">command</span></span>&gt; &lt;name&gt;route-null&lt;/name&gt; &lt;executable&gt;route-null.sh&lt;/executable&gt; &lt;expect&gt;srcip&lt;/expect&gt; &lt;timeout_allowed&gt;yes&lt;/timeout_allowed&gt; &lt;/<span class="hljs-built_in"><span class="hljs-built_in">command</span></span>&gt; &lt;!-- Active Response Config --&gt; &lt;active-response&gt; &lt;!-- This response is going to execute the host-deny - <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> every event that fires a rule with - level (severity) &gt;= 6. - The IP is going to be blocked <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> 600 seconds. --&gt; &lt;<span class="hljs-built_in"><span class="hljs-built_in">command</span></span>&gt;host-deny&lt;/<span class="hljs-built_in"><span class="hljs-built_in">command</span></span>&gt; &lt;location&gt;<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>&lt;/location&gt; &lt;level&gt;6&lt;/level&gt; &lt;timeout&gt;600&lt;/timeout&gt; &lt;/active-response&gt; &lt;active-response&gt; &lt;!-- Firewall Drop response. Block the IP <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> - 600 seconds on the firewall (iptables, - ipfilter, etc). --&gt; &lt;<span class="hljs-built_in"><span class="hljs-built_in">command</span></span>&gt;firewall-drop&lt;/<span class="hljs-built_in"><span class="hljs-built_in">command</span></span>&gt; &lt;location&gt;<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>&lt;/location&gt; &lt;level&gt;6&lt;/level&gt; &lt;timeout&gt;600&lt;/timeout&gt; &lt;/active-response&gt; &lt;localfile&gt; &lt;log_format&gt;syslog&lt;/log_format&gt; &lt;location&gt;/var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/messages&lt;/location&gt; &lt;/localfile&gt; &lt;localfile&gt; &lt;log_format&gt;syslog&lt;/log_format&gt; &lt;location&gt;/var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/secure&lt;/location&gt; &lt;/localfile&gt; &lt;localfile&gt; &lt;log_format&gt;syslog&lt;/log_format&gt; &lt;location&gt;/var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/xferlog&lt;/location&gt; &lt;/localfile&gt; &lt;localfile&gt; &lt;log_format&gt;syslog&lt;/log_format&gt; &lt;location&gt;/var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/maillog&lt;/location&gt; &lt;/localfile&gt; &lt;localfile&gt; &lt;log_format&gt;apache&lt;/log_format&gt; &lt;location&gt;/var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/httpd/error_log&lt;/location&gt; &lt;/localfile&gt; &lt;localfile&gt; &lt;log_format&gt;apache&lt;/log_format&gt; &lt;location&gt;/var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/httpd/access_log&lt;/location&gt; &lt;/localfile&gt; &lt;/ossec_config&gt;</code> </pre><br>  Let's see what is there.  At the very beginning we include sending alerts to the mail, indicating the server address, mailing address and the maximum possible number of emails per hour.  By default, OSSEC groups events so as not to overwhelm you with a stream of letters. <br>  Next is the <b>rules</b> block, which describes what and how OSSEC will react - you can leave everything, according to my observations, not to affect the speed of work.  The <b>syscheck</b> section is the settings of the so-called <b>integrity check</b> .  Its meaning is that the IDS counts the hash of each file in the specified directories and periodically compares them.  Here we ask which directories we will monitor and after how much time will be checked.  The <b>command</b> section describes the scripts that IDS can use when certain conditions occur.  The <b>active-response</b> section uses these commands.  For example, when a certain rule fires, a <b>firewall-block</b> will put src ip into iptables for 600 seconds.  Convenient to use from brute force.  At the very end, we have the actual log files that need to be analyzed and compared with the rules. <br>  This completes the rough setup of the OSSEC server part and we can start it: <br><br><pre> <code class="bash hljs">service ossec-hids start</code> </pre><br>  If successful, a letter with a message about the start will be sent to the e-mail address you specified: <br><br><pre> <code class="bash hljs">OSSEC HIDS Notification. 2013 Sep 06 13:10:35 Received From: server.domain.local-&gt;ossec-monitord Rule: 502 fired (level 3) -&gt; <span class="hljs-string"><span class="hljs-string">"Ossec server started."</span></span> Portion of the <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>(s): ossec: Ossec started. --END OF NOTIFICATION</code> </pre><br>  If the launch fails, check the configuration again for errors.  The help will be the <b>/var/ossec/logs/ossec.log</b> file. <br><br><h5>  Installing a web interface </h5><br>  The web interface is quite primitive, but for the sake of convenience, you can install <br><br><pre> <code class="bash hljs">wget ‚Äìc http://www.ossec.net/files/ossec-wui-0.3.tar.gz tar xzvf ossec-wui-0.3.tar.gz mv ossec-wui-0.3 /var/www/html/ossec <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /var/www/html/ossec/ ./setup.sh</code> </pre><br>  Here you will need to enter a login and password, the .htaccess file will be created accordingly.  Now add the ossec user to the apache group <br><br><pre> <code class="bash hljs">nano /etc/group ossec:x:494:ossec,ossecr,ossecm,ossece,apache service httpd restart</code> </pre><br>  We open the browser on our page, then give the tmp folder rights: <br><br><pre> <code class="bash hljs">chmod 770 /var/www/html/ossec/tmp chgrp apache /var/www/html/ossec/tmp</code> </pre><br>  Now we can see the events registered in OSSEC and use a simple interface. <br><br><h5>  Agent installation </h5><br>  Install agents on the server in the DMZ <br><br><pre> <code class="bash hljs">wget -q -O - https://www.atomicorp.com/installers/atomic |sh &amp;&amp; yum install ossec-hids ossec-hids-client</code> </pre><br>  Edit the <b>/var/ossec/ossec.conf</b> file and bring it to the following form: <br><br><pre> <code class="bash hljs">&lt;ossec_config&gt; &lt;client&gt; &lt;server-ip&gt;&lt;b&gt;server.domain.local&lt;/b&gt;&lt;/server-ip&gt; &lt;/client&gt; &lt;syscheck&gt; &lt;!-- Frequency that syscheck is executed -- default every 2 hours --&gt; &lt;frequency&gt;7200&lt;/frequency&gt; &lt;!-- Directories to check (perform all possible verifications) --&gt; &lt;directories check_all=<span class="hljs-string"><span class="hljs-string">"yes"</span></span>&gt;/etc,/usr/bin,/usr/sbin&lt;/directories&gt; &lt;directories check_all=<span class="hljs-string"><span class="hljs-string">"yes"</span></span>&gt;/bin,/sbin&lt;/directories&gt; &lt;!-- Files/directories to ignore --&gt; &lt;ignore&gt;/etc/mtab&lt;/ignore&gt; &lt;ignore&gt;/etc/mnttab&lt;/ignore&gt; &lt;ignore&gt;/etc/hosts.deny&lt;/ignore&gt; &lt;ignore&gt;/etc/mail/statistics&lt;/ignore&gt; &lt;ignore&gt;/etc/random-seed&lt;/ignore&gt; &lt;ignore&gt;/etc/adjtime&lt;/ignore&gt; &lt;ignore&gt;/etc/httpd/logs&lt;/ignore&gt; &lt;ignore&gt;/etc/utmpx&lt;/ignore&gt; &lt;ignore&gt;/etc/wtmpx&lt;/ignore&gt; &lt;ignore&gt;/etc/cups/certs&lt;/ignore&gt; &lt;/syscheck&gt; &lt;rootcheck&gt; &lt;rootkit_files&gt;/var/ossec/etc/shared/rootkit_files.txt&lt;/rootkit_files&gt; &lt;rootkit_trojans&gt;/var/ossec/etc/shared/rootkit_trojans.txt&lt;/rootkit_trojans&gt; &lt;/rootcheck&gt; &lt;localfile&gt; &lt;log_format&gt;syslog&lt;/log_format&gt; &lt;location&gt;/var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/messages&lt;/location&gt; &lt;/localfile&gt; &lt;localfile&gt; &lt;log_format&gt;syslog&lt;/log_format&gt; &lt;location&gt;/var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/secure&lt;/location&gt; &lt;/localfile&gt; &lt;localfile&gt; &lt;log_format&gt;syslog&lt;/log_format&gt; &lt;location&gt;/var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/maillog&lt;/location&gt; &lt;/localfile&gt; &lt;localfile&gt; &lt;log_format&gt;apache&lt;/log_format&gt; &lt;location&gt;/var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/httpd/error_log&lt;/location&gt; &lt;/localfile&gt; &lt;localfile&gt; &lt;log_format&gt;apache&lt;/log_format&gt; &lt;location&gt;/var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/httpd/access_log&lt;/location&gt; &lt;/localfile&gt; &lt;localfile&gt; &lt;log_format&gt;syslog&lt;/log_format&gt; &lt;location&gt;/var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/proftpd/error.log&lt;/location&gt; &lt;/localfile&gt; &lt;/ossec_config&gt;</code> </pre><br>  As you can see, this config is very similar to the truncated server.  The main thing that you need to specify here is the actual OSSEC server address itself and log files.  I added a proftpd log file for an example. <br>  Communication between the client and the server takes place on the <b>UDP / 1514</b> port, do not forget to open it! <br><br>  With the installation and configuration we have finished, now we need to associate the server with the agent.  To do this, we will launch a special utility <b>/ var / ossec / bin / manage_agents on the server</b> <br><br><pre> <code class="bash hljs">**************************************** * OSSEC HIDS v2.7 Agent manager. * * The following options are available: * **************************************** (A)dd an agent (A). (E)xtract key <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> an agent (E). (L)ist already added agents (L). (R)emove an agent (R). (Q)uit. Choose your action: A,E,L,R or Q: a - Adding a new agent (use <span class="hljs-string"><span class="hljs-string">'\q'</span></span> to <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> to the main menu). Please provide the following: * A name <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the new agent: ftp-server * The IP Address of the new agent: 192.168.0.2 * An ID <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the new agent[001]: Agent information: ID:001 Name:ftp-server IP Address:192.168.0.2 Confirm adding it?(y/n): y Agent added. **************************************** * OSSEC HIDS v2.7 Agent manager. * * The following options are available: * **************************************** (A)dd an agent (A). (E)xtract key <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> an agent (E). (L)ist already added agents (L). (R)emove an agent (R). (Q)uit. Choose your action: A,E,L,R or Q: e Available agents: ID: 001, Name: ftp-server, IP: 192.168.0.2 Provide the ID of the agent to extract the key (or <span class="hljs-string"><span class="hljs-string">'\q'</span></span> to quit): 001 Agent key information <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-string"><span class="hljs-string">'001'</span></span> is: MDA3IGZ0cC1zZXJ1ZXIgMTkyLjE2OC4wLjIgOTQyODg5ODg2NDI5MGNiYTkzYTU1N2I5Yzg5OWTwNTJhNzQ2ZDdlYmNkNzM3NGYyZWQyZGQyZmFlNjdjMjZmOA== ** Press ENTER to <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> to the main menu. **************************************** * OSSEC HIDS v2.7 Agent manager. * * The following options are available: * **************************************** (A)dd an agent (A). (E)xtract key <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> an agent (E). (L)ist already added agents (L). (R)emove an agent (R). (Q)uit. Choose your action: A,E,L,R or Q: q ** You must restart OSSEC <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> your changes to take effect. manage_agents: Exiting ..</code> </pre><br><br>  As you can see - everything is simple.  The result of the work will be a BASE64 string that you want to copy and paste to the agent.  Do not forget to restart the server: <br><br><pre> <code class="bash hljs">service ossec-hid restart</code> </pre><br>  Now run the <b>/ var / ossec / bin / manage_client command</b> on the agent: <br><br><pre> <code class="bash hljs">**************************************** * OSSEC HIDS v2.7 Agent manager. * * The following options are available: * **************************************** (I)mport key from the server (I). (Q)uit. Choose your action: I or Q: i * Provide the Key generated by the server. * The best approach is to cut and paste it. *** OBS: Do not include spaces or new lines. Paste it here (or <span class="hljs-string"><span class="hljs-string">'\q'</span></span> to quit): MDA3IGZ0cC1zZXJ1ZXIgMTkyLjE2OC4wLjIgOTQyODg5ODg2NDI5MGNiYTkzYTU1N2I5Yzg5OWTwNTJhNzQ2ZDdlYmNkNzM3NGYyZWQyZGQyZmFlNjdjMjZmOA== ** Press ENTER to <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> to the main menu. **************************************** * OSSEC HIDS v2.7 Agent manager. * * The following options are available: * **************************************** (I)mport key from the server (I). (Q)uit. Choose your action: I or Q: q manage_agents: Exiting ..</code> </pre><br>  Restart agent: <br><br><pre> <code class="bash hljs">service ossec-hid restart</code> </pre><br>  Go to the server console and check that the agent is connected: <br><br><pre> <code class="bash hljs">/var/ossec/bin/list_agents -a ftp-server-192.168.0.2 is available.</code> </pre><br><br>  At this setting can be considered over.  What to do next?  OSSEC is very flexible and powerful IDS.  You can write your own rules - their format is very simple.  You can manage agents from the server, assign them a configuration from there, link IDS with another IDS (for example, with NIDS Snort), and much more. <br>  If you did everything correctly, you can now control all the changes at the file level and possible attacks. <br><br><h4>  Links </h4><br><ul><li>  <a href="http://www.ossec.net/">www.ossec.net</a> </li><li>  <a href="http://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D0%25BE%25D0%25B1%25D0%25BD%25D0%25B0%25D1%2580%25D1%2583%25D0%25B6%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F_%25D0%25B2%25D1%2582%25D0%25BE%25D1%2580%25D0%25B6%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B9">ru.wikipedia.org/wiki/%D0%A1%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B0_%D0%BE%D0%B1%D0%BD%D0 % B0% D1% 80% D1% 83% D0% B6% D0% B5% D0% BD% D0% B8% D1% 8F_% D0% B2% D1% 82% D0% BE% D1% 80% D0% B6 % D0% B5% D0% BD% D0% B8% D0% B9</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/192800/">https://habr.com/ru/post/192800/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../192796/index.html">Brave new IT world!</a></li>
<li><a href="../192798/index.html">About the value of direct communication with the user</a></li>
<li><a href="../192804/index.html">Samsung Mobile SDK and Samsung Smart App Challenge 2013 for GALAXY Note</a></li>
<li><a href="../192806/index.html">Does JavaScript need classes? part 2</a></li>
<li><a href="../192814/index.html">Welcome to the blog KamaGames Studio</a></li>
<li><a href="../192816/index.html">Review Tizen SDK. Native</a></li>
<li><a href="../192818/index.html">Simplify the life of the administrator, associate the user name and computer name in automatic mode in the AD directory</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>