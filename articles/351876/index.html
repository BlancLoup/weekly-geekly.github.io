<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Aws Lambda Go 1.x, Kinesis, CloudSearch</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the previous article I described how to create a simple lambda on Golang, which takes as input a simple object of two fields and gives the same sim...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Aws Lambda Go 1.x, Kinesis, CloudSearch</h1><div class="post__text post__text-html js-mediator-article">  In the <a href="https://habrahabr.ru/post/351744/">previous</a> article I described how to create a simple lambda on Golang, which takes as input a simple object of two fields and gives the same simple object at the output.  Now let's complicate the task a bit by connecting Kinesis to the lambda as a data source, and we will transfer the result of processing Kinesis records to CloudSearch.  No special logic in lambda will be simplified: just accept requests from Kinesis, log them in to CloudWatch, convert and send to CloudSearch. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c34/065/edc/c34065edcb926b91b060d40b3b4ff2cf.png" alt="image"><br><br><a name="habracut"></a><br>  The Kinesis event that we expect to receive in the function is as follows: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"Records"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"awsRegion"</span></span>: <span class="hljs-string"><span class="hljs-string">"us-east-1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"eventID"</span></span>: <span class="hljs-string"><span class="hljs-string">"&lt;event-id&gt;"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"eventName"</span></span>: <span class="hljs-string"><span class="hljs-string">"aws:kinesis:record"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"eventSource"</span></span>: <span class="hljs-string"><span class="hljs-string">"aws:kinesis"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"eventSourceARN"</span></span>: <span class="hljs-string"><span class="hljs-string">"arn:aws:kinesis:us-east-1:&lt;xxxxxxxx&gt;:stream/&lt;stream&gt;"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"eventVersion"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"invokeIdentityArn"</span></span>: <span class="hljs-string"><span class="hljs-string">"arn:aws:iam::&lt;xxxxxx&gt;:role/&lt;role&gt;"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"kinesis"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"approximateArrivalTimestamp"</span></span>: &lt;timestamp&gt;, <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: &lt;data&gt;, <span class="hljs-attr"><span class="hljs-attr">"partitionKey"</span></span>: <span class="hljs-string"><span class="hljs-string">"&lt;partionkey&gt;"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sequenceNumber"</span></span>: <span class="hljs-string"><span class="hljs-string">"&lt;sequenceNumber&gt;"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"kinesisSchemaVersion"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0"</span></span> } } ] }</code> </pre> <br><br>  Here we are interested in the data field.  The code of the Lambda function that receives events from Kinesis and logs the data of the data field is described below: (The code is taken <a href="">here</a> ): <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"context"</span></span> <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"github.com/aws/aws-lambda-go/events"</span></span> <span class="hljs-string"><span class="hljs-string">"github.com/aws/aws-lambda-go/lambda"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ctx context.Context, kinesisEvent events.KinesisEvent)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, record := <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> kinesisEvent.Records { kinesisRecord := record.Kinesis dataBytes := kinesisRecord.Data dataText := <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>(dataBytes) fmt.Printf(<span class="hljs-string"><span class="hljs-string">"%s Data = %s \n"</span></span>, record.EventName, dataText) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { lambda.Start(handler) }</code> </pre> <br><br>  Now you need to supplement the code to write the changed data in CloudSearch <br>  Here we will generate the data from Kinesis into our submission for the search domain (CloudSearch). <br><br>  Kinesis data comes in a base64 encoded form in the <b>data</b> field.  After decoding, the data contains the following fields: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> KinesisEventData <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { FilePath <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-string"><span class="hljs-string">`json:"filePath"`</span></span> Id <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-string"><span class="hljs-string">`json:"id"`</span></span> }</code> </pre> <br><br>  In CloudSearch, we send the following data: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> CloudSearchDocument <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Directory <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-string"><span class="hljs-string">`json:"dir"`</span></span> FileName <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-string"><span class="hljs-string">`json:"name"`</span></span> FileExtension <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-string"><span class="hljs-string">`json:"ext"`</span></span> }</code> </pre> <br><br>  In this case, the id field will be stored in the document identifier.  The preparation of data for upload to CloudSearch can be found <a href="https://docs.aws.amazon.com/cloudsearch/latest/developerguide/preparing-data.html">here</a> in detail.  In short, in CloudSearch we send the following json: <br><br><pre> <code class="hljs json">[ {<span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"add"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"12345"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"fields"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"dir"</span></span>: <span class="hljs-string"><span class="hljs-string">":"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"file.txt"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ext"</span></span>: <span class="hljs-string"><span class="hljs-string">"txt"</span></span> } } ]</code> </pre> <br>  where <i>type</i> is a type of request that takes two values: add or delete;  <i>id</i> is the document identifier, and in our case the value stored in the object from kinesis in the <b>Id</b> field;  <i>fields</i> are name-value pairs that we save in the search domain, in our case, an object of type CloudSearchDocument. <br><br>  The code below converts the data from the Records collection of an object from Kinesis into a collection of data ready for upload to CloudSearch: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> amasonDocumentsBatch []AmazonDocumentUploadRequest <span class="hljs-comment"><span class="hljs-comment">//Preparing data for _, record := range kinesisEvent.Records { kinesisRecord := record.Kinesis dataBytes := kinesisRecord.Data fmt.Printf("%s Data = %s \n", record.EventName, string(dataBytes)) //Deserialize data from kinesis to KinesisEventData var eventData KinesisEventData err := json.Unmarshal(dataBytes, &amp;eventData) if err != nil { return failed(), err } //Convert data to CloudSearch format document := ConvertToCloudSearchDocument(eventData) request := CreateAmazonDocumentUploadRequest(eventData.Id, document) amasonDocumentsBatch = append(amasonDocumentsBatch, request) }</span></span></code> </pre><br><br>  The following code connects to the search domain to load previously prepared data into it: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">len</span></span>(amasonDocumentsBatch) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> { fmt.Print(<span class="hljs-string"><span class="hljs-string">"Connecting to cloudsearch...\n"</span></span>) svc := cloudsearchdomain.New(session.New(&amp;aws.Config{ Region: aws.String(os.Getenv(<span class="hljs-string"><span class="hljs-string">"SearchRegion"</span></span>)), Endpoint: aws.String(os.Getenv(<span class="hljs-string"><span class="hljs-string">"SearchEndpoint"</span></span>)), MaxRetries: aws.Int(<span class="hljs-number"><span class="hljs-number">6</span></span>), })) fmt.Print(<span class="hljs-string"><span class="hljs-string">"Creating request...\n"</span></span>) batch, err := json.Marshal(amasonDocumentsBatch) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> failed(), err } fmt.Printf(<span class="hljs-string"><span class="hljs-string">"Search document = %s \n"</span></span>, batch) params := &amp;cloudsearchdomain.UploadDocumentsInput{ ContentType: aws.String(<span class="hljs-string"><span class="hljs-string">"application/json"</span></span>), Documents: strings.NewReader(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>(batch)), } fmt.Print(<span class="hljs-string"><span class="hljs-string">"Starting to upload...\n"</span></span>) req, resp := svc.UploadDocumentsRequest(params) fmt.Print(<span class="hljs-string"><span class="hljs-string">"Send request...\n"</span></span>) err = req.Send() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> failed(), err } fmt.Println(resp) }</code> </pre><br><br>  In order to compile the code, it is necessary to load the aws <i>-sdk-go</i> and <i>aws-lambda-go files</i> : <br><br><pre> <code class="bash hljs">go get -u github.com/aws/aws-lambda-go/cmd/build-lambda-zip go get -d github.com/aws/aws-sdk-go/</code> </pre> <br>  How to collect and close the lambda described in the <a href="https://habrahabr.ru/post/351744/">previous</a> article, here it is only necessary to add environment variables through the Lambda console and prepare new test data: <br><br><pre> <code class="go hljs">os.Getenv(<span class="hljs-string"><span class="hljs-string">"SearchRegion"</span></span>) os.Getenv(<span class="hljs-string"><span class="hljs-string">"SearchEndpoint"</span></span>)</code> </pre><br><br>  The full code is available <a href="https://github.com/GolovinskayaAlbina/amazon-lambda-kinesis-cloudsearch">here</a> . <br><br>  But first, open the CloudSearch console and create a search domain.  For the domain, I will choose the most minimal instance and the number of replications = 1. Next, you need to create the fields <b>dir</b> , <b>name</b> , <b>ext</b> .  For these fields, I will select the string type, but some of them may have a different type, for example, a literal field.  But it all depends on how you will manipulate these fields.  For more information, read Amazon documentation. <br><br>  Create a search domain (button <i>Create a new Domain</i> ), fill in the name and select the instance type: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/493/90d/889/49390d8898fbc1a7d759977014e56cfd.png" alt="image"><br><br>  Create fields: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/532/5ef/c4c/5325efc4ca8c19ae569b734534b1025f.png" alt="image"><br><br>  The domain is created about 10 minutes. After it becomes active, you will have the Url of the search domain that you need to enter in the environment variables in the Lambda console, do not forget to specify the protocol as in the image below in front of the Url, and also specify the region in which search domain: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d64/0c4/8c9/d640c48c929ed81ebc247e7514a74c79.png" alt="image"><br><br>  Now do not forget to issue the rights lambda through the IAM console for working with Kinesis, CloudWatch and CloudSearch.  Kinesis can be connected via the Lambda console: to do this, select it in the <i>Add triggers box</i> and fill in the fields, indicating the stream existing in the region, the number of records in the batch and the position in the stream with which reading will begin.  We can test the work of the lambda without connecting it to kinesis, for this you need to create a test and add the following json to it: <br><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"Records"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"awsRegion"</span></span>: <span class="hljs-string"><span class="hljs-string">"us-east-1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"eventID"</span></span>: <span class="hljs-string"><span class="hljs-string">"shardId-000000000001:1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"eventName"</span></span>: <span class="hljs-string"><span class="hljs-string">"aws:kinesis:record"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"eventSource"</span></span>: <span class="hljs-string"><span class="hljs-string">"aws:kinesis"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"eventSourceARN"</span></span>: <span class="hljs-string"><span class="hljs-string">"arn:aws:kinesis:us-east-1:xxx"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"eventVersion"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"invokeIdentityArn"</span></span>: <span class="hljs-string"><span class="hljs-string">"arn:aws:iam::xxx"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"kinesis"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"approximateArrivalTimestamp"</span></span>: <span class="hljs-number"><span class="hljs-number">1522222222.06</span></span>, <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: <span class="hljs-string"><span class="hljs-string">"eyJpZCI6IDEyMzQ1LCJmaWxlUGF0aCI6ICJDOlxcZmlsZS50eHQifQ=="</span></span>, <span class="hljs-attr"><span class="hljs-attr">"partitionKey"</span></span>: <span class="hljs-string"><span class="hljs-string">"key"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sequenceNumber"</span></span>: <span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"kinesisSchemaVersion"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0"</span></span> } }, { <span class="hljs-attr"><span class="hljs-attr">"awsRegion"</span></span>: <span class="hljs-string"><span class="hljs-string">"us-east-1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"eventID"</span></span>: <span class="hljs-string"><span class="hljs-string">"shardId-000000000001:1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"eventName"</span></span>: <span class="hljs-string"><span class="hljs-string">"aws:kinesis:record"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"eventSource"</span></span>: <span class="hljs-string"><span class="hljs-string">"aws:kinesis"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"eventSourceARN"</span></span>: <span class="hljs-string"><span class="hljs-string">"arn:aws:kinesis:us-east-1:xxx"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"eventVersion"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"invokeIdentityArn"</span></span>: <span class="hljs-string"><span class="hljs-string">"arn:aws:iam::xxx"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"kinesis"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"approximateArrivalTimestamp"</span></span>: <span class="hljs-number"><span class="hljs-number">1522222222.06</span></span>, <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: <span class="hljs-string"><span class="hljs-string">"eyJpZCI6IDEyMzQ2LCJmaWxlUGF0aCI6ICJDOlxcZm9sZGVyXFxmaWxlLnR4dCJ9"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"partitionKey"</span></span>: <span class="hljs-string"><span class="hljs-string">"key"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sequenceNumber"</span></span>: <span class="hljs-string"><span class="hljs-string">"2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"kinesisSchemaVersion"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0"</span></span> } } ] }</code> </pre> <br><br>  To generate other values ‚Äã‚Äãof the <b>data</b> field, you can use the <a href="https://play.golang.org/p/-EYSnIQcKPv">link</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dcf/5bf/ee9/dcf5bfee9562d2d3f2eac2971aa4f773.png" alt="image"><br><br>  The result of the work can also be viewed in the search domain: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9e5/1c1/b77/9e51c1b77fce56c15897bdbc0428bc69.png" alt="image"><br><br>  Additional materials: <br><br>  <a href="http://takuan.hateblo.jp/entry/2016/05/17/golang%25E3%2581%258B%25E3%2582%2589cloudsearch%25E3%2582%2592%25E4%25BD%25BF%25E3%2581%2586">Search code for</a> documents in the search domain on Go. <br><br>  The next article will discuss the CloudFormation script for the automatic creation and connection of Lambda, Kinesis, CloudSearch. </div><p>Source: <a href="https://habr.com/ru/post/351876/">https://habr.com/ru/post/351876/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../351866/index.html">New Aether Cloud Console for Enterprise Security Management</a></li>
<li><a href="../351868/index.html">We use PHP for its intended purpose</a></li>
<li><a href="../351870/index.html">Simulation systems: choose the appropriate</a></li>
<li><a href="../351872/index.html">CIS Controls V7: Information Security Recommendations</a></li>
<li><a href="../351874/index.html">Tasks with interviews (front-end)</a></li>
<li><a href="../351878/index.html">Terraform: a new approach to Infrastructure as code</a></li>
<li><a href="../351880/index.html">As a result of the toxic manual, Telltale Games lost the best developers.</a></li>
<li><a href="../351882/index.html">Vue.js and how to understand it</a></li>
<li><a href="../351884/index.html">This is not ‚Äúa real job, but a better job‚Äù: as a hiring policy, Crossover allows you to pay employees above the market</a></li>
<li><a href="../351886/index.html">Controller for Lego</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>