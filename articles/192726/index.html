<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>An example of developing a blog on Zend Framework 2. Part 3. Working with users</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is the third (last?) Part of an article devoted to the development of a simple application using Zend Framework 2. In the first part I reviewed t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>An example of developing a blog on Zend Framework 2. Part 3. Working with users</h1><div class="post__text post__text-html js-mediator-article">  This is the third (last?) Part of an article devoted to the development of a simple application using Zend Framework 2. <a href="http://habrahabr.ru/post/192522/">In the first part</a> I reviewed the structure of ZendSkeletonApplication, <a href="http://habrahabr.ru/post/192608/">in the second part I</a> gave an example of developing a simple module.  This part is dedicated to working with users, and I will also bolt the Twig template engine to the project. <br><br><h2>  Work with users </h2><br>  The code written in the previous sections allows you to create, edit and delete blog posts for all site visitors.  Such an approach is unacceptable for any working site, so now is the time to resolve the issues of registration / authorization and distribution of access rights to the various features of the application. <br><br><h3>  Zf commons </h3><br>  For Zend framework, quite a few modules are written that solve standard tasks, you can find them on a special website: <a href="http://modules.zendframework.com/">modules.zendframework.com</a> .  Instead of developing my bikes for solving standard tasks, I consider it more correct to use / adapt ready-made solutions for myself (at least you need to study ready-made solutions before starting to develop a bicycle). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Among the many developers of modules, the ZF Commons team stands out, the guys from this team have developed a number of very useful modules that we will use in this project: <a href="https://github.com/ZF-Commons">github.com/ZF-Commons</a> .  Consider some of them that we need at this stage. <br><a name="habracut"></a><br><h4>  Zfcbase </h4><br>  The kernel on which other ZF Commons modules depend ( <a href="https://github.com/ZF-Commons/ZfcBase">https://github.com/ZF-Commons/ZfcBase</a> ). <br><br><h4>  ZfcUser </h4><br>  A module that implements user registration / authorization mechanisms, a user profile and View helpers for use in templates ( <a href="https://github.com/ZF-Commons/ZfcUser">https://github.com/ZF-Commons/ZfcUser</a> ). <br><br><h4>  ZfcUserDoctrineORM </h4><br>  By default, ZfcUser works with the standard framework for working with the database, since our project uses Doctrine ORM, we also need the ZfcUserDoctrineORM module ( <a href="https://github.com/ZF-Commons/ZfcUserDoctrineORM">https://github.com/ZF-Commons/ZfcUserDoctrineORM</a> ). <br><br><h4>  ZfcTwig </h4><br>  Module for integration with Twig template engine ( <a href="https://github.com/ZF-Commons/ZfcTwig">https://github.com/ZF-Commons/ZfcTwig</a> ). <br><br><h3>  BjyAuthorize </h3><br>  In addition to the modules from ZfCommons, I will use the BjyAuthorize module, which provides a convenient mechanism for distributing access rights.  The logic of the module is simple and common among other frameworks.  The module uses the following concepts: user, role and guard. <br><br>  The user can be authorized and not authorized.  An authorized user can have one or more roles.  Guard in this context is the controller / action to which we configure access rights for different roles. <br><br><h3>  Preparing to set up users </h3><br>  Before setting up work with users, you must create an entity for the user and the roles that will be used by the Doctrine.  Included with the BjyAuthorize module are examples of such entities, on the basis of which I created the MyUser module. <br><br>  The module does not contain anything original, you can see its code here: <a href="https://github.com/romka/zend-blog-example/tree/master/module/MyUser">github.com/romka/zend-blog-example/tree/master/module/MyUser</a> , in its structure it does not differ from the above Application and MyBlog modules: it contains the config and 2 entity. <br><br>  Attention should be paid only to its config ( <a href="https://github.com/romka/zend-blog-example/blob/master/module/MyUser/config/module.config.php">https://github.com/romka/zend-blog-example/blob/master/module/MyUser/config/module.config.php</a> ): <br><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'doctrine'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'driver'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'zfcuser_entity'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt;<span class="hljs-string"><span class="hljs-string">'Doctrine\ORM\Mapping\Driver\AnnotationDriver'</span></span>, <span class="hljs-string"><span class="hljs-string">'paths'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(__DIR__ . <span class="hljs-string"><span class="hljs-string">'/../src/MyUser/Entity'</span></span>) ), <span class="hljs-string"><span class="hljs-string">'orm_default'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'drivers'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'MyUser\Entity'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'zfcuser_entity'</span></span>, ) ) ) ), <span class="hljs-string"><span class="hljs-string">'zfcuser'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( // telling ZfcUser <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> use our own <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-string"><span class="hljs-string">'user_entity_class'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'MyUser\Entity\User'</span></span>, // telling ZfcUserDoctrineORM <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> skip the entities it defines <span class="hljs-string"><span class="hljs-string">'enable_default_entities'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, ), <span class="hljs-string"><span class="hljs-string">'bjyauthorize'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( // <span class="hljs-keyword"><span class="hljs-keyword">Using</span></span> the authentication <span class="hljs-keyword"><span class="hljs-keyword">identity</span></span> provider, which basically reads the roles <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> the auth servic<span class="hljs-string"><span class="hljs-string">e's identity '</span></span>identity_provider<span class="hljs-string"><span class="hljs-string">' =&gt; '</span></span>BjyAuthorize\Provider\<span class="hljs-keyword"><span class="hljs-keyword">Identity</span></span>\AuthenticationIdentityProvider<span class="hljs-string"><span class="hljs-string">', '</span></span>role_providers<span class="hljs-string"><span class="hljs-string">' =&gt; array( // using an object repository (entity repository) to load all roles into our ACL '</span></span>BjyAuthorize\Provider\<span class="hljs-keyword"><span class="hljs-keyword">Role</span></span>\ObjectRepositoryProvider<span class="hljs-string"><span class="hljs-string">' =&gt; array( '</span></span>object_manager<span class="hljs-string"><span class="hljs-string">' =&gt; '</span></span>doctrine.entity_manager.orm_default<span class="hljs-string"><span class="hljs-string">', '</span></span>role_entity_class<span class="hljs-string"><span class="hljs-string">' =&gt; '</span></span>MyUser\Entity\Rol<span class="hljs-string"><span class="hljs-string">e', ), ), ), );</span></span></code> </pre> <br>  In this config, we replace the zfcuser entity with our own, which is responsible for working with the user, and indicate to the BjyAuthorize module the entity responsible for working with roles. <br><br>  The MyUser module needs to be added to <em>application.config.php</em> and then in the console execute the following commands: <br><pre> <code class="hljs pgsql">./vendor/bin/doctrine-module orm:<span class="hljs-keyword"><span class="hljs-keyword">schema</span></span>-tool:<span class="hljs-keyword"><span class="hljs-keyword">update</span></span> <span class="hljs-comment"><span class="hljs-comment">--force ./vendor/bin/doctrine-module orm:validate-schema</span></span></code> </pre><br>  The first is to create tables for the entities created by the MyUser module in the database, the second is to make sure that the first command has worked correctly. <br><br>  The final preparatory action will be to execute the query, which will create the appropriate roles: <br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`role`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`parent_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`roleId`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">'guest'</span></span>), (<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'user'</span></span>), (<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'moderator'</span></span>), (<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'administrator'</span></span>);</code> </pre><br><br><h3>  Configuring ZfcUser, ZfcUserDoctrineORM and BjyAuthorize </h3><br>  First of all, it is necessary to register new modules in the settings of Composer: <br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"zf-commons/zfc-base"</span></span>: <span class="hljs-string"><span class="hljs-string">"v0.1.2"</span></span>, <span class="hljs-string"><span class="hljs-string">"zf-commons/zfc-user"</span></span>: <span class="hljs-string"><span class="hljs-string">"dev-master"</span></span>, <span class="hljs-string"><span class="hljs-string">"zf-commons/zfc-user-doctrine-orm"</span></span>: <span class="hljs-string"><span class="hljs-string">"dev-master"</span></span>, <span class="hljs-string"><span class="hljs-string">"doctrine/doctrine-orm-module"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.7.*"</span></span>, <span class="hljs-string"><span class="hljs-string">"bjyoungblood/bjy-authorize"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.4.*"</span></span></code> </pre><br>  update <em>php composer.phar update</em> and add new modules to <em>application.config.php</em> : <br><pre> <code class="hljs cs"><span class="hljs-string"><span class="hljs-string">'ZfcBase'</span></span>, <span class="hljs-string"><span class="hljs-string">'ZfcUser'</span></span>, <span class="hljs-string"><span class="hljs-string">'ZfcUserDoctrineORM'</span></span>, <span class="hljs-string"><span class="hljs-string">'BjyAuthorize'</span></span>,</code> </pre><br>  Attention!  The settings of some of these modules will be overridden by the settings of the handwritten modules, so these modules must be added to the top of the list. <br><br>  Now you need to copy the file <em>zfcuser.global.php.dist</em> from the directory <em>vendor / zf-commons / zfc-user / config</em> in <em>config / autoload</em> and rename it to <em>zfcuser.global.php</em> .  In this configuration file you need to set the value: <br><pre> <code class="hljs php"><span class="hljs-string"><span class="hljs-string">'table_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'users'</span></span>,</code> </pre><br>  as the default user table is used for working with users. <br><br>  Even in the same directory, you need to create a <em>bjyauth.global.php</em> configuration file containing access rights settings for various roles.  You can see the full version of this file on Github <a href="https://github.com/romka/zend-blog-example/blob/master/config/autoload/bjyauth.global.php">github.com/romka/zend-blog-example/blob/master/config/autoload/bjyauth.global.php</a> , the most interesting part of it, which is responsible for the distribution of access rights to different controllers, below: <br><pre> <code class="hljs php"><span class="hljs-string"><span class="hljs-string">'guards'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-comment"><span class="hljs-comment">/* If this guard is specified here (ie it is enabled), it will block * access to all controllers and actions unless they are specified here. * You may omit the 'action' index to allow access to the entire controller */</span></span> <span class="hljs-string"><span class="hljs-string">'BjyAuthorize\Guard\Controller'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'controller'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'zfcuser'</span></span>, <span class="hljs-string"><span class="hljs-string">'action'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'index'</span></span>, <span class="hljs-string"><span class="hljs-string">'login'</span></span>, <span class="hljs-string"><span class="hljs-string">'authenticate'</span></span>, <span class="hljs-string"><span class="hljs-string">'register'</span></span>), <span class="hljs-string"><span class="hljs-string">'roles'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'guest'</span></span>), ), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'controller'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'zfcuser'</span></span>, <span class="hljs-string"><span class="hljs-string">'action'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'logout'</span></span>), <span class="hljs-string"><span class="hljs-string">'roles'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'user'</span></span>), ), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'controller'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Application\Controller\Index'</span></span>, <span class="hljs-string"><span class="hljs-string">'roles'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>()), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'controller'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'MyBlog\Controller\BlogPost'</span></span>, <span class="hljs-string"><span class="hljs-string">'action'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'index'</span></span>, <span class="hljs-string"><span class="hljs-string">'view'</span></span>), <span class="hljs-string"><span class="hljs-string">'roles'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'guest'</span></span>, <span class="hljs-string"><span class="hljs-string">'user'</span></span>), ), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'controller'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'MyBlog\Controller\BlogPost'</span></span>, <span class="hljs-string"><span class="hljs-string">'action'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'add'</span></span>, <span class="hljs-string"><span class="hljs-string">'edit'</span></span>, <span class="hljs-string"><span class="hljs-string">'delete'</span></span>), <span class="hljs-string"><span class="hljs-string">'roles'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'administrator'</span></span>), ), ), ),</code> </pre><br>  From the config, it is clear that access to the index and view actions was done for all users, and to add / edit / delete actions, only to users with the role ‚Äúadministrator‚Äù.  Now it is easy to verify this by clicking on the link / blog / add - error 403 will be returned. <br><br>  Now we can register using the / user / register link and assign our administrator rights as an SQL query to our user: <br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> user_role_linker (user_id, role_id) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>);</code> </pre><br>  (yes, the ZfcUser module does not provide the admin panel for managing user roles). <br><br>  After authorization at the bottom of the page, the developer toolbar will display information about the role of the current user and the add / edit / delete actions will no longer return a 403 error. <br><br>  A noticeable disadvantage of the current state of the project is that links to edit / delete blogposts are displayed to all users, despite the fact that anonymous users do not have the right to perform such actions.  The <em>BjyAuthorize</em> module contains a view <em>isAllowed</em> plugin that makes it easy to fix the problem.  Add the following lines to the templates: <br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;isAllowed(<span class="hljs-string"><span class="hljs-string">'controller/MyBlog\Controller\BlogPost:edit'</span></span>)) { <span class="hljs-comment"><span class="hljs-comment">// some code here }</span></span></code> </pre><br>  where it is necessary to check the availability of access rights to the corresponding controller / action, this will allow not to display in the template links that cannot be viewed by the current user. <br><br>  In a similar method, it is possible in the indexAction () action for admins to display the full list of blog posts, and not just those published: <br><pre> <code class="hljs php"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;isAllowed(<span class="hljs-string"><span class="hljs-string">'controller/MyBlog\Controller\BlogPost:edit'</span></span>)) { $posts = $objectManager -&gt;getRepository(<span class="hljs-string"><span class="hljs-string">'\MyBlog\Entity\BlogPost'</span></span>) -&gt;findBy(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'created'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'DESC'</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $posts = $objectManager -&gt;getRepository(<span class="hljs-string"><span class="hljs-string">'\MyBlog\Entity\BlogPost'</span></span>) -&gt;findBy(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'state'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'created'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'DESC'</span></span>)); }</code> </pre><br>  The project in its current form is available in the repository on Github with the <em>configured_user</em> tag: <a href="https://github.com/romka/zend-blog-example/tree/configured_user">github.com/romka/zend-blog-example/tree/configured_user</a> . <br><br><h2>  Twig </h2><br>  In my practice, I used several different template engines and I consider the Piton <a href="http://jinja.pocoo.org/docs/">Jinja 2 to be the</a> most convenient of those with which I had to work.  The <a href="http://twig.sensiolabs.org/">Twig</a> PHP templating engine was originally developed by Armin Ronacher, the author of Jinja 2, and then Fabien Potencier, the developer of the <a href="http://symfony.com/">Symfony</a> framework, took on his support and development. <br><br>  One of the key differences between Twig and the template maker embedded in the Zend Framework is that you cannot use PHP code in Twig templates; instead, the template engine has its own syntax for implementing loops, conditional statements, and so on.  Twig templates are compiled into PHP code and, as a result, do not lose in performance to the PHP code. <br><br>  Due to such features as template inheritance, macros, filter systems, etc.  Twig patterns are compact and easy to read. <br><br><h3>  Installation </h3><br>  To install Twig, just follow the standard steps: add a line to <em>composer.json</em> , run <em>php composer.phar update</em> and add a module to <em>application.config.php</em> . <br><br>  Now to the modules that will use this template engine, you need to add the lines to the configuration file in the view_manager section: <br><pre> <code class="hljs php"><span class="hljs-string"><span class="hljs-string">'strategies'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'ZfcTwigViewStrategy'</span></span>, ),</code> </pre><br>  and Twig will be ready for use.  Moreover, both template engines (Twig and Default) can be used together, that is, part of the templates can be implemented on one template engine, and some on the other. <br><br><h3>  Twig patterns </h3><br>  The template inheritance mentioned above means that we can create a default <em>layout.twig</em> template <em>with</em> something like this: <br><pre> <code class="hljs django"><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">head</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">block</span></span></span></span></span><span class="hljs-template-tag"> title %}</span></span><span class="xml"><span class="xml">Default title</span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endblock</span></span></span></span></span><span class="hljs-template-tag"> title %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">block</span></span></span></span></span><span class="hljs-template-tag"> script %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"/js/jquery.min.js"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="undefined"></span><span class="hljs-tag"><span class="xml"><span class="undefined"></span><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endblock</span></span></span></span></span><span class="hljs-template-tag"> script %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">head</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">body</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"content"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">block</span></span></span></span></span><span class="hljs-template-tag"> content %}</span></span><span class="xml"></span><span class="hljs-template-variable"><span class="xml"></span><span class="hljs-template-variable">{{ content|raw }}</span></span><span class="xml"></span><span class="hljs-template-tag"><span class="xml"></span><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endblock</span></span></span></span></span><span class="hljs-template-tag"> content %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"sidebar"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">block</span></span></span></span></span><span class="hljs-template-tag"> sidebar %}</span></span><span class="xml"></span><span class="hljs-template-variable"><span class="xml"></span><span class="hljs-template-variable">{{ sidebar|raw }}</span></span><span class="xml"></span><span class="hljs-template-tag"><span class="xml"></span><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endblock</span></span></span></span></span><span class="hljs-template-tag"> sidebar %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">body</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br>  Next, we can create a template that will be inherited from layout.twig, in which we only redefine the changed parts of the template: <br><pre> <code class="hljs django"><span class="xml"></span><span class="hljs-template-tag"><span class="xml"></span><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">extends</span></span></span></span></span><span class="hljs-template-tag"> 'layout/layout.twig' %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">block</span></span></span></span></span><span class="hljs-template-tag"> script %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ parent() }}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"some-additional-file.js"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="undefined"></span><span class="hljs-tag"><span class="xml"><span class="undefined"></span><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endblock</span></span></span></span></span><span class="hljs-template-tag"> script %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">block</span></span></span></span></span><span class="hljs-template-tag"> content %}</span></span><span class="xml"><span class="xml"> Custom content </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endblock</span></span></span></span></span><span class="hljs-template-tag"> content %}</span></span><span class="xml"></span><span class="xml"></span></code> </pre><br>  By default, the block redefined in the template-heir replaces the block in the parent template, but pay attention to the <nobr>{{parent ()}} line</nobr> in the script block, its use means that the contents of the same block of the parent template will be loaded into this block. <br><br>  Now let's rewrite the templates using the new template engine.  I started with the standard <em>layout.phtml</em> template from Zend Skeleton Application, you can find it in the MyBlog module in the view / layout directory <a href="">github.com/romka/zend-blog-example/blob/master/module/MyBlog/view/layout/layout. twig</a> . <br><br>  Pay attention to how much smaller, for example, the use of view-helpers has become, now instead of: <br><pre> <code class="hljs xml"><span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?php</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">echo</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">$this</span></span></span><span class="php">-&gt;url(</span><span class="hljs-string"><span class="php"><span class="hljs-string">'blog'</span></span></span><span class="php">, </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">array</span></span></span><span class="php">(</span><span class="hljs-string"><span class="php"><span class="hljs-string">'action'</span></span></span><span class="php"> =&gt; </span><span class="hljs-string"><span class="php"><span class="hljs-string">'edit'</span></span></span><span class="php">)); </span><span class="hljs-meta"><span class="php"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre><br>  you can call: <br><pre> <code class="hljs cs">{{ url(<span class="hljs-string"><span class="hljs-string">'blog'</span></span>, {<span class="hljs-string"><span class="hljs-string">'action'</span></span>: <span class="hljs-string"><span class="hljs-string">'edit'</span></span>}) }}</code> </pre><br>  instead of: <br><pre> <code class="hljs xml"><span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?php</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">echo</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">$this</span></span></span><span class="php">-&gt;showMessages(); </span><span class="hljs-meta"><span class="php"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre><br>  simply: <br><pre> <code class="hljs django"><span class="xml"></span><span class="hljs-template-variable"><span class="xml"></span><span class="hljs-template-variable">{{ showMessages() }}</span></span><span class="xml"></span><span class="xml"></span></code> </pre><br>  After processing the main template we will deal with forms.  First of all, in the <em>view</em> directory of the module, create a <em>macros</em> subdirectory and in it the <a href="">forms.twig</a> file with the following contents: <br><pre> <code class="hljs django"><span class="xml"></span><span class="hljs-template-tag"><span class="xml"></span><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name">macro</span></span></span><span class="hljs-template-tag"> input(name, value, type, label, size, messages) %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">if</span></span></span></span></span><span class="hljs-template-tag"> type != 'hidden' %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"form-element-</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ name }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endif</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">if</span></span></span></span></span><span class="hljs-template-tag"> label %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ label }}</span></span><span class="xml"><span class="xml">: </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endif</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">if</span></span></span></span></span><span class="hljs-template-tag"> type == 'textarea' %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">textarea</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ name }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">size</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ size|</span><span class="hljs-name"><span class="hljs-template-variable"><span class="hljs-name">default</span></span></span><span class="hljs-template-variable">(20) }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span></span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">if</span></span></span></span></span><span class="hljs-template-tag"> messages|</span><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name">length</span></span></span><span class="hljs-template-tag"> &gt; 0 %}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"error"</span></span></span></span></span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endif</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">/&gt;</span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ value|e }}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">textarea</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name">elseif</span></span></span><span class="hljs-template-tag"> type == 'checkbox' %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">input</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ type }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ name }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span></span></span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">if</span></span></span></span></span><span class="hljs-template-tag"> value == true %}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">checked</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"checked"</span></span></span></span></span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endif</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag"> </span></span></span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">if</span></span></span></span></span><span class="hljs-template-tag"> messages|</span><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name">length</span></span></span><span class="hljs-template-tag"> &gt; 0 %}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"error"</span></span></span></span></span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endif</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">/&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">else</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">input</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ type|</span><span class="hljs-name"><span class="hljs-template-variable"><span class="hljs-name">default</span></span></span><span class="hljs-template-variable">('text') }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ name }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ value|e }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">size</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ size|</span><span class="hljs-name"><span class="hljs-template-variable"><span class="hljs-name">default</span></span></span><span class="hljs-template-variable">(20) }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span></span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">if</span></span></span></span></span><span class="hljs-template-tag"> messages|</span><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name">length</span></span></span><span class="hljs-template-tag"> &gt; 0 %}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"error"</span></span></span></span></span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endif</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">/&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endif</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">if</span></span></span></span></span><span class="hljs-template-tag"> type != 'hidden' %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endif</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">if</span></span></span></span></span><span class="hljs-template-tag"> messages|</span><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name">length</span></span></span><span class="hljs-template-tag"> &gt; 0 %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">for</span></span></span></span></span><span class="hljs-template-tag"> m </span><span class="hljs-keyword"><span class="hljs-template-tag"><span class="hljs-keyword">in</span></span></span><span class="hljs-template-tag"> messages %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ m }}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endfor</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endif</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name">endmacro</span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"></span><span class="xml"></span></code> </pre><br>  This macro will be used to display form fields.  At the input he gets the field parameters, the output returns html-markup. <br><br>  Now you can delete the existing <em>add.phtml</em> template and replace it with a new <em>add.twig</em> with the following content: <br><pre> <code class="hljs django"><span class="xml"></span><span class="hljs-template-tag"><span class="xml"></span><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">extends</span></span></span></span></span><span class="hljs-template-tag"> 'layout/layout.twig' %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name">import</span></span></span><span class="hljs-template-tag"> 'macros/forms.twig' </span><span class="hljs-keyword"><span class="hljs-template-tag"><span class="hljs-keyword">as</span></span></span><span class="hljs-template-tag"> forms %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">block</span></span></span></span></span><span class="hljs-template-tag"> content %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ title }}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">form</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ form.attributes.method }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ url('blog', {'action': 'add'}) }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">for</span></span></span></span></span><span class="hljs-template-tag"> element </span><span class="hljs-keyword"><span class="hljs-template-tag"><span class="hljs-keyword">in</span></span></span><span class="hljs-template-tag"> form %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ forms.input(element.attributes.name, element.value, element.attributes.type, element.label, 20, element.messages) }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endfor</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">form</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endblock</span></span></span></span></span><span class="hljs-template-tag"> content %}</span></span><span class="xml"></span><span class="xml"></span></code> </pre><br>  Similarly, I redid the rest of the templates and deleted the now * .phtml-templates of the module: <a href="https://github.com/romka/zend-blog-example/tree/master/module/MyBlog/view/my-blog/blog">github.com/romka/zend-blog-example/tree/master/module/MyBlog/view/my-blog/blog</a> . <br><br><h2>  Conclusion </h2><br>  On this I would like to finish.  I did not touch upon a lot of important points, such as logging, caching, Dependency Injection, writing tests, etc, etc., but all these questions are beyond the scope of the introductory article.  But I hope that for beginner developers to learn about the Zend Framework 2, this article will help become a useful starting point. <br><br>  <i>I wrote all 3 parts of this article before the publication of the first part and at the time of completing the text I planned to finish it.</i>  <i>After reading the comments, I decided to improve the application a bit:</i> <i><br></i> <ul><li>  <i>use REST, instead of checking for the type of GET / POST request,</i> </li><li>  <i>transfer part of the tasks to the hooks before the action,</i> </li><li>  <i>transfer part of the tasks to the doctrine hooks,</i> </li><li>  <i>get rid of the magical constants</i> </li><li>  <i>transfer configs to yaml,</i> </li><li>  <i>replace some calls with DI (?).</i> </li></ul> <i><br></i>  <i>The preparation of these changes will take some time, I hope to publish the fourth part of the article soon.</i> </div><p>Source: <a href="https://habr.com/ru/post/192726/">https://habr.com/ru/post/192726/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../192716/index.html">Repositories for Windows, or how to install programs faster</a></li>
<li><a href="../192718/index.html">Is there life after blocking Roskomnadzor? there is</a></li>
<li><a href="../192720/index.html">Data-Driven MS-Test Tests for Unit and Acceptance Testing</a></li>
<li><a href="../192722/index.html">Snowden has shed light on the cryptographic hacking situation. Everything is bad</a></li>
<li><a href="../192724/index.html">Creating a video editor - useful avconv recipes (ffmpeg)</a></li>
<li><a href="../192728/index.html">A look at the problems of higher IT education from the teacher</a></li>
<li><a href="../192730/index.html">Sony PRS-T3 - a new reader with a higher resolution display</a></li>
<li><a href="../192736/index.html">Calculating the maximum number in the array at compile time</a></li>
<li><a href="../192738/index.html">0 dB Silent computer. Version 1.0</a></li>
<li><a href="../192740/index.html">CornerJS, or ‚Äúas in AngularJS‚Äù directives, only better</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>