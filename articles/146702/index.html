<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Contracts vs Unit Tests</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="DISCLAIMER: This note implies that the reader has basic knowledge of unit tests, which the author of these lines does not doubt, as well as basic know...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Contracts vs Unit Tests</h1><div class="post__text post__text-html js-mediator-article">  DISCLAIMER: This note implies that the reader has basic knowledge of unit tests, which the author of these lines does not doubt, as well as basic knowledge of contract design, which can be replenished from <a href="http://sergeyteplyakov.blogspot.com/2010/05/design-by-contract.html">here</a> . <br><br>  At one of the presentations on the design of the contract, one of my colleagues asked a very reasonable question about the relationship of contracts and unit tests.  Postconditions in a class contract, like unit tests talk about class guarantees to its customers, and since unit tests are a more powerful mechanism in this matter (complex postconditions to express in the form of contracts are not always easy, and sometimes impossible), the question arises postconditions. <br><br>  So, let's briefly consider exactly where the intersection of contracts and unit tests are located, and try to answer the question: are the postconditions redundant in the presence of unit tests? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><h5>  <b>Contracts</b> </h5><br>  The problem with any code is that it is not self-sufficient.  Of course, looking at the code you can immediately see the non-optimality of the solution, find banal nonsense or incorrect use of the programming language idioms, but it is very difficult to answer the main question: <b>does this code do what it was written for or not?</b> <br><br>  The problem is that the code itself is not correct or incorrect, the concept of correctness is applicable only in conjunction: code - specification.  (You can read more about this in the article: <a href="http://sergeyteplyakov.blogspot.com/2010/05/design-by-contract.html">Design by contract. Software correctness</a> .) <br><br>  Usually this problem is solved by duplicating information in comments, which very quickly become obsolete and begin to contradict the code itself;  the specification may even be formal and be located on a wiki page;  it can be expressed in the form of statements, and also unit tests can be used for these purposes. <br><br>  We will look at the latter method later, but for now let's move on to the penultimate one: the use of contracts. <br><img src="https://habrastorage.org/storage2/849/86b/fd2/84986bfd22ffcc1f7fc56472e25b2788.jpg"><br><br>  Contracts are designed to specify specifications directly in the code in the form of statements: preconditions, postconditions, invariants and statements.  Now we are not interested in all the subtleties of these issues, and at the moment it will be enough for us to consider only the preconditions and postconditions. <br><br>  The preconditions of a class B method speak about a client's contract: <b>what clients of class</b> <b>B</b> <b>must perform in</b> <b>order for class</b> <b>B to</b> <b>start performing its duties</b> .  The postconditions of class B methods speak of a class B contract in front of its clients: <b>which guarantees that they will perform class</b> <b>B</b> <b>if their clients have fulfilled their part of the contract</b> . <br><br>  An example of a contract is the <b>IList</b> interface's <b>Add</b> method: if the client of the <b>IList</b> interface transmits a non-zero object (precondition), it will be added to this collection and the number of elements (Count) will increase by 1 (post-condition). <br><br><h5>  <b>Unit tests</b> </h5><br><br>  Unit tests are a very popular technique today, with skillful use of which the developer can get a number of buns, ranging from simplifying the refactoring process, to improving the design of the application by increasing modularity and <a href="http://sergeyteplyakov.blogspot.com/2011/11/blog-post_23.html">weakening connectivity</a> . <br><br>  Another property of unit tests is that they essentially describe the intended behavior of classes or modules, which may well be considered as their specification.  Tests are a great starting point for a new team member who wants to understand the work of a particular class, because with their help he will see the way to use the class, the necessary input data and the expected results. <br><br>  It is the last aspect of unit tests that so strongly resembles the preconditions and post-conditions of a class contract.  In fact, there are certainly similarities, but there are important differences. <br>  <b>Contracts are declarative</b> : they describe a class guarantee to its high-level customers, but they do not say how these guarantees are provided.  <b>Unit tests are imperative</b> : they describe the many steps that a class or method must perform in order to get the necessary results. <br><br>  <b>Contracts describe class guarantees to his clients, and unit tests ensure the fulfillment of these guarantees.</b> <br><br>  The ‚Äúfalling‚Äù unit test, like the violation of a postcondition, is a bug in the class code, which means that the clients of our classes should never face a violation of the precondition.  The class developer cannot guarantee the fulfillment of preconditions by his clients, but he can try to fulfill his part of the contract and ensure the fulfillment of the postconditions.  The exception arising from the violation of a postcondition is an insurance for the client, which he should never use.  If a method for some reason cannot do its work, then it should clearly signal to its customers with the appropriate type of exception. <br><br>  Contracts, unlike unit tests, are always available to clients, and with their help, the client can understand much more quickly what to expect from a class or method.  Even when it comes to in-house development, contracts are the preferred way to describe code intentions, while unit tests will be guaranteed to perform. <br><br><h5>  <b>A practical example.</b>  <b>Interface Contracts</b> </h5><br><br>  The need for additional libraries for contract programming is also related to the fact that the type systems of most modern languages ‚Äã‚Äãdo not express the programmer‚Äôs intentions as clearly as we would like.  One can only imagine how much less the number of argument checks would be if we had non-nullable reference types at our disposal, as in the Eiffel language or in functional languages. <br><br>  The type system is the first and most important means of conveying intentions, but it is quite difficult to express your intentions, especially when it comes to interfaces.  The interface models a certain abstraction, and each of its methods has a certain semantics, which can be understood using its name, a set of arguments and documentation.  Other no less important sources of interface specification can be contracts, and, in some ways, unit tests. <br>  Let's look at the <b>Add</b> method of the <b>IList</b> interface, which were once participants in one of the <a href="http://sergeyteplyakov.blogspot.com/2012/02/lsp.html">notes</a> : <br><br><pre><code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//    [ContractClass(typeof(IListContract&lt;&gt;))] public interface IList&lt;T&gt; { /// &lt;summary&gt; /// Adds an item to the ICollection&lt;T&gt;. /// &lt;/summary&gt; void Add(T item); int Count { get; } //     }</span></span></code> </pre> <br><br>  Looking only at the name of the method, its parameters, as well as documentation, it is impossible to clearly answer the question of which post-condition of the method, i.e.  what the calling code can expect and what the class implementing this contract should provide.  Whether it is necessary to add an element and only one, or not.  Looking at a contract is obvious, but without it it is very difficult to understand it. <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">ContractClassFor(typeof(IList&lt;&gt;))</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">IListContract</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; : <span class="hljs-title"><span class="hljs-title">IList</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> IList&lt;T&gt;.Add(T item) { Contract.Ensures(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Count == (Contract.OldValue&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Count) + <span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-string"><span class="hljs-string">"Count == Contract.OldValue(Count) + 1"</span></span>); } }</code> </pre><br><br>  Of course, unit tests of an interface provider can help in this matter, but the problem here is that there may be dozens of interface implementations from different manufacturers, which makes unit tests not the best source of specification. <br><br>  Interface contracts are particularly useful because the basic way of understanding what a particular class method serves for does not work for interfaces.  To understand the purpose (semantics) of a class method, we use reverse engineering, but this process is complicated for interfaces, because for this we need to analyze all possible implementations. <br><br>  Contracts, on the other hand, provide additional information that the interface client can use, and, just as importantly, the class that implements this interface. <br><br><h5>  <b>Conclusion</b> </h5><br><br>  Contract and unit tests are not competing with each other, even though both can be used as a specification expression.  Unit tests have a lot of worries, in the real system there will be quite a lot of them and it is possible to bite out of them the elements of the specification, but not so simply.  Any tool should be used for its intended purpose, and our two heroes are no exception. <br><br>  <b>Contracts - describe the abstraction and say nothing about how it works.</b>  <b>Unit tests, in turn, ensure that the implementation fits this description and that the guarantees described in the contract are always fulfilled</b> . </div><p>Source: <a href="https://habr.com/ru/post/146702/">https://habr.com/ru/post/146702/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../146695/index.html">From north to south, from west to east</a></li>
<li><a href="../146696/index.html">Crowdfunding in Russian: how it was</a></li>
<li><a href="../146697/index.html">Export MoCap Data to Unity3d</a></li>
<li><a href="../146698/index.html">Tic-tac-toe on Erlang</a></li>
<li><a href="../146699/index.html">Mobile gaming marketing doesn't work at all</a></li>
<li><a href="../146703/index.html">The stereotype of thinking in programming</a></li>
<li><a href="../146704/index.html">Convert PNG24 / 32 to PNG8 while maintaining transparency</a></li>
<li><a href="../146705/index.html">Electronics development and freelance</a></li>
<li><a href="../146707/index.html">Optimize model usage from Active Record, and some arrays</a></li>
<li><a href="../146710/index.html">Happlink - Interest Interaction Network</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>