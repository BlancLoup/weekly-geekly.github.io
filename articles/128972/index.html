<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We receive the image from an optical sensor of a computer mouse by means of Arduino</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="To solve one of the tasks, I needed to programmatically obtain and process images of a small portion of the paper surface from a very close distance. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We receive the image from an optical sensor of a computer mouse by means of Arduino</h1><div class="post__text post__text-html js-mediator-article"><img alt=", 111.3 KB" src="https://habrastorage.org/getpro/geektimes/post_images/7df/e05/372/7dfe053725ccebea1705276bf7ceb59a.jpg" title="KDVV, 111.3 KB"><br><br>  To solve one of the tasks, I needed to programmatically obtain and process images of a small portion of the paper surface from a very close distance.  Not having received decent quality when using a conventional USB camera and already half way to the store using an electron microscope, I remembered one of the lectures in which we were told how various devices are arranged, including a computer mouse. <br><a name="habracut"></a><br><h4>  Preparation and some theory </h4><br>  I will not go into details of the principle of operation of a modern optical mouse, it is written in great detail <a href="http://www.ixbt.com/peripheral/mice-sensor.shtml">here</a> (I recommend reading for general development). <br><br>  Googling information on this topic and disassembling an old Logitech PS / 2 mouse, I saw a familiar picture from the Internet. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img alt="Image #1238805, 96.3 KB" src="https://habrastorage.org/getpro/geektimes/post_images/946/f4b/71d/946f4b71d58c84e73c19976446b51d44.jpg" title="Image # 1238805, 96.3 KB"><br><br>  The not so complicated scheme of the ‚Äúfirst generation mice‚Äù, the optical sensor in the center and the PS / 2 interface chip are slightly higher.  The optical sensor I got is an analogue of the ‚Äúpopular‚Äù models ADNS2610 / ADNS2620 / PAN3101.  I think they and their counterparts were massively produced at the same Chinese factory, having received different markings at the output.  The documentation for it <a href="http://www.avagotech.com/docs/AV02-1184EN">was found</a> very easy, even with various code examples. <br><br>  Documentation says that this sensor, up to 1500 times per second, receives an image of a surface measuring 18x18 pixels (400cpi resolution), remembers it and, using image comparison algorithms, calculates the displacement along the X and Y coordinates relative to the previous position. <br><br><h4>  Implementation </h4><br>  To ‚Äúcommunicate with the sensor,‚Äù I used the popular computing platform Arduino, and decided to solder directly to the legs of the chip. <br><br><img alt="Image #1238838, 97.1 KB" src="https://habrastorage.org/getpro/geektimes/post_images/1bb/432/1da/1bb4321daba20ce731835b79fd392ca7.jpg" title="Image # 1238838, 97.1 KB"><br><br>  We connect 5V and GND to the corresponding outputs of the Arduino, and the SDIO and SCLK sensor legs to digital pins 8 and 9. <br><br>  To get an offset by coordinates, you need to read the register value of the chip at 0x02 (X) and 0x03 (Y), and to dump the picture you need to first write the value 0x2A at 0x08, and then read it 18x18 times from there.  This will be the last ‚Äúmemorized‚Äù value of the image brightness matrix from the optical sensor. <br><br>  How I implemented it on Arduino can be found here: <a href="http://pastebin.com/YpRGbzAS">http://pastebin.com/YpRGbzAS</a> (total ~ 100 lines of code). <br><br>  And for receiving and displaying a picture, a program was written in Processing. <br><br>  The source here: <a href="http://pastebin.com/XqGyP5EA">http://pastebin.com/XqGyP5EA</a> . <br><br><h4>  Result </h4><br>  After a small ‚Äúdopilivaniya‚Äù program for my project, I was able to get a picture directly from the optical sensor and make all the necessary calculations on it. <br><br><img alt="Image #1238886, 80.6 KB" src="https://habrastorage.org/getpro/geektimes/post_images/158/13e/ea4/15813eea4eb9959f855864dd7cf3fc2d.gif" title="Image # 1238886, 80.6 KB"><br><br>  You can notice the texture of the surface (paper) and even the individual letters on it.  It should be noted that such a clear picture quality is obtained due to the fact that the developers of this mouse model added a special <a href="">glass stand</a> with a small lens directly under the sensor to the design. <br><br>  If you start raising the mouse above the surface, even a couple of millimeters, the clarity disappears immediately. <br><br><img src="https://habrastorage.org/storage1/5365a464/f5f6dccd/564e58fa/25cf8d94.gif"><br><br>  If you suddenly want to repeat this at home, to find a mouse with a similar sensor, I recommend looking for old devices with a PS / 2 interface. <br><br><h4>  Conclusion </h4><br>  Although the resulting image is not very large, this was quite enough to solve my problem (barcode scanner).  It turned out very economically and quickly (a mouse for ~ 100 rubles + Arduino + a couple of days to write the code). <br><br>  I will leave references to materials which very much were useful to me for the solution of this task.  It really was not difficult and was done with great pleasure.  Now I am looking for information about the chips of more expensive models of modern mice for obtaining high-quality images with high resolution.  Maybe I can even collect something like a microscope (the quality of images from the current sensor is clearly not suitable for this).  Thanks for attention! <br><br><h5>  Theory </h5><br>  <a href="http://www.ixbt.com/peripheral/mice-sensor.shtml">http://www.ixbt.com/peripheral/mice-sensor.shtml</a> <br><br><h5>  Similar work </h5><br>  <a href="http://spritesmods.com/%3Fart%3Dmouseeye%26page%3D1">http://spritesmods.com/?art=mouseeye&amp;page=1</a> <br>  <a href="http://www.bidouille.org/hack/mousecam">http://www.bidouille.org/hack/mousecam</a> <br><br><h5>  Documentation </h5><br>  <a href="http://www.avagotech.com/docs/AV02-1184EN">http://www.avagotech.com/docs/AV02-1184EN</a> <br><br><h5>  Sources </h5><br>  <a href="http://pastebin.com/YpRGbzAS">http://pastebin.com/YpRGbzAS</a> <br>  <a href="http://pastebin.com/XqGyP5EA">http://pastebin.com/XqGyP5EA</a> <br><br>  <b>UPD from 09/23</b> : added some information about the lens and pin numbers for the Arduin. </div><p>Source: <a href="https://habr.com/ru/post/128972/">https://habr.com/ru/post/128972/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../128964/index.html">Habrayuser reflection in ICQ mirror</a></li>
<li><a href="../128965/index.html">Metaincubation</a></li>
<li><a href="../128968/index.html">Open Source RIA on the Spring Framework</a></li>
<li><a href="../128969/index.html">MRM-system BrandMaker: now in Russia</a></li>
<li><a href="../128970/index.html">HTML & CSS Aspects</a></li>
<li><a href="../128974/index.html">Vhdl Reconfigurable Design</a></li>
<li><a href="../128975/index.html">Actors as a special case of dataflow</a></li>
<li><a href="../128976/index.html">The build environment for the Midnight Commander project</a></li>
<li><a href="../128977/index.html">The site of the payment system Monety.Ru is now in a new design</a></li>
<li><a href="../128978/index.html">Happy birthday, Android!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>