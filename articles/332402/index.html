<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Lunch Break Refactoring: Introduction to Submod Scripts</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I think that project refactoring is a topic that is close to each developer. Often, we are faced with problems when the IDE and regular expressions ar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Lunch Break Refactoring: Introduction to Submod Scripts</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/web/fcd/d6d/150/fcdd6d150b12464badc1343afbd52271.jpg"></p><br><p>  <em>I think that project refactoring is a topic that is close to each developer.</em>  <em>Often, we are faced with problems when the IDE and regular expressions are no longer enough for us, and then means such as those described in this post come to the rescue.</em>  <em>Codemod scripts are a very powerful tool.</em>  <em>After its development, it will become clear that your refactoring will never be the same.</em>  <em>Therefore, I translated this post for our harabrablog.</em>  <em>I wish you a pleasant reading.</em> </p><br><p>  Maintaining the <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BE%25D0%25B4%25D0%25BE%25D0%25B2%25D0%25B0%25D1%258F_%25D0%25B1%25D0%25B0%25D0%25B7%25D0%25B0">code base</a> can turn into a headache for any developer, especially when it comes to JavaScript.  In the conditions of constantly changing standards, syntax and critical changes of third-party packages, it is very difficult to maintain such code. </p><br><p> In recent years, JavaScript has changed beyond recognition.  The development of this language has led to the fact that even the simplest task of declaring variables has been changed.  In ES6, there were <code>let</code> and <code>const</code> , switch functions and many other innovations, each of which benefits developers. </p><br><p>  With the creation and maintenance of operational code designed to withstand the test of time, the burden on developers is increasing.  From this post, you will learn how to automate tasks for large-scale code refactoring using Codemod scripts and the <code>jscodeshift</code> tool, which will allow you, for example, to easily update your code to use new language features. </p><a name="habracut"></a><br><h3 id="codemod">  Codemod </h3><br><p>  <a href="https://github.com/facebook/codemod">Codemod</a> is a tool developed by Facebook to refactor large code bases.  It allows the developer to reorganize a large amount of code in a short period of time.  For small refactoring tasks like renaming a class or variable, the developer uses the IDE, such changes usually affect only one file.  The next tool for refactoring is global search and replace.  Often it can work using complex regular expressions.  But this method is not suitable for all cases. </p><br><p>  Codemod is written in Python, it takes a number of parameters, including expressions for searching and replacing. </p><br><pre> <code class="hljs xml">codemod -m -d /code/myAwesomeSite/pages --extensions php,html \ '<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">font</span></span></span><span class="hljs-tag"> *</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">color</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"?(.*?)"</span></span></span><span class="hljs-tag">?&gt;</span></span>(.*?)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">font</span></span></span><span class="hljs-tag">&gt;</span></span>' \ '<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"color: \1;"</span></span></span><span class="hljs-tag">&gt;</span></span>\2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span>'</code> </pre> <br><p>  In the example above, we replace <code>&lt;font&gt;</code> with <code>&lt;span&gt;</code> using the built-in style to specify the color.  The first two parameters are flags indicating the need to search for multiple matches (-m), and the directory to start processing ( <code>-d /code/myAwesomeSite/pages</code> ).  We can also limit the extensions being processed ( <code>-extensions php</code> , <code>html</code> ).  We then provide expressions for search and replace.  If the replacement expression is not specified, you will be prompted to enter it at run time.  The tool works fine, but it is very similar to existing search and replace tools using regular expressions. </p><br><h4 id="jscodeshift">  jscodeshift </h4><br><p>  <a href="https://github.com/facebook/jscodeshift">jscodeshift is</a> next in the refactoring toolbox.  It was also developed by Facebook and is intended for processing several files by the Codemod script.  Being a Node.js module, jscodeshift provides a simple and convenient API, and "under the hood" uses <a href="https://github.com/benjamn/recast">Recast</a> , which is an AST-to-AST ( <a href="https://ru.wikipedia.org/wiki/%25D0%2590%25D0%25B1%25D1%2581%25D1%2582%25D1%2580%25D0%25B0%25D0%25BA%25D1%2582%25D0%25BD%25D0%25BE%25D0%25B5_%25D1%2581%25D0%25B8%25D0%25BD%25D1%2582%25D0%25B0%25D0%25BA%25D1%2581%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25BE%25D0%25B5_%25D0%25B4%25D0%25B5%25D1%2580%25D0%25B5%25D0%25B2%25D0%25BE">Abstract Syntax Tree</a> ) conversion tool. </p><br><h4 id="recast">  Recast </h4><br><p>  <a href="https://github.com/benjamn/recast">Recast</a> is a Node.js module that provides an interface for parsing and regenerating JavaScript code.  It can analyze the code as a string and generate objects from it that correspond to the AST structure.  This allows developers to check the code for templates such as function declarations. </p><br><pre> <code class="hljs lua">var recast = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"recast"</span></span>); var code = [ <span class="hljs-string"><span class="hljs-string">"function add(a, b) {"</span></span>, <span class="hljs-string"><span class="hljs-string">" return a + b"</span></span>, <span class="hljs-string"><span class="hljs-string">"}"</span></span> ].join(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>); var ast = recast.parse(code); console.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>(ast); //<span class="hljs-built_in"><span class="hljs-built_in">output</span></span> { <span class="hljs-string"><span class="hljs-string">"program"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Program"</span></span>, <span class="hljs-string"><span class="hljs-string">"body"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"FunctionDeclaration"</span></span>, <span class="hljs-string"><span class="hljs-string">"id"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Identifier"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"add"</span></span>, <span class="hljs-string"><span class="hljs-string">"loc"</span></span>: { <span class="hljs-string"><span class="hljs-string">"start"</span></span>: { <span class="hljs-string"><span class="hljs-string">"line"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"column"</span></span>: <span class="hljs-number"><span class="hljs-number">9</span></span> }, <span class="hljs-string"><span class="hljs-string">"end"</span></span>: { <span class="hljs-string"><span class="hljs-string">"line"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"column"</span></span>: <span class="hljs-number"><span class="hljs-number">12</span></span> }, <span class="hljs-string"><span class="hljs-string">"lines"</span></span>: {}, <span class="hljs-string"><span class="hljs-string">"indent"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> } }, ...........</code> </pre> <br><p>  As you can see from the example, we pass a line of code to a function that adds two numbers.  When we parse a string and print out the resulting object, we can see the AST: we see <code>FunctionDeclaration</code> , the name of the function, etc. Since this is just a JavaScript object, we can change it as we like.  You can then call the print function to return the updated line of code. </p><br><h4 id="ast-abstract-syntax-tree">  AST (Abstract Syntax Tree) </h4><br><p>  As mentioned earlier, Recast builds an AST from a line of code.  AST is a tree view of the abstract syntax of source code.  Each tree node is a construction in the source code.  <a href="https://astexplorer.net/">ASTExplorer</a> is an online tool that will help you understand and understand your code tree. </p><br><p>  With ASTExplorer, you can view AST simple sample code.  We declare a constant named foo and assign it the string value <code>'bar'</code> . </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> foo = <span class="hljs-string"><span class="hljs-string">'bar'</span></span>;</code> </pre> <br><p>  This corresponds to the following AST: </p><br><p><img src="https://habrastorage.org/web/cd8/d1a/24f/cd8d1a24f7d44c3a946c210d394430e3.png"></p><br><p>  In the body array, there is a <code>VariableDeclaration</code> branch that contains our constant.  All <code>VariableDeclarations</code> have an <code>id</code> attribute that contains important information (name, etc.).  If we were to create a Codemod script to rename all instances of foo, we would use this attribute and go through all instances to change the name. </p><br><h3 id="ustanovka-i-ispolzovanie">  Installation and use </h3><br><p>  Using the tools and techniques discussed above, we can take full advantage of jscodeshift.  Since, as we know, it is a Node.js module, you can install it for a project or globally. </p><br><pre> <code class="hljs sql">npm <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> -g jscodeshift</code> </pre> <br><p>  After installation, we can use the existing Codemod-scripts in conjunction with <code>jscodeshift</code> .  You need to provide some parameters that tell jscodeshift what we want to achieve.  The basic syntax is a <code>jscodeshift</code> call with the path to the file or files to be converted.  An important parameter is the location of the conversion script <code>(-t)</code> : it can be a local file or the URL of the Codemod script file.  By default, <code>jscodeshift</code> searches for the transform script in the transform.js file in the current directory. </p><br><p>  Other useful options are a test run (-d), which will apply the conversion, but will not update the files, and the -v option, which will output all the information about the conversion process.  Transformation scripts are Codemod scripts, simple JavaScript modules that export a function.  This function takes the following parameters: </p><br><ul><li>  fileInfo </li><li>  api </li><li>  options </li></ul><br><p>  The fileInfo parameter stores all information about the current file, including the path and source.  The api parameter is an object that provides access to <code>jscodeshift</code> helper functions, such as <code>findVariableDeclarators</code> and <code>renameTo</code> .  Finally, the parameter is the options that allow you to pass parameters from the command line to the Codemod.  For example, if we want to add a version of the code to all files, then we can pass it through the command line parameters <code>jscodeshift -t myTransforms fileA fileB --codeVersion = 1.2</code> .  In this case, the options parameter will contain <code>{codeVersion: '1.2'}</code> . </p><br><p>  Inside the function that we export, you need to return the converted code as a string.  For example, if we have a line of code <code>const foo = 'bar',</code> and we want to convert it, replacing <code>const foo</code> with <code>const bar</code> , our code will look like this: </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">transformer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">file, api</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> j = api.jscodeshift; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> j(file.source) .find(j.Identifier) .forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">path</span></span></span><span class="hljs-function"> =&gt;</span></span> { j(path).replaceWith( j.identifier(<span class="hljs-string"><span class="hljs-string">'bar'</span></span>) ); }) .toSource(); }</code> </pre> <br><p>  Here we combine a number of functions into a chain of calls and at the end call <code>toSource()</code> to generate a converted line of code. </p><br><p>  When returning the code, you must follow some rules.  Returning a string other than the input is considered a successful conversion.  If the string is the same as the input, then the conversion is considered unsuccessful, and if nothing is returned, then it is not needed.  <code>jscodeshift</code> uses these results when processing conversion statistics. </p><br><h3 id="suschestvuyuschie-codemod-skripty">  Existing Codemod Scripts </h3><br><p>  In most cases, developers do not need to write their own code - many typical refactoring actions have already been turned into Codemod scripts.  For example, <a href="https://github.com/cpojer/js-codemod/"><code>js-codemod no-vars</code></a> , which convert all var instances to let or const depending on the use of the variable (in let - if the variable is changed later, to const - if the variable will never be changed). </p><br><p>  <a href="https://github.com/cpojer/js-codemod/"><code>js-codemod template-literals</code></a> replaces string concatenation with pattern strings, for example: </p><br><pre> <code class="hljs pgsql">const sayHello = <span class="hljs-string"><span class="hljs-string">'Hi my name is '</span></span> + <span class="hljs-type"><span class="hljs-type">name</span></span>; //<span class="hljs-keyword"><span class="hljs-keyword">after</span></span> <span class="hljs-keyword"><span class="hljs-keyword">transform</span></span> const sayHello = `Hi my <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> ${<span class="hljs-type"><span class="hljs-type">name</span></span>}`;</code> </pre> <br><h3 id="kak-pishutsya-codemod-skripty">  How to write codemod scripts </h3><br><p>  We can take the <code>no-vars</code> script mentioned above and break the code to see how the complex Codemod script works. </p><br><pre> <code class="hljs pgsql">const updatedAnything = root.find(j.VariableDeclaration).<span class="hljs-keyword"><span class="hljs-keyword">filter</span></span>( <span class="hljs-type"><span class="hljs-type">dec</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">dec</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.kind === <span class="hljs-string"><span class="hljs-string">'var'</span></span> ).<span class="hljs-keyword"><span class="hljs-keyword">filter</span></span>(declaration =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> declaration.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.declarations.every(declarator =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !isTruelyVar(declaration, declarator); }); }).<span class="hljs-keyword"><span class="hljs-keyword">forEach</span></span>(declaration =&gt; { const forLoopWithoutInit = isForLoopDeclarationWithoutInit(declaration); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( declaration.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.declarations.<span class="hljs-keyword"><span class="hljs-keyword">some</span></span>(declarator =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (!declarator.init &amp;&amp; !forLoopWithoutInit) || isMutated(declaration, declarator); }) ) { declaration.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.kind = <span class="hljs-string"><span class="hljs-string">'let'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { declaration.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.kind = <span class="hljs-string"><span class="hljs-string">'const'</span></span>; } }).size() !== <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> updatedAnything ? root.toSource() : <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>;</code> </pre> <br><p>  This code is the core of the no-vars script.  First, the filter is run on all <code>VariableDeclaration</code> variables, including <code>var</code> , <code>let</code> and <code>const</code> , and returns only var declarations, which are passed to the second filter, which calls the user function <code>isTruelyVar</code> .  It is used to determine the nature of a var (for example, var inside a closure, or is declared twice, or a function declaration that can be raised) and will show whether it is safe to do the conversion of this var.  Each var returned by the <code>isTruelyVar</code> filter is processed in a foreach loop. </p><br><p>  Inside the loop, check if var is inside the loop, for example: </p><br><pre> <code class="hljs matlab"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(var <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">i</span></span>++) { doSomething(); }</code> </pre> <br><p>  To determine if var is inside a loop, you can check the parent type. </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isForLoopDeclarationWithoutInit = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">declaration</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> parentType = declaration.parentPath.value.type; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parentType === <span class="hljs-string"><span class="hljs-string">'ForOfStatement'</span></span> || parentType === <span class="hljs-string"><span class="hljs-string">'ForInStatement'</span></span>; };</code> </pre> <br><p>  If <code>var</code> is inside the loop and does not change, then it can be replaced by <code>const</code> .  Validation can be performed by filtering the <code>var AssignmentExpression</code> and <code>UpdateExpression. AssignmentExpression</code>  <code>UpdateExpression. AssignmentExpression</code> will show where and when <code>var</code> was initialized, for example: </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> foo = <span class="hljs-string"><span class="hljs-string">'bar'</span></span>; UpdateExpression ,    <span class="hljs-keyword"><span class="hljs-keyword">var</span></span>  , : <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> foo = <span class="hljs-string"><span class="hljs-string">'bar'</span></span>; foo = <span class="hljs-string"><span class="hljs-string">'Foo Bar'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//Updated</span></span></code> </pre> <br><p>  If <code>var</code> is inside a loop with a change, <code>let</code> used, since it may change after creating an instance.  The last line in the script checks if something has been changed, and if the answer is positive, a new source code for the file is returned.  Otherwise, a <code>null</code> returned, indicating that the data was not processed.  The full code for this Codemod script can be <a href="">found here</a> . </p><br><p>  The Facebook team also added several Codemod scripts to update the React syntax and process changes in the React API.  For example, <code>react-codemod sort-comp</code> , which sorts the methods of the React life cycle to conform <a href="">to the ESlint sort-comp rule</a> . </p><br><p>  The latest popular React Codemod script is <a href="https://github.com/reactjs/react-codemod"><code>React-PropTypes-to-prop-types</code></a> , which helps to cope with the recent React change, which requires developers to install <a href="https://www.npmjs.com/package/prop-types"><code>prop-types</code></a> to continue using <code>PropTypes</code> in React version 16 components. This is a great example of using Codemod scripts .  The method of using <code>PropTypes</code> not immortalized in stone. </p><br><p>  All the following examples are true. </p><br><p>  Import the React and access the <code>PropTypes</code> from the default import: </p><br><pre> <code class="hljs scala"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-type"><span class="hljs-type">React</span></span> from <span class="hljs-symbol"><span class="hljs-symbol">'reac</span></span>t'; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelloWorld</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ static propTypes = { name: <span class="hljs-type"><span class="hljs-type">React</span></span>.<span class="hljs-type"><span class="hljs-type">PropTypes</span></span>.string, } .....</code> </pre> <br><p>  Import the React and do the named import for PropTypes: </p><br><pre> <code class="hljs scala"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-type"><span class="hljs-type">React</span></span>, { <span class="hljs-type"><span class="hljs-type">PropTypes</span></span>, <span class="hljs-type"><span class="hljs-type">Component</span></span> } from <span class="hljs-symbol"><span class="hljs-symbol">'reac</span></span>t'; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelloWorld</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ static propTypes = { name: <span class="hljs-type"><span class="hljs-type">PropTypes</span></span>.string, } .....</code> </pre> <br><p>  And another option for the <code>stateless</code> component: </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, { PropTypes } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> HelloWorld = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{name}</span></span></span><span class="hljs-function">) =&gt;</span></span> { ..... } HelloWorld.propTypes = { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: PropTypes.string };</code> </pre> <br><p>  Having three ways to implement the same solution makes it difficult to use a regular expression for search and replace.  If our code had all three options, we could easily switch to the new PropTypes pattern by running: </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">jscodeshift</span></span> src/ -t transforms/proptypes.js</code> </pre> <br><p>  In this example, we took the PropTypes Codemod script from the <code>react-codemod</code> and added it to the <code>transforms</code> directory in our project.  The script will add <code>import PropTypes from 'prop-types</code> ';  for each file and replace all <code>React.PropTypes</code> with <code>PropTypes</code> . </p><br><h3 id="vyvody">  findings </h3><br><p>  Facebook began to implement code support, allowing developers to adapt to its ever-changing API and practical approaches to working with code.  <code>Javascript Fatigue</code> has become a big problem, and, as we have seen, tools that help in the process of updating existing code contribute a lot to its solution. </p><br><p>  In the server-side development world, programmers regularly create migration scripts to keep databases up-to-date and keep users up-to-date on their latest versions.  The creators of JavaScript libraries could provide Codemod scripts as such migration scripts so that when new versions with critical changes are released, you can easily process your code for updating. </p><br><p>  Having a Codemod script run automatically during installation or upgrade can speed up the process and increase consumer confidence.  In addition, the inclusion of such a script in the release process would not only be beneficial for consumers, but also reduce the costs of the accompanying updates examples and guides. </p><br><p>  In this post, we looked at the nature of the Cdemod scripts and <code>jscodeshift</code> and how quickly they can update complex code.  Starting with Codemod and moving to tools such as <code>ASTExplorer</code> and <code>jscodeshift</code> , you can learn how to create Codemod scripts according to your needs.  And the presence of a wide range of ready-made modules allows developers to actively promote the technology to the masses. </p><br><p>  <em>Translator‚Äôs note: there was an interesting talk on JSConfEU on this topic.</em> </p><br><div class="spoiler">  <b class="spoiler_title">Watch the video</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/d0pOgY8__JM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/332402/">https://habr.com/ru/post/332402/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../332390/index.html">Video instruction on Check Point Security CheckUP R80.10. Network security audit</a></li>
<li><a href="../332392/index.html">The book "Machine learning"</a></li>
<li><a href="../332394/index.html">AMD Strikes Back: AMD's share of the CPU market has grown to 31%</a></li>
<li><a href="../332396/index.html">On the protection of personal data in the Russian and European markets</a></li>
<li><a href="../332400/index.html">Openstack. Detective story or where the connection is lost? Part two. IPv6 and stuff</a></li>
<li><a href="../332406/index.html">How to protect data center from DDoS attacks?</a></li>
<li><a href="../332408/index.html">Video from Avito Data Science meetup</a></li>
<li><a href="../332412/index.html">Virtual site development pipeline and automation</a></li>
<li><a href="../332414/index.html">Announcement of the conference HolyJS 2017 Moscow: Two days of pure JS</a></li>
<li><a href="../332416/index.html">The experience of creating a real-time video sequencer on iOS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>