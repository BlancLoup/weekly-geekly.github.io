<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Freeradius. Support for different types of user authentication simultaneously</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I would like to share my experience in setting up freeradius in terms of supporting various types of user authentication. 

 Unfortuna...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Freeradius. Support for different types of user authentication simultaneously</h1><div class="post__text post__text-html js-mediator-article">  In this article I would like to share my experience in setting up freeradius in terms of supporting various types of user authentication. <br><br>  Unfortunately, faced with this problem, I could not find a ready-made solution in the open spaces of Google and other Yandex, and therefore I smoked mana on my own. <br><a name="habracut"></a><br>  So, the problem and its solution: <br><br><h4>  <b>DANO:</b> </h4><br>  1) Server running CentOS 6.6 with the freeradius package installed (version 2.1.12). <br>  2) SAS Server (Safenet Authentication Service) to provide two-factor user authentication for radius. <br>  3) User accounts are stored on the SAS server and in the MySQL database deployed on the radius server. <br>  4) The integration of freeradius and SAS has already been completed according to the <a href="http%253A%252F%252Fwww.safenet-inc.com%252Fresources%252Fintegration-guide%252Fdata-protection%252FSafenet_Authentication_Service%252FSafeNet_Authentication_Service__FreeRADIUS_Agent_Configuration_Guide%252F%26ei%3D0t25VcDHDcqNsAGx3bz4Bw%26usg%3DAFQjCNGWJ4HZOLVeKSEnKqTrsYyNVnQMlQ%26sig2%3D61fyM1LjOMNY6dEReOSY1Q%26bvm%3Dbv.99028883,d.bGg%26cad%3Drja">instructions</a> and is working successfully, I will not write about this in the article. <br>  5) The integration of freeradius with MySQL is also <a href="http://wiki.freeradius.org/guide/SQL-HOWTO">configured</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  <b>PROBLEM:</b> </h4><br>  When the SAS authentication module is enabled, radius stops authenticating users whose accounts are stored in MySQL (RADIUS itself). <br><br>  For the integration of freeradius and SAS, an additional module challAvecAuth is used, which is written in the authorize and authenticate section of the / etc / raddb / sites-enabled / default file.  And although all the instructions on freeradius state that reading the authorize section the radius tries to authenticate the user with all the listed modules in turn, in practice he encountered the fact that the challAvecAuth module appears in the authorize section regardless of its location (at the beginning, at the end, in the middle), he ‚Äúforces‚Äù freeradius to use only himself.  ALL other modules do not work. <br><br><h4>  <b>TASK:</b> </h4><br>  Configure user1 and user2 user authentication via SAS, and user3 and user4 user authentication via radius. <br><br><h4>  <b>DECISION:</b> </h4><br>  To solve this problem, the unlang language built into freeradius was used.  Using it, the condition was described according to which users user1 and user2 in the operators group are authenticated through SAS, and users user3 and user4 in the admins group are authenticated through radius itself.  Information about the belonging of users to groups is stored in the MySQL database as well as the login - the password of the user3 and user4 pair of users. <br>  MySQL table structure: <br><pre><code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> radusergroup;</code> </pre> <br><pre>  username groupname priority
 user1 operators 0
 user2 operators 0
 user3 admins 0
 user4 admins 0 </pre><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> radcheck;</code> </pre> <br><pre>  Id username attribute op Value
 1 user3 Cleartext-Password: = User3pwd
 2 user4 Cleartext-Password: = User4pwd </pre><br>  In the / etc / raddb / sites-enabled / default file in the authorize section, we make changes: <br>  1) Uncomment the sql module (if not yet uncommented) <br>  2) AFTER the sql module, add the following check condition: <br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Sql</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">Group</span></span> == admins) { pap } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { challAvecAuth }</code> </pre> <br>  3) And comment out a separate line <br>  pap <br>  As a result, the authorize section looks like this: <br><pre> <code class="hljs pgsql">authorize { preprocess chap mschap digest suffix eap { ok = <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">sql</span></span> expiration logintime <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Sql</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">Group</span></span> == admins) { pap } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { challAvecAuth } }</code> </pre> <br>  The condition here is the simplest: if the user is in the admins group, then the pap module authenticates it; if in any other group, then challAvecAuth (ie, SAS).  What write conditions depend only on the task and your imagination. <br>  4) Restart the radius and get the PROFIT! </div><p>Source: <a href="https://habr.com/ru/post/270631/">https://habr.com/ru/post/270631/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../270619/index.html">How we teach machine learning and data analysis in Beeline</a></li>
<li><a href="../270621/index.html">Six years go</a></li>
<li><a href="../270623/index.html">Windows Store and Malvari's Future</a></li>
<li><a href="../270625/index.html">Why upgrade to Data ONTAP Cluster Mode?</a></li>
<li><a href="../270629/index.html">Two providers of the Internet on the scheme DMVPN - dilution on different VRF on Spoke-ah</a></li>
<li><a href="../270633/index.html">Accidental hacking: why break low-visited sites</a></li>
<li><a href="../270635/index.html">LDAP replication</a></li>
<li><a href="../270637/index.html">Impose a responsive website correctly with Fronzy media-queries</a></li>
<li><a href="../270643/index.html">Cybergroup Buhtrap uses for its purposes attacks Watering Hole</a></li>
<li><a href="../270645/index.html">Jiant. Models for frontend applications</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>