<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Bike electrification kit development</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Greetings to all who are interested in electronics! My name is Vasily Sukhoparov, I am the Technical Director of Eczo.bike. I want to talk about how w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Bike electrification kit development</h1><div class="post__text post__text-html js-mediator-article">  Greetings to all who are interested in electronics!  My name is Vasily Sukhoparov, I am the Technical Director of Eczo.bike.  I want to talk about how we developed a bike electrification kit, which pitfalls we had to face and which engineering tricks to go.  Ahead will be a little STM32 programming, circuits, subtleties of the design of power boards and a few words about the mechanical component of the KEV (Bike Electrification Kit). <br><br> <a href="https://geektimes.ru/company/eczobike/blog/282516/"><img src="https://habrastorage.org/files/d25/a9f/2ae/d25a9f2ae80e431e839c766fa10567a5.jpg"></a> <br>  <i>Electrification kit with a maximum power of 2600 W, on-board computer, tracker, and replaceable batteries.</i> <br><a name="habracut"></a><br><h3>  <b>What was all this for?</b> </h3><br>  Having experience of self-assembly of an electric bike in parts and a large number of stuffed cones in the process, led me to the understanding that at the moment there are no offers on the market that meet all my needs. <br><br>  Every detail had to be customized, collective farm, invent something from scratch.  You can not just take and plug on the bike electronics, like a new video card in the computer.  There was no system Plug and <s>Play</s> Ride. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Your own system could provide: <br><br>  - modularity <br>  - ‚Äúuser-friendly‚Äù interface <br>  - the possibility of fine-tuning for themselves <br>  - no need to solder connectors and in general the availability of knowledge in electronics <br>  - low weight <br><br>  All of the above is something that an ordinary user will have to encounter who wants to convert large Chinese components.  With this approach, electro-bicycles will remain a lot of geeks and electronics engineers, unable to get into the masses. <br><br>  Industrial solutions do not shine with special power (up to 1000W) and are often built into their own bicycle frames.  In the home vacuum cleaner "horses" and then more :) About configurability and connection of additional features in general can not speak. <br><br>  Gradually, starting from the development of the on-board computer in the basement of my house (literally) and ending with the inverter, battery management system and the entire kit as a whole, it came to understand how everything should line up to ensure maximum comfort from using this device.  In this case, that the thing worked for the user, and not the user had to spend time to get it to work. <br><br><h3>  <b>What is the result?</b> </h3><br>  The prototype in the picture before the kata was assembled for the most part by manual labor, the boards were soldered right in the office, and immediately programmed.  On the CNC, the cases of solid plastic bars were milled; the metal frame was made in production.  The accumulators were assembled by their own labor, according to the technology a la Tesla, the basic component of which is an element in the form factor 18650, similar cells are found in most laptops.  Yes, formally Tesla rides notebook batteries :-) <br><br><img src="https://habrastorage.org/files/1d6/445/afd/1d6445afde9f45f68d228af9bfd022fc.jpg"><br><br>  The on-board computer shows not only the battery voltage or the percentage of charge (which is sometimes uninformative), but also the consumption in Wh, the specific power consumption Wh / km, and the range, three main parameters that you want to know when you go somewhere far away and you need to plan a route.  With an increase in speed, the air resistance also increases, moreover, in a progression, and it makes the main contribution to the energy consumption during movement.  You can save less by pressing the sneaker on the floor, or twisting the pedals. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/058/14d/05d/05814d05d48842439d3ff4e467e40543.JPG"></div><br>  The inverter (in common - the controller) controls the motor, allows you to customize the driving modes, control of the load, speed, power, in general, allows you to configure the system fairly widely.  It has built-in hardware short-circuit protection, temperature monitoring of transistors, a motor, support for a sensorless mode and the possibility of auto-detection of motor parameters.  The brain of the inverter is STM32F405.  By controlling all these parameters, it is possible to ensure high reliability from most cases that have arisen with me on Chinese electronics (whether it is overheating of the motor / controller, or burnout of the power switches due to the fact that the motor is locked, etc.). <br><br>  Maximum TTX such a piece of iron - IN: 30 ~ 90V 150A, OUT: 200A.  In KEV uses a simplified version of the controller with weaker characteristics. <br><br><img src="https://habrastorage.org/files/21c/4ec/5d6/21c4ec5d66874a0c8402754c6aa3fbe1.jpg"><br><br>  BMS (Battery management system) - battery management system.  Calculates the charge / discharge, controls the process of charging the elements and balances them, if necessary.  The difference from conventional BMS is again in reliability, most often Chinese BMS with a flame burned out.  You can see the voltage on each element of the battery, under load, you can monitor their internal resistance.  The main battery defect is increased self-discharge and deterioration of the int.  resistance, which can cause damage to the entire battery, if not noticed in time. <br><br>  Built-in thermal control.  Adding this module to the system allows you to use the battery as fully as possible without harming its health, for example, to reduce power when it is almost completely discharged or very cold / hot temperature, speeds up the charging process using its own balancing algorithm. <br><br><img src="https://habrastorage.org/files/f8d/dae/a52/f8ddaea5291b43ffbcf7c2de72460d2c.jpg"><br><br>  For the conversion of the bike was selected outboard motor, because  only it allows you to get a good moment on the wheel and more power with less weight.  This motor weighs 3kg.  For comparison, the motor wheels are of two types: Direct drive - ‚Äúdirect drive‚Äù - there are 1000W or even more, but they weigh from 6 kg to 23 kg only per motor.  Geared - gearbox - up to 500W weight from 2 kg, and literally a couple of motors 1000W to 4.5 kg.  In the first case, it is necessary to put reinforced rims on the bike, and be sure to build up the iron at the point of attachment of the motor axis so that the frame does not roll.  But no motor wheel in a similar weight category can get a moment of the order of 160 Nm at the rear wheel. <br><br><h3>  <b>Characteristics of KEV</b> </h3><br><blockquote>  Peak power up to 2600 W electric <br>  Maximum current of the motor 70A <br>  Maximum battery current 50A <br>  Battery Voltage 36.4 ~ 54.6V <br>  Maximum charge current 1C (~ 1 hour) <br>  CAN bus <br>  DC-DC OUT: 13V 13W + 10W for modules <br>  On-board computer with FSTN screen 240x128 2.8 " <br>  Bluetooth 4.0 on BMS or in inverter </blockquote><br><h3>  <b>Device block diagram</b> </h3><br>  To ensure versatility in connection, a CAN bus with 13V on-board voltage and a separate battery bus with battery voltage was chosen. <br><br><img src="https://habrastorage.org/files/8ef/171/4c0/8ef1714c08634c8e93a87c7393c9f32c.PNG"><br>  The heart of the whole system is the controller that controls the motor.  It converts DC voltage from battery to AC with frequency up to 1500 Hz.  (PWM frequency is higher - up to 20 kHz) Control signals are received either directly or from the on-board computer (screen) via the CAN bus.  It also has a Ubat converter.  in 13V to ensure the operation of the modules. <br><br>  The battery connects to the common network via BMS, as mentioned above, it monitors the battery to ensure its long service life.  It also has a 13V converter for module operation. <br><br>  The on-board computer is connected via a CAN bus with on-board voltage, it displays information that it receives from the modules, and can also record data on an SD card. <br><br>  The tracker is also connected via CAN + 13V and has a small battery at its disposal to protect against bike theft when the main battery is missing. <br><br>  The system supports connecting up to 4 batteries and controllers at the same time, for example, to control four-wheeled vehicles. <br><br><h3>  <b>In custody</b> </h3><br>  In the following articles I will discuss in more detail about the development of an onboard computer, a controller, a battery management system and how we collected batteries from the cells.  If it is interesting, I will write a separate article about testing the drive on the dyno or how to measure the efficiency of the motor + controller bundle at home. </div><p>Source: <a href="https://habr.com/ru/post/399029/">https://habr.com/ru/post/399029/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../399019/index.html">Helios headset uses Intel RealSense technology to help people with visual impairments</a></li>
<li><a href="../399021/index.html">How artificial intelligence is changing the chip market</a></li>
<li><a href="../399023/index.html">Brain implant allowed paralyzed monkeys to walk again</a></li>
<li><a href="../399025/index.html">Facial electrodes allow you to chew and feel the taste in virtual reality</a></li>
<li><a href="../399027/index.html">IoT in the vending business: intelligent vending</a></li>
<li><a href="../399031/index.html">Microsoft returns money to Call of Duty: Infinite Warfare customers in the Windows Store</a></li>
<li><a href="../399033/index.html">British scientists told about how "British scientists" appeared</a></li>
<li><a href="../399035/index.html">The share of Google Chrome among browsers has reached 55% and continues to grow</a></li>
<li><a href="../399037/index.html">What happens when a person far from this sphere writes about a guitar tube sound</a></li>
<li><a href="../399039/index.html">Panda among the penguins. x86_64 LattePanda microcomputer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>