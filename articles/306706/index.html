<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Phishing at a new level: Cloudflare + Protonmail + Unvalidated Redirects - a set of young phisher</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content=""... you come and ask for something from me, but you ask without respect ..." 
 Vito Corleone 
 Phishing is still the most popular and most successful...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Phishing at a new level: Cloudflare + Protonmail + Unvalidated Redirects - a set of young phisher</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  <i>"... you come and ask for something from me, but you ask without respect ..."</i> <br>  Vito Corleone </blockquote><br>  Phishing is still the most popular and most successful type of hacker attack.  It's simple, it is not the software, not the server, not the network that is attacked, but the most vulnerable components of the information systems - users.  I often meet with phishing, as a single, aimed at personal addresses, and massive attacks.  In most cases, these are clumsily composed letters and sloppy phishing pages.  Until recently, most of these attacks broke down at the user level: emails were immediately ignored (since the signs of phishing were very obvious) or, in the worst case, emails were redirected to the support service with the question ‚ÄúIs it safe to enter a password on this page?‚Äù.  Of course, some of the users still came across, but in percentage terms it was really the minimum.  But just last week I was faced with a phishing attack, the level of which surprised me.  I did a little analysis and found out exactly how it was organized and what tools were used. <br><a name="habracut"></a><br>  I hope it will not look like instructions for preparing phishing attacks, in fact, the purpose of the article is to talk about a specific case from practice.  I will also share the results of a small analysis of the actions of intruders. <br><br><h5>  Phishing page </h5>  I will not observe the sequence (as already mentioned, this is not a guide to action), and I will begin with what surprised me the most, namely, the fake page where the victims of the attack went.  The page was an exact copy of the victim's ADFS page.  In addition to visual similarity, the page was on a domain of the same level and the URL differed only in one letter: the real address of the ADFS portal was <pre>  https://login.contoso.ch/ </pre>  , the address of the phishing page - <pre>  https://login.contoso.cf/ </pre>  (hereinafter the company name is replaced by contoso).  And yes, the protocol was the same, the phishing page used SSL with a full certificate from COMODO! .. Of course, without Extended Validation, but nevertheless, Chrome displayed the address ‚Äúgreen‚Äù. <br><img src="https://habrastorage.org/files/53c/875/4e4/53c8754e40dd4bd69480e7e924422f0e"><br><br><h5>  "Investigation" </h5><br>  How so?  Very stupid "hackers"!  Second-level domains and certificates do not give COMODO to anyone, they will be easy to calculate!  But it is at first glance ... 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h6>  Domain </h6><br>  Google suggested that .cf domains are distributed free of charge.  In this case, it‚Äôs not the price that is important, but the ability to purchase a domain, without leaving a trace in the form of a credit card (or other payment method).  That is, the usual (left) email address is more than enough.  One of the registrars, Freenom, besides cf, also offers tk, ml, ga.  The only inconvenience is that when registering it is impossible to specify some free email addresses (mail.ru, yandex.ru, yahoo.com), but with most other addresses you can register a domain. <br><br><h6>  Email </h6><br>  We couldn‚Äôt find out what mail our phisher used for registering a domain, since the whois server issued the following message:  However, it can be assumed that protonmail, since phishing messages themselves were sent using this service.  This is not surprising, since on protonmail you can register absolutely anonymously, and even if you involve the relevant authorities for investigation, it will not be easy to force protonmail to cooperate, as <a href="http://www.business-standard.com/article/companies/why-cyber-probe-into-the-interview-might-get-nowhere-116031600261_1.html">practice</a> shows. <br><br><h6>  SSL certificate and hosting </h6><br>  Prior to this incident, we naively thought that it was impossible to raise a web server with a valid ssl certificate from COMODO, without leaving any traces.  As it turned out, it is not.  In our case, the attackers took advantage of Cloudflare.  A small analysis of the proposed features of the free package from Cloudflare revealed a wealth of opportunities for phishing: <br>  - Completely anonymous registration.  Mail addresses (from the same protonmail) are more than enough.  Theoretically, they can find out from what IP address registration / login was, but I am more than confident that our attackers could easily hide the real address. <br>  - Free certificate from COMODO.  It is not only free, but also issued in a few minutes without any additional verification. <br>  - Hiding the real IP address of the web server.  All traffic goes through Cloudflare (this is primarily a CDN service) <br>  - SSL offloading.  A real web server can work via unprotected http, using Cloudflare, all traffic will go through SSL.  This is important because it is real to find free hosting with HTTP, and you need to pay for SSL hosting (leaving traces). <br><br>  <b>And one more fact: with rare exceptions, CA services for domains ga, cf, tk do not sign certificates.</b>  <b>In this case (even if you are not a phisher) Cloudflare solves the problem, through them a certificate is issued without problems.</b> <br><br><h5>  Unvalidated Redirects in Phishing Service </h5><br>  Now the fun part.  The phishing letter, which itself was a masterpiece of social engineering, naturally contained a link, but not a phishing page.  The link was to the company's website, to a page with a Unvalidated Redirects vulnerability.  This may have been one of the reasons why the letter went through all the anti-spam filters. In the letter to user@contoso.ch there was only one link to <pre>  http://contoso.ch/vulnerable.php?url=https://login.contoso.cf/ </pre><br><br><h5>  Is it possible to find them? </h5><br>  Without a doubt, we ourselves will not be able to find them.  Can they find the "organs"?  You can try to request data from the registrar or Cloudflare and go to the same protonmail.  If they cooperate, the maximum that can be obtained is the IP address.  Is it possible to ‚Äúcalculate‚Äù a criminal by IP address?  I doubt it. <br><br><h5>  Total </h5><br>  We do not know how many users "bought" - they themselves will not be recognized.  Just in case, we advised everyone to change AD passwords.  The company itself was strongly recommended to enable two-factor authentication on ADFS using <a href="https://msdn.microsoft.com/en-us/library/dn783423.aspx">Custom Authentication.</a> <br><br>  <i>PS And yet, I'm not sure that I myself would not fall for it - the level impressed me.</i> </div><p>Source: <a href="https://habr.com/ru/post/306706/">https://habr.com/ru/post/306706/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../306694/index.html">Why in Ukraine there are still white hackers</a></li>
<li><a href="../306696/index.html">Documents in the wires: EDO from MegaFon</a></li>
<li><a href="../306698/index.html">What is the signature. From blood drop to EDS</a></li>
<li><a href="../306700/index.html">Bank card from MegaFon</a></li>
<li><a href="../306702/index.html">Rust: for and iterators</a></li>
<li><a href="../306712/index.html">Google Improves Android Core Security</a></li>
<li><a href="../306714/index.html">Open Ivideon API: First Steps</a></li>
<li><a href="../306716/index.html">Frontend developers should be on topic</a></li>
<li><a href="../306720/index.html">Evening of December 31</a></li>
<li><a href="../306724/index.html">Tools for prototyping: from a quick-assembled layout to full-featured prototypes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>