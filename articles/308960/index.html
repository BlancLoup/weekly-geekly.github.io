<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Optimization by example. Imitation annealing against the ant algorithm. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day to all. Recently I read an article about imitation annealing on the example of the traveling salesman problem. The picture before and after o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Optimization by example. Imitation annealing against the ant algorithm. Part 1</h1><div class="post__text post__text-html js-mediator-article">  Good day to all.  Recently I read <a href="https://habrahabr.ru/post/209610/">an article</a> about imitation annealing on the example of the traveling salesman problem.  The picture before and after optimization caused interest.  Something like this is lured. Also in the comments I noticed that it would be interesting for people to look at the comparison with other types of optimization. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/272/9e6/a38/2729e6a389cd47e69968f1fb2ce80373.jpg"></div><br><a name="habracut"></a><br>  I like the Habr site, especially I like the way people know how to correctly express their "technical" thoughts on paper, which I cannot say about myself.  Therefore, I tried to describe everything as much as possible in the comments - it is much easier for me, and it will be more convenient for you to understand. <br><br>  The code is written in MATLAB.  With a specific spelling syntax is easy to understand.  When writing algorithms, I tried to maintain a balance between the ‚Äúunderstanding‚Äù of the code and the speed of execution, eliminating vectorization, and where it is ‚Äî alternative code was written in the comments.  If you have any questions - I will try to answer in the comments.  This is the first part of the series ‚ÄúOptimization by Example‚Äù; further publications will be published depending on your comments.  That is, if you need a comparison with other heuristic methods, or if you have any suggestion (say, change the temperature formula, or the initial location of ants), where you can refine, and where you can change part of the algorithm, write.  It will be interesting to everyone, and me too.  I implement and publish as much as possible. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The purpose of the publication, first of all, to show on the detailed comments in the code the principle of operation of the two algorithms, the comparison is a secondary goal.  In this article, comparing ‚Äúpurely‚Äù will not work, since the two algorithms, especially formic, contain a decent number of initial variable parameters.  Moreover, some questions arose, but more on that later.  In the simulation annealing easier, however, also has its own nuances.  For those who are just familiar with these algorithms, I recommend first reading the useful material located at the end of the article. <br><br>  The theory of two algorithms is on Habr√© and on other sites, but I didn‚Äôt find the open code of the ant algorithm with explanatory comments, there is pseudo-code, there are separate parts of it.  The code of imitation annealing on MATLAB was laid out earlier, however, for comparison with other types of optimization, it has a low speed.  Therefore, I wrote my own, increasing the speed at times.  Both algorithms are written without built-in eigenfunctions, because with a small code, in my opinion, it is easier to perceive the structure of the algorithm.  In places where you can get confused tried to give more detailed comments.  Proceeding from this, I will not go into the theory, I will give only the following: <br><br><h3>  Imitation annealing </h3><br>  The method of simulating annealing reflects the behavior of the material body during controlled cooling.  Studies have shown that during solidification of the molten material, its temperature should decrease gradually, until the moment of complete crystallization.  If the cooling process proceeds too quickly, significant irregularities in the structure of the material are formed, which cause internal stresses.  Rapid fixation of the energy state of the body at a level above the normal is similar to the convergence of the optimization algorithm to the local minimum point.  The energy of the state of the body corresponds to the objective function, and the absolute minimum of this energy - the global minimum <a href="http://stu.scask.ru/book_ns.php%3Fid%3D29">[1]</a> . <br><br><h3>  Ant algorithm </h3><br>  One of the efficient polynomial algorithms for finding approximate solutions to the traveling salesman problem, as well as solving similar route search problems on graphs.  The essence of the approach lies in the analysis and use of the model of the behavior of ants looking for paths from the colony to the power source and represents a meta-heuristic optimization <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D1%2583%25D1%2580%25D0%25B0%25D0%25B2%25D1%258C%25D0%25B8%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25B0%25D0%25BB%25D0%25B3%25D0%25BE%25D1%2580%25D0%25B8%25D1%2582%25D0%25BC">[2]</a> . <br><br>  There are many modifications of ant algorithms.  Somewhere a different update of pheromones, somewhere there are "elite" ants, and somewhere a different location of the ants at the start.  In the code, just comment out something, uncomment something. <br><br><div class="spoiler">  <b class="spoiler_title">Imitation annealing.</b>  <b class="spoiler_title">Full code with comments</b> <div class="spoiler_text"><pre><code class="matlab hljs"><span class="hljs-comment"><span class="hljs-comment">%   (     ) %-------------------------------------------------------------------------- tic % clearvars -except cities clearvars % ----------------------------------------------------------------- % -  m = 100000; % ---------------------------------------------------------------- %   Tstart = 10000; %   Tend = 0.1; %     T = Tstart; %  S = inf; %   n = 100; % ------------------------------------------------------------------- %   dist = zeros(n,n); % ------------------------------------------------------------------------- %   (x,y) cities = rand(n,2)*100; %    ROUTE = randperm(n); %    for i = 1:n for j = 1:n % dist (  ) dist(i,j) = sqrt((cities(i,1) - cities(j,1))^2 + ... (cities(i,2) - cities(j,2))^2); end end %  ,   -  for k = 1:m %    Sp = 0; %     , ROUTEp - %   %   ROUTEp = ROUTE; %    transp = randperm(n,2); %  ,     transp  %     if transp(1) &lt; transp(2) ROUTEp(transp(1):transp(2)) = fliplr(ROUTEp(transp(1):transp(2))); else ROUTEp(transp(2):transp(1)) = fliplr(ROUTEp(transp(2):transp(1))); end %   ()   for i = 1:n-1 Sp = Sp + dist(ROUTEp(i),ROUTEp(i+1)); end Sp = Sp + dist(ROUTEp(1),ROUTEp(end)); %    ,     ... %  , ,    if Sp &lt; S S = Sp; ROUTE = ROUTEp; else %     0  1 RANDONE = rand(1); %    P = exp((-(Sp - S)) / T); if RANDONE &lt;= P S = Sp; ROUTE = ROUTEp; end end %   T = Tstart / k; %    if T &lt; Tend break; end; end %   citiesOP(:,[1,2]) = cities(ROUTE(:),[1,2]); plot([citiesOP(:,1);citiesOP(1,1)],[citiesOP(:,2);citiesOP(1,2)],'-r.') %   clearvars -except cities ROUTE S %   toc</span></span></code> </pre> <br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Ant algorithm.</b>  <b class="spoiler_title">Full code with comments</b> <div class="spoiler_text"><pre> <code class="matlab hljs"><span class="hljs-comment"><span class="hljs-comment">%   (     ) % ------------------------------------------------------------------------- tic % clearvars -except cities clearvars % ----------------------------------------------------------------- % -  (  ) age = 50; % -    countage = 30; % -  n = 30; % ----------------------------------------------------------------- %  -  ,  0     %   a = 1; %  -  ,  0  %      b = 2.5; %   (   ) e = 0.5; %    Q = 1; % -   (     elite  ) elite = 1; %   ph = 0.01; % ------------------------------------------------------------------- %   dist = zeros(n,n); %    returndist = zeros(n,n); %       ROUTEant = zeros(countage,n); %       DISTant = zeros(countage,1); %       bestDistVec = zeros(age,1); %    bestDIST = inf; %   ROUTE = zeros(1,n+1); %     (    ) RANDperm = randperm(n); %   P = zeros(1,n); % ------------------------------------------------------------------------- %   (x,y) cities = rand(n,2)*100; %    tao = ph*(ones(n,n)); %        for i = 1:n for j = 1:n % dist (  ) dist(i,j) = sqrt((cities(i,1) - cities(j,1))^2 + ... (cities(i,2) - cities(j,2))^2); % nn (   ) if i ~= j returndist(i,j) = 1/sqrt((cities(i,1) - cities(j,1))^2 + ... (cities(i,2) - cities(j,2))^2); end end end %  for iterration = 1:age %  (  ) for k = 1:countage % ******************    ****************** %    %     % ROUTEant(k,1) = randi([1 n]); %       (   ), - %   -       ROUTEant(k,1) = RANDperm(k); %           1- % ROUTEant(k,1) = 1; %       ,    %  ,     ,      %   % if iterration == 1 % ROUTEant(k,1) = randi([1 n]); % % ROUTEant(k,1) = RANDperm(k); % % ROUTEant(k,1) = 1; % else % ROUTEant(k,1) = lastROUTEant(k); % end % ********************************************************************* %   ,   ,     for s = 2:n %     ir = ROUTEant(k,s-1); %    (  ) ,     % : tao^a*(1/S)^b % 1/S - returndist. %      (-  *  %  * - ) ,       , %      .    %   .     : % for c = 1:n % P(1,c) = tao(ir,c).^a * returndist(ir,c).^b; % end P = tao(ir,:).^a .* returndist(ir,:).^b; %   (     k- ) %  n ,      ,   %  %     ,   ,  %    0,     %       P(ROUTEant(k,1:s-1)) = 0; %    (     = 1 ) P = P ./ sum(P); %       RANDONE = rand; getcity = find(cumsum(P) &gt;= RANDONE, 1, 'first'); %    -  ,   if isempty(getcity) == 1 disp '  !' end %  s-    k-  ROUTEant(k,s) = getcity; end %   k-  ROUTE = [ROUTEant(k,1:end),ROUTEant(k,1)]; %   S = 0; %   k-  for i = 1:n S = S + dist(ROUTE(i),ROUTE(i+1)); end %  k- ,   k-  DISTant(k) = S; %     S if DISTant(k) &lt; bestDIST bestDIST = DISTant(k); bestROUTE = ROUTEant(k,1:end); end %  ""  k-  (    %      ,    %  ) % lastROUTEant = ROUTEant(1:end,end); end % -----------------------  --------------------- %   ""   -   tao = (1-e)*tao; for u = 1:countage %   u-  ROUTE = [ROUTEant(u,1:end), ROUTEant(u,1)]; %    for t = 1:n x = ROUTE(t); y = ROUTE(t+1); %    if DISTant(u) ~= max(DISTant) %         %  tao(x,y) = tao(x,y) + Q / DISTant(u); else %     tao(x,y) = tao(x,y) + (elite*Q) / DISTant(u); end end end end %   citiesOP(:,[1,2]) = cities(bestROUTE(:),[1,2]); plot([citiesOP(:,1);citiesOP(1,1)],[citiesOP(:,2);citiesOP(1,2)],'.r-') clearvars -except cities ROUTE bestDIST bestROUTE ROUTEant toc</span></span></code> </pre></div></div><br>  So, let's compare, we will generate for the beginning 30 cities. <br><br>  <i>Imitation annealing:</i> <br><br>  Options: <br><br><ul><li>  The number of cities - 30 </li><li>  Initial temperature - 10,000 </li><li>  Final temperature - 0.01 </li><li>  Temperature formula - initial temperature / kth iteration </li><li>  Number of iterations - 100,000 </li><li>  Acceptance probability function - exp (-ŒîE / T) </li><li>  Determination of a potential route (generating family) - reversal of a part of a vector (current route) from two randomly selected numbers with a uniform distribution </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/files/c42/a8a/0e2/c42a8a0e29a846d7979536a66f90df2b.gif"></div><br><br>  Now look at the work of the ant algorithm at the same coordinates. <br><br>  <i>Ant algorithm:</i> <br><br>  Options: <br><br><ul><li>  The number of iterations (generations) - 60 </li><li>  The number of ants in the generation - 30 </li><li>  The number of cities - 30 </li><li>  alpha (coefficient of orientation to pheromones) - 0.85 </li><li>  beta (coefficient of orientation to the length of the path) - 3.8 </li><li>  e (coefficient evaporation of pheromones) - 0.5 </li><li>  elite (number of elite ants) - no </li><li>  The location of the ants in the first cities is different, without repetition.  Number of cities = number of ants in a generation </li><li>  pheromone update - global (pheromones are updated after the passage of the 1st generation) </li><li>  probability of transition from one vertex to another - <img src="https://habrastorage.org/files/d98/9f5/4e2/d989f54e2d5f4fbfa705575af81e3e33.jpg"></li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/files/dd7/7bd/a4a/dd77bda4a60248edb02667a6e4d068eb.gif"></div><br>  Before you visual work of two algorithms.  Once again I will note that a detailed explanation (especially of the ant algorithm) in the comments of the code. <br><br>  Please note that in imitation annealing, the optimum was already found at 20,000 iterations, then, when the temperature was low enough, the probability of switching to new routes decreased significantly, so the algorithm ‚Äúgot up‚Äù.  Here you can enter the criteria for stopping.  The higher the initial temperature, the greater the likelihood of getting to the optimal route, and the more iterations will be performed, however, it is far from a fact that we will find a global optimum. <br><br>  In the ant algorithm, everything is different.  The main advantage of the ant algorithm is that it will never stop, it will always look for better ways.  With an infinite number of iterations (generations), the probability of finding a global optimum will tend to 1. However, at the very beginning the question arose: which initial parameters should we choose?  Answer: the method of selection.  We are optimizing again.  These parameters of the ant optimization were optimized using a genetic algorithm <u>not at these coordinates</u> .  There were other coordinates and the number of cities was 50. Not really getting good convergence, I got some parameters that roughly correspond to this example. <br><br>  On one test, I did not go far, so I bring a table from a series of tests. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/b05/169/631/b05169631a2245528dfc4c517dcbca51.jpg"></div><br>  One can see the stability of the two algorithms, however, the variation in the mean value of the ant algorithm is smaller. <br><br>  Now let's look at the work of two algorithms per 100 generated cities. <br><br>  <i>Imitation annealing:</i> <br><br>  Options: <br><br><ul><li>  The number of cities - 100 </li><li>  Initial temperature - 42,000 </li><li>  Final temperature - 0.01 </li><li>  Temperature formula - initial temperature / kth iteration </li><li>  Number of iterations - 420,000 </li><li>  Acceptance probability function - exp (-ŒîE / T) </li><li>  Determination of a potential route (generating family) - reversal of a part of a vector (current route) from two randomly selected numbers with a uniform distribution </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/files/1e1/f56/53e/1e1f5653ea7a4e0f9693f02731c5d1a2.gif"></div><br>  Now look at the work of the ant algorithm at the same coordinates. <br><br>  <i>Ant algorithm:</i> <br><br>  Options: <br><br><ul><li>  Number of iterations (generations) - 50 </li><li>  Number of ants per generation - 100 </li><li>  The number of cities - 100 </li><li>  alpha (coefficient of orientation to pheromones) - 1 </li><li>  beta (coefficient of orientation to the length of the path) - 3 </li><li>  e (coefficient evaporation of pheromones) - 0.5 </li><li>  elite (number of elite ants) - no </li><li>  The location of the ants in the first cities is different, without repetition.  Number of cities = number of ants in a generation </li><li>  pheromone update - global (pheromones are updated after the passage of the 1st generation) </li></ul><br>  Here the parameters took "by eye". <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/cbc/ab5/d97/cbcab5d979b44d17a0914b5f3c7d797e.gif"></div><br>  Again, the ant algorithm showed a better result, however, let's look again at the table from the test series: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a0c/bcd/56b/a0cbcd56b5fc4263b33bd45becf09394.jpg"></div><br>  Here imitative annealing went far ahead.  In general, before I read the article, I was skeptical about imitative annealing.  In the development of trading systems (in which I am involved) and their optimization, the annealing method is not suitable, since it is not the local optimum itself that is important for us, but the ‚Äúspread‚Äù around it.  On a conditional example: there is a moving average of 15 days on some paper, the yield for the year showed 10,000, and at 14 days (-1000).  Here it is important for us that near the optimal parameter the profit should evenly decrease.  Therefore, in different situations - different optimization. <br><br>  As for the traveling salesman task, I, even if not in a ‚Äúpure‚Äù competition (because it didn‚Äôt work out the right parameters for the ant algorithm), give up the victory to simulated annealing.  If you add a stopping criterion, the same distances can be achieved in 2.5 seconds without much changing the standard deviation, which is not the case with the ant algorithm.  According to a series of tests, much of which did not get here, the ant algorithm works brilliantly up to 50 cities, then begins to "drizzle", the optimization time slows down dramatically, which is logical in principle.  However, he confidently goes to the global optimum, even if slowly. <br><br>  Somewhere deep in my heart I still want the ant algorithm to show itself better.  Maybe that is why the feeling that I made a mistake somewhere, and not just one, does not leave.  Therefore, those who are interested, and those who are just starting their way in this direction - join.  Write comments with suggestions, both about the algorithms, and about how best to submit the material. <br><br>  In the meantime, look at today's winner.  500 cities, 86 seconds of optimization (and this is far from the limit). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/bb6/14e/40e/bb614e40e1ac44da9fefb178d9e219a0.jpg"></div><br>  Very cool! <br><br>  Catch up or not the ant algorithm?  Will it overtake it genetic?  Who will be more effective?  About this and another in the following publications. <br><br>  <i>Useful material:</i> <br>  ¬ª <a href="https://www.youtube.com/watch%3Fv%3DEwDP_bAb-OI">Video about ant algorithm (in Russian)</a> <br>  ¬ª <a href="https://www.youtube.com/watch%3Fv%3DhbZ2EaTal-4">Video about imitation annealing (in Russian)</a> <br>  ¬ª <a href="http://www.serhiy-shtovba.narod.ru/doc/Shtovba_Ant_Algorithms_ExponentaPro_2003_3.pdf">An article about the ant algorithm (in Russian)</a> <br>  ¬ª <a href="http://www.math.spbu.ru/user/gran/sb1/lopatin.pdf">An article about imitation annealing (in Russian)</a> </div><p>Source: <a href="https://habr.com/ru/post/308960/">https://habr.com/ru/post/308960/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../308950/index.html">Half-HA cluster PostgreSQL on Windows 2012</a></li>
<li><a href="../308952/index.html">Porting a portfolio from Brainstorage to Freelansim</a></li>
<li><a href="../308954/index.html">How-to: interactive writing guide</a></li>
<li><a href="../308956/index.html">Microsoft Azure StorSimple: easy access to hybrid cloud. Part 1</a></li>
<li><a href="../308958/index.html">In the new list of the most profitable IT companies in Russia, 50% of the seats are occupied by foreign firms.</a></li>
<li><a href="../308962/index.html">Using TCL in FPGA Development</a></li>
<li><a href="../308966/index.html">New release of Kali Linux 2016.2</a></li>
<li><a href="../308968/index.html">AMD introduces new security mechanisms for its AMD-V hypervisor</a></li>
<li><a href="../308972/index.html">The logic of consciousness. Part 3. Holographic memory in a cellular automaton</a></li>
<li><a href="../308974/index.html">Tabs or spaces? Analysis of 400 thousand GitHub repositories, billion files, 14 TB code</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>