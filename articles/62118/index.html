<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>regsrv32.exe on .NET / Register COM server from .NET</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The problem was this: 
 The client had to switch between two versions of the application, which uses about 1000 com objects. 
 To switch, you need to ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>regsrv32.exe on .NET / Register COM server from .NET</h1><div class="post__text post__text-html js-mediator-article"> The problem was this: <br>  The client had to switch between two versions of the application, which uses about 1000 com objects. <br>  To switch, you need to unreg all dll of the first version and reg all dll of the second version ... Then, when you need to switch to the first version again, repeat the process in the opposite direction ... <br>  You can run regsrv32.exe many times, however, it is long and hard :) (for each dll, as many as 2 processes will be running, reg and anreg) ... <br>  Therefore, the following code was written.  Of great value, he is not, but because  google search for the implementation of the registration of the com server on .NET did not give anything like that, I bring it here for indexing and use by those who suddenly need :) <br><a name="habracut"></a><br> <code>// regsrv32  .NET  . register com server via .net <br> private void RegDll(string mDll) { <br> IntPtr pDll = NativeMethods.LoadLibrary(@"path_to_dll\your.dll"); <br> if (pDll == IntPtr.Zero) { <br> //...... <br> } <br> <br> IntPtr pDllRegServ = NativeMethods.GetProcAddress(pDll, "DllRegisterServer"); <br> IntPtr pDllUnRegServ = NativeMethods.GetProcAddress(pDll, "DllUnregisterServer"); <br> // check ptrs for zero... <br> <br> DllFuncServer reg = <br> (DllFuncServer) Marshal.GetDelegateForFunctionPointer(pDllRegServ, typeof(DllFuncServer)); <br> <br> DllFuncServer unReg = <br> (DllFuncServer)Marshal.GetDelegateForFunctionPointer(pDllUnRegServ, typeof(DllFuncServer)); <br> <br> int resUnreg = unReg(); <br> int resReg = reg(); <br> bool result = NativeMethods.FreeLibrary(pDll); <br> Console.Write(resUnreg + " " + resReg); <br> } <br> <br> [UnmanagedFunctionPointer(CallingConvention.Cdecl)] <br> private delegate int DllFuncServer(); <br> <br> static class NativeMethods { <br> [DllImport("kernel32.dll")] <br> public static extern IntPtr LoadLibrary(string dllToLoad); <br> <br> [DllImport("kernel32.dll")] <br> public static extern IntPtr GetProcAddress(IntPtr hModule, string procedureName); <br> <br> [DllImport("kernel32.dll")] <br> public static extern bool FreeLibrary(IntPtr hModule); <br> }</code> </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/62118/">https://habr.com/ru/post/62118/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../62110/index.html">How many years do you think a child should be allowed to access the Internet?</a></li>
<li><a href="../62111/index.html">MTS-Ukraine: Communication does not work in Kharkov</a></li>
<li><a href="../62114/index.html">md.by - we built and built and, finally, built ...</a></li>
<li><a href="../62115/index.html">SMS posts at www.twitter.com</a></li>
<li><a href="../62117/index.html">Shaq congratulated Kobi via Twitter</a></li>
<li><a href="../62120/index.html">Opera is preparing a revolution on the Internet</a></li>
<li><a href="../62121/index.html">Jabber ‚Üí Evernote</a></li>
<li><a href="../62122/index.html">SQL Server - Find out the week of the month of the week of the year</a></li>
<li><a href="../62123/index.html">Toshiba Satellite 1850c laptop review</a></li>
<li><a href="../62126/index.html">Intel vPro Contest</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>