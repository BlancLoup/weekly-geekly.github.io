<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How I found a bug in Intel Skylake processors</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The instructors of the Introduction to Programming course know that students find any reasons for the mistakes of their programs. Did the sorting proc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How I found a bug in Intel Skylake processors</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/f82/7b2/c1a/f827b2c1a23a435d9696abb154b87894.jpg" align="left">  The instructors of the Introduction to Programming course know that students find any reasons for the mistakes of their programs.  Did the sorting process discard half the data?  ‚ÄúCould it be a virus in Windows!‚Äù Did the binary search never work?  ‚ÄúThe Java compiler is behaving strangely today!‚Äù Experienced programmers know very well that a bug is usually in their own code, sometimes in third-party libraries, very rarely in system libraries, extremely rare in a compiler and never in a processor.  I thought so too until recently.  I have not yet encountered a bug in the Intel Skylake processors when I was debugging OCaml‚Äôs mysterious crashes. <br><br><h1>  First manifestation </h1><br>  At the end of April 2016, shortly after the release of OCaml 4.03.0, one Very Serious Industrial User OCaml (OSIP) addressed me privately with bad news: one of our applications, written in OCaml and compiled in OCaml 4.03.0, fell randomly .  Not at every launch, but sometimes segfault crashed, in different places of the code.  Moreover, failures were observed only on their newest computers that run on Intel Skylake processors (Skylake is the code name of the latest generation of Intel processors at the time. Now the latest generation is Kaby Lake). <br><br>  Over the past 25 years, I have been informed of many OCaml bugs, but this message was of particular concern.  Why only processors skylake?  In the end, I could not even reproduce the crashes in OSIP binaries on computers in my company Inria, because they all worked on older Intel processors.  Why fails are not reproduced?  The OSIP single-threaded application does network and disk I / O operations, so its execution must be strictly deterministic, and any bug that caused a segfault should manifest itself at each launch in the same place of the code. <br><a name="habracut"></a><br>  My first guess was that OSIP had hardware glitches: bad memory chip?  overheat?  In my experience, due to such malfunctions, the computer can boot up and work normally in the GUI, but falls under load.  So, I advised OSIP to run a memory check, reduce the processor clock speed and disable Hyper-Threading.  The assumption about HT appeared in connection with a recent report about a bug in Skylake with AVX vector arithmetic, which appeared only when HT was turned on ( <a href="http://arstechnica.com/gadgets/2016/01/intel-skylake-bug-causes-pcs-to-freeze-during-complex-workloads/">see description</a> ). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      OSIP did not like my advice.  He objected (logically) that they ran other demanding CPU and memory tasks / tests, but only programs written in OCaml are falling.  Obviously, they decided that their hardware was fine, but a bug in my program.  Well, great.  I still persuaded them to run a memory test that revealed no errors, but they ignored my request to turn off the HT.  (Very bad, because it would save us a lot of time). <br><br>  At the same time, OSIP conducted an impressive investigation using different versions of OCaml, different C compilers, which are used to compile the OCaml support system, and different operating systems.  The verdict was as follows.  Buggy OCaml 4.03, including early beta, but not 4.02.3.  From compilers GCC is buggy, but not Clang.  From operating systems - Linux and Windows, but not MacOS.  Since MacOS uses Clang and the port from the Windows version on GCC works there, the reason is clearly called OCaml 4.03 and GCC. <br><br>  Of course, OSIP reasoned logically: they say, in the OCaml 4.03 run-time support system there was a fragment of bad C code - with <a href="https://blog.regehr.org/archives/213">undefined behavior</a> , as we say in business - because of which GCC generated bad machine code, since C compilers are allowed to work with indefinite behavior.  This is not the first time that GCC handles undefined behavior as improperly as possible.  For example, see <a href="http://www.kb.cert.org/vuls/id/162289">this security vulnerability</a> or <a href="https://blog.regehr.org/archives/918">this broken benchmark</a> . <br><br>  Such an explanation seemed plausible, but it did not explain the random nature of the failures.  GCC generates bizarre code due to undefined behavior, but it is still deterministic code.  The only reason for the randomness that I could come up with could be <a href="https://en.wikipedia.org/wiki/Address_space_layout_randomization">Address Space Layout Randomization</a> (ASLR) ‚Äîthe OS function to randomize the address space, which changes the absolute addresses in memory each time it starts.  The OCaml runtime support system uses absolute addresses in some places, including for indexing memory pages into a hash table.  But the crashes remained random even after the ASLR was turned off, in particular, while the GDB debugger was running. <br><br>  It was May 2016, and it was my turn to mess up my hands when OSIP sent a subtle hint - he gave access to the shell to his famous Skylake machine.  First of all, I compiled a debug version of OCaml 4.03 (to which I planned to add more debugging tools later) and reassembled the OSIP application with this version of OCaml.  Unfortunately, this debug version did not cause a crash.  Instead, I started working with the OSIP executable file, first interactively manually under GDB (but it drove me crazy, because sometimes I had to wait a whole hour for a crash), and then with a small OCaml script that ran the program 1000 times and saved memory dumps on every failure. <br><br>  Debugging the OCaml runtime support system is not the most fun, but posthumous debugging from memory dumps is generally terrible.  An analysis of 30 memory dumps showed segfault errors in seven different places, two places in OCaml GC, and five more in the application.  The most popular place with 50% of crashes was the <code>mark_slice</code> function in the OCaml garbage collector.  In all cases, OCaml damaged the heap: there was a bad pointer in a well-formed data structure, that is, a pointer that did not point to the first field of the Caml block, but to the header or the middle of the Caml block, or even to an invalid memory address (already freed) .  All 15 <code>mark_slice</code> failures were caused by a pointer two words ahead of a block of 4. <br><br>  All these symptoms were consistent with familiar errors, such as the one that the <code>mark_slice</code> compiler forgot to register the memory object in the garbage collector.  However, such errors would lead to reproducible failures, which depend only on the allocation of memory and the actions of the garbage collector.  I didn‚Äôt understand at all what type of memory management error OCaml could cause <i>random</i> crashes! <br><br>  In the absence of better ideas, I again listened to the inner voice, which whispered: "hardware bug!".  I had a vague feeling that malfunctions occur more often if the machine is under greater load, as if it were just overheating.  To test this theory, I changed my OCaml script to run N copies of the OSIP program in parallel.  For some runs, I also turned off the OCaml memory seal, which caused more memory consumption and more garbage collection activity.  The results were not as I expected, but still amazing: <br><br><table><thead><tr><th align="right">  N </th><th align="right">  System loading </th><th align="right">  With default settings </th><th align="right">  With seal off </th></tr></thead><tbody><tr><td align="right">  one </td><td align="right">  3 + epsilon </td><td align="right">  0 failures </td><td align="right">  0 failures </td></tr><tr><td align="right">  2 </td><td align="right">  4 + epsilon </td><td align="right">  1 crash </td><td align="right">  3 failures </td></tr><tr><td align="right">  four </td><td align="right">  6 + epsilon </td><td align="right">  12 failures </td><td align="right">  19 failures </td></tr><tr><td align="right">  eight </td><td align="right">  10 + epsilon </td><td align="right">  17 failures </td><td align="right">  23 failures </td></tr><tr><td align="right">  sixteen </td><td align="right">  18 + epsilon </td><td align="right">  16 failures </td><td align="right"></td></tr></tbody></table><br><img src="https://habrastorage.org/getpro/habr/post_images/9fa/14c/caa/9fa14ccaa3e2882b424746e31af97816.png"><br><br>  This shows the number of crashes per 1000 test program launches.  See the jump between <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>N</mi><mo>=</mo><mn>2</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.325ex" height="2.057ex" viewBox="0 -780.1 2723.1 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332552/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhjZH_qoHhr5dO9krh6zJwRfZfS9A#MJMATHI-4E" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332552/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhjZH_qoHhr5dO9krh6zJwRfZfS9A#MJMAIN-3D" x="1166" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332552/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhjZH_qoHhr5dO9krh6zJwRfZfS9A#MJMAIN-32" x="2222" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi><mo>=</mo><mn>2</mn></math></span></span><script type="math/tex" id="MathJax-Element-1"> N = 2 </script>  and <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>N</mi><mo>=</mo><mn>4</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.325ex" height="2.057ex" viewBox="0 -780.1 2723.1 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332552/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhjZH_qoHhr5dO9krh6zJwRfZfS9A#MJMATHI-4E" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332552/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhjZH_qoHhr5dO9krh6zJwRfZfS9A#MJMAIN-3D" x="1166" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332552/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhjZH_qoHhr5dO9krh6zJwRfZfS9A#MJMAIN-34" x="2222" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi><mo>=</mo><mn>4</mn></math></span></span><script type="math/tex" id="MathJax-Element-2"> N = 4 </script>  ?  And the plateau between higher values <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>N</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.064ex" height="2.057ex" viewBox="0 -780.1 888.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332552/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhjZH_qoHhr5dO9krh6zJwRfZfS9A#MJMATHI-4E" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi></math></span></span><script type="math/tex" id="MathJax-Element-3"> N </script>  ?  To explain these figures, you need to tell in more detail about the test machine Skylake.  It has 4 physical cores and 8 logical cores, since HT is enabled.  The two cores were busy in the background with two long-term tests (not mine), but otherwise the car was free.  Consequently, the system load was <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>2</mn><mo>+</mo><mi>n</mi><mo>+</mo><mi>e</mi><mi>p</mi><mi>s</mi><mi>i</mi><mi>l</mi><mi>o</mi><mi>n</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="15.599ex" height="2.419ex" viewBox="0 -780.1 6716.4 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332552/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhjZH_qoHhr5dO9krh6zJwRfZfS9A#MJMAIN-32" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332552/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhjZH_qoHhr5dO9krh6zJwRfZfS9A#MJMAIN-2B" x="722" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332552/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhjZH_qoHhr5dO9krh6zJwRfZfS9A#MJMATHI-6E" x="1723" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332552/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhjZH_qoHhr5dO9krh6zJwRfZfS9A#MJMAIN-2B" x="2546" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332552/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhjZH_qoHhr5dO9krh6zJwRfZfS9A#MJMATHI-65" x="3546" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332552/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhjZH_qoHhr5dO9krh6zJwRfZfS9A#MJMATHI-70" x="4013" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332552/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhjZH_qoHhr5dO9krh6zJwRfZfS9A#MJMATHI-73" x="4516" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332552/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhjZH_qoHhr5dO9krh6zJwRfZfS9A#MJMATHI-69" x="4986" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332552/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhjZH_qoHhr5dO9krh6zJwRfZfS9A#MJMATHI-6C" x="5331" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332552/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhjZH_qoHhr5dO9krh6zJwRfZfS9A#MJMATHI-6F" x="5630" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332552/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhjZH_qoHhr5dO9krh6zJwRfZfS9A#MJMATHI-6E" x="6115" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn><mo>+</mo><mi>n</mi><mo>+</mo><mi>e</mi><mi>p</mi><mi>s</mi><mi>i</mi><mi>l</mi><mi>o</mi><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-4"> 2 + n + epsilon </script>  where <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>N</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.064ex" height="2.057ex" viewBox="0 -780.1 888.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332552/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhjZH_qoHhr5dO9krh6zJwRfZfS9A#MJMATHI-4E" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi></math></span></span><script type="math/tex" id="MathJax-Element-5"> N </script>  - This is the number of tests running in parallel. <br><br>  When no more than four processes work at the same time, the OS scheduler distributes them equally among the four cores of the machine and stubbornly tries not to direct the two processes to two logical cores of one physical core, because this will lead to insufficient use of other physical cores.  This happens in the case of <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>N</mi><mo>=</mo><mn>1</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.325ex" height="2.057ex" viewBox="0 -780.1 2723.1 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332552/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhjZH_qoHhr5dO9krh6zJwRfZfS9A#MJMATHI-4E" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332552/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhjZH_qoHhr5dO9krh6zJwRfZfS9A#MJMAIN-3D" x="1166" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332552/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhjZH_qoHhr5dO9krh6zJwRfZfS9A#MJMAIN-31" x="2222" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi><mo>=</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-6"> N = 1 </script>  as well as most of the time in the case of <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>N</mi><mo>=</mo><mn>2</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.325ex" height="2.057ex" viewBox="0 -780.1 2723.1 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332552/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhjZH_qoHhr5dO9krh6zJwRfZfS9A#MJMATHI-4E" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332552/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhjZH_qoHhr5dO9krh6zJwRfZfS9A#MJMAIN-3D" x="1166" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332552/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhjZH_qoHhr5dO9krh6zJwRfZfS9A#MJMAIN-32" x="2222" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi><mo>=</mo><mn>2</mn></math></span></span><script type="math/tex" id="MathJax-Element-7"> N = 2 </script>  .  If the number of active processes exceeds 4, then the OS starts applying HT, assigning processes to two logical cores on the same physical core.  This is the case <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>N</mi><mo>=</mo><mn>4</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.325ex" height="2.057ex" viewBox="0 -780.1 2723.1 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332552/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhjZH_qoHhr5dO9krh6zJwRfZfS9A#MJMATHI-4E" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332552/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhjZH_qoHhr5dO9krh6zJwRfZfS9A#MJMAIN-3D" x="1166" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332552/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhjZH_qoHhr5dO9krh6zJwRfZfS9A#MJMAIN-34" x="2222" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi><mo>=</mo><mn>4</mn></math></span></span><script type="math/tex" id="MathJax-Element-8"> N = 4 </script>  .  Only if all 8 logical cores on the machine are occupied, the OS performs the traditional time sharing between processes.  In our experiment, these are cases. <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>N</mi><mo>=</mo><mn>8</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.325ex" height="2.057ex" viewBox="0 -780.1 2723.1 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332552/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhjZH_qoHhr5dO9krh6zJwRfZfS9A#MJMATHI-4E" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332552/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhjZH_qoHhr5dO9krh6zJwRfZfS9A#MJMAIN-3D" x="1166" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332552/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhjZH_qoHhr5dO9krh6zJwRfZfS9A#MJMAIN-38" x="2222" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi><mo>=</mo><mn>8</mn></math></span></span><script type="math/tex" id="MathJax-Element-9"> N = 8 </script>  and <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>N</mi><mo>=</mo><mn>16</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.487ex" height="2.057ex" viewBox="0 -780.1 3223.6 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332552/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhjZH_qoHhr5dO9krh6zJwRfZfS9A#MJMATHI-4E" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332552/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhjZH_qoHhr5dO9krh6zJwRfZfS9A#MJMAIN-3D" x="1166" y="0"></use><g transform="translate(2222,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332552/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhjZH_qoHhr5dO9krh6zJwRfZfS9A#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332552/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhjZH_qoHhr5dO9krh6zJwRfZfS9A#MJMAIN-36" x="500" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi><mo>=</mo><mn>16</mn></math></span></span><script type="math/tex" id="MathJax-Element-10"> N = 16 </script>  . <br><br>  Now it became clear that failures begin only when Hyper-Threading is turned on, more precisely, when the OCaml program was running next to another thread (logical core) on the same physical core of the processor. <br><br>  I sent OSIP the results of experiments, begging him to accept my theory that multithreading was to blame.  This time, he listened and disconnected the HT in his car.  After that, the failures completely disappeared: two days of continuous testing did not reveal any problems at all. <br><br>  Problem solved?  Yes!  A happy ending?  Not really.  Neither I nor OSIP tried to report a problem to Intel or anyone else, because OSIP was satisfied that OCaml could be compiled with Clang, and also because he did not want unpleasant publicity in the spirit of ‚ÄúOSIP products fall randomly! ".  I‚Äôm completely tired of this problem, and didn‚Äôt know how to report such things (Intel doesn‚Äôt have a public bug tracker, like ordinary people), and I also suspected that this was a bug of OSIP specific machines (for example, a batch of failed chips which accidentally got into the wrong basket in the factory). <br><br><h1>  Second manifestation </h1><br>  The year 2016 went quietly, no one else reported that the sky (sky, more precisely, Skylake - pun) falls because of OCaml 4.03, so I happily forgot about this little episode with OSIP (and continued to write terrible puns). <br><br>  Then, on January 6, 2017, Angerran Dekorn and Joris Giovannangeli from <a href="https://ahrefs.com/">Ahrefs</a> (another Very Serious Industrial User OCaml, member of <a href="http://caml.inria.fr/consortium/index.en.html">the Caml Consortium</a> in addition) reported mysterious random crashes with OCaml 4.03.0: this is <a href="https://caml.inria.fr/mantis/view.php%3Fid%3D7452">PR # 7452</a> in the Caml tracker. <br><br>  In their example of a repeated failure, the ocamlopt.opt compiler itself sometimes crashed or produced a meaningless result when it compiled a large source file.  This is not too surprising because ocamlopt.opt itself is an OCaml program compiled by the compiler ocamlopt.byte, but it was easier to discuss and reproduce the problem. <br><br>  Public comments on the PR # 7452 bug show quite well what happened next, and the Ahrefs staff described their bug hunt in detail in <a href="https://tech.ahrefs.com/skylake-bug-a-detective-story-ab1ad2beddcd">this article</a> .  So I will highlight only the key points of this story. <br><br><ul><li>  12 hours after the opening of the ticket, when there were already 19 comments in the discussion, Angerran Dekorn said that ‚Äúall the machines that were able to reproduce the bug work on Intel processors from the Intel Skylake family‚Äù. </li><li>  The next day, I mentioned random crashes at OSIP and suggested disabling multithreading (Hyper-Threading). </li><li>  A day later, Joris Giovannangeli confirmed that the bug is not reproduced when Hyper-Threading is disabled. </li><li>  In parallel, Joris discovered that a failure occurs only if the OCaml runtime support system is built with the <code>gcc -O2</code> parameter, but not the <code>gcc -O1</code> .  Looking back, this explains the absence of failures with the debugging version of the OCaml environment and with OCaml 4.02, since both of them are built by default with the <code>gcc -O1</code> parameter. </li><li>  I go on stage and post the following comment: <br><blockquote>  Would it be crazy to assume that the <code>gcc -O2</code> setting on the OCaml 4.03 environment produces a specific sequence of instructions that causes a hardware failure (some stepping) in Skylake processors with Hyper-Threading?  Perhaps this is madness.  On the other hand, there is already one documented hardware problem with Hyper-Threading and Skylake <a href="http://arstechnica.com/gadgets/2016/01/intel-skylake-bug-causes-pcs-to-freeze-during-complex-workloads/">(link)</a> </blockquote></li><li>  Mark Shinwell contacted colleagues at Intel and managed to push the report through the customer support department. </li></ul><br>  Then nothing happened for 5 months, until ... <br><br><h1>  Opening </h1><br>  On May 26, 2017, user "ygrek" published a <a href="http://metadata.ftp-master.debian.org/changelogs/non-free/i/intel-microcode/intel-microcode_3.20170511.1_changelog">link</a> to the following changelog from the Debian microcode package: <br><br> <code>* New upstream microcode datafile 20170511 [...] <br> * Likely fix nightmare-level Skylake erratum SKL150. Fortunately, <br> either this erratum is very-low-hitting, or gcc/clang/icc/msvc <br> won't usually issue the affected opcode pattern and it ends up <br> being rare. <br> SKL150 - Short loops using both the AH/BH/CH/DH registers and <br> the corresponding wide register *may* result in unpredictable <br> system behavior. Requires both logical processors of the same <br> core (ie sibling hyperthreads) to be active to trigger, as <br> well as a "complex set of micro-architectural conditions"</code> <br> <br>  Errata SKL150 was documented by Intel in April 2017 and is described on page 65 in the <a href="http://www.intel.co.uk/content/dam/www/public/us/en/documents/specification-updates/desktop-6th-gen-core-family-spec-update.pdf">6th Generation Intel Processor Specification Update</a> .  A similar errata is referred to as SKW144, SKX150, SKZ7 for the Skylake and KBL095, KBW095 for the newer Kaby Lake architecture.  The words "total nightmare" are not mentioned in the Intel documentation, but roughly describe the situation. <br><br>  Despite the rather vague description (‚Äúa complex set of micro-architectural conditions,‚Äù and do not say!), This errata is hitting the target: is Hyper-Threading enabled?  There is such a thing!  Manifests pseudo-randomly?  There is!  Not related to either floating point or vector instructions?  There is!  In addition, a microcode update is ready that fixes this error, it is nicely packaged in Debian and ready to be loaded into our test machines.  A few hours later, Joris Giovannangeli confirmed that the crash disappeared after updating the microcode.  I launched even more tests on my newest workstation with a Skylake processor (thanks to the Inria supply department) and came to the same conclusion, because the test, which collapsed in less than 10 minutes with the old microcode, worked for 2.5 days without any problems with the new microcode . <br><br>  There is one more reason to believe that SKL150 is the culprit of our problems.  The fact is that the problematic code described in this errata generates GCC when compiling the OCaml runtime support system.  For example, in the <code>byterun/major_gc.c</code> for the <code>sweep_slice</code> function, <code>sweep_slice</code> get the following C code: <br><br><pre> <code class="cpp hljs">hd = Hd_hp (hp); <span class="hljs-comment"><span class="hljs-comment">/*...*/</span></span> Hd_hp (hp) = Whitehd_hd (hd);</code> </pre> <br>  After macro expansion, it looks like this: <br><br><pre> <code class="hljs markdown">hd = <span class="hljs-emphasis"><span class="hljs-emphasis">*hp; /*</span></span>...<span class="hljs-emphasis"><span class="hljs-emphasis">*/ *</span></span>hp = hd &amp; ~0x300;</code> </pre> <br>  Clang compiles this code in a banal way, using only full-width registers: <br><br><pre> <code class="hljs perl">mov<span class="hljs-string"><span class="hljs-string">q (%rbx)</span></span>, %rax [...] andq $-<span class="hljs-number"><span class="hljs-number">769</span></span>, %rax <span class="hljs-comment"><span class="hljs-comment"># imm = 0xFFFFFFFFFFFFFCFF movq %rax, (%rbx)</span></span></code> </pre> <br>  However, GCC prefers to use the 8-bit register <code>%ah</code> to work with bits 8 to 15 of the full register <code>%rax</code> , leaving the remaining bits unchanged: <br><br><pre> <code class="hljs perl">mov<span class="hljs-string"><span class="hljs-string">q (%rdi)</span></span>, %rax [...] andb $252, %ah movq %rax, (%rdi)</code> </pre> <br>  These two codes are functionally equivalent.  One possible reason for choosing GCC could be that its code is more compact: the 8-bit constant <code>$252</code> fits into one byte of code, while the 32-bit one, extended to 64 bits, the constant <code>$-769</code> needs 4 bytes.  In any case, the generated GCC code uses both <code>%rax</code> and <code>%ah</code> and, depending on the level of optimization and unsuccessful combination of circumstances, such code may end in a cycle small enough to cause a SKL150 bug. <br><br>  So, in the end, it's still a hardware bug.  Told ya! <br><br><h1>  Epilogue </h1><br>  Intel has released microcode updates for Skylake and Kaby Lake processors, which fix or bypass the problem.  Debian has published <a href="https://lists.debian.org/debian-devel/2017/06/msg00308.html">detailed instructions</a> for checking whether your processor is susceptible to bugs and how to get and apply microcode updates. <br><br>  The publication about the bug and the release of microcode turned out to be very timely, because several projects on OCaml began to have mysterious failures.  For example, in <a href="https://github.com/ocsigen/lwt/issues/315">Lwt</a> , <a href="https://coq.inria.fr/bugs/show_bug.cgi%3Fid%3D5517">Coq</a> and <a href="https://sympa.inria.fr/sympa/arc/caml-list/2017-06/msg00115.html">Coccinelle</a> . <br><br>  He wrote a number of technical sites about a hardware bug, for example, <a href="https://arstechnica.com/information-technology/2017/06/skylake-kaby-lake-chips-have-a-crash-bug-with-hyperthreading-enabled/">Ars Technica</a> , <a href="https://hothardware.com/news/critical-flaw-in-intel-skylake-and-kaby-lake-hyperthreading-discovered-requiring-bios-microcode-fix">HotHardware</a> , <a href="http://www.tomshardware.com/news/hyperthreading-kaby-lake-skylake-skylake-x,34876.html">Tom's Hardware</a> and <a href="https://news.ycombinator.com/item%3Fid%3D14630183">Hacker's News</a> [and <a href="https://geektimes.ru/post/290461/">GeekTimes</a> - approx.  trans.]. </div><p>Source: <a href="https://habr.com/ru/post/332552/">https://habr.com/ru/post/332552/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../332542/index.html">Meanwhile, Proxmox VE has been updated to version 5.0.</a></li>
<li><a href="../332544/index.html">Using timeout & strace utilities to monitor user inactivity to break a Shellinabox connection</a></li>
<li><a href="../332546/index.html">Announcement of Moscow Spark # 2</a></li>
<li><a href="../332548/index.html">Announcement Ruby Meetup # 6</a></li>
<li><a href="../332550/index.html">Simple ingredients for a better UX.</a></li>
<li><a href="../332554/index.html">Using the KOMPAS-3D API ‚Üí Lesson 3 ‚Üí Correct connection to KOMPAS</a></li>
<li><a href="../332556/index.html">How Yandex created a course on C ++, or Why did we have to rewrite everything</a></li>
<li><a href="../332558/index.html">Identification of cointegrated pairs of shares in stock markets</a></li>
<li><a href="../332560/index.html">JDI UI Testing Framework: How and Why to Use</a></li>
<li><a href="../332562/index.html">Android Architecture Components. Part 1. Introduction</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>