<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tasks and solutions for the PostgreSQL fighter</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Greetings to all SQL lovers! 

 On the Internet, I rarely met articles that cover different working points and subtleties associated with data process...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tasks and solutions for the PostgreSQL fighter</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/x3/ee/eo/x3eeeo65jv-nyf7mh9ks2dordqg.jpeg"></div><br>  Greetings to all SQL lovers! <br><br>  On the Internet, I rarely met articles that cover different working points and subtleties associated with <b>data processing in SQL</b> . <br>  I like it when you can learn a lot from one article at once, even if in general terms. <br>  Therefore, I decided to write my article containing various tasks and answers with explanations to them. <br>  Suitable for those who have mastered all the basic skills and wants to develop further. <br><br>  The answers provided are suitable for <b>PostgreSQL</b> ( <u>most of the tasks are suitable for other DBMSs</u> , but the results and solutions may be different. It is even interesting where the differences will arise) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i><u>Try to answer yourself</u> before opening the spoiler.</i> <i><br></i> <br>  Go! <br><a name="habracut"></a><br><br>  I will try to mark with an asterisk, something especially for PostgreSQL * (there are not many such moments) <br><br><h4>  1. A bit about numeric operations </h4><br>  <b>1.1</b> Will these queries be executed?  What results will they return? <br><br><pre><code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">-- )     SELECT 3/2; -- ) SELECT min('- '::TEXT), avg('- '::TEXT); -- )*      FALSE,     ? SELECT 7.2 = (3.8::FLOAT + 3.4) -- ) SELECT (20/25)*25.0;</span></span></code> </pre> <br><br><div class="spoiler">  <b class="spoiler_title">Answers to 1.1</b> <div class="spoiler_text">  A) Answer: <b>1</b> <br>  Only the whole part will be shown, since  the operation uses integer numbers.  This is often found in other languages. <br><br>  B) Answer: the request <b>will not be executed</b> . <br><br>  <b>avg</b> will give an error, because  accepts only numbers and time intervals * <br><br>  However, the <b>min / max</b> function can be performed on textual data (according to alphabetical sorting in the database). <br>  Sometimes this can be useful when you need to at least look at a column that is not listed in <i>GROUP BY</i> <br>  Or when you need to apply an alphabetical sorting to numbers, with which '10' &lt;'2' <br><br>  C) Answer: <b>FALSE</b> <br><br>  It may seem strange, but this is <u>permissible</u> , because  This is a feature of the computer representation of some floating-point numbers, the number can take the form 7.1 (9) <br>  I remember how once I had a long time with the request, not knowing this <br><br>  D) Answer: <b>0</b> .  the catch is that the expression in brackets will be = 0 <br><br>  SELECT (20 / 25.0) * 25 would work more correctly </div></div><br><br>  <b>1.2</b> Given the table " <i>table_2</i> " (with a single column " <i>value</i> " (INTEGER)) consisting of the following 5 lines: <br><table border="1" cellpadding="1"><tbody><tr><th width="120">  value </th></tr><tr><td>  five </td></tr><tr><td>  five </td></tr><tr><td>  Null </td></tr><tr><td>  five </td></tr><tr><td>  five </td></tr></tbody></table><br>  What result will return the query: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">avg</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>)*<span class="hljs-keyword"><span class="hljs-keyword">count</span></span>(*)) - <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> table_2;</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Answer Options</b> <div class="spoiler_text"><ul><li>  -four </li><li>  0 </li><li>  Null </li><li>  five </li><li>  It will cause an error, because  GROUP BY not specified </li><li>  None of the above </li></ul><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Answer 1.2</b> <div class="spoiler_text">  Answer: <b>5</b> <br><br>  Aggregate functions applied to a specific column ignore <i>NULL</i> , but count <b>(*)</b> counts all rows. <br>  5 * 5 - 20 </div></div><br><br><h4>  2. General issues </h4><br>  <b>2.1</b> When can a query return not the entire contents of a table?  ( <i>parent_id</i> INTEGER, the table is filled with various data) <br><br><pre> <code class="sql hljs"> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> any_table <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> parent_id = parent_id;</code> </pre><br>  And how will the query behave below?  What data will it display?  <i>* PostgreSQL</i> <br><br><pre> <code class="sql hljs"> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> any_table <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> parent_id <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> parent_id;</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Answers to 2.1</b> <div class="spoiler_text">  The first query will show all entries, except where <i>parent_id</i> is <b>NULL</b> <br><br>  The second query will show all the records in the table.  <u>IS DISTINCT FROM</u> is logically similar to the <b>! =</b> Operator in which NULL is identical to NULL <br>  <u>IS <b>NOT</b> DISTINCT FROM</u> Logically turns inequality into equality <br></div></div><br>  <b>2.2.</b>  What is the result of the query? <br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">-- ) SELECT * FROM ( SELECT 1 UNION ALL SELECT 1 ) x(y) UNION ( SELECT 2 UNION ALL SELECT 2 );</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Answer to 2.2</b> <div class="spoiler_text">  The result will be 2 rows with values <b>1</b> and <b>2</b> , <i>UNION</i> will remove all duplicates in the <u>result</u> set, and not just between the two tables being joined.  Noticed that not all is obvious. </div></div><br>  <b>2.3</b> Write a request that will show tomorrow's date. <br><br><div class="spoiler">  <b class="spoiler_title">Answer to 2.3</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CAST</span></span>((<span class="hljs-keyword"><span class="hljs-keyword">now</span></span>()+ <span class="hljs-built_in"><span class="hljs-built_in">INTERVAL</span></span> <span class="hljs-string"><span class="hljs-string">'1 DAY'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span>)</code> </pre> <br>  Not everyone often works with dates, but it‚Äôs worth learning some minimum <br>  * Solution for Postgres, but I think other DBMSs are not much different <br><br>  If working with dates is new to you, then I advise you to experiment with the query. <br>  For example: <br>  - replace DAY with (week, month, year, etc.) <br>  - replace +1 with -9000 <br>  - replace DATE with TIME <br>  - remove CAST <br>  - leave only NOW () <br>  etc. <br><br>  And, inspired by some results, go read <a href="https://postgrespro.ru/docs/postgresql/10/functions-datetime">MANUAL</a> , all topics are covered there in detail. <br><br></div></div><br>  <b>2.4</b> The <b>UPDATE</b> , <b>DELETE</b> , <b>INSERT</b> and <b>MERGE</b> <b>statements</b> <b>are</b> designed to manipulate data in tables.  Is the execution of <b>SELECT ..</b> "safe"?  Can any query affect the data in the table? <br><div class="spoiler">  <b class="spoiler_title">Answer 2.4</b> <div class="spoiler_text">  The question may seem primitive, however ... <br><br>  At the very beginning of the study of SQL, I had the impression that this operator can only show data, but: <br><br>  In addition to the fact that SELECT is able to lock the table for a change (BEGIN; SELECT ... FOR UPDATE) * <br>  SELECT is capable of calling functions that can perform almost any kind of manipulation. <br><br>  Beginners need to understand this immediately, and not after performing a ‚Äúsmall information‚Äù request on the <s>Production</s> server </div></div><br><br><h4>  3. Only PostgreSQL </h4><br>  <b>3.1</b> Describe what will happen when executing this query in the SQL dialog: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> wtf <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_stat_activity;</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Answer to 3.1</b> <div class="spoiler_text">  Typically, SELECT INTO is used in <i>plpgsql</i> functions to write a value to a variable. <br><br>  Outside the plpgsql, the effect of the command will be similar to the query below: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> wtf <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_stat_activity;</code> </pre> <br></div></div><br>  <b>3.2</b> what this ‚Äúsimple‚Äù query will show <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> wtf_ <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_stat_activity <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> wtf_ ;</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Answer to 3.2</b> <div class="spoiler_text">  pg_stat_activity system view (VIEW) of active processes in the database. <br><br>  The query feature is that one column with rows (ROW) with TYPE pg_stat_activity (or another table) will be displayed.  You need to know this more likely to those who write functions, you can read more in the <a href="https://postgrespro.ru/docs/postgrespro/9.5/rowtypes">manual</a> <br>  The question was added because a beginner can easily get such a result by mistake and don‚Äôt understand what's wrong. </div></div><br><h4>  4. Work with the text.  Regular expressions </h4><br>  I think you need to be able not only to build queries, but also to present the results in the right form. <br>  Regular expressions are a separate huge topic, with many quality articles.  Therefore, I will only show examples, without detailed explanations. <br><br>  <b>4.1.</b>  Suppose there is a table " <i>table_5</i> " with a text column " <i>X</i> " and a variety of different rows.  What query can I get any last 10 characters of each line? <br><br><div class="spoiler">  <b class="spoiler_title">The answer to 4.1</b> <div class="spoiler_text">  SQL allows you to come up with a lot of solutions to the same problem, for example: <br>  the simplest thing that comes to mind is <b>right (X, 10)</b> <br>  you can use the regular expression: <b>substring (X, '. {0,10} $')</b> <br>  you can even <s>nakostylyat</s> "dodge" (in all senses) as follows: <b>reverse (substring (reverse (X) for 10))</b> </div></div><br><br>  <b>4.2</b> There is a table ‚Äútable_6‚Äù with a text column ‚ÄúX‚Äù.  The table contains one row (all text is in English and Russian only): <br><pre> <code class="sql hljs">'Lorem 3 Ipsum 23 standard 7 dummy 17 text Ultimate Answer of Life ?? 777'</code> </pre> <br>  A) Write a query that returns the characters from the 42nd to the 68th of this line. <br>  B) How to pull out only CAPITAL (Russian or English) letters in a row using SQL? <br>  C) How to calculate the sum of numbers ( <u>not numbers</u> ) in a row using SQL <br><br><div class="spoiler">  <b class="spoiler_title">SQL outline</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> table_6(X) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">'Lorem 3 Ipsum 23 standard 7 dummy 17 text Ultimate Answer of Life ?? 777'</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">TEXT</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> X <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> table_6</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Answers to 4.2</b> <div class="spoiler_text"><pre> <code class="sql hljs"> <span class="hljs-comment"><span class="hljs-comment">--    WITH  "SQL " -- ) SELECT SUBSTRING(LEFT(X,68) FROM 42 ) FROM table_6 -- 1  SELECT SUBSTRING(X, 42, (68-42)+1) FROM table_6 -- 2  -- 3    -- )  ,        SELECT regexp_replace(X,'[^A-Z-]', '','g') FROM table_6 --  ''      - --   'g'    1  -- )        --   regexp_matches   **     ,      SELECT sum(x[1]::INT) FROM ( SELECT regexp_matches(X,'[0-9]+','g') FROM table_6 ) AS y(x) -- *        -- **   +,     (   1 ,     )</span></span></code> </pre> </div></div><br><br>  <b>4.3</b> How to replace in the text (cell of the table) all double (triple or more) spaces with a single space?  (by tradition: table " <i>table_7</i> " with column " <i>X</i> ") (PS it is enough to write <i>SELECT that</i> returns the desired result, and not <i>UPDATE table_7 ...</i> ) <br><br><div class="spoiler">  <b class="spoiler_title">Answer to 4.3</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> table_7(X) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">'Lorem 3 Ipsum 23 standard 7 dummy 11 text'</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">TEXT</span></span>) <span class="hljs-comment"><span class="hljs-comment">-- 1 .    (2   ) SELECT regexp_replace(X, '( ){2,}', ' ', 'g') FROM table_7 -- 2 .     (,  ,    ..)   ,      SELECT regexp_replace(X, '\s+', ' ', 'g') FROM table_7 --  !  ,  -    ,    "" .    .. --   ,    , ,        --    ,      ,    SELECT replace(replace(replace(X, ' ', '&lt;&gt;'), '&gt;&lt;', ''), '&lt;&gt;', ' ') FROM table_7</span></span></code> </pre><br></div></div><br>  <b>4.4</b> There is a string " <i>X</i> " in which typos are made.  Instead of Russian letters (e, o, c, C), outwardly similar to them characters of the English alphabet were used.  Replace these characters with SQL. <br><br>  PS The line should contain only Russian characters, and you should not worry about a possible change of English words. <br><br>  (If it is difficult to replace all characters, replace at least one) <br><br>  Example line: <br><br> <code>X = 'Coeo  eoc oe'</code> <br> <br><div class="spoiler">  <b class="spoiler_title">Answer to 4.4</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">-- , Replace(Replace(Replace(..  ,  --        (1   1 ) SELECT TRANSLATE('Coeo  eoc oe', 'Cceo', '')</span></span></code> </pre> </div></div><br>  <b>4.5</b> Write a query that converts a string: <br>  <b>Ivan IVAN</b> <b>Ivanov Ivanov to the Ivan Ivan Ivanovich</b> <br><br><div class="spoiler">  <b class="spoiler_title">Answer 4.5</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--  ,     SELECT initcap('  ') *     </span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Bonus task for those who managed</b> <div class="spoiler_text">  <s>It's great if there is a finished function.</s> <br>  Can you convert the opposite?  (preferably without losing indentation). <br>  Perhaps the task is not typical, but it will be useful for development. <br><br>  <b>'IVANOVO IVAN IVANOVICH'</b> convert to <b>'IVANOV IVAN IVANOVICH'</b> <br>  <s>and invert the register?</s> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">The answer to the bonus task</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> string_agg(<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span>(x,<span class="hljs-number"><span class="hljs-number">1</span></span>)) || <span class="hljs-keyword"><span class="hljs-keyword">UPPER</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SUBSTRING</span></span>(x <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>)), <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> rn) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> regexp_split_to_table(<span class="hljs-string"><span class="hljs-string">'    4 TesT'</span></span>, <span class="hljs-string"><span class="hljs-string">'\y'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDINALITY</span></span> y(x, rn) ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> z <span class="hljs-comment"><span class="hljs-comment">-- *  PostgreSQL,      --    ,     --      ,      --      . -- WITH ORDINALITY      (   9.4) --      --          -- ..</span></span></code> </pre> </div></div><br><h4>  5. A bit of transaction </h4><br>  Transactions are very important thing in a DBMS, it is quite important to understand the main points. <br><br>  I will try to simulate an example: <br><br>  Suppose there is a table ‚Äúgoods‚Äù with which two users are going to work. <br>  It has an integer <i>discount</i> column of <u>10</u> for all rows. <br>  Database settings are standard (READ COMMITTED - reading of captured data). <br><br>  <i>User_1</i> opens a transaction, executes the following query: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> goods <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> discount = discount + <span class="hljs-number"><span class="hljs-number">5</span></span>;</code> </pre><br>  A second later, another user ( <i>User_2</i> ) <br>  Executes almost the same query without opening a transaction: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> goods <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> discount = discount + <span class="hljs-number"><span class="hljs-number">10</span></span>;</code> </pre><br>  What do you think will happen in the following scenario: <br><br>  <b>A)</b> What result will User_2 get if User_1 leaves the transaction open (i.e., does not confirm the transaction / does not roll back the changes)? <br>  What User_1 will see when prompted: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> discount <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> goods <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br>  <b>B)</b> What happens if User_1 does a ROLLBACK?  What results will User_2 get? <br><br>  <b>Q)</b> What happens if User_1 makes a COMMIT?  What results will User_2 get? <br><br><div class="spoiler">  <b class="spoiler_title">Answers</b> <div class="spoiler_text">  As far as I know READ <b>UN</b> COMMITTED is not supported in PostgreSQL, and ‚Äúdirty‚Äù (not confirmed) data will not be read <br><br>  The answers will be as follows: <br><br>  A) <u>User_2</u> request will wait for COMMIT or ROLLBACK from User_1.  (request as if hangs) <br>  <u>User_1</u> in its transaction will see its version of the snapshot database, where the <i>discount is</i> already equal to <b>15</b> <br><br>  B) If User_1 makes a ROLLBACK, then the value of <i>discount</i> will remain the same, and after that the query User_2 will be executed, which will add 10 to the <i>discount</i> and the discount will be equal to <b>20</b> <br><br>  C) If User_1 makes a COMMIT, then the value of <i>discount</i> will increase by 5, and User_2 will be executed next, which will add 10 to the <i>discount</i> and the discount will be equal to <b>25</b> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Another version of this task</b> <div class="spoiler_text">  A slightly different version of task 13 from the user <a href="https://habr.com/users/kirill_petrov/" class="user_link">kirill_petrov</a> on the READ COMMITTED feature <br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--      CREATE TABLE goods (discount) AS (SELECT 10::INT UNION ALL SELECT 15); -- 1. User_1   (  ): BEGIN; UPDATE goods SET discount = discount + 5; --2. User_2  : UPDATE goods SET discount = discount + 100 WHERE discount = 15 --3. User_1  COMMIT;</span></span></code> </pre>  What data will be in the table? <br></div></div><br><h4>  Conclusion </h4><br>  I think I touched on some interesting points. <br><br>  I hope the tasks will help to motivate beginners, because it‚Äôs boring to learn anything without specific goals / objectives / directions. <br><br>  I can be glad for those who were easy to answer all the questions.  And those who had difficulties, I hope, got a <s>kick in the</s> direction of development.  Those who have understood little, but want to master SQL, I invite you to my last article, <a href="https://habr.com/post/340460/">The Course of a Young PostgreSQL Fighter</a> . <br><br>  I am waiting for any additions, solutions of particularly interesting problems (you can own) and other comments! <br><br>  Thanks for attention!  I wish you success in learning SQL! </div><p>Source: <a href="https://habr.com/ru/post/423097/">https://habr.com/ru/post/423097/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../423087/index.html">Don't push my eyes</a></li>
<li><a href="../423089/index.html">Programmers at MBLT DEV 2018</a></li>
<li><a href="../423091/index.html">Flutter for Android developers. How to create a UI for an Activity using Flutter</a></li>
<li><a href="../423093/index.html">Increase the randomness of the fact that it is [probably] [almost] random</a></li>
<li><a href="../423095/index.html">What's new showed on Apple presentation</a></li>
<li><a href="../423099/index.html">Steam has allowed erotica, porn and violence in games</a></li>
<li><a href="../423101/index.html">Expanding LINSTOR for Proxmox</a></li>
<li><a href="../423103/index.html">Python podcasts: that's all we found</a></li>
<li><a href="../423105/index.html">System.IO.Pipelines: High Performance IO in .NET</a></li>
<li><a href="../423107/index.html">Welcome to the ‚ÄúGo in production‚Äù mitap</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>