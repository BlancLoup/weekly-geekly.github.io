<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Development model on the example of Stack-based CPU</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Have you ever wondered how the processor works? Yes, yes, exactly the one that is in your PC / laptop / smartphone. In this article I want to give an ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Development model on the example of Stack-based CPU</h1><div class="post__text post__text-html js-mediator-article"><p>  Have you ever wondered how the processor works?  Yes, yes, exactly the one that is in your PC / laptop / smartphone.  In this article I want to give an example of a self-invented processor with a Verilog design.  Verilog is not exactly the programming language it is similar to.  This is the Hardware Description Language.  The written code is not executed by anything (if you do not run it in the simulator, of course), but turns into the design of the physical circuit, or the view perceived by the FPGA (Field Programmable Gate Array). </p><a name="habracut"></a><br><p>  <strong>Disclaimer: this article is the result of work on the project at the university, so the time for work was limited and many parts of the project are still only at the initial stage of development.</strong> </p><br><p>  <strong>Please note that the processor created in this article has little in common with modern widely used processors, but by its creation I tried to achieve a slightly different goal.</strong> </p><br><p>  In order to truly understand the programming process, it is necessary to understand how each of the tools used: the compiler / interpreter of the language, the virtual machine, if it exists, the intermediate code, and, of course, the processor itself.  Very often, people who study programming have been in the first stage for a long time - they only think about how the language and its compiler work.  This often leads to errors, solutions to which are unknown to a novice programmer, because he has no idea where the roots of these problems grow from.  I myself saw several living examples where the situation was approximately the same as in the description above, so I decided to try to remedy this situation and create a set of things that will help the beginning programmers understand all the steps. </p><br><p>  This set consists of: </p><br><ul><li>  Actually invented language </li><li>  Highlight plug-in for VS Code </li><li>  Compiler to it </li><li>  Instruction set </li><li>  A simple processor capable of executing this instruction set (written in Verilog) </li></ul><br><p>  Once again I remind you that this article DOES NOT DESCRIBE ANYTHING LIKE THE MODERN REAL PROCESSOR, it describes a model that is easy to understand without going into detail. </p><br><p>  Things you need if you want to do it yourself: </p><br><p>  To run the CPU simulation, you need ModelSim, which you can download from the Intel site. </p><br><p>  To run the OurLang compiler you need Java version&gt; = 8. </p><br><p>  Links to projects: <br>  <a href="https://github.com/IamMaxim/OurCPU">https://github.com/IamMaxim/OurCPU</a> <br>  <a href="https://github.com/IamMaxim/OurLang">https://github.com/IamMaxim/OurLang</a> </p><br><p>  Expansion: <br>  <a href="https://github.com/IamMaxim/ourlang-vscode">https://github.com/IamMaxim/ourlang-vscode</a> </p><br><p>  To build the Verilog part, I usually use a bash script: </p><br><pre><code class="plaintext hljs">#/bin/bash vlib work vlog *.v vsim -c testbench_1 -do "run; exit"</code> </pre> <br><p>  But the same can be repeated through the GUI. </p><br><p>  Intellij IDEA is convenient to use with the compiler.  The main thing is to keep track of which modules your module has in dependencies.  I did not publish ready-made .jar, because I expect the reader to read the source code of the compiler. </p><br><p>  Launched modules - Compiler and Interpreter.  With the compiler, everything is clear, Interpreter is just a OurCPU simulator in Java, but we will not discuss it in this article. </p><br><h3 id="instruction-set">  Instruction set </h3><br><p>  I think it's better to start with the Instruction Set. </p><br><p>  There are several instruction set architectures: </p><br><ul><li>  Stack-based is what is described in the article.  A distinctive feature is that all operands are pushed onto the stack and dropped from the stack, which immediately excludes the possibility of parallelizing execution, but is one of the simplest approaches to working with data. </li><li>  Accumulator-based - the bottom line is that there is only one register that stores the value that is modified by the instructions. </li><li>  Register-based is what is used in modern processors, because it allows you to achieve maximum performance by applying various optimizations, including parallelization of execution, pipelining, etc. </li></ul><br><p>  <a href="">Our processor instruction set contains 30 instructions.</a> </p><br><p>  Next, I suggest to look at the implementation of the processor: </p><br><p>  The code consists of several modules: </p><br><ul><li>  CPU </li><li>  Ram </li><li>  Modules for each instruction </li></ul><br><p>  RAM is a module that contains the memory itself, as well as a way to access the data in it. </p><br><p>  CPU - a module that directly controls the program execution progress: reads instructions, transfers control to the desired instruction, stores the necessary registers (pointer to the current instruction, etc.). </p><br><p>  Almost all instructions work only with the stack, so it suffices to execute them.  Some (for example, putw, putb, jmp and jif) have an additional argument in the instruction itself.  They need to give all the instructions so that they can read the necessary data. </p><br><p>  Here is a diagram in general terms of the processor operation: </p><br><p><img src="https://habrastorage.org/webt/le/eq/-9/leeq-9mhht6o2lderrpxylbaldm.png"></p><br><p>  General principles of device programs at the instruction level </p><br><p>  I think it's time to get acquainted with the device itself programs.  As can be seen from the diagram above, after the execution of each instruction, the address goes to the next one.  This gives a linear course of the program.  When it becomes necessary to break this linearity (condition, cycle, etc.), branch instructions are used (in our instruction set, this is jmp and jif). </p><br><p>  When calling functions, we need to save the current state of everything, and for this purpose there are activation records ‚Äî records that store this information.  They are not tied to the processor itself or instructions, it is just a concept that is used by the compiler when generating code.  The Activation record in OurLang has the following structure: </p><br><p><img src="https://habrastorage.org/webt/8d/1v/do/8d1vdowiro_cx_7piaxjns-aqni.png"></p><br><p>  As can be seen from this scheme, local variables are also stored in the activation record, which allows you to calculate the address of a variable in memory at compile time, not at run time, and, thus, program execution is accelerated. </p><br><p>  For function calls, our instruction set provides ways to work with two registers contained in the CPU module (operation pointer and activation address pointer) - putopa / popopa, putara / popara. </p><br><h3 id="kompilyator">  Compiler </h3><br><p>  And now let's take a look at the part closest to the final programmer - the compiler.  In general, the compiler as a program consists of 3 parts: </p><br><ul><li>  Lexer </li><li>  Parser </li><li>  Compiler </li></ul><br><p>  Lexer is responsible for translating the source code of the program into lexical units understandable to the parser. </p><br><p>  The parser builds an abstract syntax tree from these lexical items. </p><br><p>  The compiler runs through this tree and generates some code consisting of low-level instructions.  This can be either a bytecode or a processor-ready binary code. </p><br><p>  In OurLang compiler, these parts are represented respectively by classes. </p><br><ul><li>  Lexer.java </li><li>  Parser.java </li><li>  Compiler.java </li></ul><br><h3 id="yazyk">  Tongue </h3><br><p>  OurLang is in its infancy, that is, it works, but so far there are not so many things in it and even the core part of the language is not completed.  But to understand the essence of the current state of the compiler is already enough. </p><br><p>  As an example of a program for understanding the syntax, this code fragment is proposed (it is also used to test the functional): </p><br><pre> <code class="plaintext hljs">// single-line comments /* * Multi-line comments */ function print(int arg) { instr(putara, 0); instr(putw, 4); instr(add, 0); instr(lw, 0); instr(printword, 0); } function func1(int arg1, int arg2): int { print(arg1); print(arg2); if (arg1 == 0) { return arg2; } else { return func1(arg1 - 1, arg2); }; } function main() { var i: int; i = func1(1, 10); if (i == 0) { i = 1; } else { i = 2; }; print(i); }</code> </pre> <br><p>  Focus on the language, I will not, leave it to your study.  Through the compiler code, naturally;). </p><br><p>  While writing it, I tried to make self-explaining code that is understandable without comments, so there should be no problems with understanding the compiler code. </p><br><p>  And of course, the most interesting thing is to write code, and then watch what it turns into.  Fortunately, the OurLang compiler generates assembly-like code with comments, <br>  which will help not to get confused in what is happening inside. </p><br><p>  I also recommend installing the extension for Visual Studio Code, it will facilitate the work with the language. </p><br><p>  Good luck in learning the project! </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/430450/">https://habr.com/ru/post/430450/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../430434/index.html">Running Image Viewer from Windows XP on Modern Windows</a></li>
<li><a href="../430436/index.html">On the way to QUIC: what is the basis of HTTP / 3</a></li>
<li><a href="../430438/index.html">Realistic shadow for roguelike</a></li>
<li><a href="../430446/index.html">Once again about the advantages of "mobile slavery"</a></li>
<li><a href="../430448/index.html">What gives retail machine learning: a project example</a></li>
<li><a href="../430452/index.html">Fire, water and fine spray. How will the inhabitants and visitors of Lakhta Center be protected from fire?</a></li>
<li><a href="../430454/index.html">I'm surrounded by idiots or how to work in a team</a></li>
<li><a href="../430456/index.html">Legal PMI Project Management Books</a></li>
<li><a href="../430458/index.html">Multilayer Graphene Superconductor: Study of Flat Zones</a></li>
<li><a href="../430460/index.html">Trojan Penguin: Making a Virus for Linux</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>