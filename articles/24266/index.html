<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Practical use</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Now I will talk about how you can associate code generation with creativity. 
 In order to understand code generation, let's experiment with it. 

 St...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Practical use</h1><div class="post__text post__text-html js-mediator-article">  Now I will talk about how you can associate code generation with creativity. <br>  In order to understand code generation, let's experiment with it. <br><a name="habracut"></a><br><h2>  Structure </h2><br>  Let's create a PHP project and add 3 directories there: <br><br>  1. <b>source</b> - directory in which we will add source codes. <br>  2. <b>gen</b> - directory with code generation scripts. <br>  3. <b>result</b> - results directory. <br><br>  And one file to the root: <b>make.php</b> - it will determine the rules of code generation, run the process of code generation. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Process </h2><br>  The code generation will run the make.php file, which will contain instructions on how to perform this process. <br><br>  In general, it will look like this: <br><br>  <i>Instructions <b>make.php</b> + Source codes from the <b>source</b> directory -&gt; Processing scripts from the <b>gen</b> directory -&gt; Generating the result in the <b>result</b> directory.</i> <br><br><h2>  Let's start </h2><br>  First, let's implement just copying data from <b>source</b> to <b>result</b> without processing.  I will read the contents of each file and record it so that in the future it will be possible to implement the processing of this data. <br><br>  Before generating from <b>source</b> to <b>result,</b> you need to clear the <b>result</b> , for which you will create <b>clear.php</b> in the <b>gen</b> directory with the following contents: <br><br><blockquote>  <font color="teal"><b>function</b></font> clear () <br>  { <br>  full_delete (dirname (__ FILE__). <font color="green">'/../result'</font> , <font color="teal"><b>false</b></font> ); <br>  } <br><br>  <font color="teal"><b>function</b></font> full_delete ( <b>$ dir</b> , <b>$ delete_me</b> ) <br>  { <br>  <font color="teal"><b>if</b></font> (! <b>$ dh</b> = @opendir ( <b>$ dir</b> )) <font color="teal"><b>return</b></font> ; <br>  <font color="teal"><b>while</b></font> ( <font color="teal"><b>false</b></font> ! == ( <b>$ obj</b> = readdir ( <b>$ dh</b> ))) { <br>  <font color="teal"><b>if</b></font> ( <b>$ obj</b> == <font color="green">'.'</font> || <b>$ obj</b> == <font color="green">'..'</font> ) <font color="teal"><b>continue</b></font> ; <br>  <font color="teal"><b>if</b></font> </blockquote>  (! @unlink ( <b>$ dir</b> . <font color="green">'/'</font> . <b>$ obj</b> )) full_delete ( <b>$ dir</b> . <font color="green">'/'</font> . <b>$ obj</b> , <font color="teal"><b>true</b></font> ); <br>  } <br>  closedir ( <b>$ dh</b> ); <br>  <font color="teal"><b>if</b></font> ( <b>$ delete_me</b> ) @rmdir ( <b>$ dir</b> ); <br>  } <br>  Here I used the full_delete function that I found on php.net and resulted almost unchanged. <br><br>  Let's think over processing now.  Create an <b>index.php</b> file in the <b>source</b> directory and write something like: <br><blockquote>  <font color="teal"><b>echo</b></font> <font color="green">'Hello world!'</font>  ; </blockquote>  <font color="gray">PHP tags I do not cite for two reasons:</font> <font color="gray"><br></font>  <font color="gray">1. You yourself understand where to put them.</font> <font color="gray"><br></font>  <font color="gray">2. Habr eats them.</font> <br><br>  Now let's create a filter in the file <b>gen / filter.php</b> : <br><blockquote>  <font color="teal"><b>function</b></font> filter ( <b>$ input</b> ) <br>  { <br>  <b>$ output</b> = <b>$ input</b> ; <br>  <font color="teal"><b>return</b></font> <b>$ output</b> ; <br>  } </blockquote><br><br>  And you can write instructions in <b>make.php</b> : <br><blockquote>  <font color="teal"><b>require</b></font> <font color="green">'gen / clear.php'</font> ; <br>  <font color="teal"><b>require</b></font> <font color="green">'gen / filter.php'</font> ; <br><br>  clear (); <br><br>  <b>$ index</b> = file_get_contents ( <font color="green">'source / index.php'</font> ); <br>  file_put_contents ( <font color="green">'result / index.php'</font> , filter ( <b>$ index</b> )); <br></blockquote><br><h2>  What happened </h2><br>  We have implemented a certain concept, which is still useless, but has a certain potential. <br>  Let's improve the filter! <br><br><h2>  Preprocessor </h2><br>  Let's experiment with our system.  I really miss the PHP lambda expressions.  You can implement some of their similarity as an experiment. <br><br>  I always didn‚Äôt like that in order to use the usort function, it was necessary to create a separate function, and the use of create_function was not at all pleasing.  Let's implement some limited lambda syntax. <br><br>  I do not use the `character (it implements simplified access to the shell_exec function), so I can easily donate it for lambda expressions.  Experimental syntax lambda expressions: <br><blockquote>  `argument list -&gt; action` </blockquote><br>  Example: <br><blockquote>  ` <b>$ var1</b> , <b>$ var2</b> -&gt; <b>$ var1</b> + <b>$ var2`</b> </blockquote><br><br>  To handle such constructions, we write the filter_lambda function in the file <b>gen / filter.php</b> : <br><blockquote>  <b>$ uid</b> = <font color="maroon">0</font> ; <br><br>  <font color="teal"><b>function</b></font> filter_lambda ( <b>$ input</b> ) <br>  { <br>  <font color="teal"><b>global</b></font> <b>$ uid</b> ; <br>  <b>$ additional_code</b> = <font color="green">''</font> ; <br>  <font color="teal"><b>while</b></font> (( <b>$ spos</b> = strpos ( <b>$ input</b> , <font color="green">'`'</font> ))! == <font color="teal"><b>false</b></font> ) <br>  { <br>  <b>$ epos</b> = strpos ( <b>$ input</b> , <font color="green">'' '</font> , <b>$ spos</b> + <font color="maroon">1</font> ); <br>  <b>$ expr</b> = substr ( <b>$ input</b> , <b>$ spos</b> + <font color="maroon">1</font> , <b>$ epos</b> - <b>$ spos</b> - <font color="maroon">1</font> ); <br>  <b>$ divider_pos</b> = strpos ( <b>$ expr</b> , <font color="green">'-&gt;'</font> ); <br>  <b>$ vars</b> = trim (substr ( <b>$ expr</b> , <font color="maroon">0</font> , <b>$ divider_pos</b> )); <br>  <b>$ body</b> = trim (substr ( <b>$ expr</b> , <b>$ divider_pos</b> + <font color="maroon">2</font> )); <br>  <b>$ additional_code</b> . = <font color="green">"function lambda_ <b><font color="black">$ uid</font></b> ( <b><font color="black">$ vars</font></b> ) {return ( <b><font color="black">$ body</font></b> );} \ n"</font> ; <br>  <b>$ input</b> = substr ( <b>$ input</b> , 0, <b>$ spos</b> ).  <font color="green">"'lambda_ <font color="black"><b>$ uid</b></font> '"</font> .substr ( <b>$ input</b> , <b>$ epos</b> +1); <br>  <b>$ uid</b> ++; <br>  } <br>  <font color="teal"><b>return</b></font> ( <b>$ additional_code</b> ! = <font color="green">''</font> ? <font color="green">"&lt;? php \ n <b><font color="black">$ additional_code</font></b> ?&gt;"</font> : <font color="green">''</font> ).  <b>$ input</b> ; <br>  } </blockquote><br>  And now we will improve the filter function: <br><blockquote>  <font color="teal"><b>function</b></font> filter ( <b>$ input</b> ) <br>  { <br>  <b>$ output</b> = <b>$ input</b> ; <br>  <b>$ output</b> = filter_lambda ( <b>$ output</b> ); <br>  <font color="teal"><b>return</b></font> <b>$ output</b> ; <br>  } </blockquote><br><h2>  Result </h2><br>  Now we can write in the file <b>source / index.php</b> : <br><blockquote>  <b>$ numbers</b> = array ( <font color="green">'much longer'</font> , <font color="green">'short'</font> , <font color="green">'longer'</font> ); <br>  usort ( <b>$ numbers</b> , <font color="purple">`$ value1, $ value2 -&gt; strlen ($ value1)&gt; strlen ($ value2)`</font> ); <br><br>  <font color="teal"><b>foreach</b></font> ( <b>$ numbers</b> <font color="teal"><b>as</b></font> <b>$ key</b> =&gt; <b>$ value</b> ) <br>  { <br>  <font color="teal"><b>echo</b></font> <font color="green">" <font color="black"><b>$ key</b></font> : <font color="black"><b>$ value</b></font> &lt;br/&gt;"</font> ; <br>  } </blockquote><br>  Run <b>make.php</b> and get <b>result / index.php</b> : <br><blockquote>  <font color="red">&lt;? php</font> <br>  <font color="teal"><b>function</b></font> lambda_0 ( <b>$ value1</b> , <b>$ value2</b> ) { <font color="teal"><b>return</b></font> (strlen ( <b>$ value1</b> )&gt; strlen ( <b>$ value2</b> ));} <br>  <font color="red">?&gt; &lt;? php</font> <br><br>  <b>$ numbers</b> = <font color="teal"><b>array</b></font> ( <font color="green">'much longer'</font> , <font color="green">'short'</font> , <font color="green">'longer'</font> ); <br>  usort ( <b>$ numbers</b> , <font color="green">'lambda_0'</font> ); <br><br>  <font color="teal"><b>foreach</b></font> ( <b>$ numbers</b> <font color="teal"><b>as</b></font> <b>$ key</b> =&gt; <b>$ value</b> ) <br>  { <br>  <font color="teal"><b>echo</b></font> <font color="green">" <font color="black"><b>$ key</b></font> : <font color="black"><b>$ value</b></font> &lt;br/&gt;"</font> ; <br>  } <br>  <font color="red">?&gt;</font> </blockquote><br>  Unfortunately, there are no flambda expressions in PHP, and even this method is not perfect - you cannot use your variables (from the environment) in lambda expressions. <br><h2>  Conclusion </h2><br>  This rather simple experiment shows us how you can add your conventions to the source code and from the simple to create the complex.  This experiment is far from perfect: ideally, it would be necessary to use parsing, etc., but experience gives us the feel of the power of pre-processing code and code generation. <br><br><h2>  Stride further </h2><br>  I propose to implement the material to implement such interesting tasks as: <br>  1. Try recursively processing php files from the <b>source</b> directory to avoid writing each file to <b>make.php</b> . <br>  2. Try to implement conditional generation (as in C) - analogues #define, #ifdef, #elif, #endif. </div><p>Source: <a href="https://habr.com/ru/post/24266/">https://habr.com/ru/post/24266/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../242649/index.html">Lattice inheritance</a></li>
<li><a href="../24265/index.html">Look for the answer to the main question in the first ‚Äú42 is answer‚Äù text post.</a></li>
<li><a href="../242653/index.html">New profession at the first attempt or sincerity at the interview</a></li>
<li><a href="../242657/index.html">Puppet. Part 1: An Introduction to Hiera</a></li>
<li><a href="../242659/index.html">As I suddenly cut interest in the texts</a></li>
<li><a href="../242665/index.html">About the applied aspects of managing people in an organization or where are the children?</a></li>
<li><a href="../242669/index.html">The digest of interesting materials for mobile developer # 78 (November 2-9)</a></li>
<li><a href="../24267/index.html">GTA 4 on PC. To be or not to be?</a></li>
<li><a href="../242673/index.html">Registration of RES through the portal of state services</a></li>
<li><a href="../242675/index.html">Electronic signature. The history of the emergence and development</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>