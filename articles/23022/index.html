<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Programming for PSP: Part II. Total control</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the past, the tutorial we dealt with ‚ÄúHellowhold‚Äù, now it's time for the next, no less important thing: entering information. Knowing how to displa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Programming for PSP: Part II. Total control</h1><div class="post__text post__text-html js-mediator-article">  In the <a href="http://habrahabr.ru/blog/handfield_coding_popya4tsa/39230.html">past, the tutorial</a> we dealt with ‚ÄúHellowhold‚Äù, now it's time for the next, no less important thing: entering information.  Knowing how to display something on the screen and find out what the user clicked, you can already make a useful program.  In fact, after this lesson it will be possible to start something different, but I would advise you to wait, at least, for sprites. <br><br>  Hooray!  Subscribe to my <a href="http://psp.va1en0k.net/">PSP programming blog</a> . <br><br>  And yet, this is already a separate manifesto: if you find a mistake in the topic, you can shout "Hurray" or be proud of it.  The best thing you can do is write to me in person (this can be done easily by clicking ‚Äúadd user as a friend‚Äù and writing about the error in the ‚Äúintroduce yourself‚Äù field. If you dislike seeing me in the list of friends, write and I will not press the "allow add" button).  I don‚Äôt need to approve myself of the errors found in the comments, because there is absolutely no benefit from this, and it is annoying to scroll through such comments in search of something really interesting. <br><a name="habracut"></a><br>  Let's create the project on the template described in the <a href="http://habrahabr.ru/blog/handfield_coding_popya4tsa/39230.html">first part</a> .  Let's find in the file the main () function - the main function of the program, and in it the main loop (while (1) {...}).  By the way, about while (1): in programming for psp, <b>it is not considered bad form</b> to do infinite loops within a program, since  the output is still carried out by the HOME button, and only this way. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Let's make a standard message processing loop: getting and digesting.  The first thing to do is to define a variable in which the keyboard state will be stored: <br><blockquote>  <strong>SceCtrlData pad;</strong>  <strong>// variable where button status information is stored (pressed / not pressed).</strong> <br></blockquote><br>  The structure of SceCtrlData stores TimeStamp in itself - the number of frames, it seems, from the start of the program (need to be clarified!) the rest is taken into account only in Kernel Mode, for details see the file devkitPSP \ psp \ sdk \ include \ pspctrl.h) and the coordinates of the stick Lx and Ly.  Since it is defined only in pspctrl.h, you will have to add to the beginning of the file <br><blockquote>  <strong>#include [pspctrl.h]</strong> </blockquote><br>  (Instead of [], put angle brackets. Habr for some reason converts &lt;and&gt; into angle brackets, which confuses the browser) <br><br>  So, erase all the insides while while, and write <br><blockquote>  <strong>sceCtrlReadBufferPositive (&amp; pad, 1);</strong>  <strong>// read the contents of the uh keyboard buffer</strong> </blockquote><br>  This function fills the pad structure with the current state of the buttons and the stick.  By the way, in order to get the coordinates of the stick it was possible, you need to cram 2 lines before the while: <br><blockquote>  <strong>sceCtrlSetSamplingCycle (0);</strong> <strong><br></strong>  <strong>sceCtrlSetSamplingMode (PSP_CTRL_MODE_ANALOG);</strong>  <strong>// set up to receive information about the position of the stick</strong> </blockquote><br>  Otherwise, the joystick will harden in position (128: 128) (this is the middle, the coordinates themselves vary from 0 to 255). <br>  So, we considered the information, now we need to display it.  That's what happened with me: <br><blockquote>  <strong>pspDebugScreenPrintf ("TimeStamp% i | Pressed:", pad.TimeStamp);</strong>  <strong>// output TimeStamp</strong> <strong><br></strong>  <strong>if (pad.Buttons == 0) // nothing is pressed</strong> <strong><br></strong>  <strong>{</strong> <strong><br></strong>  <strong>pspDebugScreenPrintf ("NONE");</strong> <strong><br></strong>  <strong>} else {</strong> <strong><br></strong>  <strong>if (pad.Buttons &amp; PSP_CTRL_TRIANGLE) pspDebugScreenPrintf (‚ÄúTRIANGLE‚Äû);</strong> <strong><br></strong>  <strong>if (pad.Buttons &amp; PSP_CTRL_CIRCLE) pspDebugScreenPrintf (‚ÄúCIRCLE‚Äû);</strong> <strong><br></strong>  <strong>if (pad.Buttons &amp; PSP_CTRL_CROSS) pspDebugScreenPrintf (‚ÄúCROSS‚Äû);</strong> <strong><br></strong>  <strong>if (pad.Buttons &amp; PSP_CTRL_SQUARE) pspDebugScreenPrintf (‚ÄúSQUARE‚Äû);</strong> <strong><br></strong>  <strong>// which buttons are pressed?</strong> <strong><br></strong>  <strong>}</strong> <strong><br></strong>  <strong>pspDebugScreenPrintf (‚Äú(% i) | Stick:% i:% i \ n‚Äù, pad.Buttons, pad.Lx, pad.Ly);</strong> <strong><br></strong>  <strong>// display stick coordinates</strong> <br></blockquote><br>  As you can see, I consider only the state of the buttons with pictures (well, a triangle, a circle, a square and a cross), it is easy to add support for the rest, for devstats contact devkitPSP \ psp \ sdk \ include \ pspctrl.h.  The code in the loop will output something like this: <br><blockquote>  <strong>TimeStamp 68832112 |</strong>  <strong>Pressed NONE (0) |</strong>  <strong>Stick: 126: 150</strong> <strong><br></strong>  <strong>TimeStamp 72317982 |</strong>  <strong>Pressed TRIANGLE CIRCLE (12288) |</strong>  <strong>Stick: 119: 167</strong> <br></blockquote><br><br>  So, compile <a href="http://text20.ru/383">all the resulting code</a> (password - habrakhabr), convert to EBOOT, throw on the console and enjoy.  As a homework, you can try to make a walker, or some other incredibly useful thing;  I think that I will devote the third part to any other text mode features, and then move on to the graph.  Good luck! <br> <a href="http://va1en0k.net/hc/stat.php%3Fid%3D1"><img src="http://va1en0k.net/hc/hc.gif"></a> </div><p>Source: <a href="https://habr.com/ru/post/23022/">https://habr.com/ru/post/23022/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../230205/index.html">Installing an autorun with SAE J1939 interface on a car without CAN bus</a></li>
<li><a href="../230209/index.html">Hakatony- good! Yes, son, not bad!</a></li>
<li><a href="../23021/index.html">Google opens for developers BigTable DBMS</a></li>
<li><a href="../230215/index.html">Master plan of the village based on Yandex api v2 or how to relate the coordinates of the picture and map</a></li>
<li><a href="../230219/index.html">How Wikipedia works (part 2)</a></li>
<li><a href="../230221/index.html">Digest photo news # 7: the best materials of the beginning of July</a></li>
<li><a href="../230223/index.html">Miranda NG 0.95 has added support for full-fledged meta contacts in the kernel. What's next?</a></li>
<li><a href="../230227/index.html">Good and bad procrastination</a></li>
<li><a href="../230229/index.html">The task of the location of the figures in the game "Tetris"</a></li>
<li><a href="../23023/index.html">Anyone wishing to buy eeePC in St. Petersburg!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>