<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How I cooked CLion</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The story about CLion, docker, conan, cmake, ninja, cotire and gdb. 

 Small preface 
 I have been developing in C ++ for 15 years and once started wi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How I cooked CLion</h1><div class="post__text post__text-html js-mediator-article">  The story about CLion, docker, conan, cmake, ninja, cotire and gdb. <br><br><h2>  Small preface </h2><br>  I have been developing in C ++ for 15 years and once started with ‚ÄúWatcom C‚Äù.  About him I have the warmest memories.  But, since I had to write more for the UNIX console, I switched to vim as an IDE.  In general, it is quite convenient.  Its plugins do wonders, you can set up autocomplete, view class hierarchy, quickly go to the definition or search, in general, everything that IDE should be able to do there can be raised.  The pain comes at the moment when you are trying to install and master the new plugin.  It all starts up not everywhere and not always, and, often, it eats percent and memory worse than any java. <br><br>  Periodically, I looked at Qt Creator.  But he did not dare to go on it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  First meeting </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/955/502/34d/95550234df58ca77219c759974171a4f.png" alt="image">  And so, at one of those moments, CLion caught my eye. <a name="habracut"></a>  After the designer called vim, I really wanted to get the solution out of the box.  At first glance, I really liked him.  Quick tips, easy navigation, work with cmake projects, as with family, support for vim mode (although, later, I turned it off). <br><br>  Bummer happened pretty soon.  The fact is that although I am writing at the moment mainly under linux, I have a macbook pro as a workstation.  Yes, I am like this!  And I sincerely consider perverts of people who, having bought an apple laptop, install something other than macOS on it.  Therefore, the possibility of a remote build or build via docker is crucial for me.  And her, no matter how many users have asked, is not in CLion yet.  The first attempt at transition ended in nothing ‚Äî there is no solution out of the box. <br><br><h2>  Second try </h2><br>  But the pain with the vim setting did not go anywhere, and I decided to give the CLion a second chance - to try to solve the problems that arose before me on my own.  And this: <br><br><ol><li>  Lack of locally installed libraries.  CLion cannot give hints for classes whose descriptions cannot see. </li><li>  Actually the assembly itself </li></ol><br>  Before that, I used libraries that come in packages with the OS.  With CLion, I would have to throw all the OS header files on my Mac, which I absolutely did not want.  But here I was rescued by conan.  It stores all the collected libraries in a separate directory that you can easily put on yourself. <br><br>  With the second, everything was not so simple.  I decided to just replace cmake with my script that will build inside the docker container.  I didn‚Äôt smile every time I synchronize my code from the repository or add it back, add / remove an additional Target in CMakeLists.txt, as advised me.  I wanted to be able to clone any project and immediately get together without dancing with a tambourine.  It was not so easy.  The main difficulty was caused by the assembly of the test project CLion, which it performs when changing the toolchain, and the forwarding of parameters containing spaces inside the container.  But I managed. <br><br><h2>  If everything is good, you just don't know everything yet. </h2><br>  It would seem - I did it! <br>  ... <br>  I heard that building in C ++ using C ++ 14 or C ++ 17 is a rather slow thing, and, at first, I blamed everything on the compiler's slowness.  But then I noticed that remotely on a dedicated server, it‚Äôs somehow really going too fast.  The more the project became - the greater doubts were born in my soul. <br><br>  Docker turned out to be a double bottom.  Yes, the server rises quickly, only the compilation on osxfs works, as it turned out three times slower than on overlay.  So I had to switch to using rsync.  I also discovered docker volume configuration.  If you use delegated - the assembly speed increases by 15 percent. <a href="https://docs.docker.com/docker-for-mac/osxfs-caching/">More</a> . <br><br>  Along the way, I measured the build time in ninja against the standard make - the difference was almost doubled.  True, CLion needs to be built using make, otherwise, forgive prompts.  I had to run the assembly twice, once through make, for CLion, the second through ninja.  The win here is that the project changes quite rarely, and it‚Äôs necessary to get together often. <br><br>  Also, I tried to use precompiled headers (cotire) - the effect was ambiguous.  In addition, it required to manually form stdafx.h (or any other file) and include it in all .cpp.  And this, in turn, does not really like CLion.  He begins to consider everything else to include as superfluous.  This could be bypassed, but the gain was not so significant. <br><br>  The last thing I did was give up on ccache.  In my case, he gave a delay of about a second.  Yes, if a matching file is found, it speeds up the build.  But this does not often happen when you write a new code. <br><br><h2>  Appetite comes with eating </h2><br>  Since I started the build, why not try to push and debug! <br>  I used to think that gdb inside docker could not be started.  It turned out that it is not.  The <i>option --security-opt seccomp: unconfined</i> removes this problem.  And the <a href="https://blog.jetbrains.com/clion/2016/07/clion-2016-2-eap-remote-gdb-debug/">article describes in detail</a> how and what should be configured.  But, and there happened an unexpected bummer.  I was going through clang (which is logical), and for debugging I need to use gcc.  Otherwise, you can run the application in the debugger, but you can‚Äôt see the values ‚Äã‚Äãinside the stl containers anymore.  In principle, compiling via gcc is not a problem.  Then it really works. <br><br><h2>  Epilogue </h2><br>  Mice cried, pricked, but continued to eat cactus ... We are waiting!  We are waiting for the remote assembly.  We are waiting for full support for C ++ 17.  JetBrains and JFrog in their mailings constantly commemorate each other, but there is no integration yet.  Even when going locally, you will have to enter the conan commands manually.  We are waiting! <br><br>  It would also be nice to get support for the assembly through ninja.  50% of the performance on the road roll. <br><br>  Who cares, my scripts and the Dockerfile to build the template can be found on <a href="https://github.com/3galki/clion_docker">GitHub</a> . </div><p>Source: <a href="https://habr.com/ru/post/334080/">https://habr.com/ru/post/334080/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../334066/index.html">10 years of the School of data analysis Yandex</a></li>
<li><a href="../334068/index.html">Release Rust 1.19</a></li>
<li><a href="../334070/index.html">CRM will not save: what to do when the business has outgrown the "box"</a></li>
<li><a href="../334076/index.html">CASL. Authorization for JavaScript applications</a></li>
<li><a href="../334078/index.html">Singletons and Shared Instances</a></li>
<li><a href="../334082/index.html">Advantages of automation: how technology corrects mistakes of store employees</a></li>
<li><a href="../334084/index.html">Getting Started with Docker Ruby on Rails</a></li>
<li><a href="../334086/index.html">PHDays VII Secure Development Section: PDUG Community Meeting Summary</a></li>
<li><a href="../334088/index.html">Student website without cost</a></li>
<li><a href="../334090/index.html">Document generation - a view from the inside</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>