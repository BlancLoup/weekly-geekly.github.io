<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MS Excel and Python integration</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good afternoon, dear readers. 

 In today's article, I would like, in as much detail as possible, to consider the integration of Python and MS Excel a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MS Excel and Python integration</h1><div class="post__text post__text-html js-mediator-article">  Good afternoon, dear readers. <br><br>  In today's article, I would like, in as much detail as possible, to consider the integration of <strong>Python</strong> and <strong>MS Excel</strong> applications.  These questions may arise, for example, when creating any online reporting system, which should upload the results to a generally accepted format or some other tasks.  Also in the article I will show the reverse integration, i.e.  how to use a function written in python in Excel, which can also be useful for automating reports. <br><a name="habracut"></a><br><h3>  We work with MS Excel files in Python </h3><br>  I have 2 options for working with Excel files from Python: <br><br><ol><li>  <a href="https://habr.com/ru/post/232291/">Using libraries such as xlrd, xlwt, xlutils or openpyxl</a> </li><li>  <a href="https://habr.com/ru/post/232291/">Work with com-object</a> </li></ol><br>  Consider working with these methods in more detail.  As an example, we will use a ready-made excel file from which we first read the data from the first cell, and then write it to the second.  Such simple examples will be enough for the first acquaintance. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="lib"></a><h4>  Use of libraries </h4><br>  So, the first method is quite simple and well described.  For example, there is an excellent <a href="http://habrahabr.ru/post/99923/">article</a> for describing how to work with <a href="http://www.python-excel.org/">xlrd, xlwt, xlutils</a> .  Therefore, in this material I will give a small piece of code with their use. <br><br>  To get started, load the necessary libraries and open the <em>xls</em> file for reading and select <br>  desired data sheet: <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> xlrd, xlwt <span class="hljs-comment"><span class="hljs-comment">#  rb = xlrd.open_workbook('../ArticleScripts/ExcelPython/xl.xls',formatting_info=True) #   sheet = rb.sheet_by_index(0)</span></span></code> </pre> <br>  Now let's see how to count values ‚Äã‚Äãfrom the right cells: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#    A1 val = sheet.row_values(0)[0] #      vals = [sheet.row_values(rownum) for rownum in range(sheet.nrows)]</span></span></code> </pre><br>  As can be seen reading the data is not difficult.  Now write them to another file.  To do this, create a new excel file with a new workbook: <br><br><pre> <code class="python hljs">wb = xlwt.Workbook() ws = wb.add_sheet(<span class="hljs-string"><span class="hljs-string">'Test'</span></span>)</code> </pre><br>  We will write the previously obtained data into the new file and save the changes: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># A1     A1   ws.write(0, 0, val[0]) #  B      A   i = 0 for rec in vals: ws.write(i,1,rec[0]) i =+ i #   wb.save('../ArticleScripts/ExcelPython/xl_rec.xls')</span></span></code> </pre><br>  It is clear from the example above that the <strong>xlrd</strong> library <strong>is</strong> responsible for reading the data, and the <strong>xlwt</strong> is <strong>responsible</strong> for writing, so there is no way to make changes to an already created book without copying it into a new one.  In addition, these libraries work only with <em>xls</em> format files (Excel 2003) and they do not have support for the new <em>xlsx</em> format (Excel 2007 and higher). <br><br>  To successfully work with the xlsx format, you will need the <a href="https://pythonhosted.org/openpyxl/index.html">openpyxl</a> library.  To demonstrate its work, let's do the actions that were shown for previous libraries. <br><br>  First, load the library and select the desired book and worksheet: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> openpyxl wb = openpyxl.load_workbook(filename = <span class="hljs-string"><span class="hljs-string">'../ArticleScripts/ExcelPython/openpyxl.xlsx'</span></span>) sheet = wb[<span class="hljs-string"><span class="hljs-string">'test'</span></span>]</code> </pre><br>  As can be seen from the above listing is not difficult to do.  Now let's see how to read the data: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#    val = sheet['A1'].value #   vals = [v[0].value for v in sheet.range('A1:A2')]</span></span></code> </pre><br>  The difference from past libraries is that <em>openpyxl</em> allows you to map to cells and sequences through their names, which is quite convenient and understandable when reading a program. <br><br>  Now let's see how we record and save the data: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#     sheet['B1'] = val #  i = 0 for rec in vals: sheet.cell(row=i, column=2).value = rec i =+ 1 #   wb.save('../ArticleScripts/ExcelPython/openpyxl.xlsx')</span></span></code> </pre><br>  From the example, it is clear that recording is also quite easy.  In addition, in the code above, you can see that besides the names of the cells, <em>openpyxl</em> can work with their indices. <br><br>  The disadvantages of this library include the fact that, as in the previous example, it is not possible to save changes without creating a new book. <br><br>  As it was shown above, for more or less full-fledged work with excel files, in this case, you need 4 libraries, and this is not always convenient.  In addition, you may need to access VBA (for example, for any subsequent processing) and with the help of these libraries you will not get it. <br><br>  However, working with these libraries is quite simple and convenient for quickly creating Excel files for formatting them, but if you need more features, then the next subclause is for you. <br><br><a name="com"></a><h4>  Work with com-object </h4><br>  In my reports, I prefer to use the second method, namely the use of an Excel file through a com object using the <strong>win32com</strong> library.  Its advantage is that you can perform all operations with a file that regular Excel can do using VBA. <br><br>  We illustrate this with the same problem as the previous examples. <br><br>  First, load the required library and create a COM object. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> win32com.client Excel = win32com.client.Dispatch(<span class="hljs-string"><span class="hljs-string">"Excel.Application"</span></span>)</code> </pre><br>  Now we can work using the <em>Excel</em> object we can access all the features of VBA.  Let's first open any book and select the active sheet.  This can be done like this: <br><br><pre> <code class="python hljs">wb = Excel.Workbooks.Open(<span class="hljs-string"><span class="hljs-string">u'D:\\Scripts\\DataScience\\ArticleScripts\\ExcelPython\\xl.xls'</span></span>) sheet = wb.ActiveSheet</code> </pre><br>  Let's get the value of the first cell and the sequence: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#    val = sheet.Cells(1,1).value #   A1:A2 vals = [r[0].value for r in sheet.Range("A1:A2")]</span></span></code> </pre><br>  As you can see, we operate here with pure VBA functions.  This is very convenient if you have written macros and you want to use them when working with Python with minimal overhead of rewriting the code. <br><br>  Let's see how you can record the received values: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#     sheet.Cells(1,2).value = val #  i = 1 for rec in vals: sheet.Cells(i,3).value = rec i = i + 1 #   wb.Save() #  wb.Close() # COM  Excel.Quit()</span></span></code> </pre><br>  From the example it can be seen that these operations are also quite simply implemented.  In addition, you can notice that we saved the changes in the same book that we opened for reading, which is quite convenient. <br><br>  However, an attentive reader will pay attention to the variable <em>i</em> , which is initialized not 0, as is customary in python, but 1. This is due to the fact that we work with cell indices as from VBA, and there the numbering starts not from 0, but from 1. <br><br>  This completes the analysis of how to work with excel files in python and proceed to the inverse problem. <br><br><h3>  Call Python functions from MS Excel </h3><br>  This situation may arise that you already have some function that processes data in python, and you need to transfer its functionality to Excel.  Of course, you can rewrite it in VBA, but why? <br><br>  There is a great <a href="http://sourceforge.net/projects/excelpython/">ExcelPython</a> add-in for using python functions in Excel.  With it, you can call functions written in python directly from Excel, although you still have to write a small wrapper on VBA, and all of this will be shown below. <br><br>  So, suppose we have a function written in python that we want to use: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_unique</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(lists)</span></span></span><span class="hljs-function">:</span></span> sm = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> lists: sm = sm + int(i.pop()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sm</code> </pre><br>  At the entrance it is given a list consisting of lists, this is one of the conditions that must be met for this function to work in Excel. <br><br>  Let's save the function in the <em>plugin.py</em> file and put it in the same directory where our excel file will be located, with which we will work. <br><br>  Now install <a href="http://sourceforge.net/projects/excelpython/">ExcelPython</a> .  Installation occurs through the launch of the exe-file and does not cause difficulties. <br><br>  When all the preparations are done, open the excel test file and call the <em>VBA editor</em> (Alt + F11).  To work with the above add-in, you need to connect it via <em>Tools-&gt; References</em> , as shown in the figure: <br><br><div style="text-align:center;"><img src="http://computerscinece.ru/upload/picture/2014/08/ExcelPython1.png"></div><br><br>  Well, now you can start writing the wrapper function for our Python module <em>plugin.py</em> .  It will look like this: <br><br><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">Function</span></span> sr(lists As Range) <span class="hljs-keyword"><span class="hljs-keyword">On</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Error</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GoTo</span></span> do_error <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> plugin = PyModule(<span class="hljs-string"><span class="hljs-string">"plugin"</span></span>, AddPath:=ThisWorkbook.Path) <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> result = PyCall(plugin, <span class="hljs-string"><span class="hljs-string">"get_unique"</span></span>, PyTuple(lists.Value2)) sr = WorksheetFunction.Transpose(PyVar(result)) <span class="hljs-keyword"><span class="hljs-keyword">Exit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span> do_error: sr = <span class="hljs-built_in"><span class="hljs-built_in">Err</span></span>.Description <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span></code> </pre><br>  So, what happens in this function? <br><br>  First of all, using <strong><code>PyModule</code></strong> , we connect the necessary module.  To do this, as parameters it is passed the name of the module without an extension, and the path to the folder in which it is located.  At the output of the <strong><code>PyModule</code></strong> we get an object to work with the module. <br><br>  Then, using <strong><code>PyCall</code></strong> , we call the function we need from the specified module.  As parameters, <strong><code>PyCall</code></strong> gets the following: <br><br><ol><li>  Module object obtained in the previous step </li><li>  Name of the function being called </li><li>  Parameters passed to functions (transmitted as a list) </li></ol><br>  The <strong><code>PyTuple</code></strong> function takes as input some values ‚Äã‚Äãand converts them into a Python tuple object. <br>  Well and, accordingly, <strong><code>PyVar</code></strong> performs the operation of converting the result of the python function, to the type understood by Excel. <br><br>  Now, to make sure that our bundle works, let's call our newly baked function on a sheet in Excel: <br><br><div style="text-align:center;"><img src="http://computerscinece.ru/upload/picture/2014/08/ExcelPython2.png"></div><br><br>  As you can see from the figure, everything worked correctly. <br><br>  It should be noted that this material uses the old version of <em>ExcelPython</em> , and a new version is available on the author's <a href="https://github.com/ericremoreynolds/excelpython">GitHub</a> . <br><br><h3>  Conclusion </h3><br>  As a conclusion, it should be noted, the examples in this article are the most simple and for a more in-depth study of these methods, I recommend referring to <br>  documentation for the right packages. <br><br>  I also want to note that these packages are not the only ones, and the article omits consideration of such packages as <a href="https://xlsxwriter.readthedocs.org/">xlsxwriter</a> for generating excel files or <a href="http://xlwings.org/">xlwings</a> that can work with Excel files on the fly, as well as <a href="https://www.pyxll.com/index.html">PyXLL</a> , which performs similar <em>ExcelPython</em> functions. <br><br>  In addition, in the article I tried to somewhat generalize the material scattered around the network, since  such questions often appear on the forums and I think it would be useful for some to have such a ‚Äúcheat sheet‚Äù at hand. </div><p>Source: <a href="https://habr.com/ru/post/232291/">https://habr.com/ru/post/232291/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../232273/index.html">10 alternatives to the Google Play app store</a></li>
<li><a href="../232279/index.html">Evolution of the list of recommendations in SmartProgress</a></li>
<li><a href="../232281/index.html">Falcon 9 launch vehicle successfully put a commercial satellite into orbit</a></li>
<li><a href="../232285/index.html">Get acquainted! Eric The Epic Elephant</a></li>
<li><a href="../232287/index.html">Enlarge your pension-3. Examples Everything is relative</a></li>
<li><a href="../232293/index.html">Tizen and Ubuntu - a long way to HelloWorld</a></li>
<li><a href="../232295/index.html">A team of scientists from the University of Luxembourg managed to implant "artificial" neurons in the brain of mice</a></li>
<li><a href="../232297/index.html">HLS vs. RTMP - dry statistics</a></li>
<li><a href="../232303/index.html">How to program in Visual C # 2012. 5th ed</a></li>
<li><a href="../232305/index.html">Sessions in PHP - an underwater pebble with asynchronous requests</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>