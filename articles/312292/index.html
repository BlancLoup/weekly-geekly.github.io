<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Installing Mikrotik Cloud Hosted Router on VPS Hosting Digital Ocean</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="... or another Linux hosting.  Immediately, I‚Äôll make a reservation that since I‚Äôve been tired of demolishing and re-adjusting the droplet in DO durin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Installing Mikrotik Cloud Hosted Router on VPS Hosting Digital Ocean</h1><div class="post__text post__text-html js-mediator-article"><h6>  ... or another Linux hosting. </h6><img src="https://habrastorage.org/files/ded/3c9/c7a/ded3c9c7a2004cea802eece471bedce5.png" align="right">  <i>Immediately, I‚Äôll make a reservation that since I‚Äôve been tired of demolishing and re-adjusting the droplet in DO during all experiments, I‚Äôll follow the example in VMware ESXi, but this will not affect the final result, the commands will all be the same, in principle, this applies to Any cloud VPS hosting where we have SSH access.</i> <br clear="all">  The report is based on Dmitry Pichulin <a href="https://habrahabr.ru/users/deemru/" class="user_link">deemru</a> at the <abbr title="Mikrotik User Meeting">MUM</abbr> in September 30 in Moscow.  In contrast to the report of Dmitry, this article will not consider the issues of choosing a hosting and prices for it (in an effort to make the cloud router cheaper), the settings of the received device.  Only the technical side of the issue will be considered and a couple of problems solved. <a name="habracut"></a><br><br>  Returning from MUM, I was in anticipation, my hands itched to gash Mikrotik on Digital Ocean (at that moment, there was Ubuntu Server, which served as a VPN server).  It was useful to watch the archive of speeches, but it was not there yet and I wrote a letter to Dmitry with a request to share the slides.  Having received a presentation with a cold head, he rushed into battle - breaking his droplet completely.  I did everything as in the presentation, everything started.  Easier and impossible to come up with.  Download the image to the hosting, unpack it, translate the file system to read-only, upload the image to disk via dd.  But it was then that the first inconsistency awaited me - when Dmitry first booted the <abbr title="Cloud Hosted Router">CHR</abbr> , the file system expanded automatically and it took up the entire disk, but this did not happen and I had to be content with 128 MB. <br><br>  Someone will say 128 MB on the router is enough for everyone.  But I was not satisfied with this situation, so I began to eliminate it.  Everyone knows that RouterOS is based on Linux, but there is not much left of Linux, so after installing the system, it cannot be re-partitioned by regular means.  It is impossible to boot from any LiveCD and redefine it (well, at least for DO it is impossible).  Attempts to poke with fdisk and parted after uploading the image to disk, but before rebooting, also did not lead to any positive result (the effect either did not exist at all, or I received a non-bootable system). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Normal heroes always go around. <br><br>  So, in order to get RouterOS installed on the Digital Ocean, in which 20 GB of disk space is available (well, or how much you have at the rate), we will need: <br><br><ul><li>  Actually, droplet with the Linux distribution installed (in this case, the distribution will be Ubuntu Server 16.04 x64, and instead of droplet, there will be a virtual machine in ESXi, but once again, it will not play the role) to which we have access via SSH . <br><br></li><li>  The hypervisor installed on the computer or server (initially I did in VirtualBox, now I will do it again in ESXi, this does not affect the final result). <br><br></li><li>  LiveCD of your favorite Linux distribution (it is desirable that there is a GUI, it will be more convenient). </li></ul><br>  As you can see, the list is not very large, there are no special requirements for its points, I tried to make the decision as versatile and simple as possible so that everything could be built literally on my knee from what is. <br><br><h2>  Let's start with the droplet. </h2><br>  We need to figure out how much disk space we need in the virtual machine, so: <br><br><pre><code class="bash hljs">fdisk -l /dev/sda  /dev/sda: 16 GiB, 17179869184 , 33554432   :   1 * 512 = 512    (/): 512  / 512  I/O size (minimum/optimal): 512 bytes / 512 bytes   : dos  : 0x7b5dbf9c -  Start   Size Id  /dev/sda1 * 2048 31457279 31455232 15G 83 Linux /dev/sda2 31459326 33552383 2093058 1022M 5  /dev/sda5 31459328 33552383 2093056 1022M 82 Linux  / Solaris</code> </pre> <br>  As we see, we have a disk of 17179869184 bytes, remember this value. <br><br><h2>  Preparation of the intermediate machine </h2><br>  In the hypervisor, create a new virtual machine.  Its parameters do not really matter, but you can, for example, make them close to the characteristics of a droplet.  It is better to make the disk size with a small margin, just in case (for some reason, 20GB in DO turned out to be less than 20GB in VirtualBox).  We configure loading of the virtual computer from LiveCD. <br><br><img src="https://habrastorage.org/files/f1a/e1c/391/f1ae1c391f61484b9926acb816c76bae.PNG" alt="image"><br><br>  We include it and after downloading we download in any convenient way the latest version of CHR, which can be found <a href="http://www.mikrotik.com/download">at the link</a> : <br><br><img src="https://habrastorage.org/files/f6f/501/df1/f6f501df1172489386fd5e35a2509c93.PNG" alt="image"><br><br>  We need an image Raw disk image (for example <a href="">chr-6.37.1.img.zip</a> ).  Unpack the archive: <br><br><pre> <code class="bash hljs">unzip chr-6.37.1.img.zip Archive: chr-6.37.1.img.zip inflating: chr-6.37.1.img</code> </pre><br>  And we upload the image to the hard disk using dd (Dmitry used the pv utility here, but I honestly don‚Äôt see the point, because the image is small and unfolds pretty quickly): <br><br><pre> <code class="bash hljs">dd <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>=chr-6.37.1.img.zip of=/dev/sda 262144+0 records <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 262144+0 records out 134217728 bytes (134 MB, 128 MiB) copied, 5.64304 s, 23.8 MB/s</code> </pre><br>  instead of sda, you need to specify your disk, its name may differ. <br><br><h2>  Expanding the file system RouterOS </h2><br>  Fans can do everything in the console there, it seemed to me faster and easier to do everything in GParted. <br><br>  Run GParted, select the disk on which you installed RouterOS and use the Resize / Move function to increase the size of the second partition.  Please note that the partition size minus the size of the first partition should not exceed the size of the disk of your droplet, which we looked at the very beginning (i.e., the first partition is 32 MiB, so the second should be no more than 17179869184 bytes / 1048576 = 16384 MiB and - 32, i.e. 16352 MiB) <br><br><img src="https://habrastorage.org/files/ed6/eae/959/ed6eae95906f46d18c25b4c98c19081c.PNG" alt="image"><br><br>  Do not forget to apply changes to the disk layout. <br><br><h2>  Create a new image and click on it with gzip: </h2><br><pre> <code class="bash hljs">dd <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>=/dev/sda bs=8196 count 17000 | gzip -9cf &gt; chr.img.gz 17000+0 records <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 17000+0 records out 139332000 bytes (139 MB, 133 MiB) copied, 3.30824 s, 42.1 MB/s</code> </pre><br>  The value of 17000 we get by reducing the size of the image when it is deployed to disk.  There was 128 MiB, i.e.  128 * 1024 = 131072 KiB divide the size by the block size and round 131072/8 = 16384 ‚âà 17000 blocks. <br><br><h2>  Fill the resulting image on the droplet and install it </h2><br><pre> <code class="bash hljs">scp chr.img.gz user@host:~/</code> </pre><br>  Where user is the name of the user on your droplet, and host is his address.  Copying will be performed to the user's home directory. <br><br>  Accept the ssh server certificate, and enter the password when asked for it.  After the end of copying, this virtual machine is no longer needed. <br><br>  Go to our droplet.  You can connect to it via ssh or log in via the console.  Make sure that our image is copied, anyone can check the checksums.  Let's translate the file system into read-only mode and deploy the image to disk via gzip and dd: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> u &gt; /proc/sysrq-trigger &amp;&amp; gunzip -c chr.img.gz | dd of=/dev/vda</code> </pre><br>  Everything!  CHR is installed on our droplet.  Reboot: <br><br><pre> <code class="bash hljs">reboot</code> </pre><br><h2>  Welcome to Mikrotik Cloud Hosted Router </h2><br><div class="spoiler">  <b class="spoiler_title">@gexogen is a cheat !!!</b> <div class="spoiler_text">  In fact, even though I promised that there is no difference, in Digital Ocean we do it or in ESXi, there is still a difference.  In DO everything works, but ESXi after a reboot fell into the Kernel Panic.  But, in ESXi the file system is stretched and so at the first boot and these manipulations are not required. <br></div></div><br>  After the reboot, we enter under the user admin without a password, after which we set the password, register the ip address and default route: <br><br><blockquote>  / system user set admin password = YOURPASSWORD <br>  / ip address add address = YOUR.IP.ADD.RESS / MASK <br>  / ip route add gateway = YOUR.GATE.WAY.IP </blockquote><br>  After that, you can connect to it and configure it through the Winbox. <br><br><h2>  Conclusion </h2><br><img src="https://habrastorage.org/files/4ef/a3e/c7d/4efa3ec7de904459822f4b82e6b18f8f.jpg" alt="image"><br><br>  In an accessible place, you can install a Linux virtual machine inside RouterOS, or use it in some other way - at your discretion (to raise an FTP server or something else). <br><br><h2>  References: </h2><br>  <a href="http://mum.mikrotik.com/presentations/RU16/presentation_3932_1475483184.pdf">Presentation of Dmitry in PDF format</a> <br>  <a href="https://www.youtube.com/watch%3Fv%3DYiDtUYBH9Ao">Recording his performances</a> <br>  <a href="">Just in case, a link to a ready-made image for a 20 GB file system (i.e., a minimum DO rate of $ 5)</a> </div><p>Source: <a href="https://habr.com/ru/post/312292/">https://habr.com/ru/post/312292/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../312278/index.html">Analysis of the tasks of the first stage of selection to the school programmers HeadHunter 2016</a></li>
<li><a href="../312282/index.html">Prevent it: make life easier for the client and yourself at the same time</a></li>
<li><a href="../312286/index.html">Developing intelligent bots using the Microsoft Bot Framework, Azure Cognitive Services and NER systems. Part 1</a></li>
<li><a href="../312288/index.html">Do not think about seconds down</a></li>
<li><a href="../312290/index.html">The concept of a sandbox when developing extensions for the browser Google Chrome</a></li>
<li><a href="../312294/index.html">What's wrong with the display of currency symbols in iOS</a></li>
<li><a href="../312296/index.html">The United States has transferred control of the domains to the world community: what does it mean</a></li>
<li><a href="../312300/index.html">We understand in MAVLink. Part 1</a></li>
<li><a href="../312302/index.html">We sit on a Java-hardcore: Free broadcast of the track Joker 2016 without cuts</a></li>
<li><a href="../312304/index.html">Sell ‚Äã‚Äãlike Amazon: 7 examples of automating personal trigger e-mails that you can run today</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>