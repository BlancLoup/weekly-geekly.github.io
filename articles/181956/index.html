<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Fault tolerance of systems based on HP Storageworks P4xxx without a third data center</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Prehistory  About two years ago, the management decided to invest in the virtualization project of our data center. The task was quite simple, about 5...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Fault tolerance of systems based on HP Storageworks P4xxx without a third data center</h1><div class="post__text post__text-html js-mediator-article"><h4>  Prehistory </h4>  About two years ago, the management decided to invest in the virtualization project of our data center.  The task was quite simple, about 50 servers, mostly Windows, a couple of Linux machines, nothing non-standard.  Datacenter, though small but very <s>proud, is</s> important, we are the European headquarters of a large organization - we host services for 30 countries (Europe + CIS).  Two data centers, the connection is reliable and duplicated, for certain reasons, they chose VMWare ESXi (4 then 5) and <a href="http://habrahabr.ru/company/hp/">HP</a> Lefthand P4000 (first tranche) and P4500 (second tranche).  The reasons are purely subjective, VMWare and HP are strategic partners, etc. <a name="habracut"></a><br><br><h5>  What happened? </h5>  By the accepted rules, we test redundancy &amp; failover twice a year; in the case of virtualized services, we decided to divide the process into two stages.  The first step was to simulate the failure of only the hypervisor hosts (we actually cut down the power supply - roughly, but this is how the testing process is described in the documentation).  As expected, VMWare HA and FT worked as they should, the committee ticked off the protocols and signed.  At the second stage, along with the hypervisors, the storage devices (LeftHand) were cut down and ... no miracle happened.  Error in HP Centralized Management Console, data is not available, although backup devices are turned on and available, ... but there is no quorum.  It was not possible to restore working capacity - we had to immediately turn everything back on; we could not achieve any filer. <br><br><h5>  Began to find out. </h5>  We knew that for an automatic file server, 3 data centers were needed - at pre-sales meetings, HP representatives warned us about this many times.  Admins were not invited to meetings, clarifying questions were not asked, for some reason the management decided that ‚Äúautomatic file server is possible only with 3 data centers‚Äù implies that ‚Äúif manually, then two data centers are enough‚Äù.  But no, in response to the request, HP Support responded that neither manually nor automatically without the third data center, the file carrier is impossible.  The principle is similar to that described <a href="http://kb.vmware.com/selfservice/microsites/search.do%3Flanguage%3Den_US%26cmd%3DdisplayKC%26externalId%3D2020097">here</a> (in our case, the systems are somewhat different - but in general, the same case). <img src="https://habrastorage.org/getpro/habr/post_images/aea/560/0e6/aea5600e61a5606dc39a89e10e6f8e0f.jpg" alt="image">  In short, everything is tied to the Failover Manager (FOM) - it should be accessible from the backup data center network at the time of the failure of the main device - in order to avoid the situation of parallel operation - split brain.  The FOM itself does not contain any data, and is needed only in the event of a malfunction, as a witness.  For the operation of the FOM, which is a normal virtual machine with more than modest requirements (2Ghz, 1GB RAM, 13Gb HDD), you only need access to our iSCSI VLAN.  We immediately figured out and presented to management a version of the Windows server in the cloud with a VPN in our iSCSI VLAN and free VMWare Server to run the FOM ... but the project was rejected with comments: <ul><li>  a) Automatic faylover not needed; </li><li>  b) the use of cloud-hosted servers in the storage network is contrary to the IB policy. </li></ul>  The management set the task: to solve the problem without using the cloud and to ensure the possibility of manual switching between primary and backup storage devices. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h6>  And this is how we solved the problem: </h6><ul><li>  On one of the ESXi hosts in the backup data center, activate local storage (to provide access in case of a SAN failure) </li><li>  Create a full copy of the main FOM (we copy everything, and most importantly the MAC address of the virtual network card connected to the iSCSI network) on the host in the backup data center </li><li>  We leave the FOM in the backup data center in StandBy mode </li></ul>  And that's all, if the main system fails, we remove the FOM in the backup data center from StandBy mode, and it completely replaces the inaccessible main FOM.  When you return to normal mode, you just have to remember to return it back to StandBy mode. <br><img src="https://habrastorage.org/storage2/fe5/e62/f8b/fe5e62f8b676dc96c6b73ffa5787d442.gif"><br><hr>  ps sorry that the text on the pictures in English, copied from the report </div><p>Source: <a href="https://habr.com/ru/post/181956/">https://habr.com/ru/post/181956/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../181942/index.html">AWS Route53: DNS Failover Now Supports Elastic Load Balancer</a></li>
<li><a href="../181944/index.html">Nokia: design history</a></li>
<li><a href="../181948/index.html">Big Russian Google Glass Review</a></li>
<li><a href="../181950/index.html">What skills do technical support staff need in 2013?</a></li>
<li><a href="../181954/index.html">About one mistake</a></li>
<li><a href="../181960/index.html">Spintires - (Mud simulator on Kickstarter) - "the taiga, which needs your wings"</a></li>
<li><a href="../181968/index.html">Video Recorder for IPTV version ++</a></li>
<li><a href="../181970/index.html">Dell XPS 13 Developer Edition, or Ubuntu comes on ultrabooks</a></li>
<li><a href="../181974/index.html">About popular games in the Apple AppStore and Google Play</a></li>
<li><a href="../181978/index.html">Adjustable do-it-yourself monitor backlight</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>