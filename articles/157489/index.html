<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Big update ObjectScript 0.99-vm3. Part 1: Register Virtual Machine</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ObjectScript is a new embedded and very lightweight object-oriented open source programming language. ObjectScript extends the capabilities of languag...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Big update ObjectScript 0.99-vm3. Part 1: Register Virtual Machine</h1><div class="post__text post__text-html js-mediator-article"> ObjectScript is a new embedded and very lightweight object-oriented <a href="https://github.com/unitpoint/objectscript">open source</a> programming language.  ObjectScript extends the capabilities of languages ‚Äã‚Äãsuch as JavaScript, Lua, Ruby and PHP.  You can read the original syntax of the language in <a href="http://habrahabr.ru/post/152289">this article</a> . <br><br>  ObjectScript 0.99-vm3 - a new fast virtual machine and new features. <br><br>  Removed some operators, for example, <code>clone, numberof</code> , etc., replaced by functions.  The last value in the function is returned automatically.  Added a short entry for accessing members of the object - <code>@varname</code> , a new short syntax for declaring functions, and more.  other <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Part 1. Register ObjectScript virtual machine </h2><br>  Traditionally, programming languages ‚Äã‚Äãuse a stack virtual machine (Java, .Net, ActionScript, and some others).  Such VMs use the <code>push, pop</code> commands to add values ‚Äã‚Äãto the stack and remove it if necessary.  When calculating mathematical operations, two values ‚Äã‚Äãare used as arguments at the top of the stack, and the result of the operation replaces the arguments.  For example, the following code: <br><br><pre> <code class="javascript hljs"> i = j + k</code> </pre><br>  on the stack VM will be compiled into commands: <br><br><pre> <code class="hljs matlab"> push_local <span class="hljs-built_in"><span class="hljs-built_in">j</span></span> -     push_local k -     operator + -     set_local <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> -       pop -    </code> </pre><br>  Previously, ObjectScript also used a stack VM, but not now.  The virtual machine has been completely rewritten.  Now ObjectScript uses the Register-based Virtual Machine, and the above example will be compiled into one command: <br><br><pre> <code class="hljs matlab"> add <span class="hljs-built_in"><span class="hljs-built_in">i</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">j</span></span>, k</code> </pre><br>  ObjectScript in the debug information shows this command as follows: <br><br><pre> <code class="hljs swift"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> j [<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> +] <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> k</code> </pre><br>  Immediately striking is the difference in the number of commands to perform an action (5 for a stack VM and 1 for a register VM).  Indeed, the stack VM code has a lot more commands than registered ones, the number of VM commands also varies greatly.  For example, the previous stack version of ObjectScript VM2 had 111 commands against the current VM3 with 36 commands.  The fewer the commands, the simpler the VM, the easier it is to maintain and optimize, the easier it is to implement in different programming languages ‚Äã‚Äãif necessary, including the easier it is to make a JIT (compile into machine code). <br><br>  An example of changing values ‚Äã‚Äãin variables: <br><br><pre> <code class="javascript hljs"> i, j = j, i</code> </pre><br>  ObjectScript compiles this code into three commands: <br><br><pre> <code class="hljs swift"> move: # = <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> j move: <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> j = <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i move: <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = #</code> </pre><br>  where # means using a register for a temporary variable.  If you look at the commands, you can see that changing the values ‚Äã‚Äãof variables occurs in an optimal way and is completely equivalent to the following code: <br><br><pre> <code class="javascript hljs"> temp = j j = i i = temp</code> </pre><br><br><h2>  What is a Register Virtual Machine? </h2><br>  The register virtual machine does not operate with a stack of values, but with values ‚Äã‚Äãin registers.  A register is a temporary local variable that exists all the time when access is possible. <br><br>  In this lies the first highlight of the register VM.  The register is always ready to read and write, the VM does not need to do extra checks for the existence of such a variable (register), its allocation and destruction. <br><br>  The second highlight is that there are no push and pop commands.  Such commands are quite expensive for a VM, since  you need to change the stack and control its top, you need to constantly check the stack for overflow and the need for reallocation.  When we get rid of the work teams with the stack, it becomes possible to save the results of operations directly to the final variables, bypassing the temporary shelter in the stack. <br><br>  The third highlight is a much smaller number of commands, a simpler VM for implementation, including for JIT. <br><br>  As was seen from the above example, the command for a stack VM represents an atomic action from itself; it is simpler than the command for a register VM and takes up less space.  For example, the <code>push</code> command can be encoded with 1 byte and the next command can be encoded with the next byte.  In this lies a plus and a fat minus. <br><br>  Plus stack VM that commands are encoded with a smaller number of bytes and the resulting code takes up less space. <br><br>  The downside is that part of the commands is still impossible to encode with one byte, for example, <code>push_double, jump</code> , etc. Such commands require an additional argument, for <code>push_double</code> , this is a double-double number (8 bytes), for <code>jump</code> an offset (for example, 4 byte - int32) for the transition.  Since  The commands in the stack VM follow each other, they are not aligned in any way, so the double number or int32 offset can be in memory at any address, including at even and whatever you want.  Those who are familiar with the processor architecture will immediately pay attention to this, because  such arguments cannot be read with a single processor command.  If you try to do this, for example, read a <code>dword</code> at an odd address in memory, an exception will occur on the ARM architecture and the program will close with an error.  At different architects can be either errors or a catastrophic decline in performance.  Therefore, it is only necessary to read such multibyte arguments from the byte stream and by using bitwise offset operations to form the final argument.  This somewhat reduces the speed of the VM. <br><br>  In a registered VM, many commands have three arguments and occupy (along with the arguments) 4 bytes.  In order to eliminate the problems described above, all the commands in ObjectScript are aligned and always occupy 4 bytes, even if some of the bits are not really used.  For example, the <code>move</code> command in ObjectScript has two arguments.  But even in this case, ObjectScript comes out of the situation as follows.  Very often, the <code>move</code> commands follow each other and fill two consecutive registers.  In this case, ObjectScript (at the optimization stage) generates one <code>move2</code> command instead of two <code>move</code> : <br><br><pre> <code class="hljs nginx"> <span class="hljs-attribute"><span class="hljs-attribute">move2</span></span> R, A, B</code> </pre><br>  which is executed as two <code>move</code> commands: <br><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">move</span></span> R, A <span class="hljs-keyword"><span class="hljs-keyword">move</span></span> R+<span class="hljs-number"><span class="hljs-number">1</span></span>, B</code> </pre><br>  at the same time <code>move2</code> has three arguments and fully uses 4 bytes.  Alignment of commands allows you to read them with a single processor command, which increases the speed of the VM. <br><br>  In combination with other pluses, ObjectScript with the new register VM3 has become one third faster compared to the previous stack VM2. <br><br><h2>  How a registered VM works and where the registers come from </h2><br>  The ObjectScript compiler collects information not only about local variables that the programmer uses in functions, but also about all temporary variables (compiled by the compiler).  Thus, a register is a temporary local variable in a function.  VM refers to local variables and registers are fully equivalent, by index.  Therefore, the same VM command can work with local variables and registers, and the result of an operation can be saved immediately to a local variable, bypassing the temporary one. <br><br>  For example, the following code: <br><br><pre> <code class="javascript hljs"> k = i - j*k / (x + y - z*i / j) + i</code> </pre><br>  ObjectScript compiles to: <br><br><pre> <code class="hljs swift"> # (<span class="hljs-number"><span class="hljs-number">59</span></span>) = <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> j (<span class="hljs-number"><span class="hljs-number">5</span></span>) [<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> *] <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> k (<span class="hljs-number"><span class="hljs-number">6</span></span>) # (<span class="hljs-number"><span class="hljs-number">60</span></span>) = <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x (<span class="hljs-number"><span class="hljs-number">7</span></span>) [<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> +] <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> y (<span class="hljs-number"><span class="hljs-number">8</span></span>) # (<span class="hljs-number"><span class="hljs-number">61</span></span>) = <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> z (<span class="hljs-number"><span class="hljs-number">9</span></span>) [<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> *] <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i (<span class="hljs-number"><span class="hljs-number">4</span></span>) # (<span class="hljs-number"><span class="hljs-number">61</span></span>) = # (<span class="hljs-number"><span class="hljs-number">61</span></span>) [<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> /] <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> j (<span class="hljs-number"><span class="hljs-number">5</span></span>) # (<span class="hljs-number"><span class="hljs-number">60</span></span>) = # (<span class="hljs-number"><span class="hljs-number">60</span></span>) [<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> -] # (<span class="hljs-number"><span class="hljs-number">61</span></span>) # (<span class="hljs-number"><span class="hljs-number">59</span></span>) = # (<span class="hljs-number"><span class="hljs-number">59</span></span>) [<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> /] # (<span class="hljs-number"><span class="hljs-number">60</span></span>) # (<span class="hljs-number"><span class="hljs-number">58</span></span>) = <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i (<span class="hljs-number"><span class="hljs-number">4</span></span>) [<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> -] # (<span class="hljs-number"><span class="hljs-number">59</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> k (<span class="hljs-number"><span class="hljs-number">10</span></span>) = # (<span class="hljs-number"><span class="hljs-number">58</span></span>) [<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> +] <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i (<span class="hljs-number"><span class="hljs-number">4</span></span>)</code> </pre><br>  In parentheses are the indices where local variables or registers are located (indices are calculated at compile time).  The information collected by the compiler on all local variables (including temporary ones - registers) allows us to calculate the maximum size of the stack required to perform this function.  When the function starts, it saves the top of the stack and reserves the stack size specified by the compiler.  Indexes to registers (local variables) are used as relative offsets from the stored top of the stack, which allows you to make recursive function calls without any difficulty. <br><br><h2>  Calling a function in a registered VM </h2><br>  In order to call a function, ObjectScript reserves a continuous sequence of registers into which it places function arguments.  Then the function itself is called with information about where the first argument begins (the beginning of the sequence) and the number of values ‚Äã‚Äãin the sequence.  The first argument becomes the top of the stack for the new function, and the arguments are already at the required offsets in the stack and become its local variables.  An example of what it looks like when calling a function with three parameters: <br><br><pre> <code class="javascript hljs"> func(i, k - x*y * (z + i), j*k)</code> </pre><br>  ObjectScript compiles to: <br><br><pre> <code class="hljs go"> begin call move: # (<span class="hljs-number"><span class="hljs-number">59</span></span>) = <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(11)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move</span></span></span><span class="hljs-function">: # </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(60)</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">const</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">null</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(-1)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move</span></span></span><span class="hljs-function">: # </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(61)</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(4)</span></span></span><span class="hljs-function"> # </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(63)</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(7)</span></span></span><span class="hljs-function"> [</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">operator</span></span></span><span class="hljs-function"> *] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(8)</span></span></span><span class="hljs-function"> # </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(64)</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(9)</span></span></span><span class="hljs-function"> [</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">operator</span></span></span><span class="hljs-function"> +] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(4)</span></span></span><span class="hljs-function"> # </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(63)</span></span></span><span class="hljs-function"> = # </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(63)</span></span></span><span class="hljs-function"> [</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">operator</span></span></span><span class="hljs-function"> *] # </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(64)</span></span></span><span class="hljs-function"> # </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(62)</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">k</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(10)</span></span></span><span class="hljs-function"> [</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">operator</span></span></span><span class="hljs-function"> -] # </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(63)</span></span></span><span class="hljs-function"> # </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(63)</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">j</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(5)</span></span></span><span class="hljs-function"> [</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">operator</span></span></span><span class="hljs-function"> *] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">k</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(10)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">call</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-function"> 59, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">params</span></span></span><span class="hljs-function"> 5</span></span></code> </pre><br>  The function starts with a sequence of five values, starting with index 59. The first two values ‚Äã‚Äãare service parameters, namely, 59 is the function itself, 60 is this for the function (in this case, null): <br><br><pre> <code class="hljs go"> move: # (<span class="hljs-number"><span class="hljs-number">59</span></span>) = <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(11)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move</span></span></span><span class="hljs-function">: # </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(60)</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">const</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">null</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(-1)</span></span></span></span></code> </pre><br>  Next, the parameters themselves are passed, they are located in registers 61 to 63. The first parameter is just the variable <code>i</code> , it is copied to register 61: <br><br><pre> <code class="hljs objectivec"> move: <span class="hljs-meta"><span class="hljs-meta"># (61) = var i (4)</span></span></code> </pre><br>  The second parameter is the result of the mathematical operations <code>k - x*y * (z + i)</code> , it is stored in register 62: <br><br><pre> <code class="hljs swift"> # (<span class="hljs-number"><span class="hljs-number">63</span></span>) = <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x (<span class="hljs-number"><span class="hljs-number">7</span></span>) [<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> *] <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> y (<span class="hljs-number"><span class="hljs-number">8</span></span>) # (<span class="hljs-number"><span class="hljs-number">64</span></span>) = <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> z (<span class="hljs-number"><span class="hljs-number">9</span></span>) [<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> +] <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i (<span class="hljs-number"><span class="hljs-number">4</span></span>) # (<span class="hljs-number"><span class="hljs-number">63</span></span>) = # (<span class="hljs-number"><span class="hljs-number">63</span></span>) [<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> *] # (<span class="hljs-number"><span class="hljs-number">64</span></span>) # (<span class="hljs-number"><span class="hljs-number">62</span></span>) = <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> k (<span class="hljs-number"><span class="hljs-number">10</span></span>) [<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> -] # (<span class="hljs-number"><span class="hljs-number">63</span></span>)</code> </pre><br>  The third parameter ( <code>j*k</code> ) is stored in register 63: <br><br><pre> <code class="hljs swift"> # (<span class="hljs-number"><span class="hljs-number">63</span></span>) = <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> j (<span class="hljs-number"><span class="hljs-number">5</span></span>) [<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> *] <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> k (<span class="hljs-number"><span class="hljs-number">10</span></span>)</code> </pre><br>  Now the sequence is completely ready and the function can be called. <br><br><h2>  Where else is the register virtual machine used </h2><br>  Register VM is also used in Lua 5.0 and higher, in quakec (there was such a scripting programming language for quake 1 and numerous ports), there are register VMs for Java (for example, Dalvik VM).  Formally, any program in C ++ / C and other languages ‚Äã‚Äãthat is compiled into machine code uses the register model for internal operations and the stack for calling functions. <br><br><h2>  Total </h2><br>  The new <b>ObjectScriptScript</b> (VM3) <b>Register Virtual Machine has</b> become faster by a third of the previous VM2 stack and has fewer commands, a total of 36 vs. 111 in VM2.  A smaller number of commands greatly simplifies the VM and increases the chances of implementing JIT when necessary. <br><br>  The stack is used for local variables of functions, providing the possibility of a recursive call.  The required stack size is reserved once when the function is called, the VM3 commands themselves do not reallocate the stack. <br><br>  The stack is also used in the ObjectScript API to simplify integration with custom code.  ObjectScript API remained unchanged and is fully compatible with the previous version. <br><br><h2>  Continuation </h2><br>  In the next part, we will discuss other innovations that appeared in ObjectScript, for example, the factorial function can be written as follows: <br><br><pre> <code class="javascript hljs">print <span class="hljs-string"><span class="hljs-string">"factorial(10) = "</span></span> .. {|a| a &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span> ? <span class="hljs-number"><span class="hljs-number">1</span></span> : a * _F(a<span class="hljs-number"><span class="hljs-number">-1</span></span>)}(<span class="hljs-number"><span class="hljs-number">10</span></span>)</code> </pre><br>  will output: <br><br><pre> <code class="javascript hljs">factorial(<span class="hljs-number"><span class="hljs-number">10</span></span>) = <span class="hljs-number"><span class="hljs-number">3628800</span></span></code> </pre><br>  and many others  other <br><br>  Other relevant ObjectScript articles: <br><br><ul><li>  <a href="http://habrahabr.ru/post/154221/">ObjectScript API, integration with C ++.</a>  <a href="http://habrahabr.ru/post/154221/">Part 4: Connecting Custom Classes and Functions in C ++</a> </li><li>  <a href="http://habrahabr.ru/post/153021/">ObjectScript API, integration with C ++.</a>  <a href="http://habrahabr.ru/post/153021/">Part 3: Connecting a Module with C ++ Functions</a> </li><li>  <a href="http://habrahabr.ru/post/152813/">ObjectScript API, integration with C ++.</a>  <a href="http://habrahabr.ru/post/152813/">Part 2: executing a script on OS from C ++</a> </li><li>  <a href="http://habrahabr.ru/post/152797/">ObjectScript API, integration with C ++.</a>  <a href="http://habrahabr.ru/post/152797/">Part 1: working with the stack, calling OS functions from C ++</a> </li><li>  <a href="http://habrahabr.ru/post/153455/">ObjectScript is a new programming language, faster than PHP and JS</a> </li><li>  <a href="http://habrahabr.ru/post/152289/">ObjectScript - a new programming language</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/157489/">https://habr.com/ru/post/157489/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../157477/index.html">Account without registration</a></li>
<li><a href="../157481/index.html">Features of working with Apple push notification service</a></li>
<li><a href="../157483/index.html">Procurement "Import-Export"</a></li>
<li><a href="../157485/index.html">Photos jobs habrovchan</a></li>
<li><a href="../157487/index.html">Elon Musk. Mission to mars</a></li>
<li><a href="../157491/index.html">Jottacloud cloud storage</a></li>
<li><a href="../157493/index.html">What should a student do? Steve Ballmer will answer - online broadcast of Student Day, 10:00</a></li>
<li><a href="../157495/index.html">A large collection of lessons on creating CSS-buttons</a></li>
<li><a href="../157503/index.html">Finalists of the Technovations 2012 Cup</a></li>
<li><a href="../157505/index.html">We slow down the execution of queries in PostgreSQL</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>