<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Experiment in Yandex: how robots help test services</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The robot can not harm humans 
 or by their inaction to allow 
 so that the man was harmed. 
 Isaac Asimov 
 I am engaged in Yandex testing and I want...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Experiment in Yandex: how robots help test services</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  <i>The robot can not harm humans</i> <i><br></i>  <i>or by their inaction to allow</i> <i><br></i>  <i>so that the man was harmed.</i> <i><br></i>  <i>Isaac Asimov</i> </blockquote><br>  I am engaged in Yandex testing and I want to tell you about one of our experimental project.  Within its framework, we have created a fully automatic tool for functional testing of web interfaces - the Robotester.  Our robot satisfies the first law of robotics: it does not harm a person and does not remain inactive when he finds a bug that can create problems for people. <br><br> <a href="http://habrahabr.ru/company/yandex/blog/182976/"><img src="https://habrastorage.org/getpro/habr/post_images/c14/6d3/a1d/c146d3a1d1a55b70a8d04d529bf821e2.png" width="450" height="267" alt="The robot itself is looking for errors"></a> <br><br>  We thought that a number of test robots could be used on a par with people, and they would promptly and clearly report his problems.  Robots never rest and make it so that as few people as possible collide with the error. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We really liked this idea, and we started to implement it. <br><a name="habracut"></a><br><h4>  About functional testing </h4><br>  The easiest way to check a site for any kind of bugs is to give a group of people a task to simulate user behavior and fix the errors found.  But this solution has flaws.  For example, you have to repeat the process with each release and hire more testers who will perform routine operations. <br><br>  To put yourself in the place of a highly qualified manual tester, open the <a href="">Market advanced search page</a> .  Start choosing a laptop while checking that the layout blocks do not move anywhere, all the page elements are loaded, and after filling out the form, you are taken to the page with the list of laptops, and you do not receive a 404 error.  We call this kind of errors common.  Now imagine that you need to check all of the Yandex services for them.  It's getting scary. <br><br>  But 404 and 404 in Africa, and js a mistake, whatever the service, is an error, NaN can neither be the price of a product, nor the distance from point A to point B. This class of errors is sufficiently uniform for all services.  The process of testing them can and should be automated, and then scaled up, which is very difficult to do with qualified personnel. <br><br>  Autotests can partially cope with such problems: once you have written, you can run them whenever you want.  But autotests need not only to write, but also to support.  And we decided to go further and manual testing, and autotests. <br><br>  The robot, which should test services itself, had to be taught the following: <br><br><ol><li>  Crawl sites by both links and forms. </li><li>  Recognize page elements and interact with them. </li><li>  Generate and execute test scripts. </li><li>  Catch errors </li></ol><br><br><h4>  Crawling sites </h4><br>  This item is closely related to the recognition of elements: if we do not understand that we need to enter the name of the city in the text field, then we most likely will not be able to go to the next page and fully go around the whole site.  Such technologies as WebDriver, PhantomJS, etc. are well known in forms testing. <br><br>  It should be said that there is only one crawler that can bypass ajax-sites - <a href="http://crawljax.com/">CrawlJax</a> .  It operates with all the elements, but does not understand them at all, so for at least a little complicated site it works insanely long.  At first we wanted to make a ‚Äúbrain‚Äù for this robot, but we realized that it would have to be significantly reworked for our needs.  Therefore, we decided to make your product. <br><br>  We use both ‚Äústatic‚Äù crawling and ‚Äúdynamic‚Äù.  In the first case, we set the necessary cookies (region, userid) and follow the links.  In the second, we interact with the form, go to another page or to another state, which is obtained as a result of the activation of a new input field. <br><br><h4>  Recognition of page elements </h4><br>  The robot must simulate user actions, so it needs to interact with elements of web pages as well as people do.  If there is a drop-down list in front of him, then there are no problems, he needs to choose one of the options.  Also, there will be no problems with the checkbox and radio button.  Difficulties arise with input fields of two types: <br><br><ol><li>  Complex input fields with javascript; </li><li>  Fields of text input. </li></ol><br>  So far, our robot does not know how to interact with an arbitrary field that is being processed by JavaScript, since quite complicated logic can be ‚Äúsewn up‚Äù in such a field.  We needed to teach the robot to fill in the fields for date selection, and we created a fairly universal module for interacting with such fields.  Now Robotster can choose dates on all Yandex pages. <br><br>  I would like to dwell on the second paragraph.  Suppose we have a text entry field.  It is clear that there are fields where you can enter almost any text (for example, the search string on <a href="http://ya.ru/">ya.ru</a> ).  But in many cases, entering arbitrary text leads to the fact that a significant part of the functionality is not used.  Entering incorrect data, in some cases, the robot will not only be able to go to the next page, but also activate all the input fields on the current one. <br><br>  For example, consider a flight search form on the Yandex.Schedules page.  If for some reason the robot decides that it is necessary to enter some popular search query into the first field, and the name of a certain profession into the second field, then nothing good will come of it. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/11e/f26/b72/11ef26b72ac3619244bca3978d0e94f0.png" width="640" height="126" alt="Error entering data in form fields"><br><br>  If in the search form the robot makes a similar error, then we will never see (and never check) the search results.  If in the registration form, we will never get to the page of a successfully registered user, etc.  Moreover, if the fields are filled in the wrong way, in some forms you will not even be able to click a button, clicking on which people should go to a new page or see the old one in a new state. <br><br>  How can a robot understand what needs to be entered into a certain input field?  Similar tasks also arise when developing search robots that are indexed by <a href="http://en.wikipedia.org/wiki/Deep_Web">deep web</a> .  The term ‚Äúdeep web‚Äù is used to denote that part of information on the Internet that is ‚Äúhidden behind forms‚Äù - to access it, you must fill in some search form.  There are several approaches to solving this problem, you can read about them, for example, <a href="http://www.sigmod.org/publications/sigmod-record/0909/publications/1003/p33.survey.khare.pdf">here</a> , <a href="http://christian.schallhart.net/publications/2011--wims--real-understanding-for-real-estate-forms.pdf">here</a> or <a href="http://www2012.wwwconference.org/proceedings/proceedings/p829.pdf">here</a> . <br><br>  We will talk about how this is solved in our testing.  But first, we note that although in our case, and in the case of search robots, it is necessary to determine the type of the text field, there are important differences in our tasks: <br>  Search robots bypass all Internet sites.  These sites have very different layouts, and the text is written in dozens of different languages.  We are building a robot only for some pages of Yandex. <br><br>  For the search robot, on the other hand, you just need to maximize field recognition.  Already some search results can be obtained if 90% of the fields are correctly recognized in the form.  But we are not satisfied with the level of recognition below the "absolute" 100%.  In addition, we work not only with search forms.  Consequently, in order to create a robot that would qualitatively imitate human behavior on the page and send correct information, we had to develop the most accurate recognition algorithm.  Universality, we were ready to sacrifice. <br><br>  Our algorithm is based on a type dictionary.  The dictionary is as follows: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b79/410/a31/b79410a31bce9441cc498a3e81bc9020.png" width="454" height="500" alt="Site recognition algorithm built on a type dictionary"><br><br>  As a result, the recognition of the field type is reduced to the choice of one of the ready-made types contained in the dictionary (at the moment we have 27 of them).  To do this, for each type of input, we have formed a list of keywords.  The list included those that, being present next to the field in the interface, increase the likelihood that it belongs to this type.  Of course, not all keywords are equally useful.  Each keyword is associated weight, but more on that later.  The algorithm can be divided into several parts. <br><br>  <b>Segmentation.</b>  We divide the interface into parts corresponding to the input fields. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f57/f36/72d/f57f3672dfbebdea5cceebeeab48d5da.png" width="640" height="144" alt="Input field segmentation"><br><br>  In it, we are interested in the text and its location relative to the input field that we are studying.  But, firstly, it is not very clear what a ‚Äútext‚Äù is - only visible text may not be enough, but at once it is bad to take the entire text of the layout, because it can contain a lot of garbage.  Therefore, we use both the one and the other text, but with different weights. <br><br>  The task of extracting the neighboring (visible or invisible) text we solve as follows: <br><br><ul><li>  element.innerHTML + = "@ # @ $ @ #!" </li><li>  extract (visible / invisible) text from the entire form </li><li>  element.innerHTML- = "@ # @ $ @ #!" </li></ul><br>  Further we find in the received text the substring "@ # @ $ @ #!".  It will symbolize the position of our input field in the received text.  We extract the text using jQuery. <br><br>  <b>Putting down the scales.</b>  The resulting text is divided into words, after which each word appears weight.  It depends on whether the word is visible or not, and on the distance between it and the input field. <br><br>  <b>Type selection.</b>  The keywords for the type ‚Äúprice‚Äù in abundance are located next to the price entry field. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b79/410/a31/b79410a31bce9441cc498a3e81bc9020.png" width="260" height="539"><br><br>  The algorithm for evaluating the relevance of the type is as follows.  First, words are ordered by weight in descending order.  We will call this list X list. Now we will consider the weights of the field types themselves.  Each type has its own set of words with weights - it will be a list of Y. We intersect this set with a list of X and get a list of Z. Weights of words in the list of Z will be obtained by multiplying the weights in lists of X and Y. Next we need to get rid of situations in which weight of the type is influenced by "far" words - located in another part of the page.  Therefore, let's divide the word in the list Z with the number i by 2 <sup>i</sup> , then add all the weights of the words in the list Z - this will be considered a weight of this type. <br><br>  As already noted, an important element of this method is a set of keywords with weights for each type.  Weights must be chosen so that the maximum total weight is in the "correct" field type.  How to choose such weight?  There are many ways, we have chosen a simple "fit."  That is, we set the weights in some way, and then corrected them in a situation where the robot did not correctly recognize the type of some field that we needed to process.  A special interface was created for learning the robot, and if the operator indicated that the robot mistakenly chose the type ‚ÄúPrice‚Äù based on the word ‚Äúfrom‚Äù (and it was necessary to choose the type ‚ÄúAddress‚Äù based also on the word ‚Äúroute‚Äù), then the weight the words ‚Äúfrom‚Äù for the type ‚ÄúPrice‚Äù decreased, and the weight of the word ‚Äúroute‚Äù for the type ‚ÄúAddress‚Äù increased. <br><br>  However, the universality of this approach is quite low.  An increase in the number of tested services will inevitably lead to a situation where we will not be able to manually select weights so that they work on all sites.  Then it‚Äôs time to come up with something new: for example, use machine learning based on the ‚Äúcorrect‚Äù field types that the operator sets for some pages.  Actually, initially we did not think that such a simple algorithm would suit us, but, as it turned out, it completely fits our needs - at the moment the robot successfully recognizes all fields of all forms for which we launch it.  These are 5-6 different Yandex services. <br><br><h4>  About the results </h4><br>  Robotster helps testers Yandex.Market for more than five months.  12% of the bugs found during this time in the production environment belong to the robot.  He does not sleep, does not eat (hardware time, he eats), and most importantly - he is alone, but he has a lot of it.  Thanks to 32 cores!  I want to believe that in the testing routine manual labor will be replaced by mechanical. <br><br>  Of course, such robots will not take away the work of manual testers and auto testers, because it can be difficult to figure out the business logic and specifics of the service even to a person.  Just in the work of qualified personnel will be less routine, and in Internet services - fewer errors. <br><br>  While working on the robot, we had many other interesting tasks.  For example, I had to invent my own algorithm for crawling, since in a reasonable time it could not cope with the crawling of the Market‚Äôs mobile site containing tens of millions of pages.  Or, for example, the robot produced a lot of similar error messages.  We have developed a special reporting system in which similar errors are ‚Äúglued together‚Äù into one.  There are also interesting tasks that have not yet ‚Äúgotten their hands‚Äù - for example, how to distinguish typos in user comments from functional errors that are noticeable in the text.  We will tell about all this in the following series. </div><p>Source: <a href="https://habr.com/ru/post/182976/">https://habr.com/ru/post/182976/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../182964/index.html">5 rules for the layout of email-letters from Pechkin</a></li>
<li><a href="../182966/index.html">Facebook - from the server to the network of data centers for 8 years</a></li>
<li><a href="../182968/index.html">The third issue of the magazine TsODy.RF</a></li>
<li><a href="../182970/index.html">How to ensure proper intersection of dynamic library boundaries using custom smart pointer removal tools</a></li>
<li><a href="../182974/index.html">The evolution of design with the advent of adaptive design</a></li>
<li><a href="../182978/index.html">Flat design: why did the design go flat?</a></li>
<li><a href="../182980/index.html">Labyrinths of Bilbo Beggins</a></li>
<li><a href="../182986/index.html">How to become an entrepreneur? Four letters: JFDI</a></li>
<li><a href="../182988/index.html">Netherlands intelligence had access to PRISM data and implemented agents in IT companies</a></li>
<li><a href="../182990/index.html">Belarus is no longer a white spot on HERE maps</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>