<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Android WebView: actual problems and their solutions</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At the last meeting, AndroidDevs Meetup were made by several developers from the ICQ messenger team. My report was dedicated to Android WebView. For e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Android WebView: actual problems and their solutions</h1><div class="post__text post__text-html js-mediator-article">  At the last meeting, AndroidDevs Meetup were made by several developers from the ICQ messenger team.  My report was dedicated to Android WebView.  For everyone who could not come to the meeting, I publish an article here based on the speech.  I will go on tops, large strokes.  Deep technical details and a lot of code will not give.  If you are interested in the details, click the link at the end of the post to download the application, specially written as an illustration, and see everything with examples. <br><br><h1>  What is webview? </h1><br>  <a href="http://developer.android.com/reference/android/webkit/WebView.html">WebView</a> is a component of the Android platform that allows you to embed web pages into Android applications.  In essence, this is an embedded browser.  Using WebView about a year ago, we decided to create an <a href="http://apps.icq.com/doc/">ICQ Web API</a> for integrating web applications into our instant messenger.  What is a web application?  In essence, this is an HTML page that contains JavaScript and runs inside ICQ.  Using the ICQ Web API, web pages via JavaScript can give ICQ different commands, for example, to send messages, open a chat, etc. <br><br><img src="https://habrastorage.org/files/200/78a/cab/20078acab2454a9d98b7aa93e542bcde.jpg"><br><a name="habracut"></a><br>  Here is how it looks in ICQ.  From the Applications item you can go to the list of applications.  This is not yet a WebView, to get into it, you need to select one of the applications.  Then we go directly to WebView, where the web application is downloaded from the network. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      How does it work technically?  WebView has the ability to inject Java code in JavaScript in a certain way.  JavaScript can invoke the code that we wrote and provided to it.  This is the opportunity on which the entire ICQ Web API is based. <br><br><img src="https://habrastorage.org/files/7c1/733/877/7c1733877b0642fda6317959966e358c.jpg"><br><br>  Here it is shown that WebView is working inside ICQ, there is an injected Java class between them, and applications from the network are loaded into WebView. <br><br>  So, JavaScript from WebView makes calls to ICQ ICQ code.  There are a large number of different challenges, and during the development process, there were many problems associated with the operation of this mechanism, which I will discuss later. <br><br><h1>  Problems with WebView </h1><br>  After starting the download, it is usually necessary to monitor this process: find out whether the download was successful, whether there were redirects, track download time and other things.  We will also talk about streams that use JavaScript and calls in Java, the mismatch between Java and JavaScript types, the behavior of Alerts in JavaScript, and the size of the transmitted data.  The solution for these problems will also be described further. <br><br><h1>  WebView Basics </h1><br>  Briefly about the basics of WebView.  Consider four lines of code: <br><br><pre><code class="javascript hljs">WebView webView = (WebView) findViewById(R.id.web_view); webView.loadUrl(<span class="hljs-string"><span class="hljs-string">"http://www.example.com"</span></span>); webView.setWebViewClient(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebViewClient() {‚Ä¶} ); webView.setWebChromeClient(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebChromeClient() {‚Ä¶} );</code> </pre> <br>  Here we see that we get a WebView and load example.com into it by calling WebView.loadURL ().  There are two important classes in Android: WebViewClient and WebChromeClient, which interact with WebView.  What are they needed for?  WebViewClient is required to control the page loading process, and WebChromeClient is required to interact with this page after it has been successfully loaded.  Before the page is finished loading, WebViewClient works, and after it, WebChromeClient.  As you can see in the code, in order to interact with the WebView, we need to create our own instances of these classes and pass them to WebView.  Further, WebView, under certain conditions, causes different methods that we redefine in our instances, and so we will learn about events in the system. <br><br>  The most important methods that WebView calls the WebViewClient and WebChromeClient instances we created: <br><table><tbody><tr><th>  WebViewClient </th><th>  WebChromeClient </th></tr><tr><td>  onPageStarted () </td><td>  openFileChooser (), onShowFileChooser () </td></tr><tr><td>  shouldOverrideUrlLoading () </td><td>  onShowCustomView (), onHideCustomView () </td></tr><tr><td>  onPageFinished (), onReceivedError () </td><td>  onJsAlert () </td></tr></tbody></table>  I will talk about the purpose of all these methods a little later, although much is already clear from the names themselves. <br><br><h1>  Control of page loading in WebView </h1><br>  After we give the WebView command to load the page, the next step is to find out the result of the execution: whether the page has loaded.  From the point of view of official Android documentation, everything is simple.  We have a WebViewClient.onPageStarted () method that is called when the page starts loading.  In the case of a redirect, WebViewClient.shouldOverrideUrlLoading () is called, if the page is loaded - WebViewClient.onPageFinished (), if not loaded - WebViewClient.onReceivedError ().  Everything seems logical.  How does this actually happen? <br><br>  EXPECTATION: <br><ol><li>  onPageStarted ‚Üí shouldOverrideUrlLoading (if redirect) ‚Üí onPageFinished / onReceivedError </li></ol><br>  REALITY: <br><ol><li>  onPageStarted ‚Üí <font color="red">onPageStarted</font> ‚Üí onPageFinished </li><li>  onPageStarted ‚Üí <font color="red">onPageFinished</font> ‚Üí onPageFinished </li><li>  <font color="red">onPageFinished</font> ‚Üí onPageStarted </li><li>  <font color="red">onReceivedError</font> ‚Üí onPageStarted ‚Üí onPageFinished </li><li>  onReceivedError ‚Üí onPageFinished (no onPageStarted) </li><li>  onPageFinished (no onPageStarted) </li><li>  shouldOverrideUrlLoading ‚Üí <font color="red">shouldOverrideUrlLoading</font> </li></ol><br>  In fact, everything is always different and depends on the specific device: onPageStarted (), onPageFinished () and other methods may be called twice, all methods may be called in a different order, and some may not be called at all.  Especially often similar problems arise on Samsung and Google Nexus.  This problem has to be solved by adding additional checks to our instance of the WebViewClient class.  When it starts to work, we save the URL and then check that the download is made from that URL.  If it is completed, then we check for errors.  Since the code is large, I will not give it.  I propose to look independently in the example, the link to which will be at the end. <br><br><h1>  Injecting Java code into javascript </h1><br>  <i>Sample Java code:</i> <br><br><pre> <code class="java hljs">WebView webView = (WebView) findViewById(R.id.web_view); webView.getSettings().setJavaScriptEnabled(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); mWebView.addJavascriptInterface(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyJavaInterface(), <span class="hljs-string"><span class="hljs-string">"test"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyJavaInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@android</span></span>.webkit.<span class="hljs-function"><span class="hljs-function">JavascriptInterface </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getGreeting</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Hello JavaScript!"</span></span>; } }</code> </pre><br>  <i>JavaScript code example:</i> <br><br><pre> <code class="javascript hljs">&lt;input value=<span class="hljs-string"><span class="hljs-string">"Click"</span></span> onclick=<span class="hljs-string"><span class="hljs-string">"javascript:alert(test.getGreeting());"</span></span>/&gt;</code> </pre><br>  Here is an example of injecting Java code into JavaScript.  A short Java class, MyJavaInterface, is created, and it has a single getGreeting () method.  Please note that this method is marked with the @JavaScriptInterface marking interface - this is important.  By calling the WebView.addJavascriptInterface () method, we are forwarding this class to the WebView.  Below we see how it can be accessed from JavaScript by calling test.getGreeting ().  The important point here is the name test, which later in JavaScript will be used as an object through which you can make calls to our Java code. <br><br>  If we set breakpoint on the return string ‚ÄúHello JavaStript!‚Äù And see the name of the thread in which the call was received, what kind of stream will it be?  This is not a UI stream, but a special Java Bridge thread.  Therefore, if we want to manipulate the UI when calling some Java methods, then we need to ensure that these operations are passed to the UI stream ‚Äî use handlers or any other method. <br><br>  The second point: the Java Bridge stream cannot be blocked, otherwise JavaScript in WebView will simply stop working, and no user actions will have a response.  Therefore, if you need to do a lot of work, tasks should also be sent to other threads or services. <br><br><h1>  Java type mismatch in javascript </h1><br>  When we call some methods written in Java and injected into JavaScript, as shown above, the problem of inconsistencies between Java and JavaScript types arises.  This table lists the basic rules for mapping between type systems: <br><table><tbody><tr><th colspan="2">  Java -&gt; JavaScript </th><th colspan="2">  Javascript -&gt; java </th></tr><tr><td>  byte, short, char, int, long, float, double </td><td>  Number </td><td>  Number </td><td>  Byte, short, int, long, float, double (not Integer, Byte, Short, Long, Float, Double and not char) </td></tr><tr><td>  boolean </td><td>  Boolean </td><td>  Boolean </td><td>  boolean (not boolean) </td></tr><tr><td>  Boolean, Integer, Long, Character, Object </td><td>  Object </td><td>  Array, Object, Function </td><td>  null </td></tr><tr><td>  String </td><td>  String (Object) </td><td>  String </td><td>  String (not char []) </td></tr><tr><td>  char [], int [], Integer [], Object [] </td><td>  undefined </td><td>  undefined </td><td>  null </td></tr><tr><td>  null </td><td>  undefined </td><td>  null </td><td>  null </td></tr></tbody></table><br>  The most basic thing to notice here is that object wrappers are not transmitted.  And of all Java objects in JavaScript, only String is mapped.  Arrays and null in java are converted to undefined in javascript. <br><br>  With the transfer in the opposite direction, from JavaScript to Java, there are also nuances.  If you call a method that has elementary types as parameters, then you can pass number there.  And if among the parameters of the method there are not elementary types, but, say, object wrappers, such as Integer, then this method will not be called.  Therefore, you only need to use Java elementary types. <br><br><h1>  Sizes of data transferred between java and javascript </h1><br>  Another major problem is the amount of data transferred between Java and JavaScript.  If a sufficiently large amount of data is transferred (for example, pictures) from JavaScript to Java, then if an OutOfMemory error occurs, you will not be able to catch it.  The app just crashes.  Here is an example of what can be seen in logcat in this case: <br><br><pre> <code class="bash hljs">Process com.estrongs.android.pop (pid 6941) has died Process com.google.android.youtube (pid 24613) has died Process kik.android (pid 3022) has died Process com.doeasyapps.optimize (pid 30743) has died Process com.sandisk.mz (pid 31340) has died WIN DEATH: Window{3fc4769b u0 mc.test/mc.test.MainActivity} WIN DEATH: Window{17a5c850 u0 mc.test/mc.test.DataSizeTestActivity} Process mc.test (pid 16794) has died Force removing ActivityRecord{215171e4 u0 mc.test/.DataSizeTestActivity t406}: app died, no saved state</code> </pre><br>  As you can see, if OutOfMemory occurs in the application, then various other applications running on the device will crash.  In the end, closing all that is possible, Android comes to our application, and, since it is in the foreground, closes it last.  Once again I want to remind you that we will not receive any exception, the application will simply fall.  To prevent this, it is necessary to limit the size of the transmitted data.  Much depends on the device.  On some gadgets, it turns out to transfer 6 megabytes, on some 2-3.  For ourselves, we chose a limit of 1 megabyte, and this is enough for most devices.  If you need to transfer more, then the data will have to be cut into chunks and transferred in parts. <br><br><h1>  Javascript alerts </h1><br>  By default, the Alert dialog in WebView does not work.  If you load an HTML page with JavaScript and perform alert ('Hello'), then nothing happens.  To make it work, you need to define your WebChromeClient instance, override the WebChromeClient.onJSAlert () method and call super.onJSAlert () in it.  This is enough for the Alerts to work. <br><br><pre> <code class="javascript hljs">WebView webView = (WebView) findViewById(R.id.web_view); webView.getSettings().setJavaScriptEnabled(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); webView.setWebChromeClient(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebChromeClient() { @Override public boolean onJsAlert(....) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onJsAlert(view, url, message, result); } }</code> </pre><br><h1>  Handling device orientation changes </h1><br>  Another serious problem is related to portrait and landscape orientation.  If you change the orientation of the device, then by default the Activity will be recreated.  In this case, all the views that are attached to it will also be recreated.  Imagine the situation: there is a WebView, which is loaded with some kind of game.  The user reaches level 99, turns the device, and the WebView instance with the game is recreated, the page loads again, and it is again at the first level.  To avoid this, we use manual processing to change the device configuration.  In principle, this thing is known and described in the <a href="http://developer.android.com/guide/topics/resources/runtime-changes.html">official documentation</a> .  To do this, it is enough to register the parameter configChanges in the section Activate in AndroidManifest.xml. <br><br><pre> <code class="java hljs">&lt;activity android:name=<span class="hljs-string"><span class="hljs-string">".WebViewActivity"</span></span> android:configChanges=<span class="hljs-string"><span class="hljs-string">"orientation|screenSize"</span></span>&gt; &lt;/activity&gt;</code> </pre><br>  This will mean that we ourselves handle the change of orientation in the activity.  If the orientation changes, we receive a call to Activity.onConfigurationChange () and can change some resources programmatically.  But usually only WebView itself stretched across the entire screen has activity with WebView, and there‚Äôs nothing to do there.  It just redraws and everything continues to work normally.  Thus, the installation of configChanges allows you to not recreate the Activity, and all the Views that are present in it will retain their state. <br><br><h1>  Fullscreen Media Player </h1><br>  If a media player is embedded in a web page, then often there is a need to ensure that it can work in full screen mode.  For example, the <a href="https://developers.google.com/youtube/iframe_api_reference">youtube</a> media player <a href="https://developers.google.com/youtube/iframe_api_reference">can work inside a web page in an iframe html tag</a> , and it has a button for switching to full-screen mode.  Unfortunately, in WebView by default it does not work.  To make it work, you need to do a few manipulations.  In the xml layout in which the WebView is located, we place an additional FrameLayout.  This is a container that is stretched to full screen and in which the View with the player will be located: <br><br><pre> <code class="java hljs">&lt;FrameLayout android:layout_width=<span class="hljs-string"><span class="hljs-string">"match_parent"</span></span> android:layout_height=<span class="hljs-string"><span class="hljs-string">"match_parent"</span></span>&gt; &lt;WebView android:id=<span class="hljs-string"><span class="hljs-string">"@+id/web_view"</span></span> android:layout_width=<span class="hljs-string"><span class="hljs-string">"match_parent"</span></span> android:layout_height=<span class="hljs-string"><span class="hljs-string">"match_parent"</span></span>/&gt; &lt;FrameLayout android:id=<span class="hljs-string"><span class="hljs-string">"@+id/fullscreen_container"</span></span> android:layout_width=<span class="hljs-string"><span class="hljs-string">"match_parent"</span></span> android:layout_height=<span class="hljs-string"><span class="hljs-string">"match_parent"</span></span> android:visibility=<span class="hljs-string"><span class="hljs-string">"gone"</span></span>/&gt; &lt;/FrameLayout&gt;</code> </pre><br>  And then in our WebChromeClient instance we will override several methods: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onShowCustomView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v, CustomViewCallback c)</span></span></span><span class="hljs-function"> </span></span>{ mWebView.setVisibility(View.GONE); mFullScreenContainer.setVisibility(View.VISIBLE); mFullScreenContainer.addView(view); mFullScreenView = v; mFullscreenViewCallback = c; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onHideCustomView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ mFullScreenContainer.removeView(mFullScreenView); mFullscreenViewCallback.onCustomViewHidden(); mFullScreenView = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; mWebView.setVisibility(View.VISIBLE); mFullScreenContainer.setVisibility(View.GONE); }</code> </pre><br>  The system calls WebChromeClient.onShowCustomView () when the user presses the full screen button on the player.  onShowCustomView () takes a View, which the player itself represents.  This View is inserted into the FullScreenContainer and is made visible, and the WebView is hidden.  When the user wants to return from full-screen mode, the WebChromeClient.onHideCustimView () method is called and the opposite operation is performed: display the WebView and hide FullScreenContainer. <br><br><h1>  Input type = ‚Äùfile‚Äù </h1><br>  Web developers know that this container is used on web pages so that the user can select a file and upload it to the server, or show it on the screen.  For this container to work in WebView, we need to override the WebChromeClient.openFileChooser () method.  In this method there is a certain callback to which you need to transfer the file selected by the user.  There is no additional functionality by itself <code>/&gt;</code> .  The file selection dialog we need to provide.  That is, we can open any standard Android picker in which the user selects the desired file, get it, for example, via onActivityResult (), and pass it to the callback of the openFileChooser () method. <br><br>  <i>JavaScript code example:</i> <br><br><pre> <code class="javascript hljs">&lt;input type=<span class="hljs-string"><span class="hljs-string">"file"</span></span> onchange=<span class="hljs-string"><span class="hljs-string">"onFaileSelected(event)"</span></span>/&gt;</code> </pre><br>  <i>Sample Java code:</i> <br><br><pre> <code class="java hljs">WebChromeClient myClient = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebChromeClient() { <span class="hljs-meta"><span class="hljs-meta">@SuppressWarnings</span></span>(<span class="hljs-string"><span class="hljs-string">"unused"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openFileChooser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ValueCallback&lt;Uri&gt; callback, String accept, String capture)</span></span></span><span class="hljs-function"> </span></span>{ callback.onReceiveValue(Uri.parse(<span class="hljs-string"><span class="hljs-string">"file://"</span></span> + getFileFromSomeProvider())); } }; WebView webView = (WebView) findViewById(R.id.web_view); webView.setWebChromeClient(myClient);</code> </pre><br><h1>  Detecting network status in javascript </h1><br>  JavaScript has a useful <a href="http://www.w3schools.com/jsref/obj_navigator.asp">Navigator</a> object.  It has an onLine field showing the status of the network connection.  If we have a network connection, in the browser this field is true, otherwise it is false.  For it to work correctly inside WebView, you need to use the WebView.setNetworkAvailable () method.  With it, we transmit the current network status, which can be obtained using a network broadcast receiver or in any other way that you track the network status in Android.  Do it all the time.  If the network status has changed, then you need to call WebView.setNetworkAvailable () again and transfer the actual data.  In JavaScript, we will get the current value of this property through Navigator.onLine. <br><br><h1>  Code examples </h1><br>  <a href="https://github.com/mc-android-developer/mc.presentation.webview">github.com/mc-android-developer/mc.presentation.webview</a> <br><br><h1>  Questions and answers </h1><br>  <b>Question:</b> There is a <a href="https://crosswalk-project.org/">CrossWalk</a> project - this is a third-party WebView implementation that allows using fresh Chrome on older devices.  Do you have any experience, have you tried to embed it? <br>  <b>Answer:</b> I have not tried.  At the moment we support Android since the 14th version and no longer focus on older devices. <br><br>  <b>Q:</b> How do you deal with artifacts that remain when drawing a WebView? <br>  <b>Answer:</b> We are not fighting with them, we tried - it didn't work out.  This does not happen on all devices.  We decided that this is not so blatant a problem in order to spend more resources on it. <br><br>  <b>Question:</b> Sometimes you need a WebView to attach to ScrollView.  It is ugly, but sometimes it is required by task.  This is discouraged, even banned somewhere, and after that shortcomings in work arise.  But still, sometimes it has to be done.  For example, if you draw WebView from above, and below it draw some kind of native component (which should be native according to the requirement), and all this should be done as a single ScrollView.  That is, first the user would look at the whole page, and then, if he wanted to, he would add up to these native components. <br>  <b>Answer:</b> Unfortunately, I cannot answer you, because I did not come across such a situation.  It is quite specific, and it‚Äôs hard for me to imagine when to put a WebView in a ScrollView. <br><br>  <b>Question:</b> There is a mail application.  There is a cap on top with recipients and everything else.  Even in this case, not everything will be smooth.  WebView has big problems when it tries to determine its size inside ScrollView. <br>  <b>Answer:</b> You can try to draw the designated part of the UI inside the WebView. <br><br>  <b>Question:</b> That is, to completely transfer all the logic from the native part to the WebView and leave these containers? <br>  <b>Answer:</b> Even, perhaps, the logic does not need to be transferred, it means the injection of Java classes.  Logic can be left and invoked through the injected class.  Only UI can be transferred to WebView. <br><br>  <b>Question:</b> You mentioned the games in the messenger.  Are they web applications? <br>  <b>Answer:</b> Yes, these are web pages with javascript inside the webview. <br><br>  <b>Question:</b> Do you do all this just to not rewrite the game natively? <br>  <b>Answer:</b> And for that too.  But the main idea is to allow third-party developers to create applications that can be integrated into ICQ, and with the help of this ICQ Web API to interact with the messenger. <br><br>  <b>Question:</b> So, these games can also be played via a web browser on a laptop? <br>  <b>Answer:</b> Yes.  It can be opened in a web browser, and we sometimes even debug them right in it. <br><br>  <b>Question:</b> And if Intent, let's say, throw this toy in Chrome, what problems will it have?  If you do not write your WebView, and use the services? <br>  <b>Answer:</b> The problem is that in our WebView we can provide an API through injecting a Java class, and using this API, the application can directly interact with ICQ, send it various commands.  Suppose a command to receive a username, to receive chats that are open for him, to send chat messages directly from ICQ.  That is, from Chrome to send messages directly to ICQ will not work.  In our case, all this is possible. <br><br>  <b>Question:</b> You mentioned that you are cutting data into pieces of one megabyte.  How do you collect them then? <br>  <b>Answer:</b> We are not doing this now, because we have no such need. <br><br>  <b>Question:</b> Enough one megabyte? <br>  <b>Answer:</b> Yes.  If the pictures are bigger, then we try to squeeze them.  I said that if such a need exists, then it may be a solution to cut and assemble later in Java. <br><br>  <b>Question:</b> How do you ensure the safety of applications in the sandbox?  Did I understand correctly that you need to call injected Java classes from a JavaScript application? <br>  <b>Answer:</b> Yes. <br><br>  <b>Question:</b> How will security be provided in this case, is access to some system functions prohibited? <br>  <b>Answer:</b> Right now, since the system is still quite young, we mainly use our own web applications and we completely trust them.  In the future, all applications that will come to us will be administered, the code will be viewed, for this a special Security Team is allocated.  In addition, a special system of permissions will be created, without which applications will not be able to access any information that is critical for the user. </div><p>Source: <a href="https://habr.com/ru/post/262167/">https://habr.com/ru/post/262167/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../262145/index.html">The rapid development of mobile advertising, Fallout Shelter for Android, CSR2 - and other news of the week for a mobile developer</a></li>
<li><a href="../262149/index.html">IT infrastructure of one state budget educational organization</a></li>
<li><a href="../262151/index.html">Compact installation of FreeBSD 10 for a certification authority</a></li>
<li><a href="../262155/index.html">Top 10 data mining algorithms in simple language</a></li>
<li><a href="../262163/index.html">Reliable storage and update of data in flash memory of STM32 and MSP430 microcontrollers</a></li>
<li><a href="../262169/index.html">Consulo: Running Java code on the .NET platform using IKVM.NET</a></li>
<li><a href="../262173/index.html">Build-Deploy-Test. Continuous integration</a></li>
<li><a href="../262175/index.html">Real-time data processing in AWS Cloud. Part 1</a></li>
<li><a href="../262177/index.html">Web file manager with integrated chickenpox</a></li>
<li><a href="../262179/index.html">How to beat Excluded Constraints with RubyGem</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>