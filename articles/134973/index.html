<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Connecting the HP LJ 1010/1015/1018/1020 printer in Linux Debian (Ubuntu) with CUPS 1.4 and higher</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When updating the CUPS version, there was a problem of its incompatibility with the loaded usbpl module, which is necessary for downloading the firmwa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Connecting the HP LJ 1010/1015/1018/1020 printer in Linux Debian (Ubuntu) with CUPS 1.4 and higher</h1><div class="post__text post__text-html js-mediator-article"> When updating the CUPS version, there was a problem of its incompatibility with the loaded usbpl module, which is necessary for downloading the firmware to the printer.  When they work simultaneously, there is a conflict on the usb bus (simultaneous access), which is reflected in the logs of the / var / log / syslog system as follows: <br> <code>----------------------- <br> Jul 1 02:18:57 kernel: [ 3115.009361] usb 1-2.5: usbfs: interface 0 claimed by usblp while 'usb' sets config #1 <br> -----------------------</code> <br>  The solution to this problem: <br>  - Download the module immediately after turning on the printer <br>  - Unload the module immediately after uploading filmware <br><br>  To do this, do the following: <br><a name="habracut"></a><br><br>  0) Turn off the printer <br>  1) Install the necessary packages <br><pre> <code class="bash hljs"> aptitude install cupsys gs-esp foomatic-bin foo2zjs cups-pdf</code> </pre><br>  2) Download the required filmware for the printer, convert it and place it in the appropriate folders: <br><pre> <code class="bash hljs"> wget http://foo2zjs.rkkda.com/firmware/sihp1018.tar.gz tar xvzf sihp1018.tar.gz arm2hpdl sihp1018.img &gt; sihp1018.dl cp sihp1018.dl /usr/share/foo2zjs/firmware cp sihp1018.img /usr/share/foo2zjs/firmware cp sihp1018.dl /lib/firmware/hp cp sihp1018.img /lib/firmware/hp</code> </pre><br>  3) Create a rule for udev device manager to load the module when the printer is turned on. <br><pre> <code class="bash hljs"> vi /etc/udev/rules.d/11-hplj10xx.rules</code> </pre><br>  Specify the Vid and Pid of your printer!  An example is given for 1018. <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#Own udev rule for HP Laserjet 1018 SUBSYSTEM=="usb", ENV{DEVTYPE}=="usb_device", ATTRS{idVendor}=="03f0", ATTRS{idProduct}=="4117", RUN+="modprobe usblp"</span></span></code> </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      4) Reboot the udev device manager <br><pre> <code class="bash hljs"> /etc/init.d/udev restart</code> </pre><br>  5) Edit the foo2zjs script that runs when the printer is detected (disable the usbpl kernel module immediately after downloading the firmware).  The file name depends on your printer model! (For 1000/1005/1018/1020 - / usr / sbin / hplj1018) <br><pre> <code class="bash hljs"> vi /usr/sbin/hplj1018</code> </pre><br>  we are looking for and adjusting the firmware download process <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># # Procedure to load a single device with firmware # load1() { _dev="$1" fw="$FWDIR/sihp$FWMODEL.dl" if [ ! -f "$fw" ]; then log "Missing HP LaserJet $MODEL firmware file $fw" log "...read foo2zjs installation instructions and run ./getweb $MODEL" return 1 fi log "loading HP LaserJet $MODEL firmware $fw to $_dev ..." # There is a timeout problem with udev and FC4, so spin it off. ( if cat $fw &gt; $_dev; then log "... download successful." sleep 15 rmmod usblp #  usblp log " ... kernel module usblp disable now... " else log "... download failed." fi ) &amp; return 0 } # # OK, now download firmware to any printers that need it # if [ "$DEV" != "" ]; then # # force downloading to a specific device # load1 "$DEV" elif [ -x $PRINTERID ]; then # # Sniff around for printers that need a firmware download # usblps=`find /dev/usb -name 'lp*'`" "`find /dev -name 'usblp*'` for dev in $usblps; do status=`$PRINTERID $dev 2&gt;/dev/null | grep -y "hp LaserJet $MODEL"` if [ "$status" != "" ]; then # This is a LaserJet 100x chmod 0666 $dev status=`$PRINTERID $dev | grep 'FWVER'` if [ "$status" = "" ]; then # Firmware is not yet loaded load1 "$dev" else log "HP LaserJet $MODEL firmware already loaded into $dev" sleep 15 rmmod usblp #  usblp log " ... kernel module usblp disable now... " fi fi done else log "HP LaserJet $MODEL firmware was not downloaded..." log "...couldn't find $PRINTERID and DEV is not set" fi</span></span></code> </pre><br><br>  change comes down to adding rows <br><pre> <code class="bash hljs"> sleep 15 rmmod usblp <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> <span class="hljs-string"><span class="hljs-string">" ... kernel module usblp disable now... "</span></span></code> </pre><br><br>  6) Turn on the printer and look at the logs <br><pre> <code class="bash hljs"> tail -f /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/syslog</code> </pre><br>  when working correctly, they will have the following: <br> <code>-------------------- <br> Jul 1 01:56:12 kernel: [ 1749.871946] CE: hpet increased min_delta_ns to 20113 nsec <br> Jul 1 02:18:39 kernel: [ 3097.400294] usb 1-2.5: new high speed USB device number 8 using ehci_hcd <br> Jul 1 02:18:40 kernel: [ 3097.512010] usb 1-2.5: New USB device found, idVendor=03f0, idProduct=4117 <br> Jul 1 02:18:40 kernel: [ 3097.512084] usb 1-2.5: New USB device strings: Mfr=1, Product=2, SerialNumber=3 <br> Jul 1 02:18:40 kernel: [ 3097.512098] usb 1-2.5: Product: HP LaserJet 1018 <br> Jul 1 02:18:40 kernel: [ 3097.512109] usb 1-2.5: Manufacturer: Hewlett-Packard <br> Jul 1 02:18:40 kernel: [ 3097.512120] usb 1-2.5: SerialNumber: KP03QAY <br> Jul 1 02:18:40 mtp-probe: checking bus 1, device 8: "/sys/devices/pci0000:00/0000:00:1d.7/usb1/1-2/1-2.5" <br> Jul 1 02:18:40 mtp-probe: bus: 1, device: 8 was not an MTP device <br> Jul 1 02:18:40 udev-configure-printer: add /devices/pci0000:00/0000:00:1d.7/usb1/1-2/1-2.5/1-2.5:1.0 <br> Jul 1 02:18:40 udev-configure-printer: parent devpath is /devices/pci0000:00/0000:00:1d.7/usb1/1-2/1-2.5 <br> Jul 1 02:18:40 udev-configure-printer: Device vendor/product is 03F0:4117 <br> Jul 1 02:18:40 udev-configure-printer: MFG:Hewlett-Packard MDL:HP LaserJet 1018 SERN:- serial:KP03QAY <br> Jul 1 02:18:40 kernel: [ 3097.779667] usblp1: USB Bidirectional printer dev 8 if 0 alt 0 proto 2 vid 0x03F0 pid 0x4117 <br> Jul 1 02:18:40 kernel: [ 3097.781597] usbcore: registered new interface driver usblp <br> Jul 1 02:18:40 udev-configure-printer: add /devices/pci0000:00/0000:00:1d.7/usb1/1-2/1-2.5/1-2.5:1.0/usb/lp1 <br> Jul 1 02:18:41 kernel: [ 3098.989429] usb 1-2.5: usbfs: interface 0 claimed by usblp while 'usb' sets config #1 <br> Jul 1 02:18:43 /usr/sbin/hplj1018: foo2zjs: loading HP LaserJet 1018 firmware /lib/firmware/hp/sihp1018.dl to /dev/usb/lp1 ... <br> Jul 1 02:18:43 /usr/sbin/hplj1018: foo2zjs: ... download successful. <br> Jul 1 02:18:56 udev-configure-printer: parent devpath is /devices/pci0000:00/0000:00:1d.7/usb1/1-2/1-2.5 <br> Jul 1 02:18:56 udev-configure-printer: MFG:Hewlett-Packard MDL:HP LaserJet 1018 SERN:- serial:KP03QAY <br> Jul 1 02:18:57 kernel: [ 3115.009361] usb 1-2.5: usbfs: interface 0 claimed by usblp while 'usb' sets config #1 <br> Jul 1 02:18:58 kernel: [ 3116.139386] usbcore: deregistering interface driver usblp <br> Jul 1 02:18:58 kernel: [ 3116.139675] usblp1: removed <br> Jul 1 02:18:58 /usr/sbin/hplj1018: foo2zjs: ... kernel module usblp disable now... <br> --------------------</code> </div><p>Source: <a href="https://habr.com/ru/post/134973/">https://habr.com/ru/post/134973/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../134966/index.html">CryptDB: processing information in the database without decrypting it</a></li>
<li><a href="../134967/index.html">The first LTE network in Russia launched today (December 20, 2011) in Novosibirsk by Scartel (brand ‚ÄúYota‚Äù)</a></li>
<li><a href="../134968/index.html">Cooking Linux on Asus U31SD / P31SD and the like</a></li>
<li><a href="../134969/index.html">Solaris 11 kernel source</a></li>
<li><a href="../134972/index.html">Automating the processing of citizens in the E1 system of the Euphrates - as we did</a></li>
<li><a href="../134974/index.html">Installing Redis + Redis PHP + phpRedisAdmin on the production server in 15 minutes</a></li>
<li><a href="../134977/index.html">Customer is always right</a></li>
<li><a href="../134979/index.html">Graphics Station Virtualization on Parallels Workstation Extreme</a></li>
<li><a href="../134981/index.html">Inclusion of a shared address book in Zimbra</a></li>
<li><a href="../134982/index.html">Storing passwords in Chrome</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>