<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The status of SAMBA 4 at the moment</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is not really a post like ‚Äúapt-get howto‚Äù, I just wanted to summarize the results of my output and the current state of SAMBA4, can I use it at a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The status of SAMBA 4 at the moment</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/2c6/ce7/bd6/2c6ce7bd69597a7e6981d10a07166cc4.png" alt="image"><br><br>  This is not really a post like ‚Äúapt-get howto‚Äù, I just wanted to summarize the results of my output and the current state of SAMBA4, can I use it at all. <br><a name="habracut"></a><br>  Well, I hope everyone knows that this irony without a wonderful file server has exceeded the beta level in its 4th version.  This actually made her twist a little bit.  I have not been afraid of the status of beta in the development of the project for a long time, I still use gmail and dropbox;) The main thing is that developers adequately imagine this stage.  SAMBA Team I deeply respect, and I attribute them just to this type of developers. <br><br>  System on which I will deploy all this, ubuntu 12.04 LTS.  And at the moment there is a version of samba4 alpha18 there, which I was a little upset about. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The installation fails successfully, one of the files does not have permissions to execute, but this is easily treated.  The step-by-step instruction and the map "where you can step on a rake <s>in Mordor</s> " is here: <br>  <a href="">Installing Samba4 as a domain controller on Ubuntu Server 12.04</a> <br><br>  After aptitue finishes, the procedure for creating a workable domain is reduced to the line: <br><br><pre><code class="bash hljs">root@mserv:<span class="hljs-comment"><span class="hljs-comment">#/usr/share/samba/setup/provision --realm=example.local --domain=example --adminpass=4sweNdooG --server-role='domain controller' Looking up IPv4 addresses Looking up IPv6 addresses No IPv6 address will be assigned Setting up share.ldb Setting up secrets.ldb Setting up the registry Setting up the privileges database Setting up idmap db Setting up SAM db Setting up sam.ldb partitions and settings Setting up sam.ldb rootDSE Pre-loading the Samba 4 and AD schema Adding DomainDN: DC=example,DC=local Adding configuration container Setting up sam.ldb schema Setting up sam.ldb configuration data Setting up display specifiers Adding users container Modifying users container Adding computers container Modifying computers container Setting up sam.ldb data Setting up well known security principals Setting up sam.ldb users and groups Setting up self join Adding DNS accounts Creating CN=MicrosoftDNS,CN=System,DC=example,DC=local Creating DomainDnsZones and ForestDnsZones partitions Populating DomainDnsZones and ForestDnsZones partitions See /var/lib/samba/private/named.conf for an example configuration include file for BIND and /var/lib/samba/private/named.txt for further documentation required for secure DNS updates Setting up sam.ldb rootDSE marking as synchronized Fixing provision GUIDs A Kerberos configuration suitable for Samba 4 has been generated at /var/lib/samba/private/krb5.conf A phpLDAPadmin configuration file suitable for administering the Samba 4 LDAP server has been created in /var/lib/samba/private/phpldapadmin-config.php . Once the above files are installed, your Samba4 server will be ready to use Server Role: domain controller Hostname: mserv NetBIOS Domain: EXAMPLE DNS Domain: example.local DOMAIN SID: S-1-5-21-1715263971-3761441621-3169644295</span></span></code> </pre> <br><br>  It's all. <br>  After the end of the script, you need to add a couple of lines to the bind and apparmor config (if you have one), so that bind can work with the zone files generated by samba.  However, it is not difficult, all the information is in howto on the link above. <br><br>  Well, DHCP itself, I really did not need it. <br>  After starting samba4 and bind we see that samba will listen to much more ports than the 3rd version before. <br><br><pre> <code class="bash hljs">root@mserv:<span class="hljs-comment"><span class="hljs-comment"># netstat -tupl Active Internet connections (only servers) Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 *:3268 *:* LISTEN 1327/samba tcp 0 0 *:3269 *:* LISTEN 1327/samba tcp 0 0 *:ldap *:* LISTEN 1327/samba tcp 0 0 *:loc-srv *:* LISTEN 1324/samba tcp 0 0 *:netbios-ssn *:* LISTEN 1323/samba tcp 0 0 *:kpasswd *:* LISTEN 1329/samba tcp 0 0 mserv.example.lo:domain *:* LISTEN 1301/named tcp 0 0 localhost:domain *:* LISTEN 1301/named tcp 0 0 *:ssh *:* LISTEN 658/sshd tcp 0 0 *:kerberos *:* LISTEN 1329/samba tcp 0 0 localhost:953 *:* LISTEN 1301/named tcp 0 0 *:ldaps *:* LISTEN 1327/samba tcp 0 0 *:microsoft-ds *:* LISTEN 1323/samba tcp 0 0 *:1024 *:* LISTEN 1324/samba tcp6 0 0 [::]:3268 [::]:* LISTEN 1327/samba tcp6 0 0 [::]:3269 [::]:* LISTEN 1327/samba tcp6 0 0 [::]:ldap [::]:* LISTEN 1327/samba tcp6 0 0 [::]:loc-srv [::]:* LISTEN 1324/samba tcp6 0 0 [::]:netbios-ssn [::]:* LISTEN 1323/samba tcp6 0 0 [::]:kpasswd [::]:* LISTEN 1329/samba tcp6 0 0 [::]:ssh [::]:* LISTEN 658/sshd tcp6 0 0 [::]:kerberos [::]:* LISTEN 1329/samba tcp6 0 0 [::]:ldaps [::]:* LISTEN 1327/samba tcp6 0 0 [::]:microsoft-ds [::]:* LISTEN 1323/samba tcp6 0 0 [::]:1024 [::]:* LISTEN 1324/samba udp 0 0 mserv.example.loca:ldap *:* 1328/samba udp 0 0 *:ldap *:* 1328/samba udp 0 0 mserv.example.l:kpasswd *:* 1329/samba udp 0 0 *:kpasswd *:* 1329/samba udp 0 0 mserv.example.lo:domain *:* 1301/named udp 0 0 localhost:domain *:* 1301/named udp 0 0 mserv.example.:kerberos *:* 1329/samba udp 0 0 *:kerberos *:* 1329/samba udp 0 0 mserv.exampl:netbios-ns *:* 1325/samba udp 0 0 192.168.2.25:netbios-ns *:* 1325/samba udp 0 0 *:netbios-ns *:* 1325/samba udp 0 0 mserv.examp:netbios-dgm *:* 1325/samba udp 0 0 192.168.2.2:netbios-dgm *:* 1325/samba udp 0 0 *:netbios-dgm *:* 1325/samba udp6 0 0 fe80::5054:ff:fe8c:ldap [::]:* 1328/samba udp6 0 0 [::]:ldap [::]:* 1328/samba udp6 0 0 fe80::5054:ff:f:kpasswd [::]:* 1329/samba udp6 0 0 [::]:kpasswd [::]:* 1329/samba udp6 0 0 fe80::5054:ff::kerberos [::]:* 1329/samba udp6 0 0 [::]:kerberos [::]:* 1329/samba</span></span></code> </pre><br><br>  Result: you get a workable AD domain, into which Windows stations (in my case XPSP3 and W7SP1) are started up without any extra gestures. <br><br><img src="https://habrastorage.org/storage2/bcf/6ff/9ac/bcf6ff9ac099721fbd6b2544a29a9cc0.jpg"><br><br>  Adminpak is needed to manage the domain, the download link is in howto. <br><br><img src="https://habrastorage.org/storage2/487/7a9/6fe/4877a96fe902c77409cb54aebb583608.jpg"><br><br>  Group Policies <br><br><img src="https://habrastorage.org/storage2/eda/0f2/9f1/eda0f29f1783d201fbfc66bf86444402.jpg"><br><br>  All this looks quite rosy, but let's talk about sad things.  What does not work: <br><br><ul><li>  The web browser does not work at all.  The wiki tells that for this purpose it is necessary to use nmbd and smbd (as I understood with the 3rd version of Samba in parallel with the 4th), but I did not succeed. </li><li>  There is no printing support, again they suggest using smbd.  I have not tried. </li><li>  Various replication problems, in particular, I did not manage to join the existing 2008 AD domain, but there is a nuance, the domain was renamed, and I fully admit that the procedure was crooked, at least those errors that I received when joining referred to the incomplete renaming of the domain.  I did not have the opportunity to raise the net 2008 AD to check whether the join with the new domain will work. </li><li>  As a file server, ntvfs is used, a not very stable new file server.  As far as I understood, in beta version 4 it was disabled, and by default s3fs, that is, the file server from version 3, were used. </li></ul><br><br>  In general, the work of the SAMBA team is still a sea, but progress is good.  If the network browser works, then for small networks this is quite a replacement for Microsoft‚Äôs AD, however, I didn‚Äôt test the stability and performance of the new server, and therefore I cannot recommend samba4 for serious tasks.  Although..;) <br><br>  <b>PS:</b> I wanted to finish on this, but decided to try to install the latest fresh beta version, which is available in the ubuntu reporter for version 12.10.  Let us leave aside questions of the danger of breaking the LTS, while experimenting. <br><br>  Immediately I warn you, in beta2 s3fs is not functional, smbd falls due to various reasons.  It only helps to disable smbd and use ntvfs, for this you need to add in smb.conf: <br><br><pre> <code class="bash hljs">server services = +smb -s3fs dcerpc endpoint servers = +winreg +srvsvc</code> </pre><br><br>  Update Track Packets <br><br><pre> <code class="bash hljs">libdcerpc-server0 libdcerpc0 libgensec0 libndr-standard0 libndr0 libregistry0 libsamba-credentials0 libsamba-hostconfig0 libsamba-policy0 libsamdb0 libsmbclient-raw0 python-samba samba-dsdb-modules samba4 samba4-common-bin python-ldb libsamba-util0</code> </pre><br><br>  There will be no errors during the update if you do not delete the contents of / var / lib / samba <br><br>  The method for creating a domain is the same. <br><br>  Unfortunately, there are no noticeable changes compared to alpha18 from repository 12.04. </div><p>Source: <a href="https://habr.com/ru/post/147378/">https://habr.com/ru/post/147378/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../147372/index.html">Save resources when using virtual machines in Windows Azure</a></li>
<li><a href="../147374/index.html">Notepad ++. Cyrillic characters mistakenly in the code - a solution</a></li>
<li><a href="../147375/index.html">My Google Map Switches</a></li>
<li><a href="../147376/index.html">What I do not like Habr</a></li>
<li><a href="../147377/index.html">About hiring programmers and other engineers</a></li>
<li><a href="../147380/index.html">Features of web design for startups</a></li>
<li><a href="../147383/index.html">RFID Ring for London Underground</a></li>
<li><a href="../147384/index.html">.ME ‚Äî when, why, why, and how?</a></li>
<li><a href="../147385/index.html">Foxconn officially introduced low-noise nettop</a></li>
<li><a href="../147387/index.html">Uppercase and lowercase letters</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>