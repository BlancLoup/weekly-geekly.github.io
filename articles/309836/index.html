<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Setting and using speed limit for Open vSwitch with DPDK</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article describes how to configure the inbound speed limit for the Data Plane Development Kit (DPDK) interface in Open vSwitch (OVS) with DPDK. T...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Setting and using speed limit for Open vSwitch with DPDK</h1><div class="post__text post__text-html js-mediator-article">  This article describes how to configure the inbound speed limit for the <a href="http://dpdk.org/">Data Plane Development Kit (DPDK) interface</a> in <a href="http://openvswitch.org/">Open vSwitch (OVS)</a> with DPDK.  This article is intended for network administrators who can use the Open vSwitch speed limit to provide guaranteed reception speed for DPDK ports on deployed Open vSwitch servers.  This article complements the article <a href="https://software.intel.com/en-us/articles/qos-configuration-and-usage-for-open-vswitch-with-dpdk">Configuring and Using Quality of Service for Open vSwitch * with DPDK</a> , since speed limits and quality of service operate respectively on the receive and transmit paths, using unique API commands for configuration and operation. <br><br><img src="https://habrastorage.org/files/fb1/f70/1b4/fb1f701b4d72460ea2ede025517ae2d8.jpg"><br><a name="habracut"></a><br>  <i>Note.</i>  <i>At the time of this writing, the OVS speed limit with DPDK was available only in the <a href="https://github.com/openvswitch/ovs">main OVS branch</a> .</i>  <i>Download the ZIP archive of the main branch of OVS <a href="">here</a> .</i>  <i>The steps to install OVS with DPDK are described <a href="">here</a> .</i> <br><br><h2>  <font color="#0071c5">Speed ‚Äã‚Äãlimit in OVS with DPDK</font> </h2><br>  Before setting the speed limit, you should tell about the differences from the quality of service and about the interaction with traffic in vSwitch. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Quality of service applies to outgoing traffic, that is, data transmitted from the OVS port.  The speed limit, by contrast, is valid only for incoming traffic, that is, for data received by the vSwitch port.  The speed limit is implemented in OVS with DPDK using an incoming traffic limiter (similar to the outbound traffic limiter for quality of service supported in OVS with DPDK).  The incoming traffic limiter starts to simply drop packets after exceeding a certain reception rate in the interface (token buffer algorithm).  For a physical device, the incoming traffic limiter will drop traffic coming from outside the system through the network adapter.  For the virtual interface, that is, the vhost-user DPDK port, the delimiter will drop traffic transmitted from the guest machine to the vSwitch.  In fact, the speed of data transmission from the guest machine to this port is limited.  This is shown in fig.  one. <br><br><img src="https://habrastorage.org/files/d8e/b90/d96/d8eb90d96b9545df9dfa821c10e0eca4.png"><br>  <i>Fig.</i>  <i>1. Speed ‚Äã‚ÄãLimit using Inbound Traffic Limit for vhost-user port</i> <br><br><h2>  <font color="#0071c5">Test environment</font> </h2><br><img src="https://habrastorage.org/files/ed2/98d/206/ed298d2068b74ca999efeea2ee0fee77.png"><br>  <i>Fig.</i>  <i>2. Test environment</i> <br><br>  Note.  Both the host computer and the virtual machines (VMs) used in this environment are running the 64-bit version of <a href="https://getfedora.org/en/server/">Fedora * 23 Server</a> with the Linux * 4.4.6 kernel.  Each VM has a virtual network adapter connected to the vSwitch bridge through the vhost-user DPDK interface.  A virtual network adapter is displayed as a Linux kernel device (for example, ens0) in the virtual machine operating system.  Make sure there is a connection between the virtual machines (for example, send a ping to VM2 from VM1). <br><br><h2>  <font color="#0071c5">Configure and test speed limits</font> </h2><br>  To test the setup, install <a href="https://iperf.fr/iperf-download.php">iPerf *</a> on both <a href="https://iperf.fr/iperf-download.php">VMs</a> .  Make sure that the rpm version matches the guest OS version.  In this case, you should use the 6564-bit version of Fedora.  If you use Package Manager in Fedora 23, for example, dnf in Fedora 23, you can automatically install iPerf with the following command: <br><br><pre><code class="bash hljs">dnf install iperf</code> </pre> <br>  To verify the configuration, make sure iPerf is installed on both virtual machines.  iPerf can be run in client mode and server mode.  In this example, we will launch the iPerf client on VM1 and the iPerf server on VM2. <br><br><h3>  <font color="#0071c5">Test without incoming traffic limiter</font> </h3><br>  On VM2, run the following command to deploy the iPerf server in UDP mode on port 8080: <br><br><pre> <code class="bash hljs">iperf ‚Äìs ‚Äìu ‚Äìp 8080</code> </pre><br>  On VM1, run the following command to deploy the iPerf client in UDP mode on port 8080 with a data transfer rate of 100 Mbps: <br><br><pre> <code class="bash hljs">iperf -c 7.7.7.2 -u -p 8080 -b 100m</code> </pre><br>  In this case, VM1 will attempt to transfer data to VM2 using UDP protocol with a speed of 100 Mbps.  After 10 seconds, a set of values ‚Äã‚Äãwill appear.  Run these commands before setting the speed limit.  You will see results similar to those shown in fig.  3. In the server report, we are interested in the Bandwidth column. <br><br><img src="https://habrastorage.org/files/8d1/83f/e6f/8d183fe6fc674ca6afb8b30e037f5a7b.png"><br>  <i>Fig.</i>  <i>3. Output without limiting incoming traffic</i> <br><br>  The data shown in Fig.  3 indicate that the connection bandwidth between virtual machines is 100 Mbps. <br><br><h3>  <font color="#0071c5">Test with configured incoming traffic limiter</font> </h3><br>  Now configure the speed limit using the vhost-user1 inbound traffic limiter to 10 Mbps using the following command: <br><br><pre> <code class="bash hljs">ovs-vsctl <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> interface vhost-user1 ingress_policing_rate=10000 ingress_policing_burst=1000</code> </pre><br>  Parameters are described below. <br><br><ul><li>  <i>ingress_policing_rate</i> : The maximum speed (Kbps) allowed for this virtual machine.  This value is required to create an inbound traffic limiter.  If not specified, the existing speed limit setting will remain unchanged. </li><li>  <i>ingress_policing_burst</i> : size of the marker buffer in kilobytes.  The minimum value of this parameter should be equal to the largest estimated packet size.  If no value is specified, the default value of 8000 KB is used. </li></ul><br>  If you run UDP iPerf throughput test again, the results will be similar to those shown in fig.  four. <br><br><img src="https://habrastorage.org/files/354/979/d22/354979d22e76406d9e94652522fbac3c.png"><br>  <i>Fig.</i>  <i>4. Output with restricted inbound traffic</i> <br><br>  Note that now, with a configured traffic limiter, the available bandwidth is 9.59 Mbps, not 100 Mbps.  The iPerf program sent UDP traffic from the VM1 client to the VM2 server at 100 Mbps, but the traffic speed was reduced, since the incoming traffic limiter operates on the incoming vhost-user1 vSwitch port path.  Due to this, the speed of traffic transmitted from the iPerf VM1 client was reduced to approximately 10 Mbps. <br><br>  Note that if TCP traffic is used, then the value of the <i>ingress_policing_burst</i> parameter should be a significant proportion of the value of the <i>ingress_policing_rate</i> parameter;  It is recommended that it exceed 10%.  This is due to the performance degradation of the TCP protocol when packet drops and problems with packet retransmission occur. <br><br>  The existing speed limit setting for vhost-user1 can be obtained using the following command: <br><br><pre> <code class="bash hljs">ovs-vsctl list interface vhost-user1</code> </pre><br>  To cancel the vhost-user1 traffic speed limit, set the <i>ingress_policing_rate</i> parameter to 0, as shown below (you do not need to configure the <i>ingress_policing_burst</i> parameter value): <br><br><pre> <code class="bash hljs">ovs-vsctl <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> interface vhost-user1 ingress_policing_rate=0</code> </pre><br><br><h2>  <font color="#0071c5">Conclusion</font> </h2><br>  In this article, we showed a simple example in which traffic is transferred between two virtual machines via an Open vSwitch * with DPDK with a configured inbound traffic limiter.  We demonstrated commands for setting the speed limit for a given DPDK port, for getting information about the current speed limit setting, and for canceling the speed limit. <br><br><h2>  <font color="#0071c5">additional information</font> </h2><br>  For more information about using speed limits, parameters, and more, see the speed limit sections in <a href="">vswitch.xml</a> and <a href="http://openvswitch.org/ovs-vswitchd.conf.db.5.pdf">ovs-vswitchd.conf.db</a> . <br><br>  Have a question?  Requests for Open vSwitch can be sent to the <a href="http://mail.openvswitch.org/mailman/listinfo/discuss">mail discussion</a> . <br><br>  For more information about Open vSwitch * with DPDK, see the following videos and articles on the Intel Developer Zone and Intel Network Builders University. <br><br><ul><li>  <a href="https://software.intel.com/en-us/articles/qos-configuration-and-usage-for-open-vswitch-with-dpdk">Configure and use Quality of Service for Open vSwitch * with DPDK</a> </li><li>  <a href="https://networkbuilders.intel.com/university/course/open-vswitch-with-dpdk-architectural-deep-dive">Open vSwitch * with DPDK: detailed architecture description</a> </li><li>  <a href="https://networkbuilders.intel.com/university/course/dpdk-open-vswitch-accelerating-the-path-to-the-guest">DPDK Open vSwitch *: speed up connection to the guest system</a> </li></ul><br>  Translated articles on Habrahabr <br><br><ul><li>  <a href="https://habrahabr.ru/company/intel/blog/280502/">Using Open vSwitch with DPDK to transfer data between virtual machines with virtualization of network functions</a> </li><li>  <a href="https://habrahabr.ru/company/intel/blog/302126/">Data Plane Development Kit (DPDK): Getting Started</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/309836/">https://habr.com/ru/post/309836/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../309826/index.html">NIO: between Scylla and Charybdis?</a></li>
<li><a href="../309828/index.html">17% of the websites of Ukrainian schools are hosted in Germany, and 20% in Russia</a></li>
<li><a href="../309830/index.html">JetBrains Night in Moscow on September 29</a></li>
<li><a href="../309832/index.html">Blue-green warm</a></li>
<li><a href="../309834/index.html">Understanding Go: the encoding package</a></li>
<li><a href="../309840/index.html">Android Dev: continued podcasts about professional development for Android</a></li>
<li><a href="../309842/index.html">Exit "in the field": How we made a mobile application to increase the efficiency of field workers</a></li>
<li><a href="../309844/index.html">How to render the frame of the new Doom</a></li>
<li><a href="../309846/index.html">Using blocks in iOS. Part 2</a></li>
<li><a href="../309848/index.html">Three JavaScript performance principles that make Bluebird fast</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>