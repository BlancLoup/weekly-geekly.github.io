<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Working with commons-cli 1.2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the process of working on one project, it became necessary to develop a console application for remote access to the system. I took this for the fi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Working with commons-cli 1.2</h1><div class="post__text post__text-html js-mediator-article">  In the process of working on one project, it became necessary to develop a console application for remote access to the system.  I took this for the first time on such a scale, before everything was on the windows or if the console, then the exact number, type and order of the transmitted parameters are known.  And here there was a need for a large number of commands, each with its own parameters, or even without them, respectively, to ensure flexibility, there was a need for a parser, passed parameters. <br><br>  In order not to reinvent the wheel, I decided to take a ready-made library.  The choice stopped at <a href="http://commons.apache.org/cli/">commons-cli</a> , we managed to find a couple of examples for it and using it seemed not very difficult. <br><br>  As it turned out, there are not so many examples and they cover only the basic needs of the developer.  I'll try to fill this gap with my own explanations. <br><a name="habracut"></a><br>  So, let's begin.  Commons-cli is based on the notion of an option.  In order to immediately clarify, try to determine the terminology.  Consider this line: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Text.exe ‚Äìl login ‚Äì‚Äìpassword 123456 <br><br>  The test.exe program is called using the l option, which takes the string "login" as an argument and using the password option, with an argument as the string "123456".  It is not difficult to guess that the program requires authentication, the l option is responsible for the login, and the password option is itself a password.  For simplicity, it is possible to consider the pair ‚Äúoption, argument‚Äù in the classical way ‚Äúparameter = value‚Äù. <br><br>  By the way, the entry form with the ‚Äú=‚Äù sign is quite acceptable when using commons-cli. <br><br>  Options can be without arguments at all or there can be more than one arguments.  If an option name consists of 1 letter, then it is preceded by a ‚Äú-‚Äù (let's call it, by a simple ‚Äúdash‚Äù).  If the option name consists of 2 or more letters, then it is necessary to double the ‚Äúdash‚Äù, as with the password option. <br><br>  Deal with the terminology, you can go directly to the code.  So it all starts with options.  Create an option: <br><br><pre><code class="java hljs">Option option = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Option(<span class="hljs-string"><span class="hljs-string">"l"</span></span>, <span class="hljs-string"><span class="hljs-string">"login"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">"Login"</span></span>);</code> </pre> <br><br>  The spacecraft in this case takes 4 parameters: a short form of the option (single letter option), a long form of the option, a flag indicating the presence of parameters and a text explanation of the option.  We could specify only single-letter options of the option or only an extended view of the option, in each of these cases the designer would take 3 parameters, but not specify either a multi-letter or single-letter option, you must specify at least one.  Then you need to determine how this option will work with arumenty.  Like that: <br><br><pre> <code class="java hljs">option.setArgs(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-comment"><span class="hljs-comment">//     option.setOptionalArg(false);//      ,      ,        option.setArgName("login ");// ,           .</span></span></code> </pre> <br><br>  It seems that from the comments to the code everything should be clear.  If we need an option with no arguments (flag option), then setArgs (0).  After creating an option, you need to add it to the Options object. <br><br><pre> <code class="java hljs">Options posixOptions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Options(); posixOptions.addOption(option);</code> </pre> <br><br>  Now you need to create a command line parser and provide it with the necessary information for work: <br><br><pre> <code class="java hljs">CommandLineParser cmdLinePosixParser = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PosixParser();<span class="hljs-comment"><span class="hljs-comment">//  Posix  CommandLine commandLine = cmdLinePosixParser.parse(posixOptions, commandLineArguments);//   </span></span></code> </pre> <br><br>  To begin with we create a parser, a full-fledged parser in commons-cli 2 - Posix parser and GNU parser.  Frankly, I didn‚Äôt go into their differences, but after a quick inspection I liked the Posix-parser (regulated by the <a href="http://rus-linux.net/MyLDP/consol/Unix4all-421.html">Posix</a> standard, the system supporting this standard will work accordingly for all). , and the actual string with the parameters that were transferred to your program when it started (by itself, the standard args [] array must be separated into one line by separating the elements with spaces).  The parse result will be returned to the commandLine object. <br><br>  Now you need to execute the commands received, this is done like this: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (commandLine.hasOption(‚Äúl‚Äù)) { <span class="hljs-comment"><span class="hljs-comment">// ,     l,       ,        l String[] arguments = commandLine.getOptionValues(‚Äúl‚Äù);//    ,      System.out.println("We try to Login with: " + arguments[0]);//    ‚Ä¶ //   }</span></span></code> </pre> <br><br>  As you can see, working with commons-cli is quite simple.  In addition, this library will take care of the output of help on the use of the program, not completely, but it will ease a lot: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printHelp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Options options, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> printedRowWidth, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String header, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String footer, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> spacesBeforeOption, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> spacesBeforeOptionDescription, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> displayUsage, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> OutputStream out)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String commandLineSyntax = <span class="hljs-string"><span class="hljs-string">"java test.jar"</span></span>;<span class="hljs-comment"><span class="hljs-comment">//     final PrintWriter writer = new PrintWriter(out);//   help final HelpFormatter helpFormatter = new HelpFormatter();//     help` helpFormatter.printHelp( writer, printedRowWidth, commandLineSyntax, header, options, spacesBeforeOption, spacesBeforeOptionDescription, footer, displayUsage);//  writer.flush(); //  }</span></span></code> </pre><br>  To make everything clear, I will give an example of calling this method: <br><br><pre> <code class="java hljs">printHelp( posixOptions, <span class="hljs-comment"><span class="hljs-comment">//     help 80, //    "Options", //    "-- HELP --", //     3, //      5, //       true, //     usage   System.out //    );</span></span></code> </pre> <br><br>  Perhaps here everything is clear, except for the term ‚Äúusage string‚Äù.  I will give an example an example from which it will become clear how to use this parameter.  If true, the output will be something like this: <br><br>  usage: java test.jar [-l] [-h] <br><br>  If false, the output will be as follows: <br><br>  usage: java test.jar <br><br>  I think the difference is clear. <br><br>  The last is groups of options.  For example, there are two options -a and -b, they are mutually exclusive, that is, they cannot be specified at the same time.  For such a case, groups of options are created: <br><br><pre> <code class="java hljs">OptionGroup optionGroup = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OptionGroup(); optionGroup.addOption(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Option(<span class="hljs-string"><span class="hljs-string">"a"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">"A option"</span></span>); optionGroup.addOption(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Option(<span class="hljs-string"><span class="hljs-string">"b"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">"B option"</span></span>); posixOptions.addOptionGroup(optionGroup);</code> </pre><br>  Everything is pretty simple too. <br><br>  In general, the library left a good impression on the use, but very quickly it began to be missed.  The current version of the library 1.2, while there is a development of a completely new version 2.0 - in fact, according to the description of api version 2.0, we can say that this version should satisfy most of the demands placed on the cli libraries. <br><br>  The advantages of commons-cli are: <br><ul><li>  ease of use </li><li>  option groups </li><li>  long and short option notation (-l, --login) </li><li>  possibility to parse options of the following type -ab, when there are two options -a, -b </li></ul><br>  Cons (from their own needs, and of course there are more of them): <br><ul><li>  There is no possibility to create subcommands (as in git there are commands branch, status, etc. with their options) </li><li>  not very convenient work with option arguments, if there are more than 1 </li></ul><br>  As a result, for a simple cli is a great solution, something more serious is to look for alternatives or wait for version 2.0. <br><br>  Links in the article: <br><ul><li>  <a href="http://commons.apache.org/cli/">Commons cli</a> </li><li>  <a href="http://rus-linux.net/MyLDP/consol/Unix4all-421.html">Posix standard for cli</a> </li></ul><br><br>  UPD.  At the prompt, <a href="http://habrahabr.ru/users/nord_ua/" class="user_link">nord_ua</a> corrected the reference to the Posix standard command line. <br>  Corrected typos and added a link to commons-cli.  Thanks <a href="http://habrahabr.ru/users/nik_lazarev/" class="user_link">nik_lazarev</a> and <a href="http://habrahabr.ru/users/fractalizer/" class="user_link">FractalizeR</a> . </div><p>Source: <a href="https://habr.com/ru/post/123360/">https://habr.com/ru/post/123360/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../123351/index.html">Case study: audit of Habrahabr usability</a></li>
<li><a href="../123353/index.html">Life in a black hole or how to interact with large Russian companies</a></li>
<li><a href="../123356/index.html">How to develop your brand?</a></li>
<li><a href="../123358/index.html">AD and its weakness to the communication channel</a></li>
<li><a href="../123359/index.html">New release platform for creating online stores Synergy 0.60.0</a></li>
<li><a href="../123361/index.html">Android + Arduino = ‚ô•</a></li>
<li><a href="../123362/index.html">On-line webinar "Modern approaches to the organization of software development processes: Lean and Agile"</a></li>
<li><a href="../123363/index.html">Simple words about e-government</a></li>
<li><a href="../123364/index.html">Think twice before clicking the ‚ÄúBuy it now‚Äù button on Ebay</a></li>
<li><a href="../123365/index.html">Using the iPad 2 with and without the Digital AV Adapter</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>