<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>F # practice</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 Perhaps the two most frequently asked (and therefore, vital) questions in the comments to my review article about F # were the followin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>F # practice</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  Perhaps the two most frequently asked (and therefore, vital) questions in the comments to <a href="http://habrahabr.ru/blogs/programming/55272/">my review article about F #</a> were the following: <br>  1. Why is it so similar to OCaml? <br>  2. Why the hell did he give up? <br>  The answer to the first question is not particularly difficult - it is so similar to OCaml, because it is made entirely from it.  Is it good or bad?  Yes, rather well, this is clearly better than coming up with a completely new syntax that is not yet known how good it will be.  Plus, there is a lot of documentation on OCaml, so even at first, there shouldn't be any problems with (self) learning. <br>  The second question is much more difficult to figure out, especially now that the language is in a beta state and is so far only the object of study of overly inquisitive programmers.  However, despite a rather brief acquaintance with him, I have already had occasion to apply him once to achieve quite pragmatic goals, and I will tell you about this in a small post. <br>  I would like to make a reservation in advance, of course, not the last thing that prompted me to solve the task set in F # - the desire to practice in a new language.  Of course, the program could also be written in C #, and perhaps it would have turned out to be slightly longer (I repeat, maybe I didn‚Äôt check it).  Anyway, the program was written, and it did its job. <br><a name="habracut"></a><br><h4>  Problem </h4><br>  A small company where I work is developing various information support systems for domestic submarines.  Orders are one-time, very specific, so that until now we have never had problems inherent in product development.  For example, with localization.  However, it so happened that foreign clients of the Russian defense industry quite unexpectedly had a desire to deploy our system on some export ships.  I will not discuss on the topic ‚ÄúShould I have foreseen such an opportunity in advance?‚Äù Well, let's say it was necessary, only this does not apply to the topic. <br>  Our application must be said to include more than hundreds of diverse forms written in XAML, dedicated to various design tasks, information windows, etc., arranged in a dozen projects and subfolders in them.  And oh, horror, Russian lines were generously scattered evenly over them all.  (As it turned out a little later, there were about 1000 lines).  And with this it was necessary to do something. <br><br><h4>  Decision </h4><br>  First of all, I refused the <a href="http://msdn.microsoft.com/en-us/library/ms788718.aspx">technology</a> promoted by Microsoft almost immediately, because on the one hand it is quite complex (all these satellite assemblies scattered in folders, the need for all components to assign an id, and not a very clear usage model).  On the other hand, its capabilities, mainly the ability to switch the language in real time, were absolutely useless in this situation, since it is necessary to get only one copy in another language, and the Vietnamese sailors are unlikely to urgently need its Russian-language counterpart on the ship. <br>  So in the end it was decided to make everything much easier - to put all the lines in the ResourceDictionary, which then merge with the main dictionary located in App.xaml, and in the forms to put them as a StaticResource.  <a href="http://msdn.microsoft.com/en-us/library/bb625941.aspx">So</a> , in general. <br>  The F # program, which parses all xaml files in search of Russian strings, changes them and also creates a separate file for the dictionary, I wrote in less than an hour, it takes less than a hundred lines, along with comments and my passion, every next function in the pipeline, whatever Little she was, write in a new line.  And she processed all the files in just over a second.  I‚Äôll mention something about speed later. <br>  At first I thought alternately to tell about each method, but then I decided to lay out the entire text, so that you could read the code yourself for the sake of interest, and decide how difficult it is to read the functional code from a sheet.  And by the way, contrary to the conventional wisdom, that FWs are suitable for those who want to think a lot, but not enough to write, this particular program didn‚Äôt make me think much.  Everything happened, as our western brothers like to say straightforward, that is, head to head. <br>  In general, here is the code: <br><blockquote><code><font color="black"><font color="#0000ff">#light</font> <br> <font color="#0000ff">open</font> System <br> <font color="#0000ff">open</font> System.Xml <br> <font color="#0000ff">open</font> System.IO <br> <font color="#0000ff">open</font> System.Collections <br> <br> <font color="#0000ff">let</font> <font color="#0000ff">mutable</font> i = 0 <font color="#008000">//   </font> <br> <br> <font color="#008000">//     xml  ,  </font> <br> <font color="#0000ff">let</font> <font color="#0000ff">rec</font> nodes (node:XmlNode) = <br> seq { <font color="#0000ff">if</font> (node.NodeType &lt;&gt; XmlNodeType.Comment) <font color="#0000ff">then</font> <font color="#0000ff">yield</font> node <br> <font color="#0000ff">if</font> (node.Attributes &lt;&gt; null) <font color="#0000ff">then</font> <br> <font color="#0000ff">for</font> attr <font color="#0000ff">in</font> node.Attributes <font color="#0000ff">do</font> <font color="#0000ff">yield</font> attr <br> <font color="#0000ff">for</font> child <font color="#0000ff">in</font> node.ChildNodes <font color="#0000ff">do</font> <font color="#0000ff">yield!</font> (nodes child)} <br> <br> <font color="#008000">//  XAML      </font> <br> <font color="#0000ff">let</font> <font color="#0000ff">rec</font> xamlFiles dir filter = <br> seq { <font color="#0000ff">yield!</font> Directory.GetFiles(dir, filter) <br> <font color="#0000ff">for</font> subdir <font color="#0000ff">in</font> Directory.GetDirectories(dir) <font color="#0000ff">do</font> <font color="#0000ff">yield!</font> xamlFiles subdir filter} <br> <br> <font color="#008000">//    </font> <br> <font color="#0000ff">let</font> writeXml (doc:XmlDocument) (file:string) = <br> <font color="#0000ff">let</font> xtw = <font color="#0000ff">new</font> XmlTextWriter(file, null) <br> xtw.Formatting <font color="#0000ff">&lt;-</font> Formatting.Indented <br> doc.WriteContentTo(xtw) <br> xtw.Close() <br> <br> <font color="#008000">//   </font> <br> <font color="#0000ff">let</font> needLocalize (node:XmlNode) = <br> <font color="#0000ff">let</font> isRussian = Seq.exists ( <font color="#0000ff">fun</font> ch <font color="#0000ff">-&gt;</font> <font color="#0000ff">match</font> ch <font color="#0000ff">with</font> <br> | <font color="#A31515">''</font> .. <font color="#A31515">''</font> | <font color="#A31515">''</font> .. <font color="#A31515">''</font> <font color="#0000ff">-&gt;</font> true <br> |_ <font color="#0000ff">-&gt;</font> false) <br> node.Value &lt;&gt; null &amp;&amp; isRussian node.Value <br> <br> <font color="#008000">//  ,     .   (string*string) option</font> <br> <font color="#0000ff">let</font> localizeNode (node:XmlNode) = <br> <font color="#0000ff">if</font> (needLocalize node) <font color="#0000ff">then</font> <br> <font color="#0000ff">let</font> oldValue = node.Value.Trim() <br> i <font color="#0000ff">&lt;-</font> i+1 <br> <font color="#0000ff">let</font> key = <font color="#A31515">"Title_"</font> + i.ToString() <br> <font color="#0000ff">let</font> newValue = sprintf <font color="#A31515">"{StaticResource %s}"</font> key <br> <font color="#0000ff">match</font> node.NodeType <font color="#0000ff">with</font> <br> |XmlNodeType.Element <font color="#0000ff">-&gt;</font> (node :?&gt; XmlElement).SetAttribute( <font color="#A31515">"Content"</font> , newValue) <br> node.Value <font color="#0000ff">&lt;-</font> null <br> |XmlNodeType.Text <font color="#0000ff">-&gt;</font> (node.ParentNode :?&gt; XmlElement).SetAttribute(" <font color="#A31515">Content"</font> , newValue) <br> node.Value <font color="#0000ff">&lt;-</font> null <br> |_ <font color="#0000ff">-&gt;</font> node.Value <font color="#0000ff">&lt;-</font> newValue <br> Some(key, oldValue) <br> <font color="#0000ff">else</font> None <br> <br> <font color="#008000">//    XAML.      (, )</font> <br> <font color="#0000ff">let</font> localizeXaml (file:string) = <br> <font color="#0000ff">let</font> doc = <font color="#0000ff">new</font> XmlDocument() <br> doc.Load(file) <br> <font color="#0000ff">let</font> rusDict = nodes doc <br> |&gt; Seq.to_list <br> |&gt; List.choose localizeNode <font color="#008000">//map,    Some </font> <br> File.Copy(file,file+".tmp",true) <br> writeXml doc file <br> rusDict <br> <br> <font color="#008000">//   </font> <br> <font color="#0000ff">let</font> addResource (doc:XmlDocument) (key, value) = <br> <font color="#0000ff">let</font> elm = doc.CreateElement( <font color="#A31515">"system"</font> , <font color="#A31515">"String"</font> , <font color="#A31515">"clr-namespace:System;assembly=mscorlib"</font> ) <br> elm.SetAttribute( <font color="#A31515">"Key"</font> , <font color="#A31515">"http://schemas.microsoft.com/winfx/2006/xaml"</font> ,key)|&gt;ignore <br> elm.AppendChild(doc.CreateTextNode(value))|&gt; ignore <br> doc.FirstChild.AppendChild(elm) |&gt; ignore <br> <br> <br> <font color="#008000">//   XAML   </font> <br> <font color="#0000ff">let</font> localizeDirectory dir = <br> <font color="#0000ff">let</font> dict = <font color="#008000">// ,   namespaces</font> <br> <font color="#0000ff">let</font> tmp = <font color="#0000ff">new</font> XmlDocument() <br> <font color="#0000ff">let</font> fst = tmp.CreateElement( <font color="#A31515">""</font> , <font color="#A31515">"ResourceDictionary"</font> , <font color="#A31515">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</font> ) <br> fst.SetAttribute( <font color="#A31515">"xmlns:system"</font> , <font color="#A31515">"clr-namespace:System;assembly=mscorlib"</font> ) <br> fst.SetAttribute( <font color="#A31515">"xmlns:x"</font> , <font color="#A31515">"http://schemas.microsoft.com/winfx/2006/xaml"</font> ) <br> tmp.AppendChild(fst) |&gt; ignore <br> tmp <br> xamlFiles dir <font color="#A31515">"*.xaml"</font> <br> |&gt; Seq.to_list <br> |&gt; List.filter ( <font color="#0000ff">fun</font> file <font color="#0000ff">-&gt;</font> int (File.GetAttributes(file) &amp;&amp;&amp; FileAttributes.ReadOnly) = 0) <br> |&gt; List.map ( <font color="#0000ff">fun</font> x <font color="#0000ff">-&gt; async</font> {return localizeXaml x}) <br> |&gt; Async.Parallel <br> |&gt; Async.Run <br> |&gt; Array.to_list <br> |&gt; List.iter ( <font color="#0000ff">fun</font> lst <font color="#0000ff">-&gt;</font> List.iter (addResource dict) lst) <br> writeXml dict <font color="#A31515">"dict.xml"</font> <br> <br> <font color="#008000">// </font> <br> localizeDirectory Environment.CurrentDirectory <br></font></code> </blockquote><br><br>  I think it is useful to pay attention to two functions that use list-initialization technology - for xml nodes and file names, an example of one of which I just quoted in a review article.  Also of interest, I think, is the LocalizeNode function, which returns the so-called option value.  This is an analogue of the nullable type, which has two options Some (value) if some value is given, and None if there is no value.  This type is used in the List.concat function, which is similar to List.map, except that it accepts a mapping function that returns an option type (string * string option in this case) and adds only Some values ‚Äã‚Äãto the final list.  Essentially automatically adds List.filter to List.map ( <font color="#0000ff">fun</font> i <font color="#0000ff">-&gt;</font> i &lt;&gt; None). <br>  In addition, note that in the main function localizeDirectory, the processing of all files is parallelized to all available cores on the computer, which allows you to make a 100% load on the computer and obviously reduce the running time.  All that is needed is three gestures and no ThreadPools, not to mention monitors with other semaphores. <br>  On the other hand, the program is interesting (and just specific for F #) in that it actively uses the CLR, in this case XmlDocument, XmlNode and other classes from System.Xml.  It is in this that I see at the moment its main advantage over other functional languages. <br>  Well, in general, that's all.  I understand, not God knows that, of course, but maybe on this simple example someone can make a conclusion for themselves about the prospects or absence thereof in F #. </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/56004/">https://habr.com/ru/post/56004/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../55996/index.html">Fabien introduced symfony components</a></li>
<li><a href="../55997/index.html">Java vs .NET on Win2k</a></li>
<li><a href="../55998/index.html">Interactive educational online game "We master musical notation and frets on the neck of the guitar."</a></li>
<li><a href="../55999/index.html">Offtop about Whiskas</a></li>
<li><a href="../56001/index.html">Bit.ly received $ 2 million. Reduction of links - a profitable business?</a></li>
<li><a href="../56006/index.html">Inforotor broadcasts news live</a></li>
<li><a href="../56007/index.html">Drupal as MVC Framework</a></li>
<li><a href="../56008/index.html">University Degree in Social Media</a></li>
<li><a href="../56010/index.html">No items in the cart? Put there zest!</a></li>
<li><a href="../56015/index.html">Spotify - more than 10 million legal music tracks for free *</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>