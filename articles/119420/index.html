<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to write PingPong using LibCanvas</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good afternoon. In this topic, I will tell you how to make a ping-pong using LibCanvas. I significantly simplified it, leaving only the most important...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to write PingPong using LibCanvas</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage/habraeffect/17/00/17006bb85fb6eb7613c5d684a2765d94.png" align="left"><br>  Good afternoon.  In this topic, I will tell you how to make a ping-pong using LibCanvas.  I significantly simplified it, leaving only the most important part, since the goal of the topic is not to create the game ping-pong, but to explain the basics of LibCanvas. <br><br>  So, in the topic, step by step instructions on how to create a ping-pong using LibCanvas (without optimizations). <br><a name="habracut"></a><br>  So, ping pong - two boards, from which the ball bounces.  In general, you all know.  The first thing we need is to create an initial html file.  It is quite simple - a single canvas element, links to AtomJS and LibCanvas, and links to application files: <br><br><pre><code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>LibCanvas :: ping-pong<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/styles.css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/lib/atom.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/lib/libcanvas.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">canvas</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">canvas</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Game engine --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"js/init.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"js/controller.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"js/field.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"js/unit.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"js/ball.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Initialization </h2><br>  It all starts with an initialization file. <br><br>  In it, I call <code>LibCanvas.extract</code> in order to be able to use global names.  By default, all classes are stored in their namespaces: <code>LibCanvas.Shapes.Circle</code> .  After <code>extract</code> they can be used in abbreviated form: <code>Circle</code> <br><br>  The second step I declare the namespace for my toy.  All classes will be stored in it. <br><br>  The last step is to create the controller when the dom starts. <br><br><pre> <code class="javascript hljs">LibCanvas.extract(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.Pong = {}; atom.dom(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Pong.Controller(<span class="hljs-string"><span class="hljs-string">'canvas'</span></span>); });</code> </pre><br><br>  Initialization may differ depending on the application, but, in general, it is similar among them.  One of my comrades likes an interesting approach - a minimal html file with all the logic (even creating an element and connecting scripts) in JavaScript.  And yes, this code is valid! <br><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>LibCanvas :: ping-pong<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"js/load.ls"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br><h2>  Controller </h2><br>  The next step is to create a controller.  In it, we will create a <code>LibCanvas</code> object and game elements.  I will create all game classes using <a href=""><code>atom.Class</code></a> , where <code>initialize</code> is a constructor. <br><br><pre> <code class="javascript hljs">Pong.Controller = atom.Class({ <span class="hljs-attr"><span class="hljs-attr">initialize</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">canvas</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.libcanvas = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LibCanvas(canvas, { <span class="hljs-attr"><span class="hljs-attr">preloadImages</span></span>: { <span class="hljs-attr"><span class="hljs-attr">elems</span></span> : <span class="hljs-string"><span class="hljs-string">'im/elems.png'</span></span> } }) .listenKeyboard([ <span class="hljs-string"><span class="hljs-string">'aup'</span></span>, <span class="hljs-string"><span class="hljs-string">'adown'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>, <span class="hljs-string"><span class="hljs-string">'s'</span></span> ]) .addEvent(<span class="hljs-string"><span class="hljs-string">'ready'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.start.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)) .start(); }, <span class="hljs-attr"><span class="hljs-attr">start</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> libcanvas = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.libcanvas; [...] } });</code> </pre><br><br>  In the constructor, we pass the object to preload the picture.  The application does not start until the picture is uploaded.  These are two sprites - sticks and a ball. <br><br><img src="https://habrastorage.org/storage/habraeffect/24/eb/24eb9cbd278e6463cd56a2aa91f91899.png"><br><br>  We inform <code>LibCanvas</code> that we will use the keyboard and it is necessary to avoid default actions for the 'aup', 'adown', 'w' and 's' keys.  This will allow for convenient management and, for example, the browser window will not move with arrows. <br><br>  When the LibCanvas is ready to start drawing, we will start the controller's start method.  We will return to it later. <br><br><h2>  Playing field </h2><br>  The playing field will be responsible for drawing the background, points, some calculations, the creation of units. <br><br><pre> <code class="javascript hljs">Pong.Field = atom.Class({ <span class="hljs-attr"><span class="hljs-attr">Implements</span></span>: [ Drawable ], <span class="hljs-attr"><span class="hljs-attr">width</span></span> : <span class="hljs-number"><span class="hljs-number">800</span></span>, <span class="hljs-attr"><span class="hljs-attr">height</span></span>: <span class="hljs-number"><span class="hljs-number">500</span></span>, [...] });</code> </pre><br><br>  Create an entity and add it to libcanvas for rendering.  Notice how we deftly change the size of the canvas.  This is because our object has properties width and height. <br><br><pre> <code class="javascript hljs">Pong.Controller = atom.Class({ [...] start: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> libcanvas = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.libcanvas; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> field = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Pond.Field(); libcanvas.size( field, <span class="hljs-literal"><span class="hljs-literal">true</span></span> ); libcanvas.addElement( field ); [...] } });</code> </pre><br><br><h2>  Ball </h2><br>  The logic of the ball is extremely simple - it has a ‚Äúmomentum‚Äù - the direction and speed of movement. <br>  Speed ‚Äã‚Äãis set in pixels / second.  Each time during the update we get the time that has passed since the previous update, which we multiply the speed.  Due to this, we have a constant speed of movement, regardless of fps <br>  When the ball reaches the top or bottom border - it hits and flies the other way. <br>  appendTo allows you to easily add a ball to the field.  It is important for us to know the size of the field for the initial position and wall counting. <br>  Drawing is very simple - we just draw the desired part of the sprite into the current rectangle. <br>  Please note that during the construction of the object property, the <code>libcanvas</code> is not there yet, so you need to wait for the <code>libcanvasSet</code> event and only then wield with <code>libcanvas</code> <br><br><pre> <code class="javascript hljs">Pong.Ball = atom.Class({ <span class="hljs-attr"><span class="hljs-attr">Implements</span></span>: [ Drawable ], <span class="hljs-attr"><span class="hljs-attr">impulse</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">initialize</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">controller</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.impulse = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point( <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>.random(<span class="hljs-number"><span class="hljs-number">325</span></span>, <span class="hljs-number"><span class="hljs-number">375</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>.random(<span class="hljs-number"><span class="hljs-number">325</span></span>, <span class="hljs-number"><span class="hljs-number">375</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addEvent(<span class="hljs-string"><span class="hljs-string">'libcanvasSet'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.image = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.libcanvas.getImage(<span class="hljs-string"><span class="hljs-string">'elems'</span></span>).sprite( <span class="hljs-number"><span class="hljs-number">23</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">26</span></span>, <span class="hljs-number"><span class="hljs-number">26</span></span> ); }); }, <span class="hljs-attr"><span class="hljs-attr">move</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">time</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shape.move( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.impulse.clone().mul(time / <span class="hljs-number"><span class="hljs-number">1000</span></span>) ); }, <span class="hljs-attr"><span class="hljs-attr">update</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">time</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.move(time); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shape.from, to = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shape.to; <span class="hljs-comment"><span class="hljs-comment">//      if ( (this.impulse.y &lt; 0 &amp;&amp; from.y &lt; 0) || (this.impulse.y &gt; 0 &amp;&amp; to.y &gt; this.field.height) ) this.impulse.y *= -1; }, appendTo: function (field) { this.shape = new Rectangle( 40, field.height / 2, 24, 24 ); this.field = field; return this; }, draw: function () { this.libcanvas.ctx.drawImage(this.image, this.shape); } });</span></span></code> </pre><br><br>  Add his call to the controller.  We need to update the position of the ball every frame, because we subscribe to the update with <code>addFunc</code> <br><pre> <code class="javascript hljs">Pong.Controller = atom.Class({ [...] start: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ [...] ball = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Pong.Ball(); libcanvas [...] .addElement( ball.appendTo( field ) ) .addFunc(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">time</span></span></span><span class="hljs-function">) </span></span>{ ball.update( time ); libcanvas.update(); }); } });</code> </pre><br><br><h2>  Create units </h2><br>  The next thing we need is rackets.  They will be controlled using the keyboard (ws for the left and up and down for the right). <br>  This class will be responsible for controls, movement, contact with the ball. <br>  Note that the ‚Äúspeed‚Äù property is static, that is, added to the prototype.  We will not change it, but only use it. <br>  In controls, we bind to the update of the canvas and check the status of the <a href="">necessary keys</a> .  If necessary, move the object. <br>  An interesting way to move the shape to the desired speed - we just use the move method of our rectangle for this. <br>  fitToField ensures that the element is within acceptable limits and, if it is not, then returns it to its place. <br>  In the draw method, by analogy with Ball, the necessary part of the image is drawn into the current shape. <br><br><pre> <code class="javascript hljs">Pong.Unit = atom.Class({ <span class="hljs-attr"><span class="hljs-attr">Implements</span></span>: [ Drawable ], <span class="hljs-attr"><span class="hljs-attr">size</span></span>: { <span class="hljs-attr"><span class="hljs-attr">width</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-attr"><span class="hljs-attr">height</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-attr"><span class="hljs-attr">padding</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span> }, <span class="hljs-attr"><span class="hljs-attr">speed</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point( <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">300</span></span> ), <span class="hljs-attr"><span class="hljs-attr">score</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">controls</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">up, down</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addEvent(<span class="hljs-string"><span class="hljs-string">'libcanvasSet'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lc = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.libcanvas.addFunc(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">time</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lc.getKey(up)) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.move( -time ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lc.getKey(down)) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.move( time ); } }.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; }, <span class="hljs-attr"><span class="hljs-attr">appendTo</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">field, number</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> s = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.size; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.field = field; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.number = number; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shape = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rectangle({ <span class="hljs-comment"><span class="hljs-comment">// field.width, field.height from: [ (number == 2 ? field.width - s.width - s.padding : s.padding), (field.height - s.height) / 2 ], size: s }); return this; }, fitToField: function () { var shape = this.shape; var top = shape.from.y, bottom = shape.to.y - this.field.height; if (top &lt; 0) shape.move(new Point(0, -top)); if (bottom &gt; 0) shape.move(new Point(0, -bottom)); }, move: function (time) { this.shape.move( this.speed.clone().mul( time / 1000 ) ); this.fitToField(); }, draw: function() { this.libcanvas.ctx.drawImage( this.libcanvas.getImage('elems').sprite(0,0,20,100), this.shape ); } });</span></span></code> </pre><br><br>  We will create units on the field, where we will give them control and position: <br><pre> <code class="javascript hljs">Pong.Field = atom.Class({ [...] createUnits: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">libcanvas</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.unit = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Pong.Unit() .controls(<span class="hljs-string"><span class="hljs-string">'w'</span></span>, <span class="hljs-string"><span class="hljs-string">'s'</span></span>) .appendTo( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.enemy = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Pong.Unit() .controls(<span class="hljs-string"><span class="hljs-string">'aup'</span></span>, <span class="hljs-string"><span class="hljs-string">'adown'</span></span>) .appendTo( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span> ); libcanvas .addElement( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.unit ) .addElement( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.enemy ); }, [...]</code> </pre><br><br>  Naturally, you need to add a method call to the controller: <br><br><pre> <code class="javascript hljs">Pong.Controller = atom.Class({ [...], <span class="hljs-attr"><span class="hljs-attr">start</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ [...], field.createUnits( libcanvas ); } });</code> </pre><br><br><h2>  Object Interaction </h2><br>  Now you need to get the ball to interact with extreme boundaries and players.  Add a simple method to Ball. <br>  Please note that it is necessary to check the direction of movement of the ball, otherwise it may ‚Äúget stuck‚Äù in the players and the walls. <br><br><pre> <code class="javascript hljs">Pong.Ball = atom.Class({ [...] checkCollisions: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> coll = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.field.collidesUnits( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> ), isOut = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.field.isOut( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shape ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( (( coll &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> || isOut &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> ) &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.impulse.x &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) || (( coll &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> || isOut &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ) &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.impulse.x &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.impulse.x *= <span class="hljs-number"><span class="hljs-number">-1</span></span>; }, <span class="hljs-attr"><span class="hljs-attr">update</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">time</span></span></span><span class="hljs-function">) </span></span>{ [...] <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.checkCollisions(); }, [...] });</code> </pre><br><br>  Check inside Field is very simple. <br>  We place a check on a collision with a unit on the shoulders of the unit, and only return the direction. <br>  Checking for going beyond the right or left border is also very simple.  In case of contact with the border, we increase the score of the opposite player. <br><br><pre> <code class="javascript hljs">Pong.Field = atom.Class({ [...] collidesUnits: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ball</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.unit .collides(ball) ? <span class="hljs-number"><span class="hljs-number">-1</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.enemy.collides(ball) ? <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>; }, <span class="hljs-attr"><span class="hljs-attr">isOut</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">shape</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (shape.from.x &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.enemy.score++; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (shape.to.x &gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.width) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.unit.score++; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }, [...]</code> </pre><br><br>  Inside the Unit we will use the built-in method <code>Rectangle().intersect</code> , to check the intersection of two rectangles. <br><pre> <code class="javascript hljs">Pong.Unit = atom.Class({ [...] collides: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ball</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ball.shape.intersect(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shape); }, });</code> </pre><br><br><h2>  Account withdrawal </h2><br>  The last step is to display the players score.  This can be done easily with <code>ctx.text</code> - it allows you to draw text more closely to css, specify indents, a rectangle into which you want to output text and some additional features. <br><br><pre> <code class="javascript hljs">Pong.Field = atom.Class({ [...] drawScore: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">unit, align</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.libcanvas.ctx.text({ <span class="hljs-attr"><span class="hljs-attr">text</span></span>: unit.score, <span class="hljs-attr"><span class="hljs-attr">size</span></span>: <span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-attr"><span class="hljs-attr">padding</span></span>: [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">70</span></span>], <span class="hljs-attr"><span class="hljs-attr">color</span></span>: <span class="hljs-string"><span class="hljs-string">'white'</span></span>, <span class="hljs-attr"><span class="hljs-attr">align</span></span>: align }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; }, <span class="hljs-attr"><span class="hljs-attr">draw</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> .drawScore( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.unit , <span class="hljs-string"><span class="hljs-string">'left'</span></span> ) .drawScore( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.enemy, <span class="hljs-string"><span class="hljs-string">'right'</span></span> ); } });</code> </pre><br><br><h2>  Conclusion </h2><br>  That's all.  The full code and game you can find at <br><h3>  <a href="http://libcanvas.github.com/games/pingpong/">libcanvas.github.com/games/pingpong/</a> </h3><br><br>  The game from the topic can be developed further.  For example, add a network game with a server to node.js and WebSocket. <br>  Or add a beautiful look, animation.  You can also improve the gameplay - add barriers, a different angle of reflection of the ball. <br>  This is all done very easily with the help of LibCanvas.  What topics interest you?  If you wish - I will describe them. <br><br>  Another question is whether it is worth describing more basic things, making topics about LibCanvas not so loaded with information, but narrower and describing certain minor aspects or similar full-length articles are perceived quite easily? <br><br>  It seems to me that sometimes the thoughts were quite confused, so do not hesitate to ask questions in the comments or email shocksilien@gmail.com, if you are not registered on Habr√©. </div><p>Source: <a href="https://habr.com/ru/post/119420/">https://habr.com/ru/post/119420/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../119415/index.html">HackDay # 16 in St. Petersburg, May 28-29</a></li>
<li><a href="../119416/index.html">Digest Wanted.VC # 2</a></li>
<li><a href="../119417/index.html">Notion Ink Adam - double impressions</a></li>
<li><a href="../119418/index.html">In the wake of MySQL Users Conference 2011</a></li>
<li><a href="../119419/index.html">Open Testing Workle</a></li>
<li><a href="../119423/index.html">Kazan.rb # 1 - a meeting of Ruby & Rails programmers in Kazan on May 21 in It-park</a></li>
<li><a href="../119424/index.html">Linux JavaScript emulator</a></li>
<li><a href="../119425/index.html">Space Scale Fail</a></li>
<li><a href="../119426/index.html">RP Server for developer</a></li>
<li><a href="../119428/index.html">Team Russia - the number 1 overclocking team in the world!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>