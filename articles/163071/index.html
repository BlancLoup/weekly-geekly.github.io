<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Saving the game in Unity3D</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you are not writing a kazualka under the web and not a merciless harsh bagel, you cannot do without saving the data to disk. 
 How is this done in ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Saving the game in Unity3D</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/getpro/habr/post_images/76e/4a8/ce7/76e4a8ce78b716b8be904dcdfedc5f8c.png" title="Sometimes saving just doesn't mean the genre ..." alt="     ...">  If you are not writing a kazualka under the web and not a merciless harsh bagel, you cannot do without saving the data to disk. <br>  How is this done in Unity?  There are enough options here - there is a PlayerPrefs class in the library, you can serialize objects into XML or binary files, save to * SQL *, you can finally develop your own parser and save format. <br>  Consider in more detail with the first two options, and at the same time try to make the load-save menu with screenshots. <br><br>  We assume that reading further basic skills with this engine owns.  But at the same time, it is possible not to suspect about the existence of PlayerPrefs, GUI in its library, and, in principle, not to know about serialization.  With this all and figure it out. <br>  And so that this note does not become too exciting and useful, it is oriented the most irrelevant option in the mobile / tablet / online age - build for Windows (although, of course, more general moments are enough). <br><br><ul><li>  By the way, a couple of weeks ago on Habr√© there was an article in which the author mentioned that Unity3D is in the know about computer graphics at the computer science department of St. Petersburg math.  Interesting fact, a lot of talking about the popularity of the engine. <br>  Although it‚Äôs generally a good idea - in my opinion, a topic for discussion.  Maybe discussing it would be even more interesting than serialization issues =) </li></ul><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Another small disclaimer - I am not a pro in any of the topics that are disclosed, so if some things can be done better, easier, more convenient - corrections and additions are very welcome. <br><br><h4>  1. PlayerPrefs </h4><br>  Convenient built-in class.  Works with int, float and string.  Quite transparent, but I still met on the forums the turns in the spirit of " <a href="http://answers.unity3d.com/questions/17873/saveload-playerprefs.html">I can not understand PlayerPrefs</a> " or "I should somehow deal with PlayerPrefs", so let's look at it with a simple example. <br><br><h5>  1.1 Primitive use within one scene: QuickSave &amp; QuickLoad for hotkeys. </h5><br>  A quick example of use.  Suppose we have one scene and a character on it.  The SaveLoad.cs script is attached to the character.  We will keep the simplest - his position. <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SaveLoad</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Transform CurrentPlayerPosition; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(Input.GetKeyDown(KeyCode.R)) savePosition(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(Input.GetKeyDown(KeyCode.L)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (PlayerPrefs.HasKey(<span class="hljs-string"><span class="hljs-string">"PosX"</span></span>)) <span class="hljs-comment"><span class="hljs-comment">// ,       loadPosition(); if(Input.GetKeyDown(KeyCode.D)) PlayerPrefs.DeleteAll(); //       } public void savePosition(){ Transform CurrentPlayerPosition = this.gameObject.transform; PlayerPrefs.SetFloat("PosX", CurrentPlayerPosition.position.x); // ..   PlayerPrefs.SetFloat("PosY", CurrentPlayerPosition.position.y); //   ,   PlayerPrefs.SetFloat("PosZ", CurrentPlayerPosition.position.z); //  float   PlayerPrefs.SetFloat("AngX", CurrentPlayerPosition.eulerAngles.x); PlayerPrefs.SetFloat("AngY", CurrentPlayerPosition.eulerAngles.y); PlayerPrefs.SetString("level", Application.loadedLevelName); //   /  PlayerPrefs.SetInt("level_id", Application.loadedLevel); //   } public void loadPosition(){ Transform CurrentPlayerPosition = this.gameObject.transform; Vector3 PlayerPosition = new Vector3(PlayerPrefs.GetFloat("PosX"), PlayerPrefs.GetFloat("PosY"), PlayerPrefs.GetFloat("PosZ")); Vector3 PlayerDirection = new Vector3(PlayerPrefs.GetFloat("AngX"), //    PlayerPrefs.GetFloat("AngY"), 0); //     CurrentPlayerPosition.position = PlayerPosition; //    CurrentPlayerPosition.eulerAngles = PlayerDirection; } }</span></span></code> </pre> <br><br>  Of course, the use of PlayerPrefs is rather contrived here - in fact, against normal variables, it only adds to us the ability to load the game from the save location after the release. <br><br>  But the entire main interface of the class is visible: for each of the three types of Get / Set by key, checking entry by key, clearing.  It makes no sense even to disassemble ScriptReference, everything is obvious by function name: <a href="http://docs.unity3d.com/Documentation/ScriptReference/PlayerPrefs.html"><code>PlayerPrefs</code></a> <br><br>  However, one is still worth looking at in more detail, PlayerPrefs.Save.  The description says that in general, the default unit PlayerPrefs writes to the disk only when the application is closed - in general, it is logical, given that the class is not focused on internal data exchange, and on their preservation between sessions.  Accordingly, Save () is supposed to be used only for periodic saves in case of crash. <br><br>  Perhaps in some cases this is how it works.  Under Win PlayerPrefs are written to the registry, and, as you can easily see, are read and written immediately. <br>  Something like our class in the registry: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6d6/729/a5b/6d6729a5b34f178144c24673c1489de9.png"><br><br>  At the end their <a href="http://www.cse.yorku.ca/~oz/hash.html">DJBX33X</a> hash (Bernshtein hash with XOR) is added to all keys. <br><br>  UnityGraphicsQuality is always saved automatically, and indeed when the application is closed.  This is the Quality level from Edit -&gt; Project Settings Quality, which is <a href="http://docs.unity3d.com/Documentation/ScriptReference/QualitySettings.SetQualityLevel.html"><code>QualitySettings.SetQualityLevel</code></a> . <br><br>  If the application is running, you can modify the saved value in the registry, then request it from the program - and we will see that the modified version has returned.  Those.  you should not think that while the program is running, PlayerPrefs is something like an analogue of global variables, and the disk does not work. <br><br><br><h4>  2. Serialization in XML </h4><br>  We speak serialization, we mean a binary code.  This <a href="http://habrahabr.ru/post/60317/">happens</a> , but you can actually serialize into any format.  In essence, this is a translation of the data structure or state of the object into a stored / transferred format.  And deserialization, respectively - the restoration of the object from the stored / received data. <br><br>  In general, Mono can both binary serialization and <a href="http://www.mono-project.com/XML">XML</a> (System.Xml.Serialization), but there is one thing: most Unity classes are not serialized directly.  It is impossible to simply take and serialize a GameObject, or a class that inherits MonoBehavoir: you will have to create an additional internal serializable class containing the necessary data, and work using it.  But XmlSerializer at least automatically eats Vector3, and BinarySerializer, afaik, even does not know how. <br><br><h5>  2.1 The essence of the example </h5><br>  Imagine that you are writing <i>your Portal</i> , where the hero goes through a series of locations of the same type - but can return to any of them later.  And he could have an impact on each: some resources to use, something to break, something to throw out.  I want to save these changes, but returning to the location is unlikely and unpredictable, and dragging the parameters of all the rooms in the RAM does not make much sense.  We will serialize the location, leaving it - for example, a trigger on the door.  And when loading a location, either generate a default situation or, if there is saved data, restore it by it. <br><br><h5>  2.2 Serializable classes for data </h5><br>  XmlSerializer can work with classes, the data in which consist of other serializable classes, simple types, most of the elements of Collections [.Generic].  The class must have an empty constructor and public access to all serializable fields. <br>  Some types from the Unity library (like Vector3, containing only three fields) successfully pass this face control, but the majority, especially the more complex ones, are its feils. <br><br>  Assume that in each room we need to save the states of some arbitrary set of GameObjects.  We cannot do this directly.  So we need duplicate types. <br><br>  Create a new script in Standard Assets: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Xml.Serialization; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; [XmlRoot(<span class="hljs-string"><span class="hljs-string">"RoomState"</span></span>)] [XmlInclude(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(PositData))] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RoomState</span></span> { <span class="hljs-comment"><span class="hljs-comment">// ,      [XmlArray("Furniture")] [XmlArrayItem("FurnitureObject")] public List&lt;PositData&gt; furniture = new List&lt;PositData&gt;(); //     public RoomState() { } //   public void AddItem(PositData item) { //   -    furniture.Add(item); //      } public void Update(){ // ,     -  foreach (PositData felt in furniture) //   felt.Update(); } }</span></span></code> </pre><br><br>  In square brackets are the <a href="http://msdn.microsoft.com/en-us/library/83y7df3e(v%3Dvs.80).aspx">attributes for managing XML serialization</a> .  Here they actually affect only the names of tags in the generated * .xml, and strictly speaking, there is no need for them.  But let them be, for clarity :) If for some reason all of a sudden it matters to you what the xml-code will look like, then the capabilities of the attributes are certainly <a href="http://msdn.microsoft.com/en-us/library/2baksw0z(v%3Dvs.80).aspx">wider</a> . <br><br>  Next, in the same place, add the base class for items from the list and as many followings from it.  Although ... for example, one is enough: <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">XmlType(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"PositionData"</span></span></span><span class="hljs-meta">)</span></span>] [XmlInclude(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Lamp))] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PositData</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> GameObject _inst; <span class="hljs-comment"><span class="hljs-comment">//       public GameObject inst { set { _inst = value; } } [XmlElement("Type")] public string Name { get; set; } //      Resourses [XmlElement("Position")] public Vector3 position {get; set; } public PositData() { } public PositData(string name, Vector3 position) { this.Name = name; this.position = position; } public virtual void Estate(){ } //  ""    public virtual void Update(){ //    position = _inst.transform.position; //      } } [XmlType("Lamp")] public class Lamp : PositData // ,  ,    / { [XmlAttribute("Light")] public bool lightOn { get; set; } public Lamp() { } public Lamp(string name, Vector3 position, bool lightOn): base(name, position) { this.lightOn = lightOn; } public override void Estate(){ if (!lightOn) ((Light)(_inst.GetComponentInChildren(typeof(Light)))).enabled = false; } //   ,     Light  public override void Update(){ base.Update(); lightOn = ((Light)_inst.GetComponentInChildren(typeof(Light))).enabled; } // lightOn =    Light   }</span></span></code> </pre><br><br>  So, serializable classes are ready.  Let's now make another class to further simplify the serialization of the created RoomState type. <br><br><h5>  2.3 Directly Serialization </h5><br>  Also in Standard Assets we will make a class with a couple of static methods that we will use in the future: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Xml.Serialization; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.IO; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Serializator</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SaveXml</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">RoomState state, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> datapath</span></span></span><span class="hljs-function">)</span></span>{ Type[] extraTypes= { <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(PositData), <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Lamp)}; XmlSerializer serializer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XmlSerializer(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(RoomState), extraTypes); FileStream fs = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileStream(datapath, FileMode.Create); serializer.Serialize(fs, state); fs.Close(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RoomState </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DeXml</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> datapath</span></span></span><span class="hljs-function">)</span></span>{ Type[] extraTypes= { <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(PositData), <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Lamp)}; XmlSerializer serializer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XmlSerializer(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(RoomState), extraTypes); FileStream fs = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileStream(datapath, FileMode.Open); RoomState state = (RoomState)serializer.Deserialize(fs); fs.Close(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; } }</code> </pre><br><br>  Here we create the XmlSerializer through the constructor <a href="http://msdn.microsoft.com/en-US/library/e5aakyae(v%3Dvs.80).aspx">Constructor (Type, Type [])</a> <br>  FileStream open at the address of the transfer transmitted by a specific location. <br><br><h5>  Using </h5><br>  So, all the auxiliary tools are ready, you can proceed to the room itself.  On the object of the room we hang: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RoomGen</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> RoomState state; <span class="hljs-comment"><span class="hljs-comment">//   private string datapath; //        void Start () { datapath = Application.dataPath + "/Saves/SavedData" + Application.loadedLevel + ".xml"; if (File.Exists(datapath)) //      state = Serializator.DeXml(datapath); //  state  else setDefault(); //    Generate(); //      state } void setDefault(){ state = new RoomState(); // chair, table, lamp -    Resourses state.AddItem(new PositData("chair", new Vector3(15f, 1f, -4f))); state.AddItem(new PositData("chair", new Vector3(10f, 1f, 0f))); state.AddItem(new PositData("table", new Vector3(5f, 1f, 4f))); state.AddItem(new Lamp("lamp", new Vector3(5f, 4f, 4f), true)); } void Generate(){ foreach (PositData felt in state.furniture){ //      felt.inst = Instantiate(Resources.Load(felt.Name), felt.position, Quaternion.identity) as GameObject; //   felt.Estate(); //     } } void Dump() { state.Update(); //   state Serializator.SaveXml(state, datapath); //    } }</span></span></code> </pre><br><br>  Finally, let's call RoomGen.Dump ().  For example, suppose triggers on doors that are child objects of a room (an object with the RoomGen component): <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> nextRoom; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Door</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnTriggerEnter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Collider hit</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hit.gameObject.tag == <span class="hljs-string"><span class="hljs-string">"Player"</span></span>) { SendMessageUpwards(<span class="hljs-string"><span class="hljs-string">"Dump"</span></span>); Application.LoadLevel(nextRoom); } } }</code> </pre><br><br>  That's all.  The interaction with objects and the process of changing their state are omitted here, but this is easy to add.  For the initial test, you can simply add a couple of stateful functions to hotkeys to the script, or pause and move your hands. <br><br>  At the first launch, the default option is generated, when the changes are exited, they are dumped into the file, when returning, the last state is restored from the file, including if the application was closed.  Works like a charm. <br><br>  One of the significant drawbacks of XML is that the player can easily change the data.  And if in this case there are few who will be interested in the arrangement of scattered chairs, it is better to avoid serialization in XML, while maintaining more significant data for the player.  Yes, and in the registry, changing the values ‚Äã‚Äãis not difficult.  In such cases, it is already better to use binary serialization or its own format. <br><br><h4>  3. Save / Load through the menu </h4><br>  Probably, it would be more relevant to implement the option with the selection / creation of a user and internal automatic saves.  If your game requires a serious Save / Load menu, then it is unlikely that you are currently reading this article for the profane. <br><br>  But I can't wait to see the New Year holidays, when I can finally see my sister and finish off the classic American McGee's Alice in a couple of evenings, so we'll do Save / Load almost like there.  With screenshots.  At the same time there will be a reason to delve into the GUI, textures and other <i>exciting</i> things. <br><br><h5>  3.1 Main menu </h5><br>  To make loading and saving through the menu, we, oddly enough, need a menu.  Of course, you can make it yourself through objects on the stage, you can use ready-made solutions like <a href="http://www.tasharen.com/%3Fpage_id%3D140">NGUI</a> , but for now we will use the <a href="http://docs.unity3d.com/Documentation/ScriptReference/GUI.html">GUI</a> from the regular library. <br><br><ul><li>  <b>Scripting Reference</b> <br>  For a start, useful: <br>  <code>OnGUI()</code> is a MonoBehaviour function for drawing GUIs and handling related events.  Something like Update (), but specifically for the GUI and can be called more often than each frame. <br><br> <a href="http://docs.unity3d.com/Documentation/ScriptReference/GUI.Button.html"><code>GUI.Button</code></a> <br> <pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Button</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Rect position, String text</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Button</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Rect position, Textureimage </span></span></span><span class="hljs-function">)</span></span>;</code> </pre><br>  button function.  Draws it within the specified rectangle, responds to pressing, returning true.  More designers, but we have enough of these. <br><br>  <a href="http://docs.unity3d.com/Documentation/ScriptReference/GUI.BeginGroup.html"><code>GUI.BeginGroup</code></a> <code>, GUI.EndGroup</code> <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BeginGroup</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Rect position</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EndGroup</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>;</code> </pre><br>  Grouping of gui elements is useful mainly by redefining the boundaries relative to which the position of the nested elements is calculated (by default, this is the screen boundary, in this case, the position rectangle). <br></li><li>  <b>The essence</b> <br>  Let's make a separate starting scene, and on it an empty object, to which we attach a script for our menu.  So  the menu will travel through the scenes (when loading the next scene it is not recreated, but simply transferred to it), hand over the necessary events (like the menu button), when drawn, draw over the game screen. <br></li><li>  On the code with comments everything should be clear: </li></ul><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MenuScript</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Texture2D backgroundTexture; <span class="hljs-comment"><span class="hljs-comment">//     public const int mainMenuWidth = 200; //      private int menutype = 0; //    -   private bool menuMode = true; //    private bool gameMode = false; //     - // false    Load / New Game private void Awake(){ DontDestroyOnLoad(this); //          } void Update () { if (Input.GetKeyDown(KeyCode.Escape)){ // warning!      : Input.GetKey() if(gameMode) if (menutype == 0 || !menuMode){ //          switchGameActivity(); // /   // (     ) menuMode = !menuMode; } menutype = 0; //         } //       } private void OnGUI(){ if (menuMode){ if(backgroundTexture != null) // ,  GUI.DrawTexture(new Rect(0, 0, Screen.width, Screen.height), backgroundTexture); switch (menutype){ case 0: drawMainMenu(); break; case 1: case 2: drawSaveLoadMenu(); break; } } } private void drawMainMenu(){ GUI.BeginGroup (new Rect (Screen.width / 2 - mainMenuWidth/2, Screen.height / 2 - 180, mainMenuWidth, 240)); if (gameMode) if(GUI.Button(new Rect(0,0, mainMenuWidth,30) , "Resume")){ menuMode = false; switchMouseLook(); } if(GUI.Button(new Rect(0, 40, mainMenuWidth, 30) , "New Game")){ menuMode = false; gameMode = true; Application.LoadLevel("first_scene"); } if (gameMode) if(GUI.Button(new Rect(0, 2*40, mainMenuWidth, 30) , "Save")) menutype = 1; if(GUI.Button(new Rect(0, ((gameMode)? 3 : 2)*40, mainMenuWidth, 30) , "Load")){ menutype = 2; //   "2 + gameMode"? C#, nuff said. if(GUI.Button(new Rect(0, ((gameMode)? 4 : 3)*40, mainMenuWidth, 30) , "Options")){} if(GUI.Button(new Rect(0, ((gameMode)? 5 : 4)*40, mainMenuWidth, 30) , "Quit Game")){ Application.Quit(); } GUI.EndGroup(); } void switchGameActivity(){ //    c,       MouseLook, Camera mk = Camera.main; //     .    MouseLook ml = mk.GetComponent&lt;MouseLook&gt;(); //      if (ml != null) ml.enabled = !ml.enabled; //    } }</span></span></code> </pre><br><br><img src="https://habrastorage.org/getpro/habr/post_images/e10/b64/bf0/e10b64bf01c841e2bc4d0cc088605577.png"><br><br>  <i>Main menu before and after the game starts</i> <br><br><h5>  3.2 Draw the load / save menu </h5><br>  The drawSaveLoadMenu () function is already called when menutype&gt; 0, but not yet written.  Correct this omission.  For now, just learn how to draw our menus and call the actual load / save functions. <br><br><ul><li>  <b>Scripting Reference</b> <br>  <a href="http://docs.unity3d.com/Documentation/ScriptReference/GUI.SelectionGrid.html"><code>GUI.SelectionGrid</code></a> - draws a grid of buttons, but in fact it is a single variant select.  One option is always selected, returns the number of the selected one. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SelectionGrid</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Rect position , </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> defaultSelected, Texture[] images, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> elsInRow</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SelectionGrid</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Rect position , </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> defaultSelected, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] texts, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> elsInRow</span></span></span><span class="hljs-function">)</span></span>;</code> </pre><br>  Quantity - based on the size of the transmitted array.  Generally intended to be used like this: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> selGridInt = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//       public string[] selStrings = new string[] {"Grid 1", "Grid 2", "Grid 3", "Grid 4"}; void OnGUI() { //        selGridInt = GUI.SelectionGrid(new Rect(25, 25, 100, 30), selGridInt, selStrings, 2); //  selGridInt    , } //    ,        </span></span></code> </pre><br></li><li>  <b>The essence</b> <br>  It seems that this is not exactly what we need - we need to choose once and immediately respond.  But SelectionGrid calmly eats dirty hack - an index outside the real array.  Those.  we will always transmit, say, -1 and then we will be able to track the click event itself. <br></li></ul><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> slotsAmount = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   / //   .    , private Texture2D[] saveTexture = new Texture2D[slotsAmount]; //  ,     //,         ,  null private void drawSaveLoadMenu(){ if(GUI.Button(new Rect(Screen.width / 2 - 100, Screen.height * 2/3 + 50, 200, 30) , "Back")) menutype = 0; int slot = GUI.SelectionGrid( new Rect( //      5x2 Screen.width / 2 - Screen.height * 5/9, //   Screen.height/3, //   4:3 Screen.height * 10/9, Screen.height/3 ), -1, //     saveTexture, //  null,     5); //     if (slot &gt;= 0) //      if (menutype == 1) savegame(slot); //      -  else if (menutype == 2 &amp;&amp; saveTexture[slot] != null) loadgame (slot); } //       - .       , //         </span></span></code> </pre><br><br><img src="https://habrastorage.org/getpro/habr/post_images/9a0/4ee/508/9a04ee50880d7871ab4ced67d33a8931.jpg"><br><br>  <i>Menu Load on SelectionGrid - looks no different from the corresponding Save</i> <br><br>  The main thing that I don‚Äôt like about this solution is that the slots in the boot menu that do not contain saves remain relatively active - they only differ in their lack of texture and react to pointing.  Therefore, the bonus is a grid with handles; instead of inactive slots, we draw Box, for the active Button. <br>  At the same time, we will add rubberness: the number of slots in a line is set, the size of slots is adjusted to the screen.  True, they are already square here, but it will be easy to embed an arbitrary aspect ratio :) Well, at the same time, min / max width / height from <a href="http://docs.unity3d.com/Documentation/ScriptReference/GUILayout.html">GUILayout</a> and other file processing. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> slotsAmount = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> hN = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> margin = <span class="hljs-number"><span class="hljs-number">20</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> vN = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)Mathf.Ceil((<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)slotsAmount/hN); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Texture2D[] saveTexture = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Texture2D[slotsAmount]; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> slotSize = ((Screen.width*vN)/(Screen.height*hN) &gt;= <span class="hljs-number"><span class="hljs-number">1</span></span>) ? Screen.height/(vN + <span class="hljs-number"><span class="hljs-number">2</span></span>) : Screen.width/(hN + <span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawSaveLoadMenu</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ GUI.BeginGroup (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rect ( Screen.width / <span class="hljs-number"><span class="hljs-number">2</span></span> - (slotSize*hN - margin) / <span class="hljs-number"><span class="hljs-number">2</span></span>, Screen.height / <span class="hljs-number"><span class="hljs-number">2</span></span> - (slotSize*vN - margin) / <span class="hljs-number"><span class="hljs-number">2</span></span>, slotSize*hN - margin, slotSize*vN + <span class="hljs-number"><span class="hljs-number">40</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; vN; j++) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>, curr = j*hN; (curr = j*hN + i) &lt; slotsAmount; i++){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (menutype == <span class="hljs-number"><span class="hljs-number">2</span></span> &amp;&amp; saveTexture[curr] == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) GUI.Box(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rect(slotSize*i, slotSize*j, slotSize - margin, slotSize - margin), <span class="hljs-string"><span class="hljs-string">""</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(GUI.Button(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rect(slotSize*i, slotSize*j, slotSize - margin, slotSize - margin), saveTexture[curr])){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (menutype == <span class="hljs-number"><span class="hljs-number">1</span></span>) savestuff(curr); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (menutype == <span class="hljs-number"><span class="hljs-number">2</span></span>) loadstuff (curr); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(GUI.Button(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rect(slotSize*hN/<span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">100</span></span>, slotSize*vN , <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>) , <span class="hljs-string"><span class="hljs-string">"Back"</span></span>)) menutype = <span class="hljs-number"><span class="hljs-number">0</span></span>; GUI.EndGroup(); }</code> </pre><br><br><img src="http://habrastorage.org/storage2/aad/0c8/b57/aad0c8b57229c2951547216e502c2c63.jpg"><br><br>  <i>Menu Load on Button and Box - now empty slots are inactive</i> <br><br><h5>  3.3 Textures, screenshots </h5><br>  So, since the creation of our menu object, we will hold an array of textures.  It takes a little memory and we are guaranteed instant access to it.  In fact, there is no special alternative here - do not push the same disk work in onGUI (). <br><br>  As we have already seen, when creating our menu, we also create an array: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Texture2D[] saveTexture = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Texture2D[slotsAmount];</code> </pre> <br><br>  We will save not only the information of the saves, but also information <i>about them</i> , or rather, which slots contain the save.  How to store - the choice of each, you can parameter 0/1 for each slot, you can string from 0/1, but we will make ugly :) and take the bit vector in int.  At what point and how it is saved, we will see later, while just reading. <br>  Add to Start (): <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> gS = PlayerPrefs.GetInt(<span class="hljs-string"><span class="hljs-string">"gamesSaved"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; slotsAmount &amp;&amp; gS &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>; i++, gS/=<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gS%<span class="hljs-number"><span class="hljs-number">2</span></span> != <span class="hljs-number"><span class="hljs-number">0</span></span>){ saveTexture[i] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Texture2D(Screen.width/<span class="hljs-number"><span class="hljs-number">4</span></span>, Screen.height/<span class="hljs-number"><span class="hljs-number">4</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    ,      saveTexture[i].LoadImage(System.IO.File.ReadAllBytes(Application.dataPath + "/tb/Slot" + i + ".png")); } //  , ,    ,  .</span></span></code> </pre><br><br>  Well, actually the most important thing in this question is how to save screenshots?  The version of <a href="http://docs.unity3d.com/Documentation/ScriptReference/Application.CaptureScreenshot.html"><code>Application.CaptureScreenshot</code></a> , but there are two tricks at once.  First of all, they are saved in full size, and since in the final analysis we need only thumbnails, it is more logical to resize right away.  Secondly, we hold the array of textures, will you have to read it again from the disk?  Not very cool. <br><br>  We will call the function of taking and recording a screenshot later, but for now we will select in Coroutine in advance: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-function">IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readScreen</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">yield</span></span></span><span class="hljs-function"> return new </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WaitForEndOfFrame</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-comment"><span class="hljs-comment">//     ,       :) int adjustedWidth = Screen.height * 4/3; // ,       Texture2D tex1 = new Texture2D(adjustedWidth, Screen.height); //        tex1.ReadPixels(new Rect((Screen.width - adjustedWidth)/2, 0, adjustedWidth, Screen.height), 0, 0, true); tex1.Apply(); //     Texture2D tex = new Texture2D(Screen.height/3, Screen.height/4, TextureFormat.RGB24, true); tex.SetPixels(tex1.GetPixels(2)); //        Destroy(tex1); tex.Apply(); saveTexture[i] = tex; //     FileStream fs = System.IO.File.Open(Application.dataPath + "/tb/Slot" + i + ".png", FileMode.Create); BinaryWriter binary = new BinaryWriter(fs); binary.Write(tex.EncodeToPNG()); //    fs.Close(); }</span></span></code> </pre><br><br>  Unpleasant unresolved moment - the texture from the current session and the texture loaded from the disk vary greatly in quality. <br>  Below to the left are two current sessions, to the right - two from the disk, from previous sessions: <br><img src="http://habrastorage.org/storage2/356/ef8/08c/356ef808c678dd6b93fcc07d4ca34408.png"><br><br><h5>  3.4 Actually save load implementation </h5><br>  So, it seems to have dealt with the husk.  We learned minimally how to work with the GUI, made a simple main menu, the Save / Load menu, and learned how to work with screenshots. <br><br>  How to implement the interaction between the objects of the scene, the parameters of which we will save and our menu? <br><br> 1.                 (, ,    ) ‚Äî     . <br><br> 2. <a href="http://docs.unity3d.com/Documentation/ScriptReference/GameObject.Find.html"><code>GameObject.Find</code></a>  <a href="http://docs.unity3d.com/Documentation/ScriptReference/GameObject.FindWithTag.html"><code>GameObject.FindWithTag</code></a>      ‚Äî / ‚Äî  .   ,        ‚Äî ,  ,        ,       /   ,         . <br><br> 3. &lt;      , !  &gt; <br><br>      .       .     ,      ,      . <br>      .        ‚Äî     //!,      ,        . <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">savegame</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i</span></span></span><span class="hljs-function">)</span></span> { PlayerPrefs.SetInt(<span class="hljs-string"><span class="hljs-string">"slot"</span></span> + i + <span class="hljs-string"><span class="hljs-string">"_Lvl"</span></span>, Application.loadedLevel); <span class="hljs-comment"><span class="hljs-comment">//    // ! Interface i = Camera.main.GetComponent&lt;Interface&gt;(); if (i != null) i.save(i); //     PlayerPrefs    menuMode = false; //    switchGameActivity(); //   //    .     . //   ,      . //           PlayerPrefs.SetInt("gamesSaved", PlayerPrefs.GetInt("gamesSaved") | (1 &lt;&lt; i)); StartCoroutine(readScreen(i)); //        }</span></span></code> </pre><br><br>    ,   -,   ,  -,   .  ,       ,    . <br><br>    .      ,       .    ,    -  :) <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadgame</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gameMode) <span class="hljs-comment"><span class="hljs-comment">//  Load  ,      switchGameActivity(); PlayerPrefs.SetInt("Load", i); //    ,    Application.LoadLevel(PlayerPrefs.GetInt("slot" + i + "_Lvl")); //    menuMode = false; gameMode = true; //  ,      }</span></span></code> </pre><br><br>   ,     : <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Interface</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Transform CurrentPlayerPosition; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> load = PlayerPrefs.GetInt(<span class="hljs-string"><span class="hljs-string">"Load"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// ,     if (load &gt;= 0){ //  -   load(load); PlayerPrefs.SetInt("Load", -1); //  Load } } public virtual void save(int i) { //          CurrentPlayerPosition = this.gameObject.transform.parent.transform; PlayerPrefs.SetFloat("slot" + i + "_PosX", CurrentPlayerPosition.position.x); PlayerPrefs.SetFloat("slot" + i + "_PosY", CurrentPlayerPosition.position.y); PlayerPrefs.SetFloat("slot" + i + "_PosZ", CurrentPlayerPosition.position.z); } public virtual void load(int i) { CurrentPlayerPosition = this.gameObject.transform.parent.transform; //        Vector3 PlayerPosition = new Vector3(PlayerPrefs.GetFloat("slot" + i + "_PosX"), PlayerPrefs.GetFloat("slot" + i + "_PosY"), PlayerPrefs.GetFloat("slot" + i + "_PosZ")); CurrentPlayerPosition.position = PlayerPosition; //   ,  } //     }</span></span></code> </pre><br><br>   ‚Äû - ‚Äú    : loadgame()   load()    ,      ‚Äî .      ‚Äî    .      load(),       ‚Äî    ,   Start()          . <br><br>  Farther.              . ,    : <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">InterfaceWAng</span></span> : <span class="hljs-title"><span class="hljs-title">Interface</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Start(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">save</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.save(i); PlayerPrefs.SetFloat(<span class="hljs-string"><span class="hljs-string">"slot"</span></span> + i + <span class="hljs-string"><span class="hljs-string">"_AngX"</span></span>, CurrentPlayerPosition.eulerAngles.x); PlayerPrefs.SetFloat(<span class="hljs-string"><span class="hljs-string">"slot"</span></span> + i + <span class="hljs-string"><span class="hljs-string">"_AngY"</span></span>, CurrentPlayerPosition.eulerAngles.y); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.load(i); Vector3 PlayerDirection = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(PlayerPrefs.GetFloat(<span class="hljs-string"><span class="hljs-string">"slot"</span></span> + i + <span class="hljs-string"><span class="hljs-string">"_AngX"</span></span>), PlayerPrefs.GetFloat(<span class="hljs-string"><span class="hljs-string">"slot"</span></span> + i + <span class="hljs-string"><span class="hljs-string">"_AngY"</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>); CurrentPlayerPosition.eulerAngles = PlayerDirection; } }</code> </pre><br><br> ,      .       PlayerPrefs      save() / load(),       .  For what?      2  -,     BinarySerializer. <br>    ‚Äî , , SQLite. ,  ,  js    ,   ,         .   ,   <a href="http://wiki.unity3d.com/index.php/SQLite"></a> . <br><br><hr><br><br>       : <br><br>  <br> <a href="http://docs.unity3d.com/">docs.unity3d.com</a> <br> <a href="http://wiki.unity3d.com/">wiki.unity3d.com</a> <br> <a href="http://forum.unity3d.com/">forum.unity3d.com</a> <br> <a href="http://answers.unity3d.com/">answers.unity3d.com</a> <br>  <a href="http://stackoverflow.com/">stackoverflow.com</a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and habr. </font><font style="vertical-align: inherit;">Thanks to them. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I hope all this will bring benefit to someone, and harm to anyone :)</font></font></div><p>Source: <a href="https://habr.com/ru/post/163071/">https://habr.com/ru/post/163071/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../163059/index.html">Symfony2cheatsheet or cheat sheet for working with Symfony2.1. *</a></li>
<li><a href="../163061/index.html">Facts and figures about Web Ready 2012</a></li>
<li><a href="../163063/index.html">Video digest of the latest gaming industry news | Geek Week # 5</a></li>
<li><a href="../163067/index.html">iOS application for the service "Cloud Storage"</a></li>
<li><a href="../163069/index.html">Forsyth Cloud Services: Myth or Reality</a></li>
<li><a href="../163073/index.html">Javascript: Draw with Bezier Curves</a></li>
<li><a href="../163075/index.html">HTC One X + - evolution in action</a></li>
<li><a href="../163077/index.html">Own repository for MODX Revolution</a></li>
<li><a href="../163079/index.html">The Pirate Party of Sweden has filed charges against banks blocking WikiLeaks payments</a></li>
<li><a href="../163081/index.html">Validation of forms with postal addresses - do not forget about Hong Kong</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>