<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The implementation of the condition "OR" in SphinxQL</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The SQL-like SphinxQL language does not yet support the ‚ÄúOR‚Äù clause in the ‚ÄúWHERE‚Äù statement. That is, when you query the search index can not write s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The implementation of the condition "OR" in SphinxQL</h1><div class="post__text post__text-html js-mediator-article">  The SQL-like SphinxQL language does not yet support the ‚ÄúOR‚Äù clause in the ‚ÄúWHERE‚Äù statement.  That is, when you query the search index can not write something like <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">`goods_index`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-string"><span class="hljs-string">`price`</span></span> &gt; <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-string"><span class="hljs-string">`price`</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre>  <i>select from the index all products with a price greater than 100 MNT or if the price is not specified</i> <br><br>  But the way out, of course, is: use calculations.  Let's rewrite the query for the example invented by me in this form: <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> *, <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span>(<span class="hljs-string"><span class="hljs-string">`price`</span></span> &gt; <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) + <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span>(<span class="hljs-string"><span class="hljs-string">`price`</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">`pricematch`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">`goods_index`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-string"><span class="hljs-string">`pricematch`</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre><br>  The trick is that the <code>pricematch</code> will always be equal to one if the price is above 100 or equal to zero, and to check the compliance of the record, it suffices to check the equality of <code>pricematch</code> one. <br><br>  Using such calculations in SphinxQL and traditional SQL queries, one can get out of the situation in other situations when the ‚Äúor‚Äù condition is necessary in the query. <br><br>  <b>update.</b> <br><br>  <a href="https://habrahabr.ru/users/artifex/" class="user_link">artifex</a> in comments provides a much more transparent and readable version of using OR in a SELECT statement: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> *, (<span class="hljs-string"><span class="hljs-string">`price`</span></span> &gt; <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-string"><span class="hljs-string">`price`</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">`pricematch`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">`goods_index`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-string"><span class="hljs-string">`pricematch`</span></span> &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre><br><br>  <b>update 2.</b> <br><br>  Faced a problem: an indexable attribute in the database is of type BIGINT.  The Sphinx config is described as <br><pre> <code class="sql hljs">sql_attr_bigint = myattr</code> </pre><br><br>  At the same time, such a request does not give the desired result, returning empty set: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> myattr &gt; <span class="hljs-number"><span class="hljs-number">87124599823547</span></span>;</code> </pre><br><br>  As with the condition ‚Äúor‚Äù, the transfer of the expression to the SELECT section helped: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> *, ( myattr &gt; <span class="hljs-number"><span class="hljs-number">87124599823547</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> attrmatch <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> attrmatch = <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre></div><p>Source: <a href="https://habr.com/ru/post/195918/">https://habr.com/ru/post/195918/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../195908/index.html">Common API for JUnit and TestNG</a></li>
<li><a href="../195910/index.html">First images of hydrogen bonds</a></li>
<li><a href="../195912/index.html">Communigate Pro - a platform for the most popular communication services</a></li>
<li><a href="../195914/index.html">BitTorrent Chat - now the FSB will not follow you!</a></li>
<li><a href="../195916/index.html">Observium - installation of a monitoring system</a></li>
<li><a href="../195920/index.html">iCub is a robole who can see, feel, learn and learn</a></li>
<li><a href="../195922/index.html">New courses virtual academy Microsoft Virtual Academy</a></li>
<li><a href="../195924/index.html">Used batteries can charge 140 smartphones</a></li>
<li><a href="../195928/index.html">WTF?</a></li>
<li><a href="../195930/index.html">Battle for Klozhuru or operation "Battle Magnet"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>