<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Visual logic editor for Unity3d. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 Hello dear readers, in today's article I would like to dwell on this phenomenon in the development of applications on Unity3d , such as...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Visual logic editor for Unity3d. Part 1</h1><div class="post__text post__text-html js-mediator-article"><h2>  Introduction </h2><br>  Hello dear readers, in today's article I would like to dwell on this phenomenon in the development of applications on <b>Unity3d</b> , such as visual development or, more precisely, development using visual presentation of code and logic.  And, before continuing, I want to clarify right away that we are not talking about visual programming, from the word ‚Äúabsolutely‚Äù, no <b>Blueprint</b> variations in the Unity world and no generations of C # code.  So what is meant by the visual editor of logic?  If you are interested in the answer to this question, welcome under cat. <br><a name="habracut"></a><br><h2>  What is a visual logic editor? </h2><br>  Very often, and some say that during development, programmers write a lot of different code that does a lot of different things, from system tools to game mechanics.  This code, if the programmer is ‚Äúreal,‚Äù is usually made unified and isolated so that it can be reused (within Unity, this code is the components, they are also <b>MonoBehior‚Äôs</b> heirs).  It is not difficult to imagine that there can be a lot of such code, especially if this is not the first project.  And now let's imagine that we are starting a new project and we need to make a lot of fast and different prototypes, and the team of programmers is limited, and the whole is busy with the main project or projects.  Game designers are indignant, they need to test, check, producers run around managers trying to get a programmer for themselves, money is limited, time is running, etc., etc. <br><br>  The other side of the coin, we (the programmers) wrote a lot of code in the form of components, they hang a large list on different objects of the scene.  And here we are expanding the team, hired a new programmer, he opens the stage to figure out and is drowning in the mess of questions: who causes whom, in what order, what component is connected with which and how, etc. You reasonably say: - ‚ÄúAnd Documentation? ‚ÄùDocumentation is (although not at all a fact), but here it is a question of the lowest possible entry of new people into the team, and the time for this process is as short as possible. <br><br>  How to solve the above situation?  The answer in the title of the article is the Visual Logic Editor.  What is it?  This is an environment that allows you to visually operate with various components of logic and adjust their interrelations (in the ‚Äúsoft‚Äù version), as well as indirectly from the scene to operate with objects of the scene.  If we describe it in a fabulously simple way, then it‚Äôs like in childhood to assemble different constructions from cubes (only in our case, the cubes are not rigidly interconnected, removing the lower one, our construction will not fall). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, we have dealt with the definition, but what does this give us in the end? <br><br><ul><li>  You can collect universal designs that can be reused in projects, which reduces the subsequent routine.  Imagine some kind of pure field, which is our project, we just take the assembled structure from another game, put it on the field and that's it. </li><li>  It is possible to create a base of isolated ‚Äúcubes‚Äù (mechanic, logician, functional) from which people who are not programmers could assemble the structures themselves. </li><li>  It is possible to replace constructions with others on the fly, thereby changing the behavior of logic. </li><li>  You can use constructions in deferred mode, for example, if the NPC is not present in the world now, then no logic associated with it will exist on our ‚Äúfield‚Äù. </li><li>  Since our cubes are not connected by rigid connections between each other, we can turn them off and turn on as we please and implement arbitrarily complex conditional and unconditional branching. </li></ul><br>  Well, that sounds pretty good?  And what about the reality?  If you open the <b>Asset Store</b> and see the <b>Visual Scripting</b> section, you can see, in principle, a large number of different plugins.  Most of them are variations on the Blueprint theme from the Unreal Engine, i.e. essentially code generation.  There are practically no systems that fit the concept of a visual editor of logic.  The closest ones are: <br><br><ol><li>  <b>Playmaker</b> .  Yes, this is the FSM plugin, but nevertheless, it allows you to write your Actions.  It is not so convenient from the point of view of the interface, but for certain things it is very good.  Blizzard knowingly used it in Hearthstone. </li><li>  <b>Behavior Designer / MoonBehavior</b> , etc.  state tree plugins.  Already closer to what was described above, but a lot of limitations, after all, the state tree is not full-fledged logic on the components. </li><li>  <b>Icode</b> .  This is an analogue of playmaker, that is, in fact, also a state machine. </li></ol><br>  Is there a way out, you ask, dear readers?  I found only one to write my system, which I did, but the path to it was rather long and thorny. <br><br><h2>  Way </h2><br>  The idea to develop a visual logic plugin for <b>Unity3D has</b> arisen for a long time.  At first it was just the thought that if it were like this, it would be cool.  These thoughts appeared in the process of working on a project in which there were a lot of similar games, more than 20 pieces that had to be done very, very quickly.  The first implementation was terrible in terms of the interface, although, of course, it allowed us to successfully develop the entire set of games at a given speed. <br><br>  For the next project, it was decided to do a full-fledged visual editor, but in the end, because of the small experience, the implementation was not successful, everything was wildly slowed down, the number of links, etc. things went off scale so that it was impossible to figure out where (see screenshot and do not be scared). <br><br><img src="https://habrastorage.org/webt/kj/gm/bk/kjgmbkaf2uoytuksxl1x2cevbmc.png" alt="image"><br><br>  After that, for some time the idea was postponed.  I have already done the following projects on clean code, but the idea was still in my head.  Gradually, taking into account past mistakes, the final (as it seemed to me) vision and list of requirements was formed.  And in 2017, after the completion of the next freelancing project, I decided that I can afford to spend 6-7 months to work on this plugin and try to put it in the <b>Asset Store</b> (it still lies and is called <b>Panthea VS</b> ).  From the point of view of work experience on such a complex project, everything was very cool, alas, the financial side is sad, after all being able to program and be able to sell, these are different things.  It was November 2017, after which I slightly lost my motivation, divorced, changed the city, completely changed my life, and in order not to fall into samoedstvo I decided to look from a different angle on the theme of the visual editor of logic.  The result was <b>uViLEd</b> , which I decided to post for free.  Since I signed a full-time contract, I had to work on it on weekends and holidays, and it took all of 2018 and the beginning of 2019.  <b>uViLEd</b> is a great rethinking of <b>Panthea VS</b> , full refactoring of the code under the Roslyn compiler (C # 7+), so everything works only starting from version 2018.3 of Unity3d. <br><br>  <b>Note</b> : Several projects came out on <b>Panthea VS</b> (Android and iOS, in particular Lev's Truck and Typewriters), in principle, the experience is good, but the moment came that it‚Äôs one thing to write an editor, another thing is to learn how to use it correctly (no matter how strange it sounds ). <br><br><h2>  uViLEd and how to use it </h2><br><h3>  Introduction </h3><br>  So, what I got in the end, first we look at the picture, and then we continue (there will be more pictures later). <br><br><img src="https://habrastorage.org/webt/ll/sk/g2/llskg2i3-e2niclqltvvh4csms4.png" alt="image"><br><br>  What is basically a visual editor of logic. <br><br><img src="https://habrastorage.org/webt/p0/pn/wn/p0pnwnewe_s-_vpu704ucuzaiso.png" alt="image"><br><br>  Here: <br><br><ul><li>  <b>Components</b> are our code that implements this or that functionality, in fact, an analogue of <b>MonoBehaviour</b> , only in our case all components are inherited from the <b>LogicComponent</b> class, which in turn is <b>ScriptableObject</b> . </li><li> <b>Variables</b> are such special <b>ScriptableObjects</b> that are allowed to store data (any, including custom structures and classes, links to scene objects, prefabs and assets).  Variables are needed if it is necessary to make the data shared between components, that is, each component can refer to a variable of the desired type, and it will be one. </li><li>  <b>Relationships</b> are descriptions in visual form of which components, how and in what order the methods of each other are called.  The relationships between components are defined using two specialized fields of the types <b>INPUT_POINT</b> and <b>OUTPUT_POINT</b> .  A link is always formed as the output point of a component at the input point of another component.  These links are not rigid, that is, they are not visible to the programmer and are not in the code either.  They are present, only in the editor, and then when the scene is started, the logic controller itself understands the code.  How this happens we will talk in a separate article. </li></ul><br>  Everything in a compartment ‚Äî components, variables, and connections ‚Äî form the <b>logic</b> .  In general, nothing supercomplex, the programmer writes the code of components and variables, and the game designer or another (and maybe the same) programmer / script creates the logic by placing these components in the editor and setting up links and parameters. <br><br><h3>  Key features uViLEd </h3><br><ul><li>  Running logic (a set of components, variables and connections) in deferred mode, including starting from an external source (hard disk or server) </li><li>  Configure connections between components (call order, activation and deactivation) </li><li>  Easy integration of components and any other code, including MonoBehavior heirs </li><li>  Redefining the appearance of components in the editor (analogue to CustomPropertyDrawer) </li><li>  Setup of parameters of components through the inspector Unity3d </li><li>  Simple addition of components to the logic via the Drag &amp; Drop script file or through the directory </li><li>  Component Grouping in Logic Editor </li><li>  Setting the display of components in the editor (inversion, minimization, activation and deactivation) </li><li>  Opening the component code editor directly from the logic editor </li><li>  Displaying debug data directly in the logic editor during startup in the editor </li><li>  Scaling visual logic editor </li><li>  If suddenly there are a large number of components in logic, then there is a possibility of searching them with focus when selecting (this also applies to variables) <br></li><li>  Step-by-step debugging in scene launch mode in the Unity3d editor with tracking of all transmitted data between components and variable values </li><li>  Supports MonoBehaviour methods and setting the order in which they are called.  <b>Note</b> : here it is meant that by default there are no methods of type Start, Update, etc. in SO.  therefore, their support has been added to the components themselves.  In this case, using the ExecuteOrder attribute, you can customize the order in which the Start, Update, etc. methods are called. </li><li>  Support for Coroutine, async / await and all Unity3d attributes for the inspector, as well as support for CustomPropertyDrawer </li></ul><br><h3>  Work with the editor </h3><br>  To start working with the editor, you need to open the scene and then start the editor itself. <br><br><img src="https://habrastorage.org/webt/17/w5/s3/17w5s38ymve2zxwovfycnluasjw.png" alt="image"><br><br>  After launching the editor, we initialize the scene (the refresh button in the editor), after which it will be possible to create or add existing logic to the scene. <br>  After creating the logic (the file that will describe the components, their parameters, relationships between components, variables and their values), you can fill it with meaning.  To add a component or variable, simply drag the corresponding script into the area of ‚Äã‚Äãthe logic editor.  An alternative option is to use a directory that is generated automatically using the <b>ComponentDefinition</b> attribute. <br><br><img src="https://habrastorage.org/webt/ip/bh/oo/ipbhooqxvj2dkl7fu3ni7bgzhl0.png" alt="image"><br><br>  After we have added several components to the logic, they can be moved, including groups or combined into a visual group. <br><br><img src="https://habrastorage.org/webt/8w/ph/h4/8wphh4i-jnvymggo5hrfqlc562g.png" alt="image"><br><br>  Let us consider in more detail what we are representing the component itself in the visual editor. <br><br><img src="https://habrastorage.org/webt/fo/nd/gd/fondgdse7kf9r_71dlpjmm8in0u.png" alt="image"><br><br>  Here: <br><br><ul><li>  The component's menu button opens a drop-down menu with which you can: <br><ul><li>  Activate or deactivate the component </li><li>  Minimize the component (you can also do this by double clicking on the title) </li><li>  Invert component (swap input and output points) </li><li>  Hide or show component parameter area </li><li>  Open the component code editor. </li></ul></li><li>  The component parameter area is the place where the values ‚Äã‚Äãof the key component parameters are displayed, the composition of which depends on the programmer. </li></ul><br>  To configure the parameters (public fields or fields with the SerializeField attribute), you need to select the component in the logic editor and open the Unity3d inspector. <br><br><img src="https://habrastorage.org/webt/iz/fx/ep/izfxeppsnvrwpakv2xocjgueo-m.png" alt="image"><br><br>  Here: <br><br><ul><li>  In the upper right corner there is a button that allows you to change the color of the header, which is displayed in the logic editor. </li><li>  <b>Name</b> - field to set the name of the component instance </li><li>  <b>Comment</b> - the field for setting a comment to the component instance, is displayed in the logic editor when you hover the mouse cursor over the component </li><li>  <b>Component Parameters</b> - the area where the component parameters are displayed (public fields and fields marked with SerializeField) </li><li>  <b>Variable Links</b> - an area for setting references to variables (for more details, see the section on working with variables). </li></ul><br>  In order to visually group objects you need to select them, and then press the right button and select the corresponding item in the menu.  Groups can be renamed, as well as change their colors. <br><br><img src="https://habrastorage.org/webt/qk/z8/yx/qkz8yxb7mo5rq7zgfanosvd_lak.png" alt="image"><br><br>  To scale the visual representation of the components, use the mouse wheel, everything is quite simple. <br><br>  And the last thing I want to draw attention to is working with links between components. <br>  To establish a connection, it is necessary to connect the output point of one component to the input point of another. <br><br><img src="https://habrastorage.org/webt/oj/xa/po/ojxapozb2kopugx2k-hq8r7aosk.png" alt="image"><br><br><img src="https://habrastorage.org/webt/kc/jg/r5/kcjgr55qxhg8mgt87c8v8yqli8a.png" alt="image"><br><br><img src="https://habrastorage.org/webt/nw/7b/sf/nw7bsf7vc7paqif6jhgx6fkxnr8.png" alt="image"><br><br>  Links are established based on the type matching rule that the point transmits and receives.  An exception is made for an input point that does not accept data; any output point can be connected to it.  When a connection is established, the system automatically checks the type match and shows whether it is possible to establish this connection.  Input and output points are specified in the component code using the following classes: <br><br><pre><code class="cs hljs">INPUT_POINT OUTPUT_POINT INPUT_POINT&lt;T&gt; OUTPUT_POINT&lt;T&gt;</code> </pre> <br>  The first two classes are used for the input and output points that do not accept parameters, the second, respectively, vice versa.  T can be any type. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> INPUT_POINT &lt;<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>&gt; InputFloatValue = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> INPUT_POINT&lt;<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> OUTPUT_POINT &lt;<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>&gt; OutputFloatValue = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OUTPUT_POINT&lt;<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>&gt;();</code> </pre><br>  In order to call a chain of links, you must use the function Execute. <br><br><pre> <code class="cs hljs">OutputFloatValue.Execute(<span class="hljs-number"><span class="hljs-number">5f</span></span>);</code> </pre> <br>  In order to handle such a call, in the component code you need to install a handler for the input point (about exactly where we will talk later). <br><br><pre> <code class="cs hljs">InputFloatValue.Handler = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> =&gt; Debug.Log(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>);</code> </pre> <br>  And in conclusion, I want to mention an important point about connections.  If there are several connections from one point, then the editor has the ability to customize the order of their call. <br><br><h3>  Work with variables </h3><br>  As mentioned earlier, variables are special objects that allow data to be shared between components through references to them.  Variables, like components, are created by programmers. <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">ComponentDefinition(Name = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Float"</span></span></span><span class="hljs-meta">, Path = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"uViLEd Components/Base/Variable/Base"</span></span></span><span class="hljs-meta">, Tooltip = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Variable for a floating-point number"</span></span></span><span class="hljs-meta">, Color = VLEColor.Cyan)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">VariableFloat</span></span> : <span class="hljs-title"><span class="hljs-title">Variable</span></span>&lt;<span class="hljs-title"><span class="hljs-title">float</span></span>&gt; { }</code> </pre><br>  As you can see, the base class for variables is the generic class Variable, where T is the data type that is enclosed in a variable, T can be any type that can be serialized. <br><br>  In the editor, variables are displayed as follows: <br><br><img src="https://habrastorage.org/webt/gu/nr/7u/gunr7u-e2ilyib-1whqiepzokpm.png" alt="image"><br><br>  To change the display of the values ‚Äã‚Äãof a variable, simply override the ToString method in the T type. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> CustomData { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Value01; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Value02; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CustomData</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value01, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value02</span></span></span><span class="hljs-function">)</span></span> { Value01= value01; Value02= value02; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stringBuilder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); stringBuilder.AppendLine(<span class="hljs-string"><span class="hljs-string">"Value01 = {0}"</span></span>.Fmt(Value01)); stringBuilder.Append(<span class="hljs-string"><span class="hljs-string">"Value02 = {0}"</span></span>.Fmt(Value02)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> stringBuilder.ToString(); } }</code> </pre><br>  Thus, a variable of this type will look like: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">VariableCustomData</span></span> : <span class="hljs-title"><span class="hljs-title">Variable</span></span>&lt;<span class="hljs-title"><span class="hljs-title">CustomData</span></span>&gt; { }</code> </pre> <br>  In order to add a reference to a variable in a component, you must use a special class. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> VARIABLE_LINK&lt;CustomData&gt; CustomVariableLink = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> VARIABLE_LINK&lt;CustomData&gt;();</code> </pre> <br>  After that, the link can be set in the inspector, while in the drop-down menu, I will show only <b>CustomData</b> variables, which greatly simplifies working with them. <br><br>  For the convenience of working with variables, there are special methods that allow you to determine when a variable has changed its value or when any data has been set to it. <br><br><pre> <code class="cs hljs">CustomVariableLink.AddSetEventHandler(CustomDataSet); CustomVariableLink.AddChangedEventHandler(CustomDataChanged);</code> </pre><br>  It is worth considering here that Changed works on the <b>Equals</b> condition, therefore, if structures and classes are used, this method must be redefined to ensure correct operation. <br><br><h3>  Work with Unity Objects </h3><br>  Due to the peculiarities of the uViLEd system, direct links to Unity objects cannot be used in it, since they cannot be restored when loading logic.  To solve this problem, a specialized <b>VLObject</b> shell was created that allows you to create such links, as well as save and load them.  Among other things, this shell has a special property editor that allows you to get components from any scene object (see the figure below) if you want to access them.  With <b>VLObject,</b> you can store links not only to scene objects and their components, but also to prefabs and resource files, such as textures, sounds, etc. <br><br><img src="https://habrastorage.org/webt/3i/wl/d4/3iwld4qttgr3fjboody9ruyeeyi.png" alt="image"><br><br>  <b>Note</b> : if existing logic is used in another scene, the object references will be lost, including prefab references, because the scene acts as their repository.  This also needs to be taken into account if you plan to use logic as a template, in this case the best option would be to transfer the necessary references to it from the outside (for example, from logic tied to the scene). <br><br>  It is also possible to restrict the type of Unity object that will be set to <b>VLObject</b> .  This only affects the Unity inspector and is used for convenience. <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">SerializeField</span></span>] [TypeConstraint(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Button))] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> VLObject _button;</code> </pre> <br><h3>  Creating a logic component </h3><br>  In order to create a logic component, it is enough for a programmer to add a simple C # script file to a project (you can also create a component or variable right through the special menu in the Project tab) and change the code in it to the following: <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">ComponentDefinition(Name = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"MyComponent"</span></span></span><span class="hljs-meta">, Path = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"MyFolder/MySubfolder"</span></span></span><span class="hljs-meta">, Tooltip = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"this my logic component"</span></span></span><span class="hljs-meta">, Color = VSEColor.Green)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MyLogicComponent</span></span> : <span class="hljs-title"><span class="hljs-title">LogicComponent</span></span> { }</code> </pre><br>  As mentioned earlier, <b>ComponentDefinition</b> is an attribute that allows you to automatically generate a catalog of components, here it should be noted that Color (header color) is set in a string in the form of a HEX format. <br><br>  <b>LogicComponent</b> is the base class of all components, which in turn is a successor of <b>ScripatableObject</b> . <br><br>  Below is a simple example of a component that makes a branch on an incoming value of type bool: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">IfBool</span></span> : <span class="hljs-title"><span class="hljs-title">LogicComponent</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> INPUT_POINT&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt; ValueToBeChecked = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> INPUT_POINT&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> OUTPUT_POINT True = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OUTPUT_POINT(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> OUTPUT_POINT False = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OUTPUT_POINT(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Constructor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { ValueToBeChecked.Handler = ValueToBeCheckedHandler; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ValueToBeCheckedHandler</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { True.Execute(); }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { False.Execute(); } } }</code> </pre><br>  So, as can be seen from the code, we created an input point for the component, which takes a value of type bool and two output points that are called depending on what value we received. <br><br>  Perhaps you now have a question, what kind of <b>Constructor is</b> this?  I explain.  By default, <b>ScriptableObject</b> does not support <b>Start</b> , <b>Update</b> , etc. methods, but it supports the <b>Awake</b> , <b>OnEnable</b> , <b>OnDisable,</b> and <b>OnDestroy</b> methods.  So, <b>Awake</b> (as well as <b>OnEnable</b> ), in case <b>ScriptableObject</b> is created via the <b>CreateInstance</b> method, is always called, and this is actually the problem.  Due to the fact that an object is created in memory for serialization in the editor mode, it was necessary to exclude the work of the component code at that moment, therefore the <b>Awake</b> analogue was added in the form of the <b>Constructor</b> method, the same applies to the <b>OnDisable</b> and <b>OnDestroy</b> methods when deleting an object in the editor.  If you need to correctly handle the removal of a component (when unloading a scene, for example), you must use the <b>IDisposable</b> interface. <br><br>  In general, as you can see, there is nothing difficult in creating components.  This is a normal class, which can be any code you want.  In the particular case of the components in general may not contain input and output points, and communicate using global messages.  By the way, for this there is a <b>GlobalEvent</b> class in <b>uViLEd</b> - this is a message system based on data types (you can read more about it in my article). <br><br>  The last thing I would like to mention is the ability to configure the input and output points of the component, depending on the parameters of the component. <br><br><img src="https://habrastorage.org/webt/om/xi/0e/omxi0ebaaiuixhln-gpqmkdqz5g.png" alt="image"><br><br>  To do this in the component code, it is enough to implement one or both of the <b>IInputPointParse</b> and <b>IOutputPointParse interfaces</b> .  Below is a sample code of an abstract generic class for <b>Switch</b> branching components, output points are automatically created here, depending on the <b>SwitchValues</b> parameter. <br><br><div class="spoiler">  <b class="spoiler_title">SwitchAbstract class code</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SwitchAbstract</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; : <span class="hljs-title"><span class="hljs-title">LogicComponent</span></span>, <span class="hljs-title"><span class="hljs-title">IOutputPointParse</span></span> { [Tooltip(<span class="hljs-string"><span class="hljs-string">"input point for transmitting value, which should be checked"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> INPUT_POINT&lt;T&gt; ValueToBeChecked = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> INPUT_POINT&lt;T&gt;(); [Tooltip(<span class="hljs-string"><span class="hljs-string">"set of values for branching"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;T&gt; SwitchValues = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;T&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt; outputPoints = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Constructor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { ValueToBeChecked.Handler = ValueToBeCheckedHandler; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CompareEqual</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T first, T second</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> first.Equals(second); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetValueString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> outputPontName = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.ToString(); <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> UNITY_EDITOR </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (!UnityEditor.EditorApplication.isPlaying) { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (outputPoints.ContainsKey(outputPontName)) { outputPontName += " ({0})".Fmt(outputPoints.Count); } } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> return outputPontName; } private void ValueToBeCheckedHandler(T checkedValue) { foreach (var value in SwitchValues) { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (CompareEqual(checkedValue, value)) { ((OUTPUT_POINT)outputPoints[GetValueString(value)]).Execute(); return; } } } public IDictionary&lt;string, object&gt; GetOutputPoints() { #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> UNITY_EDITOR </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (!UnityEditor.EditorApplication.isPlayingOrWillChangePlaymode) { outputPoints.Clear(); } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (outputPoints.Count == 0) { foreach (var value in SwitchValues) { outputPoints.Add(GetValueString(value), new OUTPUT_POINT()); } } return outputPoints; } }</span></span></code> </pre> <br></div></div><br><h3>  Debugging logic </h3><br>  To debug logic, uViLEd provides several mechanisms: <br><br><ol><li>  Ability to display internal variables and their values ‚Äã‚Äãin the logic editor in the scene run mode.  To do this, use the <b>ViewInDebugMode</b> attribute <b>.</b> </li><li>  Ability to view the values ‚Äã‚Äãof logic variables in the scene run mode </li><li>  Possibility of step-by-step debugging of the call of links between components and viewing of the data that is transferred between them </li></ol><br>  For the last item in uViLEd, a special mode is provided, which is turned on when the scene starts. <br><br><img src="https://habrastorage.org/webt/vg/i2/rs/vgi2rsffppoc1zwyq4px7ojgmk0.png" alt="image"><br><br>  This mode, unfortunately, has certain limitations associated with the transition between scenes.  In this case, the debug data from the previous scene and the logic will be lost, and in the new one they will be displayed only from the moment when the logic is activated in the editor. <br><br><h2>  Conclusion </h2><br>  In this article I have tried to briefly introduce you to the development approach that I use in my current projects.  Despite the initial skepticism (and mine as well), practice shows much the convenience of its use, especially when prototyping.  Among other things, the work of game designers has been greatly simplified, they do not climb into the scene, do not poke objects to customize the gameplay, they create a separate logic with a set of variables and components in which they can easily tune everything.  Also of great advantage is the fact that in my projects, often the content is loaded from the outside.  Using the visual logic editor, I can update the balance of the gameplay without updating the main application, in some cases, the logic itself can be changed. <br><br>  For myself, I decided that a similar approach to development is quite possible to be, of course it does not apply to large projects, but it can be used there for some gameplay scripts to revitalize the world, in level design, etc. In my current projects (children's segment), he, so far, perfectly manifests itself. <br><br>  What next? <br><br>  This was the first part of a series of articles about the visual editor of the logic uViLEd, then there will be parts about: <br><br><ol><li>  <b>The core of the system</b> : how the logic is loaded, why the ScriptableObject is selected, how the API is organized, what it allows to do, etc., what difficulties have arisen and how everything has been solved. </li><li>  <b>Editor</b> : how it was developed, how it works, what problems and what solutions, etc. things that would be redone now. </li></ol><br>  Write in the comments if you have specific questions that you want me to consecrate in subsequent articles. <br><br>  <b>PS</b> : I tried to tell about the key points of <b>uViLEd</b> , if you have a desire you can read it by downloading the plugin from the Asset Store, there is complete documentation (though in English): user manual, guide for programmers and API. <br><br>  <a href="https://assetstore.unity.com/packages/tools/visual-scripting/uviled-visual-logic-editor-137517">Visual Logic Editor uViLEd</a> <br>  <a href="https://habr.com/ru/post/282524/">Global Messaging Article</a> </div><p>Source: <a href="https://habr.com/ru/post/448190/">https://habr.com/ru/post/448190/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../448180/index.html">Tools for good wifi. Ekahau Pro and others</a></li>
<li><a href="../448182/index.html">The candidate's experience in recruiting software developers. Part 1</a></li>
<li><a href="../448184/index.html">Security Week 16: Digital Identity Theft</a></li>
<li><a href="../448186/index.html">From process modeling to designing an automated system (Part 2)</a></li>
<li><a href="../448188/index.html">Time Capsule: HP iPaq h1940 out of the box. What does a PDA from the 2000s do?</a></li>
<li><a href="../448192/index.html">Why do we need the production of AR and VR</a></li>
<li><a href="../448194/index.html">The candidate's experience in recruiting software developers. Part 2</a></li>
<li><a href="../448196/index.html">The future (or secret present) of plasma engines or how to achieve 27 max moves in the atmosphere</a></li>
<li><a href="../448202/index.html">Manage generator or fight against ADC in STM32F030</a></li>
<li><a href="../448206/index.html">Modular development or the way there, not back</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>