<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Practical MySQL optimization: measure to speed</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Petr Zaitsev (Percona) 
 Today we talk about performance. 

 We will look at how to approach MySQL correctly, as well as look at some practical approa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Practical MySQL optimization: measure to speed</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/2be/569/f74/2be569f74df17c5bfa65d66a97ce3507.jpg"><br><br><h3>  Petr Zaitsev (Percona) </h3><br>  Today we talk about performance. <br><br>  We will look at how to approach MySQL correctly, as well as look at some practical approaches to this matter.  Why do I think this is important?  The fact is that when you have a specific problem, you want, for example, to ask: "And what should I set the cache size in MySQL?".  Such a question can always be entered into Google or Yandex, and get a reasonable answer to it.  But how to get an answer about general, about the analysis and optimization scheme of MySQL?  It is much more difficult. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/08b/f39/258/08bf392584296694eb2ef62da081938b.png"><br><br>  The first thing you need to know about is that the performance of MySQL itself is not really important.  And here I look, the young man from behind smiles: ‚ÄúHow is that?  Important, sort of.  What are we talking about if it is not important? " <br><br><img src="https://habrastorage.org/getpro/habr/post_images/243/682/b70/243682b70e0ace67e4541bb4afb9c7e7.png"><br><br>  In fact, your users, your boss is important, first of all, the performance of your application, which uses MySQL, and may use some other system.  And this is something that makes sense to focus on, because if you look at the problem from the point of view of the application, then some other, broader approaches open up.  Maybe MySQL does not use in some cases, or use it wrong. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1d5/a1a/9ef/1d5a1a9ef116bce143deee3e5d520f3c.png"><br><br>  It is also important that application performance is always important.  In some cases, I speak with people, and they tell me: ‚ÄúHere, you know, this is our report.  Its performance is not important to us, it takes us a minute, two or three - everything will suit us. ‚Äù  But if you ask them: ‚ÄúGuys, and if this report takes you a month, will that suit you?‚Äù.  They say: "No, of course, not satisfied."  So, performance is important, just in the minds of some people, important performance means that we can execute any request in milliseconds or in seconds.  People often do not think that even those processes that take minutes and hours can also be performance critical.  And why is this important?  Because often, when we do some database algorithms, write some queries, their complexity can return non-linearly with respect to the amount of data.  Those.  it may be that our data volume has increased only 10 times, and the speed of the query has increased 100 times.  Creating a surprise and surprise that we did not expect such brakes at all. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/499/e26/c74/499e26c74f784bccdd1c0a58126968af.png"><br><br>  What else is important?  That performance and applications may not necessarily be related to MySQL.  With this, I also have an interesting case.  I remember coming to the client, looking at their MySQL server.  And, it seems, everything is fine with them, there are no long queries, the server load is less than 10%, and I ask them: ‚ÄúGuys, why do you think that this is MySQL in general?‚Äù - ‚ÄúWell, this is how old we are we are engaged, always all the problems of performance - it is always with MySQL, so we go there and dig. "  Sometimes yes, but in some cases not. <br><br>  It is also important that even if there are problems with MySQL, often the solutions may not be related to MySQL.  For example, many of you know Andrei Aksenov from Sphinx.  Most of his business, especially in the early years, is to save MySQL-users who tried to use MySQL full text search for a long time and persistently.  But this little elephant does not fly, how not to try with it, not to try to make it work, it will not scale.  In this case, for such tasks as full-text search, using Sphinx is a more reasonable solution. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d30/a70/fb7/d30a70fb7da3b2b43a85ab75207b8233.png"><br><br>  And there are actually a lot of such tools now that allow solving various tasks that MySQL does not solve very well.  Those.  Full text search, there is Sphinx elastic Search - another option.  For some tasks, Redis or Tarantool is much better suited.  If we are talking about data analytics, then Hadoop or Vertica solution, or some systems that normally process data in parallel, is often appropriate.  Because MySQL performs any query only in one thread on one server, which, of course, does not scale to large volumes at all. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5eb/bfb/bb4/5ebbfbbb4dafc8766b4465ae8c81b895.png"><br><br>  When we talk about performance, what are we thinking about?  First of all, we think about response time.  Why?  Because if you look at your selfish user, this is what he thinks about first of all.  Those.  if I go to the website or work with the application, and this application answers me quickly, then that's all that worries me.  Your every queries per second, the number of requests per second and other user's garbage are of little interest. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/318/b34/b76/318b34b76486edeef78ab4717ee69456.png"><br><br>  Those.  First of all, we look at the application and want it to respond to the user with a response time, which can be different for different applications for different tasks.  There is no definite figure that the response time in half a second is good, and anything more is bad. <br><br>  But if we are talking about real-world applications, then often we consider not only the response time, but also other things.  The first question is that we want this response time to be stable.  Those.  I encounter very many cases that the problem is not that the response time is always bad, but that sometimes something happens to the system or outwardly that worsens it.  For example, people often complain that everything works well for me, but when I run a backup, everything starts to be bad for me.  It is necessary to follow such things.  Or it is often associated with some things like a download spike, i.e., maybe the website was shown on some well-known television program, or someone else mentioned it, traffic rushed, the system fails. <br><br>  The next question we often ask about performance is scalability.  Many, many applications start with fairly small systems.  A small amount of data, a small amount of users, they have plans to grow.  It is important for us that those algorithms, those requests, those designs, schemes that we use, not only work now, but also work on the application of the future.  And some of the approaches that are most optimal today, on the current volume of data, may be good, but do not scale. <br><br>  And the third point is efficiency, which is also important.  Efficiency, both in terms of resource use and in terms of the people who are required to create this architecture.  For example, an interesting option with Hadoop.  Now Hadoop is already better, but traditionally, when Hadoop was just beginning, it skated to thousands and thousands of nodes.  But if we compare the efficiency, for example, MySQL with Hadoop, then MySQL on one node could do the same thing as Hadoop by ten.  And it is clear that if the data volume is small enough, then using MySQL would be much more efficient.  But if we need something that does not fit onto one server, then from the Hadoop point of view, we can run 1000 or 10 000 nodes.  We can't do that with MySQL. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5b6/d25/810/5b6d2581064f39d3b646b664bc3d0f1a.png"><br><br>  In terms of our scalability, we have already talked about the load, about the size of the data, and even more important is scalability in terms of infrastructure.  What is there to say?  That depending on what mode you are in, this or that infrastructure may be available to you.  For example, in many cloud networks we cannot scale up so easily.  It‚Äôs hard to say: ‚ÄúI want to put a server in which we will have 64 cores, 1 TB of memory, 4 very-very fast flash cards, so that I can receive 10 TB of local fast flash‚Äù.  If you work in your data center, and you have a choice of infrastructure, you can get it, you can connect such a server with 40 GB Ethernet, or even not one.  If you are working in the cloud, then you may have completely different restrictions with which you have to work. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8be/a00/270/8bea00270112ac6308086297576aa4ff.png"><br><br>  The next point we often face.  When we develop real-world applications, we often have performance - this is an important thing, but it is not the only thing that we have to take care of.  For example, security.  Security, traffic encryption usually does not improve performance, but, on the contrary, these are things that can degrade performance that you have to put up with. <br><br>  Handling is another moment.  Those.  often the most optimized code and structures - you will understand its figs later.  In many cases, we find that people do not want to super optimize performance if this makes the code too complicated.  And there are other different things to be reckoned with.  For example, there may often be some audit needs, in connection with which any changes to the data must be logged, which adds additional features that cost us something in terms of performance. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/53e/06a/1b6/53e06a1b6fc2d61e075eb51e1581043e.png"><br><br>  The next point is worth mentioning.  This is what performance is the one thing that can be improved endlessly.  There is no system that is maximally optimized, and in which, having spent a lot of money and time, it is still impossible to improve performance by at least a few percent.  This means that we need to always know when to stop, otherwise we will simply waste resources completely useless.  This means that we need to somehow determine what efficiency we need, system performance, etc.  And when it is reached, we can stop. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ffe/6d3/f23/ffe6d3f232b219a7f1d575fd759169ee.png"><br><br>  Next moment.  Moving on to MySQL.  We said that the response time of the system is important.  Now let's see what MySQL, in general, does for its users.  And it makes it very simple - we execute queries on MySQL, selects, updates, inserts, and it responds to us after some time.  And everything related to the performance of MySQL can be characterized by this response to queries. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/956/b7e/895/956b7e895e9614fef2b5becf47d00351.png"><br><br>  It is clear, at different loads, with different data volumes, etc.  But if we look at these requests and look at their response time and focus on this in terms of optimization, we will get the results that can be obtained. <br><br>  When do we talk about MySQL optimization?  Probably worth saying one thing that is not on this slide.  This is about the fact that the best question to optimize something is not to do it.  Obviously, you heard a lot from anyone, but what is interesting from the point of view of MySQL is that if I come to most people, we will take the application to turn on the MySQL-log and load the page.  In most cases, I will find several requests that will be repeated.  You know that they can be easily removed because the second query is useless.  Often I will see that the data is requested from the database and the application is not used.  But why?  ‚ÄúWell, here, I have this class initialized there, it raises everything from the database, just in case, but in fact we don‚Äôt use it.‚Äù  Very often in applications a heap-heap of garbage is made that nobody needs.  But what about when we focus on optimization, what do we often work on?  The first, very simple point is that we want our questions to run faster, another thing is we want them to use less resources, for example, less memory, or with the help of compression we can optimize the system so that it uses less disk space.  Or better scalability in terms of iron, in terms of data size, etc. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/079/ac0/850/079ac0850afe74a7c1c2446ea43e6b24.png"><br><br>  If we are talking about optimization and a general approach, we often look at two things.  The first is transaction optimization.  For example, you have an application, and someone says: ‚ÄúYou know, we have such a search function or an archive that slows down, works slower than we would like.‚Äù  We can look specifically at this function, what it does queries on MySQL, and optimize them.  Another option is to say, but let's, we will optimize the application in general.  Then we can take a look at all the queries that come to MySQL, see which ones are the slowest, which use the most resources, and when we optimize them, it is obvious that our system will work faster in general.  But at the same time, if we use the second approach, we have no guarantees how optimized our braking process will be, because maybe it doesn‚Äôt create much pressure, maybe it‚Äôs some kind of analytics that the big boss looks at. once a day, and it is 0.01% of the load, but, nevertheless, it is very important. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/657/ed3/5af/657ed35aff4369c79f675ca016cc769a.png"><br><br>  And it is clear that from the point of view of overall optimization, we look at requests, we prioritize them and further optimize them. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/143/d71/a38/143d71a382ddac3a65271c6c5d75f874.png"><br><br>  In terms of requests.  As I already said, the first question from the point of view of requests: can we avoid these requests?  Because often some requests are useless.  The second question: can we change these requests so that they do less work?  What does less work mean?  This means that they scan fewer lines, read less data from disk, etc.  - we call all this the simple word ‚Äúwork‚Äù. <br><br>  What example can we have?  We have a query that runs without an index, it does a lot of work.  The index we added - the query does less work.  When it really is that simple, add an index or change MySQL settings.  In other cases, it may be something more complicated, for example, we may have a bad data scheme that does not allow us to add an index so that the query is executed quickly.  Then we have to change the data schema, not just the query indexes.  Sometimes we have to use some other approach, for example, caching.  We can cache data, we can make some kind of summary table, a table into which we have progressed all our results, instead of bluffing the data many, many times every second. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5ce/779/906/5ce7799060394d06ba7a85de0fc4cddf.png"><br><br>  The next optimization question is: what is important?  The first is that you should not look only at the average query time.  Because the average execution time of any query is rarely a problem, first of all, the problem begins with some, I do not want to say extreme conditions, but close to that.  For example, I remember the guys from Flickr (a relatively old, but large hosting for pictures) told me that they had problems when a friend sent them 1 million pictures through the API.  It is clear that what worked for normal users is normal, in the category of 1 thousand, 100 pictures, with 1 million pictures not working anymore.  From the point of view of the average request, the average user, it would not seem. <br><br>  The next point is that we also want to look at trends over time, because some problems occur cyclically, maybe this is due to monthly billing, maybe this is due to the fact that you delete old data once a week, and it can show Problems. <br><br>  Again, when we look at requests, we should think about the future.  Especially in development systems.  I very often encounter the fact that developers test queries on some small databases in their test configuration and do not read the explain in MySQL well.  In this case, when their requests are laid out on the production or a little later, when the data starts to grow sharply, it all breaks down.  It is necessary to learn to read explain and think, and how these requests will work in the future. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/585/c2b/bf7/585c2bbf7105777dd710b807750d9992.png"><br><br>  Next moment.  It is clear that we want to use fewer requests.  Even if we analyze the same number of rows, the fewer queries we can use, the better.  Because with each request we add network response time, we add an additional overhead to parsing requests, to check privileges and so on.  We also want to read and modify as little data as possible.  Those.  If we can fulfill the request of limit 10, for example, then this is much better than reading all the data, just read the first few lines in the application, and throw out the rest. <br><br>  The same goes for the fact that it is better to read only those columns in the database, those columns that the application actually uses.  Because MySQL can use other advanced optimizations in these cases and execute queries more efficiently. <br><br>  Farther.  The less we can process data during the execution of queries, the better.  Again, heavy queries that make some complex aggregations for each user every time are not very good for large aggregations, it‚Äôs better to see how we can create them like cache tables, etc. <br><br>  What can you look at?  What interesting metrics we have?  The first is that we can see how much data MySQL analyzed regarding how much it sent them to the client.  This metric is easy to get from MySQL.  There is for each query, for example, in the slow query log data Rows_sent and Rows_examined.  The relationship between them is what we want to look at.  If we have an attitude anywhere from 1 to 10, the application as a whole is usually well optimized.  If we process 100, or even 1 thousand, for each line we send from MySQL, then most likely we have many opportunities for optimization. <br><br>  The next point is to see how much data we actually had sent from MySQL regarding how much was used by the application.  Here, unfortunately, there are no metrics that MySQL gives, because MySQL gave the data, and it no longer knows how you use them.  But often you can look at it yourself, at least for the most heavy queries that return a lot of data.  Those.  If you counted 1 million lines per application, you should think well, and do you all use them there?  It is unlikely that one million elements are shown on one page.  Maybe they are somehow aggregated and in this case it is often better to do this work on a database. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c83/bcd/099/c83bcd099da5b6d6ed1199aa95804853.png"><br><br>  Next moment.  As we have said, it is not always possible to optimize queries, simply by adding an index, we often have to change the circuit more dramatically, so it often makes sense to look at the optimization of the schema and query optimization together.  And there are two things here: <br><br><ol><li>  these are small schema optimizations - add an index, maybe change a column type or something else, change storage enigne in MySQL; </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a strong change in the design and the whole architecture, which is also sometimes necessary, but it usually requires much more serious planning. </font></font> Those.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> if you do a complete reengineering of your circuit, then it takes considerable time. </font></font></li></ol><br><img src="https://habrastorage.org/getpro/habr/post_images/9a8/aa5/005/9a8aa5005e7c371fc85e64a4f4992647.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In terms of database schema. </font><font style="vertical-align: inherit;">You need to know how indexes work. </font><font style="vertical-align: inherit;">I give a </font></font><a href="http://bit.ly/1rAtamE"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link to my presentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> about this.</font></font><br><br>  Next moment.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When you are developing a scheme, think about what requests you will have to be executed. Very often, I see what people do, in the code they use IR tools, which makes it completely abstract and ‚Äúacademically‚Äù correct database structure, which, unfortunately, does not work. You can start with this, but it is rarely possible to finish it. We need to look at how your requests work on this, and think further. And you can see different techniques, Partitioning &amp; Sharding, normalization, data denormalization, etc. These things need to enter into Google and read about them. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/635/18b/5e2/63518b5e2dd47fa2d4c1f18414a6170e.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Other things that we also have important - of course, infrastructure, OS, MySQL version, MySQL configuration. And we will talk about this in a bit more detail.</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/52e/108/942/52e108942e99157a06d8be9f3885b69e.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If we have a system that needs to be optimized, how do we approach this when we are often called in terms of consulting? Firstly, there are simple things that can be changed very quickly, and this is often enough. Change the MySQL settings, maybe the OS, add some indexes, maybe turn on some caching - and these are things that can often be done in just a matter of hours. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The next question, which is more complicated, if we need to buy a new hardware or do some reconfiguration of the network, change the OS to a newer one, or upgrade MySQL. These are more complex things that take days.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And, finally, there are times when things are so bad, when even this is not enough. Then we need to go to the heavy artillery, we may have to completely redo the database schemas, or we have to change the architecture of the application, to say that ‚Äúyou know, we now do sharding, for this we decide not to use MySQL‚Äù and that .d </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you look at the many applications that have grown, they often go through such steps. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/df4/cfc/e61/df4cfce61a948c29298a0188a131595a.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">About the infrastructure. Here you need to understand what options you have, whether you can scale with one node for a while, or you need to switch to an architecture that can run on many small machines, such as, for example, often in cloud structures. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/b9e/2c0/1c4/b9e2c01c46e7d4a2807c81fe80be0238.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What we have in terms of iron? These components are important to us:</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/0bc/68f/868/0bc68f8688033b628d2c481a4e99df5f.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">From the point of view of the processor. It is clear that now server processors are Intel. C MySQL, we see that the most commonly used system with two sockets for processors. What else is important? Since MySQL can use only one processor core for a single query, often for us fast processors are more important than processors with many, but slow, cores. Often this is forgotten. And also look at such a thing as turboboost, because modern processors, if not all of them are used for bark, but only one or two, then they can often work at a much higher clock frequency. And often it‚Äôs not the processor‚Äôs nominal frequency that is important for us, but to what extent they will do turboboost, because if we fulfill heavy requests, but who use only one bark, this will limit the performance.</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/054/a5c/224/054a5c224251db6938a64be1f0a37d25.png"><br><br>  Memory.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When we use database memory, we use it for cache. Therefore, if you have a lot of data, then we want a lot of memory too. Here it makes sense to think about - what is the ratio between the size of the database and memory. Do we have all of it or some part of it? It also makes sense to look at what part of the actively used data you have in memory. It is clear that often we have a large database, but its serious part is used very rarely, it is expensive to keep it in memory, so when I look at how well the database is stored in memory, I don‚Äôt really look at the ratio of database size in memory, but, rather, on how many I / O operations occur. Especially for reading, because if we have all the actively used database in memory, then read operations,which in the disk subsystem, we practically will not.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The following graph is interesting for you: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/869/4d5/c6a/8694d5c6afbd8b995b2ba91e65344dfe.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here we looked at the behavior of a certain synthetic benchmark with different amounts of memory and different configurations of the drive system.</font></font> Those.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we have blue - this is RAID, the slowest, red is the fastest FusionIO. What we see interesting? If the database is bad in memory, then a quick stack will give us a very big advantage, that is, we see that the difference is 5 times below. But when our data gets better and better in memory, then the difference between fast and slow storage is reduced. From this conclusion: if we have a chance to drive our working set into memory, then it is better to invest in memory. Have some flush, but maybe not the fastest. But if your data volume is already such that it is still not possible to drive into memory, then in this case it often makes sense to have some less memory, but to have a faster stack.</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/128/731/413/12873141305643cd1edf82c54cf9d9e8.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What should I say about storadzh? It is clear that now there are many different solutions. Probably, I will say only one important thing, that now, if you are using MySQL or other OLT databases, does it make sense to use Flash? about the wheels that are spinning, forgot.</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/283/ee9/44c/283ee944c7c1c7843d55c3f38be24b96.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">From the point of view of the network, the performance of the MySQL server is most often limited by the response time, and not by the throughput, especially given the fact that people often make quite a few queries in MySQL for each page. Often there are hundreds of requests, and in some cases I have even seen tens of thousands. From this conclusion that we want the best possible response time at our best, which means that we want our MySQL server and application server to speak as much as possible directly. The less network hops, the better. Placing, for example, an application server in one place, and a database in another, in different cities, on different continents, is a very bad idea, even if you are told that ‚Äúwe have our own optical fiber between them‚Äù. then Gbit. Because the speed of light is finite, and when we speak of microns or fractions of ms,she is already beginning to influence correctly.</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/bda/f84/c87/bdaf84c871913c811a3b0f945a00218e.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The choice of operating system. MySQL is most successfully used on Linux. Does anyone use MySQL on anything else? FreeBSD, Windows server. But most major projects use MySQL after all on Linux. In this case, it makes sense to use the server version of this OS, which is optimized for this, and which will not change every three months, and which must be constantly upgraded. And quite new, especially if you use new hardware, because everything related to flash, as far as support for the functionality of new processors is all supported in newer kernels, new distributions are much better than in old ones.</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/63b/d13/04a/63bd1304a20f5cc050e94ab256e205ed.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What is interesting from the point of view of Linux. In fact, its default settings for many MySQL loads are quite adequate. It is clear that if we go to some sort of Google, Facebook - the last 3-5% of performance is important for them, they invest a lot in tuning the kernel too, or often even compile it on purpose, or patch it, but for most people it is not so important. The file system - most often, we see, is used either EXT4 or XFS. At different loads, either one or the other may </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">show better performance, but these two file systems. And the </font></font><a href="http://bit.ly/MySQLonLinux"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> I talked about this in more detail. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/a49/432/7ad/a494327ad70f7eb180ffd024ec1356a2.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The next point is the MySQL version.</font></font> What you need to know?<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">That newer versions of MySQL usually improve performance. There are exceptions, i.e. if we use a single client thread and use very simple queries, in fact, since MySQL is getting thicker, trying to do more query optimization, the performance on such queries may not be significant, but it will be slower in new versions of MySQL. Last week MySQL 5.7 was released, which is very cool. There are a lot of improvements, both related to the optimizer, and with general scalability, i.e. if you want maximum MySQL performance, it makes sense to look at it, but when you upgrade, you can wait for Percona Server 5.7, which will also be released after a certain number of months. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/62d/b14/3cc/62db143ccbca3cb323ccbea207ac82ba.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL configuration. It is important here that the defaults in the MySQL configuration are bad.</font></font> Those.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">it is impossible to work with defaults for MySQL. </font><font style="vertical-align: inherit;">But at the same time, do not look at him: ‚ÄúFir-sticks! </font><font style="vertical-align: inherit;">There are 400 different settings here. ‚Äù </font><font style="vertical-align: inherit;">You will most likely need to fix 5-10-20 in order to get adequate </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performance. </font><font style="vertical-align: inherit;">Again, you can watch </font></font><a href="http://bit.ly/1vth5Cu"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my slides</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or webinar with more details on this. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/164/2e2/fae/1642e2fae612613c3a80cdc0f0facd89.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you are too lazy to look there, you can take these settings, enter them into Google, and you will easily find the answers to what you need to put in your configuration. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/b38/98f/80d/b3898f80d41dd0723169790710334869.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The next point is in terms of the process. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/ec2/b04/b7c/ec2b04b7c64bc29e5ed8e92712102c30.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There are two important things:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> First, developers need to be fed, because developers often make bad requests, which, when we post the code for production, create problems. </font></font> Those. ,     ,   -,    ,   ,   ,   .     . <br><br></li><li>    ,     ,      ,     ,        ,   ,    - . ,     - .  ,       - ,    ,    MySQL  ,  ,     ,    . -  , , ,  ,  ,  , ,  ,       ,     -  ,  ,  Linux -   . ,  ,  . </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/3b2/4f2/fb4/3b24f2fb4a56ada47b090420df5a889a.png"><br><br>  Next moment.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interestingly, with all these settings we have, no matter what we change - hardware, OS, MySQL settings - it always somehow affects query performance. Therefore, if you have some kind of monitoring, that you are looking at the performance of your requests regarding time, then you will always easily catch if something suddenly becomes bad. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/a9b/ca3/51d/a9bca351d575229fa2a5265da340fb42.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So these are the tools that can be used for this. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/922/4aa/b59/9224aab594311e6a7d47d598f07a1528.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I will show one option that we did recently. This is an integration from MySQL performance Schema with Graphite. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link - </font></font><a href="http://bit.ly/1KQSNWC"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://bit.ly/1KQSNWC</font></font></a> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/952/6dd/332/9526dd332903dba494b4f36962071a4b.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here, you see, you can see the total response time for any MySQL query, which is very useful, because if something starts to be bad for us, we will see that this query has moved, for example, a plan, now it takes us abruptly, 10 times the total execution time. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/8bc/471/17f/8bc47117f6ae9c94e041c57fe7f7bd4c.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/30c/aa0/658/30caa0658d6a46c4e4dbf29dd9a9ae79.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This is about our importance. </font><font style="vertical-align: inherit;">Look at the speed of application performance. </font><font style="vertical-align: inherit;">And here are some hints how you can optimize them. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/477/d43/49c/477d4349c0d658e6895d86badbafe510.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/0e0/b9e/be9/0e0b9ebe9e3c36bcb690095e7248350c.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link - </font></font><a href="http://www.meetup.com/moscowmysql/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://www.meetup.com/moscowmysql/</font></font></a> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e2e/470/8c3/e2e4708c322e09a42aa8b8e74fb8150a.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Link - </font></font><a href="http://bit.ly/PL16Call"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://bit.ly/PL16Call</font></font></a> <br><br><h3>  Contacts </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬ª </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pz@percona.com</font></font></a> <br><br><blockquote>  <font color="gray">This report is a transcript of one of the best speeches at the conference of developers of high-loaded <a href="http://www.highload.ru/%3Futm_source%3Dhabr%26utm_medium%3Dmedia%26utm_campaign%3Dbc.2017%26utm_content%3Dbc.mysql">HighLoad ++</a> systems.</font> <font color="gray"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Within the framework of the professional festival " </font></font><a href="http://ritfest.ru/%3Futm_source%3Dhabr%26utm_medium%3Dmedia%26utm_campaign%3Dbc.2017%26utm_content%3Dbc.mysql"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Russian Internet Technologies</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " we conduct a whole section on databases. </font><font style="vertical-align: inherit;">Now there are 16 reports in it, from which we need to choose 9. Here is what we have already chosen:</font></font></font> <ul><li> <a href="http://backendconf.ru/2017/abstracts/2781%3Futm_source%3Dhabr%26utm_medium%3Dmedia%26utm_campaign%3Dbc.2017%26utm_content%3Dbc.mysql"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Postgres vs Mongo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / Oleg Bartunov (PostgreSQL Professional);</font></font></li><li> <a href="http://backendconf.ru/2017/abstracts/2771%3Futm_source%3Dhabr%26utm_medium%3Dmedia%26utm_campaign%3Dbc.2017%26utm_content%3Dbc.mysql"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cards, money, two backups: data reliability</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / Nikolay Ikhalainen (Percona);</font></font></li><li> <a href="http://backendconf.ru/2017/abstracts/2777%3Futm_source%3Dhabr%26utm_medium%3Dmedia%26utm_campaign%3Dbc.2017%26utm_content%3Dbc.mysql"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Monitoring and debugging MySQL: maximum information with minimal losses</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / Light Smirnova (Percona);</font></font></li><li> <a href="http://backendconf.ru/2017/abstracts/2773%3Futm_source%3Dhabr%26utm_medium%3Dmedia%26utm_campaign%3Dbc.2017%26utm_content%3Dbc.mysql"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Overview of promising databases for highload</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / Yuri Nasretdinov.</font></font></li></ul><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Join us! </font></font></blockquote></div><p>Source: <a href="https://habr.com/ru/post/328458/">https://habr.com/ru/post/328458/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../328446/index.html">Cellular communication even in the taiga: three generations of mobile base stations</a></li>
<li><a href="../328448/index.html">29 reports DotNext 2017 Piter: From .NET Standard and containers to security and performance</a></li>
<li><a href="../328450/index.html">Implementation of simultaneous scrolling in all directions</a></li>
<li><a href="../328452/index.html">United Dev Conf 2017: results and useful materials</a></li>
<li><a href="../328454/index.html">IT training - current brain teaser'y leading companies</a></li>
<li><a href="../328460/index.html">Key announcements of the second day of the Build 2017 conference</a></li>
<li><a href="../328466/index.html">TypeScript on the server</a></li>
<li><a href="../328468/index.html">A selection of pieces based on artificial intelligence for personal use (1/3)</a></li>
<li><a href="../328472/index.html">Which map is faster, and is there an alternative to Judy</a></li>
<li><a href="../328474/index.html">DNA Security - Security built into the network infrastructure</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>