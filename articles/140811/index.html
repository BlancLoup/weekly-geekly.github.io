<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Mnesia - change table</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mnesia has a lot of useful things: it stores data in Erlang format, replication, transactions, etc. etc. But there is one problem - how to change tabl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Mnesia - change table</h1><div class="post__text post__text-html js-mediator-article"> Mnesia has a lot of useful things: it stores data in Erlang format, replication, transactions, etc.  etc.  But there is one problem - <i>how to change table structures?</i> <br><a name="habracut"></a><br>  When creating a table, you must specify a list of fields.  We will not go deep into recommendations to use record (record) with the same name with the table.  It is important that when changing the list of fields for the proposed documentation using <b>mnesia: transform_table</b> (converting fields and replacing the table definition), it seems you will have to stop the system, convert the table, change the application code to work with the new type and start (test). <br>  If you look at any SQL database, then adding a field is an elementary operation. <br>  For me it is important to make the transition to a new type without stopping the entire system.  At least, the database should function continuously. <br><br>  I researched reading and writing in Mnesia.  And the conclusion is: <br>  Mnesia tightly controls the data while recording.  You can only record what is declared in the table structure, otherwise it is an error.  The name of the record and the number of elements is controlled - i.e.  EVERYTHING. <br>  However, when reading, Mnesia gives away what was written, not referring to the currently configured list of fields and the title of the record.  And the list of fields can be changed without actually transforming the records using the non-recommended mnesia form: transform_table (Tab, <b>ignore</b> , Fildlist). <br>  This form is intended, according to the documentation, for custom transformation of table entries. <br>  Let's see how it all works.  For example, create a table, write the data, and then add new fields and transform with ignore: <br> <code>-module(recordtest). <br> -compile(export_all). <br> -record(r1 ,{f1,f2}). <br> -record(r2 ,{f1,f2,f3,f4}). <br> dbtest()-&gt; <br> mnesia:create_table(r1,[{attributes, record_info(fields, r1)}]). <br> transform()-&gt; <br> mnesia:transform_table(r1,ignore,record_info(fields, r2), r2). <br> <br></code> <br>  Test: <br><br> <code>14&gt; mnesia:create_schema([node()]). <br> 18&gt; mnesia:start(). <br> ok <br> 19&gt; recordtest:dbtest(). <br> {atomic,ok} <br> 20&gt; mnesia:dirty_write(r1, {r1,l1,l2}). <br> ok <br> 21&gt; mnesia:dirty_write(r1, {r1,t1,t2,t3}). <br> ** exception exit: {aborted,{bad_type,{r1,t1,t2,t3}}} <br> in function mnesia:abort/1 <br> 22&gt; mnesia:dirty_write(r1, {r2,l1,l2}). <br> ** exception exit: {aborted,{bad_type,{r2,l1,l2}}} <br> in function mnesia:abort/1 <br> 23&gt; mnesia:dirty_read(r1, l1). <br> [{r1,l1,l2}] <br> 24&gt; mnesia:dirty_read(r1, l1). <br> [{r1,l1,l2}] <br> <br> 38&gt; recordtest:transform(). <br> {atomic,ok} <br> 39&gt; mnesia:dirty_read(r1, l1). <br> [{r1,l1,l2}] <br> 40&gt; mnesia:dirty_write(r1, {r2,l1,l2}). <br> ** exception exit: {aborted,{bad_type,{r2,l1,l2}}} <br> in function mnesia:abort/1 <br> 41&gt; mnesia:dirty_write(r1, {r2,a1,a2,a3,a4}). <br> ok <br> 49&gt; mnesia:dirty_read(r1, l1). <br> [{r1,l1,l2}] <br> 50&gt; mnesia:dirty_read(r1, a1). <br> [{r2,a1,a2,a3,a4}]</code> <br> <br>  Now we have records of both types in the table and we can read them.  But if we now try to create an index on the fourth field of the <code>mnesia:add_table_index(r1,[l4]).</code> <br>  - get a fatal error, stop mnesia.  The next time you run this database, an error will occur again.  Removal of the file r1.dcm will help - after that mnesia will start.  You will still need to remove the table definition from the schema. <br>  Consequently, as long as all the records in the tables do not meet the index specification, in no case can you index them. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Based on the above, it can be argued that the transformation of the mnesia tables is quite a serious problem.  Apparently, it is necessary in advance, at the design stage, to provide for the modes of operation of the system for the transformation of tables. <br>  The possibility of functioning in a transient mode is also demonstrated, when both new type and old type records are placed in the table.  How exactly to complete the transition to a new record type (get rid of the old type of records) depends on the specific system. <br><br>  If anyone is familiar with the problem of changing tables in Mnesia - share.  There is very little information about Mnesia. </div><p>Source: <a href="https://habr.com/ru/post/140811/">https://habr.com/ru/post/140811/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../140806/index.html">BrowserQuest - multiplayer game on canvas</a></li>
<li><a href="../140807/index.html">WiGig broke the 1-watt barrier, will soon appear in smartphones</a></li>
<li><a href="../140808/index.html">Innovative ASUS solutions in the learning process</a></li>
<li><a href="../140809/index.html">Collection of JavaScript Patterns and Antipatterns</a></li>
<li><a href="../140810/index.html">Prototype, proto and new operator</a></li>
<li><a href="../140812/index.html">We refund money for the application in the App Store</a></li>
<li><a href="../140813/index.html">‚ÄúUltrabook. An autopsy showed "or" make your life easier "</a></li>
<li><a href="../140814/index.html">MegaFon call center in Penza</a></li>
<li><a href="../140815/index.html">Computer Aided Design (CAD). Who will win?</a></li>
<li><a href="../140816/index.html">Login form and registration using HTML5 and CSS3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>