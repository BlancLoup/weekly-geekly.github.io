<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Updating services running on Go</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I like to program on Go, but most of all now I like to program gobot for Raspberry Pi. Each change in the code requires some time for tedious operatio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Updating services running on Go</h1><div class="post__text post__text-html js-mediator-article">  I like to program on Go, but most of all now I like to program gobot for Raspberry Pi.  Each change in the code requires some time for tedious operations associated with updating the code.  First I have to stop the process, because Filezilla refuses to write to the executable file when the process is running, load a new executable file via SFTP and start it (this is not only tedious, but another 10-20 seconds of downtime when the process is stopped). <br><br>  A similar situation haunts me when developing for a regular web on Go.  It is in gobot that I have to update the code very often, which is connected with the style of development, which brings me pleasure in my free time.  With the development of a new package to update the code written in Go has become easier and faster. <br><a name="habracut"></a><br>  Now I will tell you how to use my package and how it works. <br><br><pre><code class="bash hljs">go get github.com/CossackPyra/updater</code> </pre> <br>  This command has installed my updater in your Go, you can also install the tool on the command line with the following command: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="bash hljs">go get github.com/CossackPyra/updater/pyra-poster</code> </pre><br>  Here is an example of a web service with the ability to update: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"io"</span></span> <span class="hljs-string"><span class="hljs-string">"net/http"</span></span> <span class="hljs-string"><span class="hljs-string">"os"</span></span> <span class="hljs-string"><span class="hljs-string">"github.com/CossackPyra/updater"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { http.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, handle_def) os.Mkdir(<span class="hljs-string"><span class="hljs-string">"tmp"</span></span>, <span class="hljs-number"><span class="hljs-number">0700</span></span>) u1 := updater.UpdaterServer(<span class="hljs-string"><span class="hljs-string">"tmp"</span></span>, []<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>(<span class="hljs-string"><span class="hljs-string">"1234567890123456"</span></span>), os.Args[<span class="hljs-number"><span class="hljs-number">0</span></span>]) http.Handle(<span class="hljs-string"><span class="hljs-string">"/updater-me"</span></span>, u1) http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">":9999"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle_def</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span></span></span> { fmt.Println(<span class="hljs-string"><span class="hljs-string">"def "</span></span>, r.Method) io.WriteString(w, <span class="hljs-string"><span class="hljs-string">"v 24\n"</span></span>) io.WriteString(w, r.URL.Path) <span class="hljs-built_in"><span class="hljs-built_in">println</span></span>(r.URL.Path) }</code> </pre><br>  The following 3 lines add the ability to update the program: <br><br><pre> <code class="go hljs"> <span class="hljs-string"><span class="hljs-string">"github.com/CossackPyra/updater"</span></span> ... u1 := updater.UpdaterServer(<span class="hljs-string"><span class="hljs-string">"tmp"</span></span>, []<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>(<span class="hljs-string"><span class="hljs-string">"1234567890123456"</span></span>), os.Args[<span class="hljs-number"><span class="hljs-number">0</span></span>]) http.Handle(<span class="hljs-string"><span class="hljs-string">"/updater-me"</span></span>, u1)</code> </pre><br>  In this case, everything is encrypted with a 16-byte key <b>[] byte ("1234567890123456")</b> , and <b>313233343536373393931313233343536</b> is its hexadecimal representation.  <b>new-service is a</b> new executable file, and here is the command to update the old process. <br><br><pre> <code class="bash hljs">pyra-poster 31323334353637383930313233343536 new-service http://127.0.0.1:9999/updater-me</code> </pre><br><h4>  How it works? </h4><br>  All <a href="">code</a> fit in 280 lines.  I have more confidence in the code that I can quickly figure out.  I‚Äôm not completely sure about the cryptographic strength of my encryption algorithm, and how I can be confident about something like that, so I‚Äôm interested to discuss it with you. <br><br>  When initializing the handler in updater.UpdaterServer, a random sequence of 16 bytes is generated (rand1).  In order to update the code, you must perform two requests to the handler.  The first GET request <a href="">receives</a> these random 16 bytes (rand1).  Random 16 bytes (rand1) and secret password (key1) are used to <a href="">encrypt the</a> executable file sent with the AES algorithm and <a href="">send the</a> cipher by POST. <br><br>  First, the buffer is <a href="">filled with the</a> data according to the following recipe: <br>  - Random 20 bytes (this is not rand1, but rand0 - at the moment they are not used at all); <br>  - 20 bytes - sha1 executable file hash; <br>  - ‚Äúpyra-poster‚Äù - a sequence of bytes, the name of the protocol; <br>  - 6 bytes (1 - int16 Little Endian, 0 - int32 Little Endian) - protocol version; <br>  - the <a href="">executable</a> file itself. <br><br>  This buffer is applied to the gamma function by the <a href="">xor</a> method, obtained by the <a href="">block cipher</a> AES (key1, rand1).  The result is a ciphertext that is <a href="">sent</a> to the handler using the POST method. <br><br>  On the server for decryption, the gamut AES (key1, rand1) is superimposed on the sequence, the pyra-poster header is checked (1.0), the executable file is saved in a temporary folder and the hash is calculated using the sha1 algorithm and compared with sha1 from the header.  If the hashes <a href="">are equal</a> , then it can be assumed with high probability that this is an authentic file created by the owner of the service. <br><br>  After updating the service, rand1 changes and therefore, having intercepted the ciphertext, it cannot be reloaded.  It is also quite difficult to calculate key1, having rand1, and knowing the feature of the header ‚Äúpyra-poster‚Äù (1,0) or even having an executable file. <br><br>  The 16-byte (128-bit) key1 key can be replaced with a 32-byte (256-bit) key without any additional code changes.  Most web browsers use AES 256 bit encryption. <br><br>  Use on health. </div><p>Source: <a href="https://habr.com/ru/post/251031/">https://habr.com/ru/post/251031/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../251015/index.html">All-Russian population census: how your data is compressed</a></li>
<li><a href="../251019/index.html">Nanobots in our brain</a></li>
<li><a href="../251023/index.html">Convergence based on HP Networking. Part 1</a></li>
<li><a href="../251025/index.html">Introducing 3CX WebMeeting 7.1 Beta - Next Generation Video Conferencing</a></li>
<li><a href="../251029/index.html">Create a rotating logo using ImageMagick and FFMPEG</a></li>
<li><a href="../251035/index.html">Learning JavaScript programming</a></li>
<li><a href="../251037/index.html">March 2-5: PRO online conference + Skills: 4 skills in 4 days</a></li>
<li><a href="../251039/index.html">WordPress 4.1.1 Released</a></li>
<li><a href="../251041/index.html">Transparent encryption: advantages and disadvantages</a></li>
<li><a href="../251043/index.html">Trends of e-marketing for 2015, research and list of top tools from the company Smart Insights</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>