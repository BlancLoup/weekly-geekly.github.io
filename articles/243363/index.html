<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Animations using the Transitions API</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 

 On Habr√©, the Transitions API theme for animations that appeared in Android since 4.4 (KitKat) and continued its development in 5.0 (Lollipo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Animations using the Transitions API</h1><div class="post__text post__text-html js-mediator-article">  Hello! <br><br>  On Habr√©, the <b>Transitions API</b> theme for animations that appeared in Android since 4.4 (KitKat) and continued its development in 5.0 (Lollipop) has not yet been covered.  In my article, I will talk about how to simplify work with animations using them and how to apply them on any device with <b>Android</b> version <b>4.0 and higher</b> . <br><br><img src="https://habrastorage.org/files/df3/46d/eea/df346deea2144a069d354e2b2edf76f0.gif"><br><a name="habracut"></a><br>  Together with Android 4.4, a new mechanism for animating changes to the layout was introduced.  Even in version 4.0, the first solution to this problem appeared - the animateLayoutChange flag for ViewGroup.  But even with calling the getLayoutTransition () method and changing its parameters, it was not flexible enough and did not give full control over how our change (transition) would be animated. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      KitKat Transition API brings us the concept of the scene - <b>Scene</b> and some changes between scenes - <b>Transition</b> .  In addition to them, we introduce the concept of <b>Scene root</b> to define the root layout, within which the scene changes will occur.  And the scene itself is a certain wrapper over the ViewGroup, which describes the specific state of him and all the View objects contained in it. <br><br>  Now about <b>Transition</b> itself.  This is the mechanism responsible for reading the required values ‚Äã‚Äãof the parameters of the View, which have changed when changing scenes and generating animations for smoothly changing these states. <br><br>  Let's start with the simplest use case for the Transitions API. <br>  Imagine that the current state of our layout is the first scene.  Suppose we just have a square. <br>  We describe layout in xml: <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FrameLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/container"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">View</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/transition_square"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/square_size_normal"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/square_size_normal"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:background</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@color/square_bg"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FrameLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Now we just want to animate the size of our square.  To begin to get used to the concept of scenes we call this change the transition to the second scene. <br><br><pre> <code class="java hljs"> ViewGroup sceneRoot = (ViewGroup) findViewById(R.id.container); View square = mSceneRoot.findViewById(R.id.transition_square); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> newSquareSize = getResources().getDimensionPixelSize(R.dimen.square_size_expanded); <span class="hljs-comment"><span class="hljs-comment">//  ,   ,        sceneRoot TransitionManager.beginDelayedTransition(sceneRoot); //     ViewGroup.LayoutParams params = square.getLayoutParams(); params.width = newSquareSize; params.height = newSquareSize; square.setLayoutParams(params);</span></span></code> </pre><br>  Result: <br><img src="https://habrastorage.org/getpro/habr/post_images/8a2/3f2/93d/8a23f293d084ef008a33f5bb961e942d.gif" alt="image"><br><br>  Not bad, the animation is just one line.  Moreover, such changes inside the layout can be any number. <br>  Now we will try to set up some animation parameters.  For this you need to specify a specific Transition, which we will perform.  The <b>beginDelayedTransition</b> method can take the second parameter of any heir of the Transition class.  It is about them, we now talk. <br><br><h3>  Simple Transition Types </h3><br><ul><li>  <b>ChangeBounds</b> .  That it was performed in the first example.  This is the Transition, which is responsible for changing the coordinates of the View inside the layout and its size. </li><li>  <b>Fade</b> .  It combines the well-known animations fade in and fade out.  It is an inheritor of the Visibility class, which was invented for those Transitions that are performed at the moment when the View was visible in the first scene, but should disappear when it passes to the second, or, conversely, appear. </li><li>  <b>TransitionSet</b> .  It is also the heir of Transition, but it is just a collection of some number of other Transitions that are performed in turn or simultaneously.  The sequence is set using the setOrdering method. </li><li>  <b>AutoTransition</b> .  It is such a TransitionSet, which is merely a set of sequentially running Fade with the Fade.OUT, ChangeBounds, and Fade parameter with the Fade.IN parameter.  Thus, first with the fade out effect all views hide, which are not in the second scene, then move and resize for the View, in which these parameters have changed, and, finally, new elements from the second scene appear with the fade in.  It is AutoTransition that is executed when, as in the first example, we did not specify any specific Transition method to beginDelayedTransition. </li></ul><br><h3>  Scenes </h3><br>  Let's go back to the scenes.  In the first example, we sorted out the easiest way to use the API.  But scenes can be described more formally, for example, to make it easier to switch between them. <br><br>  We describe the layout of our Activity so that it has a button for changing scenes and FrameLayout, which will be our Scene root.  Inside it we immediately put the layout, which is the first scene, but we will put it into a separate file. <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:orientation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:padding</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"16dp"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/btn_change_scene"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Change scene"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_gravity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"center_horizontal"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FrameLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/scene_root"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">layout</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@layout/scene1"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FrameLayout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  The contents of scene1.  Place there all the same square, but in the upper left corner: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FrameLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/container"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">View</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/transition_square"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/square_size_normal"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/square_size_normal"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:background</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@color/square_bg"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_gravity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"top|left"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FrameLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  And create a scene2 file.  Move the square to the upper right corner and increase in size.  Also, add a TextView, which was not in the first scene. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FrameLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/container"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">View</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/transition_square"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/square_size_expanded"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/square_size_expanded"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:background</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@color/square_bg"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_gravity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"top|right"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/transition_title"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_gravity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"center"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"This text fades in."</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:textAppearance</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"?android:attr/textAppearanceLarge"</span></span></span><span class="hljs-tag">/&gt;</span></span>/&gt; <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FrameLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  In the onCreate Activity we describe: <br><br><pre> <code class="java hljs"> ViewGroup sceneRoot = (ViewGroup) findViewById(R.id.scene_root); <span class="hljs-comment"><span class="hljs-comment">// You can also inflate a generate a Scene from a layout resource file. final Scene scene2 = Scene.getSceneForLayout(sceneRoot, R.layout.scene3, this); findViewById(R.id.btn_change_scene).setOnClickListener(new View.OnClickListener() { @Override public void onClick(View v) { //    AutoTransition TransitionSet set = new TransitionSet(); set.addTransition(new Fade()); set.addTransition(new ChangeBounds()); //     set.setOrdering(TransitionSet.ORDERING_TOGETHER); //     set.setDuration(500); //   Interpolator set.setInterpolator(new AccelerateInterpolator()); TransitionManager.go(scene2, set); } });</span></span></code> </pre><br>  Result: <br><img src="https://habrastorage.org/getpro/habr/post_images/e93/37c/0da/e9337c0dacc355523adddf1545b57e5a.gif" alt="image"><br><br><h3>  And about the main thing.  Backport </h3><br>  It is easy to understand why few more people use this API, and even very few people know about it.  Now is the time when developers have only recently realized the moral right to abandon support for Android 2.x and most new projects finally start with minSdk support for Android 4.0.  But for the time being, there is little point in using an API that will only work starting from 4.4, because most devices are still on older versions. <br>  But!  Transition API can already be used for Android 4.0+ and everywhere the animation will work the same.  For this, I am developing a library called <a href="https://github.com/andkulikov/transitions-everywhere"><b>Transitions Everywhere</b></a> .  It is the backport of the Transition API to older versions of Android.  To integrate into your project, you need to connect the library as a gradle dependency: <br><br><pre> <code class="xml hljs">dependencies { compile "com.andkulikov:transitionseverywhere:1.7.4" }</code> </pre> <br>  And for all classes associated with this API, replace the import with the <b>com.transitionseverywhere. *</b> Package instead of <b>android.transition. *</b> <br><br><h3>  About the library </h3><br>  When I became interested in this topic I found two similar libraries: <br>  <a href="https://github.com/guerwan/TransitionsBackport">github.com/guerwan/TransitionsBackport</a> <br>  <a href="https://github.com/pardom/TransitionSupportLibrary">github.com/pardom/TransitionSupportLibrary</a> <br>  What unites them is the fact that their creators apparently scored on their development and both of them did not fully implement everything that could be implemented for backward compatibility of some functionalities on older versions of Android.  I took them as a basis and added a lot of new things.  Various fixes of some incorrect behaviors that manifested themselves, for example, in versions prior to 4.3.  In addition, the API of my library is compatible with versions of Android 2.2+, but on versions up to 4.0, a change of scenes (layout) will be performed without animation.  Also, I try to keep up with the times.  Not so long ago, a new version of Android 5.0 (Lollipop) was released, and the code for the entire transitions API package in it has also changed a lot.  I have made all the changes to my library. <br><br><h3>  What's new in the API of 5.0 </h3><br><ul><li>  Now you can set <b>TransitionName</b> for View.  Marking the same View name in the first and second scenes, we say that the transition between them needs to be animated.  This is convenient, because earlier we needed for two scenes described in different xml files to specify the same id for such a View.  In 5.0, transitionName can be specified as an attribute in the description via xml, or by calling the setTransitionName method on any heir of the View.  In my library, I partially ported this functionality in the following way: I suggest calling the static method TransitionManager.setTransitionName (View v, String transitionName) instead of the similar one from View's heir and abandoning the transitionName setting via xml. <br><br></li><li>  <b>Slide</b> .  New Transition, which is the heir of Visibility, as well as Fade.  Using it, appearing in the scene View can ‚Äúresort‚Äù from the selected edge.  Example with new Slide (Gravity.LEFT)): <br><img src="https://habrastorage.org/getpro/habr/post_images/f23/49e/fe0/f2349efe0cd872569db44896c87928bd.gif" alt="image"></li></ul><br><ul><li>  <b>Explode</b> .  In many ways similar to Slide, but View will run out either from a certain direction, which is set using the so-called Transition epicenter (see the setEpicenterCallback method) or from a random angle, if this epicenter is not specified. </li><li>  <b>TransitionPropagation.</b>  Describes the delay in starting an animation.  For example, when installing CircularPropagation, the View is closer to the established epicenter, the earlier it starts to animate.  Set for Transition using the setPropagation parameter. <br>  An example of deleting all the View from the FrameLayout with the Explode Transition and the CircularPropagation installed (the epicenter is a tapa point): <br><img src="https://habrastorage.org/files/df3/46d/eea/df346deea2144a069d354e2b2edf76f0.gif"><br><br></li><li>  <b>ChangeImageTransform</b> .  Transition, which animates the matrix transition of the image inside the ImageView.  With it, you can smoothly resize and scaleType images.  Let us consider an example.  The girl on the left, we subjected ChangeBounds and ChangeImageTransform operations, while the girl on the right only got ChangeBounds.  With the naked eye it is noticeable how the right one ‚Äútwitches‚Äù at the beginning of the animation: <br><img src="https://habrastorage.org/getpro/habr/post_images/6d2/564/98c/6d256498c8ccab5f769624d114826aa9.gif" alt="image"><br><br></li></ul><ul><li>  <b>ChangeClipBounds</b> .  Smooth change of the clipBounds parameter in View.  But!  Since the setClipBounds method appeared only in Android 4.3, then we can only change this parameter and animate it starting from this version.  Example: <br><img src="https://habrastorage.org/getpro/habr/post_images/eb9/d09/496/eb9d0949684ce48d7354195e8108271c.gif" alt="image"><br></li></ul><br><ul><li>  <b>Path (Curved) motion</b> .  Now it is possible to set for any Transition a rule for calculating the coordinates of parameters consisting of two coordinates using the <b>setPathMotion</b> method.  for example, when changing the x and y coordinates, View can run to the new coordinates not along a straight line, but along an arc.  To show an example of what it looks like, just give a <a href="https://blog.stylingandroid.com/curved-motion-part-1/">link to a good article about it</a> . <br></li></ul><br><ul><li>  A little bit about what else has appeared, but what has not yet been able to port. <br>  <b>Activity Transition</b> , well advertised by Google in the announcements of Lollipop and Material Design.  Apparently, a lot of logic is hidden in the Activity itself, even you need to set a special flag.  So, directly port it is not so easy.  The same situation with the <b>Fragment Transition</b> . <br>  The new Transition under the name <b>ChangeTransform</b> is analogous to the ChangeImageTransform, but applies a matrix transformation to any View. </li></ul><br><h3>  Targets </h3><br>  For any Transition, you can set many elements - the goals to which it will be applied. <br>  This is done using the methods of the Transition class: <br><ul><li>  <b>addTarget</b> (View target) - explicitly set the View for which you want to apply the action </li><li>  <b>addTarget</b> (int targetId) - id View </li><li>  <b>addTarget</b> (String targetName) - apply only for those View for which the corresponding name was specified via TransitionManager.setTransitionName </li><li>  <b>addTarget</b> (Class targetType) - apply only to a specific type of View.  for example android.widget.TextView.class </li></ul><br>  Methods for deleting previously added targets: <br><ul><li>  <b>removeTarget</b> (View target) </li><li>  <b>removeTarget</b> (int targetId) </li><li>  <b>removeTarget</b> (String targetName) </li><li>  <b>removeTarget</b> (Class target) </li></ul><br>  Methods by which you can apply the action "for all but": <br><ul><li>  <b>excludeTarget</b> (View target, boolean exclude) </li><li>  <b>excludeTarget</b> (int targetId, boolean exclude) </li><li>  <b>excludeTarget</b> (Class type, boolean exclude) </li><li>  <b>excludeTarget</b> (Class type, boolean exclude) </li></ul><br>  Methods by which you can exclude all children of a certain layout: <br><ul><li>  <b>excludeChildren</b> (View target, boolean exclude) </li><li>  <b>excludeChildren</b> (int targetId, boolean exclude) </li><li>  <b>excludeChildren</b> (Class type, boolean exclude) </li></ul><br><h3>  We set Transition through xml </h3><br>  Transition itself can be downloaded from the xml file.  Put it in the <b>res / anim</b> folder.  Example <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">transitionSet</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:app</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res-auto"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:transitionOrdering</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"together"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:duration</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"400"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">changeBounds</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">changeImageTransform</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fade</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:fadingMode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fade_in"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:startDelay</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"200"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">targets</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">target</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:targetId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@id/transition_title"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">targets</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fade</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">transitionSet</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  We have created a TransitionSet set of operations consisting of three other Transitions.  At the same time, the previously considered <b>startDelay</b> property was applied here - the delay time before the start of the animation.  The analog for calling from code is <b>Transition.setStartDelay</b> (long startDelay). <br><br>  You can load an entire TransitionManager from an xml file, which describes different rules for scene changes depending on the order in which they occur.  A simple example: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">transitionManager</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:app</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res-auto"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">transition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:toScene</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@layout/scene3"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:transition</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@anim/scene3_transition"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">transitionManager</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  <b>Note</b> <br>  The above two examples have been tweaked to work with my Transitions Everywhere library.  If you use the system Transition API, then you need to put the xml files in the <b>res / transition</b> directory and for all attributes you must use the namespace <b>android:</b> instead of the <b>app:</b> <br><br><h3>  Custom Transitions </h3><br>  To even more sure what a cool thing these Transitions are, let's write your own Transition. <br>  Suppose we want to change the font size of an animated textView.  <i>(As suggested in the <a href="https://habrahabr.ru/users/bimeg/" class="user_link">bimeg</a> comments, this example is a bit divorced from reality, because you should not animate the properties, each change of which during the animation causes a requestLayout ())</i> <br>  We are required to override the captureStartValues, captureEndValues, and createAnimator methods.  The first two are responsible for capturing the values ‚Äã‚Äãof the required View parameters before and after scene changes.  And the createAnimator method, in fact, creates an animator for this parameter change. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TextSizeTransition</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Transition</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  ,     HashMap  private static final String PROPNAME_TEXT_SIZE = "textSizeTransition:textSize"; private void captureValues(TransitionValues transitionValues) { //    TextView if (transitionValues.view instanceof TextView) { TextView textView = ((TextView) transitionValues.view); //    ,     dip transitionValues.values.put(PROPNAME_TEXT_SIZE, textView.getTextSize() / getResources().getDisplayMetrics().density); } } @Override public void captureStartValues(TransitionValues transitionValues) { captureValues(transitionValues); } @Override public void captureEndValues(TransitionValues transitionValues) { captureValues(transitionValues); } @Override public Animator createAnimator(ViewGroup sceneRoot, TransitionValues startValues, TransitionValues endValues) { //    ,           //        TextView. // endValues   null, ,      View  if (startValues != null &amp;&amp; endValues != null &amp;&amp; endValues.view instanceof TextView) { TextView textView = (TextView) endValues.view; //   float start = (Float) startValues.values.get(PROPNAME_TEXT_SIZE); float end = (Float) endValues.values.get(PROPNAME_TEXT_SIZE); if (start != end) { //    View   textView.setTextSize(start); //      return ObjectAnimator.ofFloat(textView, "textSize", start, end); } } return null; } }</span></span></code> </pre><br>  Result: <br><img src="https://habrastorage.org/getpro/habr/post_images/234/485/9c7/2344859c79bcd3322adb0de2cf45cc31.gif" alt="image"><br><br><h3>  PS </h3><br>  Add smooth transitions to Android! <br>  Once again the link to the library: <br>  <a href="https://github.com/andkulikov/transitions-everywhere">github.com/andkulikov/transitions-everywhere</a> </div><p>Source: <a href="https://habr.com/ru/post/243363/">https://habr.com/ru/post/243363/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../243353/index.html">Autoregistered Unity .net repositories for EF Code first</a></li>
<li><a href="../243355/index.html">QML: animated sandwich icon in Material Design style in 20 minutes</a></li>
<li><a href="../243357/index.html">Inertial measurement of air temperature by ultrasound</a></li>
<li><a href="../243359/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ134 (November 10 - 16, 2014)</a></li>
<li><a href="../243361/index.html">Yii2 test on HHVM</a></li>
<li><a href="../243365/index.html">Digest of grocery design, August-October 2014</a></li>
<li><a href="../243367/index.html">The digest of interesting news and materials from the world of PHP No. 51 (October 26 - November 16, 2014)</a></li>
<li><a href="../243369/index.html">Interlight Moscow 2014 - what's new in coverage?</a></li>
<li><a href="../243371/index.html">Let's talk about the differences Mono from MS.NET</a></li>
<li><a href="../243373/index.html">Auto-positioning and autotracing of printed circuit boards</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>