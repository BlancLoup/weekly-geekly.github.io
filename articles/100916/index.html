<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>CHIP-8 based emulation principles</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It is believed that before starting to emulate complex systems, you need to start with something simple, for example, with Chip-8. In this article I w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>CHIP-8 based emulation principles</h1><div class="post__text post__text-html js-mediator-article">  It is believed that before starting to emulate complex systems, you need to start with something simple, for example, with Chip-8.  In this article I will try to consider all aspects of how you can write your own implementation of this language in a virtual machine.  Any programming language will go completely, but because of the simplicity, I will choose Delphi. <br><br>  Wait, do not immediately rush into the editor, first you will need a pen and a notebook, where we will write down all the important information for ourselves.  It all starts with her search.  First of all, this is of course Google.  After half an hour of following links, we can see how many implementations have already been written for any system, I don‚Äôt want to choose, but we will not peek into other people's sources, but write our own. <br><a name="habracut"></a><br><br><h4>  History reference </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      CHIP-8 is a language interpreter that was used in the late 70s, early 80s on some small commercial computers, such as RCA's TELMAC 1800 and COSMAC VIP, and cheap ‚Äúcreate-it-yourself‚Äù computers of the time like ETI 660 and DREAM 6800 ... <br><br>  CHIP-8 made it easy to program games.  TELMAC 1800 and COSMAC VIP were based on RCA CDP-1802 processors.  Both came with an audio cassette containing more than 12 games, dated 1977.  The interpreter had less than 40 commands, including math, flow control, graphics and sound. <br><br>  The interpreter should have been very small, due to the memory limits of these computers: COSMAC VIP had 2Kb (but could be expanded to 32Kb), and TELMAC had 4Kb.  CHIP-8 was only 512 bytes long. <br>  The simplicity of the language allowed us to create the Pong, Brix, Invaders and Tank that we played at the very beginning of the video games.  A good programmer could put these games in less than 256 bytes. <br><br>  Here is a short story about the CHIP-8 of one of the DREAM-6800 users: <br>  " <i>... the DREAM and ETI 660 appeared in Australian Electronic Journals as projects for assembly. These computers combined their incredibly low price (about $ 100), using a hex keyboard, the ability to reproduce very limited graphics of 64 x 32 pixels (ETI 660 could get 64 x 48 or 64 x 64 with its modification) transmitted to the TV, about one kilobyte of RAM, and the ability to run a high level pseudo language, called CHIP-8 (developed by RCA for displaying COSMAC graphics, I think).</i> <i><br></i>  <i>...</i> <i><br></i>  <i>One day, my older brother assembled the DREAM 6800. What a computer that was!</i>  <i>Along with the DREAM &amp; ETI 660 build articles, there were mountains of listing for CHIP-8 games.</i>  <i>Some games were less than 200 bytes or so, so typing them would not take forever.</i>  <i>And it was great games.</i>  <i>They were not slow.</i>  <i>So CHIP-8 was very well designed for classic TV games.</i>  " <br>  Paul Heiter (Author CHIP-8 Interpreter for Amiga) <br><br>  Later, CHIP-8 was used in the early 90s on HP48 calculators, because there was no way to write games on it faster.  Almost all of the original games from CHIP-8 worked with the CHIP48 interpreter, but many new ones were written. <br>  Then a new version of the language was released - SUPER-CHIP.  He had all the features of the standard, but could already operate with a resolution of 128x64. <br><br><h4>  Architecture </h4><br><br>  All programs in CHIP-8 start at 200h, excluding ETI-660, which starts at 600h.  This is done because at the address 000h-1FFh the language interpreter itself is located. <br><br>  All memory is fully addressable and accessible.  Since the instructions occupy 16-bit, they usually have even addresses, and if some 8 bits are inserted inside the code, their addresses become odd. <br><br>  Based on the 12 bits used per memory address, you can calculate that the maximum memory without tweaks could be 4096 bytes (000h-FFFh).  However, the addresses F00h-FFFh occupies video memory, and EA0h-EFFh is used to store the stack and internal CHIP-8 variables. <br><br>  The interpreter uses 16 general-purpose 8-bit registers.  They are available as V0..VF.  Moreover, VF is used as a flag for arithmetic operations, in the case of transfer, and a collision detector when drawing sprites. <br><br>  There is also 1 address register (I) 16 bits in size.  Since the memory is only 4 kilobytes, the interpreter used only its low 12 bits.  However, the upper 4 bits could be used for the font download function, since the font was located at 8110. <br><br>  In addition to the registers, there were 2 timers.  One is a delay timer, and one is a sound timer.  Both had a length of 8 bits and reduced their contents 60 times per second, if they were not zero at that time.  That is, they had a frequency of 60 hertz.  If the sound timer had a nonzero value, it would play a sound. <br>  The dimension of the stack remained unknown, but it‚Äôs accepted to do it in 16 levels (2x16 bytes). <br><br>  Graphics are drawn with 8 by 1..15 pixel sprites that are encoded bytes.  The origin of coordinates is in the upper left corner and begins at point 0. All coordinates are positive and are considered as the remainder method of dividing by 64 or 32, respectively.  The output to the screen is in XOR mode.  If one or more pixels are cleared (change their color from 1 to 0) the VF register is set to 01h and 00h otherwise.  Chip-8 has a 4x5 pixel font containing characters 0-9 and AF. <br><br>  For clarity, consider the example of the sprite and its coding.  Take the 8x5 sprite. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/1bb/686/a19/1bb686a198fd602a291629e86cf13558.jpg"><br><br>  We get the following set of bytes: <code>0 A0 0 A0 0</code> <br>  To make it completely understandable, let's take another 8x8 sprite. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/34f/9ff/d32/34f9ffd3214c25857cab2254a2591283.jpg"><br><br>  Sprite will occupy 8 bytes and will have the following structure: <code>0 60 30 18 0 06 03</code> <br>  The keyboard for CHIP-8 is 16th and looks like this: <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/cd3/0e0/2dc/cd30e02dc2d4cc69bf46c5f58ebd92e3.jpg"><br><br>  One can only argue and reason about the convenience and expediency of such a keyboard.  But we will not move away from the original, because everything was designed for just such a keyboard. <br><br><h4>  Command system </h4><br><br>  It should immediately be said that as NNN we will denote the address, KK - 8 bit constant, X and Y - 4 bit constants. <br>  Now consider the list of commands. <br><br>  0NNN Syscall nnn Call the instructions of the machine instruction of the processor 1802 with code NNN. <br>  00CN * scdown n Scrolls the screen down N lines. <br>  00FB * Scright Scrolling the screen 4 pixels to the right <br>  00FC * Scleft Scrolling the screen 4 pixels to the left <br>  00FD * Exit Emulator <br>  00FE * Low Set the CHIP-8 (64x32) graphic mode <br>  00FF * High Set the graphic mode SUPER CHIP (128x64) <br>  00E0 Cls Clear Screen <br>  00EE Rts Return from subroutine <br>  1NNN jmp nnn Translate program execution to address NNN <br>  2NNN jsr nnn Function call at address NNN.  The previous address is pushed onto the stack. <br>  3XKK skeq vx, kk Skip the following instruction (2 bytes) if VX = KK <br>  4XKK skne vx, kk Skip the following instruction (2 bytes) if VX &lt;&gt; KK <br>  5XY0 skeq vx, vy Skip the following instruction if VX = VY <br>  6XKK mov vx, kk Write KK to VX register <br>  7XKK add vx, kk Write VX + KK to VX register (According to information from Wikipedia and other sources it does not affect the flag) <br>  8XY0 mov vx, vy In VX write the value of the register VY <br>  8XY1 or vx, vy VX = VX OR VY. <br>  8XY2 and vx, vy VX = VX AND VY <br>  8XY3 xor vx, vy VX = VX XOR VY (not documented in original documents) <br>  8XY4 add vx, vy VX = VX + VY.  In VF = carry. <br>  8XY5 sub vx, vy VX = VX - VY.  (*) VF = NOT borrow. <br>  8X06 shr vx VX = VX SHR 1 (VX = VX / 2), VF = carry <br>  8XY7 sub vy, vx VX = VY - VX, VF = not borrow (*) (undocumented in original documents) <br>  8XYE shl vx VX = VX SHL 1 (VX = VX * 2), VF = carry <br>  9XY0 skne vx, vy Skip the following instruction if VX &lt;&gt; VY <br>  ANNN mov I, nnn I = NNN <br>  BNNN Jmi NNN Translate program execution to NNN + V0 <br>  CXKK Rand vx, kk VX = (random number 0..255) AND KK <br>  DXYN Draw vx, vy, n Draw a sprite of height N (with N = 0 count N = 16) and width 8 along the coordinates (VX, VY) beginning in memory at the address contained in register I. VF = collision. <br>  EX9E Skpr vx Skip the next instruction if the number key in VX is pressed. <br>  EXA1 Skup vx Skip the next instruction if the number key in the VX is not pressed. <br>  FX07 Gdelay vx VX = Delay timer <br>  FX0A Key vx We are waiting for pressing the button and add it to VX. <br>  FX15 Sdelay vx Delay timer = VX <br>  FX18 Ssound vx Sound timer = VX <br>  FX1E Add I, vx I = I + VX <br>  FX29 Font vx Place in I the address of the sprite font 4 x 5 hexadecimal character contained in the VX <br>  FX33 Bcd vx Place the BCD representation of the VX into memory at the addresses I..I + 2.  For example, if VX contains 4Fh, then 00h 07h 09h, that is, a decimal representation of 4Fh will be stored in memory <br>  FX55 Save vx Saves the V0 ... VX registers in memory starting at I <br>  FX65 Load vx Loads V0 ... VX registers from memory starting at I <br>  FX75 * Ssave vx Saves V0 ... VX (X &lt;8) to HP48 flags <br>  FX85 * Sload vx Downloads V0 ... VX (X &lt;8) from HP48 flags <br><br>  * - it means the command is relevant only for SUPER CHIP interpreter. <br><br>  (*): When VX - VY occurs, VF is set to denial of the loan.  This means that if VX is greater than or equal to VY, VF will be set to 01, because loan = 0. If VX is less than VY, VF is set to 00, because loan = 1. <br><br><h4>  Preparing base sprites </h4><br><br>  Using a piece of paper and a pen, we sketch the sprites of the font.  You‚Äôll get something like this: <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/7f2/957/4a0/7f29574a011da9cbbdc4bf514d9de7d4.jpg"><br><br>  Using it, we write the bytes of the value of each sprite. <br><br><h4>  Principles of emulation </h4><br><br>  It is believed that all emulation should occur in a loop of approximately this type. <br><br><blockquote>  <font color="#000000">Repeat</font> <br>  <font color="#808080">// do emulation</font> <br>  <font color="#000000">Until</font> quit_pr <font color="#000066">;</font> </blockquote><br><br>  Here quit_pr is considered a sign of stopping emulation, and can change not only from the outside, but also from the inside of the emulation. <br><br>  One of the most important points that should be followed is that the frequencies of the equipment and the optimization are respected.  If it is incorrect to describe the emulation of even such a simple language like CHIP-8, you can get very low performance and extremely high CPU time, while the correct emulation will provide sufficient performance at minimum cost. <br><br>  Using Delphi, I decided to develop an emulation of the system as a class and gave it the name "TCpu1802", based on the processor model used within this system.  Consider the main procedure for it run. <br><br><blockquote>  <font color="#000000">procedure</font> tcpu1802 <font color="#000066">.</font>  <font color="#006600">run</font> <font color="#000066">;</font> <br>  <font color="#000000">begin</font> <br>  delaytimer <font color="#000066">.</font>  <font color="#006600">Enabled</font> <font color="#000066">:</font> <font color="#000066">=</font> <font color="#000000">true</font> <font color="#000066">;</font> <br>  soundtimer <font color="#000066">.</font>  <font color="#006600">Enabled</font> <font color="#000066">:</font> <font color="#000066">=</font> <font color="#000000">true</font> <font color="#000066">;</font> <br>  drawtimer <font color="#000066">.</font>  <font color="#006600">Enabled</font> <font color="#000066">:</font> <font color="#000066">=</font> <font color="#000000">true</font> <font color="#000066">;</font> <br>  work <font color="#000066">:</font> <font color="#000066">=</font> <font color="#000000">true</font> <font color="#000066">;</font> <br>  <font color="#000000">repeat</font> <br>  useopcode <font color="#000066">;</font> <br>  <font color="#000000">if</font> cpumulty &lt;&gt; <font color="#0000ff">0</font> <font color="#000000">then</font> <br>  <font color="#000000">if</font> <font color="#000066">(</font> <font color="#000066">round</font> <font color="#000066">(</font> cycle <font color="#000066">)</font> <font color="#000000">mod</font> <font color="#000066">(</font> <font color="#0000ff">2</font> <font color="#000066">)</font> <font color="#000066">)</font> <font color="#000066">=</font> <font color="#0000ff">0</font> <font color="#000000">then</font> <font color="#000066">sleep</font> <font color="#000066">(</font> cpumulty <font color="#000066">)</font> <font color="#000066">;</font> <br>  application <font color="#000066">.</font>  <font color="#006600">ProcessMessages</font> <font color="#000066">;</font> <br>  <font color="#000000">until</font> work <font color="#000066">=</font> <font color="#000000">false</font> <font color="#000066">;</font> <br>  delaytimer <font color="#000066">.</font>  <font color="#006600">Enabled</font> <font color="#000066">:</font> <font color="#000066">=</font> <font color="#000000">false</font> <font color="#000066">;</font> <br>  soundtimer <font color="#000066">.</font>  <font color="#006600">Enabled</font> <font color="#000066">:</font> <font color="#000066">=</font> <font color="#000000">false</font> <font color="#000066">;</font> <br>  drawtimer <font color="#000066">.</font>  <font color="#006600">Enabled</font> <font color="#000066">:</font> <font color="#000066">=</font> <font color="#000000">false</font> <font color="#000066">;</font> <br>  <font color="#000000">end</font> <font color="#000066">;</font> <br><br></blockquote><br><br>  First, at startup, we activate two standard for CHIP-8 timers and one entered by yourself to redraw the screen.  Cycle - a variable containing the current cycle of commands, the call of each command increases the cycle by one.  Every second action we will try to suspend the interpreter for cpumulty milliseconds.  This is necessary so that no speeding occurs. <br><br>  Soundtimer and Drawtimer timers have an interval of 17 milliseconds, that is, they operate at a frequency of 58.82 hertz, which is as close as possible to the original. <br><br>  Drawtimer delay is 10 milliseconds.  That is, on average, every 3-4 interpreter commands will be executed.  Allocation to the timer is done in order not to clutter up the process of the interpreter execution and allows regular means to perform parallelization of processes. <br><br>  Let's look at the list of variables that we need to perform the emulation itself: <br><br><blockquote>  keycode <font color="#000066">:</font> <font color="#000066">byte</font> <font color="#000066">;</font>  <font color="#808080">// key pressed code</font> <br>  memory <font color="#000066">:</font> <font color="#000000">array</font> <font color="#000066">[</font> 0 <font color="#000066">..</font> 8191 <font color="#000066">]</font> <font color="#000000">of</font> <font color="#000066">byte</font> <font color="#000066">;</font>  <font color="#808080">// 8 kilobytes of RAM, allocated due to the location of fonts</font> <br>  stack <font color="#000066">:</font> <font color="#000000">array</font> <font color="#000066">[</font> 0 <font color="#000066">..</font> 255 <font color="#000066">]</font> <font color="#000000">of</font> <font color="#000066">word</font> <font color="#000066">;</font>  <font color="#808080">// stack</font> <br>  stacksize <font color="#000066">:</font> <font color="#000066">byte</font> <font color="#000066">;</font>  <font color="#808080">// current stack expansion</font> <br>  videoarray <font color="#000066">:</font> <font color="#000000">array</font> <font color="#000066">[</font> 0 <font color="#000066">..</font> 2047 <font color="#000066">]</font> <font color="#000000">of</font> <font color="#000066">boolean</font> <font color="#000066">;</font>  <font color="#808080">// video array</font> <br>  mask <font color="#000066">:</font> <font color="#000000">array</font> <font color="#000066">[</font> 0 <font color="#000066">..</font> 2047 <font color="#000066">]</font> <font color="#000000">of</font> <font color="#000066">boolean</font> <font color="#000066">;</font>  <font color="#808080">// mask video array</font> <br>  Vreg <font color="#000066">:</font> <font color="#000000">array</font> <font color="#000066">[</font> 0 <font color="#000066">..</font> 15 <font color="#000066">]</font> <font color="#000000">of</font> <font color="#000066">byte</font> <font color="#000066">;</font>  <font color="#808080">// - registers V0..VF</font> <br>  Ireg <font color="#000066">:</font> <font color="#000066">word</font> <font color="#000066">;</font>  <font color="#808080">// 2 byte address register</font> <br>  CodeSender <font color="#000066">:</font> <font color="#000066">word</font> <font color="#000066">;</font>  <font color="#808080">// location of the next opcode in memory</font> <br>  sound <font color="#000066">:</font> <font color="#000066">boolean</font> <font color="#000066">;</font>  <font color="#808080">// is the sound playing now?</font> </blockquote><br><br>  According to the architecture, video memory is located in the same amount of RAM as everything else, however, constant reading and writing there, considering the bytes and analyzing them, would take a lot of processor resources and is impractical, however, assuming that some program can read something directly from there, in case there is a reading from that memory area, we can simply call an additional procedure called mirrorvideomem, which allows writing the current contents of the video memory there.  Such a solution is effective, although it causes a slightly larger use of RAM.  The mirrorstack procedure is similar. <br><br><blockquote>  <font color="#000000">procedure</font> tcpu1802 <font color="#000066">.</font>  <font color="#006600">mirrorvideomem</font> <font color="#000066">;</font> <br>  <font color="#000000">var</font> <br>  i <font color="#000066">,</font> j <font color="#000066">:</font> <font color="#000066">integer</font> <font color="#000066">;</font> <br>  tmp <font color="#000066">:</font> <font color="#000066">byte</font> <font color="#000066">;</font> <br>  <font color="#000000">begin</font> <br>  <font color="#000000">if</font> <font color="#000066">(</font> Ireg&gt; <font color="#000066">=</font> <font>$ F00</font> <font color="#000066">)</font> <font color="#000000">and</font> <font color="#000066">(</font> Ireg &lt; <font color="#000066">=</font> <font>$ FFF</font> <font color="#000066">)</font> <font color="#000000">then</font> <br>  <font color="#000000">begin</font> <br>  <font color="#000000">for</font> i <font color="#000066">:</font> <font color="#000066">=</font> <font color="#0000ff">0</font> <font color="#000000">to</font> <font color="#0000ff">255</font> <font color="#000000">do</font> <br>  <font color="#000000">begin</font> <br>  tmp <font color="#000066">:</font> <font color="#000066">=</font> <font color="#0000ff">0</font> <font color="#000066">;</font> <br>  <font color="#000000">for</font> j <font color="#000066">:</font> <font color="#000066">=</font> <font color="#0000ff">0</font> <font color="#000000">to</font> <font color="#0000ff">7</font> <font color="#000000">do</font> <br>  <font color="#000000">begin</font> <br>  <font color="#000000">if</font> videoarray <font color="#000066">[</font> i <font color="#000066">*</font> j <font color="#000066">]</font> <font color="#000000">then</font> tmp <font color="#000066">:</font> <font color="#000066">=</font> tmp <font color="#000066">+</font> <font color="#0000ff">1</font> <font color="#000066">;</font> <br>  tmp <font color="#000066">:</font> <font color="#000066">=</font> tmp <font color="#000000">shl</font> <font color="#0000ff">1</font> <font color="#000066">;</font> <br>  <font color="#000000">end</font> <font color="#000066">;</font> <br>  memory <font color="#000066">[</font> <font>$ F00</font> <font color="#000066">+</font> i <font color="#000066">]</font> <font color="#000066">:</font> <font color="#000066">=</font> tmp <font color="#000066">;</font> <br>  <font color="#000000">end</font> <font color="#000066">;</font> <br>  <font color="#000000">end</font> <font color="#000066">;</font> <br>  <font color="#000000">end</font> <font color="#000066">;</font> <br><br><br>  <font color="#000000">procedure</font> tcpu1802 <font color="#000066">.</font>  <font color="#006600">mirrorstack</font> <font color="#000066">;</font> <br>  <font color="#000000">var</font> <br>  n <font color="#000066">,</font> i <font color="#000066">:</font> <font color="#000066">integer</font> <font color="#000066">;</font> <br>  <font color="#000000">begin</font> <br>  <font color="#000000">if</font> <font color="#000066">(</font> Ireg&gt; <font color="#000066">=</font> <font>$ EA0</font> <font color="#000066">)</font> <font color="#000000">and</font> <font color="#000066">(</font> Ireg &lt; <font color="#000066">=</font> <font>$ EFF</font> <font color="#000066">)</font> <font color="#000000">then</font> <br>  <font color="#000000">begin</font> <br>  <font color="#000000">if</font> stacksize&gt; <font color="#0000ff">12</font> <font color="#000000">then</font> n <font color="#000066">:</font> <font color="#000066">=</font> <font color="#0000ff">11</font> <font color="#000000">else</font> n <font color="#000066">:</font> <font color="#000066">=</font> stacksize <font color="#000066">-</font> <font color="#0000ff">1</font> <font color="#000066">;</font> <br>  <font color="#000000">for</font> i <font color="#000066">:</font> <font color="#000066">=</font> <font color="#0000ff">0</font> <font color="#000000">to</font> n <font color="#000000">do</font> <br>  <font color="#000000">begin</font> <br>  memory <font color="#000066">[</font> <font>$ EFF</font> <font color="#000066">-</font> i <font color="#000066">*</font> <font color="#0000ff">2</font> <font color="#000066">]</font> <font color="#000066">:</font> <font color="#000066">=</font> stack <font color="#000066">[</font> i <font color="#000066">]</font> <font color="#000000">div</font> <font color="#0000ff">256</font> <font color="#000066">;</font> <br>  memory <font color="#000066">[</font> <font>$ EFF</font> <font color="#000066">-</font> i <font color="#000066">*</font> <font color="#0000ff">2</font> <font color="#000066">+</font> <font color="#0000ff">1</font> <font color="#000066">]</font> <font color="#000066">:</font> <font color="#000066">=</font> stack <font color="#000066">[</font> i <font color="#000066">]</font> <font color="#000000">mod</font> <font color="#0000ff">256</font> <font color="#000066">;</font> <br>  <font color="#000000">end</font> <font color="#000066">;</font> <br>  <font color="#000000">end</font> <font color="#000066">;</font> <br>  <font color="#000000">end</font> <font color="#000066">;</font> <br></blockquote><br><br>  Before writing the processor, you can see that each command is conditionally divided into 4 sections of 4 bits.  To work with them, the opcode data type is entered (type opcode = array [0..3] of byte;). <br><br>  I will not dwell on the conversion and reading of the next data from the memory, however, I will pay attention to the structure of the run procedure that performs the emulation.  In order to optimize it, it uses not ‚Äúif then else‚Äù, but ‚Äúcase‚Äù, and moreover, a number of commands allow them to be used with the help of an assembler, which further accelerates the work of emulation.  Here is an example of such a command: <br><br><blockquote>  <font color="#000000">if</font> op <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">=</font> <font color="#0000ff">1</font> <font color="#000000">then</font> <br>  <font color="#000000">begin</font> <br>  tmp <font color="#000066">:</font> <font color="#000066">=</font> Vreg <font color="#000066">[</font> op <font color="#000066">[</font> <font color="#0000ff">1</font> <font color="#000066">]</font> <font color="#000066">]</font> <font color="#000066">;</font> <br>  tmp2 <font color="#000066">:</font> <font color="#000066">=</font> Vreg <font color="#000066">[</font> op <font color="#000066">[</font> <font color="#0000ff">2</font> <font color="#000066">]</font> <font color="#000066">]</font> <font color="#000066">;</font> <br>  <font color="#000000">asm</font> <br>  mov ah <font color="#000066">,</font> <font color="#000066">[</font> tmp <font color="#000066">]</font> <br>  <font color="#000000">or</font> ah <font color="#000066">,</font> <font color="#000066">[</font> tmp2 <font color="#000066">]</font> <font color="#000066">;</font> <br>  mov <font color="#000066">[</font> tmp <font color="#000066">]</font> <font color="#000066">,</font> ah <font color="#000066">;</font> <br>  <font color="#000000">end</font> <font color="#000066">;</font> <br>  Vreg <font color="#000066">[</font> op <font color="#000066">[</font> <font color="#0000ff">1</font> <font color="#000066">]</font> <font color="#000066">]</font> <font color="#000066">:</font> <font color="#000066">=</font> tmp <font color="#000066">;</font> <br>  used <font color="#000066">:</font> <font color="#000066">=</font> <font color="#000000">true</font> <font color="#000066">;</font> <br>  codesender <font color="#000066">:</font> <font color="#000066">=</font> codesender <font color="#000066">+</font> <font color="#0000ff">2</font> <font color="#000066">;</font> <br>  <font color="#000000">end</font> <font color="#000066">;</font> </blockquote><br><br>  Now, having considered all moments of emulation, you can write your own CHIP-8 emulation.  I hope you liked my article and it was useful.  Thank you for reading. <br><br>  Articles used: <br>  <a href="http://www.pdc.kth.se/~lfo/chip8/CHIP8.htm">A CHIP-8 / SCHIP emulator</a> <a href="http://www.pdc.kth.se/~lfo/chip8/CHIP8.htm"><br></a>  <a href="http://www.pdc.kth.se/~lfo/chip8/CHIP8.htm">By David WINTER (HPMANIAC)</a> <br>  <a href="http://en.wikipedia.org/wiki/CHIP-8">Wikipedia</a> <br><br>  Module source: <br>  <a href="">source code</a> <br><br>  It was for her that I received an invitation from the user <a href="https://geektimes.ru/users/nsinreal/" class="user_link">nsinreal</a> , for which I thank him so much. <br><br>  Please do not consider the ‚Äúcopy-paste‚Äù of the <a href="http://tronix286.habrahabr.ru/blog/100907/">article</a> that appeared an hour before the publication of this one, due to the fact that it could not be sent.  Please consider that we have not seen each other's articles, due to the different content of the modules and different approaches to emulation, thanks in advance. </div><p>Source: <a href="https://habr.com/ru/post/100916/">https://habr.com/ru/post/100916/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../100909/index.html">GMABooster? Accelerate?</a></li>
<li><a href="../100910/index.html">Application for Habrahabr, v1.0</a></li>
<li><a href="../100912/index.html">Opera games with right click menu</a></li>
<li><a href="../100914/index.html">On gosuslugi.ru now you can see information about your traffic violations</a></li>
<li><a href="../100915/index.html">"Server" for nomadic life</a></li>
<li><a href="../100917/index.html">Ed Arnoun: public / civic journalism is not a service, but a philosophy</a></li>
<li><a href="../100920/index.html">IPad iPad browser emulator</a></li>
<li><a href="../100921/index.html">The main futurist CiscoSystems in the new video talks about the "Internet of things" and technology in general</a></li>
<li><a href="../100924/index.html">Linux. Conky. Monitor Counter-Strike Servers</a></li>
<li><a href="../100925/index.html">Apple iOS 4.1 beta 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>