<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Boolean expressions in C / C ++. How are the professionals mistaken</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Logical expression in programming is a programming language design, the result of which is ‚Äútrue‚Äù or ‚Äúfalse‚Äù. Many programming books designed to learn...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Boolean expressions in C / C ++. How are the professionals mistaken</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/caa/7a3/b95/caa7a3b952150160f890939d894aec3d.png" align="left">  Logical expression in programming is a programming language design, the result of which is ‚Äútrue‚Äù or ‚Äúfalse‚Äù.  Many programming books designed to learn a language from scratch provide possible operations on the logical expressions that every novice developer has encountered.  In this article I will not tell you that the AND operator is more priority than the OR operator.  I will talk about common errors in simple conditional expressions consisting of only three operators, and show you how to check your code with the help of constructing truth tables.  The described errors make the developers of such famous projects as FreeBSD, Microsoft ChakraCore, Mozilla Thunderbird, LibreOffice, and many others. <br><a name="habracut"></a><br><h2>  Introduction </h2><br>  I am developing a static code analyzer for C / C ++ / C # languages ‚Äã‚Äã- <a href="http://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> .  In my work I have to deal a lot with open and closed code of different projects.  Often the result of this work are articles on <a href="http://www.viva64.com/ru/a/0084/">checking open source projects</a> containing a description of errors found and shortcomings.  After viewing a large amount of code, you begin to notice the various error patterns that programmers allow.  So, my colleague Andrei Karpov wrote an article about the <a href="http://www.viva64.com/ru/b/0260/">effect of the last line</a> after finding a large number of errors made in the last fragments of the same type of code. <br><br>  At the beginning of this year, I checked with the help of the analyzer many projects of large IT companies, which, following the current trend, spread the open source of their projects under free licenses.  I began to notice that in almost every project there is an error in the conditional expression due to the incorrect recording of conditional statements.  The expression itself is quite simple and consists of only three operators: <ul><li>  ! = ||  ! = </li><li>  == ||  ! = </li><li>  == &amp;&amp; == </li><li>  == &amp;&amp;! = </li></ul><br>  In total, there are 6 such conditional expressions, but 4 of them are erroneous: two are always true or false;  in two, the result of the entire expression does not depend on the result of the subexpression contained in it. <br><br>  To prove the wrong result of the expression, I will build a truth table in each example;  I will also give for each example one piece of code from an open project.  This article will also mention the ternary operator '?:', Which has almost the lowest priority of all operators, but so many developers are not aware of this. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Since  most often I have encountered incorrect conditional expressions when checking the result of different functions, the return code of which is compared with error codes, then in the synthetic examples given below I will use a variable called <i>err</i> , and <i>code1</i> and <i>code2</i> will be constants.  In this case, the constants <i>code1</i> and <i>code2 are</i> not equal.  The value <i>‚Äúother codes‚Äù</i> will mean any other constants not equal to <i>code1</i> and <i>code2</i> . <br><br><h2>  Errors using the '||' operator </h2><br><h3>  Expression! = ||  ! = </h3><br>  A synthetic example in which the result of the conditional expression will always be true: <br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( err != code1 || err != code2) { .... }</code> </pre> <br>  The following is the truth table for this code example: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/854/c0e/e49/854c0ee49aefa31f8c1ceee87d17d78f.png"></div><br><br>  Now let's look at a real example of the error found in the LibreOffice project. <br><br>  <a href="http://www.viva64.com/ru/d/0137/">V547</a> Expression is always true.  Probably the '&amp;&amp;' operator should be used here.  sbxmod.cxx 1777 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> SbxDataType { SbxEMPTY = <span class="hljs-number"><span class="hljs-number">0</span></span>, SbxNULL = <span class="hljs-number"><span class="hljs-number">1</span></span>, .... }; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> SbModule::GetCodeCompleteDataFromParse( CodeCompleteDataCache&amp; aCache) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( (pSymDef-&gt;GetType() != SbxEMPTY) || <span class="hljs-comment"><span class="hljs-comment">// &lt;= (pSymDef-&gt;GetType() != SbxNULL) ) // &lt;= aCache.InsertGlobalVar( pSymDef-&gt;GetName(), pParser-&gt;aGblStrings.Find(pSymDef-&gt;GetTypeId()) ); .... }</span></span></code> </pre> <h3>  Expression == ||  ! = </h3><br>  A synthetic example in which the result of the entire conditional expression does not depend on the result of the subexpression <i>(err == code1)</i> : <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( err == code1 || err != code2) { .... }</code> </pre> <br>  The following is the truth table for this code example: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a59/4f5/a4a/a594f5a4a24014a1c2098a6343651f13.png"></div><br><br>  Now let's look at a real example of an error found in the FreeBSD project. <br><br>  <a href="http://www.viva64.com/ru/d/0194/">V590</a> Consider inspecting the 'error == 0 ||  error! = - 1 'expression.  The expression is misprint.  nd6.c 2119 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nd6_output_ifp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-comment"><span class="hljs-comment">/* Use the SEND socket */</span></span> error = send_sendso_input_hook(m, ifp, SND_OUT, ip6len); <span class="hljs-comment"><span class="hljs-comment">/* -1 == no app on SEND socket */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (error == <span class="hljs-number"><span class="hljs-number">0</span></span> || error != <span class="hljs-number"><span class="hljs-number">-1</span></span>) <span class="hljs-comment"><span class="hljs-comment">// &lt;= return (error); .... }</span></span></code> </pre> <br>  It is not much different from a synthetic example, is it? <br><br><h2>  Errors using the '&amp;&amp;' operator </h2><br><h3>  Expression == &amp;&amp; == </h3><br>  A synthetic example in which the result of a conditional expression will always be false: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( err == code1 &amp;&amp; err == code2) { .... }</code> </pre> <br>  The following is the truth table for this code example: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b02/4f6/cde/b024f6cde1ba995166478ce7eea31e2c.png"></div><br><br>  Now let's take a look at a real example of an error found in the SeriousEngine project. <br><br>  <a href="http://www.viva64.com/ru/d/0137/">V547</a> Expression is always false.  Probably the '||'  operator should be used here.  entity.cpp 3537 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> RenderType { .... RT_BRUSH = <span class="hljs-number"><span class="hljs-number">4</span></span>, RT_FIELDBRUSH = <span class="hljs-number"><span class="hljs-number">8</span></span>, .... }; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CEntity::DumpSync_t(CTStream &amp;strm, INDEX iExtensiveSyncCheck) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( en_pciCollisionInfo == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { strm.FPrintF_t(<span class="hljs-string"><span class="hljs-string">"Collision info NULL\n"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (en_RenderType==RT_BRUSH &amp;&amp; <span class="hljs-comment"><span class="hljs-comment">// &lt;= en_RenderType==RT_FIELDBRUSH) { // &lt;= strm.FPrintF_t("Collision info: Brush entity\n"); } else { .... } .... }</span></span></code> </pre> <h3>  Expression == &amp;&amp;! = </h3><br>  A synthetic example in which the result of the entire conditional expression does not depend on the result of the subroutine ‚Äúerr! = Code2‚Äù: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( err == code1 &amp;&amp; err != code2) { .... }</code> </pre><br>  The following is the truth table for this code example: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3b1/379/ba5/3b1379ba5e37c89594fcf928bff7f8bf.png"></div><br><br>  Now let's look at a real example of an error found in the ChakraCore project - a JavaScript engine for Microsoft Edge. <br><br>  <a href="http://www.viva64.com/ru/d/0194/">V590</a> Consider inspecting the 'sub [i]! =' - '&amp;&amp; sub [i] ==' / '' expression.  The expression is misprint.  rl.cpp 1388 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stristr</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * str, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * sub )</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; len; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">tolower</span></span>(str[i]) != <span class="hljs-built_in"><span class="hljs-built_in">tolower</span></span>(sub[i])) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((str[i] != <span class="hljs-string"><span class="hljs-string">'/'</span></span> &amp;&amp; str[i] != <span class="hljs-string"><span class="hljs-string">'-'</span></span>) || (sub[i] != <span class="hljs-string"><span class="hljs-string">'-'</span></span> &amp;&amp; sub[i] == <span class="hljs-string"><span class="hljs-string">'/'</span></span>)) { / &lt;= <span class="hljs-comment"><span class="hljs-comment">// if the mismatch is not between '/' and '-' break; } } } .... }</span></span></code> </pre> <h2>  Errors using the '?:' Operator </h2><br>  <a href="http://www.viva64.com/ru/d/0091/">V502</a> Perhaps the '?:' Operator was different.  The '?:' Operator has a lower than the '|'  operator.  ata-serverworks.c 166 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ata_serverworks_chipinit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">device_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dev)</span></span></span><span class="hljs-function"> </span></span>{ .... pci_write_config(dev, <span class="hljs-number"><span class="hljs-number">0x5a</span></span>, (pci_read_config(dev, <span class="hljs-number"><span class="hljs-number">0x5a</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) &amp; ~<span class="hljs-number"><span class="hljs-number">0x40</span></span>) | (ctlr-&gt;chip-&gt;cfg1 == SWKS_100) ? <span class="hljs-number"><span class="hljs-number">0x03</span></span> : <span class="hljs-number"><span class="hljs-number">0x02</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); } .... }</code> </pre> <br>  In conclusion, I want to say about the ternary operator '?:'.  Its priority is almost the lowest among all operators.  Only assignment, <i>throw</i> and comma operator are lower.  The error in the example was found in the FreeBSD kernel.  Here, the ternary operator was used to select the desired flag and to write a short beautiful code.  But the priority of the bitwise OR operator is higher, so the conditional expression is not calculated in the order in which the programmer planned.  I also decided to describe this error in this article, since  it is very common among the projects I have verified. <br><br><h2>  Conclusion </h2><br>  The described patterns of conditional expressions can be very dangerous if you don‚Äôt take extra care when writing code.  Despite the small number of statements, the entire conditional expression may be misunderstood.  The code in which such an error was made may look quite logical and will be skipped after the code review.  You can insure yourself against such errors by checking your code with the help of building truth tables, if you have doubts about the correctness of the condition, as well as with the help of regular checks with static analyzers. <br><br><div style="text-align:center;"> <a href="http://www.viva64.com/en/b/0390/"><img src="https://habrastorage.org/getpro/habr/post_images/35e/064/ddf/35e064ddf91f5d99b620384893909ff7.png"></a> </div><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Svyatoslav Razmyslov.  <a href="http://www.viva64.com/en/b/0390/">Logical Expressions in C / C ++.</a>  <a href="http://www.viva64.com/en/b/0390/">Mistakes Made by Professionals</a> . </div><p>Source: <a href="https://habr.com/ru/post/281316/">https://habr.com/ru/post/281316/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../281304/index.html">VAS for you. Part One: Integrating Mobile and Virtual PBX</a></li>
<li><a href="../281306/index.html">PHP Digest number 83 - interesting news, materials and tools (March 27 - April 10, 2016)</a></li>
<li><a href="../281308/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ206 (April 4 - 10, 2016)</a></li>
<li><a href="../281312/index.html">Android Cuvettes, Part 3: SDK and RxJava (Final)</a></li>
<li><a href="../281314/index.html">Easla.com review</a></li>
<li><a href="../281318/index.html">Use an Intel RealSense camera with TouchDesigner. Part 2</a></li>
<li><a href="../281320/index.html">Perspectives of the go language for the programmer</a></li>
<li><a href="../281322/index.html">Gaming simulators for the development of BrainApps cognitive brain functions with a cloud backend</a></li>
<li><a href="../281324/index.html">"Looming Clouds" will make you rebuild your IT platform</a></li>
<li><a href="../281330/index.html">PHP and Temporal Coupling</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>