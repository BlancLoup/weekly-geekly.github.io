<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Android Architecture Components. Part 3. LiveData</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Component LiveData - is designed to store the object and allows you to subscribe to its changes. The key feature is that the component is aware of the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Android Architecture Components. Part 3. LiveData</h1><div class="post__text post__text-html js-mediator-article"><img src="https://yglablog.files.wordpress.com/2017/06/ng-15320_8-compressor.jpg" alt="image"><br><br>  <b>Component LiveData</b> - is designed to store the object and allows you to subscribe to its changes.  The key feature is that the component is aware of the life cycle and allows you not to worry about at what stage the subscriber is now, if the subscriber is destroyed, the component will unsubscribe him.  In order for LiveData to take into account the life cycle, the Lifecycle component is used, but it is also possible to use it without reference to the life cycle. <br><br>  The component itself consists of the following classes: <i>LiveData, MutableLiveData, MediatorLiveData, LiveDataReactiveStreams, Transformations</i> and the interface: <i>Observer</i> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>The LiveData class</b> is an abstract generic class and encapsulates the entire logic of the component.  Accordingly, to create our LiveData Holder, it is necessary to inherit this class, specify the type that we plan to store in it as a typification, and also describe the logic of updating the stored object. <br><a name="habracut"></a><br>  To update the value, we must pass it using the setValue (T) method, be careful because this method needs to be called from the main thread, otherwise we will get an <i>IllegalStateException</i> , if we need to pass a value from another thread, we can use <i>postValue (T)</i> , the method in turn updates the value in the main thread.  An interesting feature of <i>postValue (T)</i> is that, in the case of a multiple call, it will not create a queue of calls to the main thread, and when executing the code in the main thread, it will take the last value it received.  Also, there are two kolbek in the class: <br><br>  <i>onActive ()</i> - will be called when the number of subscribers changes from 0 to 1. <br>  <i>onInactive ()</i> - will be called when the number of subscribers changes its value from 1 to 0. <br><br>  Their purpose is to notify our class accordingly about whether it is necessary to update the data or not.  By default, they have no implementation, and we need to override these methods to handle these events. <br><br>  Let's take a look at how our LiveData class will look like, which will store the wife network name and update it if changed, for simplicity, it is implemented as a singleton. <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NetworkLiveData</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LiveData</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">&gt; </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Context context;   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> BroadcastReceiver broadcastReceiver;   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> NetworkLiveData instance;   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> NetworkLiveData </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getInstance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span></span>{       <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (instance==<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>){           instance = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NetworkLiveData(context.getApplicationContext());       }       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> instance;   }   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NetworkLiveData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.context = context;   }   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepareReceiver</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{       IntentFilter filter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IntentFilter();       filter.addAction(<span class="hljs-string"><span class="hljs-string">"android.net.wifi.supplicant.CONNECTION_CHANGE"</span></span>);       filter.addAction(<span class="hljs-string"><span class="hljs-string">"android.net.wifi.STATE_CHANGE"</span></span>);       broadcastReceiver = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BroadcastReceiver() {           <span class="hljs-meta"><span class="hljs-meta">@Override</span></span>           <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onReceive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, Intent intent)</span></span></span><span class="hljs-function"> </span></span>{               WifiManager wifiMgr = (WifiManager) context.getSystemService(Context.WIFI_SERVICE);               WifiInfo wifiInfo = wifiMgr.getConnectionInfo();               String name = wifiInfo.getSSID();               <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (name.isEmpty()) {                   setValue(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>);               } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {                   setValue(name);               }           }       };       context.registerReceiver(broadcastReceiver, filter);   }   <span class="hljs-meta"><span class="hljs-meta">@Override</span></span>   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onActive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{       prepareReceiver(context);   }   <span class="hljs-meta"><span class="hljs-meta">@Override</span></span>   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onInactive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{       context.unregisterReceiver(broadcastReceiver);       broadcastReceiver = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>;   } }</code> </pre> <br>  In general, the fragment logic is as follows: if someone signs up, we initialize the BroadcastReceiver, which will notify us of network changes, after the last subscriber unsubscribes, we stop tracking network changes. <br><br>  In order to add a subscriber there are two methods: <i>observe (LifecycleOwner, Observer &lt;T&gt;)</i> - to add a subscriber with respect to the life cycle and <i>observeForever (Observer &lt;T&gt;)</i> - without considering.  Data change notifications come through an implementation of the <i>Observer</i> interface, which has one <i>onChanged (T)</i> method. <br><br>  It looks like this: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LifecycleActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Observer</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">&gt; </span></span>{  <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> TextView networkName;  <span class="hljs-meta"><span class="hljs-meta">@Override</span></span>  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{      <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState);      setContentView(R.layout.activity_main);      networkName = (TextView) findViewById(R.id.network_name);      NetworkLiveData.getInstance(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>).observe(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>);      <span class="hljs-comment"><span class="hljs-comment">//NetworkLiveData.getInstance(this).observeForever(this);  }  @Override  public void onChanged(@Nullable String s) {      networkName.setText(s);  } }</span></span></code> </pre> <br>  <i>Note: This fragment is for example purposes only; do not use this code in a real project.</i>  <i>To work with LiveData, it is better to use the ViewModel (about this component in the next article) or take care of unsubscribing the observer manually.</i> <i><br></i>  <i>If you use observe (this, this) when you rotate the screen, we will each time unsubscribe from our component and re-subscribe.</i>  <i>And in the case of observeForever (this), we get a memory leak.</i> <br><br>  In addition to the above methods, api LiveData also includes <i>getValue (), hasActiveObservers (), hasObservers (), removeObserver (Observer &lt;T&gt; observer), removeObservers (LifecycleOwner owner)</i> do not need additional comments. <br><br>  <b>The MutableLiveData class</b> is an extension of LiveData, with the difference that it is not an abstract class and the <i>setValue (T)</i> and <i>postValue (T)</i> methods are displayed in api, that is, public. <br>  In fact, the class is a helper for those cases when we don‚Äôt want to put the value update logic in LiveData, but only want to use it as the Holder. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String someText)</span></span></span></span>{      ourMutableLiveData.setValue(String); }</code> </pre><br>  <b>The MediatorLiveData class</b> , as the name implies, is the implementation of the mediator pattern, just in case I remind you: the behavioral pattern defines an object that encapsulates how many objects interact, eliminating the need to explicitly refer to each other.  The class itself extends <i>MutableLiveData</i> and adds two methods to its API: <i>addSource (LiveData &lt;T&gt;, Observer &lt;T&gt;)</i> and <i>removeSource (LiveData &lt;T&gt;)</i> .  The principle of working with a class is that we do not subscribe to a specific source, but to our MediatorLiveData, and add sources using <i>addSource (..)</i> .  MediatorLiveData in turn controls the subscription to the sources. <br><br>  For example, create another class LiveData, which will store the name of our mobile network: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MobileNetworkLiveData</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LiveData</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">&gt; </span></span>{  <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> MobileNetworkLiveData instance;  <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Context context;  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MobileNetworkLiveData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{      <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.context = context;  }  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MobileNetworkLiveData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{  }  <span class="hljs-meta"><span class="hljs-meta">@Override</span></span>  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onActive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{      TelephonyManager telephonyManager = (TelephonyManager) context              .getSystemService(Context.TELEPHONY_SERVICE);      String networkOperator = telephonyManager.getNetworkOperatorName();      setValue(networkOperator);  }  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> MobileNetworkLiveData </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getInstance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (instance == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) {          instance = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MobileNetworkLiveData(context);      }      <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> instance;  } }</code> </pre> <br>  And we will rewrite our application so that it displays the name of the wifi network, and if there is no connection to wifi, then the name of the mobile network, for this we change the MainActivity: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LifecycleActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Observer</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">&gt; </span></span>{  <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> MediatorLiveData&lt;String&gt; mediatorLiveData;  <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> TextView networkName;  <span class="hljs-meta"><span class="hljs-meta">@Override</span></span>  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{      <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState);      setContentView(R.layout.activity_main);      networkName = (TextView) findViewById(R.id.network_name);      mediatorLiveData = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MediatorLiveData&lt;&gt;();      init();  }  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{      <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> LiveData&lt;String&gt; network = NetworkLiveData.getInstance(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>);      <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> LiveData&lt;String&gt; mobileNetwork = MobileNetworkLiveData.getInstance(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>);      Observer&lt;String&gt; networkObserver = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Observer&lt;String&gt;() {          <span class="hljs-meta"><span class="hljs-meta">@Override</span></span>          <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Nullable String s)</span></span></span><span class="hljs-function"> </span></span>{              <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!TextUtils.isEmpty(s))                  mediatorLiveData.setValue(s);              <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>                  mediatorLiveData.setValue(mobileNetwork.getValue());          }      };      Observer&lt;String&gt; mobileNetworkObserver = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Observer&lt;String&gt;() {          <span class="hljs-meta"><span class="hljs-meta">@Override</span></span>          <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Nullable String s)</span></span></span><span class="hljs-function"> </span></span>{                  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (TextUtils.isEmpty(network.getValue())){                      mediatorLiveData.setValue(s);                  }          }      };      mediatorLiveData.addSource(network, networkObserver);      mediatorLiveData.addSource(mobileNetwork,mobileNetworkObserver);      mediatorLiveData.observe(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>);  }  <span class="hljs-meta"><span class="hljs-meta">@Override</span></span>  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Nullable String s)</span></span></span><span class="hljs-function"> </span></span>{      networkName.setText(s);  } }</code> </pre><br>  As we can see, our UI is now subscribed to <i>MediatorLiveData</i> and abstracted from a specific data source.  It is worth paying attention to the fact that the values ‚Äã‚Äãin our mediator do not depend directly on the sources and need to be set manually. <br><br>  <b>The class LiveDataReactiveStreams</b> , the name misled me at first, thought it was an extension of LiveData using RX, in fact, the class is an adapter with two static methods: <i>fromPublisher (Publisher &lt;T&gt; publisher)</i> , which returns a LiveData &lt;T&gt; object and <i>toPublisher (LifecycleOwner lifecycle, LiveData &lt;T&gt; liveData)</i> , which returns a Publisher &lt;T&gt; object.  To use this class, you need to import it separately: <br>  <i>compile "android.arch.lifecycle: reactivestreams: $ version"</i> <br><br>  <b>The Transformations class</b> , which is a helper for changing the typing of LiveData, has two static methods: <br>  <i>map (LiveData &lt;T&gt;, Function &lt;T, P&gt;)</i> - implements the implementation of the Function interface in the main thread and returns a LiveData &lt;P&gt; object, where T is the typing of the incoming LiveData, and P is the desired typing outgoing, in fact every time there will be changes in the incoming LiveData, it will notify our outgoing, and that in turn will notify subscribers after it converts the type using our Function implementation.  This whole mechanism works due to the fact that outgoing LiveData is MediatiorLiveData. <br><br><pre> <code class="java hljs">LiveData&lt;Location&gt; location = ...; LiveData&lt;String&gt; locationString = Transformations.map(location, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Function&lt;Location, String&gt;() {  <span class="hljs-meta"><span class="hljs-meta">@Override</span></span>  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apply</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Location input)</span></span></span><span class="hljs-function"> </span></span>{      <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> input.toString;  } });</code> </pre> <br>  <i>switchMap (LiveData &lt;T&gt;, Function &lt;T, LiveData &lt;P &gt;&gt;)</i> is similar to the map method with the difference that instead of changing the type in the function, we return the generated LiveData object. <br><br><pre> <code class="java hljs">LiveData&lt;Location&gt; location = ...; <span class="hljs-function"><span class="hljs-function">LiveData&lt;Place&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPlace</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Location location)</span></span></span><span class="hljs-function"> </span></span>= ...; LiveData&lt;Place&gt; userName = Transformations.switchMap(location, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Function&lt;Location, LiveData&lt;Place&gt;&gt;() {  <span class="hljs-meta"><span class="hljs-meta">@Override</span></span>  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> LiveData&lt;Place&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apply</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Location input)</span></span></span><span class="hljs-function"> </span></span>{      <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getPlace(input);  } });</code> </pre><br>  The basic example can be viewed in the repository: <a href="https://github.com/kb2fty7/Android-Architecture-Components/tree/livedata">git</a> <br><br>  Also useful links: <a href="https://developer.android.com/topic/libraries/architecture/livedata.html">one</a> and <a href="https://developer.android.com/reference/android/arch/lifecycle/LiveData.html">two</a> . <br><br>  <a href="https://habrahabr.ru/post/332562/">Android Architecture Components.</a>  <a href="https://habrahabr.ru/post/332562/">Part 1. Introduction</a> <br>  <a href="https://habrahabr.ru/post/332718/">Android Architecture Components.</a>  <a href="https://habrahabr.ru/post/332718/">Part 2. Lifecycle</a> <br>  <a href="https://habrahabr.ru/post/333890/">Android Architecture Components.</a>  <a href="https://habrahabr.ru/post/333890/">Part 3. LiveData</a> <br>  <a href="https://habrahabr.ru/post/334942/">Android Architecture Components.</a>  <a href="https://habrahabr.ru/post/334942/">Part 4. ViewModel</a> </div><p>Source: <a href="https://habr.com/ru/post/333890/">https://habr.com/ru/post/333890/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../333878/index.html">PostgreSQL Indexes - 5</a></li>
<li><a href="../333880/index.html">RubyMine 2017.2: Docker Compose, RuboCop auto-correction in the editor, improved VCS</a></li>
<li><a href="../333882/index.html">Security Week 29: How to crack ICO, RCE-bug in tens of millions of installations, Nukebot went to the people</a></li>
<li><a href="../333884/index.html">API Grace Rules</a></li>
<li><a href="../333888/index.html">How to explain the design of four years?</a></li>
<li><a href="../333896/index.html">XBRL: Just About the Complex - Chapter 4. The XBRL Report</a></li>
<li><a href="../333904/index.html">Dismiss, hire, promote - the culture of your company</a></li>
<li><a href="../333906/index.html">Flat Cubik (Rubik's cube on the plane)</a></li>
<li><a href="../333908/index.html">Which languages ‚Äã‚Äãare most in demand in finance: the views of Wall Street recruiters</a></li>
<li><a href="../333910/index.html">Actions upon arrival at work - receiving cases, updating, documenting, auditing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>