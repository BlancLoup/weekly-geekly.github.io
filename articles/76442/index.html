<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>DDB over RDB on Python</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A few months ago, I needed a document database for one planned project in Python. I do not know how it happened, but when I was googling, I managed no...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>DDB over RDB on Python</h1><div class="post__text post__text-html js-mediator-article">  A few months ago, I needed a document database for one planned project in Python.  I do not know how it happened, but when I was googling, I managed not to notice a single existing solution and came to the conclusion that the only way out was to write my own.  Since I wanted to get a working option as quickly as possible, I decided to build on existing relational databases, so as not to suffer from the implementation of storage, search, transactions and such things.  In the end, my creation got a decent look, and I decided to write a note about it here - maybe someone else will come in handy. <br><a name="habracut"></a><br><h2>  Where to get </h2><br><br>  For the most impatient: <br><ul><li>  project page with documentation and download link - <a href="http://pypi.python.org/pypi/brain">pypi.python.org/pypi/brain</a> </li><li>  project git-repository - <a href="http://github.com/Manticore/brain">github.com/Manticore/brain</a> </li></ul><br><br>  The database is designed as a module and requires Python 3 to be used (and to run unit tests, Python 3.1, very good methods have been added there).  Immediately I apologize to all Orthodox, who still cannot decide to go even to 2.6 - I, of course, could port my module to 2. *, but I was lazy. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As I already said, the module uses a regular relational database as the bottom layer for operation.  Currently supported is SQLite (the one that comes with Python) and Postgre 8 (if py-postgresql is installed). <br><br><h2>  ‚Ä¶ and what to do with it </h2><br><br>  I believe that document databases are already familiar to many, so I will be brief.  So, the basic concept with us is an object.  The object has a unique identifier and a certain amount of data of various types.  In my database, the data is a combination of the simplest types - int, float, str, bytes, and None - and the complex types - dict and list.  The nesting level is limited only by the relational engine, I will explain the reasons later.  The object identifier itself can also be stored in another (or in the same) object.  Objects can be created, deleted, and their contents can be changed arbitrarily;  and, of course, search for the necessary objects by the specified criteria. <br><br>  So, suppose you have already downloaded and installed the module.  Or even simply presented it - it does not matter.  To illustrate the work with the module, I will simply copy here some examples from the documentation (for those who were too lazy to click the link above). <br><br>  So, connect the module and create a connection.  For simplicity, the default relational engine (SQLite) and in-memory database will be used. <br><br> <code>&gt;&gt;&gt; import brain <br> &gt;&gt;&gt; conn = brain.connect(None, None) <br></code> <br><br>  Now create a pair of objects.  Notice the nested list in the second object. <br><br> <code>&gt;&gt;&gt; id1 = conn.create({'a': 1, 'b': 1.345}) <br> &gt;&gt;&gt; id2 = conn.create({'id1': id1, 'list': [1, 2, 'some_value']}) <br></code> <br><br>  Objects can be read in its entirety or select a specific section.  In the second case, the path to the required data is used - just a list, where the string means the key in dict, and the number - the index in the list. <br><br> <code>&gt;&gt;&gt; print(conn.read(id1)) <br> {'a': 1, 'b': 1.345} <br> &gt;&gt;&gt; print(conn.read(id2, ['list'])) <br> [1, 2, 'some_value'] <br></code> <br><br>  The contents of the object can be changed. <br><br> <code>&gt;&gt;&gt; conn.modify(id1, ['a'], 2) <br> &gt;&gt;&gt; print(conn.read(id1)) <br> {'a': 2, 'b': 1.345} <br></code> <br><br>  And finally, the desired object can be found. <br><br> <code>&gt;&gt;&gt; import brain.op as op <br> &gt;&gt;&gt; objs = conn.search(['list', 0], op.EQ, 1) <br> &gt;&gt;&gt; print(objs == [id2]) <br> True <br></code> <br><br>  The condition used is decrypted as ‚Äúthe 0th element of the list that is in the 'dict' key of the root dictionary is 1‚Äù. <br><br><h2>  And it's all? </h2><br><br>  Not really.  For lists, there is a special insert command (which works about the same as the Python equivalent).  Objects and their parts can be deleted (including by masks).  Search terms can be combined using logical operators.  Oh yeah, transactions are still supported, there is a simple RPC server and a caching connection (rather stupid).  All this can be found in the documentation. <br><br><h2>  What's inside? </h2><br><br>  Inside, it's pretty simple.  For each unique path, a table with the corresponding name is created (and paths that differ only in indexes in lists use the same table).  For example, for data of the form {'key': [{'key2': 'val'}]], the value of 'val' will be stored in a table with the name "field.TEXT.key..key2" (the empty space between the two points says that the key is a list).  In addition, there is one large table in which the fields available to each object and their types are recorded for each object.  Thus, if something suddenly goes wrong, then it will be quite possible to restore the data with the available means for working with relational databases. <br><br>  This results in a restriction on the level of nesting of stored data structures - it all depends on the maximum length of the table name the relational database supports. <br><br><h2>  So, what is next? </h2><br><br>  As I said, the existing version of the database is quite sufficient for my purposes.  But if suddenly someone thinks that this creation can be useful to someone else, then I will be happy to add the necessary features.  And, of course, any constructive criticism of the code / architecture / documentation is welcome. </div><p>Source: <a href="https://habr.com/ru/post/76442/">https://habr.com/ru/post/76442/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../76430/index.html">Business in style Habr - 4. Cold spin. Part two</a></li>
<li><a href="../76431/index.html">Beta version of the "killer" (or "competitor") Google Chrome OS will be released in January 2010, release - during the year</a></li>
<li><a href="../76432/index.html">Something about sex</a></li>
<li><a href="../76433/index.html">7 tricks for your company's twitter</a></li>
<li><a href="../76438/index.html">Republican statistics</a></li>
<li><a href="../76443/index.html">Ruby + Cygwin + Win or another way to install RoR</a></li>
<li><a href="../76445/index.html">My business is online accounting for individual entrepreneurs</a></li>
<li><a href="../76447/index.html">Jason and the Internet (ending)</a></li>
<li><a href="../76448/index.html">First Zend Framework Conference in Russia</a></li>
<li><a href="../76449/index.html">Security in Windows 7 and IE8: new materials in Russian</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>