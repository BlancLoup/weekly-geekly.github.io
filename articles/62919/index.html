<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Interaction between multiple .bat, multiplayer on .bat</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bat files are not able to transmit any useful information to each other over the network. 

 No sockets, well, okay, but there is a simple work with n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Interaction between multiple .bat, multiplayer on .bat</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/430/fa2/413/430fa241376c4e5fa2ffdd477f57a91f.png"><br>  Bat files are not able to transmit any useful information to each other over the network. <br><a name="habracut"></a><br>  No sockets, well, okay, but there is a simple work with named data areas, i.e.  files.  Creating and reading single-line text files is generally simplified to the limit.  Just run echo Text&gt; file.txt and file.txt will contain the string "Text".  You can read a line from a file like this: set / p var = &lt;file.txt (after execution, the var variable will contain the string "Text"). <br><habracut><br>  So, you can transfer information between batch files through files.  And if these files are located on shared network resources, then batch files running on different computers can easily communicate with each other. <br><br>  Here is a small example of a client-server application, such a rexec for the poor. <br><br>  rexec_server.bat file: <br><pre><code class="hljs dos"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span> checkFolder=\\IMP5\PUBLIC_RW :loop @<span class="hljs-built_in"><span class="hljs-built_in">ping</span></span> -n <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">127</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> &gt; <span class="hljs-built_in"><span class="hljs-built_in">nul</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exist</span></span> "<span class="hljs-variable"><span class="hljs-variable">%checkFolder%</span></span>\!<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span>" <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> loop @<span class="hljs-keyword"><span class="hljs-keyword">call</span></span> "<span class="hljs-variable"><span class="hljs-variable">%checkFolder%</span></span>\!command.bat" &gt; "<span class="hljs-variable"><span class="hljs-variable">%checkFolder%</span></span>\!result" @<span class="hljs-built_in"><span class="hljs-built_in">del</span></span> "<span class="hljs-variable"><span class="hljs-variable">%checkFolder%</span></span>\!<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span>" @<span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> loop</code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      rexec_client.bat file: <br><pre> <code class="hljs dos">@<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> off <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> checkFolder=\\IMP5\PUBLIC_RW :mainloop <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> /pc=^&gt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> "<span class="hljs-variable"><span class="hljs-variable">%c%</span></span>"=="<span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>" <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> "<span class="hljs-variable"><span class="hljs-variable">%c%</span></span>"=="quit" <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">%c%</span></span>&gt;"<span class="hljs-variable"><span class="hljs-variable">%checkFolder%</span></span>\!command.bat" <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>.&gt;"<span class="hljs-variable"><span class="hljs-variable">%checkFolder%</span></span>\!<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span>" :waitloop <span class="hljs-built_in"><span class="hljs-built_in">ping</span></span> -n <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">127</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> &gt; <span class="hljs-built_in"><span class="hljs-built_in">nul</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exist</span></span> "<span class="hljs-variable"><span class="hljs-variable">%checkFolder%</span></span>\!<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span>" <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> waitloop <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> "<span class="hljs-variable"><span class="hljs-variable">%checkFolder%</span></span>\!result" <span class="hljs-built_in"><span class="hljs-built_in">del</span></span> "<span class="hljs-variable"><span class="hljs-variable">%checkFolder%</span></span>\!result" <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> mainloop</code> </pre><br><br>  Here is an example of work: <br><img src="https://habrastorage.org/files/34f/d78/81a/34fd7881ad184a24a16ae3d333dadb97.png"><br><br>  It does the following: rexec_server.bat waits for the command line from the client and executes it on the computer on which it is running.  He communicates with the client through the shared folder <nobr>"\\ IMP5 \ PUBLIC_RW"</nobr> (of course, you will need to replace it with your own if you want to experiment).  So that the client and the server did not try to read ahead of time the files that are now being written for them, flag files were provided that serve only to indicate that the information has already been saved completely. <br><br>  Well, for a snack - a multiplayer game on .bat "tic-tac-toe, three in a row." <br>  Here, to preserve the integrity of the data, a critical section mechanism is implemented for blocking attempts to simultaneously access files. <br>  Remember that before launching you need to specify your shared folder in the line <nobr>‚Äúset FLAG_DIR = \\ IMP5 \ SHARED_RW‚Äù</nobr> (by the way, several games can be played through one folder at a time). <br><br>  Xo.bat file: <br><pre> <code class="hljs dos">@<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> off <span class="hljs-built_in"><span class="hljs-built_in">cls</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> FLAG_DIR=\\IMP5\SHARED_RW <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :create_chars :restart <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Please wait... <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :sys_utils init "%<span class="hljs-number"><span class="hljs-number">0</span></span>" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> cmdPrefix=$p<span class="hljs-variable"><span class="hljs-variable">%__PID%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">rem</span></span> ------- connecting -------- <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :sys_utils enter_critical_section <span class="hljs-built_in"><span class="hljs-built_in">cls</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :sys_utils fetch_flag ready_to_play <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> "<span class="hljs-variable"><span class="hljs-variable">%RESULT%</span></span>"=="" ( <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :sys_utils set_flag ready_to_play <span class="hljs-variable"><span class="hljs-variable">%cmdPrefix%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> symbol=X <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> symbol2=O <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> server=<span class="hljs-number"><span class="hljs-number">1</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> ( <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> cmdPrefix=<span class="hljs-variable"><span class="hljs-variable">%RESULT%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :sys_utils set_flag <span class="hljs-variable"><span class="hljs-variable">%RESULT%</span></span>_client_ready --- <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> symbol=O <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> symbol2=X <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> server=<span class="hljs-number"><span class="hljs-number">0</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :sys_utils leave_critical_section <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> "<span class="hljs-variable"><span class="hljs-variable">%server%</span></span>"=="<span class="hljs-number"><span class="hljs-number">0</span></span>" <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> client1 <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :wait_for_client <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :sys_utils set_flag <span class="hljs-variable"><span class="hljs-variable">%cmdPrefix%</span></span>_server_ready_too --- <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> skipClient1 :client1 <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :wait_for_server <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> "<span class="hljs-variable"><span class="hljs-variable">%serverFailure%</span></span>"=="<span class="hljs-number"><span class="hljs-number">1</span></span>" <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> restart :skipClient1 <span class="hljs-built_in"><span class="hljs-built_in">rem</span></span> ------- connected -------- <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :clear_field <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> "<span class="hljs-variable"><span class="hljs-variable">%server%</span></span>"=="<span class="hljs-number"><span class="hljs-number">1</span></span>" (<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> curMode=your_turn) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> curMode=enemy_turn) :main_game_loop <span class="hljs-built_in"><span class="hljs-built_in">cls</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :check_win <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :render_field <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> "<span class="hljs-variable"><span class="hljs-variable">%winSymbol%</span></span>"=="<span class="hljs-variable"><span class="hljs-variable">%symbol%</span></span>" <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> you_win <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> "<span class="hljs-variable"><span class="hljs-variable">%winSymbol%</span></span>"=="<span class="hljs-variable"><span class="hljs-variable">%symbol2%</span></span>" <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> enemy_win <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> "<span class="hljs-variable"><span class="hljs-variable">%curMode%</span></span>"=="your_turn" <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> skipTurn1 <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Your are "<span class="hljs-variable"><span class="hljs-variable">%symbol%</span></span>" <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> /p tmp=Please enter &lt;<span class="hljs-built_in"><span class="hljs-built_in">nul</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> "<span class="hljs-variable"><span class="hljs-variable">%f1%</span></span>"=="<span class="hljs-number"><span class="hljs-number">1</span></span>" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> /p tmp=<span class="hljs-number"><span class="hljs-number">1</span></span>, &lt;<span class="hljs-built_in"><span class="hljs-built_in">nul</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> "<span class="hljs-variable"><span class="hljs-variable">%f2%</span></span>"=="<span class="hljs-number"><span class="hljs-number">2</span></span>" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> /p tmp=<span class="hljs-number"><span class="hljs-number">2</span></span>, &lt;<span class="hljs-built_in"><span class="hljs-built_in">nul</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> "<span class="hljs-variable"><span class="hljs-variable">%f3%</span></span>"=="<span class="hljs-number"><span class="hljs-number">3</span></span>" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> /p tmp=<span class="hljs-number"><span class="hljs-number">3</span></span>, &lt;<span class="hljs-built_in"><span class="hljs-built_in">nul</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> "<span class="hljs-variable"><span class="hljs-variable">%f4%</span></span>"=="<span class="hljs-number"><span class="hljs-number">4</span></span>" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> /p tmp=<span class="hljs-number"><span class="hljs-number">4</span></span>, &lt;<span class="hljs-built_in"><span class="hljs-built_in">nul</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> "<span class="hljs-variable"><span class="hljs-variable">%f5%</span></span>"=="<span class="hljs-number"><span class="hljs-number">5</span></span>" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> /p tmp=<span class="hljs-number"><span class="hljs-number">5</span></span>, &lt;<span class="hljs-built_in"><span class="hljs-built_in">nul</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> "<span class="hljs-variable"><span class="hljs-variable">%f6%</span></span>"=="<span class="hljs-number"><span class="hljs-number">6</span></span>" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> /p tmp=<span class="hljs-number"><span class="hljs-number">6</span></span>, &lt;<span class="hljs-built_in"><span class="hljs-built_in">nul</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> "<span class="hljs-variable"><span class="hljs-variable">%f7%</span></span>"=="<span class="hljs-number"><span class="hljs-number">7</span></span>" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> /p tmp=<span class="hljs-number"><span class="hljs-number">7</span></span>, &lt;<span class="hljs-built_in"><span class="hljs-built_in">nul</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> "<span class="hljs-variable"><span class="hljs-variable">%f8%</span></span>"=="<span class="hljs-number"><span class="hljs-number">8</span></span>" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> /p tmp=<span class="hljs-number"><span class="hljs-number">8</span></span>, &lt;<span class="hljs-built_in"><span class="hljs-built_in">nul</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> "<span class="hljs-variable"><span class="hljs-variable">%f9%</span></span>"=="<span class="hljs-number"><span class="hljs-number">9</span></span>" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> /p tmp=<span class="hljs-number"><span class="hljs-number">9</span></span>, &lt;<span class="hljs-built_in"><span class="hljs-built_in">nul</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> or 'q' <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> quit <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> /p "tmp=Your turn: " <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> "<span class="hljs-variable"><span class="hljs-variable">%tmp%</span></span>"=="q" <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> quit_game <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> "<span class="hljs-variable"><span class="hljs-variable">%tmp%</span></span>"=="Q" <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> quit_game <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> varName=<span class="hljs-variable"><span class="hljs-variable">%%f</span></span><span class="hljs-variable"><span class="hljs-variable">%tmp%</span></span>%% <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> "<span class="hljs-variable"><span class="hljs-variable">%varName%</span></span>"=="<span class="hljs-variable"><span class="hljs-variable">%tmp%</span></span>" <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> main_game_loop <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> f<span class="hljs-variable"><span class="hljs-variable">%tmp%</span></span>=<span class="hljs-variable"><span class="hljs-variable">%symbol%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :sys_utils set_flag <span class="hljs-variable"><span class="hljs-variable">%cmdPrefix%</span></span>_<span class="hljs-variable"><span class="hljs-variable">%symbol%</span></span>_move f<span class="hljs-variable"><span class="hljs-variable">%tmp%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> curMode=enemy_turn <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> main_game_loop :skipTurn1 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> "<span class="hljs-variable"><span class="hljs-variable">%curMode%</span></span>"=="enemy_turn" <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> skipTurn2 <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Waiting <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> another player :wait_for_player0 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> /p tmp=.&lt;<span class="hljs-built_in"><span class="hljs-built_in">nul</span></span> <span class="hljs-built_in"><span class="hljs-built_in">ping</span></span> -n <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">127</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> &gt; <span class="hljs-built_in"><span class="hljs-built_in">nul</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :sys_utils fetch_flag <span class="hljs-variable"><span class="hljs-variable">%cmdPrefix%</span></span>_<span class="hljs-variable"><span class="hljs-variable">%symbol2%</span></span>_move <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> "<span class="hljs-variable"><span class="hljs-variable">%RESULT%</span></span>"=="" <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> wait_for_player0 <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">%RESULT%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> "<span class="hljs-variable"><span class="hljs-variable">%RESULT%</span></span>"=="q" <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> other_player_quit <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-variable"><span class="hljs-variable">%RESULT%</span></span>=<span class="hljs-variable"><span class="hljs-variable">%symbol2%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> curMode=your_turn <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> main_game_loop :skipTurn2 <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> main_game_loop :quit_game <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :sys_utils set_flag <span class="hljs-variable"><span class="hljs-variable">%cmdPrefix%</span></span>_<span class="hljs-variable"><span class="hljs-variable">%symbol%</span></span>_move q <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> :other_player_quit <span class="hljs-built_in"><span class="hljs-built_in">cls</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Other player has left the game. <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Press 'Enter' to search <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> another one. <span class="hljs-built_in"><span class="hljs-built_in">pause</span></span> &gt; <span class="hljs-built_in"><span class="hljs-built_in">nul</span></span> <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> restart :you_win <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> You Win <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Press 'Enter' <span class="hljs-built_in"><span class="hljs-built_in">pause</span></span> &gt; <span class="hljs-built_in"><span class="hljs-built_in">nul</span></span> <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> restart :enemy_win <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> You Lose <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Press 'Enter' <span class="hljs-built_in"><span class="hljs-built_in">pause</span></span> &gt; <span class="hljs-built_in"><span class="hljs-built_in">nul</span></span> <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> restart :wait_for_client <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Waiting <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> client :wait_for_client1 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> /p tmp=.&lt;<span class="hljs-built_in"><span class="hljs-built_in">nul</span></span> <span class="hljs-built_in"><span class="hljs-built_in">ping</span></span> -n <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">127</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> &gt; <span class="hljs-built_in"><span class="hljs-built_in">nul</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :sys_utils fetch_flag <span class="hljs-variable"><span class="hljs-variable">%cmdPrefix%</span></span>_client_ready <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> "<span class="hljs-variable"><span class="hljs-variable">%RESULT%</span></span>"=="" <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> wait_for_client1 <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> /b :wait_for_server <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Waiting <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> server <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> serverFailure=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> /a waitCnt=<span class="hljs-number"><span class="hljs-number">4</span></span> :wait_for_server1 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> /a waitCnt-=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> "<span class="hljs-variable"><span class="hljs-variable">%waitCnt%</span></span>"=="<span class="hljs-number"><span class="hljs-number">0</span></span>" ( <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> serverFailure=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> /b ) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> /p tmp=.&lt;<span class="hljs-built_in"><span class="hljs-built_in">nul</span></span> <span class="hljs-built_in"><span class="hljs-built_in">ping</span></span> -n <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">127</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> &gt; <span class="hljs-built_in"><span class="hljs-built_in">nul</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :sys_utils fetch_flag <span class="hljs-variable"><span class="hljs-variable">%cmdPrefix%</span></span>_server_ready_too <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> "<span class="hljs-variable"><span class="hljs-variable">%RESULT%</span></span>"=="" <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> wait_for_server1 <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> /b :clear_field <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "f1=<span class="hljs-number"><span class="hljs-number">1</span></span>" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "f2=<span class="hljs-number"><span class="hljs-number">2</span></span>" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "f3=<span class="hljs-number"><span class="hljs-number">3</span></span>" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "f4=<span class="hljs-number"><span class="hljs-number">4</span></span>" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "f5=<span class="hljs-number"><span class="hljs-number">5</span></span>" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "f6=<span class="hljs-number"><span class="hljs-number">6</span></span>" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "f7=<span class="hljs-number"><span class="hljs-number">7</span></span>" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "f8=<span class="hljs-number"><span class="hljs-number">8</span></span>" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "f9=<span class="hljs-number"><span class="hljs-number">9</span></span>" <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> /b :create_chars <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "charX0= # # ^|" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "charX1= # # ^|" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "charX2= # ^|" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "charX3= # # ^|" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "charX4= # # ^|" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "charX5=-------+" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "charO0= ### ^|" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "charO1= # # ^|" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "charO2= # # ^|" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "charO3= # # ^|" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "charO4= ### ^|" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "charO5=-------+" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "charXW0=.#...#.^|" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "charXW1=..#.#..^|" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "charXW2=...#...^|" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "charXW3=..#.#..^|" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "charXW4=.#...#.^|" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "charXW5=-------+" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "charOW0=..###..^|" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "charOW1=.#...#.^|" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "charOW2=.#...#.^|" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "charOW3=.#...#.^|" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "charOW4=..###..^|" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "charOW5=-------+" <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-variable"><span class="hljs-variable">%%i</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span>,<span class="hljs-number"><span class="hljs-number">8</span></span>,<span class="hljs-number"><span class="hljs-number">9</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :create_empty_char <span class="hljs-variable"><span class="hljs-variable">%%i</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> /b :create_empty_char <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "char%<span class="hljs-number"><span class="hljs-number">10</span></span>= ^|" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "char%<span class="hljs-number"><span class="hljs-number">11</span></span>= ^|" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "char%<span class="hljs-number"><span class="hljs-number">12</span></span>= %<span class="hljs-number"><span class="hljs-number">1</span></span> ^|" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "char%<span class="hljs-number"><span class="hljs-number">13</span></span>= ^|" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "char%<span class="hljs-number"><span class="hljs-number">14</span></span>= ^|" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "char%<span class="hljs-number"><span class="hljs-number">15</span></span>=-------+" <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> /b :check_win <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> winSymbol=. <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :check3 <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :check3 <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :check3 <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :check3 <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :check3 <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :check3 <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :check3 <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :check3 <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> /b :check3 <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> tmp1=<span class="hljs-variable"><span class="hljs-variable">%%f</span></span><span class="hljs-variable"><span class="hljs-variable">%1%</span></span><span class="hljs-variable"><span class="hljs-variable">%%%</span></span>f<span class="hljs-variable"><span class="hljs-variable">%2%</span></span><span class="hljs-variable"><span class="hljs-variable">%%%</span></span>f<span class="hljs-variable"><span class="hljs-variable">%3%</span></span>% <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> tmp2=<span class="hljs-variable"><span class="hljs-variable">%%f</span></span><span class="hljs-variable"><span class="hljs-variable">%1%</span></span><span class="hljs-variable"><span class="hljs-variable">%%%</span></span>f<span class="hljs-variable"><span class="hljs-variable">%1%</span></span><span class="hljs-variable"><span class="hljs-variable">%%%</span></span>f<span class="hljs-variable"><span class="hljs-variable">%1%</span></span>% <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> "<span class="hljs-variable"><span class="hljs-variable">%tmp1%</span></span>"=="<span class="hljs-variable"><span class="hljs-variable">%tmp2%</span></span>" ( <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "winSymbol=<span class="hljs-variable"><span class="hljs-variable">%%f</span></span><span class="hljs-variable"><span class="hljs-variable">%1%</span></span>%" <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "f<span class="hljs-variable"><span class="hljs-variable">%1=%</span></span><span class="hljs-variable"><span class="hljs-variable">%f%</span></span><span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-variable"><span class="hljs-variable">%%W</span></span>" <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "f<span class="hljs-variable"><span class="hljs-variable">%2=%</span></span><span class="hljs-variable"><span class="hljs-variable">%f%</span></span><span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-variable"><span class="hljs-variable">%%W</span></span>" <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "f<span class="hljs-variable"><span class="hljs-variable">%3=%</span></span><span class="hljs-variable"><span class="hljs-variable">%f%</span></span><span class="hljs-number"><span class="hljs-number">3</span></span><span class="hljs-variable"><span class="hljs-variable">%%W</span></span>" ) <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> /b :render_field <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :render_line <span class="hljs-variable"><span class="hljs-variable">%f1%</span></span> <span class="hljs-variable"><span class="hljs-variable">%f2%</span></span> <span class="hljs-variable"><span class="hljs-variable">%f3%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :render_line <span class="hljs-variable"><span class="hljs-variable">%f4%</span></span> <span class="hljs-variable"><span class="hljs-variable">%f5%</span></span> <span class="hljs-variable"><span class="hljs-variable">%f6%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :render_line <span class="hljs-variable"><span class="hljs-variable">%f7%</span></span> <span class="hljs-variable"><span class="hljs-variable">%f8%</span></span> <span class="hljs-variable"><span class="hljs-variable">%f9%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> /b :render_line <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">%%c</span></span>har<span class="hljs-variable"><span class="hljs-variable">%10%</span></span><span class="hljs-variable"><span class="hljs-variable">%%%</span></span>char<span class="hljs-variable"><span class="hljs-variable">%20%</span></span><span class="hljs-variable"><span class="hljs-variable">%%%</span></span>char<span class="hljs-variable"><span class="hljs-variable">%30%</span></span>% <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">%%c</span></span>har<span class="hljs-variable"><span class="hljs-variable">%11%</span></span><span class="hljs-variable"><span class="hljs-variable">%%%</span></span>char<span class="hljs-variable"><span class="hljs-variable">%21%</span></span><span class="hljs-variable"><span class="hljs-variable">%%%</span></span>char<span class="hljs-variable"><span class="hljs-variable">%31%</span></span>% <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">%%c</span></span>har<span class="hljs-variable"><span class="hljs-variable">%12%</span></span><span class="hljs-variable"><span class="hljs-variable">%%%</span></span>char<span class="hljs-variable"><span class="hljs-variable">%22%</span></span><span class="hljs-variable"><span class="hljs-variable">%%%</span></span>char<span class="hljs-variable"><span class="hljs-variable">%32%</span></span>% <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">%%c</span></span>har<span class="hljs-variable"><span class="hljs-variable">%13%</span></span><span class="hljs-variable"><span class="hljs-variable">%%%</span></span>char<span class="hljs-variable"><span class="hljs-variable">%23%</span></span><span class="hljs-variable"><span class="hljs-variable">%%%</span></span>char<span class="hljs-variable"><span class="hljs-variable">%33%</span></span>% <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">%%c</span></span>har<span class="hljs-variable"><span class="hljs-variable">%14%</span></span><span class="hljs-variable"><span class="hljs-variable">%%%</span></span>char<span class="hljs-variable"><span class="hljs-variable">%24%</span></span><span class="hljs-variable"><span class="hljs-variable">%%%</span></span>char<span class="hljs-variable"><span class="hljs-variable">%34%</span></span>% <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">%%c</span></span>har<span class="hljs-variable"><span class="hljs-variable">%15%</span></span><span class="hljs-variable"><span class="hljs-variable">%%%</span></span>char<span class="hljs-variable"><span class="hljs-variable">%25%</span></span><span class="hljs-variable"><span class="hljs-variable">%%%</span></span>char<span class="hljs-variable"><span class="hljs-variable">%35%</span></span>% <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> /b <span class="hljs-built_in"><span class="hljs-built_in">rem</span></span> ----------------- atom -------------- :sys_utils <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> %<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> /b :init <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> "<span class="hljs-variable"><span class="hljs-variable">%FLAG_DIR%</span></span>"=="" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> FLAG_DIR=. <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> UNIQ_BAT_ID=<span class="hljs-variable"><span class="hljs-variable">%COMPUTERNAME%</span></span>_<span class="hljs-variable"><span class="hljs-variable">%USERNAME%</span></span>_%~n2 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> /A CRITICAL_SECTION_LEVEL=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :enter_critical_section <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :test_flag --null-- $pid$ <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> /A __PID=<span class="hljs-variable"><span class="hljs-variable">%RESULT%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [<span class="hljs-variable"><span class="hljs-variable">%__PID%</span></span>]==[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> /A __PID=<span class="hljs-number"><span class="hljs-number">10000000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [<span class="hljs-variable"><span class="hljs-variable">%__PID%</span></span>]==[] <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> /A __PID=<span class="hljs-number"><span class="hljs-number">10000000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [<span class="hljs-variable"><span class="hljs-variable">%__PID%</span></span>]==[<span class="hljs-number"><span class="hljs-number">99999999</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> /A __PID=<span class="hljs-number"><span class="hljs-number">10000000</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> /A __PID=__PID+<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :set_flag --null-- $pid$ <span class="hljs-variable"><span class="hljs-variable">%__PID%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :leave_critical_section <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> UNIQ_BAT_ID=<span class="hljs-variable"><span class="hljs-variable">%UNIQ_BAT_ID%</span></span>_pid<span class="hljs-variable"><span class="hljs-variable">%__PID%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> /b :set_flag <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :enter_critical_section <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">%3&gt;"%</span></span>FLAG_DIR<span class="hljs-variable"><span class="hljs-variable">%\%</span></span><span class="hljs-number"><span class="hljs-number">2</span></span>" <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :leave_critical_section <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> /b :remove_flag <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :enter_critical_section <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exist</span></span> "<span class="hljs-variable"><span class="hljs-variable">%FLAG_DIR%</span></span>\%<span class="hljs-number"><span class="hljs-number">2</span></span>" <span class="hljs-built_in"><span class="hljs-built_in">del</span></span> "<span class="hljs-variable"><span class="hljs-variable">%FLAG_DIR%</span></span>\%<span class="hljs-number"><span class="hljs-number">2</span></span>" <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :leave_critical_section <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> /b :fetch_flag <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :enter_critical_section <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "RESULT=" <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exist</span></span> "<span class="hljs-variable"><span class="hljs-variable">%FLAG_DIR%</span></span>\%<span class="hljs-number"><span class="hljs-number">2</span></span>" ( <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> /p RESULT=&lt;"<span class="hljs-variable"><span class="hljs-variable">%FLAG_DIR%</span></span>\%<span class="hljs-number"><span class="hljs-number">2</span></span>" <span class="hljs-built_in"><span class="hljs-built_in">del</span></span> "<span class="hljs-variable"><span class="hljs-variable">%FLAG_DIR%</span></span>\%<span class="hljs-number"><span class="hljs-number">2</span></span>" ) <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :leave_critical_section <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> /b :test_flag <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :enter_critical_section <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "RESULT=" <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exist</span></span> "<span class="hljs-variable"><span class="hljs-variable">%FLAG_DIR%</span></span>\%<span class="hljs-number"><span class="hljs-number">2</span></span>" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> /p RESULT=&lt;"<span class="hljs-variable"><span class="hljs-variable">%FLAG_DIR%</span></span>\%<span class="hljs-number"><span class="hljs-number">2</span></span>" <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :leave_critical_section <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> /b :enter_critical_section <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> /A CRITICAL_SECTION_LEVEL=CRITICAL_SECTION_LEVEL+<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> [<span class="hljs-variable"><span class="hljs-variable">%CRITICAL_SECTION_LEVEL%</span></span>]==[<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> /b <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> /A __WAIT_CNT=<span class="hljs-number"><span class="hljs-number">500</span></span> :wait_enter_critical_section <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> /A __WAIT_CNT=__WAIT_CNT-<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [<span class="hljs-variable"><span class="hljs-variable">%__WAIT_CNT%</span></span>]==[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">del</span></span> "<span class="hljs-variable"><span class="hljs-variable">%FLAG_DIR%</span></span>\$cs$_*" <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exist</span></span> "<span class="hljs-variable"><span class="hljs-variable">%FLAG_DIR%</span></span>\$cs$_*" <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> wait_enter_critical_section <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>.&gt;"<span class="hljs-variable"><span class="hljs-variable">%FLAG_DIR%</span></span>\$cs$_<span class="hljs-variable"><span class="hljs-variable">%UNIQ_BAT_ID%</span></span>" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> /A __CNT=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-variable"><span class="hljs-variable">%%i</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ( "<span class="hljs-variable"><span class="hljs-variable">%FLAG_DIR%</span></span>\$cs$_*" ) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> /a __CNT=__CNT+<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [<span class="hljs-variable"><span class="hljs-variable">%__CNT%</span></span>]==[<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> all_right_1 <span class="hljs-built_in"><span class="hljs-built_in">del</span></span> "<span class="hljs-variable"><span class="hljs-variable">%FLAG_DIR%</span></span>\$cs$_<span class="hljs-variable"><span class="hljs-variable">%UNIQ_BAT_ID%</span></span>" <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> wait_enter_critical_section :all_right_1 <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> /b :leave_critical_section <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> /A CRITICAL_SECTION_LEVEL=CRITICAL_SECTION_LEVEL-<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [<span class="hljs-variable"><span class="hljs-variable">%CRITICAL_SECTION_LEVEL%</span></span>]==[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">del</span></span> "<span class="hljs-variable"><span class="hljs-variable">%FLAG_DIR%</span></span>\$cs$_<span class="hljs-variable"><span class="hljs-variable">%UNIQ_BAT_ID%</span></span>" <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> /b :EOF</code> </pre></habracut></div><p>Source: <a href="https://habr.com/ru/post/62919/">https://habr.com/ru/post/62919/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../62909/index.html">Opera mobile report: May 2009</a></li>
<li><a href="../62913/index.html">Video about new features in Mozilla Firefox 3.5</a></li>
<li><a href="../62914/index.html">Windows - over 1000 free legal songs!</a></li>
<li><a href="../62915/index.html">CMS TYPO3 developers, meeting TUG2009</a></li>
<li><a href="../62917/index.html">Lotus Symphony 1.3 as an alternative to Microsoft Office 2007</a></li>
<li><a href="../62920/index.html">In Kazakhstan, the Internet has become the media</a></li>
<li><a href="../62921/index.html">Segalovich praises Nigma.ru</a></li>
<li><a href="../62924/index.html">Effective calculation of the total cost of ownership of software</a></li>
<li><a href="../62925/index.html">Efficiency of VKontakte and Odnokashnikov groups</a></li>
<li><a href="../62926/index.html">Webnames.ru - renew domains in advance</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>