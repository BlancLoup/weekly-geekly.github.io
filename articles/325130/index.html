<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>All protocol PHP bot in 10 minutes, or how Microsoft Bot Framework and Azure Functions make life easier for us</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It is absolutely impossible to deny that the development of natural patterns in the interfaces gave a fantastic impetus to the development of the enti...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>All protocol PHP bot in 10 minutes, or how Microsoft Bot Framework and Azure Functions make life easier for us</h1><div class="post__text post__text-html js-mediator-article">  It is absolutely impossible to deny that the development of natural patterns in the interfaces gave a fantastic impetus to the development of the entire IT industry as a whole.  And this is not only and not so much about voice interfaces, but about the widespread introduction of gestures, a huge shift in the paradigm of mobile platforms and, of course, significant work in the field of UI and UX as a whole.  While the industry is striving to become increasingly friendly for more and more people, the usual and, to a certain extent, routine development turns into endless attempts to embrace the immense.  If before we were mostly concerned with the levels of abstraction of languages ‚Äã‚Äãand frameworks, now we are faced with much more global issues.  How to find a balance between a complex and functional interface?  Should I start a new project with microservices?  I can‚Äôt answer these questions, but I can tell you about the tools that already now make it much easier and cheaper to master and apply new technologies and development approaches. <a name="habracut"></a><br><br><h2>  Introduction </h2><br>  Chatbots have a long and not very successful history, but, like about touch interfaces or neural networks, one can say about them - everything has its time.  In the last round of history, bots owe their popularity to Asian messengers and social networks.  Having started in Asia, they set off to conquer Western social services.  Those, in turn, hastily concocted the API, began to compete in a variety of opportunities and the amount of potential earnings on their platforms.  That turned the lives of ordinary developers, who faced the same tasks of mastering bots, but from the side of content and service providers, into a nightmare. <br><br><div style="text-align:center;"><img width="90%" height="90%" src="https://habrastorage.org/files/61c/f14/37d/61cf1437d277447f86277ed251d0449d.jpg"></div><br>  Only one instant messengers that potentially go to the client can be counted with a dozen or so success, and in fact there are still classic SMS, Email and web chats.  And all this requires a special approach, because each offers its own API or SDK.  And it would be good to manage to cover all with one more or less consistent code, in order not to develop and support ten different implementations of the same.  Business requires not so much quality coverage of smaller sales channels, but quantitative coverage of a larger number of channels.  Even if some channels make more money than others.  Or, if some channels offer more features than others. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So how to cover as many channels as possible without turning your work into endless running around between different implementations of the same?  One of the available solutions is to use the framework.  This, of course, will not solve all the problems, but will save, at a minimum, mental balance and, ideally, the money of the customer or employer. <br><br><h2>  Microsoft Bot Framework </h2><br>  <a href="https://dev.botframework.com/">The Microsoft Bot Framework</a> was first introduced a year ago at the <a href="http://build.microsoft.com/">Microsoft Build 2016</a> conference.  However, it is still in the Preview stage, which can create certain difficulties of various kinds using it in large projects in the current form.  At least, I definitely cannot recommend using it in production right now. <br><br>  I will not talk about all the features and benefits of this framework, you can easily find out about it from its <a href="https://docs.botframework.com/en-us/">documentation</a> or any other <a href="https://habrahabr.ru/search/%3Ftarget_type%3Dposts%26order_by%3Drelevance%26q%3DMicrosoft%2BBot%2BFramework%26flow%3D">article</a> about it.  As part of this material, I want to make a slight immersion in the practical implementation of the bot for the Microsoft Bot Framework. <br><br>  It may seem that the bot is in principle difficult, but with an unfamiliar framework even more so, but it is not.  As stated in the title, the implementation of the simplest bot with the Microsoft Bot Framework will take you no more than 10 minutes.  About so much it took me to write and debug the code for this article and twice as much was spent searching for a suitable template to launch it in Azure Functions. <br><br><h4>  Why PHP? </h4><br>  I chose PHP for this material for a number of reasons.  First, because the main focus of my work is web development, and PHP, at least in Russia, remains the most popular language in this area.  I thought about including Python code in the example, but decided not to complicate the already bloated material.  If it is interesting, you can put it in a separate article.  Secondly, although Microsoft claims that it is possible to work with the Bot Framework in PHP or Python, it effectively ignores them, does not give any documentation or examples, there is not even the SDK.  All that is is the REST API and its documentation.  The implementation is on the conscience of a developer who is likely to be ignored by a technology that is poorly documented for his language, no matter how wonderful and simple it is.  Examples in other languages ‚Äã‚Äãare not always easy to read, especially if they are overloaded with foreign constructions, like ‚Äúasync / await‚Äù. <br><br><h4>  Why Azure Functions? </h4><br>  I chose <a href="https://azure.microsoft.com/ru-ru/services/functions/">Azure Functions</a> , because this is the easiest and cheapest way for any reader to try and practice with the code for this example.  In fact, all that is required of you to launch a full-fledged bot from this material is to click the <a href="https://habr.com/ru/post/325130/">‚ÄúDeploy to Azure‚Äù</a> button and enter a couple of parameters for the application.  Azure will create and configure the necessary resources, load the sample code from GitHub and set up the billing so that you do not have to pay for the entire time the application is running.  You will pay only for the immediate calls of the bot, in fact the messages it processes. <br><br>  In addition, if you are interested in the subject of microservices with serverless architecture and you are not familiar with Azure Functions, then this will be an excellent opportunity for you to get acquainted.  However, microservices and the role of Azure Functions in them is another topic for another article. <br><br><h2>  Implementation </h2><br>  Separately, I note that this example is written in the simplest, most linear, well-readable and descriptive way.  Of course, it can not be used as a working code.  Since there is no SDK for PHP at the moment, complicating this example with classes and individual functions would be completely redundant and only complicated its readability and perception. <br><br><a name="preparing"></a><h4>  Training </h4><br>  So the first thing you need to do is create the bot itself: <a href="https://dev.botframework.com/bots/new">https://dev.botframework.com/bots/new</a> .  Create a bot name (Name), description (Description) and alias for naming URLs (Bot handle).  Note that, unlike the name and description, the alias after creating a bot cannot be changed.  Leave the ‚ÄúMessaging endpoint‚Äù field blank for now, we will fill it in after launching the application. <br><br><div style="text-align:center;"><img width="60%" height="60%" src="https://habrastorage.org/files/cd1/e4d/143/cd1e4d143fe04e18a580c2dd32c74601.png"></div><br>  Click the ‚ÄúMicrosoft App ID and password‚Äù button to create an ID and password for your application.  ID and password are needed to authorize the application as a bot when sending messages to the chat, so save them.  Click the "Complete the operation and return to the Bot Framework." <br><br><div style="text-align:center;"><img width="60%" height="60%" src="https://habrastorage.org/files/0b2/029/702/0b202970266c4c31b220862a58bf6f86.png"></div><br>  At this preparatory part is almost over.  Read, confirm your agreement with all the agreements and click "Register".  If everything is correct, you will see the message ‚ÄúBot created‚Äù very soon.  Nominally, your bot is ready.  It remains to teach him to communicate. <br><br><h4>  Code </h4><br>  First of all, set the application ID and password for bot authentication.  You got them at the last step.  At the same time we set the URL where we will contact them for the token authorizing the bot's answers. <br><br><pre><code class="php hljs">$client_id = getenv(<span class="hljs-string"><span class="hljs-string">'MicrosoftAppId'</span></span>); $client_secret = getenv(<span class="hljs-string"><span class="hljs-string">'MicrosoftAppPassword'</span></span>); $authRequestUrl = <span class="hljs-string"><span class="hljs-string">'https://login.microsoftonline.com/common/oauth2/v2.0/token'</span></span>;</code> </pre> <br>  In this example, I get the parameters from the environment variables, but you can set them directly in the code. <br><br><pre> <code class="php hljs">$client_id = <span class="hljs-string"><span class="hljs-string">'26XXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX'</span></span>; $client_secret = <span class="hljs-string"><span class="hljs-string">'CJPXXXXXXXXXXXXXXXXXXXXXXXXXXXX'</span></span>; $authRequestUrl = <span class="hljs-string"><span class="hljs-string">'https://login.microsoftonline.com/common/oauth2/v2.0/token'</span></span>;</code> </pre> <br>  Next, we read the body of the POST request with a message from the user and deserialize it from the JSON format into the <i>$ deserializedRequestActivity array</i> . <br><br><pre> <code class="php hljs">$request = file_get_contents(getenv(<span class="hljs-string"><span class="hljs-string">'req'</span></span>)); $deserializedRequestActivity = json_decode($request, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>);</code> </pre> <br>  In this example, I get the request body from the environment variable <i>req</i> , which is pre-configured in the Azure Functions binding.  You can get the request body from the <i>php: // input</i> stream if you are not using Azure Functions. <br><br><pre> <code class="php hljs">$request = file_get_contents(<span class="hljs-string"><span class="hljs-string">'php://input'</span></span>); $deserializedRequestActivity = json_decode($request, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>);</code> </pre> <br>  If <i>$ deserializedRequestActivity</i> contains an <i>id</i> field, consider the incoming request to be correct and begin processing.  First of all, you need to get a token to authorize the response to the message.  The token can be obtained via a POST request to the Microsoft oAuth service.  I use the <a href="http://php.net/manual/en/stream.contexts.php">stream context</a> for a query only because its implementation looks clearer; you can use <a href="http://php.net/manual/en/book.curl.php">CURL</a> . <br><br><pre> <code class="php hljs">$authRequestOptions = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'http'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'header'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"Content-type: application/x-www-form-urlencoded\r\n"</span></span>, <span class="hljs-string"><span class="hljs-string">'method'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'POST'</span></span>, <span class="hljs-string"><span class="hljs-string">'content'</span></span> =&gt; http_build_query( <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'grant_type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'client_credentials'</span></span>, <span class="hljs-string"><span class="hljs-string">'client_id'</span></span> =&gt; $client_id, <span class="hljs-comment"><span class="hljs-comment">//ID  'client_secret' =&gt; $client_secret, //  'scope' =&gt; 'https://graph.microsoft.com/.default' ) ) ) );</span></span></code> </pre><br>  We create the stream context configured above and execute a request to an oAuth service from it. <br><br><pre> <code class="php hljs">$authRequestContext = stream_context_create($authRequestOptions); $authResult = file_get_contents($authRequestUrl, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, $authRequestContext);</code> </pre><br>  We read the answer to the request and deserialize it into the <i>$ authData</i> array. <br><br><pre> <code class="php hljs">$authData = json_decode($authResult, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>);</code> </pre> <br>  If <i>$ authData</i> contains the <i>access_token</i> field, we consider authentication successful and continue processing.  We determine what type of message we received and prepare the text of the response to the message if the type of the incoming message is message.  In this example, we will not process all other types of messages, so all other types simply say that we are not familiar with them. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> ((string)$deserializedRequestActivity[<span class="hljs-string"><span class="hljs-string">'type'</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'message'</span></span>: $message = <span class="hljs-string"><span class="hljs-string">'New message is received: '</span></span> . (string)$deserializedRequestActivity[<span class="hljs-string"><span class="hljs-string">'text'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: $message = <span class="hljs-string"><span class="hljs-string">'Unknown type'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; }</code> </pre> <br>  Now that we know what to answer, we <i>create</i> an <i>$ deserializedResponseActivity array</i> with the response data, which we later pass to the Microsoft Bot Framework. <br><br><pre> <code class="php hljs">$deserializedResponseActivity = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-comment"><span class="hljs-comment">//    'type' =&gt; 'message', //    'text' =&gt; $message, //,   -    'textFormat' =&gt; 'plain', //   'locale' =&gt; 'ru-RU', //  ID ,      (   id  POST-  ) 'replyToId' =&gt; (string)$deserializedRequestActivity['id'], // id     (   recipient-&gt;id  recipient-&gt;name  POST-  ,   id  name,     ) 'from' =&gt; array( 'id' =&gt; (string)$deserializedRequestActivity['recipient']['id'], 'name' =&gt; (string)$deserializedRequestActivity['recipient']['name'] ), // id    ,   ,      (   from-&gt;id  from-&gt;name  POST-  ) 'recipient' =&gt; array( 'id' =&gt; (string)$deserializedRequestActivity['from']['id'], 'name' =&gt; (string)$deserializedRequestActivity['from']['name'] ), // id ,     (   conversation-&gt;id  POST-  ) 'conversation' =&gt; array( 'id' =&gt; (string)$deserializedRequestActivity['conversation']['id'] ) );</span></span></code> </pre> <br>  Having formed the answer, we are preparing to send it, for which we form the URL, where we will send it.  In fact, the URL is collected from the parameters of the incoming POST request and looks like this: <br><br> <code>https:// <i>{activity.serviceUrl}</i> /v3/conversations/ <i>{activity.conversation.id}</i> /activities/ <i>{activity.id}</i></code> <br> <br>  Where <i>activity</i> is an incoming POST request with a message that was deserialized earlier into the <i>$</i> deserializedRequestActivity array. <br><br>  Skip <i>{activity.serviceUrl}</i> through <i>rtrim</i> to exclude the last closing slash, because sometimes it is, and sometimes it is not.  Also <i>{activity.id}</i> must be passed through <i>urlencode</i> , because there are special characters in it that break the URL and interfere with the request. <br><br><pre> <code class="php hljs">$responseActivityRequestUrl = rtrim($deserializedRequestActivity[<span class="hljs-string"><span class="hljs-string">'serviceUrl'</span></span>], <span class="hljs-string"><span class="hljs-string">'/'</span></span>) . <span class="hljs-string"><span class="hljs-string">'/v3/conversations/'</span></span> . $deserializedResponseActivity[<span class="hljs-string"><span class="hljs-string">'conversation'</span></span>][<span class="hljs-string"><span class="hljs-string">'id'</span></span>] . <span class="hljs-string"><span class="hljs-string">'/activities/'</span></span> . urlencode($deserializedResponseActivity[<span class="hljs-string"><span class="hljs-string">'replyToId'</span></span>]);</code> </pre><br>  The URL is ready, now we are preparing a POST request to the Microsoft Bot Connector API, in which we will transmit the response to the incoming message.  First, configure the stream context.  I use the <a href="http://php.net/manual/en/stream.contexts.php">stream context</a> for a query only because its implementation looks clearer; you can use <a href="http://php.net/manual/en/book.curl.php">CURL</a> . <br><br><pre> <code class="php hljs">$responseActivityRequestOptions = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'http'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-comment"><span class="hljs-comment">//   POST-    ,   (token_type)    (access_token) 'header' =&gt; 'Authorization: ' . $authData['token_type'] . ' ' . $authData['access_token'] . "\r\nContent-type: application/json\r\n", 'method' =&gt; 'POST', //      JSON-     $deserializedResponseActivity 'content' =&gt; json_encode($deserializedResponseActivity) ) );</span></span></code> </pre><br>  And immediately we create it and execute a configured request to the Microsoft Bot Connector API from the stream context. <br><br><pre> <code class="php hljs">$responseActivityRequestContext = stream_context_create($responseActivityRequestOptions); $responseActivityResult = file_get_contents($responseActivityRequestUrl, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, $responseActivityRequestContext);</code> </pre> <br>  Done, the user in the chat reads our response, and we write to the stream STDOUT a log about the receipt and processing of the next message. <br><br><pre> <code class="php hljs">fwrite(STDOUT, <span class="hljs-string"><span class="hljs-string">'New message is received: "'</span></span> . (string)$deserializedRequestActivity[<span class="hljs-string"><span class="hljs-string">'text'</span></span>] . <span class="hljs-string"><span class="hljs-string">'"'</span></span>);</code> </pre> <br><a name="deploy2azure"></a><h4>  Launch </h4><br>  The above code is on <a href="https://github.com/denisyfrolov/azure-functions-php-bot/blob/master/messages/run.php">GitHub</a> , there is no need to copy-paste it from here or write again.  You can deploy the code in your own environment, or use the predefined template for Azure Functions.  If you are going to deploy the code in your own environment, <a href="https://habr.com/ru/post/325130/">click here</a> to skip the part about Azure Functions. <br><br><div style="text-align:center;"> <a href="&amp;xid=17259,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjYqOT0-xWaHOYiSMKMndt7RgtUug#create/Microsoft.Template/uri/"><img src="https://habrastorage.org/getpro/habr/post_images/d45/8a0/b62/d458a0b628888281517d6e1bd0e52885.png"></a> </div> <a href="&amp;xid=17259,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjYqOT0-xWaHOYiSMKMndt7RgtUug#create/Microsoft.Template/uri/"><br></a> <br>  To perform automatic code deployment in Azure, simply click the ‚ÄúDeploy to Azure‚Äù button, located just above.  The Deployment Wizard will only ask you for ‚ÄúMicrosoft App Id‚Äù and ‚ÄúMicrosoft App Password‚Äù, feel free to enter the ones you received during the <a href="https://habr.com/ru/post/325130/">preparation</a> phase.  Be sure to change the value of the ‚ÄúApp Name‚Äù field, as the name specified in the template is already in use, and the deployment will end in error if left as is.  Just add a couple of random numbers there.  Additionally, you can select an existing resource group or create a new one, if you wish.  Otherwise, the parameters are best left as is.  Do not forget to read and agree to the terms, then click "Purchase." <br><br><div style="text-align:center;"><img width="70%" height="70%" src="https://habrastorage.org/files/693/80b/c72/69380bc72b2346eb9ee160205e5ccb1c.png"></div><br>  The final touch, you need to take a link to the deployed application and stick it in the "Messaging endpoint" created at the bot <a href="https://habr.com/ru/post/325130/">preparation</a> stage. <br><br><div style="text-align:center;"><img width="40%" height="40%" src="https://habrastorage.org/files/7e3/0c7/fb6/7e30c7fb6a8f4745bb416f6f2479ba58.png"></div><br>  Wait until the application is deployed and go to the resource group into which you deployed it. <br><br><div style="text-align:center;"><img width="98%" height="98%" src="https://habrastorage.org/files/f48/c81/a4c/f48c81a4c9d249189283f6f13d5aa8d1.png"></div><br>  Go inside the Application Service instance with the name of the application you just deployed. <br><br><div style="text-align:center;"><img width="98%" height="98%" src="https://habrastorage.org/files/ff5/355/951/ff5355951d5742cfb942a052dab23f33.png"></div><br>  On the left, under the name of the ‚Äúmessages‚Äù function, go to the ‚ÄúDevelopment‚Äù menu and in the window that opens on the right, click the ‚ÄúGet Function URL‚Äù link.  In the popup will be a link of the following form. <br><br> <code>https:// <i>{__}</i> .azurewebsites.net/api/messages?code= <i>JqXXXXXXXXXXXXXXX...</i></code> <br> <br>  The <i>code</i> parameter protects your application from accidental and malicious attacks.  Without knowing this key, you cannot make the application work, which means you cannot overload it with requests and drive you into debt to Azure.  Therefore, try not to show this parameter to anyone. <br><a name="skipazf"></a><br>  Copy the link, return to the <a href="https://dev.botframework.com/bots">list of your bots</a> on the framework portal, from there go to bot editing and paste it (or similar to the <i>messages / run.php script</i> from the example, if you did not use Azure Functions) in the ‚ÄúMessaging endpoint‚Äù field. <br><br><div style="text-align:center;"><img width="80%" height="80%" src="https://habrastorage.org/files/abe/1fc/5b9/abe1fc5b98e24790b1e3efe4ad462cd4.png"></div><br><h2>  Check and debug </h2><br>  Do not rush to leave the bot control page.  On the right, you will find a web chat window where you can already try to write something to your new e-pet. <br><br>  If you have deployed the code from <a href="https://habr.com/ru/post/325130/">the Azure Functions template</a> , then do not be alarmed if the answers to your first messages come with some delay.  This is due to the mode of the application service instance.  To reduce your costs for hosting an example, a so-called <a href="https://docs.microsoft.com/ru-ru/azure/azure-functions/functions-scale">‚ÄúConsumption Plan‚Äù is</a> included in the template, in which the service consumes resources as needed.  Simply put, it is launched and scaled only when there is a real need for it.  If it is even simpler, the service will be able to stand by until its web hook is pulled by someone who has the right to do so.  If during the execution it does not have enough available resources, it is scaled automatically.  Thus, you will save hours of computing, but <a href="https://azure.microsoft.com/ru-ru/pricing/details/functions/">note</a> that this is not the only resource you pay for.  After processing the call and after some time, the service again "falls asleep." <br><br>  If you have already sent several messages to the bot and have not received any reply from it, then first of all <a href="https://habr.com/ru/post/325130/">visit</a> the Application Services instance.  There you can find the service call log (including data from the STDOUT stream) and a code testing tool. <br><br><div style="text-align:center;"><img width="80%" height="80%" src="https://habrastorage.org/files/ca5/86a/6e2/ca586a6e2636403f8a68a8af9bf4b1de.png"></div><br>  By default, the code will be linked to the sample repository on GitHub in <a href="https://docs.microsoft.com/ru-ru/azure/app-service-web/app-service-continuous-deployment">continuous deployment</a> mode.  Therefore, in the console you will see a warning about the availability of the code read-only.  To change the code, you need to either completely disable continuous deployment, or clone the repository and link the service to it.  Both can be done if you go from the console menu on the left to the ‚ÄúApplication-function parameters‚Äù and click the ‚ÄúConfigure continuous integration‚Äù button. <br><br><h2>  Connecting channels </h2><br>  By default, Skype and web chat will be connected to the bot.  Additionally, both instant messengers like Telegram and Slack are connected, as well as Email or SMS channels.  There is also a REST API Direct Line interface that allows you to use your own chat applications or instant messengers.  The settings of all the additional channels are accompanied by detailed instructions and, as a rule, do not cause any difficulties, so I see no reason to go into the details of these procedures here. <br><br>  "Addresses and appearances" of the bot from this example: <br><br><ul><li> <a href="https://join.skype.com/bot/ad7d6aec-1c3d-4c8e-9d87-5c834056c97e"><img src="https://habrastorage.org/getpro/habr/post_images/28f/e9e/546/28fe9e546d7391b3bbb2f214b83c46db.png"></a> </li><li>  Telegram <a href="https://telegram.me/Azure_Func_PHP_Bot">@Azure_Func_PHP_Bot</a> </li><li>  <a href="https://webchat.botframework.com/embed/phpbot%3Fs%3Dn6j83OK31H0.cwA.AJA.diwP4kkGJgbh9jcLg8Bvcv6XDAMutxAZ82G3Bgxsk8Y">web chat</a> </li></ul><br><h2>  Conclusion </h2><br>  It is no secret that Microsoft has been working on natural interfaces for a very long time and at the moment has achieved, if not great, then definitely no less success than colleagues in the shop.  In my opinion, this framework is a wonderful example.  It offers one of the broadest channel covers with relatively minimal labor costs.  In addition, its capabilities are not limited to working with common features for all instant messengers and direct chat rooms.  Microsoft Bot Framework allows you to work with features that are unique to a particular messenger, as well as work in group chats with their inherent logic.  Of course, he is not the only one, and someone may have a different opinion on this matter. <br><br>  The purpose of this article: to show by example how any web developer, with the right tools at hand, can now create his first bot without the extra cost and effort.  And I hope that this will be enough for you to at least try. <br><br>  But this is definitely not enough to instruct the bot of your customers.  When we talk about natural interfaces, we mean not only the format of user interaction, but also how they will feel this interaction, that UX.  As practice shows, the user is not very fond of communicating with bots, which are perceived only by dry teams and are not able to answer a single question.  And for this problem, Microsoft has a fairly elegant solution to <a href="https://www.microsoft.com/cognitive-services">Microsoft Cognitive Services</a> . <br><br>  Microsoft Cognitive Services and working with natural speech is a very large and important part that could continue the topic of this article.  But, first of all, I want to hear how interesting this is in the context of web development?  Is it worth doing a cycle of articles?  What languages ‚Äã‚Äãwould you like to see in the future? <br><br><h4>  Related Links </h4><br><ul><li>  Sample code on <a href="https://github.com/denisyfrolov/azure-functions-php-bot">GitHub</a> </li><li>  <a href="https://docs.botframework.com/en-us/">Microsoft Bot Framework</a> Documentation </li><li>  <a href="https://docs.microsoft.com/ru-ru/azure/azure-functions/">Azure Functions</a> Documentation </li><li>  <a href="https://azure.microsoft.com/ru-ru/free/">Get 30 days of free using Azure</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/325130/">https://habr.com/ru/post/325130/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../325120/index.html">Hello, Schulte</a></li>
<li><a href="../325122/index.html">Smart Farm with Cowboy Drones using the SAP Cloud Platform</a></li>
<li><a href="../325124/index.html">Forbidden changes in the code or continuation of the repair history of one crane</a></li>
<li><a href="../325126/index.html">Checking the PascalABC.NET project with the help of SonarQube plugins: SonarC # and PVS-Studio</a></li>
<li><a href="../325128/index.html">Printing in a company: pennies that save millions</a></li>
<li><a href="../325132/index.html">Terminal Server for 1C over RDP on linux: recommendations for configuration based on the experience of actual operation</a></li>
<li><a href="../325136/index.html">Colocation: how, why and why</a></li>
<li><a href="../325138/index.html">Protection from DDoS attacks from the point of view of a telecom operator. Part 1</a></li>
<li><a href="../325140/index.html">The Institute of Software Engineering has opened access to the C ++ code design standard.</a></li>
<li><a href="../325144/index.html">Technical program PHDays: analysis of the HummingBad trojan, which is malware for macOS and attacks on the Java Card</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>