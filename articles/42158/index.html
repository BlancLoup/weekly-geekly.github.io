<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Uploading videos on ruTube using cURL</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On Habr√© there were already topics dedicated to the open API for working with the ruTube service. In the example that can be downloaded from the ruTub...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Uploading videos on ruTube using cURL</h1><div class="post__text post__text-html js-mediator-article">  On Habr√© there were already topics dedicated to the open <b>API</b> for working with the <b>ruTube</b> service.  In the example that can be downloaded from the <b>ruTube</b> site ( <a href="http://rutube.ru/partners/phpapi.html">http://rutube.ru/partners/phpapi.html</a> ), the video is sent as follows (the code is taken from the example without editing): <br><br><a name="habracut"></a><blockquote><code><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } }</font> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <ol><li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><font color="#008000"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { //    rutube    $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li></li><li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li></li><li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li></li><li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li></li><li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li></li><li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li></li><li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li></li><li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><font color="#008000"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { //    rutube $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li></li><li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> </ol> <code><font color="gray"><a href="http://uploader.rutube.ru/cgi-bin/jsapi.cgi"></a> <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">if</font> (move_uploaded_file($_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'tmp_name'</font> ], $fname)) { <font color="#008000">//    rutube   </font> $bnd = md5(uniqid(time())); $data2 = add_var( <font color="#A31515">'save'</font> , <font color="#A31515">'y'</font> ); $data2 .= add_var( <font color="#A31515">'rt_mode'</font> , <font color="#A31515">'do_upload'</font> ); $data2 .= add_var( <font color="#A31515">'rt_developer_key'</font> , $rt_developer_key); $data2 .= add_var( <font color="#A31515">'rt_redirect_ok'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=ok'</font> ); $data2 .= add_var( <font color="#A31515">'rt_redirect_error'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?redirect=error'</font> ); $data2 .= add_var( <font color="#A31515">'rt_auto_publish'</font> , $auto_publish); $data2 .= add_var( <font color="#A31515">'rt_user'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_sign'</font> , <font color="#A31515">''</font> ); $data2 .= add_var( <font color="#A31515">'rt_enc'</font> , <font color="#A31515">'UTF-8'</font> ); $data2 .= add_var( <font color="#A31515">'referer'</font> , <font color="#A31515">'http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html'</font> ); $data2 .= add_var( <font color="#A31515">'title'</font> , $name); $data2 .= add_var( <font color="#A31515">'rt_tags'</font> , $tags); $data2 .= add_var( <font color="#A31515">'comment'</font> , $description); $data2 .= add_var( <font color="#A31515">'category'</font> , $rutube_cat); $data2 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">'Content-Disposition: form-data; name="data"; filename="'</font> .$_FILES[ <font color="#A31515">'data'</font> ][ <font color="#A31515">'name'</font> ]. <font color="#A31515">'"'</font> . <font color="#A31515">"\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Type: application/octet-stream\r\n"</font> ; $data2 .= <font color="#A31515">"Content-Transfer-Encoding: binary\r\n"</font> ; $data2 .= <font color="#A31515">"\r\n"</font> ; $data3 = <font color="#A31515">"\r\n"</font> ; $data3 .= <font color="#A31515">'--'</font> .$bnd. <font color="#A31515">"--\r\n"</font> ; $data1 = <font color="#A31515">"POST uploader.rutube.ru/cgi-bin/jsapi.cgi HTTP/1.0\r\n"</font> ; $data1 .= <font color="#A31515">"Host: uploader.rutube.ru\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Type: multipart/form-data; boundary="</font> .$bnd. <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Content-Length: "</font> .(mb_strlen($data2.$data3, <font color="#A31515">'8bit'</font> )+filesize($fname)). <font color="#A31515">"\r\n"</font> ; $data1 .= <font color="#A31515">"Connection: close\r\n"</font> ; $data1 .= <font color="#A31515">"\r\n"</font> ; $f = fsockopen( <font color="#A31515">'uploader.rutube.ru'</font> , 80); fwrite($f, $data1.$data2); $f2 = fopen($fname, <font color="#A31515">'r'</font> ); <font color="#0000ff">while</font> (!feof($f2)) { $buff = fread($f2, 1024*128); fwrite($f, $buff); } fclose($f2); fwrite($f, $data3); $response = <font color="#A31515">''</font> ; <font color="#0000ff">while</font> (!feof($f)) $response .= fgets($f, 128); fclose($f); $response=split( <font color="#A31515">"\r\n\r\n"</font> ,$response); $response = trim(preg_replace( <font color="#A31515">'/.*Location:.*redirect=(\S*).*/i'</font> , <font color="#A31515">'$1'</font> , strtr($response[0],array( <font color="#A31515">"\n"</font> =&gt; <font color="#A31515">' '</font> , <font color="#A31515">"\r"</font> =&gt; <font color="#A31515">' '</font> )))); <font color="#0000ff">if</font> (strpos($response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) { <font color="#008000">//    rutube</font> $response = preg_replace( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$1'</font> , $response); <font color="#008000">//  id</font> $sql-&gt;Query( <font color="#A31515">'INSERT INTO movie SET category_id='</font> .$category. <font color="#A31515">',name="'</font> .SQL_STR. <font color="#A31515">'",description="'</font> .SQL_STR. <font color="#A31515">'",date='</font> .time(). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'",user_id='</font> .$user[ <font color="#A31515">'id'</font> ]. <font color="#A31515">',status=1,rutube_id="'</font> .SQL_STR. <font color="#A31515">'", tags="'</font> .SQL_STR. <font color="#A31515">'"'</font> , $name, $description, $author, $response, $tags); header( <font color="#A31515">'Location: http://'</font> .$_SERVER[ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); } }</font> * This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  We offer code that sends data using the cURL library: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">if</font> (move_uploaded_file ($ _ FILES [ <font color="#A31515">'data'</font> ] [ <font color="#A31515">'tmp_name'</font> ], $ fname)) </li><li>  { </li><li>  $ array_var = array ( <font color="#A31515">'save'</font> =&gt; <font color="#A31515">'y'</font> , </li><li>  <font color="#A31515">'rt_mode'</font> =&gt; <font color="#A31515">'do_upload'</font> , </li><li>  <font color="#A31515">'rt_developer_key'</font> =&gt; $ rt_developer_key, </li><li>  <font color="#A31515">'rt_redirect_ok'</font> =&gt; <font color="#A31515">'http: //'</font> . $ _ SERVER [ <font color="#A31515">'SERVER_NAME'</font> ].  <font color="#A31515">'/upload.html?redirect=ok'</font> , </li><li>  <font color="#A31515">'rt_redirect_error'</font> =&gt; <font color="#A31515">'http: //'</font> . $ _ SERVER [ <font color="#A31515">'SERVER_NAME'</font> ].  <font color="#A31515">'/upload.html?redirect=error'</font> , </li><li>  <font color="#A31515">'rt_auto_publish'</font> =&gt; $ auto_publish, </li><li>  <font color="#A31515">'rt_user'</font> =&gt; <font color="#A31515">''</font> , </li><li>  <font color="#A31515">'rt_sign'</font> =&gt; <font color="#A31515">''</font> , </li><li>  <font color="#A31515">'rt_enc'</font> =&gt; <font color="#A31515">'UTF-8'</font> , </li><li>  <font color="#A31515">'referer'</font> =&gt; <font color="#A31515">'http: //'</font> . $ _ SERVER [ <font color="#A31515">'SERVER_NAME'</font> ].  <font color="#A31515">'/upload.html'</font> , </li><li>  <font color="#A31515">'title'</font> =&gt; $ name, </li><li>  <font color="#A31515">'rt_tags'</font> =&gt; $ tags, </li><li>  <font color="#A31515">'comment'</font> =&gt; $ description, </li><li>  <font color="#A31515">'category'</font> =&gt; $ rutube_cat, </li><li>  <font color="#A31515">'data'</font> =&gt; <font color="#A31515">'@'</font> . $ fname </li><li>  ); </li><li></li><li>  $ ch = curl_init (); </li><li>  curl_setopt ($ ch, CURLOPT_URL, <font color="#A31515">"http://uploader.rutube.ru/cgi-bin/jsapi.cgi"</font> ); </li><li>  curl_setopt ($ ch, CURLOPT_FOLLOWLOCATION, 0); </li><li>  curl_setopt ($ ch, CURLOPT_POSTFIELDS, $ array_var); </li><li>  curl_setopt ($ ch, CURLOPT_RETURNTRANSFER, 1); </li><li></li><li>  $ response = curl_exec ($ ch); </li><li>  curl_close ($ ch); </li><li></li><li>  <font color="#0000ff">if</font> ($ response) </li><li>  { </li><li>  $ response = split ( <font color="#A31515">"\ r \ n \ r \ n"</font> , $ response); </li><li>  $ response = trim (preg_replace ( <font color="#A31515">'</font> /.*Location:.*redirect== ( <font color="#A31515">\ S*).*/i'</font> , <font color="#A31515">'$ 1'</font> , strtr ($ response [0], array ( <font color="#A31515">"\ n"</font> =&gt; <font color="#A31515">'</font> , <font color="#A31515">"\ r"</font> =&gt; <font color="#A31515">''</font> )))); </li><li></li><li>  <font color="#0000ff">if</font> (strpos ($ response, <font color="#A31515">'error'</font> ) === <font color="#0000ff">false</font> ) </li><li>  { </li><li>  <font color="#008000">// clip successfully uploaded to rutube</font> </li><li>  $ response = preg_replace ( <font color="#A31515">'/.*rt_movie_id=(.*)/i'</font> , <font color="#A31515">'$ 1'</font> , $ response);  <font color="#008000">// received temporary id</font> </li><li>  $ sql-&gt; Query ( <font color="#A31515">'INSERT INTO movie SET category_id ='</font> . $ category. <font color="#A31515">', name = "'</font> . SQL_STR. <font color="#A31515">'", description = "'</font> . SQL_STR. <font color="#A31515">'", date ='</font> .time (). <font color="#A31515">', author = "'</font> .SQL_STR. <font color="#A31515">'", user_id = '</font> . $ user [ <font color="#A31515">' id '</font> ]. <font color="#A31515">', status = 1, rutube_id = "'</font> .SQL_STR. <font color="#A31515">'", tags = "'</font> .SQL_STR. <font color="#A31515">'" '</font> , $ name, $ description, $ author, $ response, $ tags); </li><li></li><li>  header ( <font color="#A31515">'Location: http: //'</font> . $ _ SERVER [ <font color="#A31515">'SERVER_NAME'</font> ]. <font color="#A31515">'/upload.html?successful'</font> ); </li><li>  } </li><li>  } </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br>  This approach can be used when socket support is not disabled on the server, but there is <b>cURL</b> .  The code, as you can see, turned out to be more compact, and <b>cURL</b> works more efficiently than sockets. <br><br>  We applied this approach in a module written for <b>CMS <font color="#A30000">S.</font> Builder</b> , which interacts with the <b>ruTube</b> service.  The presence of the <b>cURL</b> library is checked, if it is on the server, then work is being done with its help, if not, then we are trying to work through sockets.  While there were no problems. </div><p>Source: <a href="https://habr.com/ru/post/42158/">https://habr.com/ru/post/42158/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../421571/index.html">Kivy. Xamarin. React Native. Three frameworks - one experiment (part 3)</a></li>
<li><a href="../421573/index.html">Product Design Digest August 2018</a></li>
<li><a href="../421575/index.html">The confrontation between Yandex and Roskomnadzor is brewing, and in a day or two the search engine may fall under partial blocking</a></li>
<li><a href="../421577/index.html">An exploit has been published for an unpatched vulnerability in Windows Task Scheduler (translation)</a></li>
<li><a href="../421579/index.html">Organization of effective interaction microservices</a></li>
<li><a href="../421585/index.html">How did the Cossacks retro contest decide</a></li>
<li><a href="../421587/index.html">[Ekaterinburg, Announcement] Mitap on Java - JUG.EKB</a></li>
<li><a href="../421589/index.html">Metamorphosis: form programming at the molecular level</a></li>
<li><a href="../42159/index.html">Three inch USB flash drive</a></li>
<li><a href="../421591/index.html">Budget Wireless (Wi-Fi) Autonomous System (from the battery) video surveillance</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>