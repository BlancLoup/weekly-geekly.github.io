<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>First steps to smart bath</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In our first articles on Habr√©, we promised to talk about specific projects in which our system is used. There are a lot of ideas, but we decided to s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>First steps to smart bath</h1><div class="post__text post__text-html js-mediator-article">  In our first articles on Habr√©, we promised to talk about specific projects in which our system is used.  There are a lot of ideas, but we decided to start with a story about one of our internal DIY projects: <br><br>  I'll tell you about my attempt to automate a little bath.  During the overhaul of the bath, an idea appeared at the same time to heat it.  So that in winter it does not freeze, as a result, it is quickly heated.  As a result of this heating, we do not let the dew point inside the bath, get rid of unnecessary condensate on the logs, the log house serves longer, well, in general, some advantages.  If it were not for one minus: you will have to pay for additional heating.  Then I will try to tell you how to minimize the costs of this heating and automate the process. <br><br><img src="https://habrastorage.org/files/e81/55a/804/e8155a804a67435b8e81280790d6cef2.png"><br><a name="habracut"></a><br>  So.  There is a private house with a heating circuit (circuit 1) from the gas boiler.  Nearby, no further than 6 meters, there is a bath.  It was decided to connect the bath to the home heating circuit.  At the same time, to the heating pipe of the bath circuit (circuit 2), after a few meters, in the places of probable frost penetration, put temperature sensors.  Circuit 2 will not always have to work with us, and not at full capacity.  To control this process, a device, tentatively called ‚ÄúThermostat‚Äù, was designed and assembled on the knees.  Temperature sensors are connected to the Thermostat, data from the sensors are analyzed by the device, checked for specified threshold values, and a decision is made to turn on / off the relay, which in turn turns on / off the circulation pump of circuit 2. The thermostat will be controlled according to the protocol Modbus (via Ethernet).  Monitoring system - <a href="http://aggregate.tibbo.com/">AggreGate</a> .  More on this later.  And now in order: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  Pipe laying </h1><br>  Under the ground, at a depth of about 1 m, a 4-pipe trunk was laid.  2 pipes - heating, 2 pipes - hot / cold water. <br><br><img src="https://habrastorage.org/files/ed0/aa7/9bf/ed0aa79bf63243ce8d64f793d1becbb4.jpg"><br><br>  I put it there right away so that they would not dangle in the air: a power electric wire, a twisted pair UTP-5 for LAN.  To the pipe "reverse", under the heater, laid a wire with temperature sensors, attached them to the pipe.  Temperature sensors selected <a href="http://www.maximintegrated.com/en/products/analog/sensors-and-sensor-interface/DS18B20.html">DS18b20</a> series.  Why them?  Just because they work according to the 1-Wire protocol, and they can be hung in parallel on 1 line.  What was done. <br><br><img src="https://habrastorage.org/files/94d/615/d88/94d615d88ca24568a98b96e0c9335d44.jpg"><br><br><img src="https://habrastorage.org/files/4d7/da1/340/4d7da13400d84975b48f27b44b04ac45.jpg"><br><br>  Temperature sensor on the pipe: <br><br><img src="https://habrastorage.org/files/c89/25b/c91/c8925bc914c4477297ed30ce618280a9.jpg"><br><br>  The sensor itself sits firmly in a sealed heat shrink: <br><br><img src="https://habrastorage.org/files/fe6/0d8/4a6/fe60d84a67134799bfeed787934a8c90.jpg"><br><br>  So, we have the following sensors: in the boiler room, at the exit from the boiler room, a couple of sensors under the ground (more out of curiosity than technical necessity, because the temperature is more or less stable below the ground), in the ground, right next to the bath, then several sensors along the wall inside the bath, 3 sensors will be in the steam room (below, above, in the middle) + 1 sensor outside.  The total number of sensors can be up to 20. <br><br><h1>  A little about the device "Thermostat" </h1><br>  Collected on his knees, in his spare time, for a couple of months.  Scheme / wiring done in Proteus.  The firmware was written in AVR Studio.  The board was made by the method of laser printer and iron.  What happened: <br><br><img src="https://habrastorage.org/files/c4c/d71/466/c4cd714660d846cb92e26b0cda82f4b0.png"><br><br><img src="https://habrastorage.org/files/0c3/c4a/3f2/0c3c4a3f2f0543e4b222049b834bbce8.png"><br><br><img src="https://habrastorage.org/files/a67/327/4a7/a673274a762947d1affc7d37852ce948.png"><br><br><img src="https://habrastorage.org/files/3ab/ecd/e41/3abecde41e364afebb4af5aa4d0c687a.png"><br><br><img src="https://habrastorage.org/files/434/290/48f/43429048fa4048d4a3b303ef4713204b.jpg"><br><br>  Main elements: ATmega128 processor, Ethernet-&gt; SPI converter (from Arduino), screen, keyboard, 20 DS18B20 sensors, 2 AM201 temperature / humidity sensors. <br><br>  The device constantly polls the DS18B20 and AM201 sensors connected to it.  All values ‚Äã‚Äãare added to registers.  Also in the registers are stored thresholds on / off relay for each of the sensors.  Access to registers - via ModBus, via Ethernet.  All settings can be changed both using the keyboard and through the ModBus registers. <br><br>  To the question why to fence one‚Äôs own one, I probably already have one ready, I‚Äôll answer: I just wanted to do it myself, for general development, so to speak.  Yes, and a ready-made solution, I think, would be much more expensive. <br><br><h1>  Monitored </h1><br>  The monitoring system is <a href="http://aggregate.tibbo.com/ru/solutions/scada_hmi.html">AggreGate SCADA / HMI</a> . <br><br>  Install, run, understand. <br><br>  We connect our device to the system: <br><br><img src="https://habrastorage.org/files/7a5/0f3/415/7a50f341504d44b49b9779e09a66c67b.png"><br><br>  We look that the data was loaded: <br><br><img src="https://habrastorage.org/files/9b1/07d/9b3/9b107d9b32514f49ab758790a224750b.png"><br><br>  Everything is working. <br><br>  Now we will build temperature graphs.  If you do not know where to press, then you will not understand right away.  I will show in order what to do. <br><br>  1. In the list of registers, we right-click on the ‚ÄúTemperature in the street‚Äù register field, in the context menu, select ‚ÄúCreate diagram‚Äù: <br><br><div class="spoiler">  <b class="spoiler_title">Variable / Register Context Menu</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/a93/e6e/36a/a93e6e36a8b94d1789399c840570c8ab.png"><br></div></div><br><br>  2. Next, select the ‚ÄúGraph on the history and / or change in real time: <br><br><div class="spoiler">  <b class="spoiler_title">Select data source</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/9a3/f01/b51/9a3f01b51ae148a6966498243d60b0dd.png"><br></div></div><br><br>  3. OK again: <br><br><div class="spoiler">  <b class="spoiler_title">Select the type and parameters of the schedule</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/59c/b4f/386/59cb4f3868fa4ecea91755e00b82eb84.png"><br></div></div><br><br>  4. In the expression field, type <b>{tOut} / 16</b> , since all temperature values ‚Äã‚Äãin the registers of our device are already multiplied by 16: <br><br><img src="https://habrastorage.org/files/28e/41f/e32/28e41fe3283642278c86ae55b4545a1a.png"><br><br>  5. Everything, the schedule is ready.  By analogy, do the rest. <br><br>  Monthly outdoor temperature: <br><br><img src="https://habrastorage.org/files/87d/0e6/af0/87d0e6af04454672a2264d0918c135d1.png"><br><br>  The temperature around the circuit in summer mode, with the boiler off: <br><br><img src="https://habrastorage.org/files/d62/6fb/2b8/d626fb2b8bda45d98637537c35f00caf.png"><br><br>  Temperature around the circuit in winter mode: <br><br><img src="https://habrastorage.org/files/e81/55a/804/e8155a804a67435b8e81280790d6cef2.png"><br><br><img src="https://habrastorage.org/files/2a7/dc8/4d4/2a7dc84d43c14b118f4db2e1b92837b0.png"><br><br>  Small amplitude sinusoidal bursts are a smooth change in the temperature of the circuit with periodic switching on / off of the boiler itself.  Big dips are switching the boiler to heat the internal boiler, at this time the heating cools.  Theoretically, it may happen that someone turns on the hot water for a long time, and the boiler will constantly heat the boiler, and the temperature of the heating circuit can drop dramatically.  This may be critical for our bath.  When the frost is -30 ¬∞ C, idle for 20-30 minutes, in some places the pipe may freeze. <br><br>  This problem can be diagnosed by AggreGate.  Add an alarm to the minimum temperature value: <br><br><img src="https://habrastorage.org/files/b36/7df/a00/b367dfa007444b25a26dcd36fee57178.png"><br><br><img src="https://habrastorage.org/files/f0a/ce3/0d6/f0ace30d638845a292fc3d24a3a0eb9e.png"><br><br>  and, in the event of an alarm, send SMS: <br><br><img src="https://habrastorage.org/files/9fa/312/e8b/9fa312e8b6c0420ba26e5a81b8e079b8.png"><br><br>  SMS is sent using SMPP protocol.  If there is no connection to the Internet, you can connect an ordinary GSM modem to AggreGate and send alarm messages through it. <br><br>  It so happened that the Thermostat device does not fulfill its main purpose.  The power of the internal circulation pump of the boiler is more than enough for circuit 2, and there is no need to install a second pump.  Rather, you need to put the n / a valve, which, when energized, will close, and open when the temperature reaches a minimum.  I did not have such a valve, so I just covered the pressure on circuit 2 a little, and left it temporarily (for 2 winters already). <br><br>  At the moment the device is in operation for more than 2 years, this time everything works without breakdowns.  Plans to assemble a control unit exhaust hood in the bath at the given values ‚Äã‚Äãof humidity. <br><br><h1>  Special offer from Tibbo on scheduling and monitoring of private houses </h1><br>  In these difficult times, we want to offer those who are engaged in building a "smart home" system in private (not multi-unit) homes free licenses for the AggreGate SCADA / HMI system: <br><br>  - License AggreGate SCADA / HMI Basic for 10 devices (Modbus, etc.) without restrictions on the time and number of tags <br>  - License AggreGate SCADA / HMI Building Automation for 1 device (OPC, BACnet, etc.) without restrictions on the time and number of tags <br><br>  Version differences are described here: <a href="http://aggregate.tibbo.com/ru/solutions/scada_hmi/compare.html">http://aggregate.tibbo.com/en/solutions/scada_hmi/compare.html</a> <br><br>  To obtain a license, send us a brief description of the project and the <a href="http://aggregate.tibbo.com/docs/ru/licensing.htm">activation key of the server by</a> July 1, 2015. </div><p>Source: <a href="https://habr.com/ru/post/258259/">https://habr.com/ru/post/258259/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../258249/index.html">Cyclic containers in Objective-C</a></li>
<li><a href="../258251/index.html">Interface revolution. USB 3.1 Type-C in detail. Electronic technician</a></li>
<li><a href="../258253/index.html">Google transfers corporate applications to the cloud with access from outside</a></li>
<li><a href="../258255/index.html">Development of the system architecture through the service-resource model</a></li>
<li><a href="../258257/index.html">Microservices. Good, bad, evil</a></li>
<li><a href="../258265/index.html">Live broadcast of DevCon conference on May 20 and 21</a></li>
<li><a href="../258267/index.html">DevCon 2015. Join the broadcast today from 10:30! What is the first day we cook?</a></li>
<li><a href="../258269/index.html">DevCon 2015. Join the broadcast today at 09:00! What is the second day we cook?</a></li>
<li><a href="../258275/index.html">Modern operating systems. 4th ed</a></li>
<li><a href="../258277/index.html">Virtual reality as a trend, a new report from App Annie, not a word about Apple Watch - and other news of the week for a mobile developer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>