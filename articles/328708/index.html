<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Development of a password manager for Android</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Greetings to all. I want to tell you the story of the development of my first mobile application for Android and share its various details. In particu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Development of a password manager for Android</h1><div class="post__text post__text-html js-mediator-article">  Greetings to all.  I want to tell you the story of the development of my first mobile application for Android and share its various details.  In particular, the architecture and the tools used will be discussed. <br><br><img src="https://habrastorage.org/web/1fc/f1e/ce8/1fcf1ece8b2244c6996a1ea892b21703.JPG"><br><a name="habracut"></a><br><h2>  Training </h2><br>  Of course, I didn‚Äôt start writing it right away, before that I had been taking all sorts of lessons on Android development for several months, read books, articles and actively absorbed information from other useful sources.  All who are going (or already) to do development for Android I want to draw attention to the most useful for me: <br><br><ul><li>  <a href="http://startandroid.ru/">startandroid.ru</a> </li><li>  <a href="http://developer.alexanderklimov.ru/">developer.alexanderklimov.ru</a> </li><li>  <a href="http://androidweekly.net/">androidweekly.net</a> </li><li>  <a href="http://androiddev.apptractor.ru/">androiddev.apptractor.ru</a> </li><li>  <a href="https://t.me/android_ru">t.me/android_ru</a> </li><li>  <a href="https://t.me/Android_Architecture">t.me/Android_Architecture</a> </li><li>  <a href="https://github.com/googlesamples">github.com/googles samples</a> </li></ul><br>  The first two, you, most likely, have already met, if you were interested in how to start developing mobile applications, here you can get acquainted with the very basics of developing for android.  More interesting - androidweekly weekly e-mail newsletter with news and articles about everything interesting that happens in the world of Android.  And then there are two very useful chat rooms, in the first one you can get answers to your questions about the development for android, in the second one, specifically about the architecture.  And last but not least, reference samples from Google. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  About the application </h2><br>  Long before the start of development, I had already decided on the subject of the application and took up the very urgent problem of storing a large number of logins, passwords, and so on. <br><br>  In the Play Market, a bunch of similar applications and I identified the main shortcomings for myself, took them into account, and made a list of the main features that I wanted to implement: <br><br><ul><li>  Several independent repositories (Accounts).  Each with its own master password; </li><li>  The ability to create an unlimited number of its categories (folders) to group records; </li><li>  The ability to create an unlimited number of fields (login, password, etc.) for each record, setting the field visibility and their arbitrary sorting; </li><li>  A large set of icons for records; </li><li>  The ability to quickly create a new record and set fields for it; </li><li>  Does not have access to the Internet, all data is stored only offline in encrypted form on the device.  From this it follows that there is no question of backend and synchronization in the cloud (which I won't pull anyway). </li></ul><br><h2>  Development </h2><br>  And now about my application itself, so that you can roughly understand the level of the application that will be discussed here is the structure of the project in Android Studio: <br><br><img src="https://habrastorage.org/web/4f6/de3/2ce/4f6de32cef064cb683bcc5935acd842f.JPG" alt="image alt" align="left">  As architecture, I chose MVP, in my opinion, now it is a standard in Android development.  There is also Clean Architecture, more flexible, even more abstractions, great for large projects.  But for me it was already too much, since I started developing all the code in Activity / Fragment, and only then rewrote under MVP (I had time to think again). <br><br>  There are several options for dividing a project into packages: the closest division to screens (features) is closest to me.  That is, almost all packages contain classes for implementing a single screen.  Except for a few: <br><br><ul><li>  base - base classes for activites, fragments, presenters </li><li>  data - repository classes </li><li>  global _di - main ApplicationComponent for dependency injection scopes </li><li>  model - pojo classes of business entities (Category, record, field, etc.) </li><li>  util - well, there are just auxiliary classes that do not fit into other packages </li></ul><br>  Oh, I forgot to list the main tools and approaches that I used in the development.  Already mentioned MVP.  Dependency Injection (DI), implemented using Dagger 2, is probably also a standard for Android development.  Where MVP and DI are there, of course, unit testing.  Unit tests cover all the logic in the model package and partly data.  Version control system (VCS) is another must have, again, I would not even develop pet projects, without it.  I use Git, first I used GitHub, but when it came time to think about the private repository I migrated to Bitbucket, everything happens in a few clicks while preserving the history of all commits. <br><br>  For those who crave at least some kind of code, below is a brief description of how the password list screen is implemented in the application.  Here is what it looks like in the end: <br><br><img src="https://habrastorage.org/web/09a/39e/651/09a39e6515dc4e09bf2cdc540e2e7a5c.png"><br><br>  Passwords package classes: <br><br><img src="https://habrastorage.org/web/33e/562/8a8/33e5628a818a49c9b72c27624d86c602.JPG"><br><br>  The markup is used almost standard scrolling activity that Android Studio creates itself. <br><br>  For the entire size of CollapsingToolbarLayout there is a picture of the category in which the entry is located, below the title. <br><br><div class="spoiler">  <b class="spoiler_title">PasswordsActivity code:</b> <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PasswordsActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppCompatActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PasswordsFragment</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnPasswordListFragmentInteractionListener</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PasswordFieldsFragment</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnPasswordFragmentInteractionListener</span></span></span><span class="hljs-class"> </span></span>{ PasswordsContract.Presenter mPasswordsPresenter; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); ActivityUtils.enableScreenshots(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); setContentView(R.layout.activity_scrolling_passwords_list); Toolbar toolbar = (Toolbar) findViewById(R.id.toolbar); setSupportActionBar(toolbar); FloatingActionButton fab = (FloatingActionButton) findViewById(R.id.fab); fab.setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View view)</span></span></span><span class="hljs-function"> </span></span>{ mPasswordsPresenter.onAddNewPasswordButtonClick(); } }); <span class="hljs-comment"><span class="hljs-comment">//Open passwords of category with that id String categoryId = getIntent().getStringExtra(PasswordsFragment.ARG_EXTRA_CATEGORY_ID); //In tablet mode open details of password with id String passwordId = getIntent().getStringExtra(PasswordFieldsFragment.ARG_EXTRA_PASSWORD_ID); PasswordsMvpController.createPasswordsViews(this, categoryId, passwordId); } @Override protected void onStop() { super.onStop(); if (isFinishing()) { Injector injector = Injector.getInstance(); injector.destroyPasswordsComponent(); if (ActivityUtils.isTablet(this)) { injector.destroyPasswordFieldsComponent(); } } } public void setPasswordsPresenter(PasswordsContract.Presenter passwordsPresenter) { mPasswordsPresenter = passwordsPresenter; } /** * Methods implemented from {@link PasswordsFragment.OnPasswordListFragmentInteractionListener} * * @param parentCategory category that must be displayed */ @Override public void showCategoryInfo(Category parentCategory) { setTitle(parentCategory.getTitle()); CollapsingToolbarLayout collapsingToolbarLayout = (CollapsingToolbarLayout) findViewById(R.id.toolbar_layout); VectorDrawableCompat vectorDrawableCompat = VectorDrawableCompat.create(getResources(), parentCategory.getPicture().getResId(), getTheme()); collapsingToolbarLayout.setContentScrim(vectorDrawableCompat); ImageView categoryImageView = (ImageView) findViewById(R.id.category_picture_imageView); categoryImageView.setImageResource(parentCategory.getPicture().getResId()); }</span></span></code> </pre> <br></div></div><br>  The first line oncreate () calls the method that, depending on the user settings, prohibits or allows screenshots to be taken. <br><br>  Through intent we get the id of the category, which stores all the information that needs to be displayed on this screen.  PasswordMvpController determines our smartphone or tablet and creates the corresponding fragments. <br><br>  In onStop (), we check if the Activity is closed forever, and if so, remove the component of this screen.  Another interesting callback from the fragment (about the fragment below), in which we set the picture and the name of the category. <br><br>  In my case, the fragment is a View and, accordingly, provides Presenter with the necessary methods for displaying data, except for them there is nothing interesting in the fragment, and the methods themselves are quite simple. <br><br>  The list of entries is implemented using RecyclerView, <a href="https://jonfhancock.com/your-viewholders-are-dumb-make-em-not-dumb-82e6f73f630c">for an article</a> that just appeared on Android Weekly.  Thanks to this approach, the adapter is very lightweight and not overloaded with unnecessary logic, which in turn is in the ViewHolder. <br><br>  Now about the most interesting - Presenter.  In the same class PasswordMvpController, the creation and inject of the presenter takes place.  For the presenter itself, we need: passwordView our fragment, categoryId a unique identifier for the category, the records from which we want to show, and the dataRepository from where we will receive this category by identifier. <br><br><div class="spoiler">  <b class="spoiler_title">Presenter Code</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PasswordsPresenter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PasswordsContract</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Presenter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> DataRepository mDataRepository; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> PasswordsContract.View mPasswordsView; <span class="hljs-comment"><span class="hljs-comment">// On tablets we can have null categoryId when @Nullable String mCategoryId; Category mCurrentCategory; PasswordsPresenter(DataRepository dataRepository, PasswordsContract.View passwordsView, @CategoryId @Nullable String categoryId) { mDataRepository = dataRepository; mPasswordsView = passwordsView; mCategoryId = categoryId; } public void setupListeners(PasswordsContract.View passwordsView) { mPasswordsView = passwordsView; mPasswordsView.setPresenter(this); } /* * Methods implemented from {@Link PasswordsContract.Presenter} * */ @Override public void start() { if (Strings.isNullOrEmpty(mCategoryId)) { // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> 25.02.2017 on tablets we can have null category id when don't pick any category, need to show message about it return; } mDataRepository.getCategory(mCategoryId, new DataSource.LoadCategoryCallback() { @Override public void onCategoryLoaded(Category category) { mCurrentCategory = category; mPasswordsView.showPasswordsInList(category.mPasswords); mPasswordsView.showCategoryInfo(mCurrentCategory); } @Override public void onDataNotAvailable() { //RecycleView show empty data message by itself } }); } @Override public void onPasswordClick(Password password) { mPasswordsView.showDetailPasswordUi(password); } @Override public void onAddNewPasswordButtonClick() { mPasswordsView.showNewPasswordUi(mCategoryId); } @Override public void onSwapPasswords(int firstPosition, int secondPosition) { mDataRepository.swapPasswords(mCurrentCategory, firstPosition, secondPosition); mPasswordsView.swapPasswordInList(firstPosition, secondPosition); } @Override public void loadCategory(Category category) { mCurrentCategory = category; mPasswordsView.showCategoryInfo(category); mPasswordsView.showPasswordsInList(category.mPasswords); } /* * Helper methods that can be called from {@Link CategoriesTabletPresenter} to manipulate view in tablet mode * */ public void onCurrentCategoryDeleted() { mPasswordsView.showEmptyUi(); } }</span></span></code> </pre> <br></div></div><br>  In the onResume () of the fragment, the start () method of the presenter is called, and in it we refer to the DataRepository and request our category when received, we tell the view to show it and the records that are stored in it.  In principle, all methods are simple enough (again, let's give up the honor of MVP), I see no reason to explain them. <br><br><h2>  Conclusion </h2><br>  In one article, it all somehow somehow did not work out; very little time was given directly to the code.  Therefore, if you are interested, write your opinions in the comments, and I will consider them when writing an article about how data is stored in the application, how it is encrypted and, in general, about everything related to security (there will be a lot of code). </div><p>Source: <a href="https://habr.com/ru/post/328708/">https://habr.com/ru/post/328708/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../328698/index.html">Learning neural network geometry</a></li>
<li><a href="../328700/index.html">Tiled2Unity: export from Tiled Map Editor to Unity</a></li>
<li><a href="../328702/index.html">State synchronization in multiplayer games</a></li>
<li><a href="../328704/index.html">Why many still do not understand the essence of the blockchain</a></li>
<li><a href="../328706/index.html">Stable income without investments, or How Yandex began the hunt for fake earnings</a></li>
<li><a href="../328710/index.html">Google I / O 2017: notes from the event from the Android developer</a></li>
<li><a href="../328712/index.html">Five books on programming worth reading</a></li>
<li><a href="../328718/index.html">Speed ‚Äã‚Äã- Do Bank Sites Need It?</a></li>
<li><a href="../328720/index.html">Google I / O co-browsing at the Avito office</a></li>
<li><a href="../328722/index.html">Logging, interfaces and allocations in Go</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>