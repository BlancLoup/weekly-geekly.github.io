<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Search without internet. New beta application Yandex</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many of us still find ourselves in situations where you need to quickly find important information, but access to the Internet is limited or absent. A...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Search without internet. New beta application Yandex</h1><div class="post__text post__text-html js-mediator-article">  Many of us still find ourselves in situations where you need to quickly find important information, but access to the Internet is limited or absent.  And one thing is to try to open an entertainment post on the site, and quite another to look for the telephone number of the hotline of a bank or hospital.  Today for the first time I will tell Habr's readers how the acceleration of search in <a href="https://play.google.com/store/apps/details%3Fid%3Dru.yandex.searchplugin.beta">the Yandex application</a> led to the opportunity to search for important information without the Internet. <br><br><img src="https://habrastorage.org/files/18c/44a/2d4/18c44a2d45564ba29774786334bfa0d9.png"><br><br>  But first you need to understand the main thing: why do we even take on offline search, if the sites from the search results are still unavailable in the absence of a network? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>  <b>EDGE search</b> <br><br>  Yandex radars traditionally show people who enter a request, but then leave the page without waiting for the download due to poor mobile Internet.  In this situation, we could not affect the overall quality of the network and the download speed of all sites, but at least the search process was less painful and it was worth a little time to save.  Actually, this is why this project was originally called an EDGE search, i.e.  search on slow internet. <br><br>  You can speed up the search in two ways.  First, optimize the web version as much as possible and the APIs that the application uses.  And this work is also underway, but even this is not enough.  Secondly, you can pre-load on the device that is useful in case of a bad connection.  Obviously, it‚Äôs physically impossible to fit the entire Internet index on the phone.  Therefore, it was necessary to go by the local storage of the already-prepared search results for specific queries.  For what?  No one knows how to predict the future requests of a person with high accuracy (but we are learning).  Therefore we take popular repeated requests. <br><br>  When we talk about popular queries, many imagine a query [VKontakte] and several similar ones.  In fact, we have hundreds of thousands of less obvious requests that are regularly repeated in large quantities.  And this is many hundreds of megabytes of results.  And we planned to save not only search results, but also hints that appear during the query entry process.  And here, many will ask: why keep prompts offline, because a person is quite capable of entering a request without them? <br><br>  When entering requests in the Yandex application, users see not ordinary search tips, but in the form of individual words / word pairs (ie, <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D1%2580%25D0%25B5%25D0%25B4%25D0%25B8%25D0%25BA%25D1%2582%25D0%25B8%25D0%25B2%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25B2%25D0%25B2%25D0%25BE%25D0%25B4_%25D1%2582%25D0%25B5%25D0%25BA%25D1%2581%25D1%2582%25D0%25B0">predictive</a> text <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D1%2580%25D0%25B5%25D0%25B4%25D0%25B8%25D0%25BA%25D1%2582%25D0%25B8%25D0%25B2%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25B2%25D0%25B2%25D0%25BE%25D0%25B4_%25D1%2582%25D0%25B5%25D0%25BA%25D1%2581%25D1%2582%25D0%25B0">input</a> ).  Regular prompts cannot be edited: if you need to add a word, you will have to enter the entire query yourself.  Hints in the form of words allow you to make edits, cover a much larger number of requests and significantly speed up their input by a person. <br><br><img src="https://habrastorage.org/files/317/d3f/162/317d3f16224c411ab4b8647f7f4868b4.png"><br><br>  But the main thing is that the tips were especially useful when working offline.  These hints help people formulate their question as most do, and this, in turn, increases the chance that the answer will be obtained from the local cache.  That is why it was important to keep the tips. <br><br>  Empirically, we picked up a certain minimum of search queries (about 150 thousand) and prompts, less than which there was no longer any sense to store.  But the volume of all this baggage still went beyond decent (a few hundred megabytes).  Even taking into account the fact that for each query only the top 10 results were stored.  It was necessary to do something. <br><br>  <b>From optimization to offline</b> <br><br>  Began to look for all that could be sent "under the knife."  Each result contained not only links to sites, but favicons and snippets.  Favikonki - these are pictures, which means that here it was possible to achieve serious savings.  The same site can be found in the results for completely different queries, so we did not initially duplicate favicons, but stored them across sites.  And then we made it so that the probability of saving the favicon is directly proportional to the frequency with which the site appears in the search results.  In other words, we have abandoned most faviconok, but visually it is not very striking. <br><br>  But to give up <a href="">snippets</a> is not so easy, because this information is no less important for people than the headline.  The snippet often already contains the answer to the question.  Therefore, for ordinary queries, we have rejected snippets for only the last two results.  For navigation, where the first results usually respond well to queries, we have reduced not only the number of snippets to the first 3-4, but also the results themselves to 5 sites instead of 10. Similarly, we reduced all the <a href="https://yandex.ru/company/technologies/searchsters">outputs</a> where there is a response of the <a href="https://yandex.ru/company/technologies/searchsters">witcher</a> . <br><br><img src="https://habrastorage.org/files/665/d2e/a34/665d2ea3463740409d81c3fd870c9238.png"><br><br>  The more we reduced the usual search results in favor of ready-made answers, the closer we came to the understanding that our EDGE search not only speeds up work, but is able to respond to a wide range of questions without an Internet connection at all.  Without even noticing, we were already working on an offline search.  So, the bet should be done on ready-made answers.  Realizing this, we began to enrich the database with important facts that could not get there before because of the popularity of the query.  These results contain only the answers, without issuing sites. <br><br><img src="https://habrastorage.org/files/783/fcb/940/783fcb940e444e919d1092b613c5abb1.png"><br><br>  In a similar pattern, we copied into the database all the <a href="https://yandex.ru/company/technologies/entity_search">object response</a> cards and all requests for which the object response is available.  Cards for offline search differ from the originals by the almost complete lack of pictures: we removed them for reasons of economy. <br><br>  The growth of the fact base required further work on optimization and a data storage structure that would be careful with the device resources. <br><br>  <b>Dictionaries</b> <br><br>  The base is downloaded to the device not entirely, but in the form of separate dictionaries, and only with a Wi-Fi connection and only with a sufficient charge level.  The breakdown into dictionaries is done for two reasons.  Firstly, if the connection breaks when loading, then during the next attempt only those dictionaries that did not have time to download earlier will be downloaded.  Secondly, to save space, the base is loaded and stored on the device in a compressed form, but with each request it is not unpacked entirely, but only with the necessary parts. <br><br><img src="https://habrastorage.org/files/6d0/f77/5f0/6d0f775f09ef4ff8a49355ef87986196.gif"><br><br>  Each dictionary contains queries that begin with specific letters, as well as all the data for issuing and prompts for these queries.  Sorting data before dividing it into dictionaries by the first letters of the queries turned out to be more logical than, for example, by their popularity.  Imagine the situation: in the first dictionary are the most popular queries, in the second - a little less popular, and so on.  But the popularity of queries often changes, and this will lead to the need to regularly update dictionaries only in order to move the query from one to another.  These are costs of traffic, energy and time.  Therefore, it was important to make sure that when the database was updated, queries did not move between dictionaries.  Alphabetical order turned out to be a simple and effective solution. <br><br>  Answers to the same requests may vary in different parts of the country, therefore, dictionaries are formed for different regions.  Moreover, during short-term visits to another region, the application will not be in a hurry with updating the dictionaries - we have provided travel and tourism scenarios. <br><br>  No matter how hard we try, the offline search does not cover all possible queries, but it already helps out on average every third.  As with any average result, this means that one part of users encounters offline answers more often than the other.  Therefore, we, of course, allow to completely disable offline search in the settings. <br><br>  Our team would be interested to know the opinion of Habr's readers about this direction and get feedback on the work of the <a href="https://play.google.com/store/apps/details%3Fid%3Dru.yandex.searchplugin.beta">Yandex</a> beta <a href="https://play.google.com/store/apps/details%3Fid%3Dru.yandex.searchplugin.beta">application</a> for Android.  Thank. </div><p>Source: <a href="https://habr.com/ru/post/323422/">https://habr.com/ru/post/323422/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../323410/index.html">New on PHDays VII: Hacking IPv6 Networks, Future WAFs, and POS Terminals</a></li>
<li><a href="../323412/index.html">OOP is beautifully cracked with C ++ 14</a></li>
<li><a href="../323414/index.html">The history of the engineer-radiophysics, who decided to watch</a></li>
<li><a href="../323416/index.html">Yii2, quick start. The easiest site on Yii2 with static pages without using a database</a></li>
<li><a href="../323420/index.html">My Material Design Framework</a></li>
<li><a href="../323424/index.html">Search space strategies. AI driver</a></li>
<li><a href="../323426/index.html">Duke Nukem 3D Source Code Analysis: Part 1</a></li>
<li><a href="../323430/index.html">GitHub Pages for the site on March 8</a></li>
<li><a href="../323434/index.html">Weekday programmers: how we finalized the cash software after the new law</a></li>
<li><a href="../323436/index.html">How we analyze vulnerabilities using neural networks and fuzzy logic</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>