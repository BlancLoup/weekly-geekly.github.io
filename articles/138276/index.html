<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>EvoJ is a convenient framework for genetic algorithms.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello colleagues! 

 There are often articles on the topic of genetic algorithms, and allow me to deposit my five kopecks. 

 For a couple of years no...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>EvoJ is a convenient framework for genetic algorithms.</h1><div class="post__text post__text-html js-mediator-article"> Hello colleagues! <br><br>  There are often articles on the topic of genetic algorithms, and allow me to deposit my five kopecks. <br><br>  For a couple of years now, I have been developing a Java framework dedicated to GA for my hobby.  When I first started working with GA, the biggest inconvenience was the need to vectorize the variable components of the solution, so in my framework I tried to make the vectorization of variables transparent to the programmer, putting all the dirty work on the framework‚Äôs shoulders.  In addition, since GA is very well parallelized, I tried to make the transition to multi-threading no less easy. <br><a name="habracut"></a><br>  To understand the basic idea of ‚Äã‚Äãthe EvoJ, consider the following example.  For simplicity, we assume that we need to find the minimum of the function <code>Z(x, y)=12 * x^2 + 8 * x + 9 * y^2.</code>  Naturally, this task can be more effectively solved without resorting to the GA, but first let's consider it, and then analyze the example revealing all the power of EvoJ. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, first of all we need to create a Java interface containing the variables we need.  We have two variables: X and Y; we will create an interface containing getters for these variables. <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Solution</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Range</span></span>(min = <span class="hljs-string"><span class="hljs-string">"-10"</span></span>, max = <span class="hljs-string"><span class="hljs-string">"10"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getX</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-meta"><span class="hljs-meta">@Range</span></span>(min = <span class="hljs-string"><span class="hljs-string">"-10"</span></span>, max = <span class="hljs-string"><span class="hljs-string">"10"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getY</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre><br>  Please note that it is not necessary to declare setters, EvoJ will be able to change variables without them.  However, if you want to implement your own mutation strategy, you will have to declare the setters - otherwise you will not be able to change the variables yourself. <br><br>  Pay attention to the <code>@Range</code> annotation, it sets the range of values ‚Äã‚Äãthat a variable can accept.  Variables are triggered by random values ‚Äã‚Äãfrom a specified range.  However, as a result of mutation, they can potentially go beyond the specified range.  This can be prevented by using the <code>strict=‚Äùtrue‚Äù</code> parameter, which prevents the variable from accepting an invalid value, even if you try to set it using the setter method. <br><br>  Another point to pay attention here is that all parameters of all annotations in EvoJ are strings, this allows you to directly specify the value of the parameter, and specify the name property instead of a specific value so that you do not strictly specify the values ‚Äã‚Äãof the annotation parameters in the compile time. <br><br>  So, we have an interface with variables, let's write a fitness function.  The Fittness function in EvoJ is represented by the interface: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SolutionRating</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-function">Comparable </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calcRating</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T solution)</span></span></span></span>; }</code> </pre><br>  Here, the parameter <code>T</code> is our interface with variables.  The larger the return value (according to the <code>Comparable</code> contract), the more <code>Comparable</code> solution is considered.  You can return <code>null</code> , it is considered the smallest value of the fitness function. <br><br>  It is recommended to implement this interface indirectly, through helper-classes, which take on some service functions: the destruction of old solutions (if the maximum lifetime of the solution is set), the caching of the function value for solutions that were not deselected on the previous iteration of the GA. <br><br>  Fittness function for our case will be as follows: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Rating</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractSimpleRating</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Solution</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calcFunction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Solution solution)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> x = solution.getX(); <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> y = solution.getY(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> * x * x + <span class="hljs-number"><span class="hljs-number">8</span></span> * x + <span class="hljs-number"><span class="hljs-number">9</span></span> * y * y; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Comparable </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doCalcRating</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Solution solution)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> fn = calcFunction(solution); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Double.isNaN(fn)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> -fn; } } }</code> </pre><br>  Everything is pretty obvious here, we just take and consider our function using variables from our first interface.  Since we are looking for a minimum, and the class contract assumes that the best solutions should have a higher rating, we return the value of the function times -1. <br><br>  In addition, we eliminate the left-hand solutions (if NaN is obtained) by returning <code>null</code> . <br><br>  Well, we have two main components, let's make it all work. <br><pre> <code class="java hljs">DefaultPoolFactory pf = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DefaultPoolFactory(); GenePool&lt;Solution&gt; pool = pf.createPool(<span class="hljs-number"><span class="hljs-number">200</span></span>, Solution.class, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); DefaultHandler handler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DefaultHandler(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rating(), <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); handler.iterate(pool, <span class="hljs-number"><span class="hljs-number">200</span></span>); Solution solution = pool.getBestSolution();</code> </pre><br>  Let's analyze the code above in the lines: <br><pre> <code class="java hljs">DefaultPoolFactory pf = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DefaultPoolFactory();</code> </pre><br>  This factory will give us many initial solutions, if you remember, our solution is represented by an interface, not a class, so we cannot create an instance ourselves. <br><pre> <code class="java hljs">GenePool&lt;Solution&gt; pool = pf.createPool(<span class="hljs-number"><span class="hljs-number">200</span></span>, Solution.class, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>);</code> </pre><br>  Here a population of 200 random solutions is created (gene pool).  Pay attention to the last parameter - there should be a <code>Map&lt;String, String&gt;</code> for with values ‚Äã‚Äãof perpertei, if you did not explicitly specify the annotation parameters. <br><pre> <code class="java hljs">DefaultHandler handler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DefaultHandler(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rating(), <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>);</code> </pre><br>  Handler is the embodiment of a genetic algorithm, it is a combination of strategies for mutation, crossing, selection and rating calculation.  Of these, it is necessary to independently implement only the rating calculation - for everything else, there are standard implementations that will be used if, instead of the corresponding parameter, <code>null</code> passed. <br><pre> <code class="java hljs">handler.iterate(pool, <span class="hljs-number"><span class="hljs-number">200</span></span>);</code> </pre><br>  This line performs 200 iterations of the GA over our population.  Since the task is rather primitive, 200 iterations are quite enough to find the minimum of our function.  (The search for a solution for more complex problems may require several hours and millions of iterations, fortunately the selection of a solution can be accelerated using multithreading, but more on that later) <br><pre> <code class="java hljs">Solution solution = pool.getBestSolution();</code> </pre><br>  Here we get the best solution found.  On an instance of this interface, you can freely call <code>getX()/getY()</code> to get the values ‚Äã‚Äãof the variables you are <code>getX()/getY()</code> for. <br>  If you are not satisfied with the solution, you can continue with the GA iteration until the desired quality of the solution is achieved. <br><br>  Thus, to solve the problem with the help of EvoJ: <br><ol><li>  Create an interface with variables </li><li>  Implement a fitness interface </li><li>  Create a population of solutions and implement the necessary amount of GA iteration over them using the code above </li></ol><br>  Well, it was a warm-up, now let's see what EvoJ really can. <br><br>  Suppose we want to approximate a full-color image with a limited set of polygons.  The solution of such a problem cannot be described by a single interface with simple variables; here, the whole power of EvoJ is manifested.  We can declare the following set of interfaces: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PolyPicture</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@ListParams</span></span>(length = <span class="hljs-string"><span class="hljs-string">"50"</span></span>) <span class="hljs-function"><span class="hljs-function">List&lt;Polygon&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPolygons</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Polygon</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">Colour </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getColor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-meta"><span class="hljs-meta">@ListParams</span></span>(length = <span class="hljs-string"><span class="hljs-string">"8"</span></span>) <span class="hljs-function"><span class="hljs-function">List&lt;Point&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPoints</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Point</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Range</span></span>(min = <span class="hljs-string"><span class="hljs-string">"-5"</span></span>, max = <span class="hljs-string"><span class="hljs-string">"325"</span></span>, strict = <span class="hljs-string"><span class="hljs-string">"true"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getX</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-meta"><span class="hljs-meta">@Range</span></span>(min = <span class="hljs-string"><span class="hljs-string">"-5"</span></span>, max = <span class="hljs-string"><span class="hljs-string">"245"</span></span>, strict = <span class="hljs-string"><span class="hljs-string">"true"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getY</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setX</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setY</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Colour</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@MutationRange</span></span>(<span class="hljs-string"><span class="hljs-string">"0.2"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Range</span></span>(min = <span class="hljs-string"><span class="hljs-string">"0"</span></span>, max = <span class="hljs-string"><span class="hljs-string">"1"</span></span>, strict = <span class="hljs-string"><span class="hljs-string">"true"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-meta"><span class="hljs-meta">@MutationRange</span></span>(<span class="hljs-string"><span class="hljs-string">"0.2"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Range</span></span>(min = <span class="hljs-string"><span class="hljs-string">"0"</span></span>, max = <span class="hljs-string"><span class="hljs-string">"1"</span></span>, strict = <span class="hljs-string"><span class="hljs-string">"true"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getGreen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-meta"><span class="hljs-meta">@MutationRange</span></span>(<span class="hljs-string"><span class="hljs-string">"0.2"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Range</span></span>(min = <span class="hljs-string"><span class="hljs-string">"0"</span></span>, max = <span class="hljs-string"><span class="hljs-string">"1"</span></span>, strict = <span class="hljs-string"><span class="hljs-string">"true"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getBlue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setRed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> red)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setGreen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> green)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setBlue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> blue)</span></span></span></span>; }</code> </pre><br>  At the top, the interface is the whole picture, it consists of a single property - a list of polygons.  Each polygon is a color plus a list of points.  A point is two coordinates, a color is three components. <br><br>  Of the new annotations, it is worth mentioning <code>@ListParams</code> - specifying the length of the list and some other properties, and <code>@MutationRange</code> - specifying the maximum mutation radius of a variable, i.e.  how much the maximum variable can change in one act of mutation. <br>  Also note that the variables describing the color components have a fixed range of values ‚Äã‚Äã( <code>strict=‚Äùtrue‚Äù</code> ). <br><br>  Next, we need to implement a fitness function, as we did last time by expanding the helper class.  Below, to save space, an incomplete class code is given (the original code is designed for multithreading and contains many unobvious optimizations that make it difficult to read). <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PictureRating</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractSimpleRating</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PolyPicture</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PictureRating</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BufferedImage originalImage)</span></span></span></span>{....} <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> Comparable </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doCalcRating</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PolyPicture picture)</span></span></span><span class="hljs-function"> </span></span>{ BufferedImage testImage = drawPicture(picture); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] originalPix = getPixels(originalImage); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] testPix = getPixels(testImage); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> -calcError(originalPix, testPix); } }</code> </pre><br>  Here we draw the picture described by our interfaces, take its pixels and compare it with the pixels of the original image.  As a result, we return the accumulated deviation with a minus sign (more error - worse solution, less error - better solution). <br><br>  Next, we will write code similar to the example where we were looking for the minimum of the function. <br><pre> <code class="java hljs">DefaultPoolFactory factory = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DefaultPoolFactory(); GenePool&lt;PolyPicture&gt; pool = factory.createPool(<span class="hljs-number"><span class="hljs-number">40</span></span>, PolyPicture.class, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); DemoRating rating = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DemoRating(PICTURE_TO_APPROXIMATE); MultithreadedHandler handler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MultithreadedHandler(<span class="hljs-number"><span class="hljs-number">2</span></span>, rating, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); handler.iterate(pool, <span class="hljs-number"><span class="hljs-number">1000</span></span>); handler.shutdown();</code> </pre><br>  There is one difference - <code>MultithreadedHandler</code> .  It differs from a simple handler in that it iterates the GA over a solution population in several threads (the number of threads is specified by the first constructor parameter).  Thus, if your processor has several cores, you can really speed up the search for a solution just by increasing the number of threads.  For example, the solution of acceptable quality for the considered problem of image approximation on Core i7 with HyperThreading enabled in 8 threads is in 15-20 minutes. <br>  Multithreaded code in EvoJ is written to minimize blocking, which allows to obtain almost linear performance gains with an increase in the number of threads (for maximum performance, the number of individuals in a population must be a multiple of the number of threads, otherwise some threads will not have enough tasks). <br><br>  You should also pay attention to the line <br><pre> <code class="java hljs">handler.shutdown();</code> </pre><br>  It is needed to complete pending executor threads. <br><br>  So, this is all I wanted to tell you about EvoJ.  As a summary, here are the main features of the EvoJ: <br><ul><li>  no need to independently vectorize variables, you can immediately write code in terms of the domain domain </li><li>  standard implementations of the main GA strategies (selection, crossing, mutation) </li><li>  declarative mutation control (annotations) </li><li>  multithreading out of the box </li><li>  small size (120 kb) and no external dependencies (yes, you only need one jar file) </li><li>  extensibility at any point (you can write your own implementation of any strategy for GA - selection, crossing and mutation) </li></ul><br>  If you are interested, you can add EvoJ to your Maven project as follows: <br><ul><li>  First you need to add a link to the repository (I have not yet laid out to the central one) </li></ul><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">repositories</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">repository</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>EvojHome<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>EvoJ<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span>http://evoj-frmw.appspot.com/repository<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">repository</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">repositories</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><ul><li>  then direct dependency </li></ul><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>net.sourceforge.evoj<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>evoj<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Those who are not friends with Maven can download EvoJ directly from the project site <a href="http://evoj-frmw.appspot.com/">http://evoj-frmw.appspot.com/</a> .  There is also a copy of this tutorial in English, as well as detailed technical guidance and the results of using EvoJ for various tasks (approximation of images, training of neural networks). <br><br>  Thanks for attention.  I am pleased to answer your questions. <br><br>  <b>UPD: Below are examples of what comes out of an approximation.</b> <br><table><tbody><tr><th>  Source image </th><th>  Matched image </th></tr><tr><td><img src="https://habrastorage.org/getpro/habr/post_images/e72/3f1/904/e723f1904210b310ccb59df01dc301aa.png" alt="image"></td><td><img src="https://habrastorage.org/getpro/habr/post_images/dd5/209/944/dd52099444fa1dc9697c5b043e0ad31d.png" alt="image"></td></tr><tr><td><img src="https://habrastorage.org/getpro/habr/post_images/933/8a1/fa5/9338a1fa51c281426d4afc5f307b39ac.png" alt="image"></td><td><img src="https://habrastorage.org/getpro/habr/post_images/82e/f9d/483/82ef9d4836eb9c9ccc8af9bf92076443.png" alt="image"></td></tr></tbody></table></div><p>Source: <a href="https://habr.com/ru/post/138276/">https://habr.com/ru/post/138276/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../138269/index.html">PHP 6 will not, did not master</a></li>
<li><a href="../138270/index.html">Oracle Database Size Growth Control</a></li>
<li><a href="../138271/index.html">About object reuse</a></li>
<li><a href="../138272/index.html">== and === differences in javascript</a></li>
<li><a href="../138275/index.html">To the interlocutor on Habr√© you address</a></li>
<li><a href="../138278/index.html">Idea with a chance of success: six rules</a></li>
<li><a href="../138280/index.html">Good old chat</a></li>
<li><a href="../138283/index.html">HTC develops its own cloud music service</a></li>
<li><a href="../138284/index.html">Chirpify startup lets you buy products via Twitter</a></li>
<li><a href="../138286/index.html">How PDF format is no longer associated with a log</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>