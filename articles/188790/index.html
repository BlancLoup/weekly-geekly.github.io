<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Monitoring Hen's Production</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A short list of what needs to be controlled on a virtualization host running Xen. A full-fledged "read" does not pull, but those who work with Xen wil...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Monitoring Hen's Production</h1><div class="post__text post__text-html js-mediator-article">  A short list of what needs to be controlled on a virtualization host running Xen.  A full-fledged "read" does not pull, but those who work with Xen will be useful.  Additions and clarifications are welcome. <br><br>  This note is about monitoring the host, not the virtual machines running on it or their services. <br><br>  So let's start with a simple one: <br><a name="habracut"></a><br><ul><li>  Ping to host, availability management ssh.  No comments required. </li><li>  Messages ipmi / ilo another management system.  Catching MCE (hardware failures of the processor, motherboard), memory errors, failures of power supplies, fans, other playful pens that open the case, etc.  It is better to monitor via the IPMI external interfaces, although the ipmitool sel list on the host will also fail due to poverty. </li><li>  Dom0 state (typical): <ol><li>  LA (its excess indicates problems, on a normal dom0 la it should not exceed 0.1, more than 2-3 - a problem) </li><li>  cpu usage.  Monitoring is usually uncomfortable (because it requires a measurement interval), most often implemented through zabbix / cacti / munin </li><li>  Free space on the sections with the log.  For example, XenServer'y like to go into the "bibikat" mode if there is a place on / var, and by default they have 4GB for everything </li><li>  Free memory (dom0 itself).  If applications from dom0 go to swap, there will be trouble for all virtualoks </li><li>  The number of open network connections.  The value itself is chosen experimentally, should not be excessive </li><li>  The state of the raid array and hard drives.  Failure or degradation of disks on the host, even if they are used ‚Äúonly‚Äù for root (that is, virtual data separately), the brake / var / log can spoil the nerves.  Particular attention in the case of hardware raid - you need to find the vendor utility and use it.  The software raid handles mdadm perfectly if you configure mail for it.  The drives themselves are controlled by smartmontools or something from the vendor. </li></ol></li><li>  Xen state: <ol><li>  The number of domains - exceeding a certain number is fraught with problems at the start of the next virtual locks.  Loops, minor numbers for tapdisk, lvm, iscsi, etc. are exhausted. </li><li>  The presence of forgotten domains.  Some tulsteks may forget a domain with the 's' status (shutdown) - if such a domain hangs in the domain list for more than 1-3 seconds, something is wrong. </li><li>  The presence of zombie domains.  If the domain has d and s flags at the same time for more than a second, then the host is very bad - there are shared memory pages between the dom0 and the domain, and they are not given to the hypervisor, that is, the domain cannot be killed.  In my practice, this was most often a ‚Äúbad‚Äù tapdisk. </li><li>  Hypervisor free memory.  You need to reserve at least 100-200 MB of memory for the hypervisor in order to be able to use shadow pages and live migration from the host.  Note that this task is different from ‚Äúload balancing‚Äù, since it is a pre-emergency for the host itself, that is, it must be monitored independently. </li><li>  The presence on the host (more than a second) of domains with uuid 00000000-0000-0000-0000-000000000000 (domain initialization error) or with uuid starting on deadbeaf-dead-beaf- ... (failure sign in xapi. Swine method to encode an error, but observation you need him)). </li><li>  The presence of extraneous (new) messages in the console ring zen.  The presence of something there usually indicates a problem or disorderly conduct with guests (for example, trying to record an MSR) </li></ol></li><li>  Dom0 services status <ol><li>  The time difference between ntpd and reference.  A discrepancy of more than 0.2s (pick a figure depending on the quality of the network) indicates problems and can directly affect guests who have time to crawl. </li><li>  The size of the arp-table.  If it is too large, it can significantly impair the performance of the SAN, leading to a constant rerun of ARP, that is, guest lags. </li><li>  Loads of network interfaces used for management / san.  If it is above a certain limit (for a SAN it is above 30-40%), this indicates a potential source of brakes.  Speech about 10-20G, since on the gigabit interface, one way or another, it will periodically be stuck in this gigabit </li><li>  Relevance of all SSL certificates.  Unlike ‚Äúoh, server API is not available‚Äù this check allows you to say ‚ÄúWARNING, in a month the certificate will be gone‚Äù. </li><li>  For tulsters that support queue depth (xapi) - the size of this queue.  30-50 tasks in a queue are usually a sign of problems.  At the same time, such a check also checks the connectivity of the slaves and the master - i.e.  it is better to check on the slaves. </li></ol></li><li>  Monitoring dmesg.  Most often this is done with grep, and not on the host, but outside of it.  Sending logs via syslog and netconsole to send dmesg is a mandatory practice.  Monitoring grepom looks undignified, but fig message is better than architectural silencing of the problem. <ol><li>  Kernel traces.  The reasons are different - most often it is OOM, plugging with IO, etc.  The appearance of the trace in the guest dmesg is a clear sign of the problem. </li><li>  Segmentation fault.  Inside dom0 there can be no user programs, and any falling program is either a crash or a future exploit. </li><li>  The presence of flap symptoms (link down / link up) of network interfaces.  If the interface has started to flop, it should be immediately taken out of service and find out who is at fault.  It so happens that the flaps can go for a long time, not detected by anyone, but at this time the problem is progressing.  There may be a bad cable plugged in, maybe an SFP or network card die. </li><li>  Reporting NFS / ISCSI timeouts, switching paths multipath (or whatever you use in SAN).  Part of the timeout is "soft", that is, the guests do not reach.  But you need to know about them.  The exact type of message is detected experimentally (redeem the test storage system and contemplate) </li></ol><br></li><li>  Monitoring storage parameters.  This area is strongly beyond Xen, so I‚Äôll name only the very minimum that is relevant to the maintenance of xen (that is, the monitoring of disks, the state of arrays, interconnects, the closure of SAS loops, etc.) will not be discussed: <br><ol><li>  Monitor latency on exported moons / volumes / catalogs.  Set yourself some reasonable line (5-10ms) and watch - as soon as 95% percentile (that is, 5% of requests) crawls out of this line - this is a clear sign of future problems </li><li>  Monitoring IOPS.  To monitor or not the maximum is a business thing, but what is necessary to monitor the minimum is definitely.  If you have a load of 25k IOPS on your storage system dropped to 200 IOPS - you need to find out why. </li><li>  The number of active connections from hosts.  A change in this value in the absence of technical work or host I / O is a sign of problems (of which, perhaps, the host does not even suspect) </li><li>  Recycling place.  Games with thin provision, oversubscription, deduplication, compression, and other space saving technologies can be painful if you don‚Äôt keep track of the fulfillment of promises. </li></ol></li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/188790/">https://habr.com/ru/post/188790/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../188778/index.html">Custom Tree v2 jQuery plugin</a></li>
<li><a href="../188780/index.html">Moto X. A controversial but interesting novelty from Motorola / Google</a></li>
<li><a href="../188782/index.html">Video review laptop Acer Aspire V5-572G</a></li>
<li><a href="../188784/index.html">‚ÄúAlready, more than 3 thousand stores operate at PrestaShop in Russia‚Äù - Bruno Leveque</a></li>
<li><a href="../188786/index.html">Joel Spolsky: Circle of Honor for Ask Patents</a></li>
<li><a href="../188792/index.html">Gigabyte U2442 - a good laptop with a difficult future</a></li>
<li><a href="../188794/index.html">Rostelecom began to provide mobile services in St. Petersburg</a></li>
<li><a href="../188798/index.html">Startup Happy Farm - Advice Wallet attracted an investment of $ 300 thousand</a></li>
<li><a href="../188800/index.html">Mobile application developers - the key to success for Russian business</a></li>
<li><a href="../188802/index.html">Postgres 9.3 highlights of material features: materialized views</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>