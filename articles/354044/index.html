<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Next generation video: introducing AV1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="AV1 is a new universal video codec developed by Alliance for Open Media. The Alliance took VPX codec from Google, Thor from Cisco and Daala from Mozil...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Next generation video: introducing AV1</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/fdf/c0d/bb1/fdfc0dbb1903a29218bbe7589db840f1.png" align="left">  AV1 is a new universal video codec developed by Alliance for Open Media.  The Alliance took VPX codec from Google, Thor from Cisco and Daala from Mozilla / Xiph.Org as a basis.  The AV1 codec is superior in performance to VP9 and HEVC, which makes it a codec not for tomorrow, but for the day after tomorrow.  The AV1 format is free of any royalty and will always remain so with the free and open source software license. <br><br><h1>  Triple platform </h1><br>  Who <a href="https://people.xiph.org/~xiphmont/demo/daala/demo1.shtml">followed the development of Daala</a> , he knows that after the formation <a href="https://aomedia.org/">of the Open Media Alliance</a> (AOM), Xiph and Mozilla offered our Daala codec as one of the bases for the new standard.  In addition, Google introduced its VP9 codec, and Cisco introduced Thor.  The idea was to create a new codec, including on the basis of these three solutions.  Since then, I have not published any demo about new technologies in Daala or AV1;  for a long time we knew little about the final codec. <br><br>  About two years ago, AOM voted to establish the fundamental structure of a new codec based on VP9, ‚Äã‚Äãrather than Daala or Thor.  Alliance member companies wanted to get a useful codec without royalties and licenses as soon as possible, so they chose VP9 as the least risky option.  I agree with this choice.  Although Daala was nominated as a candidate, I still think that the elimination of block artifacts by lapping arrpoach and the frequency domain equipment in Daala then (and even now) are not yet mature enough for real deployment.  Daala still had unresolved technical issues, and choosing as the starting point VP9 solved most of these problems. <br><a name="habracut"></a><br>  Due to the fact that VP9 is taken as a basis, the AV1 codec (AOM Video Codec 1) will be basically a clear and familiar codec built on the traditional block transform code.  Of course, it also includes some very interesting new things, some of which are taken from Daala!  Now that we are rapidly approaching the approval of the final specifications, it is time to present the long-awaited technological demonstrations of the codec in the context of AV1. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  New look at prediction of chromaticity in brightness (CfL) </h1><br>  Prediction of chromaticity in brightness (Chroma from Luma, abbreviated to CfL) is one of the new prediction methods adopted for AV1.  As the name suggests, it predicts colors in an image (chroma) based on brightness values ‚Äã‚Äã(luma).  First, the brightness values ‚Äã‚Äãare encoded and decoded, and then the CfL performs sound color prediction.  If the assumption is good, then this reduces the amount of color information to encode and saves space. <br><br>  In fact, CfL in AV1 is not a <i>completely new</i> technique.  <a href="http://dx.doi.org/10.1109/ICIP.2009.5413727">The foundational research paper on CfL</a> was published in 2009, and LG and Samsung jointly proposed the <a href="">first implementation of CfL called LM Mode</a> , which was rejected at the HEVC design stage.  You remember that I wrote about a <a href="https://people.xiph.org/~xiphmont/demo/daala/demo4.shtml">very advanced version of CfL, which is used in the Daala codec</a> .  The Cisco Thor codec also uses the CfL technique, similar to the LM Mode, and HEVC eventually added an improved version, called the Cross-Channel Prediction (CCP), as an extension of the HEVC Range Extension (RExt). <br><br><table><tbody><tr><th></th><th>  LM Mode </th><th>  Thor CFL </th><th>  Daala cfl </th><th>  HEVC CCP </th><th>  AV1 CfL </th></tr><tr><th>  Forecasting area </th><td>  space <br>  salient </td><td>  space <br>  salient </td><td>  frequency </td><td>  space <br>  salient </td><td>  <b>space</b> <b><br></b>  <b>salient</b> </td></tr><tr><th>  Coding </th><td>  not </td><td>  not </td><td>  sign bit </td><td>  index + signs </td><td>  <b>joint sign + index</b> </td></tr><tr><th>  Activation mechanism </th><td>  LM_MODE </td><td>  threshold </td><td>  signal </td><td>  binary flag </td><td>  <b>CFL_PRED</b> <br>  (only in uv mode) </td></tr><tr><th>  Requires PVQ </th><td>  not </td><td>  not </td><td>  Yes </td><td>  not </td><td>  <b>not</b> </td></tr><tr><th>  Decoder styling? </th><td>  Yes </td><td>  Yes </td><td>  not </td><td>  not </td><td>  <b>not</b> </td></tr></tbody></table>  <i><font color="gray">Comparison of different CfL implementations.</font></i> <i><font color="gray"><br><br></font></i>  <i><font color="gray">LM Mode and Thor are similar in that the encoder and decoder in parallel launch the identical prediction model and do not require any coding of parameters.</font></i>  <i><font color="gray">Unfortunately, this parallel / implicit model reduces the accuracy of the approximation and complicates the decoder.</font></i> <i><font color="gray"><br><br></font></i>  <i><font color="gray">Unlike others, CfL in Daala operates in the frequency domain.</font></i>  <i><font color="gray">This transmits only the activation bit and the sign bit, and other parameter information is already implicitly encoded through the PVQ.</font></i> <i><font color="gray"><br><br></font></i>  <i><font color="gray">The final implementation of AV1 CfL is based on the implementation of Daala, borrows the model ideas from Thor and improves both options by implementing the results of additional research.</font></i>  <i><font color="gray">This avoids the increase in complexity in the decoder, realizes the search for a model, which also reduces the complexity of the encoder compared to its predecessors, and especially improves the accuracy and approximation of the coded model.</font></i> <br><hr><br><h1>  The need for better intraframe prediction </h1><br>  At a fundamental level, compression is the art of forecasting.  Before the latest generation of codecs, video compression relied mainly on <b>interframe</b> encoding <b>prediction</b> , that is, frame coding as a set of changes compared to other frames.  Those frames on which interframe coding is based are called <b>reference frames</b> .  Predicting interframe coding over the past few decades has become an incredibly powerful tool. <br><br>  Despite the power of interframe prediction, we still need separate reference frames.  By definition, they do not rely on information from any other frames ‚Äî as a result, they can only use <b>intraframe prediction</b> , which works entirely <i>inside the</i> frame.  Since only intraframe prediction is used in the reference frames, they are also often referred to as I-frames (intra-frames).  Reference or I-frames allow you to search the video, otherwise we would always have to play the video only from the very beginning <a href="https://habr.com/ru/post/354044/">*</a> <a name="1_1"></a>  . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8ba/887/e48/8ba887e48d5f727949a6b444d77a6ed5.png"><br>  <i><font color="gray">A histogram of the size in bits of the first sixty frames of the test video, starting with the reference frame.</font></i>  <i><font color="gray">In this clip, the reference frame is 20‚Äì30 larger in size for subsequent intermediate frames.</font></i>  <i><font color="gray">In slow motion or highly static footage, the reference frame can be hundreds of times more intermediate.</font></i> <br><hr><br>  Support frames are extremely large compared to intermediate frames, so they are usually used as little as possible and widely spread from each other.  Despite this, the intermediate frames are getting smaller and smaller, and the reference frames occupy an increasing part of the bitstream.  As a result, video codec research focused on finding new, more powerful forms of intraframe prediction in order to reduce the size of reference frames.  And despite its name, intermediate frames can also benefit from intraframe prediction. <br><br>  Improving intra-frame prediction is a double win! <br><br>  Chrominance prediction in luminance works solely on the basis of luma blocks within a frame.  Thus, this is a technique of intraframe prediction. <br><br><h1>  Energy is power <a href="https://habr.com/ru/post/354044/">‚Ä†</a> <a name="2_2"></a></h1><br>
<h1>  Energy correlation is information </h1><br>  Why do we think it is possible to predict color in brightness? <br><br>  In most implementations, the video channel correlation is reduced due to the use of the YUV type color space.  Y is a luminance channel, a version of the original grayscale video signal, generated by adding weighted versions of the original red, green, and blue signals.  The U and V chroma channels subtract the luminance signal from blue and red, respectively.  The YUV model is simple and significantly reduces duplication of coding on channels. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9e8/84f/7f8/9e884f7f839571cec1e3963de302b90d.png"><br>  <i><font color="gray">Image decomposition (leftmost) in the YUV model or, more precisely, in the bt.601 Y'CbCr color space.</font></i>  <i><font color="gray">The second image on the left shows the luminance channel, and the two on the right shows the chroma channels.</font></i>  <i><font color="gray">In YUV, there is less inter-channel redundancy than in the RGB image, but the features of the original image are still clearly visible in all three channels after decomposition of YUV;</font></i>  <i><font color="gray">in all three channels the outlines of the objects are in the same places.</font></i> <br><hr><br>  And yet, if you look at the frame decomposition through the YUV channels, it becomes obvious that the outlines of the borders of chromaticity and brightness are still in the same places in the frame.  There remains some correlation that can be used to reduce the bitrate.  Let's try using some brightness data to predict chroma. <br><br><h1>  We get colored chalk </h1><br>  Predicting chromaticity in brightness is, in fact, the process of coloring a monochrome image based on reasonable guesses.  Approximately how to take an old black and white photo, colored pencils - and start coloring.  Of course, CfL forecasts should be accurate, not pure guesses. <br><br>  The work is facilitated by the fact that modern video codecs break an image into a hierarchy of smaller blocks, performing the main part of the coding independently on each block. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/113/87a/fa2/11387afa20e8a6e3e2e8303a1715bca1.jpg"><br>  <i><font color="gray">The AV1 encoder splits the frame into separate prediction blocks for maximum coding accuracy, and, last but not least, to simplify the analysis and make adjustments to the prediction as the image is processed.</font></i> <br><hr><br>  A model that predicts color for the entire image at once would be too cumbersome, complex and error-prone - but we don‚Äôt need to predict the entire image.  Since the coder works in turn with small fragments, we only need to compare the correlations in small areas ‚Äî and from them we can predict the chromaticity from the brightness with a high degree of accuracy using a fairly simple model.  Consider a small portion of the image below, in the red outline: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5e1/b7a/d68/5e1b7ad68329c11c773e07b8b51ca67b.jpg"><br>  <i><font color="gray">A single block in a single video frame illustrates that localizing chroma prediction in small blocks is an effective means to simplify prediction.</font></i> <br><hr><br>  In the small range of this example, a good ‚Äúrule‚Äù for coloring the image will be simple: the brighter areas are green, and the saturation decreases with brightness up to black.  Most blocks have the same simple colorization rules.  We can complicate them to your taste, but the simplest method also manifests itself very well, so let's start with a simple one and approximate the data to a simple ax + Œ≤ line: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1d1/34d/a14/1d134da1430893b67dbd0ac7ef10d271.png"><br>  <i><font color="gray">The values ‚Äã‚Äãof Cb and Cr (U and V) are relative to the brightness (Y) for the pixels in the selected block from the previous image.</font></i>  <i><font color="gray">The quantized and coded linear model is approximated and superimposed as a line on the scatterplot.</font></i>  <i><font color="gray">Note that the approximation consists of two lines;</font></i>  <i><font color="gray">in this example, they overlap.</font></i> <br><hr><br>  Well, well, we have two lines - one for the U channel (the difference with blue, Cb) and one for the V channel (the difference with red, Cr).  In other words, if <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msubsup><mi>L</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mi>j</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>t</mi></mrow></msubsup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.06ex" height="3.262ex" viewBox="0 -883.9 1317.5 1404.6" role="img" focusable="false" style="vertical-align: -1.209ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-74" x="963" y="499"></use><g transform="translate(681,-304)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-6A" x="345" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msubsup><mi>L</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>j</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi>t</mi></mrow></msubsup></math></span></span><script type="math/tex" id="MathJax-Element-1"> L ^ {t} _ {ij} </script>  - these are the restored brightness values, then we calculate the chromaticity values ‚Äã‚Äãas follows: <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><msub><mi>U</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mtext>&amp;#xA0;</mtext><mi>a</mi><mi>l</mi><mi>p</mi><mi>h</mi><msub><mi>a</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>U</mi></mrow></msub><msubsup><mi>L</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mi>j</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>r</mi></mrow></msubsup><mo>+</mo><mtext>&amp;#xA0;</mtext><mi>b</mi><mi>e</mi><mi>t</mi><msub><mi>a</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>U</mi></mrow></msub></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="26.022ex" height="3.021ex" viewBox="0 -780.1 11203.9 1300.8" role="img" focusable="false" style="vertical-align: -1.209ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-55" x="0" y="0"></use><g transform="translate(683,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-6A" x="345" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMAIN-3D" x="1597" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="2903" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-6C" x="3433" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-70" x="3731" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-68" x="4235" y="0"></use><g transform="translate(4811,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-55" x="748" y="-213"></use></g><g transform="translate(5983,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-72" x="963" y="499"></use><g transform="translate(681,-304)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-6A" x="345" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMAIN-2B" x="7523" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-62" x="8774" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-65" x="9203" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-74" x="9670" y="0"></use><g transform="translate(10031,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-55" x="748" y="-213"></use></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>U</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mtext>&nbsp;</mtext><mi>a</mi><mi>l</mi><mi>p</mi><mi>h</mi><msub><mi>a</mi><mrow class="MJX-TeXAtom-ORD"><mi>U</mi></mrow></msub><msubsup><mi>L</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>j</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi>r</mi></mrow></msubsup><mo>+</mo><mtext>&nbsp;</mtext><mi>b</mi><mi>e</mi><mi>t</mi><msub><mi>a</mi><mrow class="MJX-TeXAtom-ORD"><mi>U</mi></mrow></msub></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-2"> U_ {ij} = \ alpha_ {U} L ^ {r} _ {ij} + \ beta_ {U} </script></p><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><msub><mi>V</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mtext>&amp;#xA0;</mtext><mi>a</mi><mi>l</mi><mi>p</mi><mi>h</mi><msub><mi>a</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>V</mi></mrow></msub><msubsup><mi>L</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mi>j</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>r</mi></mrow></msubsup><mo>+</mo><mtext>&amp;#xA0;</mtext><mi>b</mi><mi>e</mi><mi>t</mi><msub><mi>a</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>V</mi></mrow></msub></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="25.796ex" height="3.021ex" viewBox="0 -780.1 11106.7 1300.8" role="img" focusable="false" style="vertical-align: -1.209ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-56" x="0" y="0"></use><g transform="translate(583,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-6A" x="345" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMAIN-3D" x="1497" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="2803" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-6C" x="3333" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-70" x="3631" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-68" x="4135" y="0"></use><g transform="translate(4711,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-56" x="748" y="-213"></use></g><g transform="translate(5885,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-72" x="963" y="499"></use><g transform="translate(681,-304)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-6A" x="345" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMAIN-2B" x="7424" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-62" x="8675" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-65" x="9105" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-74" x="9571" y="0"></use><g transform="translate(9933,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-56" x="748" y="-213"></use></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>V</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mtext>&nbsp;</mtext><mi>a</mi><mi>l</mi><mi>p</mi><mi>h</mi><msub><mi>a</mi><mrow class="MJX-TeXAtom-ORD"><mi>V</mi></mrow></msub><msubsup><mi>L</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>j</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi>r</mi></mrow></msubsup><mo>+</mo><mtext>&nbsp;</mtext><mi>b</mi><mi>e</mi><mi>t</mi><msub><mi>a</mi><mrow class="MJX-TeXAtom-ORD"><mi>V</mi></mrow></msub></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-3"> V_ {ij} = \ alpha_ {V} L ^ {r} _ {ij} + \ beta_ {V} </script></p><br>  What do these parameters look like?  Each <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>a</mi><mi>l</mi><mi>p</mi><mi>h</mi><mi>a</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.242ex" height="2.419ex" viewBox="0 -780.1 2687.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-6C" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-70" x="1078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-68" x="1581" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="2158" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>a</mi><mi>l</mi><mi>p</mi><mi>h</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-4"> \ alpha </script>  corresponds to a certain tone (and anti-tone) from a two-dimensional palette, which are scaled and applied in accordance with the brightness index: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d5c/952/22c/d5c95222c071375ccb6730c8b432567e.png"><br>  <i><font color="gray">Options</font></i> <math> </math><i><font color="gray"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msubsup><mi>L</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mi>j</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>t</mi></mrow></msubsup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.06ex" height="3.262ex" viewBox="0 -883.9 1317.5 1404.6" role="img" focusable="false" style="vertical-align: -1.209ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-74" x="963" y="499"></use><g transform="translate(681,-304)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-6A" x="345" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msubsup><mi>L</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>j</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi>t</mi></mrow></msubsup></math></span></span><script type="math/tex" id="MathJax-Element-5"> L ^ {t} _ {ij} </script></font></i>   <i><font color="gray">in CfL, a tone is chosen for coloring a block from a two-dimensional palette.</font></i> <br><hr><br>  Meanings <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>b</mi><mi>e</mi><mi>t</mi><mi>a</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.731ex" height="2.057ex" viewBox="0 -780.1 2037 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-62" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-65" x="679" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-74" x="1146" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="1507" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>b</mi><mi>e</mi><mi>t</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-6"> \ beta </script>  change the point of intersection of zero for the color scale, that is, these are the buttons for switching the minimum and maximum saturation levels when coloring.  note that <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>b</mi><mi>e</mi><mi>t</mi><mi>a</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.731ex" height="2.057ex" viewBox="0 -780.1 2037 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-62" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-65" x="679" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-74" x="1146" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="1507" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>b</mi><mi>e</mi><mi>t</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-7"> \ beta </script>  allows you to apply a <i>negative</i> color.  This is the opposite of the tone selected by the parameter. <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>a</mi><mi>l</mi><mi>p</mi><mi>h</mi><mi>a</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.242ex" height="2.419ex" viewBox="0 -780.1 2687.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-6C" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-70" x="1078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-68" x="1581" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="2158" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>a</mi><mi>l</mi><mi>p</mi><mi>h</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-8"> \ alpha </script>  . <br><br>  Now our task is to choose the right ones. <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>a</mi><mi>l</mi><mi>p</mi><mi>h</mi><mi>a</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.242ex" height="2.419ex" viewBox="0 -780.1 2687.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-6C" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-70" x="1078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-68" x="1581" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="2158" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>a</mi><mi>l</mi><mi>p</mi><mi>h</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-9"> \ alpha </script>  and <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>b</mi><mi>e</mi><mi>t</mi><mi>a</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.731ex" height="2.057ex" viewBox="0 -780.1 2037 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-62" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-65" x="679" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-74" x="1146" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="1507" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>b</mi><mi>e</mi><mi>t</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-10"> \ beta </script>  and then encoding them.  Here is one example of a straightforward implicit approach for <a href="https://arxiv.org/abs/1711.03951">predicting chroma luminance in AV1</a> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a12/560/339/a12560339e5033ccc4d3b6e343f6e11f.png"></div><br>  It looks worse than it actually is.  If you translate into a normal language: perform the approximation of the smallest squares of chromaticity values ‚Äã‚Äãby the restored brightness values ‚Äã‚Äãto find <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>a</mi><mi>l</mi><mi>p</mi><mi>h</mi><mi>a</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.242ex" height="2.419ex" viewBox="0 -780.1 2687.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-6C" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-70" x="1078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-68" x="1581" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="2158" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>a</mi><mi>l</mi><mi>p</mi><mi>h</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-11"> \ alpha </script>  then use <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>a</mi><mi>l</mi><mi>p</mi><mi>h</mi><mi>a</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.242ex" height="2.419ex" viewBox="0 -780.1 2687.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-6C" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-70" x="1078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-68" x="1581" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="2158" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>a</mi><mi>l</mi><mi>p</mi><mi>h</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-12"> \ alpha </script>  to solve chromaticity bias <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-13-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>b</mi><mi>e</mi><mi>t</mi><mi>a</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.731ex" height="2.057ex" viewBox="0 -780.1 2037 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-62" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-65" x="679" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-74" x="1146" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="1507" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>b</mi><mi>e</mi><mi>t</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-13"> \ beta </script>  .  At least this is one of the possible approximation methods.  It is often used in CfL implementations (such as LM Mode and Thor), which do not transmit a signal <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-14-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>a</mi><mi>l</mi><mi>p</mi><mi>h</mi><mi>a</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.242ex" height="2.419ex" viewBox="0 -780.1 2687.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-6C" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-70" x="1078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-68" x="1581" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="2158" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>a</mi><mi>l</mi><mi>p</mi><mi>h</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-14"> \ alpha </script>  neither <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-15-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>b</mi><mi>e</mi><mi>t</mi><mi>a</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.731ex" height="2.057ex" viewBox="0 -780.1 2037 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-62" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-65" x="679" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-74" x="1146" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="1507" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>b</mi><mi>e</mi><mi>t</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-15"> \ beta </script>  .  In this case, the approximation is performed using the chromaticity values ‚Äã‚Äãof the neighboring pixels that have already been fully decoded. <br><br><h1>  Cfl in daala </h1><br>  Daala performs all frequency domain prediction, including CfL, providing the prediction vector as one of the input values ‚Äã‚Äãfor <a href="https://people.xiph.org/~jm/daala/pvq_demo/">PVQ coding</a> .  PVQ is the gain / shape encoding.  The luminance vector PVQ encodes the location of the contours and borders in luminance, and we simply reuse it as a predictor for contours and chromaticity borders. <br><br>  Daala codec does not need to encode value <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-16-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>a</mi><mi>l</mi><mi>p</mi><mi>h</mi><mi>a</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.242ex" height="2.419ex" viewBox="0 -780.1 2687.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-6C" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-70" x="1078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-68" x="1581" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="2158" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>a</mi><mi>l</mi><mi>p</mi><mi>h</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-16"> \ alpha </script>  , as it falls into the PVQ gain (except for the sign).  Daala also does not need to encode the value. <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-17-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>b</mi><mi>e</mi><mi>t</mi><mi>a</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.731ex" height="2.057ex" viewBox="0 -780.1 2037 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-62" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-65" x="679" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-74" x="1146" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="1507" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>b</mi><mi>e</mi><mi>t</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-17"> \ beta </script>  : because Daala applies CfL to AC color coefficients only, <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-18-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>b</mi><mi>e</mi><mi>t</mi><mi>a</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.731ex" height="2.057ex" viewBox="0 -780.1 2037 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-62" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-65" x="679" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-74" x="1146" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="1507" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>b</mi><mi>e</mi><mi>t</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-18"> \ beta </script>  always zero.  This gives us insight: <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-19-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>b</mi><mi>e</mi><mi>t</mi><mi>a</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.731ex" height="2.057ex" viewBox="0 -780.1 2037 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-62" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-65" x="679" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-74" x="1146" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="1507" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>b</mi><mi>e</mi><mi>t</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-19"> \ beta </script>  conceptually it is just a DC offset of chroma values. <br><br>  In fact, since the Daala codec uses PVQ to encode conversion blocks, it gets CfL with little or no cost, both in terms of bits and in terms of additional calculations in the encoder and decoder. <br><br><h1>  CfL to AV1 </h1><br>  AV1 did not accept PVQ, so the cost of CfL is about the same when calculated in the pixel or frequency domain;  There is no longer a special bonus for working in the frequency domain.  In addition, the time <a href="https://people.xiph.org/~xiphmont/demo/daala/demo3.shtml">-to-time resolution switching TF (Time-Frequency resolution switching)</a> , which uses Daala to glue the smallest luma blocks and create sufficiently large sub-sampled chrominance blocks, currently works only with DCT and Walsh-Hadamard transformations.  Since AV1 uses another discrete sine transformation and pixel domain identity transform, we cannot easily perform AV1 CfL in the frequency domain, at least when using sub-sampled color. <br><br>  But, unlike Daala, AV1 does not <i>need</i> to perform CfL in the frequency domain.  So for AV1, we move the CfL from the frequency domain back to the pixel domain.  This is one of the great features of CfL ‚Äî the basic equations work the same way in both areas. <br><br>  CfL in AV1 should reduce the complexity of the reconstruction to a minimum.  For this reason, we explicitly encode <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-20-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>a</mi><mi>l</mi><mi>p</mi><mi>h</mi><mi>a</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.242ex" height="2.419ex" viewBox="0 -780.1 2687.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-6C" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-70" x="1078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-68" x="1581" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="2158" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>a</mi><mi>l</mi><mi>p</mi><mi>h</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-20"> \ alpha </script>  , so that the decoder does not take the costly approximation of the least squares.  Bit costs for explicit coding <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-21-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>a</mi><mi>l</mi><mi>p</mi><mi>h</mi><mi>a</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.242ex" height="2.419ex" viewBox="0 -780.1 2687.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-6C" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-70" x="1078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-68" x="1581" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="2158" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>a</mi><mi>l</mi><mi>p</mi><mi>h</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-21"> \ alpha </script>  more than pays off the extra precision obtained by calculating <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-22-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>a</mi><mi>l</mi><mi>p</mi><mi>h</mi><mi>a</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.242ex" height="2.419ex" viewBox="0 -780.1 2687.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-6C" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-70" x="1078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-68" x="1581" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="2158" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>a</mi><mi>l</mi><mi>p</mi><mi>h</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-22"> \ alpha </script>  using the chroma pixels of the current block instead of the neighboring reconstructed chroma pixels. <br><br>  Then we optimize the complexity of the approximation on the side of the encoder.  Daala operates in the frequency domain, so we perform CfL only with AC brightness coefficients.  AV1 approximates the CfL in the pixel domain, but we can subtract the average (that is, the already calculated DC value) from each pixel, which results in pixel values ‚Äã‚Äãto zero average, equivalent to the contribution of the AC coefficient in Daala.  Zero average luminance values ‚Äã‚Äãreduce a significant part of the least squares equation, significantly reducing the cost of the calculation: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/868/42c/36d/86842c36d39cdf62a4890d3455c41240.png"></div><br>  We can optimize even more.  After all <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-23-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>b</mi><mi>e</mi><mi>t</mi><mi>a</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.731ex" height="2.057ex" viewBox="0 -780.1 2037 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-62" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-65" x="679" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-74" x="1146" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="1507" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>b</mi><mi>e</mi><mi>t</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-23"> \ beta </script>  - this is just DC chrominance offset, so the encoder and decoder are already performing DC prediction for chroma planes, as this is necessary for other prediction modes.  Of course, the predicted DC value will not be as accurate as the explicitly coded DC / <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-24-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>b</mi><mi>e</mi><mi>t</mi><mi>a</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.731ex" height="2.057ex" viewBox="0 -780.1 2037 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-62" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-65" x="679" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-74" x="1146" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="1507" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>b</mi><mi>e</mi><mi>t</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-24"> \ beta </script>  , but tests have shown that it still looks good: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d90/e8b/898/d90e8b898d095ef74c5e959830a7adb6.png"></div><br>  <i><font color="gray">Error analysis of the default DC predictor on neighboring pixels and encoding an explicit value</font></i> <math> </math><i><font color="gray"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-25-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>b</mi><mi>e</mi><mi>t</mi><mi>a</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.731ex" height="2.057ex" viewBox="0 -780.1 2037 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-62" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-65" x="679" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-74" x="1146" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="1507" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>b</mi><mi>e</mi><mi>t</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-25"> \ beta </script></font></i>   <i><font color="gray">by pixels in the current block.</font></i> <br><hr><br>  As a result, we simply use the already existing DC color prediction instead of <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-26-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>b</mi><mi>e</mi><mi>t</mi><mi>a</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.731ex" height="2.057ex" viewBox="0 -780.1 2037 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-62" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-65" x="679" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-74" x="1146" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="1507" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>b</mi><mi>e</mi><mi>t</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-26"> \ beta </script>  .  Now, not only does the need to encode disappear <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-27-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>b</mi><mi>e</mi><mi>t</mi><mi>a</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.731ex" height="2.057ex" viewBox="0 -780.1 2037 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-62" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-65" x="679" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-74" x="1146" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="1507" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>b</mi><mi>e</mi><mi>t</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-27"> \ beta </script>  but do not need to explicitly calculate <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-28-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>b</mi><mi>e</mi><mi>t</mi><mi>a</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.731ex" height="2.057ex" viewBox="0 -780.1 2037 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-62" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-65" x="679" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-74" x="1146" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="1507" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>b</mi><mi>e</mi><mi>t</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-28"> \ beta </script>  of <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-29-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>a</mi><mi>l</mi><mi>p</mi><mi>h</mi><mi>a</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.242ex" height="2.419ex" viewBox="0 -780.1 2687.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-6C" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-70" x="1078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-68" x="1581" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/354044/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinHGbOq3_g3DQHVXCBeTViUXB19A#MJMATHI-61" x="2158" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>a</mi><mi>l</mi><mi>p</mi><mi>h</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-29"> \ alpha </script>  Neither the encoder nor the decoder.  Thus, our final CfL prediction equation is as follows: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ad3/eb8/a10/ad3eb8a10e6614998cebae1a07a49f54.png"></div><br><br>  In cases where prediction alone is not enough for an accurate result, we encode the residual transform domain.  And of course, when the prediction does not give any benefit at all in bits, we simply do not use it. <br><br><h1>  results </h1><br>  As with any prediction method, the effectiveness of CfL depends on the choice of test.  AOM uses a series of <a href="https://media.xiph.org/video/derf/">standardized test suites hosted on Xiph.Org</a> and available through the ‚ÄúAre We Compressed Yet?‚Äù, AWCY automated testing tool. <br><br>  CfL is an intraframe prediction technique.  To better evaluate its effectiveness on reference frames, take a test set of <i>subset-1</i> images: <br><br><table><tbody><tr><td></td><td colspan="7" align="center">  BD-rate </td></tr><tr><td></td><td>  PSNR </td><td>  PSNR-HVS </td><td>  SSIM </td><td>  <b>CIEDE2000</b> </td><td>  PSNR Cb </td><td>  PSNR Cr </td><td>  MS SSIM </td></tr><tr><td>  The average </td><td>  -0.53 </td><td>  -0.31 </td><td>  -0.34 </td><td>  <b>-4.87</b> </td><td>  -12.87 </td><td>  -10.75 </td><td>  -0.34 </td></tr></tbody></table><br>  Most of these metrics are not sensitive to color.  They are simply always included, and it's nice to see that the CfL technique doesn't <i>harm</i> them.  Of course, it should not, because more efficient color coding simultaneously frees up bits that can be used to better represent the brightness. <br><br>  However, it makes sense to look at the CIE delta-E 2000 indicator;  it shows the metric of perceptual-uniform color error.  We see that CfL saves almost 5% in bitrate, taking into account both brightness and chromaticity!  This is a stunning result for a single prediction method. <br><br>  CfL is also available for intraframe blocks inside intermediate frames.  During the development of the AV1, <i>objective-1-fast</i> was the standard test suite for evaluating motion sequence indicators: <br><br><table><tbody><tr><td></td><td colspan="7" align="center">  BD-rate </td></tr><tr><td></td><td>  PSNR </td><td>  PSNR-HVS </td><td>  SSIM </td><td>  <b>CIEDE2000</b> </td><td>  PSNR Cb </td><td>  PSNR Cr </td><td>  MS SSIM </td></tr><tr><td>  The average </td><td>  -0.43 </td><td>  -0.42 </td><td>  -0.38 </td><td>  <b>-2.41</b> </td><td>  -5.85 </td><td>  -5.51 </td><td>  -0.40 </td></tr><tr><td>  1080p </td><td>  -0.32 </td><td>  -0.37 </td><td>  -0.28 </td><td>  <b>-2.52</b> </td><td>  -6.80 </td><td>  -5.31 </td><td>  -0.31 </td></tr><tr><td>  1080p-screen </td><td>  -1.82 </td><td>  -1.72 </td><td>  -1.71 </td><td>  <b>-8.22</b> </td><td>  -17.76 </td><td>  -12.00 </td><td>  -1.75 </td></tr><tr><td>  720p </td><td>  -0.12 </td><td>  -0.11 </td><td>  -0.07 </td><td>  <b>-0.52</b> </td><td>  -1.08 </td><td>  -1.23 </td><td>  -0.12 </td></tr><tr><td>  360p </td><td>  -0.15 </td><td>  -0.05 </td><td>  -0.10 </td><td>  <b>-0.80</b> </td><td>  -2.17 </td><td>  -6.45 </td><td>  -0.04 </td></tr></tbody></table><br>  As expected, we still see a solid increase, although the contribution of CfL is somewhat weakened due to the prevalence of interpolation.  Intraframe blocks are used mainly in reference frames, each of these test sequences encodes only one reference frame, and intraframe coding is not often used in intermediate frames. <br><br>  The obvious exception is the ‚Äú1080p-screen‚Äù content, where we see a huge decrease in bitrate by 8%.  This is logical, because a significant part of the screencasts are quite static, and if the area changes, it is almost always a major update, suitable for intraframe coding, rather than smooth motion, suitable for interframe coding.  In these screencasts, intraframe blocks are more actively encoded - and therefore the benefits of CfL are more pronounced. <br><br>  This applies to both synthetic content and rendering: <br><br><table><tbody><tr><td></td><td colspan="7" align="center">  BD-rate </td></tr><tr><td></td><td>  PSNR </td><td>  PSNR-HVS </td><td>  SSIM </td><td>  <b>CIEDE2000</b> </td><td>  PSNR Cb </td><td>  PSNR Cr </td><td>  MS SSIM </td></tr><tr><td>  Twitch </td><td>  -1.01 </td><td>  -0.93 </td><td>  -0.90 </td><td>  <b>-5.74</b> </td><td>  -15.58 </td><td>  -9.96 </td><td>  -0.81 </td></tr></tbody></table><br>  The Twitch test suite consists entirely of video game broadcasts, and here we also see a solid reduction in bitrate. <br><br>  Of course, the prediction of chromaticity in brightness is not the only technique that the AV1 codec will open for mass use for the first time.  In the next article, we will look at a really completely new technique from the AV1: A Constrained Directional Enhancement Filter. <br><br>  <font color="gray"><b>Author: Monty (monty@xiph.org, cmontgomery@mozilla.com).</b></font>  <font color="gray"><b>Published on April 9, 2018.</b></font> <br><br> <i><a name="1"></a></i>  <i>* It is possible to ‚Äúsmudge‚Äù the reference frame over other frames using <b>rolling I</b> ( <b>frame</b> rolling).</i>  <i>In the case of rolling, the individual reference frames are divided into separate blocks, which are scattered among the previous reference frames.</i>  <i>Instead of searching for the reference frame and starting playback from this point, the codec with I-frame support supports searching for the first previous block, reads all other necessary fragments of the reference frame, and starts playback after collecting enough information to restore the full reference frame.</i>  <i>Rolling an I-frame does not improve compression;</i>  <i>it simply blurs bit rate spikes caused by large reference frames.</i>  <i>It can also be used to improve fault tolerance.</i>  <i><a href="https://habr.com/ru/post/354044/">[return]</a></i> <i><br><br><a name="2"></a></i>  <i>‚Ä† Technically, energy is the product of power and time.</i>  <i>When comparing apples and oranges, it is important to express both fruits in watt-hours.</i>  <i><a href="https://habr.com/ru/post/354044/">[return]</a></i> <br><br><h1>  Additional resources </h1><br><ul><li>  Open Media Alliance Project Document: <a href="https://docs.google.com/document/d/1T86spqQqt7o3LWj3FeaOPUJ2vZ_DSgImJ2r0on8wP-g/">CfL in AV1</a> , Luke Trudeau, David Michael Barr </li><li>  The underlying scientific paper on luminance prediction in luminance in the spatial domain: <a href="http://dx.doi.org/10.1109/ICIP.2009.5413727">‚ÄúIntraframe prediction method based on linear communication between channels in YUV 4: 2: 0 intraframe coding‚Äù</a> , San Hyun Lee, 16th International IEEE Image Processing Conference (ICIP) , 2009 </li><li>  LG's proposal to include CfL spatial prediction in HEVC: <a href="http://wftp3.itu.int/av-arch/jctvc-site/2010_07_B_Geneva/JCTVC-B021.doc">‚ÄúA new technique of intraframe chromatic prediction using interchannel correlation‚Äù</a> , Kim et al., 2010 </li><li>  Samsung and LG joint proposal on LM Mode in HEVC: <a href="">‚ÄúIntraframe prediction of chromaticity using reconstructed brightness patterns‚Äù</a> , Kim et al., 2011 </li><li>  Realization of CfL in Daala: <a href="https://arxiv.org/abs/1603.03482">‚ÄúPrediction of chromaticity in brightness in the intraframe frequency domain‚Äù</a> , Natan Aggie, Jean-Marc Valin, March 10, 2016 </li><li>  <a href="https://arxiv.org/abs/1711.03951">‚ÄúPrediction of chromaticity in luminance in AV1‚Äù</a> , Luke Trudeau, Nathan Aggie, David Barr, January 17, 2018 </li><li>  Daala's <a href="https://people.xiph.org/~xiphmont/demo/daala/demo3.shtml">Frequency Resolution Switching Demo Page</a> </li><li>  <a href="https://people.xiph.org/~xiphmont/demo/daala/demo4.shtml">Daf CfL demo page</a> </li><li>  CfL presentation from the VideoLan Dev Days 2017 conference: <a href="https://docs.google.com/presentation/d/1LYQQ4EnsIIbTTdXlLpxbxK90ijkdNhz7Pt5a1CJoxsY/">‚ÄúCfL to AV1‚Äù</a> , Luke Trudeau, David Barr, September 2017 </li><li>  Presentation from the Data Compression Conference: <a href="https://docs.google.com/presentation/d/13yUG1lyNmf_TtWARvOJRGa05EVknKya-VEDZ_8L22P8/">‚ÄúIntraframe CfL Prediction for AV1‚Äù</a> , Luc Trudeau, Nathan Aggie, David Barr, March 2018 </li><li>  <a href="https://media.xiph.org/video/derf/">Standard test suites</a> from Xiph.Org at <a href="https://media.xiph.org/">media.xiph.org</a> </li><li>  Automated testing system and metrics used in the development of Daala and AV1: <a href="https://arewecompressedyet.com/">‚ÄúAre we already compressed?‚Äù</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/354044/">https://habr.com/ru/post/354044/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../354032/index.html">Fuzzy search in relational databases</a></li>
<li><a href="../354034/index.html">Reindexer site search is easy. Or how to make an "instant search" throughout the Habrahabr</a></li>
<li><a href="../354036/index.html">20 Eloquent ORM tricks</a></li>
<li><a href="../354038/index.html">Top VSCode Extensions That Speed ‚Äã‚ÄãUp Your JavaScript Development</a></li>
<li><a href="../354040/index.html">We apply the Deep Watershed Transform in the Kaggle Data Science Bowl 2018 competition.</a></li>
<li><a href="../354046/index.html">Inheritance, composition, aggregation</a></li>
<li><a href="../354048/index.html">Atlassian Jira Software functionality in Jira plugin</a></li>
<li><a href="../354050/index.html">Designing a Schemaless Uber Engineering data warehouse using MySQL</a></li>
<li><a href="../354052/index.html">Configuring Let's Encrypt wildcard certificates on CentOS 7 with validation via CloudFlare API</a></li>
<li><a href="../354054/index.html">You should not conduct interviews because ... [spoiler - you yourself do not go to interviews]</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>