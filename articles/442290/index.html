<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Making ST-Link V2.1 from Chinese ST-Link V2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! 

 In this article I will explain how to modify ST-Link V2 to ST-Link V2.1. 

 Perhaps for someone it will not be news, but I did not find m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Making ST-Link V2.1 from Chinese ST-Link V2</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/tk/jk/6f/tkjk6fbr7s0bd4uty75xfjisfm8.jpeg" align="left">  Hi, Habr! <br><br>  In this article I will explain how to modify ST-Link V2 to ST-Link V2.1. <br><br>  Perhaps for someone it will not be news, but I did not find much information on this topic in the internet. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Who cares - I ask under the cat. <a name="habracut"></a><br clear="left"><h3>  Foreword </h3><br>  It so happened that I was bored with extra wires. <br><br>  A little thought, I remembered that on the boards Nucleo and Discovery - ST-Link combines SWD and VCP (Virtual Com Port). <br><br>  The first thing that occurred to me was to buy the cheapest of such cards, try to dump the firmware around the protection and upload it to the programmer from China, or dissolve the new board. <br>  However, I was prompted to link to GitHub with an already extended bootloader, which eventually resulted in what happened. <br><br><h3>  Getting Started </h3><br>  Modification can be made only on the version of the software under Windows, the cross-platform version of the software refuses to update the device! <br><br>  There are several options for modification, and some of them can not be done if the chip is not suitable (not enough memory). <br><br>  For example, a modification of STM32 + MSD + VCP can be done only if the chip is STM32F1xxCBxx, but it has an analogue of STM32 + Audio, which will give STM32 + VCP (in principle, what we need). <br><br>  It will take: <br><br>  - Soldering iron; <br>  - Multimeter with dialing; <br>  - PC with Windows OS (maybe it will work through Wine, I haven't tried it); <br>  - <a href="https://github.com/User420t/V2_1">Archive with the necessary software and bootloader</a> (PASS: QWK2tn + fM.EdjX6z). <br>  - Chinese clone ST-Link V2; <br>  - USB-UART adapter or second ST-Link. <br><br><h4>  We open ... </h4><br><div class="spoiler">  <b class="spoiler_title">Boards and chips in all different</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ts/8r/6x/ts8r6xu1pkbeckvs5de0ijezkso.jpeg"><br><img src="https://habrastorage.org/webt/1e/pi/me/1epimekcgewh9ngar1x5ivxv4pi.jpeg"><br><img src="https://habrastorage.org/webt/w5/ui/vd/w5uivds6cw1i-kmzkk7zmaks4i4.jpeg"><br></div></div><br><h4>  Firmware </h4><br>  There are two ways - USB-UART (slightly more complicated) or the second ST-Link. <br><br><div class="spoiler">  <b class="spoiler_title">USB UART</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/jz/qm/hq/jzqmhq36soe4ejn8uakxgle_otg.png"><br><br>  1) With a dial, we find a resistor that is connected to <b><i>BOOT0</i></b> . <br>  Make a jumper from the side of this resistor which is connected to <b><i>BOOT0</i></b> to <b><i>3.3v</i></b> . <br><br>  <b><i>PA9 (TX)</i></b> can be connected to the LED or resistor next to it, so we call it. <br><br>  We solder the <b>UART</b> on <b><i>PA9</i></b> ( <b><i>TX</i></b> ) and <b><i>PA10</i></b> ( <b><i>RX</i></b> ). <br><br>  I did it like this: <br><br><img src="https://habrastorage.org/webt/jm/rf/cr/jmrfcro5veg9cvmfv5xo5lv5kb4.jpeg"><br><br>  Just solder the food. <br><br>  We are flashing the Protected-2-1-Bootloader.bin <a href="https://www.st.com/en/development-tools/flasher-stm32.html">loader</a> using the <a href="https://www.st.com/en/development-tools/flasher-stm32.html">STM32 Flash loader demonstrator</a> . <br><br>  After flashing, unplug the jumper, <b><i>PA9</i></b> and <b><i>PA10</i></b> (leave the <b><i>PA10</i></b> if we want to output <b><i>SWO</i></b> ). <br></div></div><br><div class="spoiler">  <b class="spoiler_title">ST-Link</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/jz/qm/hq/jzqmhq36soe4ejn8uakxgle_otg.png"><br>  On the boards there are 4 pins <b><i>each</i></b> , in some cases they are already marked, otherwise we <b><i>call</i></b> them relative to <b><i>PA13</i></b> ( <b><i>SWDIO</i></b> ) and <b><i>PA14</i></b> ( <b><i>SWCLK</i></b> ), we solder with the second <b>ST-Link</b> . <br><br><img src="https://habrastorage.org/webt/fk/nh/ql/fknhqltfmmh5bugrivgwt6b7nvs.jpeg"><br><br>  Just solder the food. <br><br>  Install the STM32 ST-LINK Utility V4.3 from the archive, remove the write protection and flash the loader Protected-2-1-Bootloader.bin. <br><br>  To remove protection in the <b>STM32 ST-LINK Utility</b> program, click <b><i>Target&gt; Option Bytes</i></b> , switch <b><i>Read Out Protection</i></b> to <b><i>Disabled,</i></b> and click <b><i>Apply</i></b> . <br></div></div><br><h4>  Upgrade to ST-Link V2.1 </h4><br>  After the firmware, connect the stitched ST-Link (now almost V2.1) to the PC. <br><br>  In the <b>STM32 ST-LINK Utility V4.3 program,</b> click <b><i>ST-LINK&gt; Firmware update</i></b> . <br><br>  Click <b><i>Device Connect</i></b> - we get a list of possible modifications: <br><br><img src="https://habrastorage.org/webt/jh/5k/h5/jh5kh5vj7gp3nb6opqjuwgbvz8m.png"><br><br>  Select the modification you need, in my case <b>STM32 + MSD + VCP</b> , click <b><i>Yes &gt;&gt;&gt;&gt;</i></b> . <br><br>  We are waiting for the update to complete ... <br><br><img src="https://habrastorage.org/webt/rx/8o/_k/rx8o_kz2hkdsefcms_dv3l0wmvw.jpeg"><br><br>  Profit! <br><br><h4>  The final part </h4><br>  Since SWIM and RST do not work after this modification, I cut them off. <br><br>  I also cut off the backup 5V and 3.3V. <br><br>  It turns out 4 free pins. <br><br>  On them I get wired to the chip: <br><br>  <b><i>PA10 -&gt; SWO</i></b> <b><i><br></i></b>  <b><i>PB0 -&gt; NRST</i></b> <b><i><br></i></b>  <b><i>PA3 -&gt; RX</i></b> <b><i><br></i></b>  <b><i>PA2 -&gt; TX</i></b> <br><br>  I bring everything to the main connector, to the remaining free pins. <br><br>  It turned out this pinout: <br><br><img src="https://habrastorage.org/webt/ay/of/0y/ayof0yidnulvszuslmh_cedle9s.png"><br><br><div class="spoiler">  <b class="spoiler_title">My device after modification</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/w5/ui/vd/w5uivds6cw1i-kmzkk7zmaks4i4.jpeg"><br><br><img src="https://habrastorage.org/webt/zi/th/se/zithsegdh34lfpfkdzppu_dx1fk.jpeg"><br><br>  Nakaryabal scalpel markings on the body: <br><br><img src="https://habrastorage.org/webt/_w/xe/yp/_wxeyphddojngarajqqyuqswphy.jpeg"><br></div></div><br>  Do not forget to wash the board after soldering! <br><br>  As a result, in the PC device is determined as follows: <br><br><img src="https://habrastorage.org/webt/on/pn/u4/onpnu4abfhsqhuwbh20imhtff1a.png"><br><br><img src="https://habrastorage.org/webt/gp/61/m9/gp61m9ajw7fngz9fvf5ojyckuzg.png"><br><br>  I have no idea what is equal to the amount of virtual flash drives (in this case, F103C8 was connected to ST-Link V2.1). <br><br>  If you drop the firmware file onto it, the programmer will flash the chip without programs. <br><br>  Checking VCP: <br><br><img src="https://habrastorage.org/webt/dx/bk/da/dxbkdanxfbl4hrkch4fqqakagta.png"><br><br>  Thanks for attention! <br><br>  With questions, please contact the comments, if I can - I will help. </div><p>Source: <a href="https://habr.com/ru/post/442290/">https://habr.com/ru/post/442290/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../442272/index.html">Go + = package version control</a></li>
<li><a href="../442278/index.html">Kibana User Guide. Visualization. Part 6</a></li>
<li><a href="../442280/index.html">Machine learning in Dodo. How to start a new direction, if you are a developer</a></li>
<li><a href="../442284/index.html">NoVerify: Linter for PHP from Team VKontakte is now publicly available</a></li>
<li><a href="../442286/index.html">Russian ophthalmologists told about bionic vision. New mobile application demonstrates cybernet work</a></li>
<li><a href="../442292/index.html">Internship Sberseasons: Python, UX / UI, Data and more for students</a></li>
<li><a href="../442294/index.html">What is slightly wrong Oleg Artamonov</a></li>
<li><a href="../442298/index.html">Gatsby.js in detail</a></li>
<li><a href="../442300/index.html">I look and listen where I want. We integrate Chromecast into Android application</a></li>
<li><a href="../442302/index.html">The first launch of the spacecraft Dragon v2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>