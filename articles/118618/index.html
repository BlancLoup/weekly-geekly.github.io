<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Musical lighting of the optical glass collection</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the Optics Museum of St. Petersburg State University ITMO there is a rather remarkable exhibit - the Abbe catalog, which is a collection of optical...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Musical lighting of the optical glass collection</h1><div class="post__text post__text-html js-mediator-article">  In <a href="http://www.optimus.edu.ru/ru">the Optics Museum of</a> St. Petersburg State University ITMO there is a rather remarkable exhibit - the Abbe catalog, which is a collection of optical glasses of various brands and sizes.  The management of the museum wanted this catalog to be illuminated to the music, so the project of the musical backlighting of the catalog, which I actually dealt with, was born.  This is something akin to the task of flashing an LED using a microcontroller, only larger. <br><br><img src="https://habrastorage.org/storage/habraeffect/8f/fd/8ffdad1d73767535b5e0a94b315e1bfb.jpg" alt="image"><br><a name="habracut"></a><br><img src="https://habrastorage.org/storage/habraeffect/54/d2/54d2eefd4cd06c3cbc3db1f30dfbc841.jpg" alt="image"><br><br>  The hardware was developed by <a href="http://lmt.ifmo.ru/">LMT</a> .  Under each glass is an LED ruler connected to the controller.  The controllers are connected via a twisted pair to a network connected to a hub, which in turn is connected via USB to a computer. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      My task was to develop software that would form an image using LED bars in accordance with the currently playing music.  Those.  simple audio player that could visualize the audio and at the same time would have an interface designed for a touchscreen.  I don‚Äôt see any reason to talk about the program as a whole, so I‚Äôll focus on the sound part. <br><br>  The SFML library was used to work with graphics and sound, and FFTW was used to perform a fast Fourier transform. <br><br>  In order to extract any information from the audio signal, you must have direct access to the audio samples.  With the help of the SFML + libsndfile bundle, this was easy to implement. <br><br>  During playback of an audio file with a certain frequency (in this case, this is the frame rate), a small section of the array with samples is taken and then a fast Fourier transform is performed on it.  Thanks to the FFT, an array with frequency data is obtained from the array with the sound wave data.  In the case of performing a real conversion, the size of the resulting array will be two times smaller than the original one. <br><br>  Some pieces like this are needed: <br><img src="https://habrastorage.org/storage/habraeffect/59/ac/59ac6e896af3d6eede1a2b8eee54c381.png" alt="image"><br><br>  One thing to consider here is that in order to accurately track the bass notes, a fairly large data array is needed to transform the Fourier transform.  According to my calculations, in order to be able to begin work from the A-second octave, an array of size 8096 was required. With a sampling frequency of 44100, this is approximately 0.2 seconds, and this is a rather large interval and no longer sounding notes can get into it.  Therefore, in this case, you should resort to a little trick, told even in textbooks on digital signal processing - take a small array and add it with zeros to the desired size.  This slightly changes the result, but in this case it was not critical. <br><br>  This is what kind of data the FFT actually performs: <br><img src="https://habrastorage.org/storage/habraeffect/fd/5a/fd5a3f3b28f44bd23f406ae234c89009.png" alt="image"><br><br>  To obtain a spectrum, it is necessary to square all the elements of the resulting array, then, based on the size of the array and the sampling frequency, it is easy to determine in which elements of the array the amplitudes of which frequencies are located, since  in the last element of the array, the amplitude of the Nyquist frequency will be equal to half the sampling frequency, and before that - with a step corresponding to the number of elements.  Subsequently, the values ‚Äã‚Äãof the amplitudes of frequencies as close as possible to the frequencies of musical notes are selected from them. <br><br>  The spectrum obtained as a result of processing an array of audio samples: <br><img src="https://habrastorage.org/storage/habraeffect/4b/08/4b0863f1e12286bf746075bc071b82e3.png" alt="image"><br><br>  Further, a little more processing - tracking peaks, exceeding the value of the minimum sensitivity limit, converting the amplitude value into a brightness value.  After that, you can proceed to the formation of the image. <br><br>  Because  the resolution of the ‚Äúscreen‚Äù is small - 48x3, then there are no many options for the spatial arrangement of notes.  But two ideas came in right away.  In one embodiment, the columns of three glasses are combined and represent one note, outwardly it turns out something remotely resembling a piano keyboard.  In the second version, two glasses standing side by side in the same row represent one note, this is closer to the guitar with three strings and an extremely unusual tuning;) <br><br>  The last part - the formation of color.  Almost immediately it became clear that working with the HSV color model here is much more convenient than with RGB, since basically it was necessary to control the tone.  One of the simplest and most logical methods of sound visualization was proposed by Newton - according to his idea, the visual spectrum corresponds to one octave.  Newton's method is presented in the image below on the right: <br><img align="right" src="https://habrastorage.org/storage/habraeffect/f6/de/f6dec817ef15d1b8384bf3ea7a39640a.gif" alt="image"><br>  After experimenting, this idea was developed further - in different modes, the entire visible spectrum or its part is superimposed on a different number of octaves.  For example, 60 degrees of tone by four octaves, plus an additional constant time offset of the initial degree. <br><br>  Another color generation method was borrowed from web design.  In it, the color palette is selected using one of the templates. <br><br>  Here are some examples: <br><img src="https://habrastorage.org/storage/habraeffect/e6/c2/e6c231579143aa360b288a6f3e7bcd2a.png" alt="image"><br><br>  Using this method, you can create more contrast images.  As in the previous method, the main tone can be shifted in time. <br><br>  System video (available in FullHD): <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/13l3pPUmBtg&amp;xid=17259,15700022,15700186,15700190,15700253,15700256,15700259&amp;usg=ALkJrhgdmzvdzoIATwcQLSdIm3BuKi-Ukw" frameborder="0" allowfullscreen=""></iframe><br><br>  References: <br><br>  1. <a href="http://lukenimtz.com/archives/806">Luke Nimtz, Primary Harmonics - Music / Color Theory</a> <br>  2. <a href="http://visualmusic.blogspot.com/">Visual music blog</a> <br><br>  Students and applicants - such things (and not only such) can be dealt with in the master's program at SPbIITMO, in the direction <a href="http://embedded.ifmo.ru/">‚ÄúEmbedded Computing Systems‚Äù</a> </div><p>Source: <a href="https://habr.com/ru/post/118618/">https://habr.com/ru/post/118618/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../118610/index.html">Private cloud</a></li>
<li><a href="../118611/index.html">Bing and Bing Maps will become the default tools on BlackBerry</a></li>
<li><a href="../118612/index.html">Have you got an additional account in Skype / ICQ / Jabber / other IM networks "for business needs"?</a></li>
<li><a href="../118614/index.html">Useful Unity Commands</a></li>
<li><a href="../118616/index.html">Mario on ice</a></li>
<li><a href="../118620/index.html">My experience with the Microsoft Cassini web server</a></li>
<li><a href="../118622/index.html">Google named the most respected company in the US</a></li>
<li><a href="../118624/index.html">[Translation] VMware CloudFoundry: PaaS to Ruby</a></li>
<li><a href="../118625/index.html">Turning off the monitor with a hot key</a></li>
<li><a href="../118626/index.html">Fun da vinci</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>