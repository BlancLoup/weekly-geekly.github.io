<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Create an application for Windows Phone 7 from start to finish. Part 13. Application recovery after decontamination</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Previous part 

 When a user leaves your application, it is deactivated. If the user uses the ‚ÄúBack‚Äù button to return to your application, you need to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Create an application for Windows Phone 7 from start to finish. Part 13. Application recovery after decontamination</h1><div class="post__text post__text-html js-mediator-article">  <a href="http://habrahabr.ru/blogs/windows_mobile/118455/">Previous part</a> <br><br>  When a user leaves your application, it is deactivated.  If the user uses the ‚ÄúBack‚Äù button to return to your application, you need to restore the application to the appropriate state. <br><br>  In this part you will learn: <br><ul><li>  What is tombstoning. </li><li>  How to restore applications after it has been deactivated. </li><li>  When to perform other actions in your application. </li></ul><a name="habracut"></a><h4>  Tombstoning review </h4><br>  Your application can be interrupted and deactivated at any time, as a rule, this happens when the user switches to another application using the ‚ÄúStart‚Äù button.  When this happens, your application should maintain its state so that it can be restored in the event of a return to it.  However, isolated storage is too slow for short-term storage of state data.  Instead, you cache data using in-memory dictionaries to quickly save and load data. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      When an application is deactivated, its process can be stopped using a procedure called <i>tombstoning</i> (tombstone), which will save the application's records in memory and associate them with your cached state data.  If the user goes back to your application, the operating system restarts the application process and sends back status data to it. <br><br>  <b>Tip:</b> <br>  When the application is interrupted and then resumed, users expect to continue working from the place where it was interrupted.  For this reason, you should always implement tombstoning support for any page that can change its state.  This refers to state changes as complex as updating user input, or as simple as changing the current selection in the list.  Lack of tombstoning support can lead to poor usability at best and completely unexpected behavior at worst. <br><br>  <b>Certification Requirement:</b> <br>  Your application should not delay or prevent the user from making a call, answering an incoming call, or ending a call. <br><br><h4>  Tombstoning support implementation </h4><br>  In order to use a temporary cache that persists during tombstoning, follow these steps: <br><ul><li>  Place the application-level status data in the PhoneApplicationService.State property in the Deactivated event and retrieve the data in the Activated event handler. </li><li>  Place the page-level status data in the PhoneApplicationPage.State property for each page in the OnNavigatedFrom method overload and retrieve the data in the OnNavigatedTo method overload. </li></ul>  These two <b>State</b> properties are dictionaries in which you can store value / key type pairs, where values ‚Äã‚Äãcan be primitive type values ‚Äã‚Äãor serializable objects.  Please note that there is no guarantee that a deactivated application will ever be reactivated, so you should not use these dictionaries to store any application or user data that should be stored.  For long-term storage, use isolated storage. <br><br>  <b>Performance Improvement Tip:</b> <br>  Use state dictionaries to restore state.  Avoid recovering from isolated storage or from the Internet. <br><br>  The Fuel Tracker application saves temporary page level states during the tombstoning process, but does not have application level state data to save.  Each page saves state data with its PhoneApplicationPage.State property.  For example, the <b>FillupPage</b> class contains a <b>Fillup</b> object bound to some text fields.  This object is stored for long-term storage only when the user clicks the "Save" button.  However, during tombstoning, the page places an object in the State dictionary of the page along with a value indicating whether the user made changes to it, as shown in the following code snippet.  (The implementation of the Save button will be described in the Validation of Input Data section.) <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CURRENT_FILLUP_KEY = <font color="#A31515">"CurrentFillup"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> HAS_UNSAVED_CHANGES_KEY = <font color="#A31515">"HasUnsavedChanges"</font> ; <font color="#0000ff">private</font> Fillup currentFillup; <font color="#0000ff">private</font> <font color="#0000ff">bool</font> hasUnsavedChanges; <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedFrom(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedFrom(e); <font color="#0000ff">if</font> (cacheChanges) { CommitTextBoxes(); <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] = currentFillup; <font color="#0000ff">this</font> .State[HAS_UNSAVED_CHANGES_KEY] = hasUnsavedChanges; } } <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedTo(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedTo(e); CarHeader.DataContext = CarDataStore.Car; DataContext = currentFillup = State.ContainsKey(CURRENT_FILLUP_KEY) ? (Fillup) <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] : <font color="#0000ff">new</font> Fillup() { Date = <font color="#2B91AF">DateTime</font> .Now }; hasUnsavedChanges = State.ContainsKey(HAS_UNSAVED_CHANGES_KEY) ? ( <font color="#0000ff">bool</font> )State[HAS_UNSAVED_CHANGES_KEY] : <font color="#0000ff">false</font> ; }</font> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <ol><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CURRENT_FILLUP_KEY = <font color="#A31515">"CurrentFillup"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> HAS_UNSAVED_CHANGES_KEY = <font color="#A31515">"HasUnsavedChanges"</font> ; <font color="#0000ff">private</font> Fillup currentFillup; <font color="#0000ff">private</font> <font color="#0000ff">bool</font> hasUnsavedChanges; <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedFrom(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedFrom(e); <font color="#0000ff">if</font> (cacheChanges) { CommitTextBoxes(); <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] = currentFillup; <font color="#0000ff">this</font> .State[HAS_UNSAVED_CHANGES_KEY] = hasUnsavedChanges; } } <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedTo(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedTo(e); CarHeader.DataContext = CarDataStore.Car; DataContext = currentFillup = State.ContainsKey(CURRENT_FILLUP_KEY) ? (Fillup) <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] : <font color="#0000ff">new</font> Fillup() { Date = <font color="#2B91AF">DateTime</font> .Now }; hasUnsavedChanges = State.ContainsKey(HAS_UNSAVED_CHANGES_KEY) ? ( <font color="#0000ff">bool</font> )State[HAS_UNSAVED_CHANGES_KEY] : <font color="#0000ff">false</font> ; } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CURRENT_FILLUP_KEY = <font color="#A31515">"CurrentFillup"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> HAS_UNSAVED_CHANGES_KEY = <font color="#A31515">"HasUnsavedChanges"</font> ; <font color="#0000ff">private</font> Fillup currentFillup; <font color="#0000ff">private</font> <font color="#0000ff">bool</font> hasUnsavedChanges; <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedFrom(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedFrom(e); <font color="#0000ff">if</font> (cacheChanges) { CommitTextBoxes(); <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] = currentFillup; <font color="#0000ff">this</font> .State[HAS_UNSAVED_CHANGES_KEY] = hasUnsavedChanges; } } <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedTo(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedTo(e); CarHeader.DataContext = CarDataStore.Car; DataContext = currentFillup = State.ContainsKey(CURRENT_FILLUP_KEY) ? (Fillup) <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] : <font color="#0000ff">new</font> Fillup() { Date = <font color="#2B91AF">DateTime</font> .Now }; hasUnsavedChanges = State.ContainsKey(HAS_UNSAVED_CHANGES_KEY) ? ( <font color="#0000ff">bool</font> )State[HAS_UNSAVED_CHANGES_KEY] : <font color="#0000ff">false</font> ; } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CURRENT_FILLUP_KEY = <font color="#A31515">"CurrentFillup"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> HAS_UNSAVED_CHANGES_KEY = <font color="#A31515">"HasUnsavedChanges"</font> ; <font color="#0000ff">private</font> Fillup currentFillup; <font color="#0000ff">private</font> <font color="#0000ff">bool</font> hasUnsavedChanges; <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedFrom(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedFrom(e); <font color="#0000ff">if</font> (cacheChanges) { CommitTextBoxes(); <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] = currentFillup; <font color="#0000ff">this</font> .State[HAS_UNSAVED_CHANGES_KEY] = hasUnsavedChanges; } } <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedTo(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedTo(e); CarHeader.DataContext = CarDataStore.Car; DataContext = currentFillup = State.ContainsKey(CURRENT_FILLUP_KEY) ? (Fillup) <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] : <font color="#0000ff">new</font> Fillup() { Date = <font color="#2B91AF">DateTime</font> .Now }; hasUnsavedChanges = State.ContainsKey(HAS_UNSAVED_CHANGES_KEY) ? ( <font color="#0000ff">bool</font> )State[HAS_UNSAVED_CHANGES_KEY] : <font color="#0000ff">false</font> ; } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CURRENT_FILLUP_KEY = <font color="#A31515">"CurrentFillup"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> HAS_UNSAVED_CHANGES_KEY = <font color="#A31515">"HasUnsavedChanges"</font> ; <font color="#0000ff">private</font> Fillup currentFillup; <font color="#0000ff">private</font> <font color="#0000ff">bool</font> hasUnsavedChanges; <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedFrom(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedFrom(e); <font color="#0000ff">if</font> (cacheChanges) { CommitTextBoxes(); <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] = currentFillup; <font color="#0000ff">this</font> .State[HAS_UNSAVED_CHANGES_KEY] = hasUnsavedChanges; } } <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedTo(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedTo(e); CarHeader.DataContext = CarDataStore.Car; DataContext = currentFillup = State.ContainsKey(CURRENT_FILLUP_KEY) ? (Fillup) <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] : <font color="#0000ff">new</font> Fillup() { Date = <font color="#2B91AF">DateTime</font> .Now }; hasUnsavedChanges = State.ContainsKey(HAS_UNSAVED_CHANGES_KEY) ? ( <font color="#0000ff">bool</font> )State[HAS_UNSAVED_CHANGES_KEY] : <font color="#0000ff">false</font> ; } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CURRENT_FILLUP_KEY = <font color="#A31515">"CurrentFillup"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> HAS_UNSAVED_CHANGES_KEY = <font color="#A31515">"HasUnsavedChanges"</font> ; <font color="#0000ff">private</font> Fillup currentFillup; <font color="#0000ff">private</font> <font color="#0000ff">bool</font> hasUnsavedChanges; <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedFrom(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedFrom(e); <font color="#0000ff">if</font> (cacheChanges) { CommitTextBoxes(); <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] = currentFillup; <font color="#0000ff">this</font> .State[HAS_UNSAVED_CHANGES_KEY] = hasUnsavedChanges; } } <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedTo(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedTo(e); CarHeader.DataContext = CarDataStore.Car; DataContext = currentFillup = State.ContainsKey(CURRENT_FILLUP_KEY) ? (Fillup) <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] : <font color="#0000ff">new</font> Fillup() { Date = <font color="#2B91AF">DateTime</font> .Now }; hasUnsavedChanges = State.ContainsKey(HAS_UNSAVED_CHANGES_KEY) ? ( <font color="#0000ff">bool</font> )State[HAS_UNSAVED_CHANGES_KEY] : <font color="#0000ff">false</font> ; } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CURRENT_FILLUP_KEY = <font color="#A31515">"CurrentFillup"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> HAS_UNSAVED_CHANGES_KEY = <font color="#A31515">"HasUnsavedChanges"</font> ; <font color="#0000ff">private</font> Fillup currentFillup; <font color="#0000ff">private</font> <font color="#0000ff">bool</font> hasUnsavedChanges; <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedFrom(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedFrom(e); <font color="#0000ff">if</font> (cacheChanges) { CommitTextBoxes(); <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] = currentFillup; <font color="#0000ff">this</font> .State[HAS_UNSAVED_CHANGES_KEY] = hasUnsavedChanges; } } <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedTo(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedTo(e); CarHeader.DataContext = CarDataStore.Car; DataContext = currentFillup = State.ContainsKey(CURRENT_FILLUP_KEY) ? (Fillup) <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] : <font color="#0000ff">new</font> Fillup() { Date = <font color="#2B91AF">DateTime</font> .Now }; hasUnsavedChanges = State.ContainsKey(HAS_UNSAVED_CHANGES_KEY) ? ( <font color="#0000ff">bool</font> )State[HAS_UNSAVED_CHANGES_KEY] : <font color="#0000ff">false</font> ; } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CURRENT_FILLUP_KEY = <font color="#A31515">"CurrentFillup"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> HAS_UNSAVED_CHANGES_KEY = <font color="#A31515">"HasUnsavedChanges"</font> ; <font color="#0000ff">private</font> Fillup currentFillup; <font color="#0000ff">private</font> <font color="#0000ff">bool</font> hasUnsavedChanges; <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedFrom(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedFrom(e); <font color="#0000ff">if</font> (cacheChanges) { CommitTextBoxes(); <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] = currentFillup; <font color="#0000ff">this</font> .State[HAS_UNSAVED_CHANGES_KEY] = hasUnsavedChanges; } } <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedTo(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedTo(e); CarHeader.DataContext = CarDataStore.Car; DataContext = currentFillup = State.ContainsKey(CURRENT_FILLUP_KEY) ? (Fillup) <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] : <font color="#0000ff">new</font> Fillup() { Date = <font color="#2B91AF">DateTime</font> .Now }; hasUnsavedChanges = State.ContainsKey(HAS_UNSAVED_CHANGES_KEY) ? ( <font color="#0000ff">bool</font> )State[HAS_UNSAVED_CHANGES_KEY] : <font color="#0000ff">false</font> ; } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CURRENT_FILLUP_KEY = <font color="#A31515">"CurrentFillup"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> HAS_UNSAVED_CHANGES_KEY = <font color="#A31515">"HasUnsavedChanges"</font> ; <font color="#0000ff">private</font> Fillup currentFillup; <font color="#0000ff">private</font> <font color="#0000ff">bool</font> hasUnsavedChanges; <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedFrom(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedFrom(e); <font color="#0000ff">if</font> (cacheChanges) { CommitTextBoxes(); <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] = currentFillup; <font color="#0000ff">this</font> .State[HAS_UNSAVED_CHANGES_KEY] = hasUnsavedChanges; } } <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedTo(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedTo(e); CarHeader.DataContext = CarDataStore.Car; DataContext = currentFillup = State.ContainsKey(CURRENT_FILLUP_KEY) ? (Fillup) <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] : <font color="#0000ff">new</font> Fillup() { Date = <font color="#2B91AF">DateTime</font> .Now }; hasUnsavedChanges = State.ContainsKey(HAS_UNSAVED_CHANGES_KEY) ? ( <font color="#0000ff">bool</font> )State[HAS_UNSAVED_CHANGES_KEY] : <font color="#0000ff">false</font> ; } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CURRENT_FILLUP_KEY = <font color="#A31515">"CurrentFillup"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> HAS_UNSAVED_CHANGES_KEY = <font color="#A31515">"HasUnsavedChanges"</font> ; <font color="#0000ff">private</font> Fillup currentFillup; <font color="#0000ff">private</font> <font color="#0000ff">bool</font> hasUnsavedChanges; <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedFrom(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedFrom(e); <font color="#0000ff">if</font> (cacheChanges) { CommitTextBoxes(); <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] = currentFillup; <font color="#0000ff">this</font> .State[HAS_UNSAVED_CHANGES_KEY] = hasUnsavedChanges; } } <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedTo(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedTo(e); CarHeader.DataContext = CarDataStore.Car; DataContext = currentFillup = State.ContainsKey(CURRENT_FILLUP_KEY) ? (Fillup) <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] : <font color="#0000ff">new</font> Fillup() { Date = <font color="#2B91AF">DateTime</font> .Now }; hasUnsavedChanges = State.ContainsKey(HAS_UNSAVED_CHANGES_KEY) ? ( <font color="#0000ff">bool</font> )State[HAS_UNSAVED_CHANGES_KEY] : <font color="#0000ff">false</font> ; } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CURRENT_FILLUP_KEY = <font color="#A31515">"CurrentFillup"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> HAS_UNSAVED_CHANGES_KEY = <font color="#A31515">"HasUnsavedChanges"</font> ; <font color="#0000ff">private</font> Fillup currentFillup; <font color="#0000ff">private</font> <font color="#0000ff">bool</font> hasUnsavedChanges; <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedFrom(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedFrom(e); <font color="#0000ff">if</font> (cacheChanges) { CommitTextBoxes(); <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] = currentFillup; <font color="#0000ff">this</font> .State[HAS_UNSAVED_CHANGES_KEY] = hasUnsavedChanges; } } <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedTo(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedTo(e); CarHeader.DataContext = CarDataStore.Car; DataContext = currentFillup = State.ContainsKey(CURRENT_FILLUP_KEY) ? (Fillup) <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] : <font color="#0000ff">new</font> Fillup() { Date = <font color="#2B91AF">DateTime</font> .Now }; hasUnsavedChanges = State.ContainsKey(HAS_UNSAVED_CHANGES_KEY) ? ( <font color="#0000ff">bool</font> )State[HAS_UNSAVED_CHANGES_KEY] : <font color="#0000ff">false</font> ; } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CURRENT_FILLUP_KEY = <font color="#A31515">"CurrentFillup"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> HAS_UNSAVED_CHANGES_KEY = <font color="#A31515">"HasUnsavedChanges"</font> ; <font color="#0000ff">private</font> Fillup currentFillup; <font color="#0000ff">private</font> <font color="#0000ff">bool</font> hasUnsavedChanges; <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedFrom(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedFrom(e); <font color="#0000ff">if</font> (cacheChanges) { CommitTextBoxes(); <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] = currentFillup; <font color="#0000ff">this</font> .State[HAS_UNSAVED_CHANGES_KEY] = hasUnsavedChanges; } } <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedTo(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedTo(e); CarHeader.DataContext = CarDataStore.Car; DataContext = currentFillup = State.ContainsKey(CURRENT_FILLUP_KEY) ? (Fillup) <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] : <font color="#0000ff">new</font> Fillup() { Date = <font color="#2B91AF">DateTime</font> .Now }; hasUnsavedChanges = State.ContainsKey(HAS_UNSAVED_CHANGES_KEY) ? ( <font color="#0000ff">bool</font> )State[HAS_UNSAVED_CHANGES_KEY] : <font color="#0000ff">false</font> ; } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CURRENT_FILLUP_KEY = <font color="#A31515">"CurrentFillup"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> HAS_UNSAVED_CHANGES_KEY = <font color="#A31515">"HasUnsavedChanges"</font> ; <font color="#0000ff">private</font> Fillup currentFillup; <font color="#0000ff">private</font> <font color="#0000ff">bool</font> hasUnsavedChanges; <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedFrom(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedFrom(e); <font color="#0000ff">if</font> (cacheChanges) { CommitTextBoxes(); <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] = currentFillup; <font color="#0000ff">this</font> .State[HAS_UNSAVED_CHANGES_KEY] = hasUnsavedChanges; } } <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedTo(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedTo(e); CarHeader.DataContext = CarDataStore.Car; DataContext = currentFillup = State.ContainsKey(CURRENT_FILLUP_KEY) ? (Fillup) <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] : <font color="#0000ff">new</font> Fillup() { Date = <font color="#2B91AF">DateTime</font> .Now }; hasUnsavedChanges = State.ContainsKey(HAS_UNSAVED_CHANGES_KEY) ? ( <font color="#0000ff">bool</font> )State[HAS_UNSAVED_CHANGES_KEY] : <font color="#0000ff">false</font> ; } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CURRENT_FILLUP_KEY = <font color="#A31515">"CurrentFillup"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> HAS_UNSAVED_CHANGES_KEY = <font color="#A31515">"HasUnsavedChanges"</font> ; <font color="#0000ff">private</font> Fillup currentFillup; <font color="#0000ff">private</font> <font color="#0000ff">bool</font> hasUnsavedChanges; <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedFrom(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedFrom(e); <font color="#0000ff">if</font> (cacheChanges) { CommitTextBoxes(); <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] = currentFillup; <font color="#0000ff">this</font> .State[HAS_UNSAVED_CHANGES_KEY] = hasUnsavedChanges; } } <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedTo(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedTo(e); CarHeader.DataContext = CarDataStore.Car; DataContext = currentFillup = State.ContainsKey(CURRENT_FILLUP_KEY) ? (Fillup) <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] : <font color="#0000ff">new</font> Fillup() { Date = <font color="#2B91AF">DateTime</font> .Now }; hasUnsavedChanges = State.ContainsKey(HAS_UNSAVED_CHANGES_KEY) ? ( <font color="#0000ff">bool</font> )State[HAS_UNSAVED_CHANGES_KEY] : <font color="#0000ff">false</font> ; } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CURRENT_FILLUP_KEY = <font color="#A31515">"CurrentFillup"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> HAS_UNSAVED_CHANGES_KEY = <font color="#A31515">"HasUnsavedChanges"</font> ; <font color="#0000ff">private</font> Fillup currentFillup; <font color="#0000ff">private</font> <font color="#0000ff">bool</font> hasUnsavedChanges; <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedFrom(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedFrom(e); <font color="#0000ff">if</font> (cacheChanges) { CommitTextBoxes(); <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] = currentFillup; <font color="#0000ff">this</font> .State[HAS_UNSAVED_CHANGES_KEY] = hasUnsavedChanges; } } <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedTo(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedTo(e); CarHeader.DataContext = CarDataStore.Car; DataContext = currentFillup = State.ContainsKey(CURRENT_FILLUP_KEY) ? (Fillup) <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] : <font color="#0000ff">new</font> Fillup() { Date = <font color="#2B91AF">DateTime</font> .Now }; hasUnsavedChanges = State.ContainsKey(HAS_UNSAVED_CHANGES_KEY) ? ( <font color="#0000ff">bool</font> )State[HAS_UNSAVED_CHANGES_KEY] : <font color="#0000ff">false</font> ; } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CURRENT_FILLUP_KEY = <font color="#A31515">"CurrentFillup"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> HAS_UNSAVED_CHANGES_KEY = <font color="#A31515">"HasUnsavedChanges"</font> ; <font color="#0000ff">private</font> Fillup currentFillup; <font color="#0000ff">private</font> <font color="#0000ff">bool</font> hasUnsavedChanges; <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedFrom(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedFrom(e); <font color="#0000ff">if</font> (cacheChanges) { CommitTextBoxes(); <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] = currentFillup; <font color="#0000ff">this</font> .State[HAS_UNSAVED_CHANGES_KEY] = hasUnsavedChanges; } } <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedTo(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedTo(e); CarHeader.DataContext = CarDataStore.Car; DataContext = currentFillup = State.ContainsKey(CURRENT_FILLUP_KEY) ? (Fillup) <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] : <font color="#0000ff">new</font> Fillup() { Date = <font color="#2B91AF">DateTime</font> .Now }; hasUnsavedChanges = State.ContainsKey(HAS_UNSAVED_CHANGES_KEY) ? ( <font color="#0000ff">bool</font> )State[HAS_UNSAVED_CHANGES_KEY] : <font color="#0000ff">false</font> ; } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CURRENT_FILLUP_KEY = <font color="#A31515">"CurrentFillup"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> HAS_UNSAVED_CHANGES_KEY = <font color="#A31515">"HasUnsavedChanges"</font> ; <font color="#0000ff">private</font> Fillup currentFillup; <font color="#0000ff">private</font> <font color="#0000ff">bool</font> hasUnsavedChanges; <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedFrom(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedFrom(e); <font color="#0000ff">if</font> (cacheChanges) { CommitTextBoxes(); <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] = currentFillup; <font color="#0000ff">this</font> .State[HAS_UNSAVED_CHANGES_KEY] = hasUnsavedChanges; } } <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedTo(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedTo(e); CarHeader.DataContext = CarDataStore.Car; DataContext = currentFillup = State.ContainsKey(CURRENT_FILLUP_KEY) ? (Fillup) <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] : <font color="#0000ff">new</font> Fillup() { Date = <font color="#2B91AF">DateTime</font> .Now }; hasUnsavedChanges = State.ContainsKey(HAS_UNSAVED_CHANGES_KEY) ? ( <font color="#0000ff">bool</font> )State[HAS_UNSAVED_CHANGES_KEY] : <font color="#0000ff">false</font> ; } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CURRENT_FILLUP_KEY = <font color="#A31515">"CurrentFillup"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> HAS_UNSAVED_CHANGES_KEY = <font color="#A31515">"HasUnsavedChanges"</font> ; <font color="#0000ff">private</font> Fillup currentFillup; <font color="#0000ff">private</font> <font color="#0000ff">bool</font> hasUnsavedChanges; <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedFrom(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedFrom(e); <font color="#0000ff">if</font> (cacheChanges) { CommitTextBoxes(); <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] = currentFillup; <font color="#0000ff">this</font> .State[HAS_UNSAVED_CHANGES_KEY] = hasUnsavedChanges; } } <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedTo(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedTo(e); CarHeader.DataContext = CarDataStore.Car; DataContext = currentFillup = State.ContainsKey(CURRENT_FILLUP_KEY) ? (Fillup) <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] : <font color="#0000ff">new</font> Fillup() { Date = <font color="#2B91AF">DateTime</font> .Now }; hasUnsavedChanges = State.ContainsKey(HAS_UNSAVED_CHANGES_KEY) ? ( <font color="#0000ff">bool</font> )State[HAS_UNSAVED_CHANGES_KEY] : <font color="#0000ff">false</font> ; } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CURRENT_FILLUP_KEY = <font color="#A31515">"CurrentFillup"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> HAS_UNSAVED_CHANGES_KEY = <font color="#A31515">"HasUnsavedChanges"</font> ; <font color="#0000ff">private</font> Fillup currentFillup; <font color="#0000ff">private</font> <font color="#0000ff">bool</font> hasUnsavedChanges; <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedFrom(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedFrom(e); <font color="#0000ff">if</font> (cacheChanges) { CommitTextBoxes(); <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] = currentFillup; <font color="#0000ff">this</font> .State[HAS_UNSAVED_CHANGES_KEY] = hasUnsavedChanges; } } <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedTo(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedTo(e); CarHeader.DataContext = CarDataStore.Car; DataContext = currentFillup = State.ContainsKey(CURRENT_FILLUP_KEY) ? (Fillup) <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] : <font color="#0000ff">new</font> Fillup() { Date = <font color="#2B91AF">DateTime</font> .Now }; hasUnsavedChanges = State.ContainsKey(HAS_UNSAVED_CHANGES_KEY) ? ( <font color="#0000ff">bool</font> )State[HAS_UNSAVED_CHANGES_KEY] : <font color="#0000ff">false</font> ; } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CURRENT_FILLUP_KEY = <font color="#A31515">"CurrentFillup"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> HAS_UNSAVED_CHANGES_KEY = <font color="#A31515">"HasUnsavedChanges"</font> ; <font color="#0000ff">private</font> Fillup currentFillup; <font color="#0000ff">private</font> <font color="#0000ff">bool</font> hasUnsavedChanges; <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedFrom(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedFrom(e); <font color="#0000ff">if</font> (cacheChanges) { CommitTextBoxes(); <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] = currentFillup; <font color="#0000ff">this</font> .State[HAS_UNSAVED_CHANGES_KEY] = hasUnsavedChanges; } } <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedTo(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedTo(e); CarHeader.DataContext = CarDataStore.Car; DataContext = currentFillup = State.ContainsKey(CURRENT_FILLUP_KEY) ? (Fillup) <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] : <font color="#0000ff">new</font> Fillup() { Date = <font color="#2B91AF">DateTime</font> .Now }; hasUnsavedChanges = State.ContainsKey(HAS_UNSAVED_CHANGES_KEY) ? ( <font color="#0000ff">bool</font> )State[HAS_UNSAVED_CHANGES_KEY] : <font color="#0000ff">false</font> ; } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CURRENT_FILLUP_KEY = <font color="#A31515">"CurrentFillup"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> HAS_UNSAVED_CHANGES_KEY = <font color="#A31515">"HasUnsavedChanges"</font> ; <font color="#0000ff">private</font> Fillup currentFillup; <font color="#0000ff">private</font> <font color="#0000ff">bool</font> hasUnsavedChanges; <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedFrom(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedFrom(e); <font color="#0000ff">if</font> (cacheChanges) { CommitTextBoxes(); <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] = currentFillup; <font color="#0000ff">this</font> .State[HAS_UNSAVED_CHANGES_KEY] = hasUnsavedChanges; } } <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedTo(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedTo(e); CarHeader.DataContext = CarDataStore.Car; DataContext = currentFillup = State.ContainsKey(CURRENT_FILLUP_KEY) ? (Fillup) <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] : <font color="#0000ff">new</font> Fillup() { Date = <font color="#2B91AF">DateTime</font> .Now }; hasUnsavedChanges = State.ContainsKey(HAS_UNSAVED_CHANGES_KEY) ? ( <font color="#0000ff">bool</font> )State[HAS_UNSAVED_CHANGES_KEY] : <font color="#0000ff">false</font> ; } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CURRENT_FILLUP_KEY = <font color="#A31515">"CurrentFillup"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> HAS_UNSAVED_CHANGES_KEY = <font color="#A31515">"HasUnsavedChanges"</font> ; <font color="#0000ff">private</font> Fillup currentFillup; <font color="#0000ff">private</font> <font color="#0000ff">bool</font> hasUnsavedChanges; <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedFrom(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedFrom(e); <font color="#0000ff">if</font> (cacheChanges) { CommitTextBoxes(); <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] = currentFillup; <font color="#0000ff">this</font> .State[HAS_UNSAVED_CHANGES_KEY] = hasUnsavedChanges; } } <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedTo(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedTo(e); CarHeader.DataContext = CarDataStore.Car; DataContext = currentFillup = State.ContainsKey(CURRENT_FILLUP_KEY) ? (Fillup) <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] : <font color="#0000ff">new</font> Fillup() { Date = <font color="#2B91AF">DateTime</font> .Now }; hasUnsavedChanges = State.ContainsKey(HAS_UNSAVED_CHANGES_KEY) ? ( <font color="#0000ff">bool</font> )State[HAS_UNSAVED_CHANGES_KEY] : <font color="#0000ff">false</font> ; } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CURRENT_FILLUP_KEY = <font color="#A31515">"CurrentFillup"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> HAS_UNSAVED_CHANGES_KEY = <font color="#A31515">"HasUnsavedChanges"</font> ; <font color="#0000ff">private</font> Fillup currentFillup; <font color="#0000ff">private</font> <font color="#0000ff">bool</font> hasUnsavedChanges; <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedFrom(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedFrom(e); <font color="#0000ff">if</font> (cacheChanges) { CommitTextBoxes(); <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] = currentFillup; <font color="#0000ff">this</font> .State[HAS_UNSAVED_CHANGES_KEY] = hasUnsavedChanges; } } <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedTo(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedTo(e); CarHeader.DataContext = CarDataStore.Car; DataContext = currentFillup = State.ContainsKey(CURRENT_FILLUP_KEY) ? (Fillup) <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] : <font color="#0000ff">new</font> Fillup() { Date = <font color="#2B91AF">DateTime</font> .Now }; hasUnsavedChanges = State.ContainsKey(HAS_UNSAVED_CHANGES_KEY) ? ( <font color="#0000ff">bool</font> )State[HAS_UNSAVED_CHANGES_KEY] : <font color="#0000ff">false</font> ; } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CURRENT_FILLUP_KEY = <font color="#A31515">"CurrentFillup"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> HAS_UNSAVED_CHANGES_KEY = <font color="#A31515">"HasUnsavedChanges"</font> ; <font color="#0000ff">private</font> Fillup currentFillup; <font color="#0000ff">private</font> <font color="#0000ff">bool</font> hasUnsavedChanges; <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedFrom(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedFrom(e); <font color="#0000ff">if</font> (cacheChanges) { CommitTextBoxes(); <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] = currentFillup; <font color="#0000ff">this</font> .State[HAS_UNSAVED_CHANGES_KEY] = hasUnsavedChanges; } } <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedTo(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedTo(e); CarHeader.DataContext = CarDataStore.Car; DataContext = currentFillup = State.ContainsKey(CURRENT_FILLUP_KEY) ? (Fillup) <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] : <font color="#0000ff">new</font> Fillup() { Date = <font color="#2B91AF">DateTime</font> .Now }; hasUnsavedChanges = State.ContainsKey(HAS_UNSAVED_CHANGES_KEY) ? ( <font color="#0000ff">bool</font> )State[HAS_UNSAVED_CHANGES_KEY] : <font color="#0000ff">false</font> ; } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CURRENT_FILLUP_KEY = <font color="#A31515">"CurrentFillup"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> HAS_UNSAVED_CHANGES_KEY = <font color="#A31515">"HasUnsavedChanges"</font> ; <font color="#0000ff">private</font> Fillup currentFillup; <font color="#0000ff">private</font> <font color="#0000ff">bool</font> hasUnsavedChanges; <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedFrom(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedFrom(e); <font color="#0000ff">if</font> (cacheChanges) { CommitTextBoxes(); <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] = currentFillup; <font color="#0000ff">this</font> .State[HAS_UNSAVED_CHANGES_KEY] = hasUnsavedChanges; } } <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedTo(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedTo(e); CarHeader.DataContext = CarDataStore.Car; DataContext = currentFillup = State.ContainsKey(CURRENT_FILLUP_KEY) ? (Fillup) <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] : <font color="#0000ff">new</font> Fillup() { Date = <font color="#2B91AF">DateTime</font> .Now }; hasUnsavedChanges = State.ContainsKey(HAS_UNSAVED_CHANGES_KEY) ? ( <font color="#0000ff">bool</font> )State[HAS_UNSAVED_CHANGES_KEY] : <font color="#0000ff">false</font> ; } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CURRENT_FILLUP_KEY = <font color="#A31515">"CurrentFillup"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> HAS_UNSAVED_CHANGES_KEY = <font color="#A31515">"HasUnsavedChanges"</font> ; <font color="#0000ff">private</font> Fillup currentFillup; <font color="#0000ff">private</font> <font color="#0000ff">bool</font> hasUnsavedChanges; <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedFrom(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedFrom(e); <font color="#0000ff">if</font> (cacheChanges) { CommitTextBoxes(); <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] = currentFillup; <font color="#0000ff">this</font> .State[HAS_UNSAVED_CHANGES_KEY] = hasUnsavedChanges; } } <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedTo(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedTo(e); CarHeader.DataContext = CarDataStore.Car; DataContext = currentFillup = State.ContainsKey(CURRENT_FILLUP_KEY) ? (Fillup) <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] : <font color="#0000ff">new</font> Fillup() { Date = <font color="#2B91AF">DateTime</font> .Now }; hasUnsavedChanges = State.ContainsKey(HAS_UNSAVED_CHANGES_KEY) ? ( <font color="#0000ff">bool</font> )State[HAS_UNSAVED_CHANGES_KEY] : <font color="#0000ff">false</font> ; } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> </ol> <code><font color="gray"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CURRENT_FILLUP_KEY = <font color="#A31515">"CurrentFillup"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> HAS_UNSAVED_CHANGES_KEY = <font color="#A31515">"HasUnsavedChanges"</font> ; <font color="#0000ff">private</font> Fillup currentFillup; <font color="#0000ff">private</font> <font color="#0000ff">bool</font> hasUnsavedChanges; <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedFrom(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedFrom(e); <font color="#0000ff">if</font> (cacheChanges) { CommitTextBoxes(); <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] = currentFillup; <font color="#0000ff">this</font> .State[HAS_UNSAVED_CHANGES_KEY] = hasUnsavedChanges; } } <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnNavigatedTo(NavigationEventArgs e) { <font color="#0000ff">base</font> .OnNavigatedTo(e); CarHeader.DataContext = CarDataStore.Car; DataContext = currentFillup = State.ContainsKey(CURRENT_FILLUP_KEY) ? (Fillup) <font color="#0000ff">this</font> .State[CURRENT_FILLUP_KEY] : <font color="#0000ff">new</font> Fillup() { Date = <font color="#2B91AF">DateTime</font> .Now }; hasUnsavedChanges = State.ContainsKey(HAS_UNSAVED_CHANGES_KEY) ? ( <font color="#0000ff">bool</font> )State[HAS_UNSAVED_CHANGES_KEY] : <font color="#0000ff">false</font> ; }</font> * This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  In this code, the overloaded method OnNavigatedFrom first checks whether it should cache state data.  The <b>FillupPage</b> class initializes the <b>cacheChanges</b> field to <b>true</b> , but sets it to <b>false</b> whenever normal navigation occurs (that is, when the user clicks the Save or Back button).  Thus, the page caches data only when navigation occurs as a result of deactivation. <br><br>  If the changes have been cached, the OnNavigatedFrom method applies the values ‚Äã‚Äãof the text fields to the bound (bound) object (stored in the <b>currentFillup</b> field), and then stores the <b>currentFillup</b> and <b>hasUnsavedChanges values</b> in the State dictionary.  Applying (committing) text field values ‚Äã‚Äãis necessary because data bindings usually occur when the control loses focus, which does not happen automatically when the application is deactivated. <br><br>  The OnNavigatedTo method sets the <b>CarHeader</b> element to the DataContext property and then tries to retrieve the stored values ‚Äã‚Äãfrom the State dictionary.  If values ‚Äã‚Äãare present in the dictionary, they are used to set the page's DataContext property in addition to the <b>currentFillup</b> and <b>hasUnsavedChanges fields</b> .  Otherwise, default values ‚Äã‚Äãare used. <br><br>  This implementation provides basic tombstoning support, but does not store every aspect of page status.  In particular, this implementation does not store a value indicating which text field is in focus, nor does it store the cursor position and selection state of the text field in focus.  The importance of maintaining this state information depends on the application. <br><br>  <b>Tip:</b> <br>  When implementing tombstoning support, do not forget to test it thoroughly.  To do this, go to each page (using an emulator or an actual device), click the Start button, and then click the Back button.  Be sure to check each state of each page of your application and make sure that reactivation always restores the state as expected. <br><br>  If you are testing tombstoning support in an emulator in Visual Studio in debug mode, you will notice that the debugger sometimes interrupts the connection when you deactivate your application.  In this case, the application will seem to hang on the ‚Äúrecovering‚Äù page when you re-activate it.  You can solve this problem by simply going to Visual Studio and pressing F5 again.  The application will then be restarted and re-activated. <br><br><h4>  When to perform actions in the application </h4><br>  You can write code for each phase of the application life cycle.  We have described above how to respond to page navigation in order to load data and implement tombstoning support.  Below will be described the general life cycle of the application and the pages and the general types of code that can be written for each stage of the life cycle are indicated. <br><br>  The Windows Phone application starts when the user clicks on the icon or tile of the application, and closes when the user clicks the back button on the first page of the application.  External events (for example, when the ‚ÄúStart‚Äù button is pressed) can deactivate the application at any time, potentially causing it tombstoning and forcing it to close.  Reactivation restarts the application and gives it the ability to restore its previous state.  These stages of startup and shutdown in the life cycle are represented as Launching, Activated, Closing, and Deactivated events of the PhoneApplicationService class. <br><br>  As soon as the application is launched, the start page opens automatically, after which the user can switch to additional pages.  If the application is deactivated and reactivated, it moves to the previously active page. <br><br>  When an application first goes to a page or goes back to a page after deactivation and reactivation, an instance of the page is created, its constructor is called, and then the OnNavigatedTo method of this page is called, if they are present.  Shortly before moving to another page, exit or deactivation, the OnNavigatedFrom method is called.  Page instances are reused only if the user navigates back to previously visited pages and the application was not deactivated after this visit.  In this case, the application calls the OnNavigatedTo and OnNavigatedFrom methods, as before, but without calling the constructor before that. <br><br>  The following image shows the overall life cycle of the application and page. <br><br><img src="http://i.msdn.microsoft.com/dynimg/IC484160.png" alt="image"><br><br>  Typically, you will use Launching, Activated, Closing, and Deactivated events to initialize and maintain application state.  However, when these events occur, the phone is still in the process of loading or unloading the application, potentially causing significant delays.  To avoid increasing these delays, you should always avoid time-consuming operations in the handlers for these events. <br><br>  Usually, you will use the page's overloaded OnNavigatedTo and OnNavigatedFrom methods to initialize the page state and perform or run time-consuming operations, such as loading and saving data.  When the OnNavigatedTo method is called, the application and pages have already finished loading and are available for use.  When the OnNavigatedFrom method is called, the application and pages have not yet begun to be unloaded. <br><br>  <b>Certification Requirement:</b> <br>  Your application should render its first screen within 5 seconds after launch and start responding to user actions within 20 seconds. <br><br>  To meet the first requirement, you can display a splash screen.  To meet the second requirement, you can load data only when it is needed and run labor-intensive operations asynchronously, possibly using BackgroundWorker.  However, even if you use a background thread, you must run it in the OnNavigatedTo overloaded method, rather than in the Launching or Activated event handlers, to avoid an increase in the launch time. <br><br>  <b>Certification Requirement:</b> <br>  When the application is unloaded, it must also complete all operations within 10 seconds upon a request to close or deactivate, otherwise an exception will be thrown and the application will be terminated.  To meet this requirement, you should consider saving data as soon as they become available, or gradual saving if there are large amounts of data. <br><br>  <a href="http://habrahabr.ru/blogs/windows_mobile/118461/">Next part</a> </div><p>Source: <a href="https://habr.com/ru/post/118459/">https://habr.com/ru/post/118459/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../118452/index.html">"I repaired" Gateway MT6840</a></li>
<li><a href="../118454/index.html">Lost audio encoding. What is what?</a></li>
<li><a href="../118456/index.html">Do you use CRM in your web studio for project management?</a></li>
<li><a href="../118457/index.html">Visually about popular Open Source licenses</a></li>
<li><a href="../118458/index.html">NTRUEncrypt: the fastest asymmetric cipher</a></li>
<li><a href="../118460/index.html">How to raise server for python scripts in 1 minute</a></li>
<li><a href="../118461/index.html">Create an application for Windows Phone 7 from start to finish. Part 14. Validation of input data.</a></li>
<li><a href="../118462/index.html">Create an application for Windows Phone 7 from start to finish. Part 15. Access to photos on Windows Phone</a></li>
<li><a href="../118465/index.html">Presented by the official LiveJournal application for Android</a></li>
<li><a href="../118466/index.html">Bezamochnye algorithms: model "make, write, (try again)"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>