<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ASP .NET MVC 3. Ajax.ActionLink as an image on the example of adding to favorites with an asterisk on habrahabr.ru</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article is dedicated to creating a link with a picture using the Ajax.ActionLink helper method, or rather the Extension to the Ajax.ActionImageLi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ASP .NET MVC 3. Ajax.ActionLink as an image on the example of adding to favorites with an asterisk on habrahabr.ru</h1><div class="post__text post__text-html js-mediator-article">  This article is dedicated to creating a link with a picture using the Ajax.ActionLink helper method, or rather the Extension to the Ajax.ActionImageLink method, which we will create. <br><a name="habracut"></a><br>  First, a summary of Ajax, ASP .NET MVC 3, and their sharing. <br><br>  <a href="http://ru.wikipedia.org/wiki/AJAX">AJAX</a> (Asynchronous Javascript and XML - ‚Äúasynchronous JavaScript and XML‚Äù) is an approach to building interactive user interfaces for web applications, which consists in ‚Äúbackground‚Äù browser data exchange with a web server.  As a result, when updating data, the web page does not reload completely, and web applications become faster and more convenient. <br><br>  <a href="http://ru.wikipedia.org/wiki/ASP.NET_MVC_Framework">ASP .NET MVC</a> is a web application creation framework that implements a Model-view-controller ( <a href="http://ru.wikipedia.org/wiki/MVC">MVC</a> ) <a href="http://ru.wikipedia.org/wiki/MVC">pattern</a> based on <a href="http://ru.wikipedia.org/wiki/ASP.NET">ASP .NET</a> technology. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      There are <a href="http://msdn.microsoft.com/en-us/library/system.web.mvc.ajax.ajaxextensions.aspx">several Action methods</a> for using AJAX in ASP .NET MVC 3, but we are interested in <a href="http://msdn.microsoft.com/en-us/library/system.web.mvc.ajax.ajaxextensions.actionlink.aspx">Ajax.ActionLink</a> , so more about it: <br><br><h1>  Ajax.ActionLink </h1><br>  Ajax.ActionLink - a method that returns a link generated depending on the parameters passed, a click on which will send an asynchronous request to the server and determine the further behavior of the page. <br>  There are a total of 12 options for overloading this method ‚Äî the input parameters that can be passed to use it are discussed below: <br><ul><li>  <b>this AjaxHelper ajaxHelper</b> is a class that provides support for displaying HTML in AJAX scripts; </li><li>  <b>string linkText</b> - link text; </li><li>  <b>string actionName</b> - the name of the controller's Server Action method where the processing request will be received; </li><li>  <b>string controllerName</b> - the name of the controller where the request will be received in search of the Action method to process; </li><li>  <b>string protocol</b> - the protocol by which the request will be sent (for example, ‚Äúhttp‚Äù or ‚Äúhttps‚Äù); </li><li>  <b>string hostName</b> - domain name (for example, ‚Äúhabrahabr.ru‚Äù); </li><li>  <b>string fragment</b> - the name of the fragment, which will be added after # at the end of the URL; </li><li>  <b>RouteValueDictionary</b> / <b>object routeValues</b> - parameters passed to the server in the URL string; </li><li>  <b>AjaxOptions ajaxOptions</b> - options for performing an asynchronous request <br><ul><li>  <b>string Confirm</b> - a message that will appear before sending data to the server with a request to confirm user actions; </li><li>  <b>string HttpMethod</b> - the method by which to send data to the server (‚ÄúPOST‚Äù, ‚ÄúGET‚Äù); </li><li>  <b>InsertionMode InsertionMode</b> is a property that indicates how to update the DOM of the HTML page with the received data ("InsertAfter", "InsertBefore", or "Replace"); </li><li>  <b>string LoadingElementId</b> - id of the HTML element that is displayed while an asynchronous request is being executed (from OnBegin to OnComplete), for example, it could be ajaxLoader.gif; </li><li>  <b>string OnBegin</b> - the name of the javascript function that will be executed before sending the request; </li><li>  <b>string OnComplete</b> - the name of the javascript function that will be executed after the data has been received from the server, but the page has not yet been updated; </li><li>  <b>string OnFailure</b> is the name of the javascript function that will be executed in case of a page refresh error.  For example, you can intercept an error code that the server returns; </li><li>  <b>string OnSuccess</b> - the name of the javascript function that will be executed after successfully receiving data from the server and updating the page; </li><li>  <b>string UpdateTargetId</b> - id of the HTML element that will be updated by the received data from the server (for example, HTML markup or a string, update the div or display the message in a span); </li><li>  <b>string Url</b> - URL address to which to send the request; </li></ul></li><li>  <b>IDictionary &lt;string, Object&gt; htmlAttributes</b> is a key-value collection in which you can specify attributes to be added to the generated HTML markup (for example, new { <a href="http://habrahabr.ru/users/class/" class="user_link">class</a> = "add"}). </li></ul><br>  To use the Ajax features in the MVC 3 project, we need to include the following files, which, by default, are located in the / Scripts folder: <br><ul><li>  <b>jquery-1.4.4.js</b> </li><li>  <b>jquery.unobtrusive-ajax.min.js</b> </li></ul><br><br><h1>  Formulation of the problem </h1><br>  It is required to create a link in the form of an image (in our case, an asterisk), clicking on which will cause an asynchronous request to the server, and after receiving the answer, it will be updated (changing the image, the tooltip): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/800/da0/142/800da01428a09bdd772dcec311177c6f.png" alt="image"><br><br>  Considering the opportunities Microsoft provides us with the ActionLink ActionLink Ajax helper, we conclude that <s>without a bike,</s> they are not enough, so we need our own helper.  Let's get started <br><br><h2>  1. Create an empty ASP .NET MVC 3 project </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/e83/4c7/cfb/e834c7cfb6dfc3be0dd6885ebc71452c.jpg" alt="image"><br><br>  In the View engine specify Razor. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a06/fb4/8e9/a06fb48e95aae17e5dc8218ee1166c26.png" alt="image"><br><br><h2>  2. Add a HomeController and a view for the Index method </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/b7d/0ab/3ac/b7d0ab3acfdbd735f667f2684d5821ba.png" alt="image"><br><br>  Select ~ / Views / Shared / _Layout.cshtml as master page for our presentation <br><br><img src="https://habrastorage.org/getpro/habr/post_images/569/75e/ad7/56975ead7c72f77e5e38fb126c9e8511.jpg" alt="image"><br><br>  And so, now we need to create an Extension method for our Ajax helper. <br><br><h2>  3. Create the Extension method Ajax.ActionImageLink </h2><br>  Add a <b>core</b> folder to the project root and a new <b>static</b> class <b>Extensions.cs</b> in it <br><br><img src="https://habrastorage.org/getpro/habr/post_images/def/f28/af5/deff28af56ce82033d0a48f5fe010630.png" alt="image"><br><br>  Read more about creating extensible methods <a href="http://msdn.microsoft.com/en-us/library/bb383977.aspx">here</a> . <br><br>  We proceed directly to creating an expanding method.  And so, for the basis of our link with the image we take the HTML markup and styles of habrahabr.ru, then the contents of the container will be represented by two states: <br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"favourite"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"add"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"  "</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"favourite"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"remove"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"  "</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  Cutting off all unnecessary, we come to the fact that the container (the object to be changed is UpdateTargetId) will be a div, and our method will have to return HTML markup in the form of a link with a changing class and title. <br><br>  * <i>Then the author thought for the first time, and realized that all this is solved without expanding methods by means of the following code</i> : <br><pre> <code class="cs hljs">@Ajax.ActionLink(<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"Hello"</span></span>, <span class="hljs-string"><span class="hljs-string">"World"</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AjaxOptions() { }, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { @title= Model.inFavourite? <span class="hljs-string"><span class="hljs-string">"  "</span></span> : <span class="hljs-string"><span class="hljs-string">"  "</span></span>, @<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> = Model.inFavourite? <span class="hljs-string"><span class="hljs-string">"add"</span></span> : <span class="hljs-string"><span class="hljs-string">"remove"</span></span> })</code> </pre> <br>  <i>but deciding that it would be too easy, and having noticed a little, he complicated his task</i> . * <br><br>  <s>Cutting off all unnecessary ...</s> Adding too much, we come to the fact that the container (UpdateTargetId object to change) will be a div, and our method will have to return HTML markup in the form of a link containing the image with the changing title and path to the image. <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"favourite"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/Home/AddOrRemoveFavourite"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/Content/images/star-off.png"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"  "</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"favourite"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/Home/AddOrRemoveFavourite"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/Content/images/star-on.png"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"  "</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Note: <br>  You can use different methods to add / remove entries to your favorites, but in this article, one method will be used - <b>AddOrRemoveFavourite</b> . <br>  And so, the framework of our expanding method is presented below: <br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IHtmlString </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ImageActionLink</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> AjaxHelper helper, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> actionName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> inFavourite, AjaxOptions ajaxOptions</span></span></span><span class="hljs-function">)</span></span> { }</code> </pre><br>  Input parameters are: <br><ol><li>  <b>actionName</b> - the name of the controller method (AddOrRemoveFavourite); </li><li>  <b>inFavorite</b> - a sign of whether the entry has already been added to favorites; </li><li>  <b>ajaxOptions</b> - request execution parameters. </li></ol><br>  To create HTML markup for our image, use the <a href="http://msdn.microsoft.com/ru-ru/library/system.web.mvc.tagbuilder.aspx">TagBuilder</a> class: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> builder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TagBuilder(<span class="hljs-string"><span class="hljs-string">"img"</span></span>); builder.MergeAttribute(<span class="hljs-string"><span class="hljs-string">"src"</span></span>, String.Format(<span class="hljs-string"><span class="hljs-string">"/Content/images/star-{0}.png"</span></span>, inFavourite ? <span class="hljs-string"><span class="hljs-string">"on"</span></span> : <span class="hljs-string"><span class="hljs-string">"off"</span></span>)); builder.MergeAttribute(<span class="hljs-string"><span class="hljs-string">"title"</span></span>, inFavourite ? <span class="hljs-string"><span class="hljs-string">"  "</span></span> : <span class="hljs-string"><span class="hljs-string">"  "</span></span>);</code> </pre><br>  To create a link, use the standard Ajax.ActionLink method: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> link = helper.ActionLink(<span class="hljs-string"><span class="hljs-string">"[replaceme]"</span></span>, actionName, routeValues, ajaxOptions).ToHtmlString();</code> </pre><br>  and then add a link text replacement to the content of our HTML img element: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MvcHtmlString(link.Replace(<span class="hljs-string"><span class="hljs-string">"[replaceme]"</span></span>, builder.ToString(TagRenderMode.SelfClosing)));</code> </pre><br>  As a result, our Extensions.cs class will look like this: <br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Extensions</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IHtmlString </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ImageActionLink</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> AjaxHelper helper, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> actionName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> inFavourite, AjaxOptions ajaxOptions</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> builder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TagBuilder(<span class="hljs-string"><span class="hljs-string">"img"</span></span>); builder.MergeAttribute(<span class="hljs-string"><span class="hljs-string">"src"</span></span>, String.Format(<span class="hljs-string"><span class="hljs-string">"/Content/images/star-{0}.png"</span></span>, inFavourite ? <span class="hljs-string"><span class="hljs-string">"on"</span></span> : <span class="hljs-string"><span class="hljs-string">"off"</span></span>)); builder.MergeAttribute(<span class="hljs-string"><span class="hljs-string">"title"</span></span>, inFavourite ? <span class="hljs-string"><span class="hljs-string">"  "</span></span> : <span class="hljs-string"><span class="hljs-string">"  "</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> link = helper.ActionLink(<span class="hljs-string"><span class="hljs-string">"[replaceme]"</span></span>, actionName, inFavourite, ajaxOptions).ToHtmlString(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MvcHtmlString(link.Replace(<span class="hljs-string"><span class="hljs-string">"[replaceme]"</span></span>, builder.ToString(TagRenderMode.SelfClosing))); } }</code> </pre><br>  If you add a call to our extending method to the view (after specifying the <b>@using</b> directive <b>MVC3_AjaxActionImageLink.Core</b> ), the following HTML markup will be generated: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-ajax</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-ajax-mode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"replace"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-ajax-update</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#favourite"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/Home/AddOrRemoveFavourite"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/Content/images/star-on.png"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"  "</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  or <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-ajax</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-ajax-mode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"replace"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-ajax-update</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#favourite"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/Home/AddOrRemoveFavourite"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/Content/images/star-off.png"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"  "</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  It remains to add only a div, pictures of stars, a method call in the view, and the AddOrRemoveFavourite method itself, but I would like to dwell on the latter in more detail. <br><br><h2>  4. Adding the AddOrRemoveFavite method to the controller </h2><br>  In general, the method that handles an asynchronous request returns a value, be it a string, a number, JSON data, etc., but in our case, we will need to return the HTML markup of the new element that our extension method generates.  Alas (or fortunately) in ASP .NET MVC 3 there is no possibility to call our extending method on the server side (in the controller method) and therefore we will not be able to generate markup without duplicating the code itself in the controller method (otherwise, one of the fundamental principles of MVC- <a href="http://en.wikipedia.org/wiki/Don%27t_repeat_yourself">DRY</a> ). <br><br>  However, from the controller's method, we can return a call to Partial View, which initiates a call to our extending method, which in turn will return HTML markup. <br><br>  Let's get started <br><br><h3>  4.1.  Add a Partial View with a call to an expanding method. </h3><br>  Add the folder folder <b>Partial</b> in the <b>Views</b> folder.  In <b>Partial</b> add folder <b>Favorites</b> . <br>  Add the View to the <b>Favorites</b> folder by selecting <b>Create as partial view</b> and indicating the name <b>AddOrRemoveFavourites_PartialView</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/186/2e0/154/1862e0154f3c7a28458f2be6204a9b2e.png" alt="image"><br><br>  We add directives to the contents of the added Partial View: <br><pre> <code class="cs hljs">@<span class="hljs-keyword"><span class="hljs-keyword">using</span></span> MVC3_AjaxActionImageLink.Core @Model <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span></code> </pre><br>  and the call of our method itself: <br><pre> <code class="cs hljs">@Ajax.ImageActionLink(<span class="hljs-string"><span class="hljs-string">"AddOrRemoveFavourite"</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>)Model, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AjaxOptions() { UpdateTargetId = <span class="hljs-string"><span class="hljs-string">"favourite"</span></span> });</code> </pre><br>  Note.  To simplify the details, the model in this article will be a static variable of type bool. <br><br>  The contents of Index.cshtml now assigns the call to the expanding Partial View method and looks like this: <br><pre> <code class="cs hljs">@<span class="hljs-keyword"><span class="hljs-keyword">using</span></span> MVC3_AjaxActionImageLink.Core @model <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> @{ ViewBag.Title = <span class="hljs-string"><span class="hljs-string">"Index"</span></span>; Layout = <span class="hljs-string"><span class="hljs-string">"~/Views/Shared/_Layout.cshtml"</span></span>; } &lt;h2&gt;Index&lt;/h2&gt; &lt;div id=<span class="hljs-string"><span class="hljs-string">"favourite"</span></span>&gt; @{ Html.RenderPartial(<span class="hljs-string"><span class="hljs-string">"/Views/Partial/Favourites/AddOrRemoveFavourites_PartialView.cshtml"</span></span>, Model); } &lt;/div&gt;</code> </pre><br><br><h3>  4.2.  Add an asynchronous AddOrRemoveFavite request processing method to the controller and associate with the model </h3><br>  In order to return our Partial View, you need to specify in the return a call to the PartialView method, passing the path to the first parameter.  In addition, since we save the state in a primitive way through a static bool variable, we will transfer it as a model to both our View.  The final version of our <b>HomeController.cs</b> class is presented below: <br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">HomeController</span></span> : <span class="hljs-title"><span class="hljs-title">Controller</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> inFavourite = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddOrRemoveFavourite</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Request.IsAjaxRequest()) { inFavourite = !inFavourite; <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Add or remove favourite return PartialView("/Views/Partial/Favourites/AddOrRemoveFavourites_PartialView.cshtml", inFavourite); } return View(); } public ActionResult Index() { // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Check, if row is already in favourites return View(inFavourite); } }</span></span></code> </pre><br><br><h2>  5. What is left? </h2><br>  The final stage will be the addition of the images folder with star-off.png and star-on.png images, as well as the connection of the script for working with AJAX in ASP .NET MVC 3: <br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"../../Scripts/jquery.unobtrusive-ajax.min.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  We try. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/98c/cda/dc9/98ccdadc96d7a18c70559ad1827fdc23.jpg" alt="image"><br><br>  we click <br><br><img src="https://habrastorage.org/getpro/habr/post_images/432/427/407/432427407a339d47ac7c8209b4785b49.jpg" alt="image"><br><br><h1>  Conclusion </h1><br><img src="https://habrastorage.org/getpro/habr/post_images/19b/1e0/68b/19b1e068b0ddf47acd995ff8dca526c7.jpg" alt="image"><br><br>  So, what have we all done in this article and learned: <br><ul><li>  Considered the possibility of using AJAX in ASP .NET MVC 3 using the Ajax.ActionLink method </li><li>  Gained insight into creating your own extensible methods and using them </li><li>  Found out how to return generated HTML markup from an AJAX request by calling the Html helper </li><li>  Do not violate the principle of DRY </li></ul><br><br><h1>  Note </h1><br>  The name of the method and the principle of building the link as an image was taken from the project Stephen Walthe's <a href="http://www.asp.net/mvc/tutorials/contact-manager/iteration-7-add-ajax-functionality-cs">Contact manger project</a> </div><p>Source: <a href="https://habr.com/ru/post/134126/">https://habr.com/ru/post/134126/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../134121/index.html">GAMER.ru launches the second season of the MISS GAMER contest</a></li>
<li><a href="../134122/index.html">Sketch - 100 seconds about Adobe history</a></li>
<li><a href="../134123/index.html">The module for receiving screenshots from the video - nginx-video-thumbextractor-module</a></li>
<li><a href="../134124/index.html">DDoS attacks on online media: event chronicles</a></li>
<li><a href="../134125/index.html">Sleep and productive activities</a></li>
<li><a href="../134127/index.html">Siclum supports DrupalCafe (December 15)</a></li>
<li><a href="../134128/index.html">How to create a TK for a programmer</a></li>
<li><a href="../134131/index.html">Hard Startup! | Projects on Tin!</a></li>
<li><a href="../134132/index.html">Cretaceous period</a></li>
<li><a href="../134133/index.html">Why I want to go home: the manifesto of the father and the developer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>