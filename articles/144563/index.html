<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating regular expressions from mobile phone number ranges</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 

 I work a lot with VoIP networks. With commercial equipment, of course, too, but also a lot with OpenSource (the article is written in the co...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating regular expressions from mobile phone number ranges</h1><div class="post__text post__text-html js-mediator-article"> Hello! <br><br>  I work a lot with VoIP networks.  With commercial equipment, of course, too, but also a lot with OpenSource (the article is written in the context of using Asterisk PBX). <br><br>  In telephony, there is often a simple task, to divide routes into specific directions.  Well, for example, send calls to fixed numbers in the direction of operator 1, MG - in the direction of operator 2, MN - in the direction of operator 3. <br>  The task, in general, is trivial, and it is easy to implement on Asterisk: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <code>;  : 7  (     3-  7- ),    . <br> exten =&gt; _0X,1,dial(SIP/itsp1/${EXTEN}) <br> exten =&gt; _0XX,1,dial(SIP/itsp1/${EXTEN}) <br> exten =&gt; _XXXXXXX,1,dial(SIP/itsp1/${EXTEN}) <br> ;   :      (  - "8") + 10 . <br> exten =&gt; _8[348]XXXXXXXXX,1,dial(SIP/itsp2/${EXTEN}) <br> exten =&gt; _89XXXXXXXXX,1,dial(SIP/itsp2/${EXTEN}) <br> ; :      (  - "810") +     . <br> exten =&gt; _810X.,1,dial(SIP/itsp3/${EXTEN})</code> <br> <br>  However, sometimes it becomes necessary to provide the subscriber access only to the mobile phones in his area, and here the simple "_89XXXXXXXXX" will not work. <br><a name="habracut"></a><br><h4>  Formulation of the problem </h4><br>  The fact is that the telephone codes of mobile operators are non-geographical (so-called DEF-codes), which means that there is no code linking to a specific region.  Because of this, in the code "900", for example, there are ranges belonging to operators from the Vologda region, the Pskov, Chechen Republic, and so on. <br>  A mobile operator can theoretically afford to select any free range in any region, and this leads to the fact that in different regions there are telephone numbers from different ranges with different numbers of numbers.  For example, in the Vologda Oblast, 46 different ranges are allocated, in the Moscow Oblast - 398. <br><br>  If all the ranges were ‚Äúbeautiful‚Äù, with 1000 or 10000 numbers, like this: 5100000 - 5109999 (10,000 numbers in the 914 code), then everything would be more or less good. <br>  But often large ranges of 10,000 numbers are ‚Äúcut‚Äù into subranges from numbers that are not multiple to their order (the order of the number of numbers in a range).  Offhand: <br><table><tbody><tr><td>  Code </td><td>  From </td><td>  Before </td><td>  Capacity </td><td>  Region </td></tr><tr><td>  958 </td><td>  2997500 </td><td>  2998749 </td><td>  1250 </td><td>  Republic of Adygea </td></tr><tr><td>  958 </td><td>  2998750 </td><td>  2999999 </td><td>  1250 </td><td>  Udmurtia </td></tr></tbody></table><br>  Or even one number (I will not give). <br>  Such a range (2997500 - 2998749) cannot be described by one regular Asterisk expression, as a result you will get 3 routes: <br> <code>exten =&gt; _89582997[5-9]XX,1,dial(SIP/itsp1/${EXTEN}) <br> exten =&gt; _89582998[0-6]XX,1,dial(SIP/itsp1/${EXTEN}) <br> exten =&gt; _895829987[0-4]X,1,dial(SIP/itsp1/${EXTEN})</code> <br> <br>  And this is one particular range.  If you take a whole region, the number of regular expressions increases dramatically.  In addition, over time DEF codes tend to change.  Some disappear, others appear.  If you do not take this into account, this may lead to the fact that your subscribers, at best, will not be able to call certain ranges of your region. <br><br>  So, the task is formulated: <b>It is necessary to create regular expressions from any number of any ranges that your telephone exchange recognizes.</b> <br><br>  In all sources (MTT, the Ministry of Communications of the Russian Federation) precisely the ranges appear, and not regular expressions.  Since the work on creating routes is boring and routine, and I have to work with different regions of the Russian Federation, I decided to automate it.  Oddly enough, I did not find any ready-made tools for this. <br>  Therefore, I made the tool myself, and at the same time I share it with everyone.  A kind of regular expression service :). <br><br><h4>  Decision </h4><br>  Take an arbitrary range (2633722 - 2673388).  A person can easily create regular expressions on its basis.  As a result, they will turn out like this: <br><table><tbody><tr><td>  Subrange </td><td>  Regular expression </td></tr><tr><td>  2633722-2633729 </td><td>  _263372 [2-9] </td></tr><tr><td>  2633730-2633799 </td><td>  _26337 [3-9] X </td></tr><tr><td>  2633800-2633999 </td><td>  _2633 [8-9] XX </td></tr><tr><td>  2634000-2639999 </td><td>  _263 [4-9] XXX </td></tr><tr><td>  2640000-2669999 </td><td>  _26 [4-6] XXXX </td></tr><tr><td>  2670000-2672999 </td><td>  _267 [0-2] XXX </td></tr><tr><td>  2673000-2673299 </td><td>  _2673 [0-2] XX </td></tr><tr><td>  2673300-2673379 </td><td>  _26733 [0-7] X </td></tr><tr><td>  2673380-2673388 </td><td>  _267338 [0-8] </td></tr></tbody></table><br>  Consider how to do this automatically. <br><br><h5>  Algorithm </h5><br><ol><li>  Get a list of ranges and regions. <br>  I take the ranges in a convenient tabular form from the <a href="http://www.rossvyaz.ru/activity/num_resurs/registerNum/">FAS</a> website.  The registry is updated 2 times a month, even if there were no changes in it. </li><li>  Get a list of ranges of a particular region (the region is entered by the user). <br>  The result of the work should be a list of regular expressions for a specific region. </li><li>  Split the first range into subranges, ready to create a regular expression. <br>  The most difficult part. <br>  I made a doubly linked list that initially contains 2 elements (minimum and maximum), and with each step before the last element 2 numbers are added: the first number, which together with the minimum can become a new range (if you take the example above, then in the first step it is 2633729 , on the second - 2633799, etc.), and the second number is one more.  In each step, the penultimate and last elements of the list are considered, and 2 new elements are inserted between them.  It was quite possible to manage with a two-dimensional array, but I initially thought that it would be more difficult for me to fill it than a list. <br>  As a result, the list is a set of pairs of numbers, each of which is capable of creating a regular expression of the form "26337 [3-9] X". </li><li>  Make a regular expression out of each subrange. <br>  This is a matter of technology. </li><li>  Repeat steps 3 and 4 with each range of the initial list. </li></ol><br><h5>  Implementation and Opportunities </h5><br>  I wrote in php.  As a result, the script can: <br><ul><li>  Download the registry of numbers from the FAS website and convert it to csv in UTF-8 encoding </li><li>  Give the user a list of regular expressions that are ready for work in terms of the Asterisk set for the selected region </li><li>  As a bonus, it accepts any range of natural numbers as input and returns a list of regular expressions. </li></ul><br>  Screenshot: <br><img src="https://habrastorage.org/getpro/habr/post_images/cb5/e2d/b1b/cb5e2db1b99363ad14ce8e3cdb690be8.png" alt="image"><br><br>  There were many subtleties in writing, and they are hardly worth listing here. <br>  Source code is available <a href="">here</a> .  There are many things that can be improved (while in the plans there are summation of ranges before the 3rd paragraph of the algorithm and adding regular expressions of other formats, as well as full-fledged work from the CLI to automate regular updating of routes on existing Asterisk servers), so please write me all your wishes .  I will also be happy to hear recommendations in terms of web interface and security.  I'm not a programmer, so the quality of the code can suffer. <br><br><h4>  Links </h4><br><ul><li>  Script in action: <a href="http://rootblog.ru/regex/">http://rootblog.ru/regex/</a> <br>  All the names of the regions are taken from the registry on the FAS website and have not been changed. </li><li>  FAS registry: <a href="http://www.rossvyaz.ru/activity/num_resurs/registerNum/">www.rossvyaz.ru/activity/num_resurs/registerNum</a> </li><li>  For comparison, the ranges on the MTT website: <a href="http://www.mtt.ru/mtt/def">http://www.mtt.ru/mtt/def</a> </li><li>  Phone plan numbering Russia in <a href="http://ru.wikipedia.org/wiki/%25D0%25A2%25D0%25B5%25D0%25BB%25D0%25B5%25D1%2584%25D0%25BE%25D0%25BD%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BF%25D0%25BB%25D0%25B0%25D0%25BD_%25D0%25BD%25D1%2583%25D0%25BC%25D0%25B5%25D1%2580%25D0%25B0%25D1%2586%25D0%25B8%25D0%25B8_%25D0%25A0%25D0%25BE%25D1%2581%25D1%2581%25D0%25B8%25D0%25B8">Wikipedia</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/144563/">https://habr.com/ru/post/144563/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../144550/index.html">Home Agent: news, realities and prospects</a></li>
<li><a href="../144552/index.html">Tyumen equipped with free Wi-Fi-connections</a></li>
<li><a href="../144554/index.html">Programming philosophy. Some principles of learning</a></li>
<li><a href="../144555/index.html">Why do sites die</a></li>
<li><a href="../144561/index.html">Unbound jailbreak for iOS 5.1.1 Absinthe 2.0.4 released</a></li>
<li><a href="../144565/index.html">Stream encryption at 10 Gbit / s? Yes. Parallel</a></li>
<li><a href="../144566/index.html">Logging - a library for easy logging in Python</a></li>
<li><a href="../144567/index.html">About deleting quoted lines from JavaScript text</a></li>
<li><a href="../144568/index.html">Data Warehouse Metrics</a></li>
<li><a href="../144569/index.html">Dragon SpaceX successfully reached the ISS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>