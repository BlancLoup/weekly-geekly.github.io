<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>In-line editing tabular data in ASP.Net MVC 3</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I present to your attention one more implementation of AjaxGrid on ASP.Net MVC 3. 
 The article describes how to create a tabular form with inline edi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>In-line editing tabular data in ASP.Net MVC 3</h1><div class="post__text post__text-html js-mediator-article"> I present to your attention one more implementation of AjaxGrid on ASP.Net MVC 3. <br>  The article describes how to create a tabular form with inline editing, ajax sorting and ajax pager. <br><a name="habracut"></a><br>  This implementation is a compilation of several available components. <br>  As is usually the case, I needed to display the table data with the possibility of editing it for work purposes.  Approximately as in the screenshot: <br><br><img src="http://slrz.ru/1.png" alt="Desired result"><br><br>  Before we start installing AjaxGridScaffolder <br> <code>PM&gt; Install-Package AjaxGridScaffolder <br></code> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <br><h4>  Create a data layer </h4><br><br>  Essence <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HabrahabrMVC.Domain.Entities</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RealtyObject</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> City { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Street { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> House { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> Cost { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Visible { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } }</code> </pre><br>  Interface. <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HabrahabrMVC.Domain.Abstract</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IRepository</span></span> { <span class="hljs-function"><span class="hljs-function">IQueryable&lt;RealtyObject&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetAll</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">RealtyObject objectToSave</span></span></span><span class="hljs-function">)</span></span>; } }</code> </pre><br>  Context. <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HabrahabrMVC.Domain.Concrete</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EFContext</span></span> : <span class="hljs-title"><span class="hljs-title">DbContext</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DbSet&lt;RealtyObject&gt; RealtyObjects { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnModelCreating</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DbModelBuilder modelBuilder</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.OnModelCreating(modelBuilder); } } }</code> </pre> <br>  Interface implementation. <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HabrahabrMVC.Domain.Concrete</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EFRepository</span></span> :<span class="hljs-title"><span class="hljs-title">IRepository</span></span> { EFContext _db = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EFContext(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Entities.RealtyObject objectToSave</span></span></span><span class="hljs-function">)</span></span> { _db.Entry(_db.RealtyObjects.SingleOrDefault(z=&gt;z.Id==objectToSave.Id)).CurrentValues.SetValues(objectToSave); _db.Entry&lt;RealtyObject&gt;(_db.RealtyObjects.SingleOrDefault(z =&gt; z.Id == objectToSave.Id)).State = System.Data.EntityState.Modified; _db.SaveChanges(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IQueryable&lt;RealtyObject&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetAll</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _db.RealtyObjects.AsQueryable(); } } }</code> </pre><br><h4>  Create a controller </h4><br>  ObjectsView: <br><img src="http://slrz.ru/2.png" alt="Creating a controller"><br>  1) To do this, right-click in the Object Explorer'e (Object Explorer) on the Controllers folder, select Add-&gt; Controller ... (Add-&gt; Controller ...). <br>  2) We write the name ObjectsViewController. <br>  3) Template - Ajax Grid Controller <br>  4) Model class - RealtyObject (HabraHabrMVC3.Domain.Entities) <br>  5) Data context class - EFContext (HabraHabrMVC3.Domain.Concrete) <br>  6) Add. <br><br>  After the wizard has generated the code, we add a constructor to the controller, so that Ninject correctly injects our data layer. <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//private EFContext db = new EFContext(); private IRepository db; public ObjectsViewController(IRepository dbparam) { db = dbparam; }</span></span></code> </pre><br><br>  Now it is necessary to change the data sources in the generated code: <br>  db.RealtyObjects on db.GetAll () <br>  db.RealtyObjects.Find (id) on db.GetAll (). SingleOrDefault (z =&gt; z.Id == id) <br><br>  Now I don‚Äôt need actions to create, edit and delete data, I‚Äôll delete them. <br>  Also in the view GridData.cshtml deleted the edit and delete buttons. <br><br>  Now the line does not work: <br><pre> <code class="cs hljs">ObjectQuery&lt;RealtyObject&gt; realtyobjects = (db <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> IObjectContextAdapter).ObjectContext.CreateObjectSet&lt;RealtyObject&gt;();</code> </pre><br>  because  db does not support IObjectContextAdapter. <br>  Therefore, we add the Linq extension method. <br><br>  I created a separate static class OrderByHelper. <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HabraHabrMVC3.Infrastructure</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">OrderByHelper</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> IEnumerable&lt;T&gt; OrderBy&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> IEnumerable&lt;T&gt; enumerable, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> orderBy) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> enumerable.AsQueryable().OrderBy(orderBy).AsEnumerable(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> IQueryable&lt;T&gt; OrderBy&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> IQueryable&lt;T&gt; collection, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> orderBy) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-function"><span class="hljs-function">OrderByInfo orderByInfo </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">in</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ParseOrderBy</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">orderBy</span></span></span><span class="hljs-function">)) collection</span></span> = ApplyOrderBy&lt;T&gt;(collection, orderByInfo); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> collection; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> IQueryable&lt;T&gt; ApplyOrderBy&lt;T&gt;(IQueryable&lt;T&gt; collection, OrderByInfo orderByInfo) { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] props = orderByInfo.PropertyName.Split(<span class="hljs-string"><span class="hljs-string">'.'</span></span>); Type type = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(T); ParameterExpression arg = Expression.Parameter(type, <span class="hljs-string"><span class="hljs-string">"x"</span></span>); Expression expr = arg; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> prop <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> props) { <span class="hljs-comment"><span class="hljs-comment">// use reflection (not ComponentModel) to mirror LINQ PropertyInfo pi = type.GetProperty(prop); expr = Expression.Property(expr, pi); type = pi.PropertyType; } Type delegateType = typeof(Func&lt;,&gt;).MakeGenericType(typeof(T), type); LambdaExpression lambda = Expression.Lambda(delegateType, expr, arg); string methodName = String.Empty; if (!orderByInfo.Initial &amp;&amp; collection is IOrderedQueryable&lt;T&gt;) { if (orderByInfo.Direction == SortDirection.Ascending) methodName = "ThenBy"; else methodName = "ThenByDescending"; } else { if (orderByInfo.Direction == SortDirection.Ascending) methodName = "OrderBy"; else methodName = "OrderByDescending"; } //</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> apply caching to the generic methodsinfos? return (IOrderedQueryable&lt;T&gt;)typeof(Queryable).GetMethods().Single( method =&gt; method.Name == methodName &amp;&amp; method.IsGenericMethodDefinition &amp;&amp; method.GetGenericArguments().Length == 2 &amp;&amp; method.GetParameters().Length == 2) .MakeGenericMethod(typeof(T), type) .Invoke(null, new object[] { collection, lambda }); } private static IEnumerable&lt;OrderByInfo&gt; ParseOrderBy(string orderBy) { if (String.IsNullOrEmpty(orderBy)) yield break; string[] items = orderBy.Split(','); bool initial = true; foreach (string item in items) { string[] pair = item.Trim().Split(' '); if (pair.Length &gt; 2) throw new ArgumentException(String.Format("Invalid OrderBy string '{0}'. Order By Format: Property, Property2 ASC, Property2 DESC", item)); string prop = pair[0].Trim(); if (String.IsNullOrEmpty(prop)) throw new ArgumentException("Invalid Property. Order By Format: Property, Property2 ASC, Property2 DESC"); SortDirection dir = SortDirection.Ascending; if (pair.Length == 2) dir = ("desc".Equals(pair[1].Trim(), StringComparison.OrdinalIgnoreCase) ? SortDirection.Descending : SortDirection.Ascending); yield return new OrderByInfo() { PropertyName = prop, Direction = dir, Initial = initial }; initial = false; } } private class OrderByInfo { public string PropertyName { get; set; } public SortDirection Direction { get; set; } public bool Initial { get; set; } } private enum SortDirection { Ascending = 0, Descending = 1 } } }</span></span></code> </pre><br><br>  And then a new kind of action GridData: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GridData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> start = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> itemsPerPage = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">20</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> orderBy = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"Id"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> desc = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">false</span></span></span></span></span><span class="hljs-function">)</span></span> { Response.AppendHeader(<span class="hljs-string"><span class="hljs-string">"X-Total-Row-Count"</span></span>, db.GetAll().Count().ToString()); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> realtyobjects = db.GetAll().OrderBy(orderBy + (desc ? <span class="hljs-string"><span class="hljs-string">" desc"</span></span> : <span class="hljs-string"><span class="hljs-string">""</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> PartialView(realtyobjects.Skip(start).Take(itemsPerPage)); }</code> </pre><br><br>  Now we have a great Ajax table with sorting and paging. <br><br><h4>  Adding inline editing </h4><br><br>  Add another extension method, only for the HTML helper: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">System.Web</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">HtmlPrefixScopeExtensions</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> idsToReuseKey = <span class="hljs-string"><span class="hljs-string">"__htmlPrefixScopeExtensions_IdsToReuse_"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IDisposable </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BeginCollectionItem</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HtmlHelper html, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> collectionName</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> idsToReuse = GetIdsToReuse(html.ViewContext.HttpContext, collectionName); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> itemIndex = idsToReuse.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ? idsToReuse.Dequeue() : Guid.NewGuid().ToString(); <span class="hljs-comment"><span class="hljs-comment">// autocomplete="off" is needed to work around a very annoying Chrome behaviour whereby it reuses old values after the user clicks "Back", which causes the xyz.index and xyz[...] values to get out of sync. html.ViewContext.Writer.WriteLine(string.Format("&lt;input type=\"hidden\" name=\"{0}.index\" autocomplete=\"off\" value=\"{1}\" /&gt;", collectionName, html.Encode(itemIndex))); return BeginHtmlFieldPrefixScope(html, string.Format("{0}[{1}]", collectionName, itemIndex)); } public static IDisposable BeginHtmlFieldPrefixScope(this HtmlHelper html, string htmlFieldPrefix) { return new HtmlFieldPrefixScope(html.ViewData.TemplateInfo, htmlFieldPrefix); } private static Queue&lt;string&gt; GetIdsToReuse(HttpContextBase httpContext, string collectionName) { // We need to use the same sequence of IDs following a server-side validation failure, // otherwise the framework won't render the validation error messages next to each item. string key = idsToReuseKey + collectionName; var queue = (Queue&lt;string&gt;)httpContext.Items[key]; if (queue == null) { httpContext.Items[key] = queue = new Queue&lt;string&gt;(); var previouslyUsedIds = httpContext.Request[collectionName + ".index"]; if (!string.IsNullOrEmpty(previouslyUsedIds)) foreach (string previouslyUsedId in previouslyUsedIds.Split(',')) queue.Enqueue(previouslyUsedId); } return queue; } private class HtmlFieldPrefixScope : IDisposable { private readonly TemplateInfo templateInfo; private readonly string previousHtmlFieldPrefix; public HtmlFieldPrefixScope(TemplateInfo templateInfo, string htmlFieldPrefix) { this.templateInfo = templateInfo; previousHtmlFieldPrefix = templateInfo.HtmlFieldPrefix; templateInfo.HtmlFieldPrefix = htmlFieldPrefix; } public void Dispose() { templateInfo.HtmlFieldPrefix = previousHtmlFieldPrefix; } } } }</span></span></code> </pre><br><br>  Replace view GridData with <br><pre> <code class="cs hljs">@model IEnumerable&lt;HabraHabrMVC3.Domain.Entities.RealtyObject&gt; @<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Model.Count() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Model) { &lt;text&gt;@Html.Partial(<span class="hljs-string"><span class="hljs-string">"Edit"</span></span>, item)&lt;/text&gt; } }</code> </pre><br><br>  And view Edit at: <br><pre> <code class="cs hljs">@model HabraHabrMVC3.Domain.Entities.RealtyObject @<span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (Html.BeginCollectionItem(<span class="hljs-string"><span class="hljs-string">"objects"</span></span>)) { &lt;tr&gt; &lt;td&gt; @Html.EditorFor(model =&gt; model.City) @Html.ValidationMessageFor(model =&gt; model.City) &lt;/td&gt; &lt;td&gt; @Html.EditorFor(model =&gt; model.Street) @Html.ValidationMessageFor(model =&gt; model.Street) &lt;/td&gt; &lt;td&gt; @Html.EditorFor(model =&gt; model.House) @Html.ValidationMessageFor(model =&gt; model.House) &lt;/td&gt; &lt;td&gt; @Html.EditorFor(model =&gt; model.Cost) @Html.ValidationMessageFor(model =&gt; model.Cost) &lt;/td&gt; &lt;td&gt; @Html.EditorFor(model =&gt; model.Visible) @Html.ValidationMessageFor(model =&gt; model.Visible) &lt;/td&gt; &lt;/tr&gt; }</code> </pre><br><br>  In the view index add: <br><pre> <code class="cs hljs">@<span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (Html.BeginForm(<span class="hljs-string"><span class="hljs-string">"Save"</span></span>, <span class="hljs-string"><span class="hljs-string">"ObjectsView"</span></span>, FormMethod.Post)) { &lt;table id=<span class="hljs-string"><span class="hljs-string">"AjaxGrid"</span></span>&gt; ...code... &lt;/table&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"submit"</span></span> id=<span class="hljs-string"><span class="hljs-string">"save"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>=<span class="hljs-string"><span class="hljs-string">""</span></span> /&gt; }</code> </pre><br><br>  Add action Save: <br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">HttpPost</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ICollection&lt;RealtyObject&gt; objects</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> objects) { db.Save(item); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> RedirectToAction(<span class="hljs-string"><span class="hljs-string">"Index"</span></span>); }</code> </pre><br>  Here it is important that the collection name in @using (Html.BeginCollectionItem (" <b>objects</b> ")) matches the name of the parameter in the action Save method (ICollection <b>objects</b> ). <br><br>  Everything, it turned out a tabular form with inline editing, ajax sorting and ajax pager. <br><br>  The list of used literature on the Internet: <br><br>  1) <a href="http://haacked.com/archive/2011/08/17/new-ajax-grid-scaffolding-nuget-package-for-mvc-3.aspx">Ajax Grid Scaffolder</a> <br><br>  2) <a href="http://blog.stevensanderson.com/2010/01/28/editing-a-variable-length-list-aspnet-mvc-2-style/">Editing a variable length list, ASP.NET MVC 2-style</a> <br><br>  3) <a href="http://aonnull.blogspot.com/2010/08/dynamic-sql-like-linq-orderby-extension.html">Dynamic SQL-like Linq OrderBy Extension</a> <br><br>  <a href="">Download the result.</a> </div><p>Source: <a href="https://habr.com/ru/post/138580/">https://habr.com/ru/post/138580/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../138573/index.html">Router-on-a-Stick Data Network Architecture</a></li>
<li><a href="../138574/index.html">.NET-chiki, we meet on February 25 at the Siclum .NET Subbotnik in Dnepropetrovsk!</a></li>
<li><a href="../138575/index.html">Online Notepad note-pad.net</a></li>
<li><a href="../138576/index.html">Release stable version of Apache 2.4</a></li>
<li><a href="../138577/index.html">Why we created Julia, the new YAP for technical computing</a></li>
<li><a href="../138582/index.html">Creating Gems - Guide</a></li>
<li><a href="../138585/index.html">Once again about Bridge (in pictures)</a></li>
<li><a href="../138586/index.html">Here be dragons</a></li>
<li><a href="../138587/index.html">I like vs like</a></li>
<li><a href="../138590/index.html">How to rollback commits on github.com</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>