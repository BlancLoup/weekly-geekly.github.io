<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Wireless adapter for programming Arduino or AVR with a bootloader based on ESP8266</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A small note about the self-made adapter based on the ESP8266, which allows you to load the firmware into the microcontroller with the UART bootloader...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Wireless adapter for programming Arduino or AVR with a bootloader based on ESP8266</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/files/53f/693/97a/53f69397accb4fb2abd26521d594ca7c.jpg">  A small note about the self-made adapter based on the ESP8266, which allows you to load the firmware into the microcontroller with the UART bootloader or Arduino installed. <br>  Recently, when designing devices on AVR microcontrollers, for programming I only output one 6-pin connector (not ISP) for an FTDI adapter.  It allows you to download the firmware and debug on the UART after the firmware.  This is exactly what was done in Arduino, the idea was borrowed from there.  It's comfortable. <br>  Meanwhile, not once had to deal with the situation when you need to load the firmware into the microcontroller, but it is already in a case that does not fit in the workplace / lies on the mezzanine / in another city / walled in the wall.  In such cases, the FTDI adapter is not applicable because of the short USB lanyard and you had to dodge with a laptop.  I thought about the wireless programmer.  Here, the ESP8266 fits the best, because it has a UART and, in any version, has at least one GPIO, suitable for rebooting the controller and entering the programming mode. <br><a name="habracut"></a><br>  The following topic material was found on the net: <br><ol><li>  <a href="https://garyservin.wordpress.com/2014/12/16/programming-an-arduino-via-wifi-with-the-esp8266/">Programming an Arduino via WiFi with the ESP8266</a> - the ESP-01 type module is connected on wiring to the Arduino pro mini, then the python script is used to download the firmware </li><li>  <a href="https://www.sistemasorp.es/2014/11/11/programando-un-arduino-remotamente-con-el-modulo-esp8266/">Programando un Arduino remotamente con el m√≥dulo ESP8266</a> - here, as I understood it, without going into details, one of the Arduino GPIO is connected to RESET.  First, the microcontroller is given the command to reload itself, and then the firmware download begins </li><li>  <a href="https://github.com/beckdac/ESP8266-transparent-bridge">ESP8266-transparent-bridge</a> - firmware for ESP8266 that makes transparent Wi-Fi from the module - a UART bridge with AT support for controlling GPIO2.  The author suggests to press the reset button on the Arduino, and then launch avrdude with the parameters -c avrisp and -P net: xxxx: 23, but this allows you to automate AT.  I took this firmware as the basis </li></ol><br><br>  Adapter specifications are as follows: <br><ul><li>  Six-pin connector with pinout like an FTDI adapter <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/geektimes/post_images/a6b/e2f/4a5/a6be2f4a568938125da6ed813cbb45a9.jpg" alt="image"><br></div></div></li><li>  Work in circuits with a microcontroller supply voltage of 3.3V or 5V, selected by jumpers </li><li>  Stable operation at speeds up to 57600 inclusive </li><li>  Reboot the microcontroller using AT commands to enter programming mode </li></ul><br>  The performance was tested on the Chinese Arduino pro mini with a stock loader and on ATmega8 with <a href="https://github.com/Optiboot/optiboot">optiboot</a> installed and speeds of 9600, 19200 and 57600. At the default speed (115200), the controller refused to flash. <br><br><h5>  For those who do not want to solder and pay </h5>  In the case of application in 3.3V-powered circuits, simply connecting the esp-01 module to the Arduino wiring (VCC -&gt; VCC, GND ---&gt; GND, RX ---&gt; TX, TX ---&gt; RX, GPIO2) ---&gt; DTR).  The board is made for ease of connection and the ability to work in circuits with a microcontroller 5V supply voltage. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Schematic diagram and PCB </h5><img src="https://habrastorage.org/files/b84/275/9fe/b842759fead74aef9184ab4bb19f8dd7.png"><br>  Modules of the esp-02 type are used, but the common esp-01 will also work, only the board will need to be re-routed slightly.  Jumpers choose 3.3 / 5V operation mode.  U1 - stabilizer converts 5V to 3.3V if necessary.  R2 and R3 - divider, also for 5V mode.  After the assembly, you need to install the RPOG jumper and use the same FTDI or any other UART adapter to load the <a href="https://github.com/beckdac/ESP8266-transparent-bridge">ESP8266-transparent-bridge</a> . <br>  One-way PCB Template (SVG Vector): <br><img src="http://r3z.no-ip.info/public/esp-ftdi-F_Cu.svg" alt="image"><br>  If you want a negative, just open it with a text editor and replace # 000000 with #FFFFFF and vice versa. <br>  <a href="https://github.com/dima-ch/esp-ftdi">In KiCad format on github</a> <br><br><h5>  Microcontroller firmware </h5>  Usually, to download the firmware, you must restart the microcontroller.  The FTDI adapter makes this a pulse on the DTR leg (the first one in the connector), it is connected to the RESET microcontroller through the capacitor.  In our case, GPIO2 has been replaced with DTR (see UPD).  To reboot the microcontroller, AT commands "+++ AT GPIO2 1" and then "+++ AT GPIO2 0" are used, which change the level to GPIO2 ESP8266.  One differential is enough to reset the controller.  Immediately after the reboot, the bootloader works for some time and waits for the UART firmware image, you can transfer it using the avrdude utility.  Below is the script which the controller is flashing: <br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash HEXILE="firmware.hex" ADDRESS=xxxx BAUD=57600 echo "+++AT BAUD $BAUD" | nc $(ADDRESS) 23 echo "+++AT GPIO2 1" | nc $(ADDRESS) 23 echo "+++AT GPIO2 0" | nc $(ADDRESS) 23 avrdude -P net:$(ADDRESS):23 -F -U flash:w:$(HEXILE):i</span></span></code> </pre> <br>  These commands can be included in the Makefile. <br>  Wireless firmware can also be turned in Windows by installing the nc and avrdude utilities. <br><h5>  Video demonstrating the work on the example of the Chinese Arduino pro mini </h5><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/Yf4UusDG0qY%3Ffeature%3Doembed&amp;xid=17259,15700021,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhijcP6E9ri2H5-xic9l88TAdqrnxw" frameborder="0" allowfullscreen=""></iframe><br><br>  <b>UPD</b> : <br>  <a href="https://geektimes.ru/users/sav13/" class="user_link">sav13</a> suggested using <a href="https://github.com/jeelabs/esp-link">esp-link</a> as firmware for ESP8266, it is compatible with the current adapter circuit.  This firmware has several advantages compared with ESP8266-transparent-bridge, incl.  WEB interface for configuration, no need to use AT commands, additional functionality, in more detail <a href="http://samopal.pro/arduino-esp8266/">here</a> . </div><p>Source: <a href="https://habr.com/ru/post/392833/">https://habr.com/ru/post/392833/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../392823/index.html">High school students assembled a fusion reactor in the garage and set up experiments</a></li>
<li><a href="../392825/index.html">Reincarnation of the "popular" board TP4056 or self-made charging for lithium at 3A</a></li>
<li><a href="../392827/index.html">Robiton PM1 and PM2 power meters</a></li>
<li><a href="../392829/index.html">PO2RT: coworking on top</a></li>
<li><a href="../392831/index.html">Mobile weather station at Arduino</a></li>
<li><a href="../392835/index.html">Right holders on Telegram to Google</a></li>
<li><a href="../392837/index.html">Maintaining servo position: slave control vs stepping mode</a></li>
<li><a href="../392839/index.html">Universal Controller Module for Internet of Things</a></li>
<li><a href="../392841/index.html">Epson projectors and mobile presentations - tips on choosing a projector</a></li>
<li><a href="../392843/index.html">What distance should an autonomous car drive to prove its reliability?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>