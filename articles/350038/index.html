<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Rake when moving to a virtual platform with physical hardware</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There is a company like a small chain of stores, production or scientific institute. At some point, comes the understanding that we need our own serve...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Rake when moving to a virtual platform with physical hardware</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/ig/r0/hv/igr0hvwzlkfx44hmjydljxgyna0.png"><br><br>  There is a company like a small chain of stores, production or scientific institute.  At some point, comes the understanding that we need our own servers in the cloud.  A plan is bought, tests are done, then the move begins. <br><br>  And then we, as a platform, begin to take it and beat ourselves in the face, because customers are starting to complain that something in the cloud is not working that way.  The problem is - at least in 80% of cases - in architecture, another part is in the desire to save the last penny, and we have only a few last percent. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For example, the database is located on 7K disks and on a weak virtual machine.  Why is that?  Because the desired performance is estimated on average.  And in real business there is no medium: usually it is a chain of small peaks between the practical absence of workload.  At stores, little is happening at night, at scientific research institutes - between long calculations. <br><br>  I'll tell you a little more about typical situations. <br><a name="habracut"></a><br><h2>  Ruta </h2><br>  Quite a literacy campaign, but we often see root-access over SSH on Linux machines and life without updates on Win-machines.  Why is it important?  Because there are viruses like "Petit".  Of course, clients often say that they are not personally needed by anyone and no one will attack them.  But botnets do not care - they are breaking on all devices on the network and sorting out vulnerabilities and passwords. <br><br>  Good practice is to do authentication by keys, not passwords and close the ‚Äúextra‚Äù ports.  Ideally, use access tables.  Moving is a good reason to set up, update ACL lists, put out only those services that are really needed from a large Internet. <br><br>  It sounds pretty simple, but many are already burning on this.  Because many people in IT in an ordinary business (like ice-cream production or a car service) somehow many years ago set up someone, and they still live, do not touch anything.  Then layers of new features grow on top of this, and as a result, they start digging in archeology only when something is not working.  Not preventive. <br><br>  Naturally, we don‚Äôt climb into the client systems, we simply provide the infrastructure: we are a maintenance service.  But we help with the move, and sometimes they share this pain with us.  We can do an audit and resolve all issues.  True, some prefer to step on the rake themselves, and only then they order an audit. <br><br>  One client, for example, did not create ACL lists at all - put all the machines with a bare ass on the Internet.  I caught Petya, just povyrubal everything and re-deployed the virtuals.  Then it helped: we passed the recommendations, but, most likely, will apply them from the second time.  Now we fasten the perimeter scan automatically so that the notifications reach it in advance. <br><br>  Example of standard ACL setting by clients: <br><br><img src="https://habrastorage.org/webt/rs/qg/zo/rsqgzohnla27gckh9k-hxdiy4e8.png"><br><br><h2>  Parallelism </h2><br>  Clients often have poor services building architecture: they use virtualization as physics.  There is one fat virtual machine, and if with it a pack, then the business gets cancer.  No load balancers, no parallelization of server load, no replication.  The beauty of the clouds is that VM can be a lot.  This is not necessary: <br><br><img src="https://habrastorage.org/webt/qi/-k/r1/qi-kr18xvh4wcoi6op0geenpolk.png"><br><br>  And here it is necessary: <br><br><img src="https://habrastorage.org/webt/p1/mf/c8/p1mfc8w_dx9vhalobcvzmd6fjzi.png"><br><br>  More often, these rakes are attacked by those who had a half-rack in the office.  Stood a server - fat VM on 16 GB.  Scaling it - the addition of memory and disk.  And it is necessary to put excess machines and a balancer. <br><br><h2>  Legacy on iron </h2><br>  The next part of the story is dragging everything that is already in use into the cloud, but has long been out of date.  For example, many people want to drag in their network rules and firewalls, because their entire network is placed on them.  And the network is already different, and the old principles can be applied to it in backward compatibility mode, of course, but it is better to just take a normal tool and make a new one. <br><br>  The result of working with Legacy: in order to maintain the necessary functionality, people begin to install all sorts of third-party products to protect their structure in terms of security, for example, pfSense.  Spent on resources, although much is being done at all by the built-in cloud, for example, the NSX Firewall. <br><br>  It is enough to figure out how to configure them, and not put your own inside the cloud.  Read the instructions on the access and subnet lists and implement it with the help of the cloud, and not raise individual VMs. <br><br>  Of course, the built-in tools are not always perfect, because someone needs to read the logs, and their tools solve individual problems better.  But without the need to better throw off this ballast. <br><br><h2>  End-to-end resources </h2><br>  Quite often there is the most severe savings on virtual machines.  The base is 28 GB, and the virtual machine is given 4 GB of memory.  With large requests, departures start with actions, or just everything slows down.  Let's increase the memory?  No, we must try to optimize!  For now it will be released, let it choke. <br><br>  Or, for example, if you need to deploy an additional machine, people get an error and think for a long time what to do with it.  Roughly speaking, resources purchased back to back do not allow making a snapshot, they cannot normally restore the machine from a backup, etc.  A lot of resulting problems that will gradually expand.  We advise to expand the resource: otherwise - no way. <br><br>  A subtype of this error is the calculation of the physical cores.  When an admin physicist comes in who has not worked with a virtual environment before, he often misses the few percent of the load that the hypervisor gives, and as a result counts on the cores, one to one with his past system. <br><br>  The downside: of course, resources cost money.  Almost all customers are trying to save as much as possible, trying to squeeze out of cars as much as possible.  Savings for large companies - about 60 thousand rubles per month.  And it is not clear whether the opportunity to maneuver this money or not.  The situation is characteristic only and exclusively for a business that is not related to IT.  For example, we host a large antivirus development in the cloud - banks, insurance, large retail.  All of them know their consumption and have sufficient reserve to accommodate additional capacity at any time. <br><br>  Large customers usually have problems not at the stage of unfolding machines, but at the stage of raising all the tunnels.  And, of course, large companies - their administrators usually have more competence.  They can afford more expensive administrators. <br><br><h2>  Compatibility </h2><br>  OS migration: many try to use what they already have.  And do not pay attention to the compatibility of their OS with VMware.  Suppose there are high-loaded Debian databases.  <s>The problem is that the PVSCSI adapter is not supported by Vmware for the Debian OS.</s>  <s>Vmware does not support this OS.</s>  <i>UPD: more precisely, does not work with a sufficiently high performance.</i>  And we have seen cases when, according to the database, the difference by 3-4 times in disk performance differs from the same base on another OS, for example, CentOS.  We do not recommend using software that does not have the ‚ÄúVMware supported‚Äù mark. <br><br>  Or, in the LVM compiled on SSD disks, 7K disks are added by mistake, and then the client tries to blame us for the speed of SSD disks that does not match the stated speed. <br><br>  It is very important: it may seem that this is a completely unnecessary educational program and everyone knows this very well.  But no.  I highly recommend doing a <a href="https://kb.vmware.com/s/article/1010398">list</a> check when moving. <br><br>  We can advise in difficult cases to switch to CentOS or Red Hat, but in general it is better to think about this before planning the move. <br><br><h2>  Rarer cases </h2><br>  The client is preparing to migrate to the cloud.  The system administrator made RAID-5 on his servers in a degraded state, ‚Äútouched‚Äù before being fired.  Then he left the company.  Some time passed, preparations began for the move.  In the course of the preparation, one disk flew out of the RAID.  There base 1C.  They could not restore themselves: something with the physics of the disk.  Backup was not configured.  No comment what is called. <br><br>  A similar case was with a fire: there the backup was in the same server room where the main database worked. <br><br>  Often include the second network interfaces, and then for a long time can not deal with routing.  Two interfaces in the system scare untrained admins.  This is usually a small business: there are not enough competences, technical education leaves much to be desired.  They say: "We desperately need a second network interface", - respectively, add it.  Then you need to adjust, and everything stops working correctly for them.  The error is not one-time.  We are now writing a tutorial on how to configure what should work and on what OS it is done. <br><br>  We received a claim from the client, the client bought VDC and added a VM to two interfaces, one to the internal network, another to the external one, and, in fact, got confused in two interfaces.  In order to organize the routing, I used network bridges and decided to install the PROXMOX 5 hypervisor. They helped to resolve everything quickly - the peculiarity was that the customers had not worked with this architecture before.  Well, they turned in time before building this structure with the hypervisor in the hypervisor. <br><br>  At one client remote workplaces braked.  The solution is simple: it turned out that 10 Mbit / s come to the office in a hundred of machines. <br><br>  Another client could not move us because his old cloud provider did not let go.  Reduced the speed of the channel.  This only aggravated the situation in their relationship.  We can unload all VMs via the fast channel and put them on a closed exchanger.  Day to unload: lunch - evening, the next day he left.  Everything.  That's the way it should be. <br><br>  Trite people confuse speed: one comrade Megabyte from Megabit began to distinguish only after talking with us. <br><br>  In general, all people are very overloaded with exploitation, and those who are engaged in writing documents will write very little without techies.  And it turns a vicious circle.  Because user experience needs to be developed - the technical staff says that there is a problem.  And further together this problem is described by the literary language.  In fact, there should be a knowledge base. <br><br>  In general, we, as the exploitation of the cloud, do not have to go anywhere beyond the level of the hypervisor, but due to the fact that, as an integrator, we are doing a number of ‚Äúbig Technoserv‚Äù security audits, and we help with architecture, and so on and so forth.  But in general, we try not only to solve the problem, but also to form it. <br><br><blockquote>  <i>The text was prepared by Dmitry Maximov, Head of the <a href="http://ts-cloud.ru/%3Futm_source%3Dhabr%26utm_medium%3Dpost%26utm_campaign%3Dgrabli">Technoserv Cloud</a> Operations Department.</i> </blockquote></div><p>Source: <a href="https://habr.com/ru/post/350038/">https://habr.com/ru/post/350038/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../350026/index.html">(Non) security monitoring systems: Zabbix</a></li>
<li><a href="../350028/index.html">Code Integrity Protection with PGP. Part 2. Creating a master key</a></li>
<li><a href="../350030/index.html">Searchless method for calculating controller settings using Python</a></li>
<li><a href="../350032/index.html">Additional factors for evaluating spam activity IP / Email addresses in the Anti-Spam / Anti-Fraud API</a></li>
<li><a href="../350034/index.html">Service Workers. Web Push and where they live</a></li>
<li><a href="../350040/index.html">Call Tracking Mango Office: under the hood of the service</a></li>
<li><a href="../350042/index.html">Benchmark of Google's new tensor processor for deep learning</a></li>
<li><a href="../350044/index.html">Announcement of Google Summer of Code 2018 for the project radare2</a></li>
<li><a href="../350046/index.html">Hidden JS-mining in the browser</a></li>
<li><a href="../350048/index.html">Let's Encrypt postponed issuance of wildcard certificates due to security issues.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>