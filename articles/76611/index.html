<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Physics on Flash. Box2D Engine</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Fast, convenient and powerful open source physics engine. Under the cut - links, a small tutorial and an example of use. 

 Links 
 The Box2D project ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Physics on Flash. Box2D Engine</h1><div class="post__text post__text-html js-mediator-article"><img align="right" src="https://habrastorage.org/getpro/habr/post_images/1e4/541/8ef/1e45418efce5ba8a49a19ea88ae06528.gif"><br>  Fast, convenient and powerful open source physics engine.  Under the cut - links, a small tutorial and an example of use. <br><a name="habracut"></a><br><h4>  Links </h4><br>  The Box2D project itself is located at this address - <a href="http://www.box2d.org/">http://www.box2d.org/</a> , where you can read about its capabilities, chat on the forum, etc. <br>  Since it was made AS3 port, homepage - <a href="http://box2dflash.sourceforge.net/">http://box2dflash.sourceforge.net/</a> .  It posted a clip showing the capabilities of this engine.  By the way, all with Friday) <br><img src="https://habrastorage.org/getpro/habr/post_images/1eb/ce0/781/1ebce0781198aeae9b99252165c5e689.png"><br><br><h4>  Use (most basic) </h4><br>  1. Create a "world", all calculations occur only within the limits of this world, an object that goes beyond its borders falls out of calculations.  So we do it with a margin (WIDTH and HEIGHT - window sizes): <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">// world bounding box</font> <br> <font color="#0000ff">var</font> worldAABB : b2AABB = <font color="#0000ff">new</font> b2AABB(); <br> worldAABB.lowerBound.Set(-WIDTH, -HEIGHT); <br> worldAABB.upperBound.Set(2*WIDTH, 2*HEIGHT); <br> <br> <font color="#008000">// create world. zero gravity + use "sleeping" for objects</font> <br> m_world = <font color="#0000ff">new</font> b2World(worldAABB, b2Vec2.Make(0, 0), <font color="#0000ff">true</font> );</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  2. Add an object to the world. <br>  The object is characterized by two components. <br>  The first is the geometric representation of the object (its ‚Äúsurface‚Äù).  Each object can consist of several shapes that are convex polygons or circles (but nothing prevents you from expanding the base shape and writing your own). <br>  Here density, friction force, etc. are given. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">// shape definition</font> <br> <font color="#0000ff">var</font> bodyShapeDef : b2PolygonDef = <font color="#0000ff">new</font> b2PolygonDef(); <br> <font color="#008000">// as rectangle</font> <br> bodyShapeDef.SetAsBox(w/2, h/2); <br> <font color="#008000">// density</font> <br> bodyShapeDef.density = 1.0; <br> <font color="#008000">// friction</font> <br> bodyShapeDef.friction = 0.3;</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  The second is the object itself, its position, mass, moment of inertia, etc. <br>  Description of the object: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">// object definition</font> <br> <font color="#0000ff">var</font> bodyDef : b2BodyDef = <font color="#0000ff">new</font> b2BodyDef(); <br> <font color="#008000">// world position</font> <br> bodyDef.position.Set(xc, yc); <br> <font color="#008000">// linear "friction with world"</font> <br> bodyDef.linearDamping = 0.3; <br> <font color="#008000">// angular "friction with world"</font> <br> bodyDef.angularDamping = 0.3;</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Creating an object (it is automatically registered in the world).  Assigning to him a previously created geometric representation, and (very conveniently) automatic calculation of all physical parameters based on its density and shape. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">// create object from definition</font> <br> <font color="#0000ff">var</font> body : b2Body = m_world.CreateBody(bodyDef); <br> <font color="#008000">// create object shape from shape definition</font> <br> body.CreateShape(bodyShapeDef); <br> <font color="#008000">// calculate mass, center of mass and inertia</font> <br> <font color="#008000">// based on shape</font> <br> body.SetMassFromShapes();</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  There is a third (optional) component of the object - its presentation on the screen.  At the initial stages of development, you can use the b2DebugDraw class, which shows all the objects, the connections between them, etc.  But how to connect, for example, your own MovieClip and a physical object? <br>  The most frequently used practice is to use the userData field of the created object. <br>  Remember the on-screen representation in this field: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">// save screen object in userData field</font> <br> body.SetUserData(bodyDisplayObject); <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  3. Emulation <br>  Everything is simple.  The world has a Step function, which takes a step time in <s>milliseconds</s> seconds and the number of iterations that must be done at this step.  After emulation we go through all the objects of the world, we look if the userData field contains a screen representation ‚Äî then we update the position / rotation of this representation in accordance with the fields of the physical object. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">// calculate physics</font> <br> <font color="#008000">// using 10 steps of physics for each frame</font> <br> m_world.Step(dt, 10); <br> <br> <font color="#008000">// loop for all physic objects</font> <br> <font color="#0000ff">for</font> ( <font color="#0000ff">var</font> body : b2Body = m_world.GetBodyList(); body; body = body.GetNext()) <br> { <br> <font color="#008000">// if userData is not a shape, then skip this object</font> <br> <font color="#0000ff">if</font> (!(body.GetUserData() <font color="#0000ff">is</font> Shape)) <br> <font color="#0000ff">continue</font> ; <br> <br> <font color="#008000">// update screen object to be equal physical object</font> <br> body.GetUserData().x = body.GetPosition().x; <br> body.GetUserData().y = body.GetPosition().y; <br> body.GetUserData().rotation = body.GetAngle() * 180.0 / Math.PI; <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><h4>  Example </h4><br>  Wrote a small application in an attempt to create a snake.  80 rectangles are associated with RevoluteJoint pairs, with a limit of rotation of + -20 degrees.  When moving the mouse, the head segment of the snake receives an impulse in the direction of the cursor, as a result the whole snake crawls.  There are also objects in the world to crawl around. <br>  By clicking the application switches between own drawing and b2DebugDraw. <br>  application - <a href="http://www.rexxar.ru/snake/">http://www.rexxar.ru/snake/</a> <br>  source code - <a href="">http://www.rexxar.ru/snake/src.zip</a> <br><br>  Another test - shows the point of impact.  On click, a new rectangle is created and falls to the ground. <br>  application - <a href="http://www.rexxar.ru/phys/">http://www.rexxar.ru/phys/</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Conclusion </h4><br>  Analysis of the engine and writing examples took just a few hours, a very simple, convenient, fast and powerful tool for emulating physics.  I will use. <br></div><p>Source: <a href="https://habr.com/ru/post/76611/">https://habr.com/ru/post/76611/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../76598/index.html">Netbook with two displays will be available in December.</a></li>
<li><a href="../76599/index.html">App Rejections: directory of applications rejected</a></li>
<li><a href="../76600/index.html">Another blow to spammers</a></li>
<li><a href="../76609/index.html">When you need a lot, really a lot of servers</a></li>
<li><a href="../76610/index.html">Failover Service with CARP</a></li>
<li><a href="../76613/index.html">The late news of the departure of Valery Lanovenko</a></li>
<li><a href="../76619/index.html">Deploying Django Projects with Fabric</a></li>
<li><a href="../76622/index.html">fasten Idea plugins to WebIde</a></li>
<li><a href="../76623/index.html">About a cruel serpent post</a></li>
<li><a href="../76624/index.html">Creating a 3d robot arm in flash (please help)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>