<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using PHP and MySQL to create KML</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Gag 
 Cross-post of the fourth translation of tutorials on the Google Maps API from my blog . 

 This tutorial is intended for developers who are fami...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using PHP and MySQL to create KML</h1><div class="post__text post__text-html js-mediator-article"><h4>  Gag </h4><br>  Cross-post of the fourth translation of tutorials on the <a href="http://code.google.com/support/bin/topic.py%3Ftopic%3D11364">Google Maps API</a> from <a href="http://blog.aaa-nan.info/">my blog</a> . <br><br><a name="habracut"></a>  This tutorial is intended for developers who are familiar with PHP and MySQL and want to learn how to generate a KML file using data from a MySQL database.  In this tutorial, you will create two scripts that dynamically create a KML file containing data about the establishments of Seattle.  The first script creates a set of coordinates and determines the type of institution - a bar or restaurant - and marks them on the map.  When the user clicks on the marker, an info-window will appear containing the name and address of the establishment.  The task of the second script is to connect all the restaurants with a solid line.  Also in this tutorial you will learn how you can display the generated KML file using Google Earth. <br>  This lesson is based on the article <a href="http://levshino.habrahabr.ru/blog/38290/">‚ÄúUsing a bunch of PHP and MySQL with Google Maps‚Äù</a> written by Pamela Fox and showing how to export data from a database table to Google Maps using PHP.  You can skip the first two steps of this tutorial if you have already read Pamela's article.  The remaining steps are quite different from what was described in the above article - we, nevertheless, will deal with KML. <br>  The lesson is divided into the following parts: <ul><li>  Creating a database table; </li><li>  Filling the table with data; </li><li>  Information output in KML using PHP; </li><li>  Display KML file; </li><li>  What else can you think of. </li></ul><img alt="picture" src="http://g.codesite.articles.googlepages.com/mmarks-phpms-kml-seattle.jpg"><br><h4>  Step 1: Create a table </h4><br>  <b>Note:</b> in this lesson, places are used whose latitude and longitude values ‚Äã‚Äãare already known and are used to draw markers on the map.  If you try to use your information without having data on the coordinates of a place, then use the geocoding service to convert the address of the place to its coordinates.  Here is a list of some geocoding services: <a href="http://groups.google.com/group/Google-Maps-API/web/resources-non-google-geocoders">http://groups.google.com/group/Google-Maps-API/web/resources-non-google-geocoders</a> . <br>  If you prefer to create tables in the database using phpMyAdmin, then below is a screenshot of the table creation: <br><img alt="picture" src="http://g.codesite.articles.googlepages.com/mmarks-phpms-phpsqlajax_createtable.jpg"><br>  If you do not have access to phpMyAdmin or give preference to pure SQL, the SQL query code is shown below: <br><blockquote>  <font color="black"><font color="#0000ff">CREATE</font> <font color="#0000ff">TABLE</font> `markers` (</font> <font color="black"><br></font>  <font color="black">`id` <font color="#0000ff">INT</font> <font color="#0000ff">NOT</font> <font color="#0000ff">NULL</font> AUTO_INCREMENT <font color="#0000ff">PRIMARY</font> <font color="#0000ff">KEY</font> ,</font> <font color="black"><br></font>  <font color="black">`name` <font color="#0000ff">VARCHAR</font> (60) <font color="#0000ff">NOT</font> <font color="#0000ff">NULL</font> ,</font> <font color="black"><br></font>  <font color="black">`address` <font color="#0000ff">VARCHAR</font> (80) <font color="#0000ff">NOT</font> <font color="#0000ff">NULL</font> ,</font> <font color="black"><br></font>  <font color="black">`lat` <font color="#0000ff">FLOAT</font> (10, 6) <font color="#0000ff">NOT</font> <font color="#0000ff">NULL</font> ,</font> <font color="black"><br></font>  <font color="black">`lng` <font color="#0000ff">FLOAT</font> (10, 6) <font color="#0000ff">NOT</font> <font color="#0000ff">NULL</font> ,</font> <font color="black"><br></font>  <font color="black">`type` <font color="#0000ff">VARCHAR</font> (30) <font color="#0000ff">NOT</font> <font color="#0000ff">NULL</font></font> <font color="black"><br></font>  <font color="black">) ENGINE = MYISAM;</font> </blockquote><br><h4>  Step 2: Filling the table </h4><br>  After creating the table, it's time to fill it with information.  Data on 10 places in Seattle are shown below.  In phpMyAdmin, you can use the IMPORT option to insert data stored in various formats into the table, including CSV.  MS Excel and Google Spreadsheets applications support exporting data to CSV format.  So you can easily transfer data from these applications to the MySQL database using the export / import options. <br>  Here is the information provided in CSV format: <br><blockquote>  <font color="black">Pan Africa Market, "1521 1st Ave, Seattle, WA", 47.608941, -122.340145, restaurant</font> <font color="black"><br></font>  <font color="black">Buddha Thai &amp; Bar, "2222 2nd Ave, Seattle, WA", 47.613591, -122.344394, bar</font> <font color="black"><br></font>  <font color="black">The Melting Pot, "14 Mercer St, Seattle, WA", 47.624562, -122.356442, restaurant</font> <font color="black"><br></font>  <font color="black">Ipanema Grill, "1225 1st Ave, Seattle, WA", 47.606366, -122.337656, restaurant</font> <font color="black"><br></font>  <font color="black">Sake House, "2230 1st Ave, Seattle, WA", 47.612825, -122.34567, bar</font> <font color="black"><br></font>  <font color="black">Crab Pot, "1301 Alaskan Way, Seattle, WA", 47.605961, -122.34036, restaurant</font> <font color="black"><br></font>  <font color="black">Mama's Mexican Kitchen, "2234 2nd Ave, Seattle, WA", 47.613975, -122.345467, bar</font> <font color="black"><br></font>  <font color="black">Wingdome, "1416 E Olive Way, Seattle, WA", 47.617215, -122.326584, bar</font> <font color="black"><br></font>  <font color="black">Piroshky Piroshky, "1908 Pike pl, Seattle, WA", 47.610127, -122.342838, restaurant</font> </blockquote><br>  And here is a screenshot showing the import of data from CSV to the database table: <br><img alt="picture" src="http://g.codesite.articles.googlepages.com/mmarks-phpms-phpsqlajax_importdata.jpg"><br>  If you do not use phpMyAdmin, then below is the query code to the database in SQL language: <br><blockquote>  <font color="black"><font color="#0000ff">INSERT</font> <font color="#0000ff">INTO</font> `markers` (` name`, `address`,` lat`, `lng`,` type`) <font color="#0000ff">VALUES</font> ( <font color="#A31515">'Pan Africa Market'</font> , <font color="#A31515">'1521 1st Ave, Seattle, WA'</font> , <font color="#A31515">'47 .608941 '</font> , <font color="#A31515">' - 122.340145 '</font> , <font color="#A31515">' restaurant '</font> );</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">INSERT</font> <font color="#0000ff">INTO</font> `markers` (` name`, `address`,` lat`, `lng`,` type`) <font color="#0000ff">VALUES</font> ( <font color="#A31515">'Buddha Thai &amp; Bar'</font> , <font color="#A31515">'2222 2nd Ave, Seattle, WA'</font> , <font color="#A31515">'47 .613591 '</font> , <font color="#A31515">' -122.344394 '</font> , <font color="#A31515">' bar '</font> );</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">INSERT</font> <font color="#0000ff">INTO</font> `markers` (` name`, `address`,` lat`, `lng`,` type`) <font color="#0000ff">VALUES</font> ( <font color="#A31515">'The Melting Pot'</font> , <font color="#A31515">'14 Mercer St, Seattle, WA '</font> , <font color="#A31515">'47 .624562'</font> , <font color="#A31515">'- 122.356442 '</font> , <font color="#A31515">' restaurant '</font> );</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">INSERT</font> <font color="#0000ff">INTO</font> `markers` (` name`, `address`,` lat`, `lng`,` type`) <font color="#0000ff">VALUES</font> ( <font color="#A31515">'Ipanema Grill'</font> , <font color="#A31515">'1225 1st Ave, Seattle, WA'</font> , <font color="#A31515">'47 .606366 '</font> , <font color="#A31515">' -122.337656 '</font> , <font color="#A31515">' restaurant '</font> );</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">INSERT</font> <font color="#0000ff">INTO</font> `markers` (` name`, `address`,` lat`, `lng`,` type`) <font color="#0000ff">VALUES</font> ( <font color="#A31515">'Sake House'</font> , <font color="#A31515">'2230 1st Ave, Seattle, WA'</font> , <font color="#A31515">'47 .612825 '</font> , <font color="#A31515">' -122.34567 '</font> , <font color="#A31515">' bar '</font> );</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">INSERT</font> <font color="#0000ff">INTO</font> `markers` (` name`, `address`,` lat`, `lng`,` type`) <font color="#0000ff">VALUES</font> ( <font color="#A31515">'Crab Pot'</font> , <font color="#A31515">'1301 Alaskan Way, Seattle, WA'</font> , <font color="#A31515">'47 .605961 '</font> , <font color="#A31515">' -122.34036 '</font> , <font color="#A31515">' restaurant '</font> );</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">INSERT</font> <font color="#0000ff">INTO</font> `markers` (` name`, `address`,` lat`, `lng`,` type`) <font color="#0000ff">VALUES</font> ( <font color="#A31515">'Mama Mexican Kitchen'</font> , <font color="#A31515">'2234 2nd Ave, Seattle, WA'</font> , <font color="#A31515">'47. 613975 '</font> , <font color="#A31515">' - 122.345467 '</font> , <font color="#A31515">' bar '</font> );</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">INSERT</font> <font color="#0000ff">INTO</font> `markers` (` name`, `address`,` lat`, `lng`,` type`) <font color="#0000ff">VALUES</font> ( <font color="#A31515">'Wingdome'</font> , <font color="#A31515">'1416 E Olive Way, Seattle, WA'</font> , <font color="#A31515">'47 .617215 '</font> , <font color="#A31515">' -122.326584 '</font> , <font color="#A31515">' bar '</font> );</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">INSERT</font> <font color="#0000ff">INTO</font> `markers` (` name`, `address`,` lat`, `lng`,` type`) <font color="#0000ff">VALUES</font> ( <font color="#A31515">'Piroshky Piroshky'</font> , <font color="#A31515">'1908 Pike pl, Seattle, WA'</font> , <font color="#A31515">'47 .610127 '</font> , <font color="#A31515">' -122.342838 '</font> , <font color="#A31515">' restaurant '</font> );</font> </blockquote><br><h4>  Step 3: Display information in KML using PHP </h4><br>  At this point, you should have a database table (called markers) filled with data.  Now you need to write some PHP code that allows you to connect to the database, take the necessary information from it and export it to a KML file.  If you have never written to PHP code that allows you to connect to the database, then you need to visit the site <a href="http://php.net/">php.net</a> and read about the functions <code>mysql_connect()</code> , <code>mysql_select_db()</code> , <code>my_sql_query()</code> , and <code>mysql_error()</code> . <br>  Now you need to transfer information about connecting to the database in a separate file.  Below is the PHP code in which you must enter your own username, password and database name: <br> <code><font color="#0000ff">&lt;? <br> $username="username"; <br> $password="password"; <br> $database="username-databaseName"; <br> ?&gt;</font></code> <br>  <u>Using PHP5 DOM functions to generate a KML file</u> <br>  That's just from this point and go new material.  In a previous article, Pamela introduced you to PHP4 code, which used the <code>dom_xml</code> extension to create a simple file with markers, which was subsequently processed using JavaScript.  In this tutorial you need to get a KML file.  Instead of parsing KML with JavaScript, we will immediately build this file with Placemark-specific tags.  Further, both methods of generating a KML file will be shown: using the built-in DOM functionality in PHP5 and using the <code>dom_xml</code> extension in PHP4. <br>  First, check if the <code>DOMDocument()</code> works on your PHP server.  If the DOM functionality is disabled, you can try to create an XML file, as described in the Pamela article.  Or use the KML creation methods shown below. <br>  If you do decide to use DOM functions, then we will start creating markers for each row from the database table.  First, you need to initialize a new XML document and create the parent node ‚Äúkml‚Äù in it.  Add the KML namespace to it as an attribute.  After creating the base KML <code>&lt;document&gt;</code> , you must create two styles - one for restaurants, the other for bars - which will later represent the markers through the <code>&lt;styleURL&gt;</code> . <br>  Next, we connect to the database and execute a <code>SELECT *</code> query (select all) to the table with markers and go through all the results of this sample.  For each row in the table, create a <code>&lt;Placemark&gt;</code> element.  The information extracted from the database is used to create child elements for <code>&lt;Placemark&gt;</code> such as <code>&lt;name&gt;</code> , <code>&lt;description&gt;</code> , <code>&lt;styleURL&gt;</code> , <code>&lt;Point&gt;</code> .  The value written in the <code>&lt;styleURL&gt;</code> will depend on the value of the <code>type</code> entry.  Then add the <code>&lt;Placemark&gt;</code> child element to <code>&lt;Placemark&gt;</code> , and as the value of this element, we write down the coordinates of the institution contained in the <code>lat</code> and <code>lng</code> fields. <br>  The following PHP creates a KML file with the corresponding HTML header.  After generating the KML file, you should check this file for errors. <br> <code><font color="#0000ff">&lt;?php <br> require('phpsqlajax_dbinfo.php'); <br> <br> <font color="#17c600">//    MySQL-.</font> <br> <br> $connection = mysql_connect ($server, $username, $password); <br> <br> if (!$connection) <br> { <br> die('  : ' . mysql_error()); <br> } <br> <font color="#17c600">//   .</font> <br> $db_selected = mysql_select_db($database, $connection); <br> <br> if (!$db_selected) <br> { <br> die('   : ' . mysql_error()); <br> } <br> <br> <font color="#17c600">//      markers.</font> <br> $query = 'SELECT * FROM markers WHERE 1'; <br> $result = mysql_query($query); <br> <br> if (!$result) <br> { <br> die(' : ' . mysql_error()); <br> } <br> <br> <font color="#17c600">//  .</font> <br> $dom = new DOMDocument('1.0', 'UTF-8'); <br> <br> <font color="#17c600">//    KML     .</font> <br> $node = $dom-&gt;createElementNS('http://earth.google.com/kml/2.1', 'kml'); <br> $parNode = $dom-&gt;appendChild($node); <br> <br> <font color="#17c600">//   Document      KML.</font> <br> $dnode = $dom-&gt;createElement('Document'); <br> $docNode = $parNode-&gt;appendChild($dnode); <br> <br> <font color="#17c600">//   :   ,   .      KML.</font> <br> $restStyleNode = $dom-&gt;createElement('Style'); <br> $restStyleNode-&gt;setAttribute('id', 'restaurantStyle'); <br> $restIconstyleNode = $dom-&gt;createElement('IconStyle'); <br> $restIconstyleNode-&gt;setAttribute('id', 'restaurantIcon'); <br> $restIconNode = $dom-&gt;createElement('Icon'); <br> $restHref = $dom-&gt;createElement('href', 'http://maps.google.com/mapfiles/kml/pal2/icon63.png'); <br> $restIconNode-&gt;appendChild($restHref); <br> $restIconstyleNode-&gt;appendChild($restIconNode); <br> $restStyleNode-&gt;appendChild($restIconstyleNode); <br> $docNode-&gt;appendChild($restStyleNode); <br> <br> $barStyleNode = $dom-&gt;createElement('Style'); <br> $barStyleNode-&gt;setAttribute('id', 'barStyle'); <br> $barIconstyleNode = $dom-&gt;createElement('IconStyle'); <br> $barIconstyleNode-&gt;setAttribute('id', 'barIcon'); <br> $barIconNode = $dom-&gt;createElement('Icon'); <br> $barHref = $dom-&gt;createElement('href', 'http://maps.google.com/mapfiles/kml/pal2/icon27.png'); <br> $barIconNode-&gt;appendChild($barHref); <br> $barIconstyleNode-&gt;appendChild($barIconNode); <br> $barStyleNode-&gt;appendChild($barIconstyleNode); <br> $docNode-&gt;appendChild($barStyleNode); <br> <br> <font color="#17c600">//              Placemark.</font> <br> while ($row = @mysql_fetch_assoc($result)) <br> { <br> <font color="#17c600">//   Placemark      Document.</font> <br> <br> $node = $dom-&gt;createElement('Placemark'); <br> $placeNode = $docNode-&gt;appendChild($node); <br> <br> <font color="#17c600">//   id.</font> <br> $placeNode-&gt;setAttribute('id', 'placemark' . $row['id']); <br> <br> <font color="#17c600">//   name  description       .</font> <br> $nameNode = $dom-&gt;createElement('name',htmlentities($row['name'])); <br> $placeNode-&gt;appendChild($nameNode); <br> $descNode = $dom-&gt;createElement('description', $row['address']); <br> $placeNode-&gt;appendChild($descNode); <br> $styleUrl = $dom-&gt;createElement('styleUrl', '#' . $row['type'] . 'Style'); <br> $placeNode-&gt;appendChild($styleUrl); <br> <br> <font color="#17c600">//   Point.</font> <br> $pointNode = $dom-&gt;createElement('Point'); <br> $placeNode-&gt;appendChild($pointNode); <br> <br> <font color="#17c600">//   coordinates.</font> <br> $coorStr = $row['lng'] . ',' . $row['lat']; <br> $coorNode = $dom-&gt;createElement('coordinates', $coorStr); <br> $pointNode-&gt;appendChild($coorNode); <br> } <br> <br> $kmlOutput = $dom-&gt;saveXML(); <br> header('Content-type: application/vnd.google-earth.kml+xml'); <br> echo $kmlOutput; <br> ?&gt;</font></code> <br>  <u>Using the PHP4 <code>dom_xml</code> extension</u> <br>  PHP4 code using the dom_xml extension is very similar to the code written above: <br> <code><font color="#0000ff">&lt;?php <br> require('phpsqlajax_dbinfo.php'); <br> <br> <font color="#17c600">//    MySQL-.</font> <br> $connection=mysql_connect ($server, $username, $password); <br> if (!$connection) <br> { <br> die('  : ' . mysql_error()); <br> } <br> <font color="#17c600">//   .</font> <br> $db_selected = mysql_select_db($database, $connection); <br> if (!$db_selected) <br> { <br> die ('   : ' . mysql_error()); <br> } <br> <br> <font color="#17c600">//      markers.</font> <br> $query = 'SELECT * FROM markers WHERE 1'; <br> $result = mysql_query($query); <br> if (!$result) <br> { <br> die(' : ' . mysql_error()); <br> } <br> <br> <font color="#17c600">//  .</font> <br> $dom = new domxml_new_doc('1.0'); <br> <br> <font color="#17c600">//    KML     .</font> <br> $node = $dom-&gt;create_element_ns('http://earth.google.com/kml/2.1', 'kml'); <br> $parNode = $dom-&gt;append_child($node); <br> <br> <font color="#17c600">//   Document      KML.</font> <br> $dnode = $dom-&gt;create_element('Document'); <br> $docNode = $parNode-&gt;append_child($dnode); <br> <br> <font color="#17c600">//    :  -  ,  -  .</font> <br> $restStyleNode = $dom-&gt;create_element('Style'); <br> $restStyleNode-&gt;set_attribute('id', 'restaurantStyle'); <br> $restIconstyleNode = $dom-&gt;create_element('IconStyle'); <br> $restIconstyleNode-&gt;set_attribute('id', 'restaurantIcon'); <br> $restIconNode = $dom-&gt;create_element('Icon'); <br> $restHref = $dom-&gt;create_element('href', 'http://maps.google.com/mapfiles/kml/pal2/icon63.png'); <br> $restIconNode-&gt;append_child($restHref); <br> $restIconstyleNode-&gt;append_child($restIconNode); <br> $restStyleNode-&gt;append_child($restIconstyleNode); <br> $docNode-&gt;append_child($restStyleNode); <br> $barStyleNode = $dom-&gt;create_element('Style'); <br> $barStyleNode-&gt;set_attribute('id', 'barStyle'); <br> $barIconstyleNode = $dom-&gt;create_element('IconStyle'); <br> $barIconstyleNode-&gt;set_attribute('id', 'barIcon'); <br> $barIconNode = $dom-&gt;create_element('Icon'); <br> $barHref = $dom-&gt;create_element('href', 'http://maps.google.com/mapfiles/kml/pal2/icon27.png'); <br> $barIconNode-&gt;append_child($barHref); <br> $barIconstyleNode-&gt;append_child($barIconNode); <br> $barStyleNode-&gt;append_child($barIconstyleNode); <br> $docNode-&gt;append_child($barStyleNode); <br> <br> <font color="#17c600">//              Placemark.</font> <br> while ($row = @mysql_fetch_assoc($result)) <br> { <br> <font color="#17c600">//   Placemark      Document.</font> <br> $node = $dom-&gt;create_element('Placemark'); <br> $placeNode = $docNode-&gt;append_child($node); <br> <font color="#17c600">//   id.</font> <br> $placeNode-&gt;set_attribute('id', 'placemark' . $row['id']); <br> <br> <font color="#17c600">//   name  description       .</font> <br> $nameNode = $dom-&gt;create_element('name',htmlentities($row['name'])); <br> $placeNode-&gt;append_child($nameNode); <br> $descNode = $dom-&gt; create_element('description', $row['address']); <br> $placeNode-&gt;append_child($descNode); <br> $styleUrl = $dom-&gt;create_element('styleUrl', '#' . $row['type'] . 'Style'); <br> $placeNode-&gt;append_child($styleUrl); <br> <font color="#17c600">//   Point.</font> <br> $pointNode = $dom-&gt;create_element('Point'); <br> $placeNode-&gt;append_child($pointNode); <br> <br> <font color="#17c600">//   coordinates.</font> <br> $coorStr = $row['lng'] . ',' . $row['lat']; <br> $coorNode = $dom-&gt;create_element('coordinates', $coorStr); <br> $pointNode-&gt;append_child($coorNode); <br> } <br> <br> $kmlOutput = $dom-&gt;dump_mem(TRUE, 'UTF-8'); <br> header('Content-type: application/vnd.google-earth.kml+xml'); <br> echo $kmlOutput; <br> ?&gt;</font></code> <br>  As you can see, all the difference lies only in the name of the function responsible for creating the XML element ( <code>createElement</code> ).  In PHP4, this name is written in lower case with the ‚Äú_‚Äù character necessary to separate the words in the function name. <br>  The exception is the name of the function that initializes the new document: in PHP5 it is called <code>DOMDocument</code> , and in PHP4 it is <code>domxml_new_doc</code> . <br>  <u>Using the PHP <code>echo</code> function to output KML</u> <br>  If you do not have access to the PHP DOM functionality, you can use the echo function to display information in a KML form. <ol><li>  Connect to the database and execute a <code>SELECT *</code> query to the table with markers; </li><li>  Create a string array, the elements of which will contain the basic structure of a KML document; </li><li>  Pass through the results of sampling data from the database and add them to the array; </li><li>  For each entry in the table, we create a <code>&lt;Placemark&gt;</code> element and pass it the values ‚Äã‚Äãof the name of the institution and its address through the <code>htmlentities</code> function to exclude the entry of special characters; </li><li>  We join all the elements of the array in one line, attach the header to the file and print the string we received. </li></ol>  The code of the corresponding script: <br> <code><font color="#0000ff">&lt;?php <br> require('phpsqlajax_dbinfo.php'); <br> <br> <font color="#17c600">//    MySQL-.</font> <br> $connection = mysql_connect ($server, $username, $password); <br> if (!$connection) <br> { <br> die('  : ' . mysql_error()); <br> } <br> <br> <font color="#17c600">//   .</font> <br> $db_selected = mysql_select_db($database, $connection); <br> if (!$db_selected) <br> { <br> die ('   : ' . mysql_error()); <br> } <br> <br> <font color="#17c600">//      markers.</font> <br> $query = 'SELECT * FROM markers WHERE 1'; <br> $result = mysql_query($query); <br> if (!$result) <br> { <br> die(' : ' . mysql_error()); <br> } <br> <br> <font color="#17c600">//   .</font> <br> $kml = array('&lt;? xml version="1.0" encoding="UTF-8"?&gt;'); <br> $kml[] = '&lt;kml xmlns="http://earth.google.com/kml/2.1"&gt;'; <br> $kml[] = ' &lt;Document&gt;'; <br> $kml[] = ' &lt;Style id="restaurantStyle"&gt;'; <br> $kml[] = ' &lt;IconStyle id="restuarantIcon"&gt;'; <br> $kml[] = ' &lt;Icon&gt;'; <br> $kml[] = ' &lt;href&gt;http://maps.google.com/mapfiles/kml/pal2/icon63.png&lt;/href&gt;'; <br> $kml[] = ' &lt;/Icon&gt;'; <br> $kml[] = ' &lt;/IconStyle&gt;'; <br> $kml[] = ' &lt;/Style&gt;'; <br> $kml[] = ' &lt;Style id="barStyle"&gt;'; <br> $kml[] = ' &lt;IconStyle id="barIcon"&gt;'; <br> $kml[] = ' &lt;Icon&gt;'; <br> $kml[] = ' &lt;href&gt;http://maps.google.com/mapfiles/kml/pal2/icon27.png&lt;/href&gt;'; <br> $kml[] = ' &lt;/Icon&gt;'; <br> $kml[] = ' &lt;/IconStyle&gt;'; <br> $kml[] = ' &lt;/Style&gt;'; <br> <br> <font color="#17c600">//    .</font> <br> while ($row = @mysql_fetch_assoc($result)) <br> { <br> $kml[] = ' &lt;Placemark id="placemark' . $row['id'] . '"&gt;'; <br> $kml[] = ' &lt;name&gt;' . htmlentities($row['name']) . '&lt;/name&gt;'; <br> $kml[] = ' &lt;description&gt;' . htmlentities($row['address']) . '&lt;/description&gt;'; <br> $kml[] = ' &lt;styleUrl&gt;#' . ($row['type']) .'Style&lt;/styleUrl&gt;'; <br> $kml[] = ' &lt;Point&gt;'; <br> $kml[] = ' &lt;coordinates&gt;' . $row['lng'] . ',' . $row['lat'] . '&lt;/coordinates&gt;'; <br> $kml[] = ' &lt;/Point&gt;'; <br> $kml[] = ' &lt;/Placemark&gt;'; <br> <br> } <br> <br> <font color="#17c600">//  XML-</font> <br> $kml[] = ' &lt;/Document&gt;'; <br> $kml[] = '&lt;/kml&gt;'; <br> $kmlOutput = join("\n", $kml); <br> header('Content-type: application/vnd.google-earth.kml+xml'); <br> echo $kmlOutput; <br> ?&gt;</font></code> <br>  <u>We check the correctness of the received KML file.</u> <br>  Call our script and check the correctness of displaying KML in the browser.  If everything is alright, then you should see something like this: <br><blockquote>  <font color="black"><font color="#0000ff">&lt;?</font></font>  <font color="black"><font color="#800000">xml</font> <font color="#ff0000">version</font> <font color="#0000ff">= "1.0"</font> <font color="#ff0000">encoding</font> <font color="#0000ff">= "UTF-8"</font> ?</font>  <font color="black"><font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">kml</font> <font color="#ff0000">xmlns</font> = <font color="#0000ff">"http://earth.google.com/kml/2.1"</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Document</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Style</font> <font color="#ff0000">id</font> <font color="#0000ff">= "restaurantStyle"</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">IconStyle</font> <font color="#ff0000">id</font> <font color="#0000ff">= "restuarantIcon"</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Icon</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">href</font> <font color="#0000ff">&gt;</font> http://maps.google.com/mapfiles/kml/pal2/icon63.png <font color="#0000ff">&lt;/</font> <font color="#800000">href</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">Icon</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">IconStyle</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">Style</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Style</font> <font color="#ff0000">id</font> <font color="#0000ff">= "barStyle"</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">IconStyle</font> <font color="#ff0000">id</font> <font color="#0000ff">= "barIcon"</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Icon</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">href</font> <font color="#0000ff">&gt;</font> http://maps.google.com/mapfiles/kml/pal2/icon27.png <font color="#0000ff">&lt;/</font> <font color="#800000">href</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">Icon</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">IconStyle</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">Style</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Placemark</font> <font color="#ff0000">id</font> <font color="#0000ff">= "placemark1"</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black">Pan Africa Market <font color="#0000ff">&lt;/</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">description</font> <font color="#0000ff">&gt;</font> 1521 1st Ave, Seattle, WA <font color="#0000ff">&lt;/</font> <font color="#800000">description</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">styleUrl</font> <font color="#0000ff">&gt;</font> #restaurantStyle <font color="#0000ff">&lt;/</font> <font color="#800000">styleUrl</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Point</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">coordinates</font> <font color="#0000ff">&gt;</font> -122.340141,47.608940 <font color="#0000ff">&lt;/</font> <font color="#800000">coordinates</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">Point</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">Placemark</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Placemark</font> <font color="#ff0000">id</font> <font color="#0000ff">= "placemark2"</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font> Buddha Thai <font color="#ff0000">&amp;</font> Bar <font color="#0000ff">&lt;/</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">description</font> <font color="#0000ff">&gt;</font> 2222 2nd Ave, Seattle, WA <font color="#0000ff">&lt;/</font> <font color="#800000">description</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">styleUrl</font> <font color="#0000ff">&gt;</font> #barStyle <font color="#0000ff">&lt;/</font> <font color="#800000">styleUrl</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Point</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">coordinates</font> <font color="#0000ff">&gt;</font> -122.344391,47.613590 <font color="#0000ff">&lt;/</font> <font color="#800000">coordinates</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">Point</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">Placemark</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Placemark</font> <font color="#ff0000">id</font> <font color="#0000ff">= "placemark3"</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font> The Melting Pot <font color="#0000ff">&lt;/</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">description</font> <font color="#0000ff">&gt;</font> 14 Mercer St, Seattle, WA <font color="#0000ff">&lt;/</font> <font color="#800000">description</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">styleUrl</font> <font color="#0000ff">&gt;</font> #restaurantStyle <font color="#0000ff">&lt;/</font> <font color="#800000">styleUrl</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Point</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">coordinates</font> <font color="#0000ff">&gt;</font> -122.356445,47.624561 <font color="#0000ff">&lt;/</font> <font color="#800000">coordinates</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">Point</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">Placemark</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Placemark</font> <font color="#ff0000">id</font> <font color="#0000ff">= "placemark4"</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font> Ipanema Grill <font color="#0000ff">&lt;/</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">description</font> <font color="#0000ff">&gt;</font> 1225 1st Ave, Seattle, WA <font color="#0000ff">&lt;/</font> <font color="#800000">description</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">styleUrl</font> <font color="#0000ff">&gt;</font> #restaurantStyle <font color="#0000ff">&lt;/</font> <font color="#800000">styleUrl</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Point</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">coordinates</font> <font color="#0000ff">&gt;</font> -122.337654,47.606365 <font color="#0000ff">&lt;/</font> <font color="#800000">coordinates</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">Point</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">Placemark</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Placemark</font> <font color="#ff0000">id</font> <font color="#0000ff">= "placemark5"</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font> Sake House <font color="#0000ff">&lt;/</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">description</font> <font color="#0000ff">&gt;</font> 2230 1st Ave, Seattle, WA <font color="#0000ff">&lt;/</font> <font color="#800000">description</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">styleUrl</font> <font color="#0000ff">&gt;</font> #barStyle <font color="#0000ff">&lt;/</font> <font color="#800000">styleUrl</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Point</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">coordinates</font> <font color="#0000ff">&gt;</font> -122.345673,47.612823 <font color="#0000ff">&lt;/</font> <font color="#800000">coordinates</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">Point</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">Placemark</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Placemark</font> <font color="#ff0000">id</font> <font color="#0000ff">= "placemark6"</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font> Crab Pot <font color="#0000ff">&lt;/</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">description</font> <font color="#0000ff">&gt;</font> 1301 Alaskan Way, Seattle, WA <font color="#0000ff">&lt;/</font> <font color="#800000">description</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">styleUrl</font> <font color="#0000ff">&gt;</font> #restaurantStyle <font color="#0000ff">&lt;/</font> <font color="#800000">styleUrl</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Point</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">coordinates</font> <font color="#0000ff">&gt;</font> -122.340363,47.605961 <font color="#0000ff">&lt;/</font> <font color="#800000">coordinates</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">Point</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">Placemark</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Placemark</font> <font color="#ff0000">id</font> <font color="#0000ff">= "placemark7"</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font> Mama's Mexican Kitchen <font color="#0000ff">&lt;/</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">description</font> <font color="#0000ff">&gt;</font> 2234 2nd Ave, Seattle, WA <font color="#0000ff">&lt;/</font> <font color="#800000">description</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">styleUrl</font> <font color="#0000ff">&gt;</font> #barStyle <font color="#0000ff">&lt;/</font> <font color="#800000">styleUrl</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Point</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">coordinates</font> <font color="#0000ff">&gt;</font> -122.345467,47.613976 <font color="#0000ff">&lt;/</font> <font color="#800000">coordinates</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">Point</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">Placemark</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Placemark</font> <font color="#ff0000">id</font> <font color="#0000ff">= "placemark8"</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font> Wingdome <font color="#0000ff">&lt;/</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">description</font> <font color="#0000ff">&gt;</font> 1416 E Olive Way, Seattle, WA <font color="#0000ff">&lt;/</font> <font color="#800000">description</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">styleUrl</font> <font color="#0000ff">&gt;</font> #barStyle <font color="#0000ff">&lt;/</font> <font color="#800000">styleUrl</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Point</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">coordinates</font> <font color="#0000ff">&gt;</font> -122.326584,47.617214 <font color="#0000ff">&lt;/</font> <font color="#800000">coordinates</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">Point</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">Placemark</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Placemark</font> <font color="#ff0000">id</font> <font color="#0000ff">= "placemark9"</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font> Piroshky Piroshky <font color="#0000ff">&lt;/</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">description</font> <font color="#0000ff">&gt;</font> 1908 Pike pl, Seattle, WA <font color="#0000ff">&lt;/</font> <font color="#800000">description</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">styleUrl</font> <font color="#0000ff">&gt;</font> #restaurantStyle <font color="#0000ff">&lt;/</font> <font color="#800000">styleUrl</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Point</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">coordinates</font> <font color="#0000ff">&gt;</font> -122.342834,47.610126 <font color="#0000ff">&lt;/</font> <font color="#800000">coordinates</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">Point</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">Placemark</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">Document</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">kml</font> <font color="#0000ff">&gt;</font></font> </blockquote><br>  <u>Create a line</u> <br>  One of the remarkable features of the database is the ability to combine the information contained in them.  For example, having the data on the coordinates, you can easily make the necessary sequence of them - a line.  Let's write a script that creates the structure of a single <code>&lt;Placemark&gt;</code> element.  <code>&lt;linestring&gt;</code> inside <code>&lt;Placemark&gt;</code> .  Then we will perform a query to the database and sample the coordinates by the <code>id</code> field. <br>  This is the PHP code that creates a line connecting all the restaurants: <br> <code><font color="#0000ff">&lt;?php <br> require('phpsqlajax_dbinfo.php'); <br> <br> <font color="#17c600">//    MySQL-</font> <br> $connection = mysql_connect ($server, $username, $password); <br> <br> if (!$connection) <br> { <br> die('  : ' . mysql_error()); <br> } <br> <br> <font color="#17c600">//   </font> <br> $db_selected = mysql_select_db($database, $connection); <br> <br> if (!$db_selected) <br> { <br> die ('   : ' . mysql_error()); <br> } <br> <br> <font color="#17c600">//       markers</font> <br> <br> $query = " SELECT GROUP_CONCAT(lng, ',', lat, ',', '100' separator ' ') AS coordinates FROM markers WHERE type = 'restaurant';"; <br> <br> $result = mysql_query($query); <br> if (!$result) <br> { <br> die(' : ' . mysql_error()); <br> } <br> <br> <font color="#17c600">//  KML-,   </font> <br> $dom = new DOMDocument('1.0','UTF-8'); <br> <font color="#17c600">//   KML     Document</font> <br> $node = $dom-&gt;createElementNS('http://earth.google.com/kml/2.1','kml'); <br> $parNode = $dom-&gt;appendChild($node); <br> <br> <font color="#17c600">//  Folder</font> <br> $fnode = $dom-&gt;createElement('Folder'); <br> $folderNode = $parNode-&gt;appendChild($fnode); <br> <br> <font color="#17c600">//   </font> <br> $row = @mysql_fetch_assoc($result); <br> <br> <font color="#17c600">//  Placemark</font> <br> $node = $dom-&gt;createElement('Placemark'); <br> $placeNode = $folderNode-&gt;appendChild($node); <br> <br> <font color="#17c600">//  id</font> <br> $placeNode-&gt;setAttribute('id','linestring1'); <br> <br> <font color="#17c600">//  name, description  adress</font> <br> $nameNode = $dom-&gt;createElement('name','My path'); <br> $placeNode-&gt;appendChild($nameNode); <br> $descNode= $dom-&gt;createElement('description', 'This is the path that I took through my favorite restaurants in Seattle'); <br> $placeNode-&gt;appendChild($descNode); <br> <br> <font color="#17c600">//  LineString</font> <br> $lineNode = $dom-&gt;createElement('LineString'); <br> $placeNode-&gt;appendChild($lineNode); <br> $exnode = $dom-&gt;createElement('extrude', '1'); <br> $lineNode-&gt;appendChild($exnode); <br> $almodenode =$dom-&gt;createElement(altitudeMode,'relativeToGround'); <br> $lineNode-&gt;appendChild($almodenode); <br> <br> <font color="#17c600">//  coordinates</font> <br> $coorNode = $dom-&gt;createElement('coordinates',$row['coordinates']); <br> $lineNode-&gt;appendChild($coorNode); <br> $kmlOutput = $dom-&gt;saveXML(); <br> <br> <font color="#17c600">//  KML</font> <br> header('Content-type: application/vnd.google-earth.kml+xml'); <br> echo $kmlOutput; <br> ?&gt;</font></code> <br>  You should get something like this: <br><blockquote>  <font color="black"><font color="#0000ff">&lt;?</font></font>  <font color="black"><font color="#800000">xml</font> <font color="#ff0000">version</font> <font color="#0000ff">= '1.0'</font> <font color="#ff0000">encoding</font> <font color="#0000ff">= 'UTF-8'</font> ?</font>  <font color="black"><font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">kml</font> <font color="#ff0000">xmlns</font> <font color="#0000ff">= 'http: //earth.google.com/kml/2.1'</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Folder</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Placemark</font> <font color="#ff0000">id</font> <font color="#0000ff">= 'linestring1'</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> path <font color="#0000ff">&gt;</font> my path <font color="#0000ff">&lt;/</font> <font color="#800000">name</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">description</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">LineString</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">extrude</font> <font color="#0000ff">&gt;</font> 1 <font color="#0000ff">&lt;/</font> <font color="#800000">extrude</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">altitudeMode</font> <font color="#0000ff">&gt;</font> relativeToGround <font color="#0000ff">&lt;/</font> <font color="#800000">altitudeMode</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">coordinates</font> <font color="#0000ff">&gt;</font> -122.340141,47.608940,100 -122.356445,47.624561,100</font> <font color="black"><br></font>  <font color="black">-122.337654,47.606365,100 -122.340363,47.605961,100</font> <font color="black"><br></font>  <font color="black">-122.342834,47.610126,100</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">coordinates</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">LineString</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">Placemark</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">Folder</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">kml</font> <font color="#0000ff">&gt;</font></font> </blockquote><br><h4>  Step 4: Display the KML file </h4><br>  <u>Mapping to Google Earth</u> <br>  You can easily and simply display this data in Google Earth.  The easiest way is to create a NetworkLink file pointing to the script.  If you frequently update the information, you can set the update time.  Here is an example of a file that will work as it should: <br><blockquote>  <font color="black"><font color="#0000ff">&lt;?</font></font>  <font color="black"><font color="#800000">xml</font> <font color="#ff0000">version</font> <font color="#0000ff">= '1.0'</font> <font color="#ff0000">encoding</font> <font color="#0000ff">= 'UTF-8'</font> ?</font>  <font color="black"><font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">kml</font> <font color="#ff0000">xmlns</font> = <font color="#0000ff">'http://earth.google.com/kml/2.1'</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Folder</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">NetworkLink</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Link</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">href</font> <font color="#0000ff">&gt;</font> http://example.com/phpsql_genkml.kml <font color="#0000ff">&lt;/</font> <font color="#800000">href</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">refreshMode</font> <font color="#0000ff">&gt;</font> onInterval <font color="#0000ff">&lt;/</font> <font color="#800000">refreshMode</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">refreshInterval</font> <font color="#0000ff">&gt;</font> 3600 <font color="#0000ff">&lt;/</font> <font color="#800000">refreshInterval</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">Link</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">Networklink</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">NetworkLink</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">Link</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">href</font> <font color="#0000ff">&gt;</font> http://example.com/phpsql_genkml_ls.kml <font color="#0000ff">&lt;/</font> <font color="#800000">href</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">refreshMode</font> <font color="#0000ff">&gt;</font> onInterval <font color="#0000ff">&lt;/</font> <font color="#800000">refreshMode</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">refreshInterval</font> <font color="#0000ff">&gt;</font> 3600 <font color="#0000ff">&lt;/</font> <font color="#800000">refreshInterval</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">Link</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">Networklink</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">Folder</font> <font color="#0000ff">&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">&lt;/</font> <font color="#800000">kml</font> <font color="#0000ff">&gt;</font></font> </blockquote><br>  The &lt;href&gt; element is responsible for locating the KML file on the server. <br><img alt="picture" src="http://g.codesite.articles.googlepages.com/mmarks-phpms-seattle_nl_example.jpg"><br>  To display this file in Google Maps, you need to add a link to this script or to the NetworkLink file.  For example: <br><blockquote>  <font color="black"><font color="#0000ff">function</font> load ()</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> map;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> geoXml;</font> <font color="black"><br><br></font>  <font color="black"><font color="#0000ff">if</font> (GBrowserIsCompatible ())</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black">map = <font color="#0000ff">new</font> GMap2 ( <font color="#0000ff">document</font> .getElementById ( <font color="#A31515">'map'</font> ));</font> <font color="black"><br></font>  <font color="black">map.addControl ( <font color="#0000ff">new</font> GSmallMapControl ());</font> <font color="black"><br></font>  <font color="black">map.addControl ( <font color="#0000ff">new</font> GMapTypeControl ());</font> <font color="black"><br></font>  <font color="black">geoXml = <font color="#0000ff">new</font> GGeoXml ( <font color="#A31515">'http://example.com/phpmysql_kmlnl.kml'</font> );</font> <font color="black"><br></font>  <font color="black">map.addOverlay (geoXml);</font> <font color="black"><br></font>  <font color="black">map.setCenter ( <font color="#0000ff">new</font> GLatLng (47.613976, -122.345467), 13);</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black">}</font> </blockquote><br>  The card should look something like this: <img alt="picture" src="http://g.codesite.articles.googlepages.com/mmarks-phpms-seattle_map_nl_example.png"><br><h4>  Step 5: What else can you think of </h4><br>  What else can be done with the existing database?  The databases are good, you can add any data to the database.  A format KML is good because it can dilute the contents of your cards.  If you combine it together, you can do something interesting. <br>  And it will turn out much better than if you used only KML.  Use some of the unique features of Google Earth, such as <code>&lt;NetworkLink&gt;</code> files, that use <code>&lt;viewFormat&gt;</code> .  This function allows you to send any parameters to your script.  You can also use this function to modify the returned data.  Or use <code>&lt;TimeStamp&gt;</code> or <code>&lt;TimeSpan&gt;</code> , which allow you to animate your tags.  You can also create a database table with a more complex structure, which will store data about polygons <code>&lt;Polygons&gt;</code> , which can also be displayed on the map.  Or create a page with which other people can also add new data to your card.  You have endless possibilities! </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/38448/">https://habr.com/ru/post/38448/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../38443/index.html">We make ourselves simple hours over the weekend.</a></li>
<li><a href="../38444/index.html">Tips for CMS developers and PHP frameworks</a></li>
<li><a href="../38445/index.html">3 Mall</a></li>
<li><a href="../38446/index.html">Does the computer ‚Äúslow down‚Äù? - it's nothing you can do‚Ä¶</a></li>
<li><a href="../38447/index.html">Kohana Framework - Impressions of Usage</a></li>
<li><a href="../38449/index.html">"What would Jesus do?"</a></li>
<li><a href="../38452/index.html">Fantasy client or who works in a hosting company</a></li>
<li><a href="../384543/index.html">Undocumented Mastertronics board features. Part 2: MC2 3D Printer</a></li>
<li><a href="../38457/index.html">ASP.NET MVC Preview 5 released</a></li>
<li><a href="../38460/index.html">M.video: a full-fledged laptop with Windows Vista is cheaper than 10 000 rubles?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>