<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Use lambdas to animate WPF</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Creating a graphic primitive and animating it, for example, moving it from point A to point B at a constant speed is a simple matter. But what if you ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Use lambdas to animate WPF</h1><div class="post__text post__text-html js-mediator-article">  Creating a graphic primitive and animating it, for example, moving it from point A to point B at a constant speed is a simple matter.  But what if you need to arrange several objects in a certain sequence and then animate them nonlinearly?  For this, neither WPF nor Silverlight has any built-in functions.  In this essay, I will show how you can create objects and animations dynamically using lambda delegates and higher-order functions. <br><br><a name="habracut"></a><br><h4>  Generation </h4><br>  Suppose you need to create (and animate) something like this: <br><br><img src="http://spbalt.net/temp/spiral.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In principle, it is possible to manage with cycles, but if there is an opportunity to make everything tidier and clearer, ‚Äúin one line‚Äù, then why not use it?  Let's start with a simple one - a set of circles is obviously a collection, so we will create a class that will store links to all objects: <br><br><pre> public class LambdaCollection &lt;T&gt;: Collection &lt;T&gt; where T: DependencyObject, new ()
 {
   public LambdaCollection (int count) {while (count -&gt; 0) Add (new T ());  }
   ‚ãÆ
 }
</pre><br>  While everything is quiet - we simply defined a collection that is limited by the type of content (must inherit from <code>DependencyObject</code> and have a default constructor), and added a constructor that creates a certain number of objects we need.  And now the most interesting thing is that we add a method that can initialize the properties of <code>T</code> objects using lambda delegates: <br><br><pre> public class LambdaCollection &lt;T&gt;: Collection &lt;T&gt; where T: DependencyObject, new ()
 {
   ‚ãÆ
   public LambdaCollection &lt;T&gt; WithProperty &lt;U&gt; (DependencyProperty property, Func &lt;int, U&gt; generator)
   {
     for (int i = 0; i &lt;Count; ++ i)
       this [i] .SetValue (property, generator (i));
     return this;
   }
 }
</pre><br>  Then you should stop and see what happens.  First of all, this is a fluent interface, because it says <code>return this</code> at the end.  He himself takes two parameters.  The first parameter is the property that we want to change <em>in all elements of the collection</em> .  This seriously simplifies life as it is not necessary to write cycles everywhere.  The second parameter is a reference to <em>a</em> value <em>generator</em> ‚Äî that is, a function that takes an index of an item in the collection and returns a value of type <code>U</code>  And the tim itself can be anything, the main thing is that it fits the property. <br><br>  Attention: there is no automatic type conversion here, so if the property type is <code>double</code> , you cannot generate <code>int</code> type values, you will get an exception. <br><br>  How to use it?  Yes, very simple.  For example, to create ten circles of increasing size, we write the following: <br><br><pre> var circles = new LambdaCollection &lt;Ellipse&gt; (10)
   .WithProperty (WidthProperty, i =&gt; 1.5 * (i + 1))
   .WithProperty (HeightProperty, i =&gt; 1.5 * (i + 1));
</pre><br>  This expression allows us to make the diameter dependent on the position of the element.  In our case, it will be 1.5 pixels for the smallest element, and 15 for the largest.  Moreover, as can be seen from the code, you can vary the width and height independently. <br><br>  Since changing the X and Y coordinates is often necessary, you can write a useful method that will simplify the task: <br><br><pre> public class LambdaCollection &lt;T&gt;: Collection &lt;T&gt; where T: DependencyObject, new ()
 {
   ‚ãÆ
   public LambdaCollection &lt;T&gt; WithXY &lt;U&gt; (Func &lt;int, U&gt; xGenerator, Func &lt;int, U&gt; yGenerator)
   {
     for (int i = 0; i &lt;Count; ++ i)
     {
       this [i] .SetValue (Canvas.LeftProperty, xGenerator (i));
       this [i] .SetValue (Canvas. TopProperty, yGenerator (i));
     }
     return this;
   }
 }
</pre><br>  And now let's take all this together and create the picture that we showed at the beginning: <br><br><pre> int count = 20;
 var circles = new LambdaCollection &lt;Ellipse&gt; (count)
   .WithXY (i =&gt; 100.0 + (4.0 * i * Math.Sin (i / 4.0 * (Math.PI))),
           i =&gt; 100.0 + (4.0 * i * Math.Cos (i / 4.0 * (Math.PI))))
   .WithProperty (WidthProperty, i =&gt; 1.5 * i)
   .WithProperty (HeightProperty, i =&gt; 1.5 * i)
   .WithProperty (Shape.FillProperty, i =&gt; new SolidColorBrush (
     Color.FromArgb (255, 0, 0, (byte) (255 - (byte) (12.5 * i)))));
 foreach (var circle in circles)
   MyCanvas.Children.Add (circle);
</pre><br>  That's all - using a couple of methods you can very easily create different "constellations" of elements.  Now look at the animation. <br><br><h4>  Animation </h4><br>  Linear animation like <code>DoubleAnimation</code> is boring.  It is much more interesting when we ourselves control the value of an element.  If we take this type for an example, then it is very easy to redefine it so that the animated value is controlled by our generator: <br><br><pre> public class LambdaDoubleAnimation: DoubleAnimation
 {
   public Func &lt;double, double&gt; ValueGenerator {get;  set;  }
   protected override double GetCurrentValueCore (double origin, double dst, AnimationClock clock)
   {
     return ValueGenerator (base.GetCurrentValueCore (origin, dst, clock));
   }
 }
</pre><br>  Now we have a class that does linear interpolation for us, and we in turn can get the transformed value and do something with it. <br><br>  Since we are working with collections, again, we can use the ability to create a set of such animated objects.  Just such a class: <br><br><pre> public class LambdaDoubleAnimationCollection: Collection &lt;LambdaDoubleAnimation&gt;
 {
   ‚ãÆ
   public LambdaDoubleAnimationCollection (int count, Func &lt;int, double&gt; from, Func &lt;int, double&gt; to,
     Func &lt;int, Duration&gt; duration, Func &lt;int, Func &lt;double, double &gt;&gt; valueGenerator)
   {
     for (int i = 0; i &lt;count; ++ i)
     {
       var lda = new LambdaDoubleAnimation
       {
         From = from (i), 
         To = to (i), 
         Duration = duration (i)
         ValueGenerator = valueGenerator (i)
       };
       Add (lda);
     }
   }
   public void BeginApplyAnimation (UIElement [] targets, DependencyProperty property)
   {
     for (int i = 0; i &lt;Count; ++ i)
       targets [i] .BeginAnimation (property, Items [i]);
   }
 }
</pre><br>  There are several constructors, only one of them is shown above.  Parameters are generators of values, that is, all animation parameters can also be derived from the position of an element in the collection.  The <code>valueGenerator</code> parameter expects a 2nd order function, or a ‚Äúfunction generator function,‚Äù that is, a generator that depends on the index in the collection and whose value depends on the interpolated <code>double</code> value during the animation.  In C #, this means that a ‚Äúdouble lambda‚Äù must be passed here, for example, <code>i =&gt; j =&gt; f(j)</code> . <br><br>  Here is a simple example: unwrap our spiral in a sine wave: <br><br><pre> var c = new LambdaDoubleAnimationCollection (
   circles.Count, 
   i =&gt; 10.0 * i, 
   i =&gt; new Duration (TimeSpan.FromSeconds (2)),
   i =&gt; j =&gt; 100.0 / j);
 c.BeginApplyAnimation (circles.Cast &lt;UIElement&gt; (). ToArray (), Canvas.LeftProperty);
</pre><br>  The only trouble here is the lack of covariance.  It is because of this that we cannot pass circles as a parameter - we have to convert to <code>UIElement[]</code> .  And the array is chosen precisely because you want to know the length right away - although you could use <code>IEnumerable</code> . <br><br>  The animation itself does not show, here is its final phase - a kind of spiral "from the side." <br><br><img src="http://spbalt.net/temp/sinewave.png"><br><br><h4>  Extensions </h4><br>  Expanding our small framework is easy.  Our elements are animated in parallel, but do we need everything to be consistent?  No problem - just slightly change the <code>LambdaDoubleAnimationCollection</code> : <br><br><pre> public class LambdaDoubleAnimationCollection: Collection &lt;LambdaDoubleAnimation&gt;
 {
   ‚ãÆ
   public void BeginApplyAnimation (UIElement [] targets, DependencyProperty property)
   {
     for (int i = 0; i &lt;Count; ++ i)
     {
       Items [i] .BeginTime = new TimeSpan (0);
       targets [i] .BeginAnimation (property, Items [i]);
     }
   }
   public void BeginSequentialAnimation (UIElement [] targets, DependencyProperty property)
   {
     TimeSpan acc = new TimeSpan (0);
     for (int i = 0; i &lt;Items.Count; ++ i)
     {
       Items [i] .BeginTime = acc;
       acc + = Items [i] .Duration.TimeSpan;
     }
     for (int i = 0; i &lt;Count; ++ i)
     {
       targets [i] .BeginAnimation (property, Items [i]);
     }
   }
 }
</pre><br>  The same with other elements.  Good luck! <br><br> <a href="http://spbalt.net/"><img src="http://nesteruk.org/pix/spbalt.net.png" alt="St. Petersburg ALT.NET Group" title="St. Petersburg ALT.NET Group" width="100" height="32"></a> <br></div><p>Source: <a href="https://habr.com/ru/post/57236/">https://habr.com/ru/post/57236/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../57226/index.html">InnoDB transactions</a></li>
<li><a href="../57227/index.html">Anticrisis proposal for coworking</a></li>
<li><a href="../57228/index.html">6 must-have Linux distributions</a></li>
<li><a href="../57231/index.html">Another novelty from the Japanese</a></li>
<li><a href="../57233/index.html">Google offers Koreans to change their country of residence</a></li>
<li><a href="../57237/index.html">Twitter has been attacked by XSS worms</a></li>
<li><a href="../57238/index.html">VKontakte and commercial application development</a></li>
<li><a href="../57239/index.html">Do I need ratings on movie websites?</a></li>
<li><a href="../57240/index.html">Hello community</a></li>
<li><a href="../57241/index.html">Webasyst Shop-script Programmer Quick Reference Guide (Updated)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>