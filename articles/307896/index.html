<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How I Invented the Bike, or My First MEAN Project</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today, in the period of rapid development of web technologies, an experienced front-end developer should always remain in trend, each day deepening th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How I Invented the Bike, or My First MEAN Project</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/2fe/aab/fe7/2feaabfe70014514a94e0d2eb78616f1.png"></div><br><p>  Today, in the period of rapid development of web technologies, an experienced front-end developer should always remain in trend, each day deepening their knowledge.  And what if you are just starting your journey in the world of the web?  You have already been ill with the layout and do not want to stop there.  You are drawn to the mysterious world of JavaScript!  If this is about you, I hope this article will have to be. </p><a name="habracut"></a><br><p>  Having a one and a half year experience behind me as a front-end developer, I, tired of the monotonous layout of the next ordinary project, set out to deepen my knowledge of web programming.  I had a desire to create my first single page application.  The choice of technology stack was obvious, since I was always not indifferent to Node.js, the MEAN methodology was what the doctor prescribed. </p><br><p>  Today, there are countless different tutorials on the Internet, in which many helloworld, todo, management agency, etc. applications are created.  But just mindlessly following the steps of the tutorial is not my choice.  I decided to create a kind of messenger: an application with the ability to register new users, create dialogues between them, communicate with the chat-bot for test users.  And so, having carefully thought out the action plan, I set to work. </p><br><p>  Next, my story will describe the main points of creating this application, and for greater clarity, <a href="https://chappie-messenger.herokuapp.com/">I will leave the demo here</a> ( <a href="https://github.com/AndreyKrupskii/chappie-messenger">link to github</a> ). </p><br><p>  <i>* I also want to note that the purpose of this article, perhaps, is to help students learn not to step on the rake, which I arrived at the time, and to enable more experienced developers to view the code and express their opinions in the comments.</i> </p><br><p>  We draw up a plan of action: </p><br><ol><li>  Preparatory work </li><li>  Creating an authorization system </li><li>  Chat on Angular2 and Socket.io </li></ol><br><h3>  Preparatory work </h3><br><p>  Workplace preparation is an integral process of any development, and high-quality implementation of this task is the key to success in the future.  First of all, you need to install Express and configure a uniform configuration system for our project.  If the first and so everything is clear, then I will focus on the second in more detail. </p><br><p>  And so, we will use the remarkable <b>nconf</b> module.  Let's create a folder called config, and in its index file write: </p><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> nconf = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'nconf'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> path = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>); nconf.argv() .env() .file({ <span class="hljs-attr"><span class="hljs-attr">file</span></span>: path.join(__dirname, <span class="hljs-string"><span class="hljs-string">'./config.json'</span></span>) }); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = nconf;</code> </pre> <br><p>  Next, in this folder, create a file called config.json and make the first configuration in it - the port that our application listens to: </p><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"port"</span></span>: <span class="hljs-number"><span class="hljs-number">2016</span></span> }</code> </pre> <br><p>  To embed this setting in the application, you need nothing at all, write one / two lines of code: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> config = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./config'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> port = process.env.PORT || config.get(<span class="hljs-string"><span class="hljs-string">'port'</span></span>); app.set(<span class="hljs-string"><span class="hljs-string">'port'</span></span>, port);</code> </pre> <br><p>  But it is worth noting that this will work in case the port is defined in this way: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> server = http.createServer(app); server.listen(app.get(<span class="hljs-string"><span class="hljs-string">'port'</span></span>));</code> </pre> <br><p>  Our next task is to set up a unified logging system in our application.  As the author of the article <a href="https://habrahabr.ru/post/209436/">"About logging in Node.js"</a> wrote: </p><br><blockquote>  It is necessary to write to logs both a lot and a little.  So little to understand the state of the application now, and so much so that, if the application collapses, understand why. </blockquote><p>  For this task we will use the <b>winston</b> module: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> winston = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'winston'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> env = process.env.NODE_ENV; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLogger</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">module</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> path = <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.filename.split(<span class="hljs-string"><span class="hljs-string">'\\'</span></span>).slice(<span class="hljs-number"><span class="hljs-number">-2</span></span>).join(<span class="hljs-string"><span class="hljs-string">'/'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> winston.Logger({ <span class="hljs-attr"><span class="hljs-attr">transports</span></span>: [ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> winston.transports.Console({ <span class="hljs-attr"><span class="hljs-attr">level</span></span>: env == <span class="hljs-string"><span class="hljs-string">'development'</span></span> ? <span class="hljs-string"><span class="hljs-string">'debug'</span></span> : <span class="hljs-string"><span class="hljs-string">'error'</span></span>, <span class="hljs-attr"><span class="hljs-attr">showLevel</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">colorize</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">label</span></span>: path }) ] }); } <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = getLogger;</code> </pre> <br><p>  Of course, the setting may be more flexible, but at this stage it will be enough for us.  To use our newly created logger, you just need to connect this module to your work file and call it in the right place: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> log = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./libs/log'</span></span>)(<span class="hljs-built_in"><span class="hljs-built_in">module</span></span>); log.info(<span class="hljs-string"><span class="hljs-string">'Have a nice day =)'</span></span>);</code> </pre> <br><p>  Our next task will be setting up proper error handling for normal and ajax requests.  To do this, we will make some changes to the code that was previously generated by Express (in the example, only the development error handler is specified): </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// development error handler if (app.get('env') === 'development') { app.use(function(err, req, res, next) { res.status(err.status || 500); if(res.req.headers['x-requested-with'] == 'XMLHttpRequest'){ res.json(err); } else{ // will print stacktrace res.render('error', { message: err.message, error: err }); } }); }</span></span></code> </pre> <br><p>  We have almost finished with the preparatory work, one small, but not unimportant detail remained: to adjust the work with the database.  First of all, we will configure the connection to MongoDB using the <b>mongoose</b> module: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mongoose = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'mongoose'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> config = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../config'</span></span>); mongoose.connect(config.get(<span class="hljs-string"><span class="hljs-string">'mongoose:uri'</span></span>), config.get(<span class="hljs-string"><span class="hljs-string">'mongoose:options'</span></span>)); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = mongoose;</code> </pre> <br><p>  In <i>mongoose.connect,</i> we pass two arguments: <i>uri</i> and <i>options</i> , which I registered in advance in the config (for more information, see the <a href="http://mongoosejs.com/docs/connections.html">documentation for the module</a> ). </p><br><p>  I will not describe the process of creating user models and dialogues, since a similar process was perfectly described by the author of the web resource <a href="https://learn.javascript.ru/">learn.javascript.ru</a> in his Node.js screencast in the video tutorial " <a href="https://www.youtube.com/watch%3Fv%3DE9V1zTGKRfY%26list%3DPLDyvV36pndZFWfEQpNixIHVvp191Hb3Gg%26index%3D35">Create a model for the user / Mongoose Basics</a> ", just to mention that the user will have properties such as username, hashedPassword, salt, dialogs and created.  The dialogs property, in turn, will return an object: the key is the interlocutor id, the value is the dialog id. </p><br><p>  If someone is still interested to look at the code of these models: </p><br><div class="spoiler">  <b class="spoiler_title">users.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mongoose = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../libs/mongoose'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Schema = mongoose.Schema; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> crypto = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'crypto'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> userSchema = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Schema({ <span class="hljs-attr"><span class="hljs-attr">username</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-attr"><span class="hljs-attr">unique</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">required</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-attr"><span class="hljs-attr">hashedPassword</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-attr"><span class="hljs-attr">required</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-attr"><span class="hljs-attr">salt</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-attr"><span class="hljs-attr">required</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-attr"><span class="hljs-attr">dialogs</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: Schema.Types.Mixed, <span class="hljs-attr"><span class="hljs-attr">default</span></span>: {<span class="hljs-attr"><span class="hljs-attr">defaulteDialog</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>} }, <span class="hljs-attr"><span class="hljs-attr">created</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>, <span class="hljs-attr"><span class="hljs-attr">default</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>.now } }); userSchema.methods.encryptPassword = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">password</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> crypto.createHmac(<span class="hljs-string"><span class="hljs-string">'sha1'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.salt).update(password).digest(<span class="hljs-string"><span class="hljs-string">'hex'</span></span>); }; userSchema.methods.checkPassword = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">password</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.encryptPassword(password) === <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.hashedPassword; } userSchema.virtual(<span class="hljs-string"><span class="hljs-string">'password'</span></span>) .set(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">password</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._plainPassword = password; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.salt = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.random() + <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.hashedPassword = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.encryptPassword(password); }) .get(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._plainPassword; }); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = mongoose.model(<span class="hljs-string"><span class="hljs-string">'User'</span></span>, userSchema);</code> </pre> </div></div><div class="spoiler">  <b class="spoiler_title">dialogs.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mongoose = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../libs/mongoose'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Schema = mongoose.Schema; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> dialogSchema = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Schema({ <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: [], <span class="hljs-attr"><span class="hljs-attr">required</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }) <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = mongoose.model(<span class="hljs-string"><span class="hljs-string">'Dialog'</span></span>, dialogSchema);</code> </pre> </div></div><br><p>  All that remains is nothing - to screw the sessions to the backbone of our application.  To do this, create a session.js file and plug in such modules as <b>express-session</b> , <b>connect-mongo</b> , and the module we created from the <b>mongoose.js</b> file: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mongoose = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./mongoose'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> session = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express-session'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MongoStore = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'connect-mongo'</span></span>)(session); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = session({ <span class="hljs-attr"><span class="hljs-attr">secret</span></span>: <span class="hljs-string"><span class="hljs-string">'My secret key!'</span></span>, <span class="hljs-attr"><span class="hljs-attr">resave</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">saveUninitialized</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">cookie</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">maxAge</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">httpOnly</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">path</span></span>: <span class="hljs-string"><span class="hljs-string">'/'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">store</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MongoStore({<span class="hljs-attr"><span class="hljs-attr">mongooseConnection</span></span>: mongoose.connection}) })</code> </pre> <br><p>  Making this setting in a separate file is important, but not necessary.  This will provide an opportunity to further reconcile the sessions and web-files with each other without difficulty.  Now connect this module to app.js: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> session = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./libs/session'</span></span>); app.use(session);</code> </pre> <br><p>  What is more, <i>app.use (session)</i> must be specified after <i>app.use (cookieParser ())</i> in order for the cookie to be read.  Everything!  Now we have the ability to save sessions to our database. </p><br><p>  And this preparatory work is over.  It's time to get to the fun part! </p><br><h3>  Creating an authorization system </h3><br><p>  Creation of an authorization system will be divided into two main stages: front end and back end.  Since, starting up this application, I was going to learn something new all the time, and with Angular1.x I already had experience, the front end decided to organize on Angular2.  The fact that when I created the application, the fourth (and now the fifth) pre-release version of this framework had already been released, gave me confidence that the release would be around the corner.  And so, collecting my thoughts, I sat down to write authorization. </p><br><p>  For guys who have not yet encountered development on Angular2, please do not be surprised if in the code below you will find javascript syntax not known to you earlier.  The thing is that the whole Angular2 is built on typescript.  And no, this does not mean that it is impossible to work with this framework using regular javascript!  Here for example a great <a href="https://medium.com/angular-2-with-es6/angular-2-with-es6-the-5-minute-quickstart-a9e4eb0bffcc">article</a> , during which the author considers the development of Angular2 using ES6. </p><br><p>  But typescript is javascript, which scales.  Being a compiled javascript superset, this language adds to it all features from ES6 &amp; ES7, a real OOP with blackjack and classes, strict typification and many more cool pieces.  And there is nothing to be afraid of: after all, everything that is valid in javascript will work in typescript! </p><br><p>  First of all, create the user-authenticate.service.ts file, it will contain the authorization service: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Injectable } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@angular/core'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Http, Headers } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@angular/http'</span></span>; @Injectable() <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserAuthenticateService</span></span></span></span>{ private authenticated = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(private http: Http) {} }</code> </pre> <br><p>  Further, inside our class, we will create several methods: login, logout, singup, isLoggedIn.  All these methods are of the same type: each one performs its task of sending a request of the type post to the appropriate address.  It is not difficult to guess what logical load each of them carries.  Consider the login method code: </p><br><pre> <code class="javascript hljs">login(username, password) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> self = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> headers = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Headers(); headers.append(<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>, <span class="hljs-string"><span class="hljs-string">'application/json'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.http .post( <span class="hljs-string"><span class="hljs-string">'authentication/login'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify({ username, password }), { headers }) .map(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">res</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> answer = res.json(); self.authenticated = answer.authenticated; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> answer; }); }</code> </pre> <br><p>  To call this method from the Angular2 component, you need to embed this service into the corresponding component: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { UserAuthenticateService } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../services/user-authenticate.service'</span></span>; @Component({ ... }) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SingInComponent</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(private userAuthenticateService: UserAuthenticateService, private router: Router){ ... } onSubmit() { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> self = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> username = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.form.name.value; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> password = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.form.password.value; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.userAuthenticateService .login(username, password) .subscribe(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">result</span></span></span><span class="hljs-function">) </span></span>{ self.onSubmitResult(result); }); } }</code> </pre> <br><p>  It should be noted: to get access to the same instance of the service from different components, it needs to be embedded in a common parent component. </p><br><p>  And with this we end the frontend with the creation of an authorization system. </p><br><p>  Starting backend development, I recommend that you familiarize yourself with the interesting <b>async</b> module (module <a href="http://caolan.github.io/async/">documentation</a> ).  It will become a powerful tool in your arsenal for working with asynchronous javascript functions. </p><br><p>  Let's create an authentication.js file in the existing routes directory.  Now we specify the given middleware in app.js: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> authentication = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./routes/authentication'</span></span>); app.use(<span class="hljs-string"><span class="hljs-string">'/authentication'</span></span>, authentication);</code> </pre> <br><p>  Next, simply create a handler for the request post to the address authentication / login.  In order not to write a long sheet from various if ... else, we use the waterfall method from the above-mentioned <b>async</b> module.  This method allows you to perform a collection of asynchronous tasks in order, passing the results of the previous task to the arguments of the following, and execute some useful callback at the output.  Let's now and write this callback: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> express = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> router = express.Router(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> User = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../models/users'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Response = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../models/response'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'async'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> log = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../libs/log'</span></span>)(<span class="hljs-built_in"><span class="hljs-built_in">module</span></span>); router.post(<span class="hljs-string"><span class="hljs-string">'/login'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res, next</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">async</span></span>.waterfall([ ... ], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, results</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> authResponse = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Response(req.session.authenticated, {}, err); res.json(authResponse); }) }</code> </pre> <br><p>  For my own convenience, I prepared the Response constructor in advance: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Response = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">authenticated, data, authError</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.authenticated = authenticated; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data = data; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.authError = authError; } <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = Response;</code> </pre> <br><p>  It remains for us only to write the functions in the order we need into the array passed by the first argument in async.waterfall.  Let's create these same functions: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findUser</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">callback</span></span></span><span class="hljs-function">)</span></span>{ User.findOne({<span class="hljs-attr"><span class="hljs-attr">username</span></span>: req.body.username}, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, user</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(err) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> next(err); (user) ? callback(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, user) : callback(<span class="hljs-string"><span class="hljs-string">'username'</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkPassword</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">user, callback</span></span></span><span class="hljs-function">)</span></span>{ (user.checkPassword(req.body.password)) ? callback(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, user) : callback(<span class="hljs-string"><span class="hljs-string">'password'</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveInSession</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">user, callback</span></span></span><span class="hljs-function">)</span></span>{ req.session.authenticated = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; req.session.userId = user.id; callback(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); }</code> </pre> <br><p>  Briefly I will describe what is going on here: we are looking for a user in the database, if there is no such user, we call a colbek with a 'username' error, in the case of a successful search, we transfer the user to the colbek;  call the checkPassword method, again, if the password is correct, transfer the user to the callback, otherwise call the callback with the error 'password';  then save the session to the database and call the final callback. </p><br><p>  That's all!  Now users of our application have the ability to authorize. </p><br><h3>  Chat on Angular2 and Socket.io </h3><br><p>  We have come to the writing of a function that carries the main meaning of our application.  In this section, we will organize an algorithm for connecting to chat rooms (chat-rooms) and the function of sending / receiving messages.  To do this, we will use the <b>Socket.io</b> library, which makes it very easy to implement data exchange between the browser and the server in real time. </p><br><p>  Create a file sockets.js and connect this module to bin / www (Express input file): </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> io = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../sockets/sockets'</span></span>)(server);</code> </pre> <br><p>  Since <b>Socket.io</b> works with the web-sockets protocol, we need to think of a way to transfer the current user session to it.  To do this, write the file sockets.js already created by us: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> session = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../libs/session'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">server</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> io = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'socket.io'</span></span>).listen(server); io.use(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">socket, next</span></span></span><span class="hljs-function">) </span></span>{ session(socket.handshake, {}, next); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> io; });</code> </pre> <br><p>  <b>Socket.io is</b> built in such a way that the browser and the server exchange various events all the time: the browser generates events that the server responds to and <b>vice versa</b> , the server generates events that the browser responds to.  Let's write client-side event handlers: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Component } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@angular/core'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Router } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@angular/router'</span></span>; declare <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> io: any; @Component({ ... }) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ChatFieldComponent</span></span></span><span class="hljs-class"> </span></span>{ socket: any; <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(private router: Router, private userDataService: UserDataService){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.socket = io.connect(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.socket.on(<span class="hljs-string"><span class="hljs-string">'connect'</span></span>, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.joinDialog()); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.socket.on(<span class="hljs-string"><span class="hljs-string">'joined to dialog'</span></span>, (data) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getDialog(data)); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.socket.on(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, (data) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getMessage(data)); } }</code> </pre> <br><p>  In the code above, we created three event handlers: connect, joined to dialog, message.  Each of them calls the corresponding function.  So, the connect event calls the joinDialog () function, which in turn generates the join dialog server event, with which the interlocutor id is passed. </p><br><pre> <code class="javascript hljs">joinDialog(){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.socket.emit(<span class="hljs-string"><span class="hljs-string">'join dialog'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.userDataService.currentOpponent._id); }</code> </pre> <br><p>  Further, everything is simple: the event to the dialog receives an array with user messages, the message event adds new messages to the above mentioned array. </p><br><pre> <code class="javascript hljs">getDialog(data) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dialog = data; getMessage(data) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dialog.push(data);</code> </pre> <br><p>  In order not to return to the frontend in the future, let's create a function that will send user messages: </p><br><pre> <code class="javascript hljs">sendMessage($event){ $event.preventDefault(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.messageInputQuery !== <span class="hljs-string"><span class="hljs-string">''</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.socket.emit(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.messageInputQuery); } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.messageInputQuery = <span class="hljs-string"><span class="hljs-string">''</span></span>; }</code> </pre> <br><p>  This function generates a message event with which it sends the text of the sent message. </p><br><p>  The case remains for small - to write event handlers on the server side! </p><br><pre> <code class="javascript hljs">io.on(<span class="hljs-string"><span class="hljs-string">'connection'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">socket</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> currentDialog, currentOpponent; socket.on(<span class="hljs-string"><span class="hljs-string">'join dialog'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ ... }); socket.on(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">)</span></span>{ ... }); })</code> </pre> <br><p>  In the variables currentDialog and currentOpponent we will save the identifiers of the current dialogue and the interlocutor. </p><br><p>  Let's start writing the dialogue connection algorithm.  To do this, we use the <b>async</b> library, namely the above-mentioned watterfall method.  The order of our actions: </p><br><div class="spoiler">  <b class="spoiler_title">Leave the previous dialog:</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">leaveRooms</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">callback</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//         for(let room in socket.rooms){ socket.leave(room) } //      callback(null); }</span></span></code> </pre> </div></div><div class="spoiler">  <b class="spoiler_title">To get from the database of the user and his interlocutor:</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findCurrentUsers</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">callback</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     : // -    // -    async.parallel([findCurrentUser, findCurrentOpponent], function(err, results){ if (err) callback(err); //    ,      callback(null, results[0], results[1]); }) }</span></span></code> </pre> </div></div><div class="spoiler">  <b class="spoiler_title">Connect to existing / create new dialog:</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDialogId</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">user, opponent, callback</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//       if (user.dialogs[currentOpponent]) { let dialogId = user.dialogs[currentOpponent]; //    Id ,      callback(null, dialogId); } else{ //    : // -   // -      async.waterfall([createDialog, saveDialogIdToUser], function(err, dialogId){ if (err) callback(err); //    Id ,      callback(null, dialogId); }) } }</span></span></code> </pre> </div></div><div class="spoiler">  <b class="spoiler_title">Get message history:</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDialogData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dialogId, callback</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//       Dialog.findById(dialogId, function(err, dialog){ if (err) callback('Error in connecting to dialog'); //    ,      callback(null, dialog); }) }</span></span></code> </pre> </div></div><div class="spoiler">  <b class="spoiler_title">Calling the above functions, the global callback:</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     async.waterfall([ leaveRooms, findCurrentUsers, getDialogId, getDialogData ], //   function(err, dialog){ if (err) log.error(err); currentDialog = dialog; //     socket.join(currentDialog.id); //   joined to dialog,       io.sockets.connected[socket.id].emit('joined to dialog', currentDialog.data); } )</span></span></code> </pre> </div></div><br><p>  On this, the dialog connection algorim is complete, the only thing left is to write a handler for the message event: </p><br><pre> <code class="javascript hljs">socket.on(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> message = data; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> currentUser = socket.handshake.session.userId; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> newMessage = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Message(message, currentUser); currentDialog.data.push(newMessage); currentDialog.markModified(<span class="hljs-string"><span class="hljs-string">'data'</span></span>); currentDialog.save(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err) log.error(<span class="hljs-string"><span class="hljs-string">'Error in saveing dialog =('</span></span>); io.to(currentDialog.id).emit(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, newMessage); }) })</code> </pre> <br><p>  In this sample code, we saved the message text and user ID into variables, then, using the previously created Message constructor, created a new message object, added it to the array and, saving the updated dialog to the database, generated the message event in the room with which we passed message. </p><br><p>  That's all our application is ready! </p><br><h3>  Conclusion </h3><br><p>  Heh, did you still read it ?!  Despite the volume of the article, I did not have time to review all the details of creating the application, since my capabilities are limited by this format.  But doing this work, I not only greatly deepened my knowledge in the field of web programming, but also received a lot of pleasure from the work done.  Guys, never be afraid to take on something new, difficult, because if you carefully approach the matter, gradually sorting out the pop-up questions, even with zero experience at the start, you can create something really good! </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/307896/">https://habr.com/ru/post/307896/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../307884/index.html">DotNext 2016 Moscow: 8 MVP, StackOverflow and a bit of hardcore</a></li>
<li><a href="../307886/index.html">To the question of the operating point of the LED and (suddenly) import substitution</a></li>
<li><a href="../307890/index.html">Working with screen states in Xamarin.Forms</a></li>
<li><a href="../307892/index.html">Organization of work with Email in the CRM system</a></li>
<li><a href="../307894/index.html">Voice biometrics in the contact center of the bank. Introduction case</a></li>
<li><a href="../307898/index.html">Rockett Bank jeopardized customer personal data and bank card data</a></li>
<li><a href="../307900/index.html">Dino Esposito at uDev Tech Events: "Life as a Service: Scalability and other Aspects"</a></li>
<li><a href="../307902/index.html">Convert a regular class to a strangely repeating pattern.</a></li>
<li><a href="../307904/index.html">Reducing the temperature in the data center - new research of a number of companies</a></li>
<li><a href="../307908/index.html">Cyclic causality diagram as a tool for modeling complex systems</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>