<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Revision # 1. The key to start</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello to all! 

 For quite a while there was no news from us ‚Äî they turned the charts and drawings of the server into real hardware. Now we have a wor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Revision # 1. The key to start</h1><div class="post__text post__text-html js-mediator-article">  Hello to all! <br><br>  For quite a while there was no news from us ‚Äî they turned the charts and drawings of the server into real hardware.  Now we have a working first revision, and on the eve of the May holidays, you can be pleased with the story, what our developers have been doing for the last six months.  And of course, to show the result - in this article for the first time we will publish photos, and not just diagrams and models. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/0da/a64/b9a/0daa64b9a7294a82a0e6ae67c24d8fbd.jpg" alt="image"></div><br>  <i>Raisers with memory in the first revision of our server.</i> <br><a name="habracut"></a><br>  We did a lot: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  We completed the tracing and made samples of motherboards, control boards and memory raiser boards. </li><li>  We developed and sent to production PCI switch boards, boards for fans and display boards and interfaces (with buttons, connectors and LEDs). </li><li>  We developed and launched into production power distribution boards from CRPS sources and backplanes for NVMe disks. </li><li>  After the arrival of the first samples, the debugging of the motherboard, the control board and the memory riser went through. </li><li>  We finished the server case - during the design of the boards small changes were required in several places. </li></ul><br>  Then I will tell you about each topic in turn, and for each I will drop fresh portions of stylish engineering graphics and photos.  Thanks to a fellow programmer who is fond of photography for good photos - I took the components off yesterday while there was a break in the iron tests (I had to shoot the picture for the article‚Äôs head after he left home). <br><br><h2>  Motherboard </h2><br>  Since the publication of our <a href="https://habrahabr.ru/company/yadro/blog/308508">introductory article on the motherboard,</a> we have been engaged in the final agreement on all the requirements for the location of power rails and connectors.  We also fixed memory riser circuits - they affect pin-out connectors for risers on the motherboard.  Approved power distribution board circuits from CRPS-blocks and pinout OCuLink connectors (Nano-Pitch). <br><br>  On nutrition, it still happened to place and dilute the VRM for the processors on the motherboard - no additional fees were needed.  Given the density of the board, the required area of ‚Äã‚Äãthe feeding grounds and the number of vias required for the passage of a large current, we had to tinker.  And after that, they fine-tuned high-speed circuits for the best signal quality. <br><br>  The output was mighty: <br><br><img src="https://habrastorage.org/files/96b/c46/47e/96bc4647ec13465ea6a4100f645554a3.png" alt="image">  <i>Motherboard server in all merciless for the eyes of beauty.</i> <br><br>  Somewhere tracing was easier: <br><br><img src="https://habrastorage.org/files/f81/f71/57d/f81f7157d8994582a60e81592151281b.png" alt="image">  <i>Trace the DMI bus near memory connectors.</i> <br><br>  Somewhere a bit more complicated: <br><br><img src="https://habrastorage.org/files/71b/67c/83e/71b67c83e52046f6b2c840892a3f18cb.png" alt="image">  <i>A-Bus tracing between two processors.</i>  <i>A bit of dark magic and sleight of hand.</i> <br><br>  And in this picture you can see how the VRM processors are packed: <br><br><img src="https://habrastorage.org/files/d6b/a32/157/d6ba321578504eaeb96ebf6c9853ffae.png" alt="image">  <i>VRM processors in a cohesive series.</i> <br><br>  And finally, we can show the result of the work on the motherboard.  So it looks like after manufacture and installation: <br><br><img src="https://habrastorage.org/files/836/bb1/cfa/836bb1cfa7c94c99ad14f75914a16e25.jpg" alt="image">  <i>The first revision of the motherboard.</i> <br><br><h2>  Memory raiser </h2><br>  We made the memory riser based on the OpenPOWER reference design.  The main difference is that we increased the number of DIMM connectors to two per channel (there was one) with approximately the same board dimensions. <br><br>  Here are illustrations of the riser from the reference design and ours: <br><br><img src="https://habrastorage.org/files/1eb/d07/252/1ebd0725242049cebfe6d0eb926e8b5b.png" alt="image">  <i>Reference design riser.</i> <br><br><img src="https://habrastorage.org/files/c11/756/455/c1175645542849128afb3e3e54046a62.png" alt="image">  <i>And this is our riser design.</i> <br><br>  To accommodate a greater number of connectors, we had to modify the reference design in several directions at once: <br><br><ul><li>  Replaced SMD DIMM connectors with Press-Fit, since they can be placed much closer to each other. </li><li>  DIMM slots are brought closer to the memory buffer chip. </li><li>  Threw out of the circuit many debug connectors. </li><li>  Optimized power subsystem schematics to reduce the area occupied by the components. </li><li>  Used a more dense connector to connect to the motherboard. </li></ul><br>  During the development of this board, we encountered two main difficulties: <br><br><h3>  1. Layout has become more dense </h3><br>  The main problem was with the wiring of the bus address and commands, since when the DIMM and Memory Buffer come together we did not leave room for ourselves to align this bus (it is located in the center of the DIMM socket).  To overcome this problem, we carried part of the address bus and commands to the outer layers (in the reference design, all wiring is carried out on the inner layers). <br><br><img src="https://habrastorage.org/files/58d/ba3/004/58dba30041ad416da8ae570ccbd03a26.png" alt="image">  <i>Riser memory layout.</i> <br><br>  The speed of propagation of signals on the outer and inner layers is different - therefore, the alignment of this tire we carried out in units of time, not length. <br><br><h4>  2. Connector restrictions </h4><br>  The second problem was that the connector we used did not have an 85-ohm version, only 100 ohm.  While a fast DMI bus passing through it has an impedance of 85 ohms. <br><br>  However, we concluded that due to a drop in impedance on the pads of the connector to approximately 60 ohms, the use of a 100-ohm connector is even more preferable, since it leads to a certain compensation for this irregularity. <br><br>  Here's what happened in the end: <br><br><img src="https://habrastorage.org/files/819/467/b6f/819467b6f53140328fb9574e11d801c3.jpg" alt="image">  <i>Raiser memory.</i>  <i>Under the radiator hides Centaur memory buffer.</i>  <i>To save space, use the dense 240-pin <a href="https://www.samtec.com/products/seaf-ra">Samtec Searay SEAF-RA</a> connectors.</i> <br><br><h2>  NVMe Disk Switch Boards </h2><br>  The board with PCIe switches in the server is located above the disks - as it was written in the <a href="https://habrahabr.ru/company/yadro/blog/309080">review article about the server</a> , it‚Äôs physically impossible to place them on the backplane, it‚Äôs too big chips.  They fit under the cover of the server. <br><br>  There are 2 PCIe switch chips on the board, and each of them in our case can consist of 2 independent parts (partitions).  Up to 4 switches in total, and each of them is connected to its processor via a PCIe Gen3 x16 bus.  We made these connections with OCuLink cables.  If a smaller number of processors are installed in the system, you can reconfigure the partitioning of switches to provide the necessary connection between the disks and the processors. <br><br>  During development and tracing, we had to take into account many restrictions on the layout of components on the board, caused by stringent height requirements.  Due to the fact that there are disk baskets under the board, we could only put passive components of size 0402 on the bottom side of the board. On the upper side we were limited to a height of 9 mm. <br><br>  I had to think about the relative location of the OCuLink connectors and switches, so that it was more convenient to trace and connect the cables when building the server.  The result was the following layout of the components: <br><br><img src="https://habrastorage.org/files/cb8/6e2/29a/cb86e229ad974b09adc23d4b9eb96d83.png" alt="image"><br>  <i>Switch card layout for NVMe disks; below, protruding parts of disk baskets are visible.</i> <br><br>  This arrangement of chips and connectors required to make a separate configuration file for each of the chips.  The switch chips we have chosen have 5 x16 line blocks (chip maker Microsemi calls them stacks), which are divided between two partitions.  Due to the fact that for convenience of tracing and installation, the chips are deployed relative to each other, it was convenient to register different lines for different chips to connect to the host and to the NVMe disks.  In itself, it does not cause difficulties, but in production it is necessary to ensure that the configuration intended for it has been stitched into each of the two chips. <br><br><img src="https://habrastorage.org/files/f36/00b/78b/f3600b78bf0f4fcf92df2692df4bc39f.png" alt="image">  <i>The top layer of the switchboard.</i> <br><br><img src="https://habrastorage.org/files/79a/948/a09/79a948a09bda4322af1357bb74b5095d.png" alt="image">  <i>The bottom layer of the switchboard.</i>  <i>Welcome to the dark side.</i> <br><br>  On the inner side, on the edge of the board, there is a line of edge connectors, through which the board is connected to the disk backplane.  And from the front, we placed on it signal LEDs for disks - in this way we simplified the design of disk modules and disk backplane.  The board itself is still in production, we will show its photos in the following articles. <br><br><h2>  Disk backplane </h2><br>  Up to 24 NVMe disks are connected to the backplane.  Since we carried the disk LEDs onto the switchboard, we did not have to use light guides to display the indications on the front panel.  If the LEDs were on the backplane, it would have been impossible to do without 24 long light guides (they are usually placed in the disk tray). <br><br>  The backplane fee is across the entire server perpendicular to the air flow.  To provide good cooling for processors and memory, we had to make many evenly spaced holes in it.  We also tried to make the size of the holes larger, increasing the trace density and thinking through the optimal arrangement of the components on the board.  But during the tracing, I still had to slightly reduce the size of the slots for high-quality passing high-speed PCIe signals to the disks. <br><br><img src="https://habrastorage.org/files/956/f0e/08c/956f0e08ca454eb786bc3a7df470a082.jpg" alt="image">  <i>Diskbackline scheme.</i>  <i>Tracks evoke memories of Giger.</i> <br><br>  Power to the board comes through 3 pairs of powerful pins (RADSOK) - the grounds for them can be clearly seen in the picture below.  Power is supplied to the disks, as well as to the switchboard through the edge connectors. <br><br><img src="https://habrastorage.org/files/e80/b70/7a3/e80b707a3b4947a0bb2b7d9fbb4c04da.jpg" alt="image">  <i>Disk backplane, view from the side of disk baskets.</i> <br><br><h2>  Fan midplane </h2><br>  Immediately behind the disk backplane in our server are 5 fans.  They are placed in the guides and connected to the midplane using small cards that are placed on the fan casing. <br><br>  In addition to transmitting the control signal to the fans and feedback from them, the fan board distributes power from the CRPS sources to the fans, as well as to the disk backplane.  The total current is quite high (up to 75 A at the peak), and the width of the board is not very large, so I had to create a midplein with an increased thickness of copper on the layers.  Powered by CRPS sources summed up through copper tires. <br><br><img src="https://habrastorage.org/files/ad7/2eb/012/ad72eb012bec427386b54c8cab5d70c3.jpg" alt="image">  <i>Fans fee.</i>  <i>Simple</i> <br><br><h2>  Power Distribution Board </h2><br>  This is almost the smallest board in the server, but it plays an important role - it removes power from two units and distributes it to the server modules.  We decided to transfer power from this board to the rest of the system through copper buses through powerful contacts (RADSOK series). <br><br>  Standby power is transmitted through the edge connector.  Also through this connector are signals for switching on power supply units, ‚Äúpower good‚Äù CRPS signals, as well as data from a current sensor, which measures the consumption of disks and fans. <br><br><img src="https://habrastorage.org/files/ee9/4a7/f5d/ee94a7f5de4d4df1ba2dd7f9a7f2ec8f.jpg" alt="image">  <i>The power distribution board is small but powerful.</i> <br><br><h2>  What's next? </h2><br>  After the May holidays, we will talk in more detail about testing and debugging of various subsystems.  Stay tuned! </div><p>Source: <a href="https://habr.com/ru/post/327458/">https://habr.com/ru/post/327458/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../327448/index.html">Learning from the masters: design levels Legend Of Zelda</a></li>
<li><a href="../327450/index.html">Operator overloading in freepascal on the example of ordinary fractions</a></li>
<li><a href="../327452/index.html">Mobile application prototyping: from idea to desktop</a></li>
<li><a href="../327454/index.html">Everything is not so simple with Ctrl + Z: about undo in fast editing ONLYOFFICE</a></li>
<li><a href="../327456/index.html">Container lsp</a></li>
<li><a href="../327460/index.html">Compare Java 8, RxJava, Reactor</a></li>
<li><a href="../327464/index.html">Do you need video calls in VR?</a></li>
<li><a href="../327466/index.html">Several lines of JS code to call from browser to mobile phone</a></li>
<li><a href="../327468/index.html">Consensus Algorithms: Proof of Share and Proof of Work</a></li>
<li><a href="../327470/index.html">DevExtreme: now on GitHub and with a free license</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>