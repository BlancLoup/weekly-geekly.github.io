<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Legacy Databases in Rails 3</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Based on real events that happened (occurring) with real people. 
  
 If you work with legacy databases, you don‚Äôt always have the ability to change f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Legacy Databases in Rails 3</h1><div class="post__text post__text-html js-mediator-article">  Based on real events that happened (occurring) with real people. <br> <a href="https://github.com/kconrails/safe_attributes_example"><img src="https://habrastorage.org/getpro/habr/post_images/9fd/bbe/990/9fdbbe990f4105b6f0bf3d25b9b183a7.png"></a> <br>  If you work with legacy databases, you don‚Äôt always have the ability to change field names when fields start to conflict with Ruby on Rails.  The simplest example is a field named 'class' in one of your tables.  Rails really don't like it.  It's like a mother-in-law who doesn't like your new hairstyle, and she pays attention to it at every opportunity. <br><blockquote>  In the absence of dramatic talent, the translator failed to produce a brighter metaphor, creating a general association, as opposed to a private <br></blockquote><br><a name="habracut"></a><br><pre><code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment">#      ruby-1.9.2-p0 &gt; u = User.new :class =&gt; '1995' NoMethodError: undefined method `columns_hash' for nil:NilClass</span></span></code> </pre> <br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment">#   ,    ,       . ruby-1.9.2-p0 &gt; u = User.new :name NoMethodError: undefined method `has_key?' for nil:NilClass</span></span></code> </pre><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment">#     ruby-1.9.2-p0 &gt; u = User.new =&gt; #&lt;User id: nil, name: nil, class: nil, created_at: nil, updated_at: nil&gt; ruby-1.9.2-p0 &gt; u.class = '1995' NoMethodError: undefined method `private_method_defined?' for nil:NilClass</span></span></code> </pre><br>  As with the aforementioned mother-in-law, your problems are inevitable until the hairstyle is corrected. <br>  Fortunately, Brian Jones solved this problem for us with his gem <a href="https://github.com/bjones/safe_attributes">safe_attributes</a> .  Rails automatically creates acessors (getters and setters) for each attribute in the ActiveRecord model table.  Attempting to redefine important methods such as ‚Äúclass‚Äù with Rails is what gives us problems.  Safe_attributes excludes the creation of any attributes with dangerous names. <br><br>  It is enough to do the following: <br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># app/models/user.rb class User &lt; ActiveRecord::Base bad_attribute_names :class end</span></span></code> </pre><br>  After adding the gem in the bundle, pass to bad_attribute_names a list of the names of the offending fields, and this will free Rails from trying to generate acessor methods for them.  Now everything works, but without these acessors.  Let's try to get / assign our attribute: class: <br><pre> <code class="ruby hljs"><span class="hljs-meta"><span class="hljs-meta">ruby-1.9.2-p0 &gt;</span></span> u = User.new =&gt; #&lt;User id: nil, name: nil, class: nil, created_at: nil, updated_at: nil&gt; ruby-<span class="hljs-number"><span class="hljs-number">1.9</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>-p<span class="hljs-number"><span class="hljs-number">0</span></span> &gt; u.class = <span class="hljs-string"><span class="hljs-string">'1995'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"1995"</span></span> ruby-<span class="hljs-number"><span class="hljs-number">1.9</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>-p<span class="hljs-number"><span class="hljs-number">0</span></span> &gt; u =&gt; #&lt;User id: nil, name: nil, class: "1995", created_at: nil, updated_at: nil&gt; ruby-<span class="hljs-number"><span class="hljs-number">1.9</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>-p<span class="hljs-number"><span class="hljs-number">0</span></span> &gt; u.class =&gt; User(<span class="hljs-symbol"><span class="hljs-symbol">id:</span></span> integer, <span class="hljs-symbol"><span class="hljs-symbol">name:</span></span> string, <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">created_at</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">datetime</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">updated_at</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">datetime</span></span></span><span class="hljs-class">)</span></span></code> </pre><br>  The setter works (I assume that it was created also because there was no previously existing method 'class' =), and we can make sure that the attribute value is correctly assigned.  But the default getter call causes ... well, the default behavior. <br><br>  The fact is that you can always use the attribute in the context of hash (associated array, further hash, comment of the translator).  You can pass a key / value attribute hash to the object, and this will work.  This means that when you create and update your controller, you do not have to change it. <br>  Methods such as new, create, update_attribute, update_attributes, etc.  will work fine. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If you only want to assign a value (to avoid immediate saving, for example), proceed as follows. <br><pre> <code class="ruby hljs"><span class="hljs-meta"><span class="hljs-meta">ruby-1.9.2-p0 &gt;</span></span> u[<span class="hljs-symbol"><span class="hljs-symbol">:class</span></span>] = <span class="hljs-string"><span class="hljs-string">'1996'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"1996"</span></span> ruby-<span class="hljs-number"><span class="hljs-number">1.9</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>-p<span class="hljs-number"><span class="hljs-number">0</span></span> &gt; u =&gt; #&lt;User id: nil, name: nil, class: "1996", created_at: nil, updated_at: nil&gt;</code> </pre><br><br>  In general, you can still set the value of attributes directly, instead of using rail-generated acessors.  But we are still one step away from the final decision.  We want to refer to this attribute as the rest, and this requires us to organize a normal set of access methods (getters and setters).  One of the reasons to do this is that we will have standard validations for this attribute. <br><br>  You can add acessors as in this example: <br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># add to app/models/user.rb def class_name= value self[:class] = value end def class_name self[:class] end</span></span></code> </pre><br>  We declare acessor 'class_name', and now we can use it anywhere in the place of the original attribute name.  We can use it in forms: <br><pre> <code class="ruby hljs">&lt;%= f.text_field <span class="hljs-symbol"><span class="hljs-symbol">:class_name</span></span> %&gt;</code> </pre><br>  Or in validators: <br><pre> <code class="ruby hljs">validates_presence_of <span class="hljs-symbol"><span class="hljs-symbol">:class_name</span></span></code> </pre><br>  Or when we create a new object: <br><pre> <code class="ruby hljs">User.create <span class="hljs-symbol"><span class="hljs-symbol">:class_name</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'class of 1995'</span></span></code> </pre><br>  If you downloaded the code, then these additions are test-driven, meaning that I wrote tests for these methods before writing the methods themselves, to make sure that these methods work in an appropriate way.  I urge you to do the same. <br><br>  Good luck! <br><br>  <a href="http://kconrails.com/2011/01/28/legacy-database-table-column-names-in-ruby-on-rails-3/">Original available</a> </div><p>Source: <a href="https://habr.com/ru/post/155215/">https://habr.com/ru/post/155215/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../155203/index.html">Wi-Fi in amateur project? Nothing is easier!</a></li>
<li><a href="../155205/index.html">Magic Finger turns any surface into a touch interface</a></li>
<li><a href="../155207/index.html">Flex Config. Description of the syntax of the configuration file</a></li>
<li><a href="../155209/index.html">Ubuntu 13.04 Raring Ringtail: An Impatient Lemur Aiming for Mobile Platforms</a></li>
<li><a href="../155213/index.html">Form Interface Recommendations</a></li>
<li><a href="../155219/index.html">Appeal to the Habr community</a></li>
<li><a href="../155221/index.html">AWS Global Start-Up Challenge</a></li>
<li><a href="../155223/index.html">Crowd funding without using third-party services on the example of Star Citizen</a></li>
<li><a href="../155225/index.html">AMQP. Sending messages to RabbitMQ directly from Nginx (embedded Perl)</a></li>
<li><a href="../155227/index.html">Meteor 0.5.0: Authentication, OAuth, SRP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>