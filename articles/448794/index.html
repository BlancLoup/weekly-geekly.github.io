<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Python Testing with pytest. Plugins, CHAPTER 5</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Back Next 


 Enough powerful pytest out of the box, it becomes even better when you add a mix of plug-ins to it. The pytest codebase is structured wi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Python Testing with pytest. Plugins, CHAPTER 5</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://habr.com/ru/post/448792/">Back</a> <a href="https://habr.com/ru/post/448796/">Next</a> <img src="https://habrastorage.org/webt/rw/dy/-g/rwdy-grsvbpcetjttrmecdkxtlk.png"></p><br><p>  <em>Enough powerful pytest out of the box, it becomes even better when you add a mix of plug-ins to it.</em>  <em>The pytest codebase is structured with settings and extensions, and there are hooks available for modification and improvements via plugins.</em> </p><br><p><img src="https://habrastorage.org/webt/hd/--/9w/hd--9w134j0rxhmxftrflbbdopy.png"></p><a name="habracut"></a><br><p>  The examples in this book are written using Python 3.6 and pytest 3.2.  pytest 3.2 supports Python 2.6, 2.7 and Python 3.3+. </p><br><blockquote>  The source code for the Tasks project, as well as for all the tests shown in this book, is available via the <a href="https://pragprog.com/titles/bopytest/source_code" title="https://pragprog.com/titles/bopytest/source_code">link</a> on the book's web page at <a href="https://pragprog.com/titles/bopytest" title="https://pragprog.com/titles/bopytest">pragprog.com</a> .  You do not need to download the source code to understand the test code;  The test code is presented in a convenient form in the examples.  But to follow along with the project objectives, or to adapt test examples to test your own project (your hands are untied!), You should go to the book‚Äôs web page and download the work.  In the same place, on the book‚Äôs web page there is a link for <a href="https://pragprog.com/titles/bopytest/errata" title="https://pragprog.com/titles/bopytest/errata">errata</a> messages and a <a href="https://forums.pragprog.com/forums/438" title="https://forums.pragprog.com/forums/438">discussion forum</a> . </blockquote><p>  Under the spoiler is a list of articles in this series. </p><br><div class="spoiler">  <b class="spoiler_title">Table of contents</b> <div class="spoiler_text"><ul><li>  <a href="https://habr.com/ru/post/426699/"><strong>Introduction</strong></a> </li><li>  <a href="https://habr.com/ru/post/448782/"><strong>Chapter 1: Getting Started with pytest</strong></a> </li><li>  <a href="https://habrahabr.ru/post/346340/"><strong>Chapter 2: Writing Test Functions</strong></a> </li><li>  <a href="https://habr.com/ru/post/448786/"><strong>Chapter 3: Pytest Fixtures</strong></a> </li><li>  <a href="https://habr.com/ru/post/448792/"><strong>Chapter 4: Builtin Fixtures</strong></a> </li><li>  <a href="https://habr.com/ru/post/448794/"><strong>Chapter 5: Plugins</strong></a> (This article) </li><li>  <a href="https://habr.com/ru/post/448796/"><strong>Chapter 6: Configuration</strong></a> </li><li>  <a href="https://habr.com/ru/post/448798/"><strong>Chapter 7: Using pytest with other tools</strong></a> </li></ul></div></div><br><h2 id="poehali-dalshe">  Let's go further! </h2><br><p> You may be surprised to learn that you have already written some kind of plug-ins, if you have worked through the previous chapters in this book.  Every time you place fixtures and / or <code>conftest.py</code> top-level <code>conftest.py</code> file of the project, you create a local <code>conftest</code> plugin.  This is just a little extra work on converting these <code>conftest.py</code> files into installable plugins that you can share between projects, with other people, or with the world. </p><br><p>  We will begin this chapter with an answer to the question of where to look for third-party plugins.  Quite a lot of plugins are available, so there is a decent chance that someone has already written the changes you want to make in <code>pytest</code> .  Since we will consider open source plugins, if a plug-in does almost what you want to do, but not quite, you can develop it, or use it as a reference to create your own plug-in.  Although this chapter is about creating your own plugins, Appendix 3, the <em>Sampler Pack</em> plugin, on page 163 is included to give you a taste of what is possible. </p><br><p>  In this chapter, you will learn how to create plugins, and I will point you in the right direction for testing, packaging, and distributing them.  The complete topic of packaging and distribution of Python is too extensive and claims to be its own book, so we will not cover everything.  But you will get enough information to be able to share plugins with your team.  I will also talk about some simple ways to create plugins with PyPI support and the least amount of work. </p><br><h2 id="poisk-plaginov">  Search for plugins </h2><br><p>  You can find third-party pytest plugins in several places.  The plugins listed in Appendix 3, Plugin Sampler Pack, on page 163, are available for download from PyPI.  However, this is not the only place to look for great pytest plugins. </p><br><p>  <a href="https://docs.pytest.org/en/latest/plugins.html">https://docs.pytest.org/en/latest/plugins.html</a> </p><br><p>  On the main pytest documentation site, there is a page that talks about installing and using pytest plug-ins and lists several common plug-ins. </p><br><p>  <a href="https://pypi.python.org/">https://pypi.python.org</a> </p><br><p>  The Python Package Index (PyPI) is a great place to get lots of Python packages, but also a great place to look for pytest plugins.  When searching for pytest plugins, just enter ‚Äúpytest,‚Äù ‚Äúpytest -‚Äù or ‚Äú-pytest‚Äù into the search field, since most pytest plugins either start with ‚Äúpytest -‚Äù or end with ‚Äú-pytest.‚Äù </p><br><p>  <a href="https://github.com/pytest-dev">https://github.com/pytest-dev</a> </p><br><p>  The "pytest-dev" group on GitHub is the place where the pytest source code is stored.  In addition, here you can find popular pytest plugins that should be supported in the long run by the pytest kernel command. </p><br><h2 id="ustanovka-plaginov">  Installing plugins </h2><br><p>  Pytest plugins are installed with pip, like other Python packages.  But, <br>  You can use pip in several ways to install plugins. </p><br><h3 id="ustanovka-iz-pypi">  Install from PyPI </h3><br><p>  Since PyPI is the default location for pip, installing PyPI plugins is the easiest method.  Let's install the <code>pytest-cov</code> plugin: </p><br><pre> <code class="plaintext hljs">$ pip install pytest-cov</code> </pre> <br><p>  The latest stable version from PyPI will be installed. </p><br><h3 id="ustanovka-opredelennoy-versii-iz-pypi">  Installing a specific version of PyPI </h3><br><p>  If you want a specific version of the plugin, you can specify the version after <code>==</code> : </p><br><pre> <code class="plaintext hljs">$ pip install pytest-cov==2.4.0</code> </pre> <br><h3 id="ustanovka-iz-fayla-targz-ili-whl">  Install from a .tar.gz or .whl file </h3><br><p>  PyPI packages are distributed as zip files with the <code>.tar.gz</code> and / or <code>.whl</code> .  They are often referred to as "tar balls" and "wheels".  If you have problems with trying to work with PyPI directly (which can happen with firewalls and other network complications), you can download either <code>.tar.gz</code> or <code>.whl</code> and install from this. </p><br><p>  You do not need to unpack or dance with a tambourine;  just point a pip at it: </p><br><pre> <code class="plaintext hljs">$ pip install pytest-cov-2.4.0.tar.gz # or $ pip install pytest_cov-2.4.0-py2.py3-none-any.whl</code> </pre> <br><h3 id="ustanovka-iz-lokalnogo-kataloga">  Install from a local directory </h3><br><p>  You can have a plug-in stash (and other Python packages) in a local or shared directory in <code>.tar.gz</code> or <code>.whl</code> and use this instead of PyPI to install plug-ins: </p><br><pre> <code class="plaintext hljs">$ mkdir some_plugins $ cp pytest_cov-2.4.0-py2.py3-none-any.whl some_plugins/ $ pip install --no-index --find-links=./some_plugins/ pytest-cov</code> </pre> <br><p>  <code>--no-index</code> tells <code>pip</code> not to connect to PyPI.  <code>--find-links=./some_plugins/</code> tells pip to look in the <code>some_plugins</code> directory.  This method is especially useful if you have both third-party and own plugins stored locally, as well as if you are creating new virtual environments for continuous integration or with tox.  (We‚Äôll talk about both tox and continuous integration in Chapter 7, using pytest with other tools, on page 125.) </p><br><p>  Please note that using the local directory installation method you can install several versions and specify which version you want by adding == and the version number: </p><br><pre> <code class="plaintext hljs">$ pip install --no-index --find-links=./some_plugins/ pytest-cov==2.4.0</code> </pre> <br><h3 id="ustanovka-iz-repozitoriya-git">  Installing from the Git repository </h3><br><p>  You can install plugins directly from the Git repository in this case GitHub: </p><br><pre> <code class="plaintext hljs">$ pip install git+https://github.com/pytest-dev/pytest-cov</code> </pre> <br><p>  You can also specify a version tag: </p><br><pre> <code class="plaintext hljs">$ pip install git+https://github.com/pytest-dev/pytest-cov@v2.4.0</code> </pre> <br><p>  Or you can specify a branch: </p><br><pre> <code class="plaintext hljs">$ pip install git+https://github.com/pytest-dev/pytest-cov@master</code> </pre> <br><p>  Installing from the Git repository is especially useful if you are storing your own work in Git or if the required version of the plugin or plugin is not in PyPI. </p><br><blockquote>  <em>Translator's Note:</em> <br><br>  pip supports installations from Git, Mercurial, Subversion, and Bazaar and determines the type of VCS using the url prefixes: "git +", "hg +", "svn +", "bzr +". <br>  More details can be found in the <a href="https://pip.pypa.io/en/stable/reference/pip_install/">PyPI documentation.</a> </blockquote><br><h2 id="napisanie-sobstvennyh-plaginov">  Writing your own plugins </h2><br><p>  Many third-party plugins contain quite a lot of code.  This is one of the reasons why we use them, to save us time to develop all this on our own.  However, for your specific code, you will undoubtedly come up with special fixtures and modifications that will help you test it.  By creating a plugin, you can easily share even a few fixtures that you want to share between several projects.  You can share these changes with several projects ‚Äî and perhaps with the rest of the world ‚Äî by developing and distributing your own plugins.  It is quite easy to do.  In this section, we will develop a small modification of the pytest behavior, package it as a plugin, test it and consider how to distribute it. </p><br><p>  Plugins can include hook functions that change pytest behavior.  Since pytest was designed to allow plugins to slightly change the behavior of pytest, many hook functions are available.  hooks for pytest are listed on <a href="https://docs.pytest.org/en/latest/_modules/_pytest/hookspec.html">the pytest documentation site</a> .  In our example, we will create a plugin that will change the appearance of the test status.  Add a command line parameter to enable this new behavior.  Add text to the output header.  In particular, we will change all FAILED status indicators (unsuccessful) to ‚ÄúOPPORTUNITY (perspective) for improvement,‚Äù change F to O, and add ‚ÄúThanks for running the tests‚Äù to the title.  For this we will use the option <code>--nice</code> . </p><br><p>  To keep behavior changes separate from the discussion of plug-in mechanics, we will make changes to conftest.py before we turn it into a distributed plugin.  You do not need to run plugins in this way.  But often the changes that you intended to use only in one project will be useful enough to share them and turn into a plugin.  Therefore, we will start by adding functionality to the conftest.py file, and then, after everything works in conftest.py, we will move the code into the package. </p><br><p>  Let's return to the Tasks project.  In the section "waiting for exceptions" on page 30 we wrote several tests that checked whether exceptions were thrown if someone incorrectly called the API function.  It looks like we missed at least a few possible error conditions. </p><br><p>  Here are a couple of tests: </p><br><blockquote>  <strong>ch5 / a / tasks_proj / tests / func / test_api_exceptions.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">"""     API wrong."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> tasks <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> tasks <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Task @pytest.mark.usefixtures(<span class="hljs-string"><span class="hljs-string">'tasks_db'</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestAdd</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">()</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-string"><span class="hljs-string">""",   tasks.add()."""</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_missing_summary</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""  ,  summary missing."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pytest.raises(ValueError): tasks.add(Task(owner=<span class="hljs-string"><span class="hljs-string">'bob'</span></span>)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_done_not_bool</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""  ,  done   bool."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pytest.raises(ValueError): tasks.add(Task(summary=<span class="hljs-string"><span class="hljs-string">'summary'</span></span>, done=<span class="hljs-string"><span class="hljs-string">'True'</span></span>))</code> </pre><br><p>  Let's run them to check if they pass: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch5/a/tasks_proj $ pytest ===================== test session starts ====================== collected 57 items tests/func/test_add.py ... tests/func/test_add_variety.py ............................ tests/func/test_add_variety2.py ............ tests/func/test_api_exceptions.py .F....... tests/func/test_unique_id.py . tests/unit/test_task.py .... =========================== FAILURES =========================== __________________ TestAdd.test_done_not_bool __________________ self = &lt;func.test_api_exceptions.TestAdd object at 0x103a71a20&gt; def test_done_not_bool(self): """Should raise an exception if done is not a bool.""" with pytest.raises(ValueError): &gt; tasks.add(Task(summary='summary', done='True')) E Failed: DID NOT RAISE &lt;class 'ValueError'&gt; tests/func/test_api_exceptions.py:20: Failed ============= 1 failed, 56 passed in 0.28 seconds ==============</code> </pre><br><p>  Let's run it again with <code>-v</code> for details.  Since you have already seen the trace, you can disable it by pressing <code>--tb=no</code> . </p><br><p>  Now let's focus on new tests with <code>-k TestAdd</code> , which works because there are no other tests with names that contain ‚ÄúTestAdd.‚Äù </p><br><p>  We could quit and try to correct this test (and we will do it later), but now we will focus on trying to make failures more pleasant for developers. </p><br><p>  Let's start by adding the message "thank you" to a header that you can do with the pytest hook called <code>pytest_report_header()</code> . </p><br><blockquote>  <strong>ch5 / b / tasks_proj / tests / conftest.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pytest_report_header</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""    ."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Thanks for running the tests."</span></span></code> </pre> <br><p>  Obviously, typing a thank you message is pretty silly.  However, the ability to add information to the header can be extended.  You can add a user name, specify the equipment used and the versions being tested.  In general, everything that you can convert to a string can be inserted into the test header. </p><br><p>  Then we change the test status report to change <code>F</code> to <code>O</code> and <code>FAILED</code> to <code>OPPORTUNITY for improvement</code> .  There is a hook that allows this affair: <code>pytest_report_teststatus()</code> : </p><br><blockquote>  <strong>ch5 / b / tasks_proj / tests / conftest.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pytest_report_teststatus</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(report)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""   ."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> report.when == <span class="hljs-string"><span class="hljs-string">'call'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> report.failed: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (report.outcome, <span class="hljs-string"><span class="hljs-string">'O'</span></span>, <span class="hljs-string"><span class="hljs-string">'OPPORTUNITY for improvement'</span></span>)</code> </pre> <br><p>  And now we have just the way out we were looking.  A test session without the <code>--verbose</code> flag shows <code>O</code> for failures, that is, the possibility of improvement: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch5/b/tasks_proj/tests/func $ pytest --tb=no test_api_exceptions.py -k TestAdd ===================== test session starts ====================== Thanks for running the tests. collected 9 items test_api_exceptions.py .O ====================== 7 tests deselected ====================== ======= 1 failed, 1 passed, 7 deselected in 0.06 seconds =======</code> </pre> <br><p>  With the <code>-v</code> or <code>--verbose</code> flag will be better: </p><br><pre> <code class="plaintext hljs">$ pytest -v --tb=no test_api_exceptions.py -k TestAdd ===================== test session starts ====================== Thanks for running the tests. collected 9 items test_api_exceptions.py::TestAdd::test_missing_summary PASSED test_api_exceptions.py::TestAdd::test_done_not_bool OPPORTUNITY for improvement ====================== 7 tests deselected ====================== ======= 1 failed, 1 passed, 7 deselected in 0.07 seconds =======</code> </pre> <br><p>  The last change we make is to add a command line parameter, <code>--nice,</code> so that our status changes occur only if we substitute <code>--nice</code> : </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pytest_addoption</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(parser)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" nice    --nice."""</span></span> group = parser.getgroup(<span class="hljs-string"><span class="hljs-string">'nice'</span></span>) group.addoption(<span class="hljs-string"><span class="hljs-string">"--nice"</span></span>, action=<span class="hljs-string"><span class="hljs-string">"store_true"</span></span>, help=<span class="hljs-string"><span class="hljs-string">"nice: turn failures into opportunities"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pytest_report_header</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""    ."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> pytest.config.getoption(<span class="hljs-string"><span class="hljs-string">'nice'</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Thanks for running the tests."</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pytest_report_teststatus</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(report)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""   ."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> report.when == <span class="hljs-string"><span class="hljs-string">'call'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> report.failed <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> pytest.config.getoption(<span class="hljs-string"><span class="hljs-string">'nice'</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (report.outcome, <span class="hljs-string"><span class="hljs-string">'O'</span></span>, <span class="hljs-string"><span class="hljs-string">'OPPORTUNITY for improvement'</span></span>)</code> </pre><br><p>  It is worth noting that for this plugin we use only a couple of hooks.  There are many others that can be found on the <a href="https://docs.pytest.org/en/latest/writing_plugins.html">main Pytest documentation site</a> . </p><br><p>  Now we can manually test our plugin by simply running it in our example.  First, without the <code>--nice</code> option to make sure that only the username is displayed: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch5/c/tasks_proj/tests/func $ pytest --tb=no test_api_exceptions.py -k TestAdd ===================== test session starts ====================== collected 9 items test_api_exceptions.py .F ====================== 7 tests deselected ====================== ======= 1 failed, 1 passed, 7 deselected in 0.07 seconds =======</code> </pre><br><p>  Now with <code>--nice</code> : </p><br><pre> <code class="plaintext hljs">$ pytest --nice --tb=no test_api_exceptions.py -k TestAdd ===================== test session starts ====================== Thanks for running the tests. collected 9 items test_api_exceptions.py .O ====================== 7 tests deselected ====================== ======= 1 failed, 1 passed, 7 deselected in 0.07 seconds =======</code> </pre> <br><p>  Now with <code>--nice</code> and <code>--verbose</code> : </p><br><pre> <code class="plaintext hljs">$ pytest -v --nice --tb=no test_api_exceptions.py -k TestAdd ===================== test session starts ====================== Thanks for running the tests. collected 9 items test_api_exceptions.py::TestAdd::test_missing_summary PASSED test_api_exceptions.py::TestAdd::test_done_not_bool OPPORTUNITY for improvement ====================== 7 tests deselected ====================== ======= 1 failed, 1 passed, 7 deselected in 0.06 seconds =======</code> </pre> <br><p>  Fine!  All the changes we wanted to make were made in about a dozen lines of the code of the <code>conftest.py</code> file.  Next we will move this code into the plugin structure. </p><br><h2 id="sozdanie-ustanavlivaemogo-plagina">  Creating an installable plugin </h2><br><p>  The process of exchanging plugins with other users is clearly defined.  Even if you never turn on your own plugin in PyPI, after going through this process, it will be easier for you to read the code from open source plugins, and you will have more opportunities to evaluate whether they will help you or not. </p><br><p>  It would be unnecessary to fully cover the packaging and distribution of Python packages in this book, since this topic is well documented elsewhere.  <a href="http://python-packaging.readthedocs.io/">Here</a> and <a href="https://www.pypa.io/">here</a> and <a href="https://www.ibm.com/developerworks/ru/library/os-pythonpackaging/index.html">here</a> in Russian.  However, moving from a local configuration plug-in that we created in the previous section to something installed with pip is a simple task.  , </p><br><p>  First, we need to create a new directory to host our plugin code.  It doesn't matter what you call it, but since we are creating a plugin for the nice flag, let's call it pytest-nice.  We will have two files in this new directory: pytest_nice.py and setup.py.  (The test catalog will be discussed in the section "Test Plugins" on page 105.) </p><br><pre> <code class="plaintext hljs">‚îÇ LICENSE ‚îÇ pytest_nice.py ‚îÇ setup.py ‚îÇ ‚îî‚îÄ‚îÄ‚îÄtests ‚îÇ conftest.py ‚îÇ test_nice.py</code> </pre><br><p>  In <code>pytest_nice.py</code> , we put the exact contents of our conftest.py, which was associated with this function (and extract it from <code>tasks_proj/tests/conftest.py</code> ): </p><br><p>  <strong>ch5 / pytest-nice / pytest_nice.py</strong> </p><br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">"""  pytest-nice ."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pytest_addoption</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(parser)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" nice    --nice."""</span></span> group = parser.getgroup(<span class="hljs-string"><span class="hljs-string">'nice'</span></span>) group.addoption(<span class="hljs-string"><span class="hljs-string">"--nice"</span></span>, action=<span class="hljs-string"><span class="hljs-string">"store_true"</span></span>, help=<span class="hljs-string"><span class="hljs-string">"nice: turn FAILED into OPPORTUNITY for improvement"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pytest_report_header</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""    ."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> pytest.config.getoption(<span class="hljs-string"><span class="hljs-string">'nice'</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Thanks for running the tests."</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pytest_report_teststatus</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(report)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""   ."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> report.when == <span class="hljs-string"><span class="hljs-string">'call'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> report.failed <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> pytest.config.getoption(<span class="hljs-string"><span class="hljs-string">'nice'</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (report.outcome, <span class="hljs-string"><span class="hljs-string">'O'</span></span>, <span class="hljs-string"><span class="hljs-string">'OPPORTUNITY for improvement'</span></span>)</code> </pre> <br><p>  In <code>setup.py</code> we need the maximum minimum <code>setup()</code> call: </p><br><blockquote>  <strong>ch5 / pytest-nice / setup.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">"""Setup  pytest-nice plugin."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> setuptools <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> setup setup( name=<span class="hljs-string"><span class="hljs-string">'pytest-nice'</span></span>, version=<span class="hljs-string"><span class="hljs-string">'0.1.0'</span></span>, description=<span class="hljs-string"><span class="hljs-string">' Pytest,   FAILURE into OPPORTUNITY'</span></span>, url=<span class="hljs-string"><span class="hljs-string">'https:////////'</span></span>, author=<span class="hljs-string"><span class="hljs-string">' '</span></span>, author_email=<span class="hljs-string"><span class="hljs-string">'your_email@somewhere.com'</span></span>, license=<span class="hljs-string"><span class="hljs-string">'proprietary'</span></span>, py_modules=[<span class="hljs-string"><span class="hljs-string">'pytest_nice'</span></span>], install_requires=[<span class="hljs-string"><span class="hljs-string">'pytest'</span></span>], entry_points={<span class="hljs-string"><span class="hljs-string">'pytest11'</span></span>: [<span class="hljs-string"><span class="hljs-string">'nice = pytest_nice'</span></span>, ], }, )</code> </pre> <br><p>  You will need more information in the settings if you are going to distribute it among a wide audience or on the Internet.  However, for a small team or just for yourself this will be enough. </p><br><p>  You can include some other parameters for <code>setup()</code> ;  and here we have only required fields.  The version field is a version of this plugin.  And it is entirely up to you when you pick up the version.  The URL field is required.  You can leave it blank, but you will receive a warning.  The <code>author</code> and <code>author_email</code> can be replaced with the <code>maintainer</code> and <code>maintainer_email</code> , but one of these pairs should be there.  The <code>license</code> field is a short text field.  It could be one of many open source licenses, your name or company, or something suitable for you.  The <code>py_modules</code> lists <code>pytest_nice</code> as our only module for this plugin.  Although this is a list, and you can include more than one module, if I had more than one, I would use the package and put all the modules in one directory. </p><br><p>  Until now, all the <code>setup()</code> parameters are standard and used for all Python installers.  The part that differs for Pytest plugins is the <code>entry_points</code> parameter.  We have listed <code>entry_points={'pytest11': ['nice = pytest_nice', ], },.</code>  The <code>entry_points</code> function is standard for <code>setuptools</code> , but pytest11 is a special identifier that pytest is looking for.  In this line, we tell pytest that <code>nice</code> is the name of our plugin, and <code>pytest_nice</code> name of the module in which our plugin lives.  If we used the package, our entry here would be: </p><br><p>  I have not talked about the file <code>README.rst</code> .  Some form of README is a setuptools requirement.  If you miss it, you will get this: </p><br><pre> <code class="plaintext hljs">... warning: sdist: standard file not found: should have one of README, README.rst, README.txt ...</code> </pre><br><p>  Keeping the README as the standard way to include some project information is a good idea anyway.  This is what I put in the pytest-nice file: </p><br><blockquote>  <strong>ch5 / pytest-nice / README.rst</strong> </blockquote><br><pre> <code class="plaintext hljs">pytest-nice : A pytest plugin =============================   pytest     .  -------- -   ,     pytest. -  ``--nice`` , : -  ``F``  ``O`` -  ``-v``,  ``FAILURE``  ``OPPORTUNITY for improvement``  ------------ ,    Pytest    .tar.gz    PATH,  : :: $ pip install PATH/pytest-nice-0.1.0.tar.gz $ pip install --no-index --find-links PATH pytest-nice  ----- :: $ pytest --nice</code> </pre><br><p>  There are many opinions about what should be in the readme file.  This is a heavily cropped version, but it works. </p><br><h2 id="testirovanie-plaginov">  Plugin Testing </h2><br><p>  Plugins are code that you need to test, just like any other code.  However, testing the changes in the testing tool is a bit more complicated.  When we developed the plug-in code in ‚ÄúWriting Your Own Plugins‚Äù, on page 98, we checked it manually using the sample test file, running pytest with it and checking the output to make sure it was correct.  We can do the same thing automatically using a plugin called <code>pytester</code> , which comes with pytest, but is disabled by default. </p><br><p>  There are two files in our test directory for pytest-nice: <code>conftest.py</code> and <code>test_nice.py</code> .  To use <code>pytester</code> , we need to add only one line to <code>conftest.py</code> : </p><br><blockquote>  <strong>ch5 / pytest-nice / tests / conftest.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">"""pytester is needed for testing plugins."""</span></span> pytest_plugins = <span class="hljs-string"><span class="hljs-string">'pytester'</span></span></code> </pre> <br><p>  This line includes the <code>pytester</code> plugin.  We will use a fixture called <code>testdir</code> , which becomes available when <code>pytester</code> enabled. <br>  Often, plug-in tests take the form we described manually: </p><br><ol><li>  Make an example of a test file. </li><li>  Run pytest with or without some parameters in the directory that contains the sample file. </li><li>  Check the output. </li><li>  Possible, for checking the code result-0 for all passes, 1 for some failures. </li></ol><br><p>  Let's look at one example: </p><br><blockquote>  <strong>ch5 / pytest-nice / tests / test_nice.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_pass_fail</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(testdir)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#     Pytest testdir.makepyfile(""" def test_pass(): assert 1 == 1 def test_fail(): assert 1 == 2 """) #  pytest result = testdir.runpytest() # fnmatch_lines    result.stdout.fnmatch_lines([ '*.F', # .  Pass, F  Fail ]) # ,      '1'  testsuite assert result.ret == 1</span></span></code> </pre> <br><p>  The testdir <code>testdir</code> automatically creates a temporary directory for placing test files.  It has a <code>makepyfile()</code> method that allows you to put the contents of the test file. In this case, we create two tests: one that <em>passes</em> and the other that <em>fails</em> . </p><br><p>  We run pytest for the new test file using <code>testdir.runpytest()</code> .  You can pass parameters if you want.  The return value can be considered further and is of type <a href="https://docs.pytest.org/en/latest/writing_plugins.html">RunResult</a> . </p><br><p>  I usually look at <code>stdout</code> and <code>ret</code> .   ,    ,     ,  <code>fnmatch_lines</code> ,   ,      ,   ,  <code>ret</code>  0     1   . ,   <code>fnmatch_lines</code> ,    .        .  ,    ,   : </p><br><blockquote> <strong>ch5/pytest-nice/tests/test_nice.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@pytest.fixture() def sample_test(testdir): testdir.makepyfile(""" def test_pass(): assert 1 == 1 def test_fail(): assert 1 == 2 """) return testdir</span></span></code> </pre> <br><p> ,   ,    <code>sample_test</code>   ,       .      : </p><br><blockquote> <strong>ch5/pytest-nice/tests/test_nice.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_with_nice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sample_test)</span></span></span><span class="hljs-function">:</span></span> result = sample_test.runpytest(<span class="hljs-string"><span class="hljs-string">'--nice'</span></span>) result.stdout.fnmatch_lines([<span class="hljs-string"><span class="hljs-string">'*.O'</span></span>, ]) <span class="hljs-comment"><span class="hljs-comment"># . for Pass, O for Fail assert result.ret == 1 def test_with_nice_verbose(sample_test): result = sample_test.runpytest('-v', '--nice') result.stdout.fnmatch_lines([ '*::test_fail OPPORTUNITY for improvement', ]) assert result.ret == 1 def test_not_nice_verbose(sample_test): result = sample_test.runpytest('-v') result.stdout.fnmatch_lines(['*::test_fail FAILED']) assert result.ret == 1</span></span></code> </pre> <br><p>     .  ,       : </p><br><blockquote> <strong>ch5/pytest-nice/tests/test_nice.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_header</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sample_test)</span></span></span><span class="hljs-function">:</span></span> result = sample_test.runpytest(<span class="hljs-string"><span class="hljs-string">'--nice'</span></span>) result.stdout.fnmatch_lines([<span class="hljs-string"><span class="hljs-string">'Thanks for running the tests.'</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_header_not_nice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sample_test)</span></span></span><span class="hljs-function">:</span></span> result = sample_test.runpytest() thanks_message = <span class="hljs-string"><span class="hljs-string">'Thanks for running the tests.'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> thanks_message <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> result.stdout.str()</code> </pre><br><p>       ,        ,      . </p><br><p>    : </p><br><blockquote> <strong>ch5/pytest-nice/tests/test_nice.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_help_message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(testdir)</span></span></span><span class="hljs-function">:</span></span> result = testdir.runpytest(<span class="hljs-string"><span class="hljs-string">'--help'</span></span>) <span class="hljs-comment"><span class="hljs-comment"># fnmatch_lines    result.stdout.fnmatch_lines([ 'nice:', '*--nice*nice: turn FAILED into OPPORTUNITY for improvement', ])</span></span></code> </pre> <br><p>  ,     , ,    . </p><br><p>         <code>pytest-nice</code>  ,    .       <code>.zip.gz</code> ,       : </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch5/pytest-nice/ $ pip install . Processing /path/to/code/ch5/pytest-nice Requirement already satisfied: pytest in /path/to/venv/lib/python3.6/site-packages (from pytest-nice==0.1.0) Requirement already satisfied: py&gt;=1.4.33 in /path/to/venv/lib/python3.6/site-packages (from pytest-&gt;pytest-nice==0.1.0) Requirement already satisfied: setuptools in /path/to/venv/lib/python3.6/site-packages (from pytest-&gt;pytest-nice==0.1.0) Building wheels for collected packages: pytest-nice Running setup.py bdist_wheel for pytest-nice ... done ... Successfully built pytest-nice Installing collected packages: pytest-nice Successfully installed pytest-nice-0.1.0</code> </pre> <br><p> ,   ,   : </p><br><pre> <code class="plaintext hljs">$ pytest -v ===================== test session starts ====================== plugins: nice-0.1.0 collected 7 items tests/test_nice.py::test_pass_fail PASSED tests/test_nice.py::test_with_nice PASSED tests/test_nice.py::test_with_nice_verbose PASSED tests/test_nice.py::test_not_nice_verbose PASSED tests/test_nice.py::test_header PASSED tests/test_nice.py::test_header_not_nice PASSED tests/test_nice.py::test_help_message PASSED =================== 7 passed in 0.34 seconds ===================</code> </pre> <br><blockquote>  <strong>Note</strong> <strong>:</strong>    ,    .      . <br><pre> <code class="plaintext hljs">platform win32 -- Python 3.6.5, pytest-3.9.3, py-1.7.0, pluggy-0.8.0 -- c:\venv36\scripts\python.exe collected 7 items tests/test_nice.py::test_pass_fail FAILED [ 14%] tests/test_nice.py::test_with_nice OPPORTUNITY for improvement [ 28%] tests/test_nice.py::test_with_nice_verbose OPPORTUNITY for improvement [ 42%] tests/test_nice.py::test_not_nice_verbose FAILED [ 57%] tests/test_nice.py::test_header PASSED [ 71%] tests/test_nice.py::test_header_not_nice PASSED [ 85%] tests/test_nice.py::test_help_message PASSED [100%] ================================== FAILURES =================================== _______________________________ test_pass_fail ________________________________</code> </pre> <br><br>     <br><pre> <code class="plaintext hljs"> result.stdout.fnmatch_lines([ '*.F', # . for Pass, F for Fail ])</code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      on <br><pre> <code class="plaintext hljs"> result.stdout.fnmatch_lines([ '*.F*', # . for Pass, F for Fail ])</code> </pre> <br><br>   <code>*</code>  <code>F</code> <br><br>       <code>test_with_nice</code> , <code>test_with_nice_verbose</code> , <code>test_not_nice_verbose</code> <br><br>     pytest. <br>    c   <br> <code>'test_with_nice.py .O [100%]'</code> <br>   <code>.</code>        <br>  ,    <br><br> RemovedInPytest4Warning: usage of Session.Class is deprecated, please use pytest.Class instead <br><br>    ! <br><pre> <code class="plaintext hljs">(venv36) c:\_BOOKS_\pytest_si\bopytest-code\code\ch5\pytest-nice&gt;pytest -v ============================= test session starts ============================= platform win32 -- Python 3.6.5, pytest-3.9.3, py-1.7.0, pluggy-0.8.0 -- c:\venv36\scripts\python.exe cachedir: .pytest_cache rootdir: c:\_BOOKS_\pytest_si\bopytest-code\code\ch5\pytest-nice, inifile: plugins: nice-0.1.0 collected 7 items tests/test_nice.py::test_pass_fail PASSED [ 14%] tests/test_nice.py::test_with_nice PASSED [ 28%] tests/test_nice.py::test_with_nice_verbose PASSED [ 42%] tests/test_nice.py::test_not_nice_verbose PASSED [ 57%] tests/test_nice.py::test_header PASSED [ 71%] tests/test_nice.py::test_header_not_nice PASSED [ 85%] tests/test_nice.py::test_help_message PASSED [100%] ============================== warnings summary =============================== tests/test_nice.py::test_pass_fail c:\venv36\lib\site-packages\_pytest\compat.py:332: RemovedInPytest4Warning: usage of Session.Class is deprecated, please use pytest.Class instead return getattr(object, name, default)</code> </pre> <br></blockquote><p>  Hooray!   .     (pytest-nice),      Python <br>  pytest-: </p><br><pre> <code class="plaintext hljs">$ pip uninstall pytest-nice Uninstalling pytest-nice-0.1.0: Would remove: \path\to\venv\lib\site-packages\pytest_nice-0.1.0.dist-info\* ... Proceed (y/n)? y Successfully uninstalled pytest-nice-0.1.0</code> </pre> <br><p>        ‚Äî   ,     pytest,   PyPI. </p><br><h2 id="sozdanie-distributiva">   </h2><br><p>    ,      . ,         setup.py   : </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch5/pytest-nice $ python setup.py sdist running sdist running egg_info creating pytest_nice.egg-info ... running check creating pytest-nice-0.1.0 ... creating dist Creating tar archive ... $ ls dist pytest-nice-0.1.0.tar.gz</code> </pre> <br><p> ( ,  sdist  <em>source distribution</em> ‚Äî ‚Äú  .‚Äù) </p><br><p>  pytest-nice  dist      <code>pytest-nice-0.1.0.tar.gz</code> . </p><br><p>         ,    ,   : </p><br><pre> <code class="plaintext hljs">$ pip install dist/pytest-nice-0.1.0.tar.gz Processing ./dist/pytest-nice-0.1.0.tar.gz ... Installing collected packages: pytest-nice Successfully installed pytest-nice-0.1.0</code> </pre> <br><p>       <code>.tar.gz</code>   ,       . </p><br><h2 id="rasprostranenie-plaginov-cherez-obschiy-katalog">      </h2><br><p> <code>pip</code>       ,  ,    ,       ,   ,    ,     <code>.tar.gz</code>   . ,   <code>pytest-nice-0.1.0.tar.gz</code>     <code>myplugins</code> . </p><br><p>   <code>pytest-nice</code>  <code>myplugins</code> : </p><br><pre> <code class="plaintext hljs">$ pip install --no-index --find-links myplugins pytest-nice</code> </pre> <br><p> <code>--no-index</code>  <code>pip</code>    PyPI,   ,    . <br> The --find-links myplugins tells PyPI to look in myplugins for packages to install. And of course, pytest-nice is what we want to install. <br> <code>--find-links myplugins</code>  PyPI   <code>myplugins</code>   .  , <code>pytest-nice</code> ‚Äî  ,    . </p><br><p>         <code>myplugins</code>    ,    ,  <code>--upgrade</code> : </p><br><pre> <code class="plaintext hljs">$ pip install --upgrade --no-index --find-links myplugins pytest-nice</code> </pre> <br><p>      <code>pip</code> ,    <code>--no-index --find-links myplugins</code> . </p><br><h2 id="rasprostranenie-plaginov-cherez-pypi">    PyPI </h2><br><p>        ,    ,    .   ,    . ,          ,      ,     <a href="https://packaging.python.org/distributing">Python Packaging</a> . </p><br><p>     pytest,      ‚Äî  <a href="https://github.com/pytest-dev/cookiecutter-pytest-plugin"><code>cookiecutter-pytest-plugin</code></a> : </p><br><pre> <code class="plaintext hljs">$ pip install cookiecutter $ cookiecutter https://github.com/pytest-dev/cookiecutter-pytest-plugin</code> </pre> <br><p>          .      ,      .          ; , ,     .     pytest,      ,       . </p><br><h2 id="uprazhneniya">  Exercises </h2><br><p>  <code>ch4/cache/test_slower.py</code>  autouse fixture,  <code>check_duration()</code> .        4.      . </p><br><ol><li>     pytest-slower,        ,  ,    ¬´  ¬ª  . 102. </li><li>    ,   pytest-slower ,   . </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Write some test code for the plugin. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Take a look at the </font></font><a href="https://pypi.python.org/pypi"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python Package Index</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and look for "pytest-". </font><font style="vertical-align: inherit;">Find the pytest plugin that looks interesting to you.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Install the plugin of your choice and try it on Tasks tests. </font></font></li></ol><br><h2 id="chto-dalshe">  What's next </h2><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You have used many times </font></font><code>conftest.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in this book </font><font style="vertical-align: inherit;">so far </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">There are also configuration files that affect pytest performance, for example </font></font><code>pytest.ini</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">In the next chapter, you will learn about the various configuration files and learn what you can do to make your life easier during testing.</font></font></p><br><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://habr.com/ru/post/448792/">Back</a> <a href="https://habr.com/ru/post/448796/">Next</a> <img src="https://habrastorage.org/webt/rw/dy/-g/rwdy-grsvbpcetjttrmecdkxtlk.png"></p></div><p>Source: <a href="https://habr.com/ru/post/448794/">https://habr.com/ru/post/448794/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../448782/index.html">Python Testing with pytest. Getting started with pytest, Chapter 1</a></li>
<li><a href="../448786/index.html">Python Testing with pytest. CHAPTER 3 pytest Fixtures</a></li>
<li><a href="../448788/index.html">Python Testing with pytest. Chapter 2, Writing Test Functions</a></li>
<li><a href="../448790/index.html">SpaceVIL - cross-platform GUI framework for development on .Net Core, .Net Standard and JVM</a></li>
<li><a href="../448792/index.html">Python Testing with pytest. Builtin Fixtures, Chapter 4</a></li>
<li><a href="../448796/index.html">Python Testing with pytest. Configuration, CHAPTER 6</a></li>
<li><a href="../448798/index.html">Python Testing with pytest. Using pytest with other tools, CHAPTER 7</a></li>
<li><a href="../448806/index.html">Creating an extension system on the Qt library</a></li>
<li><a href="../448810/index.html">How I caught a hacker</a></li>
<li><a href="../448812/index.html">Lunar mission ‚ÄúBereshit‚Äù - the search for the first lunar library started after the accident of its carrier</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>