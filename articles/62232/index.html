<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Some useful aspects for PostSharp</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There are some serious AOP frameworks in the .net, but none of them ‚Äútax‚Äù as PostSharp . Being a big fan (as well as a user) of this framework, I want...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Some useful aspects for PostSharp</h1><div class="post__text post__text-html js-mediator-article"><img src="http://www.postsharp.org/images/stories/logo.png" align="right">  There are some serious AOP frameworks in the .net, but none of them ‚Äútax‚Äù as <a href="http://postsharp.org/">PostSharp</a> .  Being a big fan (as well as a user) of this framework, I want to present a few ‚Äúrecipes‚Äù to the community.  I created some of them myself, found others on the Internet and adapted them to fit my needs.  Here I will show some of the most "juicy" recipes.  And if you are not familiar with the framework or ideology of AOP, I can recommend <a href="">this webcast</a> .  So, let's begin? <br><br><a name="habracut"></a><br><h3>  Streams </h3><br>  The most ‚Äústereotypical‚Äù aspect in PostSharp is the aspect for invoking the tagged method in the pool.  The aspect is very simple, but sometimes it is very useful: <br><br>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote><code><font color="black"><font color="#00008B">public</font> <font color="#00008B">class</font> WorkerThreadAttribute : OnMethodInvocationAspect&lt;br/&gt; <br> {&lt;br/&gt; <br> <font color="#00008B">public</font> <font color="#00008B">override</font> <font color="#00008B">void</font> OnInvocation(MethodInvocationEventArgs eventArgs)&lt;br/&gt; <br> {&lt;br/&gt; <br> ThreadPool.QueueUserWorkItem(state =&gt; eventArgs.Proceed());&lt;br/&gt; <br> }&lt;br/&gt; <br> }&lt;br/&gt; <br></font></code> </blockquote>  It is interesting that you can call such code and get the return value without any type conversions, as when using <code>QueueUserWorkItem</code> directly. <br><br>  Since we have the ability to ‚Äúdirect‚Äù the method to a specific thread, we can easily declaratively make the method run in a UI stream, as in WinForms ... <br><br><blockquote> <code><font color="black"><font color="#00008B">public</font> <font color="#00008B">class</font> FormsThreadAttribute : OnMethodInvocationAspect&lt;br/&gt; <br> {&lt;br/&gt; <br> <font color="#00008B">public</font> <font color="#00008B">override</font> <font color="#00008B">void</font> OnInvocation(MethodInvocationEventArgs eventArgs)&lt;br/&gt; <br> {&lt;br/&gt; <br> Form f = (Form)eventArgs.Instance;&lt;br/&gt; <br> <font color="#00008B">if</font> (f.InvokeRequired)&lt;br/&gt; <br> f.Invoke(eventArgs.Delegate, eventArgs.GetArgumentArray());&lt;br/&gt; <br> <font color="#00008B">else</font> &lt;br/&gt; <br> eventArgs.Proceed();&lt;br/&gt; <br> }&lt;br/&gt; <br> }&lt;br/&gt; <br></font></code> </blockquote>  ... so in WPF: <br><br><blockquote> <code><font color="black"><font color="#00008B">public</font> <font color="#00008B">class</font> WpfThreadAttribute : OnMethodInvocationAspect&lt;br/&gt; <br> {&lt;br/&gt; <br> <font color="#00008B">private</font> DispatcherPriority priority;&lt;br/&gt; <br> <font color="#00008B">public</font> WpfThreadAttribute() : <font color="#00008B">this</font> (DispatcherPriority.Normal) { }&lt;br/&gt; <br> <font color="#00008B">public</font> WpfThreadAttribute(DispatcherPriority priority)&lt;br/&gt; <br> {&lt;br/&gt; <br> <font color="#00008B">this</font> .priority = priority;&lt;br/&gt; <br> }&lt;br/&gt; <br> <font color="#00008B">public</font> <font color="#00008B">override</font> <font color="#00008B">void</font> OnInvocation(MethodInvocationEventArgs eventArgs)&lt;br/&gt; <br> {&lt;br/&gt; <br> DispatcherObject dispatcherObject = (DispatcherObject)eventArgs.Instance;&lt;br/&gt; <br> <font color="#00008B">if</font> (dispatcherObject.CheckAccess())&lt;br/&gt; <br> eventArgs.Proceed();&lt;br/&gt; <br> <font color="#00008B">else</font> &lt;br/&gt; <br> dispatcherObject.Dispatcher.Invoke(priority, <font color="#00008B">new</font> Action(eventArgs.Proceed));&lt;br/&gt; <br> }&lt;br/&gt; <br> }&lt;br/&gt; <br></font></code> </blockquote>  In the latter case, we even have the opportunity to set the priority of execution. <br><br><h3>  Rewriting properties </h3><br>  In most cases, the logic inside the <code>set</code> / <code>get</code> methods is domain-specific, but there is one aspect that is sometimes useful to ‚Äúpull out‚Äù - these are the notification notification settings - something called property change notification.  In WinForms, we have the <code>INotifyPropertyChanged</code> interface <code>INotifyPropertyChanged</code> which sometimes is not so convenient to implement manually.  Also, this interface works in WPF, but there is another alternative - the creation of a so-called.  dependency property. <br><br>  Both solutions can be automatically applied to ordinary CLR autoproperties.  In both cases, the solutions are very difficult, so instead of the code I post links to the implementation of <a href="http://snipt.org/kkgn">INotifyPropertyChanged</a> and <a href="http://snipt.org/kkgo">Dependency Properties</a> .  By the way, I‚Äôve said that I used these snippets for the first time for quite a long time, and I‚Äôd hardly ever be able to use the ‚Äúmanual‚Äù implementation - unless they force the neofobes. <br><br><h3>  Lazy initialization </h3><br>  It may seem like a solution for the lazy, but lazy initialization can be done declaratively.  Moreover, using PostSharp, you can save a lazy initialization of a property even when its value is taken from the IoC container.  Here is a simple example - in it we will rewrite the field in our own way: <br><br><blockquote> <code><font color="black">[Serializable]&lt;br/&gt; <br> <font color="#00008B">class</font> LazyLoad : OnFieldAccessAspect&lt;br/&gt; <br> {&lt;br/&gt; <br> <font color="#00008B">private</font> <font color="#00008B">readonly</font> Type type;&lt;br/&gt; <br> <font color="#00008B">private</font> <font color="#00008B">readonly</font> <font color="#00008B">object</font> [] args;&lt;br/&gt; <br> <font color="#00008B">public</font> LazyLoad(Type type, <font color="#00008B">params</font> <font color="#00008B">object</font> [] arguments)&lt;br/&gt; <br> {&lt;br/&gt; <br> <font color="#00008B">this</font> .type = type;&lt;br/&gt; <br> args = arguments;&lt;br/&gt; <br> }&lt;br/&gt; <br> <font color="#00008B">public</font> <font color="#00008B">override</font> OnFieldAccessAspectOptions GetOptions()&lt;br/&gt; <br> {&lt;br/&gt; <br> <font color="#00008B">return</font> OnFieldAccessAspectOptions.RemoveFieldStorage;&lt;br/&gt; <br> }&lt;br/&gt; <br> <font color="#00008B">public</font> <font color="#00008B">override</font> <font color="#00008B">void</font> OnGetValue(FieldAccessEventArgs eventArgs)&lt;br/&gt; <br> {&lt;br/&gt; <br> <font color="#00008B">if</font> (eventArgs.StoredFieldValue == <font color="#00008B">null</font> )&lt;br/&gt; <br> eventArgs.StoredFieldValue = Activator.CreateInstance(type, args);&lt;br/&gt; <br> eventArgs.ExposedFieldValue = eventArgs.StoredFieldValue;&lt;br/&gt; <br> }&lt;br/&gt; <br> }&lt;br/&gt; <br></font></code> </blockquote>  Unfortunately, this code contains a not very neat implementation (the type of the object is transferred to the constructor), but on the other hand, this implementation provides additional flexibility.  And of course, no one bothers to cause, say, <code>My.IoCContainer.Resolve</code> , bypassing the traditional DI model in which ‚Äúeverything at once‚Äù is issued instead of <code>Activator.CreateInstance</code> . <br><br><h3>  Attempts </h3><br>  Another classic pattern (or anti-pattern, for those who hate every kind of syntactic sugar) is an aspect that allows you to call a method and, in the event of an exception, try to call the method several times with a certain time interval. <br><br><blockquote> <code><font color="black">[Serializable]&lt;br/&gt; <br> <font color="#00008B">public</font> <font color="#00008B">class</font> RetryAttribute : OnMethodInvocationAspect&lt;br/&gt; <br> {&lt;br/&gt; <br> <font color="#00008B">public</font> <font color="#00008B">int</font> Count { get; set; }&lt;br/&gt; <br> <font color="#00008B">public</font> <font color="#00008B">int</font> DelayMsec { get; set; }&lt;br/&gt; <br> <font color="#00008B">public</font> RetryAttribute( <font color="#00008B">int</font> count) : <font color="#00008B">this</font> (count, 0) { }&lt;br/&gt; <br> <font color="#00008B">public</font> RetryAttribute( <font color="#00008B">int</font> count, <font color="#00008B">int</font> delayMsec)&lt;br/&gt; <br> {&lt;br/&gt; <br> Count = count;&lt;br/&gt; <br> DelayMsec = delayMsec;&lt;br/&gt; <br> }&lt;br/&gt; <br> <font color="#00008B">public</font> <font color="#00008B">override</font> <font color="#00008B">void</font> OnInvocation(MethodInvocationEventArgs eventArgs)&lt;br/&gt; <br> {&lt;br/&gt; <br> <font color="#00008B">for</font> ( <font color="#00008B">int</font> a = 0; ; ++a)&lt;br/&gt; <br> {&lt;br/&gt; <br> <font color="#00008B">try</font> &lt;br/&gt; <br> {&lt;br/&gt; <br> <font color="#00008B">if</font> (a != 0 &amp;&amp; DelayMsec &gt; 0)&lt;br/&gt; <br> Thread.Sleep(DelayMsec);&lt;br/&gt; <br> eventArgs.Proceed();&lt;br/&gt; <br> <font color="#00008B">return</font> ;&lt;br/&gt; <br> } &lt;br/&gt; <br> <font color="#00008B">catch</font> &lt;br/&gt; <br> {&lt;br/&gt; <br> <font color="#00008B">if</font> (a == Count) <font color="#00008B">throw</font> ;&lt;br/&gt; <br> }&lt;br/&gt; <br> }&lt;br/&gt; <br> }&lt;br/&gt; <br> }&lt;br/&gt; <br></font></code> </blockquote>  Using this attribute allows you to moderate the "whims" of the system.  Also, its modified form can passively call the same function over and over again, aggregating the results of all calls.  In my practice, this approach was useful, for example, when enumerating working SQL servers in a local network, because the first call to the search function certainly finds some servers, but alas, not all. <br><br><h3>  Exceptions </h3><br>  Exception handling is another aspect of development that can be made declarative.  Here, for example, is the aspect that catches uncaught exceptions and issues a message in the box: <br><br><blockquote> <code><font color="black">[Serializable]&lt;br/&gt; <br> <font color="#00008B">public</font> <font color="#00008B">class</font> ExceptionDialogAttribute : OnExceptionAspect&lt;br/&gt; <br> {&lt;br/&gt; <br> <font color="#00008B">public</font> <font color="#00008B">override</font> <font color="#00008B">void</font> OnException(MethodExecutionEventArgs eventArgs)&lt;br/&gt; <br> {&lt;br/&gt; <br> ExceptionMessageBox emb = <font color="#00008B">new</font> ExceptionMessageBox(&lt;br/&gt; <br> eventArgs.Exception,&lt;br/&gt; <br> ExceptionMessageBoxButtons.OK,&lt;br/&gt; <br> ExceptionMessageBoxSymbol.Error);&lt;br/&gt; <br> emb.Show(eventArgs.Instance <font color="#00008B">as</font> Form);&lt;br/&gt; <br> eventArgs.FlowBehavior = FlowBehavior.Continue;&lt;br/&gt; <br> }&lt;br/&gt; <br> }&lt;br/&gt; <br></font></code> </blockquote>  Unlike the usual <code>MessageBox</code> I used the more beautiful and useful <code>ExceptionMessageBox</code> .  The idea, in principle, is quite simple.  And of course this aspect can be customized to ignore exceptions of a particular type altogether.  For example, when initializing add-ins in Visual Studio, an exception of type <code>ArgumentException</code> is a common thing, since  the studio sometimes tries to add menu items for commands that already exist.  To ‚Äúswallow‚Äù an exception, you can use the following aspect: <br><br><blockquote> <code><font color="black">[Serializable]&lt;br/&gt; <br> <font color="#00008B">public</font> <font color="#00008B">class</font> IgnoreExceptionAttribute : OnExceptionAspect&lt;br/&gt; <br> {&lt;br/&gt; <br> <font color="#00008B">private</font> Type type;&lt;br/&gt; <br> <font color="#00008B">public</font> IgnoreExceptionAttribute(Type type)&lt;br/&gt; <br> {&lt;br/&gt; <br> <font color="#00008B">this</font> .type = type;&lt;br/&gt; <br> }&lt;br/&gt; <br> <font color="#00008B">public</font> <font color="#00008B">override</font> Type GetExceptionType(System.Reflection.MethodBase method)&lt;br/&gt; <br> {&lt;br/&gt; <br> <font color="#00008B">return</font> type;&lt;br/&gt; <br> }&lt;br/&gt; <br> <font color="#00008B">public</font> <font color="#00008B">override</font> <font color="#00008B">void</font> OnException(MethodExecutionEventArgs eventArgs)&lt;br/&gt; <br> {&lt;br/&gt; <br> eventArgs.FlowBehavior = FlowBehavior.Continue;&lt;br/&gt; <br> } &lt;br/&gt; <br> }&lt;br/&gt; <br></font></code> </blockquote>  When creating websites on ASP.NET, I have a slightly different approach - I issue a ‚Äúsafe‚Äù page when an exception occurs, but I want the process of throwing out an exception (which, in fact, ASP.NET MVC system processes), it was intercepted and logged.  For this, I use the <a href="http://www.codeplex.com/diagnostics">CodePlex.Diagnostics</a> framework and this simple aspect: <br><br><blockquote> <code><font color="black">[Serializable]&lt;br/&gt; <br> <font color="#00008B">public</font> <font color="#00008B">sealed</font> <font color="#00008B">class</font> InterceptExceptionAttribute : OnExceptionAspect&lt;br/&gt; <br> {&lt;br/&gt; <br> <font color="#00008B">public</font> <font color="#00008B">override</font> <font color="#00008B">void</font> OnException(MethodExecutionEventArgs eventArgs)&lt;br/&gt; <br> {&lt;br/&gt; <br> IIdentity identity = WindowsIdentity.GetCurrent();&lt;br/&gt; <br> Guid guid = ExceptionProvider.Publish(eventArgs.Exception, identity);&lt;br/&gt; <br> <font color="#00008B">throw</font> <font color="#00008B">new</font> PublishedException(guid, eventArgs.Exception);&lt;br/&gt; <br> }&lt;br/&gt; <br> }&lt;br/&gt; <br></font></code> </blockquote><h3>  Tracing and logging </h3><br>  Since we are talking about logging, it‚Äôs a sin not to show any aspect for these purposes.  Despite the fact that most developers have their own, individual approaches to this problem, I want to show a simple aspect that records the ins and outs of methods, as well as exceptions.  For all these cases, the relevant information is displayed in the Output Studio window using a simple call to <code>Debug.WriteLine</code> : <br><br><blockquote> <code><font color="black">[Serializable]&lt;br/&gt; <br> <font color="#00008B">public</font> <font color="#00008B">sealed</font> <font color="#00008B">class</font> LogAttribute : OnMethodBoundaryAspect&lt;br/&gt; <br> {&lt;br/&gt; <br> <font color="#00008B">private</font> <font color="#00008B">static</font> <font color="#00008B">int</font> indent;&lt;br/&gt; <br> <font color="#00008B">private</font> <font color="#00008B">static</font> <font color="#00008B">int</font> indentSize = 4;&lt;br/&gt; <br> <font color="#00008B">private</font> <font color="#00008B">static</font> <font color="#00008B">string</font> IndentString&lt;br/&gt; <br> {&lt;br/&gt; <br> get&lt;br/&gt; <br> {&lt;br/&gt; <br> <font color="#00008B">return</font> <font color="#00008B">new</font> <font color="#00008B">string</font> (Enumerable.Range(0, indentSize*indent).Select(n =&gt; n%4 == 0 ? <font color="#A52A2A">'|'</font> : <font color="#A52A2A">' '</font> ).ToArray());&lt;br/&gt; <br> }&lt;br/&gt; <br> }&lt;br/&gt; <br> <font color="#00008B">private</font> <font color="#00008B">static</font> <font color="#00008B">void</font> Indent() { ++indent; }&lt;br/&gt; <br> <font color="#00008B">private</font> <font color="#00008B">static</font> <font color="#00008B">void</font> Unindent() { <font color="#00008B">if</font> (indent &gt; 0) --indent; }&lt;br/&gt; <br> <font color="#00008B">private</font> <font color="#00008B">static</font> <font color="#00008B">void</font> WriteLine( <font color="#00008B">string</font> s) { Debug.WriteLine(IndentString + s); }&lt;br/&gt; <br> <font color="#00008B">public</font> <font color="#00008B">override</font> <font color="#00008B">void</font> OnEntry(MethodExecutionEventArgs eventArgs)&lt;br/&gt; <br> {&lt;br/&gt; <br> StringBuilder sb = <font color="#00008B">new</font> StringBuilder();&lt;br/&gt; <br> sb.AppendFormat( <font color="#A52A2A">"Entering {0} with arguments"</font> , eventArgs.Method);&lt;br/&gt; <br> <font color="#00008B">object</font> [] args = eventArgs.GetReadOnlyArgumentArray() ?? <font color="#00008B">new</font> <font color="#00008B">object</font> [] {};&lt;br/&gt; <br> <font color="#00008B">foreach</font> (var arg <font color="#00008B">in</font> args)&lt;br/&gt; <br> {&lt;br/&gt; <br> sb.AppendFormat( <font color="#A52A2A">" &lt;{0}&gt;"</font> , arg);&lt;br/&gt; <br> }&lt;br/&gt; <br> WriteLine(sb.ToString());&lt;br/&gt; <br> Indent();&lt;br/&gt; <br> }&lt;br/&gt; <br> <font color="#00008B">public</font> <font color="#00008B">override</font> <font color="#00008B">void</font> OnExit(MethodExecutionEventArgs eventArgs)&lt;br/&gt; <br> {&lt;br/&gt; <br> Unindent();&lt;br/&gt; <br> WriteLine( <font color="#A52A2A">"Exiting "</font> + eventArgs.Method);&lt;br/&gt; <br> }&lt;br/&gt; <br> <font color="#00008B">public</font> <font color="#00008B">override</font> <font color="#00008B">void</font> OnException(MethodExecutionEventArgs eventArgs)&lt;br/&gt; <br> {&lt;br/&gt; <br> StringBuilder sb = <font color="#00008B">new</font> StringBuilder();&lt;br/&gt; <br> sb.AppendFormat( <font color="#A52A2A">"Exception {0} in {1}"</font> , eventArgs.Exception, eventArgs.Method);&lt;br/&gt; <br> sb.AppendLine();&lt;br/&gt; <br> WriteLine(sb.ToString());&lt;br/&gt; <br> }&lt;br/&gt; <br> }&lt;br/&gt; <br></font></code> </blockquote>  It should be mentioned here that for logging there is the addition of <a href="http://code.google.com/p/postsharp-user-plugins/wiki/Log4PostSharp">Log4PostSharp</a> , which records information on the input and output of methods using the subsystem <a href="http://logging.apache.org/log4net/index.html">log4net</a> . <br><br><h3>  Performance measurement </h3><br>  The author himself PostSharp'a in one of his <a href="http://www.codeproject.com/KB/cs/ps-custom-attributes-2.aspx">article on CodeProject</a> showed an interesting use of aspects to calculate the speed of execution of methods, as well as recording the number of their calls.  These features are based on the fact that in aspect, just like in normal code, you can have static members, and call them whenever you like.  What makes the following aspect possible: <br><br><blockquote> <code><font color="black">[Serializable]&lt;br/&gt; <br> <font color="#00008B">public</font> <font color="#00008B">class</font> PerformanceCounterAttribute : OnMethodInvocationAspect&lt;br/&gt; <br> {&lt;br/&gt; <br> <font color="#00008B">private</font> <font color="#00008B">static</font> <font color="#00008B">readonly</font> Dictionary&lt; <font color="#00008B">string</font> , PerformanceCounterAttribute&gt;&lt;br/&gt; <br> attributes = <font color="#00008B">new</font> Dictionary&lt; <font color="#00008B">string</font> , PerformanceCounterAttribute&gt;();&lt;br/&gt; <br> <font color="#00008B">private</font> <font color="#00008B">long</font> elapsedTicks;&lt;br/&gt; <br> <font color="#00008B">private</font> <font color="#00008B">long</font> hits;&lt;br/&gt; <br> [NonSerialized]&lt;br/&gt; <br> <font color="#00008B">private</font> MethodBase method;&lt;br/&gt; <br> <font color="#00008B">public</font> MethodBase Method { get { <font color="#00008B">return</font> method; } }&lt;br/&gt; <br> <font color="#00008B">public</font> <font color="#00008B">double</font> ElapsedMilliseconds&lt;br/&gt; <br> {&lt;br/&gt; <br> get { <font color="#00008B">return</font> elapsedTicks / (Stopwatch.Frequency / 1000d); }&lt;br/&gt; <br> }&lt;br/&gt; <br> <font color="#00008B">public</font> <font color="#00008B">long</font> Hits { get { <font color="#00008B">return</font> hits; } }&lt;br/&gt; <br> <font color="#00008B">public</font> <font color="#00008B">static</font> IDictionary&lt; <font color="#00008B">string</font> , PerformanceCounterAttribute&gt; Attributes&lt;br/&gt; <br> {&lt;br/&gt; <br> get&lt;br/&gt; <br> {&lt;br/&gt; <br> <font color="#00008B">return</font> attributes;&lt;br/&gt; <br> }&lt;br/&gt; <br> }&lt;br/&gt; <br> <font color="#00008B">public</font> <font color="#00008B">override</font> <font color="#00008B">void</font> OnInvocation(MethodInvocationEventArgs eventArgs)&lt;br/&gt; <br> {&lt;br/&gt; <br> Stopwatch stopwatch = Stopwatch.StartNew();&lt;br/&gt; <br> <font color="#00008B">try</font> &lt;br/&gt; <br> {&lt;br/&gt; <br> eventArgs.Proceed();&lt;br/&gt; <br> }&lt;br/&gt; <br> <font color="#00008B">finally</font> &lt;br/&gt; <br> {&lt;br/&gt; <br> stopwatch.Stop();&lt;br/&gt; <br> Interlocked.Add( <font color="#00008B">ref</font> elapsedTicks, stopwatch.ElapsedTicks);&lt;br/&gt; <br> Interlocked.Increment( <font color="#00008B">ref</font> hits);&lt;br/&gt; <br> }&lt;br/&gt; <br> }&lt;br/&gt; <br> <font color="#00008B">public</font> <font color="#00008B">override</font> <font color="#00008B">void</font> RuntimeInitialize(MethodBase method)&lt;br/&gt; <br> {&lt;br/&gt; <br> <font color="#00008B">base</font> .RuntimeInitialize(method);&lt;br/&gt; <br> <font color="#00008B">this</font> .method = method;&lt;br/&gt; <br> attributes.Add(method.Name, <font color="#00008B">this</font> );&lt;br/&gt; <br> }&lt;br/&gt; <br> }&lt;br/&gt; <br></font></code> </blockquote>  Such an interesting PostSharp.  And what aspects do you know? </div><p>Source: <a href="https://habr.com/ru/post/62232/">https://habr.com/ru/post/62232/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../62222/index.html">4 paradoxes of quantum physics</a></li>
<li><a href="../62223/index.html">Broke editing survey</a></li>
<li><a href="../62226/index.html">Approaching 3D maps</a></li>
<li><a href="../62228/index.html">% username%, do you want to shoot balls with paint in another% username%?</a></li>
<li><a href="../62230/index.html">Preparation of articles for Habr: Markdown extension + syntax highlighting + loading images</a></li>
<li><a href="../62233/index.html">Why is it Opera Unite?</a></li>
<li><a href="../62234/index.html">Global network of discussions and comments</a></li>
<li><a href="../62235/index.html">Do I need a diploma from the university?</a></li>
<li><a href="../62237/index.html">Random numbers from sound card</a></li>
<li><a href="../62238/index.html">How I raised my site traffic</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>