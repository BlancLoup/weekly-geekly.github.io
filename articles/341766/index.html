<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How I learned to directly reboot into the correct OS via UEFI</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good evening, Habrahabr! 


 Today we will learn to reboot from Linux straight to Windows and back in just one (double) click. 





 Given: 


- Two ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How I learned to directly reboot into the correct OS via UEFI</h1><div class="post__text post__text-html js-mediator-article"><p>  Good evening, Habrahabr! </p><br><p>  Today we will learn to reboot from Linux straight to Windows and back in just one (double) click. </p><br><p><img src="https://habrastorage.org/webt/ow/go/zu/owgozuczrg6wtkkdotynv4hds5k.jpeg" alt="image"></p><a name="habracut"></a><br><p>  <u><strong>Given:</strong></u> </p><br><ul><li>  Two GPT disks with different OS </li><li>  Motherboard with UEFI and disabled Legacy Mode </li><li>  Windows, which was carefully installed with full UEFI support </li><li>  Linux (I have Manjaro), which was carefully installed, having cut out any mention of GRUB and other old-fashioned things </li><li>  rEFInd is a beautiful download manager (no, not a bootloader) </li></ul><br><p>  <u><strong>It is necessary:</strong></u> </p><br><ul><li>  Write two scripts to * sh and cmd (bat), which will allow to reboot into the desired OS </li></ul><br><p>  <u><strong>Notes:</strong></u> </p><br><ul><li>  Working options are marked as <strong><u>Decision</u></strong> , the rest is my reasoning and description of the path to the goal. </li><li>  I deliberately omit the description of those parts that do not relate to the essence of the settings, or easily vary.  These details are mentioned because for me they were not obvious at the time of customization, so the article becomes more understandable for inexperienced readers who will not see in it instructions for drawing owls. </li><li>  <a href="https://habrahabr.ru/post/341766/">Why you</a> should be careful when modifying NVRAM </li></ul><br><h3 id="linux">  Linux: </h3><br><p><img src="https://habrastorage.org/webt/cf/lg/oc/cflgoc1pbxgjop98-pdvutmpaio.png" alt="Linux is your bro"><br>  Linux is an excellent base for working with computers, so everything that we need is already in the repositories, and the collective intelligence of the community knows everything and is always ready to help.  Therefore, after a brief study of the Internet, put <strong><em>efibootmgr</em></strong> : </p><br><div class="spoiler">  <b class="spoiler_title">I had it so</b> <div class="spoiler_text"><pre><code class="bash hljs">sudo pacman -S efibootmgr</code> </pre> </div></div><br><p>  Ok, now we run: </p><br><pre> <code class="bash hljs">sudo efibootmgr</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">See something like this</b> <div class="spoiler_text"><pre> <code class="bash hljs">Timeout: 1 seconds BootOrder: 0001,0000 Boot0000* Windows Boot Manager Boot0001* rEFInd Boot Manager</code> </pre> </div></div><br><p>  Attentive readers probably already noticed that something was wrong in the output, but then I was inspired by the idea that in 15 minutes I would fly between operating systems without problems, and did not pay enough attention to it. <br>  Ok, 3 minutes for the documentation, and we find the necessary parameter " <strong>-n</strong> ", which sets the custom boot order exactly at one time.  We try to execute this command: <br>  <strong><u>Decision</u></strong> </p><br><pre> <code class="bash hljs">sudo efibootmgr -n 0000 &amp;&amp; sync &amp;&amp; reboot</code> </pre> <br><p>  And we find ourselves in Windows, just like that and wanted.  Now we write this command to the script / alias / *. Desktop-file and enjoy how everything turned out great. </p><br><h3 id="windows">  Windows: </h3><br><p><img src="https://habrastorage.org/webt/u7/nc/oc/u7ncocw4oliniqtg-al6nkdvty8.png" alt="Typical Windows"><br>  It all began with the search for an analogue of efibootmgr for Windows, which, of course, is not in its pure form.  To calm my conscience, I even tried to use Linux Subsystem, but this, of course, did not work. <br>  A quick search on the Internet showed that the <strong><em>bcdedit</em></strong> utility has similar functionality for modifying NVRAM.  Great, I think, I launch PowerShell from under the Administrator and write </p><br><pre> <code class="hljs rust">bcdedit /<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">enum</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">firmware</span></span></span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Here is what I saw</b> <div class="spoiler_text"><pre> <code class="hljs tex">Firmware Boot Manager --------------------- identifier {fwbootmgr} displayorder {6893bb38-946b-11e7-b175-9301bd8a88f4} {bootmgr} timeout 1 Windows Boot Manager -------------------- identifier {bootmgr} device partition=<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Device</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HarddiskVolume</span></span></span></span>2 path <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EFI</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Microsoft</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Boot</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bootmgfw</span></span></span></span>.efi description Windows Boot Manager locale ru-RU inherit {globalsettings} default {current} resumeobject {6893bb40-946b-11e7-b175-9301bd8a88f4} toolsdisplayorder {memdiag} timeout 30 Firmware Application (101fffff) ------------------------------- identifier {6893bb38-946b-11e7-b175-9301bd8a88f4} device partition=<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Device</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HarddiskVolume</span></span></span></span>2 path <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EFI</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">REFIND</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">REFIND</span></span></span></span>_X64.EFI description rEFInd Boot Manager</code> </pre> </div></div><br><p>  Where is Linux?  Where to boot? <del>  Hate windows </del><br>  In fact, it turned out that it was not Windows that was to blame, but I (yes, that very moment for attentive users), and here's why: rEFInd is an excellent utility that usually requires you to install yourself to work correctly.  She is able to pick up all .efi files, different distributions with different kernels, she herself inserts icons.  Charm, not a tool.  But this played a cruel joke on me, as it turned out that UEFI did not know anything about Linux, since the corresponding .efi file was missing. <br>  Therefore, we reboot back to Linux, configure <strong><em>systemd-boot</em></strong> (bootctl).  Now it looks like this: </p><br><pre> <code class="bash hljs">Timeout: 1 seconds BootOrder: 0001,0003,0000,0002 Boot0000* Windows Boot Manager Boot0001* rEFInd Boot Manager Boot0002* Linux Boot Manager Boot0003* Manjaro</code> </pre> <br><p>  Go back and run again. </p><br><pre> <code class="hljs rust">bcdedit /<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">enum</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">firmware</span></span></span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Here is what I saw now</b> <div class="spoiler_text"><pre> <code class="hljs tex">Firmware Boot Manager --------------------- identifier {fwbootmgr} displayorder {6893bb38-946b-11e7-b175-9301bd8a88f4} {bootmgr} {ff0bc716-c088-11e7-bf74-000acd2dac7d} {ff0bc716-c088-11e7-bf74-000acd2dac7d} timeout 1 Windows Boot Manager -------------------- identifier {bootmgr} device partition=<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Device</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HarddiskVolume</span></span></span></span>2 path <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EFI</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Microsoft</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Boot</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bootmgfw</span></span></span></span>.efi description Windows Boot Manager locale ru-RU inherit {globalsettings} default {current} resumeobject {6893bb40-946b-11e7-b175-9301bd8a88f4} toolsdisplayorder {memdiag} timeout 30 Firmware Application (101fffff) ------------------------------- identifier {6893bb38-946b-11e7-b175-9301bd8a88f4} device partition=<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Device</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HarddiskVolume</span></span></span></span>2 path <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EFI</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">REFIND</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">REFIND</span></span></span></span>_X64.EFI description rEFInd Boot Manager Firmware Application (101fffff) ------------------------------- identifier {ff0bc716-c088-11e7-bf74-000acd2dac7d} device partition=<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Device</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HarddiskVolume</span></span></span></span>2 path <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EFI</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SYSTEMD</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SYSTEMD</span></span></span></span>-BOOTX64.EFI description Linux Boot Manager Firmware Application (101fffff) ------------------------------- identifier {ff0bc717-c088-11e7-bf74-000acd2dac7d} device partition=<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Device</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HarddiskVolume</span></span></span></span>1 path <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EFI</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manjaro</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vmlinuz</span></span></span></span>-4.13-x86_64 description Manjaro</code> </pre> </div></div><br><p>  It is worth mentioning here that <a href="https://www.reddit.com/r/sysadmin/comments/7akp7n/question_direct_boot_from_windows_to_linux_with/">reddit</a> users helped me solve the problem.  Thanks to them we have the following step: </p><br><pre> <code class="hljs">bcdedit /bootsequence {ff0bc716-c088-11e7-bf74-000acd2dac7d}</code> </pre> <br><p>  Where the argument is the identifier of the required option - Linux Boot Manager. </p><br><div class="spoiler">  <b class="spoiler_title">Troubleshooting</b> <div class="spoiler_text"><p>  Powershell does not allow to execute this command normally, cursing at </p><br><pre> <code class="hljs pgsql">The entry list data <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">valid</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> specified.</code> </pre> <br><p>  All because of the fact that Microsoft periodically likes to break something.  The solution is simple and elegant - we call the classic CMD and work in it.  This can be done with the command </p><br><pre> <code class="hljs dos"><span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span></code> </pre> </div></div><br><p>  Reboot and see that the boot order has not changed, and we found ourselves in the first element in BootOrder (I had it rEFInd), select Windows and see a terrible hello from DOS times, which tells us that \ EFI \ SYSTEMD \ SYSTEMD-BOOTX64. EFI not found.  Yes, we changed the Windows bootloader settings, but not UEFI. <br>  The struggle with this mistake took me all the holidays, but nothing good could be done.  I already thought of writing a small program for C ++ for this (that this is possible, follows from the existence of such software as EasyUEFI). <br>  But here on the next site I found this design </p><br><pre> <code class="hljs sql"> bcdedit /<span class="hljs-keyword"><span class="hljs-keyword">set</span></span> {bootmgr} <span class="hljs-keyword"><span class="hljs-keyword">path</span></span> ....</code> </pre> <br><p>  And then it dawned on me that you can directly tell bcdedit what to write and where.  Further it was worth only to check the guess: <br>  <strong><u>Decision</u></strong> </p><br><pre> <code class="hljs swift">bcdedit.exe /<span class="hljs-keyword"><span class="hljs-keyword">set</span></span> {fwbootmgr} bootsequence {ff0bc716-c088-11e7-bf74-000acd2dac7d} /addfirst</code> </pre> <br><p>  Here it is important that we explicitly told to write not in {bootmgr} (as he apparently does by default), but in {fwbootmgr}, which is our UEFI settings. <br>  Reboot, and everything works as we wanted.  We save this business in bat / lnk, we add </p><br><pre> <code class="hljs perl"><span class="hljs-keyword"><span class="hljs-keyword">shutdown</span></span> /r /t <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br><p>  We expose start from under the administrator and it is ready! <br>  Thanks for attention!  I would be very happy to comment on the technical part in the comments, comments on the design - in drugs. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/341766/">https://habr.com/ru/post/341766/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../341750/index.html">JPoint 2018 Java Conference Announcement: JDK 9, High Load and JVM Performance</a></li>
<li><a href="../341752/index.html">How I found vulnerabilities in Google's bug tracking system and got $ 15,600</a></li>
<li><a href="../341756/index.html">Unreal Engine: QuickStart in Qt Creator under Arch Linux</a></li>
<li><a href="../341760/index.html">Infrastructure with Kubernetes as an affordable service</a></li>
<li><a href="../341764/index.html">Linux package managers almanac</a></li>
<li><a href="../341768/index.html">An easy-to-use status container for a Restore application called Xstore.</a></li>
<li><a href="../341772/index.html">Is it time to save the web?</a></li>
<li><a href="../341774/index.html">Analysis of robots.txt files of the largest sites</a></li>
<li><a href="../341776/index.html">RailsClub 2017. Materials</a></li>
<li><a href="../341778/index.html">How to incorrectly test the performance of NoSQL DB in Amazon</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>