<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We write our system monitor (Linux)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I will describe the process of creating your own system monitor. This system monitor shows: 


- Hostname 
- Username 
- Uptime 
- Pro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We write our system monitor (Linux)</h1><div class="post__text post__text-html js-mediator-article">  In this article I will describe the process of creating your own system monitor.  This system monitor shows: <br><ul><li>  Hostname </li><li>  Username </li><li>  Uptime </li><li>  Processor model name </li><li>  CPU frequency </li><li>  CPU load </li><li>  Amount of RAM </li><li>  The amount of RAM used without cached data </li><li>  Running processes </li></ul><a name="habracut"></a><br>  If it is not clear to someone in the penultimate point what it means without cached data, then read <a href="https://wiki.archlinux.org/index.php/FAQ_(%25D0%25A0%25D1%2583%25D1%2581%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9)">this</a> , it describes what it means.  Also in this system monitor implemented the ability to complete processes. <br>  As a result, we should have such a system monitor: <br><img src="https://habrastorage.org/getpro/habr/post_images/e73/579/4ae/e735794aed4c6e98f97bc4f748239910.jpg" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/158/de9/d1a/158de9d1ac5da4c85e14e7aea8f69c1f.jpg" alt="image"><br>  Now its main features are defined, and I can proceed to the description of the code, I warn you right away that the code will only work in Linux, since almost all of its features are based on parsing the / proc folder.  I divided my system monitor into three classes, in the first class the general system information is realized, in the second class the process table, and the third class will combine this into one whole.  Here is the first class frame, I called it Info: <br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> INFO_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> INFO_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;QtGui&gt; #include &lt;iostream&gt; #include &lt;fstream&gt; #include &lt;pwd.h&gt; #include &lt;unistd.h&gt; #include &lt;sys/sysinfo.h&gt; #include &lt;vector&gt; using namespace std; class Info : public QWidget { Q_OBJECT public: explicit Info(QWidget *parent = 0); private: QLabel * hostname; QLabel * user; QLabel * uptime; QLabel * proc; QLabel * freq; QLabel * cpuload; QLabel * mem; QLabel * memload; QProgressBar * cpubar; QProgressBar * membar; QVBoxLayout * layout; QHBoxLayout * hlayout; vector&lt;float&gt; readCpuStats(); int getCpuLoad(double dt); public slots: void update(); }; #endif // INFO_H</span></span></span></span></code> </pre> <br>  The header files pwd.h and unistd.h are used to get the username, and the header file sys / sysinfo.h is used to get uptime.  Now I will describe the implementation of the Info class, it is located in the info.cpp file.  At the very beginning of the info.cpp file we have to connect info.h (framework of the info class).  The Info class constructor looks like this: <br><pre> <code class="cpp hljs">Info::Info(QWidget *parent) : QWidget(parent) { hostname = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QLabel(<span class="hljs-string"><span class="hljs-string">"Hostname: "</span></span>); user = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QLabel(<span class="hljs-string"><span class="hljs-string">": "</span></span>); uptime = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QLabel(<span class="hljs-string"><span class="hljs-string">"Uptime: "</span></span>); proc = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QLabel(<span class="hljs-string"><span class="hljs-string">": "</span></span>); freq = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QLabel(<span class="hljs-string"><span class="hljs-string">":"</span></span>); cpuload = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QLabel(<span class="hljs-string"><span class="hljs-string">" : "</span></span>); mem = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QLabel(<span class="hljs-string"><span class="hljs-string">" : "</span></span>); memload = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QLabel(<span class="hljs-string"><span class="hljs-string">"  : "</span></span>); cpubar = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QProgressBar; membar = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QProgressBar; layout = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QVBoxLayout; hlayout = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QHBoxLayout; cpubar-&gt;setMaximumHeight(<span class="hljs-number"><span class="hljs-number">21</span></span>); membar-&gt;setMaximumHeight(<span class="hljs-number"><span class="hljs-number">21</span></span>); hlayout-&gt;addWidget(cpuload); hlayout-&gt;addWidget(cpubar); layout-&gt;addWidget(hostname); layout-&gt;addWidget(user); layout-&gt;addWidget(uptime); layout-&gt;addWidget(proc); layout-&gt;addWidget(freq); layout-&gt;addLayout(hlayout); layout-&gt;addWidget(mem); layout-&gt;addWidget(memload); layout-&gt;addWidget(membar); setLayout(layout); update(); QTimer *timer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QTimer; connect(timer, SIGNAL(timeout()), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, SLOT(update())); timer-&gt;start(<span class="hljs-number"><span class="hljs-number">2000</span></span>); }</code> </pre><br>  at the very beginning we initialize all the graphic elements.  By the next action we set up graphic elements in the layouts.  After we call the update slot so that all labels and progress bars are filled with values.  So that the information is regularly updated we create an object of the QTimer class, and connect its timeout signal with the update slot already familiar to us. <br>  I think it would be logical to describe the following update slot, here is its code: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Info::update() { <span class="hljs-function"><span class="hljs-function">ifstream </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stream</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"/proc/sys/kernel/hostname"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> str; getline(stream,str); hostname-&gt;setText(<span class="hljs-string"><span class="hljs-string">"Hostname: "</span></span> + QString::fromStdString(str)); <span class="hljs-keyword"><span class="hljs-keyword">uid_t</span></span> uid = geteuid(); passwd *pw = getpwuid(uid); user-&gt;setText(<span class="hljs-string"><span class="hljs-string">": "</span></span> + QString::fromAscii(pw-&gt;pw_name)); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sysinfo</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">o</span></span></span><span class="hljs-class">;</span></span> sysinfo(&amp;o); <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> up = o.uptime; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> hour = up/<span class="hljs-number"><span class="hljs-number">60</span></span>/<span class="hljs-number"><span class="hljs-number">60</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> min = (up - hour*<span class="hljs-number"><span class="hljs-number">60</span></span>*<span class="hljs-number"><span class="hljs-number">60</span></span>) / <span class="hljs-number"><span class="hljs-number">60</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sec = ((up - hour*<span class="hljs-number"><span class="hljs-number">60</span></span>*<span class="hljs-number"><span class="hljs-number">60</span></span>) - min*<span class="hljs-number"><span class="hljs-number">60</span></span>); QString e = QString::number(hour) + QString(<span class="hljs-string"><span class="hljs-string">" h. "</span></span>) + QString::number(min) + QString(<span class="hljs-string"><span class="hljs-string">" m. "</span></span>) + QString::number(sec) + QString(<span class="hljs-string"><span class="hljs-string">" s."</span></span>); uptime-&gt;setText(<span class="hljs-string"><span class="hljs-string">"Uptime: "</span></span> + e); stream.close(); stream.open(<span class="hljs-string"><span class="hljs-string">"/proc/cpuinfo"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">16</span></span>;i++) stream &gt;&gt; str; getline(stream,str); proc-&gt;setText(<span class="hljs-string"><span class="hljs-string">": "</span></span> + QString::fromStdString(str)); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt; <span class="hljs-number"><span class="hljs-number">7</span></span>; i++) stream &gt;&gt; str; freq-&gt;setText(<span class="hljs-string"><span class="hljs-string">": "</span></span> + QString::fromStdString(str) + <span class="hljs-string"><span class="hljs-string">" MHz"</span></span>); cpubar-&gt;setValue(getCpuLoad(<span class="hljs-number"><span class="hljs-number">0.3</span></span>)); stream.close(); stream.open(<span class="hljs-string"><span class="hljs-string">"/proc/meminfo"</span></span>); stream &gt;&gt; str; stream &gt;&gt; str; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> num = atoi(str.c_str()); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> percent = num / <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> gb = (num / <span class="hljs-number"><span class="hljs-number">1024</span></span>) / <span class="hljs-number"><span class="hljs-number">1024</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> mb = (num-gb*<span class="hljs-number"><span class="hljs-number">1024</span></span>*<span class="hljs-number"><span class="hljs-number">1024</span></span>) /<span class="hljs-number"><span class="hljs-number">1024</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> kb = (num - (gb*<span class="hljs-number"><span class="hljs-number">1024</span></span>*<span class="hljs-number"><span class="hljs-number">1024</span></span>+mb*<span class="hljs-number"><span class="hljs-number">1024</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gb &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) e = QString::number(gb) + QString(<span class="hljs-string"><span class="hljs-string">" Gb "</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> e = QString(<span class="hljs-string"><span class="hljs-string">""</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mb &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) e += QString::number(mb) + QString(<span class="hljs-string"><span class="hljs-string">" Mb "</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (kb &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) e += QString::number(kb) + QString(<span class="hljs-string"><span class="hljs-string">" Kb "</span></span>); mem-&gt;setText(<span class="hljs-string"><span class="hljs-string">" : "</span></span> + e); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-built_in"><span class="hljs-built_in">free</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span> ; i &lt; <span class="hljs-number"><span class="hljs-number">3</span></span> ; i++) { stream &gt;&gt; str; stream &gt;&gt; str; stream &gt;&gt; str; <span class="hljs-built_in"><span class="hljs-built_in">free</span></span> += atoi(str.c_str()); } num -= <span class="hljs-built_in"><span class="hljs-built_in">free</span></span>; gb = num / <span class="hljs-number"><span class="hljs-number">1024</span></span> / <span class="hljs-number"><span class="hljs-number">1024</span></span>; mb = (num - gb*<span class="hljs-number"><span class="hljs-number">1024</span></span>*<span class="hljs-number"><span class="hljs-number">1024</span></span>) / <span class="hljs-number"><span class="hljs-number">1024</span></span>; kb = (num - ((mb*<span class="hljs-number"><span class="hljs-number">1024</span></span>) + (gb * <span class="hljs-number"><span class="hljs-number">1024</span></span> * <span class="hljs-number"><span class="hljs-number">1024</span></span>))); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gb &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) e = QString::number(gb) + QString(<span class="hljs-string"><span class="hljs-string">" Gb "</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> e = QString(<span class="hljs-string"><span class="hljs-string">""</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mb &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) e += QString::number(mb) + QString(<span class="hljs-string"><span class="hljs-string">" Mb "</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (kb &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) e += QString::number(kb) + QString(<span class="hljs-string"><span class="hljs-string">" Kb "</span></span>); memload-&gt;setText(<span class="hljs-string"><span class="hljs-string">"  : "</span></span> + e); percent = num / percent; membar-&gt;setValue(percent); }</code> </pre><br>  First, we open for reading (this is why the program does not require superuser rights) file / proc / sys / kernel / hostname and get the name of the machine, after which we fill in the hostname label.  after which we create an instance of the passwd and uid_t structure, with which we get the user name to fill in the user label.  Information on how to find out the username was taken from the source of the whoami program.  After that, we create and populate with an instance of the sysinfo structure, from which we take information about the uptime system.  After that, we associate the already created stream with the file / proc / cpuinfo, in which we find information about the name of the processor model and its frequency.  The processor load is obtained using the getCpuLoad method, which I will describe below.  Now we associate the stream with the file / proc / meminfo from which we take the amount of RAM, and bring it to a conveniently readable form.  Then from the same file we get the amount of free RAM, as well as the amount of cached data.  To get the amount of occupied RAM, we subtract the free RAM and the amount of cached data from all RAM, and then again we bring it to a conveniently readable form.  Now as I promised the above function description getCpuLoad.  I did not write this function myself (I took it <a href="http://0xc0dec.org/2011/06/16/cpp_linux_cpu_load/">from here</a> ), so I cannot give a very detailed description of it, I will describe it in general terms.  Here she is: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Info::getCpuLoad(<span class="hljs-keyword"><span class="hljs-keyword">double</span></span> dt) { <span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>&gt; stats1 = readCpuStats(); QProcess::execute(<span class="hljs-string"><span class="hljs-string">"sleep"</span></span>,QStringList() &lt;&lt; QString::number(dt)); <span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>&gt; stats2 = readCpuStats(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> size1 = stats1.size(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> size2 = stats2.size(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!size1 || !size2 || size1 != size2) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; size1; ++i) stats2[i] -= stats1[i]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sum = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; size1; ++i) sum += stats2[i]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> load = <span class="hljs-number"><span class="hljs-number">100</span></span> - (stats2[size2 - <span class="hljs-number"><span class="hljs-number">1</span></span>] * <span class="hljs-number"><span class="hljs-number">100</span></span> / sum); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> load; }</code> </pre><br>  we get three values ‚Äã‚Äãtwo times using the readCpuStats function (I'll also describe it below), but we call this function with a certain amount of time.  After the CPU is calculated based on these values.  And now the description of the readCpuStats function: <br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>&gt; Info::readCpuStats() { <span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>&gt; ret; <span class="hljs-function"><span class="hljs-function">ifstream </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stat_file</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"/proc/stat"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!stat_file.is_open()) { <span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Unable to open /proc/stat"</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> val; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> tmp; stat_file &gt;&gt; tmp; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">4</span></span>; ++i) { stat_file &gt;&gt; val; ret.push_back(val); } stat_file.close(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; }</code> </pre><br>  This function was taken from the same site as the getCpuLoad function.  In this function, we read the values ‚Äã‚Äãfrom the / proc / stat file, and put them into a vector, which we then return with the return statement. <br>  Now the Info class is written, and you can proceed to writing the ProcessTable class.  Here is the frame of this class: <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> PROCESSTABLE_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PROCESSTABLE_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;QtGui&gt; #include &lt;iostream&gt; #include &lt;fstream&gt; using namespace std; class ProcessTable : public QWidget { Q_OBJECT public: explicit ProcessTable(QWidget *parent = 0); private: QTableWidget * table; QHBoxLayout* hlayout; QPushButton* button; QVBoxLayout* layout; public slots: void update(); void kill(); }; #endif // PROCESSTABLE_H</span></span></span></span></code> </pre><br>  The update slot is used to populate the table, and the kill slot is used to terminate processes.  In the implementation file of this class, we must first include a file with its framework.  Now I come to the description of the constructor of this class, here is the constructor code: <br><pre> <code class="cpp hljs">ProcessTable::ProcessTable(QWidget *parent) : QWidget(parent) { hlayout = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QHBoxLayout; button = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QPushButton(<span class="hljs-string"><span class="hljs-string">""</span></span>); button-&gt;setToolTip(<span class="hljs-string"><span class="hljs-string">"       PID     \"\""</span></span>); connect(button,SIGNAL(clicked()),<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>,SLOT(kill())); hlayout-&gt;addStretch(); hlayout-&gt;addWidget(button); layout = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QVBoxLayout; table = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QTableWidget; update(); layout-&gt;addWidget(table); layout-&gt;addLayout(hlayout); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;setLayout(layout); QTimer *timer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QTimer; connect(timer, SIGNAL(timeout()), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, SLOT(update())); timer-&gt;start(<span class="hljs-number"><span class="hljs-number">4000</span></span>); }</code> </pre><br>  First, we initialize the graphic elements, and companion them, as well as connect the clicked signal at the ‚ÄúFinish‚Äù button to the slot of our class - kill.  We also call the update slot to populate the table, and implement the update of the table using a timer.  Now the description of the slot update, here is its code: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> ProcessTable::update() { table-&gt;setColumnCount(<span class="hljs-number"><span class="hljs-number">2</span></span>); table-&gt;setRowCount(<span class="hljs-number"><span class="hljs-number">0</span></span>); QStringList <span class="hljs-built_in"><span class="hljs-built_in">list</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">list</span></span> &lt;&lt; "Name" &lt;&lt; "PID"; table-&gt;setHorizontalHeaderLabels(<span class="hljs-built_in"><span class="hljs-built_in">list</span></span>); QDir * dir = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QDir(<span class="hljs-string"><span class="hljs-string">"/proc"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">list</span></span> = dir-&gt;entryList(QStringList(<span class="hljs-string"><span class="hljs-string">"*"</span></span>),QDir::AllDirs); foreach(QString str, <span class="hljs-built_in"><span class="hljs-built_in">list</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(str.toInt()) { ifstream stream; stream.open(<span class="hljs-string"><span class="hljs-string">"/proc/"</span></span> + str.toAscii() + <span class="hljs-string"><span class="hljs-string">"/comm"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> s; getline(stream,s); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> lastRow = table-&gt;rowCount(); QString icon = <span class="hljs-string"><span class="hljs-string">"/usr/share/icons/hicolor/32x32/apps/"</span></span> + QString::fromStdString(s) + <span class="hljs-string"><span class="hljs-string">".png"</span></span>; <span class="hljs-function"><span class="hljs-function">QFile </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">file</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(icon)</span></span></span></span>; table-&gt;insertRow(lastRow); table-&gt;setColumnWidth(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">150</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!file.exists()) { icon = <span class="hljs-string"><span class="hljs-string">":/binary.png"</span></span>; } table-&gt;setItem(lastRow,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QTableWidgetItem(QPixmap(icon),QString::fromStdString(s))); table-&gt;setItem(lastRow,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QTableWidgetItem(str)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } } }</code> </pre><br>  First we set the number of columns and rows with the table, as well as the names of the columns.  After that we get a list of directories in the / proc folder.  To fill the table, we cycle through the entire list, skipping directories that do not belong to processes.  The process name we get from the file / proc / pid / comm.  We take the icon from the / usr / share / icons / hicolor / 32x32 / apps folder, and if the icons are not there, then the binary.png image is used in the binary.  Here is the picture: <br><img src="http://habrastorage.org/getpro/habr/post_images/048/a96/186/048a961866e2acbb70d910fd7ac102ee.jpg" alt="image"><br>  In order to stitch it into the source, I used rcc, you can read about using rcc in the book by Max Schleet - ‚ÄúQt - professional programming in C ++‚Äù, or you can google, I think that there are many manas on the Internet on using rcc. <br>  Now go to the slot slot description, here is its code: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> ProcessTable::kill() { QList&lt;QTableWidgetItem*&gt; <span class="hljs-built_in"><span class="hljs-built_in">list</span></span> = table-&gt;selectedItems(); QTableWidgetItem* item = <span class="hljs-built_in"><span class="hljs-built_in">list</span></span>.value(<span class="hljs-number"><span class="hljs-number">0</span></span>); QString str = item-&gt;text(); QProcess::execute(<span class="hljs-string"><span class="hljs-string">"kill"</span></span>, QStringList() &lt;&lt; str); update(); }</code> </pre><br>  To complete the process, I use a program that is in all Linux (if you don‚Äôt have it in your Linux, I can‚Äôt even imagine what kind of Linux it is), I use the execute method of the QProcess class to run this program, the second argument of this function is the parameter list for the program, I transfer only the PID of the process that needs to be completed, after calling this program, I update the table so that the complete process disappears from it.  Now I turn to the description of the SystemMonitor class, in which I combine these two classes.  The frame of this class is quite simple: <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> SYSTEMMONITOR_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> SYSTEMMONITOR_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;QtGui&gt; #include "info.h" #include "processtable.h" class SystemMonitor : public QWidget { Q_OBJECT public: explicit SystemMonitor(QWidget *parent = 0); }; #endif // SYSTEMMONITOR_H</span></span></span></span></code> </pre><br>  Well, there is only one method in this class, so I will describe it now.  Here is the code of this constructor method (add a skeleton file connection to the top of the implementation file): <br><pre> <code class="cpp hljs">SystemMonitor::SystemMonitor(QWidget *parent) : QWidget(parent) { QTabWidget * tab = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QTabWidget; Info* info = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Info; ProcessTable* pt = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProcessTable; tab-&gt;addTab(info,<span class="hljs-string"><span class="hljs-string">"  "</span></span>); tab-&gt;addTab(pt,<span class="hljs-string"><span class="hljs-string">""</span></span>); QVBoxLayout * layout = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QVBoxLayout; layout-&gt;addWidget(tab); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;setLayout(layout); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;show(); }</code> </pre><br>  In the constructor, we simply create a tab widget, and add our information widget there, and a table widget, since the addTab method accepts the widget as an agrument, then we inherited the Info and ProcessTable classes from QWidget for this.  And now the final touch, the creation of the starting point of the program, that is, the file main.cpp.  Here is his code: <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"systemmonitor.h"</span></span></span><span class="hljs-meta"> int main(int argc,char** argv) { QTextCodec::setCodecForLocale(QTextCodec::codecForName(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"UTF-8"</span></span></span><span class="hljs-meta">)); QTextCodec::setCodecForTr(QTextCodec::codecForName(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"UTF-8"</span></span></span><span class="hljs-meta">)); QTextCodec::setCodecForCStrings(QTextCodec::codecForName(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"UTF-8"</span></span></span><span class="hljs-meta">)); QApplication app(argc,argv); QStyle * style = QStyleFactory::create(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Cleanlooks"</span></span></span><span class="hljs-meta">); app.setStyle(style); SystemMonitor sys; return app.exec(); }</span></span></code> </pre><br>  The first three lines make the Russian letters in the program correctly displayed.  Lines 8 and 9 ensure that in any system our application will look the same. <br>  Well, that's all, the system monitor is ready, Bye everyone! </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/186944/">https://habr.com/ru/post/186944/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../186930/index.html">Part 2. How to connect a smartphone to the car - begin to practice</a></li>
<li><a href="../186932/index.html">Using BLF on Escene Phones</a></li>
<li><a href="../186934/index.html">BitTorrent Sync goes into beta</a></li>
<li><a href="../186940/index.html">AOP in action. AspectJ (CTW) + Spring + LTW</a></li>
<li><a href="../186942/index.html">Monitoring server resources running * nix with RRDtool</a></li>
<li><a href="../186948/index.html">PMP Exam: Preparation, Audit, Recommendations</a></li>
<li><a href="../186950/index.html">Necessity on invention is cunning</a></li>
<li><a href="../186952/index.html">The Voynich Manuscript. Manchurian Candidate</a></li>
<li><a href="../186956/index.html">Tesla Robotic Plant</a></li>
<li><a href="../186960/index.html">FlexCloud - Home P2P cloud of the future</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>