<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Module Basics in Node.js</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Any project is more difficult ‚ÄúHello World‚Äù consists of a certain number of files, which carry the code. This gives you the opportunity to structure t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Module Basics in Node.js</h1><div class="post__text post__text-html js-mediator-article"> Any project is more difficult ‚ÄúHello World‚Äù consists of a certain number of files, which carry the code.  This gives you the opportunity to structure the project, to make independent parts that can be used in other projects and generally make the code clearer. <br><br>  So, in Node.js, each such file is a module that can be connected. <br>  The connection is made by calling the <code>require</code> function to which you need to pass the path to the file. <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> authModule = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./auth'</span></span>);</code> </pre><br>  This code connects the authorization module and makes it available through the <code>authModule</code> variable. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Depending on which parameter is passed to the <code>require</code> function, the module connection algorithm will differ.  So let's look at the principles of connecting modules in Node.js.  I note that all this information is available in the <a href="http://nodejs.org/api/modules.html">documentation</a> . <br><br>  Node.js comes with several built-in modules, to connect which you just need to specify the module name. <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cluster = reqiure(<span class="hljs-string"><span class="hljs-string">'cluster'</span></span>);</code> </pre><br>  It should be noted that built-in modules take precedence over all others, if their name is passed to the <code>require</code> function.  So for example, <code>require('http')</code> will always return a built-in module, even if there is a third-party module with the same name or a file with that name.  A list of all built-in modules and documentation on them can be found on the <a href="http://nodejs.org/api/">site</a> .  The sources of these modules can be viewed in the <a href="https://github.com/joyent/node/tree/master/lib">repository of the project</a> . <br><a name="habracut"></a><br>  If the name of the module is transferred and it is not built-in, then the module is connected from the <code>node_modules</code> folder.  This folder contains all the modules that have been added using <a href="https://www.npmjs.org/">NPM</a> .  NPM is a package manager for Node.js, which makes it easy to find and connect third-party modules.  At the time of this writing, it already contained 89,503 modules. <br><br>  To connect the module which is located in <code>node_modules</code> enough to indicate its name. <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> express = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'async'</span></span>);</code> </pre><br>  Let's consider the situation when such code was called from the <code>'/var/www/demo'</code> folder, then Node.js will try to find the specified modules in the following folders: <br><pre>     / var / www / demo / node_modules
     / var / www / node_modules
     / var / node_modules
     / node_modules
</pre><br>  Node.js recursively, each time moving to the parent folder, will look for the <code>node_modules</code> folder with the necessary module.  NPM also makes it possible to install the module globally ( <code>npm install -g MODULE</code> ), then it will be available from any location. <br><br>  Consider another connection option, if the passed parameter to the <code>require</code> function begins with <code>/</code> , <code>../</code> , or <code>./</code> , then the file for the connection will occur in the absolute path or relative to the current folder. <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> logger = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../lib/logger'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> profiler = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'/var/lib/profiler'</span></span>);</code> </pre><br>  First, a file with the name exactly corresponding to the specified one will be checked or if such a file is not found, then Node.js will try to connect the file by adding different extensions to the name: <code>.js</code> , <code>.json</code> , and also <code>.node</code> . <br><br>  Therefore, there is no need to specify a file with the extension, since <code>require('./lib/users.js')</code> and <code>require('./lib/users')</code> connect the same module. <br><br>  Modules can be so large that it may be necessary to transfer some parts into separate files in order to better organize the module code.  And since these files are used only by this module, it is not necessary that they be among the other modules.  To solve this problem in Node.js it is possible to organize the module in the form of a folder in which all the module files will be located.  To connect such a module, simply pass the path of this folder to the <code>require</code> function. <br><br>  Imagine that we have modules and one of them <code>logger</code> is presented in the form of a folder with files: <br><pre>     A‚îÄauth.js
     U‚îÄuser.js
     Lo‚îÄlogger
         Index‚îÄ index.js
         Console console.js
         Package‚îÄ package.json
         Config‚îÄ config.js
         D‚îÄ db.js
</pre><br>  The connection of the <code>logger</code> module is that we simply pass the path to this folder: <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./logger'</span></span>);</code> </pre><br>  Further Node.js itself will try to determine which of the folder files is the entry point for the module.  To begin with, the <code>package.json</code> file will be checked or exists in the folder in which the name of the file to be connected is indicated in the <code>main</code> field. <br><br><pre> <code class="javascript hljs"> { <span class="hljs-attr"><span class="hljs-attr">main</span></span>: <span class="hljs-string"><span class="hljs-string">"./console.js"</span></span> }</code> </pre><br>  In our case, the file <code>'./logger/console.js'</code> will be loaded.  If there is no <code>package.json</code> file, then Node.js will try to include the <code>'./logger/index.js'</code> or <code>'./logger/index.node'</code> . <br><br>  With the connection of the modules finished, now we will consider several interesting points related to them.  Regardless of how you connect the module, it is cached immediately after the connection.  This means that no matter how many times a module is connected, its code will be executed only once. <br><br>  This behavior can be changed by deleting it from the cache after each module call. <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>.cache[ <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> ];</code> </pre><br>  <code>module</code> is the parameter you passed to the <code>require</code> function to connect the module. <br><br>  So if you need your module to do something every time it is plugged in, you need to either clear the cache or return the function that you want to call to do the work. <br><br>  To get the full path where the module was found, you can use the <code>require.resolve</code> function. <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> modulePath = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>.resolve(<span class="hljs-string"><span class="hljs-string">'express'</span></span>);</code> </pre><br>  This function can be used if it happened to you that modules of different versions are installed in several places and you need to make sure that the correct version is being connected.  You need to go to the folder where the file in which the connection is located, run Node.js in the mode of operation from the command line and call the function with the necessary module.  Of course, this situation means that you need to revise the structure of the project and it is better to put all plug-ins in the root folder of the project. <br><br>  This function can also be used if you want to connect one of the module files that is installed via NPM. <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> package = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>.resolve(<span class="hljs-string"><span class="hljs-string">'express/package.json'</span></span>);</code> </pre><br>  Since you do not know where the <code>node_modules</code> folder with the desired module is located, you can use the fact that Node.js will go through all possible locations of the module. <br><br>  The <code>require</code> function, in addition to all this, has another useful property, <code>main</code> .  It stores the module that was launched from the command line.  So from any module you can find out whether this module was launched directly or it was connected as a dependency of another module. <br><br>  In addition to the <code>require</code> function already discussed, a module object is available in each <code>module</code> .  The main objective of this object is to enable the module to return the result of its execution.  It can be an object, a function, and a string ‚Äî any data type. <br><br>  The <code>module</code> object has a property of <code>exports</code> and it needs to assign everything that you want to return from the module.  It is <code>module.exports</code> will return as a result of the module connection. <br><br><pre> <code class="javascript hljs"> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports.createUser = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> User(); }</code> </pre><br>  After connecting the module with this code, the response will be an object with this method. <br><br>  You can also use a shorter option, the <code>exports</code> variable, which is essentially just a reference to <code>module.exports</code> . <br><br><pre> <code class="javascript hljs"> exports.createUser = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> User(); }</code> </pre><br>  Since this is a link, there is one important difference between the two options.  The result of the module can be returned only through the <code>module.exports</code> object, so if the <code>exports</code> variable is assigned a different value, it will no longer refer to <code>module.exports</code> , which means the module will not return anything. <br><br>  But the <code>module.exports</code> itself can be changed.  Instead of an object, for example, you can return a function, and then the result of the module‚Äôs work will not be an object with a method in the form of a certain function, but a function itself. <br><br>  With the <code>module</code> you can also find out or this module is launched from the command line.  To do this, check the <code>module.parent</code> property - it must be <code>undefined</code> . <br><br>  I think this information will be enough to work with modules in Node.js.  I also recommend getting acquainted with <a href="https://www.npmjs.org/">NPM</a> , since you will have to deal with it in every project on Node.js. </div><p>Source: <a href="https://habr.com/ru/post/233827/">https://habr.com/ru/post/233827/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../233813/index.html">Munich Municipality will get rid of Linux at workstations</a></li>
<li><a href="../233815/index.html">Samsung Galaxy K Zoom: tested in humans</a></li>
<li><a href="../233817/index.html">A billion dollar hobby</a></li>
<li><a href="../233821/index.html">Non-volatile home: a year of successful experiment</a></li>
<li><a href="../233823/index.html">Where does the phone design go?</a></li>
<li><a href="../233829/index.html">We have C ++ 14!</a></li>
<li><a href="../233831/index.html">App Studio - a new version of the online application designer from Microsoft</a></li>
<li><a href="../233833/index.html">Instant photo today or will Polaroid die?</a></li>
<li><a href="../233835/index.html">ExoLance: crowdfunding project to search for life on Mars under the surface of the planet from NASA veterans</a></li>
<li><a href="../233837/index.html">Analyzing network traffic on a server using tshark</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>