<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automating server updates from Debian / Ubuntu</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I will try to summarize the existing ways to automate the update of servers with Debian / Ubuntu on board. 

 And we need it? 
 Of cou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automating server updates from Debian / Ubuntu</h1><div class="post__text post__text-html js-mediator-article">  In this article I will try to summarize the existing ways to automate the update of servers with Debian / Ubuntu on board. <br><a name="habracut"></a><br><h4>  And we need it? </h4><br>  Of course, if you have only one ‚Äúserver‚Äù, which no one uses except you or a neighbor, then it is quite simple to follow the updates.  When it comes to dozens or hundreds of servers, it becomes obvious the problem of keeping them up to date. <br><br>  Updates with patches in Debian / Ubuntu come out almost every day.  Keep track of all this is not very easy.  This is where the programs described below can be useful. <br><br><h4>  apticron </h4><br>  apticron is a simple script that sends emails daily with information about available updates.  All that is needed for his work is to specify our e-mail in the settings file /etc/apticron/apticron.conf: <br><blockquote><code>EMAIL="mail@example.com" <br></code> </blockquote><br>  A letter from apticron is quite informative and looks like this: <br><blockquote> <code>apticron report [Thu, 06 Aug 2009 16:15:24 +0300] <br> ======================================================================== <br> <br> apticron has detected that some packages need upgrading on: <br> <br> example.com <br> [ 127.0.1.1 192.168.0.1 ] <br> <br> The following packages are currently pending an upgrade: <br> <br> acpid 1.0.4-5etch1 <br> apache2-utils 2.2.3-4+etch10 <br> <br> ======================================================================== <br> <br> Package Details: <br> <br> Reading changelogs... <br> --- Changes for acpid --- <br> acpid (1.0.4-5etch1) oldstable-security; urgency=high <br> <br> * Added upstream's patch to fix CVE-2009-0798 <br> <br> -- Michael Meskes &lt;meskes@debian.org&gt; Wed, 29 Apr 2009 12:26:56 +0200 <br> <br> --- Changes for apache2 (apache2-utils) --- <br> apache2 (2.2.3-4+etch10) oldstable-security; urgency=low <br> <br> * Fix regression: A segfault could happen in mod_deflate in conjunction with <br> mod_php when a client aborts the connection. <br> <br> -- Stefan Fritsch &lt;sf@debian.org&gt; Wed, 29 Jul 2009 11:39:06 +0200 <br> <br> ======================================================================== <br> <br> You can perform the upgrade by issuing the command: <br> <br> aptitude dist-upgrade <br> <br> as root on example.com <br> <br> It is recommended that you simulate the upgrade first to confirm that <br> the actions that would be taken are reasonable. The upgrade may be <br> simulated by issuing the command: <br> <br> aptitude -s -y dist-upgrade <br> <br> -- apticron <br></code> </blockquote><br>  From the letter it is clear that you need to update acpid and apache2-utils.  In addition, the letter has a description of the changes.  This is very convenient when you do not receive this information from other sources (for example, from the debian-security-announce mailing list). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  cron-apt </h4><br>  cron-apt is a more advanced utility that, in addition to informing about available updates, can download and install them.  By default, cron-apt only downloads updates, but does not install them.  To receive letters, in the / etc / cron-apt / config file, specify our e-mail and say under what conditions to send letters: <br><blockquote> <code>MAILTO="mail@example.com" <br> MAILON="always" <br></code> </blockquote><br>  Here is an example of a letter from cron-apt: <br><blockquote> <code>CRON-APT RUN [/etc/cron-apt/config]: Wed Jul 29 04:00:01 EEST 2009 <br> CRON-APT SLEEP: 1172, Wed Jul 29 04:19:33 EEST 2009 <br> CRON-APT ACTION: 0-update <br> CRON-APT LINE: /usr/bin/apt-get update -o quiet=2 <br> CRON-APT ACTION: 3-download <br> CRON-APT LINE: /usr/bin/apt-get autoclean -y <br> Reading package lists... <br> Building dependency tree... <br> Reading state information... <br> CRON-APT LINE: /usr/bin/apt-get dist-upgrade -d -y -o APT::Get::Show-Upgraded=true <br> Reading package lists... <br> Building dependency tree... <br> Reading state information... <br> The following packages will be upgraded: <br> dbus dbus-x11 dhcp3-client dhcp3-common libdbus-1-3 <br> 5 upgraded, 0 newly installed, 0 to remove and 0 not upgraded. <br> Need to get 0B/957kB of archives. <br> After this operation, 8192B disk space will be freed. <br> Download complete and in download only mode</code> </blockquote> <br>  It is seen that cron-apt downloaded, but did not install (!) Updates for dbus and dhcp. <br><br><h4>  unattended-upgrades </h4><br>  unattended-upgrade is an additional script developed by Canonical for working with apt.  In contrast to the two previously described utilities, unattended-upgrade can only install updates.  To enable automatic system update, first you need to specify in the settings file /etc/apt/apt.conf.d/50unattended-upgrades what exactly we want to update: <br><blockquote> <code>// allowed (origin, archive) pairs <br> Unattended-Upgrade::Allowed-Origins { <br> "Debian stable Debian-Security"; <br> }; <br> <br> // never update the packages in this list <br> Unattended-Upgrade::Package-Blacklist { <br> // "vim"; <br> }; <br></code> </blockquote><br>  Additionally, in the Unattended-Upgrade :: Package-Blacklist section, you can specify a list of packages that cannot be upgraded.  In this example, there is a commented vim. <br><br>  After that, you need to tell apt that we want to use unattended-upgrade.  To do this, create the file /etc/apt/apt.conf.d/10periodic and add the following lines: <br><blockquote> <code>APT::Periodic::Update-Package-Lists "1"; <br> APT::Periodic::Download-Upgradeable-Packages "1"; <br> APT::Periodic::AutocleanInterval "1"; <br> APT::Periodic::Unattended-Upgrade "1"; <br></code> </blockquote><br>  As a result, we will receive a daily update of the list of packages, download of available updates, removal of deb-files from the cache of already installed packages, and most importantly, automatic installation of packages. <br><br>  Unattended-upgrade has one small drawback - the utility does not tell anyone (except for the log file) what it actually did.  In order to learn about what she has updated, you can use the opportunity of the utility logrotate - sending log files to the mail.  To do this, we write the following lines in the /etc/logrotate.d/unattended-upgrades file: <br><blockquote> <code>/var/log/unattended-upgrades/unattended-upgrades.log { <br> rotate 7 <br> daily <br> mailfirst <br> mail mail@example.com <br> compress <br> missingok <br> notifempty <br> } <br></code> </blockquote><br>  As a result, we will receive to the e-mail a copy of the log file with information about updates: <br><blockquote> <code>2009-08-01 17:50:57,596 INFO Initial blacklisted packages: <br> 2009-08-01 17:50:57,596 INFO Starting unattended upgrades script <br> 2009-08-01 17:50:57,596 INFO Allowed origins are: ["['Debian', 'stable', 'Debian-Security']"] <br> 2009-08-01 17:51:08,294 INFO Packages that are upgraded: libbind9-40 libisc45 libisccfg40 dnsutils libtiff4 liblwres40 bind9-host libisccc40 libdns45 <br> 2009-08-01 17:51:08,294 INFO Writing dpkg log to '/var/log/unattended-upgrades/unattended-upgrades-dpkg_2009-08-01_17:51:08.294492.log' <br> 2009-08-01 17:51:11,169 INFO All upgrades installed <br></code> </blockquote><br>  As can be seen from the log, the details (dpkg output) are recorded in a separate file: unattended-upgrades-dpkg_2009-08-09_17: 51: 08.294492.log. <br><br><h4>  Conclusion </h4><br>  The utilities described above allow you to organize informing the administrator about the availability of updates in the system.  In addition, cron-apt and unattended-upgrades even allow updates to be automatically installed.  However, there is no one choice for everyone, since  Only the administrator has to decide whether to update this or that server automatically. <br><br>  PS For myself, I made a choice in favor of cron-apt. </div><p>Source: <a href="https://habr.com/ru/post/65819/">https://habr.com/ru/post/65819/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../65811/index.html">Happy holiday dear% username%</a></li>
<li><a href="../65812/index.html">Google Wave Address Exchange</a></li>
<li><a href="../65814/index.html">Video review of the game "Ghostbusters: The Video Game"</a></li>
<li><a href="../65815/index.html">FAQ: ‚ÄúWhy do I use Blackberry?‚Äù</a></li>
<li><a href="../65816/index.html">Day of the system administrator has come!</a></li>
<li><a href="../65820/index.html">In Ukraine, a filter appears that allows you to block porn sites</a></li>
<li><a href="../65821/index.html">Scrolling in comments</a></li>
<li><a href="../65822/index.html">Fonts displayed by chromium browser in linux</a></li>
<li><a href="../65824/index.html">Adobe Webinars</a></li>
<li><a href="../65825/index.html">RentACoder and Payoneer Card</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>