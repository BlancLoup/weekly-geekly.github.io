<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Practice of working with time in different time zones in unix-like systems</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If your application depends not only on local time, but also on its representation in other time zones, you must have experienced the difficulty of re...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Practice of working with time in different time zones in unix-like systems</h1><div class="post__text post__text-html js-mediator-article">  If your application depends not only on local time, but also on its representation in other time zones, you must have experienced the difficulty of representing time in different time zones.  Did not come across?  So you have not ported your application to the world of Unix. <br><br>  Indeed, in Windows for working with time zones, the programmer is provided with a convenient set of specialized WinAPI functions.  An example is the <a href="http://msdn.microsoft.com/en-us/library/aa908812.aspx">TIME_ZONE_INFORMATION structure</a> and <a href="http://msdn.microsoft.com/en-us/library/ms724421%2528v%3Dvs.85%2529.aspx">the GetTimeZoneInformation function</a> to it in addition. <br><br>  But what to do if you need to know the offset relative to UTC + 0, the rules for the transition to "summer time", while taking into account leap years with leap seconds and other specific information for any region, but all this in unix-like operating systems?  The article is devoted to the practice of working with all this junk in C / C ++. <br><a name="habracut"></a><br>  This topic was repeatedly covered in many articles from different points of view, but rarely from practical with examples of specific languages, systems and technologies.  Examples can be found on the Stack Overflow (of which there are a lot of questions), and <a href="http://habrahabr.ru/post/100741/">on Habr√©</a> this topic was touched on quite deeply, but from a theoretical point of view.  In addition, there is even a <a href="http://www.chronos-st.org/Discovering%2520the%2520Local%2520Time%2520Zone--Why%2520It%2527s%2520a%2520Hard%2520Problem.html">mini-study</a> on the topic of local time, from which we can learn that the problem of computer time is not at all trivial, which seems at first glance.  Having conducted my own investigation, I would like to briefly and intelligibly share a considerable amount of information I received, filling it in the form of ways to convert time in different time zones. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Classic: C Standard Library </h5><br>  Yes, with the help of that function maser defined in the header <a href="http://cplusplus.com/reference/clibrary/ctime/"><code>time.h</code></a> , you can also perform time conversions.  With certain restrictions. <br><br>  The fact is that all locale-dependent functions (such as <code>gmtime()</code> or <code>localtime()</code> ) use the <code>TZ</code> environment variable to determine the locale parameters.  This means that in order to convert the time to the desired time zone, you must first set this variable (with the name of the required zone), call the conversion function, and then remove the <code>TZ</code> from the environment again.  All anything, if not multitasking and multithreading.  Naturally, this method can cause conflicts and lead to difficult predictable errors. <br><br>  Sample code using this approach: <br><br><pre> <code class="cpp hljs">putenv(<span class="hljs-string"><span class="hljs-string">"TZ=Asia/Calcutta"</span></span>); <span class="hljs-comment"><span class="hljs-comment">///      tzset(); ///    time_t timeToConvert = time(0); ///     struct tm *pCalcuttasTime; ///      pCalcuttasTime = localtime(&amp;timeToConvert); ///  putenv("TZ="); ///   TZ /// ...     ...</span></span></code> </pre><br><br><h5>  <a href="http://www.iana.org/time-zones">tz database</a> , or juggling bytes </h5><br>  Using the <a href="http://en.wikipedia.org/wiki/Tz_database">Olson database</a> for your own purposes is the preferred option.  The advantages are obvious: the base most fully reflects all conceivable transition rules for any corner of the Earth (given the changes in these rules since the beginning of the last century), is distributed with many systems (see <code>/usr/share/zoneinfo</code> ) and has a unified format, while the base updated with the system.  However, having tried to work with her, I decided to refuse from this option. <br><br>  The database is distributed in binary format (for this, the <a href="http://linux.die.net/man/8/zic"><code>zic</code></a> compiler is used).  The format description can be found in the <code>tzfile.h</code> header file (use the official <a href="">FTP</a> database to find it).  I did not find any tools for working with the database (perhaps I looked badly?).  But having tried to read the file of the necessary time zone, I was faced with the problem of data interpretation - in all these subtleties and terminology you can turn your head, forgetting about the purpose of all this digging.  And, in order to abstract from such trifles, it was decided to use the most adequate and convenient tool. <br><br><h5>  Boost.Date_Time </h5><br>  As it often happens in such situations, the <a href="http://www.boost.org/doc/libs/1_49_0/doc/html/date_time.html">boost</a> comes to the rescue.  On the wide possibilities of the Date_Time library set, there has already been <a href="http://habrahabr.ru/post/66318/">an article</a> containing a brief translation of the official documentation.  By the way, the good news is for those who do not want to introduce unnecessary dependencies into their project - the library is header-only (with the exception of a couple of specific places, like creating a timestamp object from a string of a specific format). <br><br>  To resolve the issue, there are two ways: write the rules for the desired time zone with a hardcode in the program (and then hate yourself for it), or store all the rules in a special CSV-format file.  Such a file can be subsequently updated automatically (and keep the transition rules up to date, which is extremely important).  The file is distributed with the boost distribution (called <code>date_time_zonespec.csv</code> ), but can be taken from <a href="http://timezonedb.com/">other places</a> .  Plus the use of the file, among other things - it stores the rules for all regions. <br><br>  No cons, too, will not do.  What if you need to convert that timestamp somewhere near the beginning of the twentieth century, when the transition rules were different?  Such cases also have to be taken into account, and, unfortunately, the boost here can be of little help. <br><br>  For example, here‚Äôs the code that uses the Date_Time library set feature to convert time. <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"boost/date_time/local_time/local_time.hpp"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"boost/date_time/posix_time/posix_time.hpp"</span></span></span><span class="hljs-meta"> using namespace boost::local_time; using namespace boost::posix_time; ptime convertUTC0toCustomTimeZone(const ptime &amp;utcTime, const std::string &amp;tzName) { </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">///     tz_database tzDB; tzDB.load_from_file("./date_time_zonespec.csv"); ///    time_zone_ptr timeZone = tzDB.time_zone_from_region(tzName); /// tzName   "Asia/Calcutta" ///     local_date_time localTime(utcTime, timeZone); /// ...    return localTime.local_time(); }</span></span></span></span></code> </pre><br><br><h5>  Results </h5><br>  I preferred to use the boost option.  Of course, using the tz database will relieve you of the headwash with keeping information about time zones up to date or when converting a timestamp, the transition rules of which have been changed.  But in most applications such frills come to nothing, and the boost allows you to work with dates extremely conveniently. </div><p>Source: <a href="https://habr.com/ru/post/143499/">https://habr.com/ru/post/143499/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../143492/index.html">Electronic library for PocketBook: automatic processing</a></li>
<li><a href="../143494/index.html">Features of the culture of teaching in universities on computer specialties</a></li>
<li><a href="../143496/index.html">Oh this web</a></li>
<li><a href="../143497/index.html">Implementing an Identity Map Template in the Yii Framework</a></li>
<li><a href="../143498/index.html">Zabbix, we monitor MongoDB</a></li>
<li><a href="../143500/index.html">Twitter stood up for its user before the court of the state of New York</a></li>
<li><a href="../143501/index.html">The site of the Kremlin has undergone a DDoS attack</a></li>
<li><a href="../143502/index.html">Export exams from Visual CertExam to Anki</a></li>
<li><a href="../143503/index.html">How to learn to read someone else's code</a></li>
<li><a href="../143508/index.html">Want to find out why major publishers make slop applications? Look in the mirror</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>