<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Knapsack problem and gray code</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Not so long ago on Habr√© was the article " Gray Codes and brute force tasks ." This article is rather mathematical, rather than programmer, and for me...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Knapsack problem and gray code</h1><div class="post__text post__text-html js-mediator-article">  Not so long ago on Habr√© was the article " <a href="http://habrahabr.ru/post/200806/">Gray Codes and brute force tasks</a> ."  This article is rather mathematical, rather than programmer, and for me, as a simple programmer, it was unbearably hard to read.  But the topic itself is familiar to me, so I decided to describe it with my own view, as well as tell about how I used it in solving the knapsack problem. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/63b/94b/e73/63b94be7358f8ce9bab16ad7f151ba26.png" alt="image"><br>  <i>KDPV: a knapsack problem on a live example</i> <br><br><h4>  Prehistory </h4><br>  It all started 10 years ago when I was in the ninth grade.  I accidentally overheard the conversation of a computer science teacher telling a problem to some of the seniors: a set of numbers was given, and another number ‚Äî the control number.  It is necessary to find the maximum sum of numbers from the set that would not exceed the control number. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The task for some reason sunk into my soul.  After returning home, I quickly rolled the solution: a naive enumeration of all possible sums with the choice of the best.  I received the combinations by sorting through all the N-bit binary numbers and taking the sums of those initial numbers to which the units correspond.  But I was disappointed to find that with the number of elements starting somewhere around 30, the program works for a very long time.  It is not surprising, since the running time of such an algorithm is n * 2 <sup>n</sup> (the number of combinations multiplied by the sum length). <br><a name="habracut"></a><br>  5 years later.  I managed to finish school and go to university, but this task was still with me.  Once, leafing through the book ‚ÄúAlgorithmic Tricks for Programmers‚Äù (Hacker's Delight / Henry S. Warren Jr.), I came across the description of the Gray code: it is a sequence of binary numbers, each of which differs from the previous one only in one bit.  ‚ÄúStop!‚Äù - I thought - ‚ÄúIt means ... Yes!  This means that in the same task at each step of the search, you can not count the sum as a whole, but only add or subtract one number. ‚Äù  And I immediately delved into the study of the topic. <br><br><h4>  Building Gray Code </h4><br>  Gray code can be constructed for the number of any digit.  For one rank, it is obvious: <br><br>  0 <br>  one <br><br>  To add a second bit, you can add the same back to this sequence. <br><br>  0 <br>  one <br>  one <br>  0 <br><br>  and add units to the second half: <br><br>  00 <br>  01 <br>  eleven <br>  ten <br><br>  Similarly for three discharges: <br><br>  000 <br>  001 <br>  011 <br>  010 <br>  110 <br>  111 <br>  101 <br>  100 <br><br>  Such a code obtained by reflection of a code of lower bitness is called a reflex (reflected) gray code.  There are other sequences, but in practice this one is usually used. <br><br>  This code is named after <a href="https://en.wikipedia.org/wiki/Frank_Gray_(researcher)">Frank Gray</a> , who invented the tube ADC, which generated the digital signal in this particular code.  With small changes in the input signal level, the digital output could change only in one bit, and this excluded sharp jumps due to non-simultaneous switching of bits. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0f0/01b/543/0f001b5438ae1033222f7886e3e44a78.png" alt="Frank Gray's Patent"><br>  <i>Illustration of Frank Gray's patent</i> <br><br>  The most obvious application of the Gray code is in the rotation angle sensors.  A sensor similar to those in old mechanical mice, but determining not the relative offset, but the absolute value of the angle.  For this, each sensor requires several optocouplers and several slotted grids.  Moreover, each next position of the sensor should differ from the previous one only by the state of one bit, otherwise asynchronous switching of bits is possible at the boundaries, and consequently there are sharp jumps in the instrument readings.  Here you can see a curious feature of the Gray code: the last number also differs from the first one in one bit, so it can be looped. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/591/21a/7d8/59121a7d82023e9b74025ec38bec2ad5.png" alt="image"><br>  <i>Sensor absolute angle of rotation.</i>  <i>Optical slits are located in accordance with the gray code.</i> <br><br><h4>  Application in the knapsack problem </h4><br>  But back to the knapsack problem.  The standard formula gives us Gray code by number: <br><br><pre><code class="cpp hljs">G = i ^ (i &gt;&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br>  According to it, we can only calculate the sum of all the necessary elements.  And we were going to add or subtract one value at each iteration, right?  So, we need to get the numbers of mutable bits.  For multi-digit numbers, these numbers will be: <br><br>  0 <br>  one <br>  0 <br>  2 <br>  0 <br>  one <br>  0 <br>  3 <br>  0 <br>  one <br>  0 <br>  2 <br>  0 <br>  one <br>  0 <br>  four <br>  ... <br><br>  Nothing like?  This is the bit number that we set to one when we simply list the usual binary numbers.  Or else - the number of the lowest unit in binary.  This operation is called <a href="https://en.wikipedia.org/wiki/Find_first_set">find first set</a> and in most processors exists as a separate instruction.  Visual C ++ provides this instruction as a _BitScanForward function. <br><br>  So, now we are ready to write a program that solves the knapsack problem through Gray code.  We formulate the problem as follows: <br><br><blockquote>  In the file input.txt, the capacity of the backpack is indicated in the first line, and the dimensions of things in the other lines.  In the console you need to display the maximum load of the backpack and the size of the selected items.  Checking the correctness of the input, etc. - see. </blockquote><br>  We will keep the bit mask of used items, and add or remove one of them as needed.  To do int-s, we limit the number of things (and used bits) to thirty-one. <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;iostream&gt; #include &lt;fstream&gt; #include &lt;bitset&gt; #include &lt;intrin.h&gt; using namespace std; void main() { int target; //   int nItems = 0; //   int weight[31]; //   ifstream inFile("input.txt"); inFile &gt;&gt; target; while(inFile &gt;&gt; weight[nItems]) nItems++; inFile.close(); const unsigned int nIterations = 1 &lt;&lt; nItems; //  , 2^n int sum = 0; //    int bestSum = 0; //   (  ) bitset&lt;31&gt; mask; //     bitset&lt;31&gt; bestMask; //     for (unsigned int i = 1; i &lt; nIterations; i++) { unsigned long position; //      _BitScanForward(&amp;position, i); mask[position] = !mask[position]; if (mask[position]) //        sum += weight[position]; else sum -= weight[position]; if (sum &gt; target) //  continue; if (sum &gt; bestSum) //  !  ... { bestSum = sum; bestMask = mask; } } cout &lt;&lt; "Best approximation: " &lt;&lt; bestSum &lt;&lt; endl; cout &lt;&lt; "Used weights:" &lt;&lt; endl; for (int i = 0; i &lt; 31; i++) if (bestMask[i]) cout &lt;&lt; weight[i] &lt;&lt; endl; cin.get(); }</span></span></span></span></code> </pre><br>  I apologize for possible roughness;  Unfortunately, C ++ has not been my profile language for a long time. <br><br>  It works really faster than the assembly from scratch of all amounts, the difference is noticeable already at 20 numbers, and at 30 I did not wait for the naive algorithm to execute, while the new version is executed in 7 seconds.  However, given the exponential complexity, this is not at all small: for 50 numbers, using this algorithm no longer makes sense.  Unfortunately, any exact algorithm will not work faster than 2 <sup>n</sup> ;  Faster possible is only an approximate solution.  <i>(Update: in some cases, dynamic programming and meet-in-the-middle solve the problem faster; see the comments for more details.)</i> <br><br>  Perhaps that is why I am doomed to carry my pack to the end of my life, trying to speed up this program.  I already once rewrote the cycle in assembler, having received a small increase in speed, and now I'm even thinking of making a multi-threaded version of the program.  You can only sympathize with me.  :) </div><p>Source: <a href="https://habr.com/ru/post/203362/">https://habr.com/ru/post/203362/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../203352/index.html">Telephone business NOKIA sold MSFT</a></li>
<li><a href="../203354/index.html">LG will stop watching SmartTV users</a></li>
<li><a href="../203356/index.html">Extend cartridge life</a></li>
<li><a href="../203358/index.html">Once again about Security in Symfony2 the user-resource-privilege approach</a></li>
<li><a href="../203360/index.html">CMS Textpattern development and who needs it</a></li>
<li><a href="../203364/index.html">Windows Deployment Services and DHCP server on Linux + a couple of features</a></li>
<li><a href="../203366/index.html">9th Habravstrecha in Kiev</a></li>
<li><a href="../203368/index.html">Android In-app purchasing: paid ad disconnection in your application</a></li>
<li><a href="../203372/index.html">Say thanks to WINAMP ‚Ä¢ thxwinamp.com</a></li>
<li><a href="../203374/index.html">Someone made a $ 160 million bitcoin transaction</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>