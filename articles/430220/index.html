<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to turn a "hundred" usb hub into a "smart" managed and save at the same time $ 300</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Somehow I needed a hub long ago, preferably with a large number of ports and with a fairly convenient form suitable for embedding instead of a floppy ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to turn a "hundred" usb hub into a "smart" managed and save at the same time $ 300</h1><div class="post__text post__text-html js-mediator-article"><p>  Somehow I needed a hub long ago, preferably with a large number of ports and with a fairly convenient form suitable for embedding instead of a floppy disk drive into the 3.5 ‚Äùbay.  A quick look at the flea market threw the model D-link DUB-H7, and even in the combination ‚Äú2 for the price of 1‚Äù.  External inspection did not give anything special, the hub as a hub, made soundly, a major "printer" USB AM-BM on the back and 3 A power supply.  As always, first of all I took it apart, rejoiced at a small number of empty spaces instead of elements, along with high-quality soldering, and calmed down.  True, just in case, I went to the Internet to see what the hub was and if there were any interesting projects with its participation.  There were no projects, user reviews 50/50, in general, no dynamics.  For 5-7 years, the hub worked reasonably well and performed its task, then moved smoothly to the electronic junk box and quite possibly would have disappeared as a result along with unknown adapters, adapters, etc. But in my life, an event occurred that made me dig in bags with old junk, find this, as it turned out, a unique D-link, and shaking off the dust to remove it into the light of God.  If it's interesting to listen to why - welcome under cut. </p><br><img src="https://habrastorage.org/getpro/habr/post_images/3a7/fdf/977/3a7fdf977a4d085c2fcb08c4491a000f.gif" alt="twink twink instant"><a name="habracut"></a><br><h4>  Intro or Crying about greedy usb hub manufacturers </h4><br><p>  With the advent of small convenient SoC routers (like the lovingly described <a href="https://habr.com/post/425281/">clone of the popular Chinese mini-router Hame A15, aka ‚Äúunbranded A5-V11‚Äù</a> ) and the widespread adoption of openwrt for managing a host of devices (in absolute majority cases, these are devices connected via USB) the task of managing the power supply of various modems, card readers, usb-rs232 converters, etc., etc. becomes a very urgent task. The most common is the need to control the port when working with GSM  emami (to restart, for example).  In principle, the people have already developed a sufficient number of <a href="https://electronics.stackexchange.com/questions/393468/efficient-way-to-selectively-unpower-usb-ports">solutions</a> .  For these purposes, ranging from the use of free GPIO pins in the router, and ending with ready-made relays.  There are solutions from third-party manufacturers.  This is for example a programmable USB hub for 4 ports from <a href="https://acroname.com/store/acroname-programmable-usb-hub">Acroname</a> , which is also rich in software and software, but costs about $ 300. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5cb/cdd/540/5cbcdd5404d816d47e2a6917b9639f98.jpg" alt="image"></div><br><p>  There is a cheaper option, a smart switchable hub with the pleasant name <a href="https://www.yepkit.com/products/ykush">Yupkit YKUSH</a> for only ‚Ç¨ 35: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f0d/7f4/44d/f0d7f444dbf40fd96967cd8a4900d783.png" alt="image"></div><br><p>  The most economical ones can use a bundle from the cheapest usb hub, a normally closed 5V relay, and any of the Arduino-k to disconnect power from the usb port if necessary.  The cost of such a decision &lt;$ 10, excluding the time spent on soldering and programming Arduino. </p><br><p>  It would seem a dead end.  Either expensive and beautiful, or just plain and <s>snotty</s> .  But it turned out there is a third option.  Moreover, the solution is as old as the <a href="https://web.archive.org/web/20120207112406/">USB 2.0 specification</a> for hubs in which it is described. </p><br><div class="spoiler">  <b class="spoiler_title">Excerpts from the specification regarding USB power management</b> <div class="spoiler_text"><p>  It is not necessary.  Bus-powered hubs are required to have power switches.  If you are a group of gangs, you can connect to one or more ports.  A hub indicates the field of power in the wHubCharacteristics.  If a hub is supported, it is a request for the port.  Port power  If a hub is supported, it receives a SetPortFeature (PORT_POWER) request.  It is not a state of mind. <br>  ... <br>  Although it is not necessary to implement power switching, it‚Äôs necessary to support the state of all ports.  Additionally, it is necessary to implement the USB System Software (PbwrCtrlMask (all bits set to 1B)). </p></div></div><br><p>  Translating into Russian, it turns out that the USB standard has already spelled out the ability to control the power of the ports, using the so-called.  <b>Per-Port Power Switching (PPPS)</b> , but to meet a device that would support this feature is not just hard, but very hard.  To implement PPPS functionality, additional components (field-effect transistors and piping) are needed, which are not installed in hubs in order to save. </p><br><p>  Sensitively responding to market demands, some manufacturers indicate PPPS in the hub specifications, but in reality the case on the box does not go further.  And in principle, it is difficult to find fault, because many chips inside the hubs support this function, but it is impossible to implement it without additional switches (transistors) (most often USB ports are directly connected to the + 5V line). </p><br><p> I even specially disassembled several small USB hubs that I planned to use together with the A5-V11 router.  Inside it turned out: the <a href="https://www.kean.com.au/oshw/WR703N/GL850G%2520USB%2520Hub%25201.07.pdf">GL850G</a> chip and the <a href="https://www.kean.com.au/oshw/WR703N/GL850G%2520USB%2520Hub%25201.07.pdf">hotly</a> beloved by the Chinese <a href="https://cdn-shop.adafruit.com/product-files/2991/FE1.1s%2BData%2BSheet%2B(Rev.%2B1.0).pdf">FE1.1s</a> .  Naturally, only the controllers themselves were found inside with a minimum of details.  In view of the miniature size of the board, it is difficult to place even a hinged wiring of the transistor and the parts that have joined it.  I had to calm it down.  Although, depending on the chip, if there is a mention of <i>over-current detection or an individual or ganged power control in the datasheet</i> , it is possible to carry out an operation on the smart of such a device according to the method described in the <a href="https://befinitiv.wordpress.com/2014/02/02/hacking-per-port-power-switching-to-an-usb-hub-2/">article</a> .  A friend used a combination of a transistor and a bunch of resistors to enable PPPS in his hub. </p><br><div class="spoiler">  <b class="spoiler_title">Alteration scheme and appearance of the device</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/0b1/202/831/0b1202831fd6a456a90f8ab01c9ed48e.jpg" alt="image"><br><img src="https://habrastorage.org/getpro/habr/post_images/a5d/e65/b11/a5de65b1118b764b9fda1d32a1fb47f9.jpg" alt="image"></div></div><br><p>  Also reading the documentation, you catch yourself in that there is no-no and yes there is a mention that the port control mode can be implemented by adding some AIC1526-0 or MIC2026 (Dual-channel power distribution switch) to the circuit. </p><br><div class="spoiler">  <b class="spoiler_title">Schemes of datasheets will not lie</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/vn/vy/ar/vnvyarpe24tec4a6skp0irp8grk.jpeg"><br><img src="https://habrastorage.org/webt/wc/s5/yd/wcs5ydopgtt5n8xwwovr1vbdld8.jpeg"></div></div><br><h4>  Part of the main or go to the point </h4><br><p>  Overwhelmed with gloomy thoughts about buying Chinese hubs with unknown functionality ("the cat in the bag") and the impossibility of checking them beforehand, I inadvertently came across an <a href="http://www.ibuyopenwrt.com/index.php/15-yun-compatible/hardware-yun/36-usb-hub-per-port-power-switching-2">article</a> about setting up openwrt for power management of a USB hub, moreover, the example, abandoned, and the forgotten <b>D-Link DUB-H7</b> in a gray package. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/b9/3o/hv/b93ohvaf-wfvgk0hy2qltlxldlk.jpeg"></div><br><p>  After examining the <a href="http://pdf.datasheetcatalog.com/datasheet/philips/ISP1521-03.pdf">hardware,</a> it became clear that on board the hub, in addition to the fairly advanced Philips ISP1521BE controller, there is also a whole bunch of those <i>dual-channel power distribution switches</i> AIC1528-0 for a full power switch.  Although judging by the datasheet, the chip with a minimal body kit itself can control the power of downstream ports (and there are still a lot of things that, as it turned out, are not implemented, for example, indication of upstream port activity using GoodLink technology, or a USB 1.1 host to correctly support mix 2.0 and 1.1 on downstream ports, etc., etc.). </p><br><p>  By the way, for those who decide to repeat the path I have gone through, I will immediately say that the modern versions of the D-Link DUB-H7 (in a glossy black case) are not as useful as the old men of gray. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/o8/ll/uc/o8llucurzvykxpwzgd9d9shxh88.jpeg"></div><br><p>  According to information from wikidevi.com ( <a href="https://wikidevi.com/wiki/D-Link_DUB-H7_rev_A2">1</a> , <a href="https://wikidevi.com/wiki/D-Link_DUB-H7_rev_A5">2</a> , <a href="https://wikidevi.com/wiki/D-Link_DUB-H7_rev_B1">3</a> , <a href="https://wikidevi.com/wiki/D-Link_DUB-H7_rev_C1">4</a> ) there are several revisions of this hub, with a different set of components on board, and accordingly with different functionalities (A1 / A5 - ISP1521BE 7-port, B1-2xGL854G 4-port, C1 - 2xGL850Z 4-port). </p><br><p>  Attention to the D-Link DUB-H7 is also drawn because, in addition to its good functionality, it is also the most affordable option (both in price and in prevalence) in our area.  From the models that could be mentioned along with "Per-Port Power Switching", you can additionally mention, for example, the following: </p><br><ul><li>  Linksys USB2HUB4 USB 2.0 hub. </li><li>  D-Link DFB-H7 Combo Hub </li><li>  Elecom U2H-G4S </li><li>  Sanwa Supply USB-HUB14GPH </li><li>  Targus Inc.  PAUH212 </li><li>  Hawking Technology UH214 </li></ul><br><p>  I didn‚Äôt look for the devices mentioned, because I was once lucky with revision A5.  But now, if I had to buy such a hub, I would try to find revision <a href="http://pccar.ru/showpost.php%3Fp%3D364360%26postcount%3D314">B1</a> , because besides the port power management, the chip on which it is built (GL854G) has such a thing as a <b>Multi Transaction Translator</b> inside. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bn/cc/bu/bnccbuuo1tpqxp7bq7eob8lloq0.jpeg"></div><br><h4>  The importance of having a Multi Transaction Translator (MTT) in a USB hub </h4><br><p>  A small digression to tell <a href="http://www.cypress.com/file/124006/download">what</a> this Multi Transaction Translator (MTT) is and why it is so important and necessary.  The operation transmitter (transaction transactionator, TT) is an important component of any high-speed hub that provides communication between the upstream and downstream ports of the hub, especially in the case when these ports operate at different data rates.  In fact, TT separates low- and medium-speed devices from high-speed devices (especially USB 2.0, for example) and is responsible for operating at USB 1.1 speeds. </p><br><p>  Transmitter operation can be of two types - single (English Single Transaction Translator, STT) or multiple (English Multiple Transaction Translator, MTT).  In the case of STT, one transmitter is used for all ports, and in the case of MTT, each port has its own transmitter.  It is clear that the first option is cheaper and simpler, where the main drawback of this option comes from - in the case of connecting several USB 1.1 ports to the hub, they will all work through a single ‚Äúbottleneck‚Äù.  I think you can imagine what will happen with the speed of exchange. </p><br><img src="https://habrastorage.org/webt/g7/ei/ba/g7eibabozthfur42lw3je15r_tk.jpeg"><br><p>  In simple terms, STT hubs have a limit on the number of devices that can be used simultaneously.  Otherwise, it is fraught with packet loss due to conflicts in scheduling data transmissions, overloading the hub (especially when using actively communicating devices, such as sound cards), etc.  Therefore, it is better when choosing a hub to immediately focus on devices with MTT, and not to look after the cause of instability in the work.  If there is already a hub, and unfortunately it turned out to be from the STT, all that remains is to carefully check the standards of the devices connected to the hub and, if possible, reduce the number of connected USB 1.1 to one. </p><br><p>  Unfortunately, the vast majority of low-cost hubs built on low-end chips (fe1.1s, GL850G, and my A5 hub‚Äôs ISP1521BE) have STTs on board that are more expensive and advanced (GL852G, GL854G (B1 revision discussed by D-link DUB-H7), GL3520, VL812, VL813, SMSC USB2514) are running MTT. </p><br><p>  You can check the type of transmitter operation either by reading the datasheet on the chip (but often the Chinese cannot or do not want to tell the chip's brand), or by connecting the hub to a computer with * nix and running the lsusb -v command and finding the piece of service information related to the hub being investigated name).  The line <b>DeviceProtocol</b> will indicate either <i>Single TT</i> or <i>Multi TT</i> .  It is clear that it is better to buy only with Multi :) </p><br><div class="spoiler">  <b class="spoiler_title">Description of the characteristics of the hub issued by the command lsusb</b> <div class="spoiler_text"><p>  Bus 001 Device 005: ID 2001: f103 D-Link Corp.  DUB-H7 7-port USB 2.0 hub <br>  Some information will be missing <br>  Device Descriptor: <br>  bLength 18 <br>  bDescriptorType 1 <br>  bcdUSB 2.00 <br>  bDeviceClass 9 Hub <br>  bDeviceSubClass 0 Unused <br>  bDeviceProtocol 1 Single TT <br>  bMaxPacketSize0 64 <br>  idVendor 0x2001 D-Link Corp. <br>  idProduct 0xf103 DUB-H7 7-port USB 2.0 hub <br>  bcdDevice 1.00 <br>  iManufacturer 0 <br>  iProduct 0 <br>  iSerial 0 <br>  bNumConfigurations 1 <br>  Configuration Descriptor: <br>  bLength 9 <br>  bDescriptorType 2 <br>  wTotalLength 25 <br>  bNumInterfaces 1 <br>  bConfigurationValue 1 <br>  iConfiguration 0 <br>  bmAttributes 0xe0 <br>  Self powered <br>  Remote wakeup <br>  MaxPower 0mA <br>  Interface Descriptor: <br>  bLength 9 <br>  bDescriptorType 4 <br>  bInterfaceNumber 0 <br>  bAlternateSetting 0 <br>  bNumEndpoints 1 <br>  bInterfaceClass 9 Hub <br>  bInterfaceSubClass 0 Unused <br>  bInterfaceProtocol 0 Full speed (or root) hub <br>  iInterface 0 <br>  Endpoint Descriptor: <br>  bLength 7 <br>  bDescriptorType 5 <br>  bEndpointAddress 0x81 EP 1 IN <br>  bmAttributes 3 <br>  Transfer Type Interrupt <br>  Synch Type None <br>  Usage type data <br>  wMaxPacketSize 0x0001 1x 1 bytes <br>  bInterval 12 </p></div></div><br><p>  When you run the <i>lsusb -v -t</i> command, you can see a nice hierarchical structure of connected usb-devices. </p><br><img src="https://habrastorage.org/webt/qq/yv/7h/qqyv7hfnj27vnwtux7eebnwadia.jpeg"><br><p>  Instead of lsusb, you can use the <i>hwinfo</i> utility with the <i>--usb key</i> (it is advisable to install it first via <i>sudo apt-get install hwinfo</i> ).  Then the output of information about usb devices will look a little different: </p><br><div class="spoiler">  <b class="spoiler_title">Information issued by hwinfo</b> <div class="spoiler_text"><p>  lab @ lab-G: ~ $ hwinfo --usb <br>  23: USB 00.0: 10a00 Hub <br>  [Created at usb.122] <br>  Unique ID: zFuK.sOcBcpBDhs4 <br>  Parent ID: k4bc.9T1GDCLyFd9 <br>  SysFS ID: /devices/pci0000:00/0000:00:1d.7/usb1/1-8/1-8:1.0 <br>  SysFS BusID: 1-8: 1.0 <br>  Hardware Class: hub <br>  Model: "D-Link DUB-H7 7-port USB 2.0 hub" <br>  Hotplug: USB <br>  Vendor: usb 0x2001 "D-Link" <br>  Device: usb 0xf103 "DUB-H7 7-port USB 2.0 hub" <br>  Revision: "1.00" <br>  Driver: "hub" <br>  Driver Modules: "usbcore" <br>  Speed: 480 Mbps <br>  Module Alias: "usb: v2001pF103d0100dc09dsc00dp01ic09isc00ip00in00" <br>  Config Status: cfg = new, avail = yes, need = no, active = unknown <br>  Attached to: # 21 (Hub) </p></div></div><br><p>  In general, briefly with the peculiarities of the low-speed devices work out and now it's time to go to the software part. </p><br><h4>  We manage the power of USB ports </h4><br><p>  I‚Äôll say right away that I couldn‚Äôt find a way to implement PPPS functionality in a Windows environment (at least out of idle interest).  Maximum - enable / disable the device using the <i><a href="https://superuser.com/a/502055/171440">devcon</a></i> utility.  I would be glad if someone from the readers corrected and supplemented.  In the meantime, all procedures are carried out on the example of Ubuntu (in the case of openwrt, the algorithm is similar, although in the last trunk it should already be included in the "distribution"). </p><br><p>  So, the <i>Per-Port Power Switching (PPPS)</i> or " <i>Port Power Switching</i> " feature is implemented on hubs <u>with hardware support for</u> this function using the <b><a href="https://www.gniibe.org/development/ac-power-control-by-USB-hub/">hub-ctrl</a></b> program or its descendant <b><a href="https://github.com/mvp/uhubctl">uhubctrl</a></b> .  I will consider them in turn. </p><br><h4>  HUB-CTRL </h4><br><p>  The program was written by a Japanese <s>fighter for independence</s> engineer <b>Niibe Yutaka back</b> in 2006.  But it works without problems now.  For installation we need any * nix and <i>libusb-dev</i> library.  For example, Ubuntu 16.04 LTS algorithm is as follows: </p><br><blockquote><pre>  Install ext.  packages: sudo apt-get update &amp;&amp; sudo apt-get install libusb-dev git gcc
 Download source: git clone https://github.com/codazoda/hub-ctrl.c
 Compile with gcc: cd hub-ctrl.c &amp;&amp; gcc -o hub-ctrl hub-ctrl.c -lusb </pre></blockquote><p>  If the address is unavailable, you can manually download the sources <a href="">from here</a> or <a href="">from here</a> and compile with the command described above. </p><br><p>  The program has a fairly simple command-line syntax that goes into the following description: </p><br><p>  ./ <b>hub-ctrl</b> [{-h HUBNUM |  -b BUSNUM -d DEVNUM}] \ [-P PORT] [{-p [VALUE] |  -l [VALUE]}] <br>  where HUBNUM is the hub number, BUSNUM bus number, DEVNUM device number, PORT port number </p><br><p>  To find out these parameters, just run the <i>lsusb</i> command: </p><br><img src="https://habrastorage.org/webt/pp/ob/tz/ppobtz0tg81cjzgnvla8ej1vw5s.jpeg"><br><p>  By the way, the hub-ctrl program can act as a kind of ‚Äúprobe‚Äù of a usb hub for the fact that it has the ability to manage port power.  It is enough to run it with the -v key.  We get a list of supported hubs in the system (the INFO line) and the status of the ports (in my case, all the ports are turned off) </p><br><blockquote>  lab @ lab-G: ~ / hub $ sudo ./hub-ctrl -v <br>  Hub # 0 at 001: 006 <br>  INFO: individual power switching. <br>  WARN: Port indicators are NOT supported. <br>  Hub Port Status: <br>  Port 1: 0000.0000 <br>  Port 2: 0000.0000 <br>  Port 3: 0000.0000 <br>  Port 4: 0000.0000 <br>  Port 5: 0000.0000 <br>  Port 6: 0000.0000 <br>  Port 7: 0000.0000 </blockquote><p>  This is what the configuration will look like when all ports are turned on: </p><br><blockquote>  lab @ lab-G: ~ / hub $ sudo ./hub-ctrl -v <br>  Hub # 0 at 001: 006 <br>  INFO: individual power switching. <br>  WARN: Port indicators are NOT supported. <br>  Hub Port Status: <br>  Port 1: 0000.0100 power <br>  Port 2: 0000.0100 power <br>  Port 3: 0000.0100 power <br>  Port 4: 0000.0100 power <br>  Port 5: 0000.0100 power <br>  Port 6: 0000.0100 power <br>  Port 7: 0000.0100 power </blockquote><p>  To enable any of the ports you need to run the command <i>sudo ./hub-ctrl -h 0 -P 1 -p 1</i> , where -h indicates which hub is used (0th in my case), -P tells which port (1- th port in my case), and -p indicates the status (0-off, 1-on). </p><br><img src="https://habrastorage.org/webt/ko/4r/wl/ko4rwlpq2_uxinhoukzh-xltvfc.jpeg"><br><p>  To get the configuration as in the picture above, it was necessary to execute the following commands sequentially (for the ports that were initially disabled): </p><br><p>  sudo ./hub-ctrl -h 0 -P 2 -p 1 <br>  sudo ./hub-ctrl -h 0 -P 4 -p 1 <br>  sudo ./hub-ctrl -h 0 -P 6 -p 1 </p><br><p>  Accordingly, it is not difficult to write a script that will cause the LEDs to flash for fun in the desired sequence.  Examples of such things already exist and successfully function: <br>  <a href="https://gist.github.com/dardo82/52799ae762e8673c8726">Morse code</a> on a usb hub, <a href="https://www.joeldare.com/wiki/usb_powered_animated_christmas_lights">Christmas tree lights</a> , etc.  etc.  From the possibilities of hub-ctrl, I didn‚Äôt have enough of the function of cyclic inclusion for the realization of my momentary lighting fantasies (so as not to waste time writing the script, etc.).  This annoying flaw is eliminated in the successor - uhubctl. </p><br><h4>  Uhubctl </h4><br><p>  The uhubctl program is an optimized analogue of the hub-ctrl and has some cosmetic differences (and of course it supports more devices). </p><br><div class="spoiler">  <b class="spoiler_title">Work with uhubctl:</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/pn/qg/dw/pnqgdwes-bvg0n35yepl4pjjsp0.jpeg"></div></div><br><p>  Theoretically, the utility can be compiled to run in the windows environment, but ... But for now it interacts with devices via the winusb.sys driver, which cannot directly access the hub.  Also, the program claims USB 3.0 support (USB 3.0 hubs supporting Per-Port Power Switching, by the way, is much more than USB 2.0 hubs with similar functionality).  When working with a USB 3.0 hub connected to a USB 3.0 upstream port, the program defines it as two independent virtual hubs: USB 2.0 and USB 3.0, and the USB devices themselves will be connected to one of them depending on their capabilities and connection speed .  Accordingly, to control such devices, the program turns on / off power on virtual hubs by default (you can switch the utility to manual mode by adding the ‚Äìe switch to the start command). </p><br><p>  <u>Important: the</u> addressing system for USB ports can cause some confusion (it is similar for hub-ctrl and uhubctl).  During operation, it uses the same addressing method similar to that in the Linux kernel: bx.yz, where b is the USB bus number and x, y, z are the port numbers of the node chain, starting with the root USB hub for this bus.  If there is more than one managed USB hub, you can determine the correct parameters by running uhubctl with the -l (location) parameter.  I note that this addressing is semi-stable ‚Äî it will not change if you unplug and plug the USB devices back to the same physical port. </p><br><p>  The algorithm for compiling a program is similar to the algorithm for hub-ctrl.  Except for the exception that you additionally need to install the library libusb-1.0 (version 1.0.12 or later) by the usual command <i>sudo apt-get install libusb-1.0-0-dev</i> , and then compile the binarik with the command <i>make</i> . </p><br><p>  The syntax for running the program next </p><br><p>  uhubctl -a off -p 2 </p><br><p>  This command shuts off power (-a off, or -a 0) on port 2 (-p 2).  Supported off / on / cycle (or 0/1/2) commands.  The <i>cycle</i> key turns off the power, waits for a while (determined by the -d key) and turns it back on.  Those.  Now the hub can easily replace the microcontroller. </p><br><h4>  What follows from all this, or Conclusions </h4><br><p>  And it follows from this that there is a ‚Äúsecret‚Äù in the old hub from D-Link.  The use of the described technology (PPPS) is quite reasonable when it is necessary to remotely control an array of devices connected to the USB bus.  Moreover, this method is already used to disable <a href="http://joeyh.name/blog/entry/usb_drives_with_no_phantom_load/">hard drives</a> , <a href="https://gist.github.com/dardo82/66ab5f1947de0186dfbf">webcams</a> and <a href="https://www.sysmocom.de/products/sysmoqmod/index.html">GSM modems</a> (such as in the picture): </p><br><img src="https://habrastorage.org/getpro/habr/post_images/d29/99a/e9b/d2999ae9b1938357484853650973e9b0.png" alt="image"><br><p>  Although, as for the modems and the D-link DUB-H7 mentioned by me, there are <a href="http://atc-ip.ru/info/29/1.html">people</a> who question the performance of such a bundle (when working with the hub-ctrl program). </p><br><div class="spoiler">  <b class="spoiler_title">The reason is that ...</b> <div class="spoiler_text"><p>  "... experiments using Dlink DUB H-7 showed that hub-ctrl -p 0 only lowers the voltage to 1.47 V. At the same time, after inserting the modem into such an" off port "the LED does not blink, but the / dev / ttyUSBx files for this modems appear in the system. They can even be opened. However, writing commands and reading responses from this port does not end in success. " </p></div></div><br><p>  The utilities described in the article (lsusb, hwinfo, hub-ctrl) can be a great help when choosing the next USB hub, especially if there is no access to viewing the internal device.  At the Habr√©, user ideas and expectations from ideal usb hubs were already described ( <a href="https://habr.com/post/233781/">here</a> and <a href="https://habr.com/post/212947/">here</a> ).  In my opinion, the described algorithms for checking existing hubs will perfectly complement and dilute the approaches described by the authors.  Well and so, after, the hero of my article (D-link DUB-H7 ver. A5) in my opinion looks very good from the point of view of circuit solutions.  On this, perhaps, I will take my leave :) </p><br><p>  <b>Sergey Besarab</b> ( <a href="https://www.facebook.com/steanlab">Siarhei V. Besarab</a> ) </p><br><p>  <b>PS</b> After the question to the members of the habr-community, who suddenly quite accidentally stumbled around the same as my D-link DUB-H7 in a gray case. </p><br><img src="https://habrastorage.org/webt/_j/jb/pk/_jjbpk6wn6mj9ftl9m2i8wscjgo.jpeg"><br><p>  What are the details installed on the circled positions (and maybe someone even saw the scheme)?  Elements RP1 ... RP2 are especially interesting (I suspect a resistor assembly of 0 resistances). </p><br><p>  <u>Addition</u> : if suddenly someone needs a firmware dump for the EEPROM 24C02 chip, it looks like this: </p><br><img src="https://habrastorage.org/webt/67/_w/zm/67_wzmql8dpwcrzyjeybmwvvxaa.jpeg"><br><div class="spoiler">  <b class="spoiler_title">List of used sources</b> <div class="spoiler_text"><ol><li>  <a href="http://simple-is-beauty.blogspot.com/2017/12/usb-port-control.html">http://simple-is-beauty.blogspot.com/2017/12/usb-port-control.html</a> </li><li>  <a href="https://askubuntu.com/questions/149242/is-it-possible-to-power-up-ports-on-a-usb-hub-from-ubuntu">https://askubuntu.com/questions/149242/is-it-possible-to-power-up-ports-on-a-usb-hub-from-ubuntu</a> </li><li>  <a href="http://www.ibuyopenwrt.com/index.php/15-yun-compatible/hardware-yun/36-usb-hub-per-port-power-switching-2">http://www.ibuyopenwrt.com/index.php/15-yun-compatible/hardware-yun/36-usb-hub-per-port-power-switching-2</a> </li><li>  <a href="https://www.joeldare.com/wiki/usb_powered_animated_christmas_lights">https://www.joeldare.com/wiki/usb_powered_animated_christmas_lights</a> </li><li>  <a href="https://michaelbluejay.com/batteries/dc-christmas-lights.html">https://michaelbluejay.com/batteries/dc-christmas-lights.html</a> </li><li>  <a href="https://forum.archive.openwrt.org/viewtopic.php%3Fid%3D49012">https://forum.archive.openwrt.org/viewtopic.php?id=49012</a> </li><li>  <a href="http://atotto.hatenadiary.jp/entry/linux-sugoi-usb-hub-power-ctrl">http://atotto.hatenadiary.jp/entry/linux-sugoi-usb-hub-power-ctrl</a> </li><li>  <a href="https://hant.helplib.com/GitHub/article_111870">https://hant.helplib.com/GitHub/article_111870</a> </li><li>  <a href="https://www.quaxio.com/hub_ctrl/">https://www.quaxio.com/hub_ctrl/</a> </li><li>  <a href="https://forum.ixbt.com/topic.cgi%3Fid%3D13:40305-4">https://forum.ixbt.com/topic.cgi?id=13:40305-4</a> </li><li>  <a href="http://www.cypress.com/file/124006/download">http://www.cypress.com/file/124006/download</a> </li><li>  <a href="https://github.com/mvp/uhubctl">https://github.com/mvp/uhubctl</a> </li><li>  <a href="https://github.com/crazystick/py-hub-ctrl">https://github.com/crazystick/py-hub-ctrl</a> </li><li>  <a href="http://atc-ip.ru/info/29/1.html">http://atc-ip.ru/info/29/1.html</a> </li></ol></div></div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/430220/">https://habr.com/ru/post/430220/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../430208/index.html">MIT course "Computer Systems Security". Lecture 18: "Private Internet Browsing", part 3</a></li>
<li><a href="../430210/index.html">Puzzle "Test My Patience" by Check Point Security Academy</a></li>
<li><a href="../430212/index.html">OpenSceneGraph: Scene Geometry Basics</a></li>
<li><a href="../430216/index.html">As I understood that I eat a lot of sweets, or the classification of goods by checks in the application</a></li>
<li><a href="../430218/index.html">Energy Optimization STM32: A Practical Guide</a></li>
<li><a href="../430222/index.html">Senior Engineer in search of work. How I passed 20 interviews with HR and what I think about it</a></li>
<li><a href="../430224/index.html">Schizotypal Disorder: An Inside Look</a></li>
<li><a href="../430226/index.html">From var b to interview</a></li>
<li><a href="../430228/index.html">X-shaped marks, as a way to identify the radar by analyzing open data from two scientific satellites SENTINEL-1</a></li>
<li><a href="../430230/index.html">How to keep your place in the maturing startup</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>