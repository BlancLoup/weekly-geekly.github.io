<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to close a variable in C # and not shoot yourself in the foot</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Back in 2005, with the release of the C # 2.0 standard, it was possible to transfer a variable to the body of an anonymous delegate by capturing it (o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to close a variable in C # and not shoot yourself in the foot</h1><div class="post__text post__text-html js-mediator-article">  Back in 2005, with the release of the C # 2.0 standard, it was possible to transfer a variable to the body of an anonymous delegate by capturing it (or closing it to anyone) from the current context.  In 2008, the new C # 3.0 standard came out, bringing us lambdas, custom anonymous classes, LINQ queries and much more.  Now it's January 2017 and most of the C # developers are looking forward to the release of the standard C # 7.0, which should bring many new useful features.  But fix the old "features", no one is in a hurry.  Therefore, there are still enough ways to accidentally shoot yourself in the foot.  Today we will talk about one of them, and it is connected with a not quite obvious mechanism for capturing variables in the body of anonymous functions in C #. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/433/af9/b4a/433af9b4a44c643067f181b878f3631c.png" alt="Picture 1"></div><p></p><a name="habracut"></a><br><h2>  Introduction </h2><br>  As I wrote above, in this article we will discuss the peculiarities of the work of the mechanism for capturing variables in the body of anonymous methods in the C # language.  I just want to make a reservation that this article will contain a lot of technical details, but I hope that I will be able to easily and interestingly tell both experienced and novice developers about this. <br><br>  And now more to the point.  I will write a simple code sample, and you will need to say exactly what will be displayed in the console in this case. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And so, let's get started: <br><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Foo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> actions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Action&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; i++) { actions.Add(() =&gt; Console.WriteLine(i)); } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> actions) { a(); } }</code> </pre> <br>  And now attention, answer: <br><br><div class="spoiler">  <b class="spoiler_title">Answer</b> <div class="spoiler_text">  The console will display ten times the number ten: <br><pre> <code class="cs hljs"><span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre> </div></div><br>  This article is for those who thought otherwise.  Let's look at the reasons for this behavior. <br><br><h2>  Why it happens? </h2><br>  When declaring an anonymous function (it can be an anonymous delegate or lambda) inside your class, at the compilation stage another container class will be declared containing fields for all captured variables and a method containing the body of the anonymous function.  For the above code section, the disassembled structure of the program after compilation will look like this: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7a8/602/144/7a86021449da435ccac863c7133c0ce3.png" alt="Picture 3"></div><p></p><br><br>  In this case, the <i>Foo</i> method from the code shown at the beginning of the section is declared inside the <i>Program</i> class.  For lambda <i>() =&gt; Console.WriteLine (i), the</i> compiler generated the container class <i>c__DisplayClass1_0</i> , and inside it - the field <i>i</i> containing the same captured variable and the <i>b__0</i> method containing the lambda body. <br><br>  Let's look at the disassembled IL method code <i>b__0</i> (lambda body) with my comments: <br><br><div class="spoiler">  <b class="spoiler_title">Some IL code</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">.<span class="hljs-keyword"><span class="hljs-keyword">method</span></span> assembly hidebysig instance <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;Foo&gt;b__0'</span></span>() cil managed { .maxstack <span class="hljs-number"><span class="hljs-number">8</span></span> //        ( <span class="hljs-string"><span class="hljs-string">'this'</span></span>). //        . IL_0000: ldarg<span class="hljs-number"><span class="hljs-number">.0</span></span> //       <span class="hljs-string"><span class="hljs-string">'i'</span></span> //   . IL_0001: ldfld int32 TestSolution.Program/<span class="hljs-string"><span class="hljs-string">'&lt;&gt;c__DisplayClass1_0'</span></span>::i //      . //       . IL_0006: <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> [mscorlib]<span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Console::WriteLine(int32) //   . IL_000b: ret }</code> </pre> </div></div><br>  That's right, this is exactly what we do inside the lambda, no magic.  Go ahead. <br><br>  As is known, the <i>int</i> type (the full name is <i>Int32</i> ) is a structure, which means that when a transfer is made, the reference to it is not transferred to memory, but its value is copied directly. <br><br>  The value of the variable <i>i</i> must be copied (logically) during the creation of an instance of the container class.  And if you answered incorrectly to my question at the beginning of the article, then most likely you expected that the container would be created immediately before declaring the lambda in the code. <br><br>  In fact, the variable <i>i</i> after compilation will not be created at all inside the <i>Foo</i> method.  Instead, an instance of the container class <i>c__DisplayClass1_0</i> will be created, and its field <i>i</i> will be initialized instead of the local variable <i>i with</i> value 0. Moreover, wherever before we used the local variable <i>i</i> , the container class field is now used. <br><br>  The important point is that an instance of the container class will be created before the loop, since its <i>i</i> field will be used in the loop as an iterator. <br><br>  As a result, we get one instance of the container class for all iterations of the <i>for</i> loop.  And by adding a new lambda to the list of <i>actions</i> at each iteration, we, in fact, add the same link to the previously created instance of the container class.  As a result, when we loop <i>around the foreach loop</i> all the elements of the <i>actions</i> list, they all contain the same instance of the container class.  And if we take into account that the <i>for</i> loop executes an increment to the iterator value after each iteration (even after the last one), then the value of field <i>i</i> within the container class after exiting the loop becomes ten after executing the <i>for</i> loop. <br><br>  I can be convinced of all of the above by looking at the disassembled IL code of the <i>Foo</i> method (with my comments, of course): <br><br><div class="spoiler">  <b class="spoiler_title">Careful IL code</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">.<span class="hljs-keyword"><span class="hljs-keyword">method</span></span> private hidebysig instance <span class="hljs-type"><span class="hljs-type">void</span></span> Foo() cil managed { .maxstack <span class="hljs-number"><span class="hljs-number">3</span></span> // -==========    ==========- .locals init( //  <span class="hljs-string"><span class="hljs-string">'actions'</span></span>. [<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> [mscorlib]<span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Collections.Generic.List<span class="hljs-string"><span class="hljs-string">'1 &lt;class [mscorlib]System.Action&gt; actions, // -  . [1] class TestSolution.Program/ '</span></span>&lt;&gt;c__DisplayClass1_0<span class="hljs-string"><span class="hljs-string">' '</span></span>CS$&lt;&gt;<span class="hljs-number"><span class="hljs-number">8</span></span>__locals0<span class="hljs-string"><span class="hljs-string">', //   V_2    //    . [2] int32 V_2, //   V_3    //   '</span></span>actions<span class="hljs-string"><span class="hljs-string">'     '</span></span><span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span><span class="hljs-string"><span class="hljs-string">'. [3] valuetype [mscorlib]System.Collections.Generic.List'</span></span><span class="hljs-number"><span class="hljs-number">1</span></span>/Enumerator&lt;<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> [mscorlib]<span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Action&gt; V_3) // -=================  =================- //    Actions   //  <span class="hljs-string"><span class="hljs-string">'actions'</span></span>. IL_0000: newobj instance <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> [mscorlib]<span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Collections.Generic.List<span class="hljs-string"><span class="hljs-string">'1&lt;class [mscorlib]System.Action&gt;::.ctor() IL_0005: stloc.0 //   -  //     . IL_0006: newobj instance void TestSolution.Program/'</span></span>&lt;&gt;c__DisplayClass1_0<span class="hljs-string"><span class="hljs-string">'::.ctor() IL_000b: stloc.1 //      -. IL_000c: ldloc.1 //  0   . IL_000d: ldc.i4.0 //     0  '</span></span>i<span class="hljs-string"><span class="hljs-string">'  //    ( -). IL_000e: stfld int32 TestSolution.Program/'</span></span>&lt;&gt;c__DisplayClass1_0<span class="hljs-string"><span class="hljs-string">'::i // -=================  FOR =================- //    IL_0037. IL_0013: br.s IL_0037 //      '</span></span>actions<span class="hljs-string"><span class="hljs-string">'  //  -. IL_0015: ldloc.0 IL_0016: ldloc.1 //       '</span></span>Foo<span class="hljs-string"><span class="hljs-string">' //  -. IL_0017: ldftn instance void TestSolution.Program/'</span></span>&lt;&gt;c__DisplayClass1_0<span class="hljs-string"><span class="hljs-string">'::'</span></span>&lt;Foo&gt;b__0<span class="hljs-string"><span class="hljs-string">'() //    '</span></span>Action<span class="hljs-string"><span class="hljs-string">'     //    '</span></span>Foo<span class="hljs-string"><span class="hljs-string">'  -. IL_001d: newobj instance void [mscorlib]System.Action::.ctor(object, native int) //   '</span></span><span class="hljs-keyword"><span class="hljs-keyword">Add</span></span><span class="hljs-string"><span class="hljs-string">'   '</span></span>actions<span class="hljs-string"><span class="hljs-string">'  //     '</span></span>Action<span class="hljs-string"><span class="hljs-string">'. IL_0022: callvirt instance void class [mscorlib]System.Collections.Generic.List'</span></span><span class="hljs-number"><span class="hljs-number">1</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> [mscorlib]<span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Action&gt;::<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(!<span class="hljs-number"><span class="hljs-number">0</span></span>) //      <span class="hljs-string"><span class="hljs-string">'i'</span></span>  // -. IL_0027: ldloc<span class="hljs-number"><span class="hljs-number">.1</span></span> IL_0028: ldfld int32 TestSolution.Program/<span class="hljs-string"><span class="hljs-string">'&lt;&gt;c__DisplayClass1_0'</span></span>::i //    <span class="hljs-string"><span class="hljs-string">'V_2'</span></span>   <span class="hljs-string"><span class="hljs-string">'i'</span></span>. IL_002d: stloc<span class="hljs-number"><span class="hljs-number">.2</span></span> //       - //     <span class="hljs-string"><span class="hljs-string">'V_2'</span></span>. IL_002e: ldloc<span class="hljs-number"><span class="hljs-number">.1</span></span> IL_002f: ldloc<span class="hljs-number"><span class="hljs-number">.2</span></span> //     <span class="hljs-number"><span class="hljs-number">1.</span></span> IL_0030: ldc.i4<span class="hljs-number"><span class="hljs-number">.1</span></span> //          . IL_0031: <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> //       <span class="hljs-string"><span class="hljs-string">'i'</span></span>. // (  ) IL_0032: stfld int32 TestSolution.Program/<span class="hljs-string"><span class="hljs-string">'&lt;&gt;c__DisplayClass1_0'</span></span>::i //    <span class="hljs-string"><span class="hljs-string">'i'</span></span>  // -  . IL_0037: ldloc<span class="hljs-number"><span class="hljs-number">.1</span></span> IL_0038: ldfld int32 TestSolution.Program/<span class="hljs-string"><span class="hljs-string">'&lt;&gt;c__DisplayClass1_0'</span></span>::i //     <span class="hljs-number"><span class="hljs-number">10.</span></span> IL_003d: ldc.i4.s <span class="hljs-number"><span class="hljs-number">10</span></span> //    <span class="hljs-string"><span class="hljs-string">'i'</span></span>   <span class="hljs-number"><span class="hljs-number">10</span></span>, //     IL_0015. IL_003f: blt.s IL_0015 // -=================  <span class="hljs-keyword"><span class="hljs-keyword">FOREACH</span></span> =================- //       <span class="hljs-string"><span class="hljs-string">'actions'</span></span>. IL_0041: ldloc<span class="hljs-number"><span class="hljs-number">.0</span></span> //   V_3   //   <span class="hljs-string"><span class="hljs-string">'GetEnumerator'</span></span>   <span class="hljs-string"><span class="hljs-string">'actions'</span></span>. IL_0042: callvirt instance valuetype [mscorlib]<span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Collections.Generic.List<span class="hljs-string"><span class="hljs-string">'1/Enumerator&lt;!0&gt; class [mscorlib]System.Collections.Generic.List'</span></span><span class="hljs-number"><span class="hljs-number">1</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> [mscorlib]<span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Action&gt;::GetEnumerator() IL_0047: stloc<span class="hljs-number"><span class="hljs-number">.3</span></span> //   try ( <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>  //   try-finally). .try { //    IL_0056. IL_0048: br.s IL_0056 //    V_3  get_Current. //    . // (   Action   ). IL_004a: ldloca.s V_3 IL_004c: <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> instance !<span class="hljs-number"><span class="hljs-number">0</span></span> valuetype [mscorlib]<span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Collections.Generic.List<span class="hljs-string"><span class="hljs-string">'1/Enumerator&lt;class [mscorlib]System.Action&gt;::get_Current() //    Action    Invoke. IL_0051: callvirt instance void [mscorlib]System.Action::Invoke() //    V_3  MoveNext. //    . IL_0056: ldloca.s V_3 IL_0058: call instance bool valuetype [mscorlib]System.Collections.Generic.List'</span></span><span class="hljs-number"><span class="hljs-number">1</span></span>/Enumerator&lt;<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> [mscorlib]<span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Action&gt;::MoveNext() //     MoveNext  <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, //     IL_004a. IL_005d: brtrue.s IL_004a //    try    finally. IL_005f: leave.s IL_006f } // <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> .try finally { //    V_3  Dispose. IL_0061: ldloca.s V_3 IL_0063: constrained. Valuetype [mscorlib]<span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Collections.Generic.List<span class="hljs-string"><span class="hljs-string">'1/Enumerator&lt;class [mscorlib]System.Action&gt; IL_0069: callvirt instance void [mscorlib]System.IDisposable::Dispose() //    finally. IL_006e: endfinally } //    . IL_006f: ret }</span></span></code> </pre></div></div><br><h2>  Conclusion </h2><br>  Comrades from Microsoft argue that this is not a bug, but a feature, and this behavior was deliberately implemented, in order to increase the productivity of the programs.  More information on the <a href="https://blogs.msdn.microsoft.com/abhinaba/2005/10/18/c-anonymous-methods-are-not-closures/">link</a> .  In fact, this translates into bugs, and misunderstanding on the part of novice developers. <br><br>  An interesting fact is that the <i>foreach loop</i> had a similar behavior up to the standard C # 5.0.  Microsoft was literally bombarded with non-intuitive behavior in a bug tracker, and then with the release of the C # 5.0 standard, this behavior was changed by declaring an iterator variable inside each iteration of the loop, not at the compilation stage, but for all other loop constructs changes.  Read more about this at the <a href="https://visualstudiomagazine.com/articles/2012/11/01/more-than-just-async.aspx">link</a> in the <i>Breaking Changes</i> section. <br><br>  You ask how to avoid this error?  In fact, the answer is very simple.  You need to keep track of where and what variables you are capturing.  Remember, a container class will be created where you declared your variable, which you will later capture.  If the capture occurs in the body of the loop, and the variable is declared outside of it, then it is necessary to reassign it inside the loop body to a new local variable.  The correct version of the example at the beginning could look like this: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Foo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> actions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Action&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; i++) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> index = i; <span class="hljs-comment"><span class="hljs-comment">// &lt;= actions.Add(() =&gt; Console.WriteLine(index)); } foreach(var a in actions) { a(); } }</span></span></code> </pre> <br>  If you execute this code, the numbers from 0 to 9 will be displayed in the console as expected: <br><br><div class="spoiler">  <b class="spoiler_title">Console output</b> <div class="spoiler_text"><pre> <code class="hljs">0 1 2 3 4 5 6 7 8 9</code> </pre> </div></div><br>  Looking at the IL code of the for loop from this example, we will see that an instance of the container class will be created every iteration of the loop.  Thus, the list of <i>actions</i> will contain links to different instances with valid iterator values. <br><br><div class="spoiler">  <b class="spoiler_title">Some more IL code</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">// -=================  <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> =================- //    IL_002d. IL_0008: br.s IL_002d //   -      IL_000a: newobj instance <span class="hljs-type"><span class="hljs-type">void</span></span> TestSolution.Program/<span class="hljs-string"><span class="hljs-string">'&lt;&gt;c__DisplayClass1_0'</span></span>::.ctor() IL_000f: stloc<span class="hljs-number"><span class="hljs-number">.2</span></span> IL_0010: ldloc<span class="hljs-number"><span class="hljs-number">.2</span></span> //   <span class="hljs-string"><span class="hljs-string">'index'</span></span>  - //   <span class="hljs-string"><span class="hljs-string">'i'</span></span>. IL_0011: ldloc<span class="hljs-number"><span class="hljs-number">.1</span></span> IL_0012: stfld int32 TestSolution.Program/<span class="hljs-string"><span class="hljs-string">'&lt;&gt;c__DisplayClass1_0'</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">index</span></span> //    <span class="hljs-string"><span class="hljs-string">'Action'</span></span>     // -      <span class="hljs-string"><span class="hljs-string">'actions'</span></span>. IL_0017: ldloc<span class="hljs-number"><span class="hljs-number">.0</span></span> IL_0018: ldloc<span class="hljs-number"><span class="hljs-number">.2</span></span> IL_0019: ldftn instance <span class="hljs-type"><span class="hljs-type">void</span></span> TestSolution.Program/<span class="hljs-string"><span class="hljs-string">'&lt;&gt;c__DisplayClass1_0'</span></span>::<span class="hljs-string"><span class="hljs-string">'&lt;Foo&gt;b__0'</span></span>() IL_001f: newobj instance <span class="hljs-type"><span class="hljs-type">void</span></span> [mscorlib]<span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Action::.ctor(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>, native <span class="hljs-type"><span class="hljs-type">int</span></span>) IL_0024: callvirt instance <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> [mscorlib]<span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Collections.Generic.List<span class="hljs-string"><span class="hljs-string">'1&lt;class [mscorlib]System.Action&gt;::Add(!0) //     '</span></span>i<span class="hljs-string"><span class="hljs-string">' IL_0029: ldloc.1 IL_002a: ldc.i4.1 IL_002b: add IL_002c: stloc.1 //      '</span></span>i<span class="hljs-string"><span class="hljs-string">'. //        -. IL_002d: ldloc.1 //    '</span></span>i<span class="hljs-string"><span class="hljs-string">' c  10. //  '</span></span>i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-string"><span class="hljs-string">',     IL_000a. IL_002e: ldc.i4.s 10 IL_0030: blt.s IL_000a</span></span></code> </pre> </div></div><br>  Finally, let me remind you that we are all human, and we all make mistakes, and it‚Äôs not only logical to rely on the human factor when looking for errors and typos in the code, but as a rule it‚Äôs also long and resource-intensive.  Therefore, it always makes sense to use technical solutions to find and identify errors in your code.  The machine not only does not know fatigue, but often performs the work faster. <br><br>  Most recently, we, the developers of the <a href="http://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> static analyzer, have implemented a regular <a href="http://www.viva64.com/ru/w/V3129/">diagnostics</a> aimed at finding errors of incorrectly capturing variables in anonymous functions inside loops.  In my turn, I hasten to invite you to check your code for errors and typos with our static analyzer. <br><br>  On this note, I end this article, and I wish you a clean code and reckless programs. <br><br><div style="text-align:center;"> <a href="http://www.viva64.com/en/b/0468/"><img src="https://habrastorage.org/files/8d2/41b/5bf/8d241b5bf34747169141ed7c1997143b.png"></a> </div><br><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Ivan Kishchenko.  <a href="http://www.viva64.com/en/b/0468/">How to capture a variable in c #</a> <br><br><div class="spoiler">  <b class="spoiler_title">Read the article and have a question?</b> <div class="spoiler_text">  Often our articles are asked the same questions.  We collected answers to them here: <a href="http://www.viva64.com/ru/a/0085/">Answers to questions from readers of articles about PVS-Studio, version 2015</a> .  Please review the list. </div></div></div><p>Source: <a href="https://habr.com/ru/post/320588/">https://habr.com/ru/post/320588/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../320578/index.html">PgConf.Russia 2017 - we invite you to the March conference in Moscow</a></li>
<li><a href="../320580/index.html">Interviews with a ddaser or what vandals earn</a></li>
<li><a href="../320582/index.html">A stable release of Wine 2.0 has been released with 6000+ changes and additions.</a></li>
<li><a href="../320584/index.html">CTA button: 10 pillars of efficiency</a></li>
<li><a href="../320586/index.html">How I passed the Hortonworks Data Platform Certified Administrator (HDPCA) exam</a></li>
<li><a href="../320590/index.html">Pygest # 2. Releases, articles, interesting projects from the world of Python [January 15, 2017 - January 29, 2017]</a></li>
<li><a href="../320592/index.html">How IT professionals work. Andrey Tsai, ADV-ONLINE</a></li>
<li><a href="../320594/index.html">Fun nuances of Win10 and what to do about it</a></li>
<li><a href="../320596/index.html">OSSI and Avaya Communication Manager</a></li>
<li><a href="../320598/index.html">Crowd development of a scoring system for the IEM system</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>