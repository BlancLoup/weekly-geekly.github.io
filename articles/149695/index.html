<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Monitoring PHP Code Performance with Pinba</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Let's imagine a typical start-up that is gaining popularity, using, for example, PHP or Python. At first everything is on one server - PHP (or Python)...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Monitoring PHP Code Performance with Pinba</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/35e/f81/efe/35ef81efe1e34c0d2465f8b7945e90c5.png" align="left">  Let's imagine a typical start-up that is gaining popularity, using, for example, PHP or Python.  At first everything is on one server - PHP (or Python), Apache, MySQL.  Then you bring MySQL to a separate server, install nginx to distribute content, maybe add memcached for caching and some more application servers ... <br><br>  Over time, the number of servers will grow, and sooner or later you will ask yourself questions <br>  ‚ÄúWhat is happening with the system now?  How often does one script or another run and for how long?  What operations take up most of the time? ‚ÄùZabbix type monitoring systems provide only a general, superficial picture of the application state. <br><br>  To get answers to these questions, a real-time monitoring and statistics service, <a href="http://pinba.org/">Pinba,</a> was developed at Badoo.  In this article we will tell about our experience of using it for monitoring and profiling our system. <br><a name="habracut"></a><br><h3>  A few words about badoo </h3><br>  To assess the level of complexity of the problem, we will describe in a few words what Badoo is.  Today we have 2 data centers, one in America, the second in Europe.  The data centers have hundreds of PHP servers, MySQL servers, dozens of memcached and self-written services written in C / C ++.  Inside Badoo, there are subprojects (for example, a website, applications for mobile devices and desktops), the implementation and nature of the loads on which vary greatly.  In a single PHP request, interactions can occur with dozens of different data sources (database, cache, service).  This is bad for productivity, but it is necessary for solving business problems.  And in addition to this, we post a new code from 2 to 5 times a week.  Monitoring the performance of such a system is not an easy task.  Pinba helped to solve a large amount of problems associated with monitoring the performance of PHP scripts.  This service collects information about all processed PHP requests and generates detailed reports on this data. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  How it all works </h3><br>  At Habrahabr, there was already an article about how to start working with Pinba: " <a href="http://habrahabr.ru/post/129042/">Pinba - monitor php in real time</a> ."  In it, the author described how to install and configure Pinba, so now we will focus on more interesting things: how it all works and what information can be obtained. <br><br>  The general scheme of working with Pinba is shown in the diagram: <br><br><img src="https://habrastorage.org/storage2/e91/4c6/b1a/e914c6b1a2ea05f589dfed4e577c8da9.png"><br><br>  Pinba consists of a PHP module ( <i>PHP extension</i> ) and a server.  Pinba module automatically sends data on all processed requests to the server.  Pinba server is a service written in C, which: <br><ul><li>  collects data about processed requests via UDP; </li><li>  keeps all this data in memory and builds reports on it; </li><li>  provides access to raw data and reports using the MySQL protocol, that is, in fact, is a MySQL engine. </li></ul><br>  To find out what is happening with the system at the moment, it is enough to connect to the server with any MySQL client and make a few queries from the table-reports.  For example, you can view statistics on requests for each of the PHP scripts (one of the most used reports in Pinba): <br><pre><code class="sql hljs">mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> report_by_script_name;</code> </pre> <br><br>  Below we describe in more detail how to work with reports in Pinba. <br><br><h3>  How the PHP module for Pinba works </h3><br>  Even at the planning stage of the first version of the Pinba service, an idea immediately emerged of organizing the collection of general statistics without making changes to the PHP code.  People who have experience writing PHP modules know that the latter have the ability to perform certain actions before each request (phase PHP_RINIT) and after processing it (phase PHP_RSHUTDOWN).  For example, in the PHP_RINIT phase, the module can initialize its internal resources, and in RSHUTDOWN, it can free them.  The PHP module for Pinba uses both of these phases.  In RINIT, it is initialized, in RSHUTDOWN it calculates how much resources have been spent on processing the request, and then all data is sent by the UDP packet to the Pinba server. <br><br>  Sending a UDP packet to C is fast enough, so the Pinba module does not add extra workload to the PHP process.  And due to the fact that Pinba works as a module, it is enough to install and configure it, and you can immediately find out such parameters of your system as the number of requests for each of the scripts, the average running time without making changes to the PHP code. and much more. <br><br>  Unfortunately, if you have a complex system, general parameters will not be enough. <br><br><h3>  Timers </h3><br>  Initially, in the first version of Pinba (let's call it Pinba v0.1) there were no timers.  This version could tell us how often a script is called, what is the average response time, what is the average response size in bytes, and so on.  It was impossible to find out the frequency of requests to MySQL, memcached or other services.  This may not seem so critical to you, but in our system, in addition to MySQL and memcached, about a dozen different services written in C / C ++ are used. <br><br>  If there was a problem in the system (for example, something started to ‚Äúslow down‚Äù), then Pinba v0.1 showed us that there is a problem, but it was not always possible to quickly understand what exactly it is.  Most often, in such situations, one of the services to which PHP made requests (MySQL, memcached, and others) was guilty. <br><br>  To learn how to find such problem areas quickly, timers were introduced in the next version of Pinba. <br><br>  In fact, we decided to measure the running time of the mysql_connect / mysql_query / memcache_connect, etc. calls, send this time to the Pinba-server and build reports on timers.  On pseudo-php code, it looks like this: <br><br><pre> <code class="php hljs">pinba_timer_start(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'type'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'db::connect'</span></span>, <span class="hljs-string"><span class="hljs-string">'host'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'users.sql'</span></span>)); $conn = mysql_connect(...); pinba_timer_stop();</code> </pre> <br>  Here we measure the running time of the mysql_connect call and assign 2 tags to the timer, after which we will be able to build reports. <br><br>  All timers along with all the data are sent to the Pinba-server and reporting tables are built on it.  This allows you to see which operations take the most time at the moment.  Moreover, if you have, for example, hundreds of MySQL-servers and only one of them slows down, Pinba makes it easy to calculate the very problematic server due to a very flexible report schedule by timers. <br><br><h3>  Getting started with tables </h3><br>  Here is a list of tables Pinba gives access to: <br><br><pre> <code class="sql hljs">mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">SHOW</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLES</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pinba; +<span class="hljs-comment"><span class="hljs-comment">--------------------------------------+ | Tables_in_pinba | +--------------------------------------+ | info | | report_by_hostname | | report_by_hostname_and_script | | report_by_hostname_and_server | | report_by_hostname_server_and_script | | report_by_script_name | | report_by_server_and_script | | report_by_server_name | | report_by_status | | request | | tag | | timer | | timertag | +--------------------------------------+ 13 rows in set (0.00 sec)</span></span></code> </pre> <br>  Conventionally, all tables can be divided into 2 types: tables with ‚Äúraw‚Äù data and reports. <br>  There are 4 tables with raw data: request, tag, timer, timertag.  These tables contain an entry for each invocation of a script, timer, and tag in the last few minutes.  In high-load systems, these tables may contain millions of records, so we do not recommend using them directly.  Instead, it is better to use tables-reports that contain enough useful data for analyzing system performance. <br><br><h3>  Report Tables </h3><br>  <b>Report_by_script_name</b> is one of the most used reports;  contains information about how often each script was called, its average execution time, its use of CPU, the amount of traffic attributed to it. <br><br><pre> <code class="sql hljs">mysql&gt; DESC report_by_script_name; +<span class="hljs-comment"><span class="hljs-comment">------------------+--------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +------------------+--------------+------+-----+---------+-------+ | req_count | int(11) | YES | | NULL | | | req_per_sec | float | YES | | NULL | | | req_time_total | float | YES | | NULL | | | req_time_percent | float | YES | | NULL | | | req_time_per_sec | float | YES | | NULL | | | ru_utime_total | float | YES | | NULL | | | ru_utime_percent | float | YES | | NULL | | | ru_utime_per_sec | float | YES | | NULL | | | ru_stime_total | float | YES | | NULL | | | ru_stime_percent | float | YES | | NULL | | | ru_stime_per_sec | float | YES | | NULL | | | traffic_total | float | YES | | NULL | | | traffic_percent | float | YES | | NULL | | | traffic_per_sec | float | YES | | NULL | | | script_name | varchar(128) | YES | | NULL | | +------------------+--------------+------+-----+---------+-------+ 15 rows in set (0.00 sec)</span></span></code> </pre> <br>  The fields with the suffix <i>_total</i> are the sum of the corresponding values ‚Äã‚Äãfor all requests in the last 5 minutes.  That is, for example, <i>req_time_total</i> is the sum of the execution time of all queries for the corresponding script in the last 5 minutes.  And <i>req_time_total / req_count</i> is the average execution time of the script.  The <i>req_utime_ *</i> and <i>req_stime_ * fields</i> show the CPU usage in user mode and system mode, respectively. <br><br>  In our company, using these data, we build graphs of the number of requests for a particular script and graphics of CPU consumption by scripts (graphics 1, 2): <br><br>  Chart 1. <br><img src="https://habrastorage.org/storage2/c3a/4d9/7df/c3a4d97df6b4934945c8439c50bfc7ce.png"><br><br>  Chart 2. <br><img src="https://habrastorage.org/storage2/308/398/fa7/308398fa7a11a730bebf85aa7995f04d.png"><br><br>  <b>Report_by_hostname</b> : this report shows how many requests go to a specific server.  It has almost the same list of fields, but instead of the script_name field, the table contains the hostname field. <br><br><pre> <code class="sql hljs">mysql&gt; DESC report_by_hostname; +<span class="hljs-comment"><span class="hljs-comment">------------------+-------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +------------------+-------------+------+-----+---------+-------+ | req_count | int(11) | YES | | NULL | | ......... | hostname | varchar(32) | YES | | NULL | | +------------------+-------------+------+-----+---------+-------+ 15 rows in set (0.00 sec)</span></span></code> </pre> <br>  Probably, some expected to see the domain in the hostname variable passed in the HTTP Host header.  But in reality, the hostname is the contents of the $ _ENV ['HOSTNAME'] variable and contains the name of the machine. <br><br>  The main point of this report is to get information about the number of requests to a specific server and whether more servers go to any servers than to the neighboring ones. <br><br>  <b>Report_by_server_name</b> : in this report, the data is grouped by the domain to which the request came.  It shows the number of requests going to a particular domain.  The table structure is the same as in the previous two, only the data is now grouped by the <i>server_name</i> field. <br><br>  <b>Report_by_status</b> : this report is used to view HTTP statuses with which our scripts are completed: <br><br><pre> <code class="sql hljs">mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> req_count, <span class="hljs-keyword"><span class="hljs-keyword">status</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> report_by_status; +<span class="hljs-comment"><span class="hljs-comment">-----------+--------+ | req_count | status | +-----------+--------+ | 540622 | 200 | | 2578 | 301 | | 21955 | 302 | | 296 | 403 | | 2090 | 404 | +-----------+--------+ 5 rows in set (0.14 sec)</span></span></code> </pre> <br>  If the report has a status of 500, it means that we have ‚ÄúFatal error‚Äù somewhere in the PHP code. <br><br><h3>  Timers and tags </h3><br>  The reports discussed above are useful for general system analysis.  But for more detailed analysis, we use timers and tags. <br><br>  The timer is the time of execution of some part of the code.  Several tags can be attached to the timer.  The tag has a key and a value.  For example, in the timer code that was shown above, <br><br><pre> <code class="php hljs">pinba_timer_start(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'group'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'db::connect'</span></span>, <span class="hljs-string"><span class="hljs-string">'host'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'users.sql'</span></span>)); $conn = mysql_connect(...); pinba_timer_stop();</code> </pre> <br>  we measure the execution time of the mysql_connect function and bind 2 tags - group and host. <br><br>  By default, Pinba has no reports on timers and tags, but it provides very flexible options for creating them.  Below we take a closer look at how this is done in Badoo. <br><br>  First of all, we use timers to get statistics of requests to various data sources: MySQL, memcached, services written in C / C ++.  We ‚Äúwrapped‚Äù all such requests with Pinba-timers with two tags: group and host (host is the address of the database or service, group is an operation on the service). <br><br>  So, if we have implemented a tag in our system that is sent to Pinba, we can build several reports.  First of all, it will be a complete report on all values ‚Äã‚Äãof the tag.  In our example with the group tag, we can build a report on how often this or that operation is called and how much time (total) it takes.  To do this, create a table: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`tag_info_group`</span></span> ( <span class="hljs-string"><span class="hljs-string">`tag_value`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">64</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`req_count`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`req_per_sec`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`hit_count`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`hit_per_sec`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`timer_value`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=PINBA <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=latin1 <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span>=<span class="hljs-string"><span class="hljs-string">'tag_info:group'</span></span></code> </pre> <br>  The table name is arbitrary and does not affect anything.  It is important that the order of the fields be exactly the same as in the example, as well as the values ‚Äã‚Äãfor ENGINE and COMMENT = 'tag_info: group'.  In the comment group is the name of the tag for which we are creating a report.  And tag_info is a type of report (there is also tag_report, which will be discussed below). <br><br>  After creating the table, Pinba will automatically begin to enter data there.  This report will look something like this: <br><br><pre> <code class="sql hljs">mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> tag_info_group <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> timer_value; +<span class="hljs-comment"><span class="hljs-comment">--------------------+-----------+-------------+-----------+-------------+-------------+ | tag_value | req_count | req_per_sec | hit_count | hit_per_sec | timer_value | +--------------------+-----------+-------------+-----------+-------------+-------------+ | curl_request | 56216 | 281.08 | 56710 | 283.55 | 11977.3 | | memcache_get | 2563499 | 12817.5 | 11462991 | 57315 | 6823.04 | | hsc_connect | 2319186 | 11595.9 | 2870366 | 14351.8 | 6140.5 | | hsc_open_index | 2319158 | 11595.8 | 3285335 | 16426.7 | 5805.61 | | hsc_select | 2312567 | 11562.8 | 3158465 | 15792.3 | 5778.57 | | memcache_connect | 2563064 | 12815.3 | 4007451 | 20037.3 | 2389.65 | | memcache_set | 917102 | 4585.51 | 1616016 | 8080.08 | 1059.08 | | memcache_delete | 600720 | 3003.6 | 2451872 | 12259.4 | 785.702 | | scribe_receive | 382881 | 1914.41 | 975892 | 4879.46 | 382.522 | | hsc_update | 84877 | 424.385 | 85287 | 426.435 | 317.637 | | hsc_insert | 41564 | 207.82 | 41574 | 207.87 | 280.468 | | scribe_send | 382894 | 1914.47 | 975892 | 4879.46 | 174.156 | | memcache_increment | 60817 | 304.085 | 88734 | 443.67 | 30.9102 | | memcache_add | 14818 | 74.09 | 16281 | 81.405 | 4.71686 | | memcache_multi_get | 2543 | 12.715 | 2543 | 12.715 | 1.59621 | | hsc_delete | 4 | 0.02 | 9 | 0.045 | 0.003373 | +--------------------+-----------+-------------+-----------+-------------+-------------+ 16 rows in set (0.00 sec)</span></span></code> </pre> <br>  For example, from this report it is clear that we have some very slow <i>curl_request</i> . <br><br>  Reports like <b><i>tag_info</i></b> give an overall picture of its use in the system.  To study in more detail where these or other operations are called from, you need to build the same report, but grouped by the script name.  To do this in Pinba you need to create the following table: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`tag_report_group`</span></span> ( <span class="hljs-string"><span class="hljs-string">`script_name`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">128</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`tag_value`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">64</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`req_count`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`req_per_sec`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`hit_count`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`hit_per_sec`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`timer_value`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=PINBA <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=latin1 <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span>=<span class="hljs-string"><span class="hljs-string">'tag_report:group'</span></span></code> </pre> <br>  The table structure is in many ways similar to the previous <b><i>tag_info_group</i></b> report.  Notice that the <i>script_name</i> field <i>appeared</i> , and in the COMMENT field we created a report like <b><i>tag_report</i></b> .  From this table we can get all the same data as from the previous one, but grouped by <i>script_name</i> . <br><br>  You can see what operations are performed in a particular script: <br><br><pre> <code class="sql hljs">mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> tag_value, req_count, hit_count, timer_value, hit_count/req_count <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> tag_report_group <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> script_name=<span class="hljs-string"><span class="hljs-string">'/admin/messages/all.phtml'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> timer_value <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span>; +<span class="hljs-comment"><span class="hljs-comment">--------------------+-----------+-----------+-------------+---------------------+ | tag_value | req_count | hit_count | timer_value | hit_count/req_count | +--------------------+-----------+-----------+-------------+---------------------+ | memcache_get | 107439 | 3227537 | 1060.68 | 30.0406 | | memcache_connect | 107439 | 887789 | 270.919 | 8.2632 | | scribe_receive | 107573 | 283478 | 68.9106 | 2.6352 | | memcache_set | 34339 | 153080 | 50.6079 | 4.4579 | | scribe_send | 107573 | 283478 | 39.7583 | 2.6352 | | memcache_delete | 18236 | 21306 | 4.54436 | 1.1683 | | curl_request | 15 | 15 | 0.514396 | 1.0000 | | memcache_decrement | 1250 | 1250 | 0.251141 | 1.0000 | | memcache_multi_get | 125 | 125 | 0.066473 | 1.0000 | | memcache_increment | 2 | 2 | 0.000336 | 1.0000 | +--------------------+-----------+-----------+-------------+---------------------+ 10 rows in set (0.03 sec)</span></span></code> </pre> <br>  This example shows the difference between the <i>hit_count</i> and <i>req_count fields</i> .  Req_count is the number of HTTP requests during the processing of which a timer with the specified tag_value was called at least once.  Hit_count - the number of times the timer was called with the specified tag_value. <br><br>  In the example above, you can see that in our /admin/messages/all.phtml script, on average, 30 times, memcache_get is called.  Most likely this is a programmer's error, and the page needs to be optimized. <br><br>  If you have many database servers, memcached and other services, then there may be times when only one server ‚Äúslows down‚Äù.  And his ‚Äúinhibition‚Äù against the general background may not be obvious.  For this purpose, we made another tag called <i>server</i> .  For it, you can create a general report <b><i>tag_info: server</i></b> and see the overall statistics for each host.  Here is an example of data for memcached statistics: <br><br><pre> <code class="sql hljs">mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> tag_info_server <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> tag_value <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> <span class="hljs-string"><span class="hljs-string">'memcache%'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> timer_value; +<span class="hljs-comment"><span class="hljs-comment">------------------+-----------+-------------+-----------+-------------+-------------+ | tag_value | req_count | req_per_sec | hit_count | hit_per_sec | timer_value | +------------------+-----------+-------------+-----------+-------------+-------------+ | memcached7.mlan | 350702 | 1753.51 | 1767513 | 8837.57 | 781.644 | | memcached3.mlan | 336217 | 1681.08 | 1734430 | 8672.15 | 871.633 | | memcached1.mlan | 350082 | 1750.41 | 1823910 | 9119.55 | 883.52 | | memcached8.mlan | 357798 | 1788.99 | 1793808 | 8969.04 | 908.848 | | memcached10.mlan | 343287 | 1716.44 | 1757085 | 8785.42 | 909.042 | | memcached5.mlan | 398042 | 1990.21 | 1861729 | 9308.64 | 914.772 | | memcached4.mlan | 401584 | 2007.92 | 1877775 | 9388.88 | 937.53 | | memcached2.mlan | 459912 | 2299.56 | 2028406 | 10142 | 971.189 | | memcached6.mlan | 399768 | 1998.84 | 1912571 | 9562.86 | 975.094 | | memcached9.mlan | 425276 | 2126.38 | 1939575 | 9697.88 | 1008.29 | +------------------+-----------+-------------+-----------+-------------+-------------+ 10 rows in set (0.00 sec)</span></span></code> </pre> <br>  The general report on the <i>host</i> tag is not informative enough.  It shows the frequency of calling timers with a particular host, but without information about the operations performed.  Fortunately, Pinba is able to create reports like <b><b>tag_info</b></b> and <b><i>tag_report</i></b> grouped by 2 tags: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`tag_info_group_server`</span></span> ( <span class="hljs-string"><span class="hljs-string">`group_value`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">64</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`server_value`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">64</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`req_count`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`req_per_sec`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`hit_count`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`hit_per_sec`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`timer_value`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=PINBA <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=latin1 <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span>=<span class="hljs-string"><span class="hljs-string">'tag2_info:group,server'</span></span></code> </pre> <br>  This report allows you to get statistics on the operations of each host.  For example, you can see the statistics of operations on a particular host: <br><br><pre> <code class="sql hljs">mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> tag_info_group_server <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> server_value = <span class="hljs-string"><span class="hljs-string">'dbs101.mlan'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> timer_value; +<span class="hljs-comment"><span class="hljs-comment">-------------+--------------+-----------+-------------+-----------+-------------+-------------+ | group_value | server_value | req_count | req_per_sec | hit_count | hit_per_sec | timer_value | +-------------+--------------+-----------+-------------+-----------+-------------+-------------+ | db::replace | dbs101.mlan | 154 | 0.77 | 154 | 0.77 | 0.257526 | | db::delete | dbs101.mlan | 1340 | 6.7 | 1340 | 6.7 | 1.84398 | | db::begin | dbs101.mlan | 6437 | 32.185 | 6589 | 32.945 | 2.96375 | | db::commit | dbs101.mlan | 6437 | 32.185 | 6589 | 32.945 | 3.04067 | | db::insert | dbs101.mlan | 4674 | 23.37 | 11171 | 55.855 | 13.9457 | | db::update | dbs101.mlan | 6358 | 31.79 | 10399 | 51.995 | 18.197 | | db::connect | dbs101.mlan | 16826 | 84.13 | 16826 | 84.13 | 22.1383 | | db::select | dbs101.mlan | 14372 | 71.86 | 47106 | 235.53 | 180.235 | +-------------+--------------+-----------+-------------+-----------+-------------+-------------+ 8 rows in set (0.01 sec)</span></span></code> </pre> <br>  For obvious reasons, it is SELECT that takes most of the time. <br><br>  Also, for example, you can compare statistics for the same operation on different hosts.  Example for memcache_connect: <br><br><pre> <code class="sql hljs">mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> server_value, req_count, hit_count, timer_value <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> tag_info_group_server <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> group_value=<span class="hljs-string"><span class="hljs-string">'memcache_connect'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> timer_value; +<span class="hljs-comment"><span class="hljs-comment">------------------+-----------+-----------+-------------+ | server_value | req_count | hit_count | timer_value | +------------------+-----------+-----------+-------------+ | memcached1.mlan | 366138 | 365061 | 191.808 | | memcached3.mlan | 354688 | 353760 | 192.184 | | memcached10.mlan | 365358 | 364341 | 197.353 | | memcached8.mlan | 368912 | 367839 | 213.768 | | memcached7.mlan | 374160 | 373152 | 215.914 | | memcached5.mlan | 415444 | 414434 | 217.855 | | memcached4.mlan | 423394 | 422242 | 252.416 | | memcached2.mlan | 478949 | 477641 | 272.346 | | memcached6.mlan | 414088 | 413003 | 279.038 | | memcached9.mlan | 441589 | 440481 | 377.952 | +------------------+-----------+-----------+-------------+ 10 rows in set (0.01 sec)</span></span></code> </pre> <br>  You can also make a report like <b><i>tag2_report</i></b> , in which the information on 2 tags is divided into scripts: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`tag_report_group_server`</span></span> ( <span class="hljs-string"><span class="hljs-string">`sc0ript_name`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">128</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`tag1_value`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">64</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`tag2_value`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">64</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`req_count`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`req_per_sec`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`hit_count`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`hit_per_sec`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`timer_value`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=PINBA <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=latin1 <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span>=<span class="hljs-string"><span class="hljs-string">'tag2_report:group,server'</span></span></code> </pre> <br>  We give an example where this table can be useful.  In our system, all users are distributed among hundreds of MySQL servers.  This is called "sharding."  There are also certain central MySQL servers for specific tasks.  In theory, all web scripts should only make requests for ‚Äúshards‚Äù and not make requests to central databases.  The hostname of our shards starts with dbs * or dbb *.  You can check if there are any scripts that make connections to other MySQL servers using this query: <br><br><pre> <code class="sql hljs">mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> tag_report_group_server <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> tag1_value=<span class="hljs-string"><span class="hljs-string">'db::connect'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> tag2_value <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> <span class="hljs-string"><span class="hljs-string">'dbs%'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> tag2_value <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> <span class="hljs-string"><span class="hljs-string">'dbb%'</span></span>;</code> </pre> <br>  It will show which scripts make requests to central databases. <br><br><h3>  nginx + Pinba </h3><br>  But even this was not enough for us.  When a client sends us an HTTP request, the latter first gets into nginx and then proxied to PHP.  What happens if the PHP process at this point cannot accept and process the request?  For example, if the server is overloaded, or due to network problems, will nginx not be able to communicate with the php-fpm process?  The user in this case will see an error, and we in PHP will not know about it (though it will be in the nginx logs). <br><br>  In order to have an idea of ‚Äã‚Äãwhat answers (which HTTP statuses) we return to the client, Pinba developer <a href="http://habrahabr.ru/users/tony2001/">Anton Dovgal</a> made a <a href="http_pinba_module">module for nginx</a> .  The module for nginx works the same as the PHP module, but for obvious reasons it does not have timers.  The most useful reports he makes are <b><i>report_by_script_and_status</i></b> and <b><i>report_by_status</i></b> . <br><br><h3>  Plotting </h3><br>  Pinba stores data for the last few minutes.  This time can be changed in the <a href="http://pinba.org/wiki/Manual:Configuration">settings</a> .  But this is not enough if you want to monitor how the system performance changes over time.  To do this, you need to store the data of the Pinba reports (not necessarily all) for a long time and build graphs on them.  Thus, you can observe the dynamics of changes in the load on the system and on its individual scripts, as well as track how your PHP code loads databases, memcached and other data sources. <br><br>  Pinba does not know how to build graphs and store data for a long period.  To do this, use separate utilities.  You can configure Zabbix to monitor Pinba and build graphs for some of its values.  You can use a ring (cyclic) database type RRDtool or Graphite.  In our company we use RRDtool. <br><br>  RRDtool does not describe in two words.  He has many nuances of his own, and different people have different preferences in charting, so this topic is worthy of a separate article.  There are already enough manuals on the Internet that will help you to start working from scratch with this set of utilities. <br><br><h3>  results </h3><br>  What did Pinba give us?  Most of the performance problems began to be detected much faster than before its implementation.  If a script has become much more frequently requested by users, it can easily be found in Pinba.  If suddenly some of the services (MySQL, memcached, etc.) become slower to work, then with the right reports in Pinba, you can easily localize this service.  And if he began to "slow down" because of the high frequency of the request, then thanks to Pinba, it is sometimes possible to localize scripts, often requesting a specific problem service. <br><br>  It is very useful to watch Pinba charts after laying out a new version of the code on the server.  You can see how the load on the system has changed.  But for this it is important to think about what graphics will be built. <br><br>  However, you should not take Pinba as a replacement for full server monitoring.  We, for example, use Zabbix to monitor the consumption of CPU, memory, disks and network activity on all servers.  On the other hand, there is Pinba with graphs in the RRD.  Comparing the graphs from these two systems, you can easily calculate the ‚Äúcost‚Äù of a PHP request and estimate how many requests per second your servers can handle.  And this, in turn, allows you to plan whether new server purchases are needed in the near future or whether there is room for code optimization. <br><br>  Apart from the PHP module, Pinba is not tied to PHP and can be used to monitor systems written in other languages.  GitHub already has projects for using Pinba in Python and Ruby. <br><br>  <i>Maxim <a href="http://habrahabr.ru/users/max_m/" class="user_link">max_m</a> Matyukhin, developer</i> <i><br></i>  <i>Badoo company</i> <br><br><h3>  useful links </h3><br><ul><li>  <a href="http://pinba.org/">Official Pinba Project Page</a> </li><li>  <a href="https://groups.google.com/group/pinba-engine">Pinba Engine development list</a> - English-language Google-group for discussion Pinba </li><li> <a href="https://groups.google.com/group/pinba-engine-ru">Pinba Engine development list (in Russian)</a> ‚Äî  Google-   Pinba </li><li> <a href="http://habrahabr.ru/post/129042/">Pinba ‚Äî  php   </a> ‚Äî        Pinba </li><li> <a href="http://oss.oetiker.ch/rrdtool/">   RRDtool</a> </li><li> <a href="http://graphite.wikidot.com/start">   Graphite</a> </li><li> <a href="http://ru.wikipedia.org/wiki/%25D0%25A6%25D0%25B8%25D0%25BA%25D0%25BB%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25B0%25D1%258F_%25D0%25B1%25D0%25B0%25D0%25B7%25D0%25B0_%25D0%25B4%25D0%25B0%25D0%25BD%25D0%25BD%25D1%258B%25D1%2585">   ‚Äî wikipedia.org</a> </li><li> <a href="http_pinba_module">Nginx module for pinba</a> </li><li> <a href="https://github.com/IsCoolEntertainment/pynba">Python WSGI middleware for pinba</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/149695/">https://habr.com/ru/post/149695/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../149686/index.html">Forth processor on VHDL</a></li>
<li><a href="../149687/index.html">Create a Qt interface style using a table as an example.</a></li>
<li><a href="../149691/index.html">Pleasant trifle in the "Express Office" - comfortable keyboard</a></li>
<li><a href="../149693/index.html">KNN classifier</a></li>
<li><a href="../149694/index.html">RabbitMQ tutorial 1 - Hello World</a></li>
<li><a href="../149696/index.html">CERN - what is the organization for $ 900 million</a></li>
<li><a href="../149698/index.html">Radio 60-1700 MHz on RTL2832 for 20 bucks or SDR for beginners</a></li>
<li><a href="../149699/index.html">Ya.Subbotnik: BEM in the development of interfaces</a></li>
<li><a href="../149701/index.html">Multi-threaded file uploader on JS (jQuery)</a></li>
<li><a href="../149702/index.html">USB TV tuners on rtl2832 - or how to hear everything on the radio for 600 rubles</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>