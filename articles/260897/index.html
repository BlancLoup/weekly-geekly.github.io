<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Small joys of structured metadata</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A few days ago I helped with the integration project of Ultima Businessware and another accounting system. Among other things, I wanted to get a list ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Small joys of structured metadata</h1><div class="post__text post__text-html js-mediator-article">  A few days ago I helped with the integration project of <a href="http://www.ultimabusinessware.com/">Ultima Businessware</a> and another accounting system.  Among other things, I wanted to get a list of what should be synchronized in the system not only ‚Äúfrom the head‚Äù, but also in some objective way. <br>  What happened - under the cut. <br><a name="habracut"></a><br>  For a start - a little about structured metadata. <br>  I hope the reader has an understanding of the data model in <a href="http://www.ultimabusinessware.com/">Ultima Businessware</a> (otherwise why would all this read?).  If not, then refer to my previous posts and <a href="http://www.ultimabusinessware.com/architecture/">extracts from the documentation</a> on the platform website. <br><br>  Metadata is data consisting of information about the data structure.  Including themselves. <br>  By structured metadata, I mean normalized (at least until the second form) a table or view. <br><br>  So, we have directories that have fields, some of which may refer to other directories. <br>  We have totals, measurements of which refer to reference books. <br>  We have documents that consist of caps and tabular parts, which in turn consist of fields, some of which can be references to reference books. <br>  Additionally, the values ‚Äã‚Äãof the properties of reference books can have values ‚Äã‚Äãin several languages, the names of reference books, documents, and all other objects can (and have) meanings in several languages ‚Äã‚Äã(in the basic delivery in Russian and English). <br>  In addition, all configuration components are versioned.  As a result, the following structure is used to describe reference books and their links in the database: <br><img src="https://habrastorage.org/files/e53/feb/c8d/e53febc8dcb6435e88e6f98614d62883.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Fortunately, we took care of the nerves of the application developers and covered the implementation details with views. <br>  So at the presentation level, the diagram looks simpler. <br><img src="https://habrastorage.org/files/fc8/a2c/9ff/fc8a2c9ff2b64bf6affc1c1b459a0e6e.png"><br><br>  Well, similar structures are prepared for documents: <br><img src="https://habrastorage.org/files/0f4/c11/3b9/0f4c113b984a48e194086a133c86c8e2.png"><br><br>  And for the results: <br><img src="https://habrastorage.org/files/e64/07c/d1f/e6407cd1f37c405cb9601f46fedbdd24.png"><br>  I think the reader will forgive me the lowered details at the table level. <br><br><h4>  Why is this all? </h4><br>  Indeed, so what if everything is laid out.  Well, except for aesthetic pleasure, it greatly greatly simplifies the solution of many problems arising in real practice. <br><br>  Let's return to my problem about integration.  I need some kind of objective way of determining what I need to synchronize with the very system.  Under external conditions it is necessary to synchronize the totals that are included in the balance.  These are the totals that are marked as IS_DOUBLE_ENTRY (double entry is supported for it or not).  Accordingly, I have to synchronize the references to which the measurements of these totals refer.  To be precise, I had to make a list of what will be synchronized, then we had to discuss and shorten it. <br><br>  So, I easily and naturally sketched such a request (which directories are measurements of totals with titles in Russian and a list of names of totals in which they actually participate as dimensions: <br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> a.*, MT.CAPTION <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-string"><span class="hljs-string">"Dictl18nName"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> d.id <span class="hljs-string"><span class="hljs-string">"DictID"</span></span>, d.name <span class="hljs-string"><span class="hljs-string">"DictSysName"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">listagg</span></span>(mt.caption, <span class="hljs-string"><span class="hljs-string">','</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">within</span></span> <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> t.name) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-string"><span class="hljs-string">"DimensionOf"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> KERNEL.VTOTAL_DIMENSIONS td <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> KERNEL.VTOTALS t <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> t.id=TD.TOTAL_OBJ_ID <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> KERNEL.VDICTIONARIES d <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> d.id=TD.REF_DICT_OBJ_ID <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> KERNEL.VMETADATA_TRANSLATIONS mt <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> MT.LANG_ID=<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> MT.REF_OBJ_ID=t.id <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T.IS_DOUBLE_ENTRY = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> t.id <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> MO.REF_OBJ_ID <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> KERNEL.VMETADATA_TAGS_TO_OBJECTS mo <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> MO.TAG_VALUE=<span class="hljs-string"><span class="hljs-string">'warranty'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> d.id, d.name ) a <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> KERNEL.VMETADATA_TRANSLATIONS mt <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> MT.LANG_ID=<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> MT.REF_OBJ_ID=a.id</code> </pre> <br><br>  I did not download the diagrams above with unnecessary details, so I will explain - the table METADATA_TRANSLATIONS contains translations of the names of the properties and the objects themselves.  Well, in addition, I dropped the objects that relate to the guarantee (I knew this in advance). <br><br>  These are the little joys. <br>  What else did I do using queries?  I counted the lines in the code. <br>  I found all the directories in which there is a given field. <br>  Found references that are not referenced by any document. <br>  Or here is a frequently occurring situation - ‚Äúwhy this table?‚Äù <br><br>  Yes it is easy, there is no need for it, if it is not described in the configuration.  if necessary - describe in the configuration, along with comments, why it is.  And in general, let's find all such tablets that the developers have spawned for some of their work: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> all_tables <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> owner=<span class="hljs-string"><span class="hljs-string">'ULTIMA'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> table_name <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> TABLE_NAME <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> KERNEL.VDICTIONARIES <span class="hljs-keyword"><span class="hljs-keyword">union</span></span> all <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> TABLE_NAME <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> KERNEL.VDOC_TYPES <span class="hljs-keyword"><span class="hljs-keyword">union</span></span> all <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> TABLE_NAME <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> KERNEL.VTABLE_PART_TYPES <span class="hljs-keyword"><span class="hljs-keyword">union</span></span> all <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> TABLE_NAME <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> KERNEL.VLINK_TABLES ) <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> table_name</code> </pre><br><br>  Another example of dealing with garbage in the configuration is to find and mercilessly remove commands on directories that have not been used since the new year: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> dc.id, dc.caption <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> KERNEL.VDICT_COMMANDS dc <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> DC.SCRIPT_OBJ_ID <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> script_obj_id <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kernel.stat_command_events e <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> E.START_DT &gt;= trunc(<span class="hljs-keyword"><span class="hljs-keyword">sysdate</span></span>, <span class="hljs-string"><span class="hljs-string">'YYYY'</span></span>) )</code> </pre><br><br>  Incredibly useful thing, greatly simplifies life. <br><br>  I hope it is clear that having structured metadata and the SQL language as an analysis tool you can do some very interesting things.  Try to figure out for yourself what you could do with such a tool at hand! </div><p>Source: <a href="https://habr.com/ru/post/260897/">https://habr.com/ru/post/260897/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../260881/index.html">First-aid kit sysadmin. Minimal set of utilities for the most effective problem solving</a></li>
<li><a href="../260889/index.html">Microsoft cloud services popularity rating in 2015</a></li>
<li><a href="../260891/index.html">Copy dallas keys. Record on rw1990 (rw1990.1)</a></li>
<li><a href="../260893/index.html">Streets and Heroes</a></li>
<li><a href="../260895/index.html">How I painted the design of the application for the contest Mail.Ru Group</a></li>
<li><a href="../260899/index.html">Introduction to the magic of patterns</a></li>
<li><a href="../260903/index.html">Snowden: NSA is spying on foreign antivirus companies</a></li>
<li><a href="../260907/index.html">Google implements proprietary code in free (?) Chromium</a></li>
<li><a href="../260911/index.html">Development of MMO RPG - a practical guide. Server (Part 2)</a></li>
<li><a href="../260913/index.html">PentestBox - portable assembly of popular security utilities</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>