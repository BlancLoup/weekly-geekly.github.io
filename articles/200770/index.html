<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Open Open XML Excel Format Files in JavaScript</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In order to upload information about retail outlets to our logistic SaaS-service ‚ÄúForward Logistics‚Äù from Excel, I decided to use a web browser. It is...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Open Open XML Excel Format Files in JavaScript</h1><div class="post__text post__text-html js-mediator-article">  In order to upload information about retail outlets to our logistic SaaS-service ‚ÄúForward Logistics‚Äù from Excel, I decided to use a web browser.  It is usually easier to upload a file to the server and use any library to upload it to the database.  But I was interested in downloading it line by line to monitor the integrity of each line on the client, and, of course, try out the advertised HTML5 FileAPI and Drag and Drop. <br><a name="habracut"></a><br>  The Excel book is a ZIP archive with directories and XML files in <a href="http://msdn.microsoft.com/ru-ru/office/ee358824.aspx">Open XML format</a> .  Parsing XML is excellent at jQuery, but not zipper.  To do this, the zip.js library was found in the open spaces of the network, which coped perfectly with the task. <br><br>  So, let's try to see what is inside the archive: <br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"main"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">progress</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"progress"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">progress</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"filedrag"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"comps"</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"red"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"result"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"comps"</span></span>), FileDragHover = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ e.stopPropagation(); e.preventDefault(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(e.target.id===<span class="hljs-string"><span class="hljs-string">'comps'</span></span>) e.target.className = (e.type == <span class="hljs-string"><span class="hljs-string">"dragover"</span></span> ? <span class="hljs-string"><span class="hljs-string">"filedrag hover"</span></span> : <span class="hljs-string"><span class="hljs-string">"filedrag"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> c.className = (e.type == <span class="hljs-string"><span class="hljs-string">"dragover"</span></span> ? <span class="hljs-string"><span class="hljs-string">"filedrag hover"</span></span> : <span class="hljs-string"><span class="hljs-string">"filedrag"</span></span>); } c.addEventListener(<span class="hljs-string"><span class="hljs-string">"drop"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">)</span></span>{ e.preventDefault(); c.className = <span class="hljs-string"><span class="hljs-string">"filedrag"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> files = e.target.files || e.dataTransfer.files; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>, f; f = files[i]; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(f.name.toLowerCase().indexOf(<span class="hljs-string"><span class="hljs-string">'xlsx'</span></span>)&lt;=<span class="hljs-number"><span class="hljs-number">0</span></span>) { alert(<span class="hljs-string"><span class="hljs-string">'   Excel'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { zip.createReader(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> zip.BlobReader(f), <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">reader</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     reader.getEntries(function(entries) { //       Excel console.info(entries) return false; }); }, function(error) { alert(": " + error) }); } } return false; }, false); c.addEventListener("dragover", FileDragHover, false); c.addEventListener("dragleave", FileDragHover, false);</span></span></code> </pre><br><br>  The result can be found <a href="http://jsfiddle.net/ant_logist/zG6GT/">here</a> .  Download the sample file and drag it onto the form. <br>  A list of all the files in the Excel workbook appears in the console.  Among the properties of objects appearing in the console, there is a filename, and by that we will look for the XML files we need. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We need two files from the archive: <br><ul><li>  import.xlsx \ xl \ worksheets \ sheet [N] .xlsx </li><li>  import.xlsx \ xl \ sharedStrings.xml </li></ul><br>  Where: <br>  sheet [N] .xlsx is the Excel sheet itself, N is its internal number in the book. <br>  sharedStrings.xml - associative array of strings, dictionary sheet. <br><br>  Filter only the files we need: <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     reader.getEntries(function(entries) { var a=[],st; for(var i in entries){ var e=entries[i]; var fn=e.filename.toLowerCase(); if(fn.indexOf("sheet")&gt;0){ a.push(e); } else if(fn.indexOf("sharedstring")&gt;0){ st=e; } } //     Excel console.info(a) //    console.info(st) return false; });</span></span></code> </pre><br><br>  The result can be viewed <a href="http://jsfiddle.net/ant_logist/Y8dz5/">here</a> by uploading the file and looking at the console. <br><br>  Next, we need to extract the data with simple selectors, for the dictionary of rows this is <i>st t</i> , for records of the table with the data on the sheet it is <i>sheetdata row</i> . <br><br>  Add a function to display data from an Excel sheet: <br><pre> <code class="javascript hljs">printExcelData = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">sheets, strings</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> unzipProgress = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"progress"</span></span>); unzipProgress.style.display=<span class="hljs-string"><span class="hljs-string">'block'</span></span>; strings.getData(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> zip.TextWriter(), <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//          var i,st=$($.parseXML(decodeURIComponent(escape(text)))).find('si t'); for(i=0;i&lt;st.length;++i) st[i]=$(st[i]).text(); //      var parseSheet=function(sheet){ var j,i,h,sh,d=[],s; sheet.getData(new zip.TextWriter(), function(text) { //      sh=$($.parseXML(decodeURIComponent(escape(text)))).find('sheetdata row'); //     sh.each(function(e){ var c=$(this).find('c'),ci,v,o={}; for(i=0;i&lt;c.length;++i){ ci=$(c[i]); v=ci.find('v').text(); if(ci.attr('t')) v=st[v]; j=ci.attr('r').charCodeAt(0)-65; if(h) o[h[j]]=v; else o[j]=v; } if(h){ d.push(o) } else h=o; }); var id_name=""; for(i in h) if(h[i]=='Comp_Id'){ id_name=h[i]; break; } //   Comp_Id   ,    if(id_name=='Comp_Id') { unzipProgress.style.display='none'; //     s=""; for(i=0;i&lt;Object.keys(h).length;i++) s+='&lt;th&gt;'+h[i]+'&lt;/th&gt;'; $('.result thead tr').append(s) //   s=""; for(j=0; j&lt;d.length; j++){ s+='&lt;tr&gt;'; for(i=0; i&lt;Object.keys(h).length; i++){ s+='&lt;td&gt;'+d[j][h[i]].toString()+'&lt;/td&gt;'; } s+='&lt;/tr&gt;'; } $('.result tbody').append(s) sheets=[]; return; } if(sheets.length&gt;0) parseSheet(sheets.pop()); }, function(current, total) { unzipProgress.value = current; unzipProgress.max = total; }); } parseSheet(sheets.pop()); }, function(current, total) { unzipProgress.value = current; unzipProgress.max = total; }); }</span></span></code> </pre><br><br>  As Chrome considers it a crime to use the HTML File API in a cross-domain ( <b>uncaught</b> ), the last example was uploaded to a <a href="http://www.ant-logistics.com.ua/excel_demo.html">Web server</a> . <br>  Drag the file and get the standard HTML table. <br><br>  PS <br>  Yes, now, as it turned out, there is the <a href="http://openxmlsdkjs.codeplex.com/">Open XML SDK for JavaScript</a> , but this is a topic for a separate article ... </div><p>Source: <a href="https://habr.com/ru/post/200770/">https://habr.com/ru/post/200770/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../200756/index.html">"Visualization Kung Fu" at 404</a></li>
<li><a href="../200758/index.html">Tower of Hanoi on the fingers</a></li>
<li><a href="../200760/index.html">Microsoft Sculpt Ergo Subjective Review</a></li>
<li><a href="../200762/index.html">GameDev, igroprom, game development, education and faith in the future</a></li>
<li><a href="../200764/index.html">Video lecture about Bitcoin</a></li>
<li><a href="../200774/index.html">A universal way to create packages for various distributions of GNU Linux</a></li>
<li><a href="../200776/index.html">About my development experience for Android or training on Tic-Tac-Toe</a></li>
<li><a href="../200778/index.html">BlackBerry sale canceled</a></li>
<li><a href="../200780/index.html">Windows Azure and Hadoop: ‚Äúfriendship‚Äù, ready for Enterprise</a></li>
<li><a href="../200782/index.html">Amazon celebrates FAA with the sale of Kindle tablets</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>