<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to accept credit card payments - Badoo experience</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Every year more and more new payment methods appear in the world. But there is still no universal, convenient for all users method. In 2008, when we w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to accept credit card payments - Badoo experience</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/d32/d50/67a/d32d5067ad45475e9045c83beca3b5ef.jpeg" align="left">  Every year more and more new payment methods appear in the world.  But there is still no universal, convenient for all users method.  In 2008, when we were just creating a billing system for Badoo, it seemed to us that the future was in payment through SMS.  But, faced with the realities of different countries, we realized that this is not so. <br><br>  User preferences vary depending on the country and the device from which they access the site.  Very close to the ideal were bank cards whose popularity is growing from year to year, including in <a href="http://habrahabr.ru/post/177781/">Russia</a> .  This is not only one of the most common payment methods, but also the most profitable of all available on the Badoo site, and there are more than 20 of them. <br><br>  Today we will talk in more detail about what remained beyond the framework of the previous <a href="http://habrahabr.ru/company/badoo/blog/194850/">article about billing</a> : about processing payments using bank cards;  what you need to know and what to prepare for if you are just going to connect them;  how to increase their effectiveness if you already have them.  In general, the article is intended for unprepared readers, but specialists may also find something interesting for themselves. <br><a name="habracut"></a><br>  It all started with the fact that four years ago we placed on our website a form for entering credit card details and started accepting payments.  After a few months, it became clear that users are happy to pay for our services not only via SMS, but also with cards, the volume of payments for which showed promising growth.  We began to actively develop this area.  Since then, we have reviewed a dozen payment gateways offering acquiring services (i.e., accepting payments by bank cards), and now we are simultaneously working with three of them.  We did support payments with 3D Secure, set up a system that detects fraudulent transactions, and much more. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Why is it difficult to accept payment with plastic cards? </h4><br><div style="text-align:center;"><img src="https://habrastorage.org/files/b7d/242/0f9/b7d2420f9729478f8f794cc70e1d3c0b.png"></div><br>  It would seem that there is difficult?  One simple form in which the user enters their card details and presses the pay button.  We process the request, send it to the bank - and that‚Äôs all, soon the money will be in our account.  In an ideal world, this is what happens, but in the real world it is a little different. <br><br>  If you want to accept payments by credit card, then first of all you must ensure the safety of user data.  For this, large payment systems, such as Visa, Master Card, American Express, Diners, and others, have developed a security standard for the payment card industry - <a href="http://ru.wikipedia.org/wiki/PCI_DSS">PCI DSS</a> (Payment Card Industry Data Security Standard).  This is a large list of requirements that the company must meet, as well as the application development process and the configuration of the equipment used. <br><br>  The second problem is protection against fraudulent transactions, in other words, ‚Äúfraud‚Äù ( <i>from English</i> fraud).  After all, the site can be used not only by respectable users, but also by fraudsters who use stolen credit card data when shopping.  After such a purchase, the cardholder will receive an extract with transactions that he does not understand, will go to the bank and demand a refund.  After some time, the money will be returned to him, and the company will receive a minus in karma and a fine from the payment system. <br><br>  And last but not least, this is the proportion of successful transactions.  Even if there is enough money on the card and all the systems involved in making a payment, work like a clock, the bank that issued the card may simply reject the transaction if it doesn‚Äôt like something or seems suspicious. <br><br><h4>  Why get certified PCI DSS? </h4><br>  The main purpose of certification is to make sure that card data is stored securely, that an attacker will not be able to penetrate your system, and, once penetrated, will not be able to easily obtain private information.  All companies that process credit card data are required to pass it, even if the data is not stored during the processing. <br><br>  At the beginning, certification was perceived by us as a formality, because we did not keep credit card details.  Our application was engaged only in drawing a beautiful form suitable for the site design.  But gradually it developed, overgrown with business logic and "anti-fraud" checks.  We began to store personal user data and authorized information about their credit cards.  As a result, we ourselves became interested in ensuring that our system was as secure as possible.  Now, PCI DSS is perceived not as a formality, but as an opportunity, albeit somewhat bureaucratic, to test oneself for strength. <br><br>  Confirmation of compliance with the standard is necessary annually.  Requirements depend on the level assigned to the company.  There are only four of them, and they are issued depending on the number of transactions processed per year.  Recently, Badoo was assigned the first level, which is the highest and safest.  It has the most stringent certification requirements, for their confirmation you need to undergo an external audit.  For lower levels, filling out a self-assessment sheet or performing an internal audit is sufficient.  A complete list of requirements can be found in the <a href="http://pcidss.ru/files/pub/pdf/1_PCI_DSS_v3.pdf">standard</a> itself.  We will talk about what can simplify the process of passing certification for any of the levels. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/806/e8b/c76/806e8bc765414131ae33dbb5d61d5a7e.png"></div><br><br>  First you need to remember that the card number (PAN) and the security code located on the back of the card (CVC) are not allowed to be stored anywhere.  There is nothing wrong with that, since this is not required for normal operation of the application.  Upon receiving a request from the user, the data is immediately sent to the aggregator and can only be stored in RAM, which is allowed by the standard.  Only the first six and last four digits of the card number, the name of the card holder and the expiration date of the card can be stored in the permanent storage.  At high levels, the standard still allows you to store the card number, but it must be encrypted with a robust algorithm or an irreversible hash function. <br><br>  The next important thing is to reduce the area that is subject to certification.  If payment processing is not a direct business of a company, then there is not much point in extending strict PCI DSS security rules to the entire infrastructure.  It is enough to allocate to the application that processes the maps, separate servers and a repository with a code that only a limited number of people will have access to.  In addition to the formal reduction of the scope of work, this will give additional security to the entire system.  Its components will be weakly connected, therefore, hacking the main application, the attacker will not be able to access the data of credit cards. <br>  The only way to avoid certification is not to process the data of plastic cards yourself.  For example, the easiest and most common way is to send a user to the payment gateway page.  After payment, he will return to the site, and you will receive a notification about the status of payment.  For those who still want to have their own payment form, which would organically fit into the design of the site, there is a more difficult option.  Card data can be encrypted in the browser using a public key and sent to the form directly to the payment gateway, which will decrypt it with the private key and process the payment. <br><br><h4>  What is dangerous fraud and how to reduce it? </h4><br>  Fraud is a type of card data fraud aimed at illegally using money from her account.  The danger here lies not only for the user, but also for you as a seller.  The user may request from the bank to return their funds, and you not only do not receive money for your product or service, but also pay a penalty for each such request, even if it is then successfully challenged.  In addition, Visa, Master Card and other payment systems may impose additional penalties for a high level of returns.  If the fine for a normal return, as a rule, does not exceed $ 10, then a fine for a large amount can easily amount to hundreds of thousands of dollars. <br><br>  Here it is important to understand that there are two types of returns: ‚Äúrefand‚Äù ( <i>from the English</i> refund) and ‚Äúchargeback‚Äù ( <i>from the English.</i> Chargeback).  The difference is that you do the refand yourself when the user contacts you, and chargeback forces you to make the payment system.  Therefore, fines and all sorts of sanctions are imposed only with chargebacks. <br>  There are many ways to fight fraud.  The easiest and most effective is 3D Secure.  In fact, this is just an extra step when paying, in which the user must confirm that the payment is made by the cardholder (see the picture below). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/72b/a63/0fa/72ba630fa2f14973951d95edffa717a4.png"></div><br><br>  In addition to increasing security, conducting a transaction with 3D Secure shifts the responsibility for fraud on it to the shoulders of the bank that issued the card.  This is because the confirmation step is completely under its control, and the transaction should not go through if the bank had any suspicions.  But, despite all the advantages, this method of verification has one fatal flaw.  Like any additional step, it is very bad for the share of successful payments.  To verify this, we conducted a series of experiments in different countries, the results of which are shown in the graph below. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/81f/b7d/cd2/81fb7dcd2b664f3f913afe2387f405dd.png"></div><br><br>  Three arrows on the graph show the moment when we turned off the forced use of 3D Secure in the country.  For example, in Russia, 3D Secure was initially enabled.  After its disconnection, the share of successful payments increased by 20%.  In Italy, on the contrary, we turned it on and saw a drop in the share of successful transactions by 10-15%.  And only in Britain, user behavior has not changed. <br><br>  We also conducted similar experiments in the United States, where after enabling 3D Secure, users almost stopped paying, and in South African countries, which are traditionally considered a fraud stronghold, but where disabling 3D Secure had a positive effect. <br><br>  Looking at the results, we decided to abandon the forced inclusion of 3D Secure for all transactions.  But to keep chargebacks at a low level, it was necessary to develop a system that could detect fraudulent transactions and block them.  To begin with, we decided to create portraits of users who most often are sources of fraud on our website. <br><br>  It turned out three groups: <br><ul><li>  <b>carders.</b>  These are specialists in stealing bank card data.  They check the performance of their base and often use bots; </li><li>  <b>spammers.</b>  They buy stolen card data and make their profile popular.  Then they advertise or solicit money from users (for example, to treat a serious illness); </li><li>  <b>unsatisfied users.</b>  These are people who used paid services, but they didn‚Äôt like something, or they just forgot that they paid on our site, or just want to get services for free. </li></ul><br><br>  To make the life of such people more difficult, we began to analyze their behavior on the site and draw up rules for our anti-fraud system ( <i>from the English</i> anti-fraud).  They are based on various transaction parameters, of which there are about 20, for example: the amount of payment, the user's IP and country of issuing the card, the number of cards used by this user, the number of transactions, etc. Each rule that has been triggered adds fraud points to the transaction.  After a certain level is exceeded, it is considered suspicious, and we send it for an additional check via 3D Secure or simply block it. <br><br>  If the fraudster managed to get through our entire defense and we received information about chargeback, then we can try to challenge him.  In this case, we still pay a fine, but if we win the dispute, then at least we will not lose the amount of the payment itself. <br><br>  Particularly advanced aggregators can provide ‚Äúinsider‚Äù information about chargebacks received by the bank, which have not yet reached the payment system.  We use such messages for proactive anti-fraud protection.  They are registered in our system, and we are trying to make a refand for these transactions.  In this case, we still return the money to the user, but since we are doing this voluntarily, no additional sanctions and penalties are imposed on us.  The total effect of such measures is not very large - you can save only a few percent of income.  But for Badoo, it's hundreds of thousands of dollars a year, which pays for all the costs. <br><br><h4>  Why not all payments are successful? </h4><br>  On the way from the buyer to the bank that issued the card, the withdrawal request passes through many systems.  In addition to the seller, participate in the process: <br><ul><li>  payment gateway or aggregator, which can provide other payment methods; </li><li>  acquiring bank - a bank that is connected to various payment systems and provides payment processing services only by plastic cards; </li><li>  payment systems (Visa, Master Card, etc.); </li><li>  issuing bank - the bank that issued the card with which the user is trying to pay for the service. </li><li>  Each stage of the transaction contains its own points, which may affect its success. </li></ul><br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/0a1/188/681/0a1188681b294d86a0f93d4971400c74.png"></div><br><br><h5>  User - Site </h5><br>  At this stage, the code is under our control, and if there are any problems, we can fix them.  Here the most annoying type of error is the logical error of validation of the entered data.  If, when checking the cardholder's name, it is obvious that it can be long or very short, with numbers, hyphens and anything that seemed appropriate to parents, then when checking the card number you need to be careful and know what it can and should be.  For example, its length can be from 13 to 19 (depending on the type of card), and not just 16 digits, as many people think.  It is also advisable to check not only the length, but the whole number, using the <a href="http://en.wikipedia.org/wiki/Luhn_algorithm">Luhn algorithm</a> .  When checking the expiration date of the card, you must remember that it is valid until the last day of the specified month, and not before it starts. <br><br><h5>  Website - Payment Gateway - Acquiring Bank - IPS - Issuing Bank </h5><br>  The success of a transaction at this stage may depend on the frequency of payments and their amount, the country from which they come;  card type and much more.  Unfortunately, we cannot influence this in any way, therefore at these stages the percentage of failures is very high due to the false positives of the anti-fraud systems of one of the participants in the process.  But we managed to find two parameters that we can control and which strongly influence the share of successful payments.  This is using the local processing center and the correct MCC. <br><br>  <a href="https://ru.wikipedia.org/wiki/Merchant_Category_Code">MCC</a> ( <i>from the English. Merchant Category Code,</i> literally - the seller‚Äôs category code) is issued to anyone who wants to accept card payments.  He has any site and even a store around the corner.  It is used in Internet banks, which give statistics on your expenses broken down into categories, in various promotions, for example, when the bank returns some of your money when you buy groceries or cat food.  But the most interesting thing for us is that he participates in the bank antifraud algorithms. <br><br>  Initially, we had the code 7273 Dating and Escort Services, and the proportion of successful payments at the same time was about 50%.  And if ‚Äúdating‚Äù can somehow be attributed to Badoo, then escort services are definitely not about us.  Deciding that this is not correct, we went to our partners and began to insist that we need another, more suitable code.  Finally, our attempts were crowned with success, and in one of the countries we received the code 4814 - Telecoms (telecommunication services).  As a result, the share of successful payments increased by 30%.  We did not intend to stop at our achievements and continued to search for what other MCC we can use.  They turned out to be 8641 - Social, Civic and Fraternity services "(social services), which increased the share of successful payments by another 10%. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/116/1f1/94f/1161f194faf54062a831f7f01dba9a03.png"></div><br><br>  Having chosen the code suitable for us, we were still not satisfied with the performance of some countries.  For example, in France, the share of successful payments did not want to rise above 50-60%.  The reason was that the national payment system Carte Bleue is very popular there.  To accept their cards, the processing center used (acquiring bank) must be connected to it.  As a rule, suitable banks are located in the same country where you need to improve performance.  This gives an additional bonus in the form of a decrease in the suspiciousness of a transaction for antifrod systems of issuing banks in this country and entails an increase in the share of successful payments. <br><br>  After we began to use local processing connected to Carte Bleue, we received a 30% increase in the share of successful payments in France.  In the USA, where there are no local payment systems, this method gave a slightly smaller increase - about 20%. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/5dd/33d/9fe/5dd33d9fec354bbd9a069ad31e1b8bd6.png"></div><br><br>  Outside the article was a story about the platform we developed, which allowed us to carry out all the above experiments easily and without additional programming.  If you have a desire to read about it, then write in the comments, and we will prepare a separate article.  Perhaps you have your own interesting experience in the payment card industry - welcome to the comments, it will be very interesting for us to talk on this topic. <br><br>  Anatoly Panov <br>  Lead Developer </div><p>Source: <a href="https://habr.com/ru/post/234677/">https://habr.com/ru/post/234677/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../234657/index.html">Looking for black holes and supernovae with the Black Holes web app.</a></li>
<li><a href="../234659/index.html">EU has banned some e-commerce tricks</a></li>
<li><a href="../234661/index.html">BitTorrent Sync 1.4 Released</a></li>
<li><a href="../234663/index.html">How I shamefully deactivated the botnet</a></li>
<li><a href="../234673/index.html">tSqlt - unit testing in Sql Server</a></li>
<li><a href="../234679/index.html">We connect Arduino to the electric power meter</a></li>
<li><a href="../234681/index.html">Cisco Systems has released mobile network exams</a></li>
<li><a href="../234683/index.html">Hyperlapse: shooting accelerated video with image stabilization on a smartphone</a></li>
<li><a href="../234685/index.html">SSH access to Infobox Jelastic 2 cloud hosting</a></li>
<li><a href="../234687/index.html">Modern production management methodologies</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>