<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We organize Asterisk IP telephony in the office without learning Linux</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I will tell you in steps about IP telephony organization in an office for 15 people using Asterisk in the form of an Askozia assembly,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We organize Asterisk IP telephony in the office without learning Linux</h1><div class="post__text post__text-html js-mediator-article">  In this article I will tell you in steps about IP telephony organization in an office for 15 people using Asterisk in the form of an Askozia assembly, Intel NUC nettop and Linksys and Yealink phones ordered from Ebay, as well as estimate the costs of organizing communication with your telephony server plus I will try to talk about the advantages and disadvantages of this solution. <a name="habracut"></a><br><br><h4>  Iron </h4><br>  System requirements for hardware from Asterisk minimum.  In principle, any modern platform will be suitable for our task.  As such a system, I chose the <a href="http://www.intel.ru/content/www/ru/ru/motherboards/desktop-motherboards/desktop-kit-dccp847dye.html">Intel NUC DCCP847DYE</a> with a Celeron processor and 2 gb memory.  The internal SSD drive did not take. <br><img src="https://habrastorage.org/storage3/4d3/c87/a20/4d3c87a20d09d06d326ef52b3f2c9425.png"><br>  For phones, I turned to Ebay auction, using the query <i>"lot linksys spa"</i> we get the following offers: <img src="https://habrastorage.org/storage3/4a4/34d/50a/4a434d50a5536f5c77cd74aff1578738.png"><br>  Using a sniper for ebay, mail forwarder and parcels with clothes, I brought a total of about 15 Lynksys, Cisco, Yealink (Cortelco) phones to my office in a few months.  On average, 1 phone cost 2300 rubles.  I tried to take older models with two ethernet ports, screen backlighting and POE.  Well, for Sales managers and technical support specialists took on the same Ebay 6 <a href="http://www.plantronics.com/us/product/mx500i">Plantronics MX500i headsets</a> <img src="https://habrastorage.org/storage3/8d9/16d/e6e/8d916de6ea31a82fbe8609122556b7e7.png"><br>  Rather convenient thing and quality of communication acceptable for our requirements.  We even conduct webinars through it :) <br><br><h4>  Soft </h4><br>  At the time of the organization of IP telephony, I knew little about Asterisk and practically didn‚Äôt fumble in Linux, so I chose a ready-made ‚ÄúAsterisk distribution kit on a flash drive‚Äù - <a href="http://www.askozia.ru/">Askozia</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Multichannel number </h4><br>  As the main supplier, IP traffic was chosen, which was used earlier for several years, by the provider <a href="http://www.mango-office.ru/products/mnogokanalnyiy_nomer">Mango Telecom</a> . For outgoing, <a href="http://zadarma.ru/ru/">Multifon</a> , <a href="http://www.pctel.ru/">Zadarma</a> , <a href="http://zadarma.ru/ru/">PCTEL</a> were <a href="http://www.pctel.ru/">added</a> .  Each of them has its advantages when calling in certain directions. <br><br><h4>  Installation and Setup </h4><br>  The phones were simply placed between the computers and the local network, the headsets were plugged into the phones, although they were connected to USB audio, which were useful for conducting webinars via a computer later :) <br>  <i>I will try to tell you about the IP PBX setting in detail, using the installation from scratch, so as not to miss anything important.</i>  <i>To do this, I will start everything from the very beginning on the demo system and gradually bring its settings to the state of our workstation.</i> <br>  The image of an IP PBX in a couple of minutes was uploaded to the USB flash drive <a href="http://wiki.askozia.ru/handbook:setup">according to the instructions</a> and plugged into the Intel NUC, in which I chose to boot from USB.  The network has a DHCP server, because Askozia immediately received an address, which I replaced with a static one. <img src="https://habrastorage.org/storage3/292/3b8/28e/2923b828ea919fb66b4896824b811eae.png"><br>  Actually, the work in the console is completed on this, and you can go to the web interface at the ip address displayed in the console. <img src="https://habrastorage.org/storage3/69c/bbf/1e3/69cbbf1e36e1cde3ca1e95085ca1d73f.png"><br>  When we first log in, we log in using the default credentials of <b>admin / askozia</b> , go to the licenses tab and enter the keys received for the purchase. <img src="https://habrastorage.org/storage3/b5b/259/da9/b5b259da974d8710818fe45d327d85b7.png"><br>  I have 2 keys, because  we use an extended version of Askozia with a route editor.  Enter them one by one, saving each key. In the general settings, change the password, set the Russian language. <br><img src="https://habrastorage.org/storage3/58a/881/556/58a88155683ddeefe9c0287c82e48f88.png"><img src="https://habrastorage.org/storage3/22d/c3f/ec8/22dc3fec8f605e0eb902cc0e9ca9749c.png"><br>  Next, in the settings, we connect an external drive for storing logs, voice mail and call history. <br><img src="https://habrastorage.org/storage3/734/765/6a5/7347656a5924acd85019c5c11ffc76b0.png"><br>  The disk is formatted in FAT, and it can be easily connected to any Windows machine to drop conversations. <br><img src="https://habrastorage.org/storage3/3f1/8e5/79a/3f18e579a6849d65174460501ce58612.png"><br><h5>  Setting up IP phones and SIP uchetok </h5><br>  Next, go to the configuration of IP phones.  In Askozia there is a mechanism for automatically searching and configuring IP phones, there is a TFTP server for firmware and configuration files.  Phones before auto-tuning must be reset to factory settings, after which they will be available in the Askozia interface.  Of course, you can configure everything manually, to do this, you will need to register a host, login and password in each phone via the web interface. <img src="https://habrastorage.org/storage3/8c6/13e/8b3/8c613e8b39dca74683dfe138691a698d.png"><br>  And the same thing on the phone <br><img src="https://habrastorage.org/storage3/81d/2d8/7c5/81d2d87c506e88477e159cd41b7a4233.png"><br>  Add accounting for each employee <br><img src="https://habrastorage.org/storage3/fe3/b5f/aa4/fe3b5faa49ab0221989e86045f2b718f.png"><br><h5>  Provider setting </h5><br>  Next, we proceed to setting up the provider, for which we go to the Settings-Employees menu item in the personal account and add the Askozia employee, for whom we add a new SIP number in the settings. <img src="https://habrastorage.org/storage3/783/610/bde/783610bdebe6c7de4687ccdbbcc24090.png"><br>  As a result, we have the following data: <ul><li>  Login: AskoziaUser123456789 </li><li>  Password: 6Ir2034 + 9098789987 </li><li>  Host: mikru.mangosip.ru </li><li>  Phone number: +7 (495) 202-02-02 </li></ul>  Open in Askozia the menu item Accounts -&gt; Providers and add new VoIP provider MangoOffice: <br><img src="https://habrastorage.org/storage3/252/bf2/983/252bf29835b2d580aa6a5385a6ba7b60.png"><br>  Set up a template for outgoing calls, in fact, we need only 2 countries. <br><img src="https://habrastorage.org/storage3/7e0/27b/f9d/7e027bf9da73c87c1b43bf2cee52fa32.png"><br>  In codecs, only alaw is allowed. <br><img src="https://habrastorage.org/storage3/ba4/361/7cf/ba43617cfca24f67264e9c039c6a1570.png"><br>  And we configure additional trunk parameters as follows.  These parameters are given by Mango in his documentation for connecting to Asterisk. <br><img src="https://habrastorage.org/storage3/c7d/d05/e6c/c7dd05e6c49ae54657f69ba51474e4de.png"><br>  After that, you can check the work of outgoing calls by dialing the number from any internal phone number in the format 7 (XXX) XXX-XX-XX <br>  In order to make incoming calls, you need to allow them in the properties of the trunk.  For example, we want all incoming calls to come to the internal number 0000002. <br><img src="https://habrastorage.org/storage3/3d9/ee2/30a/3d9ee230a091508b43535199e3fdedab.png"><br>  And in Mango Office‚Äôs personal account, we set up forwarding of all calls to our Askozia user. <br><img src="https://habrastorage.org/storage3/5b3/ba3/1cc/5b3ba31cc8c06edfe1d32f40dd2334e9.png"><br>  As an incoming 000002, we use the call route in the form of a voice menu ( <i>you called MIKO, to contact the sales department, press 1 ..., etc.</i> ) How to make voice menus, I described in the <a href="http://habrahabr.ru/post/165971/">last post</a> . <h5>  Call recording </h5>  In Askozia, by default, there is only a recording of calls on demand, during a call, press * 1 and the recording begins, and at the end of the conversation, it is sent by email.  But it‚Äôs not for nothing that we got a large external screw out of the cabinet and connected it to Askozia. Let us solve the problem of recording all external conversations totally.  Add a dialplan command to the provider settings. <br><div class="spoiler">  <b class="spoiler_title">Embed code Incoming conversation</b> <div class="spoiler_text"><pre><code class="php hljs">Set(RecFile=${STRFTIME(${EPOCH},,%Y-%m/%d)}/in_${CDR(src)}_${STRFTIME(${EPOCH},,%Y-%m-%d-%H-%M-%S)}) Set(CDR(userfield)=${RecFile}.gsm) Monitor(gsm,${RecFile},bm)</code> </pre> </div></div><div class="spoiler">  <b class="spoiler_title">Embed code Outgoing conversation</b> <div class="spoiler_text"><pre> <code class="php hljs">Set(RecFile=${STRFTIME(${EPOCH},,%Y-%m/%d)}/out_${CDR(dst)}_${STRFTIME(${EPOCH},,%Y-%m-%d-%H-%M-%S)}) Set(CDR(userfield)=${RecFile}.gsm) Monitor(gsm,${RecFile},bm)</code> </pre></div></div><br>  Open the settings of the provider Mango Office, and set the parameters in the appropriate fields on the <b>Additional</b> tab: <br><img src="https://habrastorage.org/storage3/93f/0fa/b0d/93f0fab0df099a81f20e7b8a97d3eaf2.png"><br>  As a result, we get a record of all external conversations structured by daddies, where the file name will contain the date, time and destination number of the subscriber. <br><br><h5>  Mobile Setup </h5><br>  To construct call routes, voice menus and departments, it is necessary to have employees' mobile phone numbers inside the PBX.  To do this, we create them in the <b>external accounting</b> section, register the number and select the provider through which the call will go. <img src="https://habrastorage.org/storage3/b70/074/24a/b7007424ab14e60442df098741fc4ad8.png"><br>  You can also make an external number using a SIP URI, for example, to merge several offices and assign short numbers to colleagues from other offices. <img src="https://habrastorage.org/storage3/88b/9db/c28/88b9dbc28d870408713974d3da7d5d95.png"><br><br><h5>  Fax machines </h5><br>  Set up a box for receiving fax messages. <br><img src="https://habrastorage.org/storage3/bb5/7a8/fff/bb57a8fff4180becea9f1e4b3e1139ec.png"><br>  All incoming faxes will be sent to the general email box. <br><br><h4>  Results </h4><br>  Previously, we used the cloud-based IP ATC from Mango Office, it is convenient and reliable, but it is tightly tied to the tariff and traffic through one provider, dramatically reducing the possibilities for expanding the functionality. <br><ul><li>  <b>Intel NUC DCCP847DYE platform</b> - 6500 rub. </li><li>  <b>Memory stick 2 gb</b> - 850 rub. </li><li>  <b>2 gb flash drive for system</b> - 300 rub. </li><li>  <b>External USB screw for recording conversations</b> lay in the closet. </li><li>  <b>15 pcs of IP phones (Lynksys, Cisco, Yealink)</b> - 34,500 rubles. </li><li>  <b>6 pcs Plantronics MX500i</b> - 3500 rubles. </li><li>  <b>Askozia PBX with call route editor</b> - 9190 rubles. </li><li>  <b>Direct Moscow number in Mango</b> - 2500 rubles connection and 250 rubles.  subscriber. </li></ul><br>  The cost of IP telephony of the office from 15 people "in an adult" amounted to <b>57,340 rubles</b> . <br>  You can save a significant amount on IP phones, which we tried to do using softphones, inconveniently! Now the company has a single multi-channel number, each employee has a convenient IP phone and headset on the table. We added the <a href="http://habrahabr.ru/post/169015/">integration</a> function <a href="http://habrahabr.ru/post/169015/">with 1C: CRM</a> , connected a call from the site , two-way Skype trunk.  Communication costs are optimized by selecting an outbound provider, according to the number pattern.  For remote workers via VPN we organize full-fledged workplaces. <br><br>  <b>Useful links:</b> <ul><li>  For more information about Askozia, please follow the <a href="http://www.askozia.ru/">link.</a> </li><li>  Provider <a href="http://www.mango-office.ru/">Mango Telecom</a> </li><li>  Prices for <a href="http://price.ru/search/pc-components/barebone/offers/%3Fquery%3DDCCP847DYE%26auto%3D1">Intel NUC DCCP847DYE</a> </li><li>  About the integration of Asterisk and 1C: CRM on <a href="http://habrahabr.ru/post/169015/">habr</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/194812/">https://habr.com/ru/post/194812/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../194802/index.html">How to speed up the development of your project with COLT?</a></li>
<li><a href="../194804/index.html">City Electronic Libraries</a></li>
<li><a href="../194806/index.html">SmartProgress 2.0. We have turned goal achievement into an exciting activity.</a></li>
<li><a href="../194808/index.html">Incredible new polymer that heals itself with 97% efficiency.</a></li>
<li><a href="../194810/index.html">Broadcast launch RAD Studio XE5</a></li>
<li><a href="../194814/index.html">How do the stars count? Using InterSystems Cach√© eXtreme at Gaia</a></li>
<li><a href="../194816/index.html">ARMs for the smallest: layout-2, interrupts and hello world!</a></li>
<li><a href="../194818/index.html">InterSystems Cach√© and NoSQL Technology</a></li>
<li><a href="../194822/index.html">Copyright: you have to take the initiative</a></li>
<li><a href="../194830/index.html">It seems that the next Android will also be "flat"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>