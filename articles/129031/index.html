<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creation of modules for PHPShop.CMS Free - Tips (Part 1)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Communicating with users of PHPShop.CMS Free and hitting them on the same ‚Äúrake‚Äù pushed me to write useful tips. 

 Template engine 
 Useful tips on u...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creation of modules for PHPShop.CMS Free - Tips (Part 1)</h1><div class="post__text post__text-html js-mediator-article">  Communicating with users of PHPShop.CMS Free and hitting them on the same ‚Äúrake‚Äù pushed me to write useful tips. <br><a name="habracut"></a><br><h4>  Template engine </h4><br>  Useful tips on using the functions of template. <br><br><h5>  Tricks with set () </h5><br>  The set () method assigns a template variable to be used in templates as <a href="http://habrahabr.ru/users/var/" class="user_link">var</a> @, example: <br><pre><code class="php hljs">$var = <span class="hljs-string"><span class="hljs-string">"  "</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;set(<span class="hljs-string"><span class="hljs-string">'my_var'</span></span>,$var);</code> </pre> <br>  and inserting its form @ my_var @ into the template tpl file will allow to display the phrase ‚ÄúWe love Habr‚Äù on the site.  Often, modules such as <b>formgenerator</b> or <b>comment</b> use interception and change variables.  If we use the $ this-&gt; set ('my_var', $ var) model in the hook function, then we completely rewrite the value of the variable, in our example we rewrite the page content.  Everything would be fine, but this rule works if we have only one module enabled that intercepts the page content, and if we have more of them, then each new module will overwrite the output of the output of another module.  In such cases, the third argument of the $ this-&gt; set method, which takes the value true, comes to the rescue.  Using this argument will allow not to rewrite the variable, but to supplement it, those will allow you to display the result of the modules work in turn - output of the form and comments. <br><br>  <b>Decision:</b> <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;set(<span class="hljs-string"><span class="hljs-string">'my_var'</span></span>,$var,<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>);</code> </pre><br><h5>  ParseTemplateReturn () in modules </h5><br>  If the module uses the template of this module, described in the module config.ini, then the entry is: <br><pre> <code class="php hljs">$comment=ParseTemplateReturn($GLOBALS[<span class="hljs-string"><span class="hljs-string">'SysValue'</span></span>][<span class="hljs-string"><span class="hljs-string">'templates'</span></span>][<span class="hljs-string"><span class="hljs-string">'comment'</span></span>][<span class="hljs-string"><span class="hljs-string">'comment_content'</span></span>]);</code> </pre><br>  will display an empty result.  To use the global template function ParseTemplateReturn () in the modules, you must specify the second argument true, which switches the functions to the mode of reading template files from the modules folder, and not from the general phpshop / templates /. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Decision:</b> <br><pre> <code class="php hljs">ParseTemplateReturn($GLOBALS[<span class="hljs-string"><span class="hljs-string">'SysValue'</span></span>][<span class="hljs-string"><span class="hljs-string">'templates'</span></span>][<span class="hljs-string"><span class="hljs-string">'comment'</span></span>][<span class="hljs-string"><span class="hljs-string">'comment_content'</span></span>],<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>);</code> </pre><br><h5>  Using php in templates </h5><br>  Template engine allows you to use php-functions.  Insert format: <br><pre> <code class="php hljs">@php ... php@</code> </pre><br>  In order to avoid errors, the php compiler uses double quotes ", instead of single quotes, for example: <br><pre> <code class="php hljs">@php <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"  !"</span></span>; php@</code> </pre><br><br><h4>  Work with DB </h4><br>  Useful tips on the use of data access functions of the database. <br>  Quick selection of module settings <br><br>  There is a very good and short way to get the module settings that are stored in the modulename_systems database: <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//   PHPShopObj::loadClass("array"); class PHPShopCommentArray extends PHPShopArray { function PHPShopCommentArray() { $this-&gt;objType=3; $this-&gt;objBase=$GLOBALS['SysValue']['base']['comment']['comment_system']; parent::PHPShopArray("enabled","flag","other"); } }</span></span></code> </pre><br>  In this record we need to specify the name of the database from which we want to get data, for example <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;objBase=$GLOBALS[<span class="hljs-string"><span class="hljs-string">'SysValue'</span></span>][<span class="hljs-string"><span class="hljs-string">'base'</span></span>][<span class="hljs-string"><span class="hljs-string">'comment'</span></span>][<span class="hljs-string"><span class="hljs-string">'comment_system'</span></span>];</code> </pre><br>  and list the field names that we need, separated by commas <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::PHPShopArray(<span class="hljs-string"><span class="hljs-string">"enabled"</span></span>,<span class="hljs-string"><span class="hljs-string">"flag"</span></span>,<span class="hljs-string"><span class="hljs-string">"other"</span></span>);</code> </pre><br>  To access this data is used: <br><pre> <code class="php hljs">$PHPShopCommentArray = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PHPShopCommentArray(); $enabled = $PHPShopCommentArray-&gt;getParam(<span class="hljs-string"><span class="hljs-string">'enabled'</span></span>);</code> </pre><br><br><h5>  Complex queries in ORM </h5><br>  <a href="http://wiki.phpshopcms.ru/index.php/PHPShopOrm">PHPShopOrm is</a> used to work with MySQL.  An example of a regular sample is: <br><pre> <code class="php hljs">$data=$PHPShopOrm-&gt;select(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'id'</span></span>,<span class="hljs-string"><span class="hljs-string">'name'</span></span>),<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'id'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'=10'</span></span>),<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'order'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'id DESC'</span></span>),<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'limit'</span></span>=&gt;<span class="hljs-number"><span class="hljs-number">1000</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(is_array($data)) <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($data <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $row){ .... }</code> </pre><br>  This all simplifies and standardizes queries, but if you need to perform complex samples with the combination of tables?  In such cases, the $ PHPShopOrm-&gt; query () method is used, for example: <br><pre> <code class="php hljs">$result = $PHPShopOrm-&gt;query(<span class="hljs-string"><span class="hljs-string">'SELECT a.*, b.login FROM '</span></span>.$GLOBALS[<span class="hljs-string"><span class="hljs-string">'SysValue'</span></span>][<span class="hljs-string"><span class="hljs-string">'base'</span></span>][<span class="hljs-string"><span class="hljs-string">'comment'</span></span>][<span class="hljs-string"><span class="hljs-string">'comment_log'</span></span>].<span class="hljs-string"><span class="hljs-string">' AS a JOIN '</span></span>.$GLOBALS[<span class="hljs-string"><span class="hljs-string">'SysValue'</span></span>][<span class="hljs-string"><span class="hljs-string">'base'</span></span>][<span class="hljs-string"><span class="hljs-string">'users'</span></span>][<span class="hljs-string"><span class="hljs-string">'users_base'</span></span>].<span class="hljs-string"><span class="hljs-string">' AS b ON a.user_id = b.id WHERE a.page="'</span></span>.$page.<span class="hljs-string"><span class="hljs-string">'" order by a.id desc'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>($row = mysql_fetch_array($result)) { ..... }</code> </pre><br><h5>  Hash with multidimensionality select result () </h5><br>  A frequent ‚Äúside‚Äù gets in the way of the developer when, when sampling $ PHPShopOrm-&gt; select () and provided that a record in DB 1 is a one-dimensional array, and if it is larger, it is multidimensional.  To circumvent such uncertainty, the array ('limit' =&gt; 1) argument is used, in which the array will always be one-dimensional and work with it through a record of the form: <br><pre> <code class="php hljs">$data=$PHPShopOrm-&gt;select(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'id'</span></span>,<span class="hljs-string"><span class="hljs-string">'name'</span></span>),<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'id'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'=10'</span></span>),<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'order'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'id DESC'</span></span>),<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'limit'</span></span>=&gt;<span class="hljs-number"><span class="hljs-number">1000</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(is_array($data)) { .... }</code> </pre><br>  in cases of obvious predisposition of the result to multiple fields, the recording format is used with the explicit indication of the limit of the array ('limit' =&gt; 1000): <br><pre> <code class="php hljs">$data=$PHPShopOrm-&gt;select(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'id'</span></span>,<span class="hljs-string"><span class="hljs-string">'name'</span></span>),<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'id'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'=10'</span></span>),<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'order'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'id DESC'</span></span>),<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'limit'</span></span>=&gt;<span class="hljs-number"><span class="hljs-number">1000</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(is_array($data)) <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($data <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $row){ .... }</code> </pre><br><br>  Source <a href="http://wiki.phpshopcms.ru/">wiki.phpshopcms.ru</a> <br><br>  UPD: <a href="http://habrahabr.ru/company/phpshop/blog/129157/">Part 2</a> </div><p>Source: <a href="https://habr.com/ru/post/129031/">https://habr.com/ru/post/129031/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../129026/index.html">Canobuvosti, 110th edition</a></li>
<li><a href="../129027/index.html">Removing unused assemblies from a .NET project</a></li>
<li><a href="../129028/index.html">Learn about the new generation of System Center 2012 solutions from the developers themselves at Tech ‚àô Ed Russia 2011</a></li>
<li><a href="../129029/index.html">Over a million users are registered on Github.</a></li>
<li><a href="../129030/index.html">Scientists were able to get an image of what a person sees by scanning the brain.</a></li>
<li><a href="../129032/index.html">Kodak Zx5 - the updated iron in the updated case</a></li>
<li><a href="../129033/index.html">Tower of Babel</a></li>
<li><a href="../129034/index.html">Draw a Stickman: a game on canvas / js / svg</a></li>
<li><a href="../129035/index.html">WhatsApp server serves over a million TCP connections</a></li>
<li><a href="../129036/index.html">How I didn‚Äôt get a job at AT & T or a bit about corruption in the Czech Republic</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>