<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Accelerate webpack build with webpack</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As your application evolves and grows, its build time increases ‚Äî from a few minutes when rebuilding in development mode to tens of minutes in a cold ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Accelerate webpack build with webpack</h1><div class="post__text post__text-html js-mediator-article"><p>  As your application evolves and grows, its build time increases ‚Äî from a few minutes when rebuilding in development mode to tens of minutes in a cold production build.  This is completely unacceptable.  We, the developers, do not like to switch the context while waiting for the bundle to be ready and want to receive feedback from the application as early as possible - ideally, while we are switching from IDE to the browser. </p><br><p>  How to achieve this?  What can we do to optimize build time? </p><br><p>  This article provides an overview of tools to speed up assembly in the webpack ecosystem, experience with their use, and tips. </p><br><p>  The optimization of the bundle size and the performance of the application itself is not covered in this article. </p><a name="habracut"></a><br><p>  The project, references to which are found in the text and for which measurements of the assembly speed are performed, is a relatively small application written on the JS + Flow + React + Redux stack using webpack, Babel, PostCSS, Sass, etc. and consisting of approximately 30 thousand lines of code and 1500 modules.  Versions of dependencies are relevant for April 2019. </p><br><p>  The studies were conducted on a computer with Windows 10, Node.js 8, 4-core processor, 8 GB of memory and SSD. </p><br><h2 id="terminologiya">  Terminology </h2><br><ul><li>  Build is the process of converting project source files into a set of related assets, all together constituting a web application. </li><li> dev-mode - build with the <code>mode: 'development'</code> option, usually using webpack-dev-server and watch-mode. </li><li>  prod mode is an assembly with the <code>mode: 'production'</code> option, usually with a full set of bundle optimizations. </li><li>  Incremental build - in dev mode: rebuild only files with changes. </li><li>  ‚ÄúCold‚Äù build - build from scratch, without any caches, but with installed dependencies. </li></ul><br><h2 id="keshirovanie">  Caching </h2><br><p>  Caching allows you to save the results of calculations for further reuse.  The first build may be a little slower than usual due to the overhead of caching, but subsequent ones will be much faster due to the reuse of the compilation results of unchanged modules. </p><br><p>  By default, the webpack in watch mode <a href="https://webpack.js.org/configuration/other-options/">caches</a> intermediate build results <a href="https://webpack.js.org/configuration/other-options/">in memory</a> so as not to rebuild the entire project with each change.  For a regular build (not in watch mode), this setting does not make sense.  You can also try to turn on the <a href="https://webpack.js.org/configuration/resolve">cache rezolving</a> to simplify the webpack's work on finding modules and see if this setting has a noticeable effect on your project. </p><br><p>  There is no persistent (saved to disk or other storage) cache in the webpack, although they <a href="">promise to add</a> it in version 5.  In the meantime, we can use the following tools: </p><br><p>  <strong>- Caching in <a href="https://github.com/webpack-contrib/terser-webpack-plugin">the TerserWebpackPlugin settings</a></strong> </p><br><p>  Disabled by default.  Even alone it has a noticeable positive effect: 60.7 s ‚Üí 39 s (-36%), it is perfectly combined with other tools for caching. </p><br><p>  Enable and use is very simple: </p><br><pre> <code class="javascript hljs">optimization: { <span class="hljs-attr"><span class="hljs-attr">minimizer</span></span>: [ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TerserJsPlugin({ <span class="hljs-attr"><span class="hljs-attr">terserOptions</span></span>: { ... }, <span class="hljs-attr"><span class="hljs-attr">cache</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }) ] }</code> </pre> <br><p>  <strong>- <a href="https://github.com/webpack-contrib/cache-loader">cache loader</a></strong> </p><br><p>  Cache-loader can be placed in any chain of loaders and cache the results of previous loaders. </p><br><p>  By default, it stores the cache in the .cache-loader folder in the project root.  Using the <code>cacheDirectory</code> option in the loader settings, you can override the path. </p><br><p>  Example of use: </p><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/\.js$/</span></span>, <span class="hljs-attr"><span class="hljs-attr">use</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">loader</span></span>: <span class="hljs-string"><span class="hljs-string">'cache-loader'</span></span>, <span class="hljs-attr"><span class="hljs-attr">options</span></span>: { <span class="hljs-attr"><span class="hljs-attr">cacheDirectory</span></span>: path.resolve( __dirname, <span class="hljs-string"><span class="hljs-string">'node_modules/.cache/cache-loader'</span></span> ), }, }, <span class="hljs-string"><span class="hljs-string">'babel-loader'</span></span> ] }</code> </pre> <br><p>  Safe and secure solution.  It works without problems with almost any loaders: for scripts (babel-loader, ts-loader), styles (scss-, less-, postcss-, css-loader), images and fonts (image-webpack-loader, react-svg- loader, file-loader), etc. </p><br><p>  Note: </p><br><ul><li>  When using a cache-loader together with a style-loader or MiniCssExtractPlugin.loader, it should be placed <em>after</em> them: <br>  <code>['style-loader', 'cache-loader', 'css-loader', ...]</code> . </li><li>  Contrary to the recommendations of the documentation to use this loader for caching the results of only time-consuming calculations, it may well give a small, but measurable performance gain for more ‚Äúlightweight‚Äù loaders - you need to try and measure. </li></ul><br><p>  Results: </p><br><ul><li>  dev: 35.5 s ‚Üí (turn on the cache-loader) ‚Üí 36.2 s (+ 2%) ‚Üí (re-build) ‚Üí 7.9 s (-78%) </li><li>  prod: 60.6 s ‚Üí (include the cache-loader) ‚Üí 61.5 s (+ 1.5%) ‚Üí (re-build) ‚Üí 30.6 s (-49%) ‚Üí (turn on the cache at Terser) ‚Üí 15, 4 s (-75%) </li></ul><br><p>  <strong>- <a href="https://github.com/mzgoddard/hard-source-webpack-plugin">HardSourceWebpackPlugin</a></strong> </p><br><p>  A more massive and ‚Äúsmart‚Äù solution for caching at the level of the entire assembly process, rather than individual loader chains.  In the base use case, it is enough to add a plugin to the webpack configuration; standard settings should be sufficient for correct operation.  Suitable for those who want to achieve maximum performance and are not afraid to face difficulties. </p><br><pre> <code class="javascript hljs">plugins: [ ..., <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HardSourceWebpackPlugin() ]</code> </pre> <br><p>  In the <a href="">documentation</a> there are examples of use with advanced settings and tips for solving possible problems.  Before putting the plug-in into operation on an ongoing basis, it is worth thoroughly testing its work in various situations and assembly modes. </p><br><p>  Results: </p><br><ul><li>  dev: 35.5 s ‚Üí (include the plugin) ‚Üí 36.5 s (+ 3%) ‚Üí (re-assembly) ‚Üí 3.7 s (-90%) </li><li>  prod: 60.6 s ‚Üí (include the plugin) ‚Üí 69.5 s (+ 15%) ‚Üí (re-assembly) ‚Üí 25 s (-59%) ‚Üí (turn on the cache at Terser) ‚Üí 10 s (-83%) </li></ul><br><p>  Pros: </p><br><ul><li>  compared to the cache-loader, it speeds up re-builds even more; </li><li>  does not require duplicate ads in different places of the configuration, like a cache-loader. </li></ul><br><p>  Minuses: </p><br><ul><li>  compared to the cache-loader, it slows down the first build more (when there is no disk cache); </li><li>  may slightly increase the incremental reassembly time; </li><li>  may cause problems when using webpack-dev-server and require detailed configuration of separation and invalidation of caches (see <a href="https://github.com/mzgoddard/hard-source-webpack-plugin">documentation</a> ); </li><li>  There are a lot of <a href="https://github.com/mzgoddard/hard-source-webpack-plugin/issues">issues</a> with bugs on GitHub. </li></ul><br><p>  <strong>- Caching in the <a href="https://github.com/babel/babel-loader">settings of babel-loader</a></strong> .  Disabled by default.  The effect is a few percent worse than the cache-loader. </p><br><p>  <strong>- Caching in <a href="https://github.com/webpack-contrib/eslint-loader">the eslint-loader settings</a></strong> .  Disabled by default.  If you use this loader, the cache will help not to waste time on linting of unchanged files when re-assembling. </p><br><hr><br><p>  When using the cache-loader or HardSourceWebpackPlugin, you need to disable the built-in caching mechanisms in other plugins or loaders (except TerserWebpackPlugin), since they will no longer be useful for repeated and incremental builds, and the ‚Äúcold‚Äù ones will even slow down.  The same applies to the cache-loader itself, if you already use HardSourceWebpackPlugin. </p><br><hr><br><p>  When setting up caching, the following questions may arise: </p><br><p>  <em>Where should I save caching results?</em> </p><br><p>  <code>node_modules/.cache/&lt;_&gt;/</code> are usually stored in the <code>node_modules/.cache/&lt;_&gt;/</code> directory.  Most tools use this path by default and allow you to override it if you want to store the cache in a different place. </p><br><p>  <em>When and how to disable cache?</em> </p><br><p>  It is very important to reset the cache when the configuration of the assembly changes, which will affect the output.  Using the old cache in such cases is harmful and can lead to errors of unknown nature. </p><br><p>  Factors to consider: </p><br><ul><li>  List of dependencies and their versions: package.json, package-lock.json, yarn.lock, .yarn-integrity; </li><li>  the contents of the webpack, Babel, PostCSS, browserslist, and other configuration files that are explicitly or implicitly used by loaders and plugins. </li></ul><br><p>  If you do not use the cache-loader or HardSourceWebpackPlugin, which allow you to redefine the list of sources to form an assembly fingerprint, npm-scripts that clear the cache when adding, updating, or removing dependencies will help you a bit: </p><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">"prunecaches"</span></span>: <span class="hljs-string"><span class="hljs-string">"rimraf ./node_modules/.cache/"</span></span>, <span class="hljs-string"><span class="hljs-string">"postinstall"</span></span>: <span class="hljs-string"><span class="hljs-string">"npm run prunecaches"</span></span>, <span class="hljs-string"><span class="hljs-string">"postuninstall"</span></span>: <span class="hljs-string"><span class="hljs-string">"npm run prunecaches"</span></span></code> </pre> <br><p>  Also help <a href="https://github.com/remy/nodemon">nodemon</a> , configured to clear the cache, and restart webpack-dev-server if it detects changes in the configuration files: </p><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">"start"</span></span>: <span class="hljs-string"><span class="hljs-string">"cross-env NODE_ENV=development nodemon --exec \"webpack-dev-server --config webpack.config.dev.js\""</span></span></code> </pre> <br><p>  nodemon.json </p><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"watch"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"webpack.config.dev.js"</span></span>, <span class="hljs-string"><span class="hljs-string">"babel.config.js"</span></span>, <span class="hljs-string"><span class="hljs-string">"more configs..."</span></span>, ], <span class="hljs-string"><span class="hljs-string">"events"</span></span>: { <span class="hljs-string"><span class="hljs-string">"restart"</span></span>: <span class="hljs-string"><span class="hljs-string">"yarn prunecaches"</span></span> } }</code> </pre> <br><p>  <em>Do I need to save the cache in the project repository?</em> </p><br><p>  Since the cache is, in fact, an assembly artifact, you do not need to commit it to the repository.  This is where the cache location inside the node_modules folder, which is usually included in .gitignore, helps. </p><br><p>  It is worth noting that if you have a caching system that can reliably determine the validity of the cache under any conditions, including changing the OS and the Node.js version, the cache could be reused between the developers' machines or in the CI, which would significantly reduce the time even for the very first build switch between branches. </p><br><p>  <em>In what modes of assembly is it worth it, and in which modes you should not use the cache?</em> </p><br><p>  There is no unequivocal answer: it all depends on how intensively you use the dev and prod modes when developing and switch between them.  In general, nothing prevents you from including caching everywhere, but remember that it usually makes the first build slower.  In CI, you probably always need a ‚Äúclean‚Äù build, in which case caching can be disabled using the appropriate environment variable. </p><br><hr><br><p>  Interesting materials about caching in webpack: </p><br><ul><li>  <a href="https://github.com/webpack/webpack/issues/6527">https://github.com/webpack/webpack/issues/6527</a> - a draft and discussion of the specification for adding a caching system to the webpack 5 by HardSourcePlugin </li><li>  <a href="https://gist.github.com/mzgoddard/0b42ad50048f407c1f3ac434a874f8e1">https://gist.github.com/mzgoddard/0b42ad50048f407c1f3ac434a874f8e1</a> - the reasoning of the author HardSourcePlugin about how a caching system should be implemented in a webpack </li><li>  <a href="https://github.com/webpack-contrib/cache-loader/issues/11">https://github.com/webpack-contrib/cache-loader/issues/11</a> - opinions on using the cache-loader with HardSourcePlugin </li><li>  <a href="https://github.com/webpack/webpack/issues/250">https://github.com/webpack/webpack/issues/250</a> - a discussion of webpack caching capabilities </li><li>  <a href="https://github.com/mzgoddard/hard-source-webpack-plugin/issues/251">https://github.com/mzgoddard/hard-source-webpack-plugin/issues/251</a> - opinions on using HardSourcePlugin in conjunction with AutoDllPlugin </li></ul><br><h2 id="parallelizaciya">  Parallelization </h2><br><p>  Using parallelization, you can get a performance boost by using all available processor cores.  The final effect is individual for each car. </p><br><p>  By the way, here is a simple Node.js code to get the number of available processor cores (this can be useful when setting up the tools listed below): </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> os = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'os'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> cores = os.cpus().length;</code> </pre> <br><p>  <strong>- Parallelization in <a href="https://github.com/webpack-contrib/terser-webpack-plugin">TerserWebpackPlugin settings</a></strong> </p><br><p>  Disabled by default.  Just like your own caching, it is easy to turn on and visibly speeds up the build. </p><br><pre> <code class="javascript hljs">optimization: { <span class="hljs-attr"><span class="hljs-attr">minimizer</span></span>: [ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TerserJsPlugin({ <span class="hljs-attr"><span class="hljs-attr">terserOptions</span></span>: { ... }, <span class="hljs-attr"><span class="hljs-attr">parallel</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }) ] }</code> </pre> <br><p>  <strong>- <a href="https://github.com/webpack-contrib/thread-loader">thread-loader</a></strong> </p><br><p>  Thread-loader can be placed in a chain of heavy-duty loaders, after which the previous loaders will use a pool of Node.js subprocesses (‚Äúworkers‚Äù). </p><br><p>  It has a set of options that allow you to fine-tune the work of a pool of workers, although the basic values ‚Äã‚Äãlook quite adequate.  Special attention should be paid to <code>poolTimeout</code> and <code>workers</code> - see <a href="">example</a> . </p><br><p>  It can be used in conjunction with the cache-loader as follows (order is important): <code>['cache-loader', 'thread-loader', 'babel-loader']</code> .  If the warm-up is enabled for the thread-loader, it is worth re-checking the stability of re-assemblies using the cache ‚Äî the webpack may hang and not complete the process after successfully completing the assembly.  In this case, simply turn off warmup. </p><br><p>  If you encounter a hangup of the assembly after adding a thread-loader to the Sass-style compilation chain, <a href="https://webpack.js.org/guides/build-performance/">this advice</a> can help you. </p><br><p>  <strong>- <a href="https://github.com/amireh/happypack">HappyPack</a></strong> </p><br><p>  A plugin that intercepts loader calls and distributes their work across multiple threads.  At the moment, it is in support mode (that is, development is not planned), and its creator <a href="https://github.com/amireh/happypack">recommends</a> thread-loader as a replacement.  Thus, if your project keeps up with the times, it is better to refrain from using HappyPack, although it is definitely worth trying and comparing the results with the thread-loader. </p><br><p>  HappyPack has clear configuration <a href="">documentation</a> , which, by the way, is rather unusual in itself: it is proposed to move the configurations of the loaders to the plugin's constructor call, and replace the loader chains with the own happypack loader.  Such a non-standard approach can cause inconvenience when creating a custom webpack configuration ‚Äúof pieces‚Äù. </p><br><p>  HappyPack maintains a <a href="https://github.com/amireh/happypack/wiki/Loader-Compatibility-List">limited list of loaders</a> ;  The main and most widely used in this list are present, but the performance of others is not guaranteed due to the possible incompatibility of the API.  More information can be found in the project's <a href="https://github.com/amireh/happypack/issues">issues</a> . </p><br><h2 id="otkaz-ot-vychisleniy">  Failure to calculate </h2><br><p>  Any work takes time.  To spend less time, you need to avoid work that does little good, can be put off until later or not needed at all in this situation. </p><br><p>  <strong>- Apply loaders to the minimum possible number of modules</strong> </p><br><p>  <a href="https://webpack.js.org/configuration/module">The test, exclude and include properties</a> set the conditions for the module to be included in the processing by the loader.  The point is to avoid transforming modules that do not need this transformation. </p><br><p>  A popular example is the exclusion of node_modules from Babel transfiguration: </p><br><pre> <code class="javascript hljs">rules: [ { <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/\.jsx?$/</span></span>, <span class="hljs-attr"><span class="hljs-attr">exclude</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/node_modules/</span></span>, <span class="hljs-attr"><span class="hljs-attr">loader</span></span>: <span class="hljs-string"><span class="hljs-string">'babel-loader'</span></span> } ]</code> </pre> <br><p>  Another example is that regular CSS files do not need to be processed by the preprocessor: </p><br><pre> <code class="javascript hljs">rules: [ { <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/\.scss$/</span></span>, <span class="hljs-attr"><span class="hljs-attr">use</span></span>: [<span class="hljs-string"><span class="hljs-string">'style-loader'</span></span>, <span class="hljs-string"><span class="hljs-string">'css-loader'</span></span>, <span class="hljs-string"><span class="hljs-string">'sass-loader'</span></span>] }, { <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/\.css$/</span></span>, <span class="hljs-attr"><span class="hljs-attr">use</span></span>: [<span class="hljs-string"><span class="hljs-string">'style-loader'</span></span>, <span class="hljs-string"><span class="hljs-string">'css-loader'</span></span>] } ]</code> </pre> <br><p>  <strong>- Do not enable optimization of the size of the bundle in dev-mode</strong> </p><br><p>  On a powerful developer‚Äôs machine with a stable Internet, a locally deployed application usually starts quickly, even if it weighs several megabytes.  Optimizing a bundle when building can take much more precious time than saving when loading. </p><br><p>  The advice concerns JS (Terser, Uglify <a href="https://survivejs.com/webpack/optimizing/minifying/">, etc.</a> ), CSS (cssnano, optimize-css-assets-webpack-plugin), SVG and images (SVGO, Imagemin, image-webpack-loader), HTML (html-minifier, option in html-webpack-plugin) and others. </p><br><p>  <strong>- Do not include polyfill and transformation in dev-mode</strong> </p><br><p>  If you are using babel-preset-env, postcss-preset-env or Autoprefixer, add a <a href="https://github.com/browserslist/browserslist">separate</a> dev-mode Browserslist <a href="https://github.com/browserslist/browserslist">configuration</a> that includes only those browsers that you use during development.  Most likely, these are the latest versions of Chrome or Firefox, which perfectly support modern standards without polyfills and transformations.  This will avoid unnecessary work. </p><br><p>  Example .browserslistrc: </p><br><pre> <code class="plaintext hljs">[production] your supported browsers go here... [development] last 2 Chrome versions last 2 Firefox versions last 1 Safari version</code> </pre> <br><p>  <strong>- Revise the use of source maps</strong> </p><br><p>  Generating the most accurate and complete source maps takes considerable time (on our project, about 30% of the time of the prod-build with the <code>devtool: 'source-map'</code> option).  Consider whether you need source maps in a prod build (locally and in CI).  It may be worthwhile to generate them only when necessary - for example, on the basis of an environment variable or a commit tag. </p><br><p>  In dev-mode, in most cases there will be a rather lightweight version - <code>'cheap-eval-source-map'</code> or <code>'cheap-module-eval-source-map'</code> .  For details, see the webpack <a href="https://webpack.js.org/configuration/devtool/">documentation</a> . </p><br><p>  <strong>- Set compression in Terser</strong> </p><br><p>  According to the <a href="https://github.com/terser-js/terser">Terser documentation</a> (the same applies to Uglify), minigating the code is overwhelmed by the <code>mangle</code> and <code>compress</code> options.  By fine-tuning them, you can speed up assembly at the cost of a slight increase in the size of the bundle.  There is <a href="">an example</a> in the source code of vue-cli and <a href="https://gist.github.com/rowanoulton/44ec3424ac1e86b63316d522e1b99a16">another example</a> from an engineer from Slack.  In our project, Terser tuning in the first version reduces assembly time by about 7% in exchange for a 2.5% increase in the size of the bundle.  Is the game worth the candle - you decide. </p><br><p>  <strong>- Exclude external dependencies from parsing</strong> </p><br><p>  Using the <a href="https://webpack.js.org/configuration/module"><code>module.noParse</code></a> and <a href="https://webpack.js.org/configuration/resolve/"><code>resolve.alias</code></a> you can redirect importing library modules to already compiled versions and simply insert them into the bundle without wasting time on parsing.  In dev-mode, this should significantly increase the speed of the assembly, including incremental one. </p><br><p>  The algorithm is about the following: </p><br><p>  (1) Make a list of modules that need to be skipped during parsing. </p><br><p>  Ideally, these are all runtime dependencies that fall into a bundle (or at least the most massive ones, such as react-dom or lodash), and not only their own (first level), but also transitive (dependency dependencies).  Maintain this list in the future will have on their own. </p><br><p>  (2) For the selected modules, write down the paths to their compiled versions. </p><br><p>  Instead of missing dependencies, you need to provide the assembler with an alternative, and this alternative should not depend on the environment - have calls to <code>module.exports</code> , <code>require</code> , <code>process</code> , <code>import</code> , etc.  Pre-compiled (not necessarily minified) single-file modules that usually lie in the dist folder inside dependency sources are suitable for this role.  To find them, you have to go to node_modules.  For example, for axios, the path to the compiled module looks like this: <code>node_modules/axios/dist/axios.js</code> . </p><br><p>  (3) In the webpack configuration, use the resolve.alias option to replace imports by dependency names with direct file imports, the paths to which were written out in the previous step. </p><br><p>  For example: </p><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">resolve</span></span>: { <span class="hljs-attr"><span class="hljs-attr">alias</span></span>: { <span class="hljs-attr"><span class="hljs-attr">axios</span></span>: path.resolve( __dirname, <span class="hljs-string"><span class="hljs-string">'node_modules/dist/axios.min.js'</span></span> ), ... } } }</code> </pre> <br><p>  There is a big drawback: if your code or code of your dependencies does not refer to the standard entry point (index file, <code>main</code> field in <code>package.json</code> ), but to a specific file inside the dependency source, or if the dependency is exported as an ES module, or if the rezolving process interferes (for example, babel-plugin-transform-imports), the whole idea may fail.  Bundle will be assembled, but the application will be broken. </p><br><p>  (4) In the webpack configuration, use the module.noParse option to use the regular expressions to skip the parsing of precompiled modules requested in the paths from step 2. </p><br><p>  For example: </p><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">module</span></span>: { <span class="hljs-attr"><span class="hljs-attr">noParse</span></span>: [ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">RegExp</span></span>(<span class="hljs-string"><span class="hljs-string">'node_modules/dist/axios.min.js'</span></span>), ... ] } }</code> </pre> <br><p>  Total: on paper, the method looks promising, but a non-trivial setting with pitfalls at a minimum raises the costs of implementation, and at most, reduces the benefits to nothing. </p><br><p>  An alternative option with a similar principle of operation is the use of the <a href="https://webpack.js.org/configuration/externals"><code>externals</code></a> option.  In this case, you will have to embed links to external scripts yourself in the HTML file, and even with the necessary dependency versions that correspond to package.json. </p><br><p>  <strong>- Select rarely changing code into a separate bundle and compile it only once</strong> </p><br><p>  Surely you've heard about <a href="https://webpack.js.org/plugins/dll-plugin/">DllPlugin</a> .  With it, you can spread an actively changing code (your application) and rarely changing code (for example, dependencies) across different assemblies.  Once assembled a dependency bundle (the same DLL) then simply connects to the application build - saving time. </p><br><p>  It looks like this in general terms: </p><br><ol><li>  To build a DLL, a separate webpack configuration is created, the necessary modules are connected as entry points. </li><li>  The build starts with this configuration.  DllPlugin generates a DLL bundle and a manifest file with name mappings and module paths. </li><li>  A DllReferencePlugin is added to the configuration of the main assembly, to which the manifest is passed. </li><li>  Imports of dependencies rendered in a DLL are displayed during assembly on already compiled modules using a manifest. </li></ol><br><p>  A little more can be found in the article on the <a href="https://robertknight.me.uk/posts/webpack-dll-plugins/">link</a> . </p><br><p>  Starting to use this approach, you quickly find a number of drawbacks: </p><br><ul><li>  The assembly of the DLL is separate from the main assembly, and it needs to be managed separately: prepare a special configuration, restart each time you switch a branch or change dependencies. </li><li>  Since the DLL library does not belong to the artifacts of the main assembly, it will need to be manually copied to the folder with the other assets and connected to the HTML file using one of these plugins: <a href="https://github.com/SimenB/add-asset-html-webpack-plugin">1</a> , <a href="https://github.com/jharris4/html-webpack-include-assets-plugin">2</a> . </li><li>  It is necessary to manually maintain up to date the list of dependencies intended for inclusion in the DLL bundle. </li><li>  The sad thing is: tree-shaking is not applied to the DLL bundle.  In theory, the <a href="https://github.com/webpack/webpack/pull/7344"><code>entryOnly</code></a> option is for this, but it was forgotten to be documented. </li></ul><br><p>  You can get rid of the boilerplate and solve the first problem (and the second one, if you use html-webpack-plugin v3 - it doesn't work with the 4th version) using <a href="https://github.com/asfktz/autodll-webpack-plugin">AutoDllPlugin</a> .  However, it still does not support the <code>entryOnly</code> option for the <code>entryOnly</code> used under the hood, and the author of the plug-in himself doubts the advisability of using his brainchild in the light of the soon coming webpack 5. </p><br><h2 id="raznoe">  miscellanea </h2><br><p>  Update your software and dependencies regularly.    Node.js, npm / yarn     (webpack, Babel  .)    . ,          changelog, issues,   ,      . </p><br><p>   PostCSS  <a href="https://github.com/csstools/postcss-preset-env">postcss-preset-env</a>     stage,      . ,      stage-3,     Custom Properties,    stage-4     13%. </p><br><p>    Sass (node-sass, sass-loader),  <a href="https://sass-lang.com/dart-sass">Dart Sass</a> ( Sass  Dart,   JS)  <a href="https://github.com/yibn2008/fast-sass-loader">fast-sass-loader</a> . ,        .      ‚Äî dart-sass    ,  node-sass,     JS,     libsass. </p><br><p>   Dart Sass    <a href="https://github.com/webpack-contrib/sass-loader"> sass-loader</a> .         Sass    fibers. </p><br><p>    CSS-,          dev-.     - ,   ,         ,   . </p><br><p>  Example: </p><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">loader</span></span>: <span class="hljs-string"><span class="hljs-string">'css-loader'</span></span>, <span class="hljs-attr"><span class="hljs-attr">options</span></span>: { <span class="hljs-attr"><span class="hljs-attr">modules</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">localIdentName</span></span>: isDev ? <span class="hljs-string"><span class="hljs-string">'[path][name][local]'</span></span> : <span class="hljs-string"><span class="hljs-string">'[hash:base64:5]'</span></span> } }</code> </pre> <br><p> ,   , :      . </p><br><p> ,  -    webpack  <a href="https://webpack.js.org/plugins/prefetch-plugin/">PrefetchPlugin</a> ,      ,    ‚Äî .  webpack  <a href="https://github.com/webpack/webpack/issues/1566">  issues</a>    ,     .     ? </p><br><ol><li>     .     CLI- <code>--json</code> ,  .  <a href="https://webpack.js.org/api/stats"></a> . ,  ,   dev- . </li><li>      <a href="https://webpack.github.io/analyse/">-</a>     Hints. </li><li>  ,  ‚ÄúLong module build chains‚Äù.   ,     ‚Äî PrefetchPlugin  . </li><li>      PrefetchPlugin.     . <a href="https://stackoverflow.com/questions/32923085/how-to-optimize-webpacks-build-time-using-prefetchplugin-analyse-tool">  StackOverflow</a> . </li></ol><br><p> :         . </p><br><h2 id="v-kachestve-zaklyucheniya">    </h2><br><p>     ,       (TypeScript, Angular  .) ‚Äî   ! </p><br><h2 id="istochniki">  Sources </h2><br><p>     , ,   ,      . </p><br><ul><li> <a href="https://webpack.js.org/guides/build-performance/">https://webpack.js.org/guides/build-performance/</a> </li><li> <a href="https://survivejs.com/webpack/optimizing/performance/">https://survivejs.com/webpack/optimizing/performance/</a> </li><li> <a href="https://github.com/webpack/docs/wiki/build-performance">https://github.com/webpack/docs/wiki/build-performance</a> </li><li> <a href="https://slack.engineering/keep-webpack-fast-a-field-guide-for-better-build-performance-f56a5995e8f1">https://slack.engineering/keep-webpack-fast-a-field-guide-for-better-build-performance-f56a5995e8f1</a> </li><li> <a href="https://medium.com/webpack/typescript-webpack-super-pursuit-mode-83cc568dea79">https://medium.com/webpack/typescript-webpack-super-pursuit-mode-83cc568dea79</a> </li><li> <a href="https://medium.com/ottofellercom/0-100-in-two-seconds-speed-up-webpack-465de691ed4a">https://medium.com/ottofellercom/0-100-in-two-seconds-speed-up-webpack-465de691ed4a</a> </li><li> <a href="https://medium.com/onfido-tech/speed-up-webpack-ff53c494b89c">https://medium.com/onfido-tech/speed-up-webpack-ff53c494b89c</a> </li><li> <a href="https://blog.box.com/blog/how-we-improved-webpack-build-performance-95">https://blog.box.com/blog/how-we-improved-webpack-build-performance-95</a> </li><li> <a href="https://engineering.bitnami.com/articles/optimizing-your-webpack-builds.html">https://engineering.bitnami.com/articles/optimizing-your-webpack-builds.html</a> </li><li> <a href="https://habr.com/ru/company/skbkontur/blog/351080/">https://habr.com/ru/company/skbkontur/blog/351080/</a> </li><li> <a href="https://habr.com/ru/company/oleg-bunin/blog/433324/">https://habr.com/ru/company/oleg-bunin/blog/433324/</a> </li><li> <a href="https://github.com/lcxfs1991/blog/issues/15">https://github.com/lcxfs1991/blog/issues/15</a> </li><li> <a href="https://github.com/FrendEr/webpack-optimize-example">https://github.com/FrendEr/webpack-optimize-example</a> </li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/451146/">https://habr.com/ru/post/451146/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../451124/index.html">Developing proteins in the cloud using Python and Transcriptic or How to create any protein for $ 360</a></li>
<li><a href="../451126/index.html">Toolbox for researchers - release one: self-organization and data visualization</a></li>
<li><a href="../451132/index.html">Consumer Driven Contracts or Gitlab CI through the eyes of QA test automation</a></li>
<li><a href="../451136/index.html">Presented by .NET 5</a></li>
<li><a href="../451144/index.html">Antiquities: technology in TV advertising</a></li>
<li><a href="../451148/index.html">Object Oriented Programming in Graphic Languages</a></li>
<li><a href="../451150/index.html">Catch Me If You Can. Manager Version</a></li>
<li><a href="../451152/index.html">Resistor in the gate circuit or how to do it right</a></li>
<li><a href="../451154/index.html">Local Autonomous Data Collection System (continued)</a></li>
<li><a href="../451158/index.html">Electrical diagrams. Types of schemes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>