<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>LEMP stack with PHP 7 on CentOS 7 + Let's Encrypt on Google Cloud for deploying the Symfony 4 application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good afternoon, dear Habr! 
 I will say right away that I am a developer, and I think many colleagues will support me, there are often not enough syst...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>LEMP stack with PHP 7 on CentOS 7 + Let's Encrypt on Google Cloud for deploying the Symfony 4 application</h1><div class="post__text post__text-html js-mediator-article">  Good afternoon, dear Habr! <br>  I will say right away that I am a developer, and I think many colleagues will support me, there are often not enough system administrators in our projects, somewhere first, somewhere always.  We have to study new materials for us in this area, and in my opinion, it‚Äôs correct to share our experience with each other.  This article does not claim the laurels of the complete CentOS setup guide, and yes, SELinux is disabled in it, and no additional MySQL users are created, it only describes what is said in the header, and the minimum working configuration.  In the configuration, which then can always be completed by a specialist, but which will allow you to deploy the required project in the shortest possible time.  I will be grateful to the guru for their advice and comments, always for constructive criticism, on the basis of which I will make edits if necessary.  For the rest, I would like to quote <a href="https://habr.com/users/antonshevchuk/" class="user_link">AntonShevchuk</a> : ‚ÄúIf you do not agree with the author of the article, describe your point of view, why should you gloatfully lower his karma?‚Äù  Thank you, let's go ... <br><br>  In this post, I will provide specific steps for installing and configuring the Nginx + MySQL + PHP7 bundle on CentOS 7. It is worth noting that this article will cover setting up the system for one domain.  The site will be used by an instance on the Google Cloud Platform, with the creation of which I will begin: <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Creating an instance on Google Cloud with generating SSH keys</b> <div class="spoiler_text">  Select in the main menu, select "Compute Engine" and click "Create an instance."  Depending on the expected load, we choose the type of the machine, but <b>not lower than g1-small</b> , since Composer for Symfony 4 is demanding of RAM and will not be able to load dependencies on f1-micro. <br><br>  The proposed boot disk image is changed to CentOS 7, the minimum disk size of 10GB is quite suitable for deploying the system, all the necessary libraries and dependencies. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To access the server you are creating via SSH, you need to generate the corresponding key, for MacOS X or Linux users there is a command for this <br><br><pre><code class="hljs markdown">ssh-keygen -t rsa -f <span class="hljs-strong"><span class="hljs-strong">__FILE__</span></span> -C <span class="hljs-strong"><span class="hljs-strong">__USER__</span></span></code> </pre> <br>  where __FILE__ is the path to the saved key with the file name, and __USER__ is the user name under which you will login to the system.  When executing this command, the system will ask you to specify a key phrase that will serve as a password when using this key, its input is optional, do not enter anything to skip and press Enter, then confirm the previous action.  After executing this command, the system will create the private key specified in __FILE__, and next to it - the public key named __FILE__.pub <br>  The last thing that remains to be done with the key for MacOS X and Linux users is to deny write access to everyone except the owner of the key; <br><br><pre> <code class="hljs swift">chmod <span class="hljs-number"><span class="hljs-number">400</span></span> <span class="hljs-keyword"><span class="hljs-keyword">__FILE__</span></span></code> </pre> <br>  Windows users can use PuTTYgen.  Open the program, click Generate and follow the instructions set by default. The parameters are suitable for most cases, but Google insists on 2048-bit keys, do not forget to set this parameter.  The ‚ÄúKey comment‚Äù field is used to set the user name, and to set the key phrase - ‚ÄúKey passphrase‚Äù.  After generation is complete, the program will display the public key.  To save a private key with the .ppk extension, click ‚ÄúSave private key‚Äù. <br><br>  Copy the contents of the public key (from the file __FILE__.pub for MacOS X / Linux or from the PuTTYgen window for Windows) and paste it into the appropriate field on the Security tab: <br><br><img width="408" src="https://habrastorage.org/webt/0n/xc/bn/0nxcbnvsk0zdxh3gpmv4cx7ygc4.png"><br><br>  Do not forget to allow HTTP and HTTPS traffic by ticking the appropriate fields.  At this stage, everything is ready, click "Create". <br><br>  After creation, the system displays the external IP address assigned to the instance, connect to it via SSH using the private key: <br><br><pre> <code class="hljs markdown">ssh -i <span class="hljs-strong"><span class="hljs-strong">__FILE__</span></span> <span class="hljs-strong"><span class="hljs-strong">__USER__</span></span>@<span class="hljs-strong"><span class="hljs-strong">__IP__</span></span></code> </pre> <br></div></div><br>  We proceed directly to the installation of LEMP.  Under the rights of the current user, create variables for future use: <br><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> USER_NAME=______ <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> DOMAIN_NAME=______</code> </pre> <br>  Switch to superuser mode, all the above actions will be performed on its behalf, unless explicitly stated otherwise. <br><br>  We update the system and remove the "orphaned" packages: <br><br><pre> <code class="hljs pgsql">yum clean <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> yum <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> yum autoremove</code> </pre> <br>  Add support for Fedora repositories, install the nano text editor and the wget utility to be able to get files from remote servers.  To deploy applications to symfony (and not only), I use git repository cloning, to implement this method, install git support, also symfony needs zip support (the -y option means an automatic answer "Y" to all questions arising from the installer): <br><br><pre> <code class="hljs sql">yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> epel-<span class="hljs-keyword"><span class="hljs-keyword">release</span></span> nano wget git-core zip unzip -y</code> </pre> <br>  You need to specify the correct host name, for this we edit the network configuration file: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">cat</span></span> &lt;&lt; EOF &gt; /etc/sysconfig/network HOSTNAME=<span class="hljs-variable"><span class="hljs-variable">${DOMAIN_NAME}</span></span> EOF</code> </pre> <br><br>  Save the file and install it using the hostnamectl utility: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">hostnamectl</span></span> set-hostname <span class="hljs-variable"><span class="hljs-variable">${DOMAIN_NAME}</span></span></code> </pre> <br>  Install nginx: <br><br><pre> <code class="hljs sql">yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> nginx -y</code> </pre> <br>  Run nginx: <br><br><pre> <code class="hljs pgsql">systemctl <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> nginx</code> </pre> <br>  Add nginx to autoload: <br><br><pre> <code class="hljs pgsql">systemctl <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> nginx</code> </pre> <br>  Install MySQL, launch and add to autoload: <br><br><pre> <code class="hljs sql">yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> mariadb mariadb-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> -y systemctl <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> mariadb systemctl <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> mariadb</code> </pre> <br>  Perform the initial configuration of MySQL, answer all the questions in the script with "Y" and specify the superuser password: <br><br><pre> <code class="hljs">mysql_secure_installation</code> </pre> <br>  Add support for Let's Encrypt: <br><br><pre> <code class="hljs sql">yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> certbot -y</code> </pre> <br>  Since at the time of this writing PHP 7 is not in the CentOS repositories, nor in Fedora, we will install it from the REMI repository: <br><br><pre> <code class="bash hljs">yum install http://rpms.remirepo.net/enterprise/remi-release-7.rpm yum-utils -y yum-config-manager --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> remi-php72 yum --enablerepo=remi,remi-php72 install php-fpm php-common php-opcache php-cli php-pear php-pdo php-mysqlnd php-gd php-mcrypt php-xml php-zip -y</code> </pre> <br>  All the necessary software is installed, go to its settings, initially edit the configuration file php-fpm: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">nano</span></span> /etc/php-fpm.d/www.conf</code> </pre> <br>  In this file, you must specify the user name and the group under which you will run the application, in our minimum configuration it is the user by whom you initially logged in to the system, the same name group for it is created by the system automatically. <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">user</span></span> = ______ <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> = ______ <span class="hljs-keyword"><span class="hljs-keyword">listen</span></span>.owner = ______ <span class="hljs-keyword"><span class="hljs-keyword">listen</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">group</span></span> = ______</code> </pre> <br>  Next, we specify the socket - it is necessary to add the following under the line listen = 127.0.0.1:9000: <br><br><pre> <code class="hljs ruby">listen = <span class="hljs-regexp"><span class="hljs-regexp">/var/run</span></span><span class="hljs-regexp"><span class="hljs-regexp">/php-fpm/php</span></span>-fpm.sock</code> </pre> <br>  And finally, at the end of the file, change the folder for storing session files: <br><br><pre> <code class="hljs markdown">php<span class="hljs-emphasis"><span class="hljs-emphasis">_value[session.save_</span></span>path] = /home/<span class="hljs-strong"><span class="hljs-strong">______</span></span>/<span class="hljs-strong"><span class="hljs-strong">______</span></span>/var/sessions</code> </pre> <br>  Save the changes, then run and add php-fpm to the autoload: <br><br><pre> <code class="hljs pgsql">systemctl <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> php-fpm systemctl <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> php-fpm</code> </pre> <br>  Disable SELINUX: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">setenforce</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br>  With this command you disable SELINUX only in the current user session, so that after rebooting the settings are saved, you must edit its configuration file: <br><br><pre> <code class="hljs lua">nano /etc/selinux/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span></code> </pre> <br>  where to specify SELINUX = disabled <br><br>  Save the changes and <b>exit the superuser mode</b> .  Next, we will create a directory for the project in the home directory and put an index file there - a stub to check the functionality of the created stack: <br><br><pre> <code class="hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> mkdir -p <span class="hljs-variable"><span class="hljs-variable">${DOMAIN_NAME}</span></span>/public <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-variable"><span class="hljs-variable">${DOMAIN_NAME}</span></span>/public nano index.php</code> </pre> <br>  Let the contents of the file be as follows (replace __YOUR_ROOT_PASSWORD__ with the password of the MySQL superuser specified during its configuration): <br><br><pre> <code class="php hljs">&lt;html&gt; &lt;head&gt; &lt;h2&gt;LEMP test&lt;/h2&gt; &lt;/head&gt; &lt;body&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;p&gt;Hello!&lt;/p&gt;'</span></span>; $host = <span class="hljs-string"><span class="hljs-string">"localhost"</span></span>; $username = <span class="hljs-string"><span class="hljs-string">"root"</span></span>; $password = <span class="hljs-string"><span class="hljs-string">"__YOUR_ROOT_PASSWORD__"</span></span>; $connection = mysqli_connect($host, $username, $password); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$connection) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;p&gt;DB connect failed with error: '</span></span> . mysqli_connect_error() . <span class="hljs-string"><span class="hljs-string">'&lt;/p&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;p&gt;DB connection established&lt;/p&gt;'</span></span>; <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;/body&gt; &lt;/html&gt;</code> </pre> <br>  Again, log in as the superuser and open the nginx configuration file for editing: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">nano</span></span> /etc/nginx/nginx.conf</code> </pre> <br>  Change the username like the php-fpm configuration: <br>  user username_system_; <br><br>  Change the default server directive configuration as follows: <br><br><pre> <code class="nginx hljs"><span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">set</span></span> <span class="hljs-variable"><span class="hljs-variable">$USER_NAME</span></span> ______; <span class="hljs-attribute"><span class="hljs-attribute">server_name</span></span> <span class="hljs-variable"><span class="hljs-variable">$hostname</span></span> www.<span class="hljs-variable"><span class="hljs-variable">$hostname</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">root</span></span> /home/<span class="hljs-variable"><span class="hljs-variable">$USER_NAME</span></span>/<span class="hljs-variable"><span class="hljs-variable">$hostname</span></span>/public; <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> / { <span class="hljs-comment"><span class="hljs-comment"># try to serve file directly, fallback to index.php try_files $uri /index.php$is_args$args; } location ~ ^/index\.php(/|$) { fastcgi_pass unix:/var/run/php-fpm/php-fpm.sock; fastcgi_split_path_info ^(.+\.php)(/.*)$; include fastcgi_params; fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name; fastcgi_param DOCUMENT_ROOT $realpath_root; internal; } location ~ \.php$ { return 404; } error_log /var/log/nginx/______.error.log; access_log /var/log/nginx/______.access.log; }</span></span></code> </pre> <br>  Save the changes and let the nginx command re-read the configuration: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">nginx</span></span> -s reload</code> </pre> <br>  On the domain name __YOURD_DOMAGENNOE_IMA__ the page we created is a stub. <br><br>  Let's start creating a certificate: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">openssl</span></span> dhparam -out /etc/ssl/certs/dhparam.pem <span class="hljs-number"><span class="hljs-number">2048</span></span> certbot certonly --webroot -w /home/<span class="hljs-variable"><span class="hljs-variable">${USER_NAME}</span></span>/<span class="hljs-variable"><span class="hljs-variable">${DOMAIN_NAME}</span></span>/public -d <span class="hljs-variable"><span class="hljs-variable">${DOMAIN_NAME}</span></span> certbot certonly --webroot -w /home/<span class="hljs-variable"><span class="hljs-variable">${USER_NAME}</span></span>/<span class="hljs-variable"><span class="hljs-variable">${DOMAIN_NAME}</span></span>/public -d www.<span class="hljs-variable"><span class="hljs-variable">${DOMAIN_NAME}</span></span></code> </pre> <br>  After generating keys, we change the nginx configuration to support HTTPS, in this configuration the ‚Äúmain‚Äù domain is without a www and the redirection to a secure connection is configured.  So: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">nano</span></span> /etc/nginx/nginx.conf</code> </pre> <br>  We change the server directive we created 2 steps back to the following: <br><br><pre> <code class="nginx hljs"><span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">set</span></span> <span class="hljs-variable"><span class="hljs-variable">$USER_NAME</span></span> ______; <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">443</span></span> ssl; <span class="hljs-attribute"><span class="hljs-attribute">server_name</span></span> <span class="hljs-variable"><span class="hljs-variable">$hostname</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">ssl_certificate</span></span> /etc/letsencrypt/live/______/fullchain.pem; <span class="hljs-attribute"><span class="hljs-attribute">ssl_certificate_key</span></span> /etc/letsencrypt/live/______/privkey.pem; <span class="hljs-attribute"><span class="hljs-attribute">ssl_protocols</span></span> TLSv1 TLSv1.<span class="hljs-number"><span class="hljs-number">1</span></span> TLSv1.<span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">ssl_prefer_server_ciphers</span></span> <span class="hljs-literal"><span class="hljs-literal">on</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">ssl_ciphers</span></span> <span class="hljs-string"><span class="hljs-string">"EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH"</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">ssl_ecdh_curve</span></span> secp384r1; <span class="hljs-attribute"><span class="hljs-attribute">ssl_session_cache</span></span> shared:SSL:<span class="hljs-number"><span class="hljs-number">10m</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">ssl_session_tickets</span></span> <span class="hljs-literal"><span class="hljs-literal">off</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">ssl_stapling</span></span> <span class="hljs-literal"><span class="hljs-literal">on</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">ssl_stapling_verify</span></span> <span class="hljs-literal"><span class="hljs-literal">on</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">resolver</span></span> <span class="hljs-number"><span class="hljs-number">8.8.8.8</span></span> <span class="hljs-number"><span class="hljs-number">8.8.4.4</span></span> valid=<span class="hljs-number"><span class="hljs-number">300s</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">resolver_timeout</span></span> <span class="hljs-number"><span class="hljs-number">5s</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">add_header</span></span> Strict-Transport-Security <span class="hljs-string"><span class="hljs-string">"max-age=63072000; includeSubdomains"</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">add_header</span></span> X-Frame-Options DENY; <span class="hljs-attribute"><span class="hljs-attribute">add_header</span></span> X-Content-Type-Options nosniff; <span class="hljs-attribute"><span class="hljs-attribute">ssl_dhparam</span></span> /etc/ssl/certs/dhparam.pem; <span class="hljs-attribute"><span class="hljs-attribute">root</span></span> /home/<span class="hljs-variable"><span class="hljs-variable">$USER_NAME</span></span>/<span class="hljs-variable"><span class="hljs-variable">$hostname</span></span>/public; <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> / { <span class="hljs-comment"><span class="hljs-comment"># try to serve file directly, fallback to index.php try_files $uri /index.php$is_args$args; } location ~ ^/index\.php(/|$) { fastcgi_pass unix:/var/run/php-fpm/php-fpm.sock; fastcgi_split_path_info ^(.+\.php)(/.*)$; include fastcgi_params; fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name; fastcgi_param DOCUMENT_ROOT $realpath_root; internal; } location ~ \.php$ { return 404; } error_log /var/log/nginx/______.error.log; access_log /var/log/nginx/______.access.log; } server { listen 443 ssl; server_name www.$hostname; ssl_certificate /etc/letsencrypt/live/www.______/fullchain.pem; ssl_certificate_key /etc/letsencrypt/live/www.______/privkey.pem; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; return 301 https://$hostname$request_uri; } server { server_name $hostname www.$hostname; return 301 https://$hostname$request_uri; }</span></span></code> </pre> <br>  Save the result and tell nginx to re-read the configuration: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">nginx</span></span> -s reload</code> </pre> <br>  Since Let's Encrypt need to be updated every three months, we will configure automatic renewal in the scheduler, for example, on Monday night <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">crontab</span></span> -e</code> </pre> <br>  15 4 * * 1 / usr / bin / certbot renew --quiet <br>  18 4 * * 1 / usr / bin / systemctl reload nginx <br><br>  So that the application being deployed does not have rights problems, we change the owner of the following folder: <br><br><pre> <code class="hljs perl"><span class="hljs-keyword"><span class="hljs-keyword">chown</span></span> -R ${USER_NAME}:${USER_NAME} /var/lib/nginx</code> </pre> <br>  That's it, the system is ready.  Reboot to make sure that all the necessary software is configured correctly and will not behave differently after the reboot, then you can delete the project folder we created in the user directory and clone the necessary working repository in it.  Do not forget to create a folder for storing user sessions: <br><br><pre> <code class="hljs perl"><span class="hljs-keyword"><span class="hljs-keyword">mkdir</span></span> -p ${DOMAIN_NAME}/var/sessions</code> </pre> <br>  <b>UPD</b> : <br>  On the advice of <a href="https://habr.com/users/amet13/" class="user_link">Amet13</a> , teams use variables + package <a href="https://habr.com/users/amet13/" class="user_link">bundling</a> into a consistent "silent" installation. <br><br>  <b>UDP 2</b> : <br>  In PHP-FPM settings, the folder for storing sessions has been changed to the ‚Äúlocal‚Äù project folder to prevent problems with access rights. </div><p>Source: <a href="https://habr.com/ru/post/419121/">https://habr.com/ru/post/419121/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../419109/index.html">"Clarify for bangs" in Android P. What to do with Android Cutout?</a></li>
<li><a href="../419111/index.html">Digest of grocery design, July 2018</a></li>
<li><a href="../419115/index.html">Boot CD and retro play in one tweet</a></li>
<li><a href="../419117/index.html">‚ÄúI find it difficult to understand the motivation of a data scientist who does not see beauty in mathematics‚Äù - Kirill Danilyuk, Data Scientist</a></li>
<li><a href="../419119/index.html">Montblanc Premium Premium Pen - The Most Expensive Smart Pen Today</a></li>
<li><a href="../419125/index.html">Return of the Soviet station. Analysis and documents</a></li>
<li><a href="../419127/index.html">Three reincarnations online store. How to drain money, time and why templates are good</a></li>
<li><a href="../419129/index.html">Multi-agent systems in the construction of virtual spaces</a></li>
<li><a href="../419131/index.html">The preliminary launch date of the SpaceIL lunar module has been announced.</a></li>
<li><a href="../419133/index.html">Friday webinars: learning to program for free</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>