<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>23,000 people wrote online dictation on April 8, 2017. How did this happen?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This year 200 thousand people from 858 cities of the world took part in the educational campaign ‚ÄúTotal dictation‚Äù. They have been writing dictation f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>23,000 people wrote online dictation on April 8, 2017. How did this happen?</h1><div class="post__text post__text-html js-mediator-article">  This year 200 thousand people from 858 cities of the world took part in the educational campaign ‚ÄúTotal dictation‚Äù.  They have been writing dictation for seven years, mostly on offline platforms, the ability to do this online has been available since 2014.  Having experienced all the sorrows of extreme loads on the site, this year the organizers of the action attracted a whole team of IT companies.  Today we talk about our part of the work. <br><br><img src="https://habrastorage.org/web/66f/5b7/ff6/66f5b7ff691a4e5d8b2b0b7bcb85b392.jpg" alt="image"><br><a name="habracut"></a>  photo: Valery Melnikov, RIA News <br><br>  The Foundation "Total Dictation" began promotion of the action in February - then the online preparation classes started and the first publications went to the media.  Each lesson was watched by an average of 13,990 people - of course, on the day of the dictation an even greater load on the site was assumed.  Last year, during a dictation, a DDoS attack fell on the server, due to which the site was unavailable for some time.  For the performance of the site answered: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  CMS "1C-Bitrix" (functionality and interface); </li><li>  "Bitriksoid" (technical support); </li><li>  "Servionika" (cloud hosting); </li><li>  Atlas Scientific and Technical Center (protection against bots and DDoS attacks); </li><li>  ITSumma (preparation of IT infrastructure and servers); </li><li>  Stepik (platform for online dictation). </li></ul><br><h3>  Preparing the site for the load </h3><br>  Prior to the start of our work, the project was placed on a simple virtual server with the following characteristics: 2 CPU cores, 4 GB of RAM, HDD. <br><br>  Initially, the project team suggested that 120 RPS would come to the server on the day of the action, and 1000 visitors would come to the site every minute.  To find out how much RPS server can withstand now, and what server configuration is required for peak load, a load test was performed on the server by Yandex.Tank.  The final configuration of the main and backup servers looked like this: 48 CPU cores, 128 GB of RAM, 250 GB SSD. <br><br>  For the period of preparation of the project for the peak load, we made an upgrade of the virtual server with the site - so that it was possible to carry out all the necessary optimizations both in terms of settings and in terms of code. <br><br>  In parallel with the load testing, the anti-DDoS provider was connected to the site.  What he looked like: <br><br><ol><li>  All A-records of the site were switched to IP anti-DDoS. </li><li>  The mail server settings have been changed so that the real IP of the project never appears in the headers of outgoing emails. </li><li>  On the side of antiddos, the filtering of all requests coming to the site and their subsequent proxying to the project servers were configured. </li></ol><br>  Initially, new servers were planned to be divided, and one server should be made as the main one, and the other one - as a backup one, in case the main one falls.  But during the load tests to increase the total capacity of the system, it was decided to use a backup server to process requests for backend (in our case - php-fpm).  Backend requests between the primary and backup servers were balanced using nginx on the primary server.  MySQL was configured as a shared session storage - ‚Äú1C-Bitrix‚Äù allows you to do this without the need to modify server settings. <br><br>  A week and a half before the day of the dictation, the project was switched to new servers.  To do this, they first created a complete copy of the old server - including all software settings, site files, databases.  The switching process itself looked like this: <br><br><ol><li>  Configured database replication and project file synchronization from the old server to the new one. </li><li>  At the time of switching, proxying of all requests from the old server to the new one was enabled using nginx. </li><li>  Disable DB replication. </li></ol><br>  On the side of the anti-DDoS provider, the addresses of the target servers were changed so that all traffic would flow to the new servers. <br><br>  After the site was transferred, the final load testing was carried out - a load of 500 RPS was emulated, since  the organizers suggested that there would be more visitors than they thought.  As a result of the tests, it was found that due to the use of MySQL for storing sessions, the load on the disks turned out to be quite large, and in peaks this could lead to problems.  Therefore, it was decided to reconfigure the sessions for storage in memcache - the load testing carried out after that showed that with the expected load on the current hardware the ‚Äúnarrow‚Äù places should not appear. <br><br><h3>  Load on the day of the promotion </h3><br>  In general, a project in which several independent parties are involved at once is always a challenge, always a risk.  Therefore, before the start, despite all the preparatory work, load testing, code audits, and so on, there still remained some tension and jim-jams. <br><br><img src="https://habrastorage.org/web/e85/075/538/e85075538e0a474882c9a82e814732cf.jpg" alt="image"><br><br>  The dictation started on April 8, 2017 at 15:00 Vladivostok (GMT +10).  At the start, the load was minimal - about 20 requests per second for the dynamics.  But relax, of course, was not worth it.  To the largest broadcast, the last one, at 14:00 Moscow time, we allocated more memory for caching in Memcache, carried out the same sessions, so that there was less load on the disks.  The broadcast went without any fixed problems, the load was controlled, everything worked quickly, correctly. <br><br><img src="https://habrastorage.org/web/4d0/65e/742/4d065e74204142daa991969e69168573.jpg" alt="image"><br><br>  Here is how the picture of loads on that day looked (time on the Irkutsk charts, GMT +8). <br><br><h3>  The overall result </h3><br>  Everybody tried!  We transferred the data on load monitoring to our colleagues from ‚ÄúTotal dictation‚Äù to draw up a plan for the next year. <br><br><img src="https://habrastorage.org/web/b2f/0ed/227/b2f0ed2275b240a2942445bd9e05c463.jpg" alt="image"><br><br>  On April 8, the Internet watched the rally of 90,000 viewers, wrote a dictation online of 23,000 people.  From 9 to 18 April, 454798 unique users visited the site, who viewed four million pages - the participants learned their ratings and watched webinars with an analysis of errors.  The preparation for the dictation on April 14, 2018, the organizers have already begun - <a href="http://totaldict.ru/education/online/">pull up too</a> (repeat the rules of the Russian language on the online courses), all dictation! <br><br>  PS On October 13, we are holding a free Uptime Day conference in Moscow on accidents in IT infrastructure: details <a href="https://habrahabr.ru/company/itsumma/blog/338432/">in yesterday's post</a> , registration <a href="http://uptime.community/ru/uptimeday-2">on the site</a> . </div><p>Source: <a href="https://habr.com/ru/post/338506/">https://habr.com/ru/post/338506/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../338492/index.html">How I wrote my CMS, and why I do not recommend you do the same.</a></li>
<li><a href="../338494/index.html">How Android works, part 3</a></li>
<li><a href="../338496/index.html">VMworld 2017 Europe Conference. Day 2, 3</a></li>
<li><a href="../338498/index.html">Using Zabbix to monitor MS SQL Server database</a></li>
<li><a href="../338502/index.html">Full-stack-developers. New trend or real need of companies?</a></li>
<li><a href="../338512/index.html">Evolution: from interns to interns</a></li>
<li><a href="../338514/index.html">And the skies will tremble ... Diablo: looking back</a></li>
<li><a href="../338518/index.html">MVVM: Complete Understanding (+ WPF) Part 1</a></li>
<li><a href="../338520/index.html">Security Week 38: Security cameras pass over the IR, the neural network quickly selects passwords, hackers scout through Word</a></li>
<li><a href="../338522/index.html">What did the UFO see when they arrived at RIT ++ 2017</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>