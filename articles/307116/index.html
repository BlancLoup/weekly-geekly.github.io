<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating and using extensions for UWP applications using App Services</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the recent Anniversary Update there was such a wonderful thing as App Extensions. Unfortunately, at the moment there is only one video from the doc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating and using extensions for UWP applications using App Services</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://i.imgur.com/Nyh2ZWD.png" alt="image"></p><br><p>  In the recent Anniversary Update there was such a wonderful thing as App Extensions.  Unfortunately, at the moment there is only one video from the documentation on it and a pair of GitHub repositories.  But I was able to collect all the necessary information on the use of this feature, and now I will tell you how to write an expandable application. </p><br><p>  And yes, you will need an SDK version no lower than 14393. </p><a name="habracut"></a><br><h1>  How it will work </h1><br><p>  We will have one host application to which extensions will connect.  Each extension will contain a service (App Service), with which the application will interact with the extension. </p><br><h3>  Little about services </h3><br><p> In a UWP application, you can‚Äôt just grab a dynamic library on the fly.  This is done for security purposes.  Instead, you can communicate with another application using simple data types (their list is very limited).  This application should announce that it has a service with which to communicate, and this announcement is written in the application manifest (Package.appxmanifest).  All communication takes place by connecting to the service, sending him messages, and receiving a response.  Both messages and responses are transmitted using the <code>ValueSet</code> (in fact, it‚Äôs just a <code>Dictionary&lt;string, object&gt;</code> ), and, as mentioned earlier, only the simplest data types (numbers, strings, arrays) can be used as values. </p><br><p>  So, we proceed. </p><br><h1>  Creating a host application </h1><br><p>  For convenience, all projects will be placed in one solution.  Open Visual Studio and create an empty UWP application with a minimum version of 14393. I will call it Host. </p><br><p><img src="https://i.imgur.com/2JfknxX.png" alt="image"></p><br><p>  Now we need to edit the manifest.  Open Package.appxmanifest in code mode, and first we find <code>&lt;Package</code> , add a new namespace: <code>xmlns:uap3="http://schemas.microsoft.com/appx/manifest/uap/windows10/3"</code> and add uap3 to IgnorableNamespaces.  The result should be something like this: </p><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Package</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/appx/manifest/foundation/windows10"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:mp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/appx/2014/phone/manifest"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:uap</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/appx/manifest/uap/windows10"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:uap3</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/appx/manifest/uap/windows10/3"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IgnorableNamespaces</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"uap mp uap3"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Further we look for <code>&lt;Application&gt;</code> and inside it we add the following: </p><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Extensions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uap3:Extension</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Category</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"windows.appExtensionHost"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uap3:AppExtensionHost</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uap3:Name</span></span></span><span class="hljs-tag">&gt;</span></span>com.extensions.myhost<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uap3:Name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uap3:AppExtensionHost</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uap3:Extension</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Extensions</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Here we declare a new host for extensions.  It is by this name that the extensions will connect, and we will look for them.  The studio can start swearing, nothing terrible about it. </p><br><div class="spoiler">  <b class="spoiler_title">Result</b> <div class="spoiler_text"><pre> <code class="hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Package</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/appx/manifest/foundation/windows10"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:mp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/appx/2014/phone/manifest"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:uap</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/appx/manifest/uap/windows10"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:uap3</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/appx/manifest/uap/windows10/3"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IgnorableNamespaces</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"uap mp uap3"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Identity</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"9df790c4-956b-400b-8710-08a834e39c5a"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Publisher</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"CN=acede"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.0.0.0"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mp:PhoneIdentity</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">PhoneProductId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"9df790c4-956b-400b-8710-08a834e39c5a"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">PhonePublisherId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"00000000-0000-0000-0000-000000000000"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DisplayName</span></span></span><span class="hljs-tag">&gt;</span></span>Host<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DisplayName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PublisherDisplayName</span></span></span><span class="hljs-tag">&gt;</span></span>acede<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PublisherDisplayName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Logo</span></span></span><span class="hljs-tag">&gt;</span></span>Assets\StoreLogo.png<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Logo</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TargetDeviceFamily</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Windows.Universal"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">MinVersion</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10.0.0.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">MaxVersionTested</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10.0.0.0"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Resources</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Resource</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Language</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"x-generate"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Resources</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Applications</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Application</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"App"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Executable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$targetnametoken$.exe"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">EntryPoint</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Host.App"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Extensions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uap3:Extension</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Category</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"windows.appExtensionHost"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uap3:AppExtensionHost</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uap3:Name</span></span></span><span class="hljs-tag">&gt;</span></span>com.extensions.myhost<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uap3:Name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uap3:AppExtensionHost</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uap3:Extension</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uap:VisualElements</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">DisplayName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Host"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Square150x150Logo</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Assets\Square150x150Logo.png"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Square44x44Logo</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Assets\Square44x44Logo.png"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Description</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Host"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BackgroundColor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"transparent"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uap:DefaultTile</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Wide310x150Logo</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Assets\Wide310x150Logo.png"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uap:SplashScreen</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Image</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Assets\SplashScreen.png"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uap:VisualElements</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Application</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Applications</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Capabilities</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Capability</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"internetClient"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Capabilities</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Package</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </div></div><br><p>  Now we will write the code to search for extensions.  In this example, I will not do UI, architecture, etc., but just do everything in one class.  Of course, you shouldn‚Äôt do this in a real application, but for the sake of simplification you can </p><br><p>  Go to MainPage.xaml.cs, delete everything and write the following: </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Windows.ApplicationModel.AppExtensions; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Windows.UI.Xaml; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Windows.UI.Xaml.Controls; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Host</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MainPage</span></span> : <span class="hljs-title"><span class="hljs-title">Page</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MainPage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { InitializeComponent(); Loaded += OnLoaded; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnLoaded</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs routedEventArgs</span></span></span><span class="hljs-function">)</span></span> { AppExtensionCatalog catalog = AppExtensionCatalog.Open(<span class="hljs-string"><span class="hljs-string">"com.extensions.myhost"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> extensions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;AppExtension&gt;(<span class="hljs-keyword"><span class="hljs-keyword">await</span></span> catalog.FindAllAsync()); } } }</code> </pre> <br><p>  Let's look at what happens in the OnLoaded method.  First of all, we need to open the extension directory using <code>AppExtensionCatalog.Open</code> .  As an argument, we give him the name of the host, which was previously indicated in the manifest.  After that, we get all the extensions in the directory.  Since we do not have a user interface, it makes sense to put the breakpoint method at the end.  Already you can run the application, you will see that we do not have extensions (which is logical).  So let's write the first! </p><br><h1>  Creating an extension </h1><br><p>  As an extension, we will create a simple calculator with 4 operations and 2 operands.  Again we create an empty UWP application (the application itself), call it Calculator, go to the manifest and add the namespace (as in the host application).  Now we‚Äôre looking for <code>&lt;Application&gt;</code> again, but adding the code is different: </p><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Extensions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uap3:Extension</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Category</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"windows.appExtension"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uap3:AppExtension</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.extensions.myhost"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">PublicFolder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Public"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Calculator"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">DisplayName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Calculator"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Description</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"This is a calculator"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uap3:Properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Service</span></span></span><span class="hljs-tag">&gt;</span></span>com.mycalculator.service<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Service</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uap3:Properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uap3:AppExtension</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uap3:Extension</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Extensions</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Consider this declaration in more detail.  To begin with, we are declaring an application extension.  This ad has several options: </p><br><ul><li>  Name - the host name of the extensions (the same from the manifest) </li><li>  PublicFolder is a public folder to which the host has access.  In this example, it is not used, but it is worth knowing about it. </li><li>  Id - unique id of the extension </li><li>  DisplayName - extension name </li><li>  Description - Description </li></ul><br><p>  Next comes the thing like Properties.  Here you can declare your specific parameters.  In this case, we announce the name of our service (about it very soon). <br>  The expansion framework is ready, you can test: choose Buld&gt; Deploy Solution, start Host, and see our extension!  Magic.  Let's get him to do something now, no time to rest! </p><br><h1>  Creating a service </h1><br><p>  We will render the service in a separate project, because  placing it in the same project as the extension application requires additional code modifications.  We create a new project, only this time we need the Windows Runtime Component (the Class Library doesn‚Äôt fit to VERY great regret).  We remove the Class1 we do not need and create the Service class we need.  We will write it step by step. </p><br><ol><li><p>  Add the required using'i: </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">using</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">System</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">using</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Windows</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ApplicationModel</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.AppService</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">using</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Windows</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ApplicationModel</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Background</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">using</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Windows</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Foundation</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Collections</span></span>;</code> </pre> <br></li><li><p>  Implement the IBackgroundTask interface in Service: <br>  We will have an empty Run method like this <br> <code>public void Run(IBackgroundTaskInstance taskInstance) { }</code> <br>  <em>Explanation: Any service is a background task.</em>  <em>But background tasks apply not only to services.</em>  <em>You can read more, for example, <a href="https://msdn.microsoft.com/en-us/windows/uwp/launch-resume/create-and-register-a-background-task">on MSDN</a></em> </p><br></li><li><p>  Create a field for deferral: <br> <code>private BackgroundTaskDeferral _deferral;</code> <br>  It is needed so that our task does not end suddenly. </p><br></li><li><p>  Add the following code to Run: </p><br><pre> <code class="hljs pgsql">_deferral = taskInstance.GetDeferral(); taskInstance.Canceled += TaskInstanceOnCanceled; var serviceDetails = (AppServiceTriggerDetails) taskInstance.TriggerDetails; AppServiceConnection <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span> = serviceDetails.AppServiceConnection; <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>.ServiceClosed += ConnectionOnServiceClosed; <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>.RequestReceived += ConnectionOnRequestReceived;</code> </pre> <br><p>  So first we assign our deferral background task to our deferral.  Next, we add an event handler for the cancel task.  This is necessary so that we can release our deferral and allow the task to complete.  Then, we get information directly related to our service, and register two handlers.  ServiceClosed is called when the source of a task call destroys the calling object.  In RequestReceived, all the processing of the request will occur. </p><br></li><li><p>  Create handlers for two events related to deferral release: </p><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConnectionOnServiceClosed</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">AppServiceConnection sender, AppServiceClosedEventArgs args</span></span></span><span class="hljs-function">)</span></span> { _deferral?.Complete(); }</code> </pre> <br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TaskInstanceOnCanceled</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IBackgroundTaskInstance sender, BackgroundTaskCancellationReason reason</span></span></span><span class="hljs-function">)</span></span> { _deferral?.Complete(); }</code> </pre> <br></li><li><p>  Write a method to perform the calculations. </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> double <span class="hljs-type"><span class="hljs-type">Execute</span></span>(string op, double <span class="hljs-keyword"><span class="hljs-keyword">left</span></span>, double <span class="hljs-keyword"><span class="hljs-keyword">right</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (op) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"+"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">left</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">right</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"-"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">left</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">right</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"*"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">left</span></span>*<span class="hljs-keyword"><span class="hljs-keyword">right</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"/"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">left</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">right</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">left</span></span>; } }</code> </pre> <br><p>  There is nothing supernatural, the method takes an operator and two operands, returns the result of the calculations. </p><br></li><li><p>  The most flesh.  Writing a handler for RequestReceived: </p><br><pre> <code class="hljs ruby">private async void ConnectionOnRequestReceived(AppServiceConnection sender, AppServiceRequestReceivedEventArgs args) { var deferral = args.GetDeferral(); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  defferal,     AppServiceRequest request = args.Request; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   var op = request.Message[<span class="hljs-string"><span class="hljs-string">"Operator"</span></span>].ToString(); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  var left = (double) request.Message[<span class="hljs-string"><span class="hljs-string">"Left"</span></span>]; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  var right = (double) request.Message[<span class="hljs-string"><span class="hljs-string">"Right"</span></span>]; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   var result = Execute(op, left, right); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    await request.SendResponseAsync(new ValueSet /<span class="hljs-regexp"><span class="hljs-regexp">/    { ["Result"] = result }); deferral.Complete(); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  deferral }</span></span></code> </pre> <br></li></ol><br><p>  We wrote our service, it's time to use it! </p><br><h1>  We put everything together </h1><br><p>  First, we need to announce our service.  Go to the manifest of our extension, go to Extensions and write the following there: </p><br><pre> <code class="hljs pgsql">&lt;uap:<span class="hljs-keyword"><span class="hljs-keyword">Extension</span></span> Category="windows.appService" EntryPoint="CalculatorService.Service"&gt; &lt;uap:AppService <span class="hljs-type"><span class="hljs-type">Name</span></span>="com.mycalculator.service" /&gt; &lt;/uap:<span class="hljs-keyword"><span class="hljs-keyword">Extension</span></span>&gt;</code> </pre> <br><p>  Here we declare the name of the service and the class in which it is implemented. <br>  <strong>We add reference on CalculatorService to Calculator</strong> </p><br><p>  Now we need to connect from the host to our service.  Go back to MainPage.xaml.cs and add the code to our super method: </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> calculator = extensions[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> serviceName = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> GetServiceName(calculator); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> packageFamilyName = calculator.Package.Id.FamilyName; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> UseService(serviceName, packageFamilyName);</code> </pre> <br><p>  Here we get the name of the service and the name of the package family (and this and that will be needed to connect to the service) from the extension data. </p><br><p>  GetServiceName method: </p><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetServiceName</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">AppExtension calculator</span></span></span><span class="hljs-function">)</span></span> { IPropertySet properties = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> calculator.GetExtensionPropertiesAsync(); PropertySet serviceProperty = (PropertySet) properties[<span class="hljs-string"><span class="hljs-string">"Service"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> serviceProperty[<span class="hljs-string"><span class="hljs-string">"#text"</span></span>].ToString(); }</code> </pre> <br><p>  Here we extract the service name we specified earlier in the extension manifest, using some semblance of working with XML. </p><br><p>  Now we will write the last method, which will finally start doing something specific: </p><br><pre> <code class="hljs pgsql">private async Task UseService(string serviceName, string packageFamilyName) { var <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> AppServiceConnection { AppServiceName = serviceName, PackageFamilyName = packageFamilyName }; //   var message = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ValueSet { ["Operator"] = "+", ["Left"] = <span class="hljs-number"><span class="hljs-number">2</span></span>D, ["Right"] = <span class="hljs-number"><span class="hljs-number">2</span></span>D }; //    var status = await <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>.OpenAsync(); //   <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (status != AppServiceConnectionStatus.Success) //   { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } var response = await <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>.SendMessageAsync(message); //      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (response.Status == AppServiceResponseStatus.Success) { var result = (<span class="hljs-type"><span class="hljs-type">double</span></span>) response.Message["Result"]; //   } } }</code> </pre> <br><p>  Do not forget about the Build&gt; Deploy solution. <br>  And, if you did everything right, you should have this: <br><img src="https://i.imgur.com/wostzZ2.png" alt="image"></p><br><p>  If it works out, congratulations - you wrote your full (relatively) modular application on UWP!  (And if not, write in the comments) </p><br><h1>  Additionally </h1><br><ol><li><p>  AppExtensionCatalog has several events that you can use to monitor the states of extensions. <br>  Here is a list of them: </p><br><ul><li>  PackageInstalled </li><li>  PackageStatusChanged </li><li>  PackageUninstalling </li><li>  PackageUpdated </li><li>  Packageupdating </li></ul><br></li><li>  You may want to verify the signature of the extensions.  This will help you AppExtension.Package.SignatureKind </li></ol></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/307116/">https://habr.com/ru/post/307116/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../307104/index.html">Fighting the mysterious falls of MSBuild on XamlTaskFactory</a></li>
<li><a href="../307108/index.html">Video of the conference "Payment innovations and alternative payment systems"</a></li>
<li><a href="../307110/index.html">Is there software for KCS (knowledge-centered support)?</a></li>
<li><a href="../307112/index.html">4 virtual reality helmets that you can buy now</a></li>
<li><a href="../307114/index.html">Veramine - a new security product from former MSRC specialists</a></li>
<li><a href="../307118/index.html">&? Trim? Heisenberg? No, have not heard</a></li>
<li><a href="../307120/index.html">As a result of hacking a famous opensource hosting, distributions of Audacity, Classic Shell and others were infected.</a></li>
<li><a href="../307126/index.html">Summer Deadline: Top 10 Microsoft Virtual Academy Courses</a></li>
<li><a href="../307130/index.html">How to easily work with OneDrive from UWP apps</a></li>
<li><a href="../307132/index.html">Development of BPEL business process stubs based on Oracle SOA Suite and Weblogic</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>