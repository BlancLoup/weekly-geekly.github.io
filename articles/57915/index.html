<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SQLite and full UNICODE</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Probably many people know the embed SQLite database. SQLite fully supports UTF-8 and UTF-16 encodings. But there is one caveat, for string and text fi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SQLite and full UNICODE</h1><div class="post__text post__text-html js-mediator-article">  Probably many people know the embed <a href="http://www.sqlite.org/">SQLite</a> database.  SQLite fully supports UTF-8 and UTF-16 encodings.  But there is one caveat, for string and text fields whose characters extend beyond the ASCII table, case-insensitive LIKE and ORDER BY do not work. <br>  For example: <br><pre> sqlite&gt; SELECT s "LIKE s";
 0
</pre>  while <br><pre> sqlite&gt; SELECT "s" LIKE "S";
 one
</pre>  Let's see how to fix it. <br><a name="habracut"></a><br>  A long google leads us to the <a href="http://www.sqlite.org/cvstrac/fileview%3Ff%3Dsqlite/ext/icu/README.txt">ICU</a> extension for SQLite.  As can be seen from the readme, the ICU extension replaces the functions upper () and lower (), which are responsible for converting the case of characters.  In addition, this extension adds the implementation of the REGEXP operator, for selecting text fields by a regular expression (SQLite at the language level supports the REGEXP operator, but the function that implements it is supplied without implementation, with the expectation of a custom implementation). <br><br>  To get started with ICU extensions, you first need to compile it into a dynamic library. <br>  This will require the unicode support library icu, and the extension ICU code itself: <br>  For Mac OS (assuming macports is installed): <br><pre> $ sudo port install icu
 $ wget http://www.sqlite.org/cvstrac/getfile?f=sqlite/ext/icu/icu.c
 $ gcc -dynamiclib icu.c -o libsqliteicu.dylib `icu-config --cppflags`` icu-config --ldflags`
</pre>  Or Debian: <br><pre> $ sudo apt-get install libicu-dev
 $ wget http://www.sqlite.org/cvstrac/getfile?f=sqlite/ext/icu/icu.c
 $ gcc -shared icu.c -o libsqliteicu.so `icu-config --cppflags`` icu-config --ldflags`
</pre><br>  Now run the SQLite3 CLI, and enjoy the result :) <br><pre> $ sqlite3
 load the extension
 sqlite&gt; .load libsqliteicu.dylib
 we set Russian collation
 sqlite&gt; SELECT icu_load_collation ('en_US', 'RUSSIAN');
 sqlite&gt; SELECT s "LIKE s";
 one
</pre><br>  But in the end, everything is not so simple.  To load an extension through the API and not through the CLI, you need to call the function <a href="http://www.sqlite.org/c3ref/enable_load_extension.html">sqlite3_enable_load_extension</a> .  If the SQLite driver for your language has a wrapper for this function, or you write in C / C ++, then everything is fine.  But the ruby ‚Äã‚Äãfor ruby ‚Äã‚Äãruby-sqlite3, this function does not support ... <br><br>  The first thought is to add this function to the driver :) But, the option was found simpler.  It turns out that the ICU extension can be embedded in SQLite. <br><pre> $ wget http://www.sqlite.org/sqlite-amalgamation-3.6.13.tar.gz
 $ tar xzfv sqlite *
 $ cd sqlite *
 $ CFLAGS = '- Os -DSQLITE_ENABLE_ICU' CPPFLAGS = `icu-config --cppflags` LDFLAGS =` icu-config --ldflags` ./configure
 $ make &amp;&amp; sudo make install
</pre><br>  After that, reinstall the adapter for Ruby (to rebuild), and rejoice in solving the problem :) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      But, of course, not without its drawbacks.  Because of its dependence on ICU, the library will weigh several megabytes, which is not very good for an embed database.  If sqlite is used for the site (as in my case), then this should not worry. <br>  The solution may be to create your own collation using <a href="http://www.sqlite.org/c3ref/create_collation.html">sqlite3_create_collation</a> . <br><br>  <b>UPD:</b> For those who use the Ruby Sequel library.  As I said above, ICU extension also adds a REGEXP statement.  But, if in Sequel try to execute a query with regular expressions, like so <pre> p DB [: artists] .filter (: name =&gt; /^a.*/i).all
</pre>  then throws an exception that SQLite does not support regular expressions. <br>  To get around this, I wrote a small <a href="http://pastie.org/454830">monkey patch</a> . <br></div><p>Source: <a href="https://habr.com/ru/post/57915/">https://habr.com/ru/post/57915/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../57906/index.html">Ten dollar eco-friendly communicator i-wood 3B</a></li>
<li><a href="../57907/index.html">On TagLayne harness :)</a></li>
<li><a href="../57908/index.html">Red Hat has compiled a distribution map of interest in open source software.</a></li>
<li><a href="../57910/index.html">Skype office</a></li>
<li><a href="../57911/index.html">Zend Studio for Eclipse 6.1.2</a></li>
<li><a href="../57916/index.html">Peter principle and successful programmers</a></li>
<li><a href="../57918/index.html">IFPI DoS Hackers (iat) in retaliation for Pirate Bay</a></li>
<li><a href="../57919/index.html">Jokes gmail</a></li>
<li><a href="../57920/index.html">Do you know that ... in Japan they do not send sms, in Japan they exchange mini-emails</a></li>
<li><a href="../57921/index.html">Our Russia at Silverlight - RuTube made a Smooth Streaming site</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>