<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>BBR system: congestion control directly by congestion</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Measurement of throughput of bottlenecks in time of double pass packet 
 By all measures, today's Internet cannot transfer data as quickly as it shoul...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>BBR system: congestion control directly by congestion</h1><div class="post__text post__text-html js-mediator-article"><h3>  Measurement of throughput of bottlenecks in time of double pass packet </h3><br>  By all measures, today's Internet cannot transfer data as quickly as it should.  Most mobile users in the world experience delays from a few seconds to a few minutes: public WiFi points at airports and conferences are even worse.  Physicists and climatologists need to share petabytes of data with colleagues around the world, but they are faced with the fact that their carefully designed multi-gigabit infrastructure often yields just a few megabits per second on transcontinental lines.  [6] <br><br>  These problems arose because of the choice of architecture that was made when creating the TCP congestion control system in the 1980s ‚Äî then they decided to interpret the packet loss as a ‚Äújam‚Äù.  [13] The equivalence of these concepts was fair for that time, but only because of the limitations of the technology, and not by definition.  When NICs (network interface controllers) were upgraded from megabyte to gigabit speeds, and memory chips from kilobytes to gigabytes, the connection between packet loss and congestion became less obvious. <br><br>  In today's TCP, congestion control for packet loss ‚Äî even in the most advanced technology of this kind of CUBIC [11] ‚Äîis the main cause of these problems.  If bottlenecks are too large, the congestion control system for packet loss keeps them full, causing excessive network buffering.  If the buffers are too small, then the congestion control system for packet loss incorrectly interprets packet loss as a congestion signal, which leads to a decrease in throughput.  Solving these problems requires an alternative to congestion control for packet loss.  To find this alternative, it is necessary to understand where and how congestion occurs. <br><a name="habracut"></a><br><h1>  Clogging and bottleneck </h1><br>  At any given time in a (full duplex) TCP connection there is only one slowest link or <i>bottleneck</i> in each direction.  The bottleneck is important for the following reasons: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  It determines the maximum data transfer rate for the connection.  This is the main property of an uncompressed data stream (for example, imagine a six-lane highway during rush hours if, due to accidents, one small segment of the road is limited to just one lane. The traffic in front of the crash site will move no faster than the traffic through this lane. <br><br></li><li>  This is the place where queues are constantly formed.  They are reduced only if the intensity of the outflow from the bottleneck exceeds the intensity of the incoming stream.  For connections operating at the maximum transfer rate, all outgoing flows to the bottleneck always have a higher outgoing flow rate, so the queues move to the bottleneck. </li></ul><br>  Regardless of how many links are in a connection and what their speeds are separately, from a TCP point of view, an arbitrarily complex route is represented as a single connection with the same RTT (time of double pass of a packet, i.e., round trip time) and throughput of the bottleneck .  Two physical constraints, <i>RTprop</i> (round-trip propagation time, packet double pass time) and <i>BtlBw</i> (bottleneck bandwidth), affect transmission performance.  (If the network path were a material pipe, RTprop would be a pipe length, and BtlBw would be its diameter). <br><br>  Figure 1 shows various combinations of RTTs and transfer rates with the amount of data <i>in flight</i> , that is, inflight (data sent, but without confirmation of delivery).  The blue lines show the RTprop limit, the green lines show the BtlBw limit, and the red lines show the bottleneck buffer.  Operations in gray areas are impossible, since they contradict at least one restriction.  Transitions between the restrictions led to the formation of three regions (app-limited, bandwidth-limited and buffer-limited) with qualitatively different behavior. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/465/141/4c0/4651414c01034662067e3e902c75830c.png"><br>  <i>Picture 1</i> <br><br>  When there is not enough data in flight to fill the tube, RTprop determines the behavior;  otherwise, BtlBw dominates.  Limit lines intersect at <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-6">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-7">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-8">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-9">t</span><span class="MJXp-mo" id="MJXp-Span-10" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-11">B</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-12">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-13">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-14">B</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-15">w</span><span class="MJXp-mo" id="MJXp-Span-16" style="margin-left: 0.267em; margin-right: 0.267em;">√ó</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-17">R</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-18">T</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-19">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-20">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-21">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-22">p</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="28.845ex" height="2.419ex" viewBox="0 -780.1 12419.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-69" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-6E" x="345" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-66" x="946" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-6C" x="1496" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-69" x="1795" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-67" x="2140" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-68" x="2621" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-74" x="3197" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMAIN-3D" x="3836" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-42" x="4893" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-74" x="5652" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-6C" x="6014" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-42" x="6312" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-77" x="7072" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMAIN-D7" x="8010" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-52" x="9011" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-54" x="9771" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-70" x="10475" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-72" x="10979" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-6F" x="11430" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-70" x="11916" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-1"> inflight = BtlBw √ó RTprop </script>  It is a BDP pipe (bandwidth-delay product, a derivative of throughput and delay).  Since the pipe is full after this point, the excess <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-23"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-24">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-25">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-26">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-27">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-28">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-29">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-30">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-31">t</span><span class="MJXp-mo" id="MJXp-Span-32" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-33">B</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-34">D</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-35">P</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="16.54ex" height="2.419ex" viewBox="0 -780.1 7121.4 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-69" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-6E" x="345" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-66" x="946" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-6C" x="1496" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-69" x="1795" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-67" x="2140" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-68" x="2621" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-74" x="3197" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMAIN-2212" x="3781" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-42" x="4781" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-44" x="5541" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-50" x="6369" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-2"> inflight - BDP </script>  creates a queue to a bottleneck, which leads to a linear dependence of the RTT on the inflight data shown in the upper graph.  Packets are discarded when the excess exceeds the buffer capacity.  <i>A gate</i> is just a continuous presence to the right of the BDP line, and <i>congestion control</i> is a kind of scheme for setting a limit on how far to the right of the BDP line data transmission takes place, on average. <br><br>  Loss congestion regulation operates on the right border of the area limited by the channel bandwidth (bandwidth-limited), ensuring full bottleneck bandwidth due to large delays and frequent packet loss.  At the time when the memory was expensive, the buffer sizes only slightly exceeded the BDP, which minimized the excessive delay in controlling the congestion for losses.  Subsequent reductions in memory prices led to an increase in excessive network buffering and an increase in RTT to seconds instead of milliseconds.  [9] <br><br>  At the left edge of the area, limited by the channel capacity, there is a working point with better conditions than the right.  In 1979, Leonard Kleinrock [16] showed that this operating point is optimal, it maximizes the actual throughput while minimizing delays and losses, both for individual connections and for the network as a whole [8].  Unfortunately, at about the same time, Jeffrey Jaffe proved that it is impossible to create a distributed algorithm that converges at this operating point.  This conclusion has changed the direction of research.  Instead of searching for a distributed algorithm that seeks an optimal Kleinrock operating point, researchers began to explore alternative approaches to congestion control. <br><br>  Our group at Google every day spends hours studying logs with interceptions of TCP packet headers from around the world, comprehending anomalies and pathologies of behavior.  Usually, we first look for the key characteristics of the route, RTprop and BtlBw.  The fact that they can be derived from network traces suggests that the output of Jaffe could not be as unambiguous as it once seemed.  Its output relies on fundamental measurement uncertainty (for example, whether a measured increase in RTT is caused by a change in path length, a decrease in throughput of a bottleneck, or an increase in queue delay due to traffic from another connection).  Although it is impossible to eliminate the uncertainty of each specific measurement, the connection behavior over time provides a clearer picture, suggesting the possibility of applying measurement strategies designed to eliminate uncertainty. <br><br>  By combining these measurements with a reliable tracking loop, applying the latest advances in control systems [12], we can hope for the development of a distributed congestion control protocol that responds to the actual mash rather than packet loss or a short delay in the queue.  And he will converge with a high probability at the optimum working point of Kleinrock.  So began our three-year project to develop a system for managing congestion based on the measurement of two parameters that characterize the route: bandwidth capacity of the bottleneck and time of a double pass package, or BBR. <br><br><h1>  Characteristic bottleneck </h1><br>  The connection works with maximum throughput and minimum delay, when (speed balance) the arrival rate of the packets to the bottleneck equals BtlBw and (full channel) the total amount of data in flight equals BDP ( <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-36"><span class="MJXp-mo" id="MJXp-Span-37" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-38">B</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-39">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-40">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-41">B</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-42">w</span><span class="MJXp-mo" id="MJXp-Span-43" style="margin-left: 0.267em; margin-right: 0.267em;">√ó</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-44">R</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-45">T</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-46">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-47">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-48">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-49">p</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="19.934ex" height="2.419ex" viewBox="0 -780.1 8582.7 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMAIN-3D" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-42" x="1056" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-74" x="1815" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-6C" x="2177" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-42" x="2475" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-77" x="3235" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMAIN-D7" x="4174" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-52" x="5174" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-54" x="5934" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-70" x="6638" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-72" x="7142" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-6F" x="7593" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-70" x="8079" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-3"> = BtlBw √ó RTprop </script>  ). <br><br>  The first condition ensures that the bottleneck is 100% used.  The second ensures that we have enough data to prevent a simple bottleneck, but not to overflow the channel.  The speed balance condition alone <i>does not</i> guarantee the absence of a queue, only its unchanged size (for example, if a connection starts with sending a 10-packet Initial Window to a five-packet BDP, then works exactly at the same speed of the bottleneck, then five out of ten initial packets will fill the channel , and the surplus will form a standing line in a narrow place that will not be able to dissolve).  Similarly, the full channel condition does not guarantee the absence of a queue (for example, the connection sends BDP bursts over BDP / 2 and fully exploits the bottleneck, but the average queue is BDP / 4).  The only way to minimize the queue in a narrow place and across the channel is to meet both conditions at the same time. <br><br>  The values ‚Äã‚Äãof BtlBw and RTprop change over the life of the compound, so they should be constantly evaluated.  TCP currently monitors RTT (the time interval between sending a data packet to a message about its delivery), because it is required to determine the loss.  At any given time <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-50"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-51">t</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.84ex" height="1.937ex" viewBox="0 -728.2 361.5 834" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-74" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-4"> t </script>  , <br><br><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-52"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-53">R</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-54">T</span><span class="MJXp-msubsup" id="MJXp-Span-55"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-56" style="margin-right: 0.05em;">T</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-57" style="vertical-align: -0.4em;">t</span></span><span class="MJXp-mo" id="MJXp-Span-58" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-59">R</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-60">T</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-61">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-62">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-63">o</span><span class="MJXp-msubsup" id="MJXp-Span-64"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-65" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-66" style="vertical-align: -0.4em;">t</span></span><span class="MJXp-mo" id="MJXp-Span-67" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mtext" id="MJXp-Span-68">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-69">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-70">t</span><span class="MJXp-msubsup" id="MJXp-Span-71"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-72" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-73" style="vertical-align: -0.4em;">t</span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="24.824ex" height="2.419ex" viewBox="0 -780.1 10687.9 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-52" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-54" x="759" y="0"></use><g transform="translate(1464,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-54" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-74" x="826" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMAIN-3D" x="2681" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-52" x="3738" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-54" x="4497" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-70" x="5202" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-72" x="5705" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-6F" x="6157" y="0"></use><g transform="translate(6642,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-74" x="712" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMAIN-2B" x="7724" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-65" x="8974" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-74" x="9441" y="0"></use><g transform="translate(9802,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-74" x="748" y="-213"></use></g></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-5"> RTT_t = RTprop_t + \ eta_t </script></p><br>  Where <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-74"><span class="MJXp-mtext" id="MJXp-Span-75">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-76">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-77">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-78">a</span><span class="MJXp-mtext" id="MJXp-Span-79">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-80">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-81">e</span><span class="MJXp-mn" id="MJXp-Span-82">0</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.676ex" height="2.298ex" viewBox="0 -728.2 3305 989.6" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-65" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-74" x="716" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-61" x="1078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-67" x="1857" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-65" x="2338" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMAIN-30" x="2804" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-6"> \ eta \ ge 0 </script>  represents the ‚Äúnoise‚Äù of queues along the route, the recipient‚Äôs strategy with delayed confirmations, the accumulation of confirmations, etc.  RTprop is a physical characteristic of the connection, and it changes only when the channel itself changes.  Since channel changes occur on a time scale of <i>‚â•</i> <i>RTprop</i> , an impartial and effective estimate of time <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-83"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-84">T</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.636ex" height="2.057ex" viewBox="0 -780.1 704.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/322430/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhHnzCGlAj1NJYHwwQR_ImdUwI6zA#MJMATHI-54" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-7"> T </script>  will be <br><br><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-85"><span class="MJXp-mtext" id="MJXp-Span-86">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-87">w</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-88">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-89">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-90">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-91">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-92">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-93">t</span><span class="MJXp-mrow" id="MJXp-Span-94"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-95">R</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-96">T</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-97">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-98">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-99">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-100">p</span></span><span class="MJXp-mo" id="MJXp-Span-101" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-102">R</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-103">T</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-104">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-105">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-106">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-107">p</span><span class="MJXp-mo" id="MJXp-Span-108" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-109">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-110">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-111">n</span><span class="MJXp-mo" id="MJXp-Span-112" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mtext" id="MJXp-Span-113">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-114">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-115">t</span><span class="MJXp-msubsup" id="MJXp-Span-116"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-117" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-118" style="vertical-align: -0.4em;">t</span></span><span class="MJXp-mo" id="MJXp-Span-119" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-120" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-121">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-122">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-123">n</span><span class="MJXp-mo" id="MJXp-Span-124" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-125">R</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-126">T</span><span class="MJXp-msubsup" id="MJXp-Span-127"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-128" style="margin-right: 0.05em;">T</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-129" style="vertical-align: -0.4em;">t</span></span><span class="MJXp-mo" id="MJXp-Span-130" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mspace" id="MJXp-Span-131" style="width: 0.278em; height: 0em;"></span><span class="MJXp-mspace" id="MJXp-Span-132" style="width: 0.278em; height: 0em;"></span><span class="MJXp-mspace" id="MJXp-Span-133" style="width: 0.278em; height: 0em;"></span><span class="MJXp-mspace" id="MJXp-Span-134" style="width: 0.278em; height: 0em;"></span><span class="MJXp-mtext" id="MJXp-Span-135">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-136">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-137">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-138">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-139">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-140">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-141">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-142">t</span><span class="MJXp-mtext" id="MJXp-Span-143">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-144">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-145">n</span><span class="MJXp-mo" id="MJXp-Span-146" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-147">T</span><span class="MJXp-mo" id="MJXp-Span-148" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-msubsup" id="MJXp-Span-149"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-150" style="margin-right: 0.05em;">W</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-151" style="vertical-align: -0.4em;">R</span></span><span class="MJXp-mo" id="MJXp-Span-152" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-153">T</span><span class="MJXp-mo" id="MJXp-Span-154" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-8"> \ widehat {RTprop} = RTprop + min (\ eta_t) = min (RTT_t) \; \; \; \; \ forall t \ in [T - W_R, T] </script></p><br>  i.e. start <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-155"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-156">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-157">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-158">n</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-9"> min </script>  in the time window <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-159"><span class="MJXp-msubsup" id="MJXp-Span-160"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-161" style="margin-right: 0.05em;">W</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-162" style="vertical-align: -0.4em;">r</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-10"> W_r </script>  (which usually ranges from tens of seconds to minutes). <br><br>  Unlike RTT, nothing in TCP specifications requires an implementation to track bottleneck bandwidth, but a good estimate of this can be obtained from tracking delivery speed.  When a confirmation of the delivery of a packet is returned to the sender, it shows the RTT packet and announces the delivery of data in flight when the packet is departing.  The average delivery rate between sending a packet and receiving a confirmation is the ratio of the data delivered to the elapsed time: <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-163"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-164">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-165">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-166">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-167">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-168">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-169">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-170">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-171">y</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-172">R</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-173">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-174">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-175">e</span><span class="MJXp-mo" id="MJXp-Span-176" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-177">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-178">D</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-179">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-180">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-181">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-182">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-183">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-184">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-185">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-186">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-187">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-188">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-189">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-190">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-191">d</span><span class="MJXp-mrow" id="MJXp-Span-192"><span class="MJXp-mo" id="MJXp-Span-193" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mtext" id="MJXp-Span-194">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-195">D</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-196">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-197">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-198">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-199">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-200">t</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-11"> deliveryRate = \ Delta delivered / \ Delta t </script>  .  This speed must be less than or equal to the bandwidth of the bottleneck (the quantity on arrival is known exactly, so all the uncertainty is <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-201"><span class="MJXp-mtext" id="MJXp-Span-202">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-203">D</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-204">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-205">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-206">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-207">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-208">t</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-12"> \ Delta t </script>  which must be greater than or equal to the actual arrival interval;  therefore, the ratio must be less than or equal to the actual delivery speed, which, in turn, is limited from above by the capacity of the bottleneck).  Consequently, the maximum delivery rate window is an effective, unbiased BtlBw estimate: <br><br><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-209"><span class="MJXp-mtext" id="MJXp-Span-210">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-211">w</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-212">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-213">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-214">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-215">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-216">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-217">t</span><span class="MJXp-mrow" id="MJXp-Span-218"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-219">B</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-220">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-221">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-222">B</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-223">w</span></span><span class="MJXp-mo" id="MJXp-Span-224" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-225">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-226">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-227">x</span><span class="MJXp-mo" id="MJXp-Span-228" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-229">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-230">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-231">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-232">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-233">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-234">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-235">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-236">y</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-237">R</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-238">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-239">t</span><span class="MJXp-msubsup" id="MJXp-Span-240"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-241" style="margin-right: 0.05em;">e</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-242" style="vertical-align: -0.4em;">t</span></span><span class="MJXp-mo" id="MJXp-Span-243" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mspace" id="MJXp-Span-244" style="width: 0.278em; height: 0em;"></span><span class="MJXp-mspace" id="MJXp-Span-245" style="width: 0.278em; height: 0em;"></span><span class="MJXp-mspace" id="MJXp-Span-246" style="width: 0.278em; height: 0em;"></span><span class="MJXp-mspace" id="MJXp-Span-247" style="width: 0.278em; height: 0em;"></span><span class="MJXp-mtext" id="MJXp-Span-248">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-249">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-250">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-251">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-252">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-253">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-254">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-255">t</span><span class="MJXp-mtext" id="MJXp-Span-256">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-257">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-258">n</span><span class="MJXp-mo" id="MJXp-Span-259" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-260">T</span><span class="MJXp-mo" id="MJXp-Span-261" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-msubsup" id="MJXp-Span-262"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-263" style="margin-right: 0.05em;">W</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-264" style="vertical-align: -0.4em;">B</span></span><span class="MJXp-mo" id="MJXp-Span-265" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-266">T</span><span class="MJXp-mo" id="MJXp-Span-267" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-13-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-13"> \ widehat {BtlBw} = max (deliveryRate_t) \; \; \; \; \ forall t \ in [T - W_B, T] </script></p><br>  where is the time window <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-268"><span class="MJXp-msubsup" id="MJXp-Span-269"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-270" style="margin-right: 0.05em;">W</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-271" style="vertical-align: -0.4em;">b</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-14-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-14"> W_b </script>  typically between six and ten RTT. <br><br>  TCP must record the sending time of each packet in order to calculate RTT.  BBR supplements these records with the total amount of data delivered, so that the arrival of each confirmation reports both the RTT and the measurement of the speed of delivery, which the filters convert to RTprop and BtlBw estimates. <br><br>  Note that these values ‚Äã‚Äãare completely independent: RTprop can change (for example, when changing the route), but has the same bottleneck, or BtlBw can change (for example, when the bandwidth of the wireless channel changes) without changing the route.  (The independence of both constraints is there is a reason why they should be known in order to link the shipping behavior with the delivery route).  Since RTprop is visible only from the left side of the BDP, and BtlBw only from the right side in Figure 1, they obey the uncertainty principle: whenever one of the two can be measured, the second cannot be measured.  Intuitively, this can be understood as follows: to determine the channel capacity, it must be filled, which creates a queue that does not allow to measure the length of the channel.  For example, an application with a request / response protocol may never send enough data to fill a channel and monitor BtlBw.  Hours of transmission of large amounts of data can spend all their time in an area with limited bandwidth and get only a single sample of RTprop from RTT from the first packet.  The inherent uncertainty principle means that, in addition to the estimates, to restore the two route parameters, there must be conditions that track simultaneously and what can be learned at the current operating point and, as the information loses freshness, how to go to the operating point where you can get more recent data. <br><br><h1>  Matching Packet Flow with Shipping Way </h1><br>  The main BBR algorithm consists of two parts: <br><br>  <b>When we get confirmation (ack)</b> <br><br>  Each confirmation provides a new RTT and average delivery rate measurement, which updates the RTprop and BtlBw estimates: <br><br><pre><code class="hljs matlab"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAck</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(packet)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rtt</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">now</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">packet</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendtime</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update_min_filter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RTpropFilter, rtt)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delivered</span></span></span><span class="hljs-function"> += </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">packet</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delivered_time</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">now</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deliveryRate</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(delivered - packet.delivered)</span></span></span><span class="hljs-function"> / </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(delivered_time - packet.delivered_time)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(deliveryRate &gt; BtlBwFilter.currentMax || ! packet.app_limited)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update_max_filter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BtlBwFilter, deliveryRate)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(app_limited_until &gt; 0)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">app_limited_until</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">app_limited_until</span></span></span><span class="hljs-function"> ‚Äî </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">packet</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span></span></code> </pre> <br>  The <code>if</code> check <code>if</code> necessary because of the problem of uncertainty, which was discussed in the last paragraph: senders may be limited by the application, that is, the application may run out of data to fill the network.  This is a fairly typical situation due to request / response traffic.  When there is a possibility to send, but no data is sent, BBR marks the corresponding bandwidth samples as ‚Äúapplication limited‚Äù, i.e. app_limited (see <code>send()</code> pseudocode).  This code determines which samples to include in the bandwidth model, so that it reflects the network constraints, not the application limits.  BtlBw is a solid upper limit on the speed of delivery, so the resulting delivery rate greater than the current BtlBw estimate should mean an underestimate of BtlBw, regardless of whether the sample was limited to the application or not.  Otherwise, samples with application restrictions are discarded.  (Figure 1 shows that in the region with the restriction of the <code>deliveryRate</code> application, the BtlBw parameter is undervalued).  Such checks prevent the BtlBw filter from being filled with understated values, due to which sending data may be slowed down. <br><br>  <b>When data is sent</b> <br><br>  To relate the arrival rate of packets to the departure rate from a bottleneck, BBR tracks each data packet.  (BBR must match the bottleneck <i>rate</i> : this means tracking is an integral part of the architecture and a fundamental part of the work - therefore <i>pacing_rate</i> is the main control parameter. The auxiliary parameter <i>cwnd_gain</i> links <i>inflight</i> with a small number of BDP to handle typical network pathologies and the recipient (see below chapter for delayed and extended confirmations. Conceptually, the <code>send</code> procedure in TCP looks like the following code. (In Linux, sending data uses an efficient FQ / pacing queuing procedure [4] which  BBR provides linear single-link performance on multi-gigabit channels and handles thousands of lower-speed connections with a low CPU overhead). <br><br><pre> <code class="hljs matlab"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(packet)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bdp</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BtlBwFilter</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currentMax</span></span></span><span class="hljs-function"> √ó </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RTpropFilter</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currentMin</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(inflight &gt;= cwnd_gain √ó bdp)</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wait</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ack</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">or</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">retransmission</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">timeout</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(now &gt;= nextSendTime)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">packet</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nextPacketToSend</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(! packet)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">app_limited_until</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inflight</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">packet</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">app_limited</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(app_limited_until &gt; 0)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">packet</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendtime</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">now</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">packet</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delivered</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delivered</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">packet</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delivered_time</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delivered_time</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ship</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(packet)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nextSendTime</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">now</span></span></span><span class="hljs-function"> + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">packet</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span><span class="hljs-function"> / </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pacing_gain √ó BtlBwFilter.currentMax)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">timerCallbackAt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(send, nextSendTime)</span></span></span></span></code> </pre> <br>  <b>Behavior in steady state</b> <br><br>  The speed and amount of data sent via BBR depends only on BtlBw and RTprop, so the filters control not only the estimates of bottleneck limitations, but also their application.  This creates a nonstandard control loop, shown in Figure 2, showing RTT (blue), inflight (green) and delivery speed (red) for 700 milliseconds for a 10-megabit 40-ms stream.  The fat gray line above the delivery speed is the state of the BtlBw max filter.  Triangular shapes are obtained from the cyclic application of the pacing_gain coefficient in BBR to determine the increase in BtlBw.  The transmission coefficient in each part of the cycle is shown aligned with the data it has affected.  This factor worked on RTT earlier when the data was sent.  This is shown by horizontal irregularities in the description of the sequence of events on the left side. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0d5/2cd/b5d/0d52cdb5d319240c894572ac49b9bbd2.png"><br>  <i>Figure 2</i> <br><br>  BBR minimizes latency because most of the time passes with the same BDP in action.  Due to this, the bottleneck moves to the sender, so that the increase in BtlBw becomes imperceptible.  Therefore, BBR periodically spends the interval RTprop on the value of pacing_gain&gt; 1, which increases the sending speed and the amount of data sent without confirming the delivery (inflight).  If BtlBw does not change, then a queue is created in front of the bottleneck, increasing the RTT, which keeps the <code>deliveryRate</code> rate unchanged.  (The queue can be eliminated by sending data with a compensating pacing_gain value &lt;1 for the next RTprop).  If BtlBw increases, then the <code>deliveryRate</code> speed also increases, and the new maximum filter value immediately increases the base tracking speed ( <i>pacing_rate</i> ).  For this reason, the BBR adapts to the new bottleneck size exponentially quickly.  Figure 3 shows this effect on a 10-megabit 40-ms stream that BtlBw suddenly increases to 20 Mbps after 20 seconds of steady operation (on the left side of the graph), then resets to 10 Mbps after another 20 seconds of steady operation at 20 Mbps (right side of the graph). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/782/dc2/df0/782dc2df0ea26284cda4bcd194e7507d.png"><br>  <i>Figure 3</i> <br><br>  (Essentially, BBR is a simple example of a max-plus control system, a new approach to control systems based on nonstandard max-plus algebra [12]. This approach allows you to adapt the speed [controlled by the <i>max</i> transfer ratio] regardless of the queue growth [ controlled by the transfer coefficient <i>average</i> ]. Applied to our task, this comes down to a simple, unconditional control loop, where adaptation to changes in physical constraints is automatically carried out by changing the filters expressing these constraints.  the topic would require the creation of multiple control loops combined into a complex state machine to achieve such a result). <br><br><h1>  Behavior when starting a single BBR stream </h1><br>  Modern implementations process events like startup (startup), shutdown (shutdown) and loss recovery (loss recovery) using algorithms that respond to "events" with a large number of lines of code.  BBR uses the code above (in the previous chapter, ‚ÄúMatching Packet Flow with Delivery Path‚Äù) for everything.  Event processing occurs by passing through a sequence of "states".  The ‚Äústates‚Äù themselves are defined by a table with one or several fixed values ‚Äã‚Äãof coefficients and exit criteria.  Most of the time is spent in the ProbeBW state, which is described in the chapter ‚ÄúBehavior in a steady state‚Äù.  The Startup and Drain states are used when starting the connection (Figure 4).  To handle the connection, where the bandwidth increases by 12 orders of magnitude, in the Startup state, a binary search algorithm is implemented for BtlBw, where the transmission coefficient is used <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-272"><span class="MJXp-mn" id="MJXp-Span-273">2</span><span class="MJXp-mrow" id="MJXp-Span-274"><span class="MJXp-mo" id="MJXp-Span-275" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-276">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-277">n</span><span class="MJXp-mn" id="MJXp-Span-278">2</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-15-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-15"> 2 / ln2 </script>  for a twofold increase in transmission speed when delivery speed increases.  So determined by BtlBw in <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-279"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-280">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-281">o</span><span class="MJXp-msubsup" id="MJXp-Span-282"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-283" style="margin-right: 0.05em;">g</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-284" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-285">B</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-286">D</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-287">P</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-16-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-16"> log_2BDP </script>  RTT, but at the same time creates an extra queue to <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-288"><span class="MJXp-mn" id="MJXp-Span-289">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-290">B</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-291">D</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-292">P</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-17-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-17"> 2BDP </script>  .  As soon as Startup finds BtlBw, the BBR system enters the Drain state, which uses inverse Startup transfer coefficients to get rid of the excess queue, and then the ProbeBW state as soon as the inflight drops to the BDP line. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2fa/ac8/400/2faac84009e59e0332173d560ceafcab.png"><br>  <i>Figure 4</i> <br><br>  Figure 4 shows the first second of a 10-megabit BBR stream of 40 milliseconds.  The top chart shows the time and sequence of events, as well as the progress of the sender (green) and recipient (blue): the amount of data transmitted and received.  The red line shows the sender‚Äôs CUBIC performance under the same conditions.  Vertical gray lines indicate moments of transition between BBR states.  In the lower graph - the change in time of double pass packets (RTT) of both compounds.  Please note that the time scale for this schedule corresponds to the time of receipt of confirmation of arrival (ack).  Therefore, it may seem that the graphs seem to be shifted in time, but in fact the events below correspond to those moments when the BBR system finds out about these events and reacts. <br><br>  The lower graph in Figure 4 compares BBR and CUBIC.  At first, their behavior is almost the same, but BBR completely depletes the queue formed at the start of the connection, but CUBIC cannot do this.  It does not have a trace model that would tell you how much of the data sent is redundant.  Therefore, CUBIC less aggressively increases data transfer without confirming delivery, but this growth continues until the bottleneck buffer overflows and starts to drop packets, or until the receiver reaches the limit on the sent data without confirmation (TCP receive window). <br><br>  Figure 5 shows the behavior of the RTT in the first eight seconds of the connection shown in the previous figure 4. The CUBIC technology (red) fills the entire available buffer, then spins between 70% and 100% of the fill every few seconds.  After starting the connection, BBR (green) works almost without creating a queue. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ba5/4cc/e32/ba54cce323dbd38e54462ea8bbf3cb67.png"><br>  <i>Figure 5</i> <br><br><h1>  Behavior when multiple BBR streams meet in narrow place </h1><br>  Figure 6 shows how the bandwidth of several BBR streams converges in a fair channel partition with a 100 megabit / 10 millisecond bottleneck.  Downward looking triangular structures are the states of the ProbeRTT connections in which self-synchronization speeds up the final convergence. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/491/2d0/f00/4912d0f00580c8523040ee59b7a39df9.png"><br>  <i>Figure 6</i> <br><br>  The cycles of change of the ProbeBW gain factors (Figure 2) stimulate larger flows to give way to smaller flows, as a result of which each flow understands its honest state.  This happens quite quickly (several ProbeBW cycles), although injustice may persist if the threads that are late to the beginning of the redistribution overestimate RTprop due to the fact that previously started threads (temporarily) create a queue. <br><br>  To find out the real RTProp, the stream moves to the left of the BDP line using the ProbeRTT state: if the RTProp score is not updated (that is, by measuring a smaller RTT) for many seconds, then BBR enters the ProbeRTT state, reducing the amount of data sent (inflight) to four packets for at least one double pass, and then returns to the previous state.  When large flows enter the ProbeRTT state, many packets are removed from the queue, so several threads see the new value of RTprop (the new minimum RTT).  Because of this, their RTprop scores are zeroed at the same time, so that they collectively enter the ProbeRTT state ‚Äî and the queue shrinks even more, resulting in even more flows seeing the new value of RTprop, and so on.  Such distributed coordination is a key factor at the same time for fair strip distribution and stability. <br><br>  BBR synchronizes streams around the desired event, which is an empty queue in a narrow place.  In contrast to this approach, regulating congestion on packet loss synchronizes flows around unwanted events, such as periodic queue growth and buffer overflow, which increases latency and packet loss. <br><br><h1>  Experience implementing B4 WAN to Google </h1><br>  Google's B4 network is a high-speed WAN network (wide-area network), built on conventional low-cost switches [15].  Losses on these switches with small buffers are mainly due to the random influx of small traffic bursts.  In 2015, Google began to transfer working traffic from CUBIC to BBR.  There were no problems or regressions, and since 2016, all B4 TCP traffic uses BBR.  Figure 7 illustrates one reason for which this was done: the BBR capacity is consistently 2-25 times higher than that of CUBIC.  We saw an even greater improvement, but found that 75% of BBR connections are limited to the TCP receive buffer in the core, which the network operations staff deliberately set to a low value (8 MB) to prevent CUBIC from flooding the network with megabytes of excess traffic without confirming delivery (if divide 8 MB to 200 ms of intercontinental RTT, then it will be 335 Mbit / s maximum).  A manual increase in the receive buffer on a single US-Europe route instantly increased the BBR data transfer rate to 2 Gbit / s, while CUBIC remained at 15 Mbit / s ‚Äî a 133-fold relative increase in throughput was predicted by Mathis and his colleagues in scientific the work of 1997.  [17] <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d02/a04/ce7/d02a04ce75499aacc753dacd72d15c56.png"><br>  <i>Figure 7</i> <br><br>  Figure 7 shows the relative improvement in BBR compared with CUBIC;  on the sidebar - integral distribution functions (cumulative distribution functions, CDF) for bandwidth.  The measurements were made using the active sensing service, which opens BBR and CUBIC permanent connections to remote data centers, then sends 8 MB of data every minute.  The probes explore many B4 routes between North America, Europe and Asia. <br><br>  A huge improvement is a direct consequence of the fact that BBR <i>does not</i> use packet loss as an indicator of congestion.  To achieve full throughput for existing packet loss control methods, the loss level should be less than the inverse square of the BDP [17] (for example, less than one loss per 30 million packets for a 10 Gbit / s connection and 100 ms).  Figure 8 compares the measured throughput at various levels of packet loss.  In the CUBIC algorithm, the packet loss allowance is a structural property of the algorithm, and in BBR it is a configuration parameter.  As the loss rate in BBR approaches the maximum Gain ProbeBW, the probability of measuring the delivery rate of a real BtlBw drops sharply, which leads to an underestimation from the max filter. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e31/4ab/029/e314ab029416ab03f7a80c8d882db8cd.png"><br>  <i>Figure 8</i> <br><br>  Figure 8 compares the useful bandwidth of the BBR and CUBIC in a 60-second stream at 100 Mb / s and 100 ms with a random loss of 0.001% to 50%.  The capacity of CUBIC decreases 10 times at a loss of 0.1% and completely stalls at more than 1%.  The maximum bandwidth is the share of the band minus packet losses ( <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-293"><span class="MJXp-mo" id="MJXp-Span-294" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font></span><span class="MJXp-mn" id="MJXp-Span-295"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 </font></font></span><span class="MJXp-mo" id="MJXp-Span-296" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-297"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-298"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-299"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-300"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-301"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-302"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-303"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-304"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-18-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-18"> = 1 - lossRate </script>  ).  BBR keeps at this level up to the level of losses of 5% and close to it up to 15%. <br><br><h1>  YouTube Edge Implementation Experience </h1><br>  BBR is deployed on YouTube and Google.com video servers.  Google is conducting a small experiment in which a small percentage of users are randomly transferred to BBR or CUBIC.  The BBR video playback shows a significant improvement in all user ratings of the service quality.  Perhaps because the BBR behavior is more consistent and predictable.  BBR only slightly improves connection bandwidth, because YouTube already adapts streaming speeds to levels far below BtlBw to minimize unnecessary network buffering and re-buffering.  But even here, BBR reduces the average median RTT by 53% globally and more than 80% in developing countries. <br><br>  Figure 9 shows the median improvement in RTT versus BBR and CUBIC statistics, with over 200 million YouTube video views measured on five continents during the week.  More than half of all 7 billion mobile connections in the world connect at 2.5G at speeds from 8 to 114 Kbps [5], experiencing well-documented problems due to the fact that packet loss congestion control methods tend to overflow buffers [3].  The bottleneck in these systems is usually between the SGSN (the serving GPRS support node) [18] and the mobile device.  The SGSN software runs on a standard PC platform with plenty of RAM, which often has megabytes of buffer between the Internet and a mobile device.  Figure 10 compares the (emulated) SGSN delay between the Internet and the mobile device for BBR and CUBIC.  Horizontal lines mark one of the most serious consequences: TCP adapts to long RTT delays, with the exception of a SYN packet initiating a connection that has a fixed timeout, depending on the operating system.  When a mobile device receives a large data array (for example, from automatic software updates) via a large buffer SGSN, the device cannot establish any connection on the Internet until the queue is free (the confirming SYN ACK packet is delayed longer than the fixed SYN timeout) . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/803/8d1/3ff/8038d13ff6ae9a5538a9170196b2b61b.png"><br>  <i>Figure 9</i> <br><br>  Figure 10 shows the median RTT changes in the steady state of the connection and the dependence on the buffer size on the 128 Kbps connection and 40 ms with eight BBR (green) or CUBIC (red) streams.  BBR keeps the queue at the minimum values, regardless of the size of the bottleneck buffer and the number of active threads.  CUBIC streams always fill the buffer, so the delay increases linearly with the buffer size. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4f3/e34/9ee/4f3e349eea51398a085dba9875819aed.png"><br>  <i>Figure 10</i> <br><br><h1>  Adaptive band in mobile cellular </h1><br>  Cellular systems adapt the bandwidth for each user partly depending on the forecast of requests, which takes into account the queue of packets destined for that user.  Early versions of BBR were set up to create very small lines, which caused the connections to stop at low speeds.  An increase in the peak value of pacing_gain for ProbeBW and an increase in queues resulted in a decrease in the stalled connections.  This shows the possibility of excellent adaptation for some networks.  With the current peak gain value <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-305"><span class="MJXp-mn" id="MJXp-Span-306"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.25 </font></font></span><span class="MJXp-mo" id="MJXp-Span-307" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√ó </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-308"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-309"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-310"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-311"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-312"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">w</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-19-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-19"> 1.25 √ó BtlBw </script>  there is no degradation in any network compared to CUBIC. <br><br><h1>  Delayed and Stretched Packages ack </h1><br>  Cellular networks, WiFi and broadband networks often delay and accumulate ack packets [1].  When inflight is limited to one BDP, this leads to disruptions that reduce throughput.  Increasing the cwnd_gain ProbeBW factor to two allowed us to continue smooth transmission at the predicted delivery speed, even when ack packets were delayed to a value of one RTT.  This largely prevents breakdowns. <br><br><h1>  Current Bucket Limiters </h1><br>  The initial deployment of BBR on YouTube has shown that most of the Internet service providers in the world distort traffic using speed limits using the current bucket algorithm [7].  The bucket is usually full at the beginning of the connection, so BBR recognizes the BtlBw parameter for the underlying network.  But as soon as the bucket is empty, all packets sent faster than (much smaller than BtlBw) bucket filling speed are discarded.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BBR eventually recognizes this new delivery speed, but a cyclic change in ProbeBW gain leads to permanent moderate losses. </font><font style="vertical-align: inherit;">To minimize the loss of the upstream bandwidth and the increase in application delays from these losses, we added a special limiter detector and an explicit limiter model in BBR. </font><font style="vertical-align: inherit;">We are also actively exploring the best ways to eliminate the damage from speed limiters.</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Competition with packet loss control methods </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BBR comes down to honestly sharing the bottleneck bandwidth, whether in competition with other BBR streams or with streams managed by congestion loss control methods. Even when the latter fill the available buffer, ProbeBW still reliably shifts the BtlBw estimate towards fair flow separation, and ProbeRTT considers the RTProp score high enough for an eye for an eye to fair separation. However, unmanaged router buffers exceeding certain BDPs force outdated competitors with congestion control over packet loss to inflate the queue and grab more than is fair to them. Eliminating this is another area of ‚Äã‚Äãactive research.</font></font><br><br><h1>  Conclusion </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rethinking traffic congestion management is a huge benefit. Instead of using events such as losses or buffer occupancy that only weakly correlate with congestion, BBR starts with the formal Kleinrock congestion model and its associated optimum operating point. The annoying conclusion about the ‚Äúimpossibility‚Äù of simultaneously determining critical delay and bandwidth parameters is bypassed by observing that they can be predicted simultaneously. Then, recent advances in control systems and estimation theory are applied to create a simple distributed control loop that approaches the optimum, fully utilizing the network while maintaining a small queue. The Google BBR implementation is available in the open source Linux kernel and is described in detail in the appendix to this article.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BBR technology is used on the Google B4 backbone, improving the throughput by orders of magnitude compared to CUBIC. It also takes place on Google and YouTube web servers, greatly reducing latency on all five continents tested to date, and especially in developing countries. BBR technology works exclusively on the sender's side and does not require changes in the protocol, on the recipient or on the network, which allows you to deploy it gradually. It depends only on RTT and packet delivery notifications, so it can be used in most Internet transport protocols. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Authors can be reached at bbr-dev@googlegroups.com. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acknowledgments</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The authors are grateful to Lena Kleinrock for pointing out how to properly regulate congestion. </font><font style="vertical-align: inherit;">We are indebted to Larry Brakmo for his pioneering work on Vegas [2] and New Vegas congestion control systems, which anticipated many of the elements of BBR, as well as his advice and guidance at the initial stage of the development of BBR. </font><font style="vertical-align: inherit;">We would also like to thank Eric Dumazet, Nandita Dukkipati, Jan Iyengar, Ian Swett, M. Fitz Nowlan, David Wetherall, Leon Wetherall, Leon, Leon Wetherall, Leon Wetherall, Leon Fitz Nowlan, David Wetherall, Leon Wetherall. Kontothanassis (Leonidas Kontothanassis), Amina Vahdat (Amin Vahdat) and the Google BwE development team and YouTube infrastructure for their invaluable help and support.</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Appendix - a detailed description </font></font></h1><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The state machine for serial sensing</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Gain pacing_gain controls how fast packets are sent relative to BtlBw, and this is the key to the intelligent BBR function. When pacing_gain is greater than one, the inflight increases and the gap between arrivals of packets decreases, which moves the connection to the right side in Figure 1. When pacing_gain is less than one, the opposite effect occurs, the connection moves to the left.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BBR uses pacing_gain to implement a simple sequential state sensing machine, which alternates between testing for a larger band and testing for a shorter time to double pass a packet. (It is not necessary to test for a smaller band because it is processed automatically by the BtlBw msx filter: new measurements reflect a drop, so BtlBw will correct itself as soon as the last old changes are removed from the filter by timeout. The RTprop min filter handles the increase in the delivery path in the same way) .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If the capacity of the bottleneck increases, BBR should send data faster to detect it. Similarly, if the real time of a double pass of a packet changes, it changes the BDP, and therefore the BDP must send data slower to keep the inflight below the BDP to measure the new RTprop. Therefore, the only way to detect these changes is to run experiments, sending faster to check for BtlBw magnification or sending more slowly to check for RTprop reduction. The frequency, scale, duration, and structure of these experiments differ depending on what is already known (starting the connection or the stable state) and on the behavior of the application that sends the data (intermittent or constant). </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Steady state</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BBRs spend most of their time in the ProbeBW state, probing a band using a method called </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gain cycling</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which helps BBRs achieve high throughput, low queue lag, and convergence in an honest band section. Using </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gain cycling</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , BBR cyclically tries a series of values ‚Äã‚Äãfor the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pacing_gain</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gain </font><font style="vertical-align: inherit;">. Eight cycle phases are used with the following values: 5/4, 3/4, 1, 1, 1, 1, 1, 1. Each phase usually goes through a predicted RTprop. This design allows the coefficient cycle to first probe the channel for more bandwidth with a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pacing_gain</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> value </font><i><font style="vertical-align: inherit;">greater</font></i><font style="vertical-align: inherit;"> than 1.0, and then disperse any resulting queue using </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pacing_gain</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">by the same amount less than 1.0, and then move at cruising speed with a short queue of coefficients exactly 1.0. The average gain for all phases is 1.0, because ProbeBW tends to average to equalize with the available bandwidth and, consequently, to maintain a high degree of band usage without increasing the queue. Notice that while the change cycles of the coefficient change the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pacing_gain</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , the value of </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cwnd_gain</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> invariably remains two, since delayed and extended acknowledgment packets may appear at any time (see the chapter on delayed and extended packets ack).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Moreover, to improve flow mixing and fair band separation, and to reduce queues when multiple BBR streams share a bottleneck, BBR randomly changes the phases of the ProbeBW cycle, randomly selecting the first phase among all values ‚Äã‚Äãexcept 3/4. Why doesn't the cycle start with 3/4? The main task of this coefficient value is to disperse any queue that may form during the application of the 5/4 factor, when the channel is already full. When a process exits the Drain or ProbeRTT state and enters ProbeBW, there is no queue, so the 3/4 factor does not perform its task. Using 3/4 in this context has only a negative effect: filling the channel in this phase will be 3/4, not 1. Thus, the beginning of the cycle with 3/4 has only a negative effect, but has no positive,and since the input to the ProbeBW state occurs at the start of any connection for a long time, BBR uses this small optimization.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BBRs work together to periodically empty a queue in a narrow place using a state called ProbeRTT. In any state other than ProbeRTT itself, if the RTProp score was not updated (for example, by measuring a smaller RTT) for more than 10 seconds, then BBR enters the ProbeRTT state and reduces cwnd to a very small value (four packets). Keeping such a minimum number of packets ‚Äúin flight‚Äù for at least 200 ms and during one time of a double pass of a packet, BBR exits ProbeRTT and enters either Startup or ProbeBW, depending on the estimate whether the channel is already full.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BBR is designed to work most of the time (about 98%) in the ProbeBW state, and the rest of the time in ProbeRTT, based on a set of compromises. The ProbeRTT state lasts long enough (at least 200 ms) to allow threads with different RTT to have parallel ProbeRTT states, but at the same time it lasts a fairly short period of time to limit performance degradation to about two percent (200 ms / 10 seconds ). The RTprop filter window (10 seconds) is small enough to quickly adjust to changing traffic levels or changing routes, but large enough for interactive applications. Such applications (for example, web pages, remote procedure calls, video fragments) often demonstrate natural periods of silence or low activity in the windows of this window,where the flow rate is low enough or long enough to disperse the queue in a narrow place. Then the RTprop filter opportunistically matches these RTprop measurements, and the RTProp is updated without having to use ProbeRTT. Thus, threads typically only need to donate 2% of the band if multiple streams fill the channel abundantly throughout the whole RTProp window.</font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Startup Behavior</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> When a BBR stream starts, it performs its first (and fastest) sequential probe / empty queue process. Network bandwidth varies in the range of 10 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - from a few bits to 100 gigabits per second. To find out the value of BtlBw with such a huge range change, BBR performs a binary search in velocity space. He very quickly finds BtlBw (</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-313"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-314"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-315"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-316"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-317" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g </font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-318" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-319"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> B </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-320"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-321"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> double passes of packets), but at the expense of creating a 2BDP queue at the last stage of the search. The search is performed in the Startup state in BBR, and the emptying of the created queue is in the Drain state.</font><font style="vertical-align: inherit;">First, Startup exponentially increases the speed of sending data, doubling it at each round. To achieve such a fast sensing in the quietest way, when running, the values ‚Äã‚Äãof the gain</font><i><font style="vertical-align: inherit;">factors pacing_gain</font></i><font style="vertical-align: inherit;">and</font><i><font style="vertical-align: inherit;">cwnd_gain are</font></i><font style="vertical-align: inherit;">set to</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-20-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-20">log_2BDP</script><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-322"><span class="MJXp-mn" id="MJXp-Span-323"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 </font></font></span><span class="MJXp-mrow" id="MJXp-Span-324"><span class="MJXp-mo" id="MJXp-Span-325" style="margin-left: 0.111em; margin-right: 0.111em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font></span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-326"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> l </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-327"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n </font></font></span><span class="MJXp-mn" id="MJXp-Span-328"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , to a minimum value that doubles the speed at which data is sent each round. </font><font style="vertical-align: inherit;">Once the channel is filled, the</font><i><font style="vertical-align: inherit;">cwnd_gain</font></i><font style="vertical-align: inherit;">coefficient</font><font style="vertical-align: inherit;">limits the queue size to</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-21-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-21">2/ln2</script><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-329"><span class="MJXp-mo" id="MJXp-Span-330" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-331"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-332"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">w </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-333"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-334"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-335" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-336" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g</font></font></span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-337"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-338"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-339"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n </font></font></span><span class="MJXp-mo" id="MJXp-Span-340" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font></span><span class="MJXp-mn" id="MJXp-Span-341"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 </font></font></span><span class="MJXp-mo" id="MJXp-Span-342" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="MJXp-mo" id="MJXp-Span-343" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√ó </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-344"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-345"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-346"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-22-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-22">(cwnd_gain - 1) √ó BDP</script>  . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the start-up state, BBR assesses whether the channel is full by searching for a plateau in the BtlBw rating. If it turns out that several (three) rounds have passed, where attempts to double the delivery speed do not really give a big increase in speed (less than 25%), then he believes that he has reached BtlBw, so that he leaves the Startup state and enters the Drain state. BBR waits for three rounds to get convincing evidence that the delivery rate plateau observed by the sender is not a temporary effect influenced by the receiving window. Waiting for three rounds gives enough time for automatic tuning on the recipient's side to open the receiving window and for the BBR sender to detect the need to increase BtlBw: in the first round, the algorithm for automatically setting the receiving window increases the receiving window;in the second round, the sender fills the enlarged reception window; in the third round, the sender receives samples at an increased rate of delivery. Such a limit of three rounds proved itself as a result of implementation on YouTube.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the Drain state, the BBR algorithm seeks to quickly empty the queue that was formed in the connection start state by switching to </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pacing_gain</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mode </font><font style="vertical-align: inherit;">with inverse values ‚Äã‚Äãthan those used in the Startup state. When the number of packets in flight corresponds to the BDP estimate, this means that BBR rates the queue as completely empty, but the channel is still full. Then the BBR exits the Drain state and enters ProbeBW.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notice that the launch of the BBR connection and the slow start of the CUBIC both study the throughput of the bottleneck exponentially, doubling the dispatch rate in each round. However, they are radically different. First, BBR more reliably determines the available bandwidth because it does not stop searching in case of packet loss or (like CUBIC Hystart [10]) increasing the delay. Secondly, BBR smoothly increases the sending speed, while at CUBIC on each round (even with pacing) there is a surge in packets, and then a period of silence. Figure 4 shows the number of packets in flight and the observed RTT time for each acknowledgment message from BBR and CUBIC. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transitional Response</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The network path and the passage of traffic through it can experience sudden dramatic changes. </font><font style="vertical-align: inherit;">In order to smoothly and reliably adapt to them, as well as reduce packet loss in these situations, BBR uses a number of strategies to implement its basic model. </font><font style="vertical-align: inherit;">First, the BBR regards</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-347"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-348"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-349"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">w </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-350"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-351"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-352" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-353" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g</font></font></span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-354"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-355"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-356"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n </font></font></span><span class="MJXp-mo" id="MJXp-Span-357" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√ó </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-358"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-359"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-360"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> as a target, to which the current</font><i><font style="vertical-align: inherit;">cwnd</font></i><font style="vertical-align: inherit;">carefully approaches from the bottom, increasing</font><i><font style="vertical-align: inherit;">cwnd</font></i><font style="vertical-align: inherit;">each time by no more than the amount of data for which delivery confirmations have arrived. </font><font style="vertical-align: inherit;">Second, with a retransmission timeout, which means that the sender considers all packets lost in flight, BBR conservatively lowers</font><i><font style="vertical-align: inherit;">cwnd</font></i></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-23-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-23">cwnd_gain√óBDP</script><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">up to one packet and sends a single packet (just like congestion algorithms for packet loss, such as CUBIC). In the end, when the sender notices a packet loss, but there are still packets in flight, in the first stage of the loss recovery process, BBR temporarily reduces the sending speed to the level of the current delivery speed; on the second and subsequent loss recovery rounds, he checks that the sending speed never exceeds the current delivery speed more than twice. This significantly reduces losses in transient situations when BBR collides with speed limiters or competes with other streams in a buffer comparable to the size of a BDP.</font></font><br><br><h1>  Links </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Abrahamsson, M. 2015. TCP ACK suppression. IETF AQM mailing list; </font></font><a href="https://www.ietf.org/mail-archive/web/aqm/current/msg01480.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.ietf.org/mail-archive/web/aqm/current/msg01480.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Brakmo, LS, Peterson, LL 1995. TCP Vegas: end-to-end congestion avoidance on a global Internet. IEEE Journal on Selected Areas in Communications 13 (8): 1465-1480. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Chakravorty, R., Cartwright, J., Pratt, I. 2002. Practical experience with TCP over GPRS. In IEEE GLOBECOM. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Corbet, J. 2013. TSO sizing and the FQ scheduler. LWN.net; </font></font><a href="https://lwn.net/Articles/564978/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://lwn.net/Articles/564978/</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Ericsson. 2015 Ericsson Mobility Report (June); </font></font><a href="https://www.ericsson.com/res/docs/2015/ericsson-mobility-report-june-2015.pdf"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.ericsson.com/res/docs/2015/ericsson-mobility-report-june-2015.pdf</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. ESnet. Application tuning to optimize international astronomy workflow from NERSC to LFI-DPC at INAF-OATs; </font></font><a href="http://fasterdata.es.net/data-transfer-tools/case-studies/nersc-astronomy/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://fasterdata.es.net/data-transfer-tools/case-studies/nersc-astronomy/</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7. Flach, T., Papageorge, P., Terzis, A., Pedrosa, L., Cheng, Y., Karim, T., Katz-Bassett, E., Govindan, R. 2016. An Internet-wide analysis of traffic policing. ACM SIGCOMM: 468-482. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8. Gail, R., Kleinrock, L. 1981. An invariant property of computer network power. Conference Record, International Conference on Communications: 63.1.1-63.1.5. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9. Gettys, J., Nichols, K. 2011. Bufferbloat: dark buffers in the Internet. acmqueue 9 (11); </font></font><a href="http://queue.acm.org/detail.cfm%3Fid%3D2071893"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://queue.acm.org/detail.cfm?id=2071893</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10. Ha, S., Rhee, I. 2011. Taming the elephants: new TCP slow start. Computer Networks 55 (9): 2092-2110. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11. Ha, S., Rhee, I., Xu, L. 2008. CUBIC: a new TCP-friendly high-speed TCP variant. ACM SIGOPS Operating Systems Review 42 (5): 64-74. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12. Heidergott, B., Olsder, GJ, Van Der Woude, J. 2014. Max. Algebra and its Applications. Princeton University Press. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13. Jacobson, V. 1988. Congestion avoidance and control. ACM SIGCOMM Computer Communication Review 18 (4): 314-329. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14. Jaffe, J. 1981. Flow control power is nondecentralizable. IEEE Transactions on Communications 29 (9): 1301-1306.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15. Jain, S., Kumar, A., Mandal, S., Ong, J., Poutievski, L., Singh, A., Venkata, S., Wanderer, J., Zhou, J., Zhu, M ., et al. 2013. B4: experience with a globally-deployed software defined WAN. ACM SIGCOMM Computer Communication Review 43 (4): 3-14. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16. Kleinrock, L. 1979. Power and deterministic rules of thumb for computer communications. In Conference Record, International Conference on Communications: 43.1.1-43.1.10. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17. Mathis, M., Semke, J., Mahdavi, J., Ott, T. 1997. The congestion avoidance algorithm. ACM SIGCOMM Computer Communication Review 27 (3): 67-82. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18. Wikipedia. Serving GPRS support node in the GPRS core network; </font></font><a href="https://en.wikipedia.org/wiki/GPRS_core_network"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://en.wikipedia.org/wiki/GPRS_core_network#Serving_GPRS_support_node_.28SGSN.29</font></font></a> . <br><br> <b>  </b> <br> ¬´ <a href="http://queue.acm.org/detail.cfm%3Fid%3D2381998">        </a> ¬ª <br> Aiman Erbad, Charles ¬´Buck¬ª Krasic <br><br> ¬´ <a href="http://queue.acm.org/detail.cfm%3Fid%3D1066069">      </a> ¬ª <br> Kevin Fall, Steve McCanne <br><br> ¬´ <a href="http://queue.acm.org/detail.cfm%3Fid%3D2208919">    -</a> ¬ª <br> Dennis Abts, Bob Felderman <br><br>   ‚Äî   Google make-tcp-fast,   ‚Äî           .    TFO (TCP Fast Open), TLP (Tail Loss Probe),    RACK, fq/pacing     git   TCP  Linux    . </div><p>Source: <a href="https://habr.com/ru/post/322430/">https://habr.com/ru/post/322430/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../322420/index.html">3 steps to an interactive prototype</a></li>
<li><a href="../322422/index.html">One possible problem when working with RS232</a></li>
<li><a href="../322424/index.html">A series of video tutorials on Git for beginners</a></li>
<li><a href="../322426/index.html">How to bring a business online and do not go broke: digest of useful materials for beginners</a></li>
<li><a href="../322428/index.html">Functional security, part 5 of 7. The life cycle of information and functional security</a></li>
<li><a href="../322432/index.html">Welcome to Lua in Moscow 2017 March 5</a></li>
<li><a href="../322434/index.html">IOS Localization Guide</a></li>
<li><a href="../322438/index.html">Neural networks in pictures: from one neuron to deep architectures</a></li>
<li><a href="../322440/index.html">Full automation of the ‚Äúdevelopment‚Äù environment using docker-compose</a></li>
<li><a href="../322442/index.html">MIPSfpga and in-circuit debugging</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>