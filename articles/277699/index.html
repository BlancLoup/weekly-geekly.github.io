<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Understanding Docker</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you have never supported other people's applications, or even yours, but with such dimensions that they no longer fit in one head, then you should ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Understanding Docker</h1><div class="post__text post__text-html js-mediator-article"><p>  <em>If you have never supported other people's applications, or even yours, but with such dimensions that they no longer fit in one head, then you should relax, sit back and take what you read as an instructive tale with contrived problems, a funny storyline and an obvious happy one. the end.</em>  <em>Otherwise, if you have real combat experience, welcome to hell, but with IDDQD and IDKFA.</em> </p><br><p>  <strong>For your information!</strong>  In this article, we look at the phenomenon of docker containers itself, rather than compiling a list of microservices that nest inside.  This we will do in the next series, in the name of justice! </p><br><p>  <strong>UPDATE</strong> : I had to replace ‚Äúdocker‚Äù with ‚Äúdocker‚Äù, otherwise the article is not searched.  I apologize in advance for all the ‚Äúdockers‚Äù in the text.  Selyavi. </p><br><h2 id="chto-my-imeem-segodnya">  What do we have today </h2><br><ul><li>  Zoo oak VPS-hosting. </li><li>  Dear IaaS and PaaS with guaranteed vendor lock in. </li><li>  Unique server snowflakes. </li><li>  A bunch of obsolete dependencies on unsupported OSes. </li><li>  Hidden communications of parts of the application. </li><li>  An indispensable admin demigod on a skateboard. </li><li>  A rainbow of environments: development, testing, integration, staging, production. </li><li>  Configs generation for configs management system. </li><li>  Feature flagging. <br><a name="habracut"></a></li></ul><br><p>  Surprisingly, the root of all these problems is only in one thing: it is expensive to raise the server, and then it is also expensive to put out.  The time spent on artistic weaving by configs can be expensive, or the hardware is just starting for a long time, or the servers need to be backed up cleverly and then restored, or simply and quickly, but it works only on some uniquely expensive platform from which you cannot escape. </p><br><p>  Of course, this is the captain's entry.  And the goal of entry is just in captaincy - to show that these problems are already so trivial that even a simple enumeration makes them in some places hurt. </p><br><p>  If we imagine that it takes a minute for the cold start of the application on the new machine, and all the data are safe, then it becomes easier to breathe immediately, and the face appears to write useful code instead of fussing with the server. </p><br><p>  If your ears speak English, then please first listen to the enthusiastic <a href="https://www.youtube.com/watch%3Fv%3DQ5POuMHxW-0">Introduction to docker</a> from the founder. </p><br><h2 id="nazad-k-osnovam">  Back to basics </h2><br><p>  As often happens, at some point the state of a certain system becomes unmanageable and requires new technologies.  In programming, however, it often happens the other way around - you need to remember the old technology.  Here and in the case of docker, nothing new happened: they took the principles of <a href="https://www.youtube.com/watch%3Fv%3DybSBCVhVWs8%26feature%3Dyoutu.be%26t%3D31m34s">functional programming</a> (others <a href="https://habrahabr.ru/post/267441/">see OOP</a> ) and microkernels, applied applications (servers, networks, etc.) to the infrastructure layer and got stateless-immune-isolated-microservices.  All docker's charms grow from this.  As you know, the functional area is not as simple as Rich Hickey would like.  So that you can use the wisdom of your ancestors every day, you need to have good tools.  Docker is just such a tool. </p><br><p>  Here are the basic differences of the docker container (not microservice, see above) from a simple server. </p><br><p>  <strong>Stateless</strong> </p><br><p>  The configuration of the container cannot and should not change after launch.  All preliminary work is done at the stage of creating an image or starting a container: configs, ports, shared folders, environment variables, all this should be known by the time the container starts.  Of course, the docker allows the process running inside the container to do with its memory and file system everything that it pleases, but touching something that could be touched before launch is considered a bad tone. </p><br><p>  <strong>Pure</strong> </p><br><p>  The container does not know anything about the host system and can not interfere with other containers: neither get into someone else's file system, nor send a signal to someone else's process, or even knock on a random port.  That's what he and the container.  By itself, docker will allow containers to communicate, but only in strictly declared ways.  You can also run containers endowed with some kind of superpower, for example, access to a real network or physical device. </p><br><p>  <strong>Lazy</strong> </p><br><p>  When launched, the container does not copy the file system of the image from which it was created.  The container just creates an empty file system on top of the image.  In docker, this is called a layer.  Images are arranged in the same way.  The image consists of a list of (geological) layers overlapping each other.  From here such high speed of start of the new container: less than a second. </p><br><p>  <strong>Declarative</strong> </p><br><p>  All container properties are stored in a declarative form.  The stages of creating an image are also described in strictly separated steps.  Network settings, file system contents, memory size, public ports and so on and so forth is set in the Dockerfile or static keys at startup.  All this is easy to read on a pair of text screens, even for a very complex system. </p><br><p>  <strong>Functional</strong> </p><br><p>  A container does only one thing, but does it well.  It is assumed that in the container will live only one process (possible with the family), performing only one function in the application.  Due to the fact that the container does not have its own kernel, boot partition, init-process and, more often, even the user is only one (pseudo-root) - that is, there is no full-fledged operating system in the container - due to the lack of all this, the container starts so quickly how your service would start if the operating system was already fully loaded.  This narrow specialization makes the function implemented by the container predictable and scalable.  Since there is only one process, he has nowhere to wait (if only from the outside) for overflowing of logs, getting into a swap and the like. </p><br><p>  <strong>Strict</strong> </p><br><p>  By default, the docker denies the container everything except access to the network (which can also be denied).  However, if necessary, it is allowed to break any of these rules, when it is more logical to break the rules.  And what is interesting, allowing access is as easy as denying access.  Connecting or disconnecting containers in docker with each version becomes easier and simpler, especially pleased with the network distributed across data centers. </p><br><h2 id="chem-docker-ne-yavlyaetsya">  What docker is not </h2><br><p>  Docker is often confused with Vagrant or OpenVZ, or even VirtualBox.  Docker is just a user-space daemon in the Go language that skillfully juggles with already existing Linux kernel technologies.  I think it is worth explaining in more detail, since I myself began to get acquainted with the topic with the query ‚Äúdocker vs.  vagrant. </p><br><p>  <strong>Non-vagrant</strong> </p><br><p>  Vagrant is committed to managing virtual machines (or, more closely to the topic of hosting, virtual servers).  Just like the docker, the vagrant has a whole library of virtual machine images, and he, like the docker, knows how to snatch, download and upload, configure and run.  But again, Vagrant manages full-fledged heavy virtual machines running, for example, in VirtualBox, VMWare, DigitalOcean, AWS, and wherever it does not start them.  Gorgeous thing, this vagrant, if you need a full-fledged virtual machine with a state inside. </p><br><p>  <strong>Non virtual machine</strong> </p><br><p> , docker      (),   KVM/Qemu, VirtualBox/VMWare/Parallels, XEN, etc. Docker- (     <code>docker</code>)     ( <a href="https://channel9.msdn.com/Events/Ignite/2015/BRK2493">  </a>)    .  ,   ,     ,          .     OpenVZ   Linux Containers    ,   ,    .</p><br>
<h2 id="a-chto-zhe-togda-docker">    docker?</h2><br>
<p>Docker    :</p><br>
<ol>
<li><p><strong>docker daemon</strong> ‚Äî  docker'.     -      ,    ,    ,        (   0.8   ).       ,    ,    docker-client.</p><br>
</li>
<li><p><strong>docker</strong>      docker-  HTTP.        .  ,   docker'   ,       .       <code>docker</code>   :     tar.gz     docker-daemon,     .  -          .</p><br>
</li>
<li><strong>Docker Hub</strong>    .    <code>docker run ruby</code> docker          .    ,         .</li>
</ol><br>
<h2 id="chto-docker-zamenil"> docker </h2><br>
<p>     ,         docker'.  ,           ( , ,  SSH  Git   ?).</p><br>
<p><strong>Chef / Puppet / Ansible</strong></p><br>
<p>    ‚Äî    stateful .        <a href="https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/">Dockerfile</a>.   docker      ,      ,     ,        .       .      docker'  Chef    stateless ,     docker,          -,   FreeBSD 4.11.</p><br>
<p><strong>Upstart / SystemD / Supervisor / launchd / God.rb / SysVinit,  </strong></p><br>
<p>   ,       .     <code>docker daemon</code>,   init-      ,  ,   , ,  ,         ,      ¬´¬ª.</p><br>
<p><strong>Ubuntu_14.04.iso / AMI-W7FIS1T / apt-get update</strong></p><br>
<p>    , docker , ,       DVD- (     Dell ),        ,        .  ,            ,           <a href="https://hub.docker.com/">Docker Hub</a>.    <code>apt-get update</code>   ‚Äî          .</p><br>
<p><strong>RUBY_ENV, database.dev.yml, testing vs. staging vs. backup</strong></p><br>
<p>  docker         --   ,   ,            .   ,      ,       ,            .              ‚Äî <code>docker-compose up</code>              .    docker' 1.10       SHA256   .</p><br>
<p><strong>Xcode, brew, port install, ./configure &amp;&amp; make &amp;&amp; sudo make install, mysql --version</strong></p><br>
<p>,        ,       ,          .   ,   ,      ‚Ä¶ Docker    ,  ,      .      .</p><br>
<p><strong>SSH (sic!), VPN, Capistrano, Jenkins-slave</strong></p><br>
<p>        root  ,       .  docker'         ,    ,          .     <code>docker run</code>     docker       TLS   .      : <code>docker exec -it %containername% bash</code>        .   <code>rsync</code>  docker'    : <code>rsync -e 'docker exec -i' --blocking-io -rv CONTAINER_NAME:/data .</code>,  <a href="https://github.com/docker/docker/issues/13660"> </a>  <code>--blocking-io</code>.</p><br>
<p><strong>Git (!!!)</strong></p><br>
<p> Git      ? ! Docker    Git,   .  <code>git push</code> (        Github‚Äô)   <code>docker push</code>.    , <code>docker-compose up</code>.      . ,    zero-downtime ,    .    ,    <code>MAINTENANCE.HTML</code>      . ,           ,   ( )  ,           .</p><br>
<p><strong>Datacenter lock-in</strong></p><br>
<p>,   .          ,   ‚Äî       .     ,    ,      ,       .</p><br>
<p><strong>bundler, rvm, dotenv, /opt</strong></p><br>
<p>           ‚Äî    docker   .         ‚Äî        bundle exec.</p><br>
<p><strong>*.log, *.pid</strong></p><br>
<p> ,    docker.  <a href="https://docs.docker.com/engine/admin/logging/overview/">   </a> (kudos ‚ûû <a href="https://habrahabr.ru/users/fesor/" class="user_link">Fesor</a>)     .   .</p><br>
<p><strong>useradd www</strong></p><br>
<p>     ,  - -       ,     .          ,     .     ,   (   ,   , )   .</p><br>
<p><strong>chroot, CGroups, LXC</strong></p><br>
<p>Docker           libcontainer, runC, libnetwork.     LXC,    docker.        ,      docker'.</p><br>
<h2 id="vkusnosti-dockera"> docker'</h2><br>
<p><strong>Dockerfile</strong></p><br>
<p> ,  Dockerfile    Chef-,    .    :          ‚Äî     .   ‚Äî   .    ,   API    ,   .               .        ,          .        .</p><br>
<p><strong> </strong></p><br>
<p>  docker  ,  <a href="https://jpetazzo.github.io/assets/2015-03-03-not-so-deep-dive-into-docker-storage-drivers.html">  copy-on-write </a>.      readonly     ,  ,     ,   readonly,       .     ,      .</p><br>
<p><strong>  </strong></p><br>
<p><a href="https://habrahabr.ru/users/fesor/" class="user_link">Fesor</a>:</p><br>
<blockquote>    <a href="https://docs.docker.com/engine/admin/logging/overview/"> </a>,   <a href="https://docs.docker.com/engine/extend/plugins_volume/"> </a>  <a href="https://docs.docker.com/engine/extend/plugins_network/"></a>‚Ä¶ ‚Ä¶          .</blockquote><p> ,  <a href=""></a> <a href=""></a>   . ,    , ¬´ ¬ª.</p><br>
<p><strong>docker-daemon ‚Äî   HTTP-</strong></p><br>
<p>,      ,   Single Actor   ,   nginx.          docker  Go,       ,    docker'.</p><br>
<p><strong>docker in docker</strong></p><br>
<p>      .   ,        ,  docker'.   : </p><br>
<pre><code>docker run -v /var/run/docker.sock:/var/run/docker.sock \
       -v $(which docker):/bin/docker \
       -ti ubuntu</code></pre><br>
<p>     docker-in-docker,    <a href="http://jpetazzo.github.io/2015/09/03/do-not-use-docker-in-docker-for-ci/"> </a>.</p><br>
<p><strong>VXLAN</strong></p><br>
<p>   docker'    .      ,   .     docker'         ,      .     ,   ,    .   docker       VXLAN,       docker'      IP .                .  ,        ,        .     NAS ,      .</p><br>
<h2 id="kuda-dalshe"> ?</h2><br>
<p>     , docker   , docker-in-docker-in-docker. ,    , docker       ,    .</p><br>
<p><strong>Swarm? Machine! Compose!!!</strong></p><br>
<p>  docker',        docker',    : <a href="https://docs.docker.com/machine/">Machine</a>, <a href="https://docs.docker.com/compose/">Compose</a>  <a href="https://docs.docker.com/swarm/">Swarm</a>.   ‚Äî   .</p><br>
<h2 id="robota-nad-ashipkami">  </h2><br>
<p>     .     ,    ,    .</p><br>
<p><a href="https://habrahabr.ru/users/vasilioruzanni/" class="user_link">VasilioRuzanni</a>:</p><br>
<blockquote>  Phusion    <a href="http://phusion.github.io/baseimage-docker/">baseimage-docker</a>  ?</blockquote><p> ,      :</p><br>
<ol>
<li><p>Ubuntu      .</p><br>
<p>    docker'   <a href="https://github.com/tianon/docker-brew-ubuntu-core/blob/dist/precise/Dockerfile"> </a>   <a href="https://habrahabr.ru/post/247903/"> init   dpkg</a>. ,   .    OpenVZ     ,  , <a href="http://www.inshaker.ru/">  </a>   .</p><br>
</li>
<li><p> init ‚Äî  .</p><br>
<p>,    .   <a href="https://gist.github.com/peter-leonov/f5d2b172fec5e2713a6a">fork-</a>,   10   -  docker'     SSH: can't fork.   docker',  <code>docker ps</code>    ,  <code>docker kill</code>      .</p><br>
<p>,   ,   - ,  -  .         ,    ,       .           ,     ?          by design,  ,    , , <a href="https://github.com/krallin/tini">tini</a>.</p><br>
</li>
<li><p>Syslog?</p><br>
<p>  docker ,       STDOUT  STDERR, syslog  . Docker   ,         .   , , -,     ,  -,      .</p><br>
</li>
<li><p>Cron?</p><br>
<p> ?     ?      2016 ? ,  - , ,  ,  docker        .              <a href="http://jpetazzo.github.io/2015/09/03/do-not-use-docker-in-docker-for-ci/">   </a>.</p><br>
</li>
<li><p>SSH?</p><br>
<p> ,   <code>docker</code>    SSH.       ,   ,     .   <a href="https://docs.docker.com/engine/reference/commandline/cp/"> scp</a>.</p><br>
</li>
<li><p>,  docker        !</p><br>
<p>,  !</p><br>
</li>
<li><p>     docker'  OpenVZ.</p><br>
<p>   .</p><br>
</li>
</ol><br>
<p><a href="https://habrahabr.ru/users/powerman/" class="user_link">powerman</a>:</p><br>
<blockquote>      ‚Ä¶</blockquote><p>  .</p><br>
<p>-,     ,         ,    ¬´ ¬ª,     ,  ,   ,    .  ‚Äî  .</p><br>
<p> -,   ¬´ ¬ª,        -  ,    .         docker'    ‚Äî - ‚Äî .</p><br>
<p> ,      ,   : hardened gcc ( PIE  SSP)      shellshock -        ¬´    ¬ª,   100500   ?</p><br>
<p>        .       .      .   ,     docker',     ,   .        ,  CQRS   .           ,       .</p><br>
<p><a href="https://habrahabr.ru/users/grossws/" class="user_link">grossws</a>:</p><br>
<blockquote> vxlan,        , ‚Äî  . . .   --link  ,         .      ,    --link,   ? , ,   tinc (p2p vpn),   .</blockquote><p>     --link,   ,    .                , ,  .</p><br>
<p>@:</p><br>
<blockquote>Docker   ,     ¬´ ¬ª.     ,      ¬´ ¬ª.</blockquote><p>  ¬´ ¬ª .   ,  , ,   .</p><br>
<p><a href="https://habrahabr.ru/users/scf/" class="user_link">Scf</a>:</p><br>
<blockquote>         ,     ,      (, ),          ,         -  , ‚Ä¶<br>
    ,     ,     ,  ,    ,             json-,  .</blockquote><p>,     .      ,    ,  .    ,    ,       ;)</p><br>
<p><a href="https://habrahabr.ru/users/fesor/" class="user_link">Fesor</a>:</p><br>
<blockquote>‚Ä¶      (shared memory     )</blockquote><p>Shared memory      .        ,    docker',            ( inode   ),   .   docker'  :  <code>mmap</code>    volume'  .</p><br>
<p> ,  docker       ,              .</p><br>
<p><a href="https://habrahabr.ru/users/jpeg/" class="user_link">JPEG</a>:</p><br>
<blockquote>,       :     --theirs.   :)</blockquote><p>  ,    ,    .    ,   ,       .  , <a href="https://youtu.be/Q5POuMHxW-0%3Ft%3D2663">   </a>.</p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/277699/">https://habr.com/ru/post/277699/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../277687/index.html">Hotel module 3CX Hotel Phone System</a></li>
<li><a href="../277691/index.html">Digital signature, fast course (translation of the 17th chapter of Powershell in depth)</a></li>
<li><a href="../277693/index.html">Strategies to speed up code on R, part 2</a></li>
<li><a href="../277695/index.html">Top 6 netty optimizations</a></li>
<li><a href="../277697/index.html">The digest of interesting materials from the world of web development and IT for the last week? 199 (February 15 - 21, 2016)</a></li>
<li><a href="../277703/index.html">Leona Philpot - ‚Äúunderwater‚Äù way to cool Microsoft data center</a></li>
<li><a href="../277705/index.html">Library development for iOS / Android on Golang</a></li>
<li><a href="../277707/index.html">10 habits of content developer.js</a></li>
<li><a href="../277711/index.html">C ++ SDK for Amazon Web Services</a></li>
<li><a href="../277713/index.html">Preparing for the CISA exam. Business Continuity Definitions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>