<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We make ourselves simple hours over the weekend.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="An article about how to make a simple electronic clock using a microcontroller over the weekend from scratch. Only the basis of the clock is shown, th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We make ourselves simple hours over the weekend.</h1><div class="post__text post__text-html js-mediator-article"> An article about how to make a simple electronic clock using a microcontroller over the weekend from scratch.  Only the basis of the clock is shown, the number of software and hardware features is limited only by your imagination). <br><img src="http://img514.imageshack.us/img514/3232/smallclockinworkresizewf7.jpg"><br><a name="habracut"></a><br>  This article is a logical continuation of the article on microcontrollers, published on Habr√© on August 26 (http://habrahabr.ru/blogs/hardware/37764/).  The main task I put on is not to give step-by-step instructions on which wiring to which to solder, but to arouse the interest of readers to the topic, motivating for independent study. <br><br>  So, in order to create a watch, it is necessary to master 2 technologies - this is soldering and the creation of printed circuit boards using laser-iron technology. <br>  <a href="http://licrym.org/index.php/%25D0%259F%25D0%25B0%25D0%25B9%25D0%25BA%25D0%25B0">Soldering</a> article: <a href="http://licrym.org/index.php/%25D0%259F%25D0%25B0%25D0%25B9%25D0%25BA%25D0%25B0">licrym.org/index.php/%D0%9F%D0%B0%D0%B9%D0%BA%D0%B0</a> <br>  An article on laser-iron technology for making boards: <a href="http://licrym.org/wiki/index.php%3Fwakka%3DTexnologii/LazernoUtjuzhnajaTexnologijaIzgotovlenijaPlat">licrym.org/wiki/index.php?wakka=Texnologii/LazernoUtjuzhnajaTexnologijaIzgotovlenijaPlat</a> <br><br>  If there is no desire / ability to make a PCB, then you can do with a breadboard, it looks like this: <br><img src="http://www.chip-dip.ru/library/DOC000111246.jpg"><br>  Holes are drilled in it with a pitch of 2.54 mm, a piece of a suitable size is cut off from it, parts are installed and soldered (a circle of copper foil around each hole) and then the necessary connections are made with wire segments.  It looks unaesthetic (cobweb of wires), but it is unnecessary to poison the board. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In the most extreme case, you can replace the mock-up board with a thick cardboard with punctured holes, but then this improvised card cannot be bent or bent. <br><br>  So, we need <b>tools</b> : a soldering iron, side cutters, a multimeter (for debugging, although everything worked right away for me). <br>  <b>Details</b> : attiny2313 microcontroller, pad for it, 2 buttons, 7805 stabilizer microcircuit, four 7-segment LED indicators, I have it SA15‚Äì11GWA (digit height 38 mm).  Any indicator size, the main thing is that the segment current does not exceed 40 mA (see the datasheet for a specific indicator), 4 KT817B transistors, 16 MHz quartz, 2 22 pF capacitors, 220 nF capacitor, and a couple of resistors.  Specific components do not make sense, because  may have to use analogs + resistors are calculated. <br><br>  Let's start with the details in the picture: <br><img src="http://img514.imageshack.us/img514/558/smallclockpartsresizeyo2.jpg"><br>  The microcontroller cost 41 rubles, the indicators at 52.8 rubles apiece.  Total turns 252.2 rubles.  The rest was extracted from the reserves, but in any case the budget would not exceed 300 rubles. <br><br>  The board was drawn by hand in the Sprint Layout 4 program. Here is the etched board: <br><img src="https://habrastorage.org/getpro/geektimes/post_images/574/4c1/c72/5744c1c72fbc9ff5bac82eca11f3a76f.jpg"><br><br>  Photo clock in the collection.  In the background is my power supply, which I described here: <a href="http://licrym.org/wiki/index.php%3Fwakka%3DSdelajjSam/Universal%27nyjjBlokPitanija">Universal Power Supply</a> <br><br><img src="http://img514.imageshack.us/img514/3232/smallclockinworkresizewf7.jpg"><br><br>  View of the clock in the twilight: <br><img src="http://img222.imageshack.us/img222/8530/smallclockindarkresizeho5.jpg"><br><br>  And now let's see how it works.  Here is the scheme (wide, because the link): <br>  <a href="">licrym.org/habrahabr/small_clock_scheme.jpg</a> <br><br>  When the power is turned on, the microcontroller starts.  The microcontroller is clocked from quartz with a frequency of 16 MHz.  In the microcontroller filled control program. <br><br>  The microcontroller has a so-called timer inside, usually there are several of them (8 and 16 bit).  The timer can be used differently, for counting external pulses, for generating a given frequency, for generating a PWM signal, etc.  In this case, we will use it for timing.  We will enable the timer to count pulses on the system bus (ie, 16 MHz of quartz), turn on the prescaler 256 and interrupt by coincidence with the number 625. Ie the timer will tick at 16 MHz / 256 = 62500 Hz, and call the interrupt as soon as the timer will count to 625, ie we will have an interruption every 1/100 sec.  Each program interruption will increase the counter of hundredths of seconds by 1, reset the timer and return to the time display. <br>  If the number of hundredths of a second reaches 100, then we increase by 1 the value of seconds, and by the value of hundredths of a second we reset.  And so on, up to dozens of hours, which are reset on reaching 24 without increasing the next level.  The watches are extremely simple, that is why they do not consider either the date, or the translation for winter / summer time, etc.  These functions can be implemented in software, without changing the hardware, and therefore remain for the implementation of the willing. <br><br>  Having dealt with the timer and interrupts, we get the value of the current time in global variables.  Now let's do the output of these values.  Since the number of microcontroller ports is limited, we will exploit the inertia of view.  The cathodes of all 4 indicators are connected in parallel, and the anodes are switched separately, which allows us at any time to output any digit to any indicator.  By quickly switching the port B, to which the cathodes are connected, and by quickly switching the anodes, we can create the appearance that all 4 digits work for us, although only one works at a time.  In other words, if the current time is 12:51, then we display the number 1 on the first indicator, after a short period of time (I have 1 ms) we display the number 2 on the second indicator, after 1 ms we display 5 on 3 indicator, after 1 ms we display 1 on the 4th indicator and so on in a circle. <br><br>  The buttons are polled after each display cycle (approximately 40 times per second), the pressing processing is equipped with an anti-bounce and a ‚Äúlatch‚Äù in the form of a flag, which makes it possible to count just pressing without being distracted by the hold. <br><br>  Transistors are installed for commutation of anodes.  The fact is that the current that one foot of the port can pass through itself is limited to 40 mA, and my indicator, if all 7 segments and points are turned on (the separate LED on the circuit is just a point) will be 160 mA. <br><br>  The code that controls the clock: <br> <code><a href="http://www.hpinfotech.com/"></a> /***************************************************** <br> This program was produced by the <br> CodeWizardAVR V1.25.7 beta 5 Professional <br> Automatic Program Generator <br> ¬© Copyright 1998-2007 Pavel Haiduc, HP InfoTech srl <br> www.hpinfotech.com <br> <br> Project : Simple AVR Clock <br> Version : <br> Date : 01.05.2008 <br> Author : Spiritus Sancti <br> Company : licrym.org <br> Comments: <br> <br> Chip type : ATtiny2313 <br> Clock frequency : 16,000000 MHz <br> Memory model : Tiny <br> External SRAM size : 0 <br> Data Stack size : 32 <br> *****************************************************/ <br> <br> #include &lt;tiny2313.h&gt; <br> #include &lt;delay.h&gt; <br> #define digit_display_time 1 <br> <br> unsigned char milliseconds, seconds, ten_seconds, minutes, ten_minutes, hours, ten_hours; <br> bit button_pressed1, button_pressed2; <br> <br> // Timer 1 output compare A interrupt service routine <br> interrupt [TIM1_COMPA] void timer1_compa_isr(void) //  100   ,       <br> { milliseconds++; <br> TCNT1H=0x00; <br> TCNT1L=0x00; <br> <br> if (milliseconds &gt;= 100 ) //  .   milliseconds       . <br> { <br> milliseconds = 0; <br> seconds++; <br> }; <br> <br> if (seconds &gt;= 10) <br> { <br> seconds = 0; <br> ten_seconds++; <br> }; <br> <br> if (ten_seconds &gt;= 6) <br> { <br> ten_seconds = 0; <br> minutes++; <br> }; <br> <br> if (minutes &gt;= 10) <br> { <br> minutes = 0; <br> ten_minutes++; <br> }; <br> <br> if (ten_minutes &gt;= 6) <br> { <br> ten_minutes = 0; <br> hours++; <br> }; <br> <br> if (hours &gt;= 10) <br> { <br> hours = 0; <br> ten_hours++; <br> }; <br> <br> if (ten_hours &gt;= 2 &amp;&amp; hours == 4) <br> { <br> ten_hours = 0; <br> hours=0; <br> }; <br> <br> <br> } <br> <br> void main(void) <br> { <br> unsigned char digits[10] = {18, 159, 56, 28, 149, 84, 80, 31, 16, 20}; //   .       ,    . <br> <br> // Crystal Oscillator division factor: 1 <br> <br> CLKPR=0x80; <br> CLKPR=0x00; <br> <br> // Input/Output Ports initialization <br> // Port A initialization <br> // Func2=In Func1=In Func0=In <br> // State2=T State1=T State0=T <br> PORTA=0x00; <br> DDRA=0x00; <br> <br> // Port B initialization <br> // Func7=Out Func6=Out Func5=Out Func4=Out Func3=Out Func2=Out Func1=Out Func0=Out <br> // State7=1 State6=1 State5=1 State4=1 State3=1 State2=1 State1=1 State0=1 <br> PORTB=0xFF; <br> DDRB=0xFF; <br> <br> // Port D initialization <br> // Func6=Out Func5=Out Func4=Out Func3=Out Func2=Out Func1=In Func0=In <br> // State6=0 State5=0 State4=0 State3=0 State2=0 State1=P State0=P <br> PORTD=0x03; <br> DDRD=0x7C; <br> <br> // Timer/Counter 0 initialization <br> // Clock source: System Clock <br> // Clock value: Timer 0 Stopped <br> // Mode: Normal top=FFh <br> // OC0A output: Disconnected <br> // OC0B output: Disconnected <br> TCCR0A=0x00; <br> TCCR0B=0x00; <br> TCNT0=0x00; <br> OCR0A=0x00; <br> OCR0B=0x00; <br> <br> // Timer/Counter 1 initialization <br> // Clock source: System Clock <br> // Clock value: 62,500 kHz <br> // Mode: Normal top=FFFFh <br> // OC1A output: Discon. <br> // OC1B output: Discon. <br> // Noise Canceler: Off <br> // Input Capture on Falling Edge <br> // Timer 1 Overflow Interrupt: Off <br> // Input Capture Interrupt: Off <br> // Compare A Match Interrupt: On <br> // Compare B Match Interrupt: Off <br> TCCR1A=0x00; <br> TCCR1B=0x04; <br> TCNT1H=0x00; <br> TCNT1L=0x00; <br> ICR1H=0x00; <br> ICR1L=0x00; <br> OCR1AH=0x02; <br> OCR1AL=0x71; <br> OCR1BH=0x00; <br> OCR1BL=0x00; <br> <br> // External Interrupt(s) initialization <br> // INT0: Off <br> // INT1: Off <br> // Interrupt on any change on pins PCINT0-7: Off <br> GIMSK=0x00; <br> MCUCR=0x00; <br> <br> // Timer(s)/Counter(s) Interrupt(s) initialization <br> TIMSK=0x40; <br> <br> // Universal Serial Interface initialization <br> // Mode: Disabled <br> // Clock source: Register &amp; Counter=no clk. <br> // USI Counter Overflow Interrupt: Off <br> USICR=0x00; <br> <br> // Analog Comparator initialization <br> // Analog Comparator: Off <br> // Analog Comparator Input Capture by Timer/Counter 1: Off <br> ACSR=0x80; <br> <br> // Global enable interrupts <br> #asm("sei") <br> <br> while (1) <br> { <br> PORTD |=1&lt;&lt;5; //   <br> PORTB = digits[ten_hours]; //     <br> delay_ms(digit_display_time); //,         <br> PORTD &amp;=~(1&lt;&lt;5); //             4  <br> PORTD |=1&lt;&lt;4; <br> PORTB = digits[hours]; <br> if (milliseconds &gt;= 50) PORTB &amp;=~(1&lt;&lt;4); else PORTB|=1&lt;&lt;4; //  <br> delay_ms(digit_display_time); <br> PORTD &amp;=~(1&lt;&lt;4); <br> PORTD |=1&lt;&lt;3; <br> PORTB = digits[ten_minutes]; <br> delay_ms(digit_display_time); <br> PORTD &amp;=~(1&lt;&lt;3); <br> PORTD |=1&lt;&lt;6; <br> PORTB = digits[minutes]; <br> delay_ms(digit_display_time); <br> PORTD &amp;=~(1&lt;&lt;6); <br> <br> //         13 <br> <br> if ((PIND &amp; 1&lt;&lt;0) == 0 &amp;&amp; button_pressed1 == 0) //   1 <br> { <br> delay_ms(1); <br> hours++; <br> button_pressed1 = 1; <br> }; <br> <br> if ((PIND &amp; 1&lt;&lt;0) == 1) button_pressed1=0; //     <br> <br> <br> if ((PIND &amp; 1&lt;&lt;1) == 0 &amp;&amp; button_pressed2 == 0) //   2 <br> { <br> delay_ms(1); <br> minutes++; <br> button_pressed2 = 1; <br> }; <br> <br> if (PIND &amp; 1&lt;&lt;1) button_pressed2=0; <br> <br> <br> <br> <br> }; <br> } <br></code> <br><br>  The program is written in CodeVisionAVR.  The circuit is created in the PROTEUS program.  By the way, there you can draw a virtual circuit of the device in the proteus and immediately launch it for a simulation, knowing whether it is working or not. <br><br>  Needless to say in the article it is impossible to answer all the questions and tell about all the subtleties.  In particular, those who decide to repeat the construction will need to make a programmer (in the simplest case, 4 wiring to the LPT port, unsolder the programming block on the board (connect the 10-pin connector to the MOSI, MISO, SCK, RESET and GND legs) and set the FUSE bits microcontroller that would switch the clock generator from the internal RC chain to external quartz. About all this can be found on sites like avr123.nm.ru) <br><br>  It took me 1.25 days to create these watches from scratch (from the idea to etching the board, decoupling and writing code). <br>  Original article: <a href="http://licrym.org/index.php/%25D0%259F%25D1%2580%25D0%25BE%25D1%2581%25D1%2582%25D1%258B%25D0%25B5_%25D1%2587%25D0%25B0%25D1%2581%25D1%258B">licrym.org/index.php/%D0%9F%D1%80%D0%BE%D1%81%D1%82%D1%8B% D0%B5_%D1%87 81% D1% 8B</a> <br><br>  Features that can be added with a little blood: <br>  1) attach a speaker to one of the free legs and get an alarm clock <br>  2) hang on one of the free legs of the relay and get a timer (for example, to automatically turn on the garland) <br>  3) the microcontroller has a USART module so by picking up a microcircuit - a level converter (for example, MAX232 and a pair of capacitors), you can establish bi-directional communication with a computer via the COM port. <br><br>  PS I created a DIY blog (http://habrahabr.ru/blogs/DIY/) and henceforth I will publish all articles from the category of "do it yourself" there. <br><br>  PPS In order to avoid misunderstanding I explain.  I personally made these watches, and initially I published on my portal licrym.org but decided to transfer to the best and most interesting articles from my portal to Habrahabr. </div><p>Source: <a href="https://habr.com/ru/post/38443/">https://habr.com/ru/post/38443/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../38436/index.html">MTS corporate website</a></li>
<li><a href="../38437/index.html">"Fight with the code"</a></li>
<li><a href="../38440/index.html">How do you feel about the fact that sites generate passwords for you?</a></li>
<li><a href="../384419/index.html">Guide to choosing a scanner for home and office - part 1</a></li>
<li><a href="../38442/index.html">Yandex uses viral marketing!</a></li>
<li><a href="../38444/index.html">Tips for CMS developers and PHP frameworks</a></li>
<li><a href="../38445/index.html">3 Mall</a></li>
<li><a href="../38446/index.html">Does the computer ‚Äúslow down‚Äù? - it's nothing you can do‚Ä¶</a></li>
<li><a href="../38447/index.html">Kohana Framework - Impressions of Usage</a></li>
<li><a href="../38448/index.html">Using PHP and MySQL to create KML</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>