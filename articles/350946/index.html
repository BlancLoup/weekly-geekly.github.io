<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>React + SVG game development. Part 3</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="TL; DR: In these episodes, you'll learn how to get React and Redux to control SVG elements to create a game. The knowledge gained in this series will ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>React + SVG game development. Part 3</h1><div class="post__text post__text-html js-mediator-article"><p>  TL; DR: In these episodes, you'll learn how to get React and Redux to control SVG elements to create a game.  The knowledge gained in this series will allow you to create animation not only for games.  You can find the final version of the source code developed in this part on <a href="https://github.com/auth0-blog/aliens-go-home-part-3">GitHub.</a> </p><br><p>  (the <em>third part is the final one. In addition to completing the development of the game itself, the authorization using Auth0 and a simple realtime server are considered</em> ). </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/715/54e/ffd/71554effd1872a836898f979ab452b60.png" alt="image"></p><a name="habracut"></a><br><p>  The game, the development of which you will be engaged in this series, is called "Aliens, go home!".  The idea of ‚Äã‚Äãthe game is simple: you will have a gun with which you will shoot down "flying discs" that are trying to invade Earth.  To destroy these UFOs, you need to fire a cannon by hovering the cursor and clicking the mouse. </p><br><p>  If you're interested, you can find and run the final version of the game <a href="http://bang-bang.digituz.com.br/">here</a> (the <em>link does not always work - note of the translator</em> ).  But do not get carried away with the game, you have a job! </p><br><h2 id="v-predyduschih-seriyah">  In the previous series </h2><br><p> In the <a href="https://habrahabr.ru/post/350274/">first series,</a> you used <a href="https://github.com/facebook/create-react-app"><code>create-react-app</code></a> to quickly launch a React application, and also install and configure Redux to control the state of the game.  Then you learned how to use SVG with React components, creating <code>Sky</code> , <code>Ground</code> , <code>CannonBase</code> , and <code>CannonPipe</code> game elements.  And finally, you mounted the sight for your gun, using an event handler and an <a href="https://www.w3schools.com/jsref/met_win_setinterval.asp">interval</a> to launch the Redux action, which changes the angle of the <code>CannonPipe</code> . </p><br><p>  With these exercises, you have ‚Äúmastered‚Äù your skills in creating a game (and not only) with the help of React, Redux and SVG. </p><br><p>  In the <a href="https://habrahabr.ru/post/350278/">second series,</a> you created other elements necessary for the game ( <code>Heart</code> , <code>FlyingObject</code> and <code>CannonBall</code> ), gave players the opportunity to start the game and forced the aliens to fly (which they did in the end, right?). </p><br><p>  Despite the fact that all these "features" are very cool, the development of the game was still not finished.  Your gun still does not peel the nuclei, and there is no algorithm that determines that the nucleus has hit the target.  In addition, the value of the <code>CurrentScore</code> component should increase whenever a player knocks down another newcomer. </p><br><p>  Killing aliens and seeing how your points accumulate is, of course, cool, but you can make the game even more interesting.  To do this, you need to add a <em>leaderboard</em> function - leaderboard ranking.  Players will spend even more time to upgrade their rating to the leader. </p><br><p>  After completing all these conditions, you can safely say that you have completed the development.  In this case, we will not waste time and begin. </p><br><p>  Note: if for some reason you do not have the code written in the <a href="https://habrahabr.ru/post/350278/">previous section</a> , you can simply copy it from <a href="https://github.com/auth0-blog/aliens-go-home-part-2">the GitHub repository</a> .  After copying follow the further instructions. </p><br><h2 id="realizaciya-funkcii-leaderboard-reytinga">  <em>LeaderBoard</em> feature <em>implementation</em> (ranking) </h2><br><p>  The first thing you need to do in order for your game to truly become a game is to implement the rating function.  This will allow players to be in the system, and the game will read their maximum points and show their rank. </p><br><h2 id="integriruem-react-i-auth0">  Integrating React and Auth0 </h2><br><p>  In order for Auth0 to identify players, you first need an Auth0 account.  If you don‚Äôt have one yet, you can <a href="https://auth0.com/signup">create a free account here</a> . </p><br><p>  After you start an account, you only need to <a href="https://auth0.com/docs/clients">create an Auth0 Client</a> to represent the game.  To do this, go to the "Clients" page on the Auth0 control panel and click the "Create Client" button.  On the information panel there will be a form where you need to specify the name and type of the client.  You can ask <code>Aliens, Go Home!</code>  as a name and choose the <code>Single Page Web Application</code> (your game is a SPA on React).  Then click "Create". </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/153/316/768/1533167680ef164a3128dbcd1daeae94.png" alt="image"></p><br><p>  After that, you will be redirected to the "Quick Start" tab of your client.  Since in this article you will learn how to integrate React and Auth0, you can ignore this tab.  Instead, you will need the Settings tab, so open it. </p><br><p>  On the "Settings" page you need to do three things.  First, add the value <code>http://localhost:3000</code> to the field called <em>Allowed Callback URLs</em> .  As explained on the dashboard ( <em>in the dashboard</em> ), after authenticating with Auth0, the player will be redirected to the URL specified in this field.  Thus, if you are going to publish the game on the Internet, be sure to add its public URL (for example, <code>http://aliens-go-home.digituz.com.br</code> ). </p><br><p>  After entering all your URLs in this field, click the "Save" button or the <code>ctrl + s</code> keys (if you have a MacBook, press <code>command+s</code> ).  There are two things left: copy the values ‚Äã‚Äãfrom the "Domain" and "Client ID" fields.  But before using them, you need to program a little. </p><br><p>  First you need to enter the following command in the root of the game to install the package <code>auth0-web</code> </p><br><pre> <code class="javascript hljs">npm i auth0-web</code> </pre> <br><p>  As you can see, this package facilitates the integration between Auth0 and SPA. </p><br><p>  The next step is to add a login button to the game so that users can authenticate through Auth0.  To do this, create a new <code>Login.jsx</code> file inside the <code>./src/components</code> directory with the code: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PropTypes <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'prop-types'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Login = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> button = { <span class="hljs-attr"><span class="hljs-attr">x</span></span>: <span class="hljs-number"><span class="hljs-number">-300</span></span>, <span class="hljs-attr"><span class="hljs-attr">y</span></span>: <span class="hljs-number"><span class="hljs-number">-600</span></span>, <span class="hljs-attr"><span class="hljs-attr">width</span></span>: <span class="hljs-number"><span class="hljs-number">600</span></span>, <span class="hljs-attr"><span class="hljs-attr">height</span></span>: <span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-attr"><span class="hljs-attr">style</span></span>: { <span class="hljs-attr"><span class="hljs-attr">fill</span></span>: <span class="hljs-string"><span class="hljs-string">'transparent'</span></span>, <span class="hljs-attr"><span class="hljs-attr">cursor</span></span>: <span class="hljs-string"><span class="hljs-string">'pointer'</span></span>, }, <span class="hljs-attr"><span class="hljs-attr">onClick</span></span>: props.authenticate, }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> text = { <span class="hljs-attr"><span class="hljs-attr">textAnchor</span></span>: <span class="hljs-string"><span class="hljs-string">'middle'</span></span>, <span class="hljs-comment"><span class="hljs-comment">//   x: 0, //    X y: -440, //  440  style: { fontFamily: '"Joti One", cursive', fontSize: 45, fill: '#e3e3e3', cursor: 'pointer', }, onClick: props.authenticate, }; return ( &lt;g filter="url(#shadow)"&gt; &lt;rect {...button} /&gt; &lt;text {...text}&gt; Login to participate! &lt;/text&gt; &lt;/g&gt; ); }; Login.propTypes = { authenticate: PropTypes.func.isRequired, }; export default Login;</span></span></code> </pre> <br><p>  The created component is agnostic in terms of what it performs when pressed.  You define this action by adding it to the <code>Canvas</code> component.  So, open <code>Canvas.jsx</code> and update: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ...   import Login from './Login'; import { signIn } from 'auth0-web'; const Canvas = (props) =&gt; { // ... const definitions return ( &lt;svg ...&gt; // ...   { ! props.gameState.started &amp;&amp; &lt;g&gt; // ... StartGame  Title  &lt;Login authenticate={signIn} /&gt; &lt;/g&gt; } // ... flyingObjects.map &lt;/svg&gt; ); }; // ...  propTypes  </span></span></code> </pre> <br><p>  As you can see, in the new version you imported the <code>Login</code> component and the <code>signIn</code> function from the <code>auth0-web</code> package.  Another component appeared in the code, which is displayed only until users start the game.  You also registered the start of the <code>signIn</code> function when you click the authorization button. </p><br><p>  Having done all this, configure the <code>auth0-web</code> with your Auth0 Client properties.  To do this, open the <code>App.js</code> file: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ...   import import * as Auth0 from 'auth0-web'; Auth0.configure({ domain: 'YOUR_AUTH0_DOMAIN', //  clientID: 'YOUR_AUTH0_CLIENT_ID', //  id redirectUri: 'http://localhost:3000/', responseType: 'token id_token', scope: 'openid profile manage:points', }); class App extends Component { // ...   componentDidMount() { const self = this; Auth0.handleAuthCallback(); Auth0.subscribe((auth) =&gt; { console.log(auth); }); // ... setInterval  onresize } // ... trackMouse  render  } // ... propTypes    export</span></span></code> </pre> <br><blockquote>  Note: you must replace <code>YOUR_AUTH0_DOMAIN</code> and <code>YOUR_AUTH0_CLIENT_ID</code> values ‚Äã‚Äãcopied from the <em>Domain</em> and <em>Client ID</em> fields of your Auth0 client.  In addition, when publishing a game, you also need to replace the value of <code>redirectUri</code> . </blockquote><p>  The improvements in this code are pretty simple.  Here is a list: </p><br><ol><li>  <code>configure</code> : you used this function to configure the <code>auth0-web</code> package with your Auth0 Client properties. </li><li>  <code>handleAuthCallback</code> : This function is called in the <a href="https://reactjs.org/docs/react-component.html"><code>""   componentDidMount</code></a> to determine if a player returns with Auth0 after authentication.  The function simply tries to extract the tokens from the URL, and if successful, selects the player profile and saves everything in <code>localstorage</code> . </li><li>  <code>subscribe</code> : this function is used to determine whether a player is authenticated or not (true - if access, false - if not). </li></ol><br><p>  That's it, now your game uses <a href="https://auth0.com/learn/cloud-identity-access-management/">Auth0 as an identity management service</a> .  If you now start the application ( <code>npm start</code> ) and open it in the browser ( <code>http://localhost:3000</code> ), you will see the login button.  Clicking on it will take you to the <a href="https://auth0.com/docs/hosted-pages/login">Auth0 login</a> page, where you can log in. </p><br><p>  After logging in, Auth0 will redirect you to the game again, where the <code>handleAuthCallback</code> function <code>handleAuthCallback</code> pull out your tokens.  Then, when you tell your application to execute <code>console.log</code> , you can see <code>true</code> in the browser console. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/bfc/c5f/d6a/bfcc5fd6a22a57fa3d2793b58f451f36.png" alt="image"></p><br><h2 id="sozdaem-leaderboard-reyting">  Create LeaderBoard (rating) </h2><br><p>  Now that you have configured Auth0 as an identity management system, you need to create components that display the player‚Äôs rating and maximum points.  They are called: <code>leaderboard</code> and <code>rank</code> .  It will require exactly two components, since it is not so easy to display player data beautifully (for example, points scored, name, position and avatar).  This is not difficult, but for this you have to write some good code.  In general, to make one component out of this is not the most deft device. </p><br><p>  Since as long as you do not have players, first of all you need to define some "mock-up data" ( <em>so-called "fish" - comment of the translator</em> ) in order to fill the leaderboard.  This is best done in the <code>Canvas</code> component.  Also, since you are going to update your canvas, you can also replace the <code>Login</code> component with the <code>Leaderboard</code> component (at the same time, add the <code>Login</code> to the <code>Leaderboard</code> ): </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ...   import //  Login   import Leaderboard from './Leaderboard'; const Canvas = (props) =&gt; { // ...   () const leaderboard = [ { id: 'd4', maxScore: 82, name: 'Ado Kukic', picture: 'https://twitter.com/KukicAdo/profile_image', }, { id: 'a1', maxScore: 235, name: 'Bruno Krebs', picture: 'https://twitter.com/brunoskrebs/profile_image', }, { id: 'c3', maxScore: 99, name: 'Diego Poza', picture: 'https://twitter.com/diegopoza/profile_image', }, { id: 'b2', maxScore: 129, name: 'Jeana Tahnk', picture: 'https://twitter.com/jeanatahnk/profile_image', }, { id: 'e5', maxScore: 34, name: 'Jenny Obrien', picture: 'https://twitter.com/jenny_obrien/profile_image', }, { id: 'f6', maxScore: 153, name: 'Kim Maida', picture: 'https://twitter.com/KimMaida/profile_image', }, { id: 'g7', maxScore: 55, name: 'Luke Oliff', picture: 'https://twitter.com/mroliff/profile_image', }, { id: 'h8', maxScore: 146, name: 'Sebasti√°n Peyrott', picture: 'https://twitter.com/speyrott/profile_image', }, ]; return ( &lt;svg ...&gt; // ...   { ! props.gameState.started &amp;&amp; &lt;g&gt; // ... StartGame  Title &lt;Leaderboard currentPlayer={leaderboard[6]} authenticate={signIn} leaderboard={leaderboard} /&gt; &lt;/g&gt; } // ... flyingObjects.map &lt;/svg&gt; ); }; // ...  propTypes  export</span></span></code> </pre> <br><p>  In the new version, you described the constant <code>leaderboard</code> , which contains an array of fictional players.  These players have the following properties: <code>id</code> , <code>maxScore</code> , <code>name</code> and <code>picture</code> .  Then inside the <code>svg</code> element you added a <code>leaderboard</code> component with the following parameters: </p><br><ul><li>  <code>currentPlayer</code> : determines who is playing at the moment.  You now have fictional players, so you can see how it all works.  The purpose of the transfer of this parameter is to make the player highlighted in the table. </li><li>  <code>authenticate</code> : the same parameter that you previously added to the <code>Login</code> component. </li><li>  <code>leaderboard</code> : an array of fake players.  Used to display the current rating. </li></ul><br><p>  Next, you need to describe the component <code>Leaderboard</code> .  To do this, create a new <code>Leaderboard.jsx</code> file in the <code>./src/components</code> directory and add the following: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PropTypes <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'prop-types'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Login <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./Login'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Rank <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./Rank"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Leaderboard = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> style = { <span class="hljs-attr"><span class="hljs-attr">fill</span></span>: <span class="hljs-string"><span class="hljs-string">'transparent'</span></span>, <span class="hljs-attr"><span class="hljs-attr">stroke</span></span>: <span class="hljs-string"><span class="hljs-string">'black'</span></span>, <span class="hljs-attr"><span class="hljs-attr">strokeDasharray</span></span>: <span class="hljs-string"><span class="hljs-string">'15'</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> leaderboardTitle = { <span class="hljs-attr"><span class="hljs-attr">fontFamily</span></span>: <span class="hljs-string"><span class="hljs-string">'"Joti One", cursive'</span></span>, <span class="hljs-attr"><span class="hljs-attr">fontSize</span></span>: <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-attr"><span class="hljs-attr">fill</span></span>: <span class="hljs-string"><span class="hljs-string">'#88da85'</span></span>, <span class="hljs-attr"><span class="hljs-attr">cursor</span></span>: <span class="hljs-string"><span class="hljs-string">'default'</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> leaderboard = props.leaderboard || []; leaderboard = leaderboard.sort(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">prev, next</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prev.maxScore === next.maxScore) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> prev.name &lt;= next.name ? <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-number"><span class="hljs-number">-1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> prev.maxScore &lt; next.maxScore ? <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-number"><span class="hljs-number">-1</span></span>; }).map(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">member, index</span></span></span><span class="hljs-function">) =&gt;</span></span> ({ ...member, <span class="hljs-attr"><span class="hljs-attr">rank</span></span>: index + <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">currentPlayer</span></span>: member.id === props.currentPlayer.id, })).filter(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">member, index</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (index &lt; <span class="hljs-number"><span class="hljs-number">3</span></span> || member.id === props.currentPlayer.id) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> member; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;g&gt; &lt;text filter=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"url(#shadow)"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> style={leaderboardTitle} x=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"-150"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"-630"</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;Leaderboard&lt;</span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/text&gt; &lt;rect style={style} x="-350" y="-600" width="700" height="330" /</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; { props.currentPlayer &amp;&amp; leaderboard.map((player, idx</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> position = { <span class="hljs-attr"><span class="hljs-attr">x</span></span>: <span class="hljs-number"><span class="hljs-number">-100</span></span>, <span class="hljs-attr"><span class="hljs-attr">y</span></span>: <span class="hljs-number"><span class="hljs-number">-530</span></span> + (<span class="hljs-number"><span class="hljs-number">70</span></span> * idx) }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Rank</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{player.id}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">player</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{player}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">position</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{position}/</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> }) } { ! props.currentPlayer &amp;&amp; </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Login</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">authenticate</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{props.authenticate}</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> } </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">g</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ); }; Leaderboard.propTypes = { currentPlayer: PropTypes.shape({ id: PropTypes.string.isRequired, maxScore: PropTypes.number.isRequired, name: PropTypes.string.isRequired, picture: PropTypes.string.isRequired, }), authenticate: PropTypes.func.isRequired, leaderboard: PropTypes.arrayOf(PropTypes.shape({ id: PropTypes.string.isRequired, maxScore: PropTypes.number.isRequired, name: PropTypes.string.isRequired, picture: PropTypes.string.isRequired, ranking: PropTypes.number, })), }; Leaderboard.defaultProps = { currentPlayer: null, leaderboard: null, }; export default Leaderboard;</span></span></code> </pre> <br><p>  Do not be scared!  In fact, the code is quite simple: </p><br><ol><li>  You define the <code>leaderboardTitle</code> constant to set how the ranking table title will look. </li><li>  You define the <code>dashedRectangle</code> constant to create a <code>rect</code> element that will serve as a "container" for the table. </li><li>  You call the <code>sort</code> function of the <code>props.leaderboard</code> variable to sort the rank.  After that, the top row of the table will be occupied by the player with the most points, and the bottom - by the least.  In case of equality of points among the players, they are ordered by name. </li><li>  According to the results of the previous action, the <code>map</code> function is called to add each player his rank and add the <code>currentPlayer</code> flag.  This flag highlights the line on which the current player is located. </li><li>  As a result of the previous step ( <code>map</code> function), you use the <code>filter</code> function to <code>filter</code> out players who are not in the TOP-3.  In fact, you allow the current player to remain in the final array, even if he is not among the top three. </li><li>  Finally, you iterate through the filtered array to show the <code>Rank</code> elements if the player is logged in ( <code>props.currentPlayer</code> &amp;&amp; <code>leaderboard.map</code> ), or otherwise the <code>Login</code> button is displayed. </li></ol><br><p>  We proceed to the final stage - we create the <code>Rank</code> component.  To do this, create a new <code>Rank.jsx</code> file next to the <code>Leaderboard.jsx</code> file with the code: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PropTypes <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'prop-types'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Rank = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { x, y } = props.position; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rectId = <span class="hljs-string"><span class="hljs-string">'rect'</span></span> + props.player.rank; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> clipId = <span class="hljs-string"><span class="hljs-string">'clip'</span></span> + props.player.rank; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pictureStyle = { <span class="hljs-attr"><span class="hljs-attr">height</span></span>: <span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-attr"><span class="hljs-attr">width</span></span>: <span class="hljs-number"><span class="hljs-number">60</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> textStyle = { <span class="hljs-attr"><span class="hljs-attr">fontFamily</span></span>: <span class="hljs-string"><span class="hljs-string">'"Joti One", cursive'</span></span>, <span class="hljs-attr"><span class="hljs-attr">fontSize</span></span>: <span class="hljs-number"><span class="hljs-number">35</span></span>, <span class="hljs-attr"><span class="hljs-attr">fill</span></span>: <span class="hljs-string"><span class="hljs-string">'#e3e3e3'</span></span>, <span class="hljs-attr"><span class="hljs-attr">cursor</span></span>: <span class="hljs-string"><span class="hljs-string">'default'</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (props.player.currentPlayer) textStyle.fill = <span class="hljs-string"><span class="hljs-string">'#e9ea64'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pictureProperties = { <span class="hljs-attr"><span class="hljs-attr">style</span></span>: pictureStyle, <span class="hljs-attr"><span class="hljs-attr">x</span></span>: x - <span class="hljs-number"><span class="hljs-number">140</span></span>, <span class="hljs-attr"><span class="hljs-attr">y</span></span>: y - <span class="hljs-number"><span class="hljs-number">40</span></span>, <span class="hljs-attr"><span class="hljs-attr">href</span></span>: props.player.picture, <span class="hljs-attr"><span class="hljs-attr">clipPath</span></span>: <span class="hljs-string"><span class="hljs-string">`url(#</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${clipId}</span></span></span><span class="hljs-string">)`</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> frameProperties = { <span class="hljs-attr"><span class="hljs-attr">width</span></span>: <span class="hljs-number"><span class="hljs-number">55</span></span>, <span class="hljs-attr"><span class="hljs-attr">height</span></span>: <span class="hljs-number"><span class="hljs-number">55</span></span>, <span class="hljs-attr"><span class="hljs-attr">rx</span></span>: <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-attr"><span class="hljs-attr">x</span></span>: pictureProperties.x, <span class="hljs-attr"><span class="hljs-attr">y</span></span>: pictureProperties.y, }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( &lt;g&gt; &lt;defs&gt; &lt;rect id={rectId} {...frameProperties} /&gt; &lt;clipPath id={clipId}&gt; &lt;use xlinkHref={'#' + rectId} /&gt; &lt;/clipPath&gt; &lt;/defs&gt; &lt;use xlinkHref={'#' + rectId} strokeWidth="2" stroke="black" /&gt; &lt;text filter="url(#shadow)" style={textStyle} x={x - 200} y={y}&gt;{props.player.rank}¬∫&lt;/text&gt; &lt;image {...pictureProperties} /&gt; &lt;text filter="url(#shadow)" style={textStyle} x={x - 60} y={y}&gt;{props.player.name}&lt;/text&gt; &lt;text filter="url(#shadow)" style={textStyle} x={x + 350} y={y}&gt;{props.player.maxScore}&lt;/text&gt; &lt;/g&gt; ); }; Rank.propTypes = { player: PropTypes.shape({ id: PropTypes.string.isRequired, maxScore: PropTypes.number.isRequired, name: PropTypes.string.isRequired, picture: PropTypes.string.isRequired, rank: PropTypes.number.isRequired, currentPlayer: PropTypes.bool.isRequired, }).isRequired, position: PropTypes.shape({ x: PropTypes.number.isRequired, y: PropTypes.number.isRequired }).isRequired, }; export default Rank;</code> </pre> <br><p>  Do not be afraid of this code.  Only one thing is unusual in it - you add the <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Element/clipPath"><code>clipPath</code></a> and <code>rect</code> elements to this component inside the <code>defs</code> element to create a rounded portrait. <br>  After all this, you can go to the application ( <code>http://localhost:3000/</code> ) to see your new rating table. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/549/5b9/9c4/5495b99c4b6b38a99fd3829a705acab6.png" alt="image"></p><br><h2 id="sozdaem-tablicu-retinga-v-realnom-vremeni-s-pomoschyu-socketio">  Create a "real-time" rating table using Socket.IO </h2><br><p>  Great, now you use Auth0 as an identity management service and have all the components to display a rating table.  What's next?  That's right, you need a backend capable of sending real-time events to update the rating table. </p><br><p>  Perhaps you thought it would be difficult to create such a server ( <em>backend</em> )?  No, absolutely not.  With <a href="https://socket.io/">Socket.IO,</a> you can easily develop this feature.  However, you would want to protect this service, right?  To do this, you need to create <a href="https://auth0.com/docs/apis">an Auth0 API</a> to represent your service. </p><br><p>  Make it not so difficult.  Just go to the API page of the Auth0 control panel and click the "Create API" button.  After that, you must fill out a form with three fields: </p><br><ol><li>  <em>API</em> <em>name</em> ( <em>name</em> ): you just need to set a friendly name to remember what the given API represents.  So call: "Aliens, go back home!". <br>  2. <em>API</em> <em>identifier</em> ( <em>identifier</em> ): here it is recommended to specify the final URL of the game, but in fact you can paste anything.  However, enter <code>https://aliens-go-home.digituz.com.br</code> . </li><li>  <em>The</em> <em>Signing Algorithm</em> offers two options: RS256 and HS256.  You'd better leave this field blank (default is RS256).  If you are interested in what the difference is, check <a href="https://community.auth0.com/answers/6945/view">here</a> . </li></ol><br><p><img src="https://habrastorage.org/getpro/habr/post_images/981/e0c/410/981e0c4100c36160a61723f8ac45a5f8.png" alt="image"></p><br><p>  When complete all fields, click "Create".  You will be redirected to the <em>Quick Start</em> tab inside your new API.  From there, click on the <em>"Scopes"</em> tab ( <em>Fields</em> ) and add a new area called <code>manage:points</code> with the following description: "Reading and writing maximum points."  <a href="https://auth0.com/docs/scopes/current">This is a good way to define areas in Auth0 API applications.</a> </p><br><p>  After you add an area, you'll have to program a little.  To implement a real-time rating table, do the following: </p><br><pre> <code class="javascript hljs">#      mkdir server #    ( ) cd server #  NPM npm init -y #   npm i express jsonwebtoken jwks-rsa socket.io socketio-jwt #   touch index.js</code> </pre> <br><p>  In the new file, add the code: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> app = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>)(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>).Server(app); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> io = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'socket.io'</span></span>)(http); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> jwt = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'jsonwebtoken'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> jwksClient = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'jwks-rsa'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> client = jwksClient({ <span class="hljs-attr"><span class="hljs-attr">jwksUri</span></span>: <span class="hljs-string"><span class="hljs-string">'https://YOUR_AUTH0_DOMAIN/.well-known/jwks.json'</span></span> <span class="hljs-comment"><span class="hljs-comment">//   }); const players = [ { id: 'a1', maxScore: 235, name: 'Bruno Krebs', picture: 'https://twitter.com/brunoskrebs/profile_image', }, { id: 'c3', maxScore: 99, name: 'Diego Poza', picture: 'https://twitter.com/diegopoza/profile_image', }, { id: 'b2', maxScore: 129, name: 'Jeana Tahnk', picture: 'https://twitter.com/jeanatahnk/profile_image', }, { id: 'f6', maxScore: 153, name: 'Kim Maida', picture: 'https://twitter.com/KimMaida/profile_image', }, { id: 'e5', maxScore: 55, name: 'Luke Oliff', picture: 'https://twitter.com/mroliff/profile_image', }, { id: 'd4', maxScore: 146, name: 'Sebasti√°n Peyrott', picture: 'https://twitter.com/speyrott/profile_image', }, ]; const verifyPlayer = (token, cb) =&gt; { const uncheckedToken = jwt.decode(token, {complete: true}); const kid = uncheckedToken.header.kid; client.getSigningKey(kid, (err, key) =&gt; { const signingKey = key.publicKey || key.rsaPublicKey; jwt.verify(token, signingKey, cb); }); }; const newMaxScoreHandler = (payload) =&gt; { let foundPlayer = false; players.forEach((player) =&gt; { if (player.id === payload.id) { foundPlayer = true; player.maxScore = Math.max(player.maxScore, payload.maxScore); } }); if (!foundPlayer) { players.push(payload); } io.emit('players', players); }; io.on('connection', (socket) =&gt; { const { token } = socket.handshake.query; verifyPlayer(token, (err) =&gt; { if (err) socket.disconnect(); io.emit('players', players); }); socket.on('new-max-score', newMaxScoreHandler); }); http.listen(3001, () =&gt; { console.log('listening on port 3001'); });</span></span></code> </pre> <br><p>  Before you <code>YOUR_AUTH0_DOMAIN</code> what this code does, replace <code>YOUR_AUTH0_DOMAIN</code> your Auth0 domain (the one that you added to the <code>App.js</code> file).  This value is in the <code>jwksUri</code> property. </p><br><p>  Now, to understand how this works, read the following list: </p><br><ol><li>  <code>express</code> and <code>socket.io</code> : this is just an <a href="https://expressjs.com/">express server</a> , extended with Socket.IO, to teach it to work in real time.  If you have not previously used Socket.IO, check out their tutorial <a href="https://socket.io/get-started/">Get Started</a> .  It is quite simple. </li><li>  <code>jwt</code> and <code>jwksClient</code> : when authenticating with Auth0, your players will receive (among other things) <code>access_token</code> as JWT (JSON Web Token).  Since you are using the RS256 algorithm, you need to use the <code>jwksClient</code> package to get the correct public key to verify JWT. </li><li>  <code>jwt.verify</code> : how to get the correct key, use this function to decode and evaluate JWT.  If everything is in order, you simply send a list of players as requested.  If not, then <code>disconnect</code> client ( <code>socket</code> ). </li><li>  <code>on('new-max-score', ...)</code> : Finally, you attach the <code>newMaxScoreHandler</code> function to the <code>new-max-score</code> event.  Thus, whenever you need to update a user's maximum points, you trigger this event from React. </li></ol><br><p>  The rest of the code is intuitive.  You can focus on integrating this service into the game. </p><br><h2 id="socketio-i-react">  Socket.IO and React </h2><br><p>  After creating your "realtime backend service", let's proceed to integrating it into React.  The best way to use React and Socket.IO is to install <a href="https://github.com/socketio/socket.io-client"><code> socket.io-client</code></a> .  To do this, enter the following code in the root of the React application: </p><br><pre> <code class="javascript hljs">npm i socket.io-client</code> </pre> <br><p>  Then you connect the game to your service every time you authenticate players (there will be no unauthorized users in the table).  Since you use Redux to store the state of the game, you need two steps to update its storage.  Open the <code>./src/actions/index.js</code> file and update it: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> LEADERBOARD_LOADED = <span class="hljs-string"><span class="hljs-string">'LEADERBOARD_LOADED'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> LOGGED_IN = <span class="hljs-string"><span class="hljs-string">'LOGGED_IN'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// ... MOVE_OBJECTS  START_GAME ... export const leaderboardLoaded = players =&gt; ({ type: LEADERBOARD_LOADED, players, }); export const loggedIn = player =&gt; ({ type: LOGGED_IN, player, }); // ... moveObjects  startGame ...</span></span></code> </pre> <br><p>  The new version defines actions that should be launched in two steps: </p><br><ol><li>  <code>LOGGED_IN</code> : this action connects the game to the backend when the player logs in. </li><li>  <code>LEADERBOARD_LOADED</code> : <code>LEADERBOARD_LOADED</code> this action, you update the Redux store with ‚Äúplayers‚Äù when the backend sends a list of players. </li></ol><br><p>  To have Redux respond to these steps, open the <code>./src/reducers/index.js</code> file and update it: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { LEADERBOARD_LOADED, LOGGED_IN, MOVE_OBJECTS, START_GAME } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../actions'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// ...  import  const initialGameState = { // ...     currentPlayer: null, players: null, }; // ...  initialState function reducer(state = initialState, action) { switch (action.type) { case LEADERBOARD_LOADED: return { ...state, players: action.players, }; case LOGGED_IN: return { ...state, currentPlayer: action.player, }; // ... MOVE_OBJECTS, START_GAME,  default case } } export default reducer;</span></span></code> </pre> <br><p> ,     <code>LEADERBOARD_LOADED</code> ,   Redux   .  ,  ,     ,   <code>currentPlayer</code>  . </p><br><p> ,       ,   <code>./src/containers/Game.js</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ...   import import { leaderboardLoaded, loggedIn, moveObjects, startGame } from '../actions/index'; const mapStateToProps = state =&gt; ({ // ... angle  gameState currentPlayer: state.currentPlayer, players: state.players, }); const mapDispatchToProps = dispatch =&gt; ({ leaderboardLoaded: (players) =&gt; { dispatch(leaderboardLoaded(players)); }, loggedIn: (player) =&gt; { dispatch(loggedIn(player)); }, // ... moveObjects  startGame }); // ...  connect  export</span></span></code> </pre> <br><p>  ,     realtime- ( <em> </em> ),    .     <code>./src/App.js</code>   : </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ...   import import io from 'socket.io-client'; Auth0.configure({ // ...   audience: 'https://aliens-go-home.digituz.com.br', }); class App extends Component { // ...  componentDidMount() { const self = this; Auth0.handleAuthCallback(); Auth0.subscribe((auth) =&gt; { if (!auth) return; const playerProfile = Auth0.getProfile(); const currentPlayer = { id: playerProfile.sub, maxScore: 0, name: playerProfile.name, picture: playerProfile.picture, }; this.props.loggedIn(currentPlayer); const socket = io('http://localhost:3001', { query: `token=${Auth0.getAccessToken()}`, }); let emitted = false; socket.on('players', (players) =&gt; { this.props.leaderboardLoaded(players); if (emitted) return; socket.emit('new-max-score', { id: playerProfile.sub, maxScore: 120, name: playerProfile.name, picture: playerProfile.picture, }); emitted = true; setTimeout(() =&gt; { socket.emit('new-max-score', { id: playerProfile.sub, maxScore: 222, name: playerProfile.name, picture: playerProfile.picture, }); }, 5000); }); }); // ... setInterval  onresize } // ... trackMouse render() { return ( &lt;Canvas angle={this.props.angle} currentPlayer={this.props.currentPlayer} gameState={this.props.gameState} players={this.props.players} startGame={this.props.startGame} trackMouse={event =&gt; (this.trackMouse(event))} /&gt; ); } } App.propTypes = { // ...   propTypes currentPlayer: PropTypes.shape({ id: PropTypes.string.isRequired, maxScore: PropTypes.number.isRequired, name: PropTypes.string.isRequired, picture: PropTypes.string.isRequired, }), leaderboardLoaded: PropTypes.func.isRequired, loggedIn: PropTypes.func.isRequired, players: PropTypes.arrayOf(PropTypes.shape({ id: PropTypes.string.isRequired, maxScore: PropTypes.number.isRequired, name: PropTypes.string.isRequired, picture: PropTypes.string.isRequired, })), }; App.defaultProps = { currentPlayer: null, players: null, }; export default App;</span></span></code> </pre> <br><p>    ,  : </p><br><ol><li>   <code>audience</code>   <code>Auth0</code> . </li><li>     ( <code>Auth0.getProfile()</code> )    <code>currentPlayer</code>    (Redux store) ( <code>this.props.loggedIn(...)</code> ). </li><li>      ( <code>io('http://localhost:3001', ...)</code> )   <code>access_token</code>  ( <code>Auth0.getAccessToken()</code> ). </li><li>   <code>players</code> ,    ,   Redux store ( <code>this.props.leaderboardLoaded(...)</code> ). </li></ol><br><p>  ,        ,        (events) <code>new-max-score</code> ( ). -,    <code>maxScore</code>  <code>120</code> ,       5 . ,   5  ( <code>(setTimeout(..., 5000)</code> ),     c   <code>maxScore</code> ,  <code>222</code> ,      . </p><br><p>       <code>Canvas</code>   : <code>currentPlayer</code>  <code>players</code> . ,   <code>./src/components/Canvas.jsx</code>   : </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ...  import const Canvas = (props) =&gt; { // ...  gameHeight  viewBox //   leaderboard !!!! return ( &lt;svg ...&gt; // ...   { ! props.gameState.started &amp;&amp; &lt;g&gt; // ... StartGame  Title &lt;Leaderboard currentPlayer={props.currentPlayer} authenticate={signIn} leaderboard={props.players} /&gt; &lt;/g&gt; } // ... flyingObjects.map &lt;/svg&gt; ); }; Canvas.propTypes = { // ...   propTypes currentPlayer: PropTypes.shape({ id: PropTypes.string.isRequired, maxScore: PropTypes.number.isRequired, name: PropTypes.string.isRequired, picture: PropTypes.string.isRequired, }), players: PropTypes.arrayOf(PropTypes.shape({ id: PropTypes.string.isRequired, maxScore: PropTypes.number.isRequired, name: PropTypes.string.isRequired, picture: PropTypes.string.isRequired, })), }; Canvas.defaultProps = { currentPlayer: null, players: null, }; export default Canvas;</span></span></code> </pre> <br><p>      : </p><br><ol><li>   <code>leaderboard</code> .        . </li><li>   <code>&lt;Leaderboard /&gt;</code> .      : <code>props.currentPlayer</code>  <code>props.players</code> . </li><li>   <code>propTypes</code> ,  ,   <code>Canvas</code>    <code>currentPlayer</code>  <code>players</code> . </li></ol><br><p> !         Socket.IO.    ( <em>   ‚Äî      ‚Äî .,    </em> )  : </p><br><pre> <code class="javascript hljs">#      cd server #     node index.js &amp; #       (cd .. =    ) cd .. #   npm start</code> </pre> <br><p>     : ( <code>http://localhost:3000</code> ).  ,         ,       : <br><img src="https://habrastorage.org/getpro/habr/post_images/735/8cd/4a8/7358cd4a8d4bcd774581332caf48fb91.png" alt="image"></p><br><h2 id="chego-ne-hvataet">    </h2><br><p>         .    ,   ,     .        : </p><br><ul><li> <em> :</em>   ,  ""     . </li><li> <em> "":</em>  , ,    . </li><li> <em> ""   :</em>  ,       ,     ( <em>score</em> )    .   ,          "". </li><li> <em>  :</em>           . </li></ul><br><p>       . </p><br><h2 id="strelyaem-yadrami">   </h2><br><p>     ,     <code>onClick</code>   <code>Canvas</code> .          Redux-,       (    ).      <code>moveObjects</code> . </p><br><p>    ""   .     <code>./src/actions/index.js</code>    : </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ...    export const SHOOT = 'SHOOT'; // ...   export const shoot = (mousePosition) =&gt; ({ type: SHOOT, mousePosition, });</span></span></code> </pre> <br><p>         ( <code>./src/reducers/index.js</code> ): </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { LEADERBOARD_LOADED, LOGGED_IN, MOVE_OBJECTS, SHOOT, START_GAME } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../actions'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// ...   import import shoot from './shoot'; const initialGameState = { // ...   cannonBalls: [], }; // ...  initialState function reducer(state = initialState, action) { switch (action.type) { //  case- case SHOOT: return shoot(state, action); // ...    } }</span></span></code> </pre> <br><p>  ,        <code>shoot</code>  ,    <code>SHOOT</code> .       .     <code>shoot.js</code>         : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { calculateAngle } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../utils/formulas'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shoot</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!state.gameState.started) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { cannonBalls } = state.gameState; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cannonBalls.length === <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { x, y } = action.mousePosition; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> angle = calculateAngle(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, x, y); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> id = (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>()).getTime(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> cannonBall = { <span class="hljs-attr"><span class="hljs-attr">position</span></span>: { <span class="hljs-attr"><span class="hljs-attr">x</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">y</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, angle, id, }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">gameState</span></span>: { ...state.gameState, <span class="hljs-attr"><span class="hljs-attr">cannonBalls</span></span>: [...cannonBalls, cannonBall], } }; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> shoot;</code> </pre> <br><p>     ,   .  ,    .    ,        .     ,      .       ,   <code>calculateAngle</code>     .     ,    ,     (Redux store)  . </p><br><p>  ,         ,     <code>Game</code> ,     <code>App</code> . ,   <code>./src/containers/Game.js</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ...   import import { leaderboardLoaded, loggedIn, moveObjects, startGame, shoot } from '../actions/index'; // ... mapStateToProps const mapDispatchToProps = dispatch =&gt; ({ // ...   shoot: (mousePosition) =&gt; { dispatch(shoot(mousePosition)) }, }); // ... connect  export</span></span></code> </pre> <br><p>     <code>./src/App.js</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ... import statements and Auth0.configure class App extends Component { constructor(props) { super(props); this.shoot = this.shoot.bind(this); } // ... componentDidMount and trackMouse definition shoot() { this.props.shoot(this.canvasMousePosition); } render() { return ( &lt;Canvas // other props shoot={this.shoot} /&gt; ); } } App.propTypes = { // ... other propTypes shoot: PropTypes.func.isRequired, }; // ... defaultProps and export statements</span></span></code> </pre> <br><p>  ,       <code>App</code>    <code>shoot</code>  props ( <em> ,   "" shoot ‚Äî .</em> )   <code>canvasMousePosition</code> .        <code>Canvas</code> .     ""  ,        <code>onClick</code>  <code>svg</code>   ,   "". </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ...   import import CannonBall from './CannonBall'; const Canvas = (props) =&gt; { // ...  gameHeight  viewBox return ( &lt;svg // ...   onClick={props.shoot} &gt; // ...  defs, Sky  Ground {props.gameState.cannonBalls.map(cannonBall =&gt; ( &lt;CannonBall key={cannonBall.id} position={cannonBall.position} /&gt; ))} // ... CannonPipe, CannonBase, CurrentScore    &lt;/svg&gt; ); }; Canvas.propTypes = { // ...   shoot: PropTypes.func.isRequired, }; // ...  defaultProps  export</span></span></code> </pre> <br><p> <strong>:</strong>   <code>cannonBalls.map</code>  <code>CannonPipe</code> ,     ""  . </p><br><p>     ,         ( <code>x: 0, y: 0</code> )  ,    ( <code>angle</code> )   .   ,     "" ( ). </p><br><p>     ,     <code>./src/utils/formulas.js</code>  : </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ...   const degreesToRadian = degrees =&gt; ((degrees * Math.PI) / 180); export const calculateNextPosition = (x, y, angle, divisor = 300) =&gt; { const realAngle = (angle * -1) + 90; const stepsX = radiansToDegrees(Math.cos(degreesToRadian(realAngle))) / divisor; const stepsY = radiansToDegrees(Math.sin(degreesToRadian(realAngle))) / divisor; return { x: x +stepsX, y: y - stepsY, } };</span></span></code> </pre> <br><p> <strong>:</strong>   ,   ,  <a href="https://answers.unity.com/questions/491719/how-to-calculate-a-new-position-having-angle-and-d.html"></a> . </p><br><p>      <code>moveCannonBalls.js</code>     <code>calculateNextPosition</code> .      <code>./src/reducers/</code>   : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { calculateNextPosition } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../utils/formulas'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> moveBalls = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">cannonBalls</span></span></span><span class="hljs-function"> =&gt;</span></span> ( cannonBalls .filter(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">cannonBall</span></span></span><span class="hljs-function"> =&gt;</span></span> ( cannonBall.position.y &gt; <span class="hljs-number"><span class="hljs-number">-800</span></span> &amp;&amp; cannonBall.position.x &gt; <span class="hljs-number"><span class="hljs-number">-500</span></span> &amp;&amp; cannonBall.position.x &lt; <span class="hljs-number"><span class="hljs-number">500</span></span> )) .map(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">cannonBall</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { x, y } = cannonBall.position; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { angle } = cannonBall; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...cannonBall, <span class="hljs-attr"><span class="hljs-attr">position</span></span>: calculateNextPosition(x, y, angle, <span class="hljs-number"><span class="hljs-number">5</span></span>), }; }) ); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> moveBalls;</code> </pre> <br><p>        . -,    <code>filter</code> ,   <code>cannonBalls</code> (),      .     ,    -800   Y  ,     (   -500)   ( 500). </p><br><p> ,        <code>./src/reducers/moveObjects.js</code>  : </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ...   import import moveBalls from './moveCannonBalls'; function moveObjects(state, action) { if (!state.gameState.started) return state; let cannonBalls = moveBalls(state.gameState.cannonBalls); // ... mousePosition, createFlyingObjects, filter    return { ...newState, gameState: { ...newState.gameState, flyingObjects, cannonBalls, }, angle, }; } export default moveObjects;</span></span></code> </pre> <br><p>           <code>moveObjects</code> ,     <code>moveBalls</code> .             <code>cannonBalls</code>   <code>gameState</code> . </p><br><p>  ,     ,       .     -: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/fb3/6f9/043/fb36f9043b23d973c8a47d4ff542b4ea.png" alt="image"></p><br><h2 id="raspoznaem-popadaniya">   </h2><br><p> ,        ,      ,    ,   ,     .       ""    ,    .        "":  . </p><br><p>       : ,       .      ,  ,    ,     .  ,       ,          . </p><br><p>   ,    <code>./src/utils/formulas.js</code>  : </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ...   export const checkCollision = (rectA, rectB) =&gt; ( rectA.x1 &lt; rectB.x2 &amp;&amp; rectA.x2 &gt; rectB.x1 &amp;&amp; rectA.y1 &lt; rectB.y2 &amp;&amp; rectA.y2 &gt; rectB.y1 );</span></span></code> </pre> <br><p>  ,         ""    .       <code>checkCollisions.js</code>   <code>./src/reducers</code>   : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { checkCollision } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../utils/formulas'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { gameHeight } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../utils/constants'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> checkCollisions = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">cannonBalls, flyingDiscs</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> objectsDestroyed = []; flyingDiscs.forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">flyingDisc</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> currentLifeTime = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">new</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">Date</span></span></span></span><span class="hljs-function"><span class="hljs-params">(</span></span></span><span class="hljs-function">)).</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">getTime</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">flyingDisc</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">createdAt</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">const</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">calculatedPosition</span></span></span><span class="hljs-function"> = { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">flyingDisc</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">position</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function">, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">y</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">flyingDisc</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">position</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">y</span></span></span><span class="hljs-function"> + (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(currentLifeTime </span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/ 4000) * gameHeight), }; const rectA = { x1: calculatedPosition.x - 40, y1: calculatedPosition.y - 10, x2: calculatedPosition.x + 40, y2: calculatedPosition.y + 10, }; cannonBalls.forEach((cannonBall) =&gt; { const rectB = { x1: cannonBall.position.x - 8, y1: cannonBall.position.y - 8, x2: cannonBall.position.x + 8, y2: cannonBall.position.y + 8, }; if (checkCollision(rectA, rectB)) { objectsDestroyed.push({ cannonBallId: cannonBall.id, flyingDiscId: flyingDisc.id, }); } }); }); return objectsDestroyed; }; export default checkCollisions;</span></span></span></span></span></span></code> </pre> <br><p>  ,    : </p><br><ol><li>      <code>objectsDestroyed</code>    . </li><li>     <code>flyingDiscs</code> (  <code>forEach</code> )     . <strong> </strong> ,        CSS,        Y    <code>currentLifeTime</code> . </li><li>     <code>cannonBalls</code> (  <code>forEach</code> )     . </li><li>   <code>checkCollision</code>      (  ),  ,     ().  ,      <code>objectsDestroyed</code> ,    . </li></ol><br><p>     <code>moveObjects.js</code> ,     : </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ...  import import checkCollisions from './checkCollisions'; function moveObjects(state, action) { // ...     //       -     // ,      let let flyingObjects = newState.gameState.flyingObjects.filter(object =&gt; ( (now - object.createdAt) &lt; 4000 )); // ... { x, y }    angle const objectsDestroyed = checkCollisions(cannonBalls, flyingObjects); const cannonBallsDestroyed = objectsDestroyed.map(object =&gt; (object.cannonBallId)); const flyingDiscsDestroyed = objectsDestroyed.map(object =&gt; (object.flyingDiscId)); cannonBalls = cannonBalls.filter(cannonBall =&gt; (cannonBallsDestroyed.indexOf(cannonBall.id))); flyingObjects = flyingObjects.filter(flyingDisc =&gt; (flyingDiscsDestroyed.indexOf(flyingDisc.id))); return { ...newState, gameState: { ...newState.gameState, flyingObjects, cannonBalls, }, angle, }; } export default moveObjects;</span></span></code> </pre> <br><p>      <code>checkCollisions</code> ,      <code>cannonBalls</code>  <code>flyingObjects</code> . </p><br><p> ,     ""  ,    <code>moveObjects</code>    <code>gameState</code> .      -. </p><br><h2 id="obnovlyaem-zhizni-i-tekuschie-ochki">  ""    </h2><br><p>  ,    -  ,     "".  ""  ,   .    ""       .   ‚Äî <code>./src/reducers/moveObject.js</code> .  : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { calculateAngle } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../utils/formulas'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> createFlyingObjects <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./createFlyingObjects'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> moveBalls <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./moveCannonBalls'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> checkCollisions <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./checkCollisions'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moveObjects</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ...  newState.gameState.flyingObjects.filter const lostLife = state.gameState.flyingObjects.length &gt; flyingObjects.length; let lives = state.gameState.lives; if (lostLife) { lives--; } const started = lives &gt; 0; if (!started) { flyingObjects = []; cannonBalls = []; lives = 3; } // ... x, y, angle, objectsDestroyed    return { ...newState, gameState: { ...newState.gameState, flyingObjects, cannonBalls: [...cannonBalls], lives, started, }, angle, }; } export default moveObjects;</span></span></code> </pre> <br><p>         <code>flyingObjects</code>     ,   ,    ""  .   ,           ,      4  ( <code>(now - object.createdAt) &lt; 4000</code> ),    ,  . </p><br><p> ,     "",    <code>Canvas</code> .   <code>./src/components/Canvas.jsx</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ...   import import Heart from './Heart'; const Canvas = (props) =&gt; { // ...  gameHeight  viewBox const lives = []; for (let i = 0; i &lt; props.gameState.lives; i++) { const heartPosition = { x: -180 - (i * 70), y: 35 }; lives.push(&lt;Heart key={i} position={heartPosition}/&gt;); } return ( &lt;svg ...&gt; // ...    {lives} &lt;/svg&gt; ); }; // ...  propTypes, defaultProps,  export</span></span></code> </pre> <br><p>        .       ;      ,  . ,    ,      ,       . </p><br><p>     .      <code>./src/reducers/moveObjects.js</code>  : </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ... import statements function moveObjects(state, action) { // ...   const kills = state.gameState.kills + flyingDiscsDestroyed.length; return { // ...newState, gameState: { // ...  props- kills, }, // ... angle, }; } export default moveObjects;</span></span></code> </pre> <br><p>    <code>./src/components.Canvas.jsx</code>     <code>CurrentScore</code> (    15) : </p><br><pre> <code class="javascript hljs">&lt;CurrentScore score={props.gameState.kills} /&gt;</code> </pre> <br><h2 id="obnovlyaem-tablicu-reytinga">    </h2><br><p>    !     ,   ,        React, Redux, SVG  CSS .  ,      . </p><br><p>      <code>./server/index.js</code>    <code>players</code> .        "" ( <em> </em> )   "" .          .      ,  : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> players = [];</code> </pre> <br><p>      <code>App</code> .   <code>./src/App.js</code>   : </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ...  import // ... Auth0.configure class App extends Component { constructor(props) { // ... super  this.shoot.bind(this) this.socket = null; this.currentPlayer = null; } //     componentDidMount componentDidMount() { const self = this; Auth0.handleAuthCallback(); Auth0.subscribe((auth) =&gt; { if (!auth) return; self.playerProfile = Auth0.getProfile(); self.currentPlayer = { id: self.playerProfile.sub, maxScore: 0, name: self.playerProfile.name, picture: self.playerProfile.picture, }; self.props.loggedIn(self.currentPlayer); self.socket = io('http://localhost:3001', { query: `token=${Auth0.getAccessToken()}`, }); self.socket.on('players', (players) =&gt; { self.props.leaderboardLoaded(players); players.forEach((player) =&gt; { if (player.id === self.currentPlayer.id) { self.currentPlayer.maxScore = player.maxScore; } }); }); }); setInterval(() =&gt; { self.props.moveObjects(self.canvasMousePosition); }, 10); window.onresize = () =&gt; { const cnv = document.getElementById('aliens-go-home-canvas'); cnv.style.width = `${window.innerWidth}px`; cnv.style.height = `${window.innerHeight}px`; }; window.onresize(); } componentWillReceiveProps(nextProps) { if (!nextProps.gameState.started &amp;&amp; this.props.gameState.started) { if (this.currentPlayer.maxScore &lt; this.props.gameState.kills) { this.socket.emit('new-max-score', { ...this.currentPlayer, maxScore: this.props.gameState.kills, }); } } } // ... trackMouse, shoot,   render } // ... propTypes, defaultProps   export</span></span></code> </pre> <br><p> ,     : </p><br><ol><li>        ( <code>socket</code>  <code>currentPlayer</code> ),        . </li><li>      ,       <code>new-max-score</code> . </li><li>     <code>players</code> (  ),     <code>maxScore</code> .  ,     ,  <code>maxScore</code> . </li><li>    <code>componentWillReceiveProps</code> ,       ( <code>maxScore</code> ).       <code>new-max-score</code>    . </li></ol><br><p>  It is finished!    -.     ,    Socket.IO   React   : </p><br><pre> <code class="javascript hljs">#      node ./server/index &amp; #  React- npm start</code> </pre> <br><p>    ,           .     ,        . </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/715/54e/ffd/71554effd1872a836898f979ab452b60.png" alt="image"></p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>              .   React      , SVG ‚Äî ( HTML)    , Redux ‚Äî    , , ,  CSS      .  ,     Socket.IO,       ,  Auth0    . </p><br><p> !       .      ! </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/350946/">https://habr.com/ru/post/350946/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../350936/index.html">Digital events in Moscow from March 12 to March 18</a></li>
<li><a href="../350938/index.html">Discussed at Stanford what to do with the mathematical and engineering education of schoolchildren in Ukraine</a></li>
<li><a href="../350940/index.html">C ++ conference in April</a></li>
<li><a href="../350942/index.html">Autotest, balancing, terminal and not only - what we will talk about this Thursday</a></li>
<li><a href="../350944/index.html">March 22-24, Moscow, OpenHack on Microsoft containers and microservices</a></li>
<li><a href="../350948/index.html">How to deal with ‚Äúnihilists in information security‚Äù</a></li>
<li><a href="../350950/index.html">Telephony for hotels: billing and wake-up calls in 3CX</a></li>
<li><a href="../350952/index.html">Testing C / C ++ Projects with Python</a></li>
<li><a href="../350954/index.html">How to monitor the work of the business process and not be distracted by nonsense</a></li>
<li><a href="../350956/index.html">Rust: use serde to serialize</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>