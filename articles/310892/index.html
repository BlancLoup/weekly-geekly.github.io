<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Configuring D-link DSR routers to work with 3CX</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="IT specialists systematically contact us with questions related to configuring border network devices (routers and firewalls) to work with 3CX. Especi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Configuring D-link DSR routers to work with 3CX</h1><div class="post__text post__text-html js-mediator-article"><img title="image" src="https://habrastorage.org/getpro/habr/post_images/937/6c6/257/9376c62578765b1d626a092a4ddece2a.png" alt="image" width="287" height="119" align="left">  IT specialists systematically contact us with questions related to configuring border network devices (routers and firewalls) to work with 3CX.  Especially often problems arise with administrators who have not previously worked with VoIP technologies.  For example, the NAT module of the router can create problems when registering 3CX with VoIP providers, problems with connecting remote phones, as well as one-way audibility, or the complete absence of sound. <br><br>  In this article we will look at the configuration of network equipment on the D-link DSR-150/250 / 250N / 500 / 500N / 1000 / 1000N series of routers.  D-link DSR routers are selected due to a very affordable price (from $ 100), a simple interface and the presence of special functions responsible for working with VoIP traffic.  In addition, they support the <a href="http://openvpn.net/">OpenVPN</a> technology, which is also supported by some SIP phones (for example, Yealink, however, phones can be supplied to the Russian market with firmware without OpenVPN).  OpenVPN allows you to connect remote phones to the local network via a VPN tunnel.  This will provide excellent connection security and encryption of VoIP traffic. <br><br>  Another advantage of DSR routers is the ability to reserve an Internet channel.  This is very useful if you connect SIP trunks.  If one Internet channel ‚Äúfalls‚Äù, the router will automatically switch to the backup channel and all trunks will be automatically connected again.  Such redundancy is difficult to provide for conventional analog lines. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>The screenshots in the article correspond to the model DSR-250N, Hardware version: A1, Firmware Version: 1.09B32_WW (international)</b> . <br><br>  1. Go to the router at <strong>192.168.10.1</strong> with the username / password of <strong>admin / admin</strong> and update the firmware from the <a href="http://tsd.dlink.com.tw/">Taiwanese</a> or <a href="">Russian</a> site D-link (the firmware for Russia has some restrictions in encryption). <br><br>  2. In the <strong>Advanced - Firewall Settings - Custom Services</strong> section, create the services that are required for 3CX.  Later they are used in the rules of the firewall and traffic prioritization. <br><br>  Create a service SIP (alarm).  Service port 5060, UDP protocol. <br><br> <a href=""><img title="image" src="https://habrastorage.org/getpro/habr/post_images/b1f/a4e/ab6/b1fa4eab6d8da1bbe3a602699dd6442f.png" alt="image" width="659" height="396"></a> <br><br>  Then the service RTP (voice stream) 9000-9255.  UDP protocol <br><br> <a href=""><img title="image" src="https://habrastorage.org/getpro/habr/post_images/909/e8e/847/909e8e847838d9dfc76efe6206e5f58b.png" alt="image" width="656" height="391"></a> <br><br>  Then 3CX Tunnel service - 5090. TCP / UDP protocol. <br><br> <a href=""><img title="image" src="https://habrastorage.org/getpro/habr/post_images/23a/b6b/e4a/23ab6be4abace9a567e716b2a9374b3f.png" alt="image" width="658" height="391"></a> <br><br>  and 3CX web service.  Port 5001 (or 443) HTTPS.  TCP protocol. <br><br> <a href=""><img title="image" src="https://habrastorage.org/getpro/habr/post_images/792/b3f/e19/792b3fe19697184771dfa2e4bccb2f4a.png" alt="image" width="658" height="391"></a> <br><br>  As a result, the table of services will look like this. <br><br> <a href=""><img title="image" src="https://habrastorage.org/getpro/habr/post_images/a9e/d7e/0c8/a9ed7e0c8306b91dec79071e45da2b4c.png" alt="image" width="659" height="306"></a> <br><br>  3. After creating the services, you can proceed to creating <strong>firewall</strong> rules in the <strong>Advanced - Firewall Settings - Firewall Rules</strong> section.  Rules must comply <a href="http://www.3cx.com/docs/3cx-phone-system-v14-ports/">with 3CX recommendations</a> . <br><br>  The first rule publishes the <strong>SIP 5060 port of</strong> the 3CX server ( <strong>192.168.0.2)</strong> for the external address ( <strong>62.64.127.43)</strong> , which is the address of our SIP operator.  Thus, incoming SIP traffic is allowed only for the SIP operator and is prohibited for all other addresses.  <strong>You protect 3CX from phone hackers trying to connect to the system and make calls at your expense.</strong> <br><br> <a href=""><img title="image" src="https://habrastorage.org/getpro/habr/post_images/190/c7d/8d2/190c7d8d27d2ddc2338b91f2888aa9f6.png" alt="image" width="659" height="887"></a> <br><br>  The second rule will publish RTP ports in the same way, however, for all nodes on the Internet. <br><br> <a href=""><img title="image" src="https://habrastorage.org/getpro/habr/post_images/737/10b/d09/73710bd0975beb8647be685997e78a16.png" alt="image" width="657" height="887"></a> <br><br>  Rules for 3CX Tunnel and Web services are created similarly.  As a result, the table of network screen rules will look like this. <br><br> <a href=""><img title="image" src="https://habrastorage.org/getpro/habr/post_images/101/a29/017/101a290176f9fa34602dd7e09d47c36d.png" alt="image" width="657" height="339"></a> <br><br>  4. In the <strong>Advanced - Firewall Settings - ALG‚Äôs</strong> section, make sure that the SIP ALG is turned off. <br><br> <a href=""><img title="image" src="https://habrastorage.org/getpro/habr/post_images/0f8/5f5/856/0f85f5856d01a493e78b2e8b78aee95c.png" alt="image" width="659" height="418"></a> <br><br>  5. Enable the interesting function of the D-link DSR router - prioritizing VoIP traffic through the WAN port.  When passing traffic from / to the 3CX server, this traffic will be given the highest priority, and other Internet traffic will not affect the operation of VoIP.  In the <strong>Advanced - Advanced Network - Traffic Management - Bandwith Profiles</strong> section, enable prioritization and create <strong>3CXVoIPIn</strong> and <strong>3CXVoIPOut profiles</strong> , assigning the outgoing and incoming traffic to the highest priority. <br><br> <a href=""><img title="image" src="https://habrastorage.org/getpro/habr/post_images/f75/29f/acb/f7529facb5cce87258760b920830b3a2.png" alt="image" width="658" height="414"></a> <br><br>  As a result, the profile table will look like this. <br><br> <a href=""><img title="image" src="https://habrastorage.org/getpro/habr/post_images/126/039/018/12603901831ded1c3c18327df955fe71.png" alt="image" width="659" height="391"></a> <br><br>  6. Further in the section <strong>Advanced - Advanced Network - Traffic Management - Traffic Selectors</strong> we will add descriptions of all types of traffic that need to be ‚Äúaccelerated‚Äù.  The traffic coming from / to the IP address of the 3CX server - <strong>192.168.0.2</strong> will be prioritized.  To reduce the <strong>length</strong> of the article, I will only give a description for the <strong>3CXSIP</strong> service.  For other 3CX services, the procedure is similar. <br><br> <a href=""><img title="image" src="https://habrastorage.org/getpro/habr/post_images/b53/20c/7b7/b5320c7b73db9153a6a9593cc17bb404.png" alt="image" width="659" height="442"></a> <br><br>  As a result, the traffic prioritization page will look like this. <br><br> <a href=""><img title="image" src="https://habrastorage.org/getpro/habr/post_images/6f4/ba2/95c/6f4ba295c055b91100efc7796a123e4b.png" alt="image" width="657" height="354"></a> <br><br>  7. If you use Split DNS <a href="https://habrahabr.ru/company/3cx/blog/283176/">recommended for installing 3CX v15</a> , you can use the router's DNS server to specify the FQDN of the server.  Go to the <strong>Setup - Network Settings - Lan Setup Configuration</strong> section and specify the FQDN of the server.  In addition, here you can also specify the IP address of DHCP Option 66. By running a TFTP server on the 3CX server, you can automatically configure <a href="http://www.3cx.com/sip-phones/cisco-7940g-7960g/">legacy Cisco phones</a> . <br><br> <a href=""><img title="image" src="https://habrastorage.org/getpro/habr/post_images/fbe/a40/189/fbea401896d96f59847e4f1912d89d9a.png" alt="image" width="658" height="962"></a> <br><br>  This completes the configuration of the D-Link DSR router for working with 3CX. </div><p>Source: <a href="https://habr.com/ru/post/310892/">https://habr.com/ru/post/310892/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../310866/index.html">Y Combinator: What to do before the explosive growth</a></li>
<li><a href="../310868/index.html">Fast rendering with DOM template engines</a></li>
<li><a href="../310870/index.html">The dark side of TypeScript - @ decorators on examples</a></li>
<li><a href="../310872/index.html">ROAD audio codec analysis</a></li>
<li><a href="../310886/index.html">Replacing the boot-animation of an Android device with flickering Linux kernel logs</a></li>
<li><a href="../310922/index.html">40% of organizations store admin passwords in spreadsheets and text files</a></li>
<li><a href="../310924/index.html">Forcing Asynchrony in Java Services for Baratine</a></li>
<li><a href="../310926/index.html">Android security. Lecture in Yandex</a></li>
<li><a href="../310928/index.html">Monitor client PCs in Microsoft AD with Zabbix. Part 1 - Auto Install</a></li>
<li><a href="../310930/index.html">Placement of the table of values ‚Äã‚Äãwith the help of additional requisite and expansion of the 1C configuration</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>