<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>My way is a warrior, or how I prepared an application for life in Sailfish</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Warrior‚Äôs art is balance 
 between the horror of being a man and the miracle of being a man. 
 "Journey to Ixtlan" 

 My way of a warrior - a brutal f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>My way is a warrior, or how I prepared an application for life in Sailfish</h1><div class="post__text post__text-html js-mediator-article">  <i>Warrior‚Äôs art is balance</i> <i><br></i>  <i>between the horror of being a man and the miracle of being a man.</i> <i><br></i>  <i>"Journey to Ixtlan"</i> <br><br>  My way of a warrior - a brutal frontend developer on the ‚Äúpros‚Äù - was to find a balance between developing an application running on Sailfish and a cross-platform application. <br><br>  Recently, I‚Äôm working for a developer‚Äôs position at Digital Design, and sometimes I have to deal with tasks I haven‚Äôt met before.  It is interesting and often fun.  Now, for example, I am writing a corporate application under Sailfish OS and I want to share my experience with you - this will be discussed below.  Follow me under the cat if you are a novice developer or, like me, are faced with the task of adapting a corporate application under Sailfish OS and do not know where to start, as well as those who have not heard about Qt and the features of Sailfish. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/webt/zr/xh/si/zrxhsitmn-nk4wa5iic71hc7wfu.jpeg"></div><a name="habracut"></a><br><h3>  A little background, or why I did it </h3><br>  When the company developed the ‚ÄúAreopad‚Äù solution for iPad (iOS) 5 years ago, no one could have imagined that customers would need an application to work on a device with Sailfish OS (then the OS belonged to the Finnish company Jolla, however now too).  But in 2016, the Russian company Open Mobile Platform acquired a license to use it, modify it, distribute it and brought it to mind: it adapted it to domestic mobile devices and users (mainly companies and government agencies) and registered Sailfish Mobile OS RUS <a href="https://reestr.minsvyaz.ru/reestr/87622/%3Fsphrase_id%3D132009">in the registry</a> .  And now it can be said, the only official Russian operating system for mobile devices. <br><br>  Naturally, we wanted to figure it out - we already conquered the rest of the OS, and Sailfish, it seems, has a great future (yes, I‚Äôm talking about import substitution).  From all this it follows that the application for Sailfish be!  The first test object was the mobile application ‚ÄúInformation system for the work of collegial bodies‚Äú Areopad ‚Äù(it was just at the modernization stage). <br><br><h3>  Now about Qt </h3><br>  A wonderful cross-platform tool that includes the development environment, a ton of useful and convenient libraries, and even your own QML markup language.  I will not dwell on it for a long time, because many articles on Habr√© have been written about this miracle, and you can also read <a href="http://doc.qt.io/">documentation</a> that is easy to read and easy to read. <br><br>  Just in case, I‚Äôll clarify that the calculations and the display take place in different languages ‚Äã‚Äãin different modules (C ++ and QML), interacting with each other with special cunning methods (property, signal-slot). <br><br>  And Qt is the main framework used when developing software for Sailfish. <br><br><h3>  Approaches to the solution of the problem: if you go to the left - you will make a crutch, if you go to the right - you will lose the features </h3><br>  At first, inspired by the idea of ‚Äã‚Äãcross-platform and the fact that I would embody it, I thought that the application written for Sailfish would not take off, but would happily pop up on any other OS, but at least on a refrigerator or a kettle.  But my happiness lasted exactly until the moment when I sat down to run it on Android - then I felt sad.  Sailfish is not well suited for this case and definitely does not intend to change anything. <br><br>  If Android or iOS allow using conditional compilation and provide some kind of tool for this, then Sailfish cannot be distinguished from Linux (within Qt, of course). <br><br>  Next, there is a QML compatibility problem: in Sailfish, the outdated version of Qt Quick (2.6 for Sailfish and already 2.11 for all others), Android does not know Silica, Sailfish does not know QtQuick.Controls.  Therefore, for different operating systems you have to pull the same components from different libraries, which produces almost the same files for each operating system. <br>  At the same time, Silica probably has all the same features as QtQuick.Controls, but refuses to run on any other platform. <br><br><h3>  Sailfish Features </h3><br>  Being a <s>lazy,</s> most creative creative person with a desire to optimize labor costs, I took the path of least <s>resistance of the</s> functional and wrote my masterpiece on pure Qt, without using QtQuick.Controls and Silica.  As a result, everything works grandly and nobly on Sailfish, but on Android, half of the elements, despite my strict order to sit still, have departed to some other important business, so the next step will be to do it in an adult way and dissolve markup files for each OS at different angles.  [Which I subsequently did while preparing the article for publication.  This story draws on a separate article].  Please remember and accept: magic constants are evil (for example, width: 15).  And on two almost identical devices, even with the same OS, they can differ by 2 times. <br><br>  However, I can not fail to note that there are definitely interesting things in the Sailfish version.  Of course, in such a short time that I know him, it is almost impossible to know the whole rich inner world of Sailfish - our relationship with him is at the ‚Äúcandy-bouquet period‚Äù stage, and I have not learned a lot of things in his complex character.  In addition, it was decided to draw a universal application for all operating systems, so using more intricate mechanisms to use the chance never fell out, but I‚Äôll tell you about a couple of interesting points. <br><br>  We will discuss only one library for the implementation of the Silica graphical interface, for the rest, which I managed to learn and understand, is no different from standard QML programming. <br><br><ul><li>  <b>Theme.</b> </li></ul><br>  I was interested in this tool most of all, because I didn‚Äôt see any analogue in other OSes, but it was also simple.  The bottom line is that the design of applications is not a constant, but depends on the chosen topic. <br><br>  The Theme element contains information about the currently selected topic: primary colors, font sizes, indents, and components.  Thus, when writing applications, you do not need to hardcod colors, adjust dimensions to fit the screen size, and generally look at the layout (forgive me designers, you already have a lot of work), you can just pull it all up from the Theme element.  Well, isn't it cool! <br><br><img src="https://habrastorage.org/webt/ak/pr/wa/akprwaderu8np2wpkch4j_qo9xa.png"><br><br><ul><li>  <b>Menu.</b> </li></ul><br>  Also a feature of Sailfish (although it may be possible in Android, but I have not seen it). <br><br>  There are three types of menus: <br>  <b>PullDownMenu - PushUpMenu - ContextMenu</b> <br><br><img src="https://habrastorage.org/webt/bu/y7/a5/buy7a5tkeexpsohiexbtm4oydfm.jpeg"><img src="https://habrastorage.org/webt/jk/sl/4n/jksl4n-kik82otj40tdtcn9q4jq.jpeg"><img src="https://habrastorage.org/webt/ny/ti/tw/nytitwwksf94j2c1oraw50qea7q.jpeg"><br><br>  As for Silica ... View, they do not differ from standard ones (¬± a pair of not very noticeable properties), and the Button component makes pretty nervous - the height of the button cannot be changed, you have to write Rectangle and MouseArea everywhere.  If I only made an application for Sailfish using the standard design of this OS, it would not be necessary to change the height of the button or you could use a <a href="https://sailfishos.org/develop/docs/silica/qml-sailfishsilica-sailfish-silica-backgrounditem.html/">component from Silica</a> .  But since I am writing an application for all devices, it was decided to use the most massive design (Android), so that everyone was familiar and comfortable.  Many will disagree with me and say that you need to use native UI elements for each platform, but this is a completely different topic, it has been the subject of holivars for many years, during which time more than one generation of developers has grown. <br><br><h3>  Spoon of tar to mobile development on qt </h3><br><ul><li>  <b>Assynchronism</b> </li></ul><br>  In Qt, to communicate with the server, calling a single function is not enough; you need to send a request and ask for a special object responsible for the server‚Äôs response, to call the response processing function (which, of course, we write ourselves) when the answer is received: <br><br><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-function">QNetworkRequest </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">request</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"http://www.leningrad.spb.ru"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; QNetworkReply *reply = mngr-&gt;get(request); connect(reply, &amp;QNetworkReply::finished, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, &amp;Class:: onReplyFinished); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onReplyFinished</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ QNetworkReply *reply = (QNetworkReply*)sender(); QByteArray ans = reply-&gt;readAll(); qDebug() &lt;&lt; ans; }</code> </pre> <br>  The onReplyFinished function will be called at the time of receiving a response from the server, and this may take an unknown amount of time depending on the quality of the connection and the server part.  Now imagine how it will be organized with 1500-2000 requests, which depend on each other and should be launched in a strict queue.  And if you remember that the entire UI part depends on the answer, it becomes absolutely scary. <br><br><ul><li>  <b>Kostyu-oriented programming, or a creative approach to solving problems</b> </li></ul><br>  Another topic is ListView, this is a very local Qt problem, but still unpleasant. <br><br>  Any self-respecting ListView must have a header component, which inserts some element that is fundamentally different from the others as the first delegate.  Yes, he does it, yes, everything draws beautifully, if it were not for one ‚Äúbut‚Äù: my delegate takes up the entire screen, and it needs to be flipped, but as soon as I try to flip left from the zero index to the left, he basically refuses this Hader show.  What to do with it?  Put a crutch.  A piece of my model generation code for this ListView in the cpp part, describing as much as possible what is happening: <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (QVariant quest, QQuestions) { Questions.append(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Question(client, quest)); } kostilQuestions = Questions; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Questions.size() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) kostilQuestions.prepend(Questions[<span class="hljs-number"><span class="hljs-number">0</span></span>]);</code> </pre> <br>  The delegate then creates 2 independent items whose visibility depends on the index. <br>  When the index is zero, we see one, otherwise - the other. <br><br><h4>  Total </h4><br>  As a result, I received an application that ‚Äúflies‚Äù both on Android and iOS, and on Sailfish, more precisely, a flexible application that adapts to these operating systems.  And magic has nothing to do with it.  I found a way to avoid conflict and make friends with all OS c Sailfish by substituting some files for Sailfish and all the others.  This allowed in the application code to allocate user interface layers for each OS. <br><br>  We can assume that we have taken the first step - we made friends with the application Sailfish.  But the work on this is not completed, we with Sailfish are entering a new level of our relationship - we are preparing the ISOP Areopad application for registering in the registry (as an application for Sailfish), which means that we will need to adapt it also for the registry. <br><br>  I hope it was interesting.  To be continued. </div><p>Source: <a href="https://habr.com/ru/post/420491/">https://habr.com/ru/post/420491/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../420475/index.html">Comparison of Raylogic 11G and Raylogic V12 laser cutting machines</a></li>
<li><a href="../420477/index.html">HyperX Cloud Stinger Core review: lightweight and durable character headset</a></li>
<li><a href="../420479/index.html">Deploying dependencies into the Apache Ignite.NET service</a></li>
<li><a href="../420487/index.html">Business requests the right to personal user data</a></li>
<li><a href="../420489/index.html">New ARM processors will be able to contend with the Core i5</a></li>
<li><a href="../420493/index.html">Can the American food ordering service become Amazon in the world of restaurants?</a></li>
<li><a href="../420495/index.html">Water rendering in screen space</a></li>
<li><a href="../420497/index.html">Vegetable Singularity: Kroger Launches Robocouriers for Fruit and Vegetable Customers in Arizona</a></li>
<li><a href="../420499/index.html">Anatomy of recommendation systems. Part one</a></li>
<li><a href="../420501/index.html">Linux in RAM: debirf way 2018</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>