<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Samba and forbidden characters</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Samba (samba) under Linux. This amazing software gave Linux users the opportunity to connect with the world of Windows. 
 I remember that wonderful fe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Samba and forbidden characters</h1><div class="post__text post__text-html js-mediator-article">  Samba (samba) under Linux.  This amazing software gave Linux users the opportunity to connect with the world of Windows. <br>  I remember that wonderful feeling when my first samba server appeared in the local network.  Ah, there was a time! <br><br>  But the post is not about that.  Not by hearsay I know that many are annoyed by the limited support for special characters in Windows.  But this is no reason to abandon them, is not it? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6a3/cbf/7c0/6a3cbf7c0ea47b4026ac54225ce4d2c6.png" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Details of my misadventures and (almost) a happy ending under the cut.  Let's get started! <a name="habracut"></a><br><br>  I am fond of collecting films.  At first they were placed on one disk and it was easy.  Then there were more disks, helped by paper and Excel.  But all good things come to an end and had to think about creating a full-fledged database.  One of the consequences of this development appeared virtual folders / lists of films. <br><br>  Beg a lyrical digression.  Samba has one great feature - working with symlinks.  And if these symlinks do not lead to an accessible resource, then they are not visible.  This allows you to have a directory (and not one) in which each position is a symlink to a specific repository.  If the disk is connected, then the symlink is displayed as an accessible directory.  If not, then the directory is not displayed at all.  For this reason (and also for other, unrelated to the topic), samba and similar folders have been used for many years (visible in players, Windows, and on Linux clients). <br><br>  However, this idyll is destroyed by the fact that having a colon, for example, turns an excellent view folder (here I deliberately inserted a colon, later I will explain why this particular film was chosen): <i>2008 - Babylon N.E.</i>  <i>- Babylon: AD</i> to this: <i>2NIQRO ~ 7</i> <br><br><h4>  What to do? </h4><br>  At first, I mistakenly looked in the direction of the mapchars mount option.  But she really did not solve anything, and she additionally could lead to strange file names. <br><br>  I understood that you need to look for something that can replace file names on the fly.  That means auto substitution.  But there was still no such modules, or they did not work the way we would like.  During the search, the third version of the samba has become stable.  And it appeared so-called.  Stackable VFS modules, i.e.  virtual file system modules.  That was what I was looking for! <br><br>  However, the module I needed was not found.  The samba version from the third turned into the fourth one and I was close to trying to write the module myself (although I am only remotely familiar with system programming).  But the ongoing search led me to the <a href="https://www.samba.org/samba/docs/man/manpages/vfs_catia.8.html">vfs_catia</a> module, which was created to solve problems with Catia CAD, which also creates names with forbidden characters, but did exactly what was required.  Its full functionality is revealed from the version of samba 3.5.0 and further.  I have been testing on versions 4.1.x for quite some time. <br><br>  Further was a matter of technique.  The system I use - Debian - already has a samba-vfs-modules package containing this plugin.  It was installed and configured to replace illegal characters with their counterparts (config file: /etc/samba/smb.conf, section [global]): <br><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># 002: maps illegal symbols # vfs_catia, removed default translations: 0x20:0xb1 # vfs_catia, list of special characters: # Unix &amp; replacement chars: # 0x22: " 0xa8: ¬® # 0x2a: * 0xa4: ¬§ # 0x2f: / 0xf8: √∏ (forbidden range, should never exists in names) # 0x3a: : 0xf7: √∑ # 0x3c: &lt; 0xab: ¬´ # 0x3e: &gt; 0xbb: ¬ª # 0x3f: ? 0xbf: ¬ø # 0x5c: \ 0xff: √ø (forbidden range) # 0x7c: | 0xa6: ¬¶ # 0x20: 0xb1: ¬± vfs objects = catia catia:mappings = 0x22:0xa8,0x2a:0xa4,0x2f:0xf8,0x3a:0xf7,0x3c:0xab,0x3e:0xbb,0x3f:0xbf,0x5c:0xff,0x7c:0xa6</span></span></code> </pre> <br><br>  I added comments for myself to understand which characters are replaced by their visual counterparts.  I hope it will be useful not only for me. <br><br><h4>  Happy ending </h4><br>  After adding the code, we overload the samba daemon and the magic in action: <br>  <i>2015 - Terminator √∑ Genesis - Terminator Genisys</i> <br><br>  It is worth noting that the replacements work in both directions, i.e.  working with the same file is transparent and without damaging the original name in the system.  Although if you try, you can, changing the character to one of the usual.  But in my example there is no such thing. <br><br>  Now let me remind you why I chose the film Babylon N. E as the first example ... The point is that the dot at the end of the name of the file or directory in the Windows file system is invalid.  That is why <i>2008 - Babylon N.E.</i>  <i>- Babylon AD</i> still shows up as <i>2XJW59 ~ H</i> <br>  This is the very spoon of tar, in a large barrel of honey.  So far I don‚Äôt know how to replace the dot at the end, but not all the dots in a row, and I will be grateful to everyone who responds and helps to close the last mosaic element. <br><br>  Thank you for your attention and may the Force be with you! </div><p>Source: <a href="https://habr.com/ru/post/270877/">https://habr.com/ru/post/270877/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../270863/index.html">We are switching from STM32 to the Russian K1986BE92QI microcontroller. Practical application: We interrogate keys, we generate PWM. Comparison of CMSIS and SPL code (PWM + TIM + PORT). Part two</a></li>
<li><a href="../270865/index.html">Out of my head. GTD in development</a></li>
<li><a href="../270871/index.html">Office in your pocket. We configure cloud PBX on mobile phones</a></li>
<li><a href="../270873/index.html">SolutionCop</a></li>
<li><a href="../270875/index.html">Project Naptha - select, copy and translate texts from any pictures</a></li>
<li><a href="../270879/index.html">Aggregation and awareness</a></li>
<li><a href="../270881/index.html">Translation: Ethics Code Review</a></li>
<li><a href="../270883/index.html">HighLoad ++ 2015 through the eyes of a foreign speaker</a></li>
<li><a href="../270885/index.html">Flytouch 2 / Superpad III and an attempt to save bytes in the Linux kernel</a></li>
<li><a href="../270887/index.html">We are switching from STM32 to the Russian K1986BE92QI microcontroller. Practical application: control LED brightness (PWM)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>