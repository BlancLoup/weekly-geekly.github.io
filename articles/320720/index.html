<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Own search algorithm for similar images. Theory</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, in connection with the development of a new product line, our company faced the task of searching for identical images in the database. 

 O...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Own search algorithm for similar images. Theory</h1><div class="post__text post__text-html js-mediator-article">  Recently, in connection with the development of a new product line, our company faced the task of searching for identical images in the database. <br><br>  Outsourcing sales is too expensive and does not guarantee the best solution.  It‚Äôs cheaper to give to a freelancer - cheaper, but the solution will most likely be just as cheap and based on existing libraries, such as OpenCV.  But if the task was solved so simply, then competitors would have long ago taken advantage of it and made a decent product, but it is not on the market.  In general, perfectionism inherent in us, ambitiousness and the desire to be the best, do not allow us to bring to the market a product ‚Äúlike everyone else‚Äù, we need better, faster, stronger.  They made a decision to independently sort out the issue, work out a solution, write a detailed technical task and give it to the freelancer.  It was hoped that there were ready-made solutions that competitors simply did not notice.  But having studied the question (and with it the algorithms ORB, BRIEF, FAST, SIFT, SURF, BRISK, A-KAZE, Viola-Jones and several more), it became clear that all these algorithms have their drawbacks.  Although for the solution of our problem, some of the above algorithms were suitable, but somehow I suddenly wanted the uniqueness and simplicity of the solution.  And here I submit to the community, the algorithm of his own composition. <br><br>  Fans criticize (constructively) please under the cat. <br><a name="habracut"></a><br><h2>  1. The principle of the algorithm </h2><br>  Initially, and this is important, a method of comparing images was chosen based on searching and comparing so-called.  key points. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Like any (or almost any) algorithm of this kind, mine consists of the following steps. <br><br>  Step 1. Search for key points in the image. <br>  Step 2. Forming a descriptor. <br>  Step 3. Formation of a binary string (hash). <br>  Step 4. Comparison of the hashes of the image being processed with the image hashes stored in the database. <br>  Step 5. Getting the result in the required form. <br><br><h2>  2. Description of the algorithm </h2><br><h3>  2.1.  Search for key points in the image. </h3><br><blockquote>  The key (singular point, or feature) is an image point that satisfies a number of properties: <br><br><ul><li>  Distinctiveness (distinctness) - the feature should stand out from the background among neighboring points. </li><li>  Resistance (repeatability) - a change in brightness, contrast and color gamut should not affect the place of a particular point on an object or scene. </li><li>  Stability (stability) - image noise, not exceeding a certain threshold, should not affect the operation of the detector. </li><li>  Interpretability (interpretability) - special points should be presented in a format suitable for further work. </li><li>  Quantity (quantity) - the number of detected singular points must provide the required quantity for the detection of objects. </li></ul></blockquote><br>  To search for specific points, I use ‚ÄúFAST Detector‚Äù as the best in terms of performance / quality ratio, although other detectors can be used for other tasks. <br><br>  Next, using the Harris Angle Detector, we select a small number (I have 50) of the most significant key points. <br><br>  <i>* With the principles of operation of the detectors FAST and Harris, can be found in the interesting <a href="https://habrahabr.ru/users/lightsource/" class="user_link">lightsource</a> article " <a href="https://habrahabr.ru/users/lightsource/" class="user_link">Angle</a> <a href="https://habrahabr.ru/post/244541/">Detectors</a> ".</i> <br><br><h3>  2.2.  Descriptor generation </h3><br><blockquote>  Descriptor (from the Latin. Descriptor - describing) - the description of a particular point, which determines the features of its neighborhood, is a numeric or binary vector of certain parameters.  The length of the vector and the type of parameters are determined by the algorithm used.  The descriptor allows you to select a particular point from the whole set of them in the image; this is necessary for composing key pairs of features belonging to the same object when comparing different images. </blockquote><br>  In this step, I propose to deviate methods for describing key points that are commonly used in such algorithms and to turn to simpler methods. <br><br>  I suggest, instead of describing each key point through its environment, measure the distance from each such point to the remaining points.  Those.  lay all possible segments between the points found and measure their lengths. <br><br>  So, this is the result of the measurement, the number (length of the segment), I propose to call it a descriptor. <br><br><h3>  2.3.  Hash generation </h3><br><blockquote>  Hashing or hashing (English hashing) - the transformation of an input array of arbitrary length into a (output) bit string of a fixed length, performed by a specific algorithm.  The function that implements the algorithm and performs the conversion is called the ‚Äúhash function‚Äù or ‚Äúconvolution function‚Äù.  The source data is called an input array, a ‚Äúkey‚Äù or a ‚Äúmessage‚Äù.  The result of the conversion (output) is called ‚Äúhash‚Äù, ‚Äúhash code‚Äù, ‚Äúhash sum‚Äù, ‚Äúmessage summary‚Äù. </blockquote><br>  As is known, <u>X * (X-1) / 2</u> segments can be laid through <u>X</u> points, i.e.  from 50 points you can make 50 * 49/2 = 1225 segments.  Those.  our string will consist of 1225 integers.  Moreover, these numbers must have the same number of characters.  The required number of characters is selected based on the image resolution (for example, for an image of 500 * 500, the maximum length of the cut 707 (diagonally), which means there should be 3 characters). <br><br>  To achieve invariance to rotation in a plane, we write the lengths of the segments into a line not from the extent of their calculation, but from the largest to the smallest. <br><br>  Get the string: <u>A1, A2, ..., A1225</u> , where <u>A1&gt; A2&gt; ...&gt; A1225</u> <br><br><h3>  2.4.  Hash versus DB </h3><br>  To search for such images in the database, you need to compare the hash <u>A1, A2, ..., A1225 that we have</u> with those stored in the database. <br><br>  For example, compare the hash <u>A1, A2, ..., A1225</u> , where <u>A1&gt; A2&gt; ...&gt; A1225</u> with <u>B1, B2, ..., B1225</u> and let descriptors <u>A be</u> three-valued and descriptors <u>B</u> four.  This can be in two cases, if the images are different or if one image is at different scales. <br><br>  To achieve scale invariance, we will bring each descriptor to a single scale.  To do this, we determine the maximum number <u>M of</u> the same bitness as the capacity of the larger descriptor (for our example, the maximum four-digit number <u>M = 9999</u> ) and find the coefficient.  scaling <u>K</u> by the formula: <u>Ka = M / A1</u> (for the line <u>A1, A2, ..., A1225</u> ) and <u>Kv = M / B1</u> (for the line <u>B1, B2, ..., B1225</u> ).  Next we bring the hash to a single scale, for this we multiply each descriptor of hash <u>A</u> by <u>Ka</u> , and each descriptor of hash <u>B</u> by <u>Ap</u> .  We write the results in the lines <u>A'1, A'2, ..., A'1225</u> and <u>B'1, B'2, ..., B'1225</u> , rounding the values ‚Äã‚Äãto an integer.  As a result, we get 2 hashes of the same scale and one dimension. <br><br>  Now the lines <u>'1, '2, ..., '1225</u> and <u>'1, '2, ..., '1225</u> can be compared.  For this, we use the modified Hamming distance formula. <br><br>  The fact is, the Hamming distance takes into account the number of errors, as the number of not equal values ‚Äã‚Äãin the rows.  But in the previous step, we applied rounding to a whole number, which could lead to false results.  Therefore, we will not consider an error if the values ‚Äã‚Äãof the corresponding descriptors of the strings <u>A</u> and <u>B</u> differ by <u>E</u> (i.e., the difference <u>AI</u> and <u>Bi</u> taken in absolute value must be greater than <u>E</u> , in order to consider the values ‚Äã‚Äãin the rows not equal).  Let's call <u>E</u> "coefficient  loyalty "and in the General case, we take <u>E = 1</u> . <br><br>  Further by simple summation we count the number of errors.  Get the distance <u>P.</u> <br><br><h3>  2.5.  Getting results </h3><br>  For different tasks, you may need a different presentation of the results of the algorithm. <br><br><h4>  2.5.1.  Assessment of similarity 2x image </h4>  The result will be shown calculated in step 2.4.  distance 2x hashes r.  Or their estimated value.  For example, when <u>P &lt;10,</u> we can assume that the images are identical;  at <u>10 &lt;P &lt;100</u> , the images are similar;  etc. <br><br><h4>  2.5.2.  Image search in the database as close as possible to the studied </h4>  The result will be the output of an image (or images) with the smallest distance <u>P.</u>  Or the output of the message that no images like the one we have found was found, if all the distances <u>P are</u> greater than a certain threshold. <br><br><h2>  3. Advantages and disadvantages of the algorithm </h2><br><h3>  3.1.  The advantages of the above algorithm include: </h3><br><ul><li>  Simplicity </li><li>  High speed work </li><li>  Flexibility (you can use different methods for finding key points, depending on the task, image characteristics and the required accuracy). </li><li>  The ability to use for images of different quality, thanks to the coefficient.  loyalty <u>e</u> . </li><li>  Invariance to rotate and scale the image. </li></ul><br><h3>  3.2.  The disadvantages I would mention: </h3><br><ul><li>  Lack of invariance to distortion of a perspective character.  Although to some extent this can be achieved if you divide the original image into small fragments and increase the coefficient.  E. </li><li>  It is not possible to search for a piece of the image in a large image. </li></ul><br>  <i>* I am pleased to take note of your comments, indicating the shortcomings of the algorithm in order to refine it.</i> <br><br><h3>  3.3.  Uncertainty </h3><br>  Not being a programmer, I do not have the opportunity to independently check the algorithm in operation.  I will be glad if someone from the Habra community can programmatically implement this algorithm and test it in work. <br><br>  After such a check, we can relate the most important parameter ‚Äúaccuracy of operation‚Äù to the advantages or disadvantages of my algorithm. <br><br><h2>  References: </h2><br>  1. " <a href="https://habrahabr.ru/users/lightsource/" class="user_link">Angle</a> <a href="https://habrahabr.ru/post/244541/">detectors</a> " - <a href="https://habrahabr.ru/users/lightsource/" class="user_link">lightsource</a> <br>  2. " <a href="https://dspace.spbu.ru/bitstream/11701/3991/1/st010290.pdf">Comparative analysis of descriptors of particular points of images with the introduction of algorithms under the Android operating system</a> - Patin MV <br>  3. " <a href="https://ru.wikipedia.org/wiki/%25D0%25A5%25D0%25B5%25D1%2588%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">Caching</a> ", wikipedia.org <br><br>  PS The second (improved) version of the algorithm: <a href="https://habrahabr.ru/post/320994/">habrahabr.ru/post/320994</a> </div><p>Source: <a href="https://habr.com/ru/post/320720/">https://habr.com/ru/post/320720/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../320710/index.html">The difference between nginx and apache with examples</a></li>
<li><a href="../320712/index.html">Aesthetic Beauty: Switch vs If</a></li>
<li><a href="../320714/index.html">3CX Client for Android and iOS updates, and the 3CX SBC release for Debian Linux</a></li>
<li><a href="../320716/index.html">Passive methods to detect illegal traffic termination</a></li>
<li><a href="../320718/index.html">PHP SQL query</a></li>
<li><a href="../320722/index.html">Creating a quest tour of Berlin - step by step instructions</a></li>
<li><a href="../320724/index.html">New Year's Promises by Go-Developer</a></li>
<li><a href="../320726/index.html">Random Forest: walks in the winter forest</a></li>
<li><a href="../320728/index.html">Design patterns, iOS view developer. Part 0. Singleton Single</a></li>
<li><a href="../320730/index.html">IBM Model 5100: IBM's first laptop 40 years ago.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>