<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Will Intel have to remove from the compiler a function that deliberately delivers bad code for AMD processors?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many programmers consider the Intel compiler the best optimizing compiler available on the market, and prefer to use it for the most demanding of perf...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Will Intel have to remove from the compiler a function that deliberately delivers bad code for AMD processors?</h1><div class="post__text post__text-html js-mediator-article">  Many programmers consider the Intel compiler the best optimizing compiler available on the market, and prefer to use it for the most demanding of performance programs.  In addition, Intel supplies many highly optimized libraries for various technical and scientific purposes.  In many cases, there are no worthy alternatives to the Intel libraries. <br><br>  Unfortunately, programs compiled with an Intel compiler or libraries work much worse on AMD and VIA processors. <a name="habracut"></a>  The reason is that for software code, the compiler (or library) can produce several versions of machine code, each of which is optimized for a specific processor and instruction set, for example, SSE2, SSE3, etc.  The system includes a function that determines which type of processor it is running on and selects the most appropriate version.  This feature is called the processor dispatcher.  The Intel Processor Manager checks not only the instruction set supported by the processor, but also the <a href="http://ru.wikipedia.org/wiki/Cpuid">identifier of the processor manufacturer</a> .  If the identifier is the string ‚ÄúGenuineIntel‚Äù, then the most optimal code is selected.  But if the processor is not from Intel, then in most cases the slowest possible option will be chosen, even if the processor is fully compatible with the best version. <br><br>  I, like many other people, have complained about this behavior for many years, but Intel refused to change its controller.  If Intel declared its compiler as compatible only with Intel processors, then there would most likely be no complaints.  The problem is that they try to hide what they are doing.  Many programmers believe that the Intel compiler is compatible with AMD processors.  This is true, but in the secret of the programmer, he includes in the program a biased processor controller, who chooses the worst version of the code when working on processors of all companies except Intel.  If programmers knew this fact, they would most likely use another compiler.  Who wants to sell programs that do not work well on AMD processors? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Due to its size, Intel can afford to invest more money in its compiler than other processor manufacturers.  The Intel compiler is relatively cheap, gives excellent performance and has excellent support.  Selling such a compiler, of course, is not in itself a profitable business.  On the contrary, it is obviously a way to support sales of Intel processors.  There would be no point in adding new instruction sets to microprocessors if there were no tools to use them.  AMD also produces a compiler, but the current version only works under Linux, and there is no version under Windows yet. <br><br>  Many people have expressed the suspicion that this biased dispatcher is used in common performance measurement programs ( <a href="http://arstechnica.com/hardware/reviews/2008/07/atom-nano-review.ars/6">link</a> ).  This is a very serious question.  We know that many customers make purchasing decisions based on published test results, and biased tests give an unfair market advantage worth billions of dollars. <br><br><h4>  Legal battle </h4><br>  AMD has repeatedly sued Intel for unfair competition, starting at least since 2005, and in November 2009, a <a href="http://download.intel.com/pressroom/legal/AMD_settlement_agreement.pdf">settlement was reached</a> .  It concerns many issues of unfair competition, apparently, including the Intel compiler.  We give a quote from it: <br><blockquote><h6>  2.3 Technical Practices </h6><br>  Intel does not have the right to include any Artificial Performance Disruptions in any Intel products or require any third party to include Artificial Performance Violations in this third party product.  In this section 2.3, ‚ÄúArtificial Disruption of Performance‚Äù refers to Intel‚Äôs positive engineering action or Intel‚Äôs design action (but not inaction), which (i) impairs the performance or performance of the Specified AMD Product, (ii) is not a consequence of the Improved Intel Product and (iii) ) intentionally manufactured to impair the performance or performance of the specified AMD Product.  For the purposes of this Section 2.3, ‚ÄúImproving the Product‚Äù means any benefit, advantage or improvement in terms of performance, operation, price, cost, manufacturability, reliability, compatibility or ability to work or improve the performance of another product. <br><br>  Under no circumstances will this section 2.3 impose, and cannot be interpreted as imposing, any obligation on Intel to (i) take any action that the Product Improvement will produce for any AMD or third-party product, regardless of whether this AMD product or third parties, alone or in combination with any other product, (ii) optimize any products for the said AMD Products or (iii) provide AMD with any technical information, documents or know-how. <br></blockquote><br>  It looks like AMD is winning.  If we consider that "any Intel product" is Intel's compilers and libraries, "any third party" are programmers using these compilers and libraries, and "artificial performance violations" are the processor‚Äôs identifier verification of the manufacturer, then this arrangement obliges Intel change the dispatcher.  I will definitely check the next version of the compiler and the Intel libraries to see if they will do it or find a loophole in this agreement. <br><br>  Interestingly, the story did not end there.  Just a month after an agreement between AMD and Intel, the US Federal Trade Commission (FTC) filed an antitrust complaint against Intel.  The accusations in the FTC complaint are unusually strong: <br><blockquote>  Intel tried to undermine the performance of other companies' x86 processors in comparison with Intel x86 processors when it reworked and distributed software products such as compilers and libraries. <br>  [...] [...] <br>  The public, OEMs, independent software vendors, and testing organizations had the impression that the slower performance of other companies' processors on applications compiled using Intel products was caused by the processor, not by Intel software.  Intel did not disclose the effects of the changes it made in its software, beginning with or around 2003, to its customers and the public.  Intel also distributed false or misleading documentation about its compilers and libraries.  Intel assured independent software vendors, OEMs, testing organizations, and the public that programs initially run on Intel processors faster than on competitors.  In fact, many of the differences are due mainly or entirely to Intel software.  Intel‚Äôs misleading or false statements and omissions about the operation of their software were taken into account by independent software vendors, OEMs, testing organizations and the public when they purchased and used processors.  Thus, the assurances of Intel that the programs initially showed better results on Intel processors than on competitors were and are false or misleading.  Intel‚Äôs refusal to disclose that these differences are primarily due to Intel software, given the assurances made, was and is fraudulent.  In addition, these distortions and omissions could harm the reputation of other manufacturers of x86-processors, and harmed competition. <br>  [...] [...] <br>  Some independent software vendors have requested information from Intel regarding the apparent difference in performance of similar programs when launched on Intel processors and other companies.  In response to such requests, Intel has repeatedly misrepresented, directly or indirectly, the source of this problem and the possibility of its resolution. <br>  [...] [...] <br>  Changes to Intel software slowed the performance of x86 processors from other manufacturers without any reasonable technological advantage.  Intel's deceptive behavior deprived consumers of the opportunity to make an informed choice between Intel chips and competitors, as well as between Intel Software and competitors, and increased the cost of competition in their respective processor markets.  Performance losses due to the compiler and the Intel libraries also caused immediate harm to consumers using x86 processors from companies other than Intel. <br></blockquote><br>  The sanctions required by the FTC also go very far: <br><blockquote>  For those Intel customers who, as stated in the complaint, purchased a compiler from Intel that has inflicted or is detrimental to the actual or apparent performance of microprocessors produced by non-Intel (‚ÄúDamage Compiler‚Äù), it is required that: <br><ol><li>  Intel provided them, at no extra charge, with a replacement for the compiler, which is not a Damaged Compiler; </li><li>  Intel reimbursed them for the cost of recompiling the software that they compiled using Damaged Compiler and replacement, as well as distributing the recompiled software to their customers;  and </li><li>  Intel made a public notice and warning in such a way as to ensure that those who purchased software compiled on Defective Compilers purchased from Intel could be transferred to the possibility of replacing this software. </li></ol></blockquote><br>  Perhaps the FTC decided that an agreement between AMD and Intel is not a fair and sufficient means of protection against Intel‚Äôs monopoly behavior.  It compensates AMD for losses, but does nothing for VIA, other microprocessor manufacturers, and customers who have suffered from lack of competition and the ‚Äúflawed‚Äù software produced by the Intel compiler. <br><br><h4>  My own conclusions </h4><br>  When I started testing the Intel compiler a few years ago, I soon found out that its processor manager was biased.  Back in January 2007, I complained to Intel about an unfair processor controller.  I have long corresponded with Intel engineers on this issue.  They constantly denied the problem, and I brought more and more evidence.  They argued that: <br><blockquote> Processor Manager, combined with optimizations, is designed to optimize performance on all Intel and AMD processors in order to give the best possible results.  This is our goal and we believe that we have achieved it, with one exception.  This exception is the lack of support for SSE3 on AMD processors in versions 9.x of our compiler, related to release dates (our compiler was developed before AMD made support for SSE3).  The next version of the 10.x compiler, the beta test of which will begin this quarter, and the final version will be released around the middle of this year, will solve this problem, because we had enough time to adapt to the new AMD processors. <br></blockquote><br>  It sounds good, but in fact, the processor manager did not support even SSE and SSE2 in AMD processors, not to mention newer versions, and does not support them until now (Intel compiler version 11.1.054).  Later I learned that others had turned to Intel with similar complaints and received the same useless excuses ( <a href="http://yro.slashdot.org/comments.pl%3Fsid%3D155593%26cid%3D13042922">link</a> <a href="http://www.swallowtail.org/naughty-intel.shtml">link</a> ). <br><br>  Intel Processor Manager does not only check the processor manufacturer ID and the supported instruction sets.  It also checks specific processor models.  It will not be able to recognize future Intel processors, the family number of which is different from 6. When I asked Intel engineers about this, they answered: <br><blockquote>  You mentioned that we cannot support future Intel processors with family names other than '6' without updating the compiler.  Yes, this is true and deliberate.  We need a high degree of confidence that the program issued by our compiler will not stop working in the future.  Thus, we cannot assume anything about future processors from Intel, AMD or other manufacturers.  You noticed that we could act more aggressively.  We believe that it would be unwise in relation to our customers who want to be sure that their code (compiled with our compiler) will continue to work in the distant future.  The methods you have proposed, although they look reasonable, are not conservative enough for our highly optimizing compiler.  Our experience leads to a conservative code issue.  After we test the functionality with new Intel and AMD processors, we update the compiler.  This means that there is some lag with the support of new processors in the official version of the compiler. <br></blockquote><br>  In other words, they claim that they optimize for specific processor models, and not for specific instruction sets.  If true, this provides Intel with an argument in defense of the inadequate support of AMD processors.  But it also follows from this that all software developers using the Intel compiler must recompile their code and distribute new versions to their customers every time a new Intel processor appears on the market.  That was three years ago.  What happens if I try to run a program compiled by the old version of the Intel compiler on the newest Intel processor?  Predict: it will still select the best branch of the code.  It is more difficult to guess the reason: Intel manipulates the numbers of the CPUID families in the new processors so that the old Intel compilers consider them to be well-known models.  I have described the technical details <a href="http://aceshardware.freeforums.org/cpuid-family-bits-added-because-of-flaw-in-intel-compiler-t428.html">in another article</a> . <br><br>  It is possible that at first Intel's CPU dispatcher was really intended to optimize only for known processor models, without regard to future models.  If any of my students passed such a decision, I would consider it a serious shortcoming.  Perhaps Intel engineers discovered the lack of support for future processors too late to fix it, and were forced to develop the next generation of processors so that existing Intel software would take them for well-known models. <br><br>  After Intel refused to change its dispatcher, I decided that the most effective way to get them to change their mind would be to spread information about this issue.  I contacted several magazines, but no one wanted to write about it.  It is a pity, but not surprising, considering that they all depend on the placement of advertising by Intel.  The only place where I managed to highlight this was <a href="http://www.agner.org/optimize/">my own manual on optimizing programs</a> , where I described the situation in detail and indicated how to replace an unfair dispatcher.  I do not know why AMD has not spread this information.  Perhaps they were required to remain silent about the course of the trial?  What about VIA and Centaur? <br><br><h4>  Temporary solutions </h4><br>  At the moment we do not know whether Intel will release a new compiler and new libraries that do not check the manufacturer‚Äôs identifier, and if so, when.  But here is what we can do before this time: <br><ol><li>  Use another compiler.  According to <a href="http://www.agner.org/optimize/">my tests</a> , the Gnu compiler for Linux optimizes performance at a level similar to that of the Intel compiler, but the Gnu function library (Glibc) is worse than Intel's.  All other compilers show lower performance.  Under Windows, compilers with performance close to the Intel compiler do not exist. </li><li>  Use the Intel compiler and replace the dispatcher.  In <a href="http://www.agner.org/optimize/">my C ++ guide,</a> I published code for alternative processor dispatchers for compilers and Intel function libraries and instructions on how to embed them.  Of course, they use undocumented details about the Intel software device.  This change can in many cases significantly improve performance on non-Intel processors. </li><li>  Do not trust any performance benchmark if its source code is closed or does not use a neutral compiler, such as Gnu or Microsoft. </li><li>  AMD virtualization instructions allow you to change the CPUID of AMD processors.  I hope that someone will make a program for this.  This makes it easy to check if any given test is fair and to improve the performance of software compiled by the Intel compiler on AMD processors. </li></ol><br><br><h4>  Links </h4><br>  <a href="http://aceshardware.freeforums.org/cpuid-family-bits-added-because-of-flaw-in-intel-compiler-t428.html">My discussion on the Aceshardware forum, 2007</a> . <br><br>  <a href="http://forums.amd.com/devforum/messageview.cfm%3Fcatid%3D203%26amp%3Bthreadid%3D95754">Discussion on the Developer Forum</a> <a href="http://forums.amd.com/devforum/messageview.cfm%3Fcatid%3D203%26amp%3Bthreadid%3D95754"><br></a>  <a href="http://forums.amd.com/devforum/messageview.cfm%3Fcatid%3D203%26amp%3Bthreadid%3D95754">AMD, 2008</a> . <br><br>  <a href="http://www.amdzone.com/phpbb3/viewtopic.php%3Ff%3D52%26amp%3Bt%3D137269%26amp%3Bsid%3D3571329cc7c1238a819d02de4bf906f5">My discussion on AMDzone 2009</a> . <br><br>  <a href="http://groups.google.co.uk/group/comp.arch/browse_frm/thread/4e42f16511cf8640">Group discussion</a> <a href="http://groups.google.co.uk/group/comp.arch/browse_frm/thread/4e42f16511cf8640"><br></a>  <a href="http://groups.google.co.uk/group/comp.arch/browse_frm/thread/4e42f16511cf8640">comp.arch, 2004</a> . <br><br>  <a href="http://yro.slashdot.org/comments.pl%3Fsid%3D155593%26amp%3Bcid%3D13042922">Complaint in Intel, discussion in slashdot.org, 2004</a> . <br><br>  <a href="http://www.swallowtail.org/naughty-intel.shtml">Mark Mackey complaint to Intel, 2005</a> . <br><br>  <a href="http://arstechnica.com/hardware/reviews/2008/07/atom-nano-review.ars/6">The unfairness of the PCMark 2005, Arstechnica test has been proven</a> . <br><br>  <a href="http://www.brightsideofnews.com/print/2009/12/17/why-the-ftc-lawsuit-against-intel-has-substance.aspx">Witness's testimonies</a> <a href="http://www.brightsideofnews.com/print/2009/12/17/why-the-ftc-lawsuit-against-intel-has-substance.aspx"><br></a>  <a href="http://www.brightsideofnews.com/print/2009/12/17/why-the-ftc-lawsuit-against-intel-has-substance.aspx">John Oram regarding the testing organization BAPCo</a> . <br><br>  <a href="http://developer.amd.com/documentation/articles/pages/4292005119.aspx">Commentary on AMD Developer Central, 2005</a> . <br><br>  <a href="http://www.theregister.co.uk/2005/07/12/amd_vs_intel_code/">AMD sues, 2005</a> . <br><br>  <a href="http://techreport.com/discussions/8547">Antitrust complaint AMD, 2005</a> . <br><br>  <a href="http://download.intel.com/pressroom/legal/AMD_settlement_agreement.pdf">The settlement agreement between AMD and Intel, 2009</a> . <br><br>  <a href="http://www.ftc.gov/os/adjpro/d9341/091216intelcmpt.pdf">FTC Complaint, 2009</a> . <br><br>  <a href="http://www.agner.org/optimize/">Technical details in my C ++ optimization guide</a> . <br><br>  <a href="http://www.xtremesystems.org/forums/showthread.php%3Ft%3D242272">Discussion on the XtremeSystems forum</a> . </div><p>Source: <a href="https://habr.com/ru/post/80050/">https://habr.com/ru/post/80050/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../80035/index.html">Dell XPS M1210 disassembly</a></li>
<li><a href="../80036/index.html">The optimal length and composition of the password</a></li>
<li><a href="../80038/index.html">What does UserAgent eat</a></li>
<li><a href="../80045/index.html">Lyceum from Revolance</a></li>
<li><a href="../80046/index.html">Lenovo Skylight - the first serial smartbook</a></li>
<li><a href="../80051/index.html">December FireForge.net Review</a></li>
<li><a href="../80052/index.html">Nexus One. The presentation has begun</a></li>
<li><a href="../80053/index.html">What fine HTML code should look like.</a></li>
<li><a href="../80054/index.html">How to make a budget geocluster hosting</a></li>
<li><a href="../80056/index.html">We do the timer or the first project on the FPGA</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>