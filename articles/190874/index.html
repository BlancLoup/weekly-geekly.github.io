<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>As I continued to make my amusement park</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After the first post about his version of the study of JavaScript, combining business with pleasure, decided to make important additions and, at the s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>As I continued to make my amusement park</h1><div class="post__text post__text-html js-mediator-article">  After the <a href="http://habrahabr.ru/post/189258/">first post</a> about his version of the study of JavaScript, combining business with pleasure, decided to make important additions and, at the same time, make a breakthrough in learning. <br><a name="habracut"></a><br><br>  The first version of the script did not have one barely noticeable, at first glance, but an important function - sending a personal message to the author of the comment.  It was immediately decided to fix this: <br><br><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clickPm</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ event.preventDefault(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> username = event.target.parentElement.parentElement.parentElement.querySelector(<span class="hljs-string"><span class="hljs-string">'a.username'</span></span>).innerText; <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.location.pathname = <span class="hljs-string"><span class="hljs-string">'/conversations/'</span></span> + username; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> infobars = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelectorAll(<span class="hljs-string"><span class="hljs-string">'.to_chidren'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//        , so strange for (i = 0; i &lt; infobars.length; i++) { var pmLink = createBtn('pmlink', '', ' reply_link', 'container', clickPm); infobars[i].appendChild(pmLink); }</span></span></code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      A link is created with a message icon for each comment, and the click handler sends us to the personal message sending page to the user, in whose comments we clicked. <br><br><div class="spoiler">  <b class="spoiler_title">It looks like this</b> <div class="spoiler_text"><img src="http://habrastorage.org/getpro/habr/post_images/231/9c7/17b/2319c717b2ab7d687ce6b707e42da127.png" alt="image"></div></div><br><br>  Since the last days there is a clear trend for a different kind of WI, it was decided to do this with the obligatory display of karma and rating, as well as preservation of the usual structure of the user unit.  Also, the userbar should be transparent in order not to make it too difficult to navigate through the announcement pages (feed, posts, etc.).  If the second was decided by styles, then the first was a bit more complicated.  Having read about the rules for processing requests, I learned an important thing - only asynchronous requests.  I will make a small remark - usually I try to apply each newly studied material on a ‚Äúpatient‚Äù, that is, in the context of my tasks.  I advise you to do the same as I do for beginners, since the examples are not remembered because of their one-sidedness. <br>  First you need to create a userbar: <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> userpanel = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelectorAll(<span class="hljs-string"><span class="hljs-string">'.userpanel'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> userpanelTop = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelectorAll(<span class="hljs-string"><span class="hljs-string">'.userpanel &gt; .top'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> userpanelBottom = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelectorAll(<span class="hljs-string"><span class="hljs-string">'.userpanel &gt; .bottom'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> karmaDescription = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelectorAll(<span class="hljs-string"><span class="hljs-string">'.charge'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (userpanelBottom != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { userpanelTop.innerHTML += userpanelBottom.innerHTML; userpanel.removeChild(userpanelBottom); userpanel.removeChild(karmaDescription); karmaCounter(); }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (userpanelTop == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> top = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'div'</span></span>); top.className = <span class="hljs-string"><span class="hljs-string">'top'</span></span>; top.innerHTML = userpanel.innerHTML; userpanel.innerHTML = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; userpanel.appendChild(top); };</code> </pre><br>  I define variables and conditions for different user states (logged in and logged out).  A small trick with userpanel.innerHTML = null after transferring the contents of the userpanel variable to another userpanelTop variable created (which is a userser) and before including the userpanelTop in the userpanel allows you to avoid additional DOM walk. <br><br>  This is the function of parsing an xml page with user data: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">karmaCounter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xmlhttp=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); xmlhttp.overrideMimeType(<span class="hljs-string"><span class="hljs-string">'text/xml'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> userBlock = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelectorAll(<span class="hljs-string"><span class="hljs-string">'.top &gt; .username'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>].innerText; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> userpanelTop = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelectorAll(<span class="hljs-string"><span class="hljs-string">'.userpanel &gt; .top'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> karmaCharge = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'a'</span></span>); karmaCharge.className = <span class="hljs-string"><span class="hljs-string">'count karma'</span></span>; xmlhttp.onreadystatechange=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xmlhttp.readyState==<span class="hljs-number"><span class="hljs-number">4</span></span> &amp;&amp; xmlhttp.status==<span class="hljs-number"><span class="hljs-number">200</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> counter = xmlhttp.responseXML.querySelectorAll(<span class="hljs-string"><span class="hljs-string">'karma'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>].firstChild; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rating = xmlhttp.responseXML.querySelectorAll(<span class="hljs-string"><span class="hljs-string">'rating'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>].firstChild; karmaCharge.innerText = <span class="hljs-string"><span class="hljs-string">' '</span></span>; karmaCharge.appendChild(counter); karmaCharge.innerText += <span class="hljs-string"><span class="hljs-string">',  '</span></span>; karmaCharge.appendChild(rating); userpanelTop.insertBefore(karmaCharge, userpanelTop.firstChild.nextSibling.nextSibling); } } xmlhttp.open(<span class="hljs-string"><span class="hljs-string">"GET"</span></span>, <span class="hljs-string"><span class="hljs-string">'/api/profile/'</span></span> + userBlock ,<span class="hljs-literal"><span class="hljs-literal">true</span></span>); xmlhttp.send(); }</code> </pre><br>  The important point is that in order to parse correctly, I had to override the MIME type with overrideMimeType ('text / xml'). <br><br>  I forgot to mention the main thing - in the framework of the script I try to observe the general style and implement the new functionality so that it looks organically in the pleasant minimalism of Habr.  There is no purpose to invent a lot of things and try to implement it in the script, only necessary and not out of the box. <br><br><div class="spoiler">  <b class="spoiler_title">Userbar in all its glory</b> <div class="spoiler_text"><img src="http://habrastorage.org/getpro/habr/post_images/fac/253/edd/fac253edd78be219888e3498bcdd7c2b.png" alt="image"></div></div><br><br>  <a href="https://github.com/glebcha/habralite">Script on githaba</a> <br><br>  <a href="https://chrome.google.com/webstore/detail/habralite/lpbcmeihkgpndiagnaknkfpkhbdcmjhi">Chrome market extension</a> <br><br>  And this time, it was not without some blur in the text, for which I ask you to forgive me.  In view of the modest experience, somewhere I could be wrong and, probably, cause fair resentment.  For such a reasoned indignation in the form of comments, this post was created, because I can learn useful lessons. <br>  Thanks to everyone who accepted the invitation to visit my amusement park. </div><p>Source: <a href="https://habr.com/ru/post/190874/">https://habr.com/ru/post/190874/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../190862/index.html">Life outside Zion</a></li>
<li><a href="../190866/index.html">Determination of the percentage of similarity drawn 2d-polygon with a given pattern</a></li>
<li><a href="../190868/index.html">PhpBB integration in the Yii framework</a></li>
<li><a href="../190870/index.html">Script for checking the availability of free dates at the embassy</a></li>
<li><a href="../190872/index.html">Pseudolemmatization, composites and other strange words</a></li>
<li><a href="../190876/index.html">Optimize SQL insertion speed on Android devices</a></li>
<li><a href="../190880/index.html">Import KeePass Password Database into KWallet</a></li>
<li><a href="../190882/index.html">Caution, radiation!</a></li>
<li><a href="../190884/index.html">The first site is blocked by the "anti-piracy" law UPD + a full list of sites to block</a></li>
<li><a href="../190888/index.html">PVS-Studio finally got to Boost</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>