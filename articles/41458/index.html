<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Bit Mask Resurrection</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Based on the topics: 
 Packaging of Boolean variables for storage and search in the database 
 Storage of a set of checkboxes in one DB field. Bit mas...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Bit Mask Resurrection</h1><div class="post__text post__text-html js-mediator-article"> Based on the topics: <br>  <a href="http://coylone.habrahabr.ru/blog/37131/">Packaging of Boolean variables for storage and search in the database</a> <br>  <a href="http://habrahabr.ru/blogs/webdev/38015/">Storage of a set of checkboxes in one DB field.</a>  <a href="http://habrahabr.ru/blogs/webdev/38015/">Bit mask</a> <br>  A great idea was buried in these topics.  Well, let's try to revive her again ... <br><br><a name="habracut"></a><br>  I'll start with an example.  The user must have access to certain functions of the site.  All of these functions, for example, 1000. There are groups to which a specific set of functions is attached.  A user can belong to several groups at once.  For one request to the site, several functions can be performed at once.  Pretty real challenge isn't it? <br><br>  Groups will be stored in the groups table.  To store a set of functions to a group, the most obvious solution is to create a link table: <br> <code>CREATE TABLE `functions_to_group` ( <br> `group_id` int(4) unsigned NOT NULL, <br> `function_id` int(4) NOT NULL <br> UNIQUE KEY `f_to_g` (`group_id`,`function_id`) <br> )</code> <br> <br>  Now, when requesting a function, you need to make a request to the database: <br> <code>"SELECT <br> `function_id` <br> FROM <br> `functions_to_group` <br> WHERE <br> `group_id` in (" .implode(",", $user_groups). ") and <br> `function_id` = " .$current_function_id;</code> <br> <br>  But we do not know how many more functions will be called, and each time we have to fulfill this request. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It is possible in one fell swoop, i.e.  request, get all the available functions and for an array of several hundred elements: <br> <code>"SELECT <br> `group_id`, <br> `function_id` <br> FROM <br> `functions_to_group` <br> WHERE <br> `group_id` in (" .implode(",", $user_groups). ")"</code> <br> <br>  Somehow ugly ... All we need is to check if there is a specific value in the data set.  Here the bit mask is most welcome.  But storing a mask as a whole is no longer an option.  We have 1000 functions. <br>  Nafik number, we need binary data, well, so there is such a function pack (), we just come down. <br>  We write a simple class: <br> <code>class BitMask <br> { <br> function __construct(){} <br> <br> function GetMask($num) <br> { <br> //  0,     <br> if (!$num) <br> { <br> return "\0"; <br> } <br> <br> //          <br> $num--; <br> // -  ,    <br> $null_bytes = floor($num / 8); <br> //     ... <br> $number = pow(2, $num % 8); <br> <br> //     <br> return pack('@' .$null_bytes. 'C', $number); <br> } <br> <br> function InMask($needle, $findIn) <br> { <br> //,      , <br> //..       <br> return (bool)strlen(trim($needle &amp; $findIn, "\0")); <br> } <br> <br> }</code> <br> <br>  Now we pack the whole set of functions for the group in one line, for example, like this: <br> <code>$x = new BitMask(); <br> <br> $group_access = $x-&gt;GetMask(0); <br> <br> while (list($k, $v) = each($_POST['functions_to_group'])) <br> { <br> $group_access |= $x-&gt;GetMask($v); <br> }</code> <br> <br>  Everything.  At the output we get one binary string, which can be stored in the groups table.  When authorizing on the site, we make one request to the groups table: <br> <code>"SELECT <br> `functions_bitmask` <br> FROM <br> `groups` <br> WHERE <br> `group_id` in (" .implode(",", $user_groups). ")"</code> <br> <br>  and add the sets of all user groups bit by bit: <br> <code>$user_private_access = $x-&gt;GetMask(0); <br> <br> while (list($k, $v) = each($user_groups_access)) <br> { <br> $user_private_access |= $v; <br> }</code> <br> <br>  To check if there is access to a function, do this: <br> <code>if ($x-&gt;InMask($x-&gt;GetMask($function_id), $user_private_access)) <br> { <br> //   <br> } <br> else <br> { <br> //   <br> }</code> <br> <br>  maximum size of the binary string = ceil (max_function_id / 8) bytes, <br>  in our case for 1000 items, the maximum size will be 125 bytes. <br><br>  The string is 255 characters long, max_function_id = 2040. <br><br></div><p>Source: <a href="https://habr.com/ru/post/41458/">https://habr.com/ru/post/41458/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../41449/index.html">Trial year</a></li>
<li><a href="../41451/index.html">Pass-through authorization from Windows to Linux</a></li>
<li><a href="../41454/index.html">While Sape is resting ...</a></li>
<li><a href="../41455/index.html">What prevents work?</a></li>
<li><a href="../41457/index.html">The beginning of a new era. bigmir) net came to Belarus.</a></li>
<li><a href="../41460/index.html">Steampunk Mobile</a></li>
<li><a href="../41461/index.html">Rambler launches the most expensive advertising campaign in the history of Runet</a></li>
<li><a href="../41462/index.html">XSPF is the perfect format for playlists.</a></li>
<li><a href="../41464/index.html">MemcacheDB and MemcacheQ are key components of a high-performance infrastructure</a></li>
<li><a href="../41467/index.html">World of Warcraft bots developer to pay a fine</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>