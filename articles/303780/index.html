<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What is the secret of speed NodeJS?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We offer you a translation of the article by Evgeny Obrezkov , in which he briefly and deliberately talks about the reasons for the high speed of Node...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What is the secret of speed NodeJS?</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/264/006/171/264006171b7741648707eeab50c0b0a9.jpg" width="256" align="left">  We offer you a translation of the <a href="https://blog.ghaiklor.com/why-nodejs-is-so-fast-a0ff67858f48">article by Evgeny Obrezkov</a> , in which he briefly and deliberately talks about the reasons for the high speed of NodeJS: streams, event loop, optimizing compiler and, of course, a comparison with PHP.  What could be without him. <br><br clear="all"><a name="habracut"></a><br><br>  In another article about NodeJS I want to talk about another advantage of the software platform: the speed of code execution. <br><br><h3>  <b>What do we mean by execution speed</b> </h3><br>  Calculate the Fibonacci sequence or send a query to the database? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      When we talk about web services, the execution speed includes all the actions that are needed in order to fulfill the request and send it back to the client.  NodeJS is distinguished by high speed - starting from opening a connection and ending with sending a response. <br><br>  Once you understand what is happening in the NodeJS server during the execution of the request, it will become clear to you why this happens so quickly. <br><br>  But first, let's turn to how requests are processed in other languages.  PHP is the best example because it is very popular and does not offer any optimizations by default. <br><br><h3>  <b>What PHP suffers from</b> </h3><br>  Here is a list of what reduces the speed of code execution in PHP: <br><br><ul><li>  PHP has a synchronous execution model.  This means that when you process a request or write to the database, other operations are blocked.  Therefore, you have to wait until the end of the operation before you start doing something else. </li><li>  Each request to a web service creates a separate PHP interpreter process that executes your code.  Thousands of connections mean thousands of running processes that consume memory.  You can watch how memory is used more and more along with new connections. </li><li>  PHP does not have a JIT compiler.  This is important if you have code that is used very often, and you want to be sure that it is as close to the machine code as possible. </li></ul><br>  These are the most critical cons of PHP.  But, in my opinion, there are many more. <br><br>  Now we will look at how NodeJS copes with similar tasks. <br><br><h3>  <b>Magic NodeJS</b> </h3><br>  NodeJS is single threaded and asynchronous.  Any I / O operation does not block the operation.  This means that you can read files, send emails, query the database, and perform other actions ... at the same time. <br><br>  Each request does not create a separate NodeJS process.  On the contrary, in NodeJS only one process is constantly running and waiting for connections.  JavaScript code is executed in the main thread of this process, and all I / O operations are performed in <b>other threads with</b> almost no delay. <br><br>  The virtual machine in NodeJS (V8) that executes javascript has a JIT compilation.  When the virtual machine gets the source code, it can compile it right while running.  This means that operations that are often called can be compiled into machine code.  And it will greatly improve the speed of execution. <br><br>  In essence, the advantages of the asynchronous model were outlined here.  Let me explain how this works in NodeJS. <br><br><h3>  <b>Understand your asynchrony</b> </h3><br>  I offer you an example of the concept of asynchronous processing (thanks to <a href="https://medium.com/%40blia">Kirill Yakovenko</a> ). <br><br>  <i>Imagine that you have 1000 balls on top of a mountain.</i>  <i>And your task is to push all the balls so that they are at its base.</i>  <i>You can not push at the same time a thousand balls, only each separately.</i>  <i>But this does not mean that you have to wait for the ball to reach the ground in order to push the next one.</i> <br><br>  Synchronous execution means a waste of time for you.  You are waiting for the ball to be at the base. <br><br>  Asynchronous execution is like having 1000 extra hands.  And you can run all the balls at the same time.  Then you wait only for the messages that they are all below and collect the results. <br><br>  How does asynchronous execution help a web service work? <br><br>  Imagine that each ball is a query to the database.  You have a big project, where there are a lot of requests, aggregations, and so on.  When you process all data in a synchronous way, it blocks the execution of the code.  Asynchronously, you execute all requests at the same time, and then only collect data. <br><br>  In real life, when you have a lot of connections, it greatly speeds up the work. <br><br>  How is the asynchronous method implemented in NodeJS? <br><br><h3>  <b>Event loop</b> </h3><br>  An event loop is a construct that is responsible for handling events in a program.  The event loop almost always works asynchronously with respect to the message source.  When you invoke an I / O operation, NodeJS retains the callback associated with this operation and continues processing other events.  Callback will be called when all necessary data is received. <br><br>  The most extensive definition of the event loop: <br><br>  <i>An event loop, message dispatcher, message loop, message pump, or run loop is a software construct that waits for and processes events or messages in a program.</i>  <i>The construct works by creating requests to an internal or external message delivery service (which usually blocks the request until the message is received), after which it calls the appropriate event handler (‚Äúhandles the event‚Äù).</i>  <i>An event loop can be used in conjunction with reactor if the event source has the same interface as the files to which you can make a request of the type select or poll (poll in the sense of the Unix system call).</i>  <i>The event loop almost always works asynchronously with respect to the message source.</i> <br><br>  Let's look at a simple illustration that explains how the event loop works in NodeJS. <br><br><img src="https://habrastorage.org/files/c09/a6d/88e/c09a6d88e0354b2ba18329deff238dcc.jpeg"><br><br><h3>  <b>Event Loop in NodeJS</b> </h3><br>  When a web service receives a request, it is sent to the event loop.  The event loop registers an operation in the thread pool with the required callback.  The callback will be called when the request is completed.  Your callback can also do other ‚Äúheavy‚Äù operations, such as queries to the database.  But it does it in the same way - it registers the operation in the thread pool with the necessary callback. <br><br>  How about code execution and its speed?  We are going to talk about the virtual machine and how it executes javascript code.  That is about the V8. <br><br><h3>  <b>How does V8 optimize your code?</b> </h3><br>  <a href="https://wingolog.org/tags/v8">Wingolog</a> describes how the V8 virtual machine works.  I simplified the material stated there and I suggest squeezing. <br><br>  Below are the basic principles of the V8 virtual machine and how it optimizes JavaScript code.  This will be technical information, so you can skip this part if you do not know how the compilers work.  And if you want to know more about the V8, I advise you to contact a <a href="http://mrale.ph/v8/resources.html">specialized source</a> . <br><br>  V8 has three types of compiler, but we will discuss only two: Full and Crankshaft (the third compiler is called Turbofun). <br><br>  A full-compiler is fast and produces ‚Äúsample code‚Äù.  From the Javascript function, it takes AST ( <a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree">Abstract Syntax Tree</a> ) and translates it into typical native code.  At this stage, only one optimization is applied - <a href="https://en.wikipedia.org/wiki/Inline_caching">inline caching</a> . <br><br>  When the code is compiled and run, V8 starts the profiler thread to find out which functions are used frequently and which are not.  The virtual machine also collects type usage reports, so that it can record the types of information that passes through it. <br><br>  After V8 has determined which functions are used frequently and received a report on the use of types, she tries to run a modified AST through the optimizing compiler, Crankshaft. <br><br>  Unlike the Full compiler, Crunshaft does not work so fast, but tries to produce optimized code.  Cranshaft consists of two components: Hydrogen and Lithium. <br><br>  The Hydrogen compiler generates a CFG ( <a href="https://en.wikipedia.org/wiki/Control_flow_graph">Control Flow Graph</a> ) from AST (based on the type usage report).  This graph is presented in the form of SSA ( <a href="https://en.wikipedia.org/wiki/Static_single_assignment_form">Static Single Assignment</a> ).  Based on a simple HIR structure ( <a href="https://en.wikipedia.org/wiki/Intermediate_representation">High-Level Intermediate Representation</a> ) and an SSA form, the compiler can apply many optimizations, such as constant folding, method inlining, and so on ... <br><br>  The lithium compiler translates an optimized HIR to LIR (Low-Level Intermediate Representation).  LIR is conceptually similar to machine code, but in most cases does not depend on the platform.  In contrast to HIR, the LIR form is closer to the three-address code. <br><br>  Only after that, the optimized code can replace the old non-optimized and continue to run your application much faster. <br><br><h3>  <b>useful links</b> </h3><br><ul><li>  <a href="http://mrale.ph/">Talk crazy Russian engineers</a> </li><li>  <a href="https://wingolog.org/tags/v8">Andy Wingo blog</a> </li><li>  <a href="https://wingolog.org/tags/v8">About V8</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/303780/">https://habr.com/ru/post/303780/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../303770/index.html">A bit about the performance of Cisco network equipment</a></li>
<li><a href="../303772/index.html">Super Mario World Method: Add-ons and Extensions</a></li>
<li><a href="../303774/index.html">BitrixFramework: take everything into our own hands</a></li>
<li><a href="../303776/index.html">Vice-president of new products Mail.ru Group Yuri Gursky - about their own projects: Maps.me, MSQRD and Prisma</a></li>
<li><a href="../303778/index.html">Microservices as architecture: squeeze to the maximum</a></li>
<li><a href="../303782/index.html">[Go] [JS] And again about processing marc formats</a></li>
<li><a href="../303784/index.html">Do you have any ideas? We have Tabtabus! How was the third IT festival in nature</a></li>
<li><a href="../303786/index.html">Coding standards and other IT practices</a></li>
<li><a href="../303788/index.html">Hardcore startups. Part 1: How to make your dream come true</a></li>
<li><a href="../303790/index.html">IoT: from smart bulbs to advanced production technologies</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>