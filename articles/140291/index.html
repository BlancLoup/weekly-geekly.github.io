<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Indexing AJAX sites</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Together with the development of Joosy , AJAX suddenly - but expectedly - filled all the projects that we undertake. The paradigm proved extremely suc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Indexing AJAX sites</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/b99/423/fb0/b99423fb0684ccd920af5418c4793afc.jpg" align="left"><br><br>  Together with the development of <a href="http://guides.joosy.ws/">Joosy</a> , AJAX suddenly - but expectedly - filled all the projects that we undertake.  The paradigm proved extremely successful in all aspects except one.  That very classic one: ‚ÄúAJAX?  Indexing?  Pff ... ".  While we are doing online banking, this is fine with us.  But how not to deny yourself this exquisite pleasure for open Web-resources? <br><br>  Here‚Äôs how: <a href="https://developers.google.com/webmasters/ajax-crawling/">Google AJAX Crawling</a> is a Google standard that allows Google to magically request another magic address instead of it when generating AJAX addresses (#!).  From which Google will be waiting for the HTML dump of this page, which he cheerfully chew.  Good people have already written <a href="http://habrahabr.ru/post/71838/">an article about how it works</a> .  Well, we need to learn how to effectively form this dump.  Yes, so that without interfering with the code of the application itself. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br>  <a href="http://github.com/roundlake/hashbang">Hashbang</a> is a small Ruby proxy using the Rack protocol.  The latter means that in order to raise it will fit any web-server that works with Ruby and / or Rails.  And for those who use Rails themselves, we have prepared a couple of special buns.  But first things first. <br><br><h2>  Common device </h2><br>  During initialization, Hashbang creates a WebKit-browser instance in its depths.  After the request with the specified URL is launched, it opens the desired address, waits for a special Javascript event, and returns the HTML code at the time this event occurred. <br><br>  This means that all you need to change in the current application is to call <br><br><pre><code class="javascript hljs">Sunscraper.finish()</code> </pre> <br>  when the page prepared by Javascript can be considered finished. <br><br>  In combat mode, it will look like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/storage2/adc/6ac/4ee/adc6ac4ee79d33a3b483bc49a09661ab.png"></div><br><br><h2>  Pro internal browser and performance </h2><br>  We experimented a lot with possible implementations of a ‚Äúheadless‚Äù browser.  We tried <a href="http://watir.com/">Watir</a> and various existing <a href="http://qt.nokia.com/products/">Qt</a> bindings.  Nothing good came out.  Desperate, we just wrote our own binding to Qt-WebKit, which knows how to return HTML by tracking the event: <a href="https://github.com/roundlake/sunscraper">Sunscraper</a> .  This miracle is written in a mixture of C / C ++ and connects to Ruby via <a href="https://github.com/ffi/ffi">FFI</a> .  This means that Sunscraper should work not only on MRI, but also on JRuby / Rubinius.  Unfortunately, it still doesn‚Äôt work with Rubinius due to bugs in the implementation of that same FFI. <br><br>  Since all that we launch is the WebKit engine itself, the performance is close to maximum to solve this problem.  Real data from live servers in the collection process. <br><br><h2>  Before installation </h2><br>  Sunscraper uses Qt.  Therefore, you will definitely need it to install gem Hashbang.  If you are using a Mac, we recommend <a href="http://mxcl.github.com/homebrew/">Homebrew</a> : <code>brew install qt</code> .  In Linux, you can put any fresher of the packages. <br><br><h2>  Development mode for those on the tracks </h2><br>  If you're not developing on Rails, feel free to skip to the next paragraph, which will tell you about the implementation of Hashbang. <br><br>  To install Hashbang in a Rails project, you need to perform the following sequence of actions: <br><br><ol><li>  Add <code>gem hashbang</code> to gemfile </li><li>  Generate the base application using <code>rails g hashbang</code> </li></ol><br>  Now inside your Rails application, in the hashbang folder, is the Hashbang gadget itself.  And this means that you need to skip the first paragraph in the ‚Äúsetup and launch‚Äù section. <br><br>  In the development environment, Hashbang inserts its middleware into the Rails download, which intercepts all requests containing the _escaped_fragment_ magic fragment and automatically processes them.  Only one problem: Webrick works in one thread.  And since Hashbang asks for "itself", this leads to deadlock.  Therefore, to test the current application locally, run it using <code>rake hashbang:rails</code> .  This command will launch your application under the Unicorn server in two threads.  After launching - <code>localhost:3000/?_escaped_fragment_</code> - and check HTML.  Just do not forget that in the AJAX application itself you need to call <code>Sunscraper.finish()</code> . <br><br>  To emulate the launch of Hashbang in combat mode, where it works via /? Url = http: // ..., use the <code>rake hashbang:standalone</code> command. <br><br><h2>  Setup and Startup </h2><br>  If you do not use Rails, the base application can be taken from a <a href="https://github.com/roundlake/hashbang-sample">special repository</a> .  All you need to do is place it somewhere, make sure that you have the gem bundler installed and do it in the application root <code>bundle install</code> . <br><br>  Inside the generated / copied Hashbang application is the file config.rb, which must be edited to work effectively.  It has only two directives: <br><br><ul><li>  <b>url</b> : regular expression to which the requested URL should match </li><li>  <b>timeout</b> : timeout in milliseconds, which hashbang will wait for the Sunscraper.finish () event </li></ul><br>  Suppose that to start the service we use the <a href="http://www.modrails.com/">Passenger</a> module, which implements work with Rack based on Nginx.  In this case, in order to work correctly, we need to achieve the following: <br><br><ul><li>  The Hasbang application should work on our special internal address. </li><li>  All requests containing _escaped_fragment_ should be forwarded to this application, and should be forwarded to uri-escaped with an absolute URL in the parameter url = .... </li><li>  We need to limit the number of parallel resources to this application, because we are unlikely to be indexed in a hundred threads, and WebKit loves resources. </li></ul><br>  Here is the configuration file you can use: <a href="https://gist.github.com/2127685">https://gist.github.com/2127685</a> .  This is an example of using Hashbang in a Ralis application. <br><br><h2>  About sad </h2><br>  Unfortunately, this standard has not reached our native hearths, Yandex.  It is supported by Google, it is supported by Bing (and therefore Yahoo).  Even Facebook crawler supports it.  And Yandex is not.  This means that Hashbang does not help your indexing in the domestic segment of the Internet.  At least for now.  We are sending the furious rays of good towards the Yandex team and wish them to quickly turn their attention to the so actively developing technological segment of the Web :). <br><br><h2>  Finally </h2><br>  Despite the fact that we are already using Hashbang in battle, we have not yet tested it on all possible configurations.  If you have any problems with its assembly or configuration, we are always happy with the <a href="https://github.com/roundlake/hashbang/issues">new Issues on the githaba</a> . <br><br>  Thank :). </div><p>Source: <a href="https://habr.com/ru/post/140291/">https://habr.com/ru/post/140291/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../140285/index.html">Android and iOS Security Comparison: Key Findings</a></li>
<li><a href="../140286/index.html">Web-Drawing Library: Paper.js Vs. Processing.js Vs. Raphael.js</a></li>
<li><a href="../140287/index.html">New look at the comments. Hypercomments.com - commenting on text fragments</a></li>
<li><a href="../140288/index.html">The mysterious programming language framework Duqu defined</a></li>
<li><a href="../140289/index.html">"Resurrect" HDD</a></li>
<li><a href="../140293/index.html">Codeigniter Notify (UPD: 06/16/12)</a></li>
<li><a href="../140296/index.html">Systems on a crystal: from wristwatches to large combat robots</a></li>
<li><a href="../140297/index.html">Authorization via JS</a></li>
<li><a href="../140298/index.html">A little bit of ‚Äúperversion‚Äù over django models</a></li>
<li><a href="../140301/index.html">Perceptron Rosenblatt - what is forgotten and invented by history?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>