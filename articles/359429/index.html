<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Notes IoT provider. Zoo metering</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I continue the series of articles about the experience of IoT-provisioning based on the LoRa network. Start here and here . 


 So, the test network w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Notes IoT provider. Zoo metering</h1><div class="post__text post__text-html js-mediator-article"><p>  I continue the series of articles about the experience of IoT-provisioning based on the LoRa network.  Start <a href="https://habr.com/post/359276">here</a> and <a href="https://habr.com/post/359294">here</a> . </p><br><p>  So, the test network was launched, and we were preparing to start connecting pilot subscribers. </p><br><p>  It turned out as always: they were afraid of one thing, they did not even think about something else.  As a result, the first cost, and the second created a bunch of problems. <br>  Most of all, we were afraid that in real conditions the network would start to work somehow differently than on tests.  When the first subscriber showed us 40 basements, in which there were about 50 water meters, it became really exciting.  Basements are the usual basements of 5- and 9-storey houses.  With tiny barred windows, raw, with rats and cats. </p><br><p>  However, after placing all the radio modules it turned out that they were afraid of nothing.  The network worked without problems, we got a stable coverage within a radius of two kilometers from the base stations.  Of course, something had to be optimized, but in small detail.  It is with radio coverage that there were no problems. </p><br><p>  But the counters themselves surprised us.  In housing and communal services, we met a zoo, and inside the documentation - a mess. </p><br><img src="https://habrastorage.org/webt/fj/_c/7u/fj_c7uqjz-e17e7lvcf9mqfcl3u.png"><br><br><a name="habracut"></a><p>  I will make a small digression and explain what a pulse output counter is. </p><br><p>  Pulse output is two wires (or a terminal block) that go out of the water, electric, heat or gas meter.  If rough, then between these wires periodically short circuit occurs.  That is, the relay closes or reed.  In fact, there is not just a short circuit, just a drop in resistance, but in this case it does not matter. </p><br><p>  Each such short circuit is an impulse.  Those.  the water meter spins, winds up the cubes of water and, in proportion to them, sends these same impulses to the line.  Say, while the cube was winding, it gave 10 pulses.  Considering these impulses, we understand how much resource has passed through one or another metering device.  On board the radio module there is a pulse counter, so in fact we need to make two contacts there and correctly configure everything. </p><br><img src="https://habrastorage.org/webt/s-/hh/vf/s-hhvfwxxgpqs7fzdx_mq-3w6vs.png"><br><i></i><p>  Radio module on the water meter </p><br><p>  It is important to understand that the meter in no way tells us its final value.  He will not be able to transmit through the pulse output the testimony that he has now on the scoreboard. </p><br><p>  No, he shakes it in real time and we have to count in real time with him.  And at the first connection of the radio module, it is also necessary to rewrite and enter the initial values ‚Äã‚Äãinto the system, as can be seen on the scoreboard.  Further we will add all indications to this value. </p><br><p>  So, we began to connect the counters.  And faced with the first difficulties.  In this article I will deliberately omit the names of individual devices in order not to create anti-advertising.  I hope this article will be read by at least one of the manufacturers and draw conclusions. </p><br><p>  Some metering devices were great and clearly corresponded to the documentation.  That is, if the price impulse is 100 per 1 cu.  meter of water, then it is. <br>  For some reason, some metering devices in the documentation were lying.  Could be written - 10 pulses per cube.  And in fact - 100. Moreover, the price of the impulse was sometimes knocked out right on the meter itself, on the body.  And it was not true. </p><br><p>  Then we were very surprised, how can an attorney‚Äôs metering device have such blunders?  However, it did not cause serious difficulties.  On problem meters, the impulse price was picked up by a spear method and they still became monitored. </p><br><p>  Next, there was still a surprise waiting for us when electricity meters began to be connected.  They do not have a relay there, but an open collector and the polarity of the connection is important.  And again the documentation of part of the metering devices lied to us, confusing plus and minus.  Again, out of the situation by brute force, the benefit is that there are only two options. </p><br><img src="https://habrastorage.org/webt/73/bh/hu/73bhhudqwjbjyjguva9aeg1rb-g.jpeg"><br><i></i><p>  Apartment meters connected to the radio module.  The photo does not show that the electron is still closed with iron doors. </p><br><p>  The surprises did not stop.  We were ordered to supply a dwelling house with individual heat meters for monitoring.  The house was not in our city, but a hundred kilometers away and a survey was done by field engineers.  Those.  they took pictures of the metering devices themselves, passed their passports to us. </p><br><p>  We began to rummage in the documentation.  It turned out that these heat meters have several options for interface outputs: M-Bus, RS-485 or pulse.  The documentation modestly stated "depends on the modification."  And that's it!  What modification, where to look, where is it located ??? </p><br><p>  Contact the factory.  Then I had a dialogue like this: </p><br><p>  - Good day.  How to understand the type of interface output of your heat meter? <br>  - The leftmost cable.  What color transactions? <br>  - White and brown. <br>  - Yeah.  This is either M-Bus or Pulse. <br>  - And exactly how to find out? <br>  - M-Bus, like, signed. <br>  - Like?  And by modification is it somehow possible to find out?  Is she spelled somewhere?  I can tell you the serial. <br>  - Mmm ... on the box should be.  On the counter itself, it seems, no.  Serial does not help. <br>  - And if the box was thrown away? <br>  ‚ÄúMmm ...‚Äù </p><br><p>  As a result, the plant did not tell us anything intelligible.  What to do is not clear - the meters for a hundred kilometers, the house has not yet been handed over, they are not included.  If the testimony went, it would be possible for Tseshka to get up between the contacts.  But we can not yet.  We are already thinking of sending a test M-Bus module there.  With us require KP with the exact name of the equipment.  M-Bus is more expensive and I‚Äôm not mad about putting in the price. </p><br><p>  Then we were rescued by the supplier.  He managed to find invoices for shipment.  And he (and not the factory!) Turned out to be an amazingly intelligent engineer who nevertheless helped identify this meter.  It turned out that you need to look in the passport, there is a modification.  And although the passport did not have its decryption, the supplier, fortunately, had it.  Taxied out. </p><br><img src="https://habrastorage.org/webt/0l/bp/t7/0lbpt7hgunsmapvqvaatfqorz2o.png"><br><p>  Pinout from the passport heat meter.  We see that options 3 and 5 are visually the same.  There is no decoding of counter modifications in the passport and it is problematic to distinguish the impulse from the M-Bus. </p><br><p>  There are already quite a few such stories, and manufacturers continue to amaze.  Now we already have a huge business card with the coordinates of managers or engineers of various factories with whom you can consult.  And we do not miss the chance to build bridges with another manufacturer, so that later we could ask anyone.  Conveniently.  And sometimes the only option. </p><br><p>  I must say that most of the factories are still pleased with adequate support and competent staff in the field.  I can‚Äôt say anything bad about SPBZIP, Incotex, Energomeru, Lenelektro, EMIS.  We even made friends with Ekaterinburg Carat, and they even tested their first heat meter with a LoRa module on our network. </p><br><p>  However, some plants are NOT from the list above engineers would learn. </p><br><p>  As experience and contacts appeared, it became a little easier to work.  However, I still could not get used to that attorneys accounting devices generally allow this. </p><br><p> It turned out that we are still doing well.  Kazakh colleagues told that telemetric output of meters is now mandatory in their state.  And once it is mandatory, that is, say, apartment water meters, from which the wire sticks out.  There is a telemetric output!  The trouble is that the wire inside the meter is not connected anywhere, it just dangles in the air.  That's right, to the usual water meter just screwed the wire. </p><br><p>  So we were lucky, through the stump-deck, but our interfaces at least work. </p><br><p>  In general, for the year I‚Äôm kind of used to somehow, that this is possible.  But all was thinking - how?  Why?  A possible answer came up during our recent discussion of the problem in the LoRa community.  Colleagues noticed that some counters of different plants are similar as twin brothers.  Maybe someone someone thoughtlessly copied or is it generally Chinese nouneym.  Weed through certification and sell.  Without understanding the inner content. </p><br><p>  I can't guarantee that this is true, but the version is sound. </p><br><p>  Summarizing, I‚Äôll say that if you go to do telemetry in the housing and utilities sector, the word ‚Äúzoo‚Äù will flash more often in your vocabulary. <br>  Separately, I want to say about the sealing.  For some strange reason (maybe readers can tell why) resource managers love to seal everything they can.  The photo below shows the Energomera electric meter.  There are fillings on the top and bottom.  From above there are only interface outputs, they are specifically brought there.  There is also a seal.  It turns out that if I installed the counter, and after some time I decided to tie monitoring to it, then I should call the engineer from the resources.  Not too comfortable. </p><br><img src="https://habrastorage.org/webt/dz/nw/ba/dznwbacyxzvbpvnqrgqyjatn_0s.jpeg"><br><i></i><p>  Energomera is sealed from below and above </p><br><p>  And most importantly, all these difficulties overtook us only at the stage of pulse output.  But it soon became clear that we would not go far on a single impulse.  There were requests for monitoring of more complex devices, for example, three-phase electricity meters or house heat meters.  These devices monitor several parameters simultaneously.  And to issue them through a pulse output is simply unrealistic.  And because it uses RS-485 and others like it. <br><br>  So we had to learn how to work with this kind of interface.  Moreover, being able to handle it, we could go not only to housing and utilities, but also to other, much more interesting spheres.  And we started learning ... </p><br><p>  UPD.  It was rightly noted in the comments that my example with the sealed Energy meter is incorrect - there the lid is removed by unscrewing one non-sealed bolt.  But this does not remove the problem, many of the counters have an interface output under the seal. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/359429/">https://habr.com/ru/post/359429/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../359403/index.html">Smart column Echo recorded a private conversation and sent a random contact</a></li>
<li><a href="../359407/index.html">How to choose an IaaS provider: 4 criteria you should pay attention to</a></li>
<li><a href="../359409/index.html">Auto provisioning for MicroSIP softphone</a></li>
<li><a href="../359411/index.html">Open broadcast of the main hall RIT ++</a></li>
<li><a href="../359415/index.html">Adaptation of the blockchain to the Internet of things: the main problems</a></li>
<li><a href="../359435/index.html">Yandex Blitz: machine learning</a></li>
<li><a href="../359451/index.html">Google I / O 2018 through the eyes of a mobile game developer + follow-up recommendations</a></li>
<li><a href="../359459/index.html">Python Selenium and Krisha.kz. First in Big Data</a></li>
<li><a href="../359465/index.html">Riddles resume. Part 2. Font also matters.</a></li>
<li><a href="../359473/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ 316 (May 21 - 27, 2018)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>