<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Debugging Node.js in Visual Studio</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I like Node.js, but recently I started using it on serious projects. At the same time, I continued to use my favorite development environment * . And ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Debugging Node.js in Visual Studio</h1><div class="post__text post__text-html js-mediator-article">  I like Node.js, but recently I started using it on serious projects.  At the same time, I continued to use my favorite development environment <a href="http://habrahabr.ru/hub/vs/">*</a> .  And if for simple scripts it‚Äôs enough just an editor, then for serious development you need serious tools, in particular, a debugger.  I couldn‚Äôt find anything ready for the studio, so I took it and made it myself for a couple of days off: <br><img src="https://habrastorage.org/getpro/habr/post_images/bea/8f0/52a/bea8f052a02b41c20275ace8a17b436b.png" alt="image"><br><a name="habracut"></a><br><h2>  <font color="#4F81BD">Quick start</font> </h2><br>  Install <a href="http://nodejs.org/">Node.js</a> and <a href="http://visualstudiogallery.msdn.microsoft.com/bcac44d9-4b9d-45cd-b95e-f19929ac3831">NodeVsDebugger</a> extension.  You can also install it from the extension gallery: <i>Alt + T, U</i> select <i>Online</i> , enter ‚Äúnode debug‚Äù in the search and click <i>download</i> . <br>  Next, open the js-document, set breakpoint, press Ctrl + E, Ctrl + D, voila! <br><br><h2>  <font color="#4F81BD">What is already done</font> </h2><br><ul><li>  There are already Run / Step into / Step over / Step out / Run to line, Locals, Watches, inspection of any identifiers in the editor, Custom inspector for lines and even every little thing; </li><li>  Debugging separately dangling scripts (Ctrl + E, Ctrl + D); </li><li>  Debugging a project with automatic debugger selection (Ctrl + E, Ctrl + A, you can safely switch to F5: projects that are not configured for debugging in the node will not affect this); </li><li>  View (and debug) built-in scripts node ( <a href="">pic</a> ); </li><li>  Connect to node on remote host (only for projects); </li><li>  Mapping remote scripts, if the remote folder is connected, for example, via SAMBA or SSHFS. </li></ul><br>  <b>Debugging projects</b> <br>  At the moment, debugging projects is bolted in the form of a crutch, and you can debug in a node almost any project, be it a web site, a web application, or generally C # or C ++ makefile project.  To do this, you must first configure our debugger, in the menu Debug ‚Üí Node.js Debugging, or simply by pressing Alt + D, E, C. <br>  I did not have time to make a normal UI for settings, so now they are just a JSON file (with comments).  In the comments at the beginning of the file describes the available settings and what they mean.  They are saved to a file named ".nodevsdbg" in the root of the website or next to the project file. <br>  After the settings are made, you can launch the debugger using Ctrl + E, Ctrl + A.  I recommend zabindid on this command the F5 key, and then for projects where there are no settings for the node debugger, or it is turned off in the config (mode = "off"), the standard debugger will be launched. <br>  Naturally, I plan then to make a nodejs-project that will be assigned a custom debugger, and all these crutches will not be needed. <br><br>  <b>Debugging on a remote host</b> <br>  You can also debug a node running on another host, for example, on a virtual machine with Linux.  In one way or another, it is enough to forward the remote port and set it in the settings.  Example for PuTTY: <br><img src="https://habrastorage.org/getpro/habr/post_images/63c/f94/498/63cf9449872af98c3ebcd291e616fcbc.png" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  <font color="#4F81BD">What is not enough</font> </h2><br><ul><li>  Editing values; </li><li>  Normal display functions (with source code); </li><li>  Code completion to watches; </li><li>  Support Immediate window; </li><li>  Autos window support and context mappings; </li><li>  Show where the breakpoint was actually set; </li><li>  Conditions and hit-count in breakpoint; </li><li>  Exception capture mode switch; </li><li>  A complete Attach to process for a node running without - debug; </li><li>  Normal connection to the remote node (the fake process cmd.exe is now running); </li><li>  Debug node node; </li><li>  Edit and Continue (it‚Äôs also LiveEdit in V8); </li><li>  Debugging of native code and JS in one studio copy; </li><li>  Debugging JS in chrome and browser-derived from it (there is the same debag protocol); </li><li>  Supports source maps and debug typescript; </li><li>  Package for VS 2010; </li><li>  Icons. </li></ul><br>  Part of these features I plan to finish soon.  But since I do it sometimes in the evenings, I will be glad to any help - the code is open, send <a href="https://github.com/omgtehlion/NodeVsDebugger/pull/new/master">pull requests</a> . <br><br><h2>  <font color="#4F81BD">How was it done</font> </h2><br>  The node already has a ready backend for the debugger, which can be reached by simply connecting via an http-like protocol to port 5858 (by default).  The protocol is based on messaging in JSON-format.  The protocol itself is not node-specific, but inherited from the V8 engine.  A brief description can be found <a href="http://code.google.com/p/v8/wiki/DebuggerProtocol">here</a> .  This document is enough for an initial acquaintance, however, as it turned out later, it is full of mistakes, understatement, and stupid typos. <br>  In the studio there is a ready-made good GUI for debugger.  Naturally, I decided not to reinvent the wheel, but simply connected these two parts.  The interfaces and concepts of both parts are quite similar, because it is hard to invent something new.  In the V8 protocol, there are control commands for the process being debugged (Break, Go, Step), there is a poll of the current state (Stacktrace aka Backtrace), there are some methods for viewing variables, expressions and executing code pieces.  And a lot of other things ... <br><br>  What problems I encountered: <br>  - At the first attempt to debug the http-server, I ran into a debugger freeze at each debugging step.  The kilometer backtrace, caused by the cunning serialization (it is called a <a href="">mirror</a> ), which tries to serialize the Buffer with a separate descriptive object for each buffer byte, is to blame.  This was fixed by including inlineRefs. <br>  - By default, the lines are abbreviated, as in the following screenshot.  There is nothing wrong with this, since the whole string can also be viewed: at the user's request, we follow the string with maxStringLength = -1 <br><img src="https://habrastorage.org/getpro/habr/post_images/5bd/cdd/ecc/5bdcddecc5a2967bf3ce3f395ed78d8a.png" alt="image"><br>  All this can be understood by looking at <a href="">debug-debugger.js</a> in the same place you can see other commands that are not described in the document on the wiki. <br>  - On the studio side, the problem was the lack of adequate examples on the Custom Debug Engine.  I did not have time for a detailed study of the documentation in MSDN (and there are 100,500 interfaces, structures, enums, etc.), although in the end I often glanced there.  The only official example is an unpretentious native C debugger written for an old studio, automatically converted into a studio project 2010.  It consists of a large piece of managed C ++, which we do not need.  And, actually, the wrappers above the studio interfaces written in the days of C # 2.0 are terribly wordy. <br>  - I redid the registration of the engine, and twice.  In the example, the registration of the engine was made old regsvr32 "mixed-mode C + + assembly".  We got rid of this assembly, and I made the registration just by explicitly adding keys to the registry.  But with the registration, too, it wasn‚Äôt that simple, with 2012 ‚Äôs studios having a little changed places where she is looking for debugging engines.  In the end, all by itself was treated when I made a package for debugger and added <a href="http://msdn.microsoft.com/en-us/library/microsoft.visualstudio.shell.registrationattribute(v%3Dvs.110).aspx">RegistrationAttribute to it</a> . <br>  - Leapfrog with the name of buttons, menu items and commands.  <a href="http://alinconstantin.blogspot.ru/2011/08/element-in-vsct-files-buttontext.html">This article</a> helped to understand. <br>  - Instead of the standard library for parsing / serializing JSON, I took Newtonsoft.Json.  I like it better, and it works faster. <br><br><h2>  <font color="#4F81BD">Instead of an afterword</font> </h2><br>  Download, try, write (good) reviews on <a href="http://visualstudiogallery.msdn.microsoft.com/bcac44d9-4b9d-45cd-b95e-f19929ac3831">the extension page</a> ) <br>  Bugs, please send <a href="https://github.com/omgtehlion/NodeVsDebugger/issues">to githab</a> . <br>  Better yet, send pull requests directly to the code ‚Äî <a href="https://github.com/omgtehlion/NodeVsDebugger">fork me on GitHub!</a>  . </div><p>Source: <a href="https://habr.com/ru/post/172107/">https://habr.com/ru/post/172107/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../172083/index.html">On the styles of implementing large ERP projects</a></li>
<li><a href="../172085/index.html">SQLite - database size after DELETE FROM</a></li>
<li><a href="../172093/index.html">Report on the maintenance of the base station standards GSM and UMTS</a></li>
<li><a href="../172101/index.html">Yet Another Rating System</a></li>
<li><a href="../172105/index.html">CryptoSMS - protect your SMS (Android only)</a></li>
<li><a href="../172109/index.html">Rails 4 - Thread-Safety</a></li>
<li><a href="../172111/index.html">DIYROCKETS and Sunglass are taking a step towards the general availability of aerospace development using joint 3D modeling</a></li>
<li><a href="../172115/index.html">Controlling access to Samba file servers in an AD-based Windows domain</a></li>
<li><a href="../172119/index.html">SimplePHPEasyPlus: Adding Numbers to PHP</a></li>
<li><a href="../172121/index.html">Cross-platform development for mobile with Xamarin</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>