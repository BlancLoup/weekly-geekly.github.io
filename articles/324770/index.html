<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>OpenVPN, easy reissue of root certificate</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day. The background is as follows: ten years ago I raised the infrastructure of a network of mobile phone salons, distributed over the region. Th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>OpenVPN, easy reissue of root certificate</h1><div class="post__text post__text-html js-mediator-article">  Good day.  The background is as follows: ten years ago I raised the infrastructure of a network of mobile phone salons, distributed over the region.  The 1C: Enterprise 7.7 system was used as the accounting solution in the distributed database mode.  For data exchange, the usual windows network folder was used, which was accessed through the OpenVPN tunnel.  And once a week ago, the exchange of information between the center and the periphery completely stopped.  For some reason, the thought immediately crept in - ten years had passed (it was for this period that the root certificate was made).  Analysis of the logs confirmed the problem, the scheme has proven itself well over these ten years, but the time has come.  And now, to re-generate the entire amount of client and server keys / certificates ???  No, you can do a little easier ... <br><a name="habracut"></a><br>  OpenSSL allows you to reissue the certificate and sign it with the old private key, while maintaining the structure of the Modulus certificate and the new certificate successfully verifies the old client certificates. <br><br>  Create a new certificate: <br><br><pre><code class="bash hljs">openssl x509 -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ca.crt -days 3650 -out ca-new.crt -signkey ca.key</code> </pre> <br>  We get the answer: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="bash hljs">Getting Private key</code> </pre> <br>  and new certificate ca-new.crt <br><br>  Let's check the client certificate with a new root certificate: <br><br><pre> <code class="bash hljs">openssl verify -CAfile ca-new.crt client9.crt</code> </pre> <br>  All is well: <br><br><pre> <code class="bash hljs">client9.crt: OK</code> </pre> <br>  The next command can look at the contents of the certificate and make sure that the new and old Modulus certificate is the same: <br><br><pre> <code class="bash hljs">openssl x509 -noout -text -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ca-new.crt</code> </pre> <br>  Everything seems to be very good, we are sending a new certificate, after renaming it in the same way as the old one, with instructions to the user where to put it (we overwrite the old one). <br><br>  Restart the service on the server and see how the clients connect.  Unfortunately, not all clients did it successfully.  Some have received in the log: <br><br><pre> <code class="bash hljs">Tue Mar 21 15:12:18 2017 VERIFY ERROR: depth=1, error=certificate signature failure: /C=RU...</code> </pre> <br>  It was here that I had to lose a few hours, in the end it turned out that the client certificate verification also fails on client computers: <br><br><pre> <code class="bash hljs">openssl verify -CAfile ca-new.crt client9.crt</code> </pre> <br>  The openssl version (as part of OpenVPN) turned out to be old and did not want to check successfully. <br><br>  Accordingly, the problematic clients had to update OpenVPN to version 2.3.3 (this was used by me, I can‚Äôt say anything about others, but I believe that newer versions will also behave positively) and the system has been sent for another 10 years. </div><p>Source: <a href="https://habr.com/ru/post/324770/">https://habr.com/ru/post/324770/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../324758/index.html">Orienteer: overview of the platform and the latest release updates</a></li>
<li><a href="../324760/index.html">Visualization of attacks based on ELK (elasticsearch, kibana, logstash)</a></li>
<li><a href="../324762/index.html">Gamedev for dummies or how to make a game alone</a></li>
<li><a href="../324764/index.html">‚ÄúSmall yes remote‚Äù: scientists have developed a flow battery that cools the chips</a></li>
<li><a href="../324766/index.html">Automate mobile apps with SeeTest Automation</a></li>
<li><a href="../324772/index.html">Selection of a random record from a table with 700 * 10 ^ 6 rows</a></li>
<li><a href="../324774/index.html">Create a design system</a></li>
<li><a href="../324776/index.html">Eliminate errors in the Building resources when building android-applications using Apktool</a></li>
<li><a href="../324780/index.html">New Era of the Web: ITMO University begins training IT specialists in the field of neurotechnology</a></li>
<li><a href="../324782/index.html">Communication for everyone: Grandstream Networks news</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>